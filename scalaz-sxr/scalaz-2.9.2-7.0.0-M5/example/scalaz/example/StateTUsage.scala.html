<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>example/scalaz/example/StateTUsage.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scalaz.example

<span class="keyword">import</span> scalaz._

<span class="keyword">object</span> <a title="object scalaz.example.StateTUsage" id="33617">StateTUsage</a> <span title="ScalaObject" class="keyword">extends</span> <span title="App">App</span> <span class="delimiter">{</span>
  <span class="keyword">import</span> <a href="../../../core/scalaz/StateT.scala.html#11748" title="object scalaz.StateT">StateT</a>._

  <span class="keyword">def</span> <a title="[M[+_]](implicit evidence$1: scalaz.Functor[M])Unit" id="615729">f</a><span class="delimiter">[</span><a title="[+_]&gt;: Nothing &lt;: Any" id="615720">M</a><span class="delimiter">[</span>+<a title="&gt;: Nothing &lt;: Any" id="615731">_</a><span class="delimiter">]</span>: Functor<span class="delimiter">]</span> <span class="delimiter">{</span>
    <a href="../../../core/scalaz/Functor.scala.html#111902" title="[F[_]](implicit F: scalaz.Functor[F])scalaz.Functor[F]">Functor</a><a href="../../../core/scalaz/StateT.scala.html#130512" title="(implicit F: scalaz.Functor[[a]scalaz.StateT[M,Int,a]])scalaz.Functor[[a]scalaz.StateT[M,Int,a]]" class="delimiter">[</a><span class="delimiter">(</span><span class="delimiter">{</span><span class="keyword">type</span> l<span class="delimiter">[</span>a<span class="delimiter">]</span> = StateT<span class="delimiter">[</span>M, Int, a<span class="delimiter">]</span><span class="delimiter">}</span><span class="delimiter">)</span>#<a href="../../../core/scalaz/StateT.scala.html#11747" title="[a]scalaz.StateT[M,Int,a]">l</a><span class="delimiter">]</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[M[+_]](implicit evidence$2: scalaz.Pointed[M])Unit" id="615825">p</a><span class="delimiter">[</span><a title="[+_]&gt;: Nothing &lt;: Any" id="615723">M</a><span class="delimiter">[</span>+<a title="&gt;: Nothing &lt;: Any" id="615827">_</a><span class="delimiter">]</span>: Pointed<span class="delimiter">]</span> <span class="delimiter">{</span>
    <a href="../../../core/scalaz/Functor.scala.html#111902" title="[F[_]](implicit F: scalaz.Functor[F])scalaz.Functor[F]">Functor</a><a href="../../../core/scalaz/StateT.scala.html#130518" title="(implicit F: scalaz.Functor[[a]scalaz.StateT[M,Int,a]])scalaz.Functor[[a]scalaz.StateT[M,Int,a]]" class="delimiter">[</a><span class="delimiter">(</span><span class="delimiter">{</span><span class="keyword">type</span> l<span class="delimiter">[</span>a<span class="delimiter">]</span> = StateT<span class="delimiter">[</span>M, Int, a<span class="delimiter">]</span><span class="delimiter">}</span><span class="delimiter">)</span>#<a href="../../../core/scalaz/StateT.scala.html#11747" title="[a]scalaz.StateT[M,Int,a]">l</a><span class="delimiter">]</span>
    <a href="../../../core/scalaz/Pointed.scala.html#145457" title="[F[_]](implicit F: scalaz.Pointed[F])scalaz.Pointed[F]">Pointed</a><a href="../../../core/scalaz/StateT.scala.html#130518" title="(implicit F: scalaz.Pointed[[a]scalaz.StateT[M,Int,a]])scalaz.Pointed[[a]scalaz.StateT[M,Int,a]]" class="delimiter">[</a><span class="delimiter">(</span><span class="delimiter">{</span><span class="keyword">type</span> l<span class="delimiter">[</span>a<span class="delimiter">]</span> = StateT<span class="delimiter">[</span>M, Int, a<span class="delimiter">]</span><span class="delimiter">}</span><span class="delimiter">)</span>#<a href="../../../core/scalaz/StateT.scala.html#11747" title="[a]scalaz.StateT[M,Int,a]">l</a><span class="delimiter">]</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[M[+_]](implicit evidence$3: scalaz.Monad[M])Unit" id="616005">m</a><span class="delimiter">[</span><a title="[+_]&gt;: Nothing &lt;: Any" id="615726">M</a><span class="delimiter">[</span>+<a title="&gt;: Nothing &lt;: Any" id="616007">_</a><span class="delimiter">]</span>: Monad<span class="delimiter">]</span> <span class="delimiter">{</span>
    <a href="../../../core/scalaz/Applicative.scala.html#57710" title="[F[_]](implicit F: scalaz.Applicative[F])scalaz.Applicative[F]">Applicative</a><a href="../../../core/scalaz/StateT.scala.html#130524" title="(implicit F: scalaz.Applicative[[a]scalaz.StateT[M,Int,a]])scalaz.Applicative[[a]scalaz.StateT[M,Int,a]]" class="delimiter">[</a><span class="delimiter">(</span><span class="delimiter">{</span><span class="keyword">type</span> l<span class="delimiter">[</span>a<span class="delimiter">]</span> = StateT<span class="delimiter">[</span>M, Int, a<span class="delimiter">]</span><span class="delimiter">}</span><span class="delimiter">)</span>#<a href="../../../core/scalaz/StateT.scala.html#11747" title="[a]scalaz.StateT[M,Int,a]">l</a><span class="delimiter">]</span>
    <a href="../../../core/scalaz/Monad.scala.html#166034" title="[F[_]](implicit F: scalaz.Monad[F])scalaz.Monad[F]">Monad</a><a href="../../../core/scalaz/StateT.scala.html#130524" title="(implicit F: scalaz.Monad[[a]scalaz.StateT[M,Int,a]])scalaz.Monad[[a]scalaz.StateT[M,Int,a]]" class="delimiter">[</a><span class="delimiter">(</span><span class="delimiter">{</span><span class="keyword">type</span> l<span class="delimiter">[</span>a<span class="delimiter">]</span> = StateT<span class="delimiter">[</span>M, Int, a<span class="delimiter">]</span><span class="delimiter">}</span><span class="delimiter">)</span>#<a href="../../../core/scalaz/StateT.scala.html#11747" title="[a]scalaz.StateT[M,Int,a]">l</a><span class="delimiter">]</span>
    <a href="../../../core/scalaz/MonadState.scala.html#324464" title="[F[_,_], S](implicit F: scalaz.MonadState[F,S])scalaz.MonadState[F,S]">MonadState</a><a href="../../../core/scalaz/StateT.scala.html#130524" title="(implicit F: scalaz.MonadState[[s, a]scalaz.StateT[M,s,a],Int])scalaz.MonadState[[s, a]scalaz.StateT[M,s,a],Int]" class="delimiter">[</a><span class="delimiter">(</span><span class="delimiter">{</span><span class="keyword">type</span> f<span class="delimiter">[</span>s, a<span class="delimiter">]</span> = StateT<span class="delimiter">[</span>M, s, a<span class="delimiter">]</span><span class="delimiter">}</span><span class="delimiter">)</span>#<a href="../../../core/scalaz/StateT.scala.html#11747" title="[s, a]scalaz.StateT[M,s,a]">f</a>, <span title="Int">Int</span><span class="delimiter">]</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="615727">state</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scalaz.package.State[String,Int]" id="616128">state</a>: <a href="../../../core/scalaz/StateT.scala.html#11747" title="scalaz.package.State[String,Int]">State</a><span class="delimiter">[</span>String, Int<span class="delimiter">]</span> = <a href="../../../core/scalaz/package.scala.html#86273" title="(f: java.lang.String =&gt; (java.lang.String, Int))scalaz.package.State[java.lang.String,Int]">State</a><span class="delimiter">(</span><span class="delimiter">(</span>x: <span title="String">String</span><span class="delimiter">)</span> =&gt; <span title="(_1: java.lang.String, _2: Int)(java.lang.String, Int)" class="delimiter">(</span><a href="#616134" title="String">x</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="Int(1)" class="int">1</span>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="616129">eval</a>: <span title="Int">Int</span> = <a href="#616128" title="scalaz.package.State[String,Int]">state</a>.<a href="../../../core/scalaz/StateT.scala.html#86241" title="(initial: String)(implicit F: scalaz.Functor[scalaz.Id.Id])scalaz.Id.Id[Int]">eval</a><a href="../../../core/scalaz/package.scala.html#38787" title="=&gt; scalaz.Traverse[scalaz.Id.Id] with scalaz.Each[scalaz.Id.Id] with scalaz.Monad[scalaz.Id.Id] with scalaz.Comonad[scalaz.Id.Id] with scalaz.Cojoin[scalaz.Id.Id] with scalaz.Distributive[scalaz.Id.Id] with scalaz.Zip[scalaz.Id.Id] with scalaz.Unzip[scalaz.Id.Id] with scalaz.Cozip[scalaz.Id.Id]" class="delimiter">(</a><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
    <a href="#616128" title="scalaz.package.State[String,Int]">state</a>.<a href="../../../core/scalaz/StateT.scala.html#86248" title="(f: Int =&gt; scalaz.StateT[scalaz.Id.Id,String,Int])(implicit F: scalaz.Bind[scalaz.Id.Id])scalaz.StateT[scalaz.Id.Id,String,Int]">flatMap</a><a href="../../../core/scalaz/package.scala.html#38787" title="=&gt; scalaz.Traverse[scalaz.Id.Id] with scalaz.Each[scalaz.Id.Id] with scalaz.Monad[scalaz.Id.Id] with scalaz.Comonad[scalaz.Id.Id] with scalaz.Cojoin[scalaz.Id.Id] with scalaz.Distributive[scalaz.Id.Id] with scalaz.Zip[scalaz.Id.Id] with scalaz.Unzip[scalaz.Id.Id] with scalaz.Cozip[scalaz.Id.Id]" class="delimiter">(</a><a title="Int" id="616156">_</a> =&gt; <a href="#616128" title="scalaz.package.State[String,Int]">state</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object scalaz.example.FibStateExample" id="33086">FibStateExample</a> <span title="ScalaObject" class="keyword">extends</span> <span title="App">App</span> <span class="delimiter">{</span>
  <span class="keyword">val</span> <a title="scalaz.MonadState[[s, a]scalaz.StateT[[+X]X,s,a],(Int, Int)]" id="616162">S</a> = scalaz.<a href="../../../core/scalaz/StateT.scala.html#11748" title="object scalaz.StateT">StateT</a>.<a href="../../../core/scalaz/StateT.scala.html#130533" title="[S]=&gt; scalaz.MonadState[[s, a]scalaz.StateT[[+X]X,s,a],S]">stateMonad</a><span title="scalaz.MonadState[[s, a]scalaz.StateT[[+X]X,s,a],(Int, Int)]" class="delimiter">[</span><span title="(Int, Int)" class="delimiter">(</span>Int, Int<span class="delimiter">)</span><span class="delimiter">]</span>
  <span class="keyword">import</span> <a href="#616162" title="=&gt; scalaz.MonadState[[s, a]scalaz.StateT[[+X]X,s,a],(Int, Int)]">S</a>.<a href="../../../core/scalaz/Monad.scala.html#43514" title="=&gt; java.lang.Object with scalaz.syntax.MonadSyntax[[x]scalaz.StateT[[+X]X,(Int, Int),x]]">monadSyntax</a>._
  <span class="keyword">import</span> scalaz.<a href="../../../core/scalaz/package.scala.html#38833" title="object scalaz.package.State">State</a>._
  <span class="keyword">import</span> scalaz.std.<a href="../../../core/scalaz/std/List.scala.html#26333" title="object scalaz.std.list">list</a>._

  <span class="keyword">val</span> <a title="(Int, Int)" id="616167">initialState</a> = <span title="(_1: Int, _2: Int)(Int, Int)" class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>

  <span class="keyword">val</span> <span class="delimiter">(</span>nextFib: <a href="../../../core/scalaz/StateT.scala.html#11747" title="scalaz.package.State[(Int, Int),Int]">State</a><span class="delimiter">[</span><span class="delimiter">(</span>Int, Int<span class="delimiter">)</span>, Int<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="keyword">for</span> <span class="delimiter">{</span>
    <a title="(Int, Int)" id="616244">s</a> &lt;- <a href="../../../core/scalaz/State.scala.html#53535" title="scalaz.package.State[(Int, Int),(Int, Int)]">init</a>:<a href="../../../core/scalaz/StateT.scala.html#11747" title="scalaz.package.State[(Int, Int),(Int, Int)]">State</a><span class="delimiter">[</span><span class="delimiter">(</span>Int, Int<span class="delimiter">)</span>, <span class="delimiter">(</span>Int, Int<span class="delimiter">)</span><span class="delimiter">]</span>
    <span class="keyword">val</span> <a title="((Int, Int), Int, Int)" id="616189" class="delimiter">(</a><a href="#616188" title="Int" id="616247">a</a>,<a href="#616188" title="Int" id="616248">b</a><span class="delimiter">)</span> = <a href="#616244" title="(Int, Int)">s</a>
    <span class="keyword">val</span> <a title="Int" id="616249">n</a> = <a href="#616247" title="Int">a</a> <span title="(x: Int)Int">+</span> <a href="#616248" title="Int">b</a>
    <a title="Unit" id="616264">_</a> &lt;- <a href="../../../core/scalaz/State.scala.html#53546" title="(s: (Int, Int))scalaz.package.State[(Int, Int),Unit]">put</a> <a href="../../../core/scalaz/StateT.scala.html#86245" title="(f: Unit =&gt; Int)(implicit F: scalaz.Functor[scalaz.Id.Id])scalaz.StateT[scalaz.Id.Id,(Int, Int),Int]" class="delimiter">(</a><a href="#616248" title="Int">b</a>, <a href="#616249" title="Int">n</a><span class="delimiter">)</span>
  <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="#616248" title="Int">b</a> <span class="comment">// if we yield n, getNFibs gives you (1,2,3,5,8...)</span>
            <span class="comment">// yield b instead to get (1,1,2,3...)</span>

  <span class="keyword">def</span> <a title="(k: Int)scalaz.package.State[(Int, Int),List[Int]]" id="616171">getNFibs</a><span class="delimiter">(</span><a title="Int" id="616275">k</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="../../../core/scalaz/StateT.scala.html#11747" title="scalaz.package.State[(Int, Int),List[Int]]">State</a><span class="delimiter">[</span><span class="delimiter">(</span>Int, Int<span class="delimiter">)</span>, List<span class="delimiter">[</span>Int<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="../../../core/scalaz/syntax/MonadSyntax.scala.html#323769" title="(v: scalaz.StateT[[+X]X,(Int, Int),Int])scalaz.syntax.MonadOps[[x]scalaz.StateT[[+X]X,(Int, Int),x],Int]">nextFib</a>.<a href="../../../core/scalaz/syntax/MonadSyntax.scala.html#290642" title="(n: Int)scalaz.StateT[[+X]X,(Int, Int),List[Int]]">replicateM</a><span class="delimiter">(</span><a href="#616275" title="Int">k</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(k: Int)scalaz.package.State[(Int, Int),Int]" id="616172">getNthFib</a><span class="delimiter">(</span><a title="Int" id="616310">k</a>:<span title="Int">Int</span><span class="delimiter">)</span>: <a href="../../../core/scalaz/StateT.scala.html#11747" title="scalaz.package.State[(Int, Int),Int]">State</a><span class="delimiter">[</span><span class="delimiter">(</span>Int, Int<span class="delimiter">)</span>, Int<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span title="scalaz.package.State[(Int, Int),Int]" class="keyword">if</span> <span class="delimiter">(</span><a href="#616310" title="Int">k</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <a href="../../../core/scalaz/syntax/PointedSyntax.scala.html#116089" title="(a: =&gt; Int)(implicit F: scalaz.Pointed[[x]scalaz.StateT[[+X]X,(Int, Int),x]])scalaz.StateT[[+X]X,(Int, Int),Int]">pure</a><a href="../../../core/scalaz/StateT.scala.html#130533" title="scalaz.MonadState[[s, a]scalaz.StateT[[+X]X,s,a],(Int, Int)]" class="delimiter">(</a><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="comment">// will be thrown away</span>
    <span class="keyword">else</span>
      <a href="#616172" title="(k: Int)scalaz.package.State[(Int, Int),Int]">getNthFib</a><a href="../../../core/scalaz/syntax/BindSyntax.scala.html#144808" title="(v: scalaz.StateT[[+X]X,(Int, Int),Int])scalaz.syntax.BindOps[[x]scalaz.StateT[[+X]X,(Int, Int),x],Int]" class="delimiter">(</a><a href="#616310" title="Int">k</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <a href="../../../core/scalaz/syntax/BindSyntax.scala.html#290724" title="(b: scalaz.StateT[[+X]X,(Int, Int),Int])scalaz.StateT[[+X]X,(Int, Int),Int]">&gt;&gt;</a> <a href="#616169" title="=&gt; scalaz.package.State[(Int, Int),Int]">nextFib</a>
  <span class="delimiter">}</span>

  <span class="comment">// run two examples through the magic of App</span>
  <span title="(x: Any)Unit">println</span><span class="delimiter">(</span> <a href="#616172" title="(k: Int)scalaz.package.State[(Int, Int),Int]">getNthFib</a><span class="delimiter">(</span><span title="Int(5)" class="int">5</span><span class="delimiter">)</span>.<a href="../../../core/scalaz/StateT.scala.html#86241" title="(initial: (Int, Int))(implicit F: scalaz.Functor[scalaz.Id.Id])scalaz.Id.Id[Int]">eval</a><a href="../../../core/scalaz/package.scala.html#38787" title="=&gt; scalaz.Traverse[scalaz.Id.Id] with scalaz.Each[scalaz.Id.Id] with scalaz.Monad[scalaz.Id.Id] with scalaz.Comonad[scalaz.Id.Id] with scalaz.Cojoin[scalaz.Id.Id] with scalaz.Distributive[scalaz.Id.Id] with scalaz.Zip[scalaz.Id.Id] with scalaz.Unzip[scalaz.Id.Id] with scalaz.Cozip[scalaz.Id.Id]" class="delimiter">(</a> <a href="#616167" title="=&gt; (Int, Int)">initialState</a> <span class="delimiter">)</span> <span class="delimiter">)</span>
  <span title="(x: Any)Unit">println</span><span class="delimiter">(</span> <a href="#616171" title="(k: Int)scalaz.package.State[(Int, Int),List[Int]]">getNFibs</a><span class="delimiter">(</span><span title="Int(10)" class="int">10</span><span class="delimiter">)</span>.<a href="../../../core/scalaz/StateT.scala.html#86241" title="(initial: (Int, Int))(implicit F: scalaz.Functor[scalaz.Id.Id])scalaz.Id.Id[List[Int]]">eval</a><a href="../../../core/scalaz/package.scala.html#38787" title="=&gt; scalaz.Traverse[scalaz.Id.Id] with scalaz.Each[scalaz.Id.Id] with scalaz.Monad[scalaz.Id.Id] with scalaz.Comonad[scalaz.Id.Id] with scalaz.Cojoin[scalaz.Id.Id] with scalaz.Distributive[scalaz.Id.Id] with scalaz.Zip[scalaz.Id.Id] with scalaz.Unzip[scalaz.Id.Id] with scalaz.Cozip[scalaz.Id.Id]" class="delimiter">(</a> <a href="#616167" title="=&gt; (Int, Int)">initialState</a> <span class="delimiter">)</span> <span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/** Simple call-by-need (i.e. lazy) interpreter for Lambda Calculus based off of
  * John Launchbury's &quot;A Natural Semantics for Lazy Evaluation&quot;
  * Uses the &quot;Barendregt convention&quot;: All variable names are globally unique
  * (i.e. you cannot shadow variable names), and renames variables after substitution
  * to maintain this invariant.
  */</span>
<span class="keyword">object</span> <a title="object scalaz.example.LaunchburyInterpreter" id="33713">LaunchburyInterpreter</a> <span title="ScalaObject" class="keyword">extends</span> <span title="App">App</span> <span class="delimiter">{</span>
  <span class="keyword">import</span> scala.collection.immutable.HashMap
  <span class="keyword">import</span> scalaz.<a href="../../../core/scalaz/StreamT.scala.html#10398" title="object scalaz.StreamT">StreamT</a>._
  <span class="keyword">import</span> scalaz.std.<a href="../../../core/scalaz/std/Function.scala.html#26012" title="object scalaz.std.function">function</a>._
  <span class="keyword">import</span> scalaz.std.<a href="../../../core/scalaz/std/List.scala.html#26333" title="object scalaz.std.list">list</a>._
  <span class="keyword">import</span> scalaz.std.<a href="../../../core/scalaz/std/Map.scala.html#26483" title="object scalaz.std.map">map</a>._
  <span class="keyword">import</span> scalaz.syntax.<a href="../../../core/scalaz/syntax/Syntax.scala.html#38989" title="object scalaz.syntax.package.foldable">foldable</a>._
  <span class="keyword">import</span> scalaz.syntax.<a href="../../../core/scalaz/syntax/Syntax.scala.html#38951" title="object scalaz.syntax.package.traverse">traverse</a>._
  <span class="keyword">import</span> scalaz.syntax.<a href="../../../core/scalaz/syntax/Syntax.scala.html#38969" title="object scalaz.syntax.package.arrow">arrow</a>._

  <span class="keyword">val</span> <a title="scalaz.MonadState[[s, a]scalaz.StateT[[+X]X,s,a],scalaz.example.LaunchburyInterpreter.ReduceState]" id="616455">S</a> = scalaz.<a href="../../../core/scalaz/StateT.scala.html#11748" title="object scalaz.StateT">StateT</a>.<a href="../../../core/scalaz/StateT.scala.html#130533" title="[S]=&gt; scalaz.MonadState[[s, a]scalaz.StateT[[+X]X,s,a],S]">stateMonad</a><span title="scalaz.MonadState[[s, a]scalaz.StateT[[+X]X,s,a],scalaz.example.LaunchburyInterpreter.ReduceState]" class="delimiter">[</span><a href="#620460" title="scalaz.example.LaunchburyInterpreter.ReduceState">ReduceState</a><span class="delimiter">]</span>
  <span class="keyword">import</span> <a href="#616455" title="=&gt; scalaz.MonadState[[s, a]scalaz.StateT[[+X]X,s,a],scalaz.example.LaunchburyInterpreter.ReduceState]">S</a>.<a href="../../../core/scalaz/Monad.scala.html#43514" title="=&gt; java.lang.Object with scalaz.syntax.MonadSyntax[[x]scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,x]]">monadSyntax</a>._
  <span class="keyword">import</span> scalaz.<a href="../../../core/scalaz/package.scala.html#38833" title="object scalaz.package.State">State</a>._

  <span class="comment">/** Simple lambda calculus Abstract Syntax Tree.
    * Note that that apply applies a let-bound argument to an Expr.
    * This is to make sharing easier, by ensuring that arguments are in the heap.
    */</span>
  <span class="keyword">abstract</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <a title="class Expr extends java.lang.Object with ScalaObject" id="616459">Expr</a>
  case <span class="keyword">class</span> <a title="class Lambda extends scalaz.example.LaunchburyInterpreter.Expr with ScalaObject with Product with Serializable" id="620476">Lambda</a><a href="#620476" title="ScalaObject" class="delimiter">(</a><a title="String" id="616508">name</a>: <span title="String">String</span>, <a title="scalaz.example.LaunchburyInterpreter.Expr" id="616509">term</a>: <a href="#616459" title="scalaz.example.LaunchburyInterpreter.Expr">Expr</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#616459" title="scalaz.example.LaunchburyInterpreter.Expr">Expr</a>
  case <span class="keyword">class</span> <a title="class Apply extends scalaz.example.LaunchburyInterpreter.Expr with ScalaObject with Product with Serializable" id="620472">Apply</a><a href="#620472" title="ScalaObject" class="delimiter">(</a><a title="scalaz.example.LaunchburyInterpreter.Expr" id="616679">term</a>: <a href="#616459" title="scalaz.example.LaunchburyInterpreter.Expr">Expr</a>, <a title="String" id="616680">arg</a>:<span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#616459" title="scalaz.example.LaunchburyInterpreter.Expr">Expr</a>
  case <span class="keyword">class</span> <a title="class Var extends scalaz.example.LaunchburyInterpreter.Expr with ScalaObject with Product with Serializable" id="620468">Var</a><a href="#620468" title="ScalaObject" class="delimiter">(</a><a title="String" id="616524">name</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#616459" title="scalaz.example.LaunchburyInterpreter.Expr">Expr</a>
  case <span class="keyword">class</span> <a title="class Let extends scalaz.example.LaunchburyInterpreter.Expr with ScalaObject with Product with Serializable" id="620464">Let</a><a href="#620464" title="ScalaObject" class="delimiter">(</a><a title="Map[String,scalaz.example.LaunchburyInterpreter.Expr]" id="616540">bindings</a>: <span title="Map[String,scalaz.example.LaunchburyInterpreter.Expr]">Map</span><span class="delimiter">[</span>String, Expr<span class="delimiter">]</span>, <a title="scalaz.example.LaunchburyInterpreter.Expr" id="616541">term</a>: <a href="#616459" title="scalaz.example.LaunchburyInterpreter.Expr">Expr</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#616459" title="scalaz.example.LaunchburyInterpreter.Expr">Expr</a>

  <span class="comment">// \x.x</span>
  <span class="keyword">val</span> <a title="scalaz.example.LaunchburyInterpreter.Lambda" id="616472">example1</a> = <a href="#620476" title="(name: String, term: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Lambda">Lambda</a><span class="delimiter">(</span><span title="java.lang.String(&quot;x&quot;)" class="string">&quot;x&quot;</span>, <a href="#620468" title="(name: String)scalaz.example.LaunchburyInterpreter.Var">Var</a><span class="delimiter">(</span><span title="java.lang.String(&quot;x&quot;)" class="string">&quot;x&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="comment">// let z = \y.y in (\x.x) z</span>
  <span class="keyword">val</span> <a title="scalaz.example.LaunchburyInterpreter.Let" id="616474">example2</a> = <a href="#620464" title="(bindings: Map[String,scalaz.example.LaunchburyInterpreter.Expr], term: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Let">Let</a><span class="delimiter">(</span> <span title="(elems: (java.lang.String, scalaz.example.LaunchburyInterpreter.Lambda)*)scala.collection.immutable.HashMap[java.lang.String,scalaz.example.LaunchburyInterpreter.Lambda]">HashMap</span><span class="delimiter">(</span> <span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;z&quot;</span> <span title="(y: scalaz.example.LaunchburyInterpreter.Lambda)(java.lang.String, scalaz.example.LaunchburyInterpreter.Lambda)">-&gt;</span> <a href="#620476" title="(name: String, term: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Lambda">Lambda</a><span class="delimiter">(</span><span title="java.lang.String(&quot;y&quot;)" class="string">&quot;y&quot;</span>, <a href="#620468" title="(name: String)scalaz.example.LaunchburyInterpreter.Var">Var</a><span class="delimiter">(</span><span title="java.lang.String(&quot;y&quot;)" class="string">&quot;y&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">)</span>
                    , <a href="#620472" title="(term: scalaz.example.LaunchburyInterpreter.Expr, arg: String)scalaz.example.LaunchburyInterpreter.Apply">Apply</a><span class="delimiter">(</span><a href="#616472" title="=&gt; scalaz.example.LaunchburyInterpreter.Lambda">example1</a>, <span title="java.lang.String(&quot;z&quot;)" class="string">&quot;z&quot;</span><span class="delimiter">)</span>
                    <span class="delimiter">)</span>

  case <span class="keyword">class</span> <a title="class ReduceState extends java.lang.Object with ScalaObject with Product with Serializable" id="620460">ReduceState</a><a href="#620460" title="ScalaObject" class="delimiter">(</a> <a title="Map[String,scalaz.example.LaunchburyInterpreter.Expr]" id="616690">heap</a>: <span title="Map[String,scalaz.example.LaunchburyInterpreter.Expr]">Map</span><span class="delimiter">[</span>String, Expr<span class="delimiter">]</span>
                        , <a title="Stream[String]" id="616691">freshVars</a>: <span title="Stream[String]">Stream</span><span class="delimiter">[</span>String<span class="delimiter">]</span>
                        <span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scalaz.example.LaunchburyInterpreter.ReduceState" id="616479">initialState</a> = <a href="#620460" title="(heap: Map[String,scalaz.example.LaunchburyInterpreter.Expr], freshVars: Stream[String])scalaz.example.LaunchburyInterpreter.ReduceState">ReduceState</a><span class="delimiter">(</span> <span title="(elems: (String, Nothing)*)scala.collection.immutable.HashMap[String,Nothing]">HashMap</span><span class="delimiter">(</span><span class="delimiter">)</span>
                                        , <span title="=&gt; collection.immutable.Stream.type">Stream</span>.<span title="(start: Int)scala.collection.immutable.Stream[Int]">from</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="(f: Int =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Stream[Int],java.lang.String,Stream[String]])Stream[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.Stream.Coll,java.lang.String,scala.collection.immutable.Stream[java.lang.String]]" class="delimiter">(</span><a title="Int" id="616728">x</a> =&gt; <span title="java.lang.String(&quot;$&quot;)" class="string">&quot;$&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#616728" title="Int">x</a><span class="delimiter">)</span> <span class="comment">// i.e. $1, $2, $3, ...</span>
                                        <span class="delimiter">)</span>
  <span class="comment">// Substitute new variable names in</span>
  <span class="comment">// e.g. sub(map(&quot;x&quot; -&gt; &quot;y&quot;), Var(&quot;x&quot;)) =&gt; Var(&quot;y&quot;)</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(m: Map[String,String])(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Expr" id="616481">sub</a><span class="delimiter">(</span><a title="Map[String,String]" id="617079">m</a>: <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="scalaz.example.LaunchburyInterpreter.Expr" id="617080">e</a>: <a href="#616459" title="scalaz.example.LaunchburyInterpreter.Expr">Expr</a><span class="delimiter">)</span>: <a href="#616459" title="scalaz.example.LaunchburyInterpreter.Expr">Expr</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scalaz.example.LaunchburyInterpreter.Expr =&gt; scalaz.example.LaunchburyInterpreter.Expr" id="617082">subExpr</a> = <a href="#616481" title="(m: Map[String,String])(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Expr">sub</a><a href="#617085" title="scalaz.example.LaunchburyInterpreter.Expr" class="delimiter">(</a><a href="#617079" title="Map[String,String]">m</a><span class="delimiter">)</span> _
    <span class="keyword">def</span> <a title="(n: String)String" id="617083">subName</a><span class="delimiter">(</span><a title="String" id="617086">n</a>: <span title="String">String</span><span class="delimiter">)</span> = <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#617079" title="Map[String,String]">m</a> <span title="(key: String)Boolean">contains</span> <a href="#617086" title="String">n</a><span class="delimiter">)</span> <a href="#617079" title="(key: String)String">m</a><span class="delimiter">(</span><a href="#617086" title="String">n</a><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#617086" title="String">n</a>
    <a href="#617080" title="scalaz.example.LaunchburyInterpreter.Expr">e</a> <span title="scalaz.example.LaunchburyInterpreter.Expr" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="scalaz.example.LaunchburyInterpreter.Lambda">Lambda</span><span class="delimiter">(</span><a title="String" id="617107">z</a>, <a title="scalaz.example.LaunchburyInterpreter.Expr" id="617108">e2</a><span class="delimiter">)</span> =&gt; <a href="#620476" title="(name: String, term: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Lambda">Lambda</a><span class="delimiter">(</span><a href="#617083" title="(n: String)String">subName</a><span class="delimiter">(</span><a href="#617107" title="String">z</a><span class="delimiter">)</span>, <a href="#617082" title="(v1: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Expr">subExpr</a><span class="delimiter">(</span><a href="#617108" title="scalaz.example.LaunchburyInterpreter.Expr">e2</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="scalaz.example.LaunchburyInterpreter.Apply">Apply</span><span class="delimiter">(</span><a title="scalaz.example.LaunchburyInterpreter.Expr" id="617112">e2</a>, <a title="String" id="617113">z</a><span class="delimiter">)</span>  =&gt; <a href="#620472" title="(term: scalaz.example.LaunchburyInterpreter.Expr, arg: String)scalaz.example.LaunchburyInterpreter.Apply">Apply</a><span class="delimiter">(</span><a href="#617082" title="(v1: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Expr">subExpr</a><span class="delimiter">(</span><a href="#617112" title="scalaz.example.LaunchburyInterpreter.Expr">e2</a><span class="delimiter">)</span>, <a href="#617083" title="(n: String)String">subName</a><span class="delimiter">(</span><a href="#617113" title="String">z</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="scalaz.example.LaunchburyInterpreter.Var">Var</span><span class="delimiter">(</span><a title="String" id="617116">z</a><span class="delimiter">)</span>        =&gt; <a href="#620468" title="(name: String)scalaz.example.LaunchburyInterpreter.Var">Var</a><span class="delimiter">(</span><a href="#617083" title="(n: String)String">subName</a><span class="delimiter">(</span><a href="#617116" title="String">z</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="scalaz.example.LaunchburyInterpreter.Let">Let</span><span class="delimiter">(</span><a title="Map[String,scalaz.example.LaunchburyInterpreter.Expr]" id="617118">bs</a>, <a title="scalaz.example.LaunchburyInterpreter.Expr" id="617119">e2</a><span class="delimiter">)</span>   =&gt; <a href="#620464" title="(bindings: Map[String,scalaz.example.LaunchburyInterpreter.Expr], term: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Let">Let</a><span class="delimiter">(</span> <a href="#617118" title="Map[String,scalaz.example.LaunchburyInterpreter.Expr]">bs</a>.<span title="(f: ((String, scalaz.example.LaunchburyInterpreter.Expr)) =&gt; (String, scalaz.example.LaunchburyInterpreter.Expr))(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map[String,scalaz.example.LaunchburyInterpreter.Expr],(String, scalaz.example.LaunchburyInterpreter.Expr),Map[String,scalaz.example.LaunchburyInterpreter.Expr]])Map[String,scalaz.example.LaunchburyInterpreter.Expr]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map.Coll,(String, scalaz.example.LaunchburyInterpreter.Expr),scala.collection.immutable.Map[String,scalaz.example.LaunchburyInterpreter.Expr]]" class="delimiter">(</span><a href="../../../core/scalaz/syntax/ArrowSyntax.scala.html#54044" title="(v: String =&gt; String)(implicit F0: scalaz.Arrow[Function1])java.lang.Object with scalaz.syntax.ArrowOps[Function1,String,String]">subName</a> _ <a href="../../../core/scalaz/syntax/ArrowSyntax.scala.html#192762" title="(k: scalaz.example.LaunchburyInterpreter.Expr =&gt; scalaz.example.LaunchburyInterpreter.Expr)((String, scalaz.example.LaunchburyInterpreter.Expr)) =&gt; (String, scalaz.example.LaunchburyInterpreter.Expr)">***</a> <a href="#617082" title="scalaz.example.LaunchburyInterpreter.Expr =&gt; scalaz.example.LaunchburyInterpreter.Expr">subExpr</a><span class="delimiter">)</span>, <a href="#617082" title="(v1: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Expr">subExpr</a><span class="delimiter">(</span><a href="#617119" title="scalaz.example.LaunchburyInterpreter.Expr">e2</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>


  <span class="comment">// replaces every bound variable with a new, &quot;fresh&quot; variable</span>
  <span class="comment">// e.g. freshen(Lambda(&quot;x&quot;, Var(&quot;x&quot;))).eval(initialState) =&gt; Lambda(&quot;$1&quot;, Var(&quot;$1&quot;))</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]" id="616482">freshen</a><span class="delimiter">(</span><a title="scalaz.example.LaunchburyInterpreter.Expr" id="617374">e</a>: <a href="#616459" title="scalaz.example.LaunchburyInterpreter.Expr">Expr</a><span class="delimiter">)</span>: <a href="../../../core/scalaz/StateT.scala.html#11747" title="scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">State</a><span class="delimiter">[</span>ReduceState, Expr<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scalaz.StateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,String]" id="617376">getFreshVar</a> = <span class="keyword">for</span> <span class="delimiter">{</span> <a title="scalaz.example.LaunchburyInterpreter.ReduceState" id="617473">s</a> &lt;- <a href="../../../core/scalaz/State.scala.html#53535" title="scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState]">init</a>: <a href="../../../core/scalaz/StateT.scala.html#11747" title="scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState]">State</a><span class="delimiter">[</span>ReduceState,ReduceState<span class="delimiter">]</span>
                            <span class="keyword">val</span> ReduceState<a title="(scalaz.example.LaunchburyInterpreter.ReduceState, String, scala.collection.immutable.Stream[String])" id="617385" class="delimiter">(</a>_, <a href="#617384" title="String" id="617484">f</a> <a href="#617389" title="(xs: scala.collection.immutable.Stream[String])Option[(String, scala.collection.immutable.Stream[String])]">#::</a> <a href="#617384" title="scala.collection.immutable.Stream[String]" id="617485">fs</a><span class="delimiter">)</span> = <a href="#617473" title="scalaz.example.LaunchburyInterpreter.ReduceState">s</a>
                            <a title="Unit" id="617498">_</a> &lt;- <a href="../../../core/scalaz/State.scala.html#53549" title="(f: scalaz.example.LaunchburyInterpreter.ReduceState =&gt; scalaz.example.LaunchburyInterpreter.ReduceState)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,Unit]">modify</a><a href="../../../core/scalaz/StateT.scala.html#86245" title="(f: Unit =&gt; String)(implicit F: scalaz.Functor[scalaz.Id.Id])scalaz.StateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,String]" class="delimiter">(</a><span class="delimiter">(</span>s:<a href="#620460" title="scalaz.example.LaunchburyInterpreter.ReduceState">ReduceState</a><span class="delimiter">)</span> =&gt; <a href="#617489" title="scalaz.example.LaunchburyInterpreter.ReduceState">s</a>.<a href="#616690" title="Map[String,scalaz.example.LaunchburyInterpreter.Expr]" id="617491">copy</a><span class="delimiter">(</span>freshVars = <a href="#617485" title="scala.collection.immutable.Stream[String]" id="617490">fs</a><span class="delimiter">)</span><span class="delimiter">)</span>
                          <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="#617484" title="String">f</a>
    <span class="comment">// Lambda and Let define new bound variables, so we substitute fresh variables into them</span>
    <span class="comment">// Var and Apply just recursively traverse the AST</span>
    <a href="#617374" title="scalaz.example.LaunchburyInterpreter.Expr">e</a> <span title="scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="scalaz.StateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Lambda]">Lambda</span><span class="delimiter">(</span><a title="String" id="617587">x</a>, <a title="scalaz.example.LaunchburyInterpreter.Expr" id="617588">e2</a><span class="delimiter">)</span> =&gt; <span class="keyword">for</span> <span class="delimiter">{</span> <a title="String" id="617594">y</a> &lt;- <a href="../../../core/scalaz/StateT.scala.html#86248" title="(f: String =&gt; scalaz.StateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Lambda])(implicit F: scalaz.Bind[scalaz.Id.Id])scalaz.StateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Lambda]">getFreshVar</a>
                                  <a title="scalaz.example.LaunchburyInterpreter.Expr" id="617704">e3</a> &lt;- <a href="#616482" title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">freshen</a><a href="../../../core/scalaz/StateT.scala.html#86245" title="(f: scalaz.example.LaunchburyInterpreter.Expr =&gt; scalaz.example.LaunchburyInterpreter.Lambda)(implicit F: scalaz.Functor[scalaz.Id.Id])scalaz.StateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Lambda]" class="delimiter">(</a> <a href="#616481" title="(m: Map[String,String])(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Expr">sub</a><span class="delimiter">(</span><span title="(elems: (String, String)*)scala.collection.immutable.HashMap[String,String]">HashMap</span><span class="delimiter">(</span><a href="#617587" title="(x: String)ArrowAssoc[String]">x</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="#617594" title="String">y</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#617588" title="scalaz.example.LaunchburyInterpreter.Expr">e2</a><span class="delimiter">)</span> <span class="delimiter">)</span>
                                <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="#620476" title="(name: String, term: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Lambda">Lambda</a><span class="delimiter">(</span><a href="#617594" title="String">y</a>, <a href="#617704" title="scalaz.example.LaunchburyInterpreter.Expr">e3</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Apply]">Apply</span><span class="delimiter">(</span><a title="scalaz.example.LaunchburyInterpreter.Expr" id="617795">e2</a>, <a title="String" id="617796">x</a><span class="delimiter">)</span>  =&gt; <a href="#616482" title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">freshen</a><a href="../../../core/scalaz/syntax/BindSyntax.scala.html#144808" title="(v: scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr])scalaz.syntax.BindOps[[x]scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,x],scalaz.example.LaunchburyInterpreter.Expr]" class="delimiter">(</a><a href="#617795" title="scalaz.example.LaunchburyInterpreter.Expr">e2</a><span class="delimiter">)</span> <a href="../../../core/scalaz/syntax/BindSyntax.scala.html#290712" title="(f: scalaz.example.LaunchburyInterpreter.Expr =&gt; scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Apply])scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Apply]">&gt;&gt;=</a> <span class="delimiter">(</span><a title="scalaz.example.LaunchburyInterpreter.Expr" id="617914">e3</a> =&gt; <a href="../../../core/scalaz/syntax/PointedSyntax.scala.html#116089" title="(a: =&gt; scalaz.example.LaunchburyInterpreter.Apply)(implicit F: scalaz.Pointed[[x]scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,x]])scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Apply]">pure</a><a href="../../../core/scalaz/StateT.scala.html#130533" title="scalaz.MonadState[[s, a]scalaz.StateT[[+X]X,s,a],scalaz.example.LaunchburyInterpreter.ReduceState]" class="delimiter">(</a><a href="#620472" title="(term: scalaz.example.LaunchburyInterpreter.Expr, arg: String)scalaz.example.LaunchburyInterpreter.Apply">Apply</a><span class="delimiter">(</span><a href="#617914" title="scalaz.example.LaunchburyInterpreter.Expr">e3</a>, <a href="#617796" title="String">x</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">Var</span><span class="delimiter">(</span>_<span class="delimiter">)</span>        =&gt; <a href="../../../core/scalaz/syntax/PointedSyntax.scala.html#116089" title="(a: =&gt; scalaz.example.LaunchburyInterpreter.Expr)(implicit F: scalaz.Pointed[[x]scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,x]])scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">pure</a><a href="../../../core/scalaz/StateT.scala.html#130533" title="scalaz.MonadState[[s, a]scalaz.StateT[[+X]X,s,a],scalaz.example.LaunchburyInterpreter.ReduceState]" class="delimiter">(</a><a href="#617374" title="scalaz.example.LaunchburyInterpreter.Expr">e</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">Let</span><span class="delimiter">(</span><a title="Map[String,scalaz.example.LaunchburyInterpreter.Expr]" id="618073">bs</a>, <a title="scalaz.example.LaunchburyInterpreter.Expr" id="618074">e2</a><span class="delimiter">)</span>   =&gt; <span class="keyword">for</span> <span class="delimiter">{</span> <a title="List[String]" id="618857">fs</a> &lt;- <a href="../../../core/scalaz/syntax/MonadSyntax.scala.html#323769" title="(v: scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,String])scalaz.syntax.MonadOps[[x]scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,x],String]">getFreshVar</a>.<a href="../../../core/scalaz/syntax/MonadSyntax.scala.html#290642" title="(n: Int)scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,List[String]]">replicateM</a><a href="../../../core/scalaz/StateT.scala.html#86245" title="(f: List[String] =&gt; (List[String], Seq[((String, scalaz.example.LaunchburyInterpreter.Expr), String)], scalaz.example.LaunchburyInterpreter.Expr =&gt; scalaz.example.LaunchburyInterpreter.Expr, List[(String, scalaz.example.LaunchburyInterpreter.Expr)]))(implicit F: scalaz.Functor[[+X]X])scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,(List[String], Seq[((String, scalaz.example.LaunchburyInterpreter.Expr), String)], scalaz.example.LaunchburyInterpreter.Expr =&gt; scalaz.example.LaunchburyInterpreter.Expr, List[(String, scalaz.example.LaunchburyInterpreter.Expr)])]" class="delimiter">(</a><a href="#618073" title="Map[String,scalaz.example.LaunchburyInterpreter.Expr]">bs</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
                                  <span class="comment">// Seq[((originalVar, Expr), freshVar)]</span>
                                  <span class="keyword">val</span> <a title="Seq[((String, scalaz.example.LaunchburyInterpreter.Expr), String)]" id="618858">newBindings</a> = <a href="#618073" title="Map[String,scalaz.example.LaunchburyInterpreter.Expr]">bs</a>.<span title="=&gt; Seq[(String, scalaz.example.LaunchburyInterpreter.Expr)]">toSeq</span>.<span title="(that: scala.collection.GenIterable[String])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(String, scalaz.example.LaunchburyInterpreter.Expr)],((String, scalaz.example.LaunchburyInterpreter.Expr), String),Seq[((String, scalaz.example.LaunchburyInterpreter.Expr), String)]])Seq[((String, scalaz.example.LaunchburyInterpreter.Expr), String)]">zip</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,((String, scalaz.example.LaunchburyInterpreter.Expr), String),Seq[((String, scalaz.example.LaunchburyInterpreter.Expr), String)]]" class="delimiter">(</span><a href="#618857" title="List[String]">fs</a><span class="delimiter">)</span>
                                  <span class="comment">// sub(Map(originalVar -&gt; freshVar))</span>
                                  <span class="keyword">val</span> <a title="scalaz.example.LaunchburyInterpreter.Expr =&gt; scalaz.example.LaunchburyInterpreter.Expr" id="618859">subs</a> = <a href="#616481" title="(m: Map[String,String])(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Expr">sub</a><a href="#618692" title="scalaz.example.LaunchburyInterpreter.Expr" class="delimiter">(</a> <a href="#618858" title="Seq[((String, scalaz.example.LaunchburyInterpreter.Expr), String)]">newBindings</a>.<span title="(f: (((String, scalaz.example.LaunchburyInterpreter.Expr), String)) =&gt; (String, String))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[((String, scalaz.example.LaunchburyInterpreter.Expr), String)],(String, String),Seq[(String, String)]])Seq[(String, String)]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(String, String),Seq[(String, String)]]" class="delimiter">(</span><a title="((String, scalaz.example.LaunchburyInterpreter.Expr), String)" id="618328">tpl</a> =&gt; <a href="#618328" title="((String, scalaz.example.LaunchburyInterpreter.Expr), String)">tpl</a>.<span title="(_1: String, _2: String)(String, String)">copy</span><span class="delimiter">(</span>_1 = <a href="#618328" title="((String, scalaz.example.LaunchburyInterpreter.Expr), String)">tpl</a>.<span title="=&gt; (String, scalaz.example.LaunchburyInterpreter.Expr)">_1</span>.<span title="=&gt; String">_1</span><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="#618690" title="(implicit ev: &lt;:&lt;[(String, String),(String, String)])scala.collection.immutable.Map[String,String]">toMap</a> <span class="delimiter">)</span> _
                                  <span class="comment">// List[freshVar, Expr] - change to map when dolio's done</span>
                                  <span class="keyword">val</span> <a title="List[(String, scalaz.example.LaunchburyInterpreter.Expr)]" id="618860">bs2</a> = <a href="#618858" title="Seq[((String, scalaz.example.LaunchburyInterpreter.Expr), String)]">newBindings</a>.<span title="(f: (((String, scalaz.example.LaunchburyInterpreter.Expr), String)) =&gt; (String, scalaz.example.LaunchburyInterpreter.Expr))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[((String, scalaz.example.LaunchburyInterpreter.Expr), String)],(String, scalaz.example.LaunchburyInterpreter.Expr),Seq[(String, scalaz.example.LaunchburyInterpreter.Expr)]])Seq[(String, scalaz.example.LaunchburyInterpreter.Expr)]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(String, scalaz.example.LaunchburyInterpreter.Expr),Seq[(String, scalaz.example.LaunchburyInterpreter.Expr)]]" class="delimiter">(</span><a title="((String, scalaz.example.LaunchburyInterpreter.Expr), String)" id="618703">tpl</a> =&gt; <a href="#618703" title="((String, scalaz.example.LaunchburyInterpreter.Expr), String)">tpl</a>.<span title="(_1: String, _2: scalaz.example.LaunchburyInterpreter.Expr)(String, scalaz.example.LaunchburyInterpreter.Expr)">copy</span><span class="delimiter">(</span>_2 = <a href="#618703" title="((String, scalaz.example.LaunchburyInterpreter.Expr), String)">tpl</a>.<span title="=&gt; (String, scalaz.example.LaunchburyInterpreter.Expr)">_1</span>.<a title="scalaz.example.LaunchburyInterpreter.Expr" id="618710">_2</a>, _1 = <a href="#618703" title="((String, scalaz.example.LaunchburyInterpreter.Expr), String)">tpl</a>.<a title="String" id="618711">_2</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; List[(String, scalaz.example.LaunchburyInterpreter.Expr)]">toList</span>
                                  <a title="scalaz.example.LaunchburyInterpreter.Expr" id="618869">e3</a> &lt;- <a href="#616482" title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">freshen</a><a href="../../../core/scalaz/StateT.scala.html#86248" title="(f: scalaz.example.LaunchburyInterpreter.Expr =&gt; scalaz.StateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Let])(implicit F: scalaz.Bind[scalaz.Id.Id])scalaz.StateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Let]" class="delimiter">(</a> <a href="#618859" title="(v1: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Expr">subs</a><span class="delimiter">(</span><a href="#618074" title="scalaz.example.LaunchburyInterpreter.Expr">e2</a><span class="delimiter">)</span> <span class="delimiter">)</span>
                                  <a title="scala.collection.immutable.Map[String,scalaz.example.LaunchburyInterpreter.Expr]" id="619195">freshendBs</a> &lt;- <a href="../../../core/scalaz/syntax/TraverseSyntax.scala.html#53946" title="(v: List[(String, scalaz.example.LaunchburyInterpreter.Expr)])(implicit F0: scalaz.Traverse[List])java.lang.Object with scalaz.syntax.TraverseOps[List,(String, scalaz.example.LaunchburyInterpreter.Expr)]">bs2</a>.<a href="../../../core/scalaz/syntax/TraverseSyntax.scala.html#289930" title="(f: ((String, scalaz.example.LaunchburyInterpreter.Expr)) =&gt; scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,(String, scalaz.example.LaunchburyInterpreter.Expr)])scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,List[(String, scalaz.example.LaunchburyInterpreter.Expr)]]">traverseS</a><a href="#619035" title="scalaz.StateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,(String, scalaz.example.LaunchburyInterpreter.Expr)]" class="delimiter">{</a><span class="keyword">case</span> <span title="scalaz.StateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,(String, scalaz.example.LaunchburyInterpreter.Expr)]" class="delimiter">(</span><a title="String" id="619038">x</a>,<a title="scalaz.example.LaunchburyInterpreter.Expr" id="619039">e</a><span class="delimiter">)</span> =&gt; <a href="#616482" title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">freshen</a><span class="delimiter">(</span> <a href="#618859" title="(v1: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Expr">subs</a><span class="delimiter">(</span><a href="#619039" title="scalaz.example.LaunchburyInterpreter.Expr">e</a><span class="delimiter">)</span> <span class="delimiter">)</span>.<a href="../../../core/scalaz/StateT.scala.html#86245" title="(f: scalaz.example.LaunchburyInterpreter.Expr =&gt; (String, scalaz.example.LaunchburyInterpreter.Expr))(implicit F: scalaz.Functor[scalaz.Id.Id])scalaz.StateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,(String, scalaz.example.LaunchburyInterpreter.Expr)]">map</a><a href="../../../core/scalaz/package.scala.html#38787" title="=&gt; scalaz.Traverse[scalaz.Id.Id] with scalaz.Each[scalaz.Id.Id] with scalaz.Monad[scalaz.Id.Id] with scalaz.Comonad[scalaz.Id.Id] with scalaz.Cojoin[scalaz.Id.Id] with scalaz.Distributive[scalaz.Id.Id] with scalaz.Zip[scalaz.Id.Id] with scalaz.Unzip[scalaz.Id.Id] with scalaz.Cozip[scalaz.Id.Id]" class="delimiter">(</a><span title="(_1: String, _2: scalaz.example.LaunchburyInterpreter.Expr)(String, scalaz.example.LaunchburyInterpreter.Expr)" class="delimiter">(</span><a href="#619038" title="String">x</a>,<a href="#619045" title="scalaz.example.LaunchburyInterpreter.Expr">_</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">}</span>.<a href="../../../core/scalaz/StateT.scala.html#86245" title="(f: List[(String, scalaz.example.LaunchburyInterpreter.Expr)] =&gt; scala.collection.immutable.Map[String,scalaz.example.LaunchburyInterpreter.Expr])(implicit F: scalaz.Functor[scalaz.Id.Id])scalaz.StateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scala.collection.immutable.Map[String,scalaz.example.LaunchburyInterpreter.Expr]]">map</a><a href="../../../core/scalaz/StateT.scala.html#86245" title="(f: scala.collection.immutable.Map[String,scalaz.example.LaunchburyInterpreter.Expr] =&gt; scalaz.example.LaunchburyInterpreter.Let)(implicit F: scalaz.Functor[scalaz.Id.Id])scalaz.StateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Let]" class="delimiter">(</a><a href="#619107" title="List[(String, scalaz.example.LaunchburyInterpreter.Expr)]">_</a>.<span title="(implicit ev: &lt;:&lt;[(String, scalaz.example.LaunchburyInterpreter.Expr),(String, scalaz.example.LaunchburyInterpreter.Expr)])scala.collection.immutable.Map[String,scalaz.example.LaunchburyInterpreter.Expr]">toMap</span><span class="delimiter">)</span>
                                <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="#620464" title="(bindings: Map[String,scalaz.example.LaunchburyInterpreter.Expr], term: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Let">Let</a><span class="delimiter">(</span><a href="#619195" title="scala.collection.immutable.Map[String,scalaz.example.LaunchburyInterpreter.Expr]">freshendBs</a>, <a href="#618869" title="scalaz.example.LaunchburyInterpreter.Expr">e3</a><span class="delimiter">)</span>

    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/** performs &quot;big-step&quot; reduction: a single call maps a term to its final result
    * reduces lambda-terms to whnf or &quot;weak head normal form&quot;.  For our purposes,
    * whnf means a lambda term (generally, it also refers to primitives and constructors,
    * which we've ommitted).
    */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]" id="616483">reduce</a><span class="delimiter">(</span><a title="scalaz.example.LaunchburyInterpreter.Expr" id="619341">e</a>:<a href="#616459" title="scalaz.example.LaunchburyInterpreter.Expr">Expr</a><span class="delimiter">)</span>: <a href="../../../core/scalaz/StateT.scala.html#11747" title="scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">State</a><span class="delimiter">[</span>ReduceState, Expr<span class="delimiter">]</span> = <span class="delimiter">{</span>

    <a href="#619341" title="scalaz.example.LaunchburyInterpreter.Expr">e</a> <span title="scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">Lambda</span><span class="delimiter">(</span><a title="String" id="619343">x</a>, <a title="scalaz.example.LaunchburyInterpreter.Expr" id="619344">e2</a><span class="delimiter">)</span> =&gt; <a href="../../../core/scalaz/syntax/PointedSyntax.scala.html#116089" title="(a: =&gt; scalaz.example.LaunchburyInterpreter.Expr)(implicit F: scalaz.Pointed[[x]scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,x]])scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">pure</a><a href="../../../core/scalaz/StateT.scala.html#130533" title="scalaz.MonadState[[s, a]scalaz.StateT[[+X]X,s,a],scalaz.example.LaunchburyInterpreter.ReduceState]" class="delimiter">(</a><a href="#619341" title="scalaz.example.LaunchburyInterpreter.Expr">e</a><span class="delimiter">)</span> <span class="comment">// as defined above, a Lambda is already in whnf</span>
      <span class="keyword">case</span> <span title="scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">Apply</span><span class="delimiter">(</span><a title="scalaz.example.LaunchburyInterpreter.Expr" id="619423">e2</a>, <a title="String" id="619424">x</a><span class="delimiter">)</span>  =&gt; <a href="#616483" title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">reduce</a><a href="../../../core/scalaz/syntax/BindSyntax.scala.html#144808" title="(v: scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr])scalaz.syntax.BindOps[[x]scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,x],scalaz.example.LaunchburyInterpreter.Expr]" class="delimiter">(</a><a href="#619423" title="scalaz.example.LaunchburyInterpreter.Expr">e2</a><span class="delimiter">)</span> <a href="../../../core/scalaz/syntax/BindSyntax.scala.html#290712" title="(f: scalaz.example.LaunchburyInterpreter.Expr =&gt; scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr])scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">&gt;&gt;=</a> <a href="#619539" title="scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]" class="delimiter">{</a> <span class="keyword">case</span> <span title="scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">Lambda</span><span class="delimiter">(</span><a title="String" id="619540">y</a>, <a title="scalaz.example.LaunchburyInterpreter.Expr" id="619541">e3</a><span class="delimiter">)</span> =&gt; <a href="#616483" title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">reduce</a><span class="delimiter">(</span> <a href="#616481" title="(m: Map[String,String])(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Expr">sub</a><span class="delimiter">(</span><span title="(elems: (String, String)*)scala.collection.immutable.HashMap[String,String]">HashMap</span><span class="delimiter">(</span><a href="#619540" title="(x: String)ArrowAssoc[String]">y</a> <span title="(y: String)(String, String)">-&gt;</span> <a href="#619424" title="String">x</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#619541" title="scalaz.example.LaunchburyInterpreter.Expr">e3</a><span class="delimiter">)</span> <span class="delimiter">)</span>
                                             <span class="keyword">case</span> <span title="Nothing">_</span> =&gt; sys.<span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Ill-typed lambda term&quot;)" class="string">&quot;Ill-typed lambda term&quot;</span><span class="delimiter">)</span>
                                           <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="scalaz.StateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">Var</span><span class="delimiter">(</span><a title="String" id="619653">x</a><span class="delimiter">)</span>        =&gt; <span class="keyword">for</span> <span class="delimiter">{</span> <a title="scalaz.example.LaunchburyInterpreter.ReduceState" id="619744">state</a> &lt;- <a href="../../../core/scalaz/State.scala.html#53535" title="scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState]">init</a>:<a href="../../../core/scalaz/StateT.scala.html#11747" title="scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.ReduceState]">State</a><span class="delimiter">[</span>ReduceState, ReduceState<span class="delimiter">]</span>
                                  <span class="keyword">val</span> <a title="scalaz.example.LaunchburyInterpreter.Expr" id="619745">e2</a> = <a href="#619744" title="scalaz.example.LaunchburyInterpreter.ReduceState">state</a>.<a href="#616690" title="(key: String)scalaz.example.LaunchburyInterpreter.Expr">heap</a><span class="delimiter">(</span><a href="#619653" title="String">x</a><span class="delimiter">)</span>
                                  <a title="Unit" id="619764">_</a> &lt;- <a href="../../../core/scalaz/State.scala.html#53549" title="(f: scalaz.example.LaunchburyInterpreter.ReduceState =&gt; scalaz.example.LaunchburyInterpreter.ReduceState)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,Unit]">modify</a><a href="../../../core/scalaz/StateT.scala.html#86248" title="(f: Unit =&gt; scalaz.StateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr])(implicit F: scalaz.Bind[scalaz.Id.Id])scalaz.StateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]" class="delimiter">(</a><span class="delimiter">(</span>s:<a href="#620460" title="scalaz.example.LaunchburyInterpreter.ReduceState">ReduceState</a><span class="delimiter">)</span> =&gt; <a href="#619749" title="scalaz.example.LaunchburyInterpreter.ReduceState">s</a>.<a href="#620460" title="(heap: Map[String,scalaz.example.LaunchburyInterpreter.Expr], freshVars: Stream[String])scalaz.example.LaunchburyInterpreter.ReduceState">copy</a><span class="delimiter">(</span>heap = <a href="#619749" title="scalaz.example.LaunchburyInterpreter.ReduceState">s</a>.<a href="#616690" title="=&gt; Map[String,scalaz.example.LaunchburyInterpreter.Expr]">heap</a> <span title="(key: String)scala.collection.immutable.Map[String,scalaz.example.LaunchburyInterpreter.Expr]">-</span> <a href="#619653" title="String">x</a><span class="delimiter">)</span><span class="delimiter">)</span>
                                  <a title="scalaz.example.LaunchburyInterpreter.Expr" id="619770">e3</a> &lt;- <a href="#616483" title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">reduce</a><a href="../../../core/scalaz/StateT.scala.html#86248" title="(f: scalaz.example.LaunchburyInterpreter.Expr =&gt; scalaz.StateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr])(implicit F: scalaz.Bind[scalaz.Id.Id])scalaz.StateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]" class="delimiter">(</a><a href="#619745" title="scalaz.example.LaunchburyInterpreter.Expr">e2</a><span class="delimiter">)</span>
                                  <a title="Unit" id="619840">_</a> &lt;- <a href="../../../core/scalaz/State.scala.html#53549" title="(f: scalaz.example.LaunchburyInterpreter.ReduceState =&gt; scalaz.example.LaunchburyInterpreter.ReduceState)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,Unit]">modify</a><a href="../../../core/scalaz/StateT.scala.html#86248" title="(f: Unit =&gt; scalaz.StateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr])(implicit F: scalaz.Bind[scalaz.Id.Id])scalaz.StateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]" class="delimiter">(</a><span class="delimiter">(</span>s:<a href="#620460" title="scalaz.example.LaunchburyInterpreter.ReduceState">ReduceState</a><span class="delimiter">)</span> =&gt; <a href="#619774" title="scalaz.example.LaunchburyInterpreter.ReduceState">s</a>.<a href="#620460" title="(heap: Map[String,scalaz.example.LaunchburyInterpreter.Expr], freshVars: Stream[String])scalaz.example.LaunchburyInterpreter.ReduceState">copy</a><span class="delimiter">(</span>heap = <a href="#619774" title="scalaz.example.LaunchburyInterpreter.ReduceState">s</a>.<a href="#616690" title="=&gt; Map[String,scalaz.example.LaunchburyInterpreter.Expr]">heap</a> <span title="(kv: (String, scalaz.example.LaunchburyInterpreter.Expr))scala.collection.immutable.Map[String,scalaz.example.LaunchburyInterpreter.Expr]">+</span> <span class="delimiter">(</span><span title="(_1: String, _2: scalaz.example.LaunchburyInterpreter.Expr)(String, scalaz.example.LaunchburyInterpreter.Expr)" class="delimiter">(</span><a href="#619653" title="String">x</a>, <a href="#619770" title="scalaz.example.LaunchburyInterpreter.Expr">e3</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                                  <a title="scalaz.example.LaunchburyInterpreter.Expr" id="619846">freshendE</a> &lt;- <a href="#616482" title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">freshen</a><a href="../../../core/scalaz/StateT.scala.html#86245" title="(f: scalaz.example.LaunchburyInterpreter.Expr =&gt; scalaz.example.LaunchburyInterpreter.Expr)(implicit F: scalaz.Functor[scalaz.Id.Id])scalaz.StateT[scalaz.Id.Id,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]" class="delimiter">(</a><a href="#619770" title="scalaz.example.LaunchburyInterpreter.Expr">e3</a><span class="delimiter">)</span>
                                <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="#619846" title="scalaz.example.LaunchburyInterpreter.Expr">freshendE</a>
     <span class="keyword">case</span> <span title="scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">Let</span><span class="delimiter">(</span><a title="Map[String,scalaz.example.LaunchburyInterpreter.Expr]" id="620052">bs</a>, <a title="scalaz.example.LaunchburyInterpreter.Expr" id="620053">e2</a><span class="delimiter">)</span>   =&gt; <span class="delimiter">{</span> <span class="keyword">val</span> <a title="((String, scalaz.example.LaunchburyInterpreter.Expr)) =&gt; scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,Unit]" id="620054">heapAdd</a> = <span class="delimiter">(</span><span class="delimiter">(</span>binding:<span title="(String, scalaz.example.LaunchburyInterpreter.Expr)" class="delimiter">(</span>String, Expr<span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
                                              <a href="../../../core/scalaz/State.scala.html#53549" title="(f: scalaz.example.LaunchburyInterpreter.ReduceState =&gt; scalaz.example.LaunchburyInterpreter.ReduceState)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,Unit]">modify</a><span class="delimiter">(</span><span class="delimiter">(</span>s:<a href="#620460" title="scalaz.example.LaunchburyInterpreter.ReduceState">ReduceState</a><span class="delimiter">)</span> =&gt; <a href="#620060" title="scalaz.example.LaunchburyInterpreter.ReduceState">s</a>.<a href="#620460" title="(heap: Map[String,scalaz.example.LaunchburyInterpreter.Expr], freshVars: Stream[String])scalaz.example.LaunchburyInterpreter.ReduceState">copy</a><span class="delimiter">(</span>heap = <a href="#620060" title="scalaz.example.LaunchburyInterpreter.ReduceState">s</a>.<a href="#616690" title="=&gt; Map[String,scalaz.example.LaunchburyInterpreter.Expr]">heap</a> <span title="(kv: (String, scalaz.example.LaunchburyInterpreter.Expr))scala.collection.immutable.Map[String,scalaz.example.LaunchburyInterpreter.Expr]">+</span> <a href="#620056" title="(String, scalaz.example.LaunchburyInterpreter.Expr)">binding</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                             <a href="#620052" title="Map[String,scalaz.example.LaunchburyInterpreter.Expr]">bs</a>.<a href="../../../core/scalaz/syntax/TraverseSyntax.scala.html#53946" title="(v: List[(String, scalaz.example.LaunchburyInterpreter.Expr)])(implicit F0: scalaz.Traverse[List])java.lang.Object with scalaz.syntax.TraverseOps[List,(String, scalaz.example.LaunchburyInterpreter.Expr)]">toList</a>.<a href="../../../core/scalaz/syntax/TraverseSyntax.scala.html#289930" title="(f: ((String, scalaz.example.LaunchburyInterpreter.Expr)) =&gt; scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,Unit])scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,List[Unit]]">traverseS</a><a href="../../../core/scalaz/syntax/BindSyntax.scala.html#144808" title="(v: scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,List[Unit]])scalaz.syntax.BindOps[[x]scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,x],List[Unit]]" class="delimiter">(</a><a href="#620054" title="((String, scalaz.example.LaunchburyInterpreter.Expr)) =&gt; scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,Unit]">heapAdd</a><span class="delimiter">)</span> <a href="../../../core/scalaz/syntax/BindSyntax.scala.html#290724" title="(b: scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr])scalaz.StateT[[+X]X,scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">&gt;&gt;</a> <a href="#616483" title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">reduce</a><span class="delimiter">(</span><a href="#620053" title="scalaz.example.LaunchburyInterpreter.Expr">e2</a><span class="delimiter">)</span>
                           <span class="delimiter">}</span>
   <span class="delimiter">}</span>
 <span class="delimiter">}</span>

 <span class="keyword">def</span> <a title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Expr" id="616484">evaluate</a><span class="delimiter">(</span><a title="scalaz.example.LaunchburyInterpreter.Expr" id="620403">e</a>:<a href="#616459" title="scalaz.example.LaunchburyInterpreter.Expr">Expr</a><span class="delimiter">)</span>: <a href="#616459" title="scalaz.example.LaunchburyInterpreter.Expr">Expr</a> = <a href="#616483" title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.package.State[scalaz.example.LaunchburyInterpreter.ReduceState,scalaz.example.LaunchburyInterpreter.Expr]">reduce</a><span class="delimiter">(</span><a href="#620403" title="scalaz.example.LaunchburyInterpreter.Expr">e</a><span class="delimiter">)</span>.<a href="../../../core/scalaz/StateT.scala.html#86241" title="(initial: scalaz.example.LaunchburyInterpreter.ReduceState)(implicit F: scalaz.Functor[scalaz.Id.Id])scalaz.Id.Id[scalaz.example.LaunchburyInterpreter.Expr]">eval</a><a href="../../../core/scalaz/package.scala.html#38787" title="=&gt; scalaz.Traverse[scalaz.Id.Id] with scalaz.Each[scalaz.Id.Id] with scalaz.Monad[scalaz.Id.Id] with scalaz.Comonad[scalaz.Id.Id] with scalaz.Cojoin[scalaz.Id.Id] with scalaz.Distributive[scalaz.Id.Id] with scalaz.Zip[scalaz.Id.Id] with scalaz.Unzip[scalaz.Id.Id] with scalaz.Cozip[scalaz.Id.Id]" class="delimiter">(</a><a href="#616479" title="=&gt; scalaz.example.LaunchburyInterpreter.ReduceState">initialState</a><span class="delimiter">)</span>
 <span class="comment">// run an example through the magic of App</span>
 <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="#616484" title="(e: scalaz.example.LaunchburyInterpreter.Expr)scalaz.example.LaunchburyInterpreter.Expr">evaluate</a><span class="delimiter">(</span><a href="#616474" title="=&gt; scalaz.example.LaunchburyInterpreter.Let">example2</a><span class="delimiter">)</span><span class="delimiter">)</span>
<span class="delimiter">}</span>


        </pre>
    </body>
</html>
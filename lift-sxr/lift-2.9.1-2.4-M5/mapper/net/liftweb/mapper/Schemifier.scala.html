<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>mapper/net/liftweb/mapper/Schemifier.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright 2006-2011 WorldWide Conferencing, LLC
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

<span class="keyword">package</span> net.liftweb
<span class="keyword">package</span> mapper

<span class="keyword">import</span> java.sql.<span class="delimiter">{</span>Connection, ResultSet, DatabaseMetaData<span class="delimiter">}</span>

<span class="keyword">import</span> collection.mutable.<span class="delimiter">{</span>HashMap, ListBuffer<span class="delimiter">}</span>

<span class="keyword">import</span> common.<span class="delimiter">{</span>Full, Box, Loggable<span class="delimiter">}</span>
<span class="keyword">import</span> util.Helpers
<span class="keyword">import</span> <a href="../../../../util/net/liftweb/util/Helpers.scala.html#13346" title="object net.liftweb.util.Helpers">Helpers</a>._

<span class="comment">/**
 * Given a list of MetaMappers, make sure the database has the right schema
 * &lt;ul&gt;
 * &lt;li&gt;Make sure all the tables exists&lt;/li&gt;
 * &lt;li&gt;Make sure the columns in the tables are correct&lt;/li&gt;
 * &lt;li&gt;Create the indexes&lt;/li&gt;
 * &lt;li&gt;Create the foreign keys&lt;/li&gt;
 * &lt;/ul&gt;
 */</span>
<span class="keyword">object</span> <a title="object net.liftweb.mapper.Schemifier" id="11860">Schemifier</a> <span title="ScalaObject" class="keyword">extends</span> <a href="../../../../common/net/liftweb/common/Logging.scala.html#10717" title="net.liftweb.common.Loggable">Loggable</a> <span class="delimiter">{</span>
  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit net.liftweb.mapper.Schemifier.superToRegConnection : (sc: net.liftweb.mapper.package.SuperConnection)java.sql.Connection" id="190315">superToRegConnection</a><span class="delimiter">(</span><a title="net.liftweb.mapper.package.SuperConnection" id="190410">sc</a>: <a href="../../../../db/net/liftweb/db/DB.scala.html#10908" title="net.liftweb.mapper.package.SuperConnection">SuperConnection</a><span class="delimiter">)</span>: <span title="java.sql.Connection">Connection</span> = <a href="#190410" title="net.liftweb.mapper.package.SuperConnection">sc</a>.<a href="../../../../db/net/liftweb/db/DB.scala.html#60061" title="=&gt; java.sql.Connection">connection</a>

  <span class="comment">/**
   * Convenience function to be passed to schemify. Will log executed statements at the info level
   * using Schemifier's logger
   * 
   */</span>
  <span class="keyword">def</span> <a title="(msg: =&gt; AnyRef)Unit" id="190316">infoF</a><span class="delimiter">(</span><a title="=&gt; AnyRef" id="190412">msg</a>: =&gt; AnyRef<span class="delimiter">)</span> = <a href="../../../../common/net/liftweb/common/Logging.scala.html#19845" title="=&gt; net.liftweb.common.Logger">logger</a>.<a href="../../../../common/net/liftweb/common/Logging.scala.html#31948" title="(msg: =&gt; AnyRef)Unit">info</a><span class="delimiter">(</span><a href="#190412" title="=&gt; AnyRef">msg</a><span class="delimiter">)</span>
 
  <span class="comment">/**
   * Convenience function to be passed to schemify. Will not log any executed statements 
   */</span> 
  <span class="keyword">def</span> <a title="(msg: =&gt; AnyRef)Unit" id="190317">neverF</a><span class="delimiter">(</span><a title="=&gt; AnyRef" id="190417">msg</a>: =&gt; AnyRef<span class="delimiter">)</span> = <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>
  
 
  <span class="keyword">def</span> <a title="(performWrite: Boolean, logFunc: =&gt; AnyRef =&gt; Unit, stables: net.liftweb.mapper.BaseMetaMapper*)List[String]" id="190318">schemify</a><span class="delimiter">(</span><a title="Boolean" id="190420">performWrite</a>: <span title="Boolean">Boolean</span>, <a title="=&gt; AnyRef =&gt; Unit" id="190421">logFunc</a>: <span class="delimiter">(</span>=&gt; AnyRef<span class="delimiter">)</span> =&gt; Unit, <a title="net.liftweb.mapper.BaseMetaMapper*" id="190422">stables</a>: <span title="net.liftweb.mapper.BaseMetaMapper*">BaseMetaMapper</span>*<span class="delimiter">)</span>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = 
    <a href="#190319" title="(performWrite: Boolean, logFunc: =&gt; AnyRef =&gt; Unit, dbId: net.liftweb.mapper.package.ConnectionIdentifier, stables: net.liftweb.mapper.BaseMetaMapper*)List[String]">schemify</a><span class="delimiter">(</span><a href="#190420" title="Boolean">performWrite</a>,  <a href="#190421" title="=&gt; AnyRef =&gt; Unit">logFunc</a>, <a href="package.scala.html#15418" title="=&gt; net.liftweb.db.DefaultConnectionIdentifier.type">DefaultConnectionIdentifier</a>, <a href="#190422" title="net.liftweb.mapper.BaseMetaMapper*">stables</a> :_*<span class="delimiter">)</span>
  
  <span class="keyword">def</span> <a title="(performWrite: Boolean, logFunc: =&gt; AnyRef =&gt; Unit, dbId: net.liftweb.mapper.package.ConnectionIdentifier, stables: net.liftweb.mapper.BaseMetaMapper*)List[String]" id="190319">schemify</a><span class="delimiter">(</span><a title="Boolean" id="190439">performWrite</a>: <span title="Boolean">Boolean</span>, <a title="=&gt; AnyRef =&gt; Unit" id="190440">logFunc</a>: <span class="delimiter">(</span>=&gt; AnyRef<span class="delimiter">)</span> =&gt; Unit, <a title="net.liftweb.mapper.package.ConnectionIdentifier" id="190441">dbId</a>: <a href="../../../../db/net/liftweb/db/DB.scala.html#10911" title="net.liftweb.mapper.package.ConnectionIdentifier">ConnectionIdentifier</a>, <a title="net.liftweb.mapper.BaseMetaMapper*" id="190442">stables</a>: <span title="net.liftweb.mapper.BaseMetaMapper*">BaseMetaMapper</span>*<span class="delimiter">)</span>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = 
    <a href="#190331" title="(performWrite: Boolean, structureOnly: Boolean, logFunc: =&gt; AnyRef =&gt; Unit, dbId: net.liftweb.mapper.package.ConnectionIdentifier, stables: net.liftweb.mapper.BaseMetaMapper*)List[String]">schemify</a><span class="delimiter">(</span><a href="#190439" title="Boolean">performWrite</a>, <span title="Boolean(false)" class="keyword">false</span>, <a href="#190440" title="=&gt; AnyRef =&gt; Unit">logFunc</a>, <a href="#190441" title="net.liftweb.mapper.package.ConnectionIdentifier">dbId</a>, <a href="#190442" title="net.liftweb.mapper.BaseMetaMapper*">stables</a> :_*<span class="delimiter">)</span>
 
  <span class="keyword">def</span> <a title="(performWrite: Boolean, structureOnly: Boolean, logFunc: =&gt; AnyRef =&gt; Unit, stables: net.liftweb.mapper.BaseMetaMapper*)List[String]" id="190320">schemify</a><span class="delimiter">(</span><a title="Boolean" id="190434">performWrite</a>: <span title="Boolean">Boolean</span>, <a title="Boolean" id="190435">structureOnly</a>: <span title="Boolean">Boolean</span>, <a title="=&gt; AnyRef =&gt; Unit" id="190436">logFunc</a>: <span class="delimiter">(</span>=&gt; AnyRef<span class="delimiter">)</span> =&gt; Unit, <a title="net.liftweb.mapper.BaseMetaMapper*" id="190437">stables</a>: <span title="net.liftweb.mapper.BaseMetaMapper*">BaseMetaMapper</span>*<span class="delimiter">)</span>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = 
    <a href="#190331" title="(performWrite: Boolean, structureOnly: Boolean, logFunc: =&gt; AnyRef =&gt; Unit, dbId: net.liftweb.mapper.package.ConnectionIdentifier, stables: net.liftweb.mapper.BaseMetaMapper*)List[String]">schemify</a><span class="delimiter">(</span><a href="#190434" title="Boolean">performWrite</a>, <a href="#190435" title="Boolean">structureOnly</a>, <a href="#190436" title="=&gt; AnyRef =&gt; Unit">logFunc</a>, <a href="package.scala.html#15418" title="=&gt; net.liftweb.db.DefaultConnectionIdentifier.type">DefaultConnectionIdentifier</a>, <a href="#190437" title="net.liftweb.mapper.BaseMetaMapper*">stables</a> :_*<span class="delimiter">)</span>
    
  <span class="keyword">private</span> case <span class="keyword">class</span> <a title="class Collector extends java.lang.Object with ScalaObject with Product with Serializable" id="192832">Collector</a><a href="#192832" title="ScalaObject" class="delimiter">(</a><a title="List[() =&gt; Any]" id="190366">funcs</a>: <span title="List[() =&gt; Any]">List</span><span class="delimiter">[</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Any<span class="delimiter">]</span>, <a title="List[String]" id="190367">cmds</a>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(other: net.liftweb.mapper.Schemifier.Collector)net.liftweb.mapper.Schemifier.Collector" id="190351">+</a><span class="delimiter">(</span><a title="net.liftweb.mapper.Schemifier.Collector" id="190359">other</a>: <a href="#192832" title="net.liftweb.mapper.Schemifier.Collector">Collector</a><span class="delimiter">)</span> = <a href="#192832" title="(funcs: List[() =&gt; Any], cmds: List[String])net.liftweb.mapper.Schemifier.Collector">Collector</a><span class="delimiter">(</span><a href="#190366" title="=&gt; List[() =&gt; Any]">funcs</a> <a href="#190373" title="(prefix: List[() =&gt; Any])List[() =&gt; Any]">:::</a> <a href="#190359" title="net.liftweb.mapper.Schemifier.Collector">other</a>.<a href="#190366" title="=&gt; List[() =&gt; Any]">funcs</a>, <a href="#190367" title="=&gt; List[String]">cmds</a> <a href="#190392" title="(prefix: List[String])List[String]">:::</a> <a href="#190359" title="net.liftweb.mapper.Schemifier.Collector">other</a>.<a href="#190367" title="=&gt; List[String]">cmds</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="net.liftweb.mapper.Schemifier.Collector" id="190324">EmptyCollector</a> = <span title="net.liftweb.mapper.Schemifier.Collector" class="keyword">new</span> <a href="#192832" title="net.liftweb.mapper.Schemifier.Collector">Collector</a><span class="delimiter">(</span><span title="object Nil">Nil</span>, <span title="object Nil">Nil</span><span class="delimiter">)</span>
  
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="[RetType, VarType &lt;: java.sql.ResultSet](f: =&gt; VarType)(f2: VarType =&gt; RetType)RetType" id="190326">using</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="190329">RetType</a> &lt;: Any, <a title="&gt;: Nothing &lt;: java.sql.ResultSet" id="190330">VarType</a> &lt;: ResultSet<span class="delimiter">]</span><span class="delimiter">(</span><a title="=&gt; VarType" id="190556">f</a>: =&gt; VarType<span class="delimiter">)</span><span class="delimiter">(</span><a title="VarType =&gt; RetType" id="190557">f2</a>: VarType =&gt; RetType<span class="delimiter">)</span>: <a href="#190329" title="RetType">RetType</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="VarType" id="190561">theVar</a> = <a href="#190556" title="=&gt; VarType">f</a>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#190557" title="(v1: VarType)RetType">f2</a><span class="delimiter">(</span><a href="#190561" title="VarType">theVar</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#190561" title="VarType">theVar</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Modify database specified in dbId so it matches the structure specified in the MetaMappers
   * 
   * @param performWrite if false, will not write any changes to the database, only collect them
   * @param structureOnly if true, will only check tables and columns, not indexes and constraints. 
   *    Useful if schema is maintained outside Lift, but still needs structure to be in sync
   * @param logFunc A function that will be called for each statement being executed if performWrite == true
   * @param dbId The ConnectionIdentifier to be used
   * @param stables The MetaMapper instances to check
   * 
   * @return The list of statements needed to bring the database in a consistent state. This list is created even if performWrite=false  
   */</span>
  <span class="keyword">def</span> <a title="(performWrite: Boolean, structureOnly: Boolean, logFunc: =&gt; AnyRef =&gt; Unit, dbId: net.liftweb.mapper.package.ConnectionIdentifier, stables: net.liftweb.mapper.BaseMetaMapper*)List[String]" id="190331">schemify</a><span class="delimiter">(</span><a title="Boolean" id="190428">performWrite</a>: <span title="Boolean">Boolean</span>, <a title="Boolean" id="190429">structureOnly</a>: <span title="Boolean">Boolean</span>, <a title="=&gt; AnyRef =&gt; Unit" id="190430">logFunc</a>: <span class="delimiter">(</span>=&gt; AnyRef<span class="delimiter">)</span> =&gt; Unit, <a title="net.liftweb.mapper.package.ConnectionIdentifier" id="190431">dbId</a>: <a href="../../../../db/net/liftweb/db/DB.scala.html#10911" title="net.liftweb.mapper.package.ConnectionIdentifier">ConnectionIdentifier</a>, <a title="net.liftweb.mapper.BaseMetaMapper*" id="190432">stables</a>: <span title="net.liftweb.mapper.BaseMetaMapper*">BaseMetaMapper</span>*<span class="delimiter">)</span>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="List[net.liftweb.mapper.BaseMetaMapper]" id="190563">tables</a> = <a href="#190432" title="net.liftweb.mapper.BaseMetaMapper*">stables</a>.<span title="=&gt; List[net.liftweb.mapper.BaseMetaMapper]">toList</span>
    <a href="../../../../db/net/liftweb/db/DB.scala.html#60272" title="implicit net.liftweb.db.DB1.db1ToDb : (in: net.liftweb.db.DB1)net.liftweb.db.DB">DB</a>.<a href="../../../../db/net/liftweb/db/DB.scala.html#60371" title="(name: net.liftweb.db.ConnectionIdentifier)(f: net.liftweb.db.SuperConnection =&gt; List[String])List[String]">use</a><span class="delimiter">(</span><a href="#190431" title="net.liftweb.mapper.package.ConnectionIdentifier">dbId</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a title="net.liftweb.db.SuperConnection" id="190573">con</a> =&gt;
      <span class="comment">// Some databases (Sybase) don't like doing transactional DDL, so we disable transactions</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#190573" title="net.liftweb.db.SuperConnection">con</a>.<a href="../../../../db/net/liftweb/db/DB.scala.html#60073" title="=&gt; net.liftweb.db.DriverType">driverType</a>.<a href="../../../../db/net/liftweb/db/Driver.scala.html#66515" title="=&gt; Boolean">schemifierMustAutoCommit_?</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#190573" title="net.liftweb.db.SuperConnection">con</a>.<a href="../../../../db/net/liftweb/db/DB.scala.html#60061" title="=&gt; java.sql.Connection">connection</a>.<span title="()Boolean">getAutoCommit</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#190573" title="net.liftweb.db.SuperConnection">con</a>.<a href="../../../../db/net/liftweb/db/DB.scala.html#60061" title="=&gt; java.sql.Connection">connection</a>.<span title="()Unit">commit</span>
        <a href="#190573" title="net.liftweb.db.SuperConnection">con</a>.<a href="../../../../db/net/liftweb/db/DB.scala.html#60061" title="=&gt; java.sql.Connection">connection</a>.<span title="(x$1: Boolean)Unit">setAutoCommit</span><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="../../../../common/net/liftweb/common/Logging.scala.html#19845" title="=&gt; net.liftweb.common.Logger">logger</a>.<a href="../../../../common/net/liftweb/common/Logging.scala.html#31942" title="(msg: =&gt; AnyRef)Unit">debug</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Starting schemify. write=%s, structureOnly=%s, dbId=%s, schema=%s, tables=%s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#190428" title="Boolean">performWrite</a>, <a href="#190429" title="Boolean">structureOnly</a>, <a href="#190431" title="net.liftweb.mapper.package.ConnectionIdentifier">dbId</a>, <a href="#190335" title="(connection: net.liftweb.mapper.package.SuperConnection)String">getDefaultSchemaName</a><span class="delimiter">(</span><a href="#190573" title="net.liftweb.db.SuperConnection">con</a><span class="delimiter">)</span>, <a href="#190563" title="List[net.liftweb.mapper.BaseMetaMapper]">tables</a>.<span title="(f: net.liftweb.mapper.BaseMetaMapper =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[List[net.liftweb.mapper.BaseMetaMapper],String,Any])Any">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,String,List[String]]" class="delimiter">(</span><a href="#190602" title="net.liftweb.mapper.BaseMetaMapper">_</a>.<a href="MetaMapper.scala.html#146765" title="=&gt; String">dbTableName</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="net.liftweb.db.SuperConnection" id="190574">connection</a> = <a href="#190573" title="net.liftweb.db.SuperConnection">con</a> <span class="comment">// SuperConnection(con)</span>
      <span class="keyword">val</span> <a title="net.liftweb.db.DriverType" id="190575">driver</a> = <a href="package.scala.html#15419" title="=&gt; net.liftweb.db.DriverType.type">DriverType</a>.<a href="../../../../db/net/liftweb/db/Driver.scala.html#66875" title="(v1: java.sql.Connection)net.liftweb.db.DriverType">calcDriver</a><span class="delimiter">(</span><a href="#190315" title="implicit net.liftweb.mapper.Schemifier.superToRegConnection : (sc: net.liftweb.mapper.package.SuperConnection)java.sql.Connection">connection</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[String,String]" id="190576">actualTableNames</a> = <span title="()scala.collection.mutable.HashMap[String,String]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[String,String]">HashMap</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#190428" title="Boolean">performWrite</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#190563" title="List[net.liftweb.mapper.BaseMetaMapper]">tables</a>.<span title="(f: net.liftweb.mapper.BaseMetaMapper =&gt; Unit)Unit">foreach</span><span class="delimiter">{</span><a title="net.liftweb.mapper.BaseMetaMapper" id="190654">t</a> =&gt;
          <a href="../../../../common/net/liftweb/common/Logging.scala.html#19845" title="=&gt; net.liftweb.common.Logger">logger</a>.<a href="../../../../common/net/liftweb/common/Logging.scala.html#31942" title="(msg: =&gt; AnyRef)Unit">debug</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Running beforeSchemifier on table %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#190654" title="net.liftweb.mapper.BaseMetaMapper">t</a>.<a href="MetaMapper.scala.html#146765" title="=&gt; String">dbTableName</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#190654" title="net.liftweb.mapper.BaseMetaMapper">t</a>.<a href="MetaMapper.scala.html#146763" title="=&gt; Unit">beforeSchemifier</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      
      <span class="keyword">def</span> <a title="(t: net.liftweb.mapper.BaseMetaMapper, desc: String, f: =&gt; net.liftweb.mapper.Schemifier.Collector)net.liftweb.mapper.Schemifier.Collector" id="190577">tableCheck</a><span class="delimiter">(</span><a title="net.liftweb.mapper.BaseMetaMapper" id="190661">t</a>: <a href="MetaMapper.scala.html#11665" title="net.liftweb.mapper.BaseMetaMapper">BaseMetaMapper</a>, <a title="String" id="190662">desc</a>: <span title="String">String</span>, <a title="=&gt; net.liftweb.mapper.Schemifier.Collector" id="190663">f</a>: =&gt; Collector<span class="delimiter">)</span>: <a href="#192832" title="net.liftweb.mapper.Schemifier.Collector">Collector</a> = <span class="delimiter">{</span>
        <a href="#190576" title="scala.collection.mutable.HashMap[String,String]">actualTableNames</a>.<span title="(key: String)Option[String]">get</span><span class="delimiter">(</span><a href="#190661" title="net.liftweb.mapper.BaseMetaMapper">t</a>.<a href="MetaMapper.scala.html#146766" title="=&gt; String">_dbTableNameLC</a><span class="delimiter">)</span>.<span title="(f: String =&gt; net.liftweb.mapper.Schemifier.Collector)Option[net.liftweb.mapper.Schemifier.Collector]">map</span><span class="delimiter">(</span><a title="String" id="190713">x</a> =&gt; <a href="#190663" title="=&gt; net.liftweb.mapper.Schemifier.Collector">f</a><span class="delimiter">)</span>.<span title="(default: =&gt; net.liftweb.mapper.Schemifier.Collector)net.liftweb.mapper.Schemifier.Collector">getOrElse</span><span class="delimiter">{</span>
          <a href="../../../../common/net/liftweb/common/Logging.scala.html#19845" title="=&gt; net.liftweb.common.Logger">logger</a>.<a href="../../../../common/net/liftweb/common/Logging.scala.html#31954" title="(msg: =&gt; AnyRef)Unit">warn</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Skipping %s on table '%s' since it doesn't exist&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#190662" title="String">desc</a>, <a href="#190661" title="net.liftweb.mapper.BaseMetaMapper">t</a>.<a href="MetaMapper.scala.html#146765" title="=&gt; String">dbTableName</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#190324" title="=&gt; net.liftweb.mapper.Schemifier.Collector">EmptyCollector</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      
      <span class="keyword">val</span> <a title="net.liftweb.mapper.Schemifier.Collector" id="190578">toRun</a> =
        <a href="#190563" title="List[net.liftweb.mapper.BaseMetaMapper]">tables</a>.<span title="(z: net.liftweb.mapper.Schemifier.Collector)(f: (net.liftweb.mapper.Schemifier.Collector, net.liftweb.mapper.BaseMetaMapper) =&gt; net.liftweb.mapper.Schemifier.Collector)net.liftweb.mapper.Schemifier.Collector">foldLeft</span><span class="delimiter">(</span><a href="#190324" title="=&gt; net.liftweb.mapper.Schemifier.Collector">EmptyCollector</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="net.liftweb.mapper.Schemifier.Collector" id="190742">b</a>, <a title="net.liftweb.mapper.BaseMetaMapper" id="190743">t</a><span class="delimiter">)</span> =&gt; <a href="#190742" title="net.liftweb.mapper.Schemifier.Collector">b</a> <a href="#190351" title="(other: net.liftweb.mapper.Schemifier.Collector)net.liftweb.mapper.Schemifier.Collector">+</a> <a href="#190338" title="(performWrite: Boolean, logFunc: =&gt; AnyRef =&gt; Unit, table: net.liftweb.mapper.BaseMetaMapper, connection: net.liftweb.mapper.package.SuperConnection, actualTableNames: scala.collection.mutable.HashMap[String,String])net.liftweb.mapper.Schemifier.Collector">ensureTable</a><span class="delimiter">(</span><a href="#190428" title="Boolean">performWrite</a>, <a href="#190430" title="=&gt; AnyRef =&gt; Unit">logFunc</a>, <a href="#190743" title="net.liftweb.mapper.BaseMetaMapper">t</a>, <a href="#190574" title="net.liftweb.db.SuperConnection">connection</a>, <a href="#190576" title="scala.collection.mutable.HashMap[String,String]">actualTableNames</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#190351" title="(other: net.liftweb.mapper.Schemifier.Collector)net.liftweb.mapper.Schemifier.Collector">+</a>
        <a href="#190563" title="List[net.liftweb.mapper.BaseMetaMapper]">tables</a>.<span title="(z: net.liftweb.mapper.Schemifier.Collector)(f: (net.liftweb.mapper.Schemifier.Collector, net.liftweb.mapper.BaseMetaMapper) =&gt; net.liftweb.mapper.Schemifier.Collector)net.liftweb.mapper.Schemifier.Collector">foldLeft</span><span class="delimiter">(</span><a href="#190324" title="=&gt; net.liftweb.mapper.Schemifier.Collector">EmptyCollector</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="net.liftweb.mapper.Schemifier.Collector" id="190764">b</a>, <a title="net.liftweb.mapper.BaseMetaMapper" id="190765">t</a><span class="delimiter">)</span> =&gt; <a href="#190764" title="net.liftweb.mapper.Schemifier.Collector">b</a> <a href="#190351" title="(other: net.liftweb.mapper.Schemifier.Collector)net.liftweb.mapper.Schemifier.Collector">+</a> <a href="#190577" title="(t: net.liftweb.mapper.BaseMetaMapper, desc: String, f: =&gt; net.liftweb.mapper.Schemifier.Collector)net.liftweb.mapper.Schemifier.Collector">tableCheck</a><span class="delimiter">(</span><a href="#190765" title="net.liftweb.mapper.BaseMetaMapper">t</a>, <span title="java.lang.String(&quot;ensureColumns&quot;)" class="string">&quot;ensureColumns&quot;</span>, <a href="#190340" title="(performWrite: Boolean, logFunc: =&gt; AnyRef =&gt; Unit, table: net.liftweb.mapper.BaseMetaMapper, connection: net.liftweb.mapper.package.SuperConnection, actualTableNames: scala.collection.mutable.HashMap[String,String])net.liftweb.mapper.Schemifier.Collector">ensureColumns</a><span class="delimiter">(</span><a href="#190428" title="Boolean">performWrite</a>, <a href="#190430" title="=&gt; AnyRef =&gt; Unit">logFunc</a>, <a href="#190765" title="net.liftweb.mapper.BaseMetaMapper">t</a>, <a href="#190574" title="net.liftweb.db.SuperConnection">connection</a>, <a href="#190576" title="scala.collection.mutable.HashMap[String,String]">actualTableNames</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#190351" title="(other: net.liftweb.mapper.Schemifier.Collector)net.liftweb.mapper.Schemifier.Collector">+</a>
        <span class="delimiter">(</span><span title="net.liftweb.mapper.Schemifier.Collector" class="keyword">if</span> <span class="delimiter">(</span><a href="#190429" title="Boolean">structureOnly</a><span class="delimiter">)</span> 
          <a href="#190324" title="=&gt; net.liftweb.mapper.Schemifier.Collector">EmptyCollector</a> 
        <span class="keyword">else</span>
          <span class="delimiter">(</span><a href="#190563" title="List[net.liftweb.mapper.BaseMetaMapper]">tables</a>.<span title="(z: net.liftweb.mapper.Schemifier.Collector)(f: (net.liftweb.mapper.Schemifier.Collector, net.liftweb.mapper.BaseMetaMapper) =&gt; net.liftweb.mapper.Schemifier.Collector)net.liftweb.mapper.Schemifier.Collector">foldLeft</span><span class="delimiter">(</span><a href="#190324" title="=&gt; net.liftweb.mapper.Schemifier.Collector">EmptyCollector</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="net.liftweb.mapper.Schemifier.Collector" id="190786">b</a>, <a title="net.liftweb.mapper.BaseMetaMapper" id="190787">t</a><span class="delimiter">)</span> =&gt; <a href="#190786" title="net.liftweb.mapper.Schemifier.Collector">b</a> <a href="#190351" title="(other: net.liftweb.mapper.Schemifier.Collector)net.liftweb.mapper.Schemifier.Collector">+</a> <a href="#190577" title="(t: net.liftweb.mapper.BaseMetaMapper, desc: String, f: =&gt; net.liftweb.mapper.Schemifier.Collector)net.liftweb.mapper.Schemifier.Collector">tableCheck</a><span class="delimiter">(</span><a href="#190787" title="net.liftweb.mapper.BaseMetaMapper">t</a>, <span title="java.lang.String(&quot;ensureIndexes&quot;)" class="string">&quot;ensureIndexes&quot;</span>, <a href="#190341" title="(performWrite: Boolean, logFunc: =&gt; AnyRef =&gt; Unit, table: net.liftweb.mapper.BaseMetaMapper, connection: net.liftweb.mapper.package.SuperConnection, actualTableNames: scala.collection.mutable.HashMap[String,String])net.liftweb.mapper.Schemifier.Collector">ensureIndexes</a><span class="delimiter">(</span><a href="#190428" title="Boolean">performWrite</a>, <a href="#190430" title="=&gt; AnyRef =&gt; Unit">logFunc</a>, <a href="#190787" title="net.liftweb.mapper.BaseMetaMapper">t</a>, <a href="#190574" title="net.liftweb.db.SuperConnection">connection</a>, <a href="#190576" title="scala.collection.mutable.HashMap[String,String]">actualTableNames</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#190351" title="(other: net.liftweb.mapper.Schemifier.Collector)net.liftweb.mapper.Schemifier.Collector">+</a>
           <a href="#190563" title="List[net.liftweb.mapper.BaseMetaMapper]">tables</a>.<span title="(z: net.liftweb.mapper.Schemifier.Collector)(f: (net.liftweb.mapper.Schemifier.Collector, net.liftweb.mapper.BaseMetaMapper) =&gt; net.liftweb.mapper.Schemifier.Collector)net.liftweb.mapper.Schemifier.Collector">foldLeft</span><span class="delimiter">(</span><a href="#190324" title="=&gt; net.liftweb.mapper.Schemifier.Collector">EmptyCollector</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="net.liftweb.mapper.Schemifier.Collector" id="190808">b</a>, <a title="net.liftweb.mapper.BaseMetaMapper" id="190809">t</a><span class="delimiter">)</span> =&gt; <a href="#190808" title="net.liftweb.mapper.Schemifier.Collector">b</a> <a href="#190351" title="(other: net.liftweb.mapper.Schemifier.Collector)net.liftweb.mapper.Schemifier.Collector">+</a> <a href="#190577" title="(t: net.liftweb.mapper.BaseMetaMapper, desc: String, f: =&gt; net.liftweb.mapper.Schemifier.Collector)net.liftweb.mapper.Schemifier.Collector">tableCheck</a><span class="delimiter">(</span><a href="#190809" title="net.liftweb.mapper.BaseMetaMapper">t</a>, <span title="java.lang.String(&quot;ensureConstraints&quot;)" class="string">&quot;ensureConstraints&quot;</span>, <a href="#190342" title="(performWrite: Boolean, logFunc: =&gt; AnyRef =&gt; Unit, table: net.liftweb.mapper.BaseMetaMapper, dbId: net.liftweb.mapper.package.ConnectionIdentifier, connection: net.liftweb.mapper.package.SuperConnection, actualTableNames: scala.collection.mutable.HashMap[String,String])net.liftweb.mapper.Schemifier.Collector">ensureConstraints</a><span class="delimiter">(</span><a href="#190428" title="Boolean">performWrite</a>, <a href="#190430" title="=&gt; AnyRef =&gt; Unit">logFunc</a>, <a href="#190809" title="net.liftweb.mapper.BaseMetaMapper">t</a>, <a href="#190431" title="net.liftweb.mapper.package.ConnectionIdentifier">dbId</a>, <a href="#190574" title="net.liftweb.db.SuperConnection">connection</a>, <a href="#190576" title="scala.collection.mutable.HashMap[String,String]">actualTableNames</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#190428" title="Boolean">performWrite</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="../../../../common/net/liftweb/common/Logging.scala.html#19845" title="=&gt; net.liftweb.common.Logger">logger</a>.<a href="../../../../common/net/liftweb/common/Logging.scala.html#31942" title="(msg: =&gt; AnyRef)Unit">debug</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Executing DDL statements&quot;)" class="string">&quot;Executing DDL statements&quot;</span><span class="delimiter">)</span>
    	<a href="#190578" title="net.liftweb.mapper.Schemifier.Collector">toRun</a>.<a href="#190366" title="=&gt; List[() =&gt; Any]">funcs</a>.<span title="(f: () =&gt; Any =&gt; Any)Unit">foreach</span><span class="delimiter">(</span><a title="() =&gt; Any" id="190838">f</a> =&gt; <a href="#190838" title="()Any">f</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#190563" title="List[net.liftweb.mapper.BaseMetaMapper]">tables</a>.<span title="(f: net.liftweb.mapper.BaseMetaMapper =&gt; Unit)Unit">foreach</span><span class="delimiter">{</span><a title="net.liftweb.mapper.BaseMetaMapper" id="190859">t</a> =&gt;
          <a href="../../../../common/net/liftweb/common/Logging.scala.html#19845" title="=&gt; net.liftweb.common.Logger">logger</a>.<a href="../../../../common/net/liftweb/common/Logging.scala.html#31942" title="(msg: =&gt; AnyRef)Unit">debug</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Running afterSchemifier on table %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#190859" title="net.liftweb.mapper.BaseMetaMapper">t</a>.<a href="MetaMapper.scala.html#146765" title="=&gt; String">dbTableName</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#190859" title="net.liftweb.mapper.BaseMetaMapper">t</a>.<a href="MetaMapper.scala.html#146764" title="=&gt; Unit">afterSchemifier</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <a href="#190578" title="net.liftweb.mapper.Schemifier.Collector">toRun</a>.<a href="#190367" title="=&gt; List[String]">cmds</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(logFunc: =&gt; AnyRef =&gt; Unit, stables: net.liftweb.mapper.BaseMetaMapper*)Unit" id="190332">destroyTables_!!</a><span class="delimiter">(</span><a title="=&gt; AnyRef =&gt; Unit" id="190868">logFunc</a>: <span class="delimiter">(</span>=&gt; AnyRef<span class="delimiter">)</span> =&gt; Unit, <a title="net.liftweb.mapper.BaseMetaMapper*" id="190869">stables</a>: <span title="net.liftweb.mapper.BaseMetaMapper*">BaseMetaMapper</span>*<span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#190333" title="(dbId: net.liftweb.mapper.package.ConnectionIdentifier, logFunc: =&gt; AnyRef =&gt; Unit, stables: net.liftweb.mapper.BaseMetaMapper*)Unit">destroyTables_!!</a><span class="delimiter">(</span><a href="package.scala.html#15418" title="=&gt; net.liftweb.db.DefaultConnectionIdentifier.type">DefaultConnectionIdentifier</a>, <a href="#190868" title="=&gt; AnyRef =&gt; Unit">logFunc</a>, <a href="#190869" title="net.liftweb.mapper.BaseMetaMapper*">stables</a> :_*<span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(dbId: net.liftweb.mapper.package.ConnectionIdentifier, logFunc: =&gt; AnyRef =&gt; Unit, stables: net.liftweb.mapper.BaseMetaMapper*)Unit" id="190333">destroyTables_!!</a><span class="delimiter">(</span><a title="net.liftweb.mapper.package.ConnectionIdentifier" id="190880">dbId</a>: <a href="../../../../db/net/liftweb/db/DB.scala.html#10911" title="net.liftweb.mapper.package.ConnectionIdentifier">ConnectionIdentifier</a>, <a title="=&gt; AnyRef =&gt; Unit" id="190881">logFunc</a>: <span class="delimiter">(</span>=&gt; AnyRef<span class="delimiter">)</span> =&gt; Unit, <a title="net.liftweb.mapper.BaseMetaMapper*" id="190882">stables</a>: <span title="net.liftweb.mapper.BaseMetaMapper*">BaseMetaMapper</span>*<span class="delimiter">)</span>: <span title="Unit">Unit</span> =
  <a href="#190334" title="(dbId: net.liftweb.mapper.package.ConnectionIdentifier, cnt: Int, logFunc: =&gt; AnyRef =&gt; Unit, stables: List[net.liftweb.mapper.BaseMetaMapper])Unit">destroyTables_!!</a><span class="delimiter">(</span><a href="#190880" title="net.liftweb.mapper.package.ConnectionIdentifier">dbId</a>, <span title="Int(0)" class="int">0</span>, <a href="#190881" title="=&gt; AnyRef =&gt; Unit">logFunc</a>,  <a href="#190882" title="net.liftweb.mapper.BaseMetaMapper*">stables</a>.<span title="=&gt; List[net.liftweb.mapper.BaseMetaMapper]">toList</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(dbId: net.liftweb.mapper.package.ConnectionIdentifier, cnt: Int, logFunc: =&gt; AnyRef =&gt; Unit, stables: List[net.liftweb.mapper.BaseMetaMapper])Unit" id="190334">destroyTables_!!</a><span class="delimiter">(</span><a title="net.liftweb.mapper.package.ConnectionIdentifier" id="190875">dbId</a>: <a href="../../../../db/net/liftweb/db/DB.scala.html#10911" title="net.liftweb.mapper.package.ConnectionIdentifier">ConnectionIdentifier</a>,<a title="Int" id="190876">cnt</a>: <span title="Int">Int</span>, <a title="=&gt; AnyRef =&gt; Unit" id="190877">logFunc</a>: <span class="delimiter">(</span>=&gt; AnyRef<span class="delimiter">)</span> =&gt; Unit, <a title="List[net.liftweb.mapper.BaseMetaMapper]" id="190878">stables</a>: <span title="List[net.liftweb.mapper.BaseMetaMapper]">List</span><span class="delimiter">[</span>BaseMetaMapper<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[String,String]" id="190892">th</a> = <span title="()scala.collection.mutable.HashMap[String,String]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[String,String]">HashMap</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">(</span><a href="../../../../db/net/liftweb/db/DB.scala.html#60272" title="implicit net.liftweb.db.DB1.db1ToDb : (in: net.liftweb.db.DB1)net.liftweb.db.DB">DB</a>.<a href="../../../../db/net/liftweb/db/DB.scala.html#60371" title="(name: net.liftweb.db.ConnectionIdentifier)(f: net.liftweb.db.SuperConnection =&gt; List[net.liftweb.mapper.BaseMetaMapper])List[net.liftweb.mapper.BaseMetaMapper]">use</a><span class="delimiter">(</span><a href="#190875" title="net.liftweb.mapper.package.ConnectionIdentifier">dbId</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a title="net.liftweb.db.SuperConnection" id="190901">conn</a> =&gt;
        <span class="keyword">val</span> <a title="net.liftweb.db.SuperConnection" id="190902">sConn</a> = <a href="#190901" title="net.liftweb.db.SuperConnection">conn</a> <span class="comment">// SuperConnection(conn)</span>
        <span class="keyword">val</span> <a title="List[net.liftweb.mapper.BaseMetaMapper]" id="190903">tables</a> = <a href="#190878" title="List[net.liftweb.mapper.BaseMetaMapper]">stables</a>.<span title="=&gt; List[net.liftweb.mapper.BaseMetaMapper]">toList</span>.<span title="(p: net.liftweb.mapper.BaseMetaMapper =&gt; Boolean)List[net.liftweb.mapper.BaseMetaMapper]">filter</span><span class="delimiter">(</span><a title="net.liftweb.mapper.BaseMetaMapper" id="190913">t</a> =&gt; <a href="#190336" title="(table: net.liftweb.mapper.BaseMetaMapper, connection: net.liftweb.mapper.package.SuperConnection, actualTableNames: scala.collection.mutable.HashMap[String,String])Boolean">hasTable_?</a><span class="delimiter">(</span><a href="#190913" title="net.liftweb.mapper.BaseMetaMapper">t</a>, <a href="#190902" title="net.liftweb.db.SuperConnection">sConn</a>, <a href="#190892" title="scala.collection.mutable.HashMap[String,String]">th</a><span class="delimiter">)</span><span class="delimiter">)</span>

        <a href="#190903" title="List[net.liftweb.mapper.BaseMetaMapper]">tables</a>.<span title="(f: net.liftweb.mapper.BaseMetaMapper =&gt; Unit)Unit">foreach</span><span class="delimiter">{</span>
          <a title="net.liftweb.mapper.BaseMetaMapper" id="190937">table</a> =&gt;
          <span class="keyword">try</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="java.lang.String" id="190938">ct</a> = <span title="java.lang.String(&quot;DROP TABLE &quot;)" class="string">&quot;DROP TABLE &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#190937" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146766" title="=&gt; String">_dbTableNameLC</a>
            <span class="keyword">val</span> <a title="java.sql.Statement" id="190939">st</a> = <a href="#190315" title="implicit net.liftweb.mapper.Schemifier.superToRegConnection : (sc: net.liftweb.mapper.package.SuperConnection)java.sql.Connection">conn</a>.<span title="()java.sql.Statement">createStatement</span>
            <a href="#190939" title="java.sql.Statement">st</a>.<span title="(x$1: java.lang.String)Boolean">execute</span><span class="delimiter">(</span><a href="#190938" title="java.lang.String">ct</a><span class="delimiter">)</span>
            <a href="#190877" title="(v1: =&gt; AnyRef)Unit">logFunc</a><span class="delimiter">(</span><a href="#190938" title="java.lang.String">ct</a><span class="delimiter">)</span>
            <a href="#190939" title="java.sql.Statement">st</a>.<span title="()Unit">close</span>
          <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a title="Unit" id="190950">e</a>: <span title="Exception">Exception</span> =&gt; <span class="comment">// dispose... probably just an SQL Exception</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>

        <a href="#190903" title="List[net.liftweb.mapper.BaseMetaMapper]">tables</a>
      <span class="delimiter">}</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Unit" id="190954">t</a> <span class="keyword">if</span> <a href="#190954" title="List[net.liftweb.mapper.BaseMetaMapper]">t</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#190876" title="Int">cnt</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(1000)" class="int">1000</span> =&gt; <a href="#190334" title="(dbId: net.liftweb.mapper.package.ConnectionIdentifier, cnt: Int, logFunc: =&gt; AnyRef =&gt; Unit, stables: List[net.liftweb.mapper.BaseMetaMapper])Unit">destroyTables_!!</a><span class="delimiter">(</span><a href="#190875" title="net.liftweb.mapper.package.ConnectionIdentifier">dbId</a>, <a href="#190876" title="Int">cnt</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>, <a href="#190877" title="=&gt; AnyRef =&gt; Unit">logFunc</a>, <a href="#190954" title="List[net.liftweb.mapper.BaseMetaMapper]">t</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Retrieves schema name where the unqualified db objects are searched.
   */</span>
  <span class="keyword">def</span> <a title="(connection: net.liftweb.mapper.package.SuperConnection)String" id="190335">getDefaultSchemaName</a><span class="delimiter">(</span><a title="net.liftweb.mapper.package.SuperConnection" id="190584">connection</a>: <a href="../../../../db/net/liftweb/db/DB.scala.html#10908" title="net.liftweb.mapper.package.SuperConnection">SuperConnection</a><span class="delimiter">)</span>: <span title="String">String</span> =
  <span class="delimiter">(</span><a href="#190584" title="net.liftweb.mapper.package.SuperConnection">connection</a>.<a href="../../../../db/net/liftweb/db/DB.scala.html#60065" title="=&gt; net.liftweb.common.Box[String]">schemaName</a> <a href="../../../../common/net/liftweb/common/Box.scala.html#27043" title="(alternative: =&gt; net.liftweb.common.Box[String])net.liftweb.common.Box[String]">or</a> <a href="#190584" title="net.liftweb.mapper.package.SuperConnection">connection</a>.<a href="../../../../db/net/liftweb/db/DB.scala.html#60073" title="=&gt; net.liftweb.db.DriverType">driverType</a>.<a href="../../../../db/net/liftweb/db/Driver.scala.html#66526" title="=&gt; net.liftweb.common.Box[String]">defaultSchemaName</a> <a href="../../../../common/net/liftweb/common/Box.scala.html#27043" title="(alternative: =&gt; net.liftweb.common.Box[String])net.liftweb.common.Box[String]">or</a> <a href="../../../../db/net/liftweb/db/DB.scala.html#60272" title="implicit net.liftweb.db.DB1.db1ToDb : (in: net.liftweb.db.DB1)net.liftweb.db.DB">DB</a>.<a href="../../../../db/net/liftweb/db/DB.scala.html#60281" title="=&gt; net.liftweb.common.Box[String]">globalDefaultSchemaName</a><span class="delimiter">)</span>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; String)String">openOr</a><span class="delimiter">(</span><a href="#190315" title="implicit net.liftweb.mapper.Schemifier.superToRegConnection : (sc: net.liftweb.mapper.package.SuperConnection)java.sql.Connection">connection</a>.<span title="()java.sql.DatabaseMetaData">getMetaData</span>.<span title="()java.lang.String">getUserName</span><span class="delimiter">)</span>


  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(table: net.liftweb.mapper.BaseMetaMapper, connection: net.liftweb.mapper.package.SuperConnection, actualTableNames: scala.collection.mutable.HashMap[String,String])Boolean" id="190336">hasTable_?</a> <span class="delimiter">(</span><a title="net.liftweb.mapper.BaseMetaMapper" id="190914">table</a>: <a href="MetaMapper.scala.html#11665" title="net.liftweb.mapper.BaseMetaMapper">BaseMetaMapper</a>, <a title="net.liftweb.mapper.package.SuperConnection" id="190915">connection</a>: <a href="../../../../db/net/liftweb/db/DB.scala.html#10908" title="net.liftweb.mapper.package.SuperConnection">SuperConnection</a>, <a title="scala.collection.mutable.HashMap[String,String]" id="190916">actualTableNames</a>: <span title="scala.collection.mutable.HashMap[String,String]">HashMap</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.sql.DatabaseMetaData" id="190996">md</a> = <a href="#190315" title="implicit net.liftweb.mapper.Schemifier.superToRegConnection : (sc: net.liftweb.mapper.package.SuperConnection)java.sql.Connection">connection</a>.<span title="()java.sql.DatabaseMetaData">getMetaData</span>
    <a href="#190326" title="(f: =&gt; java.sql.ResultSet)(f2: java.sql.ResultSet =&gt; Boolean)Boolean">using</a><span class="delimiter">(</span><a href="#190996" title="java.sql.DatabaseMetaData">md</a>.<span title="(x$1: java.lang.String, x$2: java.lang.String, x$3: java.lang.String, x$4: Array[java.lang.String])java.sql.ResultSet">getTables</span><span class="delimiter">(</span><span title="Null(null)" class="keyword">null</span>, <a href="#190335" title="(connection: net.liftweb.mapper.package.SuperConnection)String">getDefaultSchemaName</a><span class="delimiter">(</span><a href="#190915" title="net.liftweb.mapper.package.SuperConnection">connection</a><span class="delimiter">)</span>, <span title="Null(null)" class="keyword">null</span>, <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">{</span> <a title="java.sql.ResultSet" id="191008">rs</a> =&gt;
      <span class="keyword">def</span> <a title="(rs: java.sql.ResultSet)Boolean" id="191009">hasTable</a><span class="delimiter">(</span><a title="java.sql.ResultSet" id="191010">rs</a>: <span title="java.sql.ResultSet">ResultSet</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> =
      <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#191010" title="java.sql.ResultSet">rs</a>.<span title="()Boolean">next</span><span class="delimiter">)</span> <span title="Boolean(false)" class="keyword">false</span>
      <span class="keyword">else</span> <a href="#191010" title="java.sql.ResultSet">rs</a>.<span title="(x$1: Int)java.lang.String">getString</span><span class="delimiter">(</span><span title="Int(3)" class="int">3</span><span class="delimiter">)</span> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Boolean" id="191015">s</a> <span class="keyword">if</span> <a href="#191015" title="java.lang.String">s</a>.<span title="()java.lang.String">toLowerCase</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#190914" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146766" title="=&gt; String">_dbTableNameLC</a>.<span title="()java.lang.String">toLowerCase</span> =&gt; <a href="#190916" title="(key: String, value: String)Unit">actualTableNames</a><span class="delimiter">(</span><a href="#190914" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146766" title="=&gt; String">_dbTableNameLC</a><span class="delimiter">)</span> = <a href="#191015" title="java.lang.String">s</a>; <span title="Boolean(true)" class="keyword">true</span>
        <span class="keyword">case</span> <span title="Boolean">_</span> =&gt; <a href="#191009" title="(rs: java.sql.ResultSet)Boolean">hasTable</a><span class="delimiter">(</span><a href="#191010" title="java.sql.ResultSet">rs</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="#191009" title="(rs: java.sql.ResultSet)Boolean">hasTable</a><span class="delimiter">(</span><a href="#191008" title="java.sql.ResultSet">rs</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>


  <span class="comment">/**
   * Creates an SQL command and optionally executes it.
   *
   * @param performWrite Whether the SQL command should be executed.
   * @param logFunc Logger.
   * @param connection Database connection.
   * @param makeSql Factory for SQL command.
   *
   * @returns SQL command.
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(performWrite: Boolean, logFunc: =&gt; AnyRef =&gt; Unit, connection: net.liftweb.mapper.package.SuperConnection)(makeSql: () =&gt; String)String" id="190337">maybeWrite</a><span class="delimiter">(</span><a title="Boolean" id="191031">performWrite</a>: <span title="Boolean">Boolean</span>, <a title="=&gt; AnyRef =&gt; Unit" id="191032">logFunc</a>: <span class="delimiter">(</span>=&gt; AnyRef<span class="delimiter">)</span> =&gt; Unit, <a title="net.liftweb.mapper.package.SuperConnection" id="191033">connection</a>: <a href="../../../../db/net/liftweb/db/DB.scala.html#10908" title="net.liftweb.mapper.package.SuperConnection">SuperConnection</a><span class="delimiter">)</span> <span class="delimiter">(</span><a title="() =&gt; String" id="191034">makeSql</a>: <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; String<span class="delimiter">)</span> : <span title="String">String</span> =<span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="String" id="191036">ct</a> = <a href="#191034" title="()String">makeSql</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="../../../../common/net/liftweb/common/Logging.scala.html#19845" title="=&gt; net.liftweb.common.Logger">logger</a>.<a href="../../../../common/net/liftweb/common/Logging.scala.html#31936" title="(msg: =&gt; AnyRef)Unit">trace</a><span class="delimiter">(</span><span title="java.lang.String(&quot;maybeWrite DDL: &quot;)" class="string">&quot;maybeWrite DDL: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#191036" title="String">ct</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#191031" title="Boolean">performWrite</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#191032" title="(v1: =&gt; AnyRef)Unit">logFunc</a><span class="delimiter">(</span><a href="#191036" title="String">ct</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.sql.Statement" id="191042">st</a> = <a href="#190315" title="implicit net.liftweb.mapper.Schemifier.superToRegConnection : (sc: net.liftweb.mapper.package.SuperConnection)java.sql.Connection">connection</a>.<span title="()java.sql.Statement">createStatement</span>
      <a href="#191042" title="java.sql.Statement">st</a>.<span title="(x$1: java.lang.String)Boolean">execute</span><span class="delimiter">(</span><a href="#191036" title="String">ct</a><span class="delimiter">)</span>
      <a href="#191042" title="java.sql.Statement">st</a>.<span title="()Unit">close</span>
    <span class="delimiter">}</span>
    <a href="#191036" title="String">ct</a>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(performWrite: Boolean, logFunc: =&gt; AnyRef =&gt; Unit, table: net.liftweb.mapper.BaseMetaMapper, connection: net.liftweb.mapper.package.SuperConnection, actualTableNames: scala.collection.mutable.HashMap[String,String])net.liftweb.mapper.Schemifier.Collector" id="190338">ensureTable</a><span class="delimiter">(</span><a title="Boolean" id="190744">performWrite</a>: <span title="Boolean">Boolean</span>, <a title="=&gt; AnyRef =&gt; Unit" id="190745">logFunc</a>: <span class="delimiter">(</span>=&gt; AnyRef<span class="delimiter">)</span> =&gt; Unit, <a title="net.liftweb.mapper.BaseMetaMapper" id="190746">table</a>: <a href="MetaMapper.scala.html#11665" title="net.liftweb.mapper.BaseMetaMapper">BaseMetaMapper</a>, <a title="net.liftweb.mapper.package.SuperConnection" id="190747">connection</a>: <a href="../../../../db/net/liftweb/db/DB.scala.html#10908" title="net.liftweb.mapper.package.SuperConnection">SuperConnection</a>, <a title="scala.collection.mutable.HashMap[String,String]" id="190748">actualTableNames</a>: <span title="scala.collection.mutable.HashMap[String,String]">HashMap</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#192832" title="net.liftweb.mapper.Schemifier.Collector">Collector</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Boolean" id="191074">hasTable</a> = <a href="../../../../common/net/liftweb/common/Logging.scala.html#19845" title="=&gt; net.liftweb.common.Logger">logger</a>.<a href="../../../../common/net/liftweb/common/Logging.scala.html#31932" title="(msg: String, v: Boolean)Boolean">trace</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Does table exist?: &quot;)" class="string">&quot;Does table exist?: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#190746" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146765" title="=&gt; String">dbTableName</a>, <a href="#190336" title="(table: net.liftweb.mapper.BaseMetaMapper, connection: net.liftweb.mapper.package.SuperConnection, actualTableNames: scala.collection.mutable.HashMap[String,String])Boolean">hasTable_?</a><span class="delimiter">(</span><a href="#190746" title="net.liftweb.mapper.BaseMetaMapper">table</a>, <a href="#190747" title="net.liftweb.mapper.package.SuperConnection">connection</a>, <a href="#190748" title="scala.collection.mutable.HashMap[String,String]">actualTableNames</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ListBuffer[String]" id="191075">cmds</a> = <span title="scala.collection.mutable.ListBuffer[String]" class="keyword">new</span> <span title="scala.collection.mutable.ListBuffer[String]">ListBuffer</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    
    <span title="net.liftweb.mapper.Schemifier.Collector" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#191074" title="Boolean">hasTable</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#191075" title="scala.collection.mutable.ListBuffer[String]">cmds</a> <span title="(x: String)cmds.type">+=</span> <a href="#190337" title="(performWrite: Boolean, logFunc: =&gt; AnyRef =&gt; Unit, connection: net.liftweb.mapper.package.SuperConnection)(makeSql: () =&gt; String)String">maybeWrite</a><span class="delimiter">(</span><a href="#190744" title="Boolean">performWrite</a>, <a href="#190745" title="=&gt; AnyRef =&gt; Unit">logFunc</a>, <a href="#190747" title="net.liftweb.mapper.package.SuperConnection">connection</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span title="java.lang.String(&quot;CREATE TABLE &quot;)" class="string">&quot;CREATE TABLE &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#190746" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146766" title="=&gt; String">_dbTableNameLC</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; (&quot;)" class="string">&quot; (&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#190339" title="(table: net.liftweb.mapper.BaseMetaMapper, connection: net.liftweb.mapper.package.SuperConnection)Seq[String]">createColumns</a><span class="delimiter">(</span><a href="#190746" title="net.liftweb.mapper.BaseMetaMapper">table</a>, <a href="#190747" title="net.liftweb.mapper.package.SuperConnection">connection</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot; , &quot;)" class="string">&quot; , &quot;</span><span class="delimiter">)</span><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;) &quot;)" class="string">&quot;) &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#190747" title="net.liftweb.mapper.package.SuperConnection">connection</a>.<a href="../../../../db/net/liftweb/db/DB.scala.html#60071" title="=&gt; String">createTablePostpend</a>
      <span class="delimiter">}</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#190747" title="net.liftweb.mapper.package.SuperConnection">connection</a>.<a href="../../../../db/net/liftweb/db/DB.scala.html#60073" title="=&gt; net.liftweb.db.DriverType">driverType</a>.<a href="../../../../db/net/liftweb/db/Driver.scala.html#66518" title="=&gt; Boolean">pkDefinedByIndexColumn_?</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="comment">// Add primary key only when it has not been created by the index field itself.</span>
        <a href="#190746" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146767" title="=&gt; Seq[net.liftweb.mapper.BaseMappedField]">mappedFields</a>.<span title="(p: net.liftweb.mapper.BaseMappedField =&gt; Boolean)Seq[net.liftweb.mapper.BaseMappedField]">filter</span><span class="delimiter">{</span><a title="net.liftweb.mapper.BaseMappedField" id="191118">f</a> =&gt; <a href="#191118" title="net.liftweb.mapper.BaseMappedField">f</a>.<a href="MappedField.scala.html#147538" title="=&gt; Boolean">dbPrimaryKey_?</a><span class="delimiter">}</span>.<span title="(f: net.liftweb.mapper.BaseMappedField =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span>
          <a title="net.liftweb.mapper.BaseMappedField" id="191137">pkField</a> =&gt;
            <a href="#190747" title="net.liftweb.mapper.package.SuperConnection">connection</a>.<a href="../../../../db/net/liftweb/db/DB.scala.html#60073" title="=&gt; net.liftweb.db.DriverType">driverType</a>.<a href="../../../../db/net/liftweb/db/Driver.scala.html#66530" title="(tableName: String, columnName: String)List[String]">primaryKeySetup</a><span class="delimiter">(</span><a href="#190746" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146766" title="=&gt; String">_dbTableNameLC</a>, <a href="#191137" title="net.liftweb.mapper.BaseMappedField">pkField</a>.<a href="MappedField.scala.html#147535" title="=&gt; String">_dbColumnNameLC</a><span class="delimiter">)</span> <span title="(f: String =&gt; scala.collection.mutable.ListBuffer[String])Unit">foreach</span> <span class="delimiter">{</span> <a title="String" id="191159">command</a> =&gt;
              <a href="#191075" title="scala.collection.mutable.ListBuffer[String]">cmds</a> <span title="(x: String)cmds.type">+=</span> <a href="#190337" title="(performWrite: Boolean, logFunc: =&gt; AnyRef =&gt; Unit, connection: net.liftweb.mapper.package.SuperConnection)(makeSql: () =&gt; String)String">maybeWrite</a><span class="delimiter">(</span><a href="#190744" title="Boolean">performWrite</a>, <a href="#190745" title="=&gt; AnyRef =&gt; Unit">logFunc</a>, <a href="#190747" title="net.liftweb.mapper.package.SuperConnection">connection</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#191159" title="String">command</a>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <a href="#190336" title="(table: net.liftweb.mapper.BaseMetaMapper, connection: net.liftweb.mapper.package.SuperConnection, actualTableNames: scala.collection.mutable.HashMap[String,String])Boolean">hasTable_?</a><span class="delimiter">(</span><a href="#190746" title="net.liftweb.mapper.BaseMetaMapper">table</a>, <a href="#190747" title="net.liftweb.mapper.package.SuperConnection">connection</a>, <a href="#190748" title="scala.collection.mutable.HashMap[String,String]">actualTableNames</a><span class="delimiter">)</span>
      <a href="#192832" title="(funcs: List[() =&gt; Any], cmds: List[String])net.liftweb.mapper.Schemifier.Collector">Collector</a><span class="delimiter">(</span><a href="#190746" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146768" title="=&gt; net.liftweb.common.Box[() =&gt; Unit]">dbAddTable</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27051" title="=&gt; List[() =&gt; Unit]">toList</a>, <a href="#191075" title="scala.collection.mutable.ListBuffer[String]">cmds</a>.<span title="=&gt; List[String]">toList</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#192832" title="(funcs: List[() =&gt; Any], cmds: List[String])net.liftweb.mapper.Schemifier.Collector">Collector</a><span class="delimiter">(</span><span title="object Nil">Nil</span>, <a href="#191075" title="scala.collection.mutable.ListBuffer[String]">cmds</a>.<span title="=&gt; List[String]">toList</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(table: net.liftweb.mapper.BaseMetaMapper, connection: net.liftweb.mapper.package.SuperConnection)Seq[String]" id="190339">createColumns</a><span class="delimiter">(</span><a title="net.liftweb.mapper.BaseMetaMapper" id="191103">table</a>: <a href="MetaMapper.scala.html#11665" title="net.liftweb.mapper.BaseMetaMapper">BaseMetaMapper</a>, <a title="net.liftweb.mapper.package.SuperConnection" id="191104">connection</a>: <a href="../../../../db/net/liftweb/db/DB.scala.html#10908" title="net.liftweb.mapper.package.SuperConnection">SuperConnection</a><span class="delimiter">)</span>: <span title="Seq[String]">Seq</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#191103" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146767" title="=&gt; Seq[net.liftweb.mapper.BaseMappedField]">mappedFields</a>.<span title="(f: net.liftweb.mapper.BaseMappedField =&gt; scala.collection.GenTraversableOnce[String])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[net.liftweb.mapper.BaseMappedField],String,Seq[String]])Seq[String]">flatMap</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#191193" title="net.liftweb.mapper.BaseMappedField">_</a>.<a href="MappedField.scala.html#147530" title="(dbType: net.liftweb.mapper.package.DriverType)List[String]">fieldCreatorString</a><span class="delimiter">(</span><a href="#191104" title="net.liftweb.mapper.package.SuperConnection">connection</a>.<a href="../../../../db/net/liftweb/db/DB.scala.html#60073" title="=&gt; net.liftweb.db.DriverType">driverType</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(performWrite: Boolean, logFunc: =&gt; AnyRef =&gt; Unit, table: net.liftweb.mapper.BaseMetaMapper, connection: net.liftweb.mapper.package.SuperConnection, actualTableNames: scala.collection.mutable.HashMap[String,String])net.liftweb.mapper.Schemifier.Collector" id="190340">ensureColumns</a><span class="delimiter">(</span><a title="Boolean" id="190766">performWrite</a>: <span title="Boolean">Boolean</span>, <a title="=&gt; AnyRef =&gt; Unit" id="190767">logFunc</a>: <span class="delimiter">(</span>=&gt; AnyRef<span class="delimiter">)</span> =&gt; Unit, <a title="net.liftweb.mapper.BaseMetaMapper" id="190768">table</a>: <a href="MetaMapper.scala.html#11665" title="net.liftweb.mapper.BaseMetaMapper">BaseMetaMapper</a>, <a title="net.liftweb.mapper.package.SuperConnection" id="190769">connection</a>: <a href="../../../../db/net/liftweb/db/DB.scala.html#10908" title="net.liftweb.mapper.package.SuperConnection">SuperConnection</a>, <a title="scala.collection.mutable.HashMap[String,String]" id="190770">actualTableNames</a>: <span title="scala.collection.mutable.HashMap[String,String]">HashMap</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#192832" title="net.liftweb.mapper.Schemifier.Collector">Collector</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ListBuffer[String]" id="191236">cmds</a> = <span title="scala.collection.mutable.ListBuffer[String]" class="keyword">new</span> <span title="scala.collection.mutable.ListBuffer[String]">ListBuffer</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="List[() =&gt; Unit]" id="191237">rc</a> = <a href="#190768" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146767" title="=&gt; Seq[net.liftweb.mapper.BaseMappedField]">mappedFields</a>.<span title="=&gt; List[net.liftweb.mapper.BaseMappedField]">toList</span>.<span title="(f: net.liftweb.mapper.BaseMappedField =&gt; scala.collection.GenTraversableOnce[() =&gt; Unit])(implicit bf: scala.collection.generic.CanBuildFrom[List[net.liftweb.mapper.BaseMappedField],() =&gt; Unit,List[() =&gt; Unit]])List[() =&gt; Unit]">flatMap</span> <span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,() =&gt; Unit,List[() =&gt; Unit]]" class="delimiter">{</span>
      <a title="net.liftweb.mapper.BaseMappedField" id="191262">field</a> =&gt;
      <span class="keyword">var</span> <a title="Int" id="191263">hasColumn</a> = <span title="Int(0)" class="int">0</span>
      <span class="keyword">var</span> <a title="List[String]" id="191264">cols</a>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span title="object Nil">Nil</span>
      <span class="keyword">val</span> <a title="Int" id="191265">totalColCnt</a> = <a href="#191262" title="net.liftweb.mapper.BaseMappedField">field</a>.<a href="MappedField.scala.html#147532" title="=&gt; Int">dbColumnCount</a>
      <span class="keyword">val</span> <a title="java.sql.DatabaseMetaData" id="191266">md</a> = <a href="#190315" title="implicit net.liftweb.mapper.Schemifier.superToRegConnection : (sc: net.liftweb.mapper.package.SuperConnection)java.sql.Connection">connection</a>.<span title="()java.sql.DatabaseMetaData">getMetaData</span>

      <a href="#190326" title="(f: =&gt; java.sql.ResultSet)(f2: java.sql.ResultSet =&gt; Unit)Unit">using</a><span class="delimiter">(</span><a href="#191266" title="java.sql.DatabaseMetaData">md</a>.<span title="(x$1: java.lang.String, x$2: java.lang.String, x$3: java.lang.String, x$4: java.lang.String)java.sql.ResultSet">getColumns</span><span class="delimiter">(</span><span title="Null(null)" class="keyword">null</span>, <a href="#190335" title="(connection: net.liftweb.mapper.package.SuperConnection)String">getDefaultSchemaName</a><span class="delimiter">(</span><a href="#190769" title="net.liftweb.mapper.package.SuperConnection">connection</a><span class="delimiter">)</span>, <a href="#190770" title="(key: String)String">actualTableNames</a><span class="delimiter">(</span><a href="#190768" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146766" title="=&gt; String">_dbTableNameLC</a><span class="delimiter">)</span>, <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="java.sql.ResultSet" id="191315">rs</a> =&gt;
        <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#191263" title="Int">hasColumn</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#191265" title="Int">totalColCnt</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#191315" title="java.sql.ResultSet">rs</a>.<span title="()Boolean">next</span><span class="delimiter">)</span> <a href="#191316" title="()Unit" class="delimiter">{</a>
          <span class="keyword">val</span> <a title="java.lang.String" id="191321">tableName</a> = <a href="#191315" title="java.sql.ResultSet">rs</a>.<span title="(x$1: Int)java.lang.String">getString</span><span class="delimiter">(</span><span title="Int(3)" class="int">3</span><span class="delimiter">)</span>.<span title="()java.lang.String">toLowerCase</span>
          <span class="keyword">val</span> <a title="java.lang.String" id="191322">columnName</a> = <a href="#191315" title="java.sql.ResultSet">rs</a>.<span title="(x$1: Int)java.lang.String">getString</span><span class="delimiter">(</span><span title="Int(4)" class="int">4</span><span class="delimiter">)</span>.<span title="()java.lang.String">toLowerCase</span>

          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#191321" title="java.lang.String">tableName</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#190768" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146766" title="=&gt; String">_dbTableNameLC</a>.<span title="()java.lang.String">toLowerCase</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#191262" title="net.liftweb.mapper.BaseMappedField">field</a>.<a href="MappedField.scala.html#147533" title="(in: String)List[String]">dbColumnNames</a><span class="delimiter">(</span><a href="#191262" title="net.liftweb.mapper.BaseMappedField">field</a>.<a href="../../../../util/net/liftweb/util/BaseField.scala.html#49767" title="=&gt; String">name</a><span class="delimiter">)</span>.<span title="(f: String =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[List[String],java.lang.String,List[java.lang.String]])List[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,java.lang.String,List[java.lang.String]]" class="delimiter">(</span><a href="#191360" title="String">_</a>.<span title="()java.lang.String">toLowerCase</span><span class="delimiter">)</span>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#191322" title="java.lang.String">columnName</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#191264" title="List[String]">cols</a> = <a href="#191322" title="java.lang.String">columnName</a> <a href="#191390" title="(x: String)List[String]">::</a> <a href="#191264" title="List[String]">cols</a>
            <a href="#191263" title="Int">hasColumn</a> = <a href="#191263" title="Int">hasColumn</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>
            <a href="../../../../common/net/liftweb/common/Logging.scala.html#19845" title="=&gt; net.liftweb.common.Logger">logger</a>.<a href="../../../../common/net/liftweb/common/Logging.scala.html#31936" title="(msg: =&gt; AnyRef)Unit">trace</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Column exists: %s.%s &quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#190768" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146765" title="=&gt; String">dbTableName</a>, <a href="#191322" title="java.lang.String">columnName</a><span class="delimiter">)</span><span class="delimiter">)</span>
      
          <span class="delimiter">}</span>
        <span class="delimiter">}</span><span class="delimiter">)</span>
      <span class="comment">// FIXME deal with column types</span>
      <span class="delimiter">(</span><a href="#191262" title="net.liftweb.mapper.BaseMappedField">field</a>.<a href="MappedField.scala.html#147533" title="(in: String)List[String]">dbColumnNames</a><span class="delimiter">(</span><a href="#191262" title="net.liftweb.mapper.BaseMappedField">field</a>.<a href="../../../../util/net/liftweb/util/BaseField.scala.html#49767" title="=&gt; String">name</a><span class="delimiter">)</span>.<span title="(p: String =&gt; Boolean)List[String]">filter</span><span class="delimiter">(</span><a title="String" id="191415">f</a> =&gt; <span title="=&gt; Boolean">!</span><a href="#191264" title="List[String]">cols</a>.<span title="(f: String =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[List[String],java.lang.String,List[java.lang.String]])List[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,java.lang.String,List[java.lang.String]]" class="delimiter">(</span><a href="#191435" title="String">_</a>.<span title="()java.lang.String">toLowerCase</span><span class="delimiter">)</span>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#191415" title="String">f</a>.<span title="()java.lang.String">toLowerCase</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: String =&gt; Any)Unit">foreach</span> <span class="delimiter">{</span><a title="String" id="191488">colName</a> =&gt;
        <a href="../../../../common/net/liftweb/common/Logging.scala.html#19845" title="=&gt; net.liftweb.common.Logger">logger</a>.<a href="../../../../common/net/liftweb/common/Logging.scala.html#31936" title="(msg: =&gt; AnyRef)Unit">trace</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Column does not exist: %s.%s &quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#190768" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146765" title="=&gt; String">dbTableName</a>, <a href="#191488" title="String">colName</a><span class="delimiter">)</span><span class="delimiter">)</span>
          
        <a href="#191236" title="scala.collection.mutable.ListBuffer[String]">cmds</a> <span title="(x: String)cmds.type">+=</span> <a href="#190337" title="(performWrite: Boolean, logFunc: =&gt; AnyRef =&gt; Unit, connection: net.liftweb.mapper.package.SuperConnection)(makeSql: () =&gt; String)String">maybeWrite</a><span class="delimiter">(</span><a href="#190766" title="Boolean">performWrite</a>, <a href="#190767" title="=&gt; AnyRef =&gt; Unit">logFunc</a>, <a href="#190769" title="net.liftweb.mapper.package.SuperConnection">connection</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span title="java.lang.String(&quot;ALTER TABLE &quot;)" class="string">&quot;ALTER TABLE &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#190768" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146766" title="=&gt; String">_dbTableNameLC</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#190769" title="net.liftweb.mapper.package.SuperConnection">connection</a>.<a href="../../../../db/net/liftweb/db/DB.scala.html#60073" title="=&gt; net.liftweb.db.DriverType">driverType</a>.<a href="../../../../db/net/liftweb/db/Driver.scala.html#66531" title="=&gt; java.lang.String">alterAddColumn</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#191262" title="net.liftweb.mapper.BaseMappedField">field</a>.<a href="MappedField.scala.html#147529" title="(dbType: net.liftweb.mapper.package.DriverType, colName: String)String">fieldCreatorString</a><span class="delimiter">(</span><a href="#190769" title="net.liftweb.mapper.package.SuperConnection">connection</a>.<a href="../../../../db/net/liftweb/db/DB.scala.html#60073" title="=&gt; net.liftweb.db.DriverType">driverType</a>, <a href="#191488" title="String">colName</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#190769" title="net.liftweb.mapper.package.SuperConnection">connection</a>.<a href="../../../../db/net/liftweb/db/DB.scala.html#60073" title="=&gt; net.liftweb.db.DriverType">driverType</a>.<a href="../../../../db/net/liftweb/db/Driver.scala.html#66518" title="=&gt; Boolean">pkDefinedByIndexColumn_?</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#191262" title="net.liftweb.mapper.BaseMappedField">field</a>.<a href="MappedField.scala.html#147538" title="=&gt; Boolean">dbPrimaryKey_?</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="comment">// Add primary key only when it has not been created by the index field itself.</span>
          <a href="#191236" title="scala.collection.mutable.ListBuffer[String]">cmds</a> <span title="(x: String)cmds.type">+=</span> <a href="#190337" title="(performWrite: Boolean, logFunc: =&gt; AnyRef =&gt; Unit, connection: net.liftweb.mapper.package.SuperConnection)(makeSql: () =&gt; String)String">maybeWrite</a><span class="delimiter">(</span><a href="#190766" title="Boolean">performWrite</a>, <a href="#190767" title="=&gt; AnyRef =&gt; Unit">logFunc</a>, <a href="#190769" title="net.liftweb.mapper.package.SuperConnection">connection</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span title="java.lang.String(&quot;ALTER TABLE &quot;)" class="string">&quot;ALTER TABLE &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#190768" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146766" title="=&gt; String">_dbTableNameLC</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; ADD CONSTRAINT &quot;)" class="string">&quot; ADD CONSTRAINT &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#190768" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146766" title="=&gt; String">_dbTableNameLC</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;_PK PRIMARY KEY(&quot;)" class="string">&quot;_PK PRIMARY KEY(&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#191262" title="net.liftweb.mapper.BaseMappedField">field</a>.<a href="MappedField.scala.html#147535" title="=&gt; String">_dbColumnNameLC</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;)&quot;)" class="string">&quot;)&quot;</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <a href="#191262" title="net.liftweb.mapper.BaseMappedField">field</a>.<a href="MappedField.scala.html#147541" title="=&gt; net.liftweb.common.Box[() =&gt; Unit]">dbAddedColumn</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27051" title="=&gt; List[() =&gt; Unit]">toList</a>

    <span class="delimiter">}</span>

    <a href="#192832" title="(funcs: List[() =&gt; Any], cmds: List[String])net.liftweb.mapper.Schemifier.Collector">Collector</a><span class="delimiter">(</span><a href="#191237" title="List[() =&gt; Unit]">rc</a>, <a href="#191236" title="scala.collection.mutable.ListBuffer[String]">cmds</a>.<span title="=&gt; List[String]">toList</span><span class="delimiter">)</span>

  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(performWrite: Boolean, logFunc: =&gt; AnyRef =&gt; Unit, table: net.liftweb.mapper.BaseMetaMapper, connection: net.liftweb.mapper.package.SuperConnection, actualTableNames: scala.collection.mutable.HashMap[String,String])net.liftweb.mapper.Schemifier.Collector" id="190341">ensureIndexes</a><span class="delimiter">(</span><a title="Boolean" id="190788">performWrite</a>: <span title="Boolean">Boolean</span>, <a title="=&gt; AnyRef =&gt; Unit" id="190789">logFunc</a>: <span class="delimiter">(</span>=&gt; AnyRef<span class="delimiter">)</span> =&gt; Unit, <a title="net.liftweb.mapper.BaseMetaMapper" id="190790">table</a>: <a href="MetaMapper.scala.html#11665" title="net.liftweb.mapper.BaseMetaMapper">BaseMetaMapper</a>, <a title="net.liftweb.mapper.package.SuperConnection" id="190791">connection</a>: <a href="../../../../db/net/liftweb/db/DB.scala.html#10908" title="net.liftweb.mapper.package.SuperConnection">SuperConnection</a>, <a title="scala.collection.mutable.HashMap[String,String]" id="190792">actualTableNames</a>: <span title="scala.collection.mutable.HashMap[String,String]">HashMap</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#192832" title="net.liftweb.mapper.Schemifier.Collector">Collector</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ListBuffer[String]" id="191603">cmds</a> = <span title="scala.collection.mutable.ListBuffer[String]" class="keyword">new</span> <span title="scala.collection.mutable.ListBuffer[String]">ListBuffer</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="comment">// val byColumn = new HashMap[String, List[(String, String, Int)]]()</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[String,List[String]]" id="191604">byName</a> = <span title="()scala.collection.mutable.HashMap[String,List[String]]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[String,List[String]]">HashMap</span><span class="delimiter">[</span>String, List<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="java.sql.DatabaseMetaData" id="191605">md</a> = <a href="#190315" title="implicit net.liftweb.mapper.Schemifier.superToRegConnection : (sc: net.liftweb.mapper.package.SuperConnection)java.sql.Connection">connection</a>.<span title="()java.sql.DatabaseMetaData">getMetaData</span>
    <span class="keyword">val</span> <a title="List[(String, String, Int)]" id="191606">q</a> = <a href="#190326" title="(f: =&gt; java.sql.ResultSet)(f2: java.sql.ResultSet =&gt; List[(String, String, Int)])List[(String, String, Int)]">using</a><span class="delimiter">(</span><a href="#191605" title="java.sql.DatabaseMetaData">md</a>.<span title="(x$1: java.lang.String, x$2: java.lang.String, x$3: java.lang.String, x$4: Boolean, x$5: Boolean)java.sql.ResultSet">getIndexInfo</span><span class="delimiter">(</span><span title="Null(null)" class="keyword">null</span>, <a href="#190335" title="(connection: net.liftweb.mapper.package.SuperConnection)String">getDefaultSchemaName</a><span class="delimiter">(</span><a href="#190791" title="net.liftweb.mapper.package.SuperConnection">connection</a><span class="delimiter">)</span>, <a href="#190792" title="(key: String)String">actualTableNames</a><span class="delimiter">(</span><a href="#190790" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146766" title="=&gt; String">_dbTableNameLC</a><span class="delimiter">)</span>, <span title="Boolean(false)" class="keyword">false</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span><a title="java.sql.ResultSet" id="191636">rs</a> =&gt;
      <span class="keyword">def</span> <a title="(rs: java.sql.ResultSet)List[(String, String, Int)]" id="191637">quad</a><span class="delimiter">(</span><a title="java.sql.ResultSet" id="191638">rs</a>: <span title="java.sql.ResultSet">ResultSet</span><span class="delimiter">)</span>: <span title="List[(String, String, Int)]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>String, String, Int<span class="delimiter">)</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
        <span title="List[(String, String, Int)]" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#191638" title="java.sql.ResultSet">rs</a>.<span title="()Boolean">next</span><span class="delimiter">)</span> <span title="object Nil">Nil</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span title="List[(String, String, Int)]" class="keyword">if</span> <span class="delimiter">(</span><a href="#191638" title="java.sql.ResultSet">rs</a>.<span title="(x$1: Int)java.lang.String">getString</span><span class="delimiter">(</span><span title="Int(3)" class="int">3</span><span class="delimiter">)</span>.<span title="(x$1: java.lang.String)Boolean">equalsIgnoreCase</span><span class="delimiter">(</span><a href="#190790" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146766" title="=&gt; String">_dbTableNameLC</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="comment">// Skip index statistics</span>
            <span title="List[(String, String, Int)]" class="keyword">if</span> <span class="delimiter">(</span><a href="#191638" title="java.sql.ResultSet">rs</a>.<span title="(x$1: Int)Short">getShort</span><span class="delimiter">(</span><span title="Int(7)" class="int">7</span><span class="delimiter">)</span> <span title="(x: Short)Boolean">!=</span> DatabaseMetaData.<span title="Short(0)">tableIndexStatistic</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span title="(_1: java.lang.String, _2: java.lang.String, _3: Int)(java.lang.String, java.lang.String, Int)" class="delimiter">(</span><a href="#191638" title="java.sql.ResultSet">rs</a>.<span title="(x$1: Int)java.lang.String">getString</span><span class="delimiter">(</span><span title="Int(6)" class="int">6</span><span class="delimiter">)</span>.<span title="()java.lang.String">toLowerCase</span>, <a href="#191638" title="java.sql.ResultSet">rs</a>.<span title="(x$1: Int)java.lang.String">getString</span><span class="delimiter">(</span><span title="Int(9)" class="int">9</span><span class="delimiter">)</span>.<span title="()java.lang.String">toLowerCase</span>, <a href="#191638" title="java.sql.ResultSet">rs</a>.<span title="(x$1: Int)Int">getInt</span><span class="delimiter">(</span><span title="Int(8)" class="int">8</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#191652" title="(x: (String, String, Int))List[(String, String, Int)]">::</a> <a href="#191637" title="(rs: java.sql.ResultSet)List[(String, String, Int)]">quad</a><span class="delimiter">(</span><a href="#191638" title="java.sql.ResultSet">rs</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            <span class="keyword">else</span> <a href="#191637" title="(rs: java.sql.ResultSet)List[(String, String, Int)]">quad</a><span class="delimiter">(</span><a href="#191638" title="java.sql.ResultSet">rs</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <span class="keyword">else</span> <span title="object Nil">Nil</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <a href="#191637" title="(rs: java.sql.ResultSet)List[(String, String, Int)]">quad</a><span class="delimiter">(</span><a href="#191636" title="java.sql.ResultSet">rs</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="comment">// val q = quad(rs)</span>
    <span class="comment">// q.foreach{case (name, col, pos) =&gt; byColumn.get(col) match {case Some(li) =&gt; byColumn(col) = (name, col, pos) :: li case _ =&gt; byColumn(col) = List((name, col, pos))}}</span>
    <a href="#191606" title="List[(String, String, Int)]">q</a>.<span title="(f: (String, String, Int) =&gt; Unit)Unit">foreach</span><a href="#191704" title="Unit" class="delimiter">{</a><span class="keyword">case</span> <span title="Unit" class="delimiter">(</span><a title="String" id="191708">name</a>, <a title="String" id="191709">col</a>, <a title="Int" id="191710">pos</a><span class="delimiter">)</span> =&gt; <a href="#191604" title="scala.collection.mutable.HashMap[String,List[String]]">byName</a>.<span title="(key: String)Option[List[String]]">get</span><span class="delimiter">(</span><a href="#191708" title="String">name</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span><span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="List[String]" id="191715">li</a><span class="delimiter">)</span> =&gt; <a href="#191604" title="(key: String, value: List[String])Unit">byName</a><span class="delimiter">(</span><a href="#191708" title="String">name</a><span class="delimiter">)</span> = <a href="#191709" title="String">col</a> <a href="#191720" title="(x: String)List[String]">::</a> <a href="#191715" title="List[String]">li</a> <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <a href="#191604" title="(key: String, value: List[String])Unit">byName</a><span class="delimiter">(</span><a href="#191708" title="String">name</a><span class="delimiter">)</span> = <span title="(xs: String*)List[String]">List</span><span class="delimiter">(</span><a href="#191709" title="String">col</a><span class="delimiter">)</span><span class="delimiter">}</span><span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="List[List[String]]" id="191607">indexedFields</a>: <span title="List[List[String]]">List</span><span class="delimiter">[</span>List<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span> = <a href="#191604" title="scala.collection.mutable.HashMap[String,List[String]]">byName</a>.<span title="(f: (String, List[String]) =&gt; List[String])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.HashMap[String,List[String]],List[String],scala.collection.mutable.Iterable[List[String]]])scala.collection.mutable.Iterable[List[String]]">map</span><a href="#191750" title="List[String]" class="delimiter">{</a><span class="keyword">case</span> <span title="List[String]" class="delimiter">(</span><a title="String" id="191753">name</a>, <a title="List[String]" id="191754">value</a><span class="delimiter">)</span> =&gt; <a href="#191754" title="List[String]">value</a>.<span title="(lt: (String, String) =&gt; Boolean)List[String]">sortWith</span><span class="delimiter">(</span><a href="#191757" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">_</a> <span title="(that: String)Boolean">&lt;</span> <a href="#191758" title="String">_</a><span class="delimiter">)</span><span class="delimiter">}</span>.<span title="=&gt; List[List[String]]">toList</span>
    <span class="comment">//rs.close</span>

    <span class="keyword">val</span> <a title="List[() =&gt; Unit]" id="191608">single</a> = <a href="#190790" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146767" title="=&gt; Seq[net.liftweb.mapper.BaseMappedField]">mappedFields</a>.<span title="(p: net.liftweb.mapper.BaseMappedField =&gt; Boolean)Seq[net.liftweb.mapper.BaseMappedField]">filter</span><span class="delimiter">{</span><a title="net.liftweb.mapper.BaseMappedField" id="192214">f</a> =&gt; <a href="#192214" title="net.liftweb.mapper.BaseMappedField">f</a>.<a href="MappedField.scala.html#147536" title="=&gt; Boolean">dbIndexed_?</a><span class="delimiter">}</span>.<span title="=&gt; List[net.liftweb.mapper.BaseMappedField]">toList</span>.<span title="(f: net.liftweb.mapper.BaseMappedField =&gt; scala.collection.GenTraversableOnce[() =&gt; Unit])(implicit bf: scala.collection.generic.CanBuildFrom[List[net.liftweb.mapper.BaseMappedField],() =&gt; Unit,List[() =&gt; Unit]])List[() =&gt; Unit]">flatMap</span> <span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,() =&gt; Unit,List[() =&gt; Unit]]" class="delimiter">{</span>
      <a title="net.liftweb.mapper.BaseMappedField" id="192235">field</a> =&gt;
      <span title="List[() =&gt; Unit]" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#191607" title="List[List[String]]">indexedFields</a>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><span title="(xs: java.lang.String*)List[java.lang.String]">List</span><span class="delimiter">(</span><a href="#192235" title="net.liftweb.mapper.BaseMappedField">field</a>.<a href="MappedField.scala.html#147535" title="=&gt; String">_dbColumnNameLC</a>.<span title="()java.lang.String">toLowerCase</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#191603" title="scala.collection.mutable.ListBuffer[String]">cmds</a> <span title="(x: String)cmds.type">+=</span> <a href="#190337" title="(performWrite: Boolean, logFunc: =&gt; AnyRef =&gt; Unit, connection: net.liftweb.mapper.package.SuperConnection)(makeSql: () =&gt; String)String">maybeWrite</a><span class="delimiter">(</span><a href="#190788" title="Boolean">performWrite</a>, <a href="#190789" title="=&gt; AnyRef =&gt; Unit">logFunc</a>, <a href="#190791" title="net.liftweb.mapper.package.SuperConnection">connection</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span title="java.lang.String(&quot;CREATE INDEX &quot;)" class="string">&quot;CREATE INDEX &quot;</span><span title="(x$1: Any)java.lang.String">+</span><span class="delimiter">(</span><a href="#190790" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146766" title="=&gt; String">_dbTableNameLC</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;_&quot;)" class="string">&quot;_&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#192235" title="net.liftweb.mapper.BaseMappedField">field</a>.<a href="MappedField.scala.html#147535" title="=&gt; String">_dbColumnNameLC</a><span class="delimiter">)</span><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; ON &quot;)" class="string">&quot; ON &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#190790" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146766" title="=&gt; String">_dbTableNameLC</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; ( &quot;)" class="string">&quot; ( &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#192235" title="net.liftweb.mapper.BaseMappedField">field</a>.<a href="MappedField.scala.html#147535" title="=&gt; String">_dbColumnNameLC</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; )&quot;)" class="string">&quot; )&quot;</span>
        <span class="delimiter">}</span>
        <a href="#192235" title="net.liftweb.mapper.BaseMappedField">field</a>.<a href="MappedField.scala.html#147542" title="=&gt; net.liftweb.common.Box[() =&gt; Unit]">dbAddedIndex</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27051" title="=&gt; List[() =&gt; Unit]">toList</a>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span title="object Nil">Nil</span>
    <span class="delimiter">}</span>

    <a href="#190790" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146769" title="=&gt; List[net.liftweb.mapper.BaseIndex[table.RealType]]">dbIndexes</a>.<span title="(f: net.liftweb.mapper.BaseIndex[table.RealType] =&gt; Any)Unit">foreach</span> <span class="delimiter">{</span>
      <a title="net.liftweb.mapper.BaseIndex[table.RealType]" id="192318">index</a> =&gt;

      <span class="keyword">val</span> <a title="List[net.liftweb.mapper.IndexItem[table.RealType]]" id="192319">columns</a> = <a href="#192318" title="net.liftweb.mapper.BaseIndex[table.RealType]">index</a>.<a href="MetaMapper.scala.html#170386" title="=&gt; Seq[net.liftweb.mapper.IndexItem[table.RealType]]">columns</a>.<span title="=&gt; List[net.liftweb.mapper.IndexItem[table.RealType]]">toList</span>

      <span class="keyword">val</span> <a title="java.lang.String" id="192320">standardCreationStatement</a> = <span class="delimiter">(</span><a href="#190790" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146766" title="=&gt; String">_dbTableNameLC</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;_&quot;)" class="string">&quot;_&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#192319" title="List[net.liftweb.mapper.IndexItem[table.RealType]]">columns</a>.<span title="(f: net.liftweb.mapper.IndexItem[table.RealType] =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[List[net.liftweb.mapper.IndexItem[table.RealType]],String,List[String]])List[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,String,List[String]]" class="delimiter">(</span><a href="#192344" title="net.liftweb.mapper.IndexItem[table.RealType]">_</a>.<a href="MetaMapper.scala.html#148127" title="=&gt; net.liftweb.mapper.BaseMappedField">field</a>.<a href="MappedField.scala.html#147535" title="=&gt; String">_dbColumnNameLC</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;_&quot;)" class="string">&quot;_&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; ON &quot;)" class="string">&quot; ON &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#190790" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146766" title="=&gt; String">_dbTableNameLC</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; ( &quot;)" class="string">&quot; ( &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#192319" title="List[net.liftweb.mapper.IndexItem[table.RealType]]">columns</a>.<span title="(f: net.liftweb.mapper.IndexItem[table.RealType] =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[List[net.liftweb.mapper.IndexItem[table.RealType]],String,List[String]])List[String]">map</span><a href="../../../../util/net/liftweb/util/ListHelpers.scala.html#48905" title="(in: List[String])net.liftweb.util.Helpers.SuperList[String]" class="delimiter">(</a><a href="#192385" title="net.liftweb.mapper.IndexItem[table.RealType]">_</a>.<a href="MetaMapper.scala.html#148128" title="=&gt; String">indexDesc</a><span class="delimiter">)</span>.<a href="../../../../util/net/liftweb/util/ListHelpers.scala.html#58416" title="=&gt; String">comma</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; )&quot;)" class="string">&quot; )&quot;</span>

      <span class="keyword">val</span> <a title="java.lang.String" id="192321">createStatement</a> = <a href="#192318" title="net.liftweb.mapper.BaseIndex[table.RealType]">index</a> <span title="java.lang.String" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="java.lang.String" id="192441">i</a>: net.liftweb.mapper.<a href="MetaMapper.scala.html#11674" title="net.liftweb.mapper.Index[_]">Index</a><span class="delimiter">[</span>_<span class="delimiter">]</span> =&gt; <span title="java.lang.String(&quot;CREATE INDEX &quot;)" class="string">&quot;CREATE INDEX &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#192320" title="java.lang.String">standardCreationStatement</a>
        <span class="keyword">case</span> <a title="java.lang.String" id="192446">i</a>: <a href="MetaMapper.scala.html#11678" title="net.liftweb.mapper.UniqueIndex[_]">UniqueIndex</a><span class="delimiter">[</span>_<span class="delimiter">]</span> =&gt; <span title="java.lang.String(&quot;CREATE UNIQUE INDEX &quot;)" class="string">&quot;CREATE UNIQUE INDEX &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#192320" title="java.lang.String">standardCreationStatement</a>
        <span class="keyword">case</span> <span title="String">GenericIndex</span><span class="delimiter">(</span><a title="(String, List[String]) =&gt; String" id="192454">createFunc</a>, _, _<span class="delimiter">)</span> =&gt; <a href="#192454" title="(v1: String, v2: List[String])String">createFunc</a><span class="delimiter">(</span><a href="#190790" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146766" title="=&gt; String">_dbTableNameLC</a>, <a href="#192319" title="List[net.liftweb.mapper.IndexItem[table.RealType]]">columns</a>.<span title="(f: net.liftweb.mapper.IndexItem[table.RealType] =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[List[net.liftweb.mapper.IndexItem[table.RealType]],String,List[String]])List[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,String,List[String]]" class="delimiter">(</span><a href="#192467" title="net.liftweb.mapper.IndexItem[table.RealType]">_</a>.<a href="MetaMapper.scala.html#148127" title="=&gt; net.liftweb.mapper.BaseMappedField">field</a>.<a href="MappedField.scala.html#147535" title="=&gt; String">_dbColumnNameLC</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="java.lang.String">_</span> =&gt; <a href="../../../../common/net/liftweb/common/Logging.scala.html#19845" title="=&gt; net.liftweb.common.Logger">logger</a>.<a href="../../../../common/net/liftweb/common/Logging.scala.html#31960" title="(msg: =&gt; AnyRef)Unit">error</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Invalid index: &quot;)" class="string">&quot;Invalid index: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#192318" title="net.liftweb.mapper.BaseIndex[table.RealType]">index</a><span class="delimiter">)</span>; <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="List[java.lang.String]" id="192322">fn</a> = <a href="#192319" title="List[net.liftweb.mapper.IndexItem[table.RealType]]">columns</a>.<span title="(f: net.liftweb.mapper.IndexItem[table.RealType] =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[List[net.liftweb.mapper.IndexItem[table.RealType]],java.lang.String,List[java.lang.String]])List[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,java.lang.String,List[java.lang.String]]" class="delimiter">(</span><a href="#192507" title="net.liftweb.mapper.IndexItem[table.RealType]">_</a>.<a href="MetaMapper.scala.html#148127" title="=&gt; net.liftweb.mapper.BaseMappedField">field</a>.<a href="MappedField.scala.html#147535" title="=&gt; String">_dbColumnNameLC</a>.<span title="()java.lang.String">toLowerCase</span><span class="delimiter">)</span>.<span title="(lt: (java.lang.String, java.lang.String) =&gt; Boolean)List[java.lang.String]">sortWith</span><span class="delimiter">(</span><a href="#192539" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">_</a> <span title="(that: String)Boolean">&lt;</span> <a href="#192540" title="java.lang.String">_</a><span class="delimiter">)</span>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#191607" title="List[List[String]]">indexedFields</a>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#192322" title="List[java.lang.String]">fn</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#191603" title="scala.collection.mutable.ListBuffer[String]">cmds</a> <span title="(x: String)cmds.type">+=</span> <a href="#190337" title="(performWrite: Boolean, logFunc: =&gt; AnyRef =&gt; Unit, connection: net.liftweb.mapper.package.SuperConnection)(makeSql: () =&gt; String)String">maybeWrite</a><span class="delimiter">(</span><a href="#190788" title="Boolean">performWrite</a>, <a href="#190789" title="=&gt; AnyRef =&gt; Unit">logFunc</a>, <a href="#190791" title="net.liftweb.mapper.package.SuperConnection">connection</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#192321" title="java.lang.String">createStatement</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <a href="#192832" title="(funcs: List[() =&gt; Any], cmds: List[String])net.liftweb.mapper.Schemifier.Collector">Collector</a><span class="delimiter">(</span><a href="#191608" title="List[() =&gt; Unit]">single</a>, <a href="#191603" title="scala.collection.mutable.ListBuffer[String]">cmds</a>.<span title="=&gt; List[String]">toList</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(performWrite: Boolean, logFunc: =&gt; AnyRef =&gt; Unit, table: net.liftweb.mapper.BaseMetaMapper, dbId: net.liftweb.mapper.package.ConnectionIdentifier, connection: net.liftweb.mapper.package.SuperConnection, actualTableNames: scala.collection.mutable.HashMap[String,String])net.liftweb.mapper.Schemifier.Collector" id="190342">ensureConstraints</a><span class="delimiter">(</span><a title="Boolean" id="190810">performWrite</a>: <span title="Boolean">Boolean</span>, <a title="=&gt; AnyRef =&gt; Unit" id="190811">logFunc</a>: <span class="delimiter">(</span>=&gt; AnyRef<span class="delimiter">)</span> =&gt; Unit, <a title="net.liftweb.mapper.BaseMetaMapper" id="190812">table</a>: <a href="MetaMapper.scala.html#11665" title="net.liftweb.mapper.BaseMetaMapper">BaseMetaMapper</a>, <a title="net.liftweb.mapper.package.ConnectionIdentifier" id="190813">dbId</a>: <a href="../../../../db/net/liftweb/db/DB.scala.html#10911" title="net.liftweb.mapper.package.ConnectionIdentifier">ConnectionIdentifier</a>, <a title="net.liftweb.mapper.package.SuperConnection" id="190814">connection</a>: <a href="../../../../db/net/liftweb/db/DB.scala.html#10908" title="net.liftweb.mapper.package.SuperConnection">SuperConnection</a>, <a title="scala.collection.mutable.HashMap[String,String]" id="190815">actualTableNames</a>: <span title="scala.collection.mutable.HashMap[String,String]">HashMap</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#192832" title="net.liftweb.mapper.Schemifier.Collector">Collector</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ListBuffer[String]" id="192582">cmds</a> = <span title="scala.collection.mutable.ListBuffer[String]" class="keyword">new</span> <span title="scala.collection.mutable.ListBuffer[String]">ListBuffer</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="List[() =&gt; Unit]" id="192583">ret</a> = <span title="List[() =&gt; Unit]" class="keyword">if</span> <span class="delimiter">(</span><a href="#190814" title="net.liftweb.mapper.package.SuperConnection">connection</a>.<a href="../../../../db/net/liftweb/db/DB.scala.html#60072" title="=&gt; Boolean">supportsForeignKeys_?</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="MetaMapper.scala.html#11666" title="object net.liftweb.mapper.MapperRules">MapperRules</a>.<a href="MetaMapper.scala.html#147884" title="(v1: net.liftweb.mapper.package.ConnectionIdentifier)Boolean">createForeignKeys_?</a><span class="delimiter">(</span><a href="#190813" title="net.liftweb.mapper.package.ConnectionIdentifier">dbId</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#190812" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146767" title="=&gt; Seq[net.liftweb.mapper.BaseMappedField]">mappedFields</a>.<span title="(f: net.liftweb.mapper.BaseMappedField =&gt; scala.collection.GenTraversableOnce[net.liftweb.mapper.BaseMappedField with net.liftweb.mapper.BaseForeignKey])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[net.liftweb.mapper.BaseMappedField],net.liftweb.mapper.BaseMappedField with net.liftweb.mapper.BaseForeignKey,Seq[net.liftweb.mapper.BaseMappedField with net.liftweb.mapper.BaseForeignKey]])Seq[net.liftweb.mapper.BaseMappedField with net.liftweb.mapper.BaseForeignKey]">flatMap</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,net.liftweb.mapper.BaseMappedField with net.liftweb.mapper.BaseForeignKey,Seq[net.liftweb.mapper.BaseMappedField with net.liftweb.mapper.BaseForeignKey]]" class="delimiter">{</span><a title="net.liftweb.mapper.BaseMappedField" id="192604">f</a> =&gt; <a href="#192604" title="net.liftweb.mapper.BaseMappedField">f</a> <span title="List[net.liftweb.mapper.BaseMappedField with net.liftweb.mapper.BaseForeignKey]" class="keyword">match</span> <span class="delimiter">{</span><span class="keyword">case</span> <a title="List[net.liftweb.mapper.BaseMappedField with net.liftweb.mapper.BaseForeignKey]" id="192605">f</a>: <a href="#192606" title="Schemifier extends net.liftweb.mapper.BaseMappedField with net.liftweb.mapper.BaseForeignKey">BaseMappedField</a> <span class="keyword">with</span> BaseForeignKey =&gt; <span title="(xs: net.liftweb.mapper.BaseMappedField with net.liftweb.mapper.BaseForeignKey*)List[net.liftweb.mapper.BaseMappedField with net.liftweb.mapper.BaseForeignKey]">List</span><span class="delimiter">(</span><a href="#192605" title="Schemifier extends net.liftweb.mapper.BaseMappedField with net.liftweb.mapper.BaseForeignKey">f</a><span class="delimiter">)</span>; <span class="keyword">case</span> <span title="scala.collection.immutable.Nil.type">_</span> =&gt; <span title="object Nil">Nil</span><span class="delimiter">}</span><span class="delimiter">}</span>.<span title="=&gt; List[net.liftweb.mapper.BaseMappedField with net.liftweb.mapper.BaseForeignKey]">toList</span>.<span title="(f: net.liftweb.mapper.BaseMappedField with net.liftweb.mapper.BaseForeignKey =&gt; scala.collection.GenTraversableOnce[() =&gt; Unit])(implicit bf: scala.collection.generic.CanBuildFrom[List[net.liftweb.mapper.BaseMappedField with net.liftweb.mapper.BaseForeignKey],() =&gt; Unit,List[() =&gt; Unit]])List[() =&gt; Unit]">flatMap</span> <span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,() =&gt; Unit,List[() =&gt; Unit]]" class="delimiter">{</span>
        <a title="Schemifier extends net.liftweb.mapper.BaseMappedField with net.liftweb.mapper.BaseForeignKey" id="192661">field</a> =&gt;

        <span class="keyword">val</span> <a title="net.liftweb.mapper.BaseMetaMapper" id="192662">other</a> = <a href="#192661" title="Schemifier extends net.liftweb.mapper.BaseMappedField with net.liftweb.mapper.BaseForeignKey">field</a>.<a href="MappedForeignKey.scala.html#162544" title="=&gt; net.liftweb.mapper.BaseMetaMapper">dbKeyToTable</a>
        <span class="keyword">val</span> <a title="String" id="192663">otherTable</a> = <a href="#190815" title="(key: String)String">actualTableNames</a><span class="delimiter">(</span><a href="#192662" title="net.liftweb.mapper.BaseMetaMapper">other</a>.<a href="MetaMapper.scala.html#146766" title="=&gt; String">_dbTableNameLC</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="String" id="192664">myTable</a> = <a href="#190815" title="(key: String)String">actualTableNames</a><span class="delimiter">(</span><a href="#190812" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146766" title="=&gt; String">_dbTableNameLC</a><span class="delimiter">)</span>

        <span class="keyword">val</span> <a title="java.sql.DatabaseMetaData" id="192665">md</a> = <a href="#190315" title="implicit net.liftweb.mapper.Schemifier.superToRegConnection : (sc: net.liftweb.mapper.package.SuperConnection)java.sql.Connection">connection</a>.<span title="()java.sql.DatabaseMetaData">getMetaData</span>
        <span class="comment">// val rs = md.getCrossReference(null, null,otherTable , null, null, myTable)</span>
        <span class="keyword">var</span> <a title="Boolean" id="192666">foundIt</a> = <span title="Boolean(false)" class="keyword">false</span>
        <a href="#190326" title="(f: =&gt; java.sql.ResultSet)(f2: java.sql.ResultSet =&gt; Unit)Unit">using</a><span class="delimiter">(</span><a href="#192665" title="java.sql.DatabaseMetaData">md</a>.<span title="(x$1: java.lang.String, x$2: java.lang.String, x$3: java.lang.String)java.sql.ResultSet">getImportedKeys</span><span class="delimiter">(</span><span title="Null(null)" class="keyword">null</span>, <a href="#190335" title="(connection: net.liftweb.mapper.package.SuperConnection)String">getDefaultSchemaName</a><span class="delimiter">(</span><a href="#190814" title="net.liftweb.mapper.package.SuperConnection">connection</a><span class="delimiter">)</span>, <a href="#192664" title="String">myTable</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="java.sql.ResultSet" id="192708">rs</a> =&gt;
          <span class="comment">//val rs = md.getCrossReference(null, null,myTable , null, null, otherTable)</span>
          <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#192666" title="Boolean">foundIt</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#192708" title="java.sql.ResultSet">rs</a>.<span title="()Boolean">next</span><span class="delimiter">)</span> <a href="#192709" title="()Unit" class="delimiter">{</a>
            <span class="keyword">val</span> <a title="java.lang.String" id="192710">pkName</a> = <a href="#192708" title="java.sql.ResultSet">rs</a>.<span title="(x$1: Int)java.lang.String">getString</span><span class="delimiter">(</span><span title="Int(4)" class="int">4</span><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="java.lang.String" id="192711">fkName</a> = <a href="#192708" title="java.sql.ResultSet">rs</a>.<span title="(x$1: Int)java.lang.String">getString</span><span class="delimiter">(</span><span title="Int(8)" class="int">8</span><span class="delimiter">)</span>
            <a href="#192666" title="Boolean">foundIt</a> = <span class="delimiter">(</span><a href="#192661" title="Schemifier extends net.liftweb.mapper.BaseMappedField with net.liftweb.mapper.BaseForeignKey">field</a>.<a href="MappedField.scala.html#147535" title="=&gt; String">_dbColumnNameLC</a>.<span title="()java.lang.String">toLowerCase</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#192711" title="java.lang.String">fkName</a>.<span title="()java.lang.String">toLowerCase</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#192661" title="Schemifier extends net.liftweb.mapper.BaseMappedField with net.liftweb.mapper.BaseForeignKey">field</a>.<a href="MappedForeignKey.scala.html#162545" title="=&gt; net.liftweb.mapper.BaseMappedField">dbKeyToColumn</a>.<a href="MappedField.scala.html#147535" title="=&gt; String">_dbColumnNameLC</a>.<span title="()java.lang.String">toLowerCase</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#192710" title="java.lang.String">pkName</a>.<span title="()java.lang.String">toLowerCase</span><span class="delimiter">)</span>
          <span class="delimiter">}</span><span class="delimiter">)</span>

        <span title="List[() =&gt; Unit]" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#192666" title="Boolean">foundIt</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#192582" title="scala.collection.mutable.ListBuffer[String]">cmds</a> <span title="(x: String)cmds.type">+=</span> <a href="#190337" title="(performWrite: Boolean, logFunc: =&gt; AnyRef =&gt; Unit, connection: net.liftweb.mapper.package.SuperConnection)(makeSql: () =&gt; String)String">maybeWrite</a><span class="delimiter">(</span><a href="#190810" title="Boolean">performWrite</a>, <a href="#190811" title="=&gt; AnyRef =&gt; Unit">logFunc</a>, <a href="#190814" title="net.liftweb.mapper.package.SuperConnection">connection</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span title="java.lang.String(&quot;ALTER TABLE &quot;)" class="string">&quot;ALTER TABLE &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#190812" title="net.liftweb.mapper.BaseMetaMapper">table</a>.<a href="MetaMapper.scala.html#146766" title="=&gt; String">_dbTableNameLC</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; ADD FOREIGN KEY ( &quot;)" class="string">&quot; ADD FOREIGN KEY ( &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#192661" title="Schemifier extends net.liftweb.mapper.BaseMappedField with net.liftweb.mapper.BaseForeignKey">field</a>.<a href="MappedField.scala.html#147535" title="=&gt; String">_dbColumnNameLC</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; ) REFERENCES &quot;)" class="string">&quot; ) REFERENCES &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#192662" title="net.liftweb.mapper.BaseMetaMapper">other</a>.<a href="MetaMapper.scala.html#146766" title="=&gt; String">_dbTableNameLC</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; ( &quot;)" class="string">&quot; ( &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#192661" title="Schemifier extends net.liftweb.mapper.BaseMappedField with net.liftweb.mapper.BaseForeignKey">field</a>.<a href="MappedForeignKey.scala.html#162545" title="=&gt; net.liftweb.mapper.BaseMappedField">dbKeyToColumn</a>.<a href="MappedField.scala.html#147535" title="=&gt; String">_dbColumnNameLC</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; ) &quot;)" class="string">&quot; ) &quot;</span>
          <span class="delimiter">}</span>
          <a href="#192661" title="Schemifier extends net.liftweb.mapper.BaseMappedField with net.liftweb.mapper.BaseForeignKey">field</a>.<a href="MappedForeignKey.scala.html#162548" title="=&gt; net.liftweb.common.Box[() =&gt; Unit]">dbAddedForeignKey</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27051" title="=&gt; List[() =&gt; Unit]">toList</a>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span title="object Nil">Nil</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span title="object Nil">Nil</span>
    <span class="delimiter">}</span>

    <a href="#192832" title="(funcs: List[() =&gt; Any], cmds: List[String])net.liftweb.mapper.Schemifier.Collector">Collector</a><span class="delimiter">(</span><a href="#192583" title="List[() =&gt; Unit]">ret</a>, <a href="#192582" title="scala.collection.mutable.ListBuffer[String]">cmds</a>.<span title="=&gt; List[String]">toList</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>


        </pre>
    </body>
</html>
<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>json/net/liftweb/json/JsonParser.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright 2009-2010 WorldWide Conferencing, LLC
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

<span class="keyword">package</span> net.liftweb
<span class="keyword">package</span> json

<span class="comment">/** JSON parser.
 */</span>
<span class="keyword">object</span> <a title="object net.liftweb.json.JsonParser" id="11146">JsonParser</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">import</span> java.io._

  <span class="keyword">class</span> <a title="class ParseException extends java.lang.Exception with ScalaObject" id="54506">ParseException</a><a href="#54506" title="ScalaObject" class="delimiter">(</a><a title="String" id="135466">message</a>: <span title="String">String</span>, <a title="Exception" id="135467">cause</a>: <span title="Exception">Exception</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="java.lang.Exception">Exception</span><span class="delimiter">(</span><a href="#135466" title="String">message</a>, <a href="#135467" title="Exception">cause</a><span class="delimiter">)</span>

  <span class="comment">/** Parsed tokens from low level pull parser.
   */</span>
  <span class="keyword">sealed</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class Token extends java.lang.Object with ScalaObject" id="54507">Token</a>
  case <span class="keyword">object</span> <a href="#135893" title="object net.liftweb.json.JsonParser.OpenObj" id="135898">OpenObj</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#54507" title="net.liftweb.json.JsonParser.Token">Token</a>
  case <span class="keyword">object</span> <a href="#135905" title="object net.liftweb.json.JsonParser.CloseObj" id="135910">CloseObj</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#54507" title="net.liftweb.json.JsonParser.Token">Token</a>
  case <span class="keyword">class</span> <a title="class FieldStart extends net.liftweb.json.JsonParser.Token with ScalaObject with Product with Serializable" id="137574">FieldStart</a><a href="#137574" title="ScalaObject" class="delimiter">(</a><a title="String" id="137042">name</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#54507" title="net.liftweb.json.JsonParser.Token">Token</a>
  case <span class="keyword">object</span> <a href="#135942" title="object net.liftweb.json.JsonParser.End" id="135947">End</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#54507" title="net.liftweb.json.JsonParser.Token">Token</a>
  case <span class="keyword">class</span> <a title="class StringVal extends net.liftweb.json.JsonParser.Token with ScalaObject with Product with Serializable" id="137570">StringVal</a><a href="#137570" title="ScalaObject" class="delimiter">(</a><a title="String" id="137046">value</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#54507" title="net.liftweb.json.JsonParser.Token">Token</a>
  case <span class="keyword">class</span> <a title="class IntVal extends net.liftweb.json.JsonParser.Token with ScalaObject with Product with Serializable" id="137566">IntVal</a><a href="#137566" title="ScalaObject" class="delimiter">(</a><a title="BigInt" id="137002">value</a>: <span title="BigInt">BigInt</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#54507" title="net.liftweb.json.JsonParser.Token">Token</a>
  case <span class="keyword">class</span> <a title="class DoubleVal extends net.liftweb.json.JsonParser.Token with ScalaObject with Product with Serializable" id="137562">DoubleVal</a><a href="#137562" title="ScalaObject" class="delimiter">(</a><a title="Double" id="136998">value</a>: <span title="Double">Double</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#54507" title="net.liftweb.json.JsonParser.Token">Token</a>
  case <span class="keyword">class</span> <a title="class BoolVal extends net.liftweb.json.JsonParser.Token with ScalaObject with Product with Serializable" id="137558">BoolVal</a><a href="#137558" title="ScalaObject" class="delimiter">(</a><a title="Boolean" id="137065">value</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#54507" title="net.liftweb.json.JsonParser.Token">Token</a>
  case <span class="keyword">object</span> <a href="#136054" title="object net.liftweb.json.JsonParser.NullVal" id="136059">NullVal</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#54507" title="net.liftweb.json.JsonParser.Token">Token</a>
  case <span class="keyword">object</span> <a href="#136066" title="object net.liftweb.json.JsonParser.OpenArr" id="136071">OpenArr</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#54507" title="net.liftweb.json.JsonParser.Token">Token</a>
  case <span class="keyword">object</span> <a href="#136078" title="object net.liftweb.json.JsonParser.CloseArr" id="136083">CloseArr</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#54507" title="net.liftweb.json.JsonParser.Token">Token</a>

  <span class="comment">/** Return parsed JSON.
   * @throws ParseException is thrown if parsing fails
   */</span>
  <span class="keyword">def</span> <a title="(s: String)net.liftweb.json.package.JValue" id="54535">parse</a><span class="delimiter">(</span><a title="String" id="54593">s</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="JsonAST.scala.html#48510" title="net.liftweb.json.package.JValue">JValue</a> = <a href="#54545" title="(buf: net.liftweb.json.JsonParser.Buffer)net.liftweb.json.package.JValue">parse</a><span class="delimiter">(</span><span title="net.liftweb.json.JsonParser.Buffer" class="keyword">new</span> <a href="#54557" title="net.liftweb.json.JsonParser.Buffer">Buffer</a><span class="delimiter">(</span><span title="java.io.StringReader" class="keyword">new</span> <span title="java.io.StringReader">StringReader</span><span class="delimiter">(</span><a href="#54593" title="String">s</a><span class="delimiter">)</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/** Return parsed JSON.
   * @param closeAutomatically true (default) if the Reader is automatically closed on EOF
   * @throws ParseException is thrown if parsing fails
   */</span>
  <span class="keyword">def</span> <a title="(s: java.io.Reader, closeAutomatically: Boolean)net.liftweb.json.package.JValue" id="54536">parse</a><span class="delimiter">(</span><a title="java.io.Reader" id="54589">s</a>: <span title="java.io.Reader">Reader</span>, <a title="Boolean" id="54592">closeAutomatically</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>: <a href="JsonAST.scala.html#48510" title="net.liftweb.json.package.JValue">JValue</a> = 
    <a href="#54545" title="(buf: net.liftweb.json.JsonParser.Buffer)net.liftweb.json.package.JValue">parse</a><span class="delimiter">(</span><span title="net.liftweb.json.JsonParser.Buffer" class="keyword">new</span> <a href="#54557" title="net.liftweb.json.JsonParser.Buffer">Buffer</a><span class="delimiter">(</span><a href="#54589" title="java.io.Reader">s</a>, <a href="#54592" title="Boolean">closeAutomatically</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/** Return parsed JSON.
   */</span>
  <span class="keyword">def</span> <a title="(s: String)Option[net.liftweb.json.package.JValue]" id="54537">parseOpt</a><span class="delimiter">(</span><a title="String" id="136127">s</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[net.liftweb.json.package.JValue]">Option</span><span class="delimiter">[</span>JValue<span class="delimiter">]</span> = 
    <span class="keyword">try</span> <span class="delimiter">{</span> <a href="#54535" title="(s: String)net.liftweb.json.package.JValue">parse</a><span class="delimiter">(</span><a href="#136127" title="String">s</a><span class="delimiter">)</span>.<a href="JsonAST.scala.html#50109" title="=&gt; Option[net.liftweb.json.JsonAST.JValue]">toOpt</a> <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span> <span class="keyword">case</span> <a title="None.type" id="136141">e</a>: <span title="Exception">Exception</span> =&gt; <span title="object None">None</span> <span class="delimiter">}</span>

  <span class="comment">/** Return parsed JSON.
   * @param closeAutomatically true (default) if the Reader is automatically closed on EOF
   */</span>
  <span class="keyword">def</span> <a title="(s: java.io.Reader, closeAutomatically: Boolean)Option[net.liftweb.json.package.JValue]" id="54538">parseOpt</a><span class="delimiter">(</span><a title="java.io.Reader" id="136142">s</a>: <span title="java.io.Reader">Reader</span>, <a title="Boolean" id="136145">closeAutomatically</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>: <span title="Option[net.liftweb.json.package.JValue]">Option</span><span class="delimiter">[</span>JValue<span class="delimiter">]</span> = 
    <span class="keyword">try</span> <span class="delimiter">{</span> <a href="#54536" title="(s: java.io.Reader, closeAutomatically: Boolean)net.liftweb.json.package.JValue">parse</a><span class="delimiter">(</span><a href="#136142" title="java.io.Reader">s</a>, <a href="#136145" title="Boolean">closeAutomatically</a><span class="delimiter">)</span>.<a href="JsonAST.scala.html#50109" title="=&gt; Option[net.liftweb.json.JsonAST.JValue]">toOpt</a> <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span> <span class="keyword">case</span> <a title="None.type" id="136164">e</a>: <span title="Exception">Exception</span> =&gt; <span title="object None">None</span> <span class="delimiter">}</span>

  <span class="comment">/** Parse in pull parsing style.
   * Use &lt;code&gt;p.nextToken&lt;/code&gt; to parse tokens one by one from a string.
   * @see net.liftweb.json.JsonParser.Token
   */</span>
  <span class="keyword">def</span> <a title="[A](s: String, p: net.liftweb.json.JsonParser.Parser =&gt; A)A" id="54539">parse</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="54541">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="String" id="54579">s</a>: <span title="String">String</span>, <a title="net.liftweb.json.JsonParser.Parser =&gt; A" id="54580">p</a>: Parser =&gt; A<span class="delimiter">)</span>: <a href="#54541" title="A">A</a> = <a href="#54542" title="(s: java.io.Reader, p: net.liftweb.json.JsonParser.Parser =&gt; A)A">parse</a><span class="delimiter">(</span><span title="java.io.StringReader" class="keyword">new</span> <span title="java.io.StringReader">StringReader</span><span class="delimiter">(</span><a href="#54579" title="String">s</a><span class="delimiter">)</span>, <a href="#54580" title="net.liftweb.json.JsonParser.Parser =&gt; A">p</a><span class="delimiter">)</span>

  <span class="comment">/** Parse in pull parsing style.
   * Use &lt;code&gt;p.nextToken&lt;/code&gt; to parse tokens one by one from a stream.
   * The Reader must be closed when parsing is stopped.
   * @see net.liftweb.json.JsonParser.Token
   */</span>
  <span class="keyword">def</span> <a title="[A](s: java.io.Reader, p: net.liftweb.json.JsonParser.Parser =&gt; A)A" id="54542">parse</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="54544">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="java.io.Reader" id="54569">s</a>: <span title="java.io.Reader">Reader</span>, <a title="net.liftweb.json.JsonParser.Parser =&gt; A" id="54570">p</a>: Parser =&gt; A<span class="delimiter">)</span>: <a href="#54544" title="A">A</a> = <a href="#54570" title="(v1: net.liftweb.json.JsonParser.Parser)A">p</a><span class="delimiter">(</span><span title="net.liftweb.json.JsonParser.Parser" class="keyword">new</span> <a href="#54556" title="net.liftweb.json.JsonParser.Parser">Parser</a><span class="delimiter">(</span><span title="net.liftweb.json.JsonParser.Buffer" class="keyword">new</span> <a href="#54557" title="net.liftweb.json.JsonParser.Buffer">Buffer</a><span class="delimiter">(</span><a href="#54569" title="java.io.Reader">s</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(buf: net.liftweb.json.JsonParser.Buffer)net.liftweb.json.package.JValue" id="54545">parse</a><span class="delimiter">(</span><a title="net.liftweb.json.JsonParser.Buffer" id="136088">buf</a>: <a href="#54557" title="net.liftweb.json.JsonParser.Buffer">Buffer</a><span class="delimiter">)</span>: <a href="JsonAST.scala.html#48510" title="net.liftweb.json.package.JValue">JValue</a> = <span class="delimiter">{</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#54551" title="(v1: net.liftweb.json.JsonParser.Parser)net.liftweb.json.package.JValue">astParser</a><span class="delimiter">(</span><span title="net.liftweb.json.JsonParser.Parser" class="keyword">new</span> <a href="#54556" title="net.liftweb.json.JsonParser.Parser">Parser</a><span class="delimiter">(</span><a href="#136088" title="net.liftweb.json.JsonParser.Buffer">buf</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Nothing" id="136283">e</a>: <a href="#54506" title="net.liftweb.json.JsonParser.ParseException">ParseException</a> =&gt; <span title="Nothing" class="keyword">throw</span> <a href="#136283" title="net.liftweb.json.JsonParser.ParseException">e</a>
      <span class="keyword">case</span> <a title="Nothing" id="136284">e</a>: <span title="Exception">Exception</span> =&gt; <span title="Nothing" class="keyword">throw</span> <span title="net.liftweb.json.JsonParser.ParseException" class="keyword">new</span> <a href="#54506" title="net.liftweb.json.JsonParser.ParseException">ParseException</a><span class="delimiter">(</span><span title="java.lang.String(&quot;parsing failed&quot;)" class="string">&quot;parsing failed&quot;</span>, <a href="#136284" title="Exception">e</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span> <a href="#136088" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124519" title="=&gt; Unit">release</a> <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">private</span><span class="delimiter">[</span>json<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(string: String)String" id="54546">unquote</a><span class="delimiter">(</span><a title="String" id="124522">string</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="String">String</span> = 
    <a href="#54547" title="(buf: net.liftweb.json.JsonParser.Buffer)String">unquote</a><span class="delimiter">(</span><span title="net.liftweb.json.JsonParser.Buffer" class="keyword">new</span> <a href="#11146" title="object net.liftweb.json.JsonParser">JsonParser</a>.<a href="#54557" title="net.liftweb.json.JsonParser.Buffer">Buffer</a><span class="delimiter">(</span><span title="java.io.StringReader" class="keyword">new</span> java.io.<span title="java.io.StringReader">StringReader</span><span class="delimiter">(</span><a href="#124522" title="String">string</a><span class="delimiter">)</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span>
  
  <span class="keyword">private</span><span class="delimiter">[</span>json<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(buf: net.liftweb.json.JsonParser.Buffer)String" id="54547">unquote</a><span class="delimiter">(</span><a title="net.liftweb.json.JsonParser.Buffer" id="124491">buf</a>: JsonParser.<a href="#54557" title="net.liftweb.json.JsonParser.Buffer">Buffer</a><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(buf: net.liftweb.json.JsonParser.Buffer, base: String)String" id="136363">unquote0</a><span class="delimiter">(</span><a title="net.liftweb.json.JsonParser.Buffer" id="136366">buf</a>: JsonParser.<a href="#54557" title="net.liftweb.json.JsonParser.Buffer">Buffer</a>, <a title="String" id="136367">base</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.lang.StringBuilder" id="136368">s</a> = <span title="(x$1: java.lang.String)java.lang.StringBuilder" class="keyword">new</span> java.lang.<span title="java.lang.StringBuilder">StringBuilder</span><span class="delimiter">(</span><a href="#136367" title="String">base</a><span class="delimiter">)</span>
      <span class="keyword">var</span> <a title="Char" id="136369">c</a> = <span title="Char(\'\\\\\')" class="char">'\\'</span>
      <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#136369" title="Char">c</a> <span title="(x: Char)Boolean">!=</span> <span title="Char(\'\\\&quot;\')" class="char">'&quot;'</span><span class="delimiter">)</span> <a href="#136370" title="()Unit" class="delimiter">{</a>
        <span title="java.lang.StringBuilder" class="keyword">if</span> <span class="delimiter">(</span><a href="#136369" title="Char">c</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'\\\\\')" class="char">'\\'</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#136366" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124516" title="=&gt; Char">next</a> <span title="java.lang.StringBuilder" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="java.lang.StringBuilder" class="char">'&quot;'</span>  =&gt; <a href="#136368" title="java.lang.StringBuilder">s</a>.<span title="(x$1: Char)java.lang.StringBuilder">append</span><span class="delimiter">(</span><span title="Char(\'\\\&quot;\')" class="char">'&quot;'</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <span title="java.lang.StringBuilder" class="char">'\\'</span> =&gt; <a href="#136368" title="java.lang.StringBuilder">s</a>.<span title="(x$1: Char)java.lang.StringBuilder">append</span><span class="delimiter">(</span><span title="Char(\'\\\\\')" class="char">'\\'</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <span title="java.lang.StringBuilder" class="char">'/'</span>  =&gt; <a href="#136368" title="java.lang.StringBuilder">s</a>.<span title="(x$1: Char)java.lang.StringBuilder">append</span><span class="delimiter">(</span><span title="Char(\'/\')" class="char">'/'</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <span title="java.lang.StringBuilder" class="char">'b'</span>  =&gt; <a href="#136368" title="java.lang.StringBuilder">s</a>.<span title="(x$1: Char)java.lang.StringBuilder">append</span><span class="delimiter">(</span><span title="Char(\'\\b\')" class="char">'\b'</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <span title="java.lang.StringBuilder" class="char">'f'</span>  =&gt; <a href="#136368" title="java.lang.StringBuilder">s</a>.<span title="(x$1: Char)java.lang.StringBuilder">append</span><span class="delimiter">(</span><span title="Char(\'\\f\')" class="char">'\f'</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <span title="java.lang.StringBuilder" class="char">'n'</span>  =&gt; <a href="#136368" title="java.lang.StringBuilder">s</a>.<span title="(x$1: Char)java.lang.StringBuilder">append</span><span class="delimiter">(</span><span title="Char(\'\\n\')" class="char">'\n'</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <span title="java.lang.StringBuilder" class="char">'r'</span>  =&gt; <a href="#136368" title="java.lang.StringBuilder">s</a>.<span title="(x$1: Char)java.lang.StringBuilder">append</span><span class="delimiter">(</span><span title="Char(\'\\r\')" class="char">'\r'</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <span title="java.lang.StringBuilder" class="char">'t'</span>  =&gt; <a href="#136368" title="java.lang.StringBuilder">s</a>.<span title="(x$1: Char)java.lang.StringBuilder">append</span><span class="delimiter">(</span><span title="Char(\'\\t\')" class="char">'\t'</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <span title="java.lang.StringBuilder" class="char">'u'</span> =&gt;
              <span class="keyword">val</span> <a title="Array[Char]" id="136419">chars</a> = <span title="(x: Char, xs: Char*)Array[Char]">Array</span><span class="delimiter">(</span><a href="#136366" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124516" title="=&gt; Char">next</a>, <a href="#136366" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124516" title="=&gt; Char">next</a>, <a href="#136366" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124516" title="=&gt; Char">next</a>, <a href="#136366" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124516" title="=&gt; Char">next</a><span class="delimiter">)</span>
              <span class="keyword">val</span> <a title="Int" id="136420">codePoint</a> = <span title="object java.lang.Integer">Integer</span>.<span title="(x$1: java.lang.String, x$2: Int)Int">parseInt</span><span class="delimiter">(</span><span title="(x$1: Array[Char])java.lang.String" class="keyword">new</span> <span title="java.lang.String">String</span><span class="delimiter">(</span><a href="#136419" title="Array[Char]">chars</a><span class="delimiter">)</span>, <span title="Int(16)" class="int">16</span><span class="delimiter">)</span>
              <a href="#136368" title="java.lang.StringBuilder">s</a>.<span title="(x$1: Int)java.lang.StringBuilder">appendCodePoint</span><span class="delimiter">(</span><a href="#136420" title="Int">codePoint</a><span class="delimiter">)</span>
            <span class="keyword">case</span> <span title="java.lang.StringBuilder">_</span> =&gt; <a href="#136368" title="java.lang.StringBuilder">s</a>.<span title="(x$1: Char)java.lang.StringBuilder">append</span><span class="delimiter">(</span><span title="Char(\'\\\\\')" class="char">'\\'</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#136368" title="java.lang.StringBuilder">s</a>.<span title="(x$1: Char)java.lang.StringBuilder">append</span><span class="delimiter">(</span><a href="#136369" title="Char">c</a><span class="delimiter">)</span>
        <a href="#136369" title="Char">c</a> = <a href="#136366" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124516" title="=&gt; Char">next</a>
      <span class="delimiter">}</span>
      <a href="#136368" title="java.lang.StringBuilder">s</a>.<span title="()java.lang.String">toString</span>
    <span class="delimiter">}</span>

    <a href="#124491" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124508" title="(x$1: Boolean)Unit">eofIsFailure</a> = <span title="Boolean(true)" class="keyword">true</span>
    <a href="#124491" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124514" title="=&gt; Unit">mark</a>
    <span class="keyword">var</span> <a title="Char" id="136364">c</a> = <a href="#124491" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124516" title="=&gt; Char">next</a>
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#136364" title="Char">c</a> <span title="(x: Char)Boolean">!=</span> <span title="Char(\'\\\&quot;\')" class="char">'&quot;'</span><span class="delimiter">)</span> <a href="#136365" title="()Unit" class="delimiter">{</a>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#136364" title="Char">c</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'\\\\\')" class="char">'\\'</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="String" id="136479">s</a> = <a href="#136363" title="(buf: net.liftweb.json.JsonParser.Buffer, base: String)String">unquote0</a><span class="delimiter">(</span><a href="#124491" title="net.liftweb.json.JsonParser.Buffer">buf</a>, <a href="#124491" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124517" title="=&gt; java.lang.String">substring</a><span class="delimiter">)</span>
        <a href="#124491" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124508" title="(x$1: Boolean)Unit">eofIsFailure</a> = <span title="Boolean(false)" class="keyword">false</span>
        <span title="Nothing" class="keyword">return</span> <a href="#136479" title="String">s</a>
      <span class="delimiter">}</span>
      <a href="#136364" title="Char">c</a> = <a href="#124491" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124516" title="=&gt; Char">next</a>
    <span class="delimiter">}</span>
    <a href="#124491" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124508" title="(x$1: Boolean)Unit">eofIsFailure</a> = <span title="Boolean(false)" class="keyword">false</span>
    <a href="#124491" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124517" title="=&gt; java.lang.String">substring</a>
  <span class="delimiter">}</span>

  <span class="comment">// FIXME fail fast to prevent infinite loop, see </span>
  <span class="comment">// http://www.exploringbinary.com/java-hangs-when-converting-2-2250738585072012e-308/</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.math.BigDecimal" id="54548">BrokenDouble</a> = <span title="(x: String)scala.math.BigDecimal">BigDecimal</span><span class="delimiter">(</span><span title="java.lang.String(&quot;2.2250738585072012e-308&quot;)" class="string">&quot;2.2250738585072012e-308&quot;</span><span class="delimiter">)</span>
  <span class="keyword">private</span><span class="delimiter">[</span>json<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(s: String)Double" id="54550">parseDouble</a><span class="delimiter">(</span><a title="String" id="124463">s</a>: <span title="String">String</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.math.BigDecimal" id="124466">d</a> = <span title="(x: String)scala.math.BigDecimal">BigDecimal</span><span class="delimiter">(</span><a href="#124463" title="String">s</a><span class="delimiter">)</span>
    <span title="Double" class="keyword">if</span> <span class="delimiter">(</span><a href="#124466" title="scala.math.BigDecimal">d</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#54548" title="=&gt; scala.math.BigDecimal">BrokenDouble</a><span class="delimiter">)</span> <span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Error parsing 2.2250738585072012e-308&quot;)" class="string">&quot;Error parsing 2.2250738585072012e-308&quot;</span><span class="delimiter">)</span>
    <span class="keyword">else</span> <a href="#124466" title="scala.math.BigDecimal">d</a>.<span title="()Double">doubleValue</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="net.liftweb.json.JsonParser.Parser =&gt; net.liftweb.json.package.JValue" id="54551">astParser</a> = <span class="delimiter">(</span>p: <a href="#54556" title="net.liftweb.json.JsonParser.Parser">Parser</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="net.liftweb.json.JsonParser.ValStack" id="135118">vals</a> = <span title="net.liftweb.json.JsonParser.ValStack" class="keyword">new</span> <a href="#54555" title="net.liftweb.json.JsonParser.ValStack">ValStack</a><span class="delimiter">(</span><a href="#135104" title="net.liftweb.json.JsonParser.Parser">p</a><span class="delimiter">)</span>
    <span class="keyword">var</span> <a title="net.liftweb.json.JsonParser.Token" id="135119">token</a>: <a href="#54507" title="net.liftweb.json.JsonParser.Token">Token</a> = <span title="Null(null)" class="keyword">null</span>
    <span class="keyword">var</span> <a title="Option[net.liftweb.json.package.JValue]" id="135120">root</a>: <span title="Option[net.liftweb.json.package.JValue]">Option</span><span class="delimiter">[</span>JValue<span class="delimiter">]</span> = <span title="object None">None</span>

    <span class="comment">// This is a slightly faster way to correct order of fields and arrays than using 'map'.</span>
    <span class="keyword">def</span> <a title="(v: net.liftweb.json.package.JValue)net.liftweb.json.package.JValue" id="135121">reverse</a><span class="delimiter">(</span><a title="net.liftweb.json.package.JValue" id="135146">v</a>: <a href="JsonAST.scala.html#48510" title="net.liftweb.json.package.JValue">JValue</a><span class="delimiter">)</span>: <a href="JsonAST.scala.html#48510" title="net.liftweb.json.package.JValue">JValue</a> = <a href="#135146" title="net.liftweb.json.package.JValue">v</a> <span title="net.liftweb.json.package.JValue" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="net.liftweb.json.JsonAST.JObject">JObject</span><span class="delimiter">(</span><a title="List[net.liftweb.json.JsonAST.JField]" id="135148">l</a><span class="delimiter">)</span> =&gt; <a href="JsonAST.scala.html#51392" title="(obj: List[net.liftweb.json.JsonAST.JField])net.liftweb.json.JsonAST.JObject">JObject</a><span class="delimiter">(</span><a href="#135148" title="List[net.liftweb.json.JsonAST.JField]">l</a>.<span title="(f: net.liftweb.json.JsonAST.JField =&gt; net.liftweb.json.package.JValue)(implicit bf: scala.collection.generic.CanBuildFrom[List[net.liftweb.json.JsonAST.JField],net.liftweb.json.package.JValue,List[net.liftweb.json.package.JValue]])List[net.liftweb.json.package.JValue]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,net.liftweb.json.package.JValue,List[net.liftweb.json.package.JValue]]" class="delimiter">(</span><a href="#135121" title="(v: net.liftweb.json.package.JValue)net.liftweb.json.package.JValue">reverse</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="List[net.liftweb.json.package.JField]" class="delimiter">[</span><span title="List[net.liftweb.json.package.JField]">List</span><span class="delimiter">[</span>JField<span class="delimiter">]</span><span class="delimiter">]</span>.<span title="=&gt; List[net.liftweb.json.package.JField]">reverse</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="net.liftweb.json.JsonAST.JArray">JArray</span><span class="delimiter">(</span><a title="List[net.liftweb.json.JsonAST.JValue]" id="135201">l</a><span class="delimiter">)</span> =&gt; <a href="JsonAST.scala.html#51423" title="(arr: List[net.liftweb.json.JsonAST.JValue])net.liftweb.json.JsonAST.JArray">JArray</a><span class="delimiter">(</span><a href="#135201" title="List[net.liftweb.json.JsonAST.JValue]">l</a>.<span title="(f: net.liftweb.json.JsonAST.JValue =&gt; net.liftweb.json.package.JValue)(implicit bf: scala.collection.generic.CanBuildFrom[List[net.liftweb.json.JsonAST.JValue],net.liftweb.json.package.JValue,List[net.liftweb.json.package.JValue]])List[net.liftweb.json.package.JValue]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,net.liftweb.json.package.JValue,List[net.liftweb.json.package.JValue]]" class="delimiter">(</span><a href="#135121" title="(v: net.liftweb.json.package.JValue)net.liftweb.json.package.JValue">reverse</a><span class="delimiter">)</span>.<span title="=&gt; List[net.liftweb.json.package.JValue]">reverse</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="net.liftweb.json.JsonAST.JField">JField</span><span class="delimiter">(</span><a title="String" id="135256">name</a>, <a title="net.liftweb.json.JsonAST.JValue" id="135257">value</a><span class="delimiter">)</span> =&gt; <a href="JsonAST.scala.html#50050" title="(name: String, value: net.liftweb.json.JsonAST.JValue)net.liftweb.json.JsonAST.JField">JField</a><span class="delimiter">(</span><a href="#135256" title="String">name</a>, <a href="#135121" title="(v: net.liftweb.json.package.JValue)net.liftweb.json.package.JValue">reverse</a><span class="delimiter">(</span><a href="#135257" title="net.liftweb.json.JsonAST.JValue">value</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="net.liftweb.json.package.JValue" id="135266">x</a> =&gt; <a href="#135266" title="net.liftweb.json.package.JValue">x</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(v: net.liftweb.json.package.JValue)Unit" id="135122">closeBlock</a><span class="delimiter">(</span><a title="net.liftweb.json.package.JValue" id="135267">v</a>: <a href="JsonAST.scala.html#48510" title="net.liftweb.json.package.JValue">JValue</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#135118" title="net.liftweb.json.JsonParser.ValStack">vals</a>.<a href="#135143" title="=&gt; Option[net.liftweb.json.package.JValue]">peekOption</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="net.liftweb.json.package.JField" id="135381">f</a>: <a href="JsonAST.scala.html#48527" title="net.liftweb.json.package.JField">JField</a><span class="delimiter">)</span> =&gt;
          <span class="keyword">val</span> <a title="net.liftweb.json.package.JField" id="135382">field</a> = <a href="#135118" title="net.liftweb.json.JsonParser.ValStack">vals</a>.<a href="#135130" title="(expectedType: Class[net.liftweb.json.package.JField])net.liftweb.json.package.JField">pop</a><span class="delimiter">(</span>classOf<span title="java.lang.Class[net.liftweb.json.package.JField](classOf[net.liftweb.json.JsonAST$$JField])" class="delimiter">[</span>JField<span class="delimiter">]</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="net.liftweb.json.JsonAST.JField" id="135383">newField</a> = <a href="JsonAST.scala.html#50050" title="(name: String, value: net.liftweb.json.JsonAST.JValue)net.liftweb.json.JsonAST.JField">JField</a><span class="delimiter">(</span><a href="#135382" title="net.liftweb.json.package.JField">field</a>.<a href="JsonAST.scala.html#50112" title="=&gt; String">name</a>, <a href="#135267" title="net.liftweb.json.package.JValue">v</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="net.liftweb.json.package.JObject" id="135384">obj</a> = <a href="#135118" title="net.liftweb.json.JsonParser.ValStack">vals</a>.<a href="#135134" title="(expectedType: Class[net.liftweb.json.package.JObject])net.liftweb.json.package.JObject">peek</a><span class="delimiter">(</span>classOf<span title="java.lang.Class[net.liftweb.json.package.JObject](classOf[net.liftweb.json.JsonAST$$JObject])" class="delimiter">[</span>JObject<span class="delimiter">]</span><span class="delimiter">)</span>
          <a href="#135118" title="net.liftweb.json.JsonParser.ValStack">vals</a>.<a href="#135137" title="(newTop: net.liftweb.json.package.JValue)net.liftweb.json.package.JValue">replace</a><span title="Unit" class="delimiter">(</span><a href="JsonAST.scala.html#51392" title="(obj: List[net.liftweb.json.JsonAST.JField])net.liftweb.json.JsonAST.JObject">JObject</a><span class="delimiter">(</span><a href="#135383" title="net.liftweb.json.JsonAST.JField">newField</a> <a href="#135438" title="(x: net.liftweb.json.JsonAST.JField)List[net.liftweb.json.JsonAST.JField]">::</a> <a href="#135384" title="net.liftweb.json.package.JObject">obj</a>.<a href="JsonAST.scala.html#50169" title="=&gt; List[net.liftweb.json.JsonAST.JField]">obj</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="net.liftweb.json.package.JObject" id="135445">o</a>: <a href="JsonAST.scala.html#48530" title="net.liftweb.json.package.JObject">JObject</a><span class="delimiter">)</span> =&gt; <a href="#135267" title="net.liftweb.json.package.JValue">v</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a title="Unit" id="135446">x</a>: <a href="JsonAST.scala.html#48527" title="net.liftweb.json.package.JField">JField</a> =&gt; <a href="#135118" title="net.liftweb.json.JsonParser.ValStack">vals</a>.<a href="#135137" title="(newTop: net.liftweb.json.package.JValue)net.liftweb.json.package.JValue">replace</a><span title="Unit" class="delimiter">(</span><a href="JsonAST.scala.html#51392" title="(obj: List[net.liftweb.json.JsonAST.JField])net.liftweb.json.JsonAST.JObject">JObject</a><span class="delimiter">(</span><a href="#135446" title="net.liftweb.json.package.JField">x</a> <a href="#135452" title="(x: net.liftweb.json.JsonAST.JField)List[net.liftweb.json.JsonAST.JField]">::</a> <a href="#135445" title="net.liftweb.json.package.JObject">o</a>.<a href="JsonAST.scala.html#50169" title="=&gt; List[net.liftweb.json.JsonAST.JField]">obj</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Nothing">_</span> =&gt; <a href="#135104" title="net.liftweb.json.JsonParser.Parser">p</a>.<a href="#135111" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="java.lang.String(&quot;expected field but got &quot;)" class="string">&quot;expected field but got &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#135267" title="net.liftweb.json.package.JValue">v</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="net.liftweb.json.package.JArray" id="135625">a</a>: <a href="JsonAST.scala.html#48533" title="net.liftweb.json.package.JArray">JArray</a><span class="delimiter">)</span> =&gt; <a href="#135118" title="net.liftweb.json.JsonParser.ValStack">vals</a>.<a href="#135137" title="(newTop: net.liftweb.json.package.JValue)net.liftweb.json.package.JValue">replace</a><span title="Unit" class="delimiter">(</span><a href="JsonAST.scala.html#51423" title="(arr: List[net.liftweb.json.JsonAST.JValue])net.liftweb.json.JsonAST.JArray">JArray</a><span class="delimiter">(</span><a href="#135267" title="net.liftweb.json.package.JValue">v</a> <a href="#135631" title="(x: net.liftweb.json.JsonAST.JValue)List[net.liftweb.json.JsonAST.JValue]">::</a> <a href="#135625" title="net.liftweb.json.package.JArray">a</a>.<a href="JsonAST.scala.html#51425" title="=&gt; List[net.liftweb.json.JsonAST.JValue]">arr</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Nothing">Some</span><span class="delimiter">(</span><a title="net.liftweb.json.package.JValue" id="135638">x</a><span class="delimiter">)</span> =&gt; <a href="#135104" title="net.liftweb.json.JsonParser.Parser">p</a>.<a href="#135111" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="java.lang.String(&quot;expected field, array or object but got &quot;)" class="string">&quot;expected field, array or object but got &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#135638" title="net.liftweb.json.package.JValue">x</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Unit">None</span> =&gt; <a href="#135120" title="Option[net.liftweb.json.package.JValue]">root</a> = <span title="(x: net.liftweb.json.package.JValue)Some[net.liftweb.json.package.JValue]">Some</span><span class="delimiter">(</span><a href="#135121" title="(v: net.liftweb.json.package.JValue)net.liftweb.json.package.JValue">reverse</a><span class="delimiter">(</span><a href="#135267" title="net.liftweb.json.package.JValue">v</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(v: net.liftweb.json.package.JValue)Unit" id="135123">newValue</a><span class="delimiter">(</span><a title="net.liftweb.json.package.JValue" id="135642">v</a>: <a href="JsonAST.scala.html#48510" title="net.liftweb.json.package.JValue">JValue</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#135118" title="net.liftweb.json.JsonParser.ValStack">vals</a>.<a href="#135134" title="(expectedType: Class[net.liftweb.json.package.JValue])net.liftweb.json.package.JValue">peek</a><span class="delimiter">(</span>classOf<span title="java.lang.Class[net.liftweb.json.package.JValue](classOf[net.liftweb.json.JsonAST$$JValue])" class="delimiter">[</span>JValue<span class="delimiter">]</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Unit" id="135646">f</a>: <a href="JsonAST.scala.html#48527" title="net.liftweb.json.package.JField">JField</a> =&gt;
          <a href="#135118" title="net.liftweb.json.JsonParser.ValStack">vals</a>.<a href="#135130" title="(expectedType: Class[net.liftweb.json.package.JField])net.liftweb.json.package.JField">pop</a><span class="delimiter">(</span>classOf<span title="java.lang.Class[net.liftweb.json.package.JField](classOf[net.liftweb.json.JsonAST$$JField])" class="delimiter">[</span>JField<span class="delimiter">]</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="net.liftweb.json.JsonAST.JField" id="135647">newField</a> = <a href="JsonAST.scala.html#50050" title="(name: String, value: net.liftweb.json.JsonAST.JValue)net.liftweb.json.JsonAST.JField">JField</a><span class="delimiter">(</span><a href="#135646" title="net.liftweb.json.package.JField">f</a>.<a href="JsonAST.scala.html#50112" title="=&gt; String">name</a>, <a href="#135642" title="net.liftweb.json.package.JValue">v</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="net.liftweb.json.package.JObject" id="135648">obj</a> = <a href="#135118" title="net.liftweb.json.JsonParser.ValStack">vals</a>.<a href="#135134" title="(expectedType: Class[net.liftweb.json.package.JObject])net.liftweb.json.package.JObject">peek</a><span class="delimiter">(</span>classOf<span title="java.lang.Class[net.liftweb.json.package.JObject](classOf[net.liftweb.json.JsonAST$$JObject])" class="delimiter">[</span>JObject<span class="delimiter">]</span><span class="delimiter">)</span>
          <a href="#135118" title="net.liftweb.json.JsonParser.ValStack">vals</a>.<a href="#135137" title="(newTop: net.liftweb.json.package.JValue)net.liftweb.json.package.JValue">replace</a><span title="Unit" class="delimiter">(</span><a href="JsonAST.scala.html#51392" title="(obj: List[net.liftweb.json.JsonAST.JField])net.liftweb.json.JsonAST.JObject">JObject</a><span class="delimiter">(</span><a href="#135647" title="net.liftweb.json.JsonAST.JField">newField</a> <a href="#135668" title="(x: net.liftweb.json.JsonAST.JField)List[net.liftweb.json.JsonAST.JField]">::</a> <a href="#135648" title="net.liftweb.json.package.JObject">obj</a>.<a href="JsonAST.scala.html#50169" title="=&gt; List[net.liftweb.json.JsonAST.JField]">obj</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="Unit" id="135674">a</a>: <a href="JsonAST.scala.html#48533" title="net.liftweb.json.package.JArray">JArray</a> =&gt; <a href="#135118" title="net.liftweb.json.JsonParser.ValStack">vals</a>.<a href="#135137" title="(newTop: net.liftweb.json.package.JValue)net.liftweb.json.package.JValue">replace</a><span title="Unit" class="delimiter">(</span><a href="JsonAST.scala.html#51423" title="(arr: List[net.liftweb.json.JsonAST.JValue])net.liftweb.json.JsonAST.JArray">JArray</a><span class="delimiter">(</span><a href="#135642" title="net.liftweb.json.package.JValue">v</a> <a href="#135680" title="(x: net.liftweb.json.JsonAST.JValue)List[net.liftweb.json.JsonAST.JValue]">::</a> <a href="#135674" title="net.liftweb.json.package.JArray">a</a>.<a href="JsonAST.scala.html#51425" title="=&gt; List[net.liftweb.json.JsonAST.JValue]">arr</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Nothing">_</span> =&gt; <a href="#135104" title="net.liftweb.json.JsonParser.Parser">p</a>.<a href="#135111" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="java.lang.String(&quot;expected field or array&quot;)" class="string">&quot;expected field or array&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <a href="#135124" title="Unit" class="keyword">do</a> <span class="delimiter">{</span>
      <a href="#135119" title="net.liftweb.json.JsonParser.Token">token</a> = <a href="#135104" title="net.liftweb.json.JsonParser.Parser">p</a>.<a href="#135112" title="=&gt; net.liftweb.json.JsonParser.Token">nextToken</a>
      <a href="#135119" title="net.liftweb.json.JsonParser.Token">token</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="#135898" title="Unit">OpenObj</a>          =&gt; <a href="#135118" title="net.liftweb.json.JsonParser.ValStack">vals</a>.<a href="#135133" title="(v: net.liftweb.json.package.JValue)Unit">push</a><span class="delimiter">(</span><a href="JsonAST.scala.html#51392" title="(obj: List[net.liftweb.json.JsonAST.JField])net.liftweb.json.JsonAST.JObject">JObject</a><span class="delimiter">(</span><span title="object Nil">Nil</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Unit">FieldStart</span><span class="delimiter">(</span><a title="String" id="135725">name</a><span class="delimiter">)</span> =&gt; <a href="#135118" title="net.liftweb.json.JsonParser.ValStack">vals</a>.<a href="#135133" title="(v: net.liftweb.json.package.JValue)Unit">push</a><span class="delimiter">(</span><a href="JsonAST.scala.html#50050" title="(name: String, value: net.liftweb.json.JsonAST.JValue)net.liftweb.json.JsonAST.JField">JField</a><span class="delimiter">(</span><a href="#135725" title="String">name</a>, <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Unit">StringVal</span><span class="delimiter">(</span><a title="String" id="135761">x</a><span class="delimiter">)</span>     =&gt; <a href="#135123" title="(v: net.liftweb.json.package.JValue)Unit">newValue</a><span class="delimiter">(</span><a href="JsonAST.scala.html#50133" title="(s: String)net.liftweb.json.JsonAST.JString">JString</a><span class="delimiter">(</span><a href="#135761" title="String">x</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Unit">IntVal</span><span class="delimiter">(</span><a title="BigInt" id="135791">x</a><span class="delimiter">)</span>        =&gt; <a href="#135123" title="(v: net.liftweb.json.package.JValue)Unit">newValue</a><span class="delimiter">(</span><a href="JsonAST.scala.html#51543" title="(num: BigInt)net.liftweb.json.JsonAST.JInt">JInt</a><span class="delimiter">(</span><a href="#135791" title="BigInt">x</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Unit">DoubleVal</span><span class="delimiter">(</span><a title="Double" id="135821">x</a><span class="delimiter">)</span>     =&gt; <a href="#135123" title="(v: net.liftweb.json.package.JValue)Unit">newValue</a><span class="delimiter">(</span><a href="JsonAST.scala.html#51514" title="(num: Double)net.liftweb.json.JsonAST.JDouble">JDouble</a><span class="delimiter">(</span><a href="#135821" title="Double">x</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Unit">BoolVal</span><span class="delimiter">(</span><a title="Boolean" id="135851">x</a><span class="delimiter">)</span>       =&gt; <a href="#135123" title="(v: net.liftweb.json.package.JValue)Unit">newValue</a><span class="delimiter">(</span><a href="JsonAST.scala.html#51495" title="(value: Boolean)net.liftweb.json.JsonAST.JBool">JBool</a><span class="delimiter">(</span><a href="#135851" title="Boolean">x</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="#136059" title="Unit">NullVal</a>          =&gt; <a href="#135123" title="(v: net.liftweb.json.package.JValue)Unit">newValue</a><span class="delimiter">(</span><a href="package.scala.html#15382" title="=&gt; net.liftweb.json.JsonAST.JNull.type">JNull</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="#135910" title="Unit">CloseObj</a>         =&gt; <a href="#135122" title="(v: net.liftweb.json.package.JValue)Unit">closeBlock</a><span class="delimiter">(</span><a href="#135118" title="net.liftweb.json.JsonParser.ValStack">vals</a>.<a href="#135130" title="(expectedType: Class[net.liftweb.json.package.JValue])net.liftweb.json.package.JValue">pop</a><span class="delimiter">(</span>classOf<span title="java.lang.Class[net.liftweb.json.package.JValue](classOf[net.liftweb.json.JsonAST$$JValue])" class="delimiter">[</span>JValue<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="#136071" title="Unit">OpenArr</a>          =&gt; <a href="#135118" title="net.liftweb.json.JsonParser.ValStack">vals</a>.<a href="#135133" title="(v: net.liftweb.json.package.JValue)Unit">push</a><span class="delimiter">(</span><a href="JsonAST.scala.html#51423" title="(arr: List[net.liftweb.json.JsonAST.JValue])net.liftweb.json.JsonAST.JArray">JArray</a><span class="delimiter">(</span><span title="object Nil">Nil</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="#136083" title="Unit">CloseArr</a>         =&gt; <a href="#135122" title="(v: net.liftweb.json.package.JValue)Unit">closeBlock</a><span class="delimiter">(</span><a href="#135118" title="net.liftweb.json.JsonParser.ValStack">vals</a>.<a href="#135130" title="(expectedType: Class[net.liftweb.json.package.JArray])net.liftweb.json.package.JArray">pop</a><span class="delimiter">(</span>classOf<span title="java.lang.Class[net.liftweb.json.package.JArray](classOf[net.liftweb.json.JsonAST$$JArray])" class="delimiter">[</span>JArray<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="#135947" title="Unit">End</a>              =&gt;
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">while</span> <span class="delimiter">(</span><a href="#135119" title="net.liftweb.json.JsonParser.Token">token</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#135947" title="object net.liftweb.json.JsonParser.End">End</a><span class="delimiter">)</span>

    <a href="#135120" title="Option[net.liftweb.json.package.JValue]">root</a> <span title="(default: =&gt; net.liftweb.json.package.JValue)net.liftweb.json.package.JValue">getOrElse</span> <a href="package.scala.html#15380" title="=&gt; net.liftweb.json.JsonAST.JNothing.type">JNothing</a>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Char" id="54553">EOF</a> = <span class="delimiter">(</span>-<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Char" class="delimiter">[</span><span title="Char">Char</span><span class="delimiter">]</span>

  <span class="keyword">private</span> <span class="keyword">class</span> <a title="class ValStack extends java.lang.Object with ScalaObject" id="54555">ValStack</a><a href="#54555" title="ScalaObject" class="delimiter">(</a><a title="net.liftweb.json.JsonParser.Parser" id="135144">parser</a>: <a href="#54556" title="net.liftweb.json.JsonParser.Parser">Parser</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">import</span> java.util.LinkedList
    <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">val</span> <a title="java.util.LinkedList[net.liftweb.json.package.JValue]" id="135129">stack</a> = <span title="java.util.LinkedList[net.liftweb.json.package.JValue]" class="keyword">new</span> <span title="java.util.LinkedList[net.liftweb.json.package.JValue]">LinkedList</span><span class="delimiter">[</span>JValue<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="[A &lt;: net.liftweb.json.package.JValue](expectedType: Class[A])A" id="135130">pop</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: net.liftweb.json.package.JValue" id="135132">A</a> &lt;: JValue<span class="delimiter">]</span><span class="delimiter">(</span><a title="Class[A]" id="135385">expectedType</a>: <span title="Class[A]">Class</span><span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#135140" title="(x: net.liftweb.json.package.JValue, expectedType: Class[A])A">convert</a><span class="delimiter">(</span><a href="#135129" title="java.util.LinkedList[net.liftweb.json.package.JValue]">stack</a>.<span title="()net.liftweb.json.package.JValue">poll</span>, <a href="#135385" title="Class[A]">expectedType</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(v: net.liftweb.json.package.JValue)Unit" id="135133">push</a><span class="delimiter">(</span><a title="net.liftweb.json.package.JValue" id="135689">v</a>: <a href="JsonAST.scala.html#48510" title="net.liftweb.json.package.JValue">JValue</a><span class="delimiter">)</span> = <a href="#135129" title="java.util.LinkedList[net.liftweb.json.package.JValue]">stack</a>.<span title="(x$1: net.liftweb.json.package.JValue)Unit">addFirst</span><span class="delimiter">(</span><a href="#135689" title="net.liftweb.json.package.JValue">v</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="[A &lt;: net.liftweb.json.package.JValue](expectedType: Class[A])A" id="135134">peek</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: net.liftweb.json.package.JValue" id="135136">A</a> &lt;: JValue<span class="delimiter">]</span><span class="delimiter">(</span><a title="Class[A]" id="135410">expectedType</a>: <span title="Class[A]">Class</span><span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#135140" title="(x: net.liftweb.json.package.JValue, expectedType: Class[A])A">convert</a><span class="delimiter">(</span><a href="#135129" title="java.util.LinkedList[net.liftweb.json.package.JValue]">stack</a>.<span title="()net.liftweb.json.package.JValue">peek</span>, <a href="#135410" title="Class[A]">expectedType</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="[A &lt;: net.liftweb.json.package.JValue](newTop: net.liftweb.json.package.JValue)net.liftweb.json.package.JValue" id="135137">replace</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: net.liftweb.json.package.JValue" id="135139">A</a> &lt;: JValue<span class="delimiter">]</span><span class="delimiter">(</span><a title="net.liftweb.json.package.JValue" id="135422">newTop</a>: <a href="JsonAST.scala.html#48510" title="net.liftweb.json.package.JValue">JValue</a><span class="delimiter">)</span> = <a href="#135129" title="java.util.LinkedList[net.liftweb.json.package.JValue]">stack</a>.<span title="(x$1: Int, x$2: net.liftweb.json.package.JValue)net.liftweb.json.package.JValue">set</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#135422" title="net.liftweb.json.package.JValue">newTop</a><span class="delimiter">)</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="[A &lt;: net.liftweb.json.package.JValue](x: net.liftweb.json.package.JValue, expectedType: Class[A])A" id="135140">convert</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: net.liftweb.json.package.JValue" id="135142">A</a> &lt;: JValue<span class="delimiter">]</span><span class="delimiter">(</span><a title="net.liftweb.json.package.JValue" id="135388">x</a>: <a href="JsonAST.scala.html#48510" title="net.liftweb.json.package.JValue">JValue</a>, <a title="Class[A]" id="135389">expectedType</a>: <span title="Class[A]">Class</span><span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#135142" title="A">A</a> = <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#135388" title="net.liftweb.json.package.JValue">x</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#135144" title="net.liftweb.json.JsonParser.Parser">parser</a>.<a href="#135111" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="java.lang.String(&quot;expected object or array&quot;)" class="string">&quot;expected object or array&quot;</span><span class="delimiter">)</span>
      <span class="keyword">try</span> <span class="delimiter">{</span> <a href="#135388" title="net.liftweb.json.package.JValue">x</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="A" class="delimiter">[</span><a href="#135142" title="A">A</a><span class="delimiter">]</span> <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span> <span class="keyword">case</span> <span title="Nothing">_</span>: <span title="ClassCastException">ClassCastException</span> =&gt; <a href="#135144" title="net.liftweb.json.JsonParser.Parser">parser</a>.<a href="#135111" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="java.lang.String(&quot;unexpected &quot;)" class="string">&quot;unexpected &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#135388" title="net.liftweb.json.package.JValue">x</a><span class="delimiter">)</span> <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="=&gt; Option[net.liftweb.json.package.JValue]" id="135143">peekOption</a> = <span title="Option[net.liftweb.json.package.JValue]" class="keyword">if</span> <span class="delimiter">(</span><a href="#135129" title="java.util.LinkedList[net.liftweb.json.package.JValue]">stack</a> <span title="()Boolean">isEmpty</span><span class="delimiter">)</span> <span title="object None">None</span> <span class="keyword">else</span> <span title="(x: net.liftweb.json.package.JValue)Some[net.liftweb.json.package.JValue]">Some</span><span class="delimiter">(</span><a href="#135129" title="java.util.LinkedList[net.liftweb.json.package.JValue]">stack</a>.<span title="()net.liftweb.json.package.JValue">peek</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">class</span> <a title="class Parser extends java.lang.Object with ScalaObject" id="54556">Parser</a><a href="#54556" title="ScalaObject" class="delimiter">(</a><a title="net.liftweb.json.JsonParser.Buffer" id="136281">buf</a>: <a href="#54557" title="net.liftweb.json.JsonParser.Buffer">Buffer</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">import</span> java.util.LinkedList

    <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">val</span> <a title="java.util.LinkedList[Parser.this.BlockMode]" id="135109">blocks</a> = <span title="java.util.LinkedList[Parser.this.BlockMode]" class="keyword">new</span> <span title="java.util.LinkedList[Parser.this.BlockMode]">LinkedList</span><span class="delimiter">[</span>BlockMode<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">var</span> <a title="Boolean" id="135110">fieldNameMode</a> = <span title="Boolean(true)" class="keyword">true</span>

    <span class="keyword">def</span> <a title="(msg: String)Nothing" id="135111">fail</a><span class="delimiter">(</span><a title="String" id="135458">msg</a>: <span title="String">String</span><span class="delimiter">)</span> = <span title="Nothing" class="keyword">throw</span> <span title="net.liftweb.json.JsonParser.ParseException" class="keyword">new</span> <a href="#54506" title="net.liftweb.json.JsonParser.ParseException">ParseException</a><span class="delimiter">(</span><a href="#135458" title="String">msg</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012Near: &quot;)" class="string">&quot;\nNear: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#136281" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124518" title="=&gt; java.lang.String">near</a>, <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>

    <span class="comment">/** Parse next Token from stream.
     */</span>
    <span class="keyword">def</span> <a title="=&gt; net.liftweb.json.JsonParser.Token" id="135112">nextToken</a>: <a href="#54507" title="net.liftweb.json.JsonParser.Token">Token</a> = <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(c: Char)Boolean" id="136816">isDelimiter</a><span class="delimiter">(</span><a title="Char" id="136821">c</a>: <span title="Char">Char</span><span class="delimiter">)</span> = <a href="#136821" title="Char">c</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\' \')" class="char">' '</span> <span title="(x: Boolean)Boolean">||</span> <a href="#136821" title="Char">c</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'\\n\')" class="char">'\n'</span> <span title="(x: Boolean)Boolean">||</span> <a href="#136821" title="Char">c</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\',\')" class="char">','</span> <span title="(x: Boolean)Boolean">||</span> <a href="#136821" title="Char">c</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'\\r\')" class="char">'\r'</span> <span title="(x: Boolean)Boolean">||</span> <a href="#136821" title="Char">c</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'\\t\')" class="char">'\t'</span> <span title="(x: Boolean)Boolean">||</span> <a href="#136821" title="Char">c</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'}\')" class="char">'}'</span> <span title="(x: Boolean)Boolean">||</span> <a href="#136821" title="Char">c</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\']\')" class="char">']'</span>

      <span class="keyword">def</span> <a title="=&gt; String" id="136817">parseFieldName</a>: <span title="String">String</span> = <span class="delimiter">{</span>
        <a href="#136281" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124514" title="=&gt; Unit">mark</a>
        <span class="keyword">var</span> <a title="Char" id="136850">c</a> = <a href="#136281" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124516" title="=&gt; Char">next</a>
        <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#136850" title="Char">c</a> <span title="(x: Char)Boolean">!=</span> <a href="#54553" title="=&gt; Char">EOF</a><span class="delimiter">)</span> <a href="#136851" title="()Unit" class="delimiter">{</a>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#136850" title="Char">c</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'\\\&quot;\')" class="char">'&quot;'</span><span class="delimiter">)</span> <span title="Nothing" class="keyword">return</span> <a href="#136281" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124517" title="=&gt; java.lang.String">substring</a>
          <a href="#136850" title="Char">c</a> = <a href="#136281" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124516" title="=&gt; Char">next</a>
        <span class="delimiter">}</span>
        <a href="#135111" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="java.lang.String(&quot;expected string end&quot;)" class="string">&quot;expected string end&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">def</span> <a title="=&gt; String" id="136818">parseString</a>: <span title="String">String</span> = 
        <span class="keyword">try</span> <span class="delimiter">{</span>
          <a href="#54547" title="(buf: net.liftweb.json.JsonParser.Buffer)String">unquote</a><span class="delimiter">(</span><a href="#136281" title="net.liftweb.json.JsonParser.Buffer">buf</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a title="Nothing" id="136868">p</a>: <a href="#54506" title="net.liftweb.json.JsonParser.ParseException">ParseException</a> =&gt; <span title="Nothing" class="keyword">throw</span> <a href="#136868" title="net.liftweb.json.JsonParser.ParseException">p</a>
          <span class="keyword">case</span> <span title="Nothing">_</span> =&gt; <a href="#135111" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="java.lang.String(&quot;unexpected string end&quot;)" class="string">&quot;unexpected string end&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

      <span class="keyword">def</span> <a title="(first: Char)Product with Serializable with net.liftweb.json.JsonParser.Token" id="136819">parseValue</a><span class="delimiter">(</span><a title="Char" id="136869">first</a>: <span title="Char">Char</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
        <span class="keyword">var</span> <a title="Boolean" id="136870">wasInt</a> = <span title="Boolean(true)" class="keyword">true</span>
        <span class="keyword">var</span> <a title="Boolean" id="136871">doubleVal</a> = <span title="Boolean(false)" class="keyword">false</span>
        <span class="keyword">val</span> <a title="StringBuilder" id="136872">s</a> = <span title="()StringBuilder" class="keyword">new</span> <span title="StringBuilder">StringBuilder</span>
        <a href="#136872" title="StringBuilder">s</a>.<span title="(x: Char)StringBuilder">append</span><span class="delimiter">(</span><a href="#136869" title="Char">first</a><span class="delimiter">)</span>
        <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#136870" title="Boolean">wasInt</a><span class="delimiter">)</span> <a href="#136874" title="()Unit" class="delimiter">{</a>
          <span class="keyword">val</span> <a title="Char" id="136881">c</a> = <a href="#136281" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124516" title="=&gt; Char">next</a>
          <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#136881" title="Char">c</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'.\')" class="char">'.'</span> <span title="(x: Boolean)Boolean">||</span> <a href="#136881" title="Char">c</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'e\')" class="char">'e'</span> <span title="(x: Boolean)Boolean">||</span> <a href="#136881" title="Char">c</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'E\')" class="char">'E'</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#136871" title="Boolean">doubleVal</a> = <span title="Boolean(true)" class="keyword">true</span>
            <a href="#136872" title="StringBuilder">s</a>.<span title="(x: Char)StringBuilder">append</span><span class="delimiter">(</span><a href="#136881" title="Char">c</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><span class="delimiter">(</span><span title="object java.lang.Character">Character</span>.<span title="(x$1: Char)Boolean">isDigit</span><span class="delimiter">(</span><a href="#136881" title="Char">c</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <a href="#136881" title="Char">c</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'.\')" class="char">'.'</span> <span title="(x: Boolean)Boolean">||</span> <a href="#136881" title="Char">c</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'e\')" class="char">'e'</span> <span title="(x: Boolean)Boolean">||</span> <a href="#136881" title="Char">c</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'E\')" class="char">'E'</span> <span title="(x: Boolean)Boolean">||</span> <a href="#136881" title="Char">c</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'-\')" class="char">'-'</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#136870" title="Boolean">wasInt</a> = <span title="Boolean(false)" class="keyword">false</span>
            <a href="#136281" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124515" title="=&gt; Unit">back</a>
          <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#136872" title="StringBuilder">s</a>.<span title="(x: Char)StringBuilder">append</span><span class="delimiter">(</span><a href="#136881" title="Char">c</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">val</span> <a title="java.lang.String" id="136873">value</a> = <a href="#136872" title="StringBuilder">s</a>.<span title="()java.lang.String">toString</span>
        <span title="&lt;none&gt; extends Product with Serializable with net.liftweb.json.JsonParser.Token" class="keyword">if</span> <span class="delimiter">(</span><a href="#136871" title="Boolean">doubleVal</a><span class="delimiter">)</span> <a href="#137562" title="(value: Double)net.liftweb.json.JsonParser.DoubleVal">DoubleVal</a><span class="delimiter">(</span><a href="#54550" title="(s: String)Double">parseDouble</a><span class="delimiter">(</span><a href="#136873" title="java.lang.String">value</a><span class="delimiter">)</span><span class="delimiter">)</span> 
        <span class="keyword">else</span> <a href="#137566" title="(value: BigInt)net.liftweb.json.JsonParser.IntVal">IntVal</a><span class="delimiter">(</span><span title="(x: String)scala.math.BigInt">BigInt</span><span class="delimiter">(</span><a href="#136873" title="java.lang.String">value</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#136281" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124516" title="=&gt; Char">next</a> <a href="#136820" title="Unit" class="keyword">match</a> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a title="Nothing" id="137026">c</a> <span class="keyword">if</span> <a href="#54553" title="=&gt; Char">EOF</a> <span title="(x: Char)Boolean">==</span> <a href="#137026" title="Char">c</a> =&gt; 
            <a href="#136281" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124520" title="=&gt; Unit">automaticClose</a>
            <span title="Nothing" class="keyword">return</span> <a href="#135947" title="object net.liftweb.json.JsonParser.End">End</a>
          <span class="keyword">case</span> <span title="Nothing" class="char">'{'</span> =&gt;
            <a href="#135109" title="java.util.LinkedList[Parser.this.BlockMode]">blocks</a>.<span title="(x$1: Parser.this.BlockMode)Unit">addFirst</span><span class="delimiter">(</span><a href="#137142" title="object Parser.this.OBJECT">OBJECT</a><span class="delimiter">)</span>
            <a href="#135110" title="Boolean">fieldNameMode</a> = <span title="Boolean(true)" class="keyword">true</span>
            <span title="Nothing" class="keyword">return</span> <a href="#135898" title="object net.liftweb.json.JsonParser.OpenObj">OpenObj</a>
          <span class="keyword">case</span> <span title="Nothing" class="char">'}'</span> =&gt;
            <a href="#135109" title="java.util.LinkedList[Parser.this.BlockMode]">blocks</a>.<span title="()Parser.this.BlockMode">poll</span>
            <span title="Nothing" class="keyword">return</span> <a href="#135910" title="object net.liftweb.json.JsonParser.CloseObj">CloseObj</a>
          <span class="keyword">case</span> <span title="Nothing" class="char">'&quot;'</span> =&gt;
            <span title="Nothing" class="keyword">if</span> <span class="delimiter">(</span><a href="#135110" title="Boolean">fieldNameMode</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#135109" title="java.util.LinkedList[Parser.this.BlockMode]">blocks</a>.<span title="()Parser.this.BlockMode">peek</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#137142" title="object Parser.this.OBJECT">OBJECT</a><span class="delimiter">)</span> <span title="Nothing" class="keyword">return</span> <a href="#137574" title="(name: String)net.liftweb.json.JsonParser.FieldStart">FieldStart</a><span class="delimiter">(</span><a href="#136817" title="=&gt; String">parseFieldName</a><span class="delimiter">)</span>
            <span class="keyword">else</span> <span class="delimiter">{</span>
              <a href="#135110" title="Boolean">fieldNameMode</a> = <span title="Boolean(true)" class="keyword">true</span>
              <span title="Nothing" class="keyword">return</span> <a href="#137570" title="(value: String)net.liftweb.json.JsonParser.StringVal">StringVal</a><span class="delimiter">(</span><a href="#136818" title="=&gt; String">parseString</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="keyword">case</span> <span title="Nothing" class="char">'t'</span> =&gt;
            <a href="#135110" title="Boolean">fieldNameMode</a> = <span title="Boolean(true)" class="keyword">true</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#136281" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124516" title="=&gt; Char">next</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'r\')" class="char">'r'</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#136281" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124516" title="=&gt; Char">next</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'u\')" class="char">'u'</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#136281" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124516" title="=&gt; Char">next</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'e\')" class="char">'e'</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span title="Nothing" class="keyword">return</span> <a href="#137558" title="(value: Boolean)net.liftweb.json.JsonParser.BoolVal">BoolVal</a><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            <a href="#135111" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="java.lang.String(&quot;expected boolean&quot;)" class="string">&quot;expected boolean&quot;</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Nothing" class="char">'f'</span> =&gt;
            <a href="#135110" title="Boolean">fieldNameMode</a> = <span title="Boolean(true)" class="keyword">true</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#136281" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124516" title="=&gt; Char">next</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'a\')" class="char">'a'</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#136281" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124516" title="=&gt; Char">next</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'l\')" class="char">'l'</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#136281" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124516" title="=&gt; Char">next</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'s\')" class="char">'s'</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#136281" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124516" title="=&gt; Char">next</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'e\')" class="char">'e'</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span title="Nothing" class="keyword">return</span> <a href="#137558" title="(value: Boolean)net.liftweb.json.JsonParser.BoolVal">BoolVal</a><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            <a href="#135111" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="java.lang.String(&quot;expected boolean&quot;)" class="string">&quot;expected boolean&quot;</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Nothing" class="char">'n'</span> =&gt;
            <a href="#135110" title="Boolean">fieldNameMode</a> = <span title="Boolean(true)" class="keyword">true</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#136281" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124516" title="=&gt; Char">next</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'u\')" class="char">'u'</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#136281" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124516" title="=&gt; Char">next</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'l\')" class="char">'l'</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#136281" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124516" title="=&gt; Char">next</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'l\')" class="char">'l'</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span title="Nothing" class="keyword">return</span> <a href="#136059" title="object net.liftweb.json.JsonParser.NullVal">NullVal</a>
            <span class="delimiter">}</span>
            <a href="#135111" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="java.lang.String(&quot;expected null&quot;)" class="string">&quot;expected null&quot;</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Unit" class="char">':'</span> =&gt;
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#135109" title="java.util.LinkedList[Parser.this.BlockMode]">blocks</a>.<span title="()Parser.this.BlockMode">peek</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#137131" title="object Parser.this.ARRAY">ARRAY</a><span class="delimiter">)</span> <a href="#135111" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Colon in an invalid position&quot;)" class="string">&quot;Colon in an invalid position&quot;</span><span class="delimiter">)</span>
            <a href="#135110" title="Boolean">fieldNameMode</a> = <span title="Boolean(false)" class="keyword">false</span>
          <span class="keyword">case</span> <span title="Nothing" class="char">'['</span> =&gt;
            <a href="#135109" title="java.util.LinkedList[Parser.this.BlockMode]">blocks</a>.<span title="(x$1: Parser.this.BlockMode)Unit">addFirst</span><span class="delimiter">(</span><a href="#137131" title="object Parser.this.ARRAY">ARRAY</a><span class="delimiter">)</span>
            <span title="Nothing" class="keyword">return</span> <a href="#136071" title="object net.liftweb.json.JsonParser.OpenArr">OpenArr</a>
          <span class="keyword">case</span> <span title="Nothing" class="char">']'</span> =&gt;
            <a href="#135110" title="Boolean">fieldNameMode</a> = <span title="Boolean(true)" class="keyword">true</span>
            <a href="#135109" title="java.util.LinkedList[Parser.this.BlockMode]">blocks</a>.<span title="()Parser.this.BlockMode">poll</span>
            <span title="Nothing" class="keyword">return</span> <a href="#136083" title="object net.liftweb.json.JsonParser.CloseArr">CloseArr</a>
          <span class="keyword">case</span> <a title="Nothing" id="137110">c</a> <span class="keyword">if</span> <span title="object java.lang.Character">Character</span>.<span title="(x$1: Char)Boolean">isDigit</span><span class="delimiter">(</span><a href="#137110" title="Char">c</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <a href="#137110" title="Char">c</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'-\')" class="char">'-'</span> =&gt;
            <a href="#135110" title="Boolean">fieldNameMode</a> = <span title="Boolean(true)" class="keyword">true</span>
            <span title="Nothing" class="keyword">return</span> <a href="#136819" title="(first: Char)Product with Serializable with net.liftweb.json.JsonParser.Token">parseValue</a><span class="delimiter">(</span><a href="#137110" title="Char">c</a><span class="delimiter">)</span>
          <span class="keyword">case</span> <a title="Unit" id="137119">c</a> <span class="keyword">if</span> <a href="#136816" title="(c: Char)Boolean">isDelimiter</a><span class="delimiter">(</span><a href="#137119" title="Char">c</a><span class="delimiter">)</span> =&gt;
          <span class="keyword">case</span> <a title="Nothing" id="137120">c</a> =&gt; <a href="#135111" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="java.lang.String(&quot;unknown token &quot;)" class="string">&quot;unknown token &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#137120" title="Char">c</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <a href="#136281" title="net.liftweb.json.JsonParser.Buffer">buf</a>.<a href="#124520" title="=&gt; Unit">automaticClose</a>
      <a href="#135947" title="object net.liftweb.json.JsonParser.End">End</a>
    <span class="delimiter">}</span>

    <span class="keyword">sealed</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class BlockMode extends java.lang.Object with ScalaObject" id="135113">BlockMode</a>
    case <span class="keyword">object</span> <a href="#137128" title="object Parser.this.ARRAY" id="137131">ARRAY</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#135113" title="Parser.this.BlockMode">BlockMode</a>
    case <span class="keyword">object</span> <a href="#137139" title="object Parser.this.OBJECT" id="137142">OBJECT</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#135113" title="Parser.this.BlockMode">BlockMode</a>
  <span class="delimiter">}</span>

  <span class="comment">/* Buffer used to parse JSON.
   * Buffer is divided to one or more segments (preallocated in Segments pool).
   */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>json<span class="delimiter">]</span> <span class="keyword">class</span> <a title="class Buffer extends java.lang.Object with ScalaObject" id="54557">Buffer</a><a href="#54557" title="ScalaObject" class="delimiter">(</a><a title="java.io.Reader" id="136098">in</a>: <span title="java.io.Reader">Reader</span>, <a title="Boolean" id="136099">closeAutomatically</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Int" id="124499">offset</a> = <span title="Int(0)" class="int">0</span>
    <span class="keyword">var</span> <a title="Int" id="124502">curMark</a> = -<span title="Int(-1)" class="int">1</span>
    <span class="keyword">var</span> <a title="Int" id="124505">curMarkSegment</a> = -<span title="Int(-1)" class="int">1</span>
    <span class="keyword">var</span> <a title="Boolean" id="124508">eofIsFailure</a> = <span title="Boolean(false)" class="keyword">false</span>
    <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">var</span> <a title="List[net.liftweb.json.JsonParser.Segment]" id="124510">segments</a>: <span title="List[net.liftweb.json.JsonParser.Segment]">List</span><span class="delimiter">[</span>Segment<span class="delimiter">]</span> = <span title="(xs: net.liftweb.json.JsonParser.Segment*)List[net.liftweb.json.JsonParser.Segment]">List</span><span class="delimiter">(</span><a href="#54558" title="object net.liftweb.json.JsonParser.Segments">Segments</a>.<a href="#135621" title="()net.liftweb.json.JsonParser.Segment">apply</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">var</span> <a title="Array[Char]" id="124511">segment</a>: <span title="Array[Char]">Array</span><span class="delimiter">[</span>Char<span class="delimiter">]</span> = <a href="#124510" title="List[net.liftweb.json.JsonParser.Segment]">segments</a>.<span title="=&gt; net.liftweb.json.JsonParser.Segment">head</span>.<a href="#136315" title="=&gt; Array[Char]">seg</a>
    <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">var</span> <a title="Int" id="124512">cur</a> = <span title="Int(0)" class="int">0</span> <span class="comment">// Pointer which points current parsing location</span>
    <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">var</span> <a title="Int" id="124513">curSegmentIdx</a> = <span title="Int(0)" class="int">0</span> <span class="comment">// Pointer which points current segment</span>

    <span class="keyword">def</span> <a title="=&gt; Unit" id="124514">mark</a> = <span class="delimiter">{</span> <a href="#124502" title="(x$1: Int)Unit">curMark</a> = <a href="#124512" title="Int">cur</a>; <a href="#124505" title="(x$1: Int)Unit">curMarkSegment</a> = <a href="#124513" title="Int">curSegmentIdx</a> <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="=&gt; Unit" id="124515">back</a> = <a href="#124512" title="Int">cur</a> = <a href="#124512" title="Int">cur</a><span title="(x: Int)Int">-</span><span title="Int(1)" class="int">1</span>

    <span class="keyword">def</span> <a title="=&gt; Char" id="124516">next</a>: <span title="Char">Char</span> = <span class="delimiter">{</span>
      <span title="Char" class="keyword">if</span> <span class="delimiter">(</span><a href="#124512" title="Int">cur</a> <span title="(x: Int)Boolean">==</span> <a href="#124499" title="=&gt; Int">offset</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#124521" title="=&gt; Int">read</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Char" class="keyword">if</span> <span class="delimiter">(</span><a href="#124508" title="=&gt; Boolean">eofIsFailure</a><span class="delimiter">)</span> <span title="Nothing" class="keyword">throw</span> <span title="net.liftweb.json.JsonParser.ParseException" class="keyword">new</span> <a href="#54506" title="net.liftweb.json.JsonParser.ParseException">ParseException</a><span class="delimiter">(</span><span title="java.lang.String(&quot;unexpected eof&quot;)" class="string">&quot;unexpected eof&quot;</span>, <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#54553" title="=&gt; Char">EOF</a>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Char" id="137361">c</a> = <a href="#124511" title="(i: Int)Char">segment</a><span class="delimiter">(</span><a href="#124512" title="Int">cur</a><span class="delimiter">)</span>
        <a href="#124512" title="Int">cur</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
        <a href="#137361" title="Char">c</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="=&gt; java.lang.String" id="124517">substring</a> = <span class="delimiter">{</span>
      <span title="java.lang.String" class="keyword">if</span> <span class="delimiter">(</span><a href="#124513" title="Int">curSegmentIdx</a> <span title="(x: Int)Boolean">==</span> <a href="#124505" title="=&gt; Int">curMarkSegment</a><span class="delimiter">)</span> <span title="(x$1: Array[Char], x$2: Int, x$3: Int)java.lang.String" class="keyword">new</span> <span title="java.lang.String">String</span><span class="delimiter">(</span><a href="#124511" title="Array[Char]">segment</a>, <a href="#124502" title="=&gt; Int">curMark</a>, <a href="#124512" title="Int">cur</a><span title="(x: Int)Int">-</span><a href="#124502" title="=&gt; Int">curMark</a><span title="(x: Int)Int">-</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      <span class="keyword">else</span> <span class="delimiter">{</span> <span class="comment">// slower path for case when string is in two or more segments</span>
        <span class="keyword">var</span> <a title="List[(Int, Int, Array[Char])]" id="136500">parts</a>: <span title="List[(Int, Int, Array[Char])]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>Int, Int, Array<span class="delimiter">[</span>Char<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">]</span> = <span title="object Nil">Nil</span>
        <span class="keyword">var</span> <a title="Int" id="136501">i</a> = <a href="#124513" title="Int">curSegmentIdx</a>
        <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#136501" title="Int">i</a> <span title="(x: Int)Boolean">&gt;=</span> <a href="#124505" title="=&gt; Int">curMarkSegment</a><span class="delimiter">)</span> <a href="#136505" title="()Unit" class="delimiter">{</a>
          <span class="keyword">val</span> <a title="Array[Char]" id="136511">s</a> = <a href="#124510" title="(n: Int)net.liftweb.json.JsonParser.Segment">segments</a><span class="delimiter">(</span><a href="#136501" title="Int">i</a><span class="delimiter">)</span>.<a href="#136315" title="=&gt; Array[Char]">seg</a>
          <span class="keyword">val</span> <a title="Int" id="136512">start</a> = <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#136501" title="Int">i</a> <span title="(x: Int)Boolean">==</span> <a href="#124505" title="=&gt; Int">curMarkSegment</a><span class="delimiter">)</span> <a href="#124502" title="=&gt; Int">curMark</a> <span class="keyword">else</span> <span title="Int(0)" class="int">0</span>
          <span class="keyword">val</span> <a title="Int" id="136513">end</a> = <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#136501" title="Int">i</a> <span title="(x: Int)Boolean">==</span> <a href="#124513" title="Int">curSegmentIdx</a><span class="delimiter">)</span> <a href="#124512" title="Int">cur</a> <span class="keyword">else</span> <a href="#136511" title="Array[Char]">s</a>.<span title="=&gt; Int">length</span><span title="(x: Int)Int">+</span><span title="Int(1)" class="int">1</span>
          <a href="#136500" title="List[(Int, Int, Array[Char])]">parts</a> = <span title="(_1: Int, _2: Int, _3: Array[Char])(Int, Int, Array[Char])" class="delimiter">(</span><a href="#136512" title="Int">start</a>, <a href="#136513" title="Int">end</a>, <a href="#136511" title="Array[Char]">s</a><span class="delimiter">)</span> <a href="#136536" title="(x: (Int, Int, Array[Char]))List[(Int, Int, Array[Char])]">::</a> <a href="#136500" title="List[(Int, Int, Array[Char])]">parts</a>
          <a href="#136501" title="Int">i</a> = <a href="#136501" title="Int">i</a><span title="(x: Int)Int">-</span><span title="Int(1)" class="int">1</span>
        <span class="delimiter">}</span>
        <span class="keyword">val</span> <a title="Int" id="136502">len</a> = <a href="#136500" title="List[(Int, Int, Array[Char])]">parts</a>.<span title="(f: (Int, Int, Array[Char]) =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[List[(Int, Int, Array[Char])],Int,List[Int]])List[Int]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,Int,List[Int]]" class="delimiter">(</span><a title="(Int, Int, Array[Char])" id="136578">p</a> =&gt; <a href="#136578" title="(Int, Int, Array[Char])">p</a>.<span title="=&gt; Int">_2</span> <span title="(x: Int)Int">-</span> <a href="#136578" title="(Int, Int, Array[Char])">p</a>.<span title="=&gt; Int">_1</span> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="(z: Int)(f: (Int, Int) =&gt; Int)Int">foldLeft</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#136640" title="Int">_</a> <span title="(x: Int)Int">+</span> <a href="#136641" title="Int">_</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Array[Char]" id="136503">chars</a> = <span title="Array[Char]" class="keyword">new</span> <span title="Array[Char]">Array</span><span class="delimiter">[</span>Char<span class="delimiter">]</span><span class="delimiter">(</span><a href="#136502" title="Int">len</a><span class="delimiter">)</span>
        <a href="#136501" title="Int">i</a> = <span title="Int(0)" class="int">0</span>
        <span class="keyword">var</span> <a title="Int" id="136504">pos</a> = <span title="Int(0)" class="int">0</span>

        <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#136501" title="Int">i</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#136500" title="List[(Int, Int, Array[Char])]">parts</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span> <a href="#136506" title="()Unit" class="delimiter">{</a>
          <span class="keyword">val</span> <a href="#136654" title="(Int, Int, Array[Char])" class="delimiter">(</a><a href="#136653" title="Int" id="136654">start</a>, <a href="#136653" title="Int" id="136655">end</a>, <a href="#136653" title="Array[Char]" id="136656">b</a><span class="delimiter">)</span> = <a href="#136500" title="(n: Int)(Int, Int, Array[Char])">parts</a><span title="(Int, Int, Array[Char]) @unchecked" class="delimiter">(</span><a href="#136501" title="Int">i</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Int" id="136657">partLen</a> = <a href="#136655" title="Int">end</a><span title="(x: Int)Int">-</span><a href="#136654" title="Int">start</a><span title="(x: Int)Int">-</span><span title="Int(1)" class="int">1</span>
          <span title="object java.lang.System">System</span>.<span title="(x$1: Any, x$2: Int, x$3: Any, x$4: Int, x$5: Int)Unit">arraycopy</span><span class="delimiter">(</span><a href="#136656" title="Array[Char]">b</a>, <a href="#136654" title="Int">start</a>, <a href="#136503" title="Array[Char]">chars</a>, <a href="#136504" title="Int">pos</a>, <a href="#136657" title="Int">partLen</a><span class="delimiter">)</span>
          <a href="#136504" title="Int">pos</a> = <a href="#136504" title="Int">pos</a> <span title="(x: Int)Int">+</span> <a href="#136657" title="Int">partLen</a>
          <a href="#136501" title="Int">i</a> = <a href="#136501" title="Int">i</a><span title="(x: Int)Int">+</span><span title="Int(1)" class="int">1</span>
        <span class="delimiter">}</span>
        <span title="(x$1: Array[Char])java.lang.String" class="keyword">new</span> <span title="java.lang.String">String</span><span class="delimiter">(</span><a href="#136503" title="Array[Char]">chars</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="=&gt; java.lang.String" id="124518">near</a> = <span title="(x$1: Array[Char], x$2: Int, x$3: Int)java.lang.String" class="keyword">new</span> <span title="java.lang.String">String</span><span class="delimiter">(</span><a href="#124511" title="Array[Char]">segment</a>, <span class="delimiter">(</span><a href="#124512" title="Int">cur</a><span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt">-</span><span title="Int(20)" class="int">20</span><span class="delimiter">)</span> <span title="(that: Int)Int">max</span> <span title="Int(0)" class="int">0</span>, <span class="delimiter">(</span><a href="#124512" title="Int">cur</a> <span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span title="(that: Int)Int">min</span> <a href="#54558" title="object net.liftweb.json.JsonParser.Segments">Segments</a>.<a href="#135615" title="=&gt; Int">segmentSize</a><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="=&gt; Unit" id="124519">release</a> = <a href="#124510" title="List[net.liftweb.json.JsonParser.Segment]">segments</a>.<span title="(f: net.liftweb.json.JsonParser.Segment =&gt; AnyVal)Unit">foreach</span><span class="delimiter">(</span><a href="#54558" title="object net.liftweb.json.JsonParser.Segments">Segments</a>.<a href="#135623" title="(s: net.liftweb.json.JsonParser.Segment)AnyVal">release</a><span class="delimiter">)</span>

    <span class="keyword">private</span><span class="delimiter">[</span>JsonParser<span class="delimiter">]</span> <span class="keyword">def</span> <a title="=&gt; Unit" id="124520">automaticClose</a> = <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#136099" title="Boolean">closeAutomatically</a><span class="delimiter">)</span> <a href="#136098" title="java.io.Reader">in</a>.<span title="()Unit">close</span>

    <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">def</span> <a title="=&gt; Int" id="124521">read</a> = <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#124499" title="=&gt; Int">offset</a> <span title="(x: Int)Boolean">&gt;=</span> <a href="#124511" title="Array[Char]">segment</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="net.liftweb.json.JsonParser.Segment" id="137170">newSegment</a> = <a href="#54558" title="object net.liftweb.json.JsonParser.Segments">Segments</a>.<a href="#135621" title="()net.liftweb.json.JsonParser.Segment">apply</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#124499" title="(x$1: Int)Unit">offset</a> = <span title="Int(0)" class="int">0</span>
        <a href="#124511" title="Array[Char]">segment</a> = <a href="#137170" title="net.liftweb.json.JsonParser.Segment">newSegment</a>.<a href="#136315" title="=&gt; Array[Char]">seg</a>
        <a href="#124510" title="List[net.liftweb.json.JsonParser.Segment]">segments</a> = <a href="#124510" title="List[net.liftweb.json.JsonParser.Segment]">segments</a> <a href="#137171" title="(prefix: List[net.liftweb.json.JsonParser.Segment])List[net.liftweb.json.JsonParser.Segment]">:::</a> <span title="(xs: net.liftweb.json.JsonParser.Segment*)List[net.liftweb.json.JsonParser.Segment]">List</span><span class="delimiter">(</span><a href="#137170" title="net.liftweb.json.JsonParser.Segment">newSegment</a><span class="delimiter">)</span>
        <a href="#124513" title="Int">curSegmentIdx</a> = <a href="#124510" title="List[net.liftweb.json.JsonParser.Segment]">segments</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="Int" id="137165">length</a> = <a href="#136098" title="java.io.Reader">in</a>.<span title="(x$1: Array[Char], x$2: Int, x$3: Int)Int">read</span><span class="delimiter">(</span><a href="#124511" title="Array[Char]">segment</a>, <a href="#124499" title="=&gt; Int">offset</a>, <a href="#124511" title="Array[Char]">segment</a>.<span title="=&gt; Int">length</span><span title="(x: Int)Int">-</span><a href="#124499" title="=&gt; Int">offset</a><span class="delimiter">)</span>
      <a href="#124512" title="Int">cur</a> = <a href="#124499" title="=&gt; Int">offset</a>
      <a href="#124499" title="(x$1: Int)Unit">offset</a> <span title="(x: Int)Int">+=</span> <a href="#137165" title="Int">length</a>
      <a href="#137165" title="Int">length</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/* A pool of preallocated char arrays.
   */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>json<span class="delimiter">]</span> <span class="keyword">object</span> <a title="object net.liftweb.json.JsonParser.Segments" id="54558">Segments</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">import</span> java.util.concurrent.ArrayBlockingQueue
    <span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger

    <span class="keyword">private</span><span class="delimiter">[</span>json<span class="delimiter">]</span> <span class="keyword">var</span> <a title="Int" id="135615">segmentSize</a> = <span title="Int(1000)" class="int">1000</span>
    <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">val</span> <a title="Int" id="135617">maxNumOfSegments</a> = <span title="Int(10000)" class="int">10000</span>
    <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">var</span> <a title="java.util.concurrent.atomic.AtomicInteger" id="135618">segmentCount</a> = <span title="java.util.concurrent.atomic.AtomicInteger" class="keyword">new</span> <span title="java.util.concurrent.atomic.AtomicInteger">AtomicInteger</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
    <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">val</span> <a title="java.util.concurrent.ArrayBlockingQueue[net.liftweb.json.JsonParser.Segment]" id="135619">segments</a> = <span title="java.util.concurrent.ArrayBlockingQueue[net.liftweb.json.JsonParser.Segment]" class="keyword">new</span> <span title="java.util.concurrent.ArrayBlockingQueue[net.liftweb.json.JsonParser.Segment]">ArrayBlockingQueue</span><span class="delimiter">[</span>Segment<span class="delimiter">]</span><span class="delimiter">(</span><a href="#135617" title="Int">maxNumOfSegments</a><span class="delimiter">)</span>
    <span class="keyword">private</span><span class="delimiter">[</span>json<span class="delimiter">]</span> <span class="keyword">def</span> <a title="=&gt; Unit" id="135620">clear</a> = <a href="#135619" title="java.util.concurrent.ArrayBlockingQueue[net.liftweb.json.JsonParser.Segment]">segments</a>.<span title="()Unit">clear</span>

    <span class="keyword">def</span> <a title="()net.liftweb.json.JsonParser.Segment" id="135621">apply</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="#54560" title="net.liftweb.json.JsonParser.Segment">Segment</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="net.liftweb.json.JsonParser.Segment" id="137403">s</a> = <a href="#135622" title="=&gt; net.liftweb.json.JsonParser.Segment">acquire</a>
      <span class="comment">// Give back a disposable segment if pool is exhausted.</span>
      <span title="net.liftweb.json.JsonParser.Segment" class="keyword">if</span> <span class="delimiter">(</span><a href="#137403" title="net.liftweb.json.JsonParser.Segment">s</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#137403" title="net.liftweb.json.JsonParser.Segment">s</a> <span class="keyword">else</span> <a href="#137548" title="(seg: Array[Char])net.liftweb.json.JsonParser.DisposableSegment">DisposableSegment</a><span class="delimiter">(</span><span title="Array[Char]" class="keyword">new</span> <span title="Array[Char]">Array</span><span class="delimiter">(</span><a href="#135615" title="=&gt; Int">segmentSize</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">def</span> <a title="=&gt; net.liftweb.json.JsonParser.Segment" id="135622">acquire</a>: <a href="#54560" title="net.liftweb.json.JsonParser.Segment">Segment</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Int" id="137426">curCount</a> = <a href="#135618" title="java.util.concurrent.atomic.AtomicInteger">segmentCount</a>.<span title="()Int">get</span>
      <span class="keyword">val</span> <a title="Boolean" id="137427">createNew</a> = 
        <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#135619" title="java.util.concurrent.ArrayBlockingQueue[net.liftweb.json.JsonParser.Segment]">segments</a>.<span title="()Int">size</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#137426" title="Int">curCount</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#135617" title="Int">maxNumOfSegments</a><span class="delimiter">)</span>
          <a href="#135618" title="java.util.concurrent.atomic.AtomicInteger">segmentCount</a>.<span title="(x$1: Int, x$2: Int)Boolean">compareAndSet</span><span class="delimiter">(</span><a href="#137426" title="Int">curCount</a>, <a href="#137426" title="Int">curCount</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
        <span class="keyword">else</span> <span title="Boolean(false)" class="keyword">false</span>

      <span title="net.liftweb.json.JsonParser.Segment" class="keyword">if</span> <span class="delimiter">(</span><a href="#137427" title="Boolean">createNew</a><span class="delimiter">)</span> <a href="#137552" title="(seg: Array[Char])net.liftweb.json.JsonParser.RecycledSegment">RecycledSegment</a><span class="delimiter">(</span><span title="Array[Char]" class="keyword">new</span> <span title="Array[Char]">Array</span><span class="delimiter">(</span><a href="#135615" title="=&gt; Int">segmentSize</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#135619" title="java.util.concurrent.ArrayBlockingQueue[net.liftweb.json.JsonParser.Segment]">segments</a>.<span title="()net.liftweb.json.JsonParser.Segment">poll</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(s: net.liftweb.json.JsonParser.Segment)AnyVal" id="135623">release</a><span class="delimiter">(</span><a title="net.liftweb.json.JsonParser.Segment" id="136312">s</a>: <a href="#54560" title="net.liftweb.json.JsonParser.Segment">Segment</a><span class="delimiter">)</span> = <a href="#136312" title="net.liftweb.json.JsonParser.Segment">s</a> <span title="AnyVal" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Boolean">_</span>: <a href="#137552" title="net.liftweb.json.JsonParser.RecycledSegment">RecycledSegment</a> =&gt; <a href="#135619" title="java.util.concurrent.ArrayBlockingQueue[net.liftweb.json.JsonParser.Segment]">segments</a>.<span title="(x$1: net.liftweb.json.JsonParser.Segment)Boolean">offer</span><span class="delimiter">(</span><a href="#136312" title="net.liftweb.json.JsonParser.Segment">s</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">sealed</span> <span class="keyword">trait</span> <a title="trait Segment extends java.lang.Object" id="54560">Segment</a> <span title="java.lang.Object" class="delimiter">{</span>
    <span class="keyword">val</span> <a title="=&gt; Array[Char]" id="136315">seg</a>: <span title="Array[Char]">Array</span><span class="delimiter">[</span>Char<span class="delimiter">]</span>
  <span class="delimiter">}</span>
  case <span class="keyword">class</span> <a title="class RecycledSegment extends java.lang.Object with net.liftweb.json.JsonParser.Segment with ScalaObject with Product with Serializable" id="137552">RecycledSegment</a><a href="#137552" title="ScalaObject" class="delimiter">(</a><a title="Array[Char]" id="137445">seg</a>: <span title="Array[Char]">Array</span><span class="delimiter">[</span>Char<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#54560" title="net.liftweb.json.JsonParser.Segment">Segment</a>
  case <span class="keyword">class</span> <a title="class DisposableSegment extends java.lang.Object with net.liftweb.json.JsonParser.Segment with ScalaObject with Product with Serializable" id="137548">DisposableSegment</a><a href="#137548" title="ScalaObject" class="delimiter">(</a><a title="Array[Char]" id="137419">seg</a>: <span title="Array[Char]">Array</span><span class="delimiter">[</span>Char<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#54560" title="net.liftweb.json.JsonParser.Segment">Segment</a>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
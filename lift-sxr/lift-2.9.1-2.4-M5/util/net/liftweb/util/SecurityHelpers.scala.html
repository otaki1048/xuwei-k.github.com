<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>util/net/liftweb/util/SecurityHelpers.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright 2006-2011 WorldWide Conferencing, LLC
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

<span class="keyword">package</span> net.liftweb 
<span class="keyword">package</span> util 

<span class="keyword">import</span> org.apache.commons.codec.binary.Base64
<span class="keyword">import</span> java.io.<span class="delimiter">{</span>InputStream, ByteArrayOutputStream, ByteArrayInputStream, Reader, File, FileInputStream, BufferedReader<span class="delimiter">}</span>
<span class="keyword">import</span> java.security.<span class="delimiter">{</span>SecureRandom, MessageDigest<span class="delimiter">}</span>
<span class="keyword">import</span> javax.crypto._
<span class="keyword">import</span> javax.crypto.spec._
<span class="keyword">import</span> scala.xml.<span class="delimiter">{</span>Node, XML<span class="delimiter">}</span>
<span class="keyword">import</span> common._

<span class="keyword">object</span> <a title="object net.liftweb.util.SecurityHelpers" id="13631">SecurityHelpers</a> <span title="ScalaObject" class="keyword">extends</span> <a href="StringHelpers.scala.html#13676" title="net.liftweb.util.StringHelpers">StringHelpers</a> <span class="keyword">with</span> <a href="IoHelpers.scala.html#13392" title="net.liftweb.util.IoHelpers">IoHelpers</a> <span class="keyword">with</span> <a href="#13633" title="net.liftweb.util.SecurityHelpers">SecurityHelpers</a>

<span class="comment">/**
 * The SecurityHelpers trait provides functions to:&lt;ul&gt;
 * &lt;li&gt; generate random numbers
 * &lt;li&gt; generate keys
 * &lt;li&gt; encrypt/decrypt keys
 * &lt;li&gt; create SHA, SHA-256, MD5 hashs (can be hex encoded)
 * &lt;/ul&gt;
 */</span>
<span class="keyword">trait</span> <a title="trait SecurityHelpers extends java.lang.Object with ScalaObject" id="13633">SecurityHelpers</a> <span title="ScalaObject" class="delimiter">{</span> 
  self: StringHelpers <span class="keyword">with</span> IoHelpers =&gt; 

  <span class="comment">/** short alias for java.security.SecureRandom */</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.security.SecureRandom" id="48912">_random</a> = <span title="java.security.SecureRandom" class="keyword">new</span> <span title="java.security.SecureRandom">SecureRandom</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="[T](f: java.security.SecureRandom =&gt; T)T" id="48914">withRandom</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="48916">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="java.security.SecureRandom =&gt; T" id="317388">f</a>: SecureRandom =&gt; T<span class="delimiter">)</span>: <a href="#48916" title="T">T</a> = 
    <a href="#48912" title="=&gt; java.security.SecureRandom">_random</a>.<span title="(x$1: T)T">synchronized</span><span class="delimiter">(</span><a href="#317388" title="(v1: java.security.SecureRandom)T">f</a><span class="delimiter">(</span><a href="#48912" title="=&gt; java.security.SecureRandom">_random</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/** return a random Long modulo a number */</span>
  <span class="keyword">def</span> <a title="(mod: Long)Long" id="48917">randomLong</a><span class="delimiter">(</span><a title="Long" id="62150">mod</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <span title="Long">Long</span> = <a href="#48914" title="(f: java.security.SecureRandom =&gt; Long)Long">withRandom</a><span class="delimiter">(</span><a title="java.security.SecureRandom" id="317402">random</a> =&gt; <span title="object Math">Math</span>.<span title="(x: Long)Long">abs</span><span class="delimiter">(</span><a href="#317402" title="java.security.SecureRandom">random</a>.<span title="()Long">nextLong</span><span class="delimiter">)</span> <span title="(x: Long)Long">%</span> <a href="#62150" title="Long">mod</a><span class="delimiter">)</span>

  <span class="comment">/** return a random int modulo a number */</span>
  <span class="keyword">def</span> <a title="(mod: Int)Int" id="48918">randomInt</a><span class="delimiter">(</span><a title="Int" id="317587">mod</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <a href="#48914" title="(f: java.security.SecureRandom =&gt; Int)Int">withRandom</a><span class="delimiter">(</span><a title="java.security.SecureRandom" id="317592">random</a> =&gt; <span title="object Math">Math</span>.<span title="(x: Int)Int">abs</span><span class="delimiter">(</span><a href="#317592" title="java.security.SecureRandom">random</a>.<span title="()Int">nextInt</span><span class="delimiter">)</span> <span title="(x: Int)Int">%</span> <a href="#317587" title="Int">mod</a><span class="delimiter">)</span>

  <span class="comment">/**
   * return true only 'percent' times when asked repeatedly.
   * This function is used in the Skittr example to get a random set of users
   * @param percent percentage as a double number &lt;= 1.0
   */</span>
  <span class="keyword">def</span> <a title="(percent: Double)Boolean" id="48919">shouldShow</a><span class="delimiter">(</span><a title="Double" id="317604">percent</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <a href="#48914" title="(f: java.security.SecureRandom =&gt; Boolean)Boolean">withRandom</a><span class="delimiter">(</span><a href="#317609" title="java.security.SecureRandom">_</a>.<span title="()Double">nextDouble</span> <span title="(x: Double)Boolean">&lt;=</span> <a href="#317604" title="Double">percent</a><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">def</span> <a title="(in: Array[Byte])Array[Byte]" id="48920">cleanArray</a><span class="delimiter">(</span><a title="Array[Byte]" id="317615">in</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span> = <a href="#317615" title="implicit scala.Predef.byteArrayOps : (xs: Array[Byte])scala.collection.mutable.ArrayOps[Byte]">in</a>.<span title="(p: Byte =&gt; Boolean)Array[Byte]">filter</span><span class="delimiter">(</span><a title="Byte" id="317821">a</a> =&gt; <a href="#317821" title="Byte">a</a> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(32)" class="int">32</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#317821" title="Byte">a</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(127)" class="int">127</span><span class="delimiter">)</span>

  <span class="comment">/** encode a Byte array in Base 64 */</span>
  <span class="keyword">def</span> <a title="(in: Array[Byte])String" id="48921">base64Encode</a><span class="delimiter">(</span><a title="Array[Byte]" id="157890">in</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="String">String</span> = <span title="(x$1: Array[Byte])java.lang.String" class="keyword">new</span> <span title="java.lang.String">String</span><span class="delimiter">(</span><a href="#48920" title="(in: Array[Byte])Array[Byte]">cleanArray</a><span class="delimiter">(</span><span class="delimiter">(</span><span title="org.apache.commons.codec.binary.Base64" class="keyword">new</span> <span title="org.apache.commons.codec.binary.Base64">Base64</span><span class="delimiter">)</span>.<span title="(x$1: Array[Byte])Array[Byte]">encode</span><span class="delimiter">(</span><a href="#157890" title="Array[Byte]">in</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/** encode a Byte array in Base 64 in a way that's safe for use in URLs */</span>
  <span class="keyword">def</span> <a title="(in: Array[Byte])String" id="48922">base64EncodeURLSafe</a><span class="delimiter">(</span><a title="Array[Byte]" id="317839">in</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="String">String</span> = <span title="(x$1: Array[Byte])java.lang.String" class="keyword">new</span> <span title="java.lang.String">String</span><span class="delimiter">(</span><span title="object org.apache.commons.codec.binary.Base64">Base64</span>.<span title="(x$1: Array[Byte])Array[Byte]">encodeBase64URLSafe</span><span class="delimiter">(</span><a href="#317839" title="Array[Byte]">in</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/** decode a String in Base 64 */</span>
  <span class="keyword">def</span> <a title="(in: String)Array[Byte]" id="48923">base64Decode</a><span class="delimiter">(</span><a title="String" id="157898">in</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span> = <span class="delimiter">(</span><span title="org.apache.commons.codec.binary.Base64" class="keyword">new</span> <span title="org.apache.commons.codec.binary.Base64">Base64</span><span class="delimiter">)</span>.<span title="(x$1: Array[Byte])Array[Byte]">decode</span><span class="delimiter">(</span><a href="#157898" title="String">in</a>.<span title="(x$1: java.lang.String)Array[Byte]">getBytes</span><span class="delimiter">(</span><span title="java.lang.String(&quot;UTF-8&quot;)" class="string">&quot;UTF-8&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/** create a MD5 digest from a Byte array */</span>
  <span class="keyword">def</span> <a title="(in: Array[Byte])Array[Byte]" id="48924">md5</a><span class="delimiter">(</span><a title="Array[Byte]" id="317856">in</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span> = <span class="delimiter">(</span><span title="object java.security.MessageDigest">MessageDigest</span>.<span title="(x$1: java.lang.String)java.security.MessageDigest">getInstance</span><span class="delimiter">(</span><span title="java.lang.String(&quot;MD5&quot;)" class="string">&quot;MD5&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(x$1: Array[Byte])Array[Byte]">digest</span><span class="delimiter">(</span><a href="#317856" title="Array[Byte]">in</a><span class="delimiter">)</span>

  <span class="comment">/** create a MD5 digest from a String */</span>
  <span class="keyword">def</span> <a title="(in: String)String" id="48925">md5</a><span class="delimiter">(</span><a title="String" id="317995">in</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="String">String</span> = <span title="(x$1: Array[Byte])java.lang.String" class="keyword">new</span> <span title="java.lang.String">String</span><span class="delimiter">(</span><a href="#48920" title="(in: Array[Byte])Array[Byte]">cleanArray</a><span class="delimiter">(</span><span class="delimiter">(</span><span title="org.apache.commons.codec.binary.Base64" class="keyword">new</span> <span title="org.apache.commons.codec.binary.Base64">Base64</span><span class="delimiter">)</span> <span title="(x$1: Array[Byte])Array[Byte]">encode</span> <a href="#48924" title="(in: Array[Byte])Array[Byte]">md5</a><span class="delimiter">(</span><a href="#317995" title="String">in</a>.<span title="(x$1: java.lang.String)Array[Byte]">getBytes</span><span class="delimiter">(</span><span title="java.lang.String(&quot;UTF-8&quot;)" class="string">&quot;UTF-8&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/** create a SHA hash from a Byte array */</span>
  <span class="keyword">def</span> <a title="(in: Array[Byte])Array[Byte]" id="48926">hash</a><span class="delimiter">(</span><a title="Array[Byte]" id="165784">in</a> : <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span> : <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="delimiter">(</span><span title="object java.security.MessageDigest">MessageDigest</span>.<span title="(x$1: java.lang.String)java.security.MessageDigest">getInstance</span><span class="delimiter">(</span><span title="java.lang.String(&quot;SHA&quot;)" class="string">&quot;SHA&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(x$1: Array[Byte])Array[Byte]">digest</span><span class="delimiter">(</span><a href="#165784" title="Array[Byte]">in</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** create a SHA hash from a String */</span>
  <span class="keyword">def</span> <a title="(in: String)String" id="48927">hash</a><span class="delimiter">(</span><a title="String" id="165782">in</a>: <span title="String">String</span><span class="delimiter">)</span> : <span title="String">String</span> = <span class="delimiter">{</span>
    <span title="(x$1: Array[Byte])java.lang.String" class="keyword">new</span> <span title="java.lang.String">String</span><span class="delimiter">(</span><a href="#48920" title="(in: Array[Byte])Array[Byte]">cleanArray</a><span class="delimiter">(</span><span class="delimiter">(</span><span title="org.apache.commons.codec.binary.Base64" class="keyword">new</span> <span title="org.apache.commons.codec.binary.Base64">Base64</span><span class="delimiter">)</span> <span title="(x$1: Array[Byte])Array[Byte]">encode</span> <span class="delimiter">(</span><span title="object java.security.MessageDigest">MessageDigest</span>.<span title="(x$1: java.lang.String)java.security.MessageDigest">getInstance</span><span class="delimiter">(</span><span title="java.lang.String(&quot;SHA&quot;)" class="string">&quot;SHA&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(x$1: Array[Byte])Array[Byte]">digest</span><span class="delimiter">(</span><a href="#165782" title="String">in</a>.<span title="(x$1: java.lang.String)Array[Byte]">getBytes</span><span class="delimiter">(</span><span title="java.lang.String(&quot;UTF-8&quot;)" class="string">&quot;UTF-8&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

   <span class="comment">/** create a SHA hash from a String */</span>
  <span class="keyword">def</span> <a title="(in: String)String" id="48928">hashHex</a><span class="delimiter">(</span><a title="String" id="318035">in</a>: <span title="String">String</span><span class="delimiter">)</span> : <span title="String">String</span> = <span class="delimiter">{</span>
    <a href="Helpers.scala.html#13346" title="object net.liftweb.util.Helpers">Helpers</a>.<a href="#48936" title="(in: Array[Byte])String">hexEncode</a><span class="delimiter">(</span><span title="object java.security.MessageDigest">MessageDigest</span>.<span title="(x$1: java.lang.String)java.security.MessageDigest">getInstance</span><span class="delimiter">(</span><span title="java.lang.String(&quot;SHA&quot;)" class="string">&quot;SHA&quot;</span><span class="delimiter">)</span>.<span title="(x$1: Array[Byte])Array[Byte]">digest</span><span class="delimiter">(</span><a href="#318035" title="String">in</a>.<span title="(x$1: java.lang.String)Array[Byte]">getBytes</span><span class="delimiter">(</span><span title="java.lang.String(&quot;UTF-8&quot;)" class="string">&quot;UTF-8&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Compare two strings in a way that does not vary if the strings
   * are determined to be not equal early (test every byte... avoids
   * timing attackes */</span>
  <span class="keyword">def</span> <a title="(s1: String, s2: String)Boolean" id="48929">secureEquals</a><span class="delimiter">(</span><a title="String" id="318045">s1</a>: <span title="String">String</span>, <a title="String" id="318046">s2</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span title="(_1: String, _2: String)(String, String)" class="delimiter">(</span><a href="#318045" title="String">s1</a>, <a href="#318046" title="String">s2</a><span class="delimiter">)</span> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="Boolean(true)" class="delimiter">(</span><span title="Null(null)" class="keyword">null</span>, <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
    <span class="keyword">case</span> <span title="Boolean(false)" class="delimiter">(</span><span title="Null(null)" class="keyword">null</span>, _<span class="delimiter">)</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
    <span class="keyword">case</span> <span title="Boolean(false)" class="delimiter">(</span>_, <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
    <span class="keyword">case</span> <span title="Boolean" class="delimiter">(</span><a title="String" id="318062">a</a>, <a title="String" id="318063">b</a><span class="delimiter">)</span> =&gt; <a href="#48930" title="(s1: Array[Byte], s2: Array[Byte])Boolean">secureEquals</a><span class="delimiter">(</span><a href="#318062" title="String">a</a>.<span title="(x$1: java.lang.String)Array[Byte]">getBytes</span><span class="delimiter">(</span><span title="java.lang.String(&quot;UTF-8&quot;)" class="string">&quot;UTF-8&quot;</span><span class="delimiter">)</span>, <a href="#318063" title="String">b</a>.<span title="(x$1: java.lang.String)Array[Byte]">getBytes</span><span class="delimiter">(</span><span title="java.lang.String(&quot;UTF-8&quot;)" class="string">&quot;UTF-8&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
    
  <span class="comment">/** Compare two byte arrays in a way that does not vary if the arrays
   * are determined to be not equal early (test every byte... avoids
   * timing attackes */</span>
  <span class="keyword">def</span> <a title="(s1: Array[Byte], s2: Array[Byte])Boolean" id="48930">secureEquals</a><span class="delimiter">(</span><a title="Array[Byte]" id="318068">s1</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span>, <a title="Array[Byte]" id="318069">s2</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span title="(_1: Array[Byte], _2: Array[Byte])(Array[Byte], Array[Byte])" class="delimiter">(</span><a href="#318068" title="Array[Byte]">s1</a>, <a href="#318069" title="Array[Byte]">s2</a><span class="delimiter">)</span> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="Boolean(true)" class="delimiter">(</span><span title="Null(null)" class="keyword">null</span>, <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
    <span class="keyword">case</span> <span title="Boolean(false)" class="delimiter">(</span><span title="Null(null)" class="keyword">null</span>, _<span class="delimiter">)</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
    <span class="keyword">case</span> <span title="Boolean(false)" class="delimiter">(</span>_, <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
    <span class="keyword">case</span> <span title="Boolean" class="delimiter">(</span><a title="Array[Byte]" id="318095">a</a>, <a title="Array[Byte]" id="318096">b</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Int" id="318097">la</a> = <a href="#318095" title="Array[Byte]">a</a>.<span title="=&gt; Int">length</span>
      <span class="keyword">val</span> <a title="Int" id="318098">lb</a> = <a href="#318096" title="Array[Byte]">b</a>.<span title="=&gt; Int">length</span>
      <span class="keyword">var</span> <a title="Boolean" id="318099">ret</a> = <span title="Boolean(true)" class="keyword">true</span>
      <span class="keyword">var</span> <a title="Int" id="318100">pos</a> = <span title="Int(0)" class="int">0</span>
      <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#318100" title="Int">pos</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#318097" title="Int">la</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#318100" title="Int">pos</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#318098" title="Int">lb</a><span class="delimiter">)</span> <a href="#318101" title="()Unit" class="delimiter">{</a>
        <a href="#318099" title="Boolean">ret</a> <span title="(x: Boolean)Boolean">&amp;=</span> <span class="delimiter">(</span><a href="#318095" title="(i: Int)Byte">a</a><span class="delimiter">(</span><a href="#318100" title="Int">pos</a><span class="delimiter">)</span> <span title="(x: Byte)Boolean">==</span> <a href="#318096" title="(i: Int)Byte">b</a><span class="delimiter">(</span><a href="#318100" title="Int">pos</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#318100" title="Int">pos</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
      <span class="delimiter">}</span>
      <a href="#318099" title="Boolean">ret</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#318097" title="Int">la</a> <span title="(x: Int)Boolean">==</span> <a href="#318098" title="Int">lb</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
    

  <span class="comment">/** create a SHA-256 hash from a Byte array */</span>
  <span class="keyword">def</span> <a title="(in: Array[Byte])Array[Byte]" id="48931">hash256</a><span class="delimiter">(</span><a title="Array[Byte]" id="318125">in</a> : <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span> : <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="delimiter">(</span><span title="object java.security.MessageDigest">MessageDigest</span>.<span title="(x$1: java.lang.String)java.security.MessageDigest">getInstance</span><span class="delimiter">(</span><span title="java.lang.String(&quot;SHA-256&quot;)" class="string">&quot;SHA-256&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(x$1: Array[Byte])Array[Byte]">digest</span><span class="delimiter">(</span><a href="#318125" title="Array[Byte]">in</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** create a SHA-256 hash from a String */</span>
  <span class="keyword">def</span> <a title="(in: String)String" id="48932">hash256</a><span class="delimiter">(</span><a title="String" id="318131">in</a> : <span title="String">String</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
    <span title="(x$1: Array[Byte])java.lang.String" class="keyword">new</span> <span title="java.lang.String">String</span><span class="delimiter">(</span><a href="#48920" title="(in: Array[Byte])Array[Byte]">cleanArray</a><span class="delimiter">(</span><span class="delimiter">(</span><span title="org.apache.commons.codec.binary.Base64" class="keyword">new</span> <span title="org.apache.commons.codec.binary.Base64">Base64</span><span class="delimiter">)</span> <span title="(x$1: Array[Byte])Array[Byte]">encode</span> <span class="delimiter">(</span><span title="object java.security.MessageDigest">MessageDigest</span>.<span title="(x$1: java.lang.String)java.security.MessageDigest">getInstance</span><span class="delimiter">(</span><span title="java.lang.String(&quot;SHA-256&quot;)" class="string">&quot;SHA-256&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(x$1: Array[Byte])Array[Byte]">digest</span><span class="delimiter">(</span><a href="#318131" title="String">in</a>.<span title="(x$1: java.lang.String)Array[Byte]">getBytes</span><span class="delimiter">(</span><span title="java.lang.String(&quot;UTF-8&quot;)" class="string">&quot;UTF-8&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** create an hex encoded SHA hash from a Byte array */</span>
  <span class="keyword">def</span> <a title="(in: Array[Byte])String" id="48933">hexDigest</a><span class="delimiter">(</span><a title="Array[Byte]" id="318150">in</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Array[Byte]" id="318152">binHash</a> = <span class="delimiter">(</span><span title="object java.security.MessageDigest">MessageDigest</span>.<span title="(x$1: java.lang.String)java.security.MessageDigest">getInstance</span><span class="delimiter">(</span><span title="java.lang.String(&quot;SHA&quot;)" class="string">&quot;SHA&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(x$1: Array[Byte])Array[Byte]">digest</span><span class="delimiter">(</span><a href="#318150" title="Array[Byte]">in</a><span class="delimiter">)</span>
    <a href="#48936" title="(in: Array[Byte])String">hexEncode</a><span class="delimiter">(</span><a href="#318152" title="Array[Byte]">binHash</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** create an hex encoded SHA-256 hash from a Byte array */</span>
  <span class="keyword">def</span> <a title="(in: Array[Byte])String" id="48934">hexDigest256</a><span class="delimiter">(</span><a title="Array[Byte]" id="318157">in</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Array[Byte]" id="318159">binHash</a> = <span class="delimiter">(</span><span title="object java.security.MessageDigest">MessageDigest</span>.<span title="(x$1: java.lang.String)java.security.MessageDigest">getInstance</span><span class="delimiter">(</span><span title="java.lang.String(&quot;SHA-256&quot;)" class="string">&quot;SHA-256&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(x$1: Array[Byte])Array[Byte]">digest</span><span class="delimiter">(</span><a href="#318157" title="Array[Byte]">in</a><span class="delimiter">)</span>
    <a href="#48936" title="(in: Array[Byte])String">hexEncode</a><span class="delimiter">(</span><a href="#318159" title="Array[Byte]">binHash</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(str: String)Array[Byte]" id="48935">hexDecode</a><span class="delimiter">(</span><a title="String" id="318164">str</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="318166">max</a> = <a href="#318164" title="String">str</a>.<span title="()Int">length</span> <span title="(x: Int)Int">/</span> <span title="Int(2)" class="int">2</span>
    <span class="keyword">val</span> <a title="Array[Byte]" id="318167">ret</a> = <span title="Array[Byte]" class="keyword">new</span> <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">(</span><a href="#318166" title="Int">max</a><span class="delimiter">)</span>
    <span class="keyword">var</span> <a title="Int" id="318168">pos</a> = <span title="Int(0)" class="int">0</span>

    <span class="keyword">def</span> <a title="(in: Char)Int" id="318169">byteOf</a><span class="delimiter">(</span><a title="Char" id="318177">in</a>: <span title="Char">Char</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <a href="#318177" title="Char">in</a> <span title="Int" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Int(0)" class="char">'0'</span> =&gt; <span title="Int(0)" class="int">0</span>
      <span class="keyword">case</span> <span title="Int(1)" class="char">'1'</span> =&gt; <span title="Int(1)" class="int">1</span>
      <span class="keyword">case</span> <span title="Int(2)" class="char">'2'</span> =&gt; <span title="Int(2)" class="int">2</span>
      <span class="keyword">case</span> <span title="Int(3)" class="char">'3'</span> =&gt; <span title="Int(3)" class="int">3</span>
      <span class="keyword">case</span> <span title="Int(4)" class="char">'4'</span> =&gt; <span title="Int(4)" class="int">4</span>
      <span class="keyword">case</span> <span title="Int(5)" class="char">'5'</span> =&gt; <span title="Int(5)" class="int">5</span>
      <span class="keyword">case</span> <span title="Int(6)" class="char">'6'</span> =&gt; <span title="Int(6)" class="int">6</span>
      <span class="keyword">case</span> <span title="Int(7)" class="char">'7'</span> =&gt; <span title="Int(7)" class="int">7</span>
      <span class="keyword">case</span> <span title="Int(8)" class="char">'8'</span> =&gt; <span title="Int(8)" class="int">8</span>
      <span class="keyword">case</span> <span title="Int(9)" class="char">'9'</span> =&gt; <span title="Int(9)" class="int">9</span>
      <span class="keyword">case</span> <span title="Int(10)" class="char">'a'</span> | <span title="Char(\'A\')" class="char">'A'</span> =&gt; <span title="Int(10)" class="int">10</span>
      <span class="keyword">case</span> <span title="Int(11)" class="char">'b'</span> | <span title="Char(\'B\')" class="char">'B'</span> =&gt; <span title="Int(11)" class="int">11</span>
      <span class="keyword">case</span> <span title="Int(12)" class="char">'c'</span> | <span title="Char(\'C\')" class="char">'C'</span> =&gt; <span title="Int(12)" class="int">12</span>
      <span class="keyword">case</span> <span title="Int(13)" class="char">'d'</span> | <span title="Char(\'D\')" class="char">'D'</span> =&gt; <span title="Int(13)" class="int">13</span>
      <span class="keyword">case</span> <span title="Int(14)" class="char">'e'</span> | <span title="Char(\'E\')" class="char">'E'</span> =&gt; <span title="Int(14)" class="int">14</span>
      <span class="keyword">case</span> <span title="Int(15)" class="char">'f'</span> | <span title="Char(\'F\')" class="char">'F'</span> =&gt; <span title="Int(15)" class="int">15</span>
        <span class="keyword">case</span> <span title="Int(0)">_</span> =&gt; <span title="Int(0)" class="int">0</span>
    <span class="delimiter">}</span>

    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#318168" title="Int">pos</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#318166" title="Int">max</a><span class="delimiter">)</span> <a href="#318170" title="()Unit" class="delimiter">{</a>
      <span class="keyword">val</span> <a title="Int" id="318182">two</a> = <a href="#318168" title="Int">pos</a> <span title="(x: Int)Int">*</span> <span title="Int(2)" class="int">2</span>
      <span class="keyword">val</span> <a title="Char" id="318183">ch</a>: <span title="Char">Char</span> = <a href="#318164" title="String">str</a>.<span title="(x$1: Int)Char">charAt</span><span class="delimiter">(</span><a href="#318182" title="Int">two</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Char" id="318184">cl</a>: <span title="Char">Char</span> = <a href="#318164" title="String">str</a>.<span title="(x$1: Int)Char">charAt</span><span class="delimiter">(</span><a href="#318182" title="Int">two</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      <a href="#318167" title="(i: Int, x: Byte)Unit">ret</a><span class="delimiter">(</span><a href="#318168" title="Int">pos</a><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="#318169" title="(in: Char)Int">byteOf</a><span class="delimiter">(</span><a href="#318183" title="Char">ch</a><span class="delimiter">)</span> <span title="(x: Int)Int">*</span> <span title="Int(16)" class="int">16</span> <span title="(x: Int)Int">+</span> <a href="#318169" title="(in: Char)Int">byteOf</a><span class="delimiter">(</span><a href="#318184" title="Char">cl</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; Byte">toByte</span>
      <a href="#318168" title="Int">pos</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
    <span class="delimiter">}</span>

    <a href="#318167" title="Array[Byte]">ret</a>
  <span class="delimiter">}</span>

  <span class="comment">/** encode a Byte array as hexadecimal characters */</span>
  <span class="keyword">def</span> <a title="(in: Array[Byte])String" id="48936">hexEncode</a><span class="delimiter">(</span><a title="Array[Byte]" id="240999">in</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="StringBuilder" id="318207">sb</a> = <span title="()StringBuilder" class="keyword">new</span> <span title="StringBuilder">StringBuilder</span>
    <span class="keyword">val</span> <a title="Int" id="318208">len</a> = <a href="#240999" title="Array[Byte]">in</a>.<span title="=&gt; Int">length</span>
    <span class="keyword">def</span> <a title="(in: Array[Byte], pos: Int, len: Int, sb: StringBuilder)Unit" id="318209">addDigit</a><span class="delimiter">(</span><a title="Array[Byte]" id="318212">in</a>: <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span>, <a title="Int" id="318213">pos</a>: <span title="Int">Int</span>, <a title="Int" id="318214">len</a>: <span title="Int">Int</span>, <a title="StringBuilder" id="318215">sb</a>: <span title="StringBuilder">StringBuilder</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#318213" title="Int">pos</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#318214" title="Int">len</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Int" id="318220">b</a>: <span title="Int">Int</span> = <a href="#318212" title="(i: Int)Byte">in</a><span title="=&gt; Int" class="delimiter">(</span><a href="#318213" title="Int">pos</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="318221">msb</a> = <span class="delimiter">(</span><a href="#318220" title="Int">b</a> <span title="(x: Int)Int">&amp;</span> <span title="Int(240)" class="int">0xf0</span><span class="delimiter">)</span> <span title="(x: Int)Int">&gt;&gt;</span> <span title="Int(4)" class="int">4</span>
        <span class="keyword">val</span> <a title="Int" id="318222">lsb</a> = <span class="delimiter">(</span><a href="#318220" title="Int">b</a> <span title="(x: Int)Int">&amp;</span> <span title="Int(15)" class="int">0x0f</span><span class="delimiter">)</span>
        <a href="#318215" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span><span class="delimiter">(</span><span class="delimiter">(</span><span title="Char" class="keyword">if</span> <span class="delimiter">(</span><a href="#318221" title="Int">msb</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(10)" class="int">10</span><span class="delimiter">)</span> <span class="delimiter">(</span><span title="Char(\'0\')" class="char">'0'</span> <span title="(x: Int)Int">+</span> <a href="#318221" title="Int">msb</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Char" class="delimiter">[</span><span title="Char">Char</span><span class="delimiter">]</span> <span class="keyword">else</span> <span class="delimiter">(</span><span title="Char(\'a\')" class="char">'a'</span> <span title="(x: Int)Int">+</span> <span class="delimiter">(</span><a href="#318221" title="Int">msb</a> <span title="(x: Int)Int">-</span> <span title="Int(10)" class="int">10</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Char" class="delimiter">[</span><span title="Char">Char</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#318215" title="StringBuilder">sb</a>.<span title="(x: Char)StringBuilder">append</span><span class="delimiter">(</span><span class="delimiter">(</span><span title="Char" class="keyword">if</span> <span class="delimiter">(</span><a href="#318222" title="Int">lsb</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(10)" class="int">10</span><span class="delimiter">)</span> <span class="delimiter">(</span><span title="Char(\'0\')" class="char">'0'</span> <span title="(x: Int)Int">+</span> <a href="#318222" title="Int">lsb</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Char" class="delimiter">[</span><span title="Char">Char</span><span class="delimiter">]</span> <span class="keyword">else</span> <span class="delimiter">(</span><span title="Char(\'a\')" class="char">'a'</span> <span title="(x: Int)Int">+</span> <span class="delimiter">(</span><a href="#318222" title="Int">lsb</a> <span title="(x: Int)Int">-</span> <span title="Int(10)" class="int">10</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Char" class="delimiter">[</span><span title="Char">Char</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span>

        <a href="#318209" title="(in: Array[Byte], pos: Int, len: Int, sb: StringBuilder)Unit">addDigit</a><span class="delimiter">(</span><a href="#318212" title="Array[Byte]">in</a>, <a href="#318213" title="Int">pos</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>, <a href="#318214" title="Int">len</a>, <a href="#318215" title="StringBuilder">sb</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <a href="#318209" title="(in: Array[Byte], pos: Int, len: Int, sb: StringBuilder)Unit">addDigit</a><span class="delimiter">(</span><a href="#240999" title="Array[Byte]">in</a>, <span title="Int(0)" class="int">0</span>, <a href="#318208" title="Int">len</a>, <a href="#318207" title="StringBuilder">sb</a><span class="delimiter">)</span>
    <a href="#318207" title="StringBuilder">sb</a>.<span title="()java.lang.String">toString</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>


        </pre>
    </body>
</html>
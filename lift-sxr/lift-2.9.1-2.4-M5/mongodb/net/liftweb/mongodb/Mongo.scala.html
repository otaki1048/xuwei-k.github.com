<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>mongodb/net/liftweb/mongodb/Mongo.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright 2010-2011 WorldWide Conferencing, LLC
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

<span class="keyword">package</span> net.liftweb
<span class="keyword">package</span> mongodb

<span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap

<span class="keyword">import</span> scala.collection.immutable.HashSet

<span class="keyword">import</span> com.mongodb._

<span class="comment">/*
* A trait for identfying Mongo instances
*/</span>
<span class="keyword">trait</span> <a title="trait MongoIdentifier extends java.lang.Object with ScalaObject" id="12317">MongoIdentifier</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="=&gt; String" id="201150">jndiName</a>: <span title="String">String</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()java.lang.String" id="201151">toString</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span title="java.lang.String(&quot;MongoIdentifier(&quot;)" class="string">&quot;MongoIdentifier(&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#201150" title="=&gt; String">jndiName</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;)&quot;)" class="string">&quot;)&quot;</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Int" id="201152">hashCode</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="#201150" title="=&gt; String">jndiName</a>.<span title="()Int">hashCode</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(other: Any)Boolean" id="201153">equals</a><span class="delimiter">(</span><a title="Any" id="212420">other</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <a href="#212420" title="Any">other</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a title="Boolean" id="212422">mi</a>: <a href="#12317" title="net.liftweb.mongodb.MongoIdentifier">MongoIdentifier</a> =&gt; <a href="#212422" title="net.liftweb.mongodb.MongoIdentifier">mi</a>.<a href="#201150" title="=&gt; String">jndiName</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#12317" title="MongoIdentifier.this.type" class="keyword">this</a>.<a href="#201150" title="=&gt; String">jndiName</a>
    <span class="keyword">case</span> <span title="Boolean(false)">_</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/*
* The default MongoIdentifier
*/</span>
case <span class="keyword">object</span> <a href="#212435" title="object net.liftweb.mongodb.DefaultMongoIdentifier" id="212440">DefaultMongoIdentifier</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#12317" title="net.liftweb.mongodb.MongoIdentifier">MongoIdentifier</a> <span class="delimiter">{</span>
  <span class="keyword">val</span> <a title="java.lang.String" id="212429">jndiName</a> = <span title="java.lang.String(&quot;test&quot;)" class="string">&quot;test&quot;</span>
<span class="delimiter">}</span>

<span class="comment">/*
* Wrapper for getting a reference to a db from the given Mongo instance
*/</span>
case <span class="keyword">class</span> <a title="class MongoAddress extends java.lang.Object with ScalaObject with Product with Serializable" id="213617">MongoAddress</a><a href="#213617" title="ScalaObject" class="delimiter">(</a><a title="net.liftweb.mongodb.MongoHostBase" id="213439">host</a>: <a href="#12323" title="net.liftweb.mongodb.MongoHostBase">MongoHostBase</a>, <a title="String" id="213440">name</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="=&gt; com.mongodb.DB" id="212448">db</a> = <a href="#213439" title="=&gt; net.liftweb.mongodb.MongoHostBase">host</a>.<a href="#212454" title="=&gt; com.mongodb.Mongo">mongo</a>.<span title="(x$1: java.lang.String)com.mongodb.DB">getDB</span><span class="delimiter">(</span><a href="#213440" title="=&gt; String">name</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/*
* Wrapper for creating a Mongo instance
*/</span>
<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class MongoHostBase extends java.lang.Object with ScalaObject" id="12323">MongoHostBase</a> <a href="#12323" title="ScalaObject" class="delimiter">{</a>
  <span class="keyword">def</span> <a title="=&gt; com.mongodb.Mongo" id="212454">mongo</a>: <span title="com.mongodb.Mongo">Mongo</span>
<span class="delimiter">}</span>
case <span class="keyword">class</span> <a title="class MongoHost extends net.liftweb.mongodb.MongoHostBase with ScalaObject with Product with Serializable" id="212778">MongoHost</a><a href="#212778" title="ScalaObject" class="delimiter">(</a><a title="com.mongodb.ServerAddress" id="212926">server</a>: <span title="com.mongodb.ServerAddress">ServerAddress</span> = <span title="com.mongodb.ServerAddress" class="keyword">new</span> <span title="com.mongodb.ServerAddress">ServerAddress</span>, <a title="com.mongodb.MongoOptions" id="212927">options</a>: <span title="com.mongodb.MongoOptions">MongoOptions</span> = <span title="com.mongodb.MongoOptions" class="keyword">new</span> <span title="com.mongodb.MongoOptions">MongoOptions</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#12323" title="net.liftweb.mongodb.MongoHostBase">MongoHostBase</a> <span class="delimiter">{</span>
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="com.mongodb.Mongo" id="212664">mongo</a> = <span title="(x$1: com.mongodb.ServerAddress, x$2: com.mongodb.MongoOptions)com.mongodb.Mongo" class="keyword">new</span> <span title="com.mongodb.Mongo">Mongo</span><span class="delimiter">(</span><a href="#212926" title="=&gt; com.mongodb.ServerAddress">server</a>, <a href="#212927" title="=&gt; com.mongodb.MongoOptions">options</a><span class="delimiter">)</span>
<span class="delimiter">}</span>
<span class="keyword">object</span> <a title="object net.liftweb.mongodb.MongoHost" id="212986">MongoHost</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(host: String)net.liftweb.mongodb.MongoHost" id="212775">apply</a><span class="delimiter">(</span><a title="String" id="212922">host</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="#212778" title="net.liftweb.mongodb.MongoHost">MongoHost</a> = <a href="#212778" title="(server: com.mongodb.ServerAddress, options: com.mongodb.MongoOptions)net.liftweb.mongodb.MongoHost">MongoHost</a><span class="delimiter">(</span><span title="(x$1: java.lang.String, x$2: Int)com.mongodb.ServerAddress" class="keyword">new</span> <span title="com.mongodb.ServerAddress">ServerAddress</span><span class="delimiter">(</span><a href="#212922" title="String">host</a>, <span title="Int(27017)" class="int">27017</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(host: String, port: Int)net.liftweb.mongodb.MongoHost" id="212776">apply</a><span class="delimiter">(</span><a title="String" id="212935">host</a>: <span title="String">String</span>, <a title="Int" id="212936">port</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="#212778" title="net.liftweb.mongodb.MongoHost">MongoHost</a> = <a href="#212778" title="(server: com.mongodb.ServerAddress, options: com.mongodb.MongoOptions)net.liftweb.mongodb.MongoHost">MongoHost</a><span class="delimiter">(</span><span title="(x$1: java.lang.String, x$2: Int)com.mongodb.ServerAddress" class="keyword">new</span> <span title="com.mongodb.ServerAddress">ServerAddress</span><span class="delimiter">(</span><a href="#212935" title="String">host</a>, <a href="#212936" title="Int">port</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(host: String, port: Int, options: com.mongodb.MongoOptions)net.liftweb.mongodb.MongoHost" id="212777">apply</a><span class="delimiter">(</span><a title="String" id="212931">host</a>: <span title="String">String</span>, <a title="Int" id="212932">port</a>: <span title="Int">Int</span>, <a title="com.mongodb.MongoOptions" id="212933">options</a>: <span title="com.mongodb.MongoOptions">MongoOptions</span><span class="delimiter">)</span>: <a href="#212778" title="net.liftweb.mongodb.MongoHost">MongoHost</a> = <a href="#212778" title="(server: com.mongodb.ServerAddress, options: com.mongodb.MongoOptions)net.liftweb.mongodb.MongoHost">MongoHost</a><span class="delimiter">(</span><span title="(x$1: java.lang.String, x$2: Int)com.mongodb.ServerAddress" class="keyword">new</span> <span title="com.mongodb.ServerAddress">ServerAddress</span><span class="delimiter">(</span><a href="#212931" title="String">host</a>, <a href="#212932" title="Int">port</a><span class="delimiter">)</span>, <a href="#212933" title="com.mongodb.MongoOptions">options</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/*
* Wrapper for creating a Replica Pair
*/</span>
case <span class="keyword">class</span> <a title="class MongoPair extends net.liftweb.mongodb.MongoHostBase with ScalaObject with Product with Serializable" id="213613">MongoPair</a><a href="#213613" title="ScalaObject" class="delimiter">(</a><a title="com.mongodb.ServerAddress" id="213603">left</a>: <span title="com.mongodb.ServerAddress">ServerAddress</span>, <a title="com.mongodb.ServerAddress" id="213604">right</a>: <span title="com.mongodb.ServerAddress">ServerAddress</span>, <a title="com.mongodb.MongoOptions" id="213610">options</a>: <span title="com.mongodb.MongoOptions">MongoOptions</span> = <span title="com.mongodb.MongoOptions" class="keyword">new</span> <span title="com.mongodb.MongoOptions">MongoOptions</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#12323" title="net.liftweb.mongodb.MongoHostBase">MongoHostBase</a> <span class="delimiter">{</span>
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="com.mongodb.Mongo" id="212998">mongo</a> = <span title="(x$1: com.mongodb.ServerAddress, x$2: com.mongodb.ServerAddress, x$3: com.mongodb.MongoOptions)com.mongodb.Mongo" class="keyword">new</span> <span title="com.mongodb.Mongo">Mongo</span><span class="delimiter">(</span><a href="#213603" title="=&gt; com.mongodb.ServerAddress">left</a>, <a href="#213604" title="=&gt; com.mongodb.ServerAddress">right</a>, <a href="#213610" title="=&gt; com.mongodb.MongoOptions">options</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/*
 * Wrapper for creating a Replica Set
 */</span>
case <span class="keyword">class</span> <a title="class MongoSet extends net.liftweb.mongodb.MongoHostBase with ScalaObject with Product with Serializable" id="213597">MongoSet</a><a href="#213597" title="ScalaObject" class="delimiter">(</a><a title="List[com.mongodb.ServerAddress]" id="213589">dbs</a>: <span title="List[com.mongodb.ServerAddress]">List</span><span class="delimiter">[</span>ServerAddress<span class="delimiter">]</span>, <a title="com.mongodb.MongoOptions" id="213594">options</a>: <span title="com.mongodb.MongoOptions">MongoOptions</span> = <span title="com.mongodb.MongoOptions" class="keyword">new</span> <span title="com.mongodb.MongoOptions">MongoOptions</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#12323" title="net.liftweb.mongodb.MongoHostBase">MongoHostBase</a> <span class="delimiter">{</span>
  <span class="keyword">import</span> scala.collection.<span title="object scala.collection.JavaConversions">JavaConversions</span>._
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="com.mongodb.Mongo" id="213092">mongo</a> = <span title="(x$1: java.util.List[com.mongodb.ServerAddress], x$2: com.mongodb.MongoOptions)com.mongodb.Mongo" class="keyword">new</span> <span title="com.mongodb.Mongo">Mongo</span><span class="delimiter">(</span><a href="#213589" title="(b: Seq[com.mongodb.ServerAddress])java.util.List[com.mongodb.ServerAddress]">dbs</a>, <a href="#213594" title="=&gt; com.mongodb.MongoOptions">options</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/*
* Main Mongo object
*/</span>
<span class="keyword">object</span> <a title="object net.liftweb.mongodb.MongoDB" id="12333">MongoDB</a> <span title="ScalaObject" class="delimiter">{</span>

  <span class="comment">/*
  * HashMap of MongoAddresses, keyed by MongoIdentifier
  */</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentHashMap[net.liftweb.mongodb.MongoIdentifier,net.liftweb.mongodb.MongoAddress]" id="200762">dbs</a> = <span title="()java.util.concurrent.ConcurrentHashMap[net.liftweb.mongodb.MongoIdentifier,net.liftweb.mongodb.MongoAddress]" class="keyword">new</span> <span title="java.util.concurrent.ConcurrentHashMap[net.liftweb.mongodb.MongoIdentifier,net.liftweb.mongodb.MongoAddress]">ConcurrentHashMap</span><span class="delimiter">[</span>MongoIdentifier, MongoAddress<span class="delimiter">]</span>

  <span class="comment">/*
  * Define a Mongo db
  */</span>
  <span class="keyword">def</span> <a title="(name: net.liftweb.mongodb.MongoIdentifier, address: net.liftweb.mongodb.MongoAddress)Unit" id="200764">defineDb</a><span class="delimiter">(</span><a title="net.liftweb.mongodb.MongoIdentifier" id="213426">name</a>: <a href="#12317" title="net.liftweb.mongodb.MongoIdentifier">MongoIdentifier</a>, <a title="net.liftweb.mongodb.MongoAddress" id="213427">address</a>: <a href="#213617" title="net.liftweb.mongodb.MongoAddress">MongoAddress</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#200762" title="=&gt; java.util.concurrent.ConcurrentHashMap[net.liftweb.mongodb.MongoIdentifier,net.liftweb.mongodb.MongoAddress]">dbs</a>.<span title="(x$1: net.liftweb.mongodb.MongoIdentifier, x$2: net.liftweb.mongodb.MongoAddress)net.liftweb.mongodb.MongoAddress">put</span><span title="Unit" class="delimiter">(</span><a href="#213426" title="net.liftweb.mongodb.MongoIdentifier">name</a>, <a href="#213427" title="net.liftweb.mongodb.MongoAddress">address</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="comment">/*
   * Define a Mongo db using a standard Mongo instance.
   */</span>
  <span class="keyword">def</span> <a title="(name: net.liftweb.mongodb.MongoIdentifier, mngo: com.mongodb.Mongo, dbName: String)Unit" id="200765">defineDb</a><span class="delimiter">(</span><a title="net.liftweb.mongodb.MongoIdentifier" id="213435">name</a>: <a href="#12317" title="net.liftweb.mongodb.MongoIdentifier">MongoIdentifier</a>, <a title="com.mongodb.Mongo" id="213436">mngo</a>: <span title="com.mongodb.Mongo">Mongo</span>, <a title="String" id="213437">dbName</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#200762" title="=&gt; java.util.concurrent.ConcurrentHashMap[net.liftweb.mongodb.MongoIdentifier,net.liftweb.mongodb.MongoAddress]">dbs</a>.<span title="(x$1: net.liftweb.mongodb.MongoIdentifier, x$2: net.liftweb.mongodb.MongoAddress)net.liftweb.mongodb.MongoAddress">put</span><span title="Unit" class="delimiter">(</span><a href="#213435" title="net.liftweb.mongodb.MongoIdentifier">name</a>, <a href="#213617" title="(host: net.liftweb.mongodb.MongoHostBase, name: String)net.liftweb.mongodb.MongoAddress">MongoAddress</a><span class="delimiter">(</span><a href="#213446" title="net.liftweb.mongodb.MongoHostBase" class="keyword">new</a> <a href="#12323" title="anonymous class $anon extends net.liftweb.mongodb.MongoHostBase" id="213446">MongoHostBase</a> <span class="delimiter">{</span> <span class="keyword">def</span> <a title="=&gt; com.mongodb.Mongo" id="213450">mongo</a> = <a href="#213436" title="com.mongodb.Mongo">mngo</a> <span class="delimiter">}</span>, <a href="#213437" title="String">dbName</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/*
  * Define and authenticate a Mongo db
  */</span>
  <span class="keyword">def</span> <a title="(name: net.liftweb.mongodb.MongoIdentifier, address: net.liftweb.mongodb.MongoAddress, username: String, password: String)Unit" id="200766">defineDbAuth</a><span class="delimiter">(</span><a title="net.liftweb.mongodb.MongoIdentifier" id="213452">name</a>: <a href="#12317" title="net.liftweb.mongodb.MongoIdentifier">MongoIdentifier</a>, <a title="net.liftweb.mongodb.MongoAddress" id="213453">address</a>: <a href="#213617" title="net.liftweb.mongodb.MongoAddress">MongoAddress</a>, <a title="String" id="213454">username</a>: <span title="String">String</span>, <a title="String" id="213455">password</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#213453" title="net.liftweb.mongodb.MongoAddress">address</a>.<a href="#212448" title="=&gt; com.mongodb.DB">db</a>.<span title="(x$1: java.lang.String, x$2: Array[Char])Boolean">authenticate</span><span class="delimiter">(</span><a href="#213454" title="String">username</a>, <a href="#213455" title="String">password</a>.<span title="()Array[Char]">toCharArray</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">throw</span> <span title="com.mongodb.MongoException" class="keyword">new</span> <span title="com.mongodb.MongoException">MongoException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Authorization failed: &quot;)" class="string">&quot;Authorization failed: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#213453" title="net.liftweb.mongodb.MongoAddress">address</a>.<a href="#213617" title="()String">toString</a><span class="delimiter">)</span>

    <a href="#200762" title="=&gt; java.util.concurrent.ConcurrentHashMap[net.liftweb.mongodb.MongoIdentifier,net.liftweb.mongodb.MongoAddress]">dbs</a>.<span title="(x$1: net.liftweb.mongodb.MongoIdentifier, x$2: net.liftweb.mongodb.MongoAddress)net.liftweb.mongodb.MongoAddress">put</span><span title="Unit" class="delimiter">(</span><a href="#213452" title="net.liftweb.mongodb.MongoIdentifier">name</a>, <a href="#213453" title="net.liftweb.mongodb.MongoAddress">address</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/*
  * Define and authenticate a Mongo db using a standard Mongo instance.
  */</span>
  <span class="keyword">def</span> <a title="(name: net.liftweb.mongodb.MongoIdentifier, mngo: com.mongodb.Mongo, dbName: String, username: String, password: String)Unit" id="200767">defineDbAuth</a><span class="delimiter">(</span><a title="net.liftweb.mongodb.MongoIdentifier" id="213490">name</a>: <a href="#12317" title="net.liftweb.mongodb.MongoIdentifier">MongoIdentifier</a>, <a title="com.mongodb.Mongo" id="213491">mngo</a>: <span title="com.mongodb.Mongo">Mongo</span>, <a title="String" id="213492">dbName</a>: <span title="String">String</span>, <a title="String" id="213493">username</a>: <span title="String">String</span>, <a title="String" id="213494">password</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#213491" title="com.mongodb.Mongo">mngo</a>.<span title="(x$1: java.lang.String)com.mongodb.DB">getDB</span><span class="delimiter">(</span><a href="#213492" title="String">dbName</a><span class="delimiter">)</span>.<span title="(x$1: java.lang.String, x$2: Array[Char])Boolean">authenticate</span><span class="delimiter">(</span><a href="#213493" title="String">username</a>, <a href="#213494" title="String">password</a>.<span title="()Array[Char]">toCharArray</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">throw</span> <span title="com.mongodb.MongoException" class="keyword">new</span> <span title="com.mongodb.MongoException">MongoException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Authorization failed: &quot;)" class="string">&quot;Authorization failed: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#213491" title="com.mongodb.Mongo">mngo</a>.<span title="()java.lang.String">toString</span><span class="delimiter">)</span>

    <a href="#200762" title="=&gt; java.util.concurrent.ConcurrentHashMap[net.liftweb.mongodb.MongoIdentifier,net.liftweb.mongodb.MongoAddress]">dbs</a>.<span title="(x$1: net.liftweb.mongodb.MongoIdentifier, x$2: net.liftweb.mongodb.MongoAddress)net.liftweb.mongodb.MongoAddress">put</span><span title="Unit" class="delimiter">(</span><a href="#213490" title="net.liftweb.mongodb.MongoIdentifier">name</a>, <a href="#213617" title="(host: net.liftweb.mongodb.MongoHostBase, name: String)net.liftweb.mongodb.MongoAddress">MongoAddress</a><span class="delimiter">(</span><a href="#213500" title="net.liftweb.mongodb.MongoHostBase" class="keyword">new</a> <a href="#12323" title="anonymous class $anon extends net.liftweb.mongodb.MongoHostBase" id="213500">MongoHostBase</a> <span class="delimiter">{</span> <span class="keyword">def</span> <a title="=&gt; com.mongodb.Mongo" id="213504">mongo</a> = <a href="#213491" title="com.mongodb.Mongo">mngo</a> <span class="delimiter">}</span>, <a href="#213492" title="String">dbName</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/*
  * Get a DB reference
  */</span>
  <span class="keyword">def</span> <a title="(name: net.liftweb.mongodb.MongoIdentifier)Option[com.mongodb.DB]" id="200768">getDb</a><span class="delimiter">(</span><a title="net.liftweb.mongodb.MongoIdentifier" id="213506">name</a>: <a href="#12317" title="net.liftweb.mongodb.MongoIdentifier">MongoIdentifier</a><span class="delimiter">)</span>: <span title="Option[com.mongodb.DB]">Option</span><span class="delimiter">[</span>DB<span class="delimiter">]</span> = <a href="#200762" title="=&gt; java.util.concurrent.ConcurrentHashMap[net.liftweb.mongodb.MongoIdentifier,net.liftweb.mongodb.MongoAddress]">dbs</a>.<span title="(x$1: Any)net.liftweb.mongodb.MongoAddress">get</span><span class="delimiter">(</span><a href="#213506" title="net.liftweb.mongodb.MongoIdentifier">name</a><span class="delimiter">)</span> <span title="Option[com.mongodb.DB]" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="None.type" class="keyword">null</span> =&gt; <span title="object None">None</span>
    <span class="keyword">case</span> <a title="Some[com.mongodb.DB]" id="213508">ma</a>: <a href="#213617" title="net.liftweb.mongodb.MongoAddress">MongoAddress</a> =&gt; <span title="(x: com.mongodb.DB)Some[com.mongodb.DB]">Some</span><span class="delimiter">(</span><a href="#213508" title="net.liftweb.mongodb.MongoAddress">ma</a>.<a href="#212448" title="=&gt; com.mongodb.DB">db</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/*
  * Get a Mongo collection. Gets a Mongo db first.
  */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(name: net.liftweb.mongodb.MongoIdentifier, collectionName: String)Option[com.mongodb.DBCollection]" id="200769">getCollection</a><span class="delimiter">(</span><a title="net.liftweb.mongodb.MongoIdentifier" id="213512">name</a>: <a href="#12317" title="net.liftweb.mongodb.MongoIdentifier">MongoIdentifier</a>, <a title="String" id="213513">collectionName</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[com.mongodb.DBCollection]">Option</span><span class="delimiter">[</span>DBCollection<span class="delimiter">]</span> = <a href="#200768" title="(name: net.liftweb.mongodb.MongoIdentifier)Option[com.mongodb.DB]">getDb</a><span class="delimiter">(</span><a href="#213512" title="net.liftweb.mongodb.MongoIdentifier">name</a><span class="delimiter">)</span> <span title="Option[com.mongodb.DBCollection]" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="Some[com.mongodb.DBCollection]">Some</span><span class="delimiter">(</span><a title="com.mongodb.DB" id="213516">mongo</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#213516" title="com.mongodb.DB">mongo</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span> =&gt; <span title="(x: com.mongodb.DBCollection)Some[com.mongodb.DBCollection]">Some</span><span class="delimiter">(</span><a href="#213516" title="com.mongodb.DB">mongo</a>.<span title="(x$1: java.lang.String)com.mongodb.DBCollection">getCollection</span><span class="delimiter">(</span><a href="#213513" title="String">collectionName</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <span title="None.type">_</span> =&gt; <span title="object None">None</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
  * Executes function {@code f} with the mongo db named {@code name}.
  */</span>
  <span class="keyword">def</span> <a title="[T](name: net.liftweb.mongodb.MongoIdentifier)(f: com.mongodb.DB =&gt; T)T" id="200770">use</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="200772">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="net.liftweb.mongodb.MongoIdentifier" id="204285">name</a>: <a href="#12317" title="net.liftweb.mongodb.MongoIdentifier">MongoIdentifier</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="com.mongodb.DB =&gt; T" id="204286">f</a>: <span class="delimiter">(</span>DB<span class="delimiter">)</span> =&gt; T<span class="delimiter">)</span>: <a href="#200772" title="T">T</a> = <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="com.mongodb.DB" id="213524">db</a> = <a href="#200768" title="(name: net.liftweb.mongodb.MongoIdentifier)Option[com.mongodb.DB]">getDb</a><span class="delimiter">(</span><a href="#204285" title="net.liftweb.mongodb.MongoIdentifier">name</a><span class="delimiter">)</span> <span title="com.mongodb.DB" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="com.mongodb.DB">Some</span><span class="delimiter">(</span><a title="com.mongodb.DB" id="213526">mongo</a><span class="delimiter">)</span> =&gt; <a href="#213526" title="com.mongodb.DB">mongo</a>
      <span class="keyword">case</span> <span title="Nothing">_</span> =&gt; <span title="Nothing" class="keyword">throw</span> <span title="com.mongodb.MongoException" class="keyword">new</span> <span title="com.mongodb.MongoException">MongoException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Mongo not found: &quot;)" class="string">&quot;Mongo not found: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#204285" title="net.liftweb.mongodb.MongoIdentifier">name</a>.<a href="#201151" title="()java.lang.String">toString</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="#204286" title="(v1: com.mongodb.DB)T">f</a><span class="delimiter">(</span><a href="#213524" title="com.mongodb.DB">db</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
  * Executes function {@code f} with the mongo named {@code name}. Uses the default mongoIdentifier
  */</span>
  <span class="keyword">def</span> <a title="[T](f: com.mongodb.DB =&gt; T)T" id="200773">use</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="200775">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="com.mongodb.DB =&gt; T" id="204280">f</a>: <span class="delimiter">(</span>DB<span class="delimiter">)</span> =&gt; T<span class="delimiter">)</span>: <a href="#200775" title="T">T</a> = <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="com.mongodb.DB" id="213532">db</a> = <a href="#200768" title="(name: net.liftweb.mongodb.MongoIdentifier)Option[com.mongodb.DB]">getDb</a><span class="delimiter">(</span><a href="#212440" title="object net.liftweb.mongodb.DefaultMongoIdentifier">DefaultMongoIdentifier</a><span class="delimiter">)</span> <span title="com.mongodb.DB" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="com.mongodb.DB">Some</span><span class="delimiter">(</span><a title="com.mongodb.DB" id="213534">mongo</a><span class="delimiter">)</span> =&gt; <a href="#213534" title="com.mongodb.DB">mongo</a>
      <span class="keyword">case</span> <span title="Nothing">_</span> =&gt; <span title="Nothing" class="keyword">throw</span> <span title="com.mongodb.MongoException" class="keyword">new</span> <span title="com.mongodb.MongoException">MongoException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Mongo not found: &quot;)" class="string">&quot;Mongo not found: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#212440" title="object net.liftweb.mongodb.DefaultMongoIdentifier">DefaultMongoIdentifier</a>.<a href="#201151" title="()java.lang.String">toString</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="#204280" title="(v1: com.mongodb.DB)T">f</a><span class="delimiter">(</span><a href="#213532" title="com.mongodb.DB">db</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
  * Executes function {@code f} with the mongo named {@code name} and collection names {@code collectionName}.
  * Gets a collection for you.
  */</span>
  <span class="keyword">def</span> <a title="[T](name: net.liftweb.mongodb.MongoIdentifier, collectionName: String)(f: com.mongodb.DBCollection =&gt; T)T" id="200776">useCollection</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="200778">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="net.liftweb.mongodb.MongoIdentifier" id="201141">name</a>: <a href="#12317" title="net.liftweb.mongodb.MongoIdentifier">MongoIdentifier</a>, <a title="String" id="201142">collectionName</a>: <span title="String">String</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="com.mongodb.DBCollection =&gt; T" id="201143">f</a>: <span class="delimiter">(</span>DBCollection<span class="delimiter">)</span> =&gt; T<span class="delimiter">)</span>: <a href="#200778" title="T">T</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="com.mongodb.DBCollection" id="213540">coll</a> = <a href="#200769" title="(name: net.liftweb.mongodb.MongoIdentifier, collectionName: String)Option[com.mongodb.DBCollection]">getCollection</a><span class="delimiter">(</span><a href="#201141" title="net.liftweb.mongodb.MongoIdentifier">name</a>, <a href="#201142" title="String">collectionName</a><span class="delimiter">)</span> <span title="com.mongodb.DBCollection" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="com.mongodb.DBCollection">Some</span><span class="delimiter">(</span><a title="com.mongodb.DBCollection" id="213542">collection</a><span class="delimiter">)</span> =&gt; <a href="#213542" title="com.mongodb.DBCollection">collection</a>
      <span class="keyword">case</span> <span title="Nothing">_</span> =&gt; <span title="Nothing" class="keyword">throw</span> <span title="com.mongodb.MongoException" class="keyword">new</span> <span title="com.mongodb.MongoException">MongoException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Collection not found: &quot;)" class="string">&quot;Collection not found: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#201142" title="String">collectionName</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;. MongoIdentifier: &quot;)" class="string">&quot;. MongoIdentifier: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#201141" title="net.liftweb.mongodb.MongoIdentifier">name</a>.<a href="#201151" title="()java.lang.String">toString</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="#201143" title="(v1: com.mongodb.DBCollection)T">f</a><span class="delimiter">(</span><a href="#213540" title="com.mongodb.DBCollection">coll</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
  * Same as above except uses DefaultMongoIdentifier
  */</span>
  <span class="keyword">def</span> <a title="[T](collectionName: String)(f: com.mongodb.DBCollection =&gt; T)T" id="200779">useCollection</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="200781">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="String" id="200791">collectionName</a>: <span title="String">String</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="com.mongodb.DBCollection =&gt; T" id="200792">f</a>: <span class="delimiter">(</span>DBCollection<span class="delimiter">)</span> =&gt; T<span class="delimiter">)</span>: <a href="#200781" title="T">T</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="com.mongodb.DBCollection" id="213548">coll</a> = <a href="#200769" title="(name: net.liftweb.mongodb.MongoIdentifier, collectionName: String)Option[com.mongodb.DBCollection]">getCollection</a><span class="delimiter">(</span><a href="#212440" title="object net.liftweb.mongodb.DefaultMongoIdentifier">DefaultMongoIdentifier</a>, <a href="#200791" title="String">collectionName</a><span class="delimiter">)</span> <span title="com.mongodb.DBCollection" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="com.mongodb.DBCollection">Some</span><span class="delimiter">(</span><a title="com.mongodb.DBCollection" id="213550">collection</a><span class="delimiter">)</span> =&gt; <a href="#213550" title="com.mongodb.DBCollection">collection</a>
      <span class="keyword">case</span> <span title="Nothing">_</span> =&gt; <span title="Nothing" class="keyword">throw</span> <span title="com.mongodb.MongoException" class="keyword">new</span> <span title="com.mongodb.MongoException">MongoException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Collection not found: &quot;)" class="string">&quot;Collection not found: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#200791" title="String">collectionName</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;. MongoIdentifier: &quot;)" class="string">&quot;. MongoIdentifier: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#212440" title="object net.liftweb.mongodb.DefaultMongoIdentifier">DefaultMongoIdentifier</a>.<a href="#201151" title="()java.lang.String">toString</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="#200792" title="(v1: com.mongodb.DBCollection)T">f</a><span class="delimiter">(</span><a href="#213548" title="com.mongodb.DBCollection">coll</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
  * Executes function {@code f} with the mongo db named {@code name}. Uses the same socket
  * for the entire function block. Allows multiple operations on the same thread/socket connection
  * and the use of getLastError.
  * See: http://www.mongodb.org/display/DOCS/Java+Driver+Concurrency
  */</span>
  <span class="keyword">def</span> <a title="[T](name: net.liftweb.mongodb.MongoIdentifier)(f: com.mongodb.DB =&gt; T)T" id="200782">useSession</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="200784">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="net.liftweb.mongodb.MongoIdentifier" id="213556">name</a>: <a href="#12317" title="net.liftweb.mongodb.MongoIdentifier">MongoIdentifier</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="com.mongodb.DB =&gt; T" id="213557">f</a>: <span class="delimiter">(</span>DB<span class="delimiter">)</span> =&gt; T<span class="delimiter">)</span>: <a href="#200784" title="T">T</a> = <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="com.mongodb.DB" id="213560">db</a> = <a href="#200768" title="(name: net.liftweb.mongodb.MongoIdentifier)Option[com.mongodb.DB]">getDb</a><span class="delimiter">(</span><a href="#213556" title="net.liftweb.mongodb.MongoIdentifier">name</a><span class="delimiter">)</span> <span title="com.mongodb.DB" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="com.mongodb.DB">Some</span><span class="delimiter">(</span><a title="com.mongodb.DB" id="213562">mongo</a><span class="delimiter">)</span> =&gt; <a href="#213562" title="com.mongodb.DB">mongo</a>
      <span class="keyword">case</span> <span title="Nothing">_</span> =&gt; <span title="Nothing" class="keyword">throw</span> <span title="com.mongodb.MongoException" class="keyword">new</span> <span title="com.mongodb.MongoException">MongoException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Mongo not found: &quot;)" class="string">&quot;Mongo not found: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#213556" title="net.liftweb.mongodb.MongoIdentifier">name</a>.<a href="#201151" title="()java.lang.String">toString</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="comment">// start the request</span>
    <a href="#213560" title="com.mongodb.DB">db</a>.<span title="()Unit">requestStart</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#213557" title="(v1: com.mongodb.DB)T">f</a><span class="delimiter">(</span><a href="#213560" title="com.mongodb.DB">db</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">finally</span> <span class="delimiter">{</span>
      <span class="comment">// end the request</span>
      <a href="#213560" title="com.mongodb.DB">db</a>.<span title="()Unit">requestDone</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
  * Same as above except uses DefaultMongoIdentifier
  */</span>
  <span class="keyword">def</span> <a title="[T](f: com.mongodb.DB =&gt; T)T" id="200785">useSession</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="200787">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="com.mongodb.DB =&gt; T" id="213568">f</a>: <span class="delimiter">(</span>DB<span class="delimiter">)</span> =&gt; T<span class="delimiter">)</span>: <a href="#200787" title="T">T</a> = <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="com.mongodb.DB" id="213571">db</a> = <a href="#200768" title="(name: net.liftweb.mongodb.MongoIdentifier)Option[com.mongodb.DB]">getDb</a><span class="delimiter">(</span><a href="#212440" title="object net.liftweb.mongodb.DefaultMongoIdentifier">DefaultMongoIdentifier</a><span class="delimiter">)</span> <span title="com.mongodb.DB" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="com.mongodb.DB">Some</span><span class="delimiter">(</span><a title="com.mongodb.DB" id="213573">mongo</a><span class="delimiter">)</span> =&gt; <a href="#213573" title="com.mongodb.DB">mongo</a>
      <span class="keyword">case</span> <span title="Nothing">_</span> =&gt; <span title="Nothing" class="keyword">throw</span> <span title="com.mongodb.MongoException" class="keyword">new</span> <span title="com.mongodb.MongoException">MongoException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Mongo not found: &quot;)" class="string">&quot;Mongo not found: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#212440" title="object net.liftweb.mongodb.DefaultMongoIdentifier">DefaultMongoIdentifier</a>.<a href="#201151" title="()java.lang.String">toString</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="comment">// start the request</span>
    <a href="#213571" title="com.mongodb.DB">db</a>.<span title="()Unit">requestStart</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#213568" title="(v1: com.mongodb.DB)T">f</a><span class="delimiter">(</span><a href="#213571" title="com.mongodb.DB">db</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">finally</span> <span class="delimiter">{</span>
      <span class="comment">// end the request</span>
      <a href="#213571" title="com.mongodb.DB">db</a>.<span title="()Unit">requestDone</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">//</span>
  <span class="keyword">def</span> <a title="=&gt; Unit" id="200788">close</a> <span class="delimiter">{</span>
    <a href="#200762" title="=&gt; java.util.concurrent.ConcurrentHashMap[net.liftweb.mongodb.MongoIdentifier,net.liftweb.mongodb.MongoAddress]">dbs</a>.<span title="()Unit">clear</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
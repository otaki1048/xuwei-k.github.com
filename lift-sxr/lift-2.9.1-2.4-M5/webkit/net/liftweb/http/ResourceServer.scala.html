<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>webkit/net/liftweb/http/ResourceServer.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright 2007-2011 WorldWide Conferencing, LLC
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

<span class="keyword">package</span> net.liftweb
<span class="keyword">package</span> http

<span class="keyword">import</span> net.liftweb.common.<span class="delimiter">{</span>Box, Full, Empty<span class="delimiter">}</span>
<span class="keyword">import</span> net.liftweb.util._
<span class="keyword">import</span> <a href="../../../../util/net/liftweb/util/Helpers.scala.html#13346" title="object net.liftweb.util.Helpers">Helpers</a>._
<span class="keyword">import</span> java.net.<span class="delimiter">{</span>URL, URLConnection, JarURLConnection<span class="delimiter">}</span>
<span class="keyword">import</span> java.util.concurrent.<span class="delimiter">{</span>ConcurrentHashMap =&gt; CHash<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object net.liftweb.http.ResourceServer" id="14613">ResourceServer</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">var</span> <a title="PartialFunction[List[String],Boolean]" id="412364">allowedPaths</a>: <span title="PartialFunction[List[String],Boolean]">PartialFunction</span><span class="delimiter">[</span>List<span class="delimiter">[</span>String<span class="delimiter">]</span>, Boolean<span class="delimiter">]</span> = <a href="#412386" title="Boolean" class="delimiter">{</a>
    <span class="keyword">case</span> <span title="Boolean(true)" class="string">&quot;jquery.js&quot;</span> :: <span title="object Nil">Nil</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
    <span class="keyword">case</span> <span title="Boolean(true)" class="string">&quot;yui&quot;</span> :: _ =&gt; <span title="Boolean(true)" class="keyword">true</span>
    <span class="keyword">case</span> <span title="Boolean(true)" class="string">&quot;liftYUI.js&quot;</span> :: <span title="object Nil">Nil</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
    <span class="keyword">case</span> <span title="Boolean(true)" class="string">&quot;extcore&quot;</span> :: _ =&gt; <span title="Boolean(true)" class="keyword">true</span>
    <span class="keyword">case</span> <span title="Boolean(true)" class="string">&quot;liftExtCore.js&quot;</span> :: <span title="object Nil">Nil</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
    <span class="keyword">case</span> <span title="Boolean(true)" class="string">&quot;json2.js&quot;</span> :: <span title="object Nil">Nil</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
    <span class="keyword">case</span> <span title="Boolean(true)" class="string">&quot;json.js&quot;</span> :: <span title="object Nil">Nil</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
    <span class="keyword">case</span> <span title="Boolean(true)" class="string">&quot;jlift.js&quot;</span> :: <span title="object Nil">Nil</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
    <span class="keyword">case</span> <a title="Boolean(true)" id="412419">bp</a>@<span class="delimiter">(</span><span title="java.lang.String(&quot;blueprint&quot;)" class="string">&quot;blueprint&quot;</span> :: _<span class="delimiter">)</span> <span class="keyword">if</span> <a href="#412419" title="collection.immutable.::[String]">bp</a>.<span title="=&gt; String">last</span>.<span title="(x$1: java.lang.String)Boolean">endsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;.css&quot;)" class="string">&quot;.css&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <a href="#412419" title="collection.immutable.::[String]">bp</a>.<span title="=&gt; String">last</span>.<span title="(x$1: java.lang.String)Boolean">endsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;.png&quot;)" class="string">&quot;.png&quot;</span><span class="delimiter">)</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
    <span class="keyword">case</span> <span title="Boolean(true)" class="string">&quot;jquery-autocomplete&quot;</span> :: <span title="java.lang.String(&quot;jquery.autocomplete.js&quot;)" class="string">&quot;jquery.autocomplete.js&quot;</span> :: <span title="object Nil">Nil</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
    <span class="keyword">case</span> <span title="Boolean(true)" class="string">&quot;jquery-autocomplete&quot;</span> :: <span title="java.lang.String(&quot;jquery.autocomplete.css&quot;)" class="string">&quot;jquery.autocomplete.css&quot;</span> :: <span title="object Nil">Nil</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
    <span class="keyword">case</span> <span title="Boolean(true)" class="string">&quot;jquery-autocomplete&quot;</span> :: <span title="java.lang.String(&quot;indicator.gif&quot;)" class="string">&quot;indicator.gif&quot;</span> :: <span title="object Nil">Nil</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; java.lang.Object with PartialFunction[List[String],List[String]]" id="412366">rewriter</a> = <a href="#412451" title="java.lang.Object with PartialFunction[List[String],List[String]]" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with PartialFunction[List[String],List[String]]" id="412451">PartialFunction</a><span class="delimiter">[</span>List<span class="delimiter">[</span>String<span class="delimiter">]</span>, List<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(in: List[String])Boolean" id="412453">isDefinedAt</a><span class="delimiter">(</span><a title="List[String]" id="412455">in</a>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158871" title="=&gt; net.liftweb.http.js.JSArtifacts">jsArtifacts</a>.<a href="js/JSArtifacts.scala.html#327573" title="=&gt; PartialFunction[List[String],List[String]]">pathRewriter</a>.<span title="(x: List[String])Boolean">isDefinedAt</span><span class="delimiter">(</span><a href="#412455" title="List[String]">in</a><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="(in: List[String])List[String]" id="412454">apply</a><span class="delimiter">(</span><a title="List[String]" id="412467">in</a>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158871" title="=&gt; net.liftweb.http.js.JSArtifacts">jsArtifacts</a>.<a href="js/JSArtifacts.scala.html#327573" title="(v1: List[String])List[String]">pathRewriter</a><span class="delimiter">(</span><a href="#412467" title="List[String]">in</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  @volatile <span class="keyword">var</span> <a title="PartialFunction[List[String],List[String]]" id="412368">pathRewriter</a>: <span title="PartialFunction[List[String],List[String]]">PartialFunction</span><span class="delimiter">[</span>List<span class="delimiter">[</span>String<span class="delimiter">]</span>, List<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span> = <a href="#412366" title="=&gt; java.lang.Object with PartialFunction[List[String],List[String]]">rewriter</a> <span title="(that: PartialFunction[List[String],List[String]])PartialFunction[List[String],List[String]]">orElse</span> <a href="#412499" title="List[String]" class="delimiter">{</a>
    <span class="keyword">case</span> <span title="List[java.lang.String]" class="string">&quot;json.js&quot;</span> :: <span title="object Nil">Nil</span> =&gt; <span title="(xs: java.lang.String*)List[java.lang.String]">List</span><span class="delimiter">(</span><span title="java.lang.String(&quot;json2-min.js&quot;)" class="string">&quot;json2-min.js&quot;</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <span title="List[java.lang.String]" class="string">&quot;json2.js&quot;</span> :: <span title="object Nil">Nil</span> =&gt; <span title="(xs: java.lang.String*)List[java.lang.String]">List</span><span class="delimiter">(</span><span title="java.lang.String(&quot;json2-min.js&quot;)" class="string">&quot;json2-min.js&quot;</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <a title="List[String]" id="412522">xs</a> =&gt; <a href="#412522" title="List[String]">xs</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * The base package for serving resources.  This way, resource names can't be spoofed
   */</span>
  <span class="keyword">var</span> <a title="java.lang.String" id="412371">baseResourceLocation</a> = <span title="java.lang.String(&quot;toserve&quot;)" class="string">&quot;toserve&quot;</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentHashMap[String,Long]" id="412373">lastModCache</a>: <span title="java.util.concurrent.ConcurrentHashMap[String,Long]">CHash</span><span class="delimiter">[</span>String, Long<span class="delimiter">]</span> = <span title="()java.util.concurrent.ConcurrentHashMap[String,Long]" class="keyword">new</span> <span title="java.util.concurrent.ConcurrentHashMap[String,Long]">CHash</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(in: java.net.URL)Long" id="412375">calcLastModified</a><span class="delimiter">(</span><a title="java.net.URL" id="412641">in</a>: <span title="java.net.URL">URL</span><span class="delimiter">)</span>: <span title="Long">Long</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.lang.String" id="412643">str</a> = <a href="#412641" title="java.net.URL">in</a>.<span title="()java.lang.String">toString</span>
    <span title="Long" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="../../../../util/net/liftweb/util/Props.scala.html#13579" title="object net.liftweb.util.Props">Props</a>.<a href="../../../../util/net/liftweb/util/Props.scala.html#151319" title="=&gt; Boolean">devMode</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#412373" title="=&gt; java.util.concurrent.ConcurrentHashMap[String,Long]">lastModCache</a>.<span title="(x$1: Any)Boolean">containsKey</span><span class="delimiter">(</span><a href="#412643" title="java.lang.String">str</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#412373" title="=&gt; java.util.concurrent.ConcurrentHashMap[String,Long]">lastModCache</a>.<span title="(x$1: Any)Long">get</span><span class="delimiter">(</span><a href="#412643" title="java.lang.String">str</a><span class="delimiter">)</span>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Long" id="412644">ret</a>: <span title="Long">Long</span> =
      <span class="delimiter">(</span><span class="keyword">for</span><span class="delimiter">{</span>
        <a title="java.net.URLConnection" id="412690">uc</a> &lt;- <a href="../../../../util/net/liftweb/util/ControlHelpers.scala.html#48608" title="(f: =&gt; java.net.URLConnection)net.liftweb.common.Box[java.net.URLConnection]">tryo</a><a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: java.net.URLConnection =&gt; Long)net.liftweb.common.Box[Long]" class="delimiter">(</a><a href="#412641" title="java.net.URL">in</a>.<span title="()java.net.URLConnection">openConnection</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">yield</span> <span class="delimiter">{</span>
          <a href="#412690" title="java.net.URLConnection">uc</a>.<span title="()Long">getLastModified</span> <span title="Long" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="Long" class="long">0L</span> =&gt; <a href="#412690" title="java.net.URLConnection">uc</a> <span title="Long" class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <a title="Long" id="412691">jc</a>: <span title="java.net.JarURLConnection">JarURLConnection</span> =&gt; <a href="#412691" title="java.net.JarURLConnection">jc</a>.<span title="()java.util.jar.JarEntry">getJarEntry</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="Long" class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <span title="Long(0L)" class="keyword">null</span> =&gt; <span title="Long(0L)" class="long">0L</span>
                <span class="keyword">case</span> <a title="Long" id="412882">e</a> =&gt; <a href="#412882" title="java.util.jar.JarEntry">e</a>.<span title="()Long">getTime</span><span class="delimiter">(</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>
              <span class="keyword">case</span> <span title="Long(0L)">_</span> =&gt; <span title="Long(0L)" class="long">0L</span>
            <span class="delimiter">}</span>
            <span class="keyword">case</span> <a title="Long" id="412883">x</a> =&gt; <a href="#412883" title="Long">x</a>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; Long)Long">openOr</a> <span title="Long(0L)" class="long">0L</span>
      <a href="#412373" title="=&gt; java.util.concurrent.ConcurrentHashMap[String,Long]">lastModCache</a>.<span title="(x$1: String, x$2: Long)Long">put</span><span class="delimiter">(</span><a href="#412643" title="java.lang.String">str</a>, <a href="#412644" title="Long">ret</a><span class="delimiter">)</span>
      <a href="#412644" title="Long">ret</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>


  <span class="keyword">def</span> <a title="(request: net.liftweb.http.Req, uri: List[String])()net.liftweb.common.Box[net.liftweb.http.LiftResponse]" id="412376">findResourceInClasspath</a><span class="delimiter">(</span><a title="net.liftweb.http.Req" id="412896">request</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a>, <a title="List[String]" id="412897">uri</a>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">Box</a><span class="delimiter">[</span>LiftResponse<span class="delimiter">]</span> =
    <span class="keyword">for</span><span class="delimiter">{</span>
      <a title="List[String]" id="412951">auri</a> &lt;- <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: List[String])net.liftweb.common.Full[List[String]]">Full</a><span class="delimiter">(</span><a href="#412897" title="List[String]">uri</a>.<span title="(p: String =&gt; Boolean)List[String]">filter</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#412904" title="String">_</a>.<span title="(x$1: java.lang.String)Boolean">startsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;.&quot;)" class="string">&quot;.&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27114" title="(p: List[String] =&gt; Boolean)net.liftweb.common.Box[List[String]]">filter</a><a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: List[String] =&gt; (List[String], List[String], String))net.liftweb.common.Box[(List[String], List[String], String)]" class="delimiter">(</a><a title="List[String]" id="412913">auri</a> =&gt; <a href="#412378" title="(path: List[String])Boolean">isAllowed</a><span class="delimiter">(</span><a href="#412913" title="List[String]">auri</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a title="List[String]" id="412952">rw</a> = <a href="#412371" title="=&gt; java.lang.String">baseResourceLocation</a> <a href="#412926" title="(x: String)List[String]">::</a> <a href="#412368" title="(v1: List[String])List[String]">pathRewriter</a><span class="delimiter">(</span><a href="#412951" title="List[String]">auri</a><span class="delimiter">)</span>
      <a title="String" id="412953">path</a> = <a href="#412952" title="List[String]">rw</a>.<span title="(start: String, sep: String, end: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span>, <span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
      <a title="java.net.URL" id="412979">url</a> &lt;- <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159083" title="(v1: String)net.liftweb.common.Box[java.net.URL]">getResource</a><a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: java.net.URL =&gt; (java.net.URL, Long))net.liftweb.common.Box[(java.net.URL, Long)]" class="delimiter">(</a><a href="#412953" title="String">path</a><span class="delimiter">)</span>
      <a title="Long" id="412980">lastModified</a> = <a href="#412375" title="(in: java.net.URL)Long">calcLastModified</a><span class="delimiter">(</span><a href="#412979" title="java.net.URL">url</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">yield</span>
      <a href="#412896" title="net.liftweb.http.Req">request</a>.<a href="Req.scala.html#149230" title="(lastModified: Long, headers: (String, String)*)net.liftweb.common.Box[net.liftweb.http.LiftResponse]">testFor304</a><span class="delimiter">(</span><a href="#412980" title="Long">lastModified</a>, <a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#49003" title="implicit net.liftweb.util.BindHelpers.strToSuperArrowAssoc : (in: String)net.liftweb.util.Helpers.SuperArrowAssoc" class="string">&quot;Expires&quot;</a> <a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#58380" title="(in: String)net.liftweb.util.Helpers.TheStrBindParam">-&gt;</a> <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48830" title="(in: Long)String">toInternetDate</a><span class="delimiter">(</span><a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48788" title="=&gt; Long">millis</a> <span title="(x: Long)Long">+</span> <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48777" title="implicit net.liftweb.util.TimeHelpers.intToTimeSpanBuilder : (in: Int)net.liftweb.util.Helpers.TimeSpanBuilder" class="int">30</a>.<a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#188674" title="implicit net.liftweb.util.ConvertableToDate.toMillis : (in: net.liftweb.util.ConvertableToDate)Long">days</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; net.liftweb.http.LiftResponse)net.liftweb.http.LiftResponse">openOr</a> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="java.io.InputStream" id="413037">stream</a> = <a href="#412979" title="java.net.URL">url</a>.<span title="()java.io.InputStream">openStream</span>
        <span class="keyword">val</span> <a title="java.net.URLConnection" id="413038">uc</a> = <a href="#412979" title="java.net.URL">url</a>.<span title="()java.net.URLConnection">openConnection</span>
        <a href="LiftResponse.scala.html#353780" title="(data: AnyRef{def read(buf: Array[Byte]): Int}, onEnd: () =&gt; Unit, size: Long, headers: List[(String, String)], cookies: List[net.liftweb.http.provider.HTTPCookie], code: Int)net.liftweb.http.StreamingResponse">StreamingResponse</a><span class="delimiter">(</span><a href="#413037" title="java.io.InputStream">stream</a>, <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#413037" title="java.io.InputStream">stream</a>.<span title="()Unit">close</span>, <a href="#413038" title="java.net.URLConnection">uc</a>.<span title="=&gt; Long">getContentLength</span>,
          <span class="delimiter">(</span><span title="List[net.liftweb.util.Helpers.TheStrBindParam]" class="keyword">if</span> <span class="delimiter">(</span><a href="#412980" title="Long">lastModified</a> <span title="(x: Long)Boolean">==</span> <span title="Long(0L)" class="long">0L</span><span class="delimiter">)</span> <span title="object Nil">Nil</span> <span class="keyword">else</span>
            <span title="(xs: net.liftweb.util.Helpers.TheStrBindParam*)List[net.liftweb.util.Helpers.TheStrBindParam]">List</span><span class="delimiter">(</span><a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#49003" title="implicit net.liftweb.util.BindHelpers.strToSuperArrowAssoc : (in: String)net.liftweb.util.Helpers.SuperArrowAssoc" class="string">&quot;Last-Modified&quot;</a> <a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#58380" title="(in: String)net.liftweb.util.Helpers.TheStrBindParam">-&gt;</a> <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48830" title="(in: Long)String">toInternetDate</a><span class="delimiter">(</span><a href="#412980" title="Long">lastModified</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#413054" title="(prefix: List[net.liftweb.util.Helpers.TheStrBindParam])List[net.liftweb.util.Helpers.TheStrBindParam]">:::</a>
                  <span title="(xs: net.liftweb.util.Helpers.TheStrBindParam*)List[net.liftweb.util.Helpers.TheStrBindParam]">List</span><span class="delimiter">(</span><a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#49003" title="implicit net.liftweb.util.BindHelpers.strToSuperArrowAssoc : (in: String)net.liftweb.util.Helpers.SuperArrowAssoc" class="string">&quot;Expires&quot;</a> <a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#58380" title="(in: String)net.liftweb.util.Helpers.TheStrBindParam">-&gt;</a> <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48830" title="(in: Long)String">toInternetDate</a><span class="delimiter">(</span><a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48788" title="=&gt; Long">millis</a> <span title="(x: Long)Long">+</span> <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48777" title="implicit net.liftweb.util.TimeHelpers.intToTimeSpanBuilder : (in: Int)net.liftweb.util.Helpers.TimeSpanBuilder" class="int">30</a>.<a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#188674" title="implicit net.liftweb.util.ConvertableToDate.toMillis : (in: net.liftweb.util.ConvertableToDate)Long">days</a><span class="delimiter">)</span>,
                       <a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#49003" title="implicit net.liftweb.util.BindHelpers.strToSuperArrowAssoc : (in: String)net.liftweb.util.Helpers.SuperArrowAssoc" class="string">&quot;Date&quot;</a> <a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#58380" title="(in: String)net.liftweb.util.Helpers.TheStrBindParam">-&gt;</a> <a href="../../../../util/net/liftweb/util/Helpers.scala.html#13346" title="object net.liftweb.util.Helpers">Helpers</a>.<a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48831" title="=&gt; String">nowAsInternetDate</a>,
                       <a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#49003" title="implicit net.liftweb.util.BindHelpers.strToSuperArrowAssoc : (in: String)net.liftweb.util.Helpers.SuperArrowAssoc" class="string">&quot;Pragma&quot;</a> <a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#58380" title="(in: String)net.liftweb.util.Helpers.TheStrBindParam">-&gt;</a> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>,
                       <a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#49003" title="implicit net.liftweb.util.BindHelpers.strToSuperArrowAssoc : (in: String)net.liftweb.util.Helpers.SuperArrowAssoc" class="string">&quot;Cache-Control&quot;</a> <a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#58380" title="(in: String)net.liftweb.util.Helpers.TheStrBindParam">-&gt;</a> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>,
                       <a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#49003" title="implicit net.liftweb.util.BindHelpers.strToSuperArrowAssoc : (in: String)net.liftweb.util.Helpers.SuperArrowAssoc" class="string">&quot;Content-Type&quot;</a> <a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#58380" title="(in: String)net.liftweb.util.Helpers.TheStrBindParam">-&gt;</a> <a href="#412377" title="(path: String)String">detectContentType</a><span class="delimiter">(</span><a href="#412952" title="List[String]">rw</a>.<span title="=&gt; String">last</span><span class="delimiter">)</span><span class="delimiter">)</span>, <span title="object Nil">Nil</span>,
          <span title="Int(200)" class="int">200</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>


  <span class="comment">/**
   * detect the Content-Type of file (path) with context-defined content-types
   * (application's web.xml or container's configuration), and fall
   * back to system or JVM-defined (FileNameMap) content types.
   * if no content-type found, then return &quot;application/octet-stream&quot;
   *
   * @param path Resource name to be analyzed to detect MIME type
   *
   * @see HTTPContext # mimeType ( String )
   * @see URLConnection # getFileNameMap ( )
   */</span>
  <span class="keyword">def</span> <a title="(path: String)String" id="412377">detectContentType</a><span class="delimiter">(</span><a title="String" id="413319">path</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
    <span class="comment">// Configure response with content type of resource</span>
    <span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159072" title="=&gt; net.liftweb.http.provider.HTTPContext">context</a>.<a href="provider/HTTPContext.scala.html#356960" title="(path: String)net.liftweb.common.Box[String]">mimeType</a><span class="delimiter">(</span><a href="#413319" title="String">path</a><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27043" title="(alternative: =&gt; net.liftweb.common.Box[String])net.liftweb.common.Box[String]">or</a>
            <span class="delimiter">(</span><a href="../../../../common/net/liftweb/common/Box.scala.html#10572" title="object net.liftweb.common.Box">Box</a> <a href="../../../../common/net/liftweb/common/Box.scala.html#28636" title="(in: java.lang.String)net.liftweb.common.Box[java.lang.String]">!!</a> <span title="object java.net.URLConnection">URLConnection</span>.<span title="()java.net.FileNameMap">getFileNameMap</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: java.lang.String)java.lang.String">getContentTypeFor</span><span class="delimiter">(</span><a href="#413319" title="String">path</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; String)String">openOr</a>
            <span title="java.lang.String(&quot;application/octet-stream&quot;)" class="string">&quot;application/octet-stream&quot;</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(path: List[String])Boolean" id="412378">isAllowed</a><span class="delimiter">(</span><a title="List[String]" id="412914">path</a>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#412364" title="=&gt; PartialFunction[List[String],Boolean]">allowedPaths</a>.<span title="(x: List[String])Boolean">isDefinedAt</span><span class="delimiter">(</span><a href="#412914" title="List[String]">path</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#412364" title="(v1: List[String])Boolean">allowedPaths</a><span class="delimiter">(</span><a href="#412914" title="List[String]">path</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(path: PartialFunction[List[String],Boolean])Unit" id="412379">allow</a><span class="delimiter">(</span><a title="PartialFunction[List[String],Boolean]" id="413368">path</a>: <span title="PartialFunction[List[String],Boolean]">PartialFunction</span><span class="delimiter">[</span>List<span class="delimiter">[</span>String<span class="delimiter">]</span>, Boolean<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#412364" title="(x$1: PartialFunction[List[String],Boolean])Unit">allowedPaths</a> = <a href="#413368" title="PartialFunction[List[String],Boolean]">path</a> <span title="(that: PartialFunction[List[String],Boolean])PartialFunction[List[String],Boolean]">orElse</span> <a href="#412364" title="=&gt; PartialFunction[List[String],Boolean]">allowedPaths</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(rw: PartialFunction[List[String],List[String]])Unit" id="412380">rewrite</a><span class="delimiter">(</span><a title="PartialFunction[List[String],List[String]]" id="413377">rw</a>: <span title="PartialFunction[List[String],List[String]]">PartialFunction</span><span class="delimiter">[</span>List<span class="delimiter">[</span>String<span class="delimiter">]</span>, List<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#412368" title="(x$1: PartialFunction[List[String],List[String]])Unit">pathRewriter</a> = <a href="#413377" title="PartialFunction[List[String],List[String]]">rw</a> <span title="(that: PartialFunction[List[String],List[String]])PartialFunction[List[String],List[String]]">orElse</span> <a href="#412368" title="=&gt; PartialFunction[List[String],List[String]]">pathRewriter</a>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>


        </pre>
    </body>
</html>
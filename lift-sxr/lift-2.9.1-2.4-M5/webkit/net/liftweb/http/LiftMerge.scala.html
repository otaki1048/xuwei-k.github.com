<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>webkit/net/liftweb/http/LiftMerge.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright 2009-2011 WorldWide Conferencing, LLC
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

<span class="keyword">package</span> net.liftweb
<span class="keyword">package</span> http

<span class="keyword">import</span> scala.collection.mutable.<span class="delimiter">{</span>HashMap, ArrayBuffer, ListBuffer<span class="delimiter">}</span>
<span class="keyword">import</span> scala.xml._
<span class="keyword">import</span> net.liftweb.util._
<span class="keyword">import</span> net.liftweb.common._
<span class="keyword">import</span> net.liftweb.http.js._
<span class="keyword">import</span> <a href="../../../../util/net/liftweb/util/Helpers.scala.html#13346" title="object net.liftweb.util.Helpers">Helpers</a>._


<span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">trait</span> <a title="trait LiftMerge extends java.lang.Object with ScalaObject" id="14197">LiftMerge</a> <span title="ScalaObject" class="delimiter">{</span>
  self: LiftSession =&gt;

  <span class="comment">/**
   * Manages the merge phase of the rendering pipeline
   */</span>
  <span class="keyword">def</span> <a title="(xhtml: scala.xml.NodeSeq, req: net.liftweb.http.Req)scala.xml.Node" id="230138">merge</a><span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="350234">xhtml</a>: <span title="scala.xml.NodeSeq">NodeSeq</span>, <a title="net.liftweb.http.Req" id="350235">req</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a><span class="delimiter">)</span>: <span title="scala.xml.Node">Node</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[String,net.liftweb.common.Box[scala.xml.NodeSeq]]" id="350237">snippetHashs</a>: <span title="scala.collection.mutable.HashMap[String,net.liftweb.common.Box[scala.xml.NodeSeq]]">HashMap</span><span class="delimiter">[</span>String, Box<span class="delimiter">[</span>NodeSeq<span class="delimiter">]</span><span class="delimiter">]</span> = <a href="#14197" title="LiftMerge.this.type" class="keyword">this</a>.<a href="LiftSession.scala.html#230203" title="object LiftMerge.this.deferredSnippets">deferredSnippets</a>.<a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75375" title="=&gt; scala.collection.mutable.HashMap[String,net.liftweb.common.Box[scala.xml.NodeSeq]]">is</a>
    <span class="keyword">val</span> <a title="Long" id="350238">waitUntil</a> = <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48788" title="=&gt; Long">millis</a> <span title="(x: Long)Long">+</span> <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159030" title="=&gt; net.liftweb.http.LiftRules#FactoryMaker[net.liftweb.util.Helpers.TimeSpan]">lazySnippetTimeout</a>.<a href="Factory.scala.html#159330" title="=&gt; net.liftweb.util.Helpers.TimeSpan">vend</a>.<a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#58452" title="=&gt; Long">millis</a>
    <span class="keyword">val</span> <a title="Boolean" id="350239">stripComments</a>: <span title="Boolean">Boolean</span> = <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159040" title="=&gt; net.liftweb.http.LiftRules#FactoryMaker[Boolean]">stripComments</a>.<a href="Factory.scala.html#159330" title="=&gt; Boolean">vend</a>

    <span class="keyword">def</span> <a title="()Unit" id="350240">waitUntilSnippetsDone</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Long" id="350280">myMillis</a> = <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48788" title="=&gt; Long">millis</a>
      <a href="#350237" title="scala.collection.mutable.HashMap[String,net.liftweb.common.Box[scala.xml.NodeSeq]]">snippetHashs</a>.<span title="(x$1: Unit)Unit">synchronized</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#350280" title="Long">myMillis</a> <span title="(x: Long)Boolean">&gt;=</span> <a href="#350238" title="Long">waitUntil</a> <span title="(x: Boolean)Boolean">||</span> <a href="#350237" title="scala.collection.mutable.HashMap[String,net.liftweb.common.Box[scala.xml.NodeSeq]]">snippetHashs</a>.<span title="=&gt; Boolean">isEmpty</span> <span title="(x: Boolean)Boolean">||</span> <span title="=&gt; Boolean">!</span><a href="#350237" title="scala.collection.mutable.HashMap[String,net.liftweb.common.Box[scala.xml.NodeSeq]]">snippetHashs</a>.<span title="=&gt; Iterable[net.liftweb.common.Box[scala.xml.NodeSeq]]">values</span>.<span title="=&gt; Iterator[net.liftweb.common.Box[scala.xml.NodeSeq]]">toIterator</span>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
        <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#350237" title="scala.collection.mutable.HashMap[String,net.liftweb.common.Box[scala.xml.NodeSeq]]">snippetHashs</a>.<span title="(x$1: Long)Unit">wait</span><span class="delimiter">(</span><a href="#350238" title="Long">waitUntil</a> <span title="(x: Long)Long">-</span> <a href="#350280" title="Long">myMillis</a><span class="delimiter">)</span>
          <a href="#350240" title="()Unit">waitUntilSnippetsDone</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <a href="#350240" title="()Unit">waitUntilSnippetsDone</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Map[String,scala.xml.NodeSeq]" id="350241">processedSnippets</a>: <span title="Map[String,scala.xml.NodeSeq]">Map</span><span class="delimiter">[</span>String, NodeSeq<span class="delimiter">]</span> = <span title="(elems: (String, scala.xml.NodeSeq)*)scala.collection.immutable.Map[String,scala.xml.NodeSeq]">Map</span><span class="delimiter">(</span><a href="#350237" title="scala.collection.mutable.HashMap[String,net.liftweb.common.Box[scala.xml.NodeSeq]]">snippetHashs</a>.<span title="=&gt; List[(String, net.liftweb.common.Box[scala.xml.NodeSeq])]">toList</span>.<span title="(f: (String, net.liftweb.common.Box[scala.xml.NodeSeq]) =&gt; scala.collection.GenTraversableOnce[(String, scala.xml.NodeSeq)])(implicit bf: scala.collection.generic.CanBuildFrom[List[(String, net.liftweb.common.Box[scala.xml.NodeSeq])],(String, scala.xml.NodeSeq),List[(String, scala.xml.NodeSeq)]])List[(String, scala.xml.NodeSeq)]">flatMap</span> <a href="#350330" title="List[(String, scala.xml.NodeSeq)]" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="List[(String, scala.xml.NodeSeq)]" class="delimiter">(</span><a title="String" id="350333">name</a>, Full<span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="350335">value</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span title="(xs: (String, scala.xml.NodeSeq)*)List[(String, scala.xml.NodeSeq)]">List</span><span class="delimiter">(</span><span title="(_1: String, _2: scala.xml.NodeSeq)(String, scala.xml.NodeSeq)" class="delimiter">(</span><a href="#350333" title="String">name</a>, <a href="#350335" title="scala.xml.NodeSeq">value</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="List[(String, scala.xml.NodeSeq)]" class="delimiter">(</span><a title="String" id="350351">name</a>, <a title="net.liftweb.common.Failure" id="350352">f</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10586" title="net.liftweb.common.Failure">Failure</a><span class="delimiter">)</span> =&gt; <span title="(xs: (String, scala.xml.NodeSeq)*)List[(String, scala.xml.NodeSeq)]">List</span><span class="delimiter">(</span><span title="(_1: String, _2: scala.xml.NodeSeq)(String, scala.xml.NodeSeq)" class="delimiter">(</span><a href="#350351" title="String">name</a>, <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159036" title="=&gt; net.liftweb.http.LiftRules#FactoryMaker[net.liftweb.common.Failure =&gt; scala.xml.NodeSeq]">deferredSnippetFailure</a>.<a href="Factory.scala.html#159330" title="(v1: net.liftweb.common.Failure)scala.xml.NodeSeq">vend</a><span class="delimiter">(</span><a href="#350352" title="net.liftweb.common.Failure">f</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="List[(String, scala.xml.NodeSeq)]" class="delimiter">(</span><a title="String" id="350378">name</a>, <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a><span class="delimiter">)</span> =&gt; <span title="(xs: (String, scala.xml.NodeSeq)*)List[(String, scala.xml.NodeSeq)]">List</span><span class="delimiter">(</span><span title="(_1: String, _2: scala.xml.NodeSeq)(String, scala.xml.NodeSeq)" class="delimiter">(</span><a href="#350378" title="String">name</a>, <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159038" title="=&gt; net.liftweb.http.LiftRules#FactoryMaker[scala.xml.NodeSeq]">deferredSnippetTimeout</a>.<a href="Factory.scala.html#159330" title="=&gt; scala.xml.NodeSeq">vend</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="scala.collection.immutable.Nil.type">_</span> =&gt; <span title="object Nil">Nil</span>
    <span class="delimiter">}</span>: _*<span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Boolean" id="350242">hasHtmlHeadAndBody</a>: <span title="Boolean">Boolean</span> = <a href="#350234" title="scala.xml.NodeSeq">xhtml</a>.<span title="(p: scala.xml.Node =&gt; Boolean)Option[scala.xml.Node]">find</span> <a href="#350436" title="Boolean" class="delimiter">{</a>
      <span class="keyword">case</span> <a title="Boolean" id="350437">e</a>: <span title="scala.xml.Elem">Elem</span> <span class="keyword">if</span> <a href="#350437" title="scala.xml.Elem">e</a>.<span title="=&gt; String">label</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;html&quot;)" class="string">&quot;html&quot;</span> =&gt;
        <a href="#350437" title="scala.xml.Elem">e</a>.<span title="=&gt; scala.xml.Node*">child</span>.<span title="(p: scala.xml.Node =&gt; Boolean)Option[scala.xml.Node]">find</span> <a href="#350447" title="Boolean" class="delimiter">{</a>
          <span class="keyword">case</span> <a title="Boolean(true)" id="350448">e</a>: <span title="scala.xml.Elem">Elem</span> <span class="keyword">if</span> <a href="#350448" title="scala.xml.Elem">e</a>.<span title="=&gt; String">label</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;head&quot;)" class="string">&quot;head&quot;</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
          <span class="keyword">case</span> <span title="Boolean(false)">_</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
        <span class="delimiter">}</span>.<span title="=&gt; Boolean">isDefined</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
                <a href="#350437" title="scala.xml.Elem">e</a>.<span title="=&gt; scala.xml.Node*">child</span>.<span title="(p: scala.xml.Node =&gt; Boolean)Option[scala.xml.Node]">find</span> <a href="#350454" title="Boolean" class="delimiter">{</a>
                  <span class="keyword">case</span> <a title="Boolean(true)" id="350455">e</a>: <span title="scala.xml.Elem">Elem</span> <span class="keyword">if</span> <a href="#350455" title="scala.xml.Elem">e</a>.<span title="=&gt; String">label</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;body&quot;)" class="string">&quot;body&quot;</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
                  <span class="keyword">case</span> <span title="Boolean(false)">_</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
                <span class="delimiter">}</span>.<span title="=&gt; Boolean">isDefined</span>
      <span class="keyword">case</span> <span title="Boolean(false)">_</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span>.<span title="=&gt; Boolean">isDefined</span>


    <span class="keyword">var</span> <a title="scala.xml.Elem" id="350243">htmlTag</a> = &lt;<a title="scala.xml.NamespaceBinding" id="350461">html</a> xmlns=<span title="java.lang.String(&quot;http://www.w3.org/1999/xhtml&quot;)" class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span> xmlns:lift=<span title="java.lang.String(&quot;http://liftweb.net&quot;)" class="symbol">'http</span><span class="comment">://liftweb.net'/&gt;</span>
    <span class="keyword">var</span> <a title="scala.xml.Elem" id="350244">headTag</a> = &lt;<span title="scala.xml.Elem">head</span>/&gt;
    <span class="keyword">var</span> <a title="scala.xml.Elem" id="350245">bodyTag</a> = &lt;<span title="scala.xml.Elem">body</span>/&gt;
    <span class="keyword">val</span> <a title="scala.collection.mutable.ListBuffer[scala.xml.Node]" id="350246">headChildren</a> = <span title="scala.collection.mutable.ListBuffer[scala.xml.Node]" class="keyword">new</span> <span title="scala.collection.mutable.ListBuffer[scala.xml.Node]">ListBuffer</span><span class="delimiter">[</span>Node<span class="delimiter">]</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ListBuffer[scala.xml.Node]" id="350247">bodyChildren</a> = <span title="scala.collection.mutable.ListBuffer[scala.xml.Node]" class="keyword">new</span> <span title="scala.collection.mutable.ListBuffer[scala.xml.Node]">ListBuffer</span><span class="delimiter">[</span>Node<span class="delimiter">]</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ListBuffer[scala.xml.Node]" id="350248">addlHead</a> = <span title="scala.collection.mutable.ListBuffer[scala.xml.Node]" class="keyword">new</span> <span title="scala.collection.mutable.ListBuffer[scala.xml.Node]">ListBuffer</span><span class="delimiter">[</span>Node<span class="delimiter">]</span>
    <a href="#350248" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">addlHead</a> <span title="(xs: scala.collection.TraversableOnce[scala.xml.Node])addlHead.type">++=</span> <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49335" title="()List[scala.xml.Elem]">forHead</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ListBuffer[scala.xml.Node]" id="350249">addlTail</a> = <span title="scala.collection.mutable.ListBuffer[scala.xml.Node]" class="keyword">new</span> <span title="scala.collection.mutable.ListBuffer[scala.xml.Node]">ListBuffer</span><span class="delimiter">[</span>Node<span class="delimiter">]</span>
    <a href="#350249" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">addlTail</a> <span title="(xs: scala.collection.TraversableOnce[scala.xml.Node])addlTail.type">++=</span> <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49337" title="()List[scala.xml.Elem]">atEndOfBody</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ListBuffer[net.liftweb.http.CometVersionPair]" id="350250">cometTimes</a> = <span title="scala.collection.mutable.ListBuffer[net.liftweb.http.CometVersionPair]" class="keyword">new</span> <span title="scala.collection.mutable.ListBuffer[net.liftweb.http.CometVersionPair]">ListBuffer</span><span class="delimiter">[</span>CometVersionPair<span class="delimiter">]</span>
    <span class="keyword">val</span> <a title="net.liftweb.common.Box[String =&gt; String]" id="350251">rewrite</a> = <a href="Req.scala.html#14583" title="object net.liftweb.http.URLRewriter">URLRewriter</a>.<a href="Req.scala.html#350484" title="=&gt; net.liftweb.common.Box[String =&gt; String]">rewriteFunc</a>
    <span class="keyword">val</span> <a title="(String, Seq[scala.xml.Node], Boolean, net.liftweb.common.Box[String =&gt; String]) =&gt; scala.xml.Text" id="350252">fixHref</a> = <a href="Req.scala.html#14562" title="object net.liftweb.http.Req">Req</a>.<a href="Req.scala.html#185918" title="=&gt; (String, Seq[scala.xml.Node], Boolean, net.liftweb.common.Box[String =&gt; String]) =&gt; scala.xml.Text">fixHref</a>

    <span class="keyword">val</span> <a title="String" id="350253">contextPath</a>: <span title="String">String</span> = <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49480" title="=&gt; String">contextPath</a>

    <span class="keyword">def</span> <a title="(original: scala.xml.MetaData, toFix: String, attrs: scala.xml.MetaData, fixURL: Boolean)scala.xml.MetaData" id="350254">fixAttrs</a><span class="delimiter">(</span><a title="scala.xml.MetaData" id="350497">original</a>: <span title="scala.xml.MetaData">MetaData</span>, <a title="String" id="350498">toFix</a>: <span title="String">String</span>, <a title="scala.xml.MetaData" id="350499">attrs</a>: <span title="scala.xml.MetaData">MetaData</span>, <a title="Boolean" id="350500">fixURL</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="scala.xml.MetaData">MetaData</span> = <a href="#350499" title="scala.xml.MetaData">attrs</a> <span title="scala.xml.MetaData" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="scala.xml.Null.type">Null</span> =&gt; <span title="object scala.xml.Null">Null</span>
      <span class="keyword">case</span> <a title="scala.xml.MetaData" id="350501">p</a>: <span title="scala.xml.PrefixedAttribute">PrefixedAttribute</span> <span class="keyword">if</span> <a href="#350501" title="scala.xml.PrefixedAttribute">p</a>.<span title="=&gt; String">key</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;when&quot;)" class="string">&quot;when&quot;</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#350501" title="scala.xml.PrefixedAttribute">p</a>.<span title="=&gt; String">pre</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;lift&quot;)" class="string">&quot;lift&quot;</span> =&gt;
        <span class="keyword">val</span> <a title="String" id="350510">when</a> = <a href="#350501" title="scala.xml.PrefixedAttribute">p</a>.<span title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">value</span>.<span title="=&gt; String">text</span>
        <a href="#350497" title="scala.xml.MetaData">original</a>.<span title="(p: scala.xml.MetaData =&gt; Boolean)Option[scala.xml.MetaData]">find</span><span class="delimiter">(</span><a title="scala.xml.MetaData" id="350522">a</a> =&gt; <span title="=&gt; Boolean">!</span><a href="#350522" title="scala.xml.MetaData">a</a>.<span title="=&gt; Boolean">isPrefixed</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#350522" title="scala.xml.MetaData">a</a>.<span title="=&gt; String">key</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;id&quot;)" class="string">&quot;id&quot;</span><span class="delimiter">)</span>.<span title="(f: scala.xml.MetaData =&gt; scala.collection.mutable.ListBuffer[net.liftweb.http.CometVersionPair])Option[scala.collection.mutable.ListBuffer[net.liftweb.http.CometVersionPair]]">map</span> <span class="delimiter">{</span>
          <a title="scala.xml.MetaData" id="350532">id</a> =&gt;
                  <a href="#350250" title="scala.collection.mutable.ListBuffer[net.liftweb.http.CometVersionPair]">cometTimes</a> <span title="(x: net.liftweb.http.CometVersionPair)cometTimes.type">+=</span> <a href="LiftRules.scala.html#350546" title="(guid: String, version: Long)net.liftweb.http.CVP">CVP</a><span class="delimiter">(</span><a href="#350532" title="scala.xml.MetaData">id</a>.<span title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">value</span>.<span title="=&gt; String">text</span>, <a href="#350510" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">when</a>.<span title="=&gt; Long">toLong</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#350254" title="(original: scala.xml.MetaData, toFix: String, attrs: scala.xml.MetaData, fixURL: Boolean)scala.xml.MetaData">fixAttrs</a><span class="delimiter">(</span><a href="#350497" title="scala.xml.MetaData">original</a>, <a href="#350498" title="String">toFix</a>, <a href="#350501" title="scala.xml.PrefixedAttribute">p</a>.<span title="=&gt; scala.xml.MetaData">next</span>, <a href="#350500" title="Boolean">fixURL</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="scala.xml.UnprefixedAttribute" id="350571">u</a>: <span title="scala.xml.UnprefixedAttribute">UnprefixedAttribute</span> <span class="keyword">if</span> <a href="#350571" title="scala.xml.UnprefixedAttribute">u</a>.<span title="=&gt; String">key</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#350498" title="String">toFix</a> =&gt;
        <span title="scala.xml.UnprefixedAttribute" class="keyword">new</span> <span title="scala.xml.UnprefixedAttribute">UnprefixedAttribute</span><span class="delimiter">(</span><a href="#350498" title="String">toFix</a>, <a href="#350252" title="(v1: String, v2: Seq[scala.xml.Node], v3: Boolean, v4: net.liftweb.common.Box[String =&gt; String])scala.xml.Text">fixHref</a><span class="delimiter">(</span><a href="#350253" title="String">contextPath</a>, <a href="#350499" title="scala.xml.MetaData">attrs</a>.<span title="=&gt; Seq[scala.xml.Node]">value</span>, <a href="#350500" title="Boolean">fixURL</a>, <a href="#350251" title="net.liftweb.common.Box[String =&gt; String]">rewrite</a><span class="delimiter">)</span>, <a href="#350254" title="(original: scala.xml.MetaData, toFix: String, attrs: scala.xml.MetaData, fixURL: Boolean)scala.xml.MetaData">fixAttrs</a><span class="delimiter">(</span><a href="#350497" title="scala.xml.MetaData">original</a>, <a href="#350498" title="String">toFix</a>, <a href="#350499" title="scala.xml.MetaData">attrs</a>.<span title="=&gt; scala.xml.MetaData">next</span>, <a href="#350500" title="Boolean">fixURL</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="scala.xml.MetaData">_</span> =&gt; <a href="#350499" title="scala.xml.MetaData">attrs</a>.<span title="(next: scala.xml.MetaData)scala.xml.MetaData">copy</span><span class="delimiter">(</span><a href="#350254" title="(original: scala.xml.MetaData, toFix: String, attrs: scala.xml.MetaData, fixURL: Boolean)scala.xml.MetaData">fixAttrs</a><span class="delimiter">(</span><a href="#350497" title="scala.xml.MetaData">original</a>, <a href="#350498" title="String">toFix</a>, <a href="#350499" title="scala.xml.MetaData">attrs</a>.<span title="=&gt; scala.xml.MetaData">next</span>, <a href="#350500" title="Boolean">fixURL</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(in: scala.xml.NodeSeq, _inHtml: Boolean, _inHead: Boolean, _justHead: Boolean, _inBody: Boolean, _justBody: Boolean, _bodyHead: Boolean, _bodyTail: Boolean, doMergy: Boolean)scala.xml.NodeSeq" id="350255">_fixHtml</a><span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="350584">in</a>: <span title="scala.xml.NodeSeq">NodeSeq</span>, <a title="Boolean" id="350585">_inHtml</a>: <span title="Boolean">Boolean</span>, <a title="Boolean" id="350586">_inHead</a>: <span title="Boolean">Boolean</span>, <a title="Boolean" id="350587">_justHead</a>: <span title="Boolean">Boolean</span>, <a title="Boolean" id="350588">_inBody</a>: <span title="Boolean">Boolean</span>, <a title="Boolean" id="350589">_justBody</a>: <span title="Boolean">Boolean</span>, <a title="Boolean" id="350590">_bodyHead</a>: <span title="Boolean">Boolean</span>, <a title="Boolean" id="350591">_bodyTail</a>: <span title="Boolean">Boolean</span>, <a title="Boolean" id="350592">doMergy</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="scala.xml.NodeSeq">NodeSeq</span> = <span class="delimiter">{</span>
      <a href="#350584" title="scala.xml.NodeSeq">in</a>.<span title="(f: scala.xml.Node =&gt; scala.collection.GenTraversableOnce[scala.xml.Node])(implicit bf: scala.collection.generic.CanBuildFrom[scala.xml.NodeSeq,scala.xml.Node,scala.xml.NodeSeq])scala.xml.NodeSeq">flatMap</span> <span title="=&gt; scala.collection.generic.CanBuildFrom[scala.xml.NodeSeq.Coll,scala.xml.Node,scala.xml.NodeSeq]" class="delimiter">{</span>
        <a title="scala.xml.Node" id="350609">v</a> =&gt;
                <span class="keyword">var</span> <a title="Boolean" id="350610">inHtml</a> = <a href="#350585" title="Boolean">_inHtml</a>
                <span class="keyword">var</span> <a title="Boolean" id="350611">inHead</a> = <a href="#350586" title="Boolean">_inHead</a>
                <span class="keyword">var</span> <a title="Boolean" id="350612">justHead</a> = <span title="Boolean(false)" class="keyword">false</span>
                <span class="keyword">var</span> <a title="Boolean" id="350613">justBody</a> = <span title="Boolean(false)" class="keyword">false</span>
                <span class="keyword">var</span> <a title="Boolean" id="350614">inBody</a> = <a href="#350588" title="Boolean">_inBody</a>
                <span class="keyword">var</span> <a title="Boolean" id="350615">bodyHead</a> = <span title="Boolean(false)" class="keyword">false</span>
                <span class="keyword">var</span> <a title="Boolean" id="350616">bodyTail</a> = <span title="Boolean(false)" class="keyword">false</span>

                <a href="#350609" title="scala.xml.Node">v</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
                  <span class="keyword">case</span> <a title="Unit" id="350618">e</a>: <span title="scala.xml.Elem">Elem</span> <span class="keyword">if</span> <a href="#350618" title="scala.xml.Elem">e</a>.<span title="=&gt; String">label</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;html&quot;)" class="string">&quot;html&quot;</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> 
                  <span title="=&gt; Boolean">!</span><a href="#350610" title="Boolean">inHtml</a> =&gt; <a href="#350243" title="scala.xml.Elem">htmlTag</a> = <a href="#350618" title="scala.xml.Elem">e</a>; <a href="#350610" title="Boolean">inHtml</a> = <span title="Boolean(true)" class="keyword">true</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#350592" title="Boolean">doMergy</a>

                  <span class="keyword">case</span> <a title="Unit" id="350623">e</a>: <span title="scala.xml.Elem">Elem</span> <span class="keyword">if</span> <a href="#350623" title="scala.xml.Elem">e</a>.<span title="=&gt; String">label</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;head&quot;)" class="string">&quot;head&quot;</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#350610" title="Boolean">inHtml</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> 
                  <span title="=&gt; Boolean">!</span><a href="#350614" title="Boolean">inBody</a> =&gt; <a href="#350244" title="scala.xml.Elem">headTag</a> = <a href="#350623" title="scala.xml.Elem">e</a>; 
                  <a href="#350611" title="Boolean">inHead</a> = <span title="Boolean(true)" class="keyword">true</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#350592" title="Boolean">doMergy</a>; <a href="#350612" title="Boolean">justHead</a> = <span title="Boolean(true)" class="keyword">true</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#350592" title="Boolean">doMergy</a>

                  <span class="keyword">case</span> <a title="Unit" id="350628">e</a>: <span title="scala.xml.Elem">Elem</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#350628" title="scala.xml.Elem">e</a>.<span title="=&gt; String">label</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;head&quot;)" class="string">&quot;head&quot;</span> <span title="(x: Boolean)Boolean">||</span> 
                                   <a href="#350628" title="scala.xml.Elem">e</a>.<span title="=&gt; String">label</span>.<span title="(x$1: java.lang.String)Boolean">startsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;head_&quot;)" class="string">&quot;head_&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> 
                  <a href="#350610" title="Boolean">inHtml</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#350614" title="Boolean">inBody</a> =&gt; <a href="#350615" title="Boolean">bodyHead</a> = <span title="Boolean(true)" class="keyword">true</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#350592" title="Boolean">doMergy</a>

                  <span class="keyword">case</span> <a title="Unit" id="350635">e</a>: <span title="scala.xml.Elem">Elem</span> <span class="keyword">if</span> <a href="#350635" title="scala.xml.Elem">e</a>.<span title="=&gt; String">label</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;tail&quot;)" class="string">&quot;tail&quot;</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#350610" title="Boolean">inHtml</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> 
                  <a href="#350614" title="Boolean">inBody</a> =&gt; <a href="#350616" title="Boolean">bodyTail</a> = <span title="Boolean(true)" class="keyword">true</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#350592" title="Boolean">doMergy</a>

                  <span class="keyword">case</span> <a title="Unit" id="350640">e</a>: <span title="scala.xml.Elem">Elem</span> <span class="keyword">if</span> <a href="#350640" title="scala.xml.Elem">e</a>.<span title="=&gt; String">label</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;body&quot;)" class="string">&quot;body&quot;</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#350610" title="Boolean">inHtml</a> =&gt;
                    <a href="#350245" title="scala.xml.Elem">bodyTag</a> = <a href="#350640" title="scala.xml.Elem">e</a>; <a href="#350614" title="Boolean">inBody</a> = <span title="Boolean(true)" class="keyword">true</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#350592" title="Boolean">doMergy</a>; 
                  <a href="#350613" title="Boolean">justBody</a> = <span title="Boolean(true)" class="keyword">true</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#350592" title="Boolean">doMergy</a>

                  <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
                <span class="delimiter">}</span>

                <span class="keyword">val</span> <a title="scala.xml.NodeSeq" id="350617">ret</a>: <span title="scala.xml.NodeSeq">NodeSeq</span> = <a href="#350609" title="scala.xml.Node">v</a> <span title="scala.xml.NodeSeq" class="keyword">match</span> <span class="delimiter">{</span>
                  <span class="keyword">case</span> <span title="scala.xml.Group">Group</span><span class="delimiter">(</span><a title="Seq[scala.xml.Node]" id="350645">nodes</a><span class="delimiter">)</span> =&gt; <span title="(nodes: Seq[scala.xml.Node])scala.xml.Group">Group</span><span class="delimiter">(</span><a href="#350255" title="(in: scala.xml.NodeSeq, _inHtml: Boolean, _inHead: Boolean, _justHead: Boolean, _inBody: Boolean, _justBody: Boolean, _bodyHead: Boolean, _bodyTail: Boolean, doMergy: Boolean)scala.xml.NodeSeq">_fixHtml</a><span class="delimiter">(</span><a href="#350645" title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">nodes</a>, <a href="#350610" title="Boolean">inHtml</a>, <a href="#350611" title="Boolean">inHead</a>, <a href="#350612" title="Boolean">justHead</a>, <a href="#350614" title="Boolean">inBody</a>, <a href="#350613" title="Boolean">justBody</a>, <a href="#350615" title="Boolean">bodyHead</a>, <a href="#350616" title="Boolean">bodyTail</a>, <a href="#350592" title="Boolean">doMergy</a><span class="delimiter">)</span><span class="delimiter">)</span>

                  <span class="comment">// if it's a deferred node, grab it from the deferred list</span>
                  <span class="keyword">case</span> <a title="scala.xml.NodeSeq" id="350650">e</a>: <span title="scala.xml.Elem">Elem</span> <span class="keyword">if</span> <a href="#350650" title="scala.xml.Elem">e</a>.<span title="=&gt; String">label</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;node&quot;)" class="string">&quot;node&quot;</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#350650" title="scala.xml.Elem">e</a>.<span title="=&gt; String">prefix</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;lift_deferred&quot;)" class="string">&quot;lift_deferred&quot;</span> =&gt;
                    <span class="keyword">for</span><span class="delimiter">{</span>
                      <a title="String" id="350831">attr</a> &lt;- <a href="#350650" title="scala.xml.Elem">e</a>.<span title="(key: String)Seq[scala.xml.Node]">attributes</span><span class="delimiter">(</span><span title="java.lang.String(&quot;id&quot;)" class="string">&quot;id&quot;</span><span class="delimiter">)</span>.<span title="=&gt; Option[scala.xml.Node]">headOption</span>.<span title="(f: scala.xml.Node =&gt; String)Option[String]">map</span><span class="delimiter">(</span><a href="#350810" title="scala.xml.Node">_</a>.<span title="=&gt; String">text</span><span class="delimiter">)</span>.<span title="(f: String =&gt; scala.collection.GenTraversableOnce[scala.xml.Node])(implicit bf: scala.collection.generic.CanBuildFrom[List[String],scala.xml.Node,List[scala.xml.Node]])List[scala.xml.Node]">toList</span>
                      <a title="scala.xml.NodeSeq" id="350851">nodes</a> &lt;- <a href="#350241" title="Map[String,scala.xml.NodeSeq]">processedSnippets</a>.<span title="(key: String)Option[scala.xml.NodeSeq]">get</span><span class="delimiter">(</span><a href="#350831" title="String">attr</a><span class="delimiter">)</span>.<span title="(f: scala.xml.NodeSeq =&gt; scala.collection.GenTraversableOnce[scala.xml.Node])(implicit bf: scala.collection.generic.CanBuildFrom[List[scala.xml.NodeSeq],scala.xml.Node,List[scala.xml.Node]])List[scala.xml.Node]">toList</span>
                      <a title="scala.xml.Node" id="350871">node</a> &lt;- <a href="#350255" title="(in: scala.xml.NodeSeq, _inHtml: Boolean, _inHead: Boolean, _justHead: Boolean, _inBody: Boolean, _justBody: Boolean, _bodyHead: Boolean, _bodyTail: Boolean, doMergy: Boolean)scala.xml.NodeSeq">_fixHtml</a><span title="(f: scala.xml.Node =&gt; scala.xml.Node)(implicit bf: scala.collection.generic.CanBuildFrom[scala.xml.NodeSeq,scala.xml.Node,scala.xml.NodeSeq])scala.xml.NodeSeq" class="delimiter">(</span><a href="#350851" title="scala.xml.NodeSeq">nodes</a>, <a href="#350610" title="Boolean">inHtml</a>, <a href="#350611" title="Boolean">inHead</a>, <a href="#350612" title="Boolean">justHead</a>, <a href="#350614" title="Boolean">inBody</a>, <a href="#350613" title="Boolean">justBody</a>, <a href="#350615" title="Boolean">bodyHead</a>, <a href="#350616" title="Boolean">bodyTail</a>, <a href="#350592" title="Boolean">doMergy</a><span class="delimiter">)</span>
                    <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="#350871" title="scala.xml.Node">node</a>

                  <span class="keyword">case</span> <a title="scala.xml.Elem" id="350947">e</a>: <span title="scala.xml.Elem">Elem</span> <span class="keyword">if</span> <a href="#350947" title="scala.xml.Elem">e</a>.<span title="=&gt; String">label</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;form&quot;)" class="string">&quot;form&quot;</span> =&gt; <span title="(prefix: String, label: String, attributes: scala.xml.MetaData, scope: scala.xml.NamespaceBinding, child: scala.xml.Node*)scala.xml.Elem">Elem</span><span class="delimiter">(</span><a href="#350609" title="scala.xml.Node">v</a>.<span title="=&gt; String">prefix</span>, <a href="#350609" title="scala.xml.Node">v</a>.<span title="=&gt; String">label</span>, <a href="#350254" title="(original: scala.xml.MetaData, toFix: String, attrs: scala.xml.MetaData, fixURL: Boolean)scala.xml.MetaData">fixAttrs</a><span class="delimiter">(</span><a href="#350609" title="scala.xml.Node">v</a>.<span title="=&gt; scala.xml.MetaData">attributes</span>, <span title="java.lang.String(&quot;action&quot;)" class="string">&quot;action&quot;</span>, <a href="#350609" title="scala.xml.Node">v</a>.<span title="=&gt; scala.xml.MetaData">attributes</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>, <a href="#350609" title="scala.xml.Node">v</a>.<span title="=&gt; scala.xml.NamespaceBinding">scope</span>, <a href="#350255" title="(in: scala.xml.NodeSeq, _inHtml: Boolean, _inHead: Boolean, _justHead: Boolean, _inBody: Boolean, _justBody: Boolean, _bodyHead: Boolean, _bodyTail: Boolean, doMergy: Boolean)scala.xml.NodeSeq">_fixHtml</a><span class="delimiter">(</span><a href="#350609" title="scala.xml.Node">v</a>.<span title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">child</span>, <a href="#350610" title="Boolean">inHtml</a>, <a href="#350611" title="Boolean">inHead</a>, <a href="#350612" title="Boolean">justHead</a>, <a href="#350614" title="Boolean">inBody</a>, <a href="#350613" title="Boolean">justBody</a>, <a href="#350615" title="Boolean">bodyHead</a>, <a href="#350616" title="Boolean">bodyTail</a>, <a href="#350592" title="Boolean">doMergy</a><span class="delimiter">)</span>: _*<span class="delimiter">)</span>
                  <span class="keyword">case</span> <a title="scala.xml.Elem" id="350954">e</a>: <span title="scala.xml.Elem">Elem</span> <span class="keyword">if</span> <a href="#350954" title="scala.xml.Elem">e</a>.<span title="=&gt; String">label</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;script&quot;)" class="string">&quot;script&quot;</span> =&gt; <span title="(prefix: String, label: String, attributes: scala.xml.MetaData, scope: scala.xml.NamespaceBinding, child: scala.xml.Node*)scala.xml.Elem">Elem</span><span class="delimiter">(</span><a href="#350609" title="scala.xml.Node">v</a>.<span title="=&gt; String">prefix</span>, <a href="#350609" title="scala.xml.Node">v</a>.<span title="=&gt; String">label</span>, <a href="#350254" title="(original: scala.xml.MetaData, toFix: String, attrs: scala.xml.MetaData, fixURL: Boolean)scala.xml.MetaData">fixAttrs</a><span class="delimiter">(</span><a href="#350609" title="scala.xml.Node">v</a>.<span title="=&gt; scala.xml.MetaData">attributes</span>, <span title="java.lang.String(&quot;src&quot;)" class="string">&quot;src&quot;</span>, <a href="#350609" title="scala.xml.Node">v</a>.<span title="=&gt; scala.xml.MetaData">attributes</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>, <a href="#350609" title="scala.xml.Node">v</a>.<span title="=&gt; scala.xml.NamespaceBinding">scope</span>, <a href="#350255" title="(in: scala.xml.NodeSeq, _inHtml: Boolean, _inHead: Boolean, _justHead: Boolean, _inBody: Boolean, _justBody: Boolean, _bodyHead: Boolean, _bodyTail: Boolean, doMergy: Boolean)scala.xml.NodeSeq">_fixHtml</a><span class="delimiter">(</span><a href="#350609" title="scala.xml.Node">v</a>.<span title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">child</span>, <a href="#350610" title="Boolean">inHtml</a>, <a href="#350611" title="Boolean">inHead</a>, <a href="#350612" title="Boolean">justHead</a>, <a href="#350614" title="Boolean">inBody</a>, <a href="#350613" title="Boolean">justBody</a>, <a href="#350615" title="Boolean">bodyHead</a>, <a href="#350616" title="Boolean">bodyTail</a>, <a href="#350592" title="Boolean">doMergy</a><span class="delimiter">)</span>: _*<span class="delimiter">)</span>
                  <span class="keyword">case</span> <a title="scala.xml.Elem" id="350961">e</a>: <span title="scala.xml.Elem">Elem</span> <span class="keyword">if</span> <a href="#350961" title="scala.xml.Elem">e</a>.<span title="=&gt; String">label</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;a&quot;)" class="string">&quot;a&quot;</span> =&gt; <span title="(prefix: String, label: String, attributes: scala.xml.MetaData, scope: scala.xml.NamespaceBinding, child: scala.xml.Node*)scala.xml.Elem">Elem</span><span class="delimiter">(</span><a href="#350609" title="scala.xml.Node">v</a>.<span title="=&gt; String">prefix</span>, <a href="#350609" title="scala.xml.Node">v</a>.<span title="=&gt; String">label</span>, <a href="#350254" title="(original: scala.xml.MetaData, toFix: String, attrs: scala.xml.MetaData, fixURL: Boolean)scala.xml.MetaData">fixAttrs</a><span class="delimiter">(</span><a href="#350609" title="scala.xml.Node">v</a>.<span title="=&gt; scala.xml.MetaData">attributes</span>, <span title="java.lang.String(&quot;href&quot;)" class="string">&quot;href&quot;</span>, <a href="#350609" title="scala.xml.Node">v</a>.<span title="=&gt; scala.xml.MetaData">attributes</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>, <a href="#350609" title="scala.xml.Node">v</a>.<span title="=&gt; scala.xml.NamespaceBinding">scope</span>, <a href="#350255" title="(in: scala.xml.NodeSeq, _inHtml: Boolean, _inHead: Boolean, _justHead: Boolean, _inBody: Boolean, _justBody: Boolean, _bodyHead: Boolean, _bodyTail: Boolean, doMergy: Boolean)scala.xml.NodeSeq">_fixHtml</a><span class="delimiter">(</span><a href="#350609" title="scala.xml.Node">v</a>.<span title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">child</span>, <a href="#350610" title="Boolean">inHtml</a>, <a href="#350611" title="Boolean">inHead</a>, <a href="#350612" title="Boolean">justHead</a>, <a href="#350614" title="Boolean">inBody</a>, <a href="#350613" title="Boolean">justBody</a>, <a href="#350615" title="Boolean">bodyHead</a>, <a href="#350616" title="Boolean">bodyTail</a>, <a href="#350592" title="Boolean">doMergy</a><span class="delimiter">)</span>: _*<span class="delimiter">)</span>
                  <span class="keyword">case</span> <a title="scala.xml.Elem" id="350968">e</a>: <span title="scala.xml.Elem">Elem</span> <span class="keyword">if</span> <a href="#350968" title="scala.xml.Elem">e</a>.<span title="=&gt; String">label</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;link&quot;)" class="string">&quot;link&quot;</span> =&gt; <span title="(prefix: String, label: String, attributes: scala.xml.MetaData, scope: scala.xml.NamespaceBinding, child: scala.xml.Node*)scala.xml.Elem">Elem</span><span class="delimiter">(</span><a href="#350609" title="scala.xml.Node">v</a>.<span title="=&gt; String">prefix</span>, <a href="#350609" title="scala.xml.Node">v</a>.<span title="=&gt; String">label</span>, <a href="#350254" title="(original: scala.xml.MetaData, toFix: String, attrs: scala.xml.MetaData, fixURL: Boolean)scala.xml.MetaData">fixAttrs</a><span class="delimiter">(</span><a href="#350609" title="scala.xml.Node">v</a>.<span title="=&gt; scala.xml.MetaData">attributes</span>, <span title="java.lang.String(&quot;href&quot;)" class="string">&quot;href&quot;</span>, <a href="#350609" title="scala.xml.Node">v</a>.<span title="=&gt; scala.xml.MetaData">attributes</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>, <a href="#350609" title="scala.xml.Node">v</a>.<span title="=&gt; scala.xml.NamespaceBinding">scope</span>, <a href="#350255" title="(in: scala.xml.NodeSeq, _inHtml: Boolean, _inHead: Boolean, _justHead: Boolean, _inBody: Boolean, _justBody: Boolean, _bodyHead: Boolean, _bodyTail: Boolean, doMergy: Boolean)scala.xml.NodeSeq">_fixHtml</a><span class="delimiter">(</span><a href="#350609" title="scala.xml.Node">v</a>.<span title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">child</span>, <a href="#350610" title="Boolean">inHtml</a>, <a href="#350611" title="Boolean">inHead</a>, <a href="#350612" title="Boolean">justHead</a>, <a href="#350614" title="Boolean">inBody</a>, <a href="#350613" title="Boolean">justBody</a>, <a href="#350615" title="Boolean">bodyHead</a>, <a href="#350616" title="Boolean">bodyTail</a>, <a href="#350592" title="Boolean">doMergy</a><span class="delimiter">)</span>: _*<span class="delimiter">)</span>
                  <span class="keyword">case</span> <a title="scala.xml.Elem" id="350975">e</a>: <span title="scala.xml.Elem">Elem</span> =&gt; <span title="(prefix: String, label: String, attributes: scala.xml.MetaData, scope: scala.xml.NamespaceBinding, child: scala.xml.Node*)scala.xml.Elem">Elem</span><span class="delimiter">(</span><a href="#350609" title="scala.xml.Node">v</a>.<span title="=&gt; String">prefix</span>, <a href="#350609" title="scala.xml.Node">v</a>.<span title="=&gt; String">label</span>, <a href="#350254" title="(original: scala.xml.MetaData, toFix: String, attrs: scala.xml.MetaData, fixURL: Boolean)scala.xml.MetaData">fixAttrs</a><span class="delimiter">(</span><a href="#350609" title="scala.xml.Node">v</a>.<span title="=&gt; scala.xml.MetaData">attributes</span>, <span title="java.lang.String(&quot;src&quot;)" class="string">&quot;src&quot;</span>, <a href="#350609" title="scala.xml.Node">v</a>.<span title="=&gt; scala.xml.MetaData">attributes</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>, <a href="#350609" title="scala.xml.Node">v</a>.<span title="=&gt; scala.xml.NamespaceBinding">scope</span>, <a href="#350255" title="(in: scala.xml.NodeSeq, _inHtml: Boolean, _inHead: Boolean, _justHead: Boolean, _inBody: Boolean, _justBody: Boolean, _bodyHead: Boolean, _bodyTail: Boolean, doMergy: Boolean)scala.xml.NodeSeq">_fixHtml</a><span class="delimiter">(</span><a href="#350609" title="scala.xml.Node">v</a>.<span title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">child</span>, <a href="#350610" title="Boolean">inHtml</a>, <a href="#350611" title="Boolean">inHead</a>, <a href="#350612" title="Boolean">justHead</a>, <a href="#350614" title="Boolean">inBody</a>, <a href="#350613" title="Boolean">justBody</a>, <a href="#350615" title="Boolean">bodyHead</a>, <a href="#350616" title="Boolean">bodyTail</a>, <a href="#350592" title="Boolean">doMergy</a><span class="delimiter">)</span>: _*<span class="delimiter">)</span>
                  <span class="keyword">case</span> <a title="scala.xml.NodeSeq" id="350978">c</a>: <span title="scala.xml.Comment">Comment</span> <span class="keyword">if</span> <a href="#350239" title="Boolean">stripComments</a> =&gt; <span title="object scala.xml.NodeSeq">NodeSeq</span>.<span title="=&gt; scala.xml.NodeSeq">Empty</span>
                  <span class="keyword">case</span> <span title="scala.xml.Node">_</span> =&gt; <a href="#350609" title="scala.xml.Node">v</a>
                <span class="delimiter">}</span>
                <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#350587" title="Boolean">_justHead</a><span class="delimiter">)</span> <a href="#350246" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">headChildren</a> <span title="(xs: scala.collection.TraversableOnce[scala.xml.Node])headChildren.type">++=</span> <a href="#350617" title="scala.xml.NodeSeq">ret</a>
                <span class="keyword">else</span> <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#350589" title="Boolean">_justBody</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#350615" title="Boolean">bodyHead</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#350616" title="Boolean">bodyTail</a><span class="delimiter">)</span> <a href="#350247" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">bodyChildren</a> <span title="(xs: scala.collection.TraversableOnce[scala.xml.Node])bodyChildren.type">++=</span> <a href="#350617" title="scala.xml.NodeSeq">ret</a>
                <span class="keyword">else</span> <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#350590" title="Boolean">_bodyHead</a><span class="delimiter">)</span> <a href="#350248" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">addlHead</a> <span title="(xs: scala.collection.TraversableOnce[scala.xml.Node])addlHead.type">++=</span> <a href="#350617" title="scala.xml.NodeSeq">ret</a>
                <span class="keyword">else</span> <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#350591" title="Boolean">_bodyTail</a><span class="delimiter">)</span> <a href="#350249" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">addlTail</a> <span title="(xs: scala.collection.TraversableOnce[scala.xml.Node])addlTail.type">++=</span> <a href="#350617" title="scala.xml.NodeSeq">ret</a>

                <span title="scala.xml.NodeSeq" class="keyword">if</span> <span class="delimiter">(</span><a href="#350615" title="Boolean">bodyHead</a> <span title="(x: Boolean)Boolean">||</span> <a href="#350616" title="Boolean">bodyTail</a><span class="delimiter">)</span> <span title="(_data: String)scala.xml.Text">Text</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
                <span class="keyword">else</span> <a href="#350617" title="scala.xml.NodeSeq">ret</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span title="scala.xml.Node" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#350242" title="Boolean">hasHtmlHeadAndBody</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.xml.NodeSeq" id="351060">fixedHtml</a> = <a href="#350255" title="(in: scala.xml.NodeSeq, _inHtml: Boolean, _inHead: Boolean, _justHead: Boolean, _inBody: Boolean, _justBody: Boolean, _bodyHead: Boolean, _bodyTail: Boolean, doMergy: Boolean)scala.xml.NodeSeq">_fixHtml</a><span class="delimiter">(</span><a href="#350234" title="scala.xml.NodeSeq">xhtml</a>, <span title="Boolean(false)" class="keyword">false</span>, <span title="Boolean(false)" class="keyword">false</span>, <span title="Boolean(false)" class="keyword">false</span>, <span title="Boolean(false)" class="keyword">false</span>, <span title="Boolean(false)" class="keyword">false</span>, <span title="Boolean(false)" class="keyword">false</span>, <span title="Boolean(false)" class="keyword">false</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>

      <a href="#351060" title="scala.xml.NodeSeq">fixedHtml</a>.<span title="(p: scala.xml.Node =&gt; Boolean)Option[scala.xml.Node]">find</span> <a href="#351066" title="Boolean" class="delimiter">{</a>
        <span class="keyword">case</span> <a title="Boolean(true)" id="351067">e</a>: <span title="scala.xml.Elem">Elem</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
        <span class="keyword">case</span> <span title="Boolean(false)">_</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
      <span class="delimiter">}</span> <span title="(default: =&gt; scala.xml.Node)scala.xml.Node">getOrElse</span> <span title="(_data: String)scala.xml.Text">Text</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#350255" title="(in: scala.xml.NodeSeq, _inHtml: Boolean, _inHead: Boolean, _justHead: Boolean, _inBody: Boolean, _justBody: Boolean, _bodyHead: Boolean, _bodyTail: Boolean, doMergy: Boolean)scala.xml.NodeSeq">_fixHtml</a><span class="delimiter">(</span><a href="#350234" title="scala.xml.NodeSeq">xhtml</a>, <span title="Boolean(false)" class="keyword">false</span>, <span title="Boolean(false)" class="keyword">false</span>, <span title="Boolean(false)" class="keyword">false</span>, <span title="Boolean(false)" class="keyword">false</span>, <span title="Boolean(false)" class="keyword">false</span>, <span title="Boolean(false)" class="keyword">false</span>, <span title="Boolean(false)" class="keyword">false</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="scala.collection.mutable.ListBuffer[scala.xml.Node]" id="351075">htmlKids</a> = <span title="scala.collection.mutable.ListBuffer[scala.xml.Node]" class="keyword">new</span> <span title="scala.collection.mutable.ListBuffer[scala.xml.Node]">ListBuffer</span><span class="delimiter">[</span>Node<span class="delimiter">]</span>

      <span class="keyword">val</span> <a title="scala.xml.Text" id="351076">nl</a> = <span title="(_data: String)scala.xml.Text">Text</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>

      <span class="keyword">for</span><span class="delimiter">{</span>
        <a title="scala.xml.Node" id="351102">node</a> &lt;- <a href="../../../../util/net/liftweb/util/HeadHelper.scala.html#13340" title="object net.liftweb.util.HeadHelper">HeadHelper</a>.<a href="../../../../util/net/liftweb/util/HeadHelper.scala.html#293971" title="(in: scala.xml.NodeSeq)scala.xml.NodeSeq">removeHtmlDuplicates</a><span title="(f: scala.xml.Node =&gt; scala.collection.mutable.ListBuffer[scala.xml.Node])Unit" class="delimiter">(</span><a href="#350248" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">addlHead</a>.<span title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">toList</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="delimiter">{</span>
        <a href="#350246" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">headChildren</a> <span title="(x: scala.xml.Node)headChildren.type">+=</span> <a href="#351102" title="scala.xml.Node">node</a>
        <a href="#350246" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">headChildren</a> <span title="(x: scala.xml.Node)headChildren.type">+=</span> <a href="#351076" title="scala.xml.Text">nl</a>
      <span class="delimiter">}</span>

      <span class="comment">// Appends ajax stript to body</span>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159156" title="(v1: net.liftweb.http.LiftSession)Boolean">autoIncludeAjax</a><span class="delimiter">(</span><a href="#14197" title="net.liftweb.http.LiftSession" class="keyword">this</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#350247" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">bodyChildren</a> <span title="(x: scala.xml.Node)bodyChildren.type">+=</span>
                &lt;<a title="scala.xml.MetaData" id="351129">script</a> src=<span class="delimiter">{</span><a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49496" title="(url: String)String">encodeURL</a><span class="delimiter">(</span><a href="#350253" title="String">contextPath</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span>
                        <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159051" title="=&gt; java.lang.String">ajaxPath</a> <span title="(x$1: Any)java.lang.String">+</span>
                        <span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159227" title="()String">ajaxScriptName</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">}</span>
                <span class="keyword">type</span>=<span title="scala.xml.Text" class="string">&quot;text/javascript&quot;</span>/&gt;
        <a href="#350247" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">bodyChildren</a> <span title="(x: scala.xml.Node)bodyChildren.type">+=</span> <a href="#351076" title="scala.xml.Text">nl</a>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="List[net.liftweb.http.CometVersionPair]" id="351077">cometList</a> = <a href="#350250" title="scala.collection.mutable.ListBuffer[net.liftweb.http.CometVersionPair]">cometTimes</a>.<span title="=&gt; List[net.liftweb.http.CometVersionPair]">toList</span>

      <span class="comment">// Appends comet stript reference to head</span>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#351077" title="List[net.liftweb.http.CometVersionPair]">cometList</a>.<span title="=&gt; Boolean">isEmpty</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159153" title="(v1: net.liftweb.http.LiftSession)Boolean">autoIncludeComet</a><span class="delimiter">(</span><a href="#14197" title="net.liftweb.http.LiftSession" class="keyword">this</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#350247" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">bodyChildren</a> <span title="(x: scala.xml.Node)bodyChildren.type">+=</span>
                &lt;<a title="scala.xml.MetaData" id="351178">script</a> src=<span class="delimiter">{</span><a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49496" title="(url: String)String">encodeURL</a><span class="delimiter">(</span><a href="#350253" title="String">contextPath</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span>
                        <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159054" title="=&gt; java.lang.String">cometPath</a> <span title="(x$1: Any)java.lang.String">+</span>
                        <span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="../../../../util/net/liftweb/util/HttpHelpers.scala.html#49043" title="(in: String)java.lang.String">urlEncode</a><span class="delimiter">(</span><a href="#14197" title="LiftMerge.this.type" class="keyword">this</a>.<a href="LiftSession.scala.html#230144" title="=&gt; String">uniqueId</a><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span>
                        <span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159230" title="()String">cometScriptName</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">}</span>
                <span class="keyword">type</span>=<span title="scala.xml.Text" class="string">&quot;text/javascript&quot;</span>/&gt;
        <a href="#350247" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">bodyChildren</a> <span title="(x: scala.xml.Node)bodyChildren.type">+=</span> <a href="#351076" title="scala.xml.Text">nl</a>
      <span class="delimiter">}</span>

      <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49340" title="()List[net.liftweb.http.js.JsCmd]">jsToAppend</a> <span title="Any" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Unit">Nil</span> =&gt; 
        <span class="keyword">case</span> <a title="addlTail.type" id="351209">x</a> :: <span title="object Nil">Nil</span> =&gt; <a href="#350249" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">addlTail</a> <span title="(x: scala.xml.Node)addlTail.type">+=</span> js.<a href="js/JsCommands.scala.html#14916" title="object net.liftweb.http.js.JsCmds">JsCmds</a>.<a href="js/JsCommands.scala.html#196378" title="(script: net.liftweb.http.js.JsCmd)scala.xml.Node">Script</a><span class="delimiter">(</span><a href="#351209" title="net.liftweb.http.js.JsCmd">x</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="addlTail.type" id="351219">xs</a> =&gt; <a href="#350249" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">addlTail</a> <span title="(x: scala.xml.Node)addlTail.type">+=</span> js.<a href="js/JsCommands.scala.html#14916" title="object net.liftweb.http.js.JsCmds">JsCmds</a>.<a href="js/JsCommands.scala.html#196378" title="(script: net.liftweb.http.js.JsCmd)scala.xml.Node">Script</a><span class="delimiter">(</span><a href="#351219" title="List[net.liftweb.http.js.JsCmd]">xs</a>.<span title="(z: net.liftweb.http.js.JsCmd)(f: (net.liftweb.http.js.JsCmd, net.liftweb.http.js.JsCmd) =&gt; net.liftweb.http.js.JsCmd)net.liftweb.http.js.JsCmd">foldLeft</span><span class="delimiter">(</span>js.<a href="js/JsCommands.scala.html#14916" title="object net.liftweb.http.js.JsCmds">JsCmds</a>.<a href="js/JsCommands.scala.html#146481" title="=&gt; net.liftweb.http.js.JsCmd">Noop</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#351239" title="net.liftweb.http.js.JsCmd">_</a> <a href="js/JsCommands.scala.html#148952" title="(other: net.liftweb.http.js.JsCmd)net.liftweb.http.js.JsCmd">&amp;</a> <a href="#351240" title="net.liftweb.http.js.JsCmd">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">for</span><span class="delimiter">{</span>
        <a title="scala.xml.Node" id="351268">node</a> &lt;- <a href="../../../../util/net/liftweb/util/HeadHelper.scala.html#13340" title="object net.liftweb.util.HeadHelper">HeadHelper</a>.<a href="../../../../util/net/liftweb/util/HeadHelper.scala.html#293971" title="(in: scala.xml.NodeSeq)scala.xml.NodeSeq">removeHtmlDuplicates</a><span title="(f: scala.xml.Node =&gt; scala.collection.mutable.ListBuffer[scala.xml.Node])Unit" class="delimiter">(</span><a href="#350249" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">addlTail</a>.<span title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">toList</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <a href="#350247" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">bodyChildren</a> <span title="(x: scala.xml.Node)bodyChildren.type">+=</span> <a href="#351268" title="scala.xml.Node">node</a>

      <a href="#350247" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">bodyChildren</a> <span title="(x: scala.xml.Node)bodyChildren.type">+=</span> <a href="#351076" title="scala.xml.Text">nl</a>

      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#351077" title="List[net.liftweb.http.CometVersionPair]">cometList</a>.<span title="=&gt; Boolean">isEmpty</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159153" title="(v1: net.liftweb.http.LiftSession)Boolean">autoIncludeComet</a><span class="delimiter">(</span><a href="#14197" title="net.liftweb.http.LiftSession" class="keyword">this</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#350247" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">bodyChildren</a> <span title="(x: scala.xml.Node)bodyChildren.type">+=</span> <a href="js/JsCommands.scala.html#14916" title="object net.liftweb.http.js.JsCmds">JsCmds</a>.<a href="js/JsCommands.scala.html#196378" title="(script: net.liftweb.http.js.JsCmd)scala.xml.Node">Script</a><span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159198" title="(v1: net.liftweb.http.LiftSession, v2: Seq[net.liftweb.http.CometVersionPair])net.liftweb.http.js.JsCmd">renderCometPageContents</a><span class="delimiter">(</span><a href="#14197" title="net.liftweb.http.LiftSession" class="keyword">this</a>, <a href="#351077" title="List[net.liftweb.http.CometVersionPair]">cometList</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#350247" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">bodyChildren</a> <span title="(x: scala.xml.Node)bodyChildren.type">+=</span> <a href="#351076" title="scala.xml.Text">nl</a>
      <span class="delimiter">}</span>

      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159180" title="=&gt; Boolean">enableLiftGC</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="LiftSession.scala.html#230327" title="=&gt; Boolean">stateful_?</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">import</span> js._
        <span class="keyword">import</span> <a href="js/JsCommands.scala.html#14916" title="object net.liftweb.http.js.JsCmds">JsCmds</a>._
        <span class="keyword">import</span> <a href="js/JsCommands.scala.html#14910" title="object net.liftweb.http.js.JE">JE</a>._

        <a href="#350247" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">bodyChildren</a> <span title="(x: scala.xml.Node)bodyChildren.type">+=</span> <a href="js/JsCommands.scala.html#14916" title="object net.liftweb.http.js.JsCmds">JsCmds</a>.<a href="js/JsCommands.scala.html#196378" title="(script: net.liftweb.http.js.JsCmd)scala.xml.Node">Script</a><span class="delimiter">(</span><span class="delimiter">(</span><span title="net.liftweb.http.js.JsCmd" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#351077" title="List[net.liftweb.http.CometVersionPair]">cometList</a>.<span title="=&gt; Boolean">isEmpty</span> <span title="(x: Boolean)Boolean">||</span> <a href="LiftSession.scala.html#230244" title="(owner: String)Boolean">hasFuncsForOwner</a><span class="delimiter">(</span><a href="LiftSession.scala.html#14488" title="object net.liftweb.http.RenderVersion">RenderVersion</a>.<a href="LiftSession.scala.html#345564" title="=&gt; String">get</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="js/JsCommands.scala.html#341508" title="(what: net.liftweb.http.js.JsCmd)net.liftweb.http.js.JsCmd">OnLoad</a><span class="delimiter">(</span><a href="js/JsCommands.scala.html#184878" title="(rawJsCmd: String)net.liftweb.http.js.JE.JsRaw">JsRaw</a><a href="js/JsCommands.scala.html#146461" title="implicit net.liftweb.http.js.JsCmds.jsExpToJsCmd : (in: net.liftweb.http.js.JsExp)net.liftweb.http.js.JsCmd" class="delimiter">(</a><span title="java.lang.String(&quot;liftAjax.lift_successRegisterGC()&quot;)" class="string">&quot;liftAjax.lift_successRegisterGC()&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="js/JsCommands.scala.html#146481" title="=&gt; net.liftweb.http.js.JsCmd">Noop</a><span class="delimiter">)</span> <a href="js/JsCommands.scala.html#148952" title="(other: net.liftweb.http.js.JsCmd)net.liftweb.http.js.JsCmd">&amp;</a>
                <a href="js/JsCommands.scala.html#330616" title="(name: String, right: net.liftweb.http.js.JsExp)net.liftweb.http.js.JsCmds.JsCrVar">JsCrVar</a><span class="delimiter">(</span><span title="java.lang.String(&quot;lift_page&quot;)" class="string">&quot;lift_page&quot;</span>, <a href="LiftSession.scala.html#14488" title="object net.liftweb.http.RenderVersion">RenderVersion</a>.<a href="js/JsCommands.scala.html#164811" title="implicit net.liftweb.http.js.JsExp.strToJsExp : (str: String)net.liftweb.http.js.JE.Str">get</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="#351075" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">htmlKids</a> <span title="(x: scala.xml.Node)htmlKids.type">+=</span> <a href="#351076" title="scala.xml.Text">nl</a>
      <a href="#351075" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">htmlKids</a> <span title="(x: scala.xml.Node)htmlKids.type">+=</span> <span title="(prefix: String, label: String, attributes: scala.xml.MetaData, scope: scala.xml.NamespaceBinding, child: scala.xml.Node*)scala.xml.Elem">Elem</span><span class="delimiter">(</span><a href="#350244" title="scala.xml.Elem">headTag</a>.<span title="=&gt; String">prefix</span>, <a href="#350244" title="scala.xml.Elem">headTag</a>.<span title="=&gt; String">label</span>, <a href="#350244" title="scala.xml.Elem">headTag</a>.<span title="=&gt; scala.xml.MetaData">attributes</span>, <a href="#350244" title="scala.xml.Elem">headTag</a>.<span title="=&gt; scala.xml.NamespaceBinding">scope</span>, <a href="#350246" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">headChildren</a>.<span title="=&gt; List[scala.xml.Node]">toList</span>: _*<span class="delimiter">)</span>
      <a href="#351075" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">htmlKids</a> <span title="(x: scala.xml.Node)htmlKids.type">+=</span> <a href="#351076" title="scala.xml.Text">nl</a>
      <a href="#351075" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">htmlKids</a> <span title="(x: scala.xml.Node)htmlKids.type">+=</span> <span title="(prefix: String, label: String, attributes: scala.xml.MetaData, scope: scala.xml.NamespaceBinding, child: scala.xml.Node*)scala.xml.Elem">Elem</span><span class="delimiter">(</span><a href="#350245" title="scala.xml.Elem">bodyTag</a>.<span title="=&gt; String">prefix</span>, <a href="#350245" title="scala.xml.Elem">bodyTag</a>.<span title="=&gt; String">label</span>, <a href="#350245" title="scala.xml.Elem">bodyTag</a>.<span title="=&gt; scala.xml.MetaData">attributes</span>, <a href="#350245" title="scala.xml.Elem">bodyTag</a>.<span title="=&gt; scala.xml.NamespaceBinding">scope</span>, <a href="#350247" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">bodyChildren</a>.<span title="=&gt; List[scala.xml.Node]">toList</span>: _*<span class="delimiter">)</span>
      <a href="#351075" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">htmlKids</a> <span title="(x: scala.xml.Node)htmlKids.type">+=</span> <a href="#351076" title="scala.xml.Text">nl</a>

      <span class="keyword">val</span> <a title="scala.xml.Elem" id="351078">tmpRet</a> = <span title="(prefix: String, label: String, attributes: scala.xml.MetaData, scope: scala.xml.NamespaceBinding, child: scala.xml.Node*)scala.xml.Elem">Elem</span><span class="delimiter">(</span><a href="#350243" title="scala.xml.Elem">htmlTag</a>.<span title="=&gt; String">prefix</span>, <a href="#350243" title="scala.xml.Elem">htmlTag</a>.<span title="=&gt; String">label</span>, <a href="#350243" title="scala.xml.Elem">htmlTag</a>.<span title="=&gt; scala.xml.MetaData">attributes</span>, <a href="#350243" title="scala.xml.Elem">htmlTag</a>.<span title="=&gt; scala.xml.NamespaceBinding">scope</span>, <a href="#351075" title="scala.collection.mutable.ListBuffer[scala.xml.Node]">htmlKids</a>.<span title="=&gt; List[scala.xml.Node]">toList</span>: _*<span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="scala.xml.Node" id="351079">ret</a>: <span title="scala.xml.Node">Node</span> = <span title="scala.xml.Node" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../../util/net/liftweb/util/Props.scala.html#13579" title="object net.liftweb.util.Props">Props</a>.<a href="../../../../util/net/liftweb/util/Props.scala.html#151319" title="=&gt; Boolean">devMode</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159159" title="=&gt; net.liftweb.common.Box[net.liftweb.http.XHtmlValidator]">xhtmlValidator</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27051" title="=&gt; List[net.liftweb.http.XHtmlValidator]">toList</a>.<span title="(f: net.liftweb.http.XHtmlValidator =&gt; scala.collection.GenTraversableOnce[net.liftweb.http.XHTMLValidationError])(implicit bf: scala.collection.generic.CanBuildFrom[List[net.liftweb.http.XHtmlValidator],net.liftweb.http.XHTMLValidationError,List[net.liftweb.http.XHTMLValidationError]])List[net.liftweb.http.XHTMLValidationError]">flatMap</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,net.liftweb.http.XHTMLValidationError,List[net.liftweb.http.XHTMLValidationError]]" class="delimiter">(</span><a href="#351382" title="(v1: scala.xml.Node)List[net.liftweb.http.XHTMLValidationError]">_</a><span class="delimiter">(</span><a href="#351078" title="scala.xml.Elem">tmpRet</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="scala.xml.Node" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="scala.xml.Elem">Nil</span> =&gt; <a href="#351078" title="scala.xml.Elem">tmpRet</a>
          <span class="keyword">case</span> <a title="scala.xml.Node" id="351426">xs</a> =&gt;
            <span class="keyword">import</span> scala.xml.transform._

            <span class="keyword">val</span> <a title="scala.xml.NodeSeq" id="351428">errors</a>: <span title="scala.xml.NodeSeq">NodeSeq</span> = <a href="#351426" title="List[net.liftweb.http.XHTMLValidationError]">xs</a>.<span title="(f: net.liftweb.http.XHTMLValidationError =&gt; scala.xml.Elem)(implicit bf: scala.collection.generic.CanBuildFrom[List[net.liftweb.http.XHTMLValidationError],scala.xml.Elem,List[scala.xml.Elem]])List[scala.xml.Elem]">map</span><span title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq" class="delimiter">(</span><a title="net.liftweb.http.XHTMLValidationError" id="351489">e</a> =&gt;
                    &lt;<a title="scala.xml.MetaData" id="351495">div</a> style=<span title="scala.xml.Text" class="string">&quot;border: red solid 2px&quot;</span>&gt;<span title="scala.xml.Text">XHTML</span> Validation error:<span class="delimiter">{</span><a href="#351489" title="net.liftweb.http.XHTMLValidationError">e</a>.<a href="LiftRules.scala.html#351388" title="=&gt; String">msg</a><span class="delimiter">}</span><span title="scala.xml.Text">at</span> line<span class="delimiter">{</span><a href="#351489" title="net.liftweb.http.XHTMLValidationError">e</a>.<a href="LiftRules.scala.html#351390" title="=&gt; Int">line</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">}</span><span title="scala.xml.Text">and</span> column<span class="delimiter">{</span><a href="#351489" title="net.liftweb.http.XHTMLValidationError">e</a>.<a href="LiftRules.scala.html#351392" title="=&gt; Int">col</a><span class="delimiter">}</span>&lt;/div&gt;<span class="delimiter">)</span>

            <span class="keyword">val</span> <a title="scala.xml.transform.RewriteRule" id="351429">rule</a> = <a href="#351529" title="scala.xml.transform.RewriteRule" class="keyword">new</a> <a title="anonymous class $anon extends scala.xml.transform.RewriteRule" id="351529">RewriteRule</a> <span class="delimiter">{</span>
              <span class="keyword">override</span> <span class="keyword">def</span> <a title="(n: scala.xml.Node)Seq[scala.xml.Node]" id="351531">transform</a><span class="delimiter">(</span><a title="scala.xml.Node" id="351533">n</a>: <span title="scala.xml.Node">Node</span><span class="delimiter">)</span> = <a href="#351533" title="scala.xml.Node">n</a> <span title="Seq[scala.xml.Node]" class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <a title="scala.xml.Elem" id="351538">e</a>: <span title="scala.xml.Elem">Elem</span> <span class="keyword">if</span> <a href="#351538" title="scala.xml.Elem">e</a>.<span title="=&gt; String">label</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;body&quot;)" class="string">&quot;body&quot;</span> =&gt;
                  <span title="(prefix: String, label: String, attributes: scala.xml.MetaData, scope: scala.xml.NamespaceBinding, child: scala.xml.Node*)scala.xml.Elem">Elem</span><span class="delimiter">(</span><a href="#351538" title="scala.xml.Elem">e</a>.<span title="=&gt; String">prefix</span>, <a href="#351538" title="scala.xml.Elem">e</a>.<span title="=&gt; String">label</span>, <a href="#351538" title="scala.xml.Elem">e</a>.<span title="=&gt; scala.xml.MetaData">attributes</span>, <a href="#351538" title="scala.xml.Elem">e</a>.<span title="=&gt; scala.xml.NamespaceBinding">scope</span>, <a href="#351538" title="scala.xml.Elem">e</a>.<span title="=&gt; scala.xml.Node*">child</span> <span title="(that: scala.collection.GenTraversableOnce[scala.xml.Node])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[scala.xml.Node],scala.xml.Node,Seq[scala.xml.Node]])Seq[scala.xml.Node]">++</span> <a href="#351428" title="scala.xml.NodeSeq">errors</a>: _*<span class="delimiter">)</span>

                <span class="keyword">case</span> <a title="Seq[scala.xml.Node]" id="351584">x</a> =&gt; <a href="#351529" title="scala.xml.transform.RewriteRule" class="keyword">super</a>.<span title="(n: scala.xml.Node)Seq[scala.xml.Node]">transform</span><span class="delimiter">(</span><a href="#351584" title="scala.xml.Node">x</a><span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>
            <span class="delimiter">(</span><span title="scala.xml.transform.RuleTransformer" class="keyword">new</span> <span title="scala.xml.transform.RuleTransformer">RuleTransformer</span><span class="delimiter">(</span><a href="#351429" title="scala.xml.transform.RewriteRule">rule</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(n: scala.xml.Node)Seq[scala.xml.Node]">transform</span><span title="(idx: Int)scala.xml.Node" class="delimiter">(</span><a href="#351078" title="scala.xml.Elem">tmpRet</a><span class="delimiter">)</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

      <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#351078" title="scala.xml.Elem">tmpRet</a>

      <a href="#351079" title="scala.xml.Node">ret</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>


        </pre>
    </body>
</html>
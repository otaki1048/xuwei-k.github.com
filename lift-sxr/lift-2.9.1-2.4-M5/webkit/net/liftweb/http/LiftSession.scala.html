<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>webkit/net/liftweb/http/LiftSession.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright 2007-2011 WorldWide Conferencing, LLC
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

<span class="keyword">package</span> net.liftweb
<span class="keyword">package</span> http

<span class="keyword">import</span> java.io.InputStream
<span class="keyword">import</span> java.lang.reflect.<span class="delimiter">{</span>Method, Modifier, InvocationTargetException<span class="delimiter">}</span>
<span class="keyword">import</span> java.util.concurrent.TimeUnit
<span class="keyword">import</span> java.util.Locale

<span class="keyword">import</span> collection.mutable.<span class="delimiter">{</span>HashMap, ArrayBuffer, ListBuffer<span class="delimiter">}</span>
<span class="keyword">import</span> reflect.Manifest
<span class="keyword">import</span> xml._

<span class="keyword">import</span> common._
<span class="keyword">import</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#10572" title="object net.liftweb.common.Box">Box</a>._
<span class="keyword">import</span> actor._
<span class="keyword">import</span> util._
<span class="keyword">import</span> <a href="../../../../util/net/liftweb/util/Helpers.scala.html#13346" title="object net.liftweb.util.Helpers">Helpers</a>._
<span class="keyword">import</span> http.js.<span class="delimiter">{</span>JsCmd, AjaxInfo<span class="delimiter">}</span>
<span class="keyword">import</span> builtin.snippet._
<span class="keyword">import</span> js._
<span class="keyword">import</span> provider._


<span class="keyword">object</span> <a title="object net.liftweb.http.LiftSession" id="14470">LiftSession</a> <span title="ScalaObject" class="delimiter">{</span>

  <span class="comment">/**
   * Returns a reference to a LiftSession dictated by LiftRules#sessionCreator function.
   */</span>
  <span class="keyword">def</span> <a title="(session: net.liftweb.http.provider.HTTPSession, contextPath: String)net.liftweb.http.LiftSession" id="326765">apply</a><span class="delimiter">(</span><a title="net.liftweb.http.provider.HTTPSession" id="357545">session</a>: <a href="provider/HTTPSession.scala.html#15091" title="net.liftweb.http.provider.HTTPSession">HTTPSession</a>, <a title="String" id="357546">contextPath</a>: <span title="String">String</span><span class="delimiter">)</span> =
    <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158851" title="(v1: net.liftweb.http.provider.HTTPSession, v2: String)net.liftweb.http.LiftSession">sessionCreator</a><span class="delimiter">(</span><a href="#357545" title="net.liftweb.http.provider.HTTPSession">session</a>, <a href="#357546" title="String">contextPath</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(request: net.liftweb.http.Req)net.liftweb.http.LiftSession" id="326766">apply</a><span class="delimiter">(</span><a title="net.liftweb.http.Req" id="357543">request</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a><span class="delimiter">)</span>: <a href="#14496" title="net.liftweb.http.LiftSession">LiftSession</a> =
    <span title="net.liftweb.http.LiftSession" class="keyword">if</span> <span class="delimiter">(</span><a href="#357543" title="net.liftweb.http.Req">request</a>.<a href="Req.scala.html#149160" title="=&gt; Boolean">stateless_?</a><span class="delimiter">)</span> <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158890" title="=&gt; net.liftweb.http.LiftRules#FactoryMaker[net.liftweb.http.Req =&gt; net.liftweb.http.LiftSession with net.liftweb.http.StatelessSession]">statelessSession</a>.<a href="Factory.scala.html#159330" title="=&gt; net.liftweb.http.Req =&gt; net.liftweb.http.LiftSession with net.liftweb.http.StatelessSession">vend</a>.<span title="(v1: net.liftweb.http.Req)net.liftweb.http.LiftSession with net.liftweb.http.StatelessSession">apply</span><span class="delimiter">(</span><a href="#357543" title="net.liftweb.http.Req">request</a><span class="delimiter">)</span>
    <span class="keyword">else</span> <span class="keyword">this</span>.<a href="#326765" title="(session: net.liftweb.http.provider.HTTPSession, contextPath: String)net.liftweb.http.LiftSession">apply</a><span class="delimiter">(</span><a href="#357543" title="net.liftweb.http.Req">request</a>.<a href="Req.scala.html#149145" title="=&gt; net.liftweb.http.provider.HTTPRequest">request</a>.<a href="provider/HTTPRequest.scala.html#216876" title="=&gt; net.liftweb.http.provider.HTTPSession">session</a>, <a href="#357543" title="net.liftweb.http.Req">request</a>.<a href="Req.scala.html#149145" title="=&gt; net.liftweb.http.provider.HTTPRequest">request</a>.<a href="provider/HTTPRequest.scala.html#216867" title="=&gt; String">contextPath</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Holds user's functions that will be called when the session is activated
   */</span>
  <span class="keyword">var</span> <a title="List[net.liftweb.http.LiftSession =&gt; Unit]" id="326768">onSessionActivate</a>: <span title="List[net.liftweb.http.LiftSession =&gt; Unit]">List</span><span class="delimiter">[</span>LiftSession =&gt; Unit<span class="delimiter">]</span> = <span title="object Nil">Nil</span>

  <span class="comment">/**
   * Holds user's functions that will be called when the session is passivated
   */</span>
  <span class="keyword">var</span> <a title="List[net.liftweb.http.LiftSession =&gt; Unit]" id="326771">onSessionPassivate</a>: <span title="List[net.liftweb.http.LiftSession =&gt; Unit]">List</span><span class="delimiter">[</span>LiftSession =&gt; Unit<span class="delimiter">]</span> = <span title="object Nil">Nil</span>

  <span class="comment">/**
   * Holds user's functions that will be called when the session is setup
   */</span>
  <span class="keyword">var</span> <a title="List[net.liftweb.http.LiftSession =&gt; Unit]" id="326774">onSetupSession</a>: <span title="List[net.liftweb.http.LiftSession =&gt; Unit]">List</span><span class="delimiter">[</span>LiftSession =&gt; Unit<span class="delimiter">]</span> = <span title="object Nil">Nil</span>

  <span class="comment">/**
   * Holds user's functions that will be called when the session is about to be terminated
   */</span>
  <span class="keyword">var</span> <a title="List[net.liftweb.http.LiftSession =&gt; Unit]" id="326777">onAboutToShutdownSession</a>: <span title="List[net.liftweb.http.LiftSession =&gt; Unit]">List</span><span class="delimiter">[</span>LiftSession =&gt; Unit<span class="delimiter">]</span> = <span title="object Nil">Nil</span>

  <span class="comment">/**
   * Holds user's functions that will be called when the session is terminated
   */</span>
  <span class="keyword">var</span> <a title="List[net.liftweb.http.LiftSession =&gt; Unit]" id="326780">onShutdownSession</a>: <span title="List[net.liftweb.http.LiftSession =&gt; Unit]">List</span><span class="delimiter">[</span>LiftSession =&gt; Unit<span class="delimiter">]</span> = <span title="object Nil">Nil</span>

  <span class="comment">/**
   * Holds user's functions that will be called when a stateful request is about to be processed
   */</span>
  <span class="keyword">var</span> <a title="List[(net.liftweb.http.LiftSession, net.liftweb.http.Req) =&gt; Unit]" id="326783">onBeginServicing</a>: <span title="List[(net.liftweb.http.LiftSession, net.liftweb.http.Req) =&gt; Unit]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>LiftSession, Req<span class="delimiter">)</span> =&gt; Unit<span class="delimiter">]</span> = <span title="object Nil">Nil</span>

  <span class="comment">/**
   * After the session is created, if you need to do anything within
   * the context of the session (like set SessionVars, etc),
   * add the function to this list
   */</span>
  <span class="keyword">var</span> <a title="List[(net.liftweb.http.LiftSession, net.liftweb.http.Req) =&gt; Unit]" id="326786">afterSessionCreate</a>: <span title="List[(net.liftweb.http.LiftSession, net.liftweb.http.Req) =&gt; Unit]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>LiftSession, Req<span class="delimiter">)</span> =&gt; Unit<span class="delimiter">]</span> = <span title="object Nil">Nil</span>

  <span class="comment">/**
   * Holds user's functions that will be called when a stateful request has been processed
   */</span>
  <span class="keyword">var</span> <a title="List[(net.liftweb.http.LiftSession, net.liftweb.http.Req, net.liftweb.common.Box[net.liftweb.http.LiftResponse]) =&gt; Unit]" id="326789">onEndServicing</a>: <span title="List[(net.liftweb.http.LiftSession, net.liftweb.http.Req, net.liftweb.common.Box[net.liftweb.http.LiftResponse]) =&gt; Unit]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>LiftSession, Req, Box<span class="delimiter">[</span>LiftResponse<span class="delimiter">]</span><span class="delimiter">)</span> =&gt; Unit<span class="delimiter">]</span> = <span title="object Nil">Nil</span>

  @volatile <span class="keyword">private</span> <span class="keyword">var</span> <a title="Map[(Class[_], net.liftweb.common.Box[Class[_]]),net.liftweb.common.Box[net.liftweb.http.ConstructorType]]" id="326792">constructorCache</a>: <span title="Map[(Class[_], net.liftweb.common.Box[Class[_]]),net.liftweb.common.Box[net.liftweb.http.ConstructorType]]">Map</span><span class="delimiter">[</span><span class="delimiter">(</span>Class<span class="delimiter">[</span>_<span class="delimiter">]</span>, Box<span class="delimiter">[</span>Class<span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>, Box<span class="delimiter">[</span>ConstructorType<span class="delimiter">]</span><span class="delimiter">]</span> = <span title="(elems: ((Class[_], net.liftweb.common.Box[Class[_]]), Nothing)*)scala.collection.immutable.Map[(Class[_], net.liftweb.common.Box[Class[_]]),Nothing]">Map</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">def</span> <a title="[T](session: net.liftweb.http.LiftSession, pp: net.liftweb.common.Box[net.liftweb.http.ParamPair], clz: Class[T])net.liftweb.common.Box[T]" id="326794">constructFrom</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="326796">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="net.liftweb.http.LiftSession" id="386948">session</a>: <a href="#14496" title="net.liftweb.http.LiftSession">LiftSession</a>, <a title="net.liftweb.common.Box[net.liftweb.http.ParamPair]" id="386949">pp</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.http.ParamPair]">Box</a><span class="delimiter">[</span>ParamPair<span class="delimiter">]</span>, <a title="Class[T]" id="386950">clz</a>: <span title="Class[T]">Class</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[T]">Box</a><span class="delimiter">[</span>T<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="()net.liftweb.common.Box[net.liftweb.http.ConstructorType]" id="386982">calcConstructor</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.http.ConstructorType]">Box</a><span class="delimiter">[</span>ConstructorType<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Array[java.lang.reflect.Constructor[_]]" id="386985">const</a> = <a href="#386950" title="Class[T]">clz</a>.<span title="()Array[java.lang.reflect.Constructor[_]]">getDeclaredConstructors</span><span class="delimiter">(</span><span class="delimiter">)</span>

      <span class="keyword">def</span> <a title="()net.liftweb.common.Box[net.liftweb.http.ConstructorType]" id="386986">nullConstructor</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.http.ConstructorType]">Box</a><span class="delimiter">[</span>ConstructorType<span class="delimiter">]</span> =
        <a href="#386985" title="(xs: Array[java.lang.reflect.Constructor[_]])scala.collection.mutable.ArrayOps[java.lang.reflect.Constructor[_]]">const</a>.<span title="(p: java.lang.reflect.Constructor[_] =&gt; Boolean)Option[java.lang.reflect.Constructor[_]]">find</span><span class="delimiter">(</span><a href="#387317" title="java.lang.reflect.Constructor[_]">_</a>.<span title="()Array[java.lang.Class[_]]">getParameterTypes</span>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<span title="(f: java.lang.reflect.Constructor[_] =&gt; net.liftweb.http.UnitConstructor)Option[net.liftweb.http.UnitConstructor]">map</span><a href="../../../../common/net/liftweb/common/Box.scala.html#28627" title="(in: Option[net.liftweb.http.UnitConstructor])net.liftweb.common.Box[net.liftweb.http.UnitConstructor]" class="delimiter">(</a><a title="java.lang.reflect.Constructor[_]" id="387327">const</a> =&gt; <a href="Templates.scala.html#387332" title="(c: java.lang.reflect.Constructor[_])net.liftweb.http.UnitConstructor">UnitConstructor</a><span class="delimiter">(</span><a href="#387327" title="java.lang.reflect.Constructor[_]">const</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <a href="#386949" title="net.liftweb.common.Box[net.liftweb.http.ParamPair]">pp</a> <span title="net.liftweb.common.Box[net.liftweb.http.ConstructorType]" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="net.liftweb.common.Box[net.liftweb.http.ConstructorType]">Full</span><span class="delimiter">(</span>ParamPair<span class="delimiter">(</span><a title="Any" id="387388">value</a>, <a title="java.lang.Class[_]" id="387389">clz</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
          <a href="#386985" title="(xs: Array[java.lang.reflect.Constructor[_]])scala.collection.mutable.ArrayOps[java.lang.reflect.Constructor[_]]">const</a>.<span title="(p: java.lang.reflect.Constructor[_] =&gt; Boolean)Option[java.lang.reflect.Constructor[_]]">find</span> <span class="delimiter">{</span>
            <a title="java.lang.reflect.Constructor[_]" id="387725">cp</a> =&gt; <span class="delimiter">{</span>
              <a href="#387725" title="java.lang.reflect.Constructor[_]">cp</a>.<span title="()Array[java.lang.Class[_]]">getParameterTypes</span>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(2)" class="int">2</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
                <a href="#387725" title="java.lang.reflect.Constructor[_]">cp</a>.<span title="()Array[java.lang.Class[_]]">getParameterTypes</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(i: Int)java.lang.Class[_]">apply</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<span title="(x$1: java.lang.Class[_])Boolean">isAssignableFrom</span><span class="delimiter">(</span><a href="#387389" title="java.lang.Class[_]">clz</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
                <a href="#387725" title="java.lang.reflect.Constructor[_]">cp</a>.<span title="()Array[java.lang.Class[_]]">getParameterTypes</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(i: Int)java.lang.Class[_]">apply</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="(x$1: java.lang.Class[_])Boolean">isAssignableFrom</span><span class="delimiter">(</span>classOf<span title="java.lang.Class[net.liftweb.http.LiftSession](classOf[net.liftweb.http.LiftSession])" class="delimiter">[</span>LiftSession<span class="delimiter">]</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>.
            <span title="(f: java.lang.reflect.Constructor[_] =&gt; net.liftweb.http.PAndSessionConstructor)Option[net.liftweb.http.PAndSessionConstructor]">map</span><span class="delimiter">(</span><a title="java.lang.reflect.Constructor[_]" id="387740">const</a> =&gt; <a href="Templates.scala.html#387745" title="(c: java.lang.reflect.Constructor[_])net.liftweb.http.PAndSessionConstructor">PAndSessionConstructor</a><span class="delimiter">(</span><a href="#387740" title="java.lang.reflect.Constructor[_]">const</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(alternative: =&gt; Option[Product with Serializable with net.liftweb.http.ConstructorType])Option[Product with Serializable with net.liftweb.http.ConstructorType]">orElse</span>
            <a href="#386985" title="(xs: Array[java.lang.reflect.Constructor[_]])scala.collection.mutable.ArrayOps[java.lang.reflect.Constructor[_]]">const</a>.<span title="(p: java.lang.reflect.Constructor[_] =&gt; Boolean)Option[java.lang.reflect.Constructor[_]]">find</span> <span class="delimiter">{</span>
              <a title="java.lang.reflect.Constructor[_]" id="388096">cp</a> =&gt; <span class="delimiter">{</span>
                <a href="#388096" title="java.lang.reflect.Constructor[_]">cp</a>.<span title="()Array[java.lang.Class[_]]">getParameterTypes</span>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
                  <a href="#388096" title="java.lang.reflect.Constructor[_]">cp</a>.<span title="()Array[java.lang.Class[_]]">getParameterTypes</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(i: Int)java.lang.Class[_]">apply</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<span title="(x$1: java.lang.Class[_])Boolean">isAssignableFrom</span><span class="delimiter">(</span><a href="#387389" title="java.lang.Class[_]">clz</a><span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>.
              <span title="(f: java.lang.reflect.Constructor[_] =&gt; net.liftweb.http.PConstructor)Option[net.liftweb.http.PConstructor]">map</span><span class="delimiter">(</span><a title="java.lang.reflect.Constructor[_]" id="388109">const</a> =&gt; <a href="Templates.scala.html#388114" title="(c: java.lang.reflect.Constructor[_])net.liftweb.http.PConstructor">PConstructor</a><span class="delimiter">(</span><a href="#388109" title="java.lang.reflect.Constructor[_]">const</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#28627" title="(in: Option[net.liftweb.http.ConstructorType])net.liftweb.common.Box[net.liftweb.http.ConstructorType]">orElse</a> <a href="#386986" title="()net.liftweb.common.Box[net.liftweb.http.ConstructorType]">nullConstructor</a><a href="../../../../common/net/liftweb/common/Box.scala.html#28630" title="(in: net.liftweb.common.Box[net.liftweb.http.ConstructorType])Option[net.liftweb.http.ConstructorType]" class="delimiter">(</a><span class="delimiter">)</span>

        <span class="keyword">case</span> <span title="net.liftweb.common.Box[net.liftweb.http.ConstructorType]">_</span> =&gt;
          <a href="#386986" title="()net.liftweb.common.Box[net.liftweb.http.ConstructorType]">nullConstructor</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="delimiter">(</span><span title="net.liftweb.common.Box[net.liftweb.http.ConstructorType]" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../../util/net/liftweb/util/Props.scala.html#13579" title="object net.liftweb.util.Props">Props</a>.<a href="../../../../util/net/liftweb/util/Props.scala.html#151319" title="=&gt; Boolean">devMode</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="comment">// no caching in dev mode</span>
      <a href="#386982" title="()net.liftweb.common.Box[net.liftweb.http.ConstructorType]">calcConstructor</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="(Class[T], net.liftweb.common.Box[java.lang.Class[_]])" id="388161">key</a> = <span class="delimiter">(</span><a href="#386950" title="(x: Class[T])ArrowAssoc[Class[T]]">clz</a> <span title="(y: net.liftweb.common.Box[java.lang.Class[_]])(Class[T], net.liftweb.common.Box[java.lang.Class[_]])">-&gt;</span> <a href="#386949" title="net.liftweb.common.Box[net.liftweb.http.ParamPair]">pp</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: net.liftweb.http.ParamPair =&gt; java.lang.Class[_])net.liftweb.common.Box[java.lang.Class[_]]">map</a><span class="delimiter">(</span><a href="#388182" title="net.liftweb.http.ParamPair">_</a>.<a href="Templates.scala.html#386959" title="=&gt; Class[_]">clz</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#326792" title="=&gt; Map[(Class[_], net.liftweb.common.Box[Class[_]]),net.liftweb.common.Box[net.liftweb.http.ConstructorType]]">constructorCache</a>.<span title="(key: (Class[_], net.liftweb.common.Box[Class[_]]))Option[net.liftweb.common.Box[net.liftweb.http.ConstructorType]]">get</span><span class="delimiter">(</span><a href="#388161" title="(Class[T], net.liftweb.common.Box[java.lang.Class[_]])">key</a><span class="delimiter">)</span> <span title="net.liftweb.common.Box[net.liftweb.http.ConstructorType]" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="net.liftweb.common.Box[net.liftweb.http.ConstructorType]">Some</span><span class="delimiter">(</span><a title="net.liftweb.common.Box[net.liftweb.http.ConstructorType]" id="388201">v</a><span class="delimiter">)</span> =&gt; <a href="#388201" title="net.liftweb.common.Box[net.liftweb.http.ConstructorType]">v</a>
        <span class="keyword">case</span> <span title="net.liftweb.common.Box[net.liftweb.http.ConstructorType]">_</span> =&gt; <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="net.liftweb.common.Box[net.liftweb.http.ConstructorType]" id="388202">nv</a> = <a href="#386982" title="()net.liftweb.common.Box[net.liftweb.http.ConstructorType]">calcConstructor</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#326792" title="(x$1: Map[(Class[_], net.liftweb.common.Box[Class[_]]),net.liftweb.common.Box[net.liftweb.http.ConstructorType]])Unit">constructorCache</a> <span title="(kv: ((Class[_], net.liftweb.common.Box[Class[_]]), net.liftweb.common.Box[net.liftweb.http.ConstructorType]))scala.collection.immutable.Map[(Class[_], net.liftweb.common.Box[Class[_]]),net.liftweb.common.Box[net.liftweb.http.ConstructorType]]">+=</span> <span class="delimiter">(</span><a href="#388161" title="(x: (Class[T], net.liftweb.common.Box[java.lang.Class[_]]))ArrowAssoc[(Class[T], net.liftweb.common.Box[java.lang.Class[_]])]">key</a> <span title="(y: net.liftweb.common.Box[net.liftweb.http.ConstructorType])((Class[T], net.liftweb.common.Box[java.lang.Class[_]]), net.liftweb.common.Box[net.liftweb.http.ConstructorType])">-&gt;</span> <a href="#388202" title="net.liftweb.common.Box[net.liftweb.http.ConstructorType]">nv</a><span class="delimiter">)</span>
          <a href="#388202" title="net.liftweb.common.Box[net.liftweb.http.ConstructorType]">nv</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: net.liftweb.http.ConstructorType =&gt; T)net.liftweb.common.Box[T]">map</a> <a href="#388354" title="T" class="delimiter">{</a>
      <span class="keyword">case</span> <a title="Nothing" id="388355">uc</a>: <a href="Templates.scala.html#14742" title="net.liftweb.http.UnitConstructor">UnitConstructor</a> =&gt; <a href="#388355" title="net.liftweb.http.UnitConstructor">uc</a>.<a href="Templates.scala.html#387337" title="Nothing">makeOne</a>
      <span class="keyword">case</span> <a title="Nothing" id="388359">pc</a>: <a href="Templates.scala.html#14748" title="net.liftweb.http.PConstructor">PConstructor</a> =&gt; <a href="#388359" title="net.liftweb.http.PConstructor">pc</a>.<a href="Templates.scala.html#388119" title="(p: Any)Nothing">makeOne</a><span class="delimiter">(</span><a href="#386949" title="net.liftweb.common.Box[net.liftweb.http.ParamPair]">pp</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27015" title="=&gt; net.liftweb.http.ParamPair">open_!</a>.<a href="Templates.scala.html#386957" title="=&gt; Any">v</a><span class="delimiter">)</span> <span class="comment">// open_! okay</span>
      <span class="keyword">case</span> <a title="Nothing" id="388363">psc</a>: <a href="Templates.scala.html#14745" title="net.liftweb.http.PAndSessionConstructor">PAndSessionConstructor</a> =&gt; <a href="#388363" title="net.liftweb.http.PAndSessionConstructor">psc</a>.<a href="Templates.scala.html#387750" title="(p: Any, s: net.liftweb.http.LiftSession)Nothing">makeOne</a><span class="delimiter">(</span><a href="#386949" title="net.liftweb.common.Box[net.liftweb.http.ParamPair]">pp</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27015" title="=&gt; net.liftweb.http.ParamPair">open_!</a>.<a href="Templates.scala.html#386957" title="=&gt; Any">v</a>, <a href="#386948" title="net.liftweb.http.LiftSession">session</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Check to see if the template is marked designer friendly
   * and lop off the stuff before the first surround
   */</span>
  @deprecated<span class="delimiter">(</span><span class="string">&quot;Use Templates.checkForContentId&quot;</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(in: scala.xml.NodeSeq)scala.xml.NodeSeq" id="326797">checkForContentId</a><span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="326798">in</a>: <span title="scala.xml.NodeSeq">NodeSeq</span><span class="delimiter">)</span>: <span title="scala.xml.NodeSeq">NodeSeq</span> =
    <a href="Templates.scala.html#14730" title="object net.liftweb.http.Templates">Templates</a>.<a href="Templates.scala.html#342666" title="(in: scala.xml.NodeSeq)scala.xml.NodeSeq">checkForContentId</a><span class="delimiter">(</span><a href="#326798" title="scala.xml.NodeSeq">in</a><span class="delimiter">)</span>


<span class="delimiter">}</span>


<span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> case <span class="keyword">class</span> <a title="class AddSession extends java.lang.Object with ScalaObject with Product with Serializable" id="403389">AddSession</a><a href="#403389" title="ScalaObject" class="delimiter">(</a><a title="net.liftweb.http.LiftSession" id="403386">session</a>: <a href="#14496" title="net.liftweb.http.LiftSession">LiftSession</a><span class="delimiter">)</span>

<span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> case <span class="keyword">class</span> <a title="class RemoveSession extends java.lang.Object with ScalaObject with Product with Serializable" id="403382">RemoveSession</a><a href="#403382" title="ScalaObject" class="delimiter">(</a><a title="String" id="389255">sessionId</a>: <span title="String">String</span><span class="delimiter">)</span>

case <span class="keyword">class</span> <a title="class SessionWatcherInfo extends java.lang.Object with ScalaObject with Product with Serializable" id="403378">SessionWatcherInfo</a><a href="#403378" title="ScalaObject" class="delimiter">(</a><a title="Map[String,net.liftweb.http.SessionInfo]" id="389415">sessions</a>: <span title="Map[String,net.liftweb.http.SessionInfo]">Map</span><span class="delimiter">[</span>String, SessionInfo<span class="delimiter">]</span><span class="delimiter">)</span>

<span class="comment">/**
 * Information about sessions
 */</span>
case <span class="keyword">class</span> <a title="class SessionInfo extends java.lang.Object with ScalaObject with Product with Serializable" id="403374">SessionInfo</a><a href="#403374" title="ScalaObject" class="delimiter">(</a><a title="net.liftweb.http.LiftSession" id="389132">session</a>: <a href="#14496" title="net.liftweb.http.LiftSession">LiftSession</a>, <a title="net.liftweb.common.Box[String]" id="389133">userAgent</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[String]">Box</a><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="net.liftweb.common.Box[String]" id="389134">ipAddress</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[String]">Box</a><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="Int" id="389135">requestCnt</a>: <span title="Int">Int</span>, <a title="Long" id="389136">lastAccess</a>: <span title="Long">Long</span><span class="delimiter">)</span>

<span class="comment">/**
 * Manages LiftSessions because the servlet container is less than optimal at
 * timing sessions out.
 */</span>
<span class="keyword">object</span> <a title="object net.liftweb.http.SessionMaster" id="14484">SessionMaster</a> <span title="ScalaObject" class="keyword">extends</span> <a href="../../../../actor/net/liftweb/actor/LiftActor.scala.html#10558" title="net.liftweb.actor.LiftActor">LiftActor</a> <span class="keyword">with</span> <a href="../../../../common/net/liftweb/common/Logging.scala.html#10717" title="net.liftweb.common.Loggable">Loggable</a> <span class="delimiter">{</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Map[String,net.liftweb.http.SessionInfo]" id="357490">sessions</a>: <span title="Map[String,net.liftweb.http.SessionInfo]">Map</span><span class="delimiter">[</span>String, SessionInfo<span class="delimiter">]</span> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="scala.collection.immutable.Map[String,Nothing]">empty</span>

  <span class="keyword">private</span> <span class="keyword">object</span> <a title="object net.liftweb.http.SessionMaster.CheckAndPurge" id="357492">CheckAndPurge</a>

  <span class="comment">/**
   * If you have a rule other than &lt;pre&gt;Box !! req.request.remoteAddress&lt;/pre&gt;
   * for calculating the remote address, change this function
   */</span>
  @volatile <span class="keyword">var</span> <a title="net.liftweb.http.Req =&gt; net.liftweb.common.Box[String]" id="357495">getIpFromReq</a>: Req =&gt; Box<span class="delimiter">[</span>String<span class="delimiter">]</span> = <a title="net.liftweb.http.Req" id="388678">req</a> =&gt; <a href="../../../../common/net/liftweb/common/Box.scala.html#10572" title="object net.liftweb.common.Box">Box</a> <a href="../../../../common/net/liftweb/common/Box.scala.html#28636" title="(in: String)net.liftweb.common.Box[String]">!!</a> <a href="#388678" title="net.liftweb.http.Req">req</a>.<a href="Req.scala.html#149145" title="=&gt; net.liftweb.http.provider.HTTPRequest">request</a>.<a href="provider/HTTPRequest.scala.html#216879" title="=&gt; String">remoteAddress</a>

  <span class="comment">/**
   * A list of functions that are run every 10 seconds.  The first param is
   * map containing the session ID and the sessions.  The second param is a function
   * to call to destroy the session.
   */</span>
  @volatile <span class="keyword">var</span> <a title="List[(Map[String,net.liftweb.http.SessionInfo], net.liftweb.http.SessionInfo =&gt; Unit) =&gt; Unit]" id="357498">sessionCheckFuncs</a>: <span title="List[(Map[String,net.liftweb.http.SessionInfo], net.liftweb.http.SessionInfo =&gt; Unit) =&gt; Unit]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>Map<span class="delimiter">[</span>String, SessionInfo<span class="delimiter">]</span>, SessionInfo =&gt; Unit<span class="delimiter">)</span> =&gt; Unit<span class="delimiter">]</span> =
    <span class="delimiter">(</span><span class="delimiter">(</span>ses: <span title="Map[String,net.liftweb.http.SessionInfo]">Map</span><span class="delimiter">[</span>String, SessionInfo<span class="delimiter">]</span>, destroyer: SessionInfo =&gt; Unit<span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Long" id="388688">now</a> = <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48788" title="=&gt; Long">millis</a>

      <span class="keyword">for</span> <span class="delimiter">(</span><span class="delimiter">(</span><a title="String" id="388710">id</a>, <a title="net.liftweb.http.SessionInfo" id="388711">info</a>@SessionInfo<span class="delimiter">(</span><a title="net.liftweb.http.LiftSession" id="388712">session</a>, _, _, _, _<span class="delimiter">)</span><span class="delimiter">)</span> &lt;- <a href="#388686" title="Map[String,net.liftweb.http.SessionInfo]">ses</a>.<a href="#388691" title="(f: (String, net.liftweb.http.SessionInfo) =&gt; Unit)Unit">iterator</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#388688" title="Long">now</a> <span title="(x: Long)Long">-</span> <a href="#388712" title="net.liftweb.http.LiftSession">session</a>.<a href="#230190" title="=&gt; Long">lastServiceTime</a> <span title="(x: Long)Boolean">&gt;</span> <a href="#388712" title="net.liftweb.http.LiftSession">session</a>.<a href="#230193" title="=&gt; Long">inactivityLength</a> <span title="(x: Boolean)Boolean">||</span> <a href="#388712" title="net.liftweb.http.LiftSession">session</a>.<a href="#230154" title="=&gt; Boolean">markedForTermination</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../../../../common/net/liftweb/common/Logging.scala.html#19845" title="=&gt; net.liftweb.common.Logger">logger</a>.<a href="../../../../common/net/liftweb/common/Logging.scala.html#31948" title="(msg: =&gt; AnyRef)Unit">info</a><span class="delimiter">(</span><span title="java.lang.String(&quot; Session &quot;)" class="string">&quot; Session &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#388710" title="String">id</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; expired&quot;)" class="string">&quot; expired&quot;</span><span class="delimiter">)</span>
          <a href="#388687" title="(v1: net.liftweb.http.SessionInfo)Unit">destroyer</a><span class="delimiter">(</span><a href="#388711" title="net.liftweb.http.SessionInfo">info</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#388712" title="net.liftweb.http.LiftSession">session</a>.<a href="#230230" title="()Unit">doCometActorCleanup</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#388712" title="net.liftweb.http.LiftSession">session</a>.<a href="#230237" title="()Unit">cleanupUnseenFuncs</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span><span class="delimiter">)</span> <a href="#388684" title="(x: (Map[String,net.liftweb.http.SessionInfo], net.liftweb.http.SessionInfo =&gt; Unit) =&gt; Unit)List[(Map[String,net.liftweb.http.SessionInfo], net.liftweb.http.SessionInfo =&gt; Unit) =&gt; Unit]">::</a> <span title="object Nil">Nil</span>

  <span class="keyword">def</span> <a title="(req: net.liftweb.http.Req, otherId: net.liftweb.common.Box[String])net.liftweb.common.Box[net.liftweb.http.LiftSession]" id="357500">getSession</a><span class="delimiter">(</span><a title="net.liftweb.http.Req" id="357532">req</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a>, <a title="net.liftweb.common.Box[String]" id="357533">otherId</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[String]">Box</a><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.http.LiftSession]">Box</a><span class="delimiter">[</span>LiftSession<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">this</span>.<span title="(x$1: net.liftweb.common.Box[net.liftweb.http.LiftSession])net.liftweb.common.Box[net.liftweb.http.LiftSession]">synchronized</span> <span class="delimiter">{</span>
      <a href="#357533" title="net.liftweb.common.Box[String]">otherId</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27023" title="(f: String =&gt; net.liftweb.common.Box[net.liftweb.http.SessionInfo])net.liftweb.common.Box[net.liftweb.http.SessionInfo]">flatMap</a><span class="delimiter">(</span><a href="#357490" title="=&gt; Map[String,net.liftweb.http.SessionInfo]">sessions</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#28627" title="(in: Option[net.liftweb.http.SessionInfo])net.liftweb.common.Box[net.liftweb.http.SessionInfo]">get</a><span class="delimiter">)</span> <span title="net.liftweb.common.Box[net.liftweb.http.LiftSession]" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="net.liftweb.common.Box[net.liftweb.http.LiftSession]">Full</span><span class="delimiter">(</span><a title="net.liftweb.http.SessionInfo" id="388757">session</a><span class="delimiter">)</span> =&gt; <a href="#357507" title="(f: =&gt; net.liftweb.common.Box[net.liftweb.http.SessionInfo])net.liftweb.common.Box[net.liftweb.http.LiftSession]">lockAndBump</a><span class="delimiter">(</span><a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.SessionInfo)net.liftweb.common.Full[net.liftweb.http.SessionInfo]">Full</a><span class="delimiter">(</span><a href="#388757" title="net.liftweb.http.SessionInfo">session</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="comment">// for stateless requests, vend a stateless session if none is found</span>
        <span class="keyword">case</span> <span title="net.liftweb.common.Box[net.liftweb.http.LiftSession]">_</span> <span class="keyword">if</span> <a href="#357532" title="net.liftweb.http.Req">req</a>.<a href="Req.scala.html#149160" title="=&gt; Boolean">stateless_?</a> =&gt;
          <a href="#357507" title="(f: =&gt; net.liftweb.common.Box[net.liftweb.http.SessionInfo])net.liftweb.common.Box[net.liftweb.http.LiftSession]">lockAndBump</a> <span class="delimiter">{</span>
            <a href="#357532" title="net.liftweb.http.Req">req</a>.<a href="Req.scala.html#149198" title="=&gt; net.liftweb.common.Box[String]">sessionId</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27023" title="(f: String =&gt; net.liftweb.common.Box[net.liftweb.http.SessionInfo])net.liftweb.common.Box[net.liftweb.http.SessionInfo]">flatMap</a><span class="delimiter">(</span><a href="#357490" title="=&gt; Map[String,net.liftweb.http.SessionInfo]">sessions</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#28627" title="(in: Option[net.liftweb.http.SessionInfo])net.liftweb.common.Box[net.liftweb.http.SessionInfo]">get</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27043" title="(alternative: =&gt; net.liftweb.common.Box[net.liftweb.http.LiftSession])net.liftweb.common.Box[net.liftweb.http.LiftSession]">or</a> <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.LiftSession with net.liftweb.http.StatelessSession)net.liftweb.common.Full[net.liftweb.http.LiftSession with net.liftweb.http.StatelessSession]">Full</a><span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158890" title="=&gt; net.liftweb.http.LiftRules#FactoryMaker[net.liftweb.http.Req =&gt; net.liftweb.http.LiftSession with net.liftweb.http.StatelessSession]">statelessSession</a>.<a href="Factory.scala.html#159330" title="=&gt; net.liftweb.http.Req =&gt; net.liftweb.http.LiftSession with net.liftweb.http.StatelessSession">vend</a>.<span title="(v1: net.liftweb.http.Req)net.liftweb.http.LiftSession with net.liftweb.http.StatelessSession">apply</span><span class="delimiter">(</span><a href="#357532" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="net.liftweb.common.Box[net.liftweb.http.LiftSession]">_</span> =&gt; <a href="#357506" title="(req: net.liftweb.http.provider.HTTPRequest, otherId: net.liftweb.common.Box[String])net.liftweb.common.Box[net.liftweb.http.LiftSession]">getSession</a><span class="delimiter">(</span><a href="#357532" title="net.liftweb.http.Req">req</a>.<a href="Req.scala.html#149145" title="=&gt; net.liftweb.http.provider.HTTPRequest">request</a>, <a href="#357533" title="net.liftweb.common.Box[String]">otherId</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(id: String, otherId: net.liftweb.common.Box[String])net.liftweb.common.Box[net.liftweb.http.LiftSession]" id="357501">getSession</a><span class="delimiter">(</span><a title="String" id="357529">id</a>: <span title="String">String</span>, <a title="net.liftweb.common.Box[String]" id="357530">otherId</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[String]">Box</a><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.http.LiftSession]">Box</a><span class="delimiter">[</span>LiftSession<span class="delimiter">]</span> = <a href="#357507" title="(f: =&gt; net.liftweb.common.Box[net.liftweb.http.SessionInfo])net.liftweb.common.Box[net.liftweb.http.LiftSession]">lockAndBump</a> <span class="delimiter">{</span>
    <a href="#357530" title="net.liftweb.common.Box[String]">otherId</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27023" title="(f: String =&gt; net.liftweb.common.Box[net.liftweb.http.SessionInfo])net.liftweb.common.Box[net.liftweb.http.SessionInfo]">flatMap</a><span class="delimiter">(</span><a href="#357490" title="=&gt; Map[String,net.liftweb.http.SessionInfo]">sessions</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#28627" title="(in: Option[net.liftweb.http.SessionInfo])net.liftweb.common.Box[net.liftweb.http.SessionInfo]">get</a><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27043" title="(alternative: =&gt; net.liftweb.common.Box[net.liftweb.http.SessionInfo])net.liftweb.common.Box[net.liftweb.http.SessionInfo]">or</a> <a href="../../../../common/net/liftweb/common/Box.scala.html#28602" title="(in: Option[net.liftweb.http.SessionInfo])net.liftweb.common.Box[net.liftweb.http.SessionInfo] with Serializable">Box</a><span class="delimiter">(</span><a href="#357490" title="=&gt; Map[String,net.liftweb.http.SessionInfo]">sessions</a>.<span title="(key: String)Option[net.liftweb.http.SessionInfo]">get</span><span class="delimiter">(</span><a href="#357529" title="String">id</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Put an Actor in this list and the Actor will receive a message
   * every 10 seconds with the current list of sessions:
   * SessionWatcherInfo
   */</span>
  @volatile <span class="keyword">var</span> <a title="List[net.liftweb.actor.LiftActor]" id="357503">sessionWatchers</a>: <span title="List[net.liftweb.actor.LiftActor]">List</span><span class="delimiter">[</span>LiftActor<span class="delimiter">]</span> = <span title="object Nil">Nil</span>

  <span class="comment">/**
   * Returns a LiftSession or Empty if not found
   */</span>
  <span class="keyword">def</span> <a title="(httpSession: =&gt; net.liftweb.http.provider.HTTPSession, otherId: net.liftweb.common.Box[String])net.liftweb.common.Box[net.liftweb.http.LiftSession]" id="357505">getSession</a><span class="delimiter">(</span><a title="=&gt; net.liftweb.http.provider.HTTPSession" id="357526">httpSession</a>: =&gt; HTTPSession, <a title="net.liftweb.common.Box[String]" id="357527">otherId</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[String]">Box</a><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.http.LiftSession]">Box</a><span class="delimiter">[</span>LiftSession<span class="delimiter">]</span> =
    <a href="#357507" title="(f: =&gt; net.liftweb.common.Box[net.liftweb.http.SessionInfo])net.liftweb.common.Box[net.liftweb.http.LiftSession]">lockAndBump</a> <span class="delimiter">{</span>
      <a href="#357527" title="net.liftweb.common.Box[String]">otherId</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27023" title="(f: String =&gt; net.liftweb.common.Box[net.liftweb.http.SessionInfo])net.liftweb.common.Box[net.liftweb.http.SessionInfo]">flatMap</a><span class="delimiter">(</span><a href="#357490" title="=&gt; Map[String,net.liftweb.http.SessionInfo]">sessions</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#28627" title="(in: Option[net.liftweb.http.SessionInfo])net.liftweb.common.Box[net.liftweb.http.SessionInfo]">get</a><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27043" title="(alternative: =&gt; net.liftweb.common.Box[net.liftweb.http.SessionInfo])net.liftweb.common.Box[net.liftweb.http.SessionInfo]">or</a> <a href="../../../../common/net/liftweb/common/Box.scala.html#28602" title="(in: Option[net.liftweb.http.SessionInfo])net.liftweb.common.Box[net.liftweb.http.SessionInfo] with Serializable">Box</a><span class="delimiter">(</span><a href="#357490" title="=&gt; Map[String,net.liftweb.http.SessionInfo]">sessions</a>.<span title="(key: String)Option[net.liftweb.http.SessionInfo]">get</span><span class="delimiter">(</span><a href="#357526" title="=&gt; net.liftweb.http.provider.HTTPSession">httpSession</a>.<a href="provider/HTTPSession.scala.html#357303" title="=&gt; String">sessionId</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="comment">/**
   * Returns a LiftSession or Empty if not found
   */</span>
  <span class="keyword">def</span> <a title="(req: net.liftweb.http.provider.HTTPRequest, otherId: net.liftweb.common.Box[String])net.liftweb.common.Box[net.liftweb.http.LiftSession]" id="357506">getSession</a><span class="delimiter">(</span><a title="net.liftweb.http.provider.HTTPRequest" id="357523">req</a>: <a href="provider/HTTPRequest.scala.html#15082" title="net.liftweb.http.provider.HTTPRequest">HTTPRequest</a>, <a title="net.liftweb.common.Box[String]" id="357524">otherId</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[String]">Box</a><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.http.LiftSession]">Box</a><span class="delimiter">[</span>LiftSession<span class="delimiter">]</span> =
    <a href="#357507" title="(f: =&gt; net.liftweb.common.Box[net.liftweb.http.SessionInfo])net.liftweb.common.Box[net.liftweb.http.LiftSession]">lockAndBump</a> <span class="delimiter">{</span>
      <a href="#357524" title="net.liftweb.common.Box[String]">otherId</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27023" title="(f: String =&gt; net.liftweb.common.Box[net.liftweb.http.SessionInfo])net.liftweb.common.Box[net.liftweb.http.SessionInfo]">flatMap</a><span class="delimiter">(</span><a href="#357490" title="=&gt; Map[String,net.liftweb.http.SessionInfo]">sessions</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#28627" title="(in: Option[net.liftweb.http.SessionInfo])net.liftweb.common.Box[net.liftweb.http.SessionInfo]">get</a><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27043" title="(alternative: =&gt; net.liftweb.common.Box[net.liftweb.http.SessionInfo])net.liftweb.common.Box[net.liftweb.http.SessionInfo]">or</a> <a href="#357523" title="net.liftweb.http.provider.HTTPRequest">req</a>.<a href="provider/HTTPRequest.scala.html#216878" title="=&gt; net.liftweb.common.Box[String]">sessionId</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27023" title="(f: String =&gt; net.liftweb.common.Box[net.liftweb.http.SessionInfo])net.liftweb.common.Box[net.liftweb.http.SessionInfo]">flatMap</a><span class="delimiter">(</span><a title="String" id="389010">id</a> =&gt; <a href="#357490" title="=&gt; Map[String,net.liftweb.http.SessionInfo]">sessions</a>.<span title="(key: String)Option[net.liftweb.http.SessionInfo]">get</span><a href="../../../../common/net/liftweb/common/Box.scala.html#28627" title="(in: Option[net.liftweb.http.SessionInfo])net.liftweb.common.Box[net.liftweb.http.SessionInfo]" class="delimiter">(</a><a href="#389010" title="String">id</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="comment">/**
   * Increments the count and last access time for the session
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(f: =&gt; net.liftweb.common.Box[net.liftweb.http.SessionInfo])net.liftweb.common.Box[net.liftweb.http.LiftSession]" id="357507">lockAndBump</a><span class="delimiter">(</span><a title="=&gt; net.liftweb.common.Box[net.liftweb.http.SessionInfo]" id="388758">f</a>: =&gt; Box<span class="delimiter">[</span>SessionInfo<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.http.LiftSession]">Box</a><span class="delimiter">[</span>LiftSession<span class="delimiter">]</span> = <span class="keyword">this</span>.<span title="(x$1: net.liftweb.common.Box[net.liftweb.http.LiftSession])net.liftweb.common.Box[net.liftweb.http.LiftSession]">synchronized</span> <span class="delimiter">{</span>
    <a href="#388758" title="=&gt; net.liftweb.common.Box[net.liftweb.http.SessionInfo]">f</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: net.liftweb.http.SessionInfo =&gt; net.liftweb.http.LiftSession)net.liftweb.common.Box[net.liftweb.http.LiftSession]">map</a> <span class="delimiter">{</span>
      <a title="net.liftweb.http.SessionInfo" id="389028">s</a> =&gt;
        <a href="#357490" title="(x$1: Map[String,net.liftweb.http.SessionInfo])Unit">sessions</a> <span title="(kv: (String, net.liftweb.http.SessionInfo))scala.collection.immutable.Map[String,net.liftweb.http.SessionInfo]">+=</span> <a href="#389028" title="net.liftweb.http.SessionInfo">s</a>.<a href="#389132" title="=&gt; net.liftweb.http.LiftSession">session</a>.<a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#49003" title="implicit net.liftweb.util.BindHelpers.strToSuperArrowAssoc : (in: String)net.liftweb.util.Helpers.SuperArrowAssoc">uniqueId</a> <a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#58395" title="(in: net.liftweb.http.SessionInfo)(String, net.liftweb.http.SessionInfo)">-&gt;</a> <a href="#403374" title="(session: net.liftweb.http.LiftSession, userAgent: net.liftweb.common.Box[String], ipAddress: net.liftweb.common.Box[String], requestCnt: Int, lastAccess: Long)net.liftweb.http.SessionInfo">SessionInfo</a><span class="delimiter">(</span><a href="#389028" title="net.liftweb.http.SessionInfo">s</a>.<a href="#389132" title="=&gt; net.liftweb.http.LiftSession">session</a>, <a href="#389028" title="net.liftweb.http.SessionInfo">s</a>.<a href="#389133" title="=&gt; net.liftweb.common.Box[String]">userAgent</a>, <a href="#389028" title="net.liftweb.http.SessionInfo">s</a>.<a href="#389134" title="=&gt; net.liftweb.common.Box[String]">ipAddress</a>, <a href="#389028" title="net.liftweb.http.SessionInfo">s</a>.<a href="#389135" title="=&gt; Int">requestCnt</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>, <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48788" title="=&gt; Long">millis</a><span class="delimiter">)</span>

        <a href="#389028" title="net.liftweb.http.SessionInfo">s</a>.<a href="#389132" title="=&gt; net.liftweb.http.LiftSession">session</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="[T](f: =&gt; T)T" id="357508">lockRead</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="357510">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="=&gt; T" id="389170">f</a>: =&gt; T<span class="delimiter">)</span>: <a href="#357510" title="T">T</a> = <span class="keyword">this</span>.<span title="(x$1: T)T">synchronized</span> <span class="delimiter">{</span>
    <a href="#389170" title="=&gt; T">f</a>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="[T](f: =&gt; T)T" id="357511">lockWrite</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="357513">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="=&gt; T" id="389176">f</a>: =&gt; T<span class="delimiter">)</span>: <a href="#357513" title="T">T</a> = <span class="keyword">this</span>.<span title="(x$1: T)T">synchronized</span> <span class="delimiter">{</span>
    <a href="#389176" title="=&gt; T">f</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Adds a new session to SessionMaster
   */</span>
  <span class="keyword">def</span> <a title="(liftSession: net.liftweb.http.LiftSession, req: net.liftweb.http.Req, userAgent: net.liftweb.common.Box[String], ipAddress: net.liftweb.common.Box[String])Unit" id="357514">addSession</a><span class="delimiter">(</span><a title="net.liftweb.http.LiftSession" id="357562">liftSession</a>: <a href="#14496" title="net.liftweb.http.LiftSession">LiftSession</a>, <a title="net.liftweb.http.Req" id="357563">req</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a>,
                 <a title="net.liftweb.common.Box[String]" id="357564">userAgent</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[String]">Box</a><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="net.liftweb.common.Box[String]" id="357565">ipAddress</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[String]">Box</a><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#357507" title="(f: =&gt; net.liftweb.common.Box[net.liftweb.http.SessionInfo])net.liftweb.common.Box[net.liftweb.http.LiftSession]">lockAndBump</a> <span class="delimiter">{</span>
      <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.SessionInfo)net.liftweb.common.Full[net.liftweb.http.SessionInfo]">Full</a><span class="delimiter">(</span><a href="#403374" title="(session: net.liftweb.http.LiftSession, userAgent: net.liftweb.common.Box[String], ipAddress: net.liftweb.common.Box[String], requestCnt: Int, lastAccess: Long)net.liftweb.http.SessionInfo">SessionInfo</a><span class="delimiter">(</span><a href="#357562" title="net.liftweb.http.LiftSession">liftSession</a>, <a href="#357564" title="net.liftweb.common.Box[String]">userAgent</a>, <a href="#357565" title="net.liftweb.common.Box[String]">ipAddress</a>, -<span title="Int(-1)" class="int">1</span>, <span title="Long(0L)" class="long">0L</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="comment">// bumped twice during session creation.  Ticket #529 DPP</span>
    <span class="delimiter">}</span>
    <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49376" title="(request: net.liftweb.http.Req, session: net.liftweb.http.LiftSession)(f: =&gt; Unit)Unit">init</a><span class="delimiter">(</span><a href="#357563" title="net.liftweb.http.Req">req</a>, <a href="#357562" title="net.liftweb.http.LiftSession">liftSession</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#357562" title="net.liftweb.http.LiftSession">liftSession</a>.<a href="#230207" title="()Unit">startSession</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#14470" title="object net.liftweb.http.LiftSession">LiftSession</a>.<a href="#326786" title="=&gt; List[(net.liftweb.http.LiftSession, net.liftweb.http.Req) =&gt; Unit]">afterSessionCreate</a>.<span title="(f: (net.liftweb.http.LiftSession, net.liftweb.http.Req) =&gt; Unit =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#389211" title="(v1: net.liftweb.http.LiftSession, v2: net.liftweb.http.Req)Unit">_</a><span class="delimiter">(</span><a href="#357562" title="net.liftweb.http.LiftSession">liftSession</a>, <a href="#357563" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="#357562" title="net.liftweb.http.LiftSession">liftSession</a>.<a href="#357325" title="=&gt; net.liftweb.common.Box[net.liftweb.http.provider.HTTPSession]">httpSession</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27031" title="(f: net.liftweb.http.provider.HTTPSession =&gt; Unit)Unit">foreach</a><span class="delimiter">(</span><a href="#389221" title="net.liftweb.http.provider.HTTPSession">_</a>.<a href="provider/HTTPSession.scala.html#357304" title="(liftSession: net.liftweb.http.LiftSession)Unit">link</a><span class="delimiter">(</span><a href="#357562" title="net.liftweb.http.LiftSession">liftSession</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="=&gt; PartialFunction[Any,Unit]" id="357515">messageHandler</a> = <a href="#357517" title="=&gt; PartialFunction[Any,Unit]">reaction</a>

  <span class="comment">/**
   * Shut down all sessions
   */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">def</span> <a title="()Unit" id="357516">shutDownAllSessions</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Map[String,net.liftweb.http.SessionInfo]" id="389227">ses</a> = <a href="#357508" title="(f: =&gt; Map[String,net.liftweb.http.SessionInfo])Map[String,net.liftweb.http.SessionInfo]">lockRead</a><span class="delimiter">(</span><a href="#357490" title="=&gt; Map[String,net.liftweb.http.SessionInfo]">sessions</a><span class="delimiter">)</span>
    <a href="#389227" title="Map[String,net.liftweb.http.SessionInfo]">ses</a>.<span title="(f: (String, net.liftweb.http.SessionInfo) =&gt; Unit)Unit">foreach</span> <a href="#389247" title="Unit" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="Unit" class="delimiter">(</span><a title="String" id="389250">key</a>, <a title="net.liftweb.http.SessionInfo" id="389251">sess</a><span class="delimiter">)</span> =&gt;
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#389251" title="net.liftweb.http.SessionInfo">sess</a>.<a href="#389132" title="=&gt; net.liftweb.http.LiftSession">session</a>.<a href="#230160" title="=&gt; Boolean">markedForShutDown_?</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#389251" title="net.liftweb.http.SessionInfo">sess</a>.<a href="#389132" title="=&gt; net.liftweb.http.LiftSession">session</a>.<a href="#230160" title="(x$1: Boolean)Unit">markedForShutDown_?</a> = <span title="Boolean(true)" class="keyword">true</span>
          <span class="keyword">this</span> <a href="../../../../actor/net/liftweb/actor/LiftActor.scala.html#29502" title="(msg: Any)Unit">!</a> <a href="#403382" title="(sessionId: String)net.liftweb.http.RemoveSession">RemoveSession</a><span class="delimiter">(</span><a href="#389250" title="String">key</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <a href="#389260" title="()Unit" class="delimiter">{</a>
      <span class="keyword">val</span> <a title="Map[String,net.liftweb.http.SessionInfo]" id="389261">s2</a> = <a href="#357508" title="(f: =&gt; Map[String,net.liftweb.http.SessionInfo])Map[String,net.liftweb.http.SessionInfo]">lockRead</a><span class="delimiter">(</span><a href="#357490" title="=&gt; Map[String,net.liftweb.http.SessionInfo]">sessions</a><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#389261" title="Map[String,net.liftweb.http.SessionInfo]">s2</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span title="Nothing" class="keyword">return</span>
      <span title="object java.lang.Thread">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><span title="Long(50L)" class="int">50</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="PartialFunction[Any,Unit]" id="357517">reaction</a>: <span title="PartialFunction[Any,Unit]">PartialFunction</span><span class="delimiter">[</span>Any, Unit<span class="delimiter">]</span> = <a href="#389273" title="Unit" class="delimiter">{</a>
    <span class="keyword">case</span> <span title="Unit">RemoveSession</span><span class="delimiter">(</span><a title="String" id="389274">sessionId</a><span class="delimiter">)</span> =&gt;
      <span class="keyword">val</span> <a title="Map[String,net.liftweb.http.SessionInfo]" id="389275">ses</a> = <a href="#357508" title="(f: =&gt; Map[String,net.liftweb.http.SessionInfo])Map[String,net.liftweb.http.SessionInfo]">lockRead</a><span class="delimiter">(</span><a href="#357490" title="=&gt; Map[String,net.liftweb.http.SessionInfo]">sessions</a><span class="delimiter">)</span>
      <a href="#389275" title="Map[String,net.liftweb.http.SessionInfo]">ses</a>.<span title="(key: String)Option[net.liftweb.http.SessionInfo]">get</span><span class="delimiter">(</span><a href="#389274" title="String">sessionId</a><span class="delimiter">)</span>.<span title="(f: net.liftweb.http.SessionInfo =&gt; Unit)Unit">foreach</span> <a href="#389285" title="Unit" class="delimiter">{</a>
        <span class="keyword">case</span> <span title="Unit">SessionInfo</span><span class="delimiter">(</span><a title="net.liftweb.http.LiftSession" id="389286">s</a>, _, _, _, _<span class="delimiter">)</span> =&gt;
          <a href="#389286" title="net.liftweb.http.LiftSession">s</a>.<a href="#230160" title="(x$1: Boolean)Unit">markedForShutDown_?</a> = <span title="Boolean(true)" class="keyword">true</span>
          <a href="../../../../util/net/liftweb/util/Schedule.scala.html#13609" title="object net.liftweb.util.Schedule">Schedule</a>.<a href="../../../../util/net/liftweb/util/Schedule.scala.html#316914" title="(f: () =&gt; Unit, delay: net.liftweb.util.Helpers.TimeSpan)java.util.concurrent.ScheduledFuture[Unit]">schedule</a><span class="delimiter">(</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
            <span class="keyword">try</span> <span class="delimiter">{</span>
              <a href="#389286" title="net.liftweb.http.LiftSession">s</a>.<a href="#230233" title="()Unit">doShutDown</a>
              <span class="keyword">try</span> <span class="delimiter">{</span>
                <a href="#389286" title="net.liftweb.http.LiftSession">s</a>.<a href="#357325" title="=&gt; net.liftweb.common.Box[net.liftweb.http.provider.HTTPSession]">httpSession</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27031" title="(f: net.liftweb.http.provider.HTTPSession =&gt; Unit)Unit">foreach</a><span class="delimiter">(</span><a href="#389299" title="net.liftweb.http.provider.HTTPSession">_</a>.<a href="provider/HTTPSession.scala.html#357305" title="(liftSession: net.liftweb.http.LiftSession)Unit">unlink</a><span class="delimiter">(</span><a href="#389286" title="net.liftweb.http.LiftSession">s</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <a title="Unit" id="389302">e</a>: <span title="Exception">Exception</span> =&gt; <span class="comment">// ignore... sometimes you can't do this and it's okay</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <a title="Unit" id="389303">e</a>: <span title="Exception">Exception</span> =&gt; <a href="../../../../common/net/liftweb/common/Logging.scala.html#19845" title="=&gt; net.liftweb.common.Logger">logger</a>.<a href="../../../../common/net/liftweb/common/Logging.scala.html#31955" title="(msg: =&gt; AnyRef, t: Throwable)Unit">warn</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Failure in remove session&quot;)" class="string">&quot;Failure in remove session&quot;</span>, <a href="#389303" title="Exception">e</a><span class="delimiter">)</span>

            <span class="delimiter">}</span>
          <span class="delimiter">}</span>, <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48777" title="implicit net.liftweb.util.TimeHelpers.intToTimeSpanBuilder : (in: Int)net.liftweb.util.Helpers.TimeSpanBuilder" class="int">0</a> <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#58471" title="=&gt; net.liftweb.util.Helpers.TimeSpan">seconds</a><span class="delimiter">)</span>
          <a href="#357511" title="(f: =&gt; Unit)Unit">lockWrite</a> <span class="delimiter">{</span>
            <a href="#357490" title="(x$1: Map[String,net.liftweb.http.SessionInfo])Unit">sessions</a> = <a href="#357490" title="=&gt; Map[String,net.liftweb.http.SessionInfo]">sessions</a> <span title="(key: String)scala.collection.immutable.Map[String,net.liftweb.http.SessionInfo]">-</span> <a href="#389274" title="String">sessionId</a>
          <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    <span class="keyword">case</span> <a href="#357492" title="Unit">CheckAndPurge</a> =&gt;
      <span class="keyword">val</span> <a title="Map[String,net.liftweb.http.SessionInfo]" id="389331">ses</a> = <a href="#357508" title="(f: =&gt; Map[String,net.liftweb.http.SessionInfo])Map[String,net.liftweb.http.SessionInfo]">lockRead</a> <span class="delimiter">{</span>
        <a href="#357490" title="=&gt; Map[String,net.liftweb.http.SessionInfo]">sessions</a>
      <span class="delimiter">}</span>

      <span class="keyword">for</span> <span class="delimiter">{</span>
        <a title="(Map[String,net.liftweb.http.SessionInfo], net.liftweb.http.SessionInfo =&gt; Unit) =&gt; Unit" id="389360">f</a> &lt;- <a href="#357498" title="(f: (Map[String,net.liftweb.http.SessionInfo], net.liftweb.http.SessionInfo =&gt; Unit) =&gt; Unit =&gt; Any)Unit">sessionCheckFuncs</a>
      <span class="delimiter">}</span> <span class="delimiter">{</span>
        <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../../util/net/liftweb/util/Props.scala.html#13579" title="object net.liftweb.util.Props">Props</a>.<a href="../../../../util/net/liftweb/util/Props.scala.html#151332" title="=&gt; Boolean">inGAE</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#389360" title="(v1: Map[String,net.liftweb.http.SessionInfo], v2: net.liftweb.http.SessionInfo =&gt; Unit)Unit">f</a><span class="delimiter">(</span><a href="#389331" title="Map[String,net.liftweb.http.SessionInfo]">ses</a>, <a title="net.liftweb.http.SessionInfo" id="389364">shutDown</a> =&gt; <span class="delimiter">{</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#389364" title="net.liftweb.http.SessionInfo">shutDown</a>.<a href="#389132" title="=&gt; net.liftweb.http.LiftSession">session</a>.<a href="#230160" title="=&gt; Boolean">markedForShutDown_?</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#389364" title="net.liftweb.http.SessionInfo">shutDown</a>.<a href="#389132" title="=&gt; net.liftweb.http.LiftSession">session</a>.<a href="#230160" title="(x$1: Boolean)Unit">markedForShutDown_?</a> = <span title="Boolean(true)" class="keyword">true</span>
              <span class="keyword">this</span>.<a href="#357519" title="(in: Any)Unit">sendMsg</a><span class="delimiter">(</span><a href="#403382" title="(sessionId: String)net.liftweb.http.RemoveSession">RemoveSession</a><span class="delimiter">(</span><a href="#389364" title="net.liftweb.http.SessionInfo">shutDown</a>.<a href="#389132" title="=&gt; net.liftweb.http.LiftSession">session</a>.<a href="#357324" title="=&gt; String">uniqueId</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="../../../../util/net/liftweb/util/Schedule.scala.html#13609" title="object net.liftweb.util.Schedule">Schedule</a>.<a href="../../../../util/net/liftweb/util/Schedule.scala.html#316914" title="(f: () =&gt; Unit, delay: net.liftweb.util.Helpers.TimeSpan)java.util.concurrent.ScheduledFuture[Unit]">schedule</a><span class="delimiter">(</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#389360" title="(v1: Map[String,net.liftweb.http.SessionInfo], v2: net.liftweb.http.SessionInfo =&gt; Unit)Unit">f</a><span class="delimiter">(</span><a href="#389331" title="Map[String,net.liftweb.http.SessionInfo]">ses</a>,
            <a title="net.liftweb.http.SessionInfo" id="389375">shutDown</a> =&gt; <span class="delimiter">{</span>
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#389375" title="net.liftweb.http.SessionInfo">shutDown</a>.<a href="#389132" title="=&gt; net.liftweb.http.LiftSession">session</a>.<a href="#230160" title="=&gt; Boolean">markedForShutDown_?</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="#389375" title="net.liftweb.http.SessionInfo">shutDown</a>.<a href="#389132" title="=&gt; net.liftweb.http.LiftSession">session</a>.
                  <a href="#230160" title="(x$1: Boolean)Unit">markedForShutDown_?</a> = <span title="Boolean(true)" class="keyword">true</span>

                <span class="keyword">this</span> <a href="../../../../actor/net/liftweb/actor/LiftActor.scala.html#29502" title="(msg: Any)Unit">!</a> <a href="#403382" title="(sessionId: String)net.liftweb.http.RemoveSession">RemoveSession</a><span class="delimiter">(</span><a href="#389375" title="net.liftweb.http.SessionInfo">shutDown</a>.
                  <a href="#389132" title="=&gt; net.liftweb.http.LiftSession">session</a>.
                  <a href="#357324" title="=&gt; String">uniqueId</a><span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>
          <span class="delimiter">)</span>, <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48777" title="implicit net.liftweb.util.TimeHelpers.intToTimeSpanBuilder : (in: Int)net.liftweb.util.Helpers.TimeSpanBuilder" class="int">0</a> <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#58471" title="=&gt; net.liftweb.util.Helpers.TimeSpan">seconds</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="../../../../util/net/liftweb/util/Props.scala.html#13579" title="object net.liftweb.util.Props">Props</a>.<a href="../../../../util/net/liftweb/util/Props.scala.html#151332" title="=&gt; Boolean">inGAE</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#357503" title="=&gt; List[net.liftweb.actor.LiftActor]">sessionWatchers</a>.<span title="(f: net.liftweb.actor.LiftActor =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#389412" title="net.liftweb.actor.LiftActor">_</a> <a href="../../../../actor/net/liftweb/actor/LiftActor.scala.html#29502" title="(msg: Any)Unit">!</a> <a href="#403378" title="(sessions: Map[String,net.liftweb.http.SessionInfo])net.liftweb.http.SessionWatcherInfo">SessionWatcherInfo</a><span class="delimiter">(</span><a href="#389331" title="Map[String,net.liftweb.http.SessionInfo]">ses</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#357520" title="()Unit">doPing</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
  <span class="delimiter">}</span>


  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(in: Any)Unit" id="357519">sendMsg</a><span class="delimiter">(</span><a title="Any" id="389365">in</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="../../../../util/net/liftweb/util/Props.scala.html#13579" title="object net.liftweb.util.Props">Props</a>.<a href="../../../../util/net/liftweb/util/Props.scala.html#151332" title="=&gt; Boolean">inGAE</a><span class="delimiter">)</span> <span class="keyword">this</span> <a href="../../../../actor/net/liftweb/actor/LiftActor.scala.html#29502" title="(msg: Any)Unit">!</a> <a href="#389365" title="Any">in</a>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#357511" title="(f: =&gt; net.liftweb.common.Box[Unit])net.liftweb.common.Box[Unit]">lockWrite</a> <span title="Unit" class="delimiter">{</span>
        <a href="../../../../util/net/liftweb/util/ControlHelpers.scala.html#48608" title="(f: =&gt; Unit)net.liftweb.common.Box[Unit]">tryo</a> <span class="delimiter">{</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#357517" title="=&gt; PartialFunction[Any,Unit]">reaction</a>.<span title="(x: Any)Boolean">isDefinedAt</span><span class="delimiter">(</span><a href="#389365" title="Any">in</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#357517" title="=&gt; PartialFunction[Any,Unit]">reaction</a>.<span title="(v1: Any)Unit">apply</span><span class="delimiter">(</span><a href="#389365" title="Any">in</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="357520">doPing</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="../../../../util/net/liftweb/util/Props.scala.html#13579" title="object net.liftweb.util.Props">Props</a>.<a href="../../../../util/net/liftweb/util/Props.scala.html#151332" title="=&gt; Boolean">inGAE</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="../../../../util/net/liftweb/util/Schedule.scala.html#13609" title="object net.liftweb.util.Schedule">Schedule</a>.<a href="../../../../util/net/liftweb/util/Schedule.scala.html#316905" title="(to: net.liftweb.common.SimpleActor[net.liftweb.http.SessionMaster.CheckAndPurge.type], msg: net.liftweb.http.SessionMaster.CheckAndPurge.type, delay: net.liftweb.util.Helpers.TimeSpan)java.util.concurrent.ScheduledFuture[Unit]">schedule</a><span title="Unit" class="delimiter">(</span><span class="keyword">this</span>, <a href="#357492" title="object net.liftweb.http.SessionMaster.CheckAndPurge">CheckAndPurge</a>, <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48777" title="implicit net.liftweb.util.TimeHelpers.intToTimeSpanBuilder : (in: Int)net.liftweb.util.Helpers.TimeSpanBuilder" class="int">10</a> <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#58471" title="=&gt; net.liftweb.util.Helpers.TimeSpan">seconds</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Unit" id="389483">e</a>: <span title="Exception">Exception</span> =&gt; <a href="../../../../common/net/liftweb/common/Logging.scala.html#19845" title="=&gt; net.liftweb.common.Logger">logger</a>.<a href="../../../../common/net/liftweb/common/Logging.scala.html#31961" title="(msg: =&gt; AnyRef, t: Throwable)Unit">error</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Couldn\'t start SessionMaster ping&quot;)" class="string">&quot;Couldn't start SessionMaster ping&quot;</span>, <a href="#389483" title="Exception">e</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <a href="#357520" title="()Unit">doPing</a><span class="delimiter">(</span><span class="delimiter">)</span>
<span class="delimiter">}</span>


<span class="keyword">object</span> <a title="object net.liftweb.http.PageName" id="14486">PageName</a> <span title="ScalaObject" class="keyword">extends</span> <a href="Vars.scala.html#14774" title="net.liftweb.http.RequestVar[String]">RequestVar</a><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>

<span class="comment">/**
 * Information about the page garbage collection
 */</span>
<span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">object</span> <a title="object net.liftweb.http.RenderVersion" id="14488">RenderVersion</a> <span title="ScalaObject" class="delimiter">{</span>

  <span class="keyword">private</span> <span class="keyword">object</span> <a title="object net.liftweb.http.RenderVersion.ver" id="345562">ver</a> <span title="ScalaObject" class="keyword">extends</span> <a href="Vars.scala.html#14774" title="net.liftweb.http.RequestVar[String]">RequestVar</a><span class="delimiter">(</span><a href="../../../../util/net/liftweb/util/Helpers.scala.html#13346" title="object net.liftweb.util.Helpers">Helpers</a>.<a href="../../../../util/net/liftweb/util/HttpHelpers.scala.html#49067" title="=&gt; String">nextFuncName</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="=&gt; String" id="345564">get</a>: <span title="String">String</span> = <a href="#345562" title="object net.liftweb.http.RenderVersion.ver">ver</a>.<a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75375" title="=&gt; String">is</a>

  <span class="keyword">def</span> <a title="[T](v: String)(f: =&gt; T)T" id="345565">doWith</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="345567">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="String" id="345569">v</a>: <span title="String">String</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="=&gt; T" id="345570">f</a>: =&gt; T<span class="delimiter">)</span>: <a href="#345567" title="T">T</a> = <a href="#345562" title="object net.liftweb.http.RenderVersion.ver">ver</a>.<a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75392" title="(newVal: String)(f: =&gt; T)T">doWith</a><span class="delimiter">(</span><a href="#345569" title="String">v</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#345570" title="=&gt; T">f</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(value: String)Unit" id="345568">set</a><span class="delimiter">(</span><a title="String" id="380997">value</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75381" title="(what: String)String">ver</a><span title="Unit" class="delimiter">(</span><a href="#380997" title="String">value</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * A trait defining how stateful the session is 
 */</span>
<span class="keyword">trait</span> <a title="trait HowStateful extends java.lang.Object with ScalaObject" id="14490">HowStateful</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="net.liftweb.util.ThreadGlobal[Boolean]" id="230325">howStateful</a> = <span title="net.liftweb.util.ThreadGlobal[Boolean]" class="keyword">new</span> <a href="../../../../util/net/liftweb/util/ThreadGlobal.scala.html#13699" title="net.liftweb.util.ThreadGlobal[Boolean]">ThreadGlobal</a><span class="delimiter">[</span>Boolean<span class="delimiter">]</span>

  <span class="comment">/**
   * Test the statefulness of this session.
   */</span>
  <span class="keyword">def</span> <a title="=&gt; Boolean" id="230327">stateful_?</a> = <a href="#230325" title="=&gt; net.liftweb.util.ThreadGlobal[Boolean]">howStateful</a>.<a href="../../../../util/net/liftweb/util/ThreadGlobal.scala.html#51271" title="=&gt; net.liftweb.common.Box[Boolean]">box</a> <a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; Boolean)Boolean">openOr</a> <span title="Boolean(true)" class="keyword">true</span>

  <span class="comment">/**
   * There may be cases when you are allowed container state (e.g.,
   * migratory session, but you're not allowed to write Lift
   * non-migratory state, return true here.
   */</span>
  <span class="keyword">def</span> <a title="=&gt; Boolean" id="230328">allowContainerState_?</a> = <a href="#230325" title="=&gt; net.liftweb.util.ThreadGlobal[Boolean]">howStateful</a>.<a href="../../../../util/net/liftweb/util/ThreadGlobal.scala.html#51271" title="=&gt; net.liftweb.common.Box[Boolean]">box</a> <a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; Boolean)Boolean">openOr</a> <span title="Boolean(true)" class="keyword">true</span>

  <span class="comment">/**
   * Within the scope of the call, this session is forced into
   * statelessness.  This allows for certain URLs in on the site
   * to be stateless and not generate a session, but if a valid
   * session is presented, they have the scope of that session/User
   */</span>
  <span class="keyword">def</span> <a title="[A](f: =&gt; A)A" id="230329">doAsStateless</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="230331">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="=&gt; A" id="389529">f</a>: =&gt; A<span class="delimiter">)</span>: <a href="#230331" title="A">A</a> =
    <a href="#230325" title="=&gt; net.liftweb.util.ThreadGlobal[Boolean]">howStateful</a>.<a href="../../../../util/net/liftweb/util/ThreadGlobal.scala.html#51274" title="(x: Boolean)(f: =&gt; A)A">doWith</a><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#389529" title="=&gt; A">f</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Sessions that include this trait will not be retained past the current
 * request and will give notifications of failure if stateful features
 * of Lift are accessed
 */</span>
<span class="keyword">trait</span> <a title="trait StatelessSession extends java.lang.Object with net.liftweb.http.HowStateful with ScalaObject" id="14491">StatelessSession</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#14490" title="net.liftweb.http.HowStateful">HowStateful</a> <span class="delimiter">{</span>
  self: LiftSession =&gt;

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Boolean" id="358032">stateful_?</a> = <span title="Boolean(false)" class="keyword">false</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Boolean" id="358033">allowContainerState_?</a> = <span title="Boolean(false)" class="keyword">false</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Sessions that include this trait will only have access to the container's
 * state via ContainerVars.  This mode is &quot;migratory&quot; so that a session
 * can migrate across app servers.  In this mode, functions that
 * access Lift state will give notifications of failure if stateful features
 * of Lift are accessed
 */</span>
<span class="keyword">trait</span> <a title="trait MigratorySession extends java.lang.Object with net.liftweb.http.HowStateful with ScalaObject" id="14492">MigratorySession</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#14490" title="net.liftweb.http.HowStateful">HowStateful</a> <span class="delimiter">{</span>
  self: LiftSession =&gt;

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Boolean" id="357353">stateful_?</a> = <span title="Boolean(false)" class="keyword">false</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Keeps information around about what kinds of functions are run
 * at the end of page rendering.  The results of these functions will be
 * appended to the bottom of the page.
 *
 * @param renderVersion -- the page ID (aka the RenderVersion)
 * @param functionCount -- the number of functions in the collection
 * @param lastSeen -- page of the page-level GC
 * @param functions -- the list of functions to run
 */</span>
<span class="keyword">private</span> <span class="keyword">final</span> case <span class="keyword">class</span> <a title="class PostPageFunctions extends java.lang.Object with ScalaObject with Product with Serializable" id="403370">PostPageFunctions</a><a href="#403370" title="ScalaObject" class="delimiter">(</a><a title="String" id="395549">renderVersion</a>: <span title="String">String</span>,
                                           <a title="Int" id="395550">functionCount</a>: <span title="Int">Int</span>,
                                           <a title="Boolean" id="395551">longLife</a>: <span title="Boolean">Boolean</span>,
                                           <a title="Long" id="395552">lastSeen</a>: <span title="Long">Long</span>,
                                           <a title="List[() =&gt; net.liftweb.http.js.JsCmd]" id="395553">functions</a>: <span title="List[() =&gt; net.liftweb.http.js.JsCmd]">List</span><span class="delimiter">[</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; JsCmd<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="comment">/**
   * Create a new instance based on the last seen time
   */</span>
  <span class="keyword">def</span> <a title="=&gt; net.liftweb.http.PostPageFunctions" id="389568">updateLastSeen</a> = <span title="net.liftweb.http.PostPageFunctions" class="keyword">new</span> <a href="#403370" title="net.liftweb.http.PostPageFunctions">PostPageFunctions</a><span class="delimiter">(</span><a href="#395549" title="=&gt; String">renderVersion</a>,
    <a href="#395550" title="=&gt; Int">functionCount</a>,
    <a href="#395551" title="=&gt; Boolean">longLife</a>,
    <a href="../../../../util/net/liftweb/util/Helpers.scala.html#13346" title="object net.liftweb.util.Helpers">Helpers</a>.<a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48788" title="=&gt; Long">millis</a>,
    <a href="#395553" title="=&gt; List[() =&gt; net.liftweb.http.js.JsCmd]">functions</a><span class="delimiter">)</span>


<span class="delimiter">}</span>

<span class="comment">/**
 * The LiftSession class containg the session state information
 */</span>
<span class="keyword">class</span> <a title="class LiftSession extends java.lang.Object with net.liftweb.http.LiftMerge with net.liftweb.common.Loggable with net.liftweb.http.HowStateful with ScalaObject" id="14496">LiftSession</a><a href="#14496" title="ScalaObject" class="delimiter">(</a><span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">val</span> <a title="String" id="357323">_contextPath</a>: <span title="String">String</span>, <span class="keyword">val</span> <a title="String" id="357324">uniqueId</a>: <span title="String">String</span>,
                  <span class="keyword">val</span> <a title="net.liftweb.common.Box[net.liftweb.http.provider.HTTPSession]" id="357325">httpSession</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.http.provider.HTTPSession]">Box</a><span class="delimiter">[</span>HTTPSession<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="LiftMerge.scala.html#14197" title="net.liftweb.http.LiftMerge">LiftMerge</a> <span class="keyword">with</span> <a href="../../../../common/net/liftweb/common/Logging.scala.html#10717" title="net.liftweb.common.Loggable">Loggable</a> <span class="keyword">with</span> <a href="#14490" title="net.liftweb.http.HowStateful">HowStateful</a> <span class="delimiter">{</span>
  <span class="keyword">val</span> <a title="net.liftweb.http.SessionVar[net.liftweb.http.HtmlProperties]" id="230149">sessionHtmlProperties</a>: <a href="Vars.scala.html#14760" title="net.liftweb.http.SessionVar[net.liftweb.http.HtmlProperties]">SessionVar</a><span class="delimiter">[</span>HtmlProperties<span class="delimiter">]</span> =
    <a href="#389841" title="net.liftweb.http.SessionVar[net.liftweb.http.HtmlProperties]" class="keyword">new</a> <a title="anonymous class $anon extends net.liftweb.http.SessionVar[net.liftweb.http.HtmlProperties]" id="389841">SessionVar</a><span class="delimiter">[</span>HtmlProperties<span class="delimiter">]</span><span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159028" title="=&gt; net.liftweb.http.LiftRules#FactoryMaker[net.liftweb.http.Req =&gt; net.liftweb.http.HtmlProperties]">htmlProperties</a>.<a href="Factory.scala.html#159330" title="(v1: net.liftweb.http.Req)net.liftweb.http.HtmlProperties">vend</a><span class="delimiter">(</span>
      <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49309" title="=&gt; net.liftweb.common.Box[net.liftweb.http.Req]">request</a> <a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; net.liftweb.http.Req)net.liftweb.http.Req">openOr</a> <a href="Req.scala.html#14562" title="object net.liftweb.http.Req">Req</a>.<a href="Req.scala.html#185916" title="=&gt; net.liftweb.http.Req">nil</a>
    <span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span><span class="delimiter">}</span>

  <span class="keyword">val</span> <a title="net.liftweb.http.TransientRequestVar[net.liftweb.http.HtmlProperties]" id="230151">requestHtmlProperties</a>: <a href="Vars.scala.html#14776" title="net.liftweb.http.TransientRequestVar[net.liftweb.http.HtmlProperties]">TransientRequestVar</a><span class="delimiter">[</span>HtmlProperties<span class="delimiter">]</span> =
    <a href="#389872" title="net.liftweb.http.TransientRequestVar[net.liftweb.http.HtmlProperties]" class="keyword">new</a> <a title="anonymous class $anon extends net.liftweb.http.TransientRequestVar[net.liftweb.http.HtmlProperties]" id="389872">TransientRequestVar</a><span class="delimiter">[</span>HtmlProperties<span class="delimiter">]</span><span class="delimiter">(</span><a href="#230149" title="=&gt; net.liftweb.http.SessionVar[net.liftweb.http.HtmlProperties]">sessionHtmlProperties</a>.<a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75375" title="=&gt; net.liftweb.http.HtmlProperties">is</a><span class="delimiter">)</span> <span class="delimiter">{</span><span class="delimiter">}</span>

  @volatile
  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">var</span> <a title="Boolean" id="230154">markedForTermination</a> = <span title="Boolean(false)" class="keyword">false</span>

  @volatile
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Boolean" id="230157">_running_?</a> = <span title="Boolean(false)" class="keyword">false</span>

  <span class="comment">/**
   * Was this session marked for shutdown... if so,
   * don't remark
   */</span>
  @volatile <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">var</span> <a title="Boolean" id="230160">markedForShutDown_?</a> = <span title="Boolean(false)" class="keyword">false</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="fullPageLoad extends net.liftweb.util.ThreadGlobal[Boolean]" id="230162">fullPageLoad</a> = <a href="#389752" title="net.liftweb.util.ThreadGlobal[Boolean]{def ?: Boolean}" class="keyword">new</a> <a title="anonymous class $anon extends net.liftweb.util.ThreadGlobal[Boolean]" id="389752">ThreadGlobal</a><span class="delimiter">[</span>Boolean<span class="delimiter">]</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="=&gt; Boolean" id="389754">?</a> = <a href="#389752" title="this.type" class="keyword">this</a>.<a href="../../../../util/net/liftweb/util/ThreadGlobal.scala.html#51271" title="=&gt; net.liftweb.common.Box[Boolean]">box</a> <a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; Boolean)Boolean">openOr</a> <span title="Boolean(false)" class="keyword">false</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   *  ****IMPORTANT**** when you access messageCallback, it *MUST*
   * be in a block that's synchronized on the owner LiftSession
   */</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="scala.collection.mutable.HashMap[String,net.liftweb.http.S.AFuncHolder]" id="230165">messageCallback</a>: <span title="scala.collection.mutable.HashMap[String,net.liftweb.http.S.AFuncHolder]">HashMap</span><span class="delimiter">[</span>String, S.AFuncHolder<span class="delimiter">]</span> = <span title="()scala.collection.mutable.HashMap[String,net.liftweb.http.S.AFuncHolder]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[String,net.liftweb.http.S.AFuncHolder]">HashMap</span>

  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">var</span> <a title="Seq[(net.liftweb.http.NoticeType.Value, scala.xml.NodeSeq, net.liftweb.common.Box[String])]" id="230168">notices</a>: <span title="Seq[(net.liftweb.http.NoticeType.Value, scala.xml.NodeSeq, net.liftweb.common.Box[String])]">Seq</span><span class="delimiter">[</span><span class="delimiter">(</span>NoticeType.Value, NodeSeq, Box<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">]</span> = <span title="object Nil">Nil</span>

  <span class="keyword">private</span> <span class="keyword">var</span> <a title="scala.collection.mutable.HashMap[(net.liftweb.common.Box[String], net.liftweb.common.Box[String]),net.liftweb.http.LiftCometActor]" id="230171">asyncComponents</a> = <span title="()scala.collection.mutable.HashMap[(net.liftweb.common.Box[String], net.liftweb.common.Box[String]),net.liftweb.http.LiftCometActor]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[(net.liftweb.common.Box[String], net.liftweb.common.Box[String]),net.liftweb.http.LiftCometActor]">HashMap</span><span class="delimiter">[</span><span class="delimiter">(</span>Box<span class="delimiter">[</span>String<span class="delimiter">]</span>, Box<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>, LiftCometActor<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">var</span> <a title="scala.collection.mutable.HashMap[String,net.liftweb.http.LiftCometActor]" id="230174">asyncById</a> = <span title="()scala.collection.mutable.HashMap[String,net.liftweb.http.LiftCometActor]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[String,net.liftweb.http.LiftCometActor]">HashMap</span><span class="delimiter">[</span>String, LiftCometActor<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Map[String,Any]" id="230177">myVariables</a>: <span title="Map[String,Any]">Map</span><span class="delimiter">[</span>String, Any<span class="delimiter">]</span> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="scala.collection.immutable.Map[String,Nothing]">empty</span>

  <span class="keyword">private</span> <span class="keyword">var</span> <a title="List[net.liftweb.http.LiftSession =&gt; Unit]" id="230180">onSessionEnd</a>: <span title="List[net.liftweb.http.LiftSession =&gt; Unit]">List</span><span class="delimiter">[</span>LiftSession =&gt; Unit<span class="delimiter">]</span> = <span title="object Nil">Nil</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.lang.Object" id="230182">sessionVarSync</a> = <span title="java.lang.Object" class="keyword">new</span> <span title="java.lang.Object">Object</span>

  <span class="comment">/**
   * A mapping between pages denoted by RenderVersion and
   * functions to execute at the end of the page rendering
   */</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Map[String,net.liftweb.http.PostPageFunctions]" id="230185">postPageFunctions</a>: <span title="Map[String,net.liftweb.http.PostPageFunctions]">Map</span><span class="delimiter">[</span>String, PostPageFunctions<span class="delimiter">]</span> = <span title="(elems: (String, Nothing)*)scala.collection.immutable.Map[String,Nothing]">Map</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="comment">/**
   * The synchronization lock for the postPageFunctions
   */</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.lang.Object" id="230187">postPageLock</a> = <span title="java.lang.Object" class="keyword">new</span> <span title="java.lang.Object">Object</span>

  @volatile
  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">var</span> <a title="Long" id="230190">lastServiceTime</a> = <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48788" title="=&gt; Long">millis</a>

  @volatile
  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">var</span> <a title="Long" id="230193">inactivityLength</a>: <span title="Long">Long</span> =
    <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158834" title="=&gt; net.liftweb.http.LiftRules#FactoryMaker[net.liftweb.common.Box[Long]]">sessionInactivityTimeout</a>.<a href="Factory.scala.html#159330" title="=&gt; net.liftweb.common.Box[Long]">vend</a> <a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; Long)Long">openOr</a> <span class="delimiter">(</span><span class="delimiter">(</span><a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48777" title="implicit net.liftweb.util.TimeHelpers.intToTimeSpanBuilder : (in: Int)net.liftweb.util.Helpers.TimeSpanBuilder" class="int">30</a> <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#188674" title="implicit net.liftweb.util.ConvertableToDate.toMillis : (in: net.liftweb.util.ConvertableToDate)Long">minutes</a><span class="delimiter">)</span>: <span title="Long">Long</span><span class="delimiter">)</span>

  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">var</span> <a title="scala.collection.mutable.HashMap[String,net.liftweb.http.LiftRules.DispatchPF]" id="230196">highLevelSessionDispatcher</a> = <span title="()scala.collection.mutable.HashMap[String,net.liftweb.http.LiftRules.DispatchPF]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[String,net.liftweb.http.LiftRules.DispatchPF]">HashMap</span><span class="delimiter">[</span>String, LiftRules.DispatchPF<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">var</span> <a title="scala.collection.mutable.HashMap[String,net.liftweb.http.LiftRules.RewritePF]" id="230199">sessionRewriter</a> = <span title="()scala.collection.mutable.HashMap[String,net.liftweb.http.LiftRules.RewritePF]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[String,net.liftweb.http.LiftRules.RewritePF]">HashMap</span><span class="delimiter">[</span>String, LiftRules.RewritePF<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>


  <span class="keyword">private</span> <span class="keyword">object</span> <a title="object LiftSession.this.snippetMap" id="230201">snippetMap</a> <span title="ScalaObject" class="keyword">extends</span> <a href="Vars.scala.html#14774" title="net.liftweb.http.RequestVar[Map[String,AnyRef]]">RequestVar</a><span class="delimiter">[</span>Map<span class="delimiter">[</span>String, AnyRef<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span title="(elems: (String, Nothing)*)scala.collection.immutable.Map[String,Nothing]">Map</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">object</span> <a title="object LiftSession.this.deferredSnippets" id="230203">deferredSnippets</a> <span title="ScalaObject" class="keyword">extends</span> <a href="Vars.scala.html#14774" title="net.liftweb.http.RequestVar[scala.collection.mutable.HashMap[String,net.liftweb.common.Box[scala.xml.NodeSeq]]]">RequestVar</a><span class="delimiter">[</span>HashMap<span class="delimiter">[</span>String, Box<span class="delimiter">[</span>NodeSeq<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span title="()scala.collection.mutable.HashMap[String,net.liftweb.common.Box[scala.xml.NodeSeq]]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[String,net.liftweb.common.Box[scala.xml.NodeSeq]]">HashMap</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">object</span> <a title="object LiftSession.this.cometSetup" id="230205">cometSetup</a> <span title="ScalaObject" class="keyword">extends</span> <a href="Vars.scala.html#14760" title="net.liftweb.http.SessionVar[List[((net.liftweb.common.Box[String], net.liftweb.common.Box[String]), Any)]]">SessionVar</a><span class="delimiter">[</span>List<span class="delimiter">[</span><span class="delimiter">(</span><span class="delimiter">(</span>Box<span class="delimiter">[</span>String<span class="delimiter">]</span>, Box<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>, Any<span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span title="object Nil">Nil</span><span class="delimiter">)</span>


  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">def</span> <a title="()Unit" id="230207">startSession</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#230157" title="(x$1: Boolean)Unit">_running_?</a> = <span title="Boolean(true)" class="keyword">true</span>
    <span class="keyword">for</span> <span class="delimiter">(</span><a title="net.liftweb.http.provider.HTTPSession" id="389959">sess</a> &lt;- <a href="../../../../common/net/liftweb/common/Box.scala.html#27031" title="(f: net.liftweb.http.provider.HTTPSession =&gt; Unit)Unit">httpSession</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="comment">// calculate the inactivity length.  If the length is</span>
      <span class="comment">// defined in LiftRules and it's less than the container's length</span>
      <span class="comment">// then use the Lift length.  Why not use it if the Lift length is</span>
      <span class="comment">// longer?  Well, the container's just going to time you out, so</span>
      <span class="comment">// why bother.</span>
      <a href="#230193" title="(x$1: Long)Unit">inactivityLength</a> =
        <span title="(_1: Long, _2: net.liftweb.common.Box[Long])(Long, net.liftweb.common.Box[Long])" class="delimiter">(</span><a href="#389959" title="net.liftweb.http.provider.HTTPSession">sess</a>.<a href="provider/HTTPSession.scala.html#357306" title="=&gt; Long">maxInactiveInterval</a> <span title="(x: Long)Long">*</span> <span title="Long(1000L)" class="long">1000L</span>,
          <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158834" title="=&gt; net.liftweb.http.LiftRules#FactoryMaker[net.liftweb.common.Box[Long]]">sessionInactivityTimeout</a>.<a href="Factory.scala.html#159330" title="=&gt; net.liftweb.common.Box[Long]">vend</a><span class="delimiter">)</span> <span title="Long" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Long" class="delimiter">(</span><a title="Long" id="389975">container</a>, Full<span class="delimiter">(</span><a title="Long" id="389977">lift</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#389977" title="Long">lift</a> <span title="(x: Long)Boolean">&lt;</span> <a href="#389975" title="Long">container</a> =&gt; <a href="#389977" title="Long">lift</a>
          <span class="keyword">case</span> <span title="Long" class="delimiter">(</span><a title="Long" id="389984">container</a>, _<span class="delimiter">)</span> =&gt; <a href="#389984" title="Long">container</a>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <a href="#230190" title="(x$1: Long)Unit">lastServiceTime</a> = <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48788" title="=&gt; Long">millis</a>
    <a href="#14470" title="object net.liftweb.http.LiftSession">LiftSession</a>.<a href="#326774" title="=&gt; List[net.liftweb.http.LiftSession =&gt; Unit]">onSetupSession</a>.<span title="(f: net.liftweb.http.LiftSession =&gt; Unit =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#390011" title="(v1: net.liftweb.http.LiftSession)Unit">_</a><span class="delimiter">(</span><a href="#14496" title="net.liftweb.http.LiftSession" class="keyword">this</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#230149" title="=&gt; net.liftweb.http.SessionVar[net.liftweb.http.HtmlProperties]">sessionHtmlProperties</a>.<a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75375" title="=&gt; net.liftweb.http.HtmlProperties">is</a> <span class="comment">// cause the properties to be calculated</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; Boolean" id="230208">running_?</a> = <a href="#230157" title="=&gt; Boolean">_running_?</a>

  <span class="keyword">private</span> <span class="keyword">var</span> <a title="List[(net.liftweb.actor.LiftActor, net.liftweb.http.Req)]" id="230210">cometList</a>: <span title="List[(net.liftweb.actor.LiftActor, net.liftweb.http.Req)]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>LiftActor, Req<span class="delimiter">)</span><span class="delimiter">]</span> = <span title="object Nil">Nil</span>

  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">def</span> <a title="()Unit" id="230212">breakOutComet</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="List[(net.liftweb.actor.LiftActor, net.liftweb.http.Req)]" id="390018">cl</a> = <a href="#14496" title="(x$1: List[(net.liftweb.actor.LiftActor, net.liftweb.http.Req)])List[(net.liftweb.actor.LiftActor, net.liftweb.http.Req)]">synchronized</a> <span class="delimiter">{</span>
      <a href="#230210" title="=&gt; List[(net.liftweb.actor.LiftActor, net.liftweb.http.Req)]">cometList</a>
    <span class="delimiter">}</span>
    <a href="#390018" title="List[(net.liftweb.actor.LiftActor, net.liftweb.http.Req)]">cl</a>.<span title="(f: (net.liftweb.actor.LiftActor, net.liftweb.http.Req) =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#390052" title="(net.liftweb.actor.LiftActor, net.liftweb.http.Req)">_</a>.<span title="=&gt; net.liftweb.actor.LiftActor">_1</span> <a href="../../../../actor/net/liftweb/actor/LiftActor.scala.html#29502" title="(msg: Any)Unit">!</a> <a href="LiftRules.scala.html#357618" title="()net.liftweb.http.BreakOut">BreakOut</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(hostAndPath: String)List[(net.liftweb.actor.LiftActor, net.liftweb.http.Req)]" id="230213">cometForHost</a><span class="delimiter">(</span><a title="String" id="357577">hostAndPath</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="List[(net.liftweb.actor.LiftActor, net.liftweb.http.Req)]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>LiftActor, Req<span class="delimiter">)</span><span class="delimiter">]</span> =
    <a href="#14496" title="(x$1: List[(net.liftweb.actor.LiftActor, net.liftweb.http.Req)])List[(net.liftweb.actor.LiftActor, net.liftweb.http.Req)]">synchronized</a> <span class="delimiter">{</span>
      <a href="#230210" title="=&gt; List[(net.liftweb.actor.LiftActor, net.liftweb.http.Req)]">cometList</a>
    <span class="delimiter">}</span>.<span title="(p: (net.liftweb.actor.LiftActor, net.liftweb.http.Req) =&gt; Boolean)List[(net.liftweb.actor.LiftActor, net.liftweb.http.Req)]">filter</span> <a href="#390064" title="Boolean" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="Boolean" class="delimiter">(</span>_, <a title="net.liftweb.http.Req" id="390067">r</a><span class="delimiter">)</span> =&gt; <a href="#390067" title="net.liftweb.http.Req">r</a>.<a href="Req.scala.html#149204" title="=&gt; String">hostAndPath</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#357577" title="String">hostAndPath</a>
    <span class="delimiter">}</span>

  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(what: (net.liftweb.actor.LiftActor, net.liftweb.http.Req))Unit" id="230214">enterComet</a><span class="delimiter">(</span><a title="(net.liftweb.actor.LiftActor, net.liftweb.http.Req)" id="385691">what</a>: <span title="(net.liftweb.actor.LiftActor, net.liftweb.http.Req)" class="delimiter">(</span>LiftActor, Req<span class="delimiter">)</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#14496" title="(x$1: Unit)Unit">synchronized</a> <span class="delimiter">{</span>
    <a href="#230210" title="(x$1: List[(net.liftweb.actor.LiftActor, net.liftweb.http.Req)])Unit">cometList</a> = <a href="#385691" title="(net.liftweb.actor.LiftActor, net.liftweb.http.Req)">what</a> <a href="#390074" title="(x: (net.liftweb.actor.LiftActor, net.liftweb.http.Req))List[(net.liftweb.actor.LiftActor, net.liftweb.http.Req)]">::</a> <a href="#230210" title="=&gt; List[(net.liftweb.actor.LiftActor, net.liftweb.http.Req)]">cometList</a>
  <span class="delimiter">}</span>

  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(what: net.liftweb.actor.LiftActor)Unit" id="230215">exitComet</a><span class="delimiter">(</span><a title="net.liftweb.actor.LiftActor" id="385586">what</a>: <a href="../../../../actor/net/liftweb/actor/LiftActor.scala.html#10558" title="net.liftweb.actor.LiftActor">LiftActor</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#14496" title="(x$1: Unit)Unit">synchronized</a> <span class="delimiter">{</span>
    <a href="#230210" title="(x$1: List[(net.liftweb.actor.LiftActor, net.liftweb.http.Req)])Unit">cometList</a> = <a href="#230210" title="=&gt; List[(net.liftweb.actor.LiftActor, net.liftweb.http.Req)]">cometList</a>.<span title="(p: (net.liftweb.actor.LiftActor, net.liftweb.http.Req) =&gt; Boolean)List[(net.liftweb.actor.LiftActor, net.liftweb.http.Req)]">filterNot</span><span class="delimiter">(</span><a href="#390088" title="(net.liftweb.actor.LiftActor, net.liftweb.http.Req)">_</a>.<span title="=&gt; net.liftweb.actor.LiftActor">_1</span> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#385586" title="net.liftweb.actor.LiftActor">what</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> case <span class="keyword">class</span> <a title="class RunnerHolder extends java.lang.Object with ScalaObject with Product with Serializable" id="390130">RunnerHolder</a><a href="#390130" title="ScalaObject" class="delimiter">(</a><a title="String" id="390305">name</a>: <span title="String">String</span>, <a title="net.liftweb.http.S.AFuncHolder" id="390306">func</a>: S.<a href="S.scala.html#49602" title="net.liftweb.http.S.AFuncHolder">AFuncHolder</a>, <a title="net.liftweb.common.Box[String]" id="390307">owner</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[String]">Box</a><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>

  <span class="keyword">object</span> <a title="object LiftSession.this.ieMode" id="230219">ieMode</a> <span title="ScalaObject" class="keyword">extends</span> <a href="Vars.scala.html#14760" title="net.liftweb.http.SessionVar[Boolean]">SessionVar</a><span class="delimiter">[</span>Boolean<span class="delimiter">]</span><span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158987" title="()Boolean">calcIEMode</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">override</span> <span class="keyword">private</span><span class="delimiter">[</span>liftweb<span class="delimiter">]</span> <span class="keyword">def</span> <a title="=&gt; Boolean" id="390182">magicSessionVar_?</a> = <span title="Boolean(true)" class="keyword">true</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; Unit" id="230221">terminateHint</a> <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#230157" title="=&gt; Boolean">_running_?</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#230154" title="(x$1: Boolean)Unit">markedForTermination</a> = <span title="Boolean(true)" class="keyword">true</span>;
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Executes the user's functions based on the query parameters
   */</span>
  <span class="keyword">def</span> <a title="(state: net.liftweb.http.Req)List[Any]" id="230222">runParams</a><span class="delimiter">(</span><a title="net.liftweb.http.Req" id="380676">state</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a><span class="delimiter">)</span>: <span title="List[Any]">List</span><span class="delimiter">[</span>Any<span class="delimiter">]</span> = <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="List[LiftSession.this.RunnerHolder]" id="390194">toRun</a> = <span class="delimiter">{</span>
      <span class="comment">// get all the commands, sorted by owner,</span>
      <span class="delimiter">(</span><a href="#380676" title="net.liftweb.http.Req">state</a>.<a href="Req.scala.html#149181" title="=&gt; List[net.liftweb.http.FileParamHolder]">uploadedFiles</a>.<span title="(f: net.liftweb.http.FileParamHolder =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[List[net.liftweb.http.FileParamHolder],String,List[String]])List[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,String,List[String]]" class="delimiter">(</span><a href="#390223" title="net.liftweb.http.FileParamHolder">_</a>.<a href="Req.scala.html#349704" title="=&gt; String">name</a><span class="delimiter">)</span> <a href="#390197" title="(prefix: List[String])List[String]">:::</a> <a href="#380676" title="net.liftweb.http.Req">state</a>.<a href="Req.scala.html#149179" title="=&gt; List[String]">paramNames</a><span class="delimiter">)</span>.<span title="=&gt; List[String]">distinct</span>.
        <span title="(f: String =&gt; scala.collection.GenTraversableOnce[LiftSession.this.RunnerHolder])(implicit bf: scala.collection.generic.CanBuildFrom[List[String],LiftSession.this.RunnerHolder,List[LiftSession.this.RunnerHolder]])List[LiftSession.this.RunnerHolder]">flatMap</span> <span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,LiftSession.this.RunnerHolder,List[LiftSession.this.RunnerHolder]]" class="delimiter">{</span>
        <a title="String" id="390283">n</a> =&gt; <a href="#14496" title="(x$1: Option[net.liftweb.http.S.AFuncHolder])Option[net.liftweb.http.S.AFuncHolder]">synchronized</a> <span class="delimiter">{</span>
          <a href="#230165" title="=&gt; scala.collection.mutable.HashMap[String,net.liftweb.http.S.AFuncHolder]">messageCallback</a>.<span title="(key: String)Option[net.liftweb.http.S.AFuncHolder]">get</span><span class="delimiter">(</span><a href="#390283" title="String">n</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>.<span title="(f: net.liftweb.http.S.AFuncHolder =&gt; LiftSession.this.RunnerHolder)Option[LiftSession.this.RunnerHolder]">map</span><span title="(xo: Option[LiftSession.this.RunnerHolder])Iterable[LiftSession.this.RunnerHolder]" class="delimiter">(</span><a title="net.liftweb.http.S.AFuncHolder" id="390304">mcb</a> =&gt; <a href="#390130" title="(name: String, func: net.liftweb.http.S.AFuncHolder, owner: net.liftweb.common.Box[String])LiftSession.this.RunnerHolder">RunnerHolder</a><span class="delimiter">(</span><a href="#390283" title="String">n</a>, <a href="#390304" title="net.liftweb.http.S.AFuncHolder">mcb</a>, <a href="#390304" title="net.liftweb.http.S.AFuncHolder">mcb</a>.<a href="S.scala.html#159454" title="=&gt; net.liftweb.common.Box[String]">owner</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>.
        <span title="(lt: (LiftSession.this.RunnerHolder, LiftSession.this.RunnerHolder) =&gt; Boolean)List[LiftSession.this.RunnerHolder]">sortWith</span> <a href="#390384" title="Boolean" class="delimiter">{</a>
        <span class="keyword">case</span> <span title="Boolean(true)" class="delimiter">(</span>RunnerHolder<span class="delimiter">(</span>_, _, Full<span class="delimiter">(</span><a title="String" id="390395">a</a><span class="delimiter">)</span><span class="delimiter">)</span>, RunnerHolder<span class="delimiter">(</span>_, _, Full<span class="delimiter">(</span><a title="String" id="390397">b</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#390395" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">a</a> <span title="(that: String)Boolean">&lt;</span> <a href="#390397" title="String">b</a> =&gt; <span title="Boolean(true)" class="keyword">true</span>
        <span class="keyword">case</span> <span title="Boolean(false)" class="delimiter">(</span>RunnerHolder<span class="delimiter">(</span>_, _, Full<span class="delimiter">(</span><a title="String" id="390440">a</a><span class="delimiter">)</span><span class="delimiter">)</span>, RunnerHolder<span class="delimiter">(</span>_, _, Full<span class="delimiter">(</span><a title="String" id="390442">b</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#390440" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">a</a> <span title="(that: String)Boolean">&gt;</span> <a href="#390442" title="String">b</a> =&gt; <span title="Boolean(false)" class="keyword">false</span>
        <span class="keyword">case</span> <span title="Boolean" class="delimiter">(</span>RunnerHolder<span class="delimiter">(</span><a title="String" id="390484">an</a>, _, Full<span class="delimiter">(</span><a title="String" id="390486">a</a><span class="delimiter">)</span><span class="delimiter">)</span>, RunnerHolder<span class="delimiter">(</span><a title="String" id="390487">bn</a>, _, Full<span class="delimiter">(</span><a title="String" id="390489">b</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#390486" title="String">a</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#390489" title="String">b</a> =&gt; <a href="#390484" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">an</a> <span title="(that: String)Boolean">&lt;</span> <a href="#390487" title="String">bn</a>
        <span class="keyword">case</span> <span title="Boolean(false)" class="delimiter">(</span>RunnerHolder<span class="delimiter">(</span>_, _, Full<span class="delimiter">(</span>_<span class="delimiter">)</span><span class="delimiter">)</span>, _<span class="delimiter">)</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
        <span class="keyword">case</span> <span title="Boolean(true)" class="delimiter">(</span>_, RunnerHolder<span class="delimiter">(</span>_, _, Full<span class="delimiter">(</span>_<span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
        <span class="keyword">case</span> <span title="Boolean" class="delimiter">(</span>RunnerHolder<span class="delimiter">(</span><a title="String" id="390541">a</a>, _, _<span class="delimiter">)</span>, RunnerHolder<span class="delimiter">(</span><a title="String" id="390542">b</a>, _, _<span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#390541" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">a</a> <span title="(that: String)Boolean">&lt;</span> <a href="#390542" title="String">b</a>
        <span class="keyword">case</span> <span title="Boolean(false)">_</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(i: LiftSession.this.RunnerHolder)() =&gt; Any" id="390195">buildFunc</a><span class="delimiter">(</span><a title="LiftSession.this.RunnerHolder" id="390582">i</a>: <a href="#390130" title="LiftSession.this.RunnerHolder">RunnerHolder</a><span class="delimiter">)</span>: <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Any = <a href="#390582" title="LiftSession.this.RunnerHolder">i</a>.<a href="#390306" title="=&gt; net.liftweb.http.S.AFuncHolder">func</a> <span title="() =&gt; Any" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="() =&gt; Any" id="390583">bfh</a> <span class="keyword">if</span> <a href="#390583" title="net.liftweb.http.S.AFuncHolder">bfh</a>.<a href="S.scala.html#159457" title="=&gt; Boolean">supportsFileParams_?</a> =&gt;
        <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#380676" title="net.liftweb.http.Req">state</a>.<a href="Req.scala.html#149181" title="=&gt; List[net.liftweb.http.FileParamHolder]">uploadedFiles</a>.<span title="(p: net.liftweb.http.FileParamHolder =&gt; Boolean)List[net.liftweb.http.FileParamHolder]">filter</span><span class="delimiter">(</span><a href="#390592" title="net.liftweb.http.FileParamHolder">_</a>.<a href="Req.scala.html#349704" title="=&gt; String">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#390582" title="LiftSession.this.RunnerHolder">i</a>.<a href="#390305" title="=&gt; String">name</a><span class="delimiter">)</span>.<span title="(f: net.liftweb.http.FileParamHolder =&gt; Any)(implicit bf: scala.collection.generic.CanBuildFrom[List[net.liftweb.http.FileParamHolder],Any,Any])Any">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,Any,List[Any]]" class="delimiter">(</span><a title="net.liftweb.http.FileParamHolder" id="390616">v</a> =&gt; <a href="S.scala.html#159456" title="(in: net.liftweb.http.FileParamHolder)Any">bfh</a><span class="delimiter">(</span><a href="#390616" title="net.liftweb.http.FileParamHolder">v</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="() =&gt; Any" id="390665">normal</a> =&gt;
        <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="S.scala.html#159455" title="(in: List[String])Any">normal</a><span class="delimiter">(</span><a href="#380676" title="net.liftweb.http.Req">state</a>.<a href="Req.scala.html#149194" title="=&gt; Map[String,List[String]]">params</a>.<span title="(key: String, default: =&gt; List[String])List[String]">getOrElse</span><span class="delimiter">(</span><a href="#390582" title="LiftSession.this.RunnerHolder">i</a>.<a href="#390305" title="=&gt; String">name</a>,
          <a href="#380676" title="net.liftweb.http.Req">state</a>.<a href="Req.scala.html#149181" title="=&gt; List[net.liftweb.http.FileParamHolder]">uploadedFiles</a>.<span title="(p: net.liftweb.http.FileParamHolder =&gt; Boolean)List[net.liftweb.http.FileParamHolder]">filter</span><span class="delimiter">(</span><a href="#390695" title="net.liftweb.http.FileParamHolder">_</a>.<a href="Req.scala.html#349704" title="=&gt; String">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#390582" title="LiftSession.this.RunnerHolder">i</a>.<a href="#390305" title="=&gt; String">name</a><span class="delimiter">)</span>.<span title="(f: net.liftweb.http.FileParamHolder =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[List[net.liftweb.http.FileParamHolder],String,List[String]])List[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,String,List[String]]" class="delimiter">(</span><a href="#390719" title="net.liftweb.http.FileParamHolder">_</a>.<a href="Req.scala.html#349708" title="=&gt; String">fileName</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="List[Any]" id="390196">ret</a> = <a href="#390194" title="List[LiftSession.this.RunnerHolder]">toRun</a>.<span title="(f: LiftSession.this.RunnerHolder =&gt; net.liftweb.common.Box[String])(implicit bf: scala.collection.generic.CanBuildFrom[List[LiftSession.this.RunnerHolder],net.liftweb.common.Box[String],List[net.liftweb.common.Box[String]]])List[net.liftweb.common.Box[String]]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,net.liftweb.common.Box[String],List[net.liftweb.common.Box[String]]]" class="delimiter">(</span><a href="#390765" title="LiftSession.this.RunnerHolder">_</a>.<a href="#390307" title="=&gt; net.liftweb.common.Box[String]">owner</a><span class="delimiter">)</span>.<span title="=&gt; List[net.liftweb.common.Box[String]]">distinct</span>.<span title="(f: net.liftweb.common.Box[String] =&gt; scala.collection.GenTraversableOnce[Any])(implicit bf: scala.collection.generic.CanBuildFrom[List[net.liftweb.common.Box[String]],Any,List[Any]])List[Any]">flatMap</span> <span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,Any,List[Any]]" class="delimiter">{</span>
      <a title="net.liftweb.common.Box[String]" id="390817">w</a> =&gt;
        <span class="keyword">val</span> <a title="List[LiftSession.this.RunnerHolder]" id="390818">f</a> = <a href="#390194" title="List[LiftSession.this.RunnerHolder]">toRun</a>.<span title="(p: LiftSession.this.RunnerHolder =&gt; Boolean)List[LiftSession.this.RunnerHolder]">filter</span><span class="delimiter">(</span><a href="#390822" title="LiftSession.this.RunnerHolder">_</a>.<a href="#390307" title="=&gt; net.liftweb.common.Box[String]">owner</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#390817" title="net.liftweb.common.Box[String]">w</a><span class="delimiter">)</span>
        <a href="#390817" title="net.liftweb.common.Box[String]">w</a> <span title="List[Any]" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="comment">// if it's going to a CometActor, batch up the commands</span>
          <span class="keyword">case</span> <span title="List[Any]">Full</span><span class="delimiter">(</span><a title="String" id="390828">id</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#230174" title="=&gt; scala.collection.mutable.HashMap[String,net.liftweb.http.LiftCometActor]">asyncById</a>.<span title="(key: String)Boolean">contains</span><span class="delimiter">(</span><a href="#390828" title="String">id</a><span class="delimiter">)</span> =&gt;
            <a href="#230174" title="=&gt; scala.collection.mutable.HashMap[String,net.liftweb.http.LiftCometActor]">asyncById</a>.<span title="(key: String)Option[net.liftweb.http.LiftCometActor]">get</span><span class="delimiter">(</span><a href="#390828" title="String">id</a><span class="delimiter">)</span>.<span title="=&gt; List[net.liftweb.http.LiftCometActor]">toList</span>.
              <span title="(f: net.liftweb.http.LiftCometActor =&gt; scala.collection.GenTraversableOnce[Any])(implicit bf: scala.collection.generic.CanBuildFrom[List[net.liftweb.http.LiftCometActor],Any,List[Any]])List[Any]">flatMap</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,Any,List[Any]]" class="delimiter">(</span><a title="net.liftweb.http.LiftCometActor" id="390862">a</a> =&gt; <a href="#390862" title="net.liftweb.http.LiftCometActor">a</a>.<a href="../../../../common/net/liftweb/common/SimpleActor.scala.html#32912" title="(timeout: Long, message: Any)net.liftweb.common.Box[Any]">!?</a><span class="delimiter">(</span><span title="Long(5000L)" class="long">5000L</span>, <a href="CometActor.scala.html#346000" title="(msg: List[() =&gt; Any], req: net.liftweb.http.Req)net.liftweb.http.ActionMessageSet">ActionMessageSet</a><span class="delimiter">(</span><a href="#390818" title="List[LiftSession.this.RunnerHolder]">f</a>.<span title="(f: LiftSession.this.RunnerHolder =&gt; () =&gt; Any)(implicit bf: scala.collection.generic.CanBuildFrom[List[LiftSession.this.RunnerHolder],() =&gt; Any,List[() =&gt; Any]])List[() =&gt; Any]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,() =&gt; Any,List[() =&gt; Any]]" class="delimiter">(</span><a title="LiftSession.this.RunnerHolder" id="390885">i</a> =&gt; <a href="#390195" title="(i: LiftSession.this.RunnerHolder)() =&gt; Any">buildFunc</a><span class="delimiter">(</span><a href="#390885" title="LiftSession.this.RunnerHolder">i</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#380676" title="net.liftweb.http.Req">state</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="List[Any]" class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <span title="List[_]">Full</span><span class="delimiter">(</span><a title="List[_]" id="390914">li</a>: <span title="List[_]">List</span><span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span> =&gt; <a href="#390914" title="List[_]">li</a>
              <span class="keyword">case</span> <a title="&lt;none&gt; extends net.liftweb.common.Box[Any] with List[_]" id="390916">li</a>: <span title="List[_]">List</span><span class="delimiter">[</span>_<span class="delimiter">]</span> =&gt; <a href="#390916" title="&lt;none&gt; extends net.liftweb.common.Box[Any] with List[_]">li</a>
              <span class="keyword">case</span> <a title="scala.collection.immutable.Nil.type" id="390919">other</a> =&gt; <span title="object Nil">Nil</span>
            <span class="delimiter">}</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="List[Any]">_</span> =&gt; <a href="#390818" title="List[LiftSession.this.RunnerHolder]">f</a>.<span title="(f: LiftSession.this.RunnerHolder =&gt; Any)(implicit bf: scala.collection.generic.CanBuildFrom[List[LiftSession.this.RunnerHolder],Any,List[Any]])List[Any]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,Any,List[Any]]" class="delimiter">(</span><a title="LiftSession.this.RunnerHolder" id="394892">i</a> =&gt; <a href="#390195" title="(i: LiftSession.this.RunnerHolder)() =&gt; Any">buildFunc</a><span class="delimiter">(</span><a href="#394892" title="LiftSession.this.RunnerHolder">i</a><span class="delimiter">)</span>.<span title="()Any">apply</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <a href="#390196" title="List[Any]">ret</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Updates the internal functions mapping
   */</span>
  <span class="keyword">def</span> <a title="(funcs: Map[String,net.liftweb.http.S.AFuncHolder], uniqueId: String, when: Long)Unit" id="230223">updateFunctionMap</a><span class="delimiter">(</span><a title="Map[String,net.liftweb.http.S.AFuncHolder]" id="344503">funcs</a>: <span title="Map[String,net.liftweb.http.S.AFuncHolder]">Map</span><span class="delimiter">[</span>String, S.AFuncHolder<span class="delimiter">]</span>, <a title="String" id="344504">uniqueId</a>: <span title="String">String</span>, <a title="Long" id="344505">when</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#14496" title="(x$1: Unit)Unit">synchronized</a> <span class="delimiter">{</span>
    <a href="#344503" title="Map[String,net.liftweb.http.S.AFuncHolder]">funcs</a>.<span title="(f: (String, net.liftweb.http.S.AFuncHolder) =&gt; Unit)Unit">foreach</span> <a href="#394965" title="Unit" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="Unit" class="delimiter">(</span><a title="String" id="394968">name</a>, <a title="net.liftweb.http.S.AFuncHolder" id="394969">func</a><span class="delimiter">)</span> =&gt; <a href="#230165" title="(key: String, value: net.liftweb.http.S.AFuncHolder)Unit">messageCallback</a><span class="delimiter">(</span><a href="#394968" title="String">name</a><span class="delimiter">)</span> = <a href="#394969" title="net.liftweb.http.S.AFuncHolder">func</a>.<a href="S.scala.html#159458" title="(newOwner: String)net.liftweb.http.S.AFuncHolder">duplicate</a><span class="delimiter">(</span><a href="#344504" title="String">uniqueId</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(name: String)scala.collection.mutable.HashMap[String,net.liftweb.http.S.AFuncHolder]" id="230224">removeFunction</a><span class="delimiter">(</span><a title="String" id="394981">name</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#14496" title="(x$1: scala.collection.mutable.HashMap[String,net.liftweb.http.S.AFuncHolder])scala.collection.mutable.HashMap[String,net.liftweb.http.S.AFuncHolder]">synchronized</a> <span class="delimiter">{</span>
    <a href="#230165" title="=&gt; scala.collection.mutable.HashMap[String,net.liftweb.http.S.AFuncHolder]">messageCallback</a> <span title="(key: java.lang.String)scala.collection.mutable.HashMap[String,net.liftweb.http.S.AFuncHolder]">-=</span> <a href="#394981" title="String">name</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Set your session-specific progress listener for mime uploads
   *     pBytesRead - The total number of bytes, which have been read so far.
   *    pContentLength - The total number of bytes, which are being read. May be -1, if this number is unknown.
   *    pItems - The number of the field, which is currently being read. (0 = no item so far, 1 = first item is being read, ...)
   */</span>
  <span class="keyword">var</span> <a title="net.liftweb.common.Box[(Long, Long, Int) =&gt; Unit]" id="230226">progressListener</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[(Long, Long, Int) =&gt; Unit]">Box</a><span class="delimiter">[</span><span class="delimiter">(</span>Long, Long, Int<span class="delimiter">)</span> =&gt; Unit<span class="delimiter">]</span> = <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a>

  <span class="comment">/**
   * Called just before the session exits.  If there's clean-up work, override this method
   */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">def</span> <a title="()Unit" id="230228">cleanUpSession</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#230165" title="(x$1: scala.collection.mutable.HashMap[String,net.liftweb.http.S.AFuncHolder])Unit">messageCallback</a> = <span title="object scala.collection.mutable.HashMap">HashMap</span>.<span title="scala.collection.mutable.HashMap[String,net.liftweb.http.S.AFuncHolder]">empty</span>
    <a href="#230168" title="(x$1: Seq[(net.liftweb.http.NoticeType.Value, scala.xml.NodeSeq, net.liftweb.common.Box[String])])Unit">notices</a> = <span title="object Nil">Nil</span>
    <a href="#230171" title="=&gt; scala.collection.mutable.HashMap[(net.liftweb.common.Box[String], net.liftweb.common.Box[String]),net.liftweb.http.LiftCometActor]">asyncComponents</a>.<span title="()Unit">clear</span>
    <a href="#230174" title="(x$1: scala.collection.mutable.HashMap[String,net.liftweb.http.LiftCometActor])Unit">asyncById</a> = <span title="object scala.collection.mutable.HashMap">HashMap</span>.<span title="scala.collection.mutable.HashMap[String,net.liftweb.http.LiftCometActor]">empty</span>
    <a href="#230177" title="(x$1: Map[String,Any])Unit">myVariables</a> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="scala.collection.immutable.Map[String,Nothing]">empty</span>
    <a href="#230180" title="(x$1: List[net.liftweb.http.LiftSession =&gt; Unit])Unit">onSessionEnd</a> = <span title="object Nil">Nil</span>
    <a href="#230185" title="(x$1: Map[String,net.liftweb.http.PostPageFunctions])Unit">postPageFunctions</a> = <span title="(elems: (String, Nothing)*)scala.collection.immutable.Map[String,Nothing]">Map</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#230196" title="(x$1: scala.collection.mutable.HashMap[String,net.liftweb.http.LiftRules.DispatchPF])Unit">highLevelSessionDispatcher</a> = <span title="object scala.collection.mutable.HashMap">HashMap</span>.<span title="scala.collection.mutable.HashMap[String,net.liftweb.http.LiftRules.DispatchPF]">empty</span>
    <a href="#230199" title="(x$1: scala.collection.mutable.HashMap[String,net.liftweb.http.LiftRules.RewritePF])Unit">sessionRewriter</a> = <span title="object scala.collection.mutable.HashMap">HashMap</span>.<span title="scala.collection.mutable.HashMap[String,net.liftweb.http.LiftRules.RewritePF]">empty</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">def</span> <a title="()Unit" id="230229">fixSessionTime</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#14496" title="(x$1: Unit)Unit">synchronized</a> <span class="delimiter">{</span>
    <span class="keyword">for</span> <span class="delimiter">(</span><a title="net.liftweb.http.provider.HTTPSession" id="395055">httpSession</a> &lt;- <a href="#14496" title="LiftSession.this.type" class="keyword">this</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27031" title="(f: net.liftweb.http.provider.HTTPSession =&gt; Unit)Unit">httpSession</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#230190" title="(x$1: Long)Unit">lastServiceTime</a> = <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48788" title="=&gt; Long">millis</a> <span class="comment">// DO NOT REMOVE THIS LINE!!!!!</span>
      <span class="keyword">val</span> <a title="Long" id="395056">diff</a> = <a href="#230190" title="=&gt; Long">lastServiceTime</a> <span title="(x: Long)Long">-</span> <a href="#395055" title="net.liftweb.http.provider.HTTPSession">httpSession</a>.<a href="provider/HTTPSession.scala.html#357308" title="=&gt; Long">lastAccessedTime</a>
      <span class="keyword">val</span> <a title="Int" id="395057">maxInactive</a> = <a href="#395055" title="net.liftweb.http.provider.HTTPSession">httpSession</a>.<a href="provider/HTTPSession.scala.html#357306" title="=&gt; Long">maxInactiveInterval</a>.<span title="=&gt; Int">toInt</span>
      <span class="keyword">val</span> <a title="Int" id="395058">togo</a>: <span title="Int">Int</span> = <a href="#395057" title="Int">maxInactive</a> <span title="(x: Int)Int">-</span> <span class="delimiter">(</span><a href="#395056" title="Long">diff</a> <span title="(x: Long)Long">/</span> <span title="Long(1000L)" class="long">1000L</span><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span>
      <span class="comment">// if we're within 2 minutes of session timeout and</span>
      <span class="comment">// the Servlet session doesn't seem to have been updated,</span>
      <span class="comment">// extends the lifespan of the HttpSession</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#395056" title="Long">diff</a> <span title="(x: Long)Boolean">&gt;</span> <span title="Long(1000L)" class="long">1000L</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#395058" title="Int">togo</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(120)" class="int">120</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#395055" title="net.liftweb.http.provider.HTTPSession">httpSession</a>.<a href="provider/HTTPSession.scala.html#357307" title="(interval: Long)Unit">setMaxInactiveInterval</a><span class="delimiter">(</span><a href="#395057" title="Int">maxInactive</a> <span title="=&gt; Long">+</span> <span title="Int(120)" class="int">120</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">def</span> <a title="()Unit" id="230230">doCometActorCleanup</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="List[net.liftweb.http.LiftCometActor]" id="395086">acl</a> = <a href="#14496" title="(x$1: List[net.liftweb.http.LiftCometActor])List[net.liftweb.http.LiftCometActor]">synchronized</a> <span class="delimiter">{</span>
      <a href="#14496" title="LiftSession.this.type" class="keyword">this</a>.<a href="#230171" title="=&gt; scala.collection.mutable.HashMap[(net.liftweb.common.Box[String], net.liftweb.common.Box[String]),net.liftweb.http.LiftCometActor]">asyncComponents</a>.<span title="=&gt; Iterable[net.liftweb.http.LiftCometActor]">values</span>.<span title="=&gt; List[net.liftweb.http.LiftCometActor]">toList</span>
    <span class="delimiter">}</span>
    <a href="#395086" title="List[net.liftweb.http.LiftCometActor]">acl</a>.<span title="(f: net.liftweb.http.LiftCometActor =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#395134" title="net.liftweb.http.LiftCometActor">_</a> <a href="../../../../common/net/liftweb/common/SimpleActor.scala.html#29491" title="(param: Any)Unit">!</a> <a href="CometActor.scala.html#14116" title="object net.liftweb.http.ShutdownIfPastLifespan">ShutdownIfPastLifespan</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Adds a cleanup function that will be executed when session is terminated
   */</span>
  <span class="keyword">def</span> <a title="(f: net.liftweb.http.LiftSession =&gt; Unit)Unit" id="230231">addSessionCleanup</a><span class="delimiter">(</span><a title="net.liftweb.http.LiftSession =&gt; Unit" id="395137">f</a>: LiftSession =&gt; Unit<span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#14496" title="(x$1: Unit)Unit">synchronized</a> <span class="delimiter">{</span>
    <a href="#230180" title="(x$1: List[net.liftweb.http.LiftSession =&gt; Unit])Unit">onSessionEnd</a> = <a href="#395137" title="net.liftweb.http.LiftSession =&gt; Unit">f</a> <a href="#395141" title="(x: net.liftweb.http.LiftSession =&gt; Unit)List[net.liftweb.http.LiftSession =&gt; Unit]">::</a> <a href="#230180" title="=&gt; List[net.liftweb.http.LiftSession =&gt; Unit]">onSessionEnd</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Destroy this session and the underlying container session.
   */</span>
  <span class="keyword">def</span> <a title="()Unit" id="230232">destroySession</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49309" title="=&gt; net.liftweb.common.Box[net.liftweb.http.Req]">request</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27031" title="(f: net.liftweb.http.Req =&gt; Unit)Unit">foreach</a><span class="delimiter">(</span><a href="#395152" title="net.liftweb.http.Req">_</a>.<a href="Req.scala.html#149145" title="=&gt; net.liftweb.http.provider.HTTPRequest">request</a>.<a href="provider/HTTPRequest.scala.html#216876" title="=&gt; net.liftweb.http.provider.HTTPSession">session</a>.<a href="provider/HTTPSession.scala.html#357312" title="=&gt; Unit">terminate</a><span class="delimiter">)</span>
    <a href="#14496" title="LiftSession.this.type" class="keyword">this</a>.<a href="#230233" title="()Unit">doShutDown</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">def</span> <a title="()Unit" id="230233">doShutDown</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#230208" title="=&gt; Boolean">running_?</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="comment">// only deal with comet on stateful sessions</span>
      <span class="comment">// stateless temporary sessions bar comet use</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#230327" title="=&gt; Boolean">stateful_?</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="List[(net.liftweb.actor.LiftActor, net.liftweb.http.Req)]" id="395154">cl</a> = <a href="#14496" title="(x$1: List[(net.liftweb.actor.LiftActor, net.liftweb.http.Req)])List[(net.liftweb.actor.LiftActor, net.liftweb.http.Req)]">synchronized</a> <span class="delimiter">{</span>
          <a href="#230210" title="=&gt; List[(net.liftweb.actor.LiftActor, net.liftweb.http.Req)]">cometList</a>
        <span class="delimiter">}</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#395154" title="List[(net.liftweb.actor.LiftActor, net.liftweb.http.Req)]">cl</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#14496" title="LiftSession.this.type" class="keyword">this</a>.<a href="#230212" title="()Unit">breakOutComet</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <span title="object java.lang.Thread">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><span title="Long(100L)" class="int">100</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <a href="#14496" title="LiftSession.this.type" class="keyword">this</a>.<a href="#230245" title="()Unit">shutDown</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Puts the correct thread locking around access to postPageFunctions
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="[T](f: =&gt; T)T" id="230234">accessPostPageFuncs</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="230236">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="=&gt; T" id="395352">f</a>: =&gt; T<span class="delimiter">)</span>: <a href="#230236" title="T">T</a> = <span class="delimiter">{</span>
    <a href="#230187" title="=&gt; java.lang.Object">postPageLock</a>.<span title="(x$1: T)T">synchronized</span> <span class="delimiter">{</span>
      <a href="#395352" title="=&gt; T">f</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">def</span> <a title="()Unit" id="230237">cleanupUnseenFuncs</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159180" title="=&gt; Boolean">enableLiftGC</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#230327" title="=&gt; Boolean">stateful_?</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Long" id="395360">now</a> = <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48788" title="=&gt; Long">millis</a>

      <a href="#230234" title="(f: =&gt; Unit)Unit">accessPostPageFuncs</a> <span class="delimiter">{</span>
        <span class="keyword">for</span> <span class="delimiter">{</span>
          <span class="delimiter">(</span><a title="String" id="395398">key</a>, <a title="net.liftweb.http.PostPageFunctions" id="395399">pageInfo</a><span class="delimiter">)</span> &lt;- <a href="#230185" title="(f: (String, net.liftweb.http.PostPageFunctions) =&gt; Unit)Unit">postPageFunctions</a>
        <span class="delimiter">}</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#395399" title="net.liftweb.http.PostPageFunctions">pageInfo</a>.<a href="#395551" title="=&gt; Boolean">longLife</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
          <span class="delimiter">(</span><a href="#395360" title="Long">now</a> <span title="(x: Long)Long">-</span> <a href="#395399" title="net.liftweb.http.PostPageFunctions">pageInfo</a>.<a href="#395552" title="=&gt; Long">lastSeen</a><span class="delimiter">)</span> <span title="(x: Long)Boolean">&gt;</span> <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159183" title="=&gt; Long">unusedFunctionsLifeTime</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#230185" title="(x$1: Map[String,net.liftweb.http.PostPageFunctions])Unit">postPageFunctions</a> <span title="(key: String)scala.collection.immutable.Map[String,net.liftweb.http.PostPageFunctions]">-=</span> <a href="#395398" title="String">key</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <a href="#14496" title="(x$1: Unit)Unit">synchronized</a> <span class="delimiter">{</span>
        <a href="#230165" title="=&gt; scala.collection.mutable.HashMap[String,net.liftweb.http.S.AFuncHolder]">messageCallback</a>.<span title="(f: (String, net.liftweb.http.S.AFuncHolder) =&gt; Any)Unit">foreach</span> <a href="#395452" title="Any" class="delimiter">{</a>
          <span class="keyword">case</span> <span title="Any" class="delimiter">(</span><a title="String" id="395455">k</a>, <a title="net.liftweb.http.S.AFuncHolder" id="395456">f</a><span class="delimiter">)</span> =&gt;
            <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#395456" title="net.liftweb.http.S.AFuncHolder">f</a>.<a href="S.scala.html#159462" title="=&gt; Boolean">sessionLife</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
              <a href="#395456" title="net.liftweb.http.S.AFuncHolder">f</a>.<a href="S.scala.html#159454" title="=&gt; net.liftweb.common.Box[String]">owner</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27014" title="=&gt; Boolean">isDefined</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
              <span class="delimiter">(</span><a href="#395360" title="Long">now</a> <span title="(x: Long)Long">-</span> <a href="#395456" title="net.liftweb.http.S.AFuncHolder">f</a>.<a href="S.scala.html#159460" title="=&gt; Long">lastSeen</a><span class="delimiter">)</span> <span title="(x: Long)Boolean">&gt;</span> <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159183" title="=&gt; Long">unusedFunctionsLifeTime</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#230165" title="=&gt; scala.collection.mutable.HashMap[String,net.liftweb.http.S.AFuncHolder]">messageCallback</a> <span title="(key: java.lang.String)scala.collection.mutable.HashMap[String,net.liftweb.http.S.AFuncHolder]">-=</span> <a href="#395455" title="String">k</a>
            <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Clear the PostPage JavaScript functions for the current page.
   * This is used by CometActor to remove the PostPage JavaScript
   * functions from the given component during redraw.
   */</span>
  <span class="keyword">def</span> <a title="()Unit" id="230238">clearPostPageJavaScriptForThisPage</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#230309" title="(f: =&gt; Unit)Unit">testStatefulFeature</a> <span class="delimiter">{</span>
      <a href="#230234" title="(f: =&gt; Unit)Unit">accessPostPageFuncs</a> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="String" id="395514">rv</a>: <span title="String">String</span> = <a href="#14488" title="object net.liftweb.http.RenderVersion">RenderVersion</a>.<a href="#345564" title="=&gt; String">get</a>

        <a href="#230185" title="(x$1: Map[String,net.liftweb.http.PostPageFunctions])Unit">postPageFunctions</a> <span title="(key: String)scala.collection.immutable.Map[String,net.liftweb.http.PostPageFunctions]">-=</span> <a href="#395514" title="String">rv</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Associate a function that renders JavaScript with the current page.
   * This function will be run and the resulting JavaScript will be appended
   * to any rendering associated with this page... the normal page render,
   * Ajax calls, and even Comet calls for this page.
   *
   * @param func -- the function that returns JavaScript to be appended to
   * responses associated with this page
   */</span>
  <span class="keyword">def</span> <a title="(func: () =&gt; net.liftweb.http.js.JsCmd)Unit" id="230239">addPostPageJavaScript</a><span class="delimiter">(</span><a title="() =&gt; net.liftweb.http.js.JsCmd" id="395532">func</a>: <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; JsCmd<span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#230309" title="(f: =&gt; Unit)Unit">testStatefulFeature</a> <span class="delimiter">{</span>
      <a href="#230234" title="(f: =&gt; Unit)Unit">accessPostPageFuncs</a> <span class="delimiter">{</span>
        <span class="comment">// The page or cometactor that the functions are associated with</span>
        <span class="keyword">val</span> <a title="String" id="395538">rv</a>: <span title="String">String</span> = <a href="#14488" title="object net.liftweb.http.RenderVersion">RenderVersion</a>.<a href="#345564" title="=&gt; String">get</a>

        <span class="keyword">val</span> <a title="net.liftweb.http.PostPageFunctions" id="395539">old</a> =
          <a href="#230185" title="=&gt; Map[String,net.liftweb.http.PostPageFunctions]">postPageFunctions</a>.<span title="(key: String, default: =&gt; net.liftweb.http.PostPageFunctions)net.liftweb.http.PostPageFunctions">getOrElse</span><span class="delimiter">(</span><a href="#395538" title="String">rv</a>,
            <a href="#403370" title="(renderVersion: String, functionCount: Int, longLife: Boolean, lastSeen: Long, functions: List[() =&gt; net.liftweb.http.js.JsCmd])net.liftweb.http.PostPageFunctions">PostPageFunctions</a><span class="delimiter">(</span><a href="#395538" title="String">rv</a>,
              <span title="Int(0)" class="int">0</span>,
              <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49316" title="=&gt; net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">currentCometActor</a>.
                <a href="../../../../common/net/liftweb/common/Box.scala.html#27014" title="=&gt; Boolean">isDefined</a>,
              <a href="../../../../util/net/liftweb/util/Helpers.scala.html#13346" title="object net.liftweb.util.Helpers">Helpers</a>.<a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48788" title="=&gt; Long">millis</a>,
              <span title="object Nil">Nil</span><span class="delimiter">)</span><span class="delimiter">)</span>

        <span class="keyword">val</span> <a title="net.liftweb.http.PostPageFunctions" id="395540">updated</a> = <a href="#403370" title="(renderVersion: String, functionCount: Int, longLife: Boolean, lastSeen: Long, functions: List[() =&gt; net.liftweb.http.js.JsCmd])net.liftweb.http.PostPageFunctions">PostPageFunctions</a><span class="delimiter">(</span><a href="#395539" title="net.liftweb.http.PostPageFunctions">old</a>.<a href="#395549" title="=&gt; String">renderVersion</a>,
          <a href="#395539" title="net.liftweb.http.PostPageFunctions">old</a>.<a href="#395550" title="=&gt; Int">functionCount</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>,
          <a href="#395539" title="net.liftweb.http.PostPageFunctions">old</a>.<a href="#395551" title="=&gt; Boolean">longLife</a>,
          <a href="../../../../util/net/liftweb/util/Helpers.scala.html#13346" title="object net.liftweb.util.Helpers">Helpers</a>.<a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48788" title="=&gt; Long">millis</a>,
          <a href="#395532" title="() =&gt; net.liftweb.http.js.JsCmd">func</a> <a href="#395573" title="(x: () =&gt; net.liftweb.http.js.JsCmd)List[() =&gt; net.liftweb.http.js.JsCmd]">::</a> <a href="#395539" title="net.liftweb.http.PostPageFunctions">old</a>.<a href="#395553" title="=&gt; List[() =&gt; net.liftweb.http.js.JsCmd]">functions</a><span class="delimiter">)</span>

        <a href="#230185" title="(x$1: Map[String,net.liftweb.http.PostPageFunctions])Unit">postPageFunctions</a> <span title="(kv: (String, net.liftweb.http.PostPageFunctions))scala.collection.immutable.Map[String,net.liftweb.http.PostPageFunctions]">+=</span> <span class="delimiter">(</span><a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#49003" title="implicit net.liftweb.util.BindHelpers.strToSuperArrowAssoc : (in: String)net.liftweb.util.Helpers.SuperArrowAssoc">rv</a> <a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#58395" title="(in: net.liftweb.http.PostPageFunctions)(String, net.liftweb.http.PostPageFunctions)">-&gt;</a> <a href="#395540" title="net.liftweb.http.PostPageFunctions">updated</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(rv: String)List[net.liftweb.http.js.JsCmd]" id="230240">postPageJavaScript</a><span class="delimiter">(</span><a title="String" id="345646">rv</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="List[net.liftweb.http.js.JsCmd]">List</span><span class="delimiter">[</span>JsCmd<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="=&gt; Option[net.liftweb.http.PostPageFunctions]" id="395710">org</a> = <a href="#230234" title="(f: =&gt; Option[net.liftweb.http.PostPageFunctions])Option[net.liftweb.http.PostPageFunctions]">accessPostPageFuncs</a> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Option[net.liftweb.http.PostPageFunctions]" id="395713">ret</a> = <a href="#230185" title="=&gt; Map[String,net.liftweb.http.PostPageFunctions]">postPageFunctions</a>.<span title="(key: String)Option[net.liftweb.http.PostPageFunctions]">get</span><span class="delimiter">(</span><a href="#345646" title="String">rv</a><span class="delimiter">)</span>
      <a href="#395713" title="Option[net.liftweb.http.PostPageFunctions]">ret</a>.<span title="(f: net.liftweb.http.PostPageFunctions =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span>
        <a title="net.liftweb.http.PostPageFunctions" id="395722">r</a> =&gt; <a href="#230185" title="(x$1: Map[String,net.liftweb.http.PostPageFunctions])Unit">postPageFunctions</a> <span title="(kv: (String, net.liftweb.http.PostPageFunctions))scala.collection.immutable.Map[String,net.liftweb.http.PostPageFunctions]">+=</span> <span class="delimiter">(</span><a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#49003" title="implicit net.liftweb.util.BindHelpers.strToSuperArrowAssoc : (in: String)net.liftweb.util.Helpers.SuperArrowAssoc">rv</a> <a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#58395" title="(in: net.liftweb.http.PostPageFunctions)(String, net.liftweb.http.PostPageFunctions)">-&gt;</a> <a href="#395722" title="net.liftweb.http.PostPageFunctions">r</a>.<a href="#389568" title="=&gt; net.liftweb.http.PostPageFunctions">updateLastSeen</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#395713" title="Option[net.liftweb.http.PostPageFunctions]">ret</a>
    <span class="delimiter">}</span>

    <a href="#395710" title="=&gt; Option[net.liftweb.http.PostPageFunctions]">org</a> <span title="List[net.liftweb.http.js.JsCmd]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="scala.collection.immutable.Nil.type">None</span> =&gt; <span title="object Nil">Nil</span>
      <span class="keyword">case</span> <span title="List[net.liftweb.http.js.JsCmd]">Some</span><span class="delimiter">(</span><a title="net.liftweb.http.PostPageFunctions" id="395861">ppf</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="scala.collection.mutable.ListBuffer[net.liftweb.http.js.JsCmd]" id="395862">lb</a> = <span title="scala.collection.mutable.ListBuffer[net.liftweb.http.js.JsCmd]" class="keyword">new</span> <span title="scala.collection.mutable.ListBuffer[net.liftweb.http.js.JsCmd]">ListBuffer</span><span class="delimiter">[</span>JsCmd<span class="delimiter">]</span>

        <span class="keyword">def</span> <a title="(count: Int, funcs: List[() =&gt; net.liftweb.http.js.JsCmd])Unit" id="395863">run</a><span class="delimiter">(</span><a title="Int" id="395864">count</a>: <span title="Int">Int</span>, <a title="List[() =&gt; net.liftweb.http.js.JsCmd]" id="395865">funcs</a>: <span title="List[() =&gt; net.liftweb.http.js.JsCmd]">List</span><span class="delimiter">[</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; JsCmd<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#395865" title="List[() =&gt; net.liftweb.http.js.JsCmd]">funcs</a>.<span title="=&gt; List[() =&gt; net.liftweb.http.js.JsCmd]">reverse</span>.<span title="(f: () =&gt; net.liftweb.http.js.JsCmd =&gt; scala.collection.mutable.ListBuffer[net.liftweb.http.js.JsCmd])Unit">foreach</span><span class="delimiter">(</span><a title="() =&gt; net.liftweb.http.js.JsCmd" id="395893">f</a> =&gt; <a href="#395862" title="scala.collection.mutable.ListBuffer[net.liftweb.http.js.JsCmd]">lb</a> <span title="(x: net.liftweb.http.js.JsCmd)lb.type">+=</span> <a href="#395893" title="()net.liftweb.http.js.JsCmd">f</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="net.liftweb.http.PostPageFunctions" id="395866">next</a> = <a href="#395710" title="=&gt; Option[net.liftweb.http.PostPageFunctions]">org</a>.<span title="=&gt; net.liftweb.http.PostPageFunctions">get</span> <span class="comment">// safe to do get here because we know the</span>
          <span class="comment">// postPageFunc is defined</span>

          <span class="keyword">val</span> <a title="Int" id="395867">diff</a> = <a href="#395866" title="net.liftweb.http.PostPageFunctions">next</a>.<a href="#395550" title="=&gt; Int">functionCount</a> <span title="(x: Int)Int">-</span> <a href="#395864" title="Int">count</a>

          <span class="comment">// if the function table is updated, make sure to get</span>
          <span class="comment">// the additional functions</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#395867" title="Int">diff</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
            <a href="#395863" title="(count: Int, funcs: List[() =&gt; net.liftweb.http.js.JsCmd])Unit">run</a><span class="delimiter">(</span><a href="#395866" title="net.liftweb.http.PostPageFunctions">next</a>.<a href="#395550" title="=&gt; Int">functionCount</a>, <a href="#395866" title="net.liftweb.http.PostPageFunctions">next</a>.<a href="#395553" title="=&gt; List[() =&gt; net.liftweb.http.js.JsCmd]">functions</a>.<span title="(n: Int)List[() =&gt; net.liftweb.http.js.JsCmd]">take</span><span class="delimiter">(</span><a href="#395867" title="Int">diff</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>

        <a href="#395863" title="(count: Int, funcs: List[() =&gt; net.liftweb.http.js.JsCmd])Unit">run</a><span class="delimiter">(</span><a href="#395861" title="net.liftweb.http.PostPageFunctions">ppf</a>.<a href="#395550" title="=&gt; Int">functionCount</a>, <a href="#395861" title="net.liftweb.http.PostPageFunctions">ppf</a>.<a href="#395553" title="=&gt; List[() =&gt; net.liftweb.http.js.JsCmd]">functions</a><span class="delimiter">)</span>

        <a href="#395862" title="scala.collection.mutable.ListBuffer[net.liftweb.http.js.JsCmd]">lb</a>.<span title="=&gt; List[net.liftweb.http.js.JsCmd]">toList</span>

      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Get the post-page JavaScript functions for a sequence of page IDs.
   * This is used by the CometActor to get the post-page JavaScript functions
   * for the comet actor and for the page the the comet actor is associated with
   */</span>
  <span class="keyword">def</span> <a title="(pageIds: Seq[String])List[net.liftweb.http.js.JsCmd]" id="230241">postPageJavaScript</a><span class="delimiter">(</span><a title="Seq[String]" id="345644">pageIds</a>: <span title="Seq[String]">Seq</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="List[net.liftweb.http.js.JsCmd]">List</span><span class="delimiter">[</span>JsCmd<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">for</span> <span class="delimiter">{</span>
      <a title="String" id="395932">rv</a> &lt;- <a href="#345644" title="Seq[String]">pageIds</a>.<span title="=&gt; List[String]">toList</span>.<span title="(f: String =&gt; scala.collection.GenTraversableOnce[net.liftweb.http.js.JsCmd])(implicit bf: scala.collection.generic.CanBuildFrom[List[String],net.liftweb.http.js.JsCmd,List[net.liftweb.http.js.JsCmd]])List[net.liftweb.http.js.JsCmd]">distinct</span>
      <a title="net.liftweb.http.js.JsCmd" id="395958">js</a> &lt;- <a href="#230240" title="(rv: String)List[net.liftweb.http.js.JsCmd]">postPageJavaScript</a><span title="(f: net.liftweb.http.js.JsCmd =&gt; net.liftweb.http.js.JsCmd)(implicit bf: scala.collection.generic.CanBuildFrom[List[net.liftweb.http.js.JsCmd],net.liftweb.http.js.JsCmd,List[net.liftweb.http.js.JsCmd]])List[net.liftweb.http.js.JsCmd]" class="delimiter">(</span><a href="#395932" title="String">rv</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="#395958" title="net.liftweb.http.js.JsCmd">js</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Get the JavaScript to execute as part of the current page
   */</span>
  <span class="keyword">def</span> <a title="()List[net.liftweb.http.js.JsCmd]" id="230242">postPageJavaScript</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="List[net.liftweb.http.js.JsCmd]">List</span><span class="delimiter">[</span>JsCmd<span class="delimiter">]</span> = <a href="#230240" title="(rv: String)List[net.liftweb.http.js.JsCmd]">postPageJavaScript</a><span class="delimiter">(</span><a href="#14488" title="object net.liftweb.http.RenderVersion">RenderVersion</a>.<a href="#345564" title="=&gt; String">get</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Updates the timestamp of the functions owned by this owner and return the
   * number of updated functions
   */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(ownerName: String, time: Long)Int" id="230243">updateFuncByOwner</a><span class="delimiter">(</span><a title="String" id="381073">ownerName</a>: <span title="String">String</span>, <a title="Long" id="381074">time</a>: <span title="Long">Long</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
    <a href="#230234" title="(f: =&gt; Unit)Unit">accessPostPageFuncs</a> <span class="delimiter">{</span>
      <span class="keyword">for</span> <span class="delimiter">{</span>
        <a title="net.liftweb.http.PostPageFunctions" id="396029">funcInfo</a> &lt;- <a href="#230185" title="=&gt; Map[String,net.liftweb.http.PostPageFunctions]">postPageFunctions</a>.<span title="(key: String)Option[net.liftweb.http.PostPageFunctions]">get</span><span title="(f: net.liftweb.http.PostPageFunctions =&gt; Unit)Unit" class="delimiter">(</span><a href="#381073" title="String">ownerName</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <a href="#230185" title="(x$1: Map[String,net.liftweb.http.PostPageFunctions])Unit">postPageFunctions</a> <span title="(kv: (String, net.liftweb.http.PostPageFunctions))scala.collection.immutable.Map[String,net.liftweb.http.PostPageFunctions]">+=</span> <span class="delimiter">(</span><a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#49003" title="implicit net.liftweb.util.BindHelpers.strToSuperArrowAssoc : (in: String)net.liftweb.util.Helpers.SuperArrowAssoc">ownerName</a> <a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#58395" title="(in: net.liftweb.http.PostPageFunctions)(String, net.liftweb.http.PostPageFunctions)">-&gt;</a> <a href="#396029" title="net.liftweb.http.PostPageFunctions">funcInfo</a>.<a href="#389568" title="=&gt; net.liftweb.http.PostPageFunctions">updateLastSeen</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="#14496" title="(x$1: Int)Int">synchronized</a> <span class="delimiter">{</span>
      <span class="delimiter">(</span><span title="Int(0)" class="int">0</span> <a href="#396140" title="(z: Int)(op: (Int, (String, net.liftweb.http.S.AFuncHolder)) =&gt; Int)Int">/:</a> <a href="#230165" title="=&gt; scala.collection.mutable.HashMap[String,net.liftweb.http.S.AFuncHolder]">messageCallback</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="Int" id="396155">l</a>, <a title="(String, net.liftweb.http.S.AFuncHolder)" id="396156">v</a><span class="delimiter">)</span> =&gt; <a href="#396155" title="Int">l</a> <span title="(x: Int)Int">+</span> <span class="delimiter">(</span><a href="#396156" title="(String, net.liftweb.http.S.AFuncHolder)">v</a>.<span title="=&gt; net.liftweb.http.S.AFuncHolder">_2</span>.<a href="S.scala.html#159454" title="=&gt; net.liftweb.common.Box[String]">owner</a> <span title="Int" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Int">Full</span><span class="delimiter">(</span><a title="String" id="396162">owner</a><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#396162" title="String">owner</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#381073" title="String">ownerName</a><span class="delimiter">)</span> =&gt;
          <a href="#396156" title="(String, net.liftweb.http.S.AFuncHolder)">v</a>.<span title="=&gt; net.liftweb.http.S.AFuncHolder">_2</span>.<a href="S.scala.html#159461" title="(when: Long)Unit">lastSeen</a> = <a href="#381074" title="Long">time</a>
          <span title="Int(1)" class="int">1</span>
        <span class="keyword">case</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="Int">Empty</a> =&gt; <a href="#396156" title="(String, net.liftweb.http.S.AFuncHolder)">v</a>.<span title="=&gt; net.liftweb.http.S.AFuncHolder">_2</span>.<a href="S.scala.html#159461" title="(when: Long)Unit">lastSeen</a> = <a href="#381074" title="Long">time</a>
        <span title="Int(1)" class="int">1</span>
        <span class="keyword">case</span> <span title="Int(0)">_</span> =&gt; <span title="Int(0)" class="int">0</span>
      <span class="delimiter">}</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Returns true if there are functions bound for this owner
   */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(owner: String)Boolean" id="230244">hasFuncsForOwner</a><span class="delimiter">(</span><a title="String" id="351310">owner</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <a href="#14496" title="(x$1: Boolean)Boolean">synchronized</a> <span class="delimiter">{</span>
    <span title="=&gt; Boolean">!</span><a href="#230165" title="=&gt; scala.collection.mutable.HashMap[String,net.liftweb.http.S.AFuncHolder]">messageCallback</a>.<span title="(p: (String, net.liftweb.http.S.AFuncHolder) =&gt; Boolean)Option[(String, net.liftweb.http.S.AFuncHolder)]">find</span><span class="delimiter">(</span><a href="#396180" title="(String, net.liftweb.http.S.AFuncHolder)">_</a>.<span title="=&gt; net.liftweb.http.S.AFuncHolder">_2</span>.<a href="S.scala.html#159454" title="=&gt; net.liftweb.common.Box[String]">owner</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#351310" title="String">owner</a><span class="delimiter">)</span>.<span title="=&gt; Boolean">isEmpty</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="230245">shutDown</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="List[() =&gt; Unit]" id="395166">done</a>: <span title="List[() =&gt; Unit]">List</span><span class="delimiter">[</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Unit<span class="delimiter">]</span> = <span title="object Nil">Nil</span>

    <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49455" title="(session: net.liftweb.http.LiftSession)(f: =&gt; Unit)Unit">initIfUninitted</a><span class="delimiter">(</span><a href="#14496" title="net.liftweb.http.LiftSession" class="keyword">this</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#230180" title="=&gt; List[net.liftweb.http.LiftSession =&gt; Unit]">onSessionEnd</a>.<span title="(f: net.liftweb.http.LiftSession =&gt; Unit =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#395192" title="(v1: net.liftweb.http.LiftSession)Unit">_</a><span class="delimiter">(</span><a href="#14496" title="net.liftweb.http.LiftSession" class="keyword">this</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#14496" title="(x$1: Unit)Unit">synchronized</a> <span class="delimiter">{</span>
        <a href="#14470" title="object net.liftweb.http.LiftSession">LiftSession</a>.<a href="#326777" title="=&gt; List[net.liftweb.http.LiftSession =&gt; Unit]">onAboutToShutdownSession</a>.<span title="(f: net.liftweb.http.LiftSession =&gt; Unit =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#395218" title="(v1: net.liftweb.http.LiftSession)Unit">_</a><span class="delimiter">(</span><a href="#14496" title="net.liftweb.http.LiftSession" class="keyword">this</a><span class="delimiter">)</span><span class="delimiter">)</span>

        <a href="#230157" title="(x$1: Boolean)Unit">_running_?</a> = <span title="Boolean(false)" class="keyword">false</span>

        <a href="#14484" title="object net.liftweb.http.SessionMaster">SessionMaster</a>.<a href="#357519" title="(in: Any)Unit">sendMsg</a><span class="delimiter">(</span><a href="#403382" title="(sessionId: String)net.liftweb.http.RemoveSession">RemoveSession</a><span class="delimiter">(</span><a href="#14496" title="LiftSession.this.type" class="keyword">this</a>.<a href="#357324" title="=&gt; String">uniqueId</a><span class="delimiter">)</span><span class="delimiter">)</span>

        <a href="#230171" title="=&gt; scala.collection.mutable.HashMap[(net.liftweb.common.Box[String], net.liftweb.common.Box[String]),net.liftweb.http.LiftCometActor]">asyncComponents</a>.<span title="(f: ((net.liftweb.common.Box[String], net.liftweb.common.Box[String]), net.liftweb.http.LiftCometActor) =&gt; Unit)Unit">foreach</span> <a href="#395243" title="Unit" class="delimiter">{</a>
          <span class="keyword">case</span> <span title="Unit" class="delimiter">(</span>_, <a title="net.liftweb.http.LiftCometActor" id="395246">comp</a><span class="delimiter">)</span> =&gt; <a href="#395166" title="List[() =&gt; Unit]">done</a> <span title="(x: () =&gt; Unit)List[() =&gt; Unit]">::=</span> <span class="delimiter">(</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="../../../../util/net/liftweb/util/ControlHelpers.scala.html#48608" title="(f: =&gt; Unit)net.liftweb.common.Box[Unit]">tryo</a><span title="Unit" class="delimiter">(</span><a href="#395246" title="net.liftweb.http.LiftCometActor">comp</a> <a href="../../../../common/net/liftweb/common/SimpleActor.scala.html#29491" title="(param: Any)Unit">!</a> <a href="#402713" title="object net.liftweb.http.ShutDown">ShutDown</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#230228" title="()Unit">cleanUpSession</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#14470" title="object net.liftweb.http.LiftSession">LiftSession</a>.<a href="#326780" title="=&gt; List[net.liftweb.http.LiftSession =&gt; Unit]">onShutdownSession</a>.<span title="(f: net.liftweb.http.LiftSession =&gt; Unit =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="net.liftweb.http.LiftSession =&gt; Unit" id="395317">f</a> =&gt; <a href="#395166" title="List[() =&gt; Unit]">done</a> <span title="(x: () =&gt; Unit)List[() =&gt; Unit]">::=</span> <span class="delimiter">(</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#395317" title="(v1: net.liftweb.http.LiftSession)Unit">f</a><span class="delimiter">(</span><a href="#14496" title="net.liftweb.http.LiftSession" class="keyword">this</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <a href="#395166" title="List[() =&gt; Unit]">done</a>.<span title="(f: () =&gt; Unit =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#395350" title="() =&gt; Unit">_</a>.<span title="()Unit">apply</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Find the template assocaited with the Loc
   */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">def</span> <a title="=&gt; net.liftweb.common.Box[scala.xml.NodeSeq]" id="230246">locTemplate</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[scala.xml.NodeSeq]">Box</a><span class="delimiter">[</span>NodeSeq<span class="delimiter">]</span> =
    <span class="keyword">for</span> <span class="delimiter">(</span><a title="net.liftweb.sitemap.Loc[_]" id="396198">loc</a> &lt;- <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27023" title="(f: net.liftweb.sitemap.Loc[_] =&gt; net.liftweb.common.Box[scala.xml.NodeSeq])net.liftweb.common.Box[scala.xml.NodeSeq]">location</a>;
         <a title="scala.xml.NodeSeq" id="396205">template</a> &lt;- <a href="#396198" title="net.liftweb.sitemap.Loc[_]">loc</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: scala.xml.NodeSeq =&gt; scala.xml.NodeSeq)net.liftweb.common.Box[scala.xml.NodeSeq]">template</a><span class="delimiter">)</span> <span class="keyword">yield</span> <a href="#396205" title="scala.xml.NodeSeq">template</a>

  <span class="comment">/**
   * Define the context path for this session.  This allows different
   * sessions to have different context paths.
   */</span>
  <span class="keyword">def</span> <a title="=&gt; String" id="230247">contextPath</a> = <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159060" title="()net.liftweb.common.Box[String]">calculateContextPath</a><span class="delimiter">(</span><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; String)String">openOr</a> <a href="#357323" title="=&gt; String">_contextPath</a>

  <span class="comment">/**
   * Convert a template into a Lift Response.
   *
   * @param template -- the NodeSeq that makes up the page... or the template
   * will be located via findVisibleTemplate
   * @param request -- the Req the led to this rendering
   * @param path -- the ParsePath that led to this page
   * @param code -- the HTTP response code (usually 200)
   *
   * @returns a Box of LiftResponse with all the proper page rewriting
   */</span>
  <span class="keyword">def</span> <a title="(template: net.liftweb.common.Box[scala.xml.NodeSeq], request: net.liftweb.http.Req, path: net.liftweb.http.ParsePath, code: Int)net.liftweb.common.Box[net.liftweb.http.LiftResponse]" id="230248">processTemplate</a><span class="delimiter">(</span><a title="net.liftweb.common.Box[scala.xml.NodeSeq]" id="396220">template</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[scala.xml.NodeSeq]">Box</a><span class="delimiter">[</span>NodeSeq<span class="delimiter">]</span>, <a title="net.liftweb.http.Req" id="396221">request</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a>, <a title="net.liftweb.http.ParsePath" id="396222">path</a>: <a href="Req.scala.html#14577" title="net.liftweb.http.ParsePath">ParsePath</a>, <a title="Int" id="396223">code</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">Box</a><span class="delimiter">[</span>LiftResponse<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#230249" title="object LiftSession.this.overrideResponseCode">overrideResponseCode</a>.<a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75392" title="(newVal: net.liftweb.common.Box[Int])(f: =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse])net.liftweb.common.Box[net.liftweb.http.LiftResponse]">doWith</a><span class="delimiter">(</span><a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="delimiter">(</span><a href="#396220" title="net.liftweb.common.Box[scala.xml.NodeSeq]">template</a> <a href="../../../../common/net/liftweb/common/Box.scala.html#27043" title="(alternative: =&gt; net.liftweb.common.Box[scala.xml.NodeSeq])net.liftweb.common.Box[scala.xml.NodeSeq]">or</a> <a href="#230269" title="(path: net.liftweb.http.ParsePath, session: net.liftweb.http.Req)net.liftweb.common.Box[scala.xml.NodeSeq]">findVisibleTemplate</a><span class="delimiter">(</span><a href="#396222" title="net.liftweb.http.ParsePath">path</a>, <a href="#396221" title="net.liftweb.http.Req">request</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: scala.xml.NodeSeq =&gt; net.liftweb.http.LiftResponse)net.liftweb.common.Box[net.liftweb.http.LiftResponse]">map</a> <span class="delimiter">{</span>
        <a title="scala.xml.NodeSeq" id="396242">xhtml</a> =&gt;
          <a href="#230162" title="=&gt; net.liftweb.util.ThreadGlobal[Boolean]{def ?: Boolean}">fullPageLoad</a>.<a href="../../../../util/net/liftweb/util/ThreadGlobal.scala.html#51274" title="(x: Boolean)(f: =&gt; net.liftweb.http.LiftResponse)net.liftweb.http.LiftResponse">doWith</a><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="comment">// allow parallel snippets</span>
            <span class="comment">// Phase 1: snippets &amp; templates processing</span>
            <span class="keyword">val</span> <a title="scala.xml.NodeSeq" id="396248">rawXml</a>: <span title="scala.xml.NodeSeq">NodeSeq</span> = <a href="#230307" title="(page: String, in: scala.xml.NodeSeq)scala.xml.NodeSeq">processSurroundAndInclude</a><span class="delimiter">(</span><a href="#14486" title="object net.liftweb.http.PageName">PageName</a> <a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75377" title="=&gt; String">get</a>, <a href="#396242" title="scala.xml.NodeSeq">xhtml</a><span class="delimiter">)</span>

            <span class="comment">// Make sure that functions have the right owner. It is important for this to</span>
            <span class="comment">// happen before the merge phase so that in merge to have a correct view of</span>
            <span class="comment">// mapped functions and their owners.</span>
            <a href="#230223" title="(funcs: Map[String,net.liftweb.http.S.AFuncHolder], uniqueId: String, when: Long)Unit">updateFunctionMap</a><span class="delimiter">(</span><a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49475" title="=&gt; Map[String,net.liftweb.http.S.AFuncHolder]">functionMap</a>, <a href="#14488" title="object net.liftweb.http.RenderVersion">RenderVersion</a> <a href="#345564" title="=&gt; String">get</a>, <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48788" title="=&gt; Long">millis</a><span class="delimiter">)</span>

            <span class="comment">// Clear the function map after copying it... but it</span>
            <span class="comment">// might get some nifty new functions during the merge phase</span>
            <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49479" title="=&gt; Unit">clearFunctionMap</a>

            <span class="comment">// Phase 2: Head &amp; Tail merge, add additional elements to body &amp; head</span>
            <span class="keyword">val</span> <a title="scala.xml.Node" id="396249">xml</a> = <a href="LiftMerge.scala.html#230138" title="(xhtml: scala.xml.NodeSeq, req: net.liftweb.http.Req)scala.xml.Node">merge</a><span class="delimiter">(</span><a href="#396248" title="scala.xml.NodeSeq">rawXml</a>, <a href="#396221" title="net.liftweb.http.Req">request</a><span class="delimiter">)</span>

            <span class="comment">// But we need to update the function map because there</span>
            <span class="comment">// may be addition functions created during the JsToAppend processing</span>
            <span class="comment">// See issue #983</span>
            <a href="#230223" title="(funcs: Map[String,net.liftweb.http.S.AFuncHolder], uniqueId: String, when: Long)Unit">updateFunctionMap</a><span class="delimiter">(</span><a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49475" title="=&gt; Map[String,net.liftweb.http.S.AFuncHolder]">functionMap</a>, <a href="#14488" title="object net.liftweb.http.RenderVersion">RenderVersion</a> <a href="#345564" title="=&gt; String">get</a>, <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48788" title="=&gt; Long">millis</a><span class="delimiter">)</span>

            <a href="#230168" title="(x$1: Seq[(net.liftweb.http.NoticeType.Value, scala.xml.NodeSeq, net.liftweb.common.Box[String])])Unit">notices</a> = <span title="object Nil">Nil</span>
            <span class="comment">// Phase 3: Response conversion including fixHtml</span>
            <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159125" title="(v1: (Any, List[(String, String)], List[net.liftweb.http.provider.HTTPCookie], net.liftweb.http.Req))net.liftweb.http.LiftResponse">convertResponse</a><span title="(_1: (scala.xml.Node, Int), _2: List[(String, String)], _3: List[net.liftweb.http.provider.HTTPCookie], _4: net.liftweb.http.Req)((scala.xml.Node, Int), List[(String, String)], List[net.liftweb.http.provider.HTTPCookie], net.liftweb.http.Req)" class="delimiter">(</span><span title="(_1: scala.xml.Node, _2: Int)(scala.xml.Node, Int)" class="delimiter">(</span><a href="#396249" title="scala.xml.Node">xml</a>, <a href="#230249" title="object LiftSession.this.overrideResponseCode">overrideResponseCode</a>.<a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75375" title="=&gt; net.liftweb.common.Box[Int]">is</a> <a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; Int)Int">openOr</a> <a href="#396223" title="Int">code</a><span class="delimiter">)</span>,
              <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49405" title="(in: List[(String, String)])List[(String, String)]">getHeaders</a><span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159119" title="(v1: (scala.xml.NodeSeq, net.liftweb.http.Req))List[(String, String)]">defaultHeaders</a><span class="delimiter">(</span><span title="(_1: scala.xml.Node, _2: net.liftweb.http.Req)(scala.xml.Node, net.liftweb.http.Req)" class="delimiter">(</span><a href="#396249" title="scala.xml.Node">xml</a>, <a href="#396221" title="net.liftweb.http.Req">request</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>,
              <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49317" title="=&gt; List[net.liftweb.http.provider.HTTPCookie]">responseCookies</a>,
              <a href="#396221" title="net.liftweb.http.Req">request</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">object</span> <a title="object LiftSession.this.overrideResponseCode" id="230249">overrideResponseCode</a> <span title="ScalaObject" class="keyword">extends</span> <a href="Vars.scala.html#14776" title="net.liftweb.http.TransientRequestVar[net.liftweb.common.Box[Int]]">TransientRequestVar</a><span class="delimiter">[</span>Box<span class="delimiter">[</span>Int<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a><span class="delimiter">)</span>

  <span class="comment">/**
   * If the sitemap entry for this Req is marked stateless,
   * run the rest of the request as stateless
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="[T](req: net.liftweb.http.Req)(f: =&gt; T)T" id="230251">checkStatelessInSiteMap</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="230253">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="net.liftweb.http.Req" id="396292">req</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="=&gt; T" id="396293">f</a>: =&gt; T<span class="delimiter">)</span>: <a href="#230253" title="T">T</a> = <span class="delimiter">{</span>
    <a href="#396292" title="net.liftweb.http.Req">req</a>.<a href="Req.scala.html#149208" title="=&gt; net.liftweb.common.Box[net.liftweb.sitemap.Loc[_]]">location</a> <span title="T" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="T">Full</span><span class="delimiter">(</span><a title="net.liftweb.sitemap.Loc[_]" id="396297">loc</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#396297" title="net.liftweb.sitemap.Loc[_]">loc</a>.<a href="../sitemap/Loc.scala.html#215909" title="=&gt; Boolean">stateless_?</a> =&gt; <a href="#14496" title="LiftSession.this.type" class="keyword">this</a>.<a href="#230329" title="(f: =&gt; T)T">doAsStateless</a><span class="delimiter">(</span><a href="#396293" title="=&gt; T">f</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="T">_</span> =&gt; <a href="#396293" title="=&gt; T">f</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Destroy the current session, then create a new session and
   * continue the execution of the code.  The continuation function
   * must return Nothing (it must throw an exception... this is typically
   * done by calling S.redirectTo(...)).  This method is
   * useful for changing sessions on login.  Issue #727.
   */</span>
  <span class="keyword">def</span> <a title="(continuation: () =&gt; Nothing)Nothing" id="230254">destroySessionAndContinueInNewSession</a><span class="delimiter">(</span><a title="() =&gt; Nothing" id="230332">continuation</a>: <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Nothing<span class="delimiter">)</span>: <span title="Nothing">Nothing</span> = <span class="delimiter">{</span>
    <span title="Nothing" class="keyword">throw</span> <span title="net.liftweb.http.ContinueResponseException" class="keyword">new</span> <a href="ResponseShortcutException.scala.html#14620" title="net.liftweb.http.ContinueResponseException">ContinueResponseException</a><span class="delimiter">(</span><a href="#230332" title="() =&gt; Nothing">continuation</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(request: net.liftweb.http.Req, continuation: net.liftweb.common.Box[() =&gt; Nothing])net.liftweb.common.Box[net.liftweb.http.LiftResponse]" id="230255">processRequest</a><span class="delimiter">(</span><a title="net.liftweb.http.Req" id="380982">request</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a>,
                                   <a title="net.liftweb.common.Box[() =&gt; Nothing]" id="380983">continuation</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[() =&gt; Nothing]">Box</a><span class="delimiter">[</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Nothing<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">Box</a><span class="delimiter">[</span>LiftResponse<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#230219" title="object LiftSession.this.ieMode">ieMode</a>.<a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75375" title="=&gt; Boolean">is</a> <span class="comment">// make sure this is primed</span>
    <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75381" title="(what: Seq[(net.liftweb.http.NoticeType.Value, scala.xml.NodeSeq, net.liftweb.common.Box[String])])Seq[(net.liftweb.http.NoticeType.Value, scala.xml.NodeSeq, net.liftweb.common.Box[String])]">oldNotices</a><span class="delimiter">(</span><a href="#230168" title="=&gt; Seq[(net.liftweb.http.NoticeType.Value, scala.xml.NodeSeq, net.liftweb.common.Box[String])]">notices</a><span class="delimiter">)</span>
    <a href="#14470" title="object net.liftweb.http.LiftSession">LiftSession</a>.<a href="#326783" title="=&gt; List[(net.liftweb.http.LiftSession, net.liftweb.http.Req) =&gt; Unit]">onBeginServicing</a>.<span title="(f: (net.liftweb.http.LiftSession, net.liftweb.http.Req) =&gt; Unit =&gt; net.liftweb.common.Box[Unit])Unit">foreach</span><span class="delimiter">(</span><a title="(net.liftweb.http.LiftSession, net.liftweb.http.Req) =&gt; Unit" id="396333">f</a> =&gt; <a href="../../../../util/net/liftweb/util/ControlHelpers.scala.html#48608" title="(f: =&gt; Unit)net.liftweb.common.Box[Unit]">tryo</a><span class="delimiter">(</span><a href="#396333" title="(v1: net.liftweb.http.LiftSession, v2: net.liftweb.http.Req)Unit">f</a><span class="delimiter">(</span><a href="#14496" title="net.liftweb.http.LiftSession" class="keyword">this</a>, <a href="#380982" title="net.liftweb.http.Req">request</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]" id="396309">ret</a> = <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="comment">// run the continuation in the new session</span>
      <span class="comment">// if there is a continuation</span>
      <a href="#380983" title="net.liftweb.common.Box[() =&gt; Nothing]">continuation</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Nothing">Full</span><span class="delimiter">(</span><a title="() =&gt; Nothing" id="396379">func</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <a href="#396379" title="()Nothing">func</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49366" title="(where: String)Nothing">redirectTo</a><span class="delimiter">(</span><span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <span class="comment">// do nothing</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="List[net.liftweb.http.LiftRules.DispatchPF]" id="396376">sessionDispatch</a> = <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49326" title="=&gt; List[net.liftweb.http.LiftRules.DispatchPF]">highLevelSessionDispatcher</a>

      <span class="keyword">val</span> <a title="net.liftweb.http.Req" id="396377">toMatch</a> = <a href="#380982" title="net.liftweb.http.Req">request</a>
      <a href="../../../../util/net/liftweb/util/NamedPartialFunction.scala.html#13548" title="object net.liftweb.util.NamedPF">NamedPF</a>.<a href="../../../../util/net/liftweb/util/NamedPartialFunction.scala.html#185585" title="(value: net.liftweb.http.Req, lst: Seq[PartialFunction[net.liftweb.http.Req,() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]]])net.liftweb.common.Box[() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]]">applyBox</a><span class="delimiter">(</span><a href="#396377" title="net.liftweb.http.Req">toMatch</a>, <a href="#396376" title="List[net.liftweb.http.LiftRules.DispatchPF]">sessionDispatch</a><span class="delimiter">)</span> <span title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">Full</span><span class="delimiter">(</span><a title="() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]" id="396400">f</a><span class="delimiter">)</span> =&gt;
          <a href="#230222" title="(state: net.liftweb.http.Req)List[Any]">runParams</a><span class="delimiter">(</span><a href="#380982" title="net.liftweb.http.Req">request</a><span class="delimiter">)</span>
          <span class="keyword">try</span> <span class="delimiter">{</span>
            <a href="#396400" title="()net.liftweb.common.Box[net.liftweb.http.LiftResponse]">f</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]" class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <span title="net.liftweb.common.Full[net.liftweb.http.LiftResponse]">Full</span><span class="delimiter">(</span><a title="net.liftweb.http.LiftResponse" id="396402">r</a><span class="delimiter">)</span> =&gt; <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.LiftResponse)net.liftweb.common.Full[net.liftweb.http.LiftResponse]">Full</a><span class="delimiter">(</span><a href="#230267" title="(resp: net.liftweb.http.LiftResponse)net.liftweb.http.LiftResponse">checkRedirect</a><span class="delimiter">(</span><a href="#396402" title="net.liftweb.http.LiftResponse">r</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">_</span> =&gt; <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158929" title="(requestState: net.liftweb.http.Req, session: net.liftweb.common.Box[net.liftweb.http.LiftSession])net.liftweb.common.Box[net.liftweb.http.LiftResponse]">notFoundOrIgnore</a><span class="delimiter">(</span><a href="#380982" title="net.liftweb.http.Req">request</a>, <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.LiftSession)net.liftweb.common.Full[net.liftweb.http.LiftSession]">Full</a><span class="delimiter">(</span><a href="#14496" title="net.liftweb.http.LiftSession" class="keyword">this</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
            <a href="#230168" title="(x$1: Seq[(net.liftweb.http.NoticeType.Value, scala.xml.NodeSeq, net.liftweb.common.Box[String])])Unit">notices</a> = <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49557" title="=&gt; List[(net.liftweb.http.NoticeType.Value, scala.xml.NodeSeq, net.liftweb.common.Box[String])]">getAllNotices</a>
          <span class="delimiter">}</span>

        <span class="keyword">case</span> <span title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">_</span> =&gt;
          <a href="#14488" title="object net.liftweb.http.RenderVersion">RenderVersion</a>.<a href="#345564" title="=&gt; String">get</a> <span class="comment">// touch this early</span>

          <a href="#230222" title="(state: net.liftweb.http.Req)List[Any]">runParams</a><span class="delimiter">(</span><a href="#380982" title="net.liftweb.http.Req">request</a><span class="delimiter">)</span>

          <span class="keyword">val</span> <a title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]" id="396411">early</a> = <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159147" title="(=&gt; _601.RulesSeq[net.liftweb.http.Req =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]] with _601.FirstBox[net.liftweb.http.Req,net.liftweb.http.LiftResponse]) forSome { val _601: net.liftweb.http.LiftRules }">preAccessControlResponse_!!</a>.<a href="LiftRules.scala.html#357156" title="(param: net.liftweb.http.Req)net.liftweb.common.Box[net.liftweb.http.LiftResponse]">firstFull</a><span class="delimiter">(</span><a href="#380982" title="net.liftweb.http.Req">request</a><span class="delimiter">)</span>

          <span class="comment">// Process but make sure we're okay, sitemap wise</span>
          <span class="keyword">val</span> <a title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]" id="396412">response</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">Box</a><span class="delimiter">[</span>LiftResponse<span class="delimiter">]</span> = <a href="#396411" title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">early</a> <a href="../../../../common/net/liftweb/common/Box.scala.html#27043" title="(alternative: =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse])net.liftweb.common.Box[net.liftweb.http.LiftResponse]">or</a> <span class="delimiter">(</span><a href="#380982" title="net.liftweb.http.Req">request</a>.<a href="Req.scala.html#149210" title="=&gt; Either[Boolean,net.liftweb.common.Box[net.liftweb.http.LiftResponse]]">testLocation</a> <span title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">Left</span><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> =&gt;
              <a href="#230251" title="(req: net.liftweb.http.Req)(f: =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse])net.liftweb.common.Box[net.liftweb.http.LiftResponse]">checkStatelessInSiteMap</a><span class="delimiter">(</span><a href="#380982" title="net.liftweb.http.Req">request</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="#230257" title="=&gt; Unit">cleanUpBeforeRender</a>

                <a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75381" title="(what: String)String">PageName</a><span class="delimiter">(</span><a href="#380982" title="net.liftweb.http.Req">request</a>.<a href="Req.scala.html#149224" title="=&gt; String">uri</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; -&gt; &quot;)" class="string">&quot; -&gt; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#380982" title="net.liftweb.http.Req">request</a>.<a href="Req.scala.html#149137" title="=&gt; net.liftweb.http.ParsePath">path</a><span class="delimiter">)</span>
                <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159032" title="=&gt; net.liftweb.http.LiftRules#FactoryMaker[Boolean]">allowParallelSnippets</a>.<a href="../../../../util/net/liftweb/util/Maker.scala.html#150914" title="(vFunc: () =&gt; Boolean)(f: =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse])net.liftweb.common.Box[net.liftweb.http.LiftResponse]">doWith</a><span class="delimiter">(</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span title="=&gt; Boolean">!</span><a href="../../../../util/net/liftweb/util/Props.scala.html#13579" title="object net.liftweb.util.Props">Props</a>.<a href="../../../../util/net/liftweb/util/Props.scala.html#151332" title="=&gt; Boolean">inGAE</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                  <span class="delimiter">(</span><a href="#380982" title="net.liftweb.http.Req">request</a>.<a href="Req.scala.html#149208" title="=&gt; net.liftweb.common.Box[net.liftweb.sitemap.Loc[_]]">location</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27023" title="(f: net.liftweb.sitemap.Loc[_] =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse])net.liftweb.common.Box[net.liftweb.http.LiftResponse]">flatMap</a><span class="delimiter">(</span><a href="#396477" title="net.liftweb.sitemap.Loc[_]">_</a>.<a href="../sitemap/Loc.scala.html#215925" title="=&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]">earlyResponse</a><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27043" title="(alternative: =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse])net.liftweb.common.Box[net.liftweb.http.LiftResponse]">or</a> <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159149" title="(=&gt; _603.RulesSeq[net.liftweb.http.Req =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]] with _603.FirstBox[net.liftweb.http.Req,net.liftweb.http.LiftResponse]) forSome { val _603: net.liftweb.http.LiftRules }">earlyResponse</a>.<a href="LiftRules.scala.html#357156" title="(param: net.liftweb.http.Req)net.liftweb.common.Box[net.liftweb.http.LiftResponse]">firstFull</a><span class="delimiter">(</span><a href="#380982" title="net.liftweb.http.Req">request</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27043" title="(alternative: =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse])net.liftweb.common.Box[net.liftweb.http.LiftResponse]">or</a>
                    <span class="delimiter">(</span><a href="#230248" title="(template: net.liftweb.common.Box[scala.xml.NodeSeq], request: net.liftweb.http.Req, path: net.liftweb.http.ParsePath, code: Int)net.liftweb.common.Box[net.liftweb.http.LiftResponse]">processTemplate</a><span class="delimiter">(</span><a href="#230246" title="=&gt; net.liftweb.common.Box[scala.xml.NodeSeq]">locTemplate</a>, <a href="#380982" title="net.liftweb.http.Req">request</a>, <a href="#380982" title="net.liftweb.http.Req">request</a>.<a href="Req.scala.html#149137" title="=&gt; net.liftweb.http.ParsePath">path</a>, <span title="Int(200)" class="int">200</span><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27043" title="(alternative: =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse])net.liftweb.common.Box[net.liftweb.http.LiftResponse]">or</a>
                      <a href="#380982" title="net.liftweb.http.Req">request</a>.<a href="Req.scala.html#149219" title="(f: net.liftweb.http.ParsePath =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse])net.liftweb.common.Box[net.liftweb.http.LiftResponse]">createNotFound</a> <span class="delimiter">{</span>
                        <a href="#230248" title="(template: net.liftweb.common.Box[scala.xml.NodeSeq], request: net.liftweb.http.Req, path: net.liftweb.http.ParsePath, code: Int)net.liftweb.common.Box[net.liftweb.http.LiftResponse]">processTemplate</a><span class="delimiter">(</span><a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a>, <a href="#380982" title="net.liftweb.http.Req">request</a>, <a href="#396507" title="net.liftweb.http.ParsePath">_</a>, <span title="Int(404)" class="int">404</span><span class="delimiter">)</span>
                      <span class="delimiter">}</span><span class="delimiter">)</span>
                <span class="delimiter">}</span>
              <span class="delimiter">}</span>

            <span class="keyword">case</span> <span title="net.liftweb.common.Full[net.liftweb.http.LiftResponse]">Right</span><span class="delimiter">(</span>Full<span class="delimiter">(</span><a title="net.liftweb.http.LiftResponse" id="396516">resp</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.LiftResponse)net.liftweb.common.Full[net.liftweb.http.LiftResponse]">Full</a><span class="delimiter">(</span><a href="#396516" title="net.liftweb.http.LiftResponse">resp</a><span class="delimiter">)</span>
            <span class="keyword">case</span> <span title="net.liftweb.common.Empty.type">_</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158914" title="=&gt; Boolean">passNotFoundToChain</a><span class="delimiter">)</span> =&gt; <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a>
            <span class="keyword">case</span> <span title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">_</span> <span class="keyword">if</span> <a href="../../../../util/net/liftweb/util/Props.scala.html#13579" title="object net.liftweb.util.Props">Props</a>.<a href="../../../../util/net/liftweb/util/Props.scala.html#151315" title="=&gt; net.liftweb.util.Props.RunModes.Value">mode</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../../util/net/liftweb/util/Props.scala.html#13579" title="object net.liftweb.util.Props">Props</a>.<a href="../../../../util/net/liftweb/util/Props.scala.html#151308" title="object net.liftweb.util.Props.RunModes">RunModes</a>.<a href="../../../../util/net/liftweb/util/Props.scala.html#151346" title="=&gt; net.liftweb.util.Props.RunModes.Value">Development</a> =&gt;
              <a href="#380982" title="net.liftweb.http.Req">request</a>.<a href="Req.scala.html#149219" title="(f: net.liftweb.http.ParsePath =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse])net.liftweb.common.Box[net.liftweb.http.LiftResponse]">createNotFound</a> <span class="delimiter">{</span>
                <a href="#230248" title="(template: net.liftweb.common.Box[scala.xml.NodeSeq], request: net.liftweb.http.Req, path: net.liftweb.http.ParsePath, code: Int)net.liftweb.common.Box[net.liftweb.http.LiftResponse]">processTemplate</a><span class="delimiter">(</span><a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a>, <a href="#380982" title="net.liftweb.http.Req">request</a>, <a href="#396531" title="net.liftweb.http.ParsePath">_</a>, <span title="Int(404)" class="int">404</span><span class="delimiter">)</span>
              <span class="delimiter">}</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27043" title="(alternative: =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse])net.liftweb.common.Box[net.liftweb.http.LiftResponse]">or</a>
                <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.ForbiddenResponse)net.liftweb.common.Full[net.liftweb.http.ForbiddenResponse]">Full</a><span class="delimiter">(</span><a href="LiftResponse.scala.html#352331" title="(message: String)net.liftweb.http.ForbiddenResponse">ForbiddenResponse</a><span class="delimiter">(</span><span title="java.lang.String(&quot;The requested page was not defined in your SiteMap, so access was blocked.  (This message is displayed in development mode only)&quot;)" class="string">&quot;The requested page was not defined in your SiteMap, so access was blocked.  (This message is displayed in development mode only)&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <span title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">_</span> =&gt; <a href="#380982" title="net.liftweb.http.Req">request</a>.<a href="Req.scala.html#149219" title="(f: net.liftweb.http.ParsePath =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse])net.liftweb.common.Box[net.liftweb.http.LiftResponse]">createNotFound</a> <span class="delimiter">{</span>
              <a href="#230248" title="(template: net.liftweb.common.Box[scala.xml.NodeSeq], request: net.liftweb.http.Req, path: net.liftweb.http.ParsePath, code: Int)net.liftweb.common.Box[net.liftweb.http.LiftResponse]">processTemplate</a><span class="delimiter">(</span><a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a>, <a href="#380982" title="net.liftweb.http.Req">request</a>, <a href="#396547" title="net.liftweb.http.ParsePath">_</a>, <span title="Int(404)" class="int">404</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span><span class="delimiter">)</span>

          <span class="comment">// Before returning the response check for redirect and set the appropriate state.</span>
          <a href="#396412" title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">response</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: net.liftweb.http.LiftResponse =&gt; net.liftweb.http.LiftResponse)net.liftweb.common.Box[net.liftweb.http.LiftResponse]">map</a><span class="delimiter">(</span><a href="#230267" title="(resp: net.liftweb.http.LiftResponse)net.liftweb.http.LiftResponse">checkRedirect</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="ResponseShortcutException.scala.html#380735" title="Nothing">ContinueResponseException</a><span class="delimiter">(</span><a title="net.liftweb.http.ContinueResponseException" id="396556">cre</a><span class="delimiter">)</span> =&gt; <span title="Nothing" class="keyword">throw</span> <a href="#396556" title="net.liftweb.http.ContinueResponseException">cre</a>

      <span class="keyword">case</span> <a title="net.liftweb.common.Full[net.liftweb.http.LiftResponse]" id="396557">ite</a>: java.lang.reflect.<span title="java.lang.reflect.InvocationTargetException">InvocationTargetException</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#396557" title="java.lang.reflect.InvocationTargetException">ite</a>.<span title="()java.lang.Throwable">getCause</span>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="ResponseShortcutException.scala.html#14623" title="net.liftweb.http.ResponseShortcutException">ResponseShortcutException</a><span class="delimiter">]</span><span class="delimiter">)</span> =&gt;
        <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.LiftResponse)net.liftweb.common.Full[net.liftweb.http.LiftResponse]">Full</a><span class="delimiter">(</span><a href="#230258" title="(re: net.liftweb.http.ResponseShortcutException, request: net.liftweb.http.Req)net.liftweb.http.LiftResponse">handleRedirect</a><span class="delimiter">(</span><a href="#396557" title="java.lang.reflect.InvocationTargetException">ite</a>.<span title="()java.lang.Throwable">getCause</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="net.liftweb.http.ResponseShortcutException" class="delimiter">[</span><a href="ResponseShortcutException.scala.html#14623" title="net.liftweb.http.ResponseShortcutException">ResponseShortcutException</a><span class="delimiter">]</span>, <a href="#380982" title="net.liftweb.http.Req">request</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">case</span> <a title="net.liftweb.common.Full[net.liftweb.http.LiftResponse]" id="396561">rd</a>: net.liftweb.http.<a href="ResponseShortcutException.scala.html#14623" title="net.liftweb.http.ResponseShortcutException">ResponseShortcutException</a> =&gt; <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.LiftResponse)net.liftweb.common.Full[net.liftweb.http.LiftResponse]">Full</a><span class="delimiter">(</span><a href="#230258" title="(re: net.liftweb.http.ResponseShortcutException, request: net.liftweb.http.Req)net.liftweb.http.LiftResponse">handleRedirect</a><span class="delimiter">(</span><a href="#396561" title="net.liftweb.http.ResponseShortcutException">rd</a>, <a href="#380982" title="net.liftweb.http.Req">request</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">case</span> <a title="Nothing" id="396565">e</a>: <a href="../../../../util/net/liftweb/util/Helpers.scala.html#13350" title="net.liftweb.util.LiftFlowOfControlException">LiftFlowOfControlException</a> =&gt; <span title="Nothing" class="keyword">throw</span> <a href="#396565" title="net.liftweb.util.LiftFlowOfControlException">e</a>

      <span class="keyword">case</span> <a title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]" id="396566">e</a> =&gt; <a href="../../../../util/net/liftweb/util/NamedPartialFunction.scala.html#13548" title="object net.liftweb.util.NamedPF">NamedPF</a>.<a href="../../../../util/net/liftweb/util/NamedPartialFunction.scala.html#185585" title="(value: (net.liftweb.util.Props.RunModes.Value, net.liftweb.http.Req, java.lang.Throwable), lst: Seq[PartialFunction[(net.liftweb.util.Props.RunModes.Value, net.liftweb.http.Req, java.lang.Throwable),net.liftweb.http.LiftResponse]])net.liftweb.common.Box[net.liftweb.http.LiftResponse]">applyBox</a><span class="delimiter">(</span><span title="(_1: net.liftweb.util.Props.RunModes.Value, _2: net.liftweb.http.Req, _3: java.lang.Throwable)(net.liftweb.util.Props.RunModes.Value, net.liftweb.http.Req, java.lang.Throwable)" class="delimiter">(</span><a href="../../../../util/net/liftweb/util/Props.scala.html#13579" title="object net.liftweb.util.Props">Props</a>.<a href="../../../../util/net/liftweb/util/Props.scala.html#151315" title="=&gt; net.liftweb.util.Props.RunModes.Value">mode</a>, <a href="#380982" title="net.liftweb.http.Req">request</a>, <a href="#396566" title="java.lang.Throwable">e</a><span class="delimiter">)</span>, <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159134" title="=&gt; net.liftweb.http.LiftRules#RulesSeq[PartialFunction[(net.liftweb.util.Props.RunModes.Value, net.liftweb.http.Req, java.lang.Throwable),net.liftweb.http.LiftResponse]]">exceptionHandler</a>.<a href="LiftRules.scala.html#185552" title="=&gt; List[PartialFunction[(net.liftweb.util.Props.RunModes.Value, net.liftweb.http.Req, java.lang.Throwable),net.liftweb.http.LiftResponse]]">toList</a><span class="delimiter">)</span>;

    <span class="delimiter">}</span>

    <a href="#14470" title="object net.liftweb.http.LiftSession">LiftSession</a>.<a href="#326789" title="=&gt; List[(net.liftweb.http.LiftSession, net.liftweb.http.Req, net.liftweb.common.Box[net.liftweb.http.LiftResponse]) =&gt; Unit]">onEndServicing</a>.<span title="(f: (net.liftweb.http.LiftSession, net.liftweb.http.Req, net.liftweb.common.Box[net.liftweb.http.LiftResponse]) =&gt; Unit =&gt; net.liftweb.common.Box[Unit])Unit">foreach</span><span class="delimiter">(</span><a title="(net.liftweb.http.LiftSession, net.liftweb.http.Req, net.liftweb.common.Box[net.liftweb.http.LiftResponse]) =&gt; Unit" id="396614">f</a> =&gt; <a href="../../../../util/net/liftweb/util/ControlHelpers.scala.html#48608" title="(f: =&gt; Unit)net.liftweb.common.Box[Unit]">tryo</a><span class="delimiter">(</span><a href="#396614" title="(v1: net.liftweb.http.LiftSession, v2: net.liftweb.http.Req, v3: net.liftweb.common.Box[net.liftweb.http.LiftResponse])Unit">f</a><span class="delimiter">(</span><a href="#14496" title="net.liftweb.http.LiftSession" class="keyword">this</a>, <a href="#380982" title="net.liftweb.http.Req">request</a>, <a href="#396309" title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">ret</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#396309" title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">ret</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Merge all the head elements into the main head element and move tail stuff to the end of the
   * page.
   */</span>
  <span class="keyword">def</span> <a title="(in: scala.xml.NodeSeq, req: net.liftweb.http.Req)scala.xml.Node" id="230256">performHeadMerge</a><span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="396658">in</a>: <span title="scala.xml.NodeSeq">NodeSeq</span>, <a title="net.liftweb.http.Req" id="396659">req</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a><span class="delimiter">)</span>: <span title="scala.xml.Node">Node</span> = <a href="LiftMerge.scala.html#230138" title="(xhtml: scala.xml.NodeSeq, req: net.liftweb.http.Req)scala.xml.Node">merge</a><span class="delimiter">(</span><a href="#396658" title="scala.xml.NodeSeq">in</a>, <a href="#396659" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; Unit" id="230257">cleanUpBeforeRender</a> <span class="delimiter">{</span>
    <span class="comment">// Reset the mapping between ID and Style for Ajax notices.</span>
    <a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75381" title="(what: scala.collection.mutable.HashMap[String,String])scala.collection.mutable.HashMap[String,String]">MsgErrorMeta</a><span class="delimiter">(</span><span title="()scala.collection.mutable.HashMap[String,String]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[String,String]">HashMap</span><span class="delimiter">)</span>
    <a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75381" title="(what: scala.collection.mutable.HashMap[String,String])scala.collection.mutable.HashMap[String,String]">MsgWarningMeta</a><span class="delimiter">(</span><span title="()scala.collection.mutable.HashMap[String,String]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[String,String]">HashMap</span><span class="delimiter">)</span>
    <a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75381" title="(what: scala.collection.mutable.HashMap[String,String])scala.collection.mutable.HashMap[String,String]">MsgNoticeMeta</a><span title="Unit" class="delimiter">(</span><span title="()scala.collection.mutable.HashMap[String,String]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[String,String]">HashMap</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(re: net.liftweb.http.ResponseShortcutException, request: net.liftweb.http.Req)net.liftweb.http.LiftResponse" id="230258">handleRedirect</a><span class="delimiter">(</span><a title="net.liftweb.http.ResponseShortcutException" id="380762">re</a>: <a href="ResponseShortcutException.scala.html#14623" title="net.liftweb.http.ResponseShortcutException">ResponseShortcutException</a>, <a title="net.liftweb.http.Req" id="380763">request</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a><span class="delimiter">)</span>: <a href="LiftResponse.scala.html#14269" title="net.liftweb.http.LiftResponse">LiftResponse</a> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#380762" title="net.liftweb.http.ResponseShortcutException">re</a>.<a href="ResponseShortcutException.scala.html#380748" title="=&gt; Boolean">doNotices</a><span class="delimiter">)</span> <a href="#230168" title="(x$1: Seq[(net.liftweb.http.NoticeType.Value, scala.xml.NodeSeq, net.liftweb.common.Box[String])])Unit">notices</a> = <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49557" title="=&gt; List[(net.liftweb.http.NoticeType.Value, scala.xml.NodeSeq, net.liftweb.common.Box[String])]">getAllNotices</a>

    <a href="#380762" title="net.liftweb.http.ResponseShortcutException">re</a>.<a href="ResponseShortcutException.scala.html#380751" title="=&gt; net.liftweb.http.LiftResponse">response</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Set a session-local variable to a value
   *
   * @param name -- the name of the variable
   * @param value -- the value of the variable
   */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>liftweb<span class="delimiter">]</span> <span class="keyword">def</span> <a title="[T](name: String, value: T)Unit" id="230259">set</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="230261">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="String" id="396673">name</a>: <span title="String">String</span>, <a title="T" id="396674">value</a>: <a href="#230261" title="T">T</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#230182" title="=&gt; java.lang.Object">sessionVarSync</a>.<span title="(x$1: Unit)Unit">synchronized</span> <span class="delimiter">{</span>
    <a href="#230177" title="(x$1: Map[String,Any])Unit">myVariables</a> = <a href="#230177" title="=&gt; Map[String,Any]">myVariables</a> <span title="(kv: (String, Any))scala.collection.immutable.Map[String,Any]">+</span> <span class="delimiter">(</span><a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#49003" title="implicit net.liftweb.util.BindHelpers.strToSuperArrowAssoc : (in: String)net.liftweb.util.Helpers.SuperArrowAssoc">name</a> <a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#58395" title="(in: T)(String, T)">-&gt;</a> <a href="#396674" title="T">value</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Gets the named variable if it exists
   *
   * @param name -- the name of the session-local variable to get
   *
   * @return Full ( value ) if found, Empty otherwise
   */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>liftweb<span class="delimiter">]</span> <span class="keyword">def</span> <a title="[T](name: String)net.liftweb.common.Box[T]" id="230262">get</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="230264">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="String" id="396785">name</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[T]">Box</a><span class="delimiter">[</span>T<span class="delimiter">]</span> = <a href="#230182" title="=&gt; java.lang.Object">sessionVarSync</a>.<span title="(x$1: net.liftweb.common.Box[T])net.liftweb.common.Box[T]">synchronized</span> <span class="delimiter">{</span>
    <a href="../../../../common/net/liftweb/common/Box.scala.html#28602" title="(in: Option[Any])net.liftweb.common.Box[Any] with Serializable">Box</a><span class="delimiter">(</span><a href="#230177" title="=&gt; Map[String,Any]">myVariables</a>.<span title="(key: String)Option[Any]">get</span><span class="delimiter">(</span><a href="#396785" title="String">name</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="net.liftweb.common.Box[T]" class="delimiter">[</span><a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[T]">Box</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Unset the named variable
   *
   * @param name the variable to unset
   */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>liftweb<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(name: String)Unit" id="230265">unset</a><span class="delimiter">(</span><a title="String" id="396909">name</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#230182" title="=&gt; java.lang.Object">sessionVarSync</a>.<span title="(x$1: Unit)Unit">synchronized</span> <span class="delimiter">{</span>
    <a href="#230177" title="(x$1: Map[String,Any])Unit">myVariables</a> <span title="(key: String)scala.collection.immutable.Map[String,Any]">-=</span> <a href="#396909" title="String">name</a>
  <span class="delimiter">}</span>


  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(uri: String, f: net.liftweb.common.Box[() =&gt; Unit])String" id="230266">attachRedirectFunc</a><span class="delimiter">(</span><a title="String" id="396929">uri</a>: <span title="String">String</span>, <a title="net.liftweb.common.Box[() =&gt; Unit]" id="396930">f</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[() =&gt; Unit]">Box</a><span class="delimiter">[</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Unit<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#396930" title="net.liftweb.common.Box[() =&gt; Unit]">f</a> <a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: () =&gt; Unit =&gt; String)net.liftweb.common.Box[String]">map</a> <span class="delimiter">{</span>
      <a title="() =&gt; Unit" id="396937">fnc</a> =&gt;
        <span class="keyword">val</span> <a title="String" id="396938">func</a>: <span title="String">String</span> = <a href="#14496" title="LiftSession.this.type">LiftSession</a>.<span class="keyword">this</span>.<span title="(x$1: String)String">synchronized</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="String" id="396941">funcName</a> = <a href="../../../../util/net/liftweb/util/Helpers.scala.html#13346" title="object net.liftweb.util.Helpers">Helpers</a>.<a href="../../../../util/net/liftweb/util/HttpHelpers.scala.html#49067" title="=&gt; String">nextFuncName</a>
          <a href="#230165" title="(key: String, value: net.liftweb.http.S.AFuncHolder)Unit">messageCallback</a><span class="delimiter">(</span><a href="#396941" title="String">funcName</a><span class="delimiter">)</span> = <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#396952" title="(func: () =&gt; Any)net.liftweb.http.S.AFuncHolder">NFuncHolder</a><span class="delimiter">(</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
            <a href="#396937" title="()Unit">fnc</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="delimiter">}</span><span class="delimiter">)</span>
          <a href="#396941" title="String">funcName</a>
        <span class="delimiter">}</span>
        <a href="../../../../util/net/liftweb/util/Helpers.scala.html#13346" title="object net.liftweb.util.Helpers">Helpers</a>.<a href="../../../../util/net/liftweb/util/HttpHelpers.scala.html#49057" title="(url: String, funcStr: String)String">appendFuncToURL</a><span class="delimiter">(</span><a href="#396929" title="String">uri</a>, <a href="#396938" title="String">func</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;=_&quot;)" class="string">&quot;=_&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; String)String">openOr</a> <a href="#396929" title="String">uri</a>

  <span class="delimiter">}</span>

  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(resp: net.liftweb.http.LiftResponse)net.liftweb.http.LiftResponse" id="230267">checkRedirect</a><span class="delimiter">(</span><a title="net.liftweb.http.LiftResponse" id="359117">resp</a>: <a href="LiftResponse.scala.html#14269" title="net.liftweb.http.LiftResponse">LiftResponse</a><span class="delimiter">)</span>: <a href="LiftResponse.scala.html#14269" title="net.liftweb.http.LiftResponse">LiftResponse</a> = <a href="#359117" title="net.liftweb.http.LiftResponse">resp</a> <span title="net.liftweb.http.LiftResponse" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a href="LiftResponse.scala.html#228039" title="net.liftweb.http.RedirectResponse">RedirectWithState</a><span class="delimiter">(</span><a title="String" id="396974">uri</a>, <a title="net.liftweb.http.RedirectState" id="396975">state</a>, <a title="Seq[net.liftweb.http.provider.HTTPCookie]" id="396976">cookies</a><span class="delimiter">)</span> =&gt;
      <a href="#396975" title="net.liftweb.http.RedirectState">state</a>.<a href="LiftResponse.scala.html#228059" title="=&gt; (String, net.liftweb.http.NoticeType.Value)*">msgs</a>.<span title="(f: (String, net.liftweb.http.NoticeType.Value) =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="(String, net.liftweb.http.NoticeType.Value)" id="396993">m</a> =&gt; <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49553" title="(msg: String, notice: net.liftweb.http.NoticeType.Value)Unit">message</a><span class="delimiter">(</span><a href="#396993" title="(String, net.liftweb.http.NoticeType.Value)">m</a>.<span title="=&gt; String">_1</span>, <a href="#396993" title="(String, net.liftweb.http.NoticeType.Value)">m</a>.<span title="=&gt; net.liftweb.http.NoticeType.Value">_2</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#230168" title="(x$1: Seq[(net.liftweb.http.NoticeType.Value, scala.xml.NodeSeq, net.liftweb.common.Box[String])])Unit">notices</a> = <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49557" title="=&gt; List[(net.liftweb.http.NoticeType.Value, scala.xml.NodeSeq, net.liftweb.common.Box[String])]">getAllNotices</a>
      <a href="LiftResponse.scala.html#354296" title="(uri: String, cookies: net.liftweb.http.provider.HTTPCookie*)net.liftweb.http.RedirectResponse">RedirectResponse</a><span class="delimiter">(</span><a href="#230266" title="(uri: String, f: net.liftweb.common.Box[() =&gt; Unit])String">attachRedirectFunc</a><span class="delimiter">(</span><a href="#396974" title="String">uri</a>, <a href="#396975" title="net.liftweb.http.RedirectState">state</a>.<a href="LiftResponse.scala.html#228057" title="=&gt; net.liftweb.common.Box[() =&gt; Unit]">func</a><span class="delimiter">)</span>, <a href="#396976" title="Seq[net.liftweb.http.provider.HTTPCookie]">cookies</a>: _*<span class="delimiter">)</span>
    <span class="keyword">case</span> <span title="net.liftweb.http.LiftResponse">_</span> =&gt; <a href="#359117" title="net.liftweb.http.LiftResponse">resp</a>
  <span class="delimiter">}</span>


  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(in: scala.xml.NodeSeq, f: scala.xml.Elem =&gt; Boolean)List[scala.xml.Elem]" id="230268">allElems</a><span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="397013">in</a>: <span title="scala.xml.NodeSeq">NodeSeq</span>, <a title="scala.xml.Elem =&gt; Boolean" id="397014">f</a>: Elem =&gt; Boolean<span class="delimiter">)</span>: <span title="List[scala.xml.Elem]">List</span><span class="delimiter">[</span>Elem<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ListBuffer[scala.xml.Elem]" id="397016">lb</a> = <span title="scala.collection.mutable.ListBuffer[scala.xml.Elem]" class="keyword">new</span> <span title="scala.collection.mutable.ListBuffer[scala.xml.Elem]">ListBuffer</span><span class="delimiter">[</span>Elem<span class="delimiter">]</span>

    <span class="keyword">def</span> <a title="(in: scala.xml.NodeSeq, lb: scala.collection.mutable.ListBuffer[scala.xml.Elem])Unit" id="397017">appendAll</a><span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="397018">in</a>: <span title="scala.xml.NodeSeq">NodeSeq</span>, <a title="scala.collection.mutable.ListBuffer[scala.xml.Elem]" id="397019">lb</a>: <span title="scala.collection.mutable.ListBuffer[scala.xml.Elem]">ListBuffer</span><span class="delimiter">[</span>Elem<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#397018" title="scala.xml.NodeSeq">in</a>.<span title="(f: scala.xml.Node =&gt; Unit)Unit">foreach</span> <a href="#397036" title="Unit" class="delimiter">{</a>
        <span class="keyword">case</span> <span title="Unit">Group</span><span class="delimiter">(</span><a title="Seq[scala.xml.Node]" id="397037">ns</a><span class="delimiter">)</span> =&gt; <a href="#397017" title="(in: scala.xml.NodeSeq, lb: scala.collection.mutable.ListBuffer[scala.xml.Elem])Unit">appendAll</a><span class="delimiter">(</span><a href="#397037" title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">ns</a>, <a href="#397019" title="scala.collection.mutable.ListBuffer[scala.xml.Elem]">lb</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="Unit" id="397040">e</a>: <span title="scala.xml.Elem">Elem</span> <span class="keyword">if</span> <a href="#397014" title="(v1: scala.xml.Elem)Boolean">f</a><span class="delimiter">(</span><a href="#397040" title="scala.xml.Elem">e</a><span class="delimiter">)</span> =&gt; <a href="#397019" title="scala.collection.mutable.ListBuffer[scala.xml.Elem]">lb</a> <span title="(x: scala.xml.Elem)lb.type">+=</span> <a href="#397040" title="scala.xml.Elem">e</a>; <a href="#397017" title="(in: scala.xml.NodeSeq, lb: scala.collection.mutable.ListBuffer[scala.xml.Elem])Unit">appendAll</a><span class="delimiter">(</span><a href="#397040" title="scala.xml.Elem">e</a>.<span title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">child</span>, <a href="#397019" title="scala.collection.mutable.ListBuffer[scala.xml.Elem]">lb</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="Unit" id="397053">e</a>: <span title="scala.xml.Elem">Elem</span> =&gt; <a href="#397017" title="(in: scala.xml.NodeSeq, lb: scala.collection.mutable.ListBuffer[scala.xml.Elem])Unit">appendAll</a><span class="delimiter">(</span><a href="#397053" title="scala.xml.Elem">e</a>.<span title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">child</span>, <a href="#397019" title="scala.collection.mutable.ListBuffer[scala.xml.Elem]">lb</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <a href="#397017" title="(in: scala.xml.NodeSeq, lb: scala.collection.mutable.ListBuffer[scala.xml.Elem])Unit">appendAll</a><span class="delimiter">(</span><a href="#397013" title="scala.xml.NodeSeq">in</a>, <a href="#397016" title="scala.collection.mutable.ListBuffer[scala.xml.Elem]">lb</a><span class="delimiter">)</span>

    <a href="#397016" title="scala.collection.mutable.ListBuffer[scala.xml.Elem]">lb</a>.<span title="=&gt; List[scala.xml.Elem]">toList</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(path: net.liftweb.http.ParsePath, session: net.liftweb.http.Req)net.liftweb.common.Box[scala.xml.NodeSeq]" id="230269">findVisibleTemplate</a><span class="delimiter">(</span><a title="net.liftweb.http.ParsePath" id="396235">path</a>: <a href="Req.scala.html#14577" title="net.liftweb.http.ParsePath">ParsePath</a>, <a title="net.liftweb.http.Req" id="396236">session</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[scala.xml.NodeSeq]">Box</a><span class="delimiter">[</span>NodeSeq<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="List[String]" id="397057">tpath</a> = <a href="#396235" title="net.liftweb.http.ParsePath">path</a>.<a href="Req.scala.html#216847" title="=&gt; List[String]">partPath</a>
    <span class="keyword">val</span> <a title="List[String]" id="397058">splits</a> = <a href="#397057" title="List[String]">tpath</a>.<span title="=&gt; List[String]">toList</span>.<span title="(p: String =&gt; Boolean)List[String]">filter</span> <span class="delimiter">{</span>
      <a title="String" id="397064">a</a> =&gt; <span title="=&gt; Boolean">!</span><a href="#397064" title="String">a</a>.<span title="(x$1: java.lang.String)Boolean">startsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;_&quot;)" class="string">&quot;_&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#397064" title="String">a</a>.<span title="(x$1: java.lang.String)Boolean">startsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;.&quot;)" class="string">&quot;.&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#397064" title="String">a</a>.<span title="()java.lang.String">toLowerCase</span>.<span title="(x$1: java.lang.String)Int">indexOf</span><span class="delimiter">(</span><span title="java.lang.String(&quot;-hidden&quot;)" class="string">&quot;-hidden&quot;</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">==</span> -<span title="Int(-1)" class="int">1</span>
    <span class="delimiter">}</span> <span title="List[String]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="List[String]" id="397080">s</a>@_ <span class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#397080" title="List[String]">s</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> =&gt; <a href="#397080" title="List[String]">s</a>
      <span class="keyword">case</span> <span title="List[java.lang.String]">_</span> =&gt; <span title="(xs: java.lang.String*)List[java.lang.String]">List</span><span class="delimiter">(</span><span title="java.lang.String(&quot;index&quot;)" class="string">&quot;index&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="Templates.scala.html#342663" title="(places: List[String], locale: java.util.Locale)net.liftweb.common.Box[scala.xml.NodeSeq]">Templates</a><span class="delimiter">(</span><a href="#397058" title="List[String]">splits</a>, <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49322" title="=&gt; java.util.Locale">locale</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span><span class="delimiter">[</span>liftweb<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(name: String)net.liftweb.common.Box[scala.xml.NodeSeq]" id="230270">findTemplate</a><span class="delimiter">(</span><a title="String" id="326753">name</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[scala.xml.NodeSeq]">Box</a><span class="delimiter">[</span>NodeSeq<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="List[java.lang.String]" id="397094">splits</a> = <span class="delimiter">(</span><span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#326753" title="String">name</a>.<span title="(x$1: java.lang.String)Boolean">startsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#326753" title="String">name</a> <span class="keyword">else</span> <span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#326753" title="String">name</a><span class="delimiter">)</span>.<span title="(x$1: java.lang.String)Array[java.lang.String]">split</span><span title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">(</span><span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span class="delimiter">)</span>.<span title="=&gt; List[java.lang.String]">toList</span>.<span title="(n: Int)List[java.lang.String]">drop</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span title="List[java.lang.String]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="List[java.lang.String]">Nil</span> =&gt; <span title="(xs: java.lang.String*)List[java.lang.String]">List</span><span class="delimiter">(</span><span title="java.lang.String(&quot;index&quot;)" class="string">&quot;index&quot;</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="List[java.lang.String]" id="397210">s</a> =&gt; <a href="#397210" title="List[java.lang.String]">s</a>
    <span class="delimiter">}</span>

    <a href="Templates.scala.html#342663" title="(places: List[String], locale: java.util.Locale)net.liftweb.common.Box[scala.xml.NodeSeq]">Templates</a><span class="delimiter">(</span><span title="java.lang.String(&quot;templates-hidden&quot;)" class="string">&quot;templates-hidden&quot;</span> <a href="#397217" title="(x: java.lang.String)List[java.lang.String]">::</a> <a href="#397094" title="List[java.lang.String]">splits</a>, <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49322" title="=&gt; java.util.Locale">locale</a><span class="delimiter">)</span> <span title="net.liftweb.common.Box[scala.xml.NodeSeq]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="net.liftweb.common.Full[scala.xml.NodeSeq]">Full</span><span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="397224">x</a><span class="delimiter">)</span> =&gt; <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: scala.xml.NodeSeq)net.liftweb.common.Full[scala.xml.NodeSeq]">Full</a><span class="delimiter">(</span><a href="#397224" title="scala.xml.NodeSeq">x</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="net.liftweb.common.Failure" id="397228">f</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10586" title="net.liftweb.common.Failure">Failure</a> <span class="keyword">if</span> <a href="../../../../util/net/liftweb/util/Props.scala.html#13579" title="object net.liftweb.util.Props">Props</a>.<a href="../../../../util/net/liftweb/util/Props.scala.html#151319" title="=&gt; Boolean">devMode</a> =&gt; <a href="#397228" title="net.liftweb.common.Failure">f</a>
      <span class="keyword">case</span> <span title="net.liftweb.common.Box[scala.xml.NodeSeq]">_</span> =&gt; <a href="Templates.scala.html#342663" title="(places: List[String], locale: java.util.Locale)net.liftweb.common.Box[scala.xml.NodeSeq]">Templates</a><span class="delimiter">(</span><a href="#397094" title="List[java.lang.String]">splits</a>, <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49322" title="=&gt; java.util.Locale">locale</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/*
   * Given a Snippet name, try to determine the fully-qualified Class
   * so that we can instantiate it via reflection.
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(name: String)net.liftweb.common.Box[Class[AnyRef]]" id="230271">findSnippetClass</a><span class="delimiter">(</span><a title="String" id="397235">name</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[Class[AnyRef]]">Box</a><span class="delimiter">[</span>Class<span class="delimiter">[</span>AnyRef<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span title="net.liftweb.common.Box[Class[AnyRef]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#397235" title="String">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="comment">// Name might contain some relative packages, so split them out and put them in the proper argument of findClass</span>
      <span class="keyword">val</span> <a href="#397242" title="(java.lang.String, String)" class="delimiter">(</a><a href="#397241" title="java.lang.String" id="397242">packageSuffix</a>, <a href="#397241" title="String" id="397243">terminal</a><span class="delimiter">)</span> = <a href="#397235" title="String">name</a>.<span title="(x$1: Int)Int">lastIndexOf</span><span class="delimiter">(</span><span title="Int(46)" class="char">'.'</span><span class="delimiter">)</span> <span title="(java.lang.String, String)" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="(java.lang.String, String)">-</span><span class="int">1</span> =&gt; <span title="(_1: java.lang.String, _2: String)(java.lang.String, String)" class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <a href="#397235" title="String">name</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="(java.lang.String, java.lang.String)" id="397254">i</a> =&gt; <span title="(_1: java.lang.String, _2: java.lang.String)(java.lang.String, java.lang.String)" class="delimiter">(</span><span title="java.lang.String(&quot;.&quot;)" class="string">&quot;.&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#397235" title="String">name</a>.<span title="(x$1: Int, x$2: Int)java.lang.String">substring</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#397254" title="Int">i</a><span class="delimiter">)</span>, <a href="#397235" title="String">name</a>.<span title="(x$1: Int)java.lang.String">substring</span><span class="delimiter">(</span><a href="#397254" title="Int">i</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="../../../../util/net/liftweb/util/ClassHelpers.scala.html#48564" title="(name: String, where: List[String])net.liftweb.common.Box[Class[AnyRef]]">findClass</a><span class="delimiter">(</span><a href="#397243" title="String">terminal</a>, <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159077" title="(end: String)List[java.lang.String]">buildPackage</a><span class="delimiter">(</span><span title="java.lang.String(&quot;snippet&quot;)" class="string">&quot;snippet&quot;</span><span class="delimiter">)</span>.<span title="(f: java.lang.String =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[List[java.lang.String],java.lang.String,List[java.lang.String]])List[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,java.lang.String,List[java.lang.String]]" class="delimiter">(</span><a href="#397314" title="java.lang.String">_</a> <span title="(x$1: Any)java.lang.String">+</span> <a href="#397242" title="java.lang.String">packageSuffix</a><span class="delimiter">)</span> <a href="#397290" title="(prefix: List[java.lang.String])List[java.lang.String]">:::</a>
        <span class="delimiter">(</span><span class="delimiter">(</span><span title="java.lang.String(&quot;lift.app.snippet&quot;)" class="string">&quot;lift.app.snippet&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#397242" title="java.lang.String">packageSuffix</a><span class="delimiter">)</span> <a href="#397342" title="(x: java.lang.String)List[java.lang.String]">::</a> <span class="delimiter">(</span><span title="java.lang.String(&quot;net.liftweb.builtin.snippet&quot;)" class="string">&quot;net.liftweb.builtin.snippet&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#397242" title="java.lang.String">packageSuffix</a><span class="delimiter">)</span> <a href="#397343" title="(x: java.lang.String)List[java.lang.String]">::</a> <span title="object Nil">Nil</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="[T](c: Class[T])net.liftweb.common.Box[T]" id="230272">instantiateOrRedirect</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="230274">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="Class[T]" id="397361">c</a>: <span title="Class[T]">Class</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[T]">Box</a><span class="delimiter">[</span>T<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#14470" title="object net.liftweb.http.LiftSession">LiftSession</a>.<a href="#326794" title="(session: net.liftweb.http.LiftSession, pp: net.liftweb.common.Box[net.liftweb.http.ParamPair], clz: Class[T])net.liftweb.common.Box[T]">constructFrom</a><span class="delimiter">(</span><a href="#14496" title="net.liftweb.http.LiftSession" class="keyword">this</a>,
        <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49312" title="=&gt; net.liftweb.common.Box[net.liftweb.sitemap.Loc[_]]">location</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27023" title="(f: net.liftweb.sitemap.Loc[_] =&gt; net.liftweb.common.Box[net.liftweb.http.ParamPair])net.liftweb.common.Box[net.liftweb.http.ParamPair]">flatMap</a><span class="delimiter">(</span><a href="#397372" title="net.liftweb.sitemap.Loc[_]">_</a>.
          <a href="../sitemap/Loc.scala.html#215889" title="=&gt; net.liftweb.common.Box[Any]">currentValue</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: Any =&gt; net.liftweb.http.ParamPair)net.liftweb.common.Box[net.liftweb.http.ParamPair]">map</a><span class="delimiter">(</span><a title="Any" id="397379">v</a> =&gt;
          <a href="Templates.scala.html#387361" title="(v: Any, clz: Class[_])net.liftweb.http.ParamPair">ParamPair</a><span class="delimiter">(</span><a href="#397379" title="Any">v</a>, <a href="#397379" title="Any">v</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="java.lang.Object" class="delimiter">[</span><span title="java.lang.Object">Object</span><span class="delimiter">]</span>.<span title="()java.lang.Class[_]">getClass</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>,
        <a href="#397361" title="Class[T]">c</a><span class="delimiter">)</span>

    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="net.liftweb.common.Empty.type" id="397398">e</a>: <span title="java.lang.IllegalAccessException">IllegalAccessException</span> =&gt; <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(attrValue: String, rest: scala.xml.MetaData, params: AnyRef*)scala.xml.MetaData" id="230275">findAttributeSnippet</a><span class="delimiter">(</span><a title="String" id="397399">attrValue</a>: <span title="String">String</span>, <a title="scala.xml.MetaData" id="397400">rest</a>: <span title="scala.xml.MetaData">MetaData</span>, <a title="AnyRef*" id="397401">params</a>: <span title="AnyRef*">AnyRef</span>*<span class="delimiter">)</span>: <span title="scala.xml.MetaData">MetaData</span> = <span class="delimiter">{</span>
    <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49484" title="(name: String)(f: =&gt; scala.xml.MetaData)scala.xml.MetaData">doSnippet</a><span class="delimiter">(</span><a href="#397399" title="String">attrValue</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a href="#397412" title="(String, String)" class="delimiter">(</a><a href="#397411" title="String" id="397412">cls</a>, <a href="#397411" title="String" id="397413">method</a><span class="delimiter">)</span> = <a href="#230279" title="(in: String)(String, String)">splitColonPair</a><span title="(String, String) @unchecked" class="delimiter">(</span><a href="#397399" title="String">attrValue</a><span class="delimiter">)</span>

      <a href="../../../../util/net/liftweb/util/ListHelpers.scala.html#48877" title="(in: Seq[java.lang.String])(_f: java.lang.String =&gt; net.liftweb.common.Box[scala.xml.MetaData])net.liftweb.common.Box[scala.xml.MetaData]">first</a><span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158965" title="=&gt; net.liftweb.http.LiftRules#FactoryMaker[java.lang.String =&gt; List[java.lang.String]]">snippetNamesToSearch</a>.<a href="Factory.scala.html#159330" title="(v1: java.lang.String)List[java.lang.String]">vend</a><span class="delimiter">(</span><a href="#397412" title="String">cls</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a title="java.lang.String" id="397454">nameToTry</a> =&gt;
          <a href="#230271" title="(name: String)net.liftweb.common.Box[Class[AnyRef]]">findSnippetClass</a><span class="delimiter">(</span><a href="#397454" title="java.lang.String">nameToTry</a><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27023" title="(f: Class[AnyRef] =&gt; net.liftweb.common.Box[scala.xml.MetaData])net.liftweb.common.Box[scala.xml.MetaData]">flatMap</a> <span class="delimiter">{</span>
            <a title="Class[AnyRef]" id="397459">clz</a> =&gt;
              <a href="#230272" title="(c: Class[AnyRef])net.liftweb.common.Box[AnyRef]">instantiateOrRedirect</a><span class="delimiter">(</span><a href="#397459" title="Class[AnyRef]">clz</a><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27023" title="(f: AnyRef =&gt; net.liftweb.common.Box[scala.xml.MetaData])net.liftweb.common.Box[scala.xml.MetaData]">flatMap</a> <span class="delimiter">{</span>
                <a title="AnyRef" id="397467">inst</a> =&gt;
                  <a href="../../../../util/net/liftweb/util/ClassHelpers.scala.html#48578" title="(clz: Class[AnyRef], inst: AnyRef, meth: String)net.liftweb.common.Box[Any]">invokeMethod</a><span class="delimiter">(</span><a href="#397459" title="Class[AnyRef]">clz</a>, <a href="#397467" title="AnyRef">inst</a>, <a href="#397413" title="String">method</a><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27043" title="(alternative: =&gt; net.liftweb.common.Box[Any])net.liftweb.common.Box[Any]">or</a> <a href="../../../../util/net/liftweb/util/ClassHelpers.scala.html#48581" title="(clz: Class[AnyRef], inst: AnyRef, meth: String, params: Array[AnyRef])net.liftweb.common.Box[Any]">invokeMethod</a><span class="delimiter">(</span><a href="#397459" title="Class[AnyRef]">clz</a>, <a href="#397467" title="AnyRef">inst</a>, <a href="#397413" title="String">method</a>, <a href="#397401" title="AnyRef*">params</a>.<span title="=&gt; List[AnyRef]">toList</span>.<span title="(implicit evidence$1: ClassManifest[AnyRef])Array[AnyRef]">toArray</span><span class="delimiter">)</span> <span title="&lt;none&gt; extends net.liftweb.common.Box[scala.xml.MetaData] with Serializable" class="keyword">match</span> <span class="delimiter">{</span>
                    <span class="keyword">case</span> <span title="net.liftweb.common.Full[scala.xml.MetaData]">Full</span><span class="delimiter">(</span><a title="scala.xml.MetaData" id="397536">md</a>: <span title="scala.xml.MetaData">MetaData</span><span class="delimiter">)</span> =&gt; <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: scala.xml.MetaData)net.liftweb.common.Full[scala.xml.MetaData]">Full</a><span class="delimiter">(</span><a href="#397536" title="scala.xml.MetaData">md</a>.<span title="(next: scala.xml.MetaData)scala.xml.MetaData">copy</span><span class="delimiter">(</span><a href="#397400" title="scala.xml.MetaData">rest</a><span class="delimiter">)</span><span class="delimiter">)</span>
                    <span class="keyword">case</span> <span title="net.liftweb.common.Empty.type">_</span> =&gt; <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a>
                  <span class="delimiter">}</span>
              <span class="delimiter">}</span>
          <span class="delimiter">}</span>
      <span class="delimiter">}</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; scala.xml.MetaData)scala.xml.MetaData">openOr</a> <a href="#397400" title="scala.xml.MetaData">rest</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">object</span> <a title="object LiftSession.this.DotSplit" id="230276">DotSplit</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(in: String)Option[List[String]]" id="397649">unapply</a><span class="delimiter">(</span><a title="String" id="397651">in</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[List[String]]">Option</span><span class="delimiter">[</span>List<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Int" id="397653">i</a> = <a href="#397651" title="String">in</a>.<span title="(x$1: Int)Int">lastIndexOf</span><span class="delimiter">(</span><span title="Int(46)" class="char">'.'</span><span class="delimiter">)</span>
      <span title="Option[List[String]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#397653" title="Int">i</a> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span title="(x: List[java.lang.String])Some[List[java.lang.String]]">Some</span><span class="delimiter">(</span><span title="(xs: java.lang.String*)List[java.lang.String]">List</span><span class="delimiter">(</span><a href="#397651" title="String">in</a>.<span title="(x$1: Int, x$2: Int)java.lang.String">substring</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#397653" title="Int">i</a><span class="delimiter">)</span>, <a href="#397651" title="String">in</a>.<span title="(x$1: Int)java.lang.String">substring</span><span class="delimiter">(</span><a href="#397653" title="Int">i</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">else</span> <span title="object None">None</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(in: String)String" id="230278">colonToDot</a><span class="delimiter">(</span><a title="String" id="397680">in</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
    <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#397680" title="String">in</a>.<span title="(x$1: Int)Int">indexOf</span><span class="delimiter">(</span><span title="Int(47)" class="char">'/'</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Int" id="397690">len</a> = <a href="#397680" title="String">in</a>.<span title="()Int">length</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.lang.StringBuilder" id="397691">ret</a> = <span title="(x$1: Int)java.lang.StringBuilder" class="keyword">new</span> java.lang.<span title="java.lang.StringBuilder">StringBuilder</span><span class="delimiter">(</span><a href="#397690" title="Int">len</a><span class="delimiter">)</span>
      <span class="keyword">var</span> <a title="Int" id="397692">x</a> = <span title="Int(0)" class="int">0</span>
      <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#397692" title="Int">x</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#397690" title="Int">len</a><span class="delimiter">)</span> <a href="#397693" title="()Unit" class="delimiter">{</a>
        <span class="keyword">val</span> <a title="Char" id="397702">c</a> = <a href="#397680" title="String">in</a>.<span title="(x$1: Int)Char">charAt</span><span class="delimiter">(</span><a href="#397692" title="Int">x</a><span class="delimiter">)</span>
        <span title="java.lang.StringBuilder" class="keyword">if</span> <span class="delimiter">(</span><a href="#397702" title="Char">c</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'/\')" class="char">'/'</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#397691" title="java.lang.StringBuilder">ret</a>.<span title="(x$1: Char)java.lang.StringBuilder">append</span><span class="delimiter">(</span><span title="Char(\'.\')" class="char">'.'</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">else</span> <a href="#397691" title="java.lang.StringBuilder">ret</a>.<span title="(x$1: Char)java.lang.StringBuilder">append</span><span class="delimiter">(</span><a href="#397702" title="Char">c</a><span class="delimiter">)</span>
        <a href="#397692" title="Int">x</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
      <span class="delimiter">}</span>
      <a href="#397691" title="java.lang.StringBuilder">ret</a>.<span title="()java.lang.String">toString</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#397680" title="String">in</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Split a string separated by a point or by a column in 2 parts. Uses default values if only one is found or if no parts are found
   * @param in string to split
   * @return a pair containing the first and second parts
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(in: String)(String, String)" id="230279">splitColonPair</a><span class="delimiter">(</span><a title="String" id="397414">in</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="(String, String)" class="delimiter">(</span>String, String<span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="delimiter">(</span><a href="#397414" title="String">in</a> <span title="List[java.lang.String]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="List[java.lang.String]" class="keyword">null</span> =&gt; <span title="(xs: java.lang.String*)List[java.lang.String]">List</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="#397649" title="List[String]">DotSplit</a><span class="delimiter">(</span><a title="List[String]" id="397727">lst</a><span class="delimiter">)</span> =&gt; <a href="#397727" title="List[String]">lst</a>
      <span class="keyword">case</span> <a title="List[String]" id="397728">s</a> =&gt; <a href="../../../../util/net/liftweb/util/StringHelpers.scala.html#48858" title="implicit net.liftweb.util.StringHelpers.stringToSuper : (in: String)net.liftweb.util.SuperString">s</a>.<a href="../../../../util/net/liftweb/util/StringHelpers.scala.html#58433" title="(sep: String)List[String]">roboSplit</a><span class="delimiter">(</span><span title="java.lang.String(&quot;:&quot;)" class="string">&quot;:&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span> <span title="(String, String)" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="(String, java.lang.String)" id="397735">f</a> :: <a title="java.lang.String" id="397740">s</a> :: _ =&gt; <span title="(_1: String, _2: java.lang.String)(String, java.lang.String)" class="delimiter">(</span><a href="#230278" title="(in: String)String">colonToDot</a><span class="delimiter">(</span><a href="#397735" title="java.lang.String">f</a><span class="delimiter">)</span>, <a href="#397740" title="java.lang.String">s</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="(String, java.lang.String)" id="397751">f</a> :: <span title="object Nil">Nil</span> =&gt; <span title="(_1: String, _2: java.lang.String)(String, java.lang.String)" class="delimiter">(</span><a href="#230278" title="(in: String)String">colonToDot</a><span class="delimiter">(</span><a href="#397751" title="java.lang.String">f</a><span class="delimiter">)</span>, <span title="java.lang.String(&quot;render&quot;)" class="string">&quot;render&quot;</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="(java.lang.String, java.lang.String)">_</span> =&gt; <span title="(_1: java.lang.String, _2: java.lang.String)(java.lang.String, java.lang.String)" class="delimiter">(</span><span title="java.lang.String(&quot;yikes dude, there\'s no method name defined&quot;)" class="string">&quot;yikes dude, there's no method name defined&quot;</span>, <span title="java.lang.String(&quot;render&quot;)" class="string">&quot;render&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>


  <span class="comment">/**
   * Finds a template named name and then runs it throught the Lift processing engine
   */</span>
  <span class="keyword">def</span> <a title="(name: List[String])net.liftweb.common.Box[scala.xml.Elem]" id="230280">findAndProcessTemplate</a><span class="delimiter">(</span><a title="List[String]" id="397764">name</a>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[scala.xml.Elem]">Box</a><span class="delimiter">[</span>Elem<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(in: scala.xml.NodeSeq)net.liftweb.common.Box[scala.xml.Elem]" id="397766">findElem</a><span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="397767">in</a>: <span title="scala.xml.NodeSeq">NodeSeq</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[scala.xml.Elem]">Box</a><span class="delimiter">[</span>Elem<span class="delimiter">]</span> =
      <a href="#397767" title="scala.xml.NodeSeq">in</a>.<span title="=&gt; List[scala.xml.Node]">toList</span>.<span title="(f: scala.xml.Node =&gt; scala.collection.GenTraversableOnce[scala.xml.Elem])(implicit bf: scala.collection.generic.CanBuildFrom[List[scala.xml.Node],scala.xml.Elem,List[scala.xml.Elem]])List[scala.xml.Elem]">flatMap</span> <a href="#397787" title="Iterable[scala.xml.Elem]" class="delimiter">{</a>
        <span class="keyword">case</span> <a title="Iterable[scala.xml.Elem]" id="397788">e</a>: <span title="scala.xml.Elem">Elem</span> =&gt; <span title="(x: scala.xml.Elem)Some[scala.xml.Elem]">Some</span><span title="(xo: Option[scala.xml.Elem])Iterable[scala.xml.Elem]" class="delimiter">(</span><a href="#397788" title="scala.xml.Elem">e</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Iterable[Nothing]">_</span> =&gt; <span title="(xo: Option[Nothing])Iterable[Nothing]">None</span>
      <span class="delimiter">}</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#28627" title="(in: Option[scala.xml.Elem])net.liftweb.common.Box[scala.xml.Elem]">headOption</a>

    <span class="keyword">for</span> <span class="delimiter">{</span>
      <a title="scala.xml.NodeSeq" id="397934">template</a> &lt;- <a href="Templates.scala.html#342663" title="(places: List[String], locale: java.util.Locale)net.liftweb.common.Box[scala.xml.NodeSeq]">Templates</a><span class="delimiter">(</span><a href="#397764" title="List[String]">name</a>, <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49322" title="=&gt; java.util.Locale">locale</a><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27023" title="(f: scala.xml.NodeSeq =&gt; net.liftweb.common.Box[scala.xml.Elem])net.liftweb.common.Box[scala.xml.Elem]">?~</a> <span class="delimiter">(</span><span title="java.lang.String(&quot;Template &quot;)" class="string">&quot;Template &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#397764" title="List[String]">name</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; not found&quot;)" class="string">&quot; not found&quot;</span><span class="delimiter">)</span>
      <a title="scala.xml.Elem" id="397941">res</a> &lt;- <a href="#397766" title="(in: scala.xml.NodeSeq)net.liftweb.common.Box[scala.xml.Elem]">findElem</a><a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: scala.xml.Elem =&gt; scala.xml.Elem)net.liftweb.common.Box[scala.xml.Elem]" class="delimiter">(</a><a href="#230307" title="(page: String, in: scala.xml.NodeSeq)scala.xml.NodeSeq">processSurroundAndInclude</a><span class="delimiter">(</span><a href="#397764" title="List[String]">name</a>.<span title="(start: String, sep: String, end: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span>, <span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>, <a href="#397934" title="scala.xml.NodeSeq">template</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="#397941" title="scala.xml.Elem">res</a>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(in: scala.xml.MetaData)scala.xml.MetaData" id="230281">processAttributes</a><span class="delimiter">(</span><a title="scala.xml.MetaData" id="397944">in</a>: <span title="scala.xml.MetaData">MetaData</span><span class="delimiter">)</span>: <span title="scala.xml.MetaData">MetaData</span> = <span class="delimiter">{</span>
    <a href="#397944" title="scala.xml.MetaData">in</a> <span title="scala.xml.MetaData" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="scala.xml.Null.type">Null</span> =&gt; <span title="object scala.xml.Null">Null</span>
      <span class="keyword">case</span> <a title="scala.xml.MetaData" id="397946">mine</a>: <span title="scala.xml.PrefixedAttribute">PrefixedAttribute</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#397946" title="scala.xml.PrefixedAttribute">mine</a>.<span title="=&gt; String">pre</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;lift&quot;)" class="string">&quot;lift&quot;</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="#397946" title="scala.xml.PrefixedAttribute">mine</a>.<span title="=&gt; String">key</span> <span title="scala.xml.MetaData" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a title="scala.xml.MetaData" id="397951">s</a> <span class="keyword">if</span> <a href="#397951" title="String">s</a>.<span title="(x$1: Int)Int">indexOf</span><span class="delimiter">(</span><span title="Int(46)" class="char">'.'</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">&gt;</span> -<span title="Int(-1)" class="int">1</span> =&gt; <a href="#230275" title="(attrValue: String, rest: scala.xml.MetaData, params: AnyRef*)scala.xml.MetaData">findAttributeSnippet</a><span class="delimiter">(</span><a href="#397951" title="String">s</a>, <a href="#230281" title="(in: scala.xml.MetaData)scala.xml.MetaData">processAttributes</a><span class="delimiter">(</span><a href="#397944" title="scala.xml.MetaData">in</a>.<span title="=&gt; scala.xml.MetaData">next</span><span class="delimiter">)</span>, <a href="#397946" title="scala.xml.PrefixedAttribute">mine</a><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="scala.xml.MetaData" class="string">&quot;snippet&quot;</span> =&gt; <a href="#230275" title="(attrValue: String, rest: scala.xml.MetaData, params: AnyRef*)scala.xml.MetaData">findAttributeSnippet</a><span class="delimiter">(</span><a href="#397946" title="scala.xml.PrefixedAttribute">mine</a>.<span title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">value</span>.<span title="=&gt; String">text</span>, <a href="#230281" title="(in: scala.xml.MetaData)scala.xml.MetaData">processAttributes</a><span class="delimiter">(</span><a href="#397944" title="scala.xml.MetaData">in</a>.<span title="=&gt; scala.xml.MetaData">next</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="scala.xml.PrefixedAttribute">_</span> =&gt; <a href="#397946" title="scala.xml.PrefixedAttribute">mine</a>.<span title="(next: scala.xml.MetaData)scala.xml.PrefixedAttribute">copy</span><span class="delimiter">(</span><a href="#230281" title="(in: scala.xml.MetaData)scala.xml.MetaData">processAttributes</a><span class="delimiter">(</span><a href="#397944" title="scala.xml.MetaData">in</a>.<span title="=&gt; scala.xml.MetaData">next</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <a title="scala.xml.MetaData" id="397966">notMine</a> =&gt; <a href="#397966" title="scala.xml.MetaData">notMine</a>.<span title="(next: scala.xml.MetaData)scala.xml.MetaData">copy</span><span class="delimiter">(</span><a href="#230281" title="(in: scala.xml.MetaData)scala.xml.MetaData">processAttributes</a><span class="delimiter">(</span><a href="#397944" title="scala.xml.MetaData">in</a>.<span title="=&gt; scala.xml.MetaData">next</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * See if there's a object singleton with the right name
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(cls: String)net.liftweb.common.Box[AnyRef]" id="230282">findSnippetObject</a><span class="delimiter">(</span><a title="String" id="397967">cls</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[AnyRef]">Box</a><span class="delimiter">[</span>AnyRef<span class="delimiter">]</span> =
    <a href="#230271" title="(name: String)net.liftweb.common.Box[Class[AnyRef]]">findSnippetClass</a><span class="delimiter">(</span><a href="#397967" title="String">cls</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;$&quot;)" class="string">&quot;$&quot;</span><span class="delimiter">)</span>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27023" title="(f: Class[AnyRef] =&gt; net.liftweb.common.Box[java.lang.Object])net.liftweb.common.Box[java.lang.Object]">flatMap</a> <span class="delimiter">{</span>
      <a title="Class[AnyRef]" id="397973">c</a> =&gt;
        <a href="../../../../util/net/liftweb/util/ControlHelpers.scala.html#48608" title="(f: =&gt; java.lang.Object)net.liftweb.common.Box[java.lang.Object]">tryo</a> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="java.lang.reflect.Field" id="397998">field</a> = <a href="#397973" title="Class[AnyRef]">c</a>.<span title="(x$1: java.lang.String)java.lang.reflect.Field">getField</span><span class="delimiter">(</span><span title="java.lang.String(&quot;MODULE$&quot;)" class="string">&quot;MODULE$&quot;</span><span class="delimiter">)</span>
          <a href="#397998" title="java.lang.reflect.Field">field</a>.<span title="(x$1: Any)java.lang.Object">get</span><span class="delimiter">(</span><span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>

  <span class="comment">/*
   * We need to locate a snippet instance for the given tag name. We look in
   * this order:
   *
   * 1. Check to see if a StatefulSnippet has already registered itself
   * 2. See if we have a custom snippet dispatch defined in LiftRules
   * 3. Locate a Class or Object based on the snippet name
   *
   * For the cases #2 and #3, we need to set the snippet name if the returned snippet
   * class is a StatefulSnippet so that the registration function works on return calls.
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(cls: String)net.liftweb.common.Box[AnyRef]" id="230283">findSnippetInstance</a><span class="delimiter">(</span><a title="String" id="398001">cls</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[AnyRef]">Box</a><span class="delimiter">[</span>AnyRef<span class="delimiter">]</span> =
    <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49384" title="(cls: String)net.liftweb.common.Box[net.liftweb.http.DispatchSnippet]">snippetForClass</a><span class="delimiter">(</span><a href="#398001" title="String">cls</a><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27043" title="(alternative: =&gt; net.liftweb.common.Box[AnyRef])net.liftweb.common.Box[AnyRef]">or</a>
      <span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158971" title="(name: String)net.liftweb.common.Box[net.liftweb.http.DispatchSnippet]">snippet</a><span class="delimiter">(</span><a href="#398001" title="String">cls</a><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27043" title="(alternative: =&gt; net.liftweb.common.Box[AnyRef])net.liftweb.common.Box[AnyRef]">or</a>
        <a href="#230271" title="(name: String)net.liftweb.common.Box[Class[AnyRef]]">findSnippetClass</a><span class="delimiter">(</span><a href="#398001" title="String">cls</a><span class="delimiter">)</span>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27023" title="(f: Class[AnyRef] =&gt; net.liftweb.common.Box[AnyRef])net.liftweb.common.Box[AnyRef]">flatMap</a><span class="delimiter">(</span><a title="Class[AnyRef]" id="398018">c</a> =&gt; <a href="#230272" title="(c: Class[AnyRef])net.liftweb.common.Box[AnyRef]">instantiateOrRedirect</a><span class="delimiter">(</span><a href="#398018" title="Class[AnyRef]">c</a><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27043" title="(alternative: =&gt; net.liftweb.common.Box[AnyRef])net.liftweb.common.Box[AnyRef]">or</a> <a href="#230282" title="(cls: String)net.liftweb.common.Box[AnyRef]">findSnippetObject</a><span class="delimiter">(</span><a href="#398001" title="String">cls</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="net.liftweb.common.Box[AnyRef]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="net.liftweb.common.Full[net.liftweb.http.StatefulSnippet]">Full</span><span class="delimiter">(</span><a title="net.liftweb.http.StatefulSnippet" id="398031">inst</a>: <a href="StatefulSnippet.scala.html#14713" title="net.liftweb.http.StatefulSnippet">StatefulSnippet</a><span class="delimiter">)</span> =&gt;
        <a href="#398031" title="net.liftweb.http.StatefulSnippet">inst</a>.<a href="StatefulSnippet.scala.html#193186" title="(name: String)Unit">addName</a><span class="delimiter">(</span><a href="#398001" title="String">cls</a><span class="delimiter">)</span>; <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49386" title="(cls: String, inst: net.liftweb.http.DispatchSnippet)Unit">overrideSnippetForClass</a><span class="delimiter">(</span><a href="#398001" title="String">cls</a>, <a href="#398031" title="net.liftweb.http.StatefulSnippet">inst</a><span class="delimiter">)</span>; <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.StatefulSnippet)net.liftweb.common.Full[net.liftweb.http.StatefulSnippet]">Full</a><span class="delimiter">(</span><a href="#398031" title="net.liftweb.http.StatefulSnippet">inst</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="net.liftweb.common.Full[AnyRef]">Full</span><span class="delimiter">(</span><a title="AnyRef" id="398038">ret</a><span class="delimiter">)</span> =&gt; <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: AnyRef)net.liftweb.common.Full[AnyRef]">Full</a><span class="delimiter">(</span><a href="#398038" title="AnyRef">ret</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="net.liftweb.common.Failure" id="398042">fail</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10586" title="net.liftweb.common.Failure">Failure</a> =&gt; <a href="#398042" title="net.liftweb.common.Failure">fail</a>
      <span class="keyword">case</span> <span title="net.liftweb.common.Empty.type">_</span> =&gt; <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a>
    <span class="delimiter">}</span>

  <span class="comment">/**
   * Report a snippet error depending on what the run mode is
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(page: String, snippetName: net.liftweb.common.Box[String], why: net.liftweb.http.LiftRules.SnippetFailures.Value, addlMsg: scala.xml.NodeSeq, whole: scala.xml.NodeSeq)scala.xml.NodeSeq" id="230284">reportSnippetError</a><span class="delimiter">(</span><a title="String" id="398043">page</a>: <span title="String">String</span>,
                                 <a title="net.liftweb.common.Box[String]" id="398044">snippetName</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[String]">Box</a><span class="delimiter">[</span>String<span class="delimiter">]</span>,
                                 <a title="net.liftweb.http.LiftRules.SnippetFailures.Value" id="398045">why</a>: LiftRules.SnippetFailures.<span title="net.liftweb.http.LiftRules.SnippetFailures.Value">Value</span>,
                                 <a title="scala.xml.NodeSeq" id="398046">addlMsg</a>: <span title="scala.xml.NodeSeq">NodeSeq</span>,
                                 <a title="scala.xml.NodeSeq" id="398047">whole</a>: <span title="scala.xml.NodeSeq">NodeSeq</span><span class="delimiter">)</span>: <span title="scala.xml.NodeSeq">NodeSeq</span> = <span class="delimiter">{</span>
    <span class="keyword">for</span> <span class="delimiter">{</span>
      <a title="net.liftweb.http.LiftRules.SnippetFailure =&gt; Unit" id="398080">f</a> &lt;- <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159128" title="=&gt; net.liftweb.http.LiftRules#RulesSeq[net.liftweb.http.LiftRules.SnippetFailure =&gt; Unit]">snippetFailedFunc</a>.<a href="LiftRules.scala.html#185552" title="(f: net.liftweb.http.LiftRules.SnippetFailure =&gt; Unit =&gt; Unit)Unit">toList</a>
    <span class="delimiter">}</span> <span class="delimiter">{</span>
      <a href="#398080" title="(v1: net.liftweb.http.LiftRules.SnippetFailure)Unit">f</a><span class="delimiter">(</span><a href="LiftRules.scala.html#14376" title="object net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#356767" title="(page: String, typeName: net.liftweb.common.Box[String], failure: net.liftweb.http.LiftRules.SnippetFailures.Value)net.liftweb.http.LiftRules.SnippetFailure">SnippetFailure</a><span class="delimiter">(</span><a href="#398043" title="String">page</a>, <a href="#398044" title="net.liftweb.common.Box[String]">snippetName</a>, <a href="#398045" title="net.liftweb.http.LiftRules.SnippetFailures.Value">why</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../../util/net/liftweb/util/Props.scala.html#13579" title="object net.liftweb.util.Props">Props</a>.<a href="../../../../util/net/liftweb/util/Props.scala.html#151319" title="=&gt; Boolean">devMode</a> <span title="(x: Boolean)Boolean">||</span> <a href="../../../../util/net/liftweb/util/Props.scala.html#13579" title="object net.liftweb.util.Props">Props</a>.<a href="../../../../util/net/liftweb/util/Props.scala.html#151321" title="=&gt; Boolean">testMode</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#230249" title="object LiftSession.this.overrideResponseCode">overrideResponseCode</a>.<a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75378" title="(what: net.liftweb.common.Box[Int])net.liftweb.common.Box[Int]">set</a><span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159069" title="=&gt; net.liftweb.common.Box[Int]">devModeFailureResponseCodeOverride</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="../../../../util/net/liftweb/util/Helpers.scala.html#13346" title="object net.liftweb.util.Helpers">Helpers</a>.<a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#48940" title="(body: scala.xml.NodeSeq)net.liftweb.common.Box[scala.xml.NodeSeq]">errorDiv</a><span class="delimiter">(</span>
      &lt;<a title="scala.xml.Elem" id="398103">div</a>&gt;<span title="scala.xml.Text">Error</span> processing snippet:
        &lt;<a title="scala.xml.Elem" id="398104">b</a>&gt;
          <span class="delimiter">{</span><a href="#398044" title="net.liftweb.common.Box[String]">snippetName</a> <a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; String)String">openOr</a> <span title="java.lang.String(&quot;N/A&quot;)" class="string">&quot;N/A&quot;</span><span class="delimiter">}</span>
        &lt;/b&gt; &lt;<span title="scala.xml.Elem">br</span>/&gt;
        Reason:
        &lt;<a title="scala.xml.Elem" id="398110">b</a>&gt;
          <span class="delimiter">{</span><a href="#398045" title="net.liftweb.http.LiftRules.SnippetFailures.Value">why</a><span class="delimiter">}</span><span class="delimiter">{</span><a href="#398046" title="scala.xml.NodeSeq">addlMsg</a><span class="delimiter">}</span>
        &lt;/b&gt; &lt;<span title="scala.xml.Elem">br</span>/&gt;
        XML causing <span class="keyword">this</span> error:
          &lt;<span title="scala.xml.Elem">br</span>/&gt;
        &lt;<a title="scala.xml.MetaData" id="398116">pre</a> style=<span title="scala.xml.Text" class="string">&quot;background: lightgrey; padding: 6px; border: 1px solid&quot;</span>&gt;
          <span class="delimiter">{</span><a href="#398047" title="scala.xml.NodeSeq">whole</a>.<span title="()String">toString</span><span class="delimiter">}</span>
        &lt;/pre&gt;
      &lt;/div&gt;<span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; scala.xml.NodeSeq)scala.xml.NodeSeq">openOr</a> <span title="object scala.xml.NodeSeq">NodeSeq</span>.<span title="=&gt; scala.xml.NodeSeq">Empty</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">def</span> <a title="(attrs: scala.xml.MetaData, prefix: String, key: String)Option[Seq[scala.xml.Node]]" id="230285">findNSAttr</a><span class="delimiter">(</span><a title="scala.xml.MetaData" id="398122">attrs</a>: <span title="scala.xml.MetaData">MetaData</span>, <a title="String" id="398123">prefix</a>: <span title="String">String</span>, <a title="String" id="398124">key</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[Seq[scala.xml.Node]]">Option</span><span class="delimiter">[</span>Seq<span class="delimiter">[</span>Node<span class="delimiter">]</span><span class="delimiter">]</span> =
    <a href="#398122" title="scala.xml.MetaData">attrs</a> <span title="Option[Seq[scala.xml.Node]]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Option[Nothing]">Null</span> =&gt; <a href="../../../../common/net/liftweb/common/Box.scala.html#28630" title="(in: net.liftweb.common.Box[Nothing])Option[Nothing]">Empty</a>
      <span class="keyword">case</span> <a title="Some[Seq[scala.xml.Node]]" id="398131">p</a>: <span title="scala.xml.PrefixedAttribute">PrefixedAttribute</span> <span class="keyword">if</span> <a href="#398131" title="scala.xml.PrefixedAttribute">p</a>.<span title="=&gt; String">pre</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#398123" title="String">prefix</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#398131" title="scala.xml.PrefixedAttribute">p</a>.<span title="=&gt; String">key</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#398124" title="String">key</a> =&gt; <span title="(x: Seq[scala.xml.Node])Some[Seq[scala.xml.Node]]">Some</span><span class="delimiter">(</span><a href="#398131" title="scala.xml.PrefixedAttribute">p</a>.<span title="=&gt; Seq[scala.xml.Node]">value</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="Option[Seq[scala.xml.Node]]" id="398143">x</a> =&gt; <a href="#230285" title="(attrs: scala.xml.MetaData, prefix: String, key: String)Option[Seq[scala.xml.Node]]">findNSAttr</a><span class="delimiter">(</span><a href="#398143" title="scala.xml.MetaData">x</a>.<span title="=&gt; scala.xml.MetaData">next</span>, <a href="#398123" title="String">prefix</a>, <a href="#398124" title="String">key</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="comment">/**
   * Wrap an AFuncHolder with the current snippet and Loc context so that for Ajax calls, the original snippets,
   * RequestVars and Loc (location) are populated
   *
   * @param f the AFuncHolder that you want to wrap with execution context
   */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(f: net.liftweb.http.S.AFuncHolder)net.liftweb.http.S.AFuncHolder" id="230286">contextFuncBuilder</a><span class="delimiter">(</span><a title="net.liftweb.http.S.AFuncHolder" id="398144">f</a>: S.<a href="S.scala.html#49602" title="net.liftweb.http.S.AFuncHolder">AFuncHolder</a><span class="delimiter">)</span>: S.<a href="S.scala.html#49602" title="net.liftweb.http.S.AFuncHolder">AFuncHolder</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Map[String,AnyRef]" id="398146">currentMap</a> = <a href="#230201" title="object LiftSession.this.snippetMap">snippetMap</a>.<a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75375" title="=&gt; Map[String,AnyRef]">is</a>
    <span class="keyword">val</span> <a title="net.liftweb.common.Box[net.liftweb.sitemap.Loc[_]]" id="398147">curLoc</a> = <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49312" title="=&gt; net.liftweb.common.Box[net.liftweb.sitemap.Loc[_]]">location</a>

    <span class="keyword">val</span> <a title="() =&gt; Any =&gt; Any" id="398148">requestVarFunc</a>: <span title="() =&gt; Any =&gt; Any">Function1</span><span class="delimiter">[</span>Function0<span class="delimiter">[</span>Any<span class="delimiter">]</span>, Any<span class="delimiter">]</span> = <a href="Vars.scala.html#14779" title="object net.liftweb.http.RequestVarHandler">RequestVarHandler</a>.<a href="Vars.scala.html#398161" title="()() =&gt; Any =&gt; Any">generateSnapshotRestorer</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#398181" title="net.liftweb.http.S.ProxyFuncHolder" class="keyword">new</a> <a href="S.scala.html#14641" title="anonymous class $anon extends net.liftweb.http.S.ProxyFuncHolder" id="398181">S</a>.<a href="S.scala.html#49589" title="net.liftweb.http.S.ProxyFuncHolder">ProxyFuncHolder</a><span class="delimiter">(</span><a href="#398144" title="net.liftweb.http.S.AFuncHolder">f</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="(in: List[String])Any" id="398200">apply</a><span class="delimiter">(</span><a title="List[String]" id="398203">in</a>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Any">Any</span> =
        <a href="#398148" title="(v1: () =&gt; Any)Any">requestVarFunc</a><span class="delimiter">(</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt;
          <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49310" title="object net.liftweb.http.S.CurrentLocation">CurrentLocation</a>.<a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75392" title="(newVal: net.liftweb.common.Box[net.liftweb.sitemap.Loc[_]])(f: =&gt; Any)Any">doWith</a><span class="delimiter">(</span><a href="#398147" title="net.liftweb.common.Box[net.liftweb.sitemap.Loc[_]]">curLoc</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#230201" title="object LiftSession.this.snippetMap">snippetMap</a>.<a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75392" title="(newVal: Map[String,AnyRef])(f: =&gt; Any)Any">doWith</a><span class="delimiter">(</span><a href="#230201" title="object LiftSession.this.snippetMap">snippetMap</a>.<a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75375" title="=&gt; Map[String,AnyRef]">is</a> <span title="(xs: scala.collection.GenTraversableOnce[(String, AnyRef)])scala.collection.immutable.Map[String,AnyRef]">++</span> <a href="#398146" title="Map[String,AnyRef]">currentMap</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#398181" title="net.liftweb.http.S.ProxyFuncHolder" class="keyword">super</a>.<a href="S.scala.html#398193" title="(in: List[String])Any">apply</a><span class="delimiter">(</span><a href="#398203" title="List[String]">in</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">)</span>

      <span class="keyword">override</span> <span class="keyword">def</span> <a title="(in: net.liftweb.http.FileParamHolder)Any" id="398201">apply</a><span class="delimiter">(</span><a title="net.liftweb.http.FileParamHolder" id="398218">in</a>: <a href="Req.scala.html#14548" title="net.liftweb.http.FileParamHolder">FileParamHolder</a><span class="delimiter">)</span>: <span title="Any">Any</span> =
        <a href="#398148" title="(v1: () =&gt; Any)Any">requestVarFunc</a><span class="delimiter">(</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt;
          <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49310" title="object net.liftweb.http.S.CurrentLocation">CurrentLocation</a>.<a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75392" title="(newVal: net.liftweb.common.Box[net.liftweb.sitemap.Loc[_]])(f: =&gt; Any)Any">doWith</a><span class="delimiter">(</span><a href="#398147" title="net.liftweb.common.Box[net.liftweb.sitemap.Loc[_]]">curLoc</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#230201" title="object LiftSession.this.snippetMap">snippetMap</a>.<a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75392" title="(newVal: Map[String,AnyRef])(f: =&gt; Any)Any">doWith</a><span class="delimiter">(</span><a href="#230201" title="object LiftSession.this.snippetMap">snippetMap</a>.<a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75375" title="=&gt; Map[String,AnyRef]">is</a> <span title="(xs: scala.collection.GenTraversableOnce[(String, AnyRef)])scala.collection.immutable.Map[String,AnyRef]">++</span> <a href="#398146" title="Map[String,AnyRef]">currentMap</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#398181" title="net.liftweb.http.S.ProxyFuncHolder" class="keyword">super</a>.<a href="S.scala.html#398194" title="(in: net.liftweb.http.FileParamHolder)Any">apply</a><span class="delimiter">(</span><a href="#398218" title="net.liftweb.http.FileParamHolder">in</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * During the HTTP request/response cycle or in a CometActor,
   * Lift populates &quot;S&quot; with information about the current session,
   * the current request, etc.  This method allows you to wrap a
   * function in another function that will snapshot current state
   * (request vars, Req, Loc, etc.) such that when the returned
   * function is executed, it will be executed as if it had been
   * executed in the scope of the thread where it was create.
   * This allows you to farm work out to separate threads, but make
   * it look to those threads as if the scope was the same as if it
   * had been executed on the thread that created the function.
   */</span>
  <span class="keyword">def</span> <a title="[T](f: () =&gt; T)() =&gt; T" id="230287">buildDeferredFunction</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="230289">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="() =&gt; T" id="328296">f</a>: <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; T<span class="delimiter">)</span>: <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; T = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="net.liftweb.common.Box[net.liftweb.http.Req]" id="398461">currentReq</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.http.Req]">Box</a><span class="delimiter">[</span>Req<span class="delimiter">]</span> = <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49309" title="=&gt; net.liftweb.common.Box[net.liftweb.http.Req]">request</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: net.liftweb.http.Req =&gt; net.liftweb.http.Req)net.liftweb.common.Box[net.liftweb.http.Req]">map</a><span class="delimiter">(</span><a href="#398470" title="net.liftweb.http.Req">_</a>.<a href="Req.scala.html#149165" title="=&gt; net.liftweb.http.Req">snapshot</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="String" id="398462">renderVersion</a> = <a href="#14488" title="object net.liftweb.http.RenderVersion">RenderVersion</a>.<a href="#345564" title="=&gt; String">get</a>

    <span class="keyword">val</span> <a title="Map[String,AnyRef]" id="398463">currentMap</a> = <a href="#230201" title="object LiftSession.this.snippetMap">snippetMap</a>.<a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75375" title="=&gt; Map[String,AnyRef]">is</a>
    <span class="keyword">val</span> <a title="net.liftweb.common.Box[net.liftweb.sitemap.Loc[_]]" id="398464">curLoc</a> = <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49312" title="=&gt; net.liftweb.common.Box[net.liftweb.sitemap.Loc[_]]">location</a>

    <span class="keyword">val</span> <a title="() =&gt; T =&gt; T" id="398465">requestVarFunc</a> = <a href="Vars.scala.html#14779" title="object net.liftweb.http.RequestVarHandler">RequestVarHandler</a>.<a href="Vars.scala.html#398161" title="[T]()() =&gt; T =&gt; T">generateSnapshotRestorer</a><span title="()() =&gt; T =&gt; T" class="delimiter">[</span><a href="#230289" title="T">T</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <a href="#398465" title="(v1: () =&gt; T)T">requestVarFunc</a><span class="delimiter">(</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt;
        <a href="#230290" title="(req: net.liftweb.common.Box[net.liftweb.http.Req], renderVersion: String)(f: =&gt; T)T">executeInScope</a><span class="delimiter">(</span><a href="#398461" title="net.liftweb.common.Box[net.liftweb.http.Req]">currentReq</a>, <a href="#398462" title="String">renderVersion</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#328296" title="()T">f</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[T](req: net.liftweb.common.Box[net.liftweb.http.Req], renderVersion: String)(f: =&gt; T)T" id="230290">executeInScope</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="230292">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="net.liftweb.common.Box[net.liftweb.http.Req]" id="398475">req</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.http.Req]">Box</a><span class="delimiter">[</span>Req<span class="delimiter">]</span>, <a title="String" id="398476">renderVersion</a>: <span title="String">String</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="=&gt; T" id="398477">f</a>: =&gt; T<span class="delimiter">)</span>: <a href="#230292" title="T">T</a> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="()T" id="398486">doExec</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="#230292" title="T">T</a> = <span class="delimiter">{</span>
      <a href="#14488" title="object net.liftweb.http.RenderVersion">RenderVersion</a>.<a href="#345568" title="(value: String)Unit">set</a><span class="delimiter">(</span><a href="#398476" title="String">renderVersion</a><span class="delimiter">)</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="#398477" title="=&gt; T">f</a>
      <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49475" title="=&gt; Map[String,net.liftweb.http.S.AFuncHolder]">functionMap</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#14496" title="LiftSession.this.type" class="keyword">this</a>.<a href="#230223" title="(funcs: Map[String,net.liftweb.http.S.AFuncHolder], uniqueId: String, when: Long)Unit">updateFunctionMap</a><span class="delimiter">(</span><a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49475" title="=&gt; Map[String,net.liftweb.http.S.AFuncHolder]">functionMap</a>,
            <a href="#398476" title="String">renderVersion</a>, <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48788" title="=&gt; Long">millis</a><span class="delimiter">)</span>
          <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49479" title="=&gt; Unit">clearFunctionMap</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <a href="#398475" title="net.liftweb.common.Box[net.liftweb.http.Req]">req</a> <span title="T" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="T">Full</span><span class="delimiter">(</span><a title="net.liftweb.http.Req" id="398493">r</a><span class="delimiter">)</span> =&gt; <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49376" title="(request: net.liftweb.http.Req, session: net.liftweb.http.LiftSession)(f: =&gt; T)T">init</a><span class="delimiter">(</span><a href="#398493" title="net.liftweb.http.Req">r</a>, <a href="#14496" title="net.liftweb.http.LiftSession" class="keyword">this</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#398486" title="()T">doExec</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="T">_</span> =&gt; <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49455" title="(session: net.liftweb.http.LiftSession)(f: =&gt; T)T">initIfUninitted</a><span class="delimiter">(</span><a href="#14496" title="net.liftweb.http.LiftSession" class="keyword">this</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#398486" title="()T">doExec</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(page: String, snippetName: net.liftweb.common.Box[String], attrs: scala.xml.MetaData, wholeTag: scala.xml.NodeSeq, passedKids: scala.xml.NodeSeq)scala.xml.NodeSeq" id="230293">processSnippet</a><span class="delimiter">(</span><a title="String" id="398506">page</a>: <span title="String">String</span>, <a title="net.liftweb.common.Box[String]" id="398507">snippetName</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[String]">Box</a><span class="delimiter">[</span>String<span class="delimiter">]</span>,
                             <a title="scala.xml.MetaData" id="398508">attrs</a>: <span title="scala.xml.MetaData">MetaData</span>,
                             <a title="scala.xml.NodeSeq" id="398509">wholeTag</a>: <span title="scala.xml.NodeSeq">NodeSeq</span>,
                             <a title="scala.xml.NodeSeq" id="398510">passedKids</a>: <span title="scala.xml.NodeSeq">NodeSeq</span><span class="delimiter">)</span>: <span title="scala.xml.NodeSeq">NodeSeq</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Boolean" id="398512">isForm</a> = <span title="=&gt; Boolean">!</span><a href="#398508" title="scala.xml.MetaData">attrs</a>.<span title="(key: String)Option[Seq[scala.xml.Node]]">get</span><span class="delimiter">(</span><span title="java.lang.String(&quot;form&quot;)" class="string">&quot;form&quot;</span><span class="delimiter">)</span>.<span title="=&gt; List[Seq[scala.xml.Node]]">toList</span>.<span title="=&gt; Boolean">isEmpty</span>

    <span class="keyword">val</span> <a title="Boolean" id="398513">eagerEval</a>: <span title="Boolean">Boolean</span> =
      <span class="delimiter">(</span><a href="#398508" title="scala.xml.MetaData">attrs</a>.<span title="(key: String)Option[Seq[scala.xml.Node]]">get</span><span class="delimiter">(</span><span title="java.lang.String(&quot;eager_eval&quot;)" class="string">&quot;eager_eval&quot;</span><span class="delimiter">)</span>.<span title="(f: Seq[scala.xml.Node] =&gt; Boolean)Option[Boolean]">map</span><a href="../../../../common/net/liftweb/common/Box.scala.html#28627" title="(in: Option[Boolean])net.liftweb.common.Box[Boolean]" class="delimiter">(</a><a href="../../../../util/net/liftweb/util/BasicTypesHelpers.scala.html#49092" title="(in: Any)Boolean">toBoolean</a><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27043" title="(alternative: =&gt; net.liftweb.common.Box[Boolean])net.liftweb.common.Box[Boolean]">or</a>
        <a href="#230285" title="(attrs: scala.xml.MetaData, prefix: String, key: String)Option[Seq[scala.xml.Node]]">findNSAttr</a><span class="delimiter">(</span><a href="#398508" title="scala.xml.MetaData">attrs</a>, <span title="java.lang.String(&quot;lift&quot;)" class="string">&quot;lift&quot;</span>, <span title="java.lang.String(&quot;eager_eval&quot;)" class="string">&quot;eager_eval&quot;</span><span class="delimiter">)</span>.<span title="(f: Seq[scala.xml.Node] =&gt; Boolean)Option[Boolean]">map</span><a href="../../../../common/net/liftweb/common/Box.scala.html#28627" title="(in: Option[Boolean])net.liftweb.common.Box[Boolean]" class="delimiter">(</a><a href="../../../../util/net/liftweb/util/BasicTypesHelpers.scala.html#49092" title="(in: Any)Boolean">toBoolean</a><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#28630" title="(in: net.liftweb.common.Box[Boolean])Option[Boolean]">or</a>
        <a href="#230285" title="(attrs: scala.xml.MetaData, prefix: String, key: String)Option[Seq[scala.xml.Node]]">findNSAttr</a><span class="delimiter">(</span><a href="#398508" title="scala.xml.MetaData">attrs</a>, <span title="java.lang.String(&quot;l&quot;)" class="string">&quot;l&quot;</span>, <span title="java.lang.String(&quot;eager_eval&quot;)" class="string">&quot;eager_eval&quot;</span><span class="delimiter">)</span>.<span title="(f: Seq[scala.xml.Node] =&gt; Boolean)Option[Boolean]">map</span><a href="../../../../common/net/liftweb/common/Box.scala.html#28627" title="(in: Option[Boolean])net.liftweb.common.Box[Boolean]" class="delimiter">(</a><a href="../../../../util/net/liftweb/util/BasicTypesHelpers.scala.html#49092" title="(in: Any)Boolean">toBoolean</a><span class="delimiter">)</span>
        <span class="delimiter">)</span> <span title="(default: =&gt; Boolean)Boolean">getOrElse</span> <span title="Boolean(false)" class="keyword">false</span>

    <span class="keyword">val</span> <a title="scala.xml.NodeSeq" id="398514">kids</a> = <span title="scala.xml.NodeSeq" class="keyword">if</span> <span class="delimiter">(</span><a href="#398513" title="Boolean">eagerEval</a><span class="delimiter">)</span> <a href="#230307" title="(page: String, in: scala.xml.NodeSeq)scala.xml.NodeSeq">processSurroundAndInclude</a><span class="delimiter">(</span><a href="#398506" title="String">page</a>, <a href="#398510" title="scala.xml.NodeSeq">passedKids</a><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#398510" title="scala.xml.NodeSeq">passedKids</a>

    <span class="comment">// Locate a snippet as defined by our SiteMap Loc</span>
    <span class="keyword">def</span> <a title="(snippet: String)net.liftweb.common.Box[scala.xml.NodeSeq]" id="398515">locSnippet</a><span class="delimiter">(</span><a title="String" id="398610">snippet</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[scala.xml.NodeSeq]">Box</a><span class="delimiter">[</span>NodeSeq<span class="delimiter">]</span> =
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="net.liftweb.sitemap.Loc[_]" id="398615">loc</a> &lt;- <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27023" title="(f: net.liftweb.sitemap.Loc[_] =&gt; net.liftweb.common.Box[scala.xml.NodeSeq])net.liftweb.common.Box[scala.xml.NodeSeq]">location</a>;
           <a title="scala.xml.NodeSeq =&gt; scala.xml.NodeSeq" id="398622">func</a> &lt;- <a href="#398615" title="net.liftweb.sitemap.Loc[_]">loc</a>.<a href="../sitemap/Loc.scala.html#215920" title="(name: String)net.liftweb.common.Box[scala.xml.NodeSeq =&gt; scala.xml.NodeSeq]">snippet</a><a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: scala.xml.NodeSeq =&gt; scala.xml.NodeSeq =&gt; scala.xml.NodeSeq)net.liftweb.common.Box[scala.xml.NodeSeq]" class="delimiter">(</a><a href="#398610" title="String">snippet</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">yield</span> <a href="#398622" title="(v1: scala.xml.NodeSeq)scala.xml.NodeSeq">func</a><span class="delimiter">(</span><a href="#398514" title="scala.xml.NodeSeq">kids</a><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="(tagName: String)net.liftweb.common.Box[AnyRef]" id="398516">locateAndCacheSnippet</a><span class="delimiter">(</span><a title="String" id="398626">tagName</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[AnyRef]">Box</a><span class="delimiter">[</span>AnyRef<span class="delimiter">]</span> =
      <a href="#230201" title="object LiftSession.this.snippetMap">snippetMap</a>.<a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75375" title="=&gt; Map[String,AnyRef]">is</a>.<span title="(key: String)Option[AnyRef]">get</span><a href="../../../../common/net/liftweb/common/Box.scala.html#28627" title="(in: Option[AnyRef])net.liftweb.common.Box[AnyRef]" class="delimiter">(</a><a href="#398626" title="String">tagName</a><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27043" title="(alternative: =&gt; net.liftweb.common.Box[AnyRef])net.liftweb.common.Box[AnyRef]">or</a> <span class="delimiter">{</span>
        <a href="../../../../util/net/liftweb/util/ListHelpers.scala.html#48877" title="(in: Seq[java.lang.String])(_f: java.lang.String =&gt; net.liftweb.common.Box[AnyRef])net.liftweb.common.Box[AnyRef]">first</a><span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158965" title="=&gt; net.liftweb.http.LiftRules#FactoryMaker[java.lang.String =&gt; List[java.lang.String]]">snippetNamesToSearch</a>.<a href="Factory.scala.html#159330" title="(v1: java.lang.String)List[java.lang.String]">vend</a><span class="delimiter">(</span><a href="#398626" title="String">tagName</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a title="java.lang.String" id="398678">nameToTry</a> =&gt;
            <span class="keyword">val</span> <a title="net.liftweb.common.Box[AnyRef]" id="398679">ret</a> = <a href="#230283" title="(cls: String)net.liftweb.common.Box[AnyRef]">findSnippetInstance</a><span class="delimiter">(</span><a href="#398678" title="java.lang.String">nameToTry</a><span class="delimiter">)</span>
            <span class="comment">// Update the snippetMap so that we reuse the same instance in this request</span>
            <a href="#398679" title="net.liftweb.common.Box[AnyRef]">ret</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27031" title="(f: AnyRef =&gt; Map[String,AnyRef])Unit">foreach</a><span class="delimiter">(</span><a title="AnyRef" id="398684">s</a> =&gt; <a href="#230201" title="object LiftSession.this.snippetMap">snippetMap</a>.<a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75378" title="(what: Map[String,AnyRef])Map[String,AnyRef]">set</a><span class="delimiter">(</span><a href="#230201" title="object LiftSession.this.snippetMap">snippetMap</a>.<a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75375" title="=&gt; Map[String,AnyRef]">is</a>.<span title="(key: String, value: AnyRef)scala.collection.immutable.Map[String,AnyRef]">updated</span><span class="delimiter">(</span><a href="#398626" title="String">tagName</a>, <a href="#398684" title="AnyRef">s</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#398679" title="net.liftweb.common.Box[AnyRef]">ret</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="scala.xml.NodeSeq" id="398517">ret</a>: <span title="scala.xml.NodeSeq">NodeSeq</span> =
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="#398507" title="net.liftweb.common.Box[String]">snippetName</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: String =&gt; scala.xml.NodeSeq)net.liftweb.common.Box[scala.xml.NodeSeq]">map</a><span class="delimiter">(</span><a title="String" id="398727">snippet</a> =&gt;
          <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49484" title="(name: String)(f: =&gt; scala.xml.NodeSeq)scala.xml.NodeSeq">doSnippet</a><span class="delimiter">(</span><a href="#398727" title="String">snippet</a><span class="delimiter">)</span><span class="delimiter">(</span>
            <span class="delimiter">(</span><a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49488" title="(name: String)net.liftweb.common.Box[scala.xml.NodeSeq =&gt; scala.xml.NodeSeq]">locateMappedSnippet</a><span class="delimiter">(</span><a href="#398727" title="String">snippet</a><span class="delimiter">)</span>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: scala.xml.NodeSeq =&gt; scala.xml.NodeSeq =&gt; scala.xml.NodeSeq)net.liftweb.common.Box[scala.xml.NodeSeq]">map</a><span class="delimiter">(</span><a href="#398738" title="(v1: scala.xml.NodeSeq)scala.xml.NodeSeq">_</a><span class="delimiter">(</span><a href="#398514" title="scala.xml.NodeSeq">kids</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27043" title="(alternative: =&gt; net.liftweb.common.Box[scala.xml.NodeSeq])net.liftweb.common.Box[scala.xml.NodeSeq]">or</a>
              <a href="#398515" title="(snippet: String)net.liftweb.common.Box[scala.xml.NodeSeq]">locSnippet</a><span class="delimiter">(</span><a href="#398727" title="String">snippet</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; scala.xml.NodeSeq)scala.xml.NodeSeq">openOr</a><span class="delimiter">(</span>
              <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49481" title="(name: String)net.liftweb.common.Box[scala.xml.NodeSeq =&gt; scala.xml.NodeSeq]">locateSnippet</a><span class="delimiter">(</span><a href="#398727" title="String">snippet</a><span class="delimiter">)</span>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: scala.xml.NodeSeq =&gt; scala.xml.NodeSeq =&gt; scala.xml.NodeSeq)net.liftweb.common.Box[scala.xml.NodeSeq]">map</a><span class="delimiter">(</span><a href="#398753" title="(v1: scala.xml.NodeSeq)scala.xml.NodeSeq">_</a><span class="delimiter">(</span><a href="#398514" title="scala.xml.NodeSeq">kids</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; scala.xml.NodeSeq)scala.xml.NodeSeq">openOr</a> <span class="delimiter">{</span>
                <span class="keyword">val</span> <a href="#398759" title="(String, String)" class="delimiter">(</a><a href="#398758" title="String" id="398759">cls</a>, <a href="#398758" title="String" id="398760">method</a><span class="delimiter">)</span> = <a href="#230279" title="(in: String)(String, String)">splitColonPair</a><span title="(String, String) @unchecked" class="delimiter">(</span><a href="#398727" title="String">snippet</a><span class="delimiter">)</span>
                <span class="delimiter">(</span><a href="#398516" title="(tagName: String)net.liftweb.common.Box[AnyRef]">locateAndCacheSnippet</a><span class="delimiter">(</span><a href="#398759" title="String">cls</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="scala.xml.NodeSeq" class="keyword">match</span> <span class="delimiter">{</span>
                  <span class="comment">// deal with a stateless request when a snippet has</span>
                  <span class="comment">// different behavior in stateless mode</span>
                  <span class="keyword">case</span> <span title="scala.xml.NodeSeq">Full</span><span class="delimiter">(</span><a title="net.liftweb.http.StatelessBehavior" id="398772">inst</a>: <a href="StatefulSnippet.scala.html#14718" title="net.liftweb.http.StatelessBehavior">StatelessBehavior</a><span class="delimiter">)</span> <span class="keyword">if</span> <span title="=&gt; Boolean">!</span><a href="#230327" title="=&gt; Boolean">stateful_?</a> =&gt;
                    <span title="scala.xml.NodeSeq" class="keyword">if</span> <span class="delimiter">(</span><a href="#398772" title="net.liftweb.http.StatelessBehavior">inst</a>.<a href="StatefulSnippet.scala.html#398773" title="=&gt; PartialFunction[String,scala.xml.NodeSeq =&gt; scala.xml.NodeSeq]">statelessDispatch</a>.<span title="(x: String)Boolean">isDefinedAt</span><span class="delimiter">(</span><a href="#398760" title="String">method</a><span class="delimiter">)</span><span class="delimiter">)</span>
                    <a href="#398772" title="net.liftweb.http.StatelessBehavior">inst</a>.<a href="StatefulSnippet.scala.html#398773" title="(v1: String)scala.xml.NodeSeq =&gt; scala.xml.NodeSeq">statelessDispatch</a><span title="(v1: scala.xml.NodeSeq)scala.xml.NodeSeq" class="delimiter">(</span><a href="#398760" title="String">method</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#398514" title="scala.xml.NodeSeq">kids</a><span class="delimiter">)</span> <span class="keyword">else</span> <span title="object scala.xml.NodeSeq">NodeSeq</span>.<span title="=&gt; scala.xml.NodeSeq">Empty</span>

                  <span class="keyword">case</span> <span title="scala.xml.NodeSeq">Full</span><span class="delimiter">(</span><a title="net.liftweb.http.StatefulSnippet" id="398778">inst</a>: <a href="StatefulSnippet.scala.html#14713" title="net.liftweb.http.StatefulSnippet">StatefulSnippet</a><span class="delimiter">)</span> <span class="keyword">if</span> <span title="=&gt; Boolean">!</span><a href="#230327" title="=&gt; Boolean">stateful_?</a> =&gt;
                    <a href="#230284" title="(page: String, snippetName: net.liftweb.common.Box[String], why: net.liftweb.http.LiftRules.SnippetFailures.Value, addlMsg: scala.xml.NodeSeq, whole: scala.xml.NodeSeq)scala.xml.NodeSeq">reportSnippetError</a><span class="delimiter">(</span><a href="#398506" title="String">page</a>, <a href="#398507" title="net.liftweb.common.Box[String]">snippetName</a>,
                      <a href="LiftRules.scala.html#14376" title="object net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158809" title="object net.liftweb.http.LiftRules.SnippetFailures">SnippetFailures</a>.<a href="LiftRules.scala.html#326669" title="=&gt; net.liftweb.http.LiftRules.SnippetFailures.Value">StateInStateless</a>,
                      <span title="object scala.xml.NodeSeq">NodeSeq</span>.<span title="=&gt; scala.xml.NodeSeq">Empty</span>,
                      <a href="#398509" title="scala.xml.NodeSeq">wholeTag</a><span class="delimiter">)</span>

                  <span class="keyword">case</span> <span title="scala.xml.NodeSeq">Full</span><span class="delimiter">(</span><a title="net.liftweb.http.StatefulSnippet" id="398780">inst</a>: <a href="StatefulSnippet.scala.html#14713" title="net.liftweb.http.StatefulSnippet">StatefulSnippet</a><span class="delimiter">)</span> =&gt;
                    <span title="scala.xml.NodeSeq" class="keyword">if</span> <span class="delimiter">(</span><a href="#398780" title="net.liftweb.http.StatefulSnippet">inst</a>.<a href="StatefulSnippet.scala.html#193183" title="=&gt; inst.DispatchIt">dispatch</a>.<span title="(x: String)Boolean">isDefinedAt</span><span class="delimiter">(</span><a href="#398760" title="String">method</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                      <span class="keyword">val</span> <a title="scala.xml.NodeSeq" id="398782">res</a> = <a href="#398780" title="net.liftweb.http.StatefulSnippet">inst</a>.<a href="StatefulSnippet.scala.html#193183" title="(v1: String)scala.xml.NodeSeq =&gt; scala.xml.NodeSeq">dispatch</a><span title="(v1: scala.xml.NodeSeq)scala.xml.NodeSeq" class="delimiter">(</span><a href="#398760" title="String">method</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#398514" title="scala.xml.NodeSeq">kids</a><span class="delimiter">)</span>

                      <a href="#398780" title="net.liftweb.http.StatefulSnippet">inst</a>.<a href="StatefulSnippet.scala.html#193193" title="(isForm: Boolean, res: scala.xml.NodeSeq, toMerge: =&gt; scala.xml.NodeSeq)scala.xml.NodeSeq">mergeIntoForm</a><span class="delimiter">(</span><a href="#398512" title="Boolean">isForm</a>, <a href="#398782" title="scala.xml.NodeSeq">res</a>, <a href="SHtml.scala.html#14660" title="object net.liftweb.http.SHtml">SHtml</a>.<a href="SHtml.scala.html#152860" title="(func: () =&gt; Any, attrs: net.liftweb.http.SHtml.ElemAttr*)scala.xml.Elem">hidden</a><span class="delimiter">(</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#398780" title="net.liftweb.http.StatefulSnippet">inst</a>.<a href="StatefulSnippet.scala.html#193188" title="()Unit">registerThisSnippet</a><span class="delimiter">)</span><span class="delimiter">)</span>
                      <span class="comment">/* (if (isForm &amp;&amp; !res.isEmpty) SHtml.hidden(() =&gt; inst.registerThisSnippet) else NodeSeq.Empty) ++
                      res*/</span>
                    <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#230284" title="(page: String, snippetName: net.liftweb.common.Box[String], why: net.liftweb.http.LiftRules.SnippetFailures.Value, addlMsg: scala.xml.NodeSeq, whole: scala.xml.NodeSeq)scala.xml.NodeSeq">reportSnippetError</a><span class="delimiter">(</span><a href="#398506" title="String">page</a>, <a href="#398507" title="net.liftweb.common.Box[String]">snippetName</a>,
                      <a href="LiftRules.scala.html#14376" title="object net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158809" title="object net.liftweb.http.LiftRules.SnippetFailures">SnippetFailures</a>.<a href="LiftRules.scala.html#326659" title="=&gt; net.liftweb.http.LiftRules.SnippetFailures.Value">StatefulDispatchNotMatched</a>,
                      <span title="object scala.xml.NodeSeq">NodeSeq</span>.<span title="=&gt; scala.xml.NodeSeq">Empty</span>,
                      <a href="#398509" title="scala.xml.NodeSeq">wholeTag</a><span class="delimiter">)</span>

                  <span class="keyword">case</span> <span title="scala.xml.NodeSeq">Full</span><span class="delimiter">(</span><a title="net.liftweb.http.DispatchSnippet" id="398793">inst</a>: <a href="StatefulSnippet.scala.html#14717" title="net.liftweb.http.DispatchSnippet">DispatchSnippet</a><span class="delimiter">)</span> =&gt;
                    <span title="scala.xml.NodeSeq" class="keyword">if</span> <span class="delimiter">(</span><a href="#398793" title="net.liftweb.http.DispatchSnippet">inst</a>.<a href="StatefulSnippet.scala.html#193183" title="=&gt; inst.DispatchIt">dispatch</a>.<span title="(x: String)Boolean">isDefinedAt</span><span class="delimiter">(</span><a href="#398760" title="String">method</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#398793" title="net.liftweb.http.DispatchSnippet">inst</a>.<a href="StatefulSnippet.scala.html#193183" title="(v1: String)scala.xml.NodeSeq =&gt; scala.xml.NodeSeq">dispatch</a><span title="(v1: scala.xml.NodeSeq)scala.xml.NodeSeq" class="delimiter">(</span><a href="#398760" title="String">method</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#398514" title="scala.xml.NodeSeq">kids</a><span class="delimiter">)</span>
                    <span class="keyword">else</span> <a href="#230284" title="(page: String, snippetName: net.liftweb.common.Box[String], why: net.liftweb.http.LiftRules.SnippetFailures.Value, addlMsg: scala.xml.NodeSeq, whole: scala.xml.NodeSeq)scala.xml.NodeSeq">reportSnippetError</a><span class="delimiter">(</span><a href="#398506" title="String">page</a>, <a href="#398507" title="net.liftweb.common.Box[String]">snippetName</a>,
                      <a href="LiftRules.scala.html#14376" title="object net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158809" title="object net.liftweb.http.LiftRules.SnippetFailures">SnippetFailures</a>.<a href="LiftRules.scala.html#326659" title="=&gt; net.liftweb.http.LiftRules.SnippetFailures.Value">StatefulDispatchNotMatched</a>,
                      <span title="object scala.xml.NodeSeq">NodeSeq</span>.<span title="=&gt; scala.xml.NodeSeq">Empty</span>,
                      <a href="#398509" title="scala.xml.NodeSeq">wholeTag</a><span class="delimiter">)</span>

                  <span class="keyword">case</span> <span title="scala.xml.NodeSeq">Full</span><span class="delimiter">(</span><a title="AnyRef" id="398798">inst</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
                    <span class="keyword">def</span> <a title="=&gt; net.liftweb.common.Box[scala.xml.NodeSeq]" id="398799">gotIt</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[scala.xml.NodeSeq]">Box</a><span class="delimiter">[</span>NodeSeq<span class="delimiter">]</span> =
                      <span class="keyword">for</span> <span class="delimiter">{</span>
                        <a title="java.lang.reflect.Method" id="398858">meth</a> &lt;- <a href="../../../../util/net/liftweb/util/ControlHelpers.scala.html#48608" title="(f: =&gt; java.lang.reflect.Method)net.liftweb.common.Box[java.lang.reflect.Method]">tryo</a><a href="../../../../common/net/liftweb/common/Box.scala.html#37111" title="(f: java.lang.reflect.Method =&gt; scala.xml.NodeSeq)net.liftweb.common.Box[scala.xml.NodeSeq]" class="delimiter">(</a><a href="#398798" title="AnyRef">inst</a>.<span title="()java.lang.Class[_]">getClass</span>.<span title="(x$1: java.lang.String, x$2: &lt;repeated...&gt;[java.lang.Class[_]])java.lang.reflect.Method">getMethod</span><span class="delimiter">(</span><a href="#398760" title="String">method</a><span class="delimiter">)</span><span class="delimiter">)</span>
                        <span class="keyword">if</span> classOf<span title="java.lang.Class[net.liftweb.util.package.CssBindFunc](classOf[net.liftweb.util.CssSel])" class="delimiter">[</span>CssBindFunc<span class="delimiter">]</span>.<span title="(x$1: java.lang.Class[_])Boolean">isAssignableFrom</span><span class="delimiter">(</span><a href="#398858" title="java.lang.reflect.Method">meth</a>.<span title="()java.lang.Class[_]">getReturnType</span><span class="delimiter">)</span>
                      <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="#398858" title="java.lang.reflect.Method">meth</a>.<span title="(x$1: Any, x$2: &lt;repeated...&gt;[java.lang.Object])java.lang.Object">invoke</span><span class="delimiter">(</span><a href="#398798" title="AnyRef">inst</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="net.liftweb.util.package.CssBindFunc" class="delimiter">[</span><a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#13142" title="net.liftweb.util.package.CssBindFunc">CssBindFunc</a><span class="delimiter">]</span>.<span title="(v1: scala.xml.NodeSeq)scala.xml.NodeSeq">apply</span><span class="delimiter">(</span><a href="#398514" title="scala.xml.NodeSeq">kids</a><span class="delimiter">)</span>

                    <span class="keyword">import</span> java.lang.reflect.<span class="delimiter">{</span>Type, ParameterizedType<span class="delimiter">}</span>

                    <span class="keyword">def</span> <a title="(tpe: java.lang.reflect.Type)Boolean" id="398801">isFunc1</a><span class="delimiter">(</span><a title="java.lang.reflect.Type" id="398861">tpe</a>: <span title="java.lang.reflect.Type">Type</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <a href="#398861" title="java.lang.reflect.Type">tpe</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
                      <span class="keyword">case</span> <span title="Boolean(false)" class="keyword">null</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
                      <span class="keyword">case</span> <a title="Boolean" id="398862">c</a>: <span title="Class[_]">Class</span><span class="delimiter">[</span>_<span class="delimiter">]</span> =&gt; classOf<span title="java.lang.Class[Function1[_, _]](classOf[scala.Function1])" class="delimiter">[</span>Function1<span class="delimiter">[</span>_, _<span class="delimiter">]</span><span class="delimiter">]</span> <span title="(x$1: java.lang.Class[_])Boolean">isAssignableFrom</span> <a href="#398862" title="Class[_]">c</a>
                      <span class="keyword">case</span> <span title="Boolean(false)">_</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
                    <span class="delimiter">}</span>

                    <span class="keyword">def</span> <a title="(tpe: java.lang.reflect.Type)Boolean" id="398802">isNodeSeq</a><span class="delimiter">(</span><a title="java.lang.reflect.Type" id="398873">tpe</a>: <span title="java.lang.reflect.Type">Type</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <a href="#398873" title="java.lang.reflect.Type">tpe</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
                      <span class="keyword">case</span> <span title="Boolean(false)" class="keyword">null</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
                      <span class="keyword">case</span> <a title="Boolean" id="398874">c</a>: <span title="Class[_]">Class</span><span class="delimiter">[</span>_<span class="delimiter">]</span> =&gt; classOf<span title="java.lang.Class[scala.xml.NodeSeq](classOf[scala.xml.NodeSeq])" class="delimiter">[</span>NodeSeq<span class="delimiter">]</span> <span title="(x$1: java.lang.Class[_])Boolean">isAssignableFrom</span> <a href="#398874" title="Class[_]">c</a>
                      <span class="keyword">case</span> <span title="Boolean(false)">_</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
                    <span class="delimiter">}</span>

                    <span class="keyword">def</span> <a title="(tpe: java.lang.reflect.Type)Boolean" id="398803">testGeneric</a><span class="delimiter">(</span><a title="java.lang.reflect.Type" id="398877">tpe</a>: <span title="java.lang.reflect.Type">Type</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <a href="#398877" title="java.lang.reflect.Type">tpe</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
                      <span class="keyword">case</span> <span title="Boolean(false)" class="keyword">null</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
                      <span class="keyword">case</span> <a title="Boolean" id="398878">pt</a>: <span title="java.lang.reflect.ParameterizedType">ParameterizedType</span> =&gt;
                        <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#398801" title="(tpe: java.lang.reflect.Type)Boolean">isFunc1</a><span class="delimiter">(</span><a href="#398878" title="java.lang.reflect.ParameterizedType">pt</a>.<span title="()java.lang.reflect.Type">getRawType</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
                          <a href="#398878" title="java.lang.reflect.ParameterizedType">pt</a>.<span title="()Array[java.lang.reflect.Type]">getActualTypeArguments</span>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(2)" class="int">2</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
                          <a href="#398802" title="(tpe: java.lang.reflect.Type)Boolean">isNodeSeq</a><span class="delimiter">(</span><a href="#398878" title="java.lang.reflect.ParameterizedType">pt</a>.<span title="()Array[java.lang.reflect.Type]">getActualTypeArguments</span><span title="(i: Int)java.lang.reflect.Type" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
                          <a href="#398802" title="(tpe: java.lang.reflect.Type)Boolean">isNodeSeq</a><span class="delimiter">(</span><a href="#398878" title="java.lang.reflect.ParameterizedType">pt</a>.<span title="()Array[java.lang.reflect.Type]">getActualTypeArguments</span><span title="(i: Int)java.lang.reflect.Type" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                          <span title="Boolean(true)" class="keyword">true</span>
                        <span class="keyword">else</span> <a href="#398803" title="(tpe: java.lang.reflect.Type)Boolean">testGeneric</a><span class="delimiter">(</span><a href="#398878" title="java.lang.reflect.ParameterizedType">pt</a>.<span title="()java.lang.reflect.Type">getRawType</span><span class="delimiter">)</span>

                      <span class="keyword">case</span> <a title="Boolean" id="398884">clz</a>: <span title="Class[_]">Class</span><span class="delimiter">[</span>_<span class="delimiter">]</span> =&gt;
                        <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#398884" title="Class[_]">clz</a> <span title="(x$1: AnyRef)Boolean">==</span> classOf<span title="java.lang.Class[java.lang.Object](classOf[java.lang.Object])" class="delimiter">[</span>Object<span class="delimiter">]</span><span class="delimiter">)</span> <span title="Boolean(false)" class="keyword">false</span>
                        <span class="keyword">else</span> <a href="#398884" title="Class[_]">clz</a>.<span title="(xs: Array[java.lang.reflect.Type])scala.collection.mutable.ArrayOps[java.lang.reflect.Type]">getGenericInterfaces</span>.<span title="(p: java.lang.reflect.Type =&gt; Boolean)Option[java.lang.reflect.Type]">find</span><span class="delimiter">(</span><a href="#398803" title="(tpe: java.lang.reflect.Type)Boolean">testGeneric</a><span class="delimiter">)</span> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
                          <span class="keyword">case</span> <span title="Boolean(true)">Some</span><span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
                          <span class="keyword">case</span> <span title="Boolean">_</span> =&gt; <a href="#398803" title="(tpe: java.lang.reflect.Type)Boolean">testGeneric</a><span class="delimiter">(</span><a href="#398884" title="Class[_]">clz</a>.<span title="()java.lang.Class[_ &gt;: _]">getSuperclass</span><span class="delimiter">)</span>
                        <span class="delimiter">}</span>

                      <span class="keyword">case</span> <span title="Boolean(false)">_</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
                    <span class="delimiter">}</span>

                    <span class="keyword">def</span> <a title="(meth: java.lang.reflect.Method)Boolean" id="398804">isFuncNodeSeq</a><span class="delimiter">(</span><a title="java.lang.reflect.Method" id="399162">meth</a>: <span title="java.lang.reflect.Method">Method</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
                      <span class="delimiter">(</span>classOf<span title="java.lang.Class[Function1[_, _]](classOf[scala.Function1])" class="delimiter">[</span>Function1<span class="delimiter">[</span>_, _<span class="delimiter">]</span><span class="delimiter">]</span> <span title="(x$1: java.lang.Class[_])Boolean">isAssignableFrom</span> <a href="#399162" title="java.lang.reflect.Method">meth</a>.<span title="()java.lang.Class[_]">getReturnType</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
                        <a href="#398803" title="(tpe: java.lang.reflect.Type)Boolean">testGeneric</a><span class="delimiter">(</span><a href="#399162" title="java.lang.reflect.Method">meth</a>.<span title="()java.lang.reflect.Type">getGenericReturnType</span><span class="delimiter">)</span>
                    <span class="delimiter">}</span>


                    <span class="keyword">def</span> <a title="=&gt; net.liftweb.common.Box[scala.xml.NodeSeq]" id="398805">nodeSeqFunc</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[scala.xml.NodeSeq]">Box</a><span class="delimiter">[</span>NodeSeq<span class="delimiter">]</span> =
                      <span class="keyword">for</span> <span class="delimiter">{</span>
                        <a title="java.lang.reflect.Method" id="399219">meth</a> &lt;- <a href="../../../../util/net/liftweb/util/ControlHelpers.scala.html#48608" title="(f: =&gt; java.lang.reflect.Method)net.liftweb.common.Box[java.lang.reflect.Method]">tryo</a><a href="../../../../common/net/liftweb/common/Box.scala.html#37111" title="(f: java.lang.reflect.Method =&gt; scala.xml.NodeSeq)net.liftweb.common.Box[scala.xml.NodeSeq]" class="delimiter">(</a><a href="#398798" title="AnyRef">inst</a>.<span title="()java.lang.Class[_]">getClass</span>.<span title="(x$1: java.lang.String, x$2: &lt;repeated...&gt;[java.lang.Class[_]])java.lang.reflect.Method">getMethod</span><span class="delimiter">(</span><a href="#398760" title="String">method</a><span class="delimiter">)</span><span class="delimiter">)</span>
                        <span class="keyword">if</span> <a href="#398804" title="(meth: java.lang.reflect.Method)Boolean">isFuncNodeSeq</a><span class="delimiter">(</span><a href="#399219" title="java.lang.reflect.Method">meth</a><span class="delimiter">)</span>
                      <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="#399219" title="java.lang.reflect.Method">meth</a>.<span title="(x$1: Any, x$2: &lt;repeated...&gt;[java.lang.Object])java.lang.Object">invoke</span><span class="delimiter">(</span><a href="#398798" title="AnyRef">inst</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="scala.xml.NodeSeq =&gt; scala.xml.NodeSeq" class="delimiter">[</span><span title="scala.xml.NodeSeq =&gt; scala.xml.NodeSeq">Function1</span><span class="delimiter">[</span>NodeSeq,
                        NodeSeq<span class="delimiter">]</span><span class="delimiter">]</span>.<span title="(v1: scala.xml.NodeSeq)scala.xml.NodeSeq">apply</span><span class="delimiter">(</span><a href="#398514" title="scala.xml.NodeSeq">kids</a><span class="delimiter">)</span>


                    <span class="delimiter">(</span><a href="#398799" title="=&gt; net.liftweb.common.Box[scala.xml.NodeSeq]">gotIt</a> <a href="../../../../common/net/liftweb/common/Box.scala.html#27043" title="(alternative: =&gt; net.liftweb.common.Box[scala.xml.NodeSeq])net.liftweb.common.Box[scala.xml.NodeSeq]">or</a> <a href="#398805" title="=&gt; net.liftweb.common.Box[scala.xml.NodeSeq]">nodeSeqFunc</a><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; scala.xml.NodeSeq)scala.xml.NodeSeq">openOr</a> <span class="delimiter">{</span>

                      <span class="keyword">val</span> <a title="Array[AnyRef]" id="399227">ar</a>: <span title="Array[AnyRef]">Array</span><span class="delimiter">[</span>AnyRef<span class="delimiter">]</span> = <span title="(xs: scala.xml.Group*)List[scala.xml.Group]">List</span><span class="delimiter">(</span><span title="(nodes: Seq[scala.xml.Node])scala.xml.Group">Group</span><span class="delimiter">(</span><a href="#398514" title="scala.xml.NodeSeq">kids</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(implicit evidence$1: ClassManifest[AnyRef])Array[AnyRef]">toArray</span>
                      <span class="delimiter">(</span><span class="delimiter">(</span><a href="../../../../util/net/liftweb/util/Helpers.scala.html#13346" title="object net.liftweb.util.Helpers">Helpers</a>.<a href="../../../../util/net/liftweb/util/ClassHelpers.scala.html#48581" title="(clz: Class[?0], inst: AnyRef, meth: String, params: Array[AnyRef])net.liftweb.common.Box[Any]">invokeMethod</a><span class="delimiter">(</span><a href="#398798" title="AnyRef">inst</a>.<span title="()java.lang.Class[_]">getClass</span>, <a href="#398798" title="AnyRef">inst</a>, <a href="#398760" title="String">method</a>, <a href="#399227" title="Array[AnyRef]">ar</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27043" title="(alternative: =&gt; net.liftweb.common.Box[Any])net.liftweb.common.Box[Any]">or</a>
                        <a href="../../../../util/net/liftweb/util/Helpers.scala.html#13346" title="object net.liftweb.util.Helpers">Helpers</a>.<a href="../../../../util/net/liftweb/util/ClassHelpers.scala.html#48578" title="(clz: Class[?0], inst: AnyRef, meth: String)net.liftweb.common.Box[Any]">invokeMethod</a><span class="delimiter">(</span><a href="#398798" title="AnyRef">inst</a>.<span title="()java.lang.Class[_]">getClass</span>, <a href="#398798" title="AnyRef">inst</a>, <a href="#398760" title="String">method</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="scala.xml.NodeSeq" class="keyword">match</span> <span class="delimiter">{</span>
                        <span class="keyword">case</span> <a href="../../../../util/net/liftweb/util/HttpHelpers.scala.html#298037" title="scala.xml.NodeSeq">CheckNodeSeq</a><span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="399313">md</a><span class="delimiter">)</span> =&gt; <a href="#399313" title="scala.xml.NodeSeq">md</a>
                        <span class="keyword">case</span> <a title="scala.xml.NodeSeq" id="399314">it</a> =&gt;
                          <span class="keyword">val</span> <a title="List[java.lang.String]" id="399315">intersection</a> = <span title="List[java.lang.String]" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../../util/net/liftweb/util/Props.scala.html#13579" title="object net.liftweb.util.Props">Props</a>.<a href="../../../../util/net/liftweb/util/Props.scala.html#151319" title="=&gt; Boolean">devMode</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                            <span class="keyword">val</span> <a title="List[java.lang.String]" id="399316">methodNames</a> = <a href="#398798" title="AnyRef">inst</a>.<span title="()java.lang.Class[_]">getClass</span>.<span title="()Array[java.lang.reflect.Method]">getMethods</span><span title="(xs: Array[java.lang.reflect.Method])scala.collection.mutable.ArrayOps[java.lang.reflect.Method]" class="delimiter">(</span><span class="delimiter">)</span>.<span title="(f: java.lang.reflect.Method =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Array[java.lang.reflect.Method],java.lang.String,Array[java.lang.String]])Array[java.lang.String]">map</span><span title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">(</span><a href="#399765" title="java.lang.reflect.Method">_</a>.<span title="()java.lang.String">getName</span><span class="delimiter">)</span>.<span title="=&gt; List[java.lang.String]">toList</span>.<span title="=&gt; List[java.lang.String]">distinct</span>
                            <span class="keyword">val</span> <a title="List[String]" id="399317">methodAlts</a> = <span title="(xs: String*)List[String]">List</span><span class="delimiter">(</span><a href="#398760" title="String">method</a>, <a href="../../../../util/net/liftweb/util/Helpers.scala.html#13346" title="object net.liftweb.util.Helpers">Helpers</a>.<a href="../../../../util/net/liftweb/util/StringHelpers.scala.html#48841" title="(name: String)String">camelify</a><span class="delimiter">(</span><a href="#398760" title="String">method</a><span class="delimiter">)</span>,
                              <a href="../../../../util/net/liftweb/util/Helpers.scala.html#13346" title="object net.liftweb.util.Helpers">Helpers</a>.<a href="../../../../util/net/liftweb/util/StringHelpers.scala.html#48842" title="(name: String)String">camelifyMethod</a><span class="delimiter">(</span><a href="#398760" title="String">method</a><span class="delimiter">)</span><span class="delimiter">)</span>
                            <a href="#399316" title="List[java.lang.String]">methodNames</a> <span title="(that: scala.collection.GenSeq[java.lang.String])List[java.lang.String]">intersect</span> <a href="#399317" title="List[String]">methodAlts</a>
                          <span class="delimiter">}</span> <span class="keyword">else</span> <span title="object Nil">Nil</span>

                          <a href="#230284" title="(page: String, snippetName: net.liftweb.common.Box[String], why: net.liftweb.http.LiftRules.SnippetFailures.Value, addlMsg: scala.xml.NodeSeq, whole: scala.xml.NodeSeq)scala.xml.NodeSeq">reportSnippetError</a><span class="delimiter">(</span><a href="#398506" title="String">page</a>, <a href="#398507" title="net.liftweb.common.Box[String]">snippetName</a>,
                            <a href="LiftRules.scala.html#14376" title="object net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158809" title="object net.liftweb.http.LiftRules.SnippetFailures">SnippetFailures</a>.<a href="LiftRules.scala.html#326661" title="=&gt; net.liftweb.http.LiftRules.SnippetFailures.Value">MethodNotFound</a>,
                            <span title="scala.xml.NodeSeq" class="keyword">if</span> <span class="delimiter">(</span><a href="#399315" title="List[java.lang.String]">intersection</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span title="object scala.xml.NodeSeq">NodeSeq</span>.<span title="=&gt; scala.xml.NodeSeq">Empty</span>
                            <span class="keyword">else</span>
                              &lt;<a title="scala.xml.Elem" id="399922">div</a>&gt;<span title="scala.xml.Text">There</span> are possible matching methods <span class="delimiter">(</span>
                                <span class="delimiter">{</span><a href="#399315" title="List[java.lang.String]">intersection</a><span class="delimiter">}</span>
                                <span class="delimiter">)</span>,
                                but none has the required signature:
                                &lt;<a title="scala.xml.Elem" id="399923">pre</a>&gt;<span title="scala.xml.Text" class="keyword">def</span>
                                  <span class="delimiter">{</span><a href="#398760" title="String">method</a><span class="delimiter">}</span>
                                  <span class="delimiter">(</span>in: NodeSeq<span class="delimiter">)</span>: NodeSeq&lt;/pre&gt;
                              &lt;/div&gt;,
                            <a href="#398509" title="scala.xml.NodeSeq">wholeTag</a><span class="delimiter">)</span>
                      <span class="delimiter">}</span>
                    <span class="delimiter">}</span>
                  <span class="delimiter">}</span>
                  <span class="keyword">case</span> <span title="scala.xml.NodeSeq">Failure</span><span class="delimiter">(</span>_, Full<span class="delimiter">(</span><a title="Throwable" id="399926">exception</a><span class="delimiter">)</span>, _<span class="delimiter">)</span> =&gt; <a href="../../../../common/net/liftweb/common/Logging.scala.html#19845" title="=&gt; net.liftweb.common.Logger">logger</a>.<a href="../../../../common/net/liftweb/common/Logging.scala.html#31955" title="(msg: =&gt; AnyRef, t: Throwable)Unit">warn</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Snippet instantiation error&quot;)" class="string">&quot;Snippet instantiation error&quot;</span>, <a href="#399926" title="Throwable">exception</a><span class="delimiter">)</span>
                  <a href="#230284" title="(page: String, snippetName: net.liftweb.common.Box[String], why: net.liftweb.http.LiftRules.SnippetFailures.Value, addlMsg: scala.xml.NodeSeq, whole: scala.xml.NodeSeq)scala.xml.NodeSeq">reportSnippetError</a><span class="delimiter">(</span><a href="#398506" title="String">page</a>, <a href="#398507" title="net.liftweb.common.Box[String]">snippetName</a>,
                    <a href="LiftRules.scala.html#14376" title="object net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158809" title="object net.liftweb.http.LiftRules.SnippetFailures">SnippetFailures</a>.<a href="LiftRules.scala.html#326665" title="=&gt; net.liftweb.http.LiftRules.SnippetFailures.Value">InstantiationException</a>,
                    <span title="object scala.xml.NodeSeq">NodeSeq</span>.<span title="=&gt; scala.xml.NodeSeq">Empty</span>,
                    <a href="#398509" title="scala.xml.NodeSeq">wholeTag</a><span class="delimiter">)</span>

                  <span class="keyword">case</span> <span title="scala.xml.NodeSeq">_</span> =&gt; <a href="#230284" title="(page: String, snippetName: net.liftweb.common.Box[String], why: net.liftweb.http.LiftRules.SnippetFailures.Value, addlMsg: scala.xml.NodeSeq, whole: scala.xml.NodeSeq)scala.xml.NodeSeq">reportSnippetError</a><span class="delimiter">(</span><a href="#398506" title="String">page</a>, <a href="#398507" title="net.liftweb.common.Box[String]">snippetName</a>,
                    <a href="LiftRules.scala.html#14376" title="object net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158809" title="object net.liftweb.http.LiftRules.SnippetFailures">SnippetFailures</a>.<a href="LiftRules.scala.html#326657" title="=&gt; net.liftweb.http.LiftRules.SnippetFailures.Value">ClassNotFound</a>,
                    <span title="object scala.xml.NodeSeq">NodeSeq</span>.<span title="=&gt; scala.xml.NodeSeq">Empty</span>,
                    <a href="#398509" title="scala.xml.NodeSeq">wholeTag</a><span class="delimiter">)</span>

                <span class="delimiter">}</span>
              <span class="delimiter">}</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; scala.xml.NodeSeq)scala.xml.NodeSeq">openOr</a> <span class="delimiter">{</span>
          <a href="#230284" title="(page: String, snippetName: net.liftweb.common.Box[String], why: net.liftweb.http.LiftRules.SnippetFailures.Value, addlMsg: scala.xml.NodeSeq, whole: scala.xml.NodeSeq)scala.xml.NodeSeq">reportSnippetError</a><span class="delimiter">(</span><a href="#398506" title="String">page</a>, <a href="#398507" title="net.liftweb.common.Box[String]">snippetName</a>,
            <a href="LiftRules.scala.html#14376" title="object net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158809" title="object net.liftweb.http.LiftRules.SnippetFailures">SnippetFailures</a>.<a href="LiftRules.scala.html#326663" title="=&gt; net.liftweb.http.LiftRules.SnippetFailures.Value">NoNameSpecified</a>,
            <span title="object scala.xml.NodeSeq">NodeSeq</span>.<span title="=&gt; scala.xml.NodeSeq">Empty</span>,
            <a href="#398509" title="scala.xml.NodeSeq">wholeTag</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="#399943" title="scala.xml.NodeSeq">ExclosedSnippetFailure</a><span class="delimiter">(</span><a title="net.liftweb.http.SnippetFailureException" id="399947">e</a><span class="delimiter">)</span> =&gt;
          <a href="#230284" title="(page: String, snippetName: net.liftweb.common.Box[String], why: net.liftweb.http.LiftRules.SnippetFailures.Value, addlMsg: scala.xml.NodeSeq, whole: scala.xml.NodeSeq)scala.xml.NodeSeq">reportSnippetError</a><span class="delimiter">(</span><a href="#398506" title="String">page</a>, <a href="#398507" title="net.liftweb.common.Box[String]">snippetName</a>,
            <a href="#399947" title="net.liftweb.http.SnippetFailureException">e</a>.<a href="Templates.scala.html#326382" title="=&gt; net.liftweb.http.LiftRules.SnippetFailures.Value">snippetFailure</a>,
            <a href="#399947" title="net.liftweb.http.SnippetFailureException">e</a>.<a href="Templates.scala.html#326383" title="=&gt; scala.xml.NodeSeq">buildStackTrace</a>,
            <a href="#398509" title="scala.xml.NodeSeq">wholeTag</a><span class="delimiter">)</span>
          
        <span class="keyword">case</span> <a title="scala.xml.NodeSeq" id="399948">e</a>: <a href="Templates.scala.html#14736" title="net.liftweb.http.SnippetFailureException">SnippetFailureException</a> =&gt;
          <a href="#230284" title="(page: String, snippetName: net.liftweb.common.Box[String], why: net.liftweb.http.LiftRules.SnippetFailures.Value, addlMsg: scala.xml.NodeSeq, whole: scala.xml.NodeSeq)scala.xml.NodeSeq">reportSnippetError</a><span class="delimiter">(</span><a href="#398506" title="String">page</a>, <a href="#398507" title="net.liftweb.common.Box[String]">snippetName</a>,
            <a href="#399948" title="net.liftweb.http.SnippetFailureException">e</a>.<a href="Templates.scala.html#326382" title="=&gt; net.liftweb.http.LiftRules.SnippetFailures.Value">snippetFailure</a>,
            <a href="#399948" title="net.liftweb.http.SnippetFailureException">e</a>.<a href="Templates.scala.html#326383" title="=&gt; scala.xml.NodeSeq">buildStackTrace</a>,
            <a href="#398509" title="scala.xml.NodeSeq">wholeTag</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(in: scala.xml.MetaData)scala.xml.MetaData" id="398518">checkMultiPart</a><span class="delimiter">(</span><a title="scala.xml.MetaData" id="399949">in</a>: <span title="scala.xml.MetaData">MetaData</span><span class="delimiter">)</span>: <span title="scala.xml.MetaData">MetaData</span> = <a href="#399949" title="scala.xml.MetaData">in</a>.<span title="(f: scala.xml.MetaData =&gt; Boolean)scala.xml.MetaData">filter</span><span class="delimiter">(</span><a href="#399953" title="scala.xml.MetaData">_</a>.<span title="=&gt; String">key</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;multipart&quot;)" class="string">&quot;multipart&quot;</span><span class="delimiter">)</span>.<span title="=&gt; List[scala.xml.MetaData]">toList</span> <span title="scala.xml.MetaData" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="scala.xml.Null.type">Nil</span> =&gt; <span title="object scala.xml.Null">Null</span>
      <span class="keyword">case</span> <a title="scala.xml.UnprefixedAttribute" id="399960">x</a> =&gt; <span title="scala.xml.UnprefixedAttribute" class="keyword">new</span> <span title="scala.xml.UnprefixedAttribute">UnprefixedAttribute</span><span class="delimiter">(</span><span title="java.lang.String(&quot;enctype&quot;)" class="string">&quot;enctype&quot;</span>, <span title="(_data: String)scala.xml.Text">Text</span><span class="delimiter">(</span><span title="java.lang.String(&quot;multipart/form-data&quot;)" class="string">&quot;multipart/form-data&quot;</span><span class="delimiter">)</span>, <span title="object scala.xml.Null">Null</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(attr_name: String, in: scala.xml.MetaData, base: scala.xml.MetaData)scala.xml.MetaData" id="398519">checkAttr</a><span class="delimiter">(</span><a title="String" id="399967">attr_name</a>: <span title="String">String</span>, <a title="scala.xml.MetaData" id="399968">in</a>: <span title="scala.xml.MetaData">MetaData</span>, <a title="scala.xml.MetaData" id="399969">base</a>: <span title="scala.xml.MetaData">MetaData</span><span class="delimiter">)</span>: <span title="scala.xml.MetaData">MetaData</span> =
      <a href="#399968" title="scala.xml.MetaData">in</a>.<span title="(f: scala.xml.MetaData =&gt; Boolean)scala.xml.MetaData">filter</span><span class="delimiter">(</span><a href="#399973" title="scala.xml.MetaData">_</a>.<span title="=&gt; String">key</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#399967" title="String">attr_name</a><span class="delimiter">)</span>.<span title="=&gt; List[scala.xml.MetaData]">toList</span> <span title="scala.xml.MetaData" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="scala.xml.MetaData">Nil</span> =&gt; <a href="#399969" title="scala.xml.MetaData">base</a>
        <span class="keyword">case</span> <a title="scala.xml.UnprefixedAttribute" id="399980">x</a> =&gt; <span title="scala.xml.UnprefixedAttribute" class="keyword">new</span> <span title="scala.xml.UnprefixedAttribute">UnprefixedAttribute</span><span class="delimiter">(</span><a href="#399967" title="String">attr_name</a>, <span title="(_data: String)scala.xml.Text">Text</span><span class="delimiter">(</span><a href="#399980" title="List[scala.xml.MetaData]">x</a>.<span title="=&gt; scala.xml.MetaData">head</span>.<span title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">value</span>.<span title="=&gt; String">text</span><span class="delimiter">)</span>,
          <a href="#399969" title="scala.xml.MetaData">base</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span title="scala.xml.NodeSeq" class="keyword">if</span> <span class="delimiter">(</span><a href="#398517" title="scala.xml.NodeSeq">ret</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#398517" title="scala.xml.NodeSeq">ret</a>
    <span class="keyword">else</span>
      <a href="#398508" title="scala.xml.MetaData">attrs</a>.<span title="(key: String)Option[Seq[scala.xml.Node]]">get</span><span class="delimiter">(</span><span title="java.lang.String(&quot;form&quot;)" class="string">&quot;form&quot;</span><span class="delimiter">)</span>.<span title="(f: Seq[scala.xml.Node] =&gt; java.lang.String)Option[java.lang.String]">map</span><span class="delimiter">(</span><a href="#399996" title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">_</a>.<span title="=&gt; String">text</span>.<span title="()java.lang.String">trim</span>.<span title="()java.lang.String">toLowerCase</span><span class="delimiter">)</span> <span title="scala.xml.NodeSeq" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="scala.xml.NodeSeq">Some</span><span class="delimiter">(</span><span title="java.lang.String(&quot;post&quot;)" class="string">&quot;post&quot;</span><span class="delimiter">)</span> =&gt;
          <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49459" title="(attrs: scala.xml.MetaData)(f: =&gt; scala.xml.NodeSeq)scala.xml.NodeSeq">withAttrs</a><span class="delimiter">(</span><a href="#398508" title="scala.xml.MetaData">attrs</a>.<span title="(f: scala.xml.MetaData =&gt; Boolean)scala.xml.MetaData">filter</span><span class="delimiter">(</span><a href="#400017" title="scala.xml.MetaData">_</a>.<span title="=&gt; String">key</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;multipart&quot;)" class="string">&quot;multipart&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            net.liftweb.builtin.snippet.<a href="../builtin/snippet/Form.scala.html#13869" title="object net.liftweb.builtin.snippet.Form">Form</a>.<a href="../builtin/snippet/Form.scala.html#327209" title="(kids: scala.xml.NodeSeq)scala.xml.NodeSeq">post</a><span class="delimiter">(</span><a href="#398517" title="scala.xml.NodeSeq">ret</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span title="scala.xml.NodeSeq" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a title="scala.xml.Elem" id="400026">e</a>: <span title="scala.xml.Elem">Elem</span> =&gt; <a href="#400026" title="scala.xml.Elem">e</a> <span title="(updates: scala.xml.MetaData)scala.xml.Elem">%</span> <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159139" title="=&gt; net.liftweb.http.LiftRules#FactoryMaker[List[java.lang.String]]">formAttrs</a>.<a href="Factory.scala.html#159330" title="=&gt; List[java.lang.String]">vend</a>.<span title="[B](z: B)(f: (B, java.lang.String) =&gt; B)B">foldLeft</span><span title="(z: scala.xml.MetaData)(f: (scala.xml.MetaData, java.lang.String) =&gt; scala.xml.MetaData)scala.xml.MetaData" class="delimiter">[</span><span title="scala.xml.MetaData">MetaData</span><span class="delimiter">]</span><span class="delimiter">(</span><span title="object scala.xml.Null">Null</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="scala.xml.MetaData" id="400050">base</a>, <a title="java.lang.String" id="400051">name</a><span class="delimiter">)</span> =&gt; <a href="#398519" title="(attr_name: String, in: scala.xml.MetaData, base: scala.xml.MetaData)scala.xml.MetaData">checkAttr</a><span class="delimiter">(</span><a href="#400051" title="java.lang.String">name</a>, <a href="#398508" title="scala.xml.MetaData">attrs</a>, <a href="#400050" title="scala.xml.MetaData">base</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <a title="scala.xml.NodeSeq" id="400052">x</a> =&gt; <a href="#400052" title="scala.xml.NodeSeq">x</a>
          <span class="delimiter">}</span>

        <span class="keyword">case</span> <span title="scala.xml.Elem">Some</span><span class="delimiter">(</span><a title="java.lang.String" id="400054">ft</a><span class="delimiter">)</span> =&gt;
          &lt;<a title="scala.xml.MetaData" id="400064">form</a> action=<span class="delimiter">{</span><a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49359" title="=&gt; String">uri</a><span class="delimiter">}</span> method=<span class="delimiter">{</span><a href="#400054" title="java.lang.String">ft</a><span class="delimiter">}</span>&gt;
            <span class="delimiter">{</span><a href="#398517" title="scala.xml.NodeSeq">ret</a><span class="delimiter">}</span>
          &lt;/form&gt; <span title="(updates: scala.xml.MetaData)scala.xml.Elem">%</span>
            <a href="#398518" title="(in: scala.xml.MetaData)scala.xml.MetaData">checkMultiPart</a><span class="delimiter">(</span><a href="#398508" title="scala.xml.MetaData">attrs</a><span class="delimiter">)</span> <span title="(updates: scala.xml.MetaData)scala.xml.Elem">%</span> <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159139" title="=&gt; net.liftweb.http.LiftRules#FactoryMaker[List[java.lang.String]]">formAttrs</a>.<a href="Factory.scala.html#159330" title="=&gt; List[java.lang.String]">vend</a>.<span title="[B](z: B)(f: (B, java.lang.String) =&gt; B)B">foldLeft</span><span title="(z: scala.xml.MetaData)(f: (scala.xml.MetaData, java.lang.String) =&gt; scala.xml.MetaData)scala.xml.MetaData" class="delimiter">[</span><span title="scala.xml.MetaData">MetaData</span><span class="delimiter">]</span><span class="delimiter">(</span><span title="object scala.xml.Null">Null</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="scala.xml.MetaData" id="400082">base</a>, <a title="java.lang.String" id="400083">name</a><span class="delimiter">)</span> =&gt; <a href="#398519" title="(attr_name: String, in: scala.xml.MetaData, base: scala.xml.MetaData)scala.xml.MetaData">checkAttr</a><span class="delimiter">(</span><a href="#400083" title="java.lang.String">name</a>, <a href="#398508" title="scala.xml.MetaData">attrs</a>, <a href="#400082" title="scala.xml.MetaData">base</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="scala.xml.NodeSeq">_</span> =&gt; <a href="#398517" title="scala.xml.NodeSeq">ret</a>
      <span class="delimiter">}</span>

  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">object</span> <a title="object LiftSession.this.ExclosedSnippetFailure" id="230294">ExclosedSnippetFailure</a> <span title="ScalaObject" class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(e: Throwable)Option[net.liftweb.http.SnippetFailureException]" id="399943">unapply</a><span class="delimiter">(</span><a title="Throwable" id="399944">e</a>: <span title="Throwable">Throwable</span><span class="delimiter">)</span>: <span title="Option[net.liftweb.http.SnippetFailureException]">Option</span><span class="delimiter">[</span>SnippetFailureException<span class="delimiter">]</span> = <a href="#399944" title="Throwable">e</a>.<span title="()java.lang.Throwable">getCause</span> <span title="Option[net.liftweb.http.SnippetFailureException]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="None.type" class="keyword">null</span> =&gt; <span title="object None">None</span>
      <span class="keyword">case</span> <a title="Some[net.liftweb.http.SnippetFailureException]" id="400085">e</a>: <a href="Templates.scala.html#14736" title="net.liftweb.http.SnippetFailureException">SnippetFailureException</a> =&gt; <span title="(x: net.liftweb.http.SnippetFailureException)Some[net.liftweb.http.SnippetFailureException]">Some</span><span class="delimiter">(</span><a href="#400085" title="net.liftweb.http.SnippetFailureException">e</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="None.type">_</span> =&gt; <span title="object None">None</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Apply HTML specific corrections such as adding the context path etc.
   */</span>
  <span class="keyword">def</span> <a title="(in: scala.xml.NodeSeq)scala.xml.NodeSeq" id="230296">fixHtml</a><span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="400089">in</a>: <span title="scala.xml.NodeSeq">NodeSeq</span><span class="delimiter">)</span>: <span title="scala.xml.NodeSeq">NodeSeq</span> = <a href="Req.scala.html#14562" title="object net.liftweb.http.Req">Req</a>.<a href="Req.scala.html#185922" title="(contextPath: String, in: scala.xml.NodeSeq)scala.xml.NodeSeq">fixHtml</a><span class="delimiter">(</span><a href="#230247" title="=&gt; String">contextPath</a>, <a href="#400089" title="scala.xml.NodeSeq">in</a><span class="delimiter">)</span>


  <span class="comment">/**
   * The partial function that defines how lift tags are processed for this session.  Initially composed
   * of LiftRules.liftTagProcessing orElse the default lift tag processing.  If you need to change the
   * way a particular session handles lift tags, alter this partial function.
   */</span>
  @volatile
  <span class="keyword">var</span> <a title="List[net.liftweb.http.LiftRules.LiftTagPF]" id="230298">liftTagProcessing</a>: <span title="List[net.liftweb.http.LiftRules.LiftTagPF]">List</span><span class="delimiter">[</span>LiftRules.LiftTagPF<span class="delimiter">]</span> = _

  <span class="comment">/**
   * The basic partial function that does lift tag processing
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; net.liftweb.http.LiftRules.LiftTagPF" id="230300">_defaultLiftTagProcessing</a>: LiftRules.<span title="net.liftweb.http.LiftRules.LiftTagPF">LiftTagPF</span> =
    <a href="../../../../util/net/liftweb/util/NamedPartialFunction.scala.html#185565" title="(name: String)(f: PartialFunction[(String, scala.xml.Elem, scala.xml.MetaData, scala.xml.NodeSeq, String),scala.xml.NodeSeq])net.liftweb.util.NamedPartialFunction[(String, scala.xml.Elem, scala.xml.MetaData, scala.xml.NodeSeq, String),scala.xml.NodeSeq]">NamedPF</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Default Lift Tags&quot;)" class="string">&quot;Default Lift Tags&quot;</span><span class="delimiter">)</span> <a href="#400117" title="scala.xml.NodeSeq" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="scala.xml.NodeSeq" class="delimiter">(</span><span title="java.lang.String(&quot;snippet&quot;)" class="string">&quot;snippet&quot;</span>, <a title="scala.xml.Elem" id="400123">elm</a>, <a title="scala.xml.MetaData" id="400124">metaData</a>, <a title="scala.xml.NodeSeq" id="400125">kids</a>, <a title="String" id="400126">page</a><span class="delimiter">)</span> =&gt;
        <a href="#400124" title="scala.xml.MetaData">metaData</a>.<span title="(key: String)Option[Seq[scala.xml.Node]]">get</span><span class="delimiter">(</span><span title="java.lang.String(&quot;type&quot;)" class="string">&quot;type&quot;</span><span class="delimiter">)</span> <span title="scala.xml.NodeSeq" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="scala.xml.NodeSeq">Some</span><span class="delimiter">(</span><a title="Seq[scala.xml.Node]" id="400130">tn</a><span class="delimiter">)</span> =&gt;
            <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49484" title="(name: String)(f: =&gt; scala.xml.NodeSeq)scala.xml.NodeSeq">doSnippet</a><span class="delimiter">(</span><a href="#400130" title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">tn</a>.<span title="=&gt; String">text</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="../../../../util/net/liftweb/util/NamedPartialFunction.scala.html#185580" title="(value: (String, scala.xml.Elem, scala.xml.MetaData, scala.xml.NodeSeq, String), lst: Seq[PartialFunction[(String, scala.xml.Elem, scala.xml.MetaData, scala.xml.NodeSeq, String),scala.xml.NodeSeq]])scala.xml.NodeSeq">NamedPF</a><span class="delimiter">(</span><span title="(_1: String, _2: scala.xml.Elem, _3: scala.xml.MetaData, _4: scala.xml.NodeSeq, _5: String)(String, scala.xml.Elem, scala.xml.MetaData, scala.xml.NodeSeq, String)" class="delimiter">(</span><a href="#400130" title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">tn</a>.<span title="=&gt; String">text</span>, <a href="#400123" title="scala.xml.Elem">elm</a>, <a href="#400124" title="scala.xml.MetaData">metaData</a>, <a href="#400125" title="scala.xml.NodeSeq">kids</a>, <a href="#400126" title="String">page</a><span class="delimiter">)</span>,
                <a href="#230298" title="=&gt; List[net.liftweb.http.LiftRules.LiftTagPF]">liftTagProcessing</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>

          <span class="keyword">case</span> <span title="scala.xml.NodeSeq">_</span> =&gt; <a href="#230293" title="(page: String, snippetName: net.liftweb.common.Box[String], attrs: scala.xml.MetaData, wholeTag: scala.xml.NodeSeq, passedKids: scala.xml.NodeSeq)scala.xml.NodeSeq">processSnippet</a><span class="delimiter">(</span><a href="#400126" title="String">page</a>, <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a>, <a href="#400123" title="scala.xml.Elem">elm</a>.<span title="=&gt; scala.xml.MetaData">attributes</span>, <a href="#400123" title="scala.xml.Elem">elm</a>, <a href="#400123" title="scala.xml.Elem">elm</a>.<span title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">child</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="scala.xml.NodeSeq" class="delimiter">(</span><a title="String" id="400220">snippetInfo</a>, <a title="scala.xml.Elem" id="400221">elm</a>, <a title="scala.xml.MetaData" id="400222">metaData</a>, <a title="scala.xml.NodeSeq" id="400223">kids</a>, <a title="String" id="400224">page</a><span class="delimiter">)</span> =&gt;
        <a href="#230293" title="(page: String, snippetName: net.liftweb.common.Box[String], attrs: scala.xml.MetaData, wholeTag: scala.xml.NodeSeq, passedKids: scala.xml.NodeSeq)scala.xml.NodeSeq">processSnippet</a><span class="delimiter">(</span><a href="#400224" title="String">page</a>, <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: String)net.liftweb.common.Full[String]">Full</a><span class="delimiter">(</span><a href="#400220" title="String">snippetInfo</a><span class="delimiter">)</span>, <a href="#400222" title="scala.xml.MetaData">metaData</a>, <a href="#400221" title="scala.xml.Elem">elm</a>, <a href="#400223" title="scala.xml.NodeSeq">kids</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <a href="#230298" title="(x$1: List[net.liftweb.http.LiftRules.LiftTagPF])Unit">liftTagProcessing</a> = <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158930" title="=&gt; net.liftweb.http.LiftRules#RulesSeq[PartialFunction[(java.lang.String, scala.xml.Elem, scala.xml.MetaData, scala.xml.NodeSeq, java.lang.String),scala.xml.NodeSeq]]">liftTagProcessing</a>.<a href="LiftRules.scala.html#185552" title="=&gt; List[PartialFunction[(java.lang.String, scala.xml.Elem, scala.xml.MetaData, scala.xml.NodeSeq, java.lang.String),scala.xml.NodeSeq]]">toList</a> <a href="#400230" title="(prefix: List[net.liftweb.http.LiftRules.LiftTagPF])List[net.liftweb.http.LiftRules.LiftTagPF]">:::</a> <span title="(xs: net.liftweb.http.LiftRules.LiftTagPF*)List[net.liftweb.http.LiftRules.LiftTagPF]">List</span><span class="delimiter">(</span><a href="#230300" title="=&gt; net.liftweb.http.LiftRules.LiftTagPF">_defaultLiftTagProcessing</a><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(in: Seq[scala.xml.Node])scala.xml.NodeSeq" id="230301">asNodeSeq</a><span class="delimiter">(</span><a title="Seq[scala.xml.Node]" id="400262">in</a>: <span title="Seq[scala.xml.Node]">Seq</span><span class="delimiter">[</span>Node<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="scala.xml.NodeSeq">NodeSeq</span> = <a href="#400262" title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">in</a>


  <span class="keyword">private</span> <span class="keyword">class</span> <a title="class DeferredProcessor extends java.lang.Object with net.liftweb.actor.SpecializedLiftActor[LiftSession.this.ProcessSnippet] with ScalaObject" id="230302">DeferredProcessor</a> <a href="#230302" title="ScalaObject" class="keyword">extends</a> <a href="../../../../actor/net/liftweb/actor/LiftActor.scala.html#10551" title="net.liftweb.actor.SpecializedLiftActor[LiftSession.this.ProcessSnippet]">SpecializedLiftActor</a><span class="delimiter">[</span>ProcessSnippet<span class="delimiter">]</span> <span class="delimiter">{</span>
    <span class="keyword">protected</span> <span class="keyword">def</span> <a title="=&gt; PartialFunction[LiftSession.this.ProcessSnippet,Unit]" id="400267">messageHandler</a> = <a href="#400273" title="Unit" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="Unit">ProcessSnippet</span><span class="delimiter">(</span><a title="() =&gt; Unit" id="400301">f</a><span class="delimiter">)</span> =&gt; <a href="#400301" title="()Unit">f</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> case <span class="keyword">class</span> <a title="class ProcessSnippet extends java.lang.Object with ScalaObject with Product with Serializable" id="400281">ProcessSnippet</a><a href="#400281" title="ScalaObject" class="delimiter">(</a><a title="() =&gt; Unit" id="400364">f</a>: <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Unit<span class="delimiter">)</span>

  <span class="comment">// if the &quot;lift:parallel&quot; attribute is part of the snippet, create an</span>
  <span class="comment">// actor and send the message off to that actor</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(isLazy: Boolean)(f: =&gt; scala.xml.NodeSeq)scala.xml.NodeSeq" id="230306">processOrDefer</a><span class="delimiter">(</span><a title="Boolean" id="400327">isLazy</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="=&gt; scala.xml.NodeSeq" id="400328">f</a>: =&gt; NodeSeq<span class="delimiter">)</span>: <span title="scala.xml.NodeSeq">NodeSeq</span> = <span class="delimiter">{</span>
    <span class="comment">/*
    val isLazy = LiftRules.allowParallelSnippets() &amp;&amp;
            node.attributes.find {
              case p: PrefixedAttribute =&gt; p.pre == &quot;lift&quot; &amp;&amp; (p.key == &quot;parallel&quot;)
              case _ =&gt; false
            }.isDefined
            */</span>

    <span title="scala.xml.NodeSeq" class="keyword">if</span> <span class="delimiter">(</span><a href="#230162" title="=&gt; net.liftweb.util.ThreadGlobal[Boolean]{def ?: Boolean}">fullPageLoad</a>.<a href="#389765" title="=&gt; Boolean">?</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#400327" title="Boolean">isLazy</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="../../../../util/net/liftweb/util/Maker.scala.html#150935" title="()Boolean">allowParallelSnippets</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="comment">// name the node</span>
      <span class="keyword">val</span> <a title="String" id="400336">nodeId</a> = <a href="../../../../util/net/liftweb/util/StringHelpers.scala.html#48846" title="(size: Int)String">randomString</a><span class="delimiter">(</span><span title="Int(20)" class="int">20</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="String" id="400337">renderVersion</a> = <a href="#14488" title="object net.liftweb.http.RenderVersion">RenderVersion</a>.<a href="#345564" title="=&gt; String">get</a>

      <span class="keyword">val</span> <a title="scala.xml.Elem" id="400338">theNode</a> = &lt;<a title="scala.xml.MetaData" id="400343">lift_deferred</a>:node id=<span class="delimiter">{</span><a href="#400336" title="String">nodeId</a><span class="delimiter">}</span>/&gt;

      <span class="comment">// take a snapshot of the hashmap used to communicate between threads</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[String,net.liftweb.common.Box[scala.xml.NodeSeq]]" id="400339">hash</a> = <a href="#230203" title="object LiftSession.this.deferredSnippets">deferredSnippets</a>.<a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75375" title="=&gt; scala.collection.mutable.HashMap[String,net.liftweb.common.Box[scala.xml.NodeSeq]]">is</a>

      <span class="comment">// insert an empty node</span>
      <a href="#400339" title="scala.collection.mutable.HashMap[String,net.liftweb.common.Box[scala.xml.NodeSeq]]">hash</a>.<span title="(x$1: Unit)Unit">synchronized</span> <span class="delimiter">{</span>
        <a href="#400339" title="(key: String, value: net.liftweb.common.Box[scala.xml.NodeSeq])Unit">hash</a><span class="delimiter">(</span><a href="#400336" title="String">nodeId</a><span class="delimiter">)</span> = <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a>
      <span class="delimiter">}</span>

      <span class="comment">// create a function that will restore our RequestVars</span>
      <span class="keyword">val</span> <a title="() =&gt; scala.xml.NodeSeq =&gt; scala.xml.NodeSeq" id="400340">reqVarCallback</a> = <a href="#230203" title="object LiftSession.this.deferredSnippets">deferredSnippets</a>.<a href="Vars.scala.html#171745" title="[T]()() =&gt; T =&gt; T">generateSnapshotRestorer</a><span title="()() =&gt; scala.xml.NodeSeq =&gt; scala.xml.NodeSeq" class="delimiter">[</span><span title="scala.xml.NodeSeq">NodeSeq</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

      <span class="comment">// create a new actor</span>
      <span class="keyword">val</span> <a title="LiftSession.this.DeferredProcessor" id="400341">actor</a> = <span title="LiftSession.this.DeferredProcessor" class="keyword">new</span> <a href="#230302" title="LiftSession.this.DeferredProcessor">DeferredProcessor</a>

      <span class="comment">// snapshot the current Req</span>
      <span class="keyword">val</span> <a title="net.liftweb.common.Box[net.liftweb.http.Req]" id="400342">req</a> = <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49309" title="=&gt; net.liftweb.common.Box[net.liftweb.http.Req]">request</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: net.liftweb.http.Req =&gt; net.liftweb.http.Req)net.liftweb.common.Box[net.liftweb.http.Req]">map</a><span class="delimiter">(</span><a href="#400360" title="net.liftweb.http.Req">_</a>.<a href="Req.scala.html#149165" title="=&gt; net.liftweb.http.Req">snapshot</a><span class="delimiter">)</span>

      <span class="comment">// send the ProcessSnippet message to the Actor</span>
      <a href="#400341" title="LiftSession.this.DeferredProcessor">actor</a> <a href="../../../../actor/net/liftweb/actor/LiftActor.scala.html#29502" title="(msg: LiftSession.this.ProcessSnippet)Unit">!</a> <a href="#400281" title="(f: () =&gt; Unit)LiftSession.this.ProcessSnippet">ProcessSnippet</a><span class="delimiter">(</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="#230290" title="(req: net.liftweb.common.Box[net.liftweb.http.Req], renderVersion: String)(f: =&gt; Unit)Unit">executeInScope</a><span class="delimiter">(</span><a href="#400342" title="net.liftweb.common.Box[net.liftweb.http.Req]">req</a>, <a href="#400337" title="String">renderVersion</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="comment">// process the message</span>
          <span class="keyword">val</span> <a title="net.liftweb.common.Box[scala.xml.NodeSeq]" id="400373">bns</a> = <a href="../../../../util/net/liftweb/util/ControlHelpers.scala.html#48608" title="(f: =&gt; scala.xml.NodeSeq)net.liftweb.common.Box[scala.xml.NodeSeq]">tryo</a> <span class="delimiter">{</span>
            <a href="#400340" title="(v1: () =&gt; scala.xml.NodeSeq)scala.xml.NodeSeq">reqVarCallback</a><span class="delimiter">(</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#400328" title="=&gt; scala.xml.NodeSeq">f</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

          <span class="comment">// set the node</span>
          <a href="#400339" title="scala.collection.mutable.HashMap[String,net.liftweb.common.Box[scala.xml.NodeSeq]]">hash</a>.<span title="(x$1: Unit)Unit">synchronized</span> <span class="delimiter">{</span>
            <a href="#400339" title="(key: String, value: net.liftweb.common.Box[scala.xml.NodeSeq])Unit">hash</a><span class="delimiter">(</span><a href="#400336" title="String">nodeId</a><span class="delimiter">)</span> = <a href="#400373" title="net.liftweb.common.Box[scala.xml.NodeSeq]">bns</a> <span title="net.liftweb.common.Box[scala.xml.NodeSeq]" class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="net.liftweb.common.Failure">Empty</a> =&gt; <a href="../../../../common/net/liftweb/common/Box.scala.html#37830" title="(msg: String, exception: net.liftweb.common.Box[Throwable], chain: net.liftweb.common.Box[net.liftweb.common.Failure])net.liftweb.common.Failure">Failure</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Weird Empty Node&quot;)" class="string">&quot;Weird Empty Node&quot;</span>, <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a>, <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <a title="net.liftweb.common.Box[scala.xml.NodeSeq]" id="400423">x</a> =&gt; <a href="#400423" title="net.liftweb.common.Box[scala.xml.NodeSeq]">x</a>
            <span class="delimiter">}</span>

            <span class="comment">// and notify listeners</span>
            <a href="#400339" title="scala.collection.mutable.HashMap[String,net.liftweb.common.Box[scala.xml.NodeSeq]]">hash</a>.<span title="()Unit">notify</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>

      <a href="#400338" title="scala.xml.Elem">theNode</a>
    <span class="delimiter">}</span>
    <span class="keyword">else</span> <a href="#400328" title="=&gt; scala.xml.NodeSeq">f</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Processes the surround tag and other lift tags
   */</span>
  <span class="keyword">def</span> <a title="(page: String, in: scala.xml.NodeSeq)scala.xml.NodeSeq" id="230307">processSurroundAndInclude</a><span class="delimiter">(</span><a title="String" id="341968">page</a>: <span title="String">String</span>, <a title="scala.xml.NodeSeq" id="341969">in</a>: <span title="scala.xml.NodeSeq">NodeSeq</span><span class="delimiter">)</span>: <span title="scala.xml.NodeSeq">NodeSeq</span> = <span class="delimiter">{</span>
    <a href="#341969" title="scala.xml.NodeSeq">in</a>.<span title="(f: scala.xml.Node =&gt; scala.collection.GenTraversableOnce[scala.xml.Node])(implicit bf: scala.collection.generic.CanBuildFrom[scala.xml.NodeSeq,scala.xml.Node,scala.xml.NodeSeq])scala.xml.NodeSeq">flatMap</span> <a href="#400443" title="scala.xml.NodeSeq" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="scala.xml.Group">Group</span><span class="delimiter">(</span><a title="Seq[scala.xml.Node]" id="400444">nodes</a><span class="delimiter">)</span> =&gt;
        <span title="(nodes: Seq[scala.xml.Node])scala.xml.Group">Group</span><span class="delimiter">(</span><a href="#230307" title="(page: String, in: scala.xml.NodeSeq)scala.xml.NodeSeq">processSurroundAndInclude</a><span class="delimiter">(</span><a href="#341968" title="String">page</a>, <a href="#400444" title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">nodes</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">case</span> <a href="#400456" title="scala.xml.NodeSeq">SnippetNode</a><span class="delimiter">(</span><a title="scala.xml.Elem" id="400460">element</a>, <a title="scala.xml.NodeSeq" id="400461">kids</a>, <a title="Boolean" id="400462">isLazy</a>, <a title="scala.xml.MetaData" id="400463">attrs</a>, <a title="String" id="400464">snippetName</a><span class="delimiter">)</span> =&gt;
        <a href="#230306" title="(isLazy: Boolean)(f: =&gt; scala.xml.NodeSeq)scala.xml.NodeSeq">processOrDefer</a><span class="delimiter">(</span><a href="#400462" title="Boolean">isLazy</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49484" title="(name: String)(f: =&gt; scala.xml.NodeSeq)scala.xml.NodeSeq">doSnippet</a><span class="delimiter">(</span><a href="#400464" title="String">snippetName</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49459" title="(attrs: scala.xml.MetaData)(f: =&gt; scala.xml.NodeSeq)scala.xml.NodeSeq">withAttrs</a><span class="delimiter">(</span><a href="#400463" title="scala.xml.MetaData">attrs</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#230307" title="(page: String, in: scala.xml.NodeSeq)scala.xml.NodeSeq">processSurroundAndInclude</a><span class="delimiter">(</span><a href="#341968" title="String">page</a>,
                <a href="../../../../util/net/liftweb/util/NamedPartialFunction.scala.html#185580" title="(value: (String, scala.xml.Elem, scala.xml.MetaData, scala.xml.NodeSeq, String), lst: Seq[PartialFunction[(String, scala.xml.Elem, scala.xml.MetaData, scala.xml.NodeSeq, String),scala.xml.NodeSeq]])scala.xml.NodeSeq">NamedPF</a><span class="delimiter">(</span><span title="(_1: String, _2: scala.xml.Elem, _3: scala.xml.MetaData, _4: scala.xml.NodeSeq, _5: String)(String, scala.xml.Elem, scala.xml.MetaData, scala.xml.NodeSeq, String)" class="delimiter">(</span><a href="#400464" title="String">snippetName</a>,
                  <a href="#400460" title="scala.xml.Elem">element</a>, <a href="#400463" title="scala.xml.MetaData">attrs</a>,
                  <a href="#400461" title="scala.xml.NodeSeq">kids</a>,
                  <a href="#341968" title="String">page</a><span class="delimiter">)</span>,
                  <a href="#230298" title="=&gt; List[net.liftweb.http.LiftRules.LiftTagPF]">liftTagProcessing</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>

      <span class="keyword">case</span> <a title="scala.xml.Elem" id="400530">v</a>: <span title="scala.xml.Elem">Elem</span> =&gt;
        <span title="(prefix: String, label: String, attributes: scala.xml.MetaData, scope: scala.xml.NamespaceBinding, child: scala.xml.Node*)scala.xml.Elem">Elem</span><span class="delimiter">(</span><a href="#400530" title="scala.xml.Elem">v</a>.<span title="=&gt; String">prefix</span>, <a href="#400530" title="scala.xml.Elem">v</a>.<span title="=&gt; String">label</span>, <a href="#230281" title="(in: scala.xml.MetaData)scala.xml.MetaData">processAttributes</a><span class="delimiter">(</span><a href="#400530" title="scala.xml.Elem">v</a>.<span title="=&gt; scala.xml.MetaData">attributes</span><span class="delimiter">)</span>,
          <a href="#400530" title="scala.xml.Elem">v</a>.<span title="=&gt; scala.xml.NamespaceBinding">scope</span>, <a href="#230307" title="(page: String, in: scala.xml.NodeSeq)scala.xml.NodeSeq">processSurroundAndInclude</a><span class="delimiter">(</span><a href="#341968" title="String">page</a>, <a href="#400530" title="scala.xml.Elem">v</a>.<span title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">child</span><span class="delimiter">)</span>: _*<span class="delimiter">)</span>

      <span class="keyword">case</span> <a title="scala.xml.PCData" id="400533">pcd</a>: scala.xml.<span title="scala.xml.PCData">PCData</span> =&gt; <a href="#400533" title="scala.xml.PCData">pcd</a>
      <span class="keyword">case</span> <a title="scala.xml.Text" id="400534">text</a>: <span title="scala.xml.Text">Text</span> =&gt; <a href="#400534" title="scala.xml.Text">text</a>
      <span class="keyword">case</span> <a title="scala.xml.Unparsed" id="400535">unparsed</a>: <span title="scala.xml.Unparsed">Unparsed</span> =&gt; <a href="#400535" title="scala.xml.Unparsed">unparsed</a>

      <span class="keyword">case</span> <a title="scala.xml.Text" id="400536">a</a>: <span title="scala.xml.Atom[Any]">Atom</span><span class="delimiter">[</span>Any<span class="delimiter">]</span> <span class="keyword">if</span> <a href="#400536" title="scala.xml.Atom[Any]">a</a>.<span title="()java.lang.Class[_]">getClass</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()java.lang.String">getName</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;scala.xml.Atom&quot;)" class="string">&quot;scala.xml.Atom&quot;</span> =&gt; <span title="scala.xml.Text" class="keyword">new</span> <span title="scala.xml.Text">Text</span><span class="delimiter">(</span><a href="#400536" title="scala.xml.Atom[Any]">a</a>.<span title="=&gt; Any">data</span>.<span title="()java.lang.String">toString</span><span class="delimiter">)</span>

      <span class="keyword">case</span> <a title="scala.xml.Node" id="400544">v</a> =&gt; <a href="#400544" title="scala.xml.Node">v</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * A nicely named proxy for processSurroundAndInclude.  This method processes
   * a Lift template
   *
   * @param pageName -- the name of the page being processed (for error reporting)
   * @param template -- the template to process using Lift's templating engine
   */</span>
  <span class="keyword">def</span> <a title="(pageName: String, template: scala.xml.NodeSeq)scala.xml.NodeSeq" id="230308">runTemplate</a><span class="delimiter">(</span><a title="String" id="400564">pageName</a>: <span title="String">String</span>, <a title="scala.xml.NodeSeq" id="400565">template</a>: <span title="scala.xml.NodeSeq">NodeSeq</span><span class="delimiter">)</span>: <span title="scala.xml.NodeSeq">NodeSeq</span> =
    <a href="#230307" title="(page: String, in: scala.xml.NodeSeq)scala.xml.NodeSeq">processSurroundAndInclude</a><span class="delimiter">(</span><a href="#400564" title="String">pageName</a>, <a href="#400565" title="scala.xml.NodeSeq">template</a><span class="delimiter">)</span>

  <span class="comment">/**
   * Run the code, but if the session is not stateful, then
   * throw a StateInStatelessException
   */</span>
  <span class="keyword">def</span> <a title="[T](f: =&gt; T)T" id="230309">testStatefulFeature</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="230311">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="=&gt; T" id="395507">f</a>: =&gt; T<span class="delimiter">)</span>: <a href="#230311" title="T">T</a> = <span class="delimiter">{</span>
    <span title="T" class="keyword">if</span> <span class="delimiter">(</span><a href="#14496" title="LiftSession.this.type" class="keyword">this</a>.<a href="#230327" title="=&gt; Boolean">stateful_?</a><span class="delimiter">)</span> <a href="#395507" title="=&gt; T">f</a>
    <span class="keyword">else</span> <span title="Nothing" class="keyword">throw</span> <span title="net.liftweb.http.StateInStatelessException" class="keyword">new</span> <a href="Templates.scala.html#14737" title="net.liftweb.http.StateInStatelessException">StateInStatelessException</a><span class="delimiter">(</span>
      <span title="java.lang.String(&quot;Accessing stateful feature outside of a stateful session&quot;)" class="string">&quot;Accessing stateful feature outside of a stateful session&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Finds all Comet actors by type
   */</span>
  <span class="keyword">def</span> <a title="(theType: String)List[net.liftweb.http.LiftCometActor]" id="230312">findComet</a><span class="delimiter">(</span><a title="String" id="326399">theType</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="List[net.liftweb.http.LiftCometActor]">List</span><span class="delimiter">[</span>LiftCometActor<span class="delimiter">]</span> = <a href="#14496" title="(x$1: List[net.liftweb.http.LiftCometActor])List[net.liftweb.http.LiftCometActor]">synchronized</a> <span class="delimiter">{</span>
    <a href="#230309" title="(f: =&gt; List[net.liftweb.http.LiftCometActor])List[net.liftweb.http.LiftCometActor]">testStatefulFeature</a> <span class="delimiter">{</span>
      <a href="#230171" title="=&gt; scala.collection.mutable.HashMap[(net.liftweb.common.Box[String], net.liftweb.common.Box[String]),net.liftweb.http.LiftCometActor]">asyncComponents</a>.<span title="(f: ((net.liftweb.common.Box[String], net.liftweb.common.Box[String]), net.liftweb.http.LiftCometActor) =&gt; scala.collection.GenTraversableOnce[net.liftweb.http.LiftCometActor])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.HashMap[(net.liftweb.common.Box[String], net.liftweb.common.Box[String]),net.liftweb.http.LiftCometActor],net.liftweb.http.LiftCometActor,scala.collection.mutable.Iterable[net.liftweb.http.LiftCometActor]])scala.collection.mutable.Iterable[net.liftweb.http.LiftCometActor]">flatMap</span> <a href="#400590" title="Iterable[net.liftweb.http.LiftCometActor]" class="delimiter">{</a>
        <span class="keyword">case</span> <span title="Iterable[net.liftweb.http.LiftCometActor]" class="delimiter">(</span><span class="delimiter">(</span>Full<span class="delimiter">(</span><a title="String" id="400596">name</a><span class="delimiter">)</span>, _<span class="delimiter">)</span>, <a title="net.liftweb.http.LiftCometActor" id="400597">value</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#400596" title="String">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#326399" title="String">theType</a> =&gt; <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.LiftCometActor)net.liftweb.common.Full[net.liftweb.http.LiftCometActor]">Full</a><a href="../../../../common/net/liftweb/common/Box.scala.html#28624" title="(in: net.liftweb.common.Box[net.liftweb.http.LiftCometActor])Iterable[net.liftweb.http.LiftCometActor]" class="delimiter">(</a><a href="#400597" title="net.liftweb.http.LiftCometActor">value</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Iterable[Nothing]">_</span> =&gt; <a href="../../../../common/net/liftweb/common/Box.scala.html#28624" title="(in: net.liftweb.common.Box[Nothing])Iterable[Nothing]">Empty</a>
      <span class="delimiter">}</span>.<span title="=&gt; List[net.liftweb.http.LiftCometActor]">toList</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Find the comet actor by type and name
   */</span>
  <span class="keyword">def</span> <a title="(theType: String, name: net.liftweb.common.Box[String])net.liftweb.common.Box[net.liftweb.http.LiftCometActor]" id="230313">findComet</a><span class="delimiter">(</span><a title="String" id="326396">theType</a>: <span title="String">String</span>, <a title="net.liftweb.common.Box[String]" id="326397">name</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[String]">Box</a><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">Box</a><span class="delimiter">[</span>LiftCometActor<span class="delimiter">]</span> = <a href="#14496" title="(x$1: net.liftweb.common.Box[net.liftweb.http.LiftCometActor])net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">synchronized</a> <span class="delimiter">{</span>
    <a href="#230309" title="(f: =&gt; net.liftweb.common.Box[net.liftweb.http.LiftCometActor])net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">testStatefulFeature</a> <span class="delimiter">{</span>
      <a href="#230171" title="=&gt; scala.collection.mutable.HashMap[(net.liftweb.common.Box[String], net.liftweb.common.Box[String]),net.liftweb.http.LiftCometActor]">asyncComponents</a>.<span title="(key: (net.liftweb.common.Box[String], net.liftweb.common.Box[String]))Option[net.liftweb.http.LiftCometActor]">get</span><a href="../../../../common/net/liftweb/common/Box.scala.html#28627" title="(in: Option[net.liftweb.http.LiftCometActor])net.liftweb.common.Box[net.liftweb.http.LiftCometActor]" class="delimiter">(</a><a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: String)net.liftweb.common.Full[String]">Full</a><span title="(x: net.liftweb.common.Full[String])ArrowAssoc[net.liftweb.common.Full[String]]" class="delimiter">(</span><a href="#326396" title="String">theType</a><span class="delimiter">)</span> <span title="(y: net.liftweb.common.Box[String])(net.liftweb.common.Full[String], net.liftweb.common.Box[String])">-&gt;</span> <a href="#326397" title="net.liftweb.common.Box[String]">name</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>


  <span class="comment">/**
   * This method will send a message to a CometActor, whether or not
   * the CometActor is instantiated.  If the CometActor already exists
   * in the session, the message will be sent immediately.  If the CometActor
   * is not yet instantiated, the message will be sent to the CometActor
   * as part of setup (@see setupComet) if it is created as part
   * of the current HTTP request/response cycle.
   *
   * @param theType the type of the CometActor
   * @param name the optional name of the CometActor
   * @param msg the message to send to the CometActor
   */</span>
  <span class="keyword">def</span> <a title="(theType: String, name: net.liftweb.common.Box[String], msg: Any)Unit" id="230314">sendCometActorMessage</a><span class="delimiter">(</span><a title="String" id="400796">theType</a>: <span title="String">String</span>, <a title="net.liftweb.common.Box[String]" id="400797">name</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[String]">Box</a><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="Any" id="400798">msg</a>: <span title="Any">Any</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#230309" title="(f: =&gt; Unit)Unit">testStatefulFeature</a> <span class="delimiter">{</span>
      <a href="#230313" title="(theType: String, name: net.liftweb.common.Box[String])net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">findComet</a><span class="delimiter">(</span><a href="#400796" title="String">theType</a>, <a href="#400797" title="net.liftweb.common.Box[String]">name</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Unit">Full</span><span class="delimiter">(</span><a title="net.liftweb.http.LiftCometActor" id="400807">a</a><span class="delimiter">)</span> =&gt; <a href="#400807" title="net.liftweb.http.LiftCometActor">a</a> <a href="../../../../common/net/liftweb/common/SimpleActor.scala.html#29491" title="(param: Any)Unit">!</a> <a href="#400798" title="Any">msg</a>
        <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <a href="#230315" title="(theType: String, name: net.liftweb.common.Box[String], msg: Any)Unit">setupComet</a><span class="delimiter">(</span><a href="#400796" title="String">theType</a>, <a href="#400797" title="net.liftweb.common.Box[String]">name</a>, <a href="#400798" title="Any">msg</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Allows you to send messages to a CometActor that may or may not be set up yet
   */</span>
  <span class="keyword">def</span> <a title="(theType: String, name: net.liftweb.common.Box[String], msg: Any)Unit" id="230315">setupComet</a><span class="delimiter">(</span><a title="String" id="328408">theType</a>: <span title="String">String</span>, <a title="net.liftweb.common.Box[String]" id="328409">name</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[String]">Box</a><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="Any" id="328410">msg</a>: <span title="Any">Any</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#230309" title="(f: =&gt; LiftSession.this.cometSetup.ValueType)LiftSession.this.cometSetup.ValueType">testStatefulFeature</a> <span title="Unit" class="delimiter">{</span>
      <a href="#230205" title="object LiftSession.this.cometSetup">cometSetup</a>.<a href="../../../../util/net/liftweb/util/ValueHolder.scala.html#49791" title="(f: LiftSession.this.cometSetup.ValueType =&gt; LiftSession.this.cometSetup.ValueType)LiftSession.this.cometSetup.ValueType">atomicUpdate</a><span class="delimiter">(</span><a title="LiftSession.this.cometSetup.ValueType" id="400814">v</a> =&gt; <span title="(_1: (net.liftweb.common.Full[String], net.liftweb.common.Box[String]), _2: Any)((net.liftweb.common.Full[String], net.liftweb.common.Box[String]), Any)" class="delimiter">(</span><a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: String)net.liftweb.common.Full[String]">Full</a><span title="(x: net.liftweb.common.Full[String])ArrowAssoc[net.liftweb.common.Full[String]]" class="delimiter">(</span><a href="#328408" title="String">theType</a><span class="delimiter">)</span> <span title="(y: net.liftweb.common.Box[String])(net.liftweb.common.Full[String], net.liftweb.common.Box[String])">-&gt;</span> <a href="#328409" title="net.liftweb.common.Box[String]">name</a>, <a href="#328410" title="Any">msg</a><span class="delimiter">)</span> <a href="#400815" title="(x: ((net.liftweb.common.Box[String], net.liftweb.common.Box[String]), Any))List[((net.liftweb.common.Box[String], net.liftweb.common.Box[String]), Any)]">::</a> <a href="#400814" title="LiftSession.this.cometSetup.ValueType">v</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span><span class="delimiter">[</span>liftweb<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(theType: net.liftweb.common.Box[String], name: net.liftweb.common.Box[String], defaultXml: scala.xml.NodeSeq, attributes: Map[String,String])net.liftweb.common.Box[net.liftweb.http.LiftCometActor]" id="230316">findComet</a><span class="delimiter">(</span><a title="net.liftweb.common.Box[String]" id="326391">theType</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[String]">Box</a><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="net.liftweb.common.Box[String]" id="326392">name</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[String]">Box</a><span class="delimiter">[</span>String<span class="delimiter">]</span>,
                                 <a title="scala.xml.NodeSeq" id="326393">defaultXml</a>: <span title="scala.xml.NodeSeq">NodeSeq</span>,
                                 <a title="Map[String,String]" id="326394">attributes</a>: <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">Box</a><span class="delimiter">[</span>LiftCometActor<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#230309" title="(f: =&gt; net.liftweb.common.Box[net.liftweb.http.LiftCometActor])net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">testStatefulFeature</a> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="(net.liftweb.common.Box[String], net.liftweb.common.Box[String])" id="400849">what</a> = <span class="delimiter">(</span><a href="#326391" title="(x: net.liftweb.common.Box[String])ArrowAssoc[net.liftweb.common.Box[String]]">theType</a> <span title="(y: net.liftweb.common.Box[String])(net.liftweb.common.Box[String], net.liftweb.common.Box[String])">-&gt;</span> <a href="#326392" title="net.liftweb.common.Box[String]">name</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="net.liftweb.common.Box[net.liftweb.http.LiftCometActor]" id="400850">ret</a> = <a href="#14496" title="(x$1: net.liftweb.common.Box[net.liftweb.http.LiftCometActor])net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">synchronized</a> <span class="delimiter">{</span>

        <span class="keyword">val</span> <a title="net.liftweb.common.Box[net.liftweb.http.LiftCometActor]" id="400869">ret</a> = <a href="../../../../common/net/liftweb/common/Box.scala.html#28602" title="(in: Option[net.liftweb.http.LiftCometActor])net.liftweb.common.Box[net.liftweb.http.LiftCometActor] with Serializable">Box</a><span class="delimiter">(</span><a href="#230171" title="=&gt; scala.collection.mutable.HashMap[(net.liftweb.common.Box[String], net.liftweb.common.Box[String]),net.liftweb.http.LiftCometActor]">asyncComponents</a>.<span title="(key: (net.liftweb.common.Box[String], net.liftweb.common.Box[String]))Option[net.liftweb.http.LiftCometActor]">get</span><span class="delimiter">(</span><a href="#400849" title="(net.liftweb.common.Box[String], net.liftweb.common.Box[String])">what</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27043" title="(alternative: =&gt; net.liftweb.common.Box[net.liftweb.http.LiftCometActor])net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">or</a><span class="delimiter">(</span><span class="delimiter">{</span>
          <a href="#326391" title="net.liftweb.common.Box[String]">theType</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27023" title="(f: String =&gt; net.liftweb.common.Box[net.liftweb.http.LiftCometActor])net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">flatMap</a> <span class="delimiter">{</span>
            <a title="String" id="400998">tpe</a> =&gt;
              <span class="keyword">val</span> <a title="net.liftweb.common.Box[net.liftweb.http.LiftCometActor]" id="400999">ret</a> = <a href="#230321" title="(contType: String, name: net.liftweb.common.Box[String], defaultXml: scala.xml.NodeSeq, attributes: Map[String,String])net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">findCometByType</a><span class="delimiter">(</span><a href="#400998" title="String">tpe</a>, <a href="#326392" title="net.liftweb.common.Box[String]">name</a>, <a href="#326393" title="scala.xml.NodeSeq">defaultXml</a>, <a href="#326394" title="Map[String,String]">attributes</a><span class="delimiter">)</span>
              <a href="#400999" title="net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">ret</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27031" title="(f: net.liftweb.http.LiftCometActor =&gt; Unit)Unit">foreach</a><span class="delimiter">(</span><a title="net.liftweb.http.LiftCometActor" id="401009">r</a> =&gt;
                <a href="#14496" title="(x$1: Unit)Unit">synchronized</a> <span class="delimiter">{</span>
                  <a href="#230171" title="(key: (net.liftweb.common.Box[String], net.liftweb.common.Box[String]), value: net.liftweb.http.LiftCometActor)Unit">asyncComponents</a><span class="delimiter">(</span><a href="#400849" title="(net.liftweb.common.Box[String], net.liftweb.common.Box[String])">what</a><span class="delimiter">)</span> = <a href="#401009" title="net.liftweb.http.LiftCometActor">r</a>
                  <a href="#230174" title="(key: String, value: net.liftweb.http.LiftCometActor)Unit">asyncById</a><span class="delimiter">(</span><a href="#401009" title="net.liftweb.http.LiftCometActor">r</a>.<a href="CometActor.scala.html#325343" title="=&gt; String">uniqueId</a><span class="delimiter">)</span> = <a href="#401009" title="net.liftweb.http.LiftCometActor">r</a>
                <span class="delimiter">}</span><span class="delimiter">)</span>
              <a href="#400999" title="net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">ret</a>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span><span class="delimiter">)</span>

        <a href="#400869" title="net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">ret</a>
      <span class="delimiter">}</span>

      <span class="keyword">for</span> <span class="delimiter">{</span>
        <a title="net.liftweb.http.LiftCometActor" id="401035">actor</a> &lt;- <a href="../../../../common/net/liftweb/common/Box.scala.html#27031" title="(f: net.liftweb.http.LiftCometActor =&gt; Unit)Unit">ret</a>
        <span class="delimiter">(</span><a title="(net.liftweb.common.Box[String], net.liftweb.common.Box[String])" id="401071">cst</a>, <a title="Any" id="401072">csv</a><span class="delimiter">)</span> &lt;- <a href="#230205" title="object LiftSession.this.cometSetup">cometSetup</a>.<a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75375" title="(f: ((net.liftweb.common.Box[String], net.liftweb.common.Box[String]), Any) =&gt; Unit)Unit">is</a> <span class="keyword">if</span> <a href="#401071" title="(net.liftweb.common.Box[String], net.liftweb.common.Box[String])">cst</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#400849" title="(net.liftweb.common.Box[String], net.liftweb.common.Box[String])">what</a>
      <span class="delimiter">}</span> <a href="#401035" title="net.liftweb.http.LiftCometActor">actor</a> <a href="../../../../common/net/liftweb/common/SimpleActor.scala.html#29491" title="(param: Any)Unit">!</a> <a href="#401072" title="Any">csv</a>

      <a href="#230205" title="object LiftSession.this.cometSetup">cometSetup</a>.<a href="../../../../util/net/liftweb/util/ValueHolder.scala.html#49791" title="(f: LiftSession.this.cometSetup.ValueType =&gt; LiftSession.this.cometSetup.ValueType)LiftSession.this.cometSetup.ValueType">atomicUpdate</a><span class="delimiter">(</span><a title="LiftSession.this.cometSetup.ValueType" id="401077">v</a> =&gt; <a href="#401077" title="LiftSession.this.cometSetup.ValueType">v</a>.<span title="(p: ((net.liftweb.common.Box[String], net.liftweb.common.Box[String]), Any) =&gt; Boolean)List[((net.liftweb.common.Box[String], net.liftweb.common.Box[String]), Any)]">filter</span><span class="delimiter">(</span><a href="#401081" title="((net.liftweb.common.Box[String], net.liftweb.common.Box[String]), Any)">_</a>.<span title="=&gt; (net.liftweb.common.Box[String], net.liftweb.common.Box[String])">_1</span> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#400849" title="(net.liftweb.common.Box[String], net.liftweb.common.Box[String])">what</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <a href="#400850" title="net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">ret</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>


  <span class="comment">/**
   * Finds a Comet actor by ID
   */</span>
  <span class="keyword">def</span> <a title="(id: String)net.liftweb.common.Box[net.liftweb.http.LiftCometActor]" id="230317">getAsyncComponent</a><span class="delimiter">(</span><a title="String" id="385758">id</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">Box</a><span class="delimiter">[</span>LiftCometActor<span class="delimiter">]</span> = <a href="#14496" title="(x$1: net.liftweb.common.Box[net.liftweb.http.LiftCometActor])net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">synchronized</a><span class="delimiter">(</span>
    <a href="#230309" title="(f: =&gt; net.liftweb.common.Box[net.liftweb.http.LiftCometActor])net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">testStatefulFeature</a><span class="delimiter">(</span><a href="#230174" title="=&gt; scala.collection.mutable.HashMap[String,net.liftweb.http.LiftCometActor]">asyncById</a>.<span title="(key: String)Option[net.liftweb.http.LiftCometActor]">get</span><a href="../../../../common/net/liftweb/common/Box.scala.html#28627" title="(in: Option[net.liftweb.http.LiftCometActor])net.liftweb.common.Box[net.liftweb.http.LiftCometActor]" class="delimiter">(</a><a href="#385758" title="String">id</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Adds a new Comet actor to this session
   */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(act: net.liftweb.http.LiftCometActor)Unit" id="230318">addCometActor</a><span class="delimiter">(</span><a title="net.liftweb.http.LiftCometActor" id="346743">act</a>: <a href="CometActor.scala.html#14092" title="net.liftweb.http.LiftCometActor">LiftCometActor</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#14496" title="(x$1: Unit)Unit">synchronized</a> <span class="delimiter">{</span>
    <a href="#230309" title="(f: =&gt; Unit)Unit">testStatefulFeature</a> <span class="delimiter">{</span>
      <a href="#230174" title="(key: String, value: net.liftweb.http.LiftCometActor)Unit">asyncById</a><span class="delimiter">(</span><a href="#346743" title="net.liftweb.http.LiftCometActor">act</a>.<a href="CometActor.scala.html#325343" title="=&gt; String">uniqueId</a><span class="delimiter">)</span> = <a href="#346743" title="net.liftweb.http.LiftCometActor">act</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span><span class="delimiter">[</span>liftweb<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(act: net.liftweb.http.LiftCometActor, theType: net.liftweb.common.Box[String], name: net.liftweb.common.Box[String], defaultXml: scala.xml.NodeSeq, attributes: Map[String,String])Unit" id="230319">addAndInitCometActor</a><span class="delimiter">(</span><a title="net.liftweb.http.LiftCometActor" id="401116">act</a>: <a href="CometActor.scala.html#14092" title="net.liftweb.http.LiftCometActor">LiftCometActor</a>,
                                            <a title="net.liftweb.common.Box[String]" id="401117">theType</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[String]">Box</a><span class="delimiter">[</span>String<span class="delimiter">]</span>,
                                            <a title="net.liftweb.common.Box[String]" id="401118">name</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[String]">Box</a><span class="delimiter">[</span>String<span class="delimiter">]</span>,
                                            <a title="scala.xml.NodeSeq" id="401119">defaultXml</a>: <span title="scala.xml.NodeSeq">NodeSeq</span>,
                                            <a title="Map[String,String]" id="401120">attributes</a>: <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#230309" title="(f: =&gt; Unit)Unit">testStatefulFeature</a> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="(net.liftweb.common.Box[String], net.liftweb.common.Box[String])" id="401125">what</a> = <span class="delimiter">(</span><a href="#401117" title="(x: net.liftweb.common.Box[String])ArrowAssoc[net.liftweb.common.Box[String]]">theType</a> <span title="(y: net.liftweb.common.Box[String])(net.liftweb.common.Box[String], net.liftweb.common.Box[String])">-&gt;</span> <a href="#401118" title="net.liftweb.common.Box[String]">name</a><span class="delimiter">)</span>
      <a href="#14496" title="(x$1: Unit)Unit">synchronized</a> <span class="delimiter">{</span>
        <a href="#230174" title="(key: String, value: net.liftweb.http.LiftCometActor)Unit">asyncById</a><span class="delimiter">(</span><a href="#401116" title="net.liftweb.http.LiftCometActor">act</a>.<a href="CometActor.scala.html#325343" title="=&gt; String">uniqueId</a><span class="delimiter">)</span> = <a href="#401116" title="net.liftweb.http.LiftCometActor">act</a>
        <a href="#230171" title="(key: (net.liftweb.common.Box[String], net.liftweb.common.Box[String]), value: net.liftweb.http.LiftCometActor)Unit">asyncComponents</a><span class="delimiter">(</span><a href="#401125" title="(net.liftweb.common.Box[String], net.liftweb.common.Box[String])">what</a><span class="delimiter">)</span> = <a href="#401116" title="net.liftweb.http.LiftCometActor">act</a>
      <span class="delimiter">}</span>
      <a href="#401116" title="net.liftweb.http.LiftCometActor">act</a>.<a href="CometActor.scala.html#325344" title="(theSession: net.liftweb.http.LiftSession, theType: net.liftweb.common.Box[String], name: net.liftweb.common.Box[String], defaultHtml: scala.xml.NodeSeq, attributes: Map[String,String])Unit">callInitCometActor</a><span class="delimiter">(</span><a href="#14496" title="net.liftweb.http.LiftSession" class="keyword">this</a>, <a href="#401117" title="net.liftweb.common.Box[String]">theType</a>, <a href="#401118" title="net.liftweb.common.Box[String]">name</a>, <a href="#401119" title="scala.xml.NodeSeq">defaultXml</a>, <a href="#401120" title="Map[String,String]">attributes</a><span class="delimiter">)</span>
      <a href="#401116" title="net.liftweb.http.LiftCometActor">act</a> <a href="../../../../common/net/liftweb/common/SimpleActor.scala.html#29491" title="(param: Any)Unit">!</a> <a href="CometActor.scala.html#328064" title="(initialReq: net.liftweb.common.Box[net.liftweb.http.Req])net.liftweb.http.PerformSetupComet2">PerformSetupComet2</a><span class="delimiter">(</span><span title="net.liftweb.common.Box[net.liftweb.http.Req]" class="keyword">if</span> <span class="delimiter">(</span><a href="#401116" title="net.liftweb.http.LiftCometActor">act</a>.<a href="CometActor.scala.html#325353" title="=&gt; Boolean">sendInitialReq_?</a><span class="delimiter">)</span>
        <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49309" title="=&gt; net.liftweb.common.Box[net.liftweb.http.Req]">request</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: net.liftweb.http.Req =&gt; net.liftweb.http.Req)net.liftweb.common.Box[net.liftweb.http.Req]">map</a><span class="delimiter">(</span><a href="#401164" title="net.liftweb.http.Req">_</a>.<a href="Req.scala.html#149165" title="=&gt; net.liftweb.http.Req">snapshot</a><span class="delimiter">)</span>
      <span class="keyword">else</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Remove a Comet actor
   */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(act: net.liftweb.http.LiftCometActor)Unit" id="230320">removeCometActor</a><span class="delimiter">(</span><a title="net.liftweb.http.LiftCometActor" id="346477">act</a>: <a href="CometActor.scala.html#14092" title="net.liftweb.http.LiftCometActor">LiftCometActor</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#14496" title="(x$1: Unit)Unit">synchronized</a> <span class="delimiter">{</span>
    <a href="#230309" title="(f: =&gt; Unit)Unit">testStatefulFeature</a> <span class="delimiter">{</span>
      <a href="#230174" title="=&gt; scala.collection.mutable.HashMap[String,net.liftweb.http.LiftCometActor]">asyncById</a> <span title="(key: java.lang.String)scala.collection.mutable.HashMap[String,net.liftweb.http.LiftCometActor]">-=</span> <a href="#346477" title="net.liftweb.http.LiftCometActor">act</a>.<a href="CometActor.scala.html#325343" title="=&gt; String">uniqueId</a>
      <a href="#230165" title="=&gt; scala.collection.mutable.HashMap[String,net.liftweb.http.S.AFuncHolder]">messageCallback</a> <span title="(key: java.lang.String)scala.collection.mutable.HashMap[String,net.liftweb.http.S.AFuncHolder]">-=</span> <a href="#346477" title="net.liftweb.http.LiftCometActor">act</a>.<a href="CometActor.scala.html#325346" title="=&gt; net.liftweb.http.js.JsonCall">jsonCall</a>.<a href="js/JsCommands.scala.html#344258" title="=&gt; String">funcId</a>
      <a href="#230171" title="=&gt; scala.collection.mutable.HashMap[(net.liftweb.common.Box[String], net.liftweb.common.Box[String]),net.liftweb.http.LiftCometActor]">asyncComponents</a> <span title="(key: (net.liftweb.common.Box[java.lang.String], net.liftweb.common.Box[java.lang.String]))scala.collection.mutable.HashMap[(net.liftweb.common.Box[String], net.liftweb.common.Box[String]),net.liftweb.http.LiftCometActor]">-=</span> <span class="delimiter">(</span><a href="#346477" title="net.liftweb.http.LiftCometActor">act</a>.<a href="CometActor.scala.html#325347" title="(x: net.liftweb.common.Box[String])ArrowAssoc[net.liftweb.common.Box[String]]">theType</a> <span title="(y: net.liftweb.common.Box[String])(net.liftweb.common.Box[String], net.liftweb.common.Box[String])">-&gt;</span> <a href="#346477" title="net.liftweb.http.LiftCometActor">act</a>.<a href="CometActor.scala.html#325348" title="=&gt; net.liftweb.common.Box[String]">name</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="net.liftweb.common.Full[String]" id="401171">toCmp</a> = <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: String)net.liftweb.common.Full[String]">Full</a><span class="delimiter">(</span><a href="#346477" title="net.liftweb.http.LiftCometActor">act</a>.<a href="CometActor.scala.html#325343" title="=&gt; String">uniqueId</a><span class="delimiter">)</span>

      <a href="#230165" title="=&gt; scala.collection.mutable.HashMap[String,net.liftweb.http.S.AFuncHolder]">messageCallback</a>.<span title="(f: (String, net.liftweb.http.S.AFuncHolder) =&gt; Any)Unit">foreach</span> <a href="#401276" title="Any" class="delimiter">{</a>
        <span class="keyword">case</span> <span title="Any" class="delimiter">(</span><a title="String" id="401279">k</a>, <a title="net.liftweb.http.S.AFuncHolder" id="401280">f</a><span class="delimiter">)</span> =&gt;
          <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#401280" title="net.liftweb.http.S.AFuncHolder">f</a>.<a href="S.scala.html#159454" title="=&gt; net.liftweb.common.Box[String]">owner</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#401171" title="net.liftweb.common.Full[String]">toCmp</a><span class="delimiter">)</span> <a href="#230165" title="=&gt; scala.collection.mutable.HashMap[String,net.liftweb.http.S.AFuncHolder]">messageCallback</a> <span title="(key: java.lang.String)scala.collection.mutable.HashMap[String,net.liftweb.http.S.AFuncHolder]">-=</span> <a href="#401279" title="String">k</a>
      <span class="delimiter">}</span>

      <a href="#230234" title="(f: =&gt; Unit)Unit">accessPostPageFuncs</a> <span class="delimiter">{</span>
        <a href="#230185" title="(x$1: Map[String,net.liftweb.http.PostPageFunctions])Unit">postPageFunctions</a> <span title="(key: String)scala.collection.immutable.Map[String,net.liftweb.http.PostPageFunctions]">-=</span> <a href="#346477" title="net.liftweb.http.LiftCometActor">act</a>.<a href="CometActor.scala.html#325343" title="=&gt; String">uniqueId</a>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="net.liftweb.common.Full[String]" id="401172">id</a> = <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: String)net.liftweb.common.Full[String]">Full</a><span class="delimiter">(</span><a href="#346477" title="net.liftweb.http.LiftCometActor">act</a>.<a href="CometActor.scala.html#325343" title="=&gt; String">uniqueId</a><span class="delimiter">)</span>
      <a href="#230165" title="=&gt; scala.collection.mutable.HashMap[String,net.liftweb.http.S.AFuncHolder]">messageCallback</a>.<span title="=&gt; Iterable[String]">keys</span>.<span title="=&gt; List[String]">toList</span>.<span title="(f: String =&gt; Any)Unit">foreach</span> <span class="delimiter">{</span>
        <a title="String" id="401359">k</a> =&gt;
          <span class="keyword">val</span> <a title="net.liftweb.http.S.AFuncHolder" id="401360">f</a> = <a href="#230165" title="(key: String)net.liftweb.http.S.AFuncHolder">messageCallback</a><span class="delimiter">(</span><a href="#401359" title="String">k</a><span class="delimiter">)</span>
          <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#401360" title="net.liftweb.http.S.AFuncHolder">f</a>.<a href="S.scala.html#159454" title="=&gt; net.liftweb.common.Box[String]">owner</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#401172" title="net.liftweb.common.Full[String]">id</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#230165" title="=&gt; scala.collection.mutable.HashMap[String,net.liftweb.http.S.AFuncHolder]">messageCallback</a> <span title="(key: java.lang.String)scala.collection.mutable.HashMap[String,net.liftweb.http.S.AFuncHolder]">-=</span> <a href="#401359" title="String">k</a>
          <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(contType: String, name: net.liftweb.common.Box[String], defaultXml: scala.xml.NodeSeq, attributes: Map[String,String])net.liftweb.common.Box[net.liftweb.http.LiftCometActor]" id="230321">findCometByType</a><span class="delimiter">(</span><a title="String" id="401000">contType</a>: <span title="String">String</span>,
                              <a title="net.liftweb.common.Box[String]" id="401001">name</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[String]">Box</a><span class="delimiter">[</span>String<span class="delimiter">]</span>,
                              <a title="scala.xml.NodeSeq" id="401002">defaultXml</a>: <span title="scala.xml.NodeSeq">NodeSeq</span>,
                              <a title="Map[String,String]" id="401003">attributes</a>: <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">Box</a><span class="delimiter">[</span>LiftCometActor<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#230309" title="(f: =&gt; net.liftweb.common.Box[net.liftweb.http.LiftCometActor])net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">testStatefulFeature</a> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="net.liftweb.http.CometCreationInfo" id="401417">createInfo</a> = <a href="Templates.scala.html#327989" title="(contType: String, name: net.liftweb.common.Box[String], defaultXml: scala.xml.NodeSeq, attributes: Map[String,String], session: net.liftweb.http.LiftSession)net.liftweb.http.CometCreationInfo">CometCreationInfo</a><span class="delimiter">(</span><a href="#401000" title="String">contType</a>, <a href="#401001" title="net.liftweb.common.Box[String]">name</a>, <a href="#401002" title="scala.xml.NodeSeq">defaultXml</a>, <a href="#401003" title="Map[String,String]">attributes</a>, <a href="#14496" title="net.liftweb.http.LiftSession" class="keyword">this</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="net.liftweb.common.Box[net.liftweb.http.LiftCometActor]" id="401418">boxCA</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">Box</a><span class="delimiter">[</span>LiftCometActor<span class="delimiter">]</span> = <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158882" title="=&gt; net.liftweb.http.LiftRules#FactoryMaker[net.liftweb.http.CometCreationInfo =&gt; net.liftweb.common.Box[net.liftweb.http.LiftCometActor]]">cometCreationFactory</a>.<a href="Factory.scala.html#159330" title="=&gt; net.liftweb.http.CometCreationInfo =&gt; net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">vend</a>.<span title="(v1: net.liftweb.http.CometCreationInfo)net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">apply</span><span class="delimiter">(</span><a href="#401417" title="net.liftweb.http.CometCreationInfo">createInfo</a><span class="delimiter">)</span>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: net.liftweb.http.LiftCometActor =&gt; net.liftweb.http.LiftCometActor)net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">map</a> <span class="delimiter">{</span>
        <a title="net.liftweb.http.LiftCometActor" id="401445">a</a> =&gt; <a href="#401445" title="net.liftweb.http.LiftCometActor">a</a> <a href="../../../../common/net/liftweb/common/SimpleActor.scala.html#29491" title="(param: Any)Unit">!</a> <a href="CometActor.scala.html#328064" title="(initialReq: net.liftweb.common.Box[net.liftweb.http.Req])net.liftweb.http.PerformSetupComet2">PerformSetupComet2</a><span class="delimiter">(</span><span title="net.liftweb.common.Box[net.liftweb.http.Req]" class="keyword">if</span> <span class="delimiter">(</span><a href="#401445" title="net.liftweb.http.LiftCometActor">a</a>.<a href="CometActor.scala.html#325353" title="=&gt; Boolean">sendInitialReq_?</a><span class="delimiter">)</span>
          <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49309" title="=&gt; net.liftweb.common.Box[net.liftweb.http.Req]">request</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: net.liftweb.http.Req =&gt; net.liftweb.http.Req)net.liftweb.common.Box[net.liftweb.http.Req]">map</a><span class="delimiter">(</span><a href="#401452" title="net.liftweb.http.Req">_</a>.<a href="Req.scala.html#149165" title="=&gt; net.liftweb.http.Req">snapshot</a><span class="delimiter">)</span>
        <span class="keyword">else</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a><span class="delimiter">)</span>;
        <a href="#401445" title="net.liftweb.http.LiftCometActor">a</a>
      <span class="delimiter">}</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27043" title="(alternative: =&gt; net.liftweb.common.Box[net.liftweb.http.LiftCometActor])net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">or</a>
        <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158879" title="=&gt; net.liftweb.http.LiftRules#RulesSeq[PartialFunction[net.liftweb.http.CometCreationInfo,net.liftweb.http.LiftCometActor]]">cometCreation</a>.<a href="LiftRules.scala.html#185552" title="=&gt; List[PartialFunction[net.liftweb.http.CometCreationInfo,net.liftweb.http.LiftCometActor]]">toList</a>.<span title="(p: PartialFunction[net.liftweb.http.CometCreationInfo,net.liftweb.http.LiftCometActor] =&gt; Boolean)Option[PartialFunction[net.liftweb.http.CometCreationInfo,net.liftweb.http.LiftCometActor]]">find</span><span class="delimiter">(</span><a href="#401477" title="PartialFunction[net.liftweb.http.CometCreationInfo,net.liftweb.http.LiftCometActor]">_</a>.<span title="(x: net.liftweb.http.CometCreationInfo)Boolean">isDefinedAt</span><span class="delimiter">(</span><a href="#401417" title="net.liftweb.http.CometCreationInfo">createInfo</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: PartialFunction[net.liftweb.http.CometCreationInfo,net.liftweb.http.LiftCometActor] =&gt; net.liftweb.http.LiftCometActor)Option[net.liftweb.http.LiftCometActor]">map</span><span class="delimiter">(</span><a href="#401483" title="PartialFunction[net.liftweb.http.CometCreationInfo,net.liftweb.http.LiftCometActor]">_</a>.<span title="(v1: net.liftweb.http.CometCreationInfo)net.liftweb.http.LiftCometActor">apply</span><span class="delimiter">(</span><a href="#401417" title="net.liftweb.http.CometCreationInfo">createInfo</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: net.liftweb.http.LiftCometActor =&gt; net.liftweb.http.LiftCometActor)Option[net.liftweb.http.LiftCometActor]">map</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#28627" title="(in: Option[net.liftweb.http.LiftCometActor])net.liftweb.common.Box[net.liftweb.http.LiftCometActor]" class="delimiter">{</a>
          <a title="net.liftweb.http.LiftCometActor" id="401490">a</a> =&gt; <a href="#401490" title="net.liftweb.http.LiftCometActor">a</a> <a href="../../../../common/net/liftweb/common/SimpleActor.scala.html#29491" title="(param: Any)Unit">!</a> <a href="CometActor.scala.html#328064" title="(initialReq: net.liftweb.common.Box[net.liftweb.http.Req])net.liftweb.http.PerformSetupComet2">PerformSetupComet2</a><span class="delimiter">(</span><span title="net.liftweb.common.Box[net.liftweb.http.Req]" class="keyword">if</span> <span class="delimiter">(</span><a href="#401490" title="net.liftweb.http.LiftCometActor">a</a>.<a href="CometActor.scala.html#325353" title="=&gt; Boolean">sendInitialReq_?</a><span class="delimiter">)</span>
            <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49309" title="=&gt; net.liftweb.common.Box[net.liftweb.http.Req]">request</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: net.liftweb.http.Req =&gt; net.liftweb.http.Req)net.liftweb.common.Box[net.liftweb.http.Req]">map</a><span class="delimiter">(</span><a href="#401496" title="net.liftweb.http.Req">_</a>.<a href="Req.scala.html#149165" title="=&gt; net.liftweb.http.Req">snapshot</a><span class="delimiter">)</span>
          <span class="keyword">else</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a><span class="delimiter">)</span>;
          <a href="#401490" title="net.liftweb.http.LiftCometActor">a</a>
        <span class="delimiter">}</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27043" title="(alternative: =&gt; net.liftweb.common.Box[net.liftweb.http.LiftCometActor])net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">or</a>
        <span class="delimiter">(</span><a href="../../../../util/net/liftweb/util/ClassHelpers.scala.html#48561" title="[C &lt;: AnyRef](name: String, where: List[String])(implicit m: scala.reflect.Manifest[C])net.liftweb.common.Box[Class[C]]">findType</a><span title="(name: String, where: List[String])(implicit m: scala.reflect.Manifest[net.liftweb.http.LiftCometActor])net.liftweb.common.Box[Class[net.liftweb.http.LiftCometActor]]" class="delimiter">[</span><a href="CometActor.scala.html#14092" title="net.liftweb.http.LiftCometActor">LiftCometActor</a><span class="delimiter">]</span><span title="(clazz: Class[_])scala.reflect.Manifest[net.liftweb.http.LiftCometActor]" class="delimiter">(</span><a href="#401000" title="String">contType</a>, <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159077" title="(end: String)List[java.lang.String]">buildPackage</a><span class="delimiter">(</span><span title="java.lang.String(&quot;comet&quot;)" class="string">&quot;comet&quot;</span><span class="delimiter">)</span> <a href="#401511" title="(prefix: List[java.lang.String])List[java.lang.String]">:::</a> <span class="delimiter">(</span><span title="java.lang.String(&quot;lift.app.comet&quot;)" class="string">&quot;lift.app.comet&quot;</span> <a href="#401514" title="(x: java.lang.String)List[java.lang.String]">::</a> <span title="object Nil">Nil</span><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27023" title="(f: Class[net.liftweb.http.LiftCometActor] =&gt; net.liftweb.common.Box[net.liftweb.http.LiftCometActor])net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">flatMap</a> <span class="delimiter">{</span>
          <a title="Class[net.liftweb.http.LiftCometActor]" id="401545">cls</a> =&gt;
            <a href="../../../../util/net/liftweb/util/ControlHelpers.scala.html#48611" title="(onError: Throwable =&gt; Unit)(f: =&gt; net.liftweb.http.LiftCometActor)net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">tryo</a><span class="delimiter">(</span><span class="delimiter">(</span>e: <span title="Throwable">Throwable</span><span class="delimiter">)</span> =&gt; <a href="#401657" title="Throwable">e</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <a title="Unit" id="401658">e</a>: java.lang.<span title="java.lang.NoSuchMethodException">NoSuchMethodException</span> =&gt; <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a title="Unit" id="401659">e</a> =&gt; <a href="../../../../common/net/liftweb/common/Logging.scala.html#19845" title="=&gt; net.liftweb.common.Logger">logger</a>.<a href="../../../../common/net/liftweb/common/Logging.scala.html#31949" title="(msg: =&gt; AnyRef, t: =&gt; Throwable)Unit">info</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Comet find by type Failed to instantiate &quot;)" class="string">&quot;Comet find by type Failed to instantiate &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#401545" title="Class[net.liftweb.http.LiftCometActor]">cls</a>.<span title="()java.lang.String">getName</span>, <a href="#401659" title="Throwable">e</a><span class="delimiter">)</span>
            <span class="delimiter">}</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="keyword">val</span> <a title="java.lang.reflect.Constructor[net.liftweb.http.LiftCometActor]" id="401687">constr</a> = <a href="#401545" title="Class[net.liftweb.http.LiftCometActor]">cls</a>.<span title="(x$1: &lt;repeated...&gt;[java.lang.Class[_]])java.lang.reflect.Constructor[net.liftweb.http.LiftCometActor]">getConstructor</span><span class="delimiter">(</span><span class="delimiter">)</span>
              <span class="keyword">val</span> <a title="net.liftweb.http.LiftCometActor" id="401688">ret</a> = <a href="#401687" title="java.lang.reflect.Constructor[net.liftweb.http.LiftCometActor]">constr</a>.<span title="(x$1: &lt;repeated...&gt;[java.lang.Object])net.liftweb.http.LiftCometActor">newInstance</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="net.liftweb.http.LiftCometActor" class="delimiter">[</span><a href="CometActor.scala.html#14092" title="net.liftweb.http.LiftCometActor">LiftCometActor</a><span class="delimiter">]</span>
              <a href="#401688" title="net.liftweb.http.LiftCometActor">ret</a>.<a href="CometActor.scala.html#325344" title="(theSession: net.liftweb.http.LiftSession, theType: net.liftweb.common.Box[String], name: net.liftweb.common.Box[String], defaultHtml: scala.xml.NodeSeq, attributes: Map[String,String])Unit">callInitCometActor</a><span class="delimiter">(</span><a href="#14496" title="net.liftweb.http.LiftSession" class="keyword">this</a>, <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: String)net.liftweb.common.Full[String]">Full</a><span class="delimiter">(</span><a href="#401000" title="String">contType</a><span class="delimiter">)</span>, <a href="#401001" title="net.liftweb.common.Box[String]">name</a>, <a href="#401002" title="scala.xml.NodeSeq">defaultXml</a>, <a href="#401003" title="Map[String,String]">attributes</a><span class="delimiter">)</span>

              <a href="#401688" title="net.liftweb.http.LiftCometActor">ret</a> <a href="../../../../common/net/liftweb/common/SimpleActor.scala.html#29491" title="(param: Any)Unit">!</a> <a href="CometActor.scala.html#328064" title="(initialReq: net.liftweb.common.Box[net.liftweb.http.Req])net.liftweb.http.PerformSetupComet2">PerformSetupComet2</a><span class="delimiter">(</span><span title="net.liftweb.common.Box[net.liftweb.http.Req]" class="keyword">if</span> <span class="delimiter">(</span><a href="#401688" title="net.liftweb.http.LiftCometActor">ret</a>.<a href="CometActor.scala.html#325353" title="=&gt; Boolean">sendInitialReq_?</a><span class="delimiter">)</span>
                <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49309" title="=&gt; net.liftweb.common.Box[net.liftweb.http.Req]">request</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: net.liftweb.http.Req =&gt; net.liftweb.http.Req)net.liftweb.common.Box[net.liftweb.http.Req]">map</a><span class="delimiter">(</span><a href="#401696" title="net.liftweb.http.Req">_</a>.<a href="Req.scala.html#149165" title="=&gt; net.liftweb.http.Req">snapshot</a><span class="delimiter">)</span>
              <span class="keyword">else</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a><span class="delimiter">)</span>
              <a href="#401688" title="net.liftweb.http.LiftCometActor">ret</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="net.liftweb.http.LiftCometActor" class="delimiter">[</span><a href="CometActor.scala.html#14092" title="net.liftweb.http.LiftCometActor">LiftCometActor</a><span class="delimiter">]</span>
            <span class="delimiter">}</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27043" title="(alternative: =&gt; net.liftweb.common.Box[net.liftweb.http.LiftCometActor])net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">or</a> <a href="../../../../util/net/liftweb/util/ControlHelpers.scala.html#48611" title="(onError: Throwable =&gt; Unit)(f: =&gt; net.liftweb.http.LiftCometActor)net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">tryo</a><span class="delimiter">(</span><span class="delimiter">(</span>e: <span title="Throwable">Throwable</span><span class="delimiter">)</span> =&gt; <a href="../../../../common/net/liftweb/common/Logging.scala.html#19845" title="=&gt; net.liftweb.common.Logger">logger</a>.<a href="../../../../common/net/liftweb/common/Logging.scala.html#31949" title="(msg: =&gt; AnyRef, t: =&gt; Throwable)Unit">info</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Comet find by type Failed to instantiate &quot;)" class="string">&quot;Comet find by type Failed to instantiate &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#401545" title="Class[net.liftweb.http.LiftCometActor]">cls</a>.<span title="()java.lang.String">getName</span>, <a href="#401813" title="Throwable">e</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="keyword">val</span> <a title="java.lang.reflect.Constructor[net.liftweb.http.LiftCometActor]" id="401841">constr</a> = <a href="#401545" title="Class[net.liftweb.http.LiftCometActor]">cls</a>.<span title="(x$1: &lt;repeated...&gt;[java.lang.Class[_]])java.lang.reflect.Constructor[net.liftweb.http.LiftCometActor]">getConstructor</span><span class="delimiter">(</span><a href="#14496" title="LiftSession.this.type" class="keyword">this</a>.<span title="()java.lang.Class[_]">getClass</span>, classOf<span title="java.lang.Class[net.liftweb.common.Box[String]](classOf[net.liftweb.common.Box])" class="delimiter">[</span>Box<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span>, classOf<span title="java.lang.Class[scala.xml.NodeSeq](classOf[scala.xml.NodeSeq])" class="delimiter">[</span>NodeSeq<span class="delimiter">]</span>, classOf<span title="java.lang.Class[Map[String,String]](classOf[scala.collection.immutable.Map])" class="delimiter">[</span>Map<span class="delimiter">[</span>String, String<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>
              <span class="keyword">val</span> <a title="net.liftweb.http.LiftCometActor" id="401842">ret</a> = <a href="#401841" title="java.lang.reflect.Constructor[net.liftweb.http.LiftCometActor]">constr</a>.<span title="(x$1: &lt;repeated...&gt;[java.lang.Object])net.liftweb.http.LiftCometActor">newInstance</span><span class="delimiter">(</span><a href="#14496" title="net.liftweb.http.LiftSession" class="keyword">this</a>, <a href="#401001" title="net.liftweb.common.Box[String]">name</a>, <a href="#401002" title="scala.xml.NodeSeq">defaultXml</a>, <a href="#401003" title="Map[String,String]">attributes</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="net.liftweb.http.LiftCometActor" class="delimiter">[</span><a href="CometActor.scala.html#14092" title="net.liftweb.http.LiftCometActor">LiftCometActor</a><span class="delimiter">]</span>;

              <a href="#401842" title="net.liftweb.http.LiftCometActor">ret</a> <a href="../../../../common/net/liftweb/common/SimpleActor.scala.html#29491" title="(param: Any)Unit">!</a> <a href="CometActor.scala.html#328064" title="(initialReq: net.liftweb.common.Box[net.liftweb.http.Req])net.liftweb.http.PerformSetupComet2">PerformSetupComet2</a><span class="delimiter">(</span><span title="net.liftweb.common.Box[net.liftweb.http.Req]" class="keyword">if</span> <span class="delimiter">(</span><a href="#401842" title="net.liftweb.http.LiftCometActor">ret</a>.<a href="CometActor.scala.html#325353" title="=&gt; Boolean">sendInitialReq_?</a><span class="delimiter">)</span>
                <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49309" title="=&gt; net.liftweb.common.Box[net.liftweb.http.Req]">request</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: net.liftweb.http.Req =&gt; net.liftweb.http.Req)net.liftweb.common.Box[net.liftweb.http.Req]">map</a><span class="delimiter">(</span><a href="#401853" title="net.liftweb.http.Req">_</a>.<a href="Req.scala.html#149165" title="=&gt; net.liftweb.http.Req">snapshot</a><span class="delimiter">)</span>
              <span class="keyword">else</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a><span class="delimiter">)</span>
              <a href="#401842" title="net.liftweb.http.LiftCometActor">ret</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="net.liftweb.http.LiftCometActor" class="delimiter">[</span><a href="CometActor.scala.html#14092" title="net.liftweb.http.LiftCometActor">LiftCometActor</a><span class="delimiter">]</span>
            <span class="delimiter">}</span>
        <span class="delimiter">}</span><span class="delimiter">)</span>
      <a href="#401418" title="net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">boxCA</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27031" title="(f: net.liftweb.http.LiftCometActor =&gt; Unit)Unit">foreach</a> <span class="delimiter">{</span>
        <a href="#401864" title="net.liftweb.http.LiftCometActor">_</a>.<a href="CometActor.scala.html#325359" title="(loc: java.util.Locale)Unit">setCometActorLocale</a><span class="delimiter">(</span><a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49322" title="=&gt; java.util.Locale">locale</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="#401418" title="net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">boxCA</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(in: net.liftweb.common.Failure)scala.xml.NodeSeq" id="230322">failedFind</a><span class="delimiter">(</span><a title="net.liftweb.common.Failure" id="401867">in</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10586" title="net.liftweb.common.Failure">Failure</a><span class="delimiter">)</span>: <span title="scala.xml.NodeSeq">NodeSeq</span> =
    &lt;<a title="scala.xml.NamespaceBinding" id="401871">html</a> xmlns:lift=<span title="java.lang.String(&quot;http://liftweb.net&quot;)" class="string">&quot;http://liftweb.net&quot;</span> xmlns=<span title="java.lang.String(&quot;http://www.w3.org/1999/xhtml&quot;)" class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span>&gt;
        &lt;<a href="#401871" title="scala.xml.Elem">head</a>/&gt;
      &lt;<a href="#401871" title="scala.xml.Elem" id="401872">body</a>&gt;
        <span class="delimiter">{</span><a href="../../../../util/net/liftweb/util/Helpers.scala.html#13346" title="object net.liftweb.util.Helpers">Helpers</a>.<a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#48940" title="(body: scala.xml.NodeSeq)net.liftweb.common.Box[scala.xml.NodeSeq]">errorDiv</a><span class="delimiter">(</span>
        &lt;<a href="#401871" title="scala.xml.Elem" id="401873">div</a>&gt;<span title="scala.xml.Text">Error</span> locating template.
            &lt;<a href="#401871" title="scala.xml.Elem">br</a>/&gt;
          Message:
          &lt;<a href="#401871" title="scala.xml.Elem" id="401874">b</a>&gt;
            <span class="delimiter">{</span><a href="#401867" title="net.liftweb.common.Failure">in</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#37795" title="=&gt; String">msg</a><span class="delimiter">}</span>
          &lt;/b&gt; &lt;<a href="#401871" title="scala.xml.Elem">br</a>/&gt;<span class="delimiter">{</span><a href="#401867" title="net.liftweb.common.Failure">in</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#37797" title="=&gt; net.liftweb.common.Box[Throwable]">exception</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: Throwable =&gt; scala.xml.Elem)net.liftweb.common.Box[scala.xml.Elem]">map</a><span class="delimiter">(</span><a title="Throwable" id="401879">e</a> =&gt; &lt;<a href="#401871" title="scala.xml.Elem" id="401880">pre</a>&gt;
          <span class="delimiter">{</span><a href="#401879" title="Throwable">e</a>.<span title="()java.lang.String">toString</span><span class="delimiter">}</span><span class="delimiter">{</span><a href="#401879" title="Throwable">e</a>.<span title="(xs: Array[java.lang.StackTraceElement])scala.collection.mutable.ArrayOps[java.lang.StackTraceElement]">getStackTrace</span>.<span title="(f: java.lang.StackTraceElement =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Array[java.lang.StackTraceElement],java.lang.String,Array[java.lang.String]])Array[java.lang.String]">map</span><span title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">(</span><a href="#402326" title="java.lang.StackTraceElement">_</a>.<span title="()java.lang.String">toString</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span><span class="delimiter">}</span>
        &lt;/pre&gt;<span class="delimiter">)</span>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; scala.xml.NodeSeq)scala.xml.NodeSeq">openOr</a><span class="delimiter">(</span><span title="object scala.xml.NodeSeq">NodeSeq</span>.<span title="=&gt; scala.xml.NodeSeq">Empty</span><span class="delimiter">)</span><span class="delimiter">}</span>
        &lt;/div&gt;<span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; scala.xml.NodeSeq)scala.xml.NodeSeq">openOr</a> <span title="object scala.xml.NodeSeq">NodeSeq</span>.<span title="=&gt; scala.xml.NodeSeq">Empty</span><span class="delimiter">}</span>
      &lt;/body&gt;
    &lt;/html&gt;

  <span class="keyword">private</span><span class="delimiter">[</span>liftweb<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(templateName: net.liftweb.common.Box[String], atWhat: Map[String,scala.xml.NodeSeq])scala.xml.NodeSeq" id="230323">findAndMerge</a><span class="delimiter">(</span><a title="net.liftweb.common.Box[String]" id="342038">templateName</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[String]">Box</a><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="Map[String,scala.xml.NodeSeq]" id="342039">atWhat</a>: <span title="Map[String,scala.xml.NodeSeq]">Map</span><span class="delimiter">[</span>String, NodeSeq<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="scala.xml.NodeSeq">NodeSeq</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="String" id="402506">name</a>: <span title="String">String</span> = <a href="#342038" title="net.liftweb.common.Box[String]">templateName</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: String =&gt; String)net.liftweb.common.Box[String]">map</a><span class="delimiter">(</span><a title="String" id="402512">s</a> =&gt; <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#402512" title="String">s</a>.<span title="(x$1: java.lang.String)Boolean">startsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#402512" title="String">s</a> <span class="keyword">else</span> <span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#402512" title="String">s</a><span class="delimiter">)</span>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; String)String">openOr</a><span class="delimiter">(</span><span title="java.lang.String(&quot;/templates-hidden/default&quot;)" class="string">&quot;/templates-hidden/default&quot;</span><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="(s: scala.xml.NodeSeq)Boolean" id="402507">hasLiftBind</a><span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="402521">s</a>: <span title="scala.xml.NodeSeq">NodeSeq</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> =
      <span class="delimiter">(</span><a href="../../../../util/net/liftweb/util/Helpers.scala.html#13346" title="object net.liftweb.util.Helpers">Helpers</a>.<a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#49019" title="(nodes: Seq[scala.xml.Node])(f: scala.xml.Elem =&gt; Option[Boolean])Option[Boolean]">findOption</a><span class="delimiter">(</span><a href="#402521" title="scala.xml.NodeSeq">s</a><span class="delimiter">)</span> <a href="#402527" title="Option[Boolean]" class="delimiter">{</a>
        <span class="keyword">case</span> <a title="Some[Boolean]" id="402528">e</a> <span class="keyword">if</span> <span title="java.lang.String(&quot;lift&quot;)" class="string">&quot;lift&quot;</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#402528" title="scala.xml.Elem">e</a>.<span title="=&gt; String">prefix</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="java.lang.String(&quot;bind&quot;)" class="string">&quot;bind&quot;</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#402528" title="scala.xml.Elem">e</a>.<span title="=&gt; String">label</span> =&gt; <span title="(x: Boolean)Some[Boolean]">Some</span><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="None.type">_</span> =&gt; <span title="object None">None</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>.<span title="=&gt; Boolean">isDefined</span>

    <a href="#230270" title="(name: String)net.liftweb.common.Box[scala.xml.NodeSeq]">findTemplate</a><span class="delimiter">(</span><a href="#402506" title="String">name</a><span class="delimiter">)</span> <span title="scala.xml.NodeSeq" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="scala.xml.NodeSeq" id="402555">f</a>@Failure<span class="delimiter">(</span><a title="String" id="402556">msg</a>, <a title="net.liftweb.common.Box[Throwable]" id="402557">be</a>, _<span class="delimiter">)</span> <span class="keyword">if</span> <a href="../../../../util/net/liftweb/util/Props.scala.html#13579" title="object net.liftweb.util.Props">Props</a>.<a href="../../../../util/net/liftweb/util/Props.scala.html#151319" title="=&gt; Boolean">devMode</a> =&gt;
        <a href="#230322" title="(in: net.liftweb.common.Failure)scala.xml.NodeSeq">failedFind</a><span class="delimiter">(</span><a href="#402555" title="net.liftweb.common.Failure">f</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="scala.xml.NodeSeq">Full</span><span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="402559">s</a><span class="delimiter">)</span> =&gt;
        <span title="scala.xml.NodeSeq" class="keyword">if</span> <span class="delimiter">(</span><a href="#402507" title="(s: scala.xml.NodeSeq)Boolean">hasLiftBind</a><span class="delimiter">(</span><a href="#402559" title="scala.xml.NodeSeq">s</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../../util/net/liftweb/util/Helpers.scala.html#13346" title="object net.liftweb.util.Helpers">Helpers</a>.<a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#49014" title="(vals: Map[String,scala.xml.NodeSeq], xml: scala.xml.NodeSeq)scala.xml.NodeSeq">bind</a><span class="delimiter">(</span><a href="#342039" title="Map[String,scala.xml.NodeSeq]">atWhat</a>, <a href="#402559" title="scala.xml.NodeSeq">s</a><span class="delimiter">)</span>
        <span class="keyword">else</span> <a href="#342039" title="Map[String,scala.xml.NodeSeq]">atWhat</a>.<span title="=&gt; List[(String, scala.xml.NodeSeq)]">toList</span> <span title="scala.xml.NodeSeq" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="scala.xml.NodeSeq">Nil</span> =&gt; <a href="#402559" title="scala.xml.NodeSeq">s</a>
          <span class="keyword">case</span> <a title="scala.xml.NodeSeq" id="402564">xs</a> =&gt; <a href="#402564" title="List[(String, scala.xml.NodeSeq)]">xs</a>.<span title="(f: (String, scala.xml.NodeSeq) =&gt; net.liftweb.util.CssSel)(implicit bf: scala.collection.generic.CanBuildFrom[List[(String, scala.xml.NodeSeq)],net.liftweb.util.CssSel,List[net.liftweb.util.CssSel]])List[net.liftweb.util.CssSel]">map</span> <a href="#402581" title="net.liftweb.util.CssSel" class="delimiter">{</a>
            <span class="keyword">case</span> <span title="net.liftweb.util.CssSel" class="delimiter">(</span><a title="String" id="402584">id</a>, <a title="scala.xml.NodeSeq" id="402585">replacement</a><span class="delimiter">)</span> =&gt; <span class="delimiter">(</span><span class="delimiter">(</span><span title="java.lang.String(&quot;#&quot;)" class="string">&quot;#&quot;</span> <a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#49034" title="implicit net.liftweb.util.BindHelpers.strToCssBindPromoter : (str: String)net.liftweb.util.ToCssBindPromoter">+</a> <a href="#402584" title="String">id</a><span class="delimiter">)</span> <a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#58351" title="(ns: scala.xml.NodeSeq)net.liftweb.util.CssSel">#&gt;</a> <a href="#402585" title="scala.xml.NodeSeq">replacement</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>.<span title="(f: (net.liftweb.util.CssSel, net.liftweb.util.CssSel) =&gt; net.liftweb.util.CssSel)net.liftweb.util.CssSel">reduceLeft</span><span title="(v1: scala.xml.NodeSeq)scala.xml.NodeSeq" class="delimiter">(</span><a href="#402642" title="net.liftweb.util.CssSel">_</a> <a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#271925" title="(other: net.liftweb.util.CssSel)net.liftweb.util.CssSel">&amp;</a> <a href="#402643" title="net.liftweb.util.CssSel">_</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#402559" title="scala.xml.NodeSeq">s</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="scala.xml.NodeSeq">_</span> =&gt; <a href="#342039" title="Map[String,scala.xml.NodeSeq]">atWhat</a>.<span title="=&gt; Iterable[scala.xml.NodeSeq]">values</span>.<span title="(f: scala.xml.NodeSeq =&gt; scala.collection.GenTraversableOnce[scala.xml.Node])(implicit bf: scala.collection.generic.CanBuildFrom[Iterable[scala.xml.NodeSeq],scala.xml.Node,Iterable[scala.xml.Node]])Iterable[scala.xml.Node]">flatMap</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Iterable.Coll,scala.xml.Node,Iterable[scala.xml.Node]]" class="delimiter">(</span><a href="#402664" title="scala.xml.NodeSeq">_</a>.<span title="=&gt; scala.collection.immutable.Seq[scala.xml.Node]">toSeq</span><span class="delimiter">)</span>.<span title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">toList</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>


<span class="comment">/**
 * The response from a page saying that it's been rendered
 */</span>
case <span class="keyword">object</span> <a href="#402708" title="object net.liftweb.http.ShutDown" id="402713">ShutDown</a>

<span class="comment">/**
 * If a class is to be used as a lift view (rendering from code rather than a static template)
 * and the method names are to be used as &quot;actions&quot;, the view must be marked as &quot;InsecureLiftView&quot;
 * because there exists the ability to execute arbitrary methods based on wire content
 */</span>
<a href="#14498" title="object net.liftweb.http.ShutDown" class="keyword">trait</a> <a title="trait InsecureLiftView extends java.lang.Object" id="14499">InsecureLiftView</a>

<span class="comment">/**
 *  The preferred way to do lift views... implement a partial function that dispatches
 * the incoming request to an appropriate method
 */</span>
<span class="keyword">trait</span> <a title="trait LiftView extends java.lang.Object with ScalaObject" id="14500">LiftView</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit net.liftweb.http.LiftView.nsToCns : (in: scala.xml.NodeSeq)net.liftweb.common.Box[scala.xml.NodeSeq]" id="402716">nsToCns</a><span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="402720">in</a>: <span title="scala.xml.NodeSeq">NodeSeq</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[scala.xml.NodeSeq]">Box</a><span class="delimiter">[</span>NodeSeq<span class="delimiter">]</span> = <a href="../../../../common/net/liftweb/common/Box.scala.html#10572" title="object net.liftweb.common.Box">Box</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#28633" title="(in: scala.xml.NodeSeq)net.liftweb.common.Box[scala.xml.NodeSeq]">legacyNullTest</a><span class="delimiter">(</span><a href="#402720" title="scala.xml.NodeSeq">in</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="=&gt; PartialFunction[String,() =&gt; net.liftweb.common.Box[scala.xml.NodeSeq]]" id="402717">dispatch</a>: <span title="PartialFunction[String,() =&gt; net.liftweb.common.Box[scala.xml.NodeSeq]]">PartialFunction</span><span class="delimiter">[</span>String, <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Box<span class="delimiter">[</span>NodeSeq<span class="delimiter">]</span><span class="delimiter">]</span>
<span class="delimiter">}</span>

<span class="comment">// an object that extracts an elem that defines a snippet</span>
<span class="keyword">private</span> <span class="keyword">object</span> <a title="object net.liftweb.http.SnippetNode" id="14501">SnippetNode</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(str: String)String" id="400450">removeLift</a><span class="delimiter">(</span><a title="String" id="402732">str</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="String">String</span> =
    <a href="#402732" title="String">str</a>.<span title="(x$1: java.lang.String)Int">indexOf</span><span class="delimiter">(</span><span title="java.lang.String(&quot;:&quot;)" class="string">&quot;:&quot;</span><span class="delimiter">)</span> <span title="String" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="java.lang.String" id="402738">x</a> <span class="keyword">if</span> <a href="#402738" title="Int">x</a> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(0)" class="int">0</span> =&gt; <a href="#402732" title="String">str</a>.<span title="(x$1: Int)java.lang.String">substring</span><span class="delimiter">(</span><a href="#402738" title="Int">x</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="String">_</span> =&gt; <a href="#402732" title="String">str</a>
    <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(key: String, value: String, rest: scala.xml.MetaData)scala.xml.MetaData" id="400451">makeMetaData</a><span class="delimiter">(</span><a title="String" id="402749">key</a>: <span title="String">String</span>, <a title="String" id="402750">value</a>: <span title="String">String</span>, <a title="scala.xml.MetaData" id="402751">rest</a>: <span title="scala.xml.MetaData">MetaData</span><span class="delimiter">)</span>: <span title="scala.xml.MetaData">MetaData</span> = <a href="#402749" title="String">key</a>.<span title="(x$1: java.lang.String)Int">indexOf</span><span class="delimiter">(</span><span title="java.lang.String(&quot;:&quot;)" class="string">&quot;:&quot;</span><span class="delimiter">)</span> <span title="scala.xml.MetaData" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a title="scala.xml.PrefixedAttribute" id="402757">x</a> <span class="keyword">if</span> <a href="#402757" title="Int">x</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span> =&gt; <span title="(pre: String, key: String, value: String, next: scala.xml.MetaData)scala.xml.PrefixedAttribute" class="keyword">new</span> <span title="scala.xml.PrefixedAttribute">PrefixedAttribute</span><span class="delimiter">(</span><a href="#402749" title="String">key</a>.<span title="(x$1: Int, x$2: Int)java.lang.String">substring</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#402757" title="Int">x</a><span class="delimiter">)</span>,
      <a href="#402749" title="String">key</a>.<span title="(x$1: Int)java.lang.String">substring</span><span class="delimiter">(</span><a href="#402757" title="Int">x</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>,
      <a href="#402750" title="String">value</a>, <a href="#402751" title="scala.xml.MetaData">rest</a><span class="delimiter">)</span>

    <span class="keyword">case</span> <span title="scala.xml.UnprefixedAttribute">_</span> =&gt; <span title="(key: String, value: String, next: scala.xml.MetaData)scala.xml.UnprefixedAttribute" class="keyword">new</span> <span title="scala.xml.UnprefixedAttribute">UnprefixedAttribute</span><span class="delimiter">(</span><a href="#402749" title="String">key</a>, <a href="#402750" title="String">value</a>, <a href="#402751" title="scala.xml.MetaData">rest</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(in: List[String])scala.xml.MetaData" id="400452">pairsToMetaData</a><span class="delimiter">(</span><a title="List[String]" id="402778">in</a>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="scala.xml.MetaData">MetaData</span> = <a href="#402778" title="List[String]">in</a> <span title="scala.xml.MetaData" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="scala.xml.Null.type">Nil</span> =&gt; <span title="object scala.xml.Null">Null</span>
    <span class="keyword">case</span> <a title="scala.xml.MetaData" id="402784">x</a> :: <a title="List[String]" id="402785">xs</a> =&gt; <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.xml.MetaData" id="402786">rest</a> = <a href="#400452" title="(in: List[String])scala.xml.MetaData">pairsToMetaData</a><span class="delimiter">(</span><a href="#402785" title="List[String]">xs</a><span class="delimiter">)</span>
      <a href="../../../../util/net/liftweb/util/StringHelpers.scala.html#48858" title="implicit net.liftweb.util.StringHelpers.stringToSuper : (in: String)net.liftweb.util.SuperString">x</a>.<a href="../../../../util/net/liftweb/util/StringHelpers.scala.html#58434" title="(sep: Char)List[String]">charSplit</a><span class="delimiter">(</span><span title="Char(\'=\')" class="char">'='</span><span class="delimiter">)</span>.<span title="(f: String =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[List[String],java.lang.String,List[java.lang.String]])List[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,java.lang.String,List[java.lang.String]]" class="delimiter">(</span><a href="../../../../util/net/liftweb/util/Helpers.scala.html#13346" title="object net.liftweb.util.Helpers">Helpers</a>.<a href="../../../../util/net/liftweb/util/HttpHelpers.scala.html#49042" title="(in: String)java.lang.String">urlDecode</a><span class="delimiter">)</span> <span title="scala.xml.MetaData" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="scala.xml.MetaData">Nil</span> =&gt; <a href="#402786" title="scala.xml.MetaData">rest</a>
        <span class="keyword">case</span> <a title="scala.xml.MetaData" id="402840">x</a> :: <span title="object Nil">Nil</span> =&gt; <a href="#400451" title="(key: String, value: String, rest: scala.xml.MetaData)scala.xml.MetaData">makeMetaData</a><span class="delimiter">(</span><a href="#402840" title="java.lang.String">x</a>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <a href="#402786" title="scala.xml.MetaData">rest</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="scala.xml.MetaData" id="402845">x</a> :: <a title="java.lang.String" id="402850">y</a> :: _ =&gt; <a href="#400451" title="(key: String, value: String, rest: scala.xml.MetaData)scala.xml.MetaData">makeMetaData</a><span class="delimiter">(</span><a href="#402845" title="java.lang.String">x</a>, <a href="#402850" title="java.lang.String">y</a>, <a href="#402786" title="scala.xml.MetaData">rest</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(s: String)Boolean" id="400453">isLiftClass</a><span class="delimiter">(</span><a title="String" id="402851">s</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> =
    <a href="#402851" title="String">s</a>.<span title="(x$1: java.lang.String)Boolean">startsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;lift:&quot;)" class="string">&quot;lift:&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <a href="#402851" title="String">s</a>.<span title="(x$1: java.lang.String)Boolean">startsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;l:&quot;)" class="string">&quot;l:&quot;</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(in: scala.xml.Elem)Option[(String, scala.xml.MetaData)]" id="400454">snippy</a><span class="delimiter">(</span><a title="scala.xml.Elem" id="402857">in</a>: <span title="scala.xml.Elem">Elem</span><span class="delimiter">)</span>: <span title="Option[(String, scala.xml.MetaData)]">Option</span><span class="delimiter">[</span><span class="delimiter">(</span>String, MetaData<span class="delimiter">)</span><span class="delimiter">]</span> =
    <span class="delimiter">(</span><span class="delimiter">(</span><span class="keyword">for</span> <span class="delimiter">{</span>
      <a title="Seq[scala.xml.Node]" id="402865">cls</a> &lt;- <a href="#402857" title="scala.xml.Elem">in</a>.<span title="(key: String)Option[Seq[scala.xml.Node]]">attribute</span><span title="(f: Seq[scala.xml.Node] =&gt; Option[String])Option[String]" class="delimiter">(</span><span title="java.lang.String(&quot;class&quot;)" class="string">&quot;class&quot;</span><span class="delimiter">)</span>
      <a title="String" id="402887">snip</a> &lt;- <a href="#402865" title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">cls</a>.<a href="../../../../util/net/liftweb/util/StringHelpers.scala.html#48858" title="implicit net.liftweb.util.StringHelpers.stringToSuper : (in: String)net.liftweb.util.SuperString">text</a>.<a href="../../../../util/net/liftweb/util/StringHelpers.scala.html#58434" title="(sep: Char)List[String]">charSplit</a><span class="delimiter">(</span><span title="Char(\' \')" class="char">' '</span><span class="delimiter">)</span>.<span title="(p: String =&gt; Boolean)Option[String]">find</span><span title="(f: String =&gt; String)Option[String]" class="delimiter">(</span><a href="#400453" title="(s: String)Boolean">isLiftClass</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="#402887" title="String">snip</a><span class="delimiter">)</span> <span title="(alternative: =&gt; Option[String])Option[String]">orElse</span> <a href="#402857" title="scala.xml.Elem">in</a>.<span title="(key: String)Option[Seq[scala.xml.Node]]">attribute</span><span class="delimiter">(</span><span title="java.lang.String(&quot;lift&quot;)" class="string">&quot;lift&quot;</span><span class="delimiter">)</span>.<span title="(f: Seq[scala.xml.Node] =&gt; String)Option[String]">map</span><span class="delimiter">(</span><a href="#402900" title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">_</a>.<span title="=&gt; String">text</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: String =&gt; (String, scala.xml.MetaData))Option[(String, scala.xml.MetaData)]">map</span> <span class="delimiter">{</span>
      <a title="String" id="402913">snip</a> =&gt;
        <a href="../../../../util/net/liftweb/util/StringHelpers.scala.html#48858" title="implicit net.liftweb.util.StringHelpers.stringToSuper : (in: String)net.liftweb.util.SuperString">snip</a>.<a href="../../../../util/net/liftweb/util/StringHelpers.scala.html#58434" title="(sep: Char)List[String]">charSplit</a><span class="delimiter">(</span><span title="Char(\'?\')" class="char">'?'</span><span class="delimiter">)</span> <span title="(String, scala.xml.MetaData)" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="(String, scala.xml.Null.type)">Nil</span> =&gt; <a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#49003" title="implicit net.liftweb.util.BindHelpers.strToSuperArrowAssoc : (in: String)net.liftweb.util.Helpers.SuperArrowAssoc" class="string">&quot;this should never happen&quot;</a> <a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#58395" title="(in: scala.xml.Null.type)(String, scala.xml.Null.type)">-&gt;</a> <span title="object scala.xml.Null">Null</span>
          <span class="keyword">case</span> <a title="(String, scala.xml.Null.type)" id="402973">x</a> :: <span title="object Nil">Nil</span> =&gt; <a href="../../../../util/net/liftweb/util/HttpHelpers.scala.html#49042" title="(in: String)java.lang.String">urlDecode</a><a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#49003" title="implicit net.liftweb.util.BindHelpers.strToSuperArrowAssoc : (in: String)net.liftweb.util.Helpers.SuperArrowAssoc" class="delimiter">(</a><a href="#400450" title="(str: String)String">removeLift</a><span class="delimiter">(</span><a href="#402973" title="String">x</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#58395" title="(in: scala.xml.Null.type)(String, scala.xml.Null.type)">-&gt;</a> <span title="object scala.xml.Null">Null</span>
          <span class="keyword">case</span> <a title="(String, scala.xml.MetaData)" id="403018">x</a> :: <a title="List[String]" id="403019">xs</a> =&gt; <a href="../../../../util/net/liftweb/util/HttpHelpers.scala.html#49042" title="(in: String)java.lang.String">urlDecode</a><a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#49003" title="implicit net.liftweb.util.BindHelpers.strToSuperArrowAssoc : (in: String)net.liftweb.util.Helpers.SuperArrowAssoc" class="delimiter">(</a><a href="#400450" title="(str: String)String">removeLift</a><span class="delimiter">(</span><a href="#403018" title="String">x</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#58395" title="(in: scala.xml.MetaData)(String, scala.xml.MetaData)">-&gt;</a> <a href="#400452" title="(in: List[String])scala.xml.MetaData">pairsToMetaData</a><span class="delimiter">(</span><a href="#403019" title="List[String]">xs</a>.<span title="(f: String =&gt; scala.collection.GenTraversableOnce[String])(implicit bf: scala.collection.generic.CanBuildFrom[List[String],String,List[String]])List[String]">flatMap</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,String,List[String]]" class="delimiter">(</span><a href="../../../../util/net/liftweb/util/StringHelpers.scala.html#48858" title="implicit net.liftweb.util.StringHelpers.stringToSuper : (in: String)net.liftweb.util.SuperString">_</a>.<a href="../../../../util/net/liftweb/util/StringHelpers.scala.html#58433" title="(sep: String)List[String]">roboSplit</a><span class="delimiter">(</span><span title="java.lang.String(&quot;[;&amp;]&quot;)" class="string">&quot;[;&amp;]&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(in: scala.xml.MetaData)(Boolean, scala.xml.MetaData)" id="400455">liftAttrsAndParallel</a><span class="delimiter">(</span><a title="scala.xml.MetaData" id="403107">in</a>: <span title="scala.xml.MetaData">MetaData</span><span class="delimiter">)</span>: <span title="(Boolean, scala.xml.MetaData)" class="delimiter">(</span>Boolean, MetaData<span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="scala.xml.MetaData" id="403109">next</a> = <a href="#403107" title="scala.xml.MetaData">in</a>
    <span class="keyword">var</span> <a title="Boolean" id="403110">par</a> = <span title="Boolean(false)" class="keyword">false</span>
    <span class="keyword">var</span> <a title="scala.xml.MetaData" id="403111">nonLift</a>: <span title="scala.xml.MetaData">MetaData</span> = <span title="object scala.xml.Null">Null</span>

    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#403109" title="scala.xml.MetaData">next</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="object scala.xml.Null">Null</span><span class="delimiter">)</span> <a href="#403112" title="()Unit" class="delimiter">{</a>
      <a href="#403109" title="scala.xml.MetaData">next</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="comment">// remove the lift class css classes from the class attribute</span>
        <span class="keyword">case</span> <a title="Unit" id="403118">up</a>: <span title="scala.xml.UnprefixedAttribute">UnprefixedAttribute</span> <span class="keyword">if</span> <a href="#403118" title="scala.xml.UnprefixedAttribute">up</a>.<span title="=&gt; String">key</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;class&quot;)" class="string">&quot;class&quot;</span> =&gt;
          <a href="#403118" title="scala.xml.UnprefixedAttribute">up</a>.<span title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">value</span>.<a href="../../../../util/net/liftweb/util/StringHelpers.scala.html#48858" title="implicit net.liftweb.util.StringHelpers.stringToSuper : (in: String)net.liftweb.util.SuperString">text</a>.<a href="../../../../util/net/liftweb/util/StringHelpers.scala.html#58434" title="(sep: Char)List[String]">charSplit</a><span class="delimiter">(</span><span title="Char(\' \')" class="char">' '</span><span class="delimiter">)</span>.<span title="(p: String =&gt; Boolean)List[String]">filter</span><span class="delimiter">(</span><a title="String" id="403136">s</a> =&gt; <span title="=&gt; Boolean">!</span><a href="#400453" title="(s: String)Boolean">isLiftClass</a><span class="delimiter">(</span><a href="#403136" title="String">s</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="Unit">Nil</span> =&gt;
            <span class="keyword">case</span> <a title="Unit" id="403137">xs</a> =&gt; <a href="#403111" title="scala.xml.MetaData">nonLift</a> = <span title="(key: String, value: String, next: scala.xml.MetaData)scala.xml.UnprefixedAttribute" class="keyword">new</span> <span title="scala.xml.UnprefixedAttribute">UnprefixedAttribute</span><span class="delimiter">(</span><span title="java.lang.String(&quot;class&quot;)" class="string">&quot;class&quot;</span>,
              <a href="#403137" title="List[String]">xs</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span><span class="delimiter">)</span>,
              <a href="#403111" title="scala.xml.MetaData">nonLift</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

        <span class="keyword">case</span> <a title="Unit" id="403144">p</a>: <span title="scala.xml.PrefixedAttribute">PrefixedAttribute</span>
          <span class="keyword">if</span> <span class="delimiter">(</span><a href="#403144" title="scala.xml.PrefixedAttribute">p</a>.<span title="=&gt; String">pre</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;l&quot;)" class="string">&quot;l&quot;</span> <span title="(x: Boolean)Boolean">||</span> <a href="#403144" title="scala.xml.PrefixedAttribute">p</a>.<span title="=&gt; String">pre</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;lift&quot;)" class="string">&quot;lift&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#403144" title="scala.xml.PrefixedAttribute">p</a>.<span title="=&gt; String">key</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;parallel&quot;)" class="string">&quot;parallel&quot;</span>
        =&gt; <a href="#403110" title="Boolean">par</a> = <span title="Boolean(true)" class="keyword">true</span>

        <span class="keyword">case</span> <a title="Unit" id="403157">up</a>: <span title="scala.xml.UnprefixedAttribute">UnprefixedAttribute</span> <span class="keyword">if</span> <a href="#403157" title="scala.xml.UnprefixedAttribute">up</a>.<span title="=&gt; String">key</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;lift&quot;)" class="string">&quot;lift&quot;</span> =&gt; <span class="comment">// ignore</span>

        <span class="keyword">case</span> <a title="Unit" id="403162">p</a>: <span title="scala.xml.PrefixedAttribute">PrefixedAttribute</span>
          <span class="keyword">if</span> <a href="#403162" title="scala.xml.PrefixedAttribute">p</a>.<span title="=&gt; String">pre</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;lift&quot;)" class="string">&quot;lift&quot;</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#403162" title="scala.xml.PrefixedAttribute">p</a>.<span title="=&gt; String">key</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;snippet&quot;)" class="string">&quot;snippet&quot;</span>
        =&gt; <a href="#403111" title="scala.xml.MetaData">nonLift</a> = <a href="#403162" title="scala.xml.PrefixedAttribute">p</a>.<span title="(next: scala.xml.MetaData)scala.xml.PrefixedAttribute">copy</span><span class="delimiter">(</span><a href="#403111" title="scala.xml.MetaData">nonLift</a><span class="delimiter">)</span>

        <span class="keyword">case</span> <a title="Unit" id="403171">a</a> =&gt; <a href="#403111" title="scala.xml.MetaData">nonLift</a> = <a href="#403171" title="scala.xml.MetaData">a</a>.<span title="(next: scala.xml.MetaData)scala.xml.MetaData">copy</span><span class="delimiter">(</span><a href="#403111" title="scala.xml.MetaData">nonLift</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#403109" title="scala.xml.MetaData">next</a> = <a href="#403109" title="scala.xml.MetaData">next</a>.<span title="=&gt; scala.xml.MetaData">next</span>
    <span class="delimiter">}</span>


    <span title="(_1: Boolean, _2: scala.xml.MetaData)(Boolean, scala.xml.MetaData)" class="delimiter">(</span><a href="#403110" title="Boolean">par</a>, <a href="#403111" title="scala.xml.MetaData">nonLift</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>


  <span class="keyword">def</span> <a title="(baseNode: scala.xml.Node)Option[(scala.xml.Elem, scala.xml.NodeSeq, Boolean, scala.xml.MetaData, String)]" id="400456">unapply</a><span class="delimiter">(</span><a title="scala.xml.Node" id="400457">baseNode</a>: <span title="scala.xml.Node">Node</span><span class="delimiter">)</span>: <span title="Option[(scala.xml.Elem, scala.xml.NodeSeq, Boolean, scala.xml.MetaData, String)]">Option</span><span class="delimiter">[</span><span class="delimiter">(</span>Elem, NodeSeq, Boolean, MetaData, String<span class="delimiter">)</span><span class="delimiter">]</span> =
    <a href="#400457" title="scala.xml.Node">baseNode</a> <span title="Option[(scala.xml.Elem, scala.xml.NodeSeq, Boolean, scala.xml.MetaData, String)]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Some[(scala.xml.Elem, scala.xml.NodeSeq, Boolean, scala.xml.MetaData, String)]" id="403178">elm</a>: <span title="scala.xml.Elem">Elem</span> <span class="keyword">if</span> <a href="#403178" title="scala.xml.Elem">elm</a>.<span title="=&gt; String">prefix</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;lift&quot;)" class="string">&quot;lift&quot;</span> <span title="(x: Boolean)Boolean">||</span> <a href="#403178" title="scala.xml.Elem">elm</a>.<span title="=&gt; String">prefix</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;l&quot;)" class="string">&quot;l&quot;</span> =&gt; <span class="delimiter">{</span>
        <span title="(x: (scala.xml.Elem, scala.xml.NodeSeq, Boolean, scala.xml.MetaData, String))Some[(scala.xml.Elem, scala.xml.NodeSeq, Boolean, scala.xml.MetaData, String)]">Some</span><span class="delimiter">(</span><span title="(_1: scala.xml.Elem, _2: scala.xml.NodeSeq, _3: Boolean, _4: scala.xml.MetaData, _5: String)(scala.xml.Elem, scala.xml.NodeSeq, Boolean, scala.xml.MetaData, String)" class="delimiter">(</span><a href="#403178" title="scala.xml.Elem">elm</a>, <a href="#403178" title="scala.xml.Elem">elm</a>.<span title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">child</span>,
          <a href="#403178" title="scala.xml.Elem">elm</a>.<span title="=&gt; scala.xml.MetaData">attributes</span>.<span title="(p: scala.xml.MetaData =&gt; Boolean)Option[scala.xml.MetaData]">find</span> <a href="#403206" title="Boolean" class="delimiter">{</a>
            <span class="keyword">case</span> <a title="Boolean" id="403207">p</a>: <span title="scala.xml.PrefixedAttribute">PrefixedAttribute</span> =&gt; <a href="#403207" title="scala.xml.PrefixedAttribute">p</a>.<span title="=&gt; String">pre</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;lift&quot;)" class="string">&quot;lift&quot;</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span class="delimiter">(</span><a href="#403207" title="scala.xml.PrefixedAttribute">p</a>.<span title="=&gt; String">key</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;parallel&quot;)" class="string">&quot;parallel&quot;</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <span title="Boolean(false)">_</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
          <span class="delimiter">}</span>.<span title="=&gt; Boolean">isDefined</span>,
          <a href="#403178" title="scala.xml.Elem">elm</a>.<span title="=&gt; scala.xml.MetaData">attributes</span>, <a href="#403178" title="scala.xml.Elem">elm</a>.<span title="=&gt; String">label</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">case</span> <a title="Option[(scala.xml.Elem, scala.xml.NodeSeq, Boolean, scala.xml.MetaData, String)]" id="403222">elm</a>: <span title="scala.xml.Elem">Elem</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">for</span> <span class="delimiter">{</span>
          <span class="delimiter">(</span><a title="String" id="403237">snippetName</a>, <a title="scala.xml.MetaData" id="403238">lift</a><span class="delimiter">)</span> &lt;- <a href="#400454" title="(in: scala.xml.Elem)Option[(String, scala.xml.MetaData)]">snippy</a><a href="#403225" title="(f: (String, scala.xml.MetaData) =&gt; (scala.xml.Elem, scala.xml.NodeSeq, Boolean, scala.xml.MetaData, String))Option[(scala.xml.Elem, scala.xml.NodeSeq, Boolean, scala.xml.MetaData, String)]" class="delimiter">(</a><a href="#403222" title="scala.xml.Elem">elm</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">yield</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a href="#403240" title="(Boolean, scala.xml.MetaData)" class="delimiter">(</a><a href="#403239" title="Boolean" id="403240">par</a>, <a href="#403239" title="scala.xml.MetaData" id="403241">nonLift</a><span class="delimiter">)</span> = <a href="#400455" title="(in: scala.xml.MetaData)(Boolean, scala.xml.MetaData)">liftAttrsAndParallel</a><span title="(Boolean, scala.xml.MetaData) @unchecked" class="delimiter">(</span><a href="#403222" title="scala.xml.Elem">elm</a>.<span title="=&gt; scala.xml.MetaData">attributes</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="scala.xml.Elem" id="403242">newElm</a> = <span title="scala.xml.Elem" class="keyword">new</span> <span title="scala.xml.Elem">Elem</span><span class="delimiter">(</span><a href="#403222" title="scala.xml.Elem">elm</a>.<span title="=&gt; String">prefix</span>, <a href="#403222" title="scala.xml.Elem">elm</a>.<span title="=&gt; String">label</span>,
            <a href="#403241" title="scala.xml.MetaData">nonLift</a>, <a href="#403222" title="scala.xml.Elem">elm</a>.<span title="=&gt; scala.xml.NamespaceBinding">scope</span>, <a href="#403222" title="scala.xml.Elem">elm</a>.<span title="=&gt; scala.xml.Node*">child</span>: _*<span class="delimiter">)</span>
          <span title="(_1: scala.xml.Elem, _2: scala.xml.Elem, _3: Boolean, _4: scala.xml.MetaData, _5: String)(scala.xml.Elem, scala.xml.Elem, Boolean, scala.xml.MetaData, String)" class="delimiter">(</span><a href="#403242" title="scala.xml.Elem">newElm</a>, <a href="#403242" title="scala.xml.Elem">newElm</a>, <a href="#403240" title="Boolean">par</a> <span title="(x: Boolean)Boolean">||</span>
            <span class="delimiter">(</span><a href="#403238" title="scala.xml.MetaData">lift</a>.<span title="(p: scala.xml.MetaData =&gt; Boolean)Option[scala.xml.MetaData]">find</span> <a href="#403268" title="Boolean" class="delimiter">{</a>
              <span class="keyword">case</span> <a title="Boolean(true)" id="403269">up</a>: <span title="scala.xml.UnprefixedAttribute">UnprefixedAttribute</span> <span class="keyword">if</span> <a href="#403269" title="scala.xml.UnprefixedAttribute">up</a>.<span title="=&gt; String">key</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;parallel&quot;)" class="string">&quot;parallel&quot;</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
              <span class="keyword">case</span> <span title="Boolean(false)">_</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
            <span class="delimiter">}</span>.
              <span title="(f: scala.xml.MetaData =&gt; Option[Boolean])Option[Boolean]">flatMap</span><span class="delimiter">(</span><a title="scala.xml.MetaData" id="403278">up</a> =&gt; <a href="../../../../util/net/liftweb/util/BasicTypesHelpers.scala.html#49094" title="object net.liftweb.util.Helpers.AsBoolean">AsBoolean</a>.<a href="../../../../util/net/liftweb/util/BasicTypesHelpers.scala.html#270642" title="(in: String)Option[Boolean]">unapply</a><span class="delimiter">(</span><a href="#403278" title="scala.xml.MetaData">up</a>.<span title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">value</span>.<span title="=&gt; String">text</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(default: =&gt; Boolean)Boolean">getOrElse</span>
              <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>, <a href="#403238" title="scala.xml.MetaData">lift</a>, <a href="#403237" title="String">snippetName</a><span class="delimiter">)</span>

        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">case</span> <span title="None.type">_</span> =&gt; <span class="delimiter">{</span>
        <span title="object None">None</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
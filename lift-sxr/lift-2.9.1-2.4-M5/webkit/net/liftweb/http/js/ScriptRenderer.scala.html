<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>webkit/net/liftweb/http/js/ScriptRenderer.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright 2007-2011 WorldWide Conferencing, LLC
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

<span class="keyword">package</span> net.liftweb
<span class="keyword">package</span> http
<span class="keyword">package</span> js

<span class="keyword">import</span> net.liftweb.http._
<span class="keyword">import</span> net.liftweb.common._

<span class="comment">/**
 * the default mechanisms for doing Ajax and Comet in Lift
 */</span>
<span class="keyword">object</span> <a title="object net.liftweb.http.js.ScriptRenderer" id="14964">ScriptRenderer</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="comment">/**
   * Renders the default ajax script use by lift
   */</span>
  <span class="keyword">def</span> <a title="=&gt; net.liftweb.http.js.JsCmds.Run" id="364744">ajaxScript</a> = <a href="JsCommands.scala.html#14916" title="object net.liftweb.http.js.JsCmds">JsCmds</a>.<a href="JsCommands.scala.html#196384" title="(text: String)net.liftweb.http.js.JsCmds.Run">Run</a><span class="delimiter">(</span><span title="java.lang.String(&quot;\012\012(function() {\012\012  window.liftAjax = {\012    lift_ajaxQueue: [],\012    lift_ajaxInProcess: null,\012    lift_doCycleQueueCnt: 0,\012    lift_ajaxShowing: false,\012    lift_ajaxRetryCount: &quot;)" class="string">&quot;&quot;&quot;

(function() {

  window.liftAjax = {
    lift_ajaxQueue: [],
    lift_ajaxInProcess: null,
    lift_doCycleQueueCnt: 0,
    lift_ajaxShowing: false,
    lift_ajaxRetryCount: &quot;&quot;&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span class="delimiter">(</span><a href="../LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="../LiftRules.scala.html#158979" title="=&gt; net.liftweb.common.Box[Int]">ajaxRetryCount</a> <a href="../../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; Int)Int">openOr</a> <span title="Int(3)" class="int">3</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;,\012\012    lift_ajaxHandler: function(theData, theSuccess, theFailure, responseType){\012\011  var toSend = {retryCnt: 0};\012\011  toSend.when = (new Date()).getTime();\012\011  toSend.theData = theData;\012\011  toSend.onSuccess = theSuccess;\012\011  toSend.onFailure = theFailure;\012\011  toSend.responseType = responseType;\012\012\011  liftAjax.lift_ajaxQueue.push(toSend);\012\011  liftAjax.lift_ajaxQueueSort();\012\011  liftAjax.lift_doCycleQueueCnt++;\012\011  liftAjax.lift_doAjaxCycle();\012\011  return false; // buttons in forms don\'t trigger the form\012\012    },\012\012    lift_uriSuffix: undefined,\012\012    lift_ajaxQueueSort: function() {\012      liftAjax.lift_ajaxQueue.sort(function (a, b) {return a.when - b.when;});\012    },\012\012    lift_defaultFailure: function() {\012      &quot;)" class="string">&quot;&quot;&quot;,

    lift_ajaxHandler: function(theData, theSuccess, theFailure, responseType){
	  var toSend = {retryCnt: 0};
	  toSend.when = (new Date()).getTime();
	  toSend.theData = theData;
	  toSend.onSuccess = theSuccess;
	  toSend.onFailure = theFailure;
	  toSend.responseType = responseType;

	  liftAjax.lift_ajaxQueue.push(toSend);
	  liftAjax.lift_ajaxQueueSort();
	  liftAjax.lift_doCycleQueueCnt++;
	  liftAjax.lift_doAjaxCycle();
	  return false; // buttons in forms don't trigger the form

    },

    lift_uriSuffix: undefined,

    lift_ajaxQueueSort: function() {
      liftAjax.lift_ajaxQueue.sort(function (a, b) {return a.when - b.when;});
    },

    lift_defaultFailure: function() {
      &quot;&quot;&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span class="delimiter">(</span><a href="../LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="../LiftRules.scala.html#158997" title="=&gt; net.liftweb.common.Box[() =&gt; net.liftweb.http.js.JsCmd]">ajaxDefaultFailure</a>.<a href="../../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: () =&gt; net.liftweb.http.js.JsCmd =&gt; String)net.liftweb.common.Box[String]">map</a><span class="delimiter">(</span><a href="#364768" title="()net.liftweb.http.js.JsCmd">_</a><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="JsCommands.scala.html#148953" title="=&gt; String">toJsCmd</a><span class="delimiter">)</span> <a href="../../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; String)String">openOr</a> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012    },\012\012    lift_startAjax: function() {\012      liftAjax.lift_ajaxShowing = true;\012      &quot;)" class="string">&quot;&quot;&quot;
    },

    lift_startAjax: function() {
      liftAjax.lift_ajaxShowing = true;
      &quot;&quot;&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span class="delimiter">(</span><a href="../LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="../LiftRules.scala.html#158982" title="=&gt; net.liftweb.common.Box[() =&gt; net.liftweb.http.js.JsCmd]">ajaxStart</a>.<a href="../../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: () =&gt; net.liftweb.http.js.JsCmd =&gt; String)net.liftweb.common.Box[String]">map</a><span class="delimiter">(</span><a href="#364783" title="()net.liftweb.http.js.JsCmd">_</a><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="JsCommands.scala.html#148953" title="=&gt; String">toJsCmd</a><span class="delimiter">)</span> <a href="../../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; String)String">openOr</a> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012    },\012\012    lift_endAjax: function() {\012      liftAjax.lift_ajaxShowing = false;\012      &quot;)" class="string">&quot;&quot;&quot;
    },

    lift_endAjax: function() {
      liftAjax.lift_ajaxShowing = false;
      &quot;&quot;&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span class="delimiter">(</span><a href="../LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="../LiftRules.scala.html#158990" title="=&gt; net.liftweb.common.Box[() =&gt; net.liftweb.http.js.JsCmd]">ajaxEnd</a>.<a href="../../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: () =&gt; net.liftweb.http.js.JsCmd =&gt; String)net.liftweb.common.Box[String]">map</a><span class="delimiter">(</span><a href="#364796" title="()net.liftweb.http.js.JsCmd">_</a><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="JsCommands.scala.html#148953" title="=&gt; String">toJsCmd</a><span class="delimiter">)</span> <a href="../../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; String)String">openOr</a> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012    },\012\012    lift_testAndShowAjax: function() {\012      if (liftAjax.lift_ajaxShowing &amp;&amp; liftAjax.lift_ajaxQueue.length == 0 &amp;&amp; liftAjax.lift_ajaxInProcess == null) {\012        liftAjax.lift_endAjax();\012      } else if (!liftAjax.lift_ajaxShowing &amp;&amp; (liftAjax.lift_ajaxQueue.length &gt; 0 || liftAjax.lift_ajaxInProcess != null)) {\012        liftAjax.lift_startAjax();\012      }\012    },\012\012    lift_traverseAndCall: function(node, func) {\012      if (node.nodeType == 1) func(node);\012      var i = 0;\012      var cn = node.childNodes;\012\012      for (i = 0; i &lt; cn.length; i++) {\012        liftAjax.lift_traverseAndCall(cn.item(i), func);\012      }\012    },\012\012    lift_successRegisterGC: function() {\012      setTimeout(\&quot;liftAjax.lift_registerGC()\&quot;, &quot;)" class="string">&quot;&quot;&quot;
    },

    lift_testAndShowAjax: function() {
      if (liftAjax.lift_ajaxShowing &amp;&amp; liftAjax.lift_ajaxQueue.length == 0 &amp;&amp; liftAjax.lift_ajaxInProcess == null) {
        liftAjax.lift_endAjax();
      } else if (!liftAjax.lift_ajaxShowing &amp;&amp; (liftAjax.lift_ajaxQueue.length &gt; 0 || liftAjax.lift_ajaxInProcess != null)) {
        liftAjax.lift_startAjax();
      }
    },

    lift_traverseAndCall: function(node, func) {
      if (node.nodeType == 1) func(node);
      var i = 0;
      var cn = node.childNodes;

      for (i = 0; i &lt; cn.length; i++) {
        liftAjax.lift_traverseAndCall(cn.item(i), func);
      }
    },

    lift_successRegisterGC: function() {
      setTimeout(&quot;liftAjax.lift_registerGC()&quot;, &quot;&quot;&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="../LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="../LiftRules.scala.html#159186" title="=&gt; Long">liftGCPollingInterval</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;);\012    },\012\012    lift_failRegisterGC: function() {\012      setTimeout(\&quot;liftAjax.lift_registerGC()\&quot;, &quot;)" class="string">&quot;&quot;&quot;);
    },

    lift_failRegisterGC: function() {
      setTimeout(&quot;liftAjax.lift_registerGC()&quot;, &quot;&quot;&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="../LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="../LiftRules.scala.html#159192" title="=&gt; Long">liftGCFailureRetryTimeout</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;);\012    },\012\012    lift_registerGC: function() {\012      var data = \&quot;__lift__GC=_\&quot;\012      &quot;)" class="string">&quot;&quot;&quot;);
    },

    lift_registerGC: function() {
      var data = &quot;__lift__GC=_&quot;
      &quot;&quot;&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="../LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="../LiftRules.scala.html#158871" title="=&gt; net.liftweb.http.js.JSArtifacts">jsArtifacts</a>.<a href="JSArtifacts.scala.html#327569" title="(data: net.liftweb.http.js.AjaxInfo)String">ajax</a><span class="delimiter">(</span><a href="JSArtifacts.scala.html#364820" title="(data: net.liftweb.http.js.JsExp, action: String, timeout: Long, cache: Boolean, dataType: String, successFunc: net.liftweb.common.Box[String], failFunc: net.liftweb.common.Box[String])net.liftweb.http.js.AjaxInfo">AjaxInfo</a><span class="delimiter">(</span><a href="JsCommands.scala.html#14910" title="object net.liftweb.http.js.JE">JE</a>.<a href="JsCommands.scala.html#184878" title="(rawJsCmd: String)net.liftweb.http.js.JE.JsRaw">JsRaw</a><span class="delimiter">(</span><span title="java.lang.String(&quot;data&quot;)" class="string">&quot;data&quot;</span><span class="delimiter">)</span>,
    <span title="java.lang.String(&quot;POST&quot;)" class="string">&quot;POST&quot;</span>,
    <a href="../LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="../LiftRules.scala.html#159165" title="=&gt; Long">ajaxPostTimeout</a>,
    <span title="Boolean(false)" class="keyword">false</span>, <span title="java.lang.String(&quot;script&quot;)" class="string">&quot;script&quot;</span>,
    <a href="../../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: java.lang.String)net.liftweb.common.Full[java.lang.String]">Full</a><span class="delimiter">(</span><span title="java.lang.String(&quot;liftAjax.lift_successRegisterGC&quot;)" class="string">&quot;liftAjax.lift_successRegisterGC&quot;</span><span class="delimiter">)</span>, <a href="../../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: java.lang.String)net.liftweb.common.Full[java.lang.String]">Full</a><span class="delimiter">(</span><span title="java.lang.String(&quot;liftAjax.lift_failRegisterGC&quot;)" class="string">&quot;liftAjax.lift_failRegisterGC&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span>
          <span title="java.lang.String(&quot;\012       },\012\012       lift_doAjaxCycle: function() {\012         if (liftAjax.lift_doCycleQueueCnt &gt; 0) liftAjax.lift_doCycleQueueCnt--;\012         var queue = liftAjax.lift_ajaxQueue;\012         if (queue.length &gt; 0) {\012           var now = (new Date()).getTime();\012           if (liftAjax.lift_ajaxInProcess == null &amp;&amp; queue[0].when &lt;= now) {\012             var aboutToSend = queue.shift();\012\012             liftAjax.lift_ajaxInProcess = aboutToSend;\012\012             var successFunc = function(data) {\012               liftAjax.lift_ajaxInProcess = null;\012               if (aboutToSend.onSuccess) {\012                 aboutToSend.onSuccess(data);\012               }\012               liftAjax.lift_doCycleQueueCnt++;\012               liftAjax.lift_doAjaxCycle();\012             };\012\012             var failureFunc = function() {\012               liftAjax.lift_ajaxInProcess = null;\012               var cnt = aboutToSend.retryCnt;\012               if (cnt &lt; liftAjax.lift_ajaxRetryCount) {\012               aboutToSend.retryCnt = cnt + 1;\012                 var now = (new Date()).getTime();\012                 aboutToSend.when = now + (1000 * Math.pow(2, cnt));\012                 queue.push(aboutToSend);\012                 liftAjax.lift_ajaxQueueSort();\012               } else {\012                 if (aboutToSend.onFailure) {\012                   aboutToSend.onFailure();\012                 } else {\012                   liftAjax.lift_defaultFailure();\012                 }\012               }\012               liftAjax.lift_doCycleQueueCnt++;\012               liftAjax.lift_doAjaxCycle();\012             };\012\012             if (aboutToSend.responseType != undefined &amp;&amp;\012                 aboutToSend.responseType != null &amp;&amp;\012                 aboutToSend.responseType.toLowerCase() === \&quot;json\&quot;) {\012               liftAjax.lift_actualJSONCall(aboutToSend.theData, successFunc, failureFunc);\012             } else {\012               var theData = aboutToSend.theData;\012               if (liftAjax.lift_uriSuffix) {\012                 theData += \'&amp;\' + liftAjax.lift_uriSuffix;\012                 liftAjax.lift_uriSuffix = undefined;\012               }\012               liftAjax.lift_actualAjaxCall(theData, successFunc, failureFunc);\012             }\012            }\012         }\012\012         liftAjax.lift_testAndShowAjax();\012         if (liftAjax.lift_doCycleQueueCnt &lt;= 0) liftAjax.lift_doCycleIn200()\012       },\012\012       lift_doCycleIn200: function() {\012         liftAjax.lift_doCycleQueueCnt++;\012         setTimeout(\&quot;liftAjax.lift_doAjaxCycle();\&quot;, 200);\012       },\012\012       addPageName: function(url) {\012         return &quot;)" class="string">&quot;&quot;&quot;
       },

       lift_doAjaxCycle: function() {
         if (liftAjax.lift_doCycleQueueCnt &gt; 0) liftAjax.lift_doCycleQueueCnt--;
         var queue = liftAjax.lift_ajaxQueue;
         if (queue.length &gt; 0) {
           var now = (new Date()).getTime();
           if (liftAjax.lift_ajaxInProcess == null &amp;&amp; queue[0].when &lt;= now) {
             var aboutToSend = queue.shift();

             liftAjax.lift_ajaxInProcess = aboutToSend;

             var successFunc = function(data) {
               liftAjax.lift_ajaxInProcess = null;
               if (aboutToSend.onSuccess) {
                 aboutToSend.onSuccess(data);
               }
               liftAjax.lift_doCycleQueueCnt++;
               liftAjax.lift_doAjaxCycle();
             };

             var failureFunc = function() {
               liftAjax.lift_ajaxInProcess = null;
               var cnt = aboutToSend.retryCnt;
               if (cnt &lt; liftAjax.lift_ajaxRetryCount) {
               aboutToSend.retryCnt = cnt + 1;
                 var now = (new Date()).getTime();
                 aboutToSend.when = now + (1000 * Math.pow(2, cnt));
                 queue.push(aboutToSend);
                 liftAjax.lift_ajaxQueueSort();
               } else {
                 if (aboutToSend.onFailure) {
                   aboutToSend.onFailure();
                 } else {
                   liftAjax.lift_defaultFailure();
                 }
               }
               liftAjax.lift_doCycleQueueCnt++;
               liftAjax.lift_doAjaxCycle();
             };

             if (aboutToSend.responseType != undefined &amp;&amp;
                 aboutToSend.responseType != null &amp;&amp;
                 aboutToSend.responseType.toLowerCase() === &quot;json&quot;) {
               liftAjax.lift_actualJSONCall(aboutToSend.theData, successFunc, failureFunc);
             } else {
               var theData = aboutToSend.theData;
               if (liftAjax.lift_uriSuffix) {
                 theData += '&amp;' + liftAjax.lift_uriSuffix;
                 liftAjax.lift_uriSuffix = undefined;
               }
               liftAjax.lift_actualAjaxCall(theData, successFunc, failureFunc);
             }
            }
         }

         liftAjax.lift_testAndShowAjax();
         if (liftAjax.lift_doCycleQueueCnt &lt;= 0) liftAjax.lift_doCycleIn200()
       },

       lift_doCycleIn200: function() {
         liftAjax.lift_doCycleQueueCnt++;
         setTimeout(&quot;liftAjax.lift_doAjaxCycle();&quot;, 200);
       },

       addPageName: function(url) {
         return &quot;&quot;&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span class="delimiter">{</span>
    <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="../LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="../LiftRules.scala.html#159180" title="=&gt; Boolean">enableLiftGC</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="java.lang.String(&quot;url.replace(\'&quot;)" class="string">&quot;url.replace('&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="../LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="../LiftRules.scala.html#159051" title="=&gt; java.lang.String">ajaxPath</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\', \'&quot;)" class="string">&quot;', '&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="../LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="../LiftRules.scala.html#159051" title="=&gt; java.lang.String">ajaxPath</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;/\'+lift_page);&quot;)" class="string">&quot;/'+lift_page);&quot;</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span title="java.lang.String(&quot;url;&quot;)" class="string">&quot;url;&quot;</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012    },\012\012    lift_actualAjaxCall: function(data, onSuccess, onFailure) {\012      &quot;)" class="string">&quot;&quot;&quot;
    },

    lift_actualAjaxCall: function(data, onSuccess, onFailure) {
      &quot;&quot;&quot;</span> <span title="(x$1: Any)java.lang.String">+</span>
          <a href="../LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="../LiftRules.scala.html#158871" title="=&gt; net.liftweb.http.js.JSArtifacts">jsArtifacts</a>.<a href="JSArtifacts.scala.html#327569" title="(data: net.liftweb.http.js.AjaxInfo)String">ajax</a><span class="delimiter">(</span><a href="JSArtifacts.scala.html#364820" title="(data: net.liftweb.http.js.JsExp, action: String, timeout: Long, cache: Boolean, dataType: String, successFunc: net.liftweb.common.Box[String], failFunc: net.liftweb.common.Box[String])net.liftweb.http.js.AjaxInfo">AjaxInfo</a><span class="delimiter">(</span><a href="JsCommands.scala.html#14910" title="object net.liftweb.http.js.JE">JE</a>.<a href="JsCommands.scala.html#184878" title="(rawJsCmd: String)net.liftweb.http.js.JE.JsRaw">JsRaw</a><span class="delimiter">(</span><span title="java.lang.String(&quot;data&quot;)" class="string">&quot;data&quot;</span><span class="delimiter">)</span>,
            <span title="java.lang.String(&quot;POST&quot;)" class="string">&quot;POST&quot;</span>,
            <a href="../LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="../LiftRules.scala.html#159165" title="=&gt; Long">ajaxPostTimeout</a>,
            <span title="Boolean(false)" class="keyword">false</span>, <span title="java.lang.String(&quot;script&quot;)" class="string">&quot;script&quot;</span>,
            <a href="../../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: java.lang.String)net.liftweb.common.Full[java.lang.String]">Full</a><span class="delimiter">(</span><span title="java.lang.String(&quot;onSuccess&quot;)" class="string">&quot;onSuccess&quot;</span><span class="delimiter">)</span>, <a href="../../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: java.lang.String)net.liftweb.common.Full[java.lang.String]">Full</a><span class="delimiter">(</span><span title="java.lang.String(&quot;onFailure&quot;)" class="string">&quot;onFailure&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span>
          <span title="java.lang.String(&quot;\012        },\012\012        lift_actualJSONCall: function(data, onSuccess, onFailure) {\012          &quot;)" class="string">&quot;&quot;&quot;
        },

        lift_actualJSONCall: function(data, onSuccess, onFailure) {
          &quot;&quot;&quot;</span> <span title="(x$1: Any)java.lang.String">+</span>
          <a href="../LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="../LiftRules.scala.html#158871" title="=&gt; net.liftweb.http.js.JSArtifacts">jsArtifacts</a>.<a href="JSArtifacts.scala.html#327569" title="(data: net.liftweb.http.js.AjaxInfo)String">ajax</a><span class="delimiter">(</span><a href="JSArtifacts.scala.html#364820" title="(data: net.liftweb.http.js.JsExp, action: String, timeout: Long, cache: Boolean, dataType: String, successFunc: net.liftweb.common.Box[String], failFunc: net.liftweb.common.Box[String])net.liftweb.http.js.AjaxInfo">AjaxInfo</a><span class="delimiter">(</span><a href="JsCommands.scala.html#14910" title="object net.liftweb.http.js.JE">JE</a>.<a href="JsCommands.scala.html#184878" title="(rawJsCmd: String)net.liftweb.http.js.JE.JsRaw">JsRaw</a><span class="delimiter">(</span><span title="java.lang.String(&quot;data&quot;)" class="string">&quot;data&quot;</span><span class="delimiter">)</span>,
            <span title="java.lang.String(&quot;POST&quot;)" class="string">&quot;POST&quot;</span>,
            <a href="../LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="../LiftRules.scala.html#159165" title="=&gt; Long">ajaxPostTimeout</a>,
            <span title="Boolean(false)" class="keyword">false</span>, <span title="java.lang.String(&quot;json&quot;)" class="string">&quot;json&quot;</span>,
            <a href="../../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: java.lang.String)net.liftweb.common.Full[java.lang.String]">Full</a><span class="delimiter">(</span><span title="java.lang.String(&quot;onSuccess&quot;)" class="string">&quot;onSuccess&quot;</span><span class="delimiter">)</span>, <a href="../../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: java.lang.String)net.liftweb.common.Full[java.lang.String]">Full</a><span class="delimiter">(</span><span title="java.lang.String(&quot;onFailure&quot;)" class="string">&quot;onFailure&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span>
          <span title="java.lang.String(&quot;\012              }\012            };\012\012            window.liftUtils = {\012              lift_blurIfReturn: function(e) {\012                var code;\012                if (!e) var e = window.event;\012                if (e.keyCode) code = e.keyCode;\012                else if (e.which) code = e.which;\012\012                var targ;\012\012                if (e.target) targ = e.target;\012                else if (e.srcElement) targ = e.srcElement;\012                if (targ.nodeType == 3) // defeat Safari bug\012                  targ = targ.parentNode;\012                if (code == 13) {targ.blur(); return false;} else {return true;};\012              }\012            };\012\012\012          })();\012          &quot;)" class="string">&quot;&quot;&quot;
              }
            };

            window.liftUtils = {
              lift_blurIfReturn: function(e) {
                var code;
                if (!e) var e = window.event;
                if (e.keyCode) code = e.keyCode;
                else if (e.which) code = e.which;

                var targ;

                if (e.target) targ = e.target;
                else if (e.srcElement) targ = e.srcElement;
                if (targ.nodeType == 3) // defeat Safari bug
                  targ = targ.parentNode;
                if (code == 13) {targ.blur(); return false;} else {return true;};
              }
            };


          })();
          &quot;&quot;&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="../LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="../LiftRules.scala.html#158871" title="=&gt; net.liftweb.http.js.JSArtifacts">jsArtifacts</a>.<a href="JSArtifacts.scala.html#327567" title="(cmd: net.liftweb.http.js.JsCmd)net.liftweb.http.js.JsCmd">onLoad</a><span class="delimiter">(</span><a href="#364948" title="java.lang.Object with net.liftweb.http.js.JsCmd" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with net.liftweb.http.js.JsCmd" id="364948">JsCmd</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span><span class="keyword">def</span> <a title="=&gt; java.lang.String" id="364955">toJsCmd</a> = <span title="java.lang.String(&quot;liftAjax.lift_doCycleIn200();&quot;)" class="string">&quot;liftAjax.lift_doCycleIn200();&quot;</span><span class="delimiter">}</span><span class="delimiter">)</span>.<a href="JsCommands.scala.html#148953" title="=&gt; String">toJsCmd</a><span class="delimiter">)</span>


  <span class="comment">/**
   * Renders the default JS comet script
   */</span>
  <span class="keyword">def</span> <a title="=&gt; net.liftweb.http.js.JsCmds.Run" id="364745">cometScript</a> = <a href="JsCommands.scala.html#14916" title="object net.liftweb.http.js.JsCmds">JsCmds</a>.<a href="JsCommands.scala.html#196384" title="(text: String)net.liftweb.http.js.JsCmds.Run">Run</a><span class="delimiter">(</span><span title="java.lang.String(&quot;\012  (function() {\012    window.liftComet = {\012      lift_handlerSuccessFunc: function() {\012        setTimeout(\&quot;liftComet.lift_cometEntry();\&quot;,100);\012      },\012\012      lift_unlistWatch : function(watchId) {\012        var ret = [];\012        for (item in lift_toWatch) {\012          if (item !== watchId) {\012            ret.push(item);\012          }\012        }\012        lift_toWatch = ret;\012      },\012\012      lift_handlerFailureFunc: function() {\012        setTimeout(\&quot;liftComet.lift_cometEntry();\&quot;,&quot;)" class="string">&quot;&quot;&quot;
  (function() {
    window.liftComet = {
      lift_handlerSuccessFunc: function() {
        setTimeout(&quot;liftComet.lift_cometEntry();&quot;,100);
      },

      lift_unlistWatch : function(watchId) {
        var ret = [];
        for (item in lift_toWatch) {
          if (item !== watchId) {
            ret.push(item);
          }
        }
        lift_toWatch = ret;
      },

      lift_handlerFailureFunc: function() {
        setTimeout(&quot;liftComet.lift_cometEntry();&quot;,&quot;&quot;&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="../LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="../LiftRules.scala.html#158960" title="=&gt; Long">cometFailureRetryTimeout</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;);\012      },\012\012      lift_cometEntry: function() {\012        var isEmpty = function(){for (var i in lift_toWatch) {return false} return true}();\012        if (!isEmpty) {\012          liftAjax.lift_uriSuffix = undefined;\012        &quot;)" class="string">&quot;&quot;&quot;);
      },

      lift_cometEntry: function() {
        var isEmpty = function(){for (var i in lift_toWatch) {return false} return true}();
        if (!isEmpty) {
          liftAjax.lift_uriSuffix = undefined;
        &quot;&quot;&quot;</span> <span title="(x$1: Any)java.lang.String">+</span>
          <a href="../LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="../LiftRules.scala.html#158871" title="=&gt; net.liftweb.http.js.JSArtifacts">jsArtifacts</a>.<a href="JSArtifacts.scala.html#327570" title="(data: net.liftweb.http.js.AjaxInfo)String">comet</a><span class="delimiter">(</span><a href="JSArtifacts.scala.html#364820" title="(data: net.liftweb.http.js.JsExp, action: String, timeout: Long, cache: Boolean, dataType: String, successFunc: net.liftweb.common.Box[String], failFunc: net.liftweb.common.Box[String])net.liftweb.http.js.AjaxInfo">AjaxInfo</a><span class="delimiter">(</span><a href="JsCommands.scala.html#14910" title="object net.liftweb.http.js.JE">JE</a>.<a href="JsCommands.scala.html#184878" title="(rawJsCmd: String)net.liftweb.http.js.JE.JsRaw">JsRaw</a><span class="delimiter">(</span><span title="java.lang.String(&quot;lift_toWatch&quot;)" class="string">&quot;lift_toWatch&quot;</span><span class="delimiter">)</span>,
            <span title="java.lang.String(&quot;GET&quot;)" class="string">&quot;GET&quot;</span>,
            <a href="../LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="../LiftRules.scala.html#159168" title="=&gt; Long">cometGetTimeout</a>,
            <span title="Boolean(false)" class="keyword">false</span>,
            <span title="java.lang.String(&quot;script&quot;)" class="string">&quot;script&quot;</span>,
            <a href="../../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: java.lang.String)net.liftweb.common.Full[java.lang.String]">Full</a><span class="delimiter">(</span><span title="java.lang.String(&quot;liftComet.lift_handlerSuccessFunc&quot;)" class="string">&quot;liftComet.lift_handlerSuccessFunc&quot;</span><span class="delimiter">)</span>,
            <a href="../../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: java.lang.String)net.liftweb.common.Full[java.lang.String]">Full</a><span class="delimiter">(</span><span title="java.lang.String(&quot;liftComet.lift_handlerFailureFunc&quot;)" class="string">&quot;liftComet.lift_handlerFailureFunc&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span>
          <span title="java.lang.String(&quot;\012              }\012            }\012          }})();\012          &quot;)" class="string">&quot;&quot;&quot;
              }
            }
          }})();
          &quot;&quot;&quot;</span> <span title="(x$1: Any)java.lang.String">+</span>

          <a href="../LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="../LiftRules.scala.html#158871" title="=&gt; net.liftweb.http.js.JSArtifacts">jsArtifacts</a>.<a href="JSArtifacts.scala.html#327567" title="(cmd: net.liftweb.http.js.JsCmd)net.liftweb.http.js.JsCmd">onLoad</a><span class="delimiter">(</span><a href="#365071" title="java.lang.Object with net.liftweb.http.js.JsCmd" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with net.liftweb.http.js.JsCmd" id="365071">JsCmd</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">def</span> <a title="=&gt; java.lang.String" id="365075">toJsCmd</a> = <span title="java.lang.String(&quot;liftComet.lift_handlerSuccessFunc()&quot;)" class="string">&quot;liftComet.lift_handlerSuccessFunc()&quot;</span>
          <span class="delimiter">}</span><span class="delimiter">)</span>.<a href="JsCommands.scala.html#148953" title="=&gt; String">toJsCmd</a><span class="delimiter">)</span>
<span class="delimiter">}</span>


        </pre>
    </body>
</html>
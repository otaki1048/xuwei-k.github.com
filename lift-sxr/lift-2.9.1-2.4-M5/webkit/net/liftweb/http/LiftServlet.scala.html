<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>webkit/net/liftweb/http/LiftServlet.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright 2007-2011 WorldWide Conferencing, LLC
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

<span class="keyword">package</span> net.liftweb
<span class="keyword">package</span> http

<span class="keyword">import</span> xml.<span class="delimiter">{</span>Node, NodeSeq, Group<span class="delimiter">}</span>

<span class="keyword">import</span> common._
<span class="keyword">import</span> actor._
<span class="keyword">import</span> util._
<span class="keyword">import</span> util.<a href="../../../../util/net/liftweb/util/Helpers.scala.html#13346" title="object net.liftweb.util.Helpers">Helpers</a>._
<span class="keyword">import</span> js._
<span class="keyword">import</span> auth._
<span class="keyword">import</span> provider._


<span class="keyword">class</span> <a title="class LiftServlet extends java.lang.Object with net.liftweb.common.Loggable with ScalaObject" id="14447">LiftServlet</a> <a href="#14447" title="ScalaObject" class="keyword">extends</a> <a href="../../../../common/net/liftweb/common/Logging.scala.html#10717" title="net.liftweb.common.Loggable">Loggable</a> <span class="delimiter">{</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="net.liftweb.http.provider.HTTPContext" id="379356">servletContext</a>: <a href="provider/HTTPContext.scala.html#15052" title="net.liftweb.http.provider.HTTPContext">HTTPContext</a> = <span title="Null(null)" class="keyword">null</span>

  <span class="keyword">def</span> <a title="(ctx: net.liftweb.http.provider.HTTPContext)net.liftweb.http.LiftServlet" id="379358" class="keyword">this</a><span class="delimiter">(</span><a title="net.liftweb.http.provider.HTTPContext" id="379401">ctx</a>: <a href="provider/HTTPContext.scala.html#15052" title="net.liftweb.http.provider.HTTPContext">HTTPContext</a><span class="delimiter">)</span> = <span title="Unit" class="delimiter">{</span>
    <a href="#14447" title="LiftServlet.this.type" class="keyword">this</a> <span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#14447" title="LiftServlet.this.type" class="keyword">this</a>.<a href="#379356" title="(x$1: net.liftweb.http.provider.HTTPContext)Unit">servletContext</a> = <a href="#379401" title="net.liftweb.http.provider.HTTPContext">ctx</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; net.liftweb.http.provider.HTTPContext" id="379359">getContext</a>: <a href="provider/HTTPContext.scala.html#15052" title="net.liftweb.http.provider.HTTPContext">HTTPContext</a> = <a href="#379356" title="=&gt; net.liftweb.http.provider.HTTPContext">servletContext</a>

  <span class="keyword">def</span> <a title="=&gt; Unit" id="379360">destroy</a> = <span class="delimiter">{</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159045" title="(x$1: Boolean)Unit">ending</a> = <span title="Boolean(true)" class="keyword">true</span>

      <a href="../../../../util/net/liftweb/util/ControlHelpers.scala.html#48608" title="(f: =&gt; Unit)net.liftweb.common.Box[Unit]">tryo</a> <span class="delimiter">{</span>
        <a href="LiftSession.scala.html#14484" title="object net.liftweb.http.SessionMaster">SessionMaster</a>.<a href="LiftSession.scala.html#357516" title="()Unit">shutDownAllSessions</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="Long" id="379416">cur</a> = <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48788" title="=&gt; Long">millis</a>

      <span class="comment">// wait 10 seconds or until the request count is zero</span>
      <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159042" title="=&gt; java.util.concurrent.atomic.AtomicInteger">reqCnt</a>.<span title="()Int">get</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span class="delimiter">(</span><a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48788" title="=&gt; Long">millis</a> <span title="(x: Long)Long">-</span> <a href="#379416" title="Long">cur</a><span class="delimiter">)</span> <span title="(x: Long)Boolean">&lt;</span> <span title="Long(10000L)" class="long">10000L</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="object java.lang.Thread">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><a href="#379417" title="()Unit" class="delimiter">(</a><span title="Long(20L)" class="int">20</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="../../../../util/net/liftweb/util/ControlHelpers.scala.html#48608" title="(f: =&gt; Unit)net.liftweb.common.Box[Unit]">tryo</a> <span class="delimiter">{</span>
        <a href="../../../../util/net/liftweb/util/Schedule.scala.html#13609" title="object net.liftweb.util.Schedule">Schedule</a>.<a href="../../../../util/net/liftweb/util/Schedule.scala.html#316904" title="()Unit">shutdown</a>
      <span class="delimiter">}</span>
      <a href="../../../../util/net/liftweb/util/ControlHelpers.scala.html#48608" title="(f: =&gt; Unit)net.liftweb.common.Box[Unit]">tryo</a> <span class="delimiter">{</span>
        <a href="../../../../actor/net/liftweb/actor/LiftActor.scala.html#10549" title="object net.liftweb.actor.LAScheduler">LAScheduler</a>.<a href="../../../../actor/net/liftweb/actor/LiftActor.scala.html#19867" title="()Unit">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="../../../../util/net/liftweb/util/ControlHelpers.scala.html#48608" title="(f: =&gt; Unit)net.liftweb.common.Box[Unit]">tryo</a> <span class="delimiter">{</span>
        <a href="../../../../actor/net/liftweb/actor/LAPinger.scala.html#10537" title="object net.liftweb.actor.LAPinger">LAPinger</a>.<a href="../../../../actor/net/liftweb/actor/LAPinger.scala.html#29296" title="=&gt; Unit">shutdown</a>
      <span class="delimiter">}</span>

      <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158908" title="()Unit">runUnloadHooks</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="../../../../common/net/liftweb/common/Logging.scala.html#19845" title="=&gt; net.liftweb.common.Logger">logger</a>.<a href="../../../../common/net/liftweb/common/Logging.scala.html#31942" title="(msg: =&gt; AnyRef)Unit">debug</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Destroyed Lift handler.&quot;)" class="string">&quot;Destroyed Lift handler.&quot;</span><span class="delimiter">)</span>
      <span class="comment">// super.destroy</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Unit" id="379603">e</a> =&gt; <a href="../../../../common/net/liftweb/common/Logging.scala.html#19845" title="=&gt; net.liftweb.common.Logger">logger</a>.<a href="../../../../common/net/liftweb/common/Logging.scala.html#31961" title="(msg: =&gt; AnyRef, t: Throwable)Unit">error</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Destruction failure&quot;)" class="string">&quot;Destruction failure&quot;</span>, <a href="#379603" title="java.lang.Throwable">e</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; Unit" id="379361">init</a> = <span class="delimiter">{</span>
    <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159045" title="(x$1: Boolean)Unit">ending</a> = <span title="Boolean(false)" class="keyword">false</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(request: net.liftweb.http.Req)net.liftweb.http.LiftSession" id="379362">getLiftSession</a><span class="delimiter">(</span><a title="net.liftweb.http.Req" id="379615">request</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a><span class="delimiter">)</span>: <a href="LiftSession.scala.html#14496" title="net.liftweb.http.LiftSession">LiftSession</a> = <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158858" title="(v1: net.liftweb.http.Req)net.liftweb.http.LiftSession">getLiftSession</a><span class="delimiter">(</span><a href="#379615" title="net.liftweb.http.Req">request</a><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="[T](req: net.liftweb.http.Req, session: net.liftweb.common.Box[net.liftweb.http.LiftSession])(f: =&gt; T)T" id="379363">wrapState</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="379365">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="net.liftweb.http.Req" id="379622">req</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a>, <a title="net.liftweb.common.Box[net.liftweb.http.LiftSession]" id="379623">session</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.http.LiftSession]">Box</a><span class="delimiter">[</span>LiftSession<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="=&gt; T" id="379624">f</a>: =&gt; T<span class="delimiter">)</span>: <a href="#379365" title="T">T</a> = <span class="delimiter">{</span>
    <a href="#379623" title="net.liftweb.common.Box[net.liftweb.http.LiftSession]">session</a> <span title="T" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="T">Full</span><span class="delimiter">(</span><a title="net.liftweb.http.LiftSession" id="379628">ses</a><span class="delimiter">)</span> =&gt; <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49376" title="(request: net.liftweb.http.Req, session: net.liftweb.http.LiftSession)(f: =&gt; T)T">init</a><span class="delimiter">(</span><a href="#379622" title="net.liftweb.http.Req">req</a>, <a href="#379628" title="net.liftweb.http.LiftSession">ses</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#379624" title="=&gt; T">f</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="T">_</span> =&gt; <a href="Req.scala.html#14555" title="object net.liftweb.http.CurrentReq">CurrentReq</a>.<a href="../../../../util/net/liftweb/util/ThreadGlobal.scala.html#51274" title="(x: net.liftweb.http.Req)(f: =&gt; T)T">doWith</a><span class="delimiter">(</span><a href="#379622" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#379624" title="=&gt; T">f</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(reqOrg: net.liftweb.http.Req, resp: net.liftweb.http.provider.HTTPResponse, session: net.liftweb.common.Box[net.liftweb.http.LiftSession], func: =&gt; net.liftweb.http.LiftResponse =&gt; Unit =&gt; Unit)Boolean" id="379366">handleGenericContinuation</a><span class="delimiter">(</span><a title="net.liftweb.http.Req" id="379647">reqOrg</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a>, <a title="net.liftweb.http.provider.HTTPResponse" id="379648">resp</a>: <a href="provider/HTTPResponse.scala.html#15087" title="net.liftweb.http.provider.HTTPResponse">HTTPResponse</a>, <a title="net.liftweb.common.Box[net.liftweb.http.LiftSession]" id="379649">session</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.http.LiftSession]">Box</a><span class="delimiter">[</span>LiftSession<span class="delimiter">]</span>, <a title="=&gt; net.liftweb.http.LiftResponse =&gt; Unit =&gt; Unit" id="379650">func</a>: <span class="delimiter">(</span><span class="delimiter">(</span>=&gt; LiftResponse<span class="delimiter">)</span> =&gt; Unit<span class="delimiter">)</span> =&gt; Unit<span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="net.liftweb.http.Req" id="379652">req</a> = <span title="net.liftweb.http.Req" class="keyword">if</span> <span class="delimiter">(</span><span title="Null(null)" class="keyword">null</span> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#379647" title="net.liftweb.http.Req">reqOrg</a><span class="delimiter">)</span> <a href="#379647" title="net.liftweb.http.Req">reqOrg</a> <span class="keyword">else</span> <a href="#379647" title="net.liftweb.http.Req">reqOrg</a>.<a href="Req.scala.html#149165" title="=&gt; net.liftweb.http.Req">snapshot</a>

    <span class="keyword">def</span> <a title="(doAnswer: net.liftweb.http.LiftResponse =&gt; Unit)Unit" id="379653">runFunction</a><span class="delimiter">(</span><a title="net.liftweb.http.LiftResponse =&gt; Unit" id="379654">doAnswer</a>: LiftResponse =&gt; Unit<span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../../../util/net/liftweb/util/Schedule.scala.html#13609" title="object net.liftweb.util.Schedule">Schedule</a>.<a href="../../../../util/net/liftweb/util/Schedule.scala.html#316914" title="(f: () =&gt; Unit, delay: net.liftweb.util.Helpers.TimeSpan)java.util.concurrent.ScheduledFuture[Unit]">schedule</a><span title="Unit" class="delimiter">(</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="=&gt; net.liftweb.http.LiftResponse =&gt; Unit" id="379662">answerFunc</a>: <span class="delimiter">(</span>=&gt; LiftResponse<span class="delimiter">)</span> =&gt; Unit = <a title="=&gt; net.liftweb.http.LiftResponse" id="379664">response</a> =&gt;
          <a href="#379654" title="(v1: net.liftweb.http.LiftResponse)Unit">doAnswer</a><span class="delimiter">(</span><a href="#379363" title="(req: net.liftweb.http.Req, session: net.liftweb.common.Box[net.liftweb.http.LiftSession])(f: =&gt; net.liftweb.http.LiftResponse)net.liftweb.http.LiftResponse">wrapState</a><span class="delimiter">(</span><a href="#379652" title="net.liftweb.http.Req">req</a>, <a href="#379649" title="net.liftweb.common.Box[net.liftweb.http.LiftSession]">session</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#379664" title="=&gt; net.liftweb.http.LiftResponse">response</a><span class="delimiter">)</span><span class="delimiter">)</span>

        <a href="#379650" title="(v1: =&gt; net.liftweb.http.LiftResponse =&gt; Unit)Unit">func</a><span class="delimiter">(</span><a href="#379662" title="=&gt; net.liftweb.http.LiftResponse =&gt; Unit">answerFunc</a><span class="delimiter">)</span>

      <span class="delimiter">}</span>, <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48779" title="implicit net.liftweb.util.TimeHelpers.intToTimeSpan : (in: Int)net.liftweb.util.Helpers.TimeSpan" class="int">5</a> <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48778" title="implicit net.liftweb.util.TimeHelpers.longToTimeSpan : (in: Long)net.liftweb.util.Helpers.TimeSpan">millis</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#379647" title="net.liftweb.http.Req">reqOrg</a>.<a href="Req.scala.html#149145" title="=&gt; net.liftweb.http.provider.HTTPRequest">request</a>.<a href="provider/HTTPRequest.scala.html#216886" title="=&gt; Boolean">suspendResumeSupport_?</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#379653" title="(doAnswer: net.liftweb.http.LiftResponse =&gt; Unit)Unit">runFunction</a><span class="delimiter">(</span><a title="net.liftweb.http.LiftResponse" id="379687">liftResponse</a> =&gt; <span class="delimiter">{</span>
        <span class="comment">// do the actual write on a separate thread</span>
        <a href="../../../../util/net/liftweb/util/Schedule.scala.html#13609" title="object net.liftweb.util.Schedule">Schedule</a>.<a href="../../../../util/net/liftweb/util/Schedule.scala.html#316914" title="(f: () =&gt; Unit, delay: net.liftweb.util.Helpers.TimeSpan)java.util.concurrent.ScheduledFuture[Unit]">schedule</a><span title="Unit" class="delimiter">(</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <a href="#379647" title="net.liftweb.http.Req">reqOrg</a>.<a href="Req.scala.html#149145" title="=&gt; net.liftweb.http.provider.HTTPRequest">request</a>.<a href="provider/HTTPRequest.scala.html#216889" title="(what: (net.liftweb.http.Req, net.liftweb.http.LiftResponse))Boolean">resume</a><span title="(_1: net.liftweb.http.Req, _2: net.liftweb.http.LiftResponse)(net.liftweb.http.Req, net.liftweb.http.LiftResponse)" class="delimiter">(</span><a href="#379647" title="net.liftweb.http.Req">reqOrg</a>, <a href="#379687" title="net.liftweb.http.LiftResponse">liftResponse</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>, <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48777" title="implicit net.liftweb.util.TimeHelpers.intToTimeSpanBuilder : (in: Int)net.liftweb.util.Helpers.TimeSpanBuilder" class="int">0</a> <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#58471" title="=&gt; net.liftweb.util.Helpers.TimeSpan">seconds</a><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>

      <a href="#379647" title="net.liftweb.http.Req">reqOrg</a>.<a href="Req.scala.html#149145" title="=&gt; net.liftweb.http.provider.HTTPRequest">request</a>.<a href="provider/HTTPRequest.scala.html#216888" title="(timeout: Long)net.liftweb.http.provider.RetryState.Value">suspend</a><span class="delimiter">(</span><a href="#379381" title="=&gt; Long">cometTimeout</a><span class="delimiter">)</span>
      <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="net.liftweb.actor.LAFuture[net.liftweb.http.LiftResponse]" id="379715">future</a> = <span title="net.liftweb.actor.LAFuture[net.liftweb.http.LiftResponse]" class="keyword">new</span> <a href="../../../../actor/net/liftweb/actor/LAFuture.scala.html#10526" title="net.liftweb.actor.LAFuture[net.liftweb.http.LiftResponse]">LAFuture</a><span class="delimiter">[</span>LiftResponse<span class="delimiter">]</span>

      <a href="#379653" title="(doAnswer: net.liftweb.http.LiftResponse =&gt; Unit)Unit">runFunction</a><span class="delimiter">(</span><a title="net.liftweb.http.LiftResponse" id="379717">answer</a> =&gt; <a href="#379715" title="net.liftweb.actor.LAFuture[net.liftweb.http.LiftResponse]">future</a>.<a href="../../../../actor/net/liftweb/actor/LAFuture.scala.html#15444" title="(value: net.liftweb.http.LiftResponse)Unit">satisfy</a><span class="delimiter">(</span><a href="#379717" title="net.liftweb.http.LiftResponse">answer</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <a href="#379715" title="net.liftweb.actor.LAFuture[net.liftweb.http.LiftResponse]">future</a>.<a href="../../../../actor/net/liftweb/actor/LAFuture.scala.html#15447" title="(timeout: Long)net.liftweb.common.Box[net.liftweb.http.LiftResponse]">get</a><span class="delimiter">(</span><a href="#379381" title="=&gt; Long">cometTimeout</a><span class="delimiter">)</span> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Boolean">Full</span><span class="delimiter">(</span><a title="net.liftweb.http.LiftResponse" id="379722">answer</a><span class="delimiter">)</span> =&gt; <a href="#379391" title="(liftResp: net.liftweb.http.LiftResponse, response: net.liftweb.http.provider.HTTPResponse, request: net.liftweb.http.Req)Unit">sendResponse</a><span class="delimiter">(</span><a href="#379722" title="net.liftweb.http.LiftResponse">answer</a>, <a href="#379648" title="net.liftweb.http.provider.HTTPResponse">resp</a>, <a href="#379652" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span>; <span title="Boolean(true)" class="keyword">true</span>
        <span class="keyword">case</span> <span title="Boolean(false)">_</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Processes the HTTP requests
   */</span>
  <span class="keyword">def</span> <a title="(req: net.liftweb.http.Req, resp: net.liftweb.http.provider.HTTPResponse)Boolean" id="379367">service</a><span class="delimiter">(</span><a title="net.liftweb.http.Req" id="379727">req</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a>, <a title="net.liftweb.http.provider.HTTPResponse" id="379728">resp</a>: <a href="provider/HTTPResponse.scala.html#15087" title="net.liftweb.http.provider.HTTPResponse">HTTPResponse</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="=&gt; Boolean" id="379730">doIt</a>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
        <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159253" title="=&gt; Boolean">logServiceRequestTiming</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48817" title="(f: =&gt; (String, Boolean))Boolean">logTime</a> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="Boolean" id="379745">ret</a> = <a href="#379374" title="(req: net.liftweb.http.Req, response: net.liftweb.http.provider.HTTPResponse)Boolean">doService</a><span class="delimiter">(</span><a href="#379727" title="net.liftweb.http.Req">req</a>, <a href="#379728" title="net.liftweb.http.provider.HTTPResponse">resp</a><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="java.lang.String" id="379746">msg</a> = <span title="java.lang.String(&quot;Service request (&quot;)" class="string">&quot;Service request (&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#379727" title="net.liftweb.http.Req">req</a>.<a href="Req.scala.html#149145" title="=&gt; net.liftweb.http.provider.HTTPRequest">request</a>.<a href="provider/HTTPRequest.scala.html#216885" title="=&gt; String">method</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;) &quot;)" class="string">&quot;) &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#379727" title="net.liftweb.http.Req">req</a>.<a href="Req.scala.html#149145" title="=&gt; net.liftweb.http.provider.HTTPRequest">request</a>.<a href="provider/HTTPRequest.scala.html#216870" title="=&gt; String">uri</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; returned &quot;)" class="string">&quot; returned &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#379728" title="net.liftweb.http.provider.HTTPResponse">resp</a>.<a href="provider/HTTPResponse.scala.html#364968" title="=&gt; Int">getStatus</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span>
            <span title="(_1: java.lang.String, _2: Boolean)(java.lang.String, Boolean)" class="delimiter">(</span><a href="#379746" title="java.lang.String">msg</a>, <a href="#379745" title="Boolean">ret</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#379374" title="(req: net.liftweb.http.Req, response: net.liftweb.http.provider.HTTPResponse)Boolean">doService</a><span class="delimiter">(</span><a href="#379727" title="net.liftweb.http.Req">req</a>, <a href="#379728" title="net.liftweb.http.provider.HTTPResponse">resp</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <a href="#379727" title="net.liftweb.http.Req">req</a>.<a href="Req.scala.html#149145" title="=&gt; net.liftweb.http.provider.HTTPRequest">request</a>.<a href="provider/HTTPRequest.scala.html#216887" title="=&gt; Option[(net.liftweb.http.Req, net.liftweb.http.LiftResponse)]">resumeInfo</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Boolean">None</span> =&gt; <a href="#379730" title="=&gt; Boolean">doIt</a>
        <span class="keyword">case</span> <a title="Boolean" id="379763">r</a> <span class="keyword">if</span> <a href="#379763" title="Option[(net.liftweb.http.Req, net.liftweb.http.LiftResponse)]">r</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span> =&gt; <a href="#379730" title="=&gt; Boolean">doIt</a>
        <span class="keyword">case</span> <span title="Boolean">Some</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="net.liftweb.http.Req" id="379767">or</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a>, <a title="net.liftweb.http.LiftResponse" id="379768">r</a>: <a href="LiftResponse.scala.html#14269" title="net.liftweb.http.LiftResponse">LiftResponse</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#379727" title="net.liftweb.http.Req">req</a>.<a href="Req.scala.html#149137" title="=&gt; net.liftweb.http.ParsePath">path</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#379767" title="net.liftweb.http.Req">or</a>.<a href="Req.scala.html#149137" title="=&gt; net.liftweb.http.ParsePath">path</a><span class="delimiter">)</span> =&gt; <a href="#379391" title="(liftResp: net.liftweb.http.LiftResponse, response: net.liftweb.http.provider.HTTPResponse, request: net.liftweb.http.Req)Unit">sendResponse</a><span class="delimiter">(</span><a href="#379768" title="net.liftweb.http.LiftResponse">r</a>, <a href="#379728" title="net.liftweb.http.provider.HTTPResponse">resp</a>, <a href="#379727" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span>; <span title="Boolean(true)" class="keyword">true</span>
        <span class="keyword">case</span> <span title="Boolean">_</span> =&gt; <a href="#379730" title="=&gt; Boolean">doIt</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Boolean">rest</span>.ContinuationException<span class="delimiter">(</span><a title="net.liftweb.http.Req" id="379821">theReq</a>, <a title="net.liftweb.common.Box[net.liftweb.http.LiftSession]" id="379822">sesBox</a>, <a title="=&gt; net.liftweb.http.LiftResponse =&gt; Unit =&gt; Unit" id="379823">func</a><span class="delimiter">)</span> =&gt;
        <a href="#379366" title="(reqOrg: net.liftweb.http.Req, resp: net.liftweb.http.provider.HTTPResponse, session: net.liftweb.common.Box[net.liftweb.http.LiftSession], func: =&gt; net.liftweb.http.LiftResponse =&gt; Unit =&gt; Unit)Boolean">handleGenericContinuation</a><span class="delimiter">(</span><a href="#379821" title="net.liftweb.http.Req">theReq</a>, <a href="#379728" title="net.liftweb.http.provider.HTTPResponse">resp</a>, <a href="#379822" title="net.liftweb.common.Box[net.liftweb.http.LiftSession]">sesBox</a>, <a href="#379823" title="=&gt; net.liftweb.http.LiftResponse =&gt; Unit =&gt; Unit">func</a><span class="delimiter">)</span>; <span title="Boolean(true)" class="keyword">true</span> <span class="comment">// we have to return true to hold onto the request</span>

      <span class="keyword">case</span> <a title="Nothing" id="379824">e</a> <span class="keyword">if</span> <a href="#379824" title="java.lang.Throwable">e</a>.<span title="()java.lang.Class[_]">getClass</span>.<span title="()java.lang.String">getName</span>.<span title="(x$1: java.lang.String)Boolean">endsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;RetryRequest&quot;)" class="string">&quot;RetryRequest&quot;</span><span class="delimiter">)</span> =&gt; <span title="Nothing" class="keyword">throw</span> <a href="#379824" title="java.lang.Throwable">e</a>
      <span class="keyword">case</span> <a title="Nothing" id="379827">e</a> =&gt; <a href="../../../../common/net/liftweb/common/Logging.scala.html#19845" title="=&gt; net.liftweb.common.Logger">logger</a>.<a href="../../../../common/net/liftweb/common/Logging.scala.html#31949" title="(msg: =&gt; AnyRef, t: =&gt; Throwable)Unit">info</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Request for &quot;)" class="string">&quot;Request for &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#379727" title="net.liftweb.http.Req">req</a>.<a href="Req.scala.html#149145" title="=&gt; net.liftweb.http.provider.HTTPRequest">request</a>.<a href="provider/HTTPRequest.scala.html#216870" title="=&gt; String">uri</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; failed &quot;)" class="string">&quot; failed &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#379827" title="java.lang.Throwable">e</a>.<span title="()java.lang.String">getMessage</span>, <a href="#379827" title="java.lang.Throwable">e</a><span class="delimiter">)</span>; <span title="Nothing" class="keyword">throw</span> <a href="#379827" title="java.lang.Throwable">e</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(in: List[Any])List[Any]" id="379368">flatten</a><span class="delimiter">(</span><a title="List[Any]" id="379834">in</a>: <span title="List[Any]">List</span><span class="delimiter">[</span>Any<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="List[Any]">List</span><span class="delimiter">[</span>Any<span class="delimiter">]</span> = <a href="#379834" title="List[Any]">in</a> <span title="List[Any]" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="scala.collection.immutable.Nil.type">Nil</span> =&gt; <span title="object Nil">Nil</span>
    <span class="keyword">case</span> <span title="List[Any]">Some</span><span class="delimiter">(</span><a title="AnyRef" id="379841">x</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span> :: <a title="List[Any]" id="379842">xs</a> =&gt; <a href="#379841" title="AnyRef">x</a> <a href="#379843" title="(x: Any)List[Any]">::</a> <a href="#379368" title="(in: List[Any])List[Any]">flatten</a><span class="delimiter">(</span><a href="#379842" title="List[Any]">xs</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <span title="List[Any]">Full</span><span class="delimiter">(</span><a title="AnyRef" id="379854">x</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span> :: <a title="List[Any]" id="379855">xs</a> =&gt; <a href="#379854" title="AnyRef">x</a> <a href="#379856" title="(x: Any)List[Any]">::</a> <a href="#379368" title="(in: List[Any])List[Any]">flatten</a><span class="delimiter">(</span><a href="#379855" title="List[Any]">xs</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <span title="List[Any]" class="delimiter">(</span><a title="Iterable[_]" id="379864">lst</a>: <span title="Iterable[_]">Iterable</span><span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span> :: <a title="List[Any]" id="379866">xs</a> =&gt; <a href="#379864" title="Iterable[_]">lst</a>.<span title="=&gt; List[_]">toList</span> <a href="#379867" title="(prefix: List[Any])List[Any]">:::</a> <a href="#379368" title="(in: List[Any])List[Any]">flatten</a><span class="delimiter">(</span><a href="#379866" title="List[Any]">xs</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <span title="List[Any]" class="delimiter">(</span><a title="AnyRef" id="379890">x</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span> :: <a title="List[Any]" id="379891">xs</a> =&gt; <a href="#379890" title="AnyRef">x</a> <a href="#379892" title="(x: Any)List[Any]">::</a> <a href="#379368" title="(in: List[Any])List[Any]">flatten</a><span class="delimiter">(</span><a href="#379891" title="List[Any]">xs</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <a title="List[Any]" id="379900">x</a> :: <a title="List[Any]" id="379901">xs</a> =&gt; <a href="#379368" title="(in: List[Any])List[Any]">flatten</a><span class="delimiter">(</span><a href="#379901" title="List[Any]">xs</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(req: net.liftweb.http.Req)Boolean" id="379369">authPassed_?</a><span class="delimiter">(</span><a title="net.liftweb.http.Req" id="379902">req</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="(net.liftweb.http.auth.Role, List[net.liftweb.http.auth.Role]) =&gt; Boolean" id="379904">checkRoles</a>: <span class="delimiter">(</span>Role, List<span class="delimiter">[</span>Role<span class="delimiter">]</span><span class="delimiter">)</span> =&gt; Boolean = <a href="#379907" title="Boolean" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="Boolean" class="delimiter">(</span><a title="net.liftweb.http.auth.Role" id="379945">resRole</a>, <a title="List[net.liftweb.http.auth.Role]" id="379946">roles</a><span class="delimiter">)</span> =&gt; <span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span> <a href="#379947" title="(z: Boolean)(op: (Boolean, net.liftweb.http.auth.Role) =&gt; Boolean)Boolean">/:</a> <a href="#379946" title="List[net.liftweb.http.auth.Role]">roles</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="Boolean" id="379960">l</a>, <a title="net.liftweb.http.auth.Role" id="379961">r</a><span class="delimiter">)</span> =&gt; <a href="#379960" title="Boolean">l</a> <span title="(x: Boolean)Boolean">||</span> <a href="#379945" title="net.liftweb.http.auth.Role">resRole</a>.<a href="auth/Role.scala.html#379923" title="(roleName: String)Boolean">isChildOf</a><span class="delimiter">(</span><a href="#379961" title="net.liftweb.http.auth.Role">r</a>.<a href="auth/Role.scala.html#379916" title="=&gt; String">name</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="net.liftweb.common.Box[net.liftweb.common.Box[net.liftweb.http.auth.Role]]" id="379905">role</a> = <a href="../../../../util/net/liftweb/util/NamedPartialFunction.scala.html#13548" title="object net.liftweb.util.NamedPF">NamedPF</a>.<a href="../../../../util/net/liftweb/util/NamedPartialFunction.scala.html#185585" title="(value: net.liftweb.http.Req, lst: Seq[PartialFunction[net.liftweb.http.Req,net.liftweb.common.Box[net.liftweb.http.auth.Role]]])net.liftweb.common.Box[net.liftweb.common.Box[net.liftweb.http.auth.Role]]">applyBox</a><span class="delimiter">(</span><a href="#379902" title="net.liftweb.http.Req">req</a>, <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158846" title="=&gt; net.liftweb.http.LiftRules#RulesSeq[PartialFunction[net.liftweb.http.Req,net.liftweb.common.Box[net.liftweb.http.auth.Role]]]">httpAuthProtectedResource</a>.<a href="LiftRules.scala.html#185552" title="=&gt; List[PartialFunction[net.liftweb.http.Req,net.liftweb.common.Box[net.liftweb.http.auth.Role]]]">toList</a><span class="delimiter">)</span>
    <a href="#379905" title="net.liftweb.common.Box[net.liftweb.common.Box[net.liftweb.http.auth.Role]]">role</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: net.liftweb.common.Box[net.liftweb.http.auth.Role] =&gt; Boolean)net.liftweb.common.Box[Boolean]">map</a><span class="delimiter">(</span><a href="#380002" title="net.liftweb.common.Box[net.liftweb.http.auth.Role]">_</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Boolean">Full</span><span class="delimiter">(</span><a title="net.liftweb.http.auth.Role" id="380004">r</a><span class="delimiter">)</span> =&gt;
        <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158848" title="=&gt; net.liftweb.http.auth.HttpAuthentication">authentication</a>.<a href="auth/HttpAuthentication.scala.html#356906" title="(v1: net.liftweb.http.Req)Boolean">verified_?</a><span class="delimiter">(</span><a href="#379902" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Boolean" class="keyword">true</span> =&gt; <a href="#379904" title="(v1: net.liftweb.http.auth.Role, v2: List[net.liftweb.http.auth.Role])Boolean">checkRoles</a><span class="delimiter">(</span><a href="#380004" title="net.liftweb.http.auth.Role">r</a>, <a href="auth/HttpAuthentication.scala.html#14829" title="object net.liftweb.http.auth.userRoles">userRoles</a>.<a href="../../../../util/net/liftweb/util/AnyVar.scala.html#75377" title="=&gt; List[net.liftweb.http.auth.Role]">get</a><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Boolean(false)">_</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="Boolean">_</span> =&gt; <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158848" title="=&gt; net.liftweb.http.auth.HttpAuthentication">authentication</a>.<a href="auth/HttpAuthentication.scala.html#356906" title="(v1: net.liftweb.http.Req)Boolean">verified_?</a><span class="delimiter">(</span><a href="#379902" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; Boolean)Boolean">openOr</a> <span title="Boolean(true)" class="keyword">true</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="net.liftweb.common.LRUMap[String,Int]" id="379370">recent</a>: <a href="../../../../common/net/liftweb/common/LRU.scala.html#10698" title="net.liftweb.common.LRUMap[String,Int]">LRUMap</a><span class="delimiter">[</span>String, Int<span class="delimiter">]</span> = <a href="../../../../common/net/liftweb/common/LRU.scala.html#41192" title="(size: Int)net.liftweb.common.LRUMap[String,Int]" class="keyword">new</a> <a href="../../../../common/net/liftweb/common/LRU.scala.html#10698" title="net.liftweb.common.LRUMap[String,Int]">LRUMap</a><span class="delimiter">(</span><span title="Int(2000)" class="int">2000</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(id: String)Unit" id="379372">registerRecentlyChecked</a><span class="delimiter">(</span><a title="String" id="380030">id</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="#14447" title="(x$1: Unit)Unit">synchronized</a> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Int" id="380034">next</a> = <a href="#379370" title="=&gt; net.liftweb.common.LRUMap[String,Int]">recent</a>.<a href="../../../../common/net/liftweb/common/LRU.scala.html#41200" title="(key: String)net.liftweb.common.Box[Int]">get</a><span class="delimiter">(</span><a href="#380030" title="String">id</a><span class="delimiter">)</span> <span title="Int" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Int">Full</span><span class="delimiter">(</span><a title="Int" id="380037">x</a><span class="delimiter">)</span> =&gt; <a href="#380037" title="Int">x</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>
        <span class="keyword">case</span> <span title="Int(1)">_</span> =&gt; <span title="Int(1)" class="int">1</span>
      <span class="delimiter">}</span>

      <a href="../../../../common/net/liftweb/common/LRU.scala.html#41205" title="(key: String, value: Int)Unit">recent</a><span class="delimiter">(</span><a href="#380030" title="String">id</a><span class="delimiter">)</span> = <a href="#380034" title="Int">next</a>
    <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(id: net.liftweb.common.Box[String])Int" id="379373">recentlyChecked</a><span class="delimiter">(</span><a title="net.liftweb.common.Box[String]" id="380045">id</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[String]">Box</a><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <a href="#14447" title="(x$1: Int)Int">synchronized</a> <span class="delimiter">{</span>
    <a href="#380045" title="net.liftweb.common.Box[String]">id</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27023" title="(f: String =&gt; net.liftweb.common.Box[Int])net.liftweb.common.Box[Int]">flatMap</a><span class="delimiter">(</span><a href="#379370" title="=&gt; net.liftweb.common.LRUMap[String,Int]">recent</a>.<a href="../../../../common/net/liftweb/common/LRU.scala.html#41200" title="(key: String)net.liftweb.common.Box[Int]">get</a><span class="delimiter">)</span>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; Int)Int">openOr</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Service the HTTP request
   */</span>
  <span class="keyword">def</span> <a title="(req: net.liftweb.http.Req, response: net.liftweb.http.provider.HTTPResponse)Boolean" id="379374">doService</a><span class="delimiter">(</span><a title="net.liftweb.http.Req" id="379747">req</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a>, <a title="net.liftweb.http.provider.HTTPResponse" id="379748">response</a>: <a href="provider/HTTPResponse.scala.html#15087" title="net.liftweb.http.provider.HTTPResponse">HTTPResponse</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="net.liftweb.common.Box[net.liftweb.common.Box[net.liftweb.http.LiftResponse]]" id="380061">tmpStatelessHolder</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.common.Box[net.liftweb.http.LiftResponse]]">Box</a><span class="delimiter">[</span>Box<span class="delimiter">[</span>LiftResponse<span class="delimiter">]</span><span class="delimiter">]</span> = <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a>

    <a href="../../../../util/net/liftweb/util/ControlHelpers.scala.html#48608" title="(f: =&gt; Unit)net.liftweb.common.Box[Unit]">tryo</a> <span class="delimiter">{</span>
      <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159145" title="=&gt; net.liftweb.http.LiftRules#RulesSeq[net.liftweb.http.Req =&gt; Unit]">onBeginServicing</a>.<a href="LiftRules.scala.html#185552" title="=&gt; List[net.liftweb.http.Req =&gt; Unit]">toList</a>.<span title="(f: net.liftweb.http.Req =&gt; Unit =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#380121" title="(v1: net.liftweb.http.Req)Unit">_</a><span class="delimiter">(</span><a href="#379747" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(idb: net.liftweb.common.Box[String])Boolean" id="380062">hasSession</a><span class="delimiter">(</span><a title="net.liftweb.common.Box[String]" id="380139">idb</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[String]">Box</a><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
      <a href="#380139" title="net.liftweb.common.Box[String]">idb</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27023" title="(f: String =&gt; net.liftweb.common.Box[net.liftweb.http.LiftSession])net.liftweb.common.Box[net.liftweb.http.LiftSession]">flatMap</a> <span class="delimiter">{</span>
        <a title="String" id="380144">id</a> =&gt;
          <a href="#379372" title="(id: String)Unit">registerRecentlyChecked</a><span class="delimiter">(</span><a href="#380144" title="String">id</a><span class="delimiter">)</span>
          <a href="LiftSession.scala.html#14484" title="object net.liftweb.http.SessionMaster">SessionMaster</a>.<a href="LiftSession.scala.html#357501" title="(id: String, otherId: net.liftweb.common.Box[String])net.liftweb.common.Box[net.liftweb.http.LiftSession]">getSession</a><span class="delimiter">(</span><a href="#380144" title="String">id</a>, <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27014" title="=&gt; Boolean">isDefined</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(req: net.liftweb.http.Req)Boolean" id="380063">isCometOrAjax</a><span class="delimiter">(</span><a title="net.liftweb.http.Req" id="380150">req</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="List[java.lang.String]" id="380151">wp</a> = <a href="#380150" title="net.liftweb.http.Req">req</a>.<a href="Req.scala.html#149137" title="=&gt; net.liftweb.http.ParsePath">path</a>.<a href="Req.scala.html#216857" title="=&gt; List[java.lang.String]">wholePath</a>
      <span class="keyword">val</span> <a title="Int" id="380152">len</a> = <a href="#380151" title="List[java.lang.String]">wp</a>.<span title="=&gt; Int">length</span>

      <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#380152" title="Int">len</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span> <span title="Boolean(false)" class="keyword">false</span>
      <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Boolean" id="380159">kindaComet</a> = <a href="#380151" title="List[java.lang.String]">wp</a>.<span title="=&gt; java.lang.String">head</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159054" title="=&gt; java.lang.String">cometPath</a>
        <span class="keyword">val</span> <a title="Boolean" id="380160">cometScript</a> = <span class="delimiter">(</span><a href="#380152" title="Int">len</a> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(3)" class="int">3</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#380159" title="Boolean">kindaComet</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
          <a href="#380151" title="(n: Int)java.lang.String">wp</a><span class="delimiter">(</span><span title="Int(2)" class="int">2</span><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159230" title="()String">cometScriptName</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Boolean" id="380161">kindaAjax</a> = <a href="#380151" title="List[java.lang.String]">wp</a>.<span title="=&gt; java.lang.String">head</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159051" title="=&gt; java.lang.String">ajaxPath</a>
        <span class="keyword">val</span> <a title="Boolean" id="380162">ajaxScript</a> = <a href="#380152" title="Int">len</a> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(2)" class="int">2</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#380161" title="Boolean">kindaAjax</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
          <a href="#380151" title="(n: Int)java.lang.String">wp</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159227" title="()String">ajaxScriptName</a><span class="delimiter">(</span><span class="delimiter">)</span>


        <span class="delimiter">(</span><span class="delimiter">(</span><a href="#380159" title="Boolean">kindaComet</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#380160" title="Boolean">cometScript</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <span class="delimiter">(</span><a href="#380161" title="Boolean">kindaAjax</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#380162" title="Boolean">ajaxScript</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
          <a href="#380150" title="net.liftweb.http.Req">req</a>.<a href="Req.scala.html#149243" title="=&gt; Boolean">acceptsJavaScript_?</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="net.liftweb.http.SessionIdCalc" id="380064">sessionIdCalc</a> = <span title="net.liftweb.http.SessionIdCalc" class="keyword">new</span> <a href="#14450" title="net.liftweb.http.SessionIdCalc">SessionIdCalc</a><span class="delimiter">(</span><a href="#379747" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]" id="380065">resp</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">Box</a><span class="delimiter">[</span>LiftResponse<span class="delimiter">]</span> = <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="comment">// if the application is shutting down, return a 404</span>
      <span title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]" class="keyword">if</span> <span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159044" title="=&gt; Boolean">ending</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158929" title="(requestState: net.liftweb.http.Req, session: net.liftweb.common.Box[net.liftweb.http.LiftSession])net.liftweb.common.Box[net.liftweb.http.LiftResponse]">notFoundOrIgnore</a><span class="delimiter">(</span><a href="#379747" title="net.liftweb.http.Req">req</a>, <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#379369" title="(req: net.liftweb.http.Req)Boolean">authPassed_?</a><span class="delimiter">(</span><a href="#379747" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.UnauthorizedResponse)net.liftweb.common.Full[net.liftweb.http.UnauthorizedResponse]">Full</a><span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158848" title="=&gt; net.liftweb.http.auth.HttpAuthentication">authentication</a>.<a href="auth/HttpAuthentication.scala.html#356908" title="=&gt; net.liftweb.http.UnauthorizedResponse">unauthorizedResponse</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]" class="keyword">if</span> <span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159131" title="=&gt; Boolean">redirectAjaxOnSessionLoss</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#380062" title="(idb: net.liftweb.common.Box[String])Boolean">hasSession</a><span class="delimiter">(</span><a href="#380064" title="net.liftweb.http.SessionIdCalc">sessionIdCalc</a>.<a href="#380338" title="=&gt; net.liftweb.common.Box[String]">id</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#380063" title="(req: net.liftweb.http.Req)Boolean">isCometOrAjax</a><span class="delimiter">(</span><a href="#379747" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>

        <span class="keyword">val</span> <a title="net.liftweb.common.Box[String]" id="380358">theId</a> = <a href="#380064" title="net.liftweb.http.SessionIdCalc">sessionIdCalc</a>.<a href="#380338" title="=&gt; net.liftweb.common.Box[String]">id</a>
        <span class="comment">// okay after 2 attempts to redirect, just</span>
        <span class="comment">// ignore calls to the comet URL</span>
        <span title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]" class="keyword">if</span> <span class="delimiter">(</span><a href="#379373" title="(id: net.liftweb.common.Box[String])Int">recentlyChecked</a><span class="delimiter">(</span><a href="#380358" title="net.liftweb.common.Box[String]">theId</a><span class="delimiter">)</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.JavaScriptResponse)net.liftweb.common.Full[net.liftweb.http.JavaScriptResponse]">Full</a><span class="delimiter">(</span><a href="LiftResponse.scala.html#353003" title="(js: net.liftweb.http.js.JsCmd, headers: List[(String, String)], cookies: List[net.liftweb.http.provider.HTTPCookie], code: Int)net.liftweb.http.JavaScriptResponse">JavaScriptResponse</a><span class="delimiter">(</span>js.<a href="js/JsCommands.scala.html#14910" title="object net.liftweb.http.js.JE">JE</a>.<a href="js/JsCommands.scala.html#184878" title="(rawJsCmd: String)net.liftweb.http.js.JE.JsRaw">JsRaw</a><span class="delimiter">(</span><span title="java.lang.String(&quot;window.location = &quot;)" class="string">&quot;window.location = &quot;</span> <span title="(x$1: Any)java.lang.String">+</span>
            <span class="delimiter">(</span><a href="#379747" title="net.liftweb.http.Req">req</a>.<a href="Req.scala.html#149145" title="=&gt; net.liftweb.http.provider.HTTPRequest">request</a>.
              <a href="provider/HTTPRequest.scala.html#216864" title="(name: String)net.liftweb.common.Box[String]">header</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Referer&quot;)" class="string">&quot;Referer&quot;</span><span class="delimiter">)</span> <a href="../../../../util/net/liftweb/util/StringHelpers.scala.html#48858" title="implicit net.liftweb.util.StringHelpers.stringToSuper : (in: String)net.liftweb.util.SuperString">openOr</a>
              <span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span class="delimiter">)</span>.<a href="../../../../util/net/liftweb/util/StringHelpers.scala.html#58436" title="=&gt; String">encJs</a><span class="delimiter">)</span>.<a href="js/JsCommands.scala.html#58023" title="=&gt; net.liftweb.http.js.JsCmd">cmd</a>, <span title="object Nil">Nil</span>, <span title="object Nil">Nil</span>, <span title="Int(200)" class="int">200</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> <span class="keyword">else</span>
      <span class="comment">// if the request is matched is defined in the stateless table, dispatch</span>
      <span title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]" class="keyword">if</span> <span class="delimiter">(</span><a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49379" title="(request: net.liftweb.http.Req)(f: =&gt; Boolean)Boolean">statelessInit</a><span class="delimiter">(</span><a href="#379747" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#380061" title="net.liftweb.common.Box[net.liftweb.common.Box[net.liftweb.http.LiftResponse]]">tmpStatelessHolder</a> = <a href="../../../../util/net/liftweb/util/NamedPartialFunction.scala.html#13548" title="object net.liftweb.util.NamedPF">NamedPF</a>.<a href="../../../../util/net/liftweb/util/NamedPartialFunction.scala.html#185585" title="(value: net.liftweb.http.Req, lst: Seq[PartialFunction[net.liftweb.http.Req,() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]]])net.liftweb.common.Box[() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]]">applyBox</a><span class="delimiter">(</span><a href="#379747" title="net.liftweb.http.Req">req</a>,
          <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159048" title="=&gt; net.liftweb.http.LiftRules#RulesSeq[PartialFunction[net.liftweb.http.Req,() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]]]">statelessDispatchTable</a>.<a href="LiftRules.scala.html#185552" title="=&gt; List[PartialFunction[net.liftweb.http.Req,() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]]]">toList</a><span class="delimiter">)</span>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: () =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse] =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse])net.liftweb.common.Box[net.liftweb.common.Box[net.liftweb.http.LiftResponse]]">map</a><span class="delimiter">(</span><a href="#380426" title="() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]">_</a>.<span title="()net.liftweb.common.Box[net.liftweb.http.LiftResponse]">apply</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="net.liftweb.common.Full[net.liftweb.http.LiftResponse]">Full</span><span class="delimiter">(</span><a title="net.liftweb.http.LiftResponse" id="380428">a</a><span class="delimiter">)</span> =&gt; <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.LiftResponse)net.liftweb.common.Full[net.liftweb.http.LiftResponse]">Full</a><span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159125" title="(v1: (Any, List[(String, String)], List[net.liftweb.http.provider.HTTPCookie], net.liftweb.http.Req))net.liftweb.http.LiftResponse">convertResponse</a><span class="delimiter">(</span><span title="(_1: net.liftweb.http.LiftResponse, _2: scala.collection.immutable.Nil.type, _3: List[net.liftweb.http.provider.HTTPCookie], _4: net.liftweb.http.Req)(net.liftweb.http.LiftResponse, scala.collection.immutable.Nil.type, List[net.liftweb.http.provider.HTTPCookie], net.liftweb.http.Req)" class="delimiter">(</span><a href="#380428" title="net.liftweb.http.LiftResponse">a</a>, <span title="object Nil">Nil</span>, <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49317" title="=&gt; List[net.liftweb.http.provider.HTTPCookie]">responseCookies</a>, <a href="#379747" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]" id="380449">r</a> =&gt; <a href="#380449" title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">r</a>
        <span class="delimiter">}</span><span class="delimiter">)</span>;
        <a href="#380061" title="net.liftweb.common.Box[net.liftweb.common.Box[net.liftweb.http.LiftResponse]]">tmpStatelessHolder</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27014" title="=&gt; Boolean">isDefined</a>
      <span class="delimiter">}</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]" id="380453">f</a> = <a href="#380061" title="net.liftweb.common.Box[net.liftweb.common.Box[net.liftweb.http.LiftResponse]]">tmpStatelessHolder</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27015" title="=&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]">open_!</a>
        <a href="#380453" title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">f</a> <span title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="net.liftweb.common.Full[net.liftweb.http.LiftResponse]">Full</span><span class="delimiter">(</span><a title="net.liftweb.http.LiftResponse" id="380455">v</a><span class="delimiter">)</span> =&gt; <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.LiftResponse)net.liftweb.common.Full[net.liftweb.http.LiftResponse]">Full</a><span class="delimiter">(</span><a href="#380455" title="net.liftweb.http.LiftResponse">v</a><span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">Empty</a> =&gt; <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158929" title="(requestState: net.liftweb.http.Req, session: net.liftweb.common.Box[net.liftweb.http.LiftSession])net.liftweb.common.Box[net.liftweb.http.LiftResponse]">notFoundOrIgnore</a><span class="delimiter">(</span><a href="#379747" title="net.liftweb.http.Req">req</a>, <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a><span class="delimiter">)</span>
          <span class="keyword">case</span> <a title="net.liftweb.common.Full[net.liftweb.http.LiftResponse]" id="380461">f</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10586" title="net.liftweb.common.Failure">Failure</a> =&gt; <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.LiftResponse)net.liftweb.common.Full[net.liftweb.http.LiftResponse]">Full</a><span class="delimiter">(</span><a href="#379747" title="net.liftweb.http.Req">req</a>.<a href="Req.scala.html#149218" title="(f: net.liftweb.common.Failure)net.liftweb.http.LiftResponse">createNotFound</a><span class="delimiter">(</span><a href="#380461" title="net.liftweb.common.Failure">f</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="comment">// otherwise do a stateful response</span>
        <span class="keyword">val</span> <a title="net.liftweb.http.LiftSession" id="380467">liftSession</a> = <a href="#379362" title="(request: net.liftweb.http.Req)net.liftweb.http.LiftSession">getLiftSession</a><span class="delimiter">(</span><a href="#379747" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span>

        <span class="keyword">def</span> <a title="(r2: net.liftweb.http.Req, s2: net.liftweb.http.LiftSession, continue: net.liftweb.common.Box[() =&gt; Nothing])() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]" id="380468">doSession</a><span class="delimiter">(</span><a title="net.liftweb.http.Req" id="380470">r2</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a>, <a title="net.liftweb.http.LiftSession" id="380471">s2</a>: <a href="LiftSession.scala.html#14496" title="net.liftweb.http.LiftSession">LiftSession</a>, <a title="net.liftweb.common.Box[() =&gt; Nothing]" id="380472">continue</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[() =&gt; Nothing]">Box</a><span class="delimiter">[</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Nothing<span class="delimiter">]</span><span class="delimiter">)</span>: <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Box<span class="delimiter">[</span>LiftResponse<span class="delimiter">]</span> = <span class="delimiter">{</span>
          <span class="keyword">try</span> <span class="delimiter">{</span>
            <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49376" title="(request: net.liftweb.http.Req, session: net.liftweb.http.LiftSession)(f: =&gt; () =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse])() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]">init</a><span class="delimiter">(</span><a href="#380470" title="net.liftweb.http.Req">r2</a>, <a href="#380471" title="net.liftweb.http.LiftSession">s2</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#379375" title="(req: net.liftweb.http.Req, liftSession: net.liftweb.http.LiftSession, originalRequest: net.liftweb.http.Req, continuation: net.liftweb.common.Box[() =&gt; Nothing])() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]">dispatchStatefulRequest</a><span class="delimiter">(</span><a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49309" title="=&gt; net.liftweb.common.Box[net.liftweb.http.Req]">request</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27015" title="=&gt; net.liftweb.http.Req">open_!</a>, <a href="#380467" title="net.liftweb.http.LiftSession">liftSession</a>, <a href="#380470" title="net.liftweb.http.Req">r2</a>, <a href="#380472" title="net.liftweb.common.Box[() =&gt; Nothing]">continue</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a title="() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]" id="380484">cre</a>: <a href="ResponseShortcutException.scala.html#14620" title="net.liftweb.http.ContinueResponseException">ContinueResponseException</a> =&gt;
              <a href="#380470" title="net.liftweb.http.Req">r2</a>.<a href="Req.scala.html#149164" title="()Unit">destroyServletSession</a><span class="delimiter">(</span><span class="delimiter">)</span>
              <a href="#380468" title="(r2: net.liftweb.http.Req, s2: net.liftweb.http.LiftSession, continue: net.liftweb.common.Box[() =&gt; Nothing])() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]">doSession</a><span class="delimiter">(</span><a href="#380470" title="net.liftweb.http.Req">r2</a>, <a href="#379362" title="(request: net.liftweb.http.Req)net.liftweb.http.LiftSession">getLiftSession</a><span class="delimiter">(</span><a href="#380470" title="net.liftweb.http.Req">r2</a><span class="delimiter">)</span>, <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: () =&gt; Nothing)net.liftweb.common.Full[() =&gt; Nothing]">Full</a><span class="delimiter">(</span><a href="#380484" title="net.liftweb.http.ContinueResponseException">cre</a>.<a href="ResponseShortcutException.scala.html#380486" title="=&gt; () =&gt; Nothing">continue</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>

        <span class="keyword">val</span> <a title="() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]" id="380469">lzy</a>: <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Box<span class="delimiter">[</span>LiftResponse<span class="delimiter">]</span> = <a href="#380468" title="(r2: net.liftweb.http.Req, s2: net.liftweb.http.LiftSession, continue: net.liftweb.common.Box[() =&gt; Nothing])() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]">doSession</a><span class="delimiter">(</span><a href="#379747" title="net.liftweb.http.Req">req</a>, <a href="#380467" title="net.liftweb.http.LiftSession">liftSession</a>, <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a><span class="delimiter">)</span>

        <a href="#380469" title="()net.liftweb.common.Box[net.liftweb.http.LiftResponse]">lzy</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Nothing" id="380493">foc</a>: <a href="../../../../util/net/liftweb/util/Helpers.scala.html#13350" title="net.liftweb.util.LiftFlowOfControlException">LiftFlowOfControlException</a> =&gt; <span title="Nothing" class="keyword">throw</span> <a href="#380493" title="net.liftweb.util.LiftFlowOfControlException">foc</a>
      <span class="keyword">case</span> <a title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]" id="380494">e</a>: <span title="Exception">Exception</span> <span class="keyword">if</span> <span title="=&gt; Boolean">!</span><a href="#380494" title="Exception">e</a>.<span title="()java.lang.Class[_]">getClass</span>.<span title="()java.lang.String">getName</span>.<span title="(x$1: java.lang.String)Boolean">endsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;RetryRequest&quot;)" class="string">&quot;RetryRequest&quot;</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="(net.liftweb.util.Props.RunModes.Value, net.liftweb.http.Req, Exception)" id="380497">bundle</a> = <span title="(_1: net.liftweb.util.Props.RunModes.Value, _2: net.liftweb.http.Req, _3: Exception)(net.liftweb.util.Props.RunModes.Value, net.liftweb.http.Req, Exception)" class="delimiter">(</span><a href="../../../../util/net/liftweb/util/Props.scala.html#13579" title="object net.liftweb.util.Props">Props</a>.<a href="../../../../util/net/liftweb/util/Props.scala.html#151315" title="=&gt; net.liftweb.util.Props.RunModes.Value">mode</a>, <a href="#379747" title="net.liftweb.http.Req">req</a>, <a href="#380494" title="Exception">e</a><span class="delimiter">)</span>
        <a href="../../../../util/net/liftweb/util/NamedPartialFunction.scala.html#13548" title="object net.liftweb.util.NamedPF">NamedPF</a>.<a href="../../../../util/net/liftweb/util/NamedPartialFunction.scala.html#185585" title="(value: (net.liftweb.util.Props.RunModes.Value, net.liftweb.http.Req, Exception), lst: Seq[PartialFunction[(net.liftweb.util.Props.RunModes.Value, net.liftweb.http.Req, Exception),net.liftweb.http.LiftResponse]])net.liftweb.common.Box[net.liftweb.http.LiftResponse]">applyBox</a><span class="delimiter">(</span><a href="#380497" title="(net.liftweb.util.Props.RunModes.Value, net.liftweb.http.Req, Exception)">bundle</a>, <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159134" title="=&gt; net.liftweb.http.LiftRules#RulesSeq[PartialFunction[(net.liftweb.util.Props.RunModes.Value, net.liftweb.http.Req, java.lang.Throwable),net.liftweb.http.LiftResponse]]">exceptionHandler</a>.<a href="LiftRules.scala.html#185552" title="=&gt; List[PartialFunction[(net.liftweb.util.Props.RunModes.Value, net.liftweb.http.Req, java.lang.Throwable),net.liftweb.http.LiftResponse]]">toList</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <a href="../../../../util/net/liftweb/util/ControlHelpers.scala.html#48608" title="(f: =&gt; Unit)net.liftweb.common.Box[Unit]">tryo</a> <span class="delimiter">{</span>
      <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159151" title="=&gt; net.liftweb.http.LiftRules#RulesSeq[(net.liftweb.http.Req, net.liftweb.common.Box[net.liftweb.http.LiftResponse]) =&gt; Unit]">onEndServicing</a>.<a href="LiftRules.scala.html#185552" title="=&gt; List[(net.liftweb.http.Req, net.liftweb.common.Box[net.liftweb.http.LiftResponse]) =&gt; Unit]">toList</a>.<span title="(f: (net.liftweb.http.Req, net.liftweb.common.Box[net.liftweb.http.LiftResponse]) =&gt; Unit =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#380594" title="(v1: net.liftweb.http.Req, v2: net.liftweb.common.Box[net.liftweb.http.LiftResponse])Unit">_</a><span class="delimiter">(</span><a href="#379747" title="net.liftweb.http.Req">req</a>, <a href="#380065" title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">resp</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="#380065" title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">resp</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Boolean(true)">Full</span><span class="delimiter">(</span><a href="LiftResponse.scala.html#14277" title="object net.liftweb.http.EmptyResponse">EmptyResponse</a><span class="delimiter">)</span> =&gt;
        <span title="Boolean(true)" class="keyword">true</span>

      <span class="keyword">case</span> <span title="Boolean">Full</span><span class="delimiter">(</span><a title="net.liftweb.http.LiftResponse" id="380615">cresp</a><span class="delimiter">)</span> =&gt;
        <a href="#379391" title="(liftResp: net.liftweb.http.LiftResponse, response: net.liftweb.http.provider.HTTPResponse, request: net.liftweb.http.Req)Unit">sendResponse</a><span class="delimiter">(</span><a href="#380615" title="net.liftweb.http.LiftResponse">cresp</a>, <a href="#379748" title="net.liftweb.http.provider.HTTPResponse">response</a>, <a href="#379747" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span>
        <span title="Boolean(true)" class="keyword">true</span>

      <span class="keyword">case</span> <span title="Boolean(false)">_</span> =&gt; <span class="delimiter">{</span>
        <span title="Boolean(false)" class="keyword">false</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(req: net.liftweb.http.Req, liftSession: net.liftweb.http.LiftSession, originalRequest: net.liftweb.http.Req, continuation: net.liftweb.common.Box[() =&gt; Nothing])() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]" id="379375">dispatchStatefulRequest</a><span class="delimiter">(</span><a title="net.liftweb.http.Req" id="380477">req</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a>,
                                      <a title="net.liftweb.http.LiftSession" id="380478">liftSession</a>: <a href="LiftSession.scala.html#14496" title="net.liftweb.http.LiftSession">LiftSession</a>,
                                      <a title="net.liftweb.http.Req" id="380479">originalRequest</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a>,
                                      <a title="net.liftweb.common.Box[() =&gt; Nothing]" id="380480">continuation</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[() =&gt; Nothing]">Box</a><span class="delimiter">[</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Nothing<span class="delimiter">]</span><span class="delimiter">)</span>: <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Box<span class="delimiter">[</span>LiftResponse<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="net.liftweb.http.Req" id="380616">toMatch</a> = <a href="#380477" title="net.liftweb.http.Req">req</a>

    <span class="keyword">val</span> <a title="(Boolean, net.liftweb.common.Box[net.liftweb.http.LiftResponse])" id="380617">dispatch</a>: <span title="(Boolean, net.liftweb.common.Box[net.liftweb.http.LiftResponse])" class="delimiter">(</span>Boolean, Box<span class="delimiter">[</span>LiftResponse<span class="delimiter">]</span><span class="delimiter">)</span> =
      <a href="../../../../util/net/liftweb/util/NamedPartialFunction.scala.html#13548" title="object net.liftweb.util.NamedPF">NamedPF</a>.<a href="../../../../util/net/liftweb/util/NamedPartialFunction.scala.html#185570" title="(value: net.liftweb.http.Req, lst: Seq[PartialFunction[net.liftweb.http.Req,() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]]])net.liftweb.common.Box[PartialFunction[net.liftweb.http.Req,() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]]]">find</a><span class="delimiter">(</span><a href="#380616" title="net.liftweb.http.Req">toMatch</a>, <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159050" title="(req: net.liftweb.http.provider.HTTPRequest)List[net.liftweb.http.LiftRules.DispatchPF]">dispatchTable</a><span class="delimiter">(</span><a href="#380477" title="net.liftweb.http.Req">req</a>.<a href="Req.scala.html#149145" title="=&gt; net.liftweb.http.provider.HTTPRequest">request</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(Boolean, net.liftweb.common.Box[net.liftweb.http.LiftResponse])" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="(Boolean, net.liftweb.common.Box[net.liftweb.http.LiftResponse])">Full</span><span class="delimiter">(</span><a title="PartialFunction[net.liftweb.http.Req,() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]]" id="380641">pf</a><span class="delimiter">)</span> =&gt;
          <a href="LiftSession.scala.html#14470" title="object net.liftweb.http.LiftSession">LiftSession</a>.<a href="LiftSession.scala.html#326782" title="=&gt; List[(net.liftweb.http.LiftSession, net.liftweb.http.Req) =&gt; Unit]">onBeginServicing</a>.<span title="(f: (net.liftweb.http.LiftSession, net.liftweb.http.Req) =&gt; Unit =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#380668" title="(v1: net.liftweb.http.LiftSession, v2: net.liftweb.http.Req)Unit">_</a><span class="delimiter">(</span><a href="#380478" title="net.liftweb.http.LiftSession">liftSession</a>, <a href="#380477" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="(Boolean, net.liftweb.common.Box[net.liftweb.http.LiftResponse])" id="380642">ret</a>: <span title="(Boolean, net.liftweb.common.Box[net.liftweb.http.LiftResponse])" class="delimiter">(</span>Boolean, Box<span class="delimiter">[</span>LiftResponse<span class="delimiter">]</span><span class="delimiter">)</span> =
            <span class="keyword">try</span> <span class="delimiter">{</span>
              <span class="keyword">try</span> <span class="delimiter">{</span>
                <span class="comment">// run the continuation in the new session</span>
                <span class="comment">// if there is a continuation</span>
                <a href="#380480" title="net.liftweb.common.Box[() =&gt; Nothing]">continuation</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
                  <span class="keyword">case</span> <span title="Nothing">Full</span><span class="delimiter">(</span><a title="() =&gt; Nothing" id="380673">func</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
                    <a href="#380673" title="()Nothing">func</a><span class="delimiter">(</span><span class="delimiter">)</span>
                    <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49366" title="(where: String)Nothing">redirectTo</a><span class="delimiter">(</span><span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span class="delimiter">)</span>
                  <span class="delimiter">}</span>
                  <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <span class="comment">// do nothing</span>
                <span class="delimiter">}</span>

                <a href="#380478" title="net.liftweb.http.LiftSession">liftSession</a>.<a href="LiftSession.scala.html#230222" title="(state: net.liftweb.http.Req)List[Any]">runParams</a><span class="delimiter">(</span><a href="#380477" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span>
                <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49432" title="(span: Boolean)(f: =&gt; (Boolean, net.liftweb.common.Box[net.liftweb.http.LiftResponse]))(Boolean, net.liftweb.common.Box[net.liftweb.http.LiftResponse])">functionLifespan</a><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                  <a href="#380641" title="(v1: net.liftweb.http.Req)() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]">pf</a><span title="()net.liftweb.common.Box[net.liftweb.http.LiftResponse]" class="delimiter">(</span><a href="#380616" title="net.liftweb.http.Req">toMatch</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(Boolean, net.liftweb.common.Box[net.liftweb.http.LiftResponse])" class="keyword">match</span> <span class="delimiter">{</span>
                    <span class="keyword">case</span> <span title="(Boolean, net.liftweb.common.Full[net.liftweb.http.LiftResponse])">Full</span><span class="delimiter">(</span><a title="net.liftweb.http.LiftResponse" id="380684">v</a><span class="delimiter">)</span> =&gt;
                      <span title="(_1: Boolean, _2: net.liftweb.common.Full[net.liftweb.http.LiftResponse])(Boolean, net.liftweb.common.Full[net.liftweb.http.LiftResponse])" class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span>, <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.LiftResponse)net.liftweb.common.Full[net.liftweb.http.LiftResponse]">Full</a><span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159125" title="(v1: (Any, List[(String, String)], List[net.liftweb.http.provider.HTTPCookie], net.liftweb.http.Req))net.liftweb.http.LiftResponse">convertResponse</a><span class="delimiter">(</span><span title="(_1: net.liftweb.http.LiftResponse, _2: scala.collection.immutable.Nil.type, _3: List[net.liftweb.http.provider.HTTPCookie], _4: net.liftweb.http.Req)(net.liftweb.http.LiftResponse, scala.collection.immutable.Nil.type, List[net.liftweb.http.provider.HTTPCookie], net.liftweb.http.Req)" class="delimiter">(</span><a href="#380478" title="net.liftweb.http.LiftSession">liftSession</a>.<a href="LiftSession.scala.html#230267" title="(resp: net.liftweb.http.LiftResponse)net.liftweb.http.LiftResponse">checkRedirect</a><span class="delimiter">(</span><a href="#380684" title="net.liftweb.http.LiftResponse">v</a><span class="delimiter">)</span>, <span title="object Nil">Nil</span>,
                        <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49317" title="=&gt; List[net.liftweb.http.provider.HTTPCookie]">responseCookies</a>, <a href="#380477" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

                    <span class="keyword">case</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="(Boolean, net.liftweb.common.Box[net.liftweb.http.LiftResponse])">Empty</a> =&gt;
                      <span title="(_1: Boolean, _2: net.liftweb.common.Box[net.liftweb.http.LiftResponse])(Boolean, net.liftweb.common.Box[net.liftweb.http.LiftResponse])" class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span>, <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158929" title="(requestState: net.liftweb.http.Req, session: net.liftweb.common.Box[net.liftweb.http.LiftSession])net.liftweb.common.Box[net.liftweb.http.LiftResponse]">notFoundOrIgnore</a><span class="delimiter">(</span><a href="#380477" title="net.liftweb.http.Req">req</a>, <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.LiftSession)net.liftweb.common.Full[net.liftweb.http.LiftSession]">Full</a><span class="delimiter">(</span><a href="#380478" title="net.liftweb.http.LiftSession">liftSession</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

                    <span class="keyword">case</span> <a title="(Boolean, net.liftweb.common.Full[net.liftweb.http.LiftResponse])" id="380720">f</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10586" title="net.liftweb.common.Failure">Failure</a> =&gt;
                      <span title="(_1: Boolean, _2: net.liftweb.common.Full[net.liftweb.http.LiftResponse])(Boolean, net.liftweb.common.Full[net.liftweb.http.LiftResponse])" class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span>, <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.LiftResponse)net.liftweb.common.Full[net.liftweb.http.LiftResponse]">Full</a><span class="delimiter">(</span><a href="#380478" title="net.liftweb.http.LiftSession">liftSession</a>.<a href="LiftSession.scala.html#230267" title="(resp: net.liftweb.http.LiftResponse)net.liftweb.http.LiftResponse">checkRedirect</a><span class="delimiter">(</span><a href="#380477" title="net.liftweb.http.Req">req</a>.<a href="Req.scala.html#149218" title="(f: net.liftweb.common.Failure)net.liftweb.http.LiftResponse">createNotFound</a><span class="delimiter">(</span><a href="#380720" title="net.liftweb.common.Failure">f</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                  <span class="delimiter">}</span>
                <span class="delimiter">}</span>
              <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <a href="ResponseShortcutException.scala.html#380735" title="Nothing">ContinueResponseException</a><span class="delimiter">(</span><a title="net.liftweb.http.ContinueResponseException" id="380739">cre</a><span class="delimiter">)</span> =&gt; <span title="Nothing" class="keyword">throw</span> <a href="#380739" title="net.liftweb.http.ContinueResponseException">cre</a>

                <span class="keyword">case</span> <a title="(Boolean, net.liftweb.common.Full[net.liftweb.http.LiftResponse])" id="380740">ite</a>: java.lang.reflect.<span title="java.lang.reflect.InvocationTargetException">InvocationTargetException</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#380740" title="java.lang.reflect.InvocationTargetException">ite</a>.<span title="()java.lang.Throwable">getCause</span>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="ResponseShortcutException.scala.html#14623" title="net.liftweb.http.ResponseShortcutException">ResponseShortcutException</a><span class="delimiter">]</span><span class="delimiter">)</span> =&gt;
                  <span title="(_1: Boolean, _2: net.liftweb.common.Full[net.liftweb.http.LiftResponse])(Boolean, net.liftweb.common.Full[net.liftweb.http.LiftResponse])" class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span>, <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.LiftResponse)net.liftweb.common.Full[net.liftweb.http.LiftResponse]">Full</a><span class="delimiter">(</span><a href="#380478" title="net.liftweb.http.LiftSession">liftSession</a>.<a href="LiftSession.scala.html#230258" title="(re: net.liftweb.http.ResponseShortcutException, request: net.liftweb.http.Req)net.liftweb.http.LiftResponse">handleRedirect</a><span class="delimiter">(</span><a href="#380740" title="java.lang.reflect.InvocationTargetException">ite</a>.<span title="()java.lang.Throwable">getCause</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="net.liftweb.http.ResponseShortcutException" class="delimiter">[</span><a href="ResponseShortcutException.scala.html#14623" title="net.liftweb.http.ResponseShortcutException">ResponseShortcutException</a><span class="delimiter">]</span>, <a href="#380477" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

                <span class="keyword">case</span> <a title="(Boolean, net.liftweb.common.Full[net.liftweb.http.LiftResponse])" id="380768">rd</a>: net.liftweb.http.<a href="ResponseShortcutException.scala.html#14623" title="net.liftweb.http.ResponseShortcutException">ResponseShortcutException</a> =&gt; <span title="(_1: Boolean, _2: net.liftweb.common.Full[net.liftweb.http.LiftResponse])(Boolean, net.liftweb.common.Full[net.liftweb.http.LiftResponse])" class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span>, <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.LiftResponse)net.liftweb.common.Full[net.liftweb.http.LiftResponse]">Full</a><span class="delimiter">(</span><a href="#380478" title="net.liftweb.http.LiftSession">liftSession</a>.<a href="LiftSession.scala.html#230258" title="(re: net.liftweb.http.ResponseShortcutException, request: net.liftweb.http.Req)net.liftweb.http.LiftResponse">handleRedirect</a><span class="delimiter">(</span><a href="#380768" title="net.liftweb.http.ResponseShortcutException">rd</a>, <a href="#380477" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

                <span class="keyword">case</span> <a title="Nothing" id="380778">e</a> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#380778" title="java.lang.Throwable">e</a>.<span title="()java.lang.Class[_]">getClass</span>.<span title="()java.lang.String">getName</span>.<span title="(x$1: java.lang.String)Boolean">endsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;RetryRequest&quot;)" class="string">&quot;RetryRequest&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span title="Nothing" class="keyword">throw</span> <a href="#380778" title="java.lang.Throwable">e</a>

                <span class="keyword">case</span> <a title="Nothing" id="380781">e</a>: <a href="../../../../util/net/liftweb/util/Helpers.scala.html#13350" title="net.liftweb.util.LiftFlowOfControlException">LiftFlowOfControlException</a> =&gt; <span title="Nothing" class="keyword">throw</span> <a href="#380781" title="net.liftweb.util.LiftFlowOfControlException">e</a>

                <span class="keyword">case</span> <a title="(Boolean, net.liftweb.common.Box[net.liftweb.http.LiftResponse])" id="380782">e</a> =&gt; <span title="(_1: Boolean, _2: net.liftweb.common.Box[net.liftweb.http.LiftResponse])(Boolean, net.liftweb.common.Box[net.liftweb.http.LiftResponse])" class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span>, <a href="../../../../util/net/liftweb/util/NamedPartialFunction.scala.html#13548" title="object net.liftweb.util.NamedPF">NamedPF</a>.<a href="../../../../util/net/liftweb/util/NamedPartialFunction.scala.html#185585" title="(value: (net.liftweb.util.Props.RunModes.Value, net.liftweb.http.Req, java.lang.Throwable), lst: Seq[PartialFunction[(net.liftweb.util.Props.RunModes.Value, net.liftweb.http.Req, java.lang.Throwable),net.liftweb.http.LiftResponse]])net.liftweb.common.Box[net.liftweb.http.LiftResponse]">applyBox</a><span class="delimiter">(</span><span title="(_1: net.liftweb.util.Props.RunModes.Value, _2: net.liftweb.http.Req, _3: java.lang.Throwable)(net.liftweb.util.Props.RunModes.Value, net.liftweb.http.Req, java.lang.Throwable)" class="delimiter">(</span><a href="../../../../util/net/liftweb/util/Props.scala.html#13579" title="object net.liftweb.util.Props">Props</a>.<a href="../../../../util/net/liftweb/util/Props.scala.html#151315" title="=&gt; net.liftweb.util.Props.RunModes.Value">mode</a>, <a href="#380477" title="net.liftweb.http.Req">req</a>, <a href="#380782" title="java.lang.Throwable">e</a><span class="delimiter">)</span>, <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159134" title="=&gt; net.liftweb.http.LiftRules#RulesSeq[PartialFunction[(net.liftweb.util.Props.RunModes.Value, net.liftweb.http.Req, java.lang.Throwable),net.liftweb.http.LiftResponse]]">exceptionHandler</a>.<a href="LiftRules.scala.html#185552" title="=&gt; List[PartialFunction[(net.liftweb.util.Props.RunModes.Value, net.liftweb.http.Req, java.lang.Throwable),net.liftweb.http.LiftResponse]]">toList</a><span class="delimiter">)</span><span class="delimiter">)</span>

              <span class="delimiter">}</span>

            <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49475" title="=&gt; Map[String,net.liftweb.http.S.AFuncHolder]">functionMap</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="#380478" title="net.liftweb.http.LiftSession">liftSession</a>.<a href="LiftSession.scala.html#230223" title="(funcs: Map[String,net.liftweb.http.S.AFuncHolder], uniqueId: String, when: Long)Unit">updateFunctionMap</a><span class="delimiter">(</span><a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49475" title="=&gt; Map[String,net.liftweb.http.S.AFuncHolder]">functionMap</a>, <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49359" title="=&gt; String">uri</a>, <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48788" title="=&gt; Long">millis</a><span class="delimiter">)</span>
                <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49479" title="=&gt; Unit">clearFunctionMap</a>
              <span class="delimiter">}</span>
              <a href="#380478" title="net.liftweb.http.LiftSession">liftSession</a>.<a href="LiftSession.scala.html#230168" title="(x$1: Seq[(net.liftweb.http.NoticeType.Value, scala.xml.NodeSeq, net.liftweb.common.Box[String])])Unit">notices</a> = <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49556" title="=&gt; List[(net.liftweb.http.NoticeType.Value, scala.xml.NodeSeq, net.liftweb.common.Box[String])]">getNotices</a>
            <span class="delimiter">}</span>

          <a href="LiftSession.scala.html#14470" title="object net.liftweb.http.LiftSession">LiftSession</a>.<a href="LiftSession.scala.html#326788" title="=&gt; List[(net.liftweb.http.LiftSession, net.liftweb.http.Req, net.liftweb.common.Box[net.liftweb.http.LiftResponse]) =&gt; Unit]">onEndServicing</a>.<span title="(f: (net.liftweb.http.LiftSession, net.liftweb.http.Req, net.liftweb.common.Box[net.liftweb.http.LiftResponse]) =&gt; Unit =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#380846" title="(v1: net.liftweb.http.LiftSession, v2: net.liftweb.http.Req, v3: net.liftweb.common.Box[net.liftweb.http.LiftResponse])Unit">_</a><span class="delimiter">(</span><a href="#380478" title="net.liftweb.http.LiftSession">liftSession</a>, <a href="#380477" title="net.liftweb.http.Req">req</a>,
            <a href="#380642" title="(Boolean, net.liftweb.common.Box[net.liftweb.http.LiftResponse])">ret</a>.<span title="=&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]">_2</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#380642" title="(Boolean, net.liftweb.common.Box[net.liftweb.http.LiftResponse])">ret</a>

        <span class="keyword">case</span> <span title="(Boolean, net.liftweb.common.Empty.type)">_</span> =&gt; <span title="(_1: Boolean, _2: net.liftweb.common.Empty.type)(Boolean, net.liftweb.common.Empty.type)" class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span>, <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="List[java.lang.String]" id="380618">wp</a> = <a href="#380477" title="net.liftweb.http.Req">req</a>.<a href="Req.scala.html#149137" title="=&gt; net.liftweb.http.ParsePath">path</a>.<a href="Req.scala.html#216857" title="=&gt; List[java.lang.String]">wholePath</a>

    <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158855" title="=&gt; Boolean">enableContainerSessions</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#380477" title="net.liftweb.http.Req">req</a>.<a href="Req.scala.html#149160" title="=&gt; Boolean">stateless_?</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#380477" title="net.liftweb.http.Req">req</a>.<a href="Req.scala.html#149145" title="=&gt; net.liftweb.http.provider.HTTPRequest">request</a>.<a href="provider/HTTPRequest.scala.html#216876" title="=&gt; net.liftweb.http.provider.HTTPSession">session</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(in: net.liftweb.common.Box[net.liftweb.http.LiftResponse])() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]" id="380619">respToFunc</a><span class="delimiter">(</span><a title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]" id="380873">in</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">Box</a><span class="delimiter">[</span>LiftResponse<span class="delimiter">]</span><span class="delimiter">)</span>: <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Box<span class="delimiter">[</span>LiftResponse<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]" id="380874">ret</a> = <a href="#380873" title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">in</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: net.liftweb.http.LiftResponse =&gt; net.liftweb.http.LiftResponse)net.liftweb.common.Box[net.liftweb.http.LiftResponse]">map</a><span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159122" title="(in: net.liftweb.http.LiftResponse)net.liftweb.http.LiftResponse">performTransform</a><span class="delimiter">)</span>
      <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#380874" title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">ret</a>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]" id="380620">toReturn</a>: <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Box<span class="delimiter">[</span>LiftResponse<span class="delimiter">]</span> =
      <span title="() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]" class="keyword">if</span> <span class="delimiter">(</span><a href="#380617" title="(Boolean, net.liftweb.common.Box[net.liftweb.http.LiftResponse])">dispatch</a>.<span title="=&gt; Boolean">_1</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#380619" title="(in: net.liftweb.common.Box[net.liftweb.http.LiftResponse])() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]">respToFunc</a><span class="delimiter">(</span><a href="#380617" title="(Boolean, net.liftweb.common.Box[net.liftweb.http.LiftResponse])">dispatch</a>.<span title="=&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]">_2</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span title="() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]" class="keyword">if</span> <span class="delimiter">(</span><a href="#380618" title="List[java.lang.String]">wp</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(3)" class="int">3</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#380618" title="List[java.lang.String]">wp</a>.<span title="=&gt; java.lang.String">head</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159054" title="=&gt; java.lang.String">cometPath</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
        <a href="#380618" title="(n: Int)java.lang.String">wp</a><span class="delimiter">(</span><span title="Int(2)" class="int">2</span><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159230" title="()String">cometScriptName</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#380619" title="(in: net.liftweb.common.Box[net.liftweb.http.LiftResponse])() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]">respToFunc</a><span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159233" title="(v1: net.liftweb.http.LiftSession, v2: net.liftweb.http.Req)net.liftweb.common.Box[net.liftweb.http.LiftResponse]">serveCometScript</a><span class="delimiter">(</span><a href="#380478" title="net.liftweb.http.LiftSession">liftSession</a>, <a href="#380477" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span title="() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#380618" title="List[java.lang.String]">wp</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#380618" title="List[java.lang.String]">wp</a>.<span title="=&gt; java.lang.String">head</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159054" title="=&gt; java.lang.String">cometPath</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#379384" title="(requestState: net.liftweb.http.Req, sessionActor: net.liftweb.http.LiftSession, originalRequest: net.liftweb.http.Req)Either[net.liftweb.common.Box[net.liftweb.http.LiftResponse],() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]]">handleComet</a><span class="delimiter">(</span><a href="#380477" title="net.liftweb.http.Req">req</a>, <a href="#380478" title="net.liftweb.http.LiftSession">liftSession</a>, <a href="#380479" title="net.liftweb.http.Req">originalRequest</a><span class="delimiter">)</span> <span title="() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]">Left</span><span class="delimiter">(</span><a title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]" id="380935">x</a><span class="delimiter">)</span> =&gt; <a href="#380619" title="(in: net.liftweb.common.Box[net.liftweb.http.LiftResponse])() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]">respToFunc</a><span class="delimiter">(</span><a href="#380935" title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">x</a><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]">Right</span><span class="delimiter">(</span><a title="() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]" id="380937">x</a><span class="delimiter">)</span> =&gt; <a href="#380937" title="() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]">x</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span title="() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]" class="keyword">if</span> <span class="delimiter">(</span><a href="#380618" title="List[java.lang.String]">wp</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(2)" class="int">2</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#380618" title="List[java.lang.String]">wp</a>.<span title="=&gt; java.lang.String">head</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159051" title="=&gt; java.lang.String">ajaxPath</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
        <a href="#380618" title="(n: Int)java.lang.String">wp</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159227" title="()String">ajaxScriptName</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#380619" title="(in: net.liftweb.common.Box[net.liftweb.http.LiftResponse])() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]">respToFunc</a><span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159236" title="(v1: net.liftweb.http.LiftSession, v2: net.liftweb.http.Req)net.liftweb.common.Box[net.liftweb.http.LiftResponse]">serveAjaxScript</a><span class="delimiter">(</span><a href="#380478" title="net.liftweb.http.LiftSession">liftSession</a>, <a href="#380477" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span title="() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]" class="keyword">if</span> <span class="delimiter">(</span><a href="#380618" title="List[java.lang.String]">wp</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(1)" class="int">1</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#380618" title="List[java.lang.String]">wp</a>.<span title="=&gt; java.lang.String">head</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159051" title="=&gt; java.lang.String">ajaxPath</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#380619" title="(in: net.liftweb.common.Box[net.liftweb.http.LiftResponse])() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]">respToFunc</a><span class="delimiter">(</span><a href="#379377" title="(liftSession: net.liftweb.http.LiftSession, requestState: net.liftweb.http.Req)net.liftweb.common.Box[net.liftweb.http.LiftResponse]">handleAjax</a><span class="delimiter">(</span><a href="#380478" title="net.liftweb.http.LiftSession">liftSession</a>, <a href="#380477" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="#380619" title="(in: net.liftweb.common.Box[net.liftweb.http.LiftResponse])() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]">respToFunc</a><span class="delimiter">(</span><a href="#380478" title="net.liftweb.http.LiftSession">liftSession</a>.<a href="LiftSession.scala.html#230255" title="(request: net.liftweb.http.Req, continuation: net.liftweb.common.Box[() =&gt; Nothing])net.liftweb.common.Box[net.liftweb.http.LiftResponse]">processRequest</a><span class="delimiter">(</span><a href="#380477" title="net.liftweb.http.Req">req</a>, <a href="#380480" title="net.liftweb.common.Box[() =&gt; Nothing]">continuation</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <a href="#380620" title="() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]">toReturn</a>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(path: List[String])Unit" id="379376">extractVersion</a><span class="delimiter">(</span><a title="List[String]" id="380985">path</a>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#380985" title="List[String]">path</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Unit" id="380991">first</a> :: <a title="String" id="380996">second</a> :: _ =&gt; <a href="LiftSession.scala.html#14488" title="object net.liftweb.http.RenderVersion">RenderVersion</a>.<a href="LiftSession.scala.html#345568" title="(value: String)Unit">set</a><span class="delimiter">(</span><a href="#380996" title="String">second</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(liftSession: net.liftweb.http.LiftSession, requestState: net.liftweb.http.Req)net.liftweb.common.Box[net.liftweb.http.LiftResponse]" id="379377">handleAjax</a><span class="delimiter">(</span><a title="net.liftweb.http.LiftSession" id="380979">liftSession</a>: <a href="LiftSession.scala.html#14496" title="net.liftweb.http.LiftSession">LiftSession</a>,
                         <a title="net.liftweb.http.Req" id="380980">requestState</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">Box</a><span class="delimiter">[</span>LiftResponse<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#379376" title="(path: List[String])Unit">extractVersion</a><span class="delimiter">(</span><a href="#380980" title="net.liftweb.http.Req">requestState</a>.<a href="Req.scala.html#149137" title="=&gt; net.liftweb.http.ParsePath">path</a>.<a href="Req.scala.html#216847" title="=&gt; List[String]">partPath</a><span class="delimiter">)</span>

    <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159116" title="=&gt; net.liftweb.common.Logger">cometLogger</a>.<a href="../../../../common/net/liftweb/common/Logging.scala.html#31942" title="(msg: =&gt; AnyRef)Unit">debug</a><span class="delimiter">(</span><span title="java.lang.String(&quot;AJAX Request: &quot;)" class="string">&quot;AJAX Request: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#380979" title="net.liftweb.http.LiftSession">liftSession</a>.<a href="LiftSession.scala.html#230144" title="=&gt; String">uniqueId</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#380980" title="net.liftweb.http.Req">requestState</a>.<a href="Req.scala.html#149194" title="=&gt; Map[String,List[String]]">params</a><span class="delimiter">)</span>
    <a href="../../../../util/net/liftweb/util/ControlHelpers.scala.html#48608" title="(f: =&gt; Unit)net.liftweb.common.Box[Unit]">tryo</a> <span class="delimiter">{</span>
      <a href="LiftSession.scala.html#14470" title="object net.liftweb.http.LiftSession">LiftSession</a>.<a href="LiftSession.scala.html#326782" title="=&gt; List[(net.liftweb.http.LiftSession, net.liftweb.http.Req) =&gt; Unit]">onBeginServicing</a>.<span title="(f: (net.liftweb.http.LiftSession, net.liftweb.http.Req) =&gt; Unit =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#381053" title="(v1: net.liftweb.http.LiftSession, v2: net.liftweb.http.Req)Unit">_</a><span class="delimiter">(</span><a href="#380979" title="net.liftweb.http.LiftSession">liftSession</a>, <a href="#380980" title="net.liftweb.http.Req">requestState</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]" id="380999">ret</a> = <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#380980" title="net.liftweb.http.Req">requestState</a>.<a href="Req.scala.html#149174" title="(n: String)net.liftweb.common.Box[String]">param</a><span class="delimiter">(</span><span title="java.lang.String(&quot;__lift__GC&quot;)" class="string">&quot;__lift__GC&quot;</span><span class="delimiter">)</span> <span title="net.liftweb.common.Full[net.liftweb.http.LiftResponse]" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="net.liftweb.common.Full[net.liftweb.http.LiftResponse]">Full</span><span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;
          <a href="#380979" title="net.liftweb.http.LiftSession">liftSession</a>.<a href="LiftSession.scala.html#230243" title="(ownerName: String, time: Long)Int">updateFuncByOwner</a><span class="delimiter">(</span><a href="LiftSession.scala.html#14488" title="object net.liftweb.http.RenderVersion">RenderVersion</a>.<a href="LiftSession.scala.html#345564" title="=&gt; String">get</a>, <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48788" title="=&gt; Long">millis</a><span class="delimiter">)</span>
          <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.LiftResponse)net.liftweb.common.Full[net.liftweb.http.LiftResponse]">Full</a><span class="delimiter">(</span><a href="LiftResponse.scala.html#353002" title="(js: net.liftweb.http.js.JsCmd)net.liftweb.http.LiftResponse">JavaScriptResponse</a><span class="delimiter">(</span>js.<a href="js/JsCommands.scala.html#14916" title="object net.liftweb.http.js.JsCmds">JsCmds</a>.<a href="js/JsCommands.scala.html#146481" title="=&gt; net.liftweb.http.js.JsCmd">Noop</a><span class="delimiter">)</span><span class="delimiter">)</span>

        <span class="keyword">case</span> <span title="net.liftweb.common.Full[net.liftweb.http.LiftResponse]">_</span> =&gt;
          <span class="keyword">try</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="List[Any]" id="381085">what</a> = <a href="#379368" title="(in: List[Any])List[Any]">flatten</a><span class="delimiter">(</span><span class="keyword">try</span> <span class="delimiter">{</span>
              <a href="#380979" title="net.liftweb.http.LiftSession">liftSession</a>.<a href="LiftSession.scala.html#230222" title="(state: net.liftweb.http.Req)List[Any]">runParams</a><span class="delimiter">(</span><a href="#380980" title="net.liftweb.http.Req">requestState</a><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <span title="List[net.liftweb.http.js.JsCmds.RedirectTo]">ResponseShortcutException</span><span class="delimiter">(</span>_, Full<span class="delimiter">(</span><a title="String" id="381127">to</a><span class="delimiter">)</span>, _<span class="delimiter">)</span> =&gt;
                <span class="keyword">import</span> js.<a href="js/JsCommands.scala.html#14916" title="object net.liftweb.http.js.JsCmds">JsCmds</a>._
                <span title="(xs: net.liftweb.http.js.JsCmds.RedirectTo*)List[net.liftweb.http.js.JsCmds.RedirectTo]">List</span><span class="delimiter">(</span><a href="js/JsCommands.scala.html#377704" title="(where: String)net.liftweb.http.js.JsCmds.RedirectTo">RedirectTo</a><span class="delimiter">(</span><a href="#381127" title="String">to</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="delimiter">}</span><span class="delimiter">)</span>

            <span class="keyword">val</span> <a title="List[java.lang.Object]" id="381086">what2</a> = <a href="#381085" title="List[Any]">what</a>.<span title="(f: Any =&gt; scala.collection.GenTraversableOnce[java.lang.Object])(implicit bf: scala.collection.generic.CanBuildFrom[List[Any],java.lang.Object,List[java.lang.Object]])List[java.lang.Object]">flatMap</span> <a href="#381158" title="List[java.lang.Object]" class="delimiter">{</a>
              <span class="keyword">case</span> <a title="List[net.liftweb.http.js.JsCmd]" id="381159">js</a>: <a href="js/JsCommands.scala.html#14913" title="net.liftweb.http.js.JsCmd">JsCmd</a> =&gt; <span title="(xs: net.liftweb.http.js.JsCmd*)List[net.liftweb.http.js.JsCmd]">List</span><span class="delimiter">(</span><a href="#381159" title="net.liftweb.http.js.JsCmd">js</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <a title="List[scala.xml.NodeSeq]" id="381167">n</a>: <span title="scala.xml.NodeSeq">NodeSeq</span> =&gt; <span title="(xs: scala.xml.NodeSeq*)List[scala.xml.NodeSeq]">List</span><span class="delimiter">(</span><a href="#381167" title="scala.xml.NodeSeq">n</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <a title="List[net.liftweb.http.js.JsCommands]" id="381175">js</a>: <a href="js/JsCommands.scala.html#14901" title="net.liftweb.http.js.JsCommands">JsCommands</a> =&gt; <span title="(xs: net.liftweb.http.js.JsCommands*)List[net.liftweb.http.js.JsCommands]">List</span><span class="delimiter">(</span><a href="#381175" title="net.liftweb.http.js.JsCommands">js</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <a title="List[net.liftweb.http.LiftResponse]" id="381190">r</a>: <a href="LiftResponse.scala.html#14269" title="net.liftweb.http.LiftResponse">LiftResponse</a> =&gt; <span title="(xs: net.liftweb.http.LiftResponse*)List[net.liftweb.http.LiftResponse]">List</span><span class="delimiter">(</span><a href="#381190" title="net.liftweb.http.LiftResponse">r</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <a title="scala.collection.immutable.Nil.type" id="381198">s</a> =&gt; <span title="object Nil">Nil</span>
            <span class="delimiter">}</span>

            <span class="keyword">val</span> <a title="net.liftweb.http.LiftResponse" id="381087">ret</a>: <a href="LiftResponse.scala.html#14269" title="net.liftweb.http.LiftResponse">LiftResponse</a> = <a href="#381086" title="List[java.lang.Object]">what2</a> <span title="net.liftweb.http.LiftResponse" class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <span title="net.liftweb.http.LiftResponse" class="delimiter">(</span><a title="net.liftweb.http.js.JsObj" id="385049">json</a>: <a href="js/JsCommands.scala.html#14905" title="net.liftweb.http.js.JsObj">JsObj</a><span class="delimiter">)</span> :: <span title="object Nil">Nil</span> =&gt; <a href="LiftResponse.scala.html#353173" title="(json: net.liftweb.http.js.JsExp)net.liftweb.http.LiftResponse">JsonResponse</a><span class="delimiter">(</span><a href="#385049" title="net.liftweb.http.js.JsObj">json</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="net.liftweb.http.InMemoryResponse" class="delimiter">(</span><a title="net.liftweb.http.js.JsCmd" id="385062">js</a>: <a href="js/JsCommands.scala.html#14913" title="net.liftweb.http.js.JsCmd">JsCmd</a><span class="delimiter">)</span> :: <a title="List[java.lang.Object]" id="385063">xs</a> =&gt; <span class="delimiter">{</span>
                <span class="delimiter">(</span><a href="js/JsCommands.scala.html#385066" title="(in: Seq[net.liftweb.http.js.JsCmd])net.liftweb.http.js.JsCommands">JsCommands</a><span class="delimiter">(</span><a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49517" title="=&gt; net.liftweb.http.js.JsCmd">noticesToJsCmd</a> <a href="#385091" title="(x: net.liftweb.http.js.JsCmd)List[net.liftweb.http.js.JsCmd]">::</a> <span title="object Nil">Nil</span><span class="delimiter">)</span> <a href="js/JsCommands.scala.html#381181" title="(in: List[net.liftweb.http.js.JsCmd])net.liftweb.http.js.JsCommands">&amp;</a>
                  <span class="delimiter">(</span><span class="delimiter">(</span><a href="#385062" title="net.liftweb.http.js.JsCmd">js</a> <a href="#385121" title="(x: java.lang.Object)List[java.lang.Object]">::</a> <a href="#385063" title="List[java.lang.Object]">xs</a><span class="delimiter">)</span>.<span title="(f: java.lang.Object =&gt; scala.collection.GenTraversableOnce[net.liftweb.http.js.JsCmd])(implicit bf: scala.collection.generic.CanBuildFrom[List[java.lang.Object],net.liftweb.http.js.JsCmd,List[net.liftweb.http.js.JsCmd]])List[net.liftweb.http.js.JsCmd]">flatMap</span> <a href="#385151" title="List[net.liftweb.http.js.JsCmd]" class="delimiter">{</a>
                    <span class="keyword">case</span> <a title="List[net.liftweb.http.js.JsCmd]" id="385152">js</a>: <a href="js/JsCommands.scala.html#14913" title="net.liftweb.http.js.JsCmd">JsCmd</a> =&gt; <span title="(xs: net.liftweb.http.js.JsCmd*)List[net.liftweb.http.js.JsCmd]">List</span><span class="delimiter">(</span><a href="#385152" title="net.liftweb.http.js.JsCmd">js</a><span class="delimiter">)</span>
                    <span class="keyword">case</span> <span title="scala.collection.immutable.Nil.type">_</span> =&gt; <span title="object Nil">Nil</span>
                  <span class="delimiter">}</span>.<span title="=&gt; List[net.liftweb.http.js.JsCmd]">reverse</span><span class="delimiter">)</span> <a href="js/JsCommands.scala.html#381181" title="(in: List[net.liftweb.http.js.JsCmd])net.liftweb.http.js.JsCommands">&amp;</a>
                  <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49340" title="()List[net.liftweb.http.js.JsCmd]">jsToAppend</a><span class="delimiter">)</span>.<a href="js/JsCommands.scala.html#381182" title="=&gt; net.liftweb.http.InMemoryResponse">toResponse</a>
              <span class="delimiter">}</span>

              <span class="keyword">case</span> <span title="net.liftweb.http.XmlResponse" class="delimiter">(</span><a title="scala.xml.Node" id="385347">n</a>: <span title="scala.xml.Node">Node</span><span class="delimiter">)</span> :: _ =&gt; <a href="LiftResponse.scala.html#351753" title="(xml: scala.xml.Node)net.liftweb.http.XmlResponse">XmlResponse</a><span class="delimiter">(</span><a href="#385347" title="scala.xml.Node">n</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="net.liftweb.http.XmlResponse" class="delimiter">(</span><a title="scala.xml.NodeSeq" id="385358">ns</a>: <span title="scala.xml.NodeSeq">NodeSeq</span><span class="delimiter">)</span> :: _ =&gt; <a href="LiftResponse.scala.html#351753" title="(xml: scala.xml.Node)net.liftweb.http.XmlResponse">XmlResponse</a><span class="delimiter">(</span><span title="(nodes: Seq[scala.xml.Node])scala.xml.Group">Group</span><span class="delimiter">(</span><a href="#385358" title="scala.xml.NodeSeq">ns</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="net.liftweb.http.LiftResponse" class="delimiter">(</span><a title="net.liftweb.http.LiftResponse" id="385371">r</a>: <a href="LiftResponse.scala.html#14269" title="net.liftweb.http.LiftResponse">LiftResponse</a><span class="delimiter">)</span> :: _ =&gt; <a href="#385371" title="net.liftweb.http.LiftResponse">r</a>
              <span class="keyword">case</span> <span title="net.liftweb.http.InMemoryResponse">_</span> =&gt; <a href="js/JsCommands.scala.html#385066" title="(in: Seq[net.liftweb.http.js.JsCmd])net.liftweb.http.js.JsCommands">JsCommands</a><span class="delimiter">(</span><a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49517" title="=&gt; net.liftweb.http.js.JsCmd">noticesToJsCmd</a> <a href="#385380" title="(x: net.liftweb.http.js.JsCmd)List[net.liftweb.http.js.JsCmd]">::</a> <a href="js/JsCommands.scala.html#14916" title="object net.liftweb.http.js.JsCmds">JsCmds</a>.<a href="js/JsCommands.scala.html#146481" title="=&gt; net.liftweb.http.js.JsCmd">Noop</a> <a href="#385381" title="(x: net.liftweb.http.js.JsCmd)List[net.liftweb.http.js.JsCmd]">::</a> <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49340" title="()List[net.liftweb.http.js.JsCmd]">jsToAppend</a><span class="delimiter">)</span>.<a href="js/JsCommands.scala.html#381182" title="=&gt; net.liftweb.http.InMemoryResponse">toResponse</a>
            <span class="delimiter">}</span>

            <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159116" title="=&gt; net.liftweb.common.Logger">cometLogger</a>.<a href="../../../../common/net/liftweb/common/Logging.scala.html#31942" title="(msg: =&gt; AnyRef)Unit">debug</a><span class="delimiter">(</span><span title="java.lang.String(&quot;AJAX Response: &quot;)" class="string">&quot;AJAX Response: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#380979" title="net.liftweb.http.LiftSession">liftSession</a>.<a href="LiftSession.scala.html#230144" title="=&gt; String">uniqueId</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#381087" title="net.liftweb.http.LiftResponse">ret</a><span class="delimiter">)</span>

            <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.LiftResponse)net.liftweb.common.Full[net.liftweb.http.LiftResponse]">Full</a><span class="delimiter">(</span><a href="#381087" title="net.liftweb.http.LiftResponse">ret</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
            <a href="#380979" title="net.liftweb.http.LiftSession">liftSession</a>.<a href="LiftSession.scala.html#230223" title="(funcs: Map[String,net.liftweb.http.S.AFuncHolder], uniqueId: String, when: Long)Unit">updateFunctionMap</a><span class="delimiter">(</span><a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49475" title="=&gt; Map[String,net.liftweb.http.S.AFuncHolder]">functionMap</a>, <a href="LiftSession.scala.html#14488" title="object net.liftweb.http.RenderVersion">RenderVersion</a>.<a href="LiftSession.scala.html#345564" title="=&gt; String">get</a>, <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48788" title="=&gt; Long">millis</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Nothing" id="385399">foc</a>: <a href="../../../../util/net/liftweb/util/Helpers.scala.html#13350" title="net.liftweb.util.LiftFlowOfControlException">LiftFlowOfControlException</a> =&gt; <span title="Nothing" class="keyword">throw</span> <a href="#385399" title="net.liftweb.util.LiftFlowOfControlException">foc</a>
      <span class="keyword">case</span> <a title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]" id="385400">e</a> =&gt; <a href="../../../../util/net/liftweb/util/NamedPartialFunction.scala.html#13548" title="object net.liftweb.util.NamedPF">NamedPF</a>.<a href="../../../../util/net/liftweb/util/NamedPartialFunction.scala.html#185585" title="(value: (net.liftweb.util.Props.RunModes.Value, net.liftweb.http.Req, java.lang.Throwable), lst: Seq[PartialFunction[(net.liftweb.util.Props.RunModes.Value, net.liftweb.http.Req, java.lang.Throwable),net.liftweb.http.LiftResponse]])net.liftweb.common.Box[net.liftweb.http.LiftResponse]">applyBox</a><span class="delimiter">(</span><span title="(_1: net.liftweb.util.Props.RunModes.Value, _2: net.liftweb.http.Req, _3: java.lang.Throwable)(net.liftweb.util.Props.RunModes.Value, net.liftweb.http.Req, java.lang.Throwable)" class="delimiter">(</span><a href="../../../../util/net/liftweb/util/Props.scala.html#13579" title="object net.liftweb.util.Props">Props</a>.<a href="../../../../util/net/liftweb/util/Props.scala.html#151315" title="=&gt; net.liftweb.util.Props.RunModes.Value">mode</a>, <a href="#380980" title="net.liftweb.http.Req">requestState</a>, <a href="#385400" title="java.lang.Throwable">e</a><span class="delimiter">)</span>, <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159134" title="=&gt; net.liftweb.http.LiftRules#RulesSeq[PartialFunction[(net.liftweb.util.Props.RunModes.Value, net.liftweb.http.Req, java.lang.Throwable),net.liftweb.http.LiftResponse]]">exceptionHandler</a>.<a href="LiftRules.scala.html#185552" title="=&gt; List[PartialFunction[(net.liftweb.util.Props.RunModes.Value, net.liftweb.http.Req, java.lang.Throwable),net.liftweb.http.LiftResponse]]">toList</a><span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    <a href="../../../../util/net/liftweb/util/ControlHelpers.scala.html#48608" title="(f: =&gt; Unit)net.liftweb.common.Box[Unit]">tryo</a> <span class="delimiter">{</span>
      <a href="LiftSession.scala.html#14470" title="object net.liftweb.http.LiftSession">LiftSession</a>.<a href="LiftSession.scala.html#326788" title="=&gt; List[(net.liftweb.http.LiftSession, net.liftweb.http.Req, net.liftweb.common.Box[net.liftweb.http.LiftResponse]) =&gt; Unit]">onEndServicing</a>.<span title="(f: (net.liftweb.http.LiftSession, net.liftweb.http.Req, net.liftweb.common.Box[net.liftweb.http.LiftResponse]) =&gt; Unit =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#385472" title="(v1: net.liftweb.http.LiftSession, v2: net.liftweb.http.Req, v3: net.liftweb.common.Box[net.liftweb.http.LiftResponse])Unit">_</a><span class="delimiter">(</span><a href="#380979" title="net.liftweb.http.LiftSession">liftSession</a>, <a href="#380980" title="net.liftweb.http.Req">requestState</a>, <a href="#380999" title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">ret</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#380999" title="net.liftweb.common.Box[net.liftweb.http.LiftResponse]">ret</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * An actor that manages continuations from container (Jetty style)
   */</span>
  <span class="keyword">class</span> <a title="class ContinuationActor extends java.lang.Object with net.liftweb.actor.LiftActor with ScalaObject" id="379378">ContinuationActor</a><a href="#379378" title="ScalaObject" class="delimiter">(</a><a title="net.liftweb.http.Req" id="385518">request</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a>, <a title="net.liftweb.http.LiftSession" id="385519">session</a>: <a href="LiftSession.scala.html#14496" title="net.liftweb.http.LiftSession">LiftSession</a>,
                          <a title="List[(net.liftweb.http.LiftCometActor, Long)]" id="385520">actors</a>: <span title="List[(net.liftweb.http.LiftCometActor, Long)]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>LiftCometActor, Long<span class="delimiter">)</span><span class="delimiter">]</span>,
                          <a title="List[net.liftweb.http.AnswerRender] =&gt; Unit" id="385521">onBreakout</a>: List<span class="delimiter">[</span>AnswerRender<span class="delimiter">]</span> =&gt; Unit<span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../../../actor/net/liftweb/actor/LiftActor.scala.html#10558" title="net.liftweb.actor.LiftActor">LiftActor</a> <span class="delimiter">{</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <a title="List[net.liftweb.http.AnswerRender]" id="385502">answers</a>: <span title="List[net.liftweb.http.AnswerRender]">List</span><span class="delimiter">[</span>AnswerRender<span class="delimiter">]</span> = <span title="object Nil">Nil</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <a title="Boolean" id="385505">done</a> = <span title="Boolean(false)" class="keyword">false</span>
    <span class="keyword">val</span> <a title="Long" id="385507">seqId</a> = <a href="../../../../util/net/liftweb/util/Helpers.scala.html#13346" title="object net.liftweb.util.Helpers">Helpers</a>.<a href="../../../../util/net/liftweb/util/HttpHelpers.scala.html#49062" title="=&gt; Long">nextNum</a>

    <span class="keyword">def</span> <a title="=&gt; PartialFunction[Any,Unit]" id="385509">messageHandler</a> = <a href="#385526" title="Unit" class="delimiter">{</a>
      <span class="keyword">case</span> <a href="#379379" title="Unit">BeginContinuation</a> =&gt;
        <span class="keyword">val</span> <a title="net.liftweb.http.AnswerRender =&gt; Unit" id="385528">sendItToMe</a>: AnswerRender =&gt; Unit = <a title="net.liftweb.http.AnswerRender" id="385530">ah</a> =&gt; <a href="#379378" title="ContinuationActor.this.type" class="keyword">this</a> <a href="../../../../actor/net/liftweb/actor/LiftActor.scala.html#29502" title="(msg: Any)Unit">!</a> <a href="#385530" title="net.liftweb.http.AnswerRender">ah</a>

        <a href="#385520" title="List[(net.liftweb.http.LiftCometActor, Long)]">actors</a>.<span title="(f: (net.liftweb.http.LiftCometActor, Long) =&gt; Unit)Unit">foreach</span> <a href="#385552" title="Unit" class="delimiter">{</a>
          <span class="keyword">case</span> <span title="Unit" class="delimiter">(</span><a title="net.liftweb.http.LiftCometActor" id="385555">act</a>, <a title="Long" id="385556">when</a><span class="delimiter">)</span> =&gt; <a href="#385555" title="net.liftweb.http.LiftCometActor">act</a> <a href="../../../../common/net/liftweb/common/SimpleActor.scala.html#29491" title="(param: Any)Unit">!</a> <a href="CometActor.scala.html#345767" title="(when: Long, uniqueId: net.liftweb.http.ListenerId, action: net.liftweb.http.AnswerRender =&gt; Unit)net.liftweb.http.Listen">Listen</a><span class="delimiter">(</span><a href="#385556" title="Long">when</a>, <a href="CometActor.scala.html#344619" title="(id: Long)net.liftweb.http.ListenerId">ListenerId</a><span class="delimiter">(</span><a href="#385507" title="=&gt; Long">seqId</a><span class="delimiter">)</span>, <a href="#385528" title="net.liftweb.http.AnswerRender =&gt; Unit">sendItToMe</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

      <span class="keyword">case</span> <a title="Unit" id="385563">ar</a>: <a href="CometActor.scala.html#14110" title="net.liftweb.http.AnswerRender">AnswerRender</a> =&gt;
        <a href="#385502" title="(x$1: List[net.liftweb.http.AnswerRender])Unit">answers</a> = <a href="#385563" title="net.liftweb.http.AnswerRender">ar</a> <a href="#385564" title="(x: net.liftweb.http.AnswerRender)List[net.liftweb.http.AnswerRender]">::</a> <a href="#385502" title="=&gt; List[net.liftweb.http.AnswerRender]">answers</a>
        <a href="../../../../actor/net/liftweb/actor/LAPinger.scala.html#10537" title="object net.liftweb.actor.LAPinger">LAPinger</a>.<a href="../../../../actor/net/liftweb/actor/LAPinger.scala.html#29297" title="(to: net.liftweb.actor.SpecializedLiftActor[Any], msg: Any, delay: Long)java.util.concurrent.ScheduledFuture[Unit]">schedule</a><span title="Unit" class="delimiter">(</span><a href="#379378" title="LiftServlet.this.ContinuationActor" class="keyword">this</a>, <a href="LiftRules.scala.html#357618" title="()net.liftweb.http.BreakOut">BreakOut</a><span class="delimiter">(</span><span class="delimiter">)</span>, <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#48779" title="implicit net.liftweb.util.TimeHelpers.intToTimeSpan : (in: Int)net.liftweb.util.Helpers.TimeSpan" class="int">5</a> <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#58452" title="=&gt; Long">millis</a><span class="delimiter">)</span>

      <span class="keyword">case</span> <span title="Unit">BreakOut</span><span class="delimiter">(</span><span class="delimiter">)</span> <span class="keyword">if</span> <span title="=&gt; Boolean">!</span><a href="#385505" title="=&gt; Boolean">done</a> =&gt;
        <a href="#385505" title="(x$1: Boolean)Unit">done</a> = <span title="Boolean(true)" class="keyword">true</span>
        <a href="#385519" title="net.liftweb.http.LiftSession">session</a>.<a href="LiftSession.scala.html#230215" title="(what: net.liftweb.actor.LiftActor)Unit">exitComet</a><span class="delimiter">(</span><a href="#379378" title="LiftServlet.this.ContinuationActor" class="keyword">this</a><span class="delimiter">)</span>
        <a href="#385520" title="List[(net.liftweb.http.LiftCometActor, Long)]">actors</a>.<span title="(f: (net.liftweb.http.LiftCometActor, Long) =&gt; net.liftweb.common.Box[Unit])Unit">foreach</span> <a href="#385599" title="net.liftweb.common.Box[Unit]" class="delimiter">{</a>
          <span class="keyword">case</span> <span title="net.liftweb.common.Box[Unit]" class="delimiter">(</span><a title="net.liftweb.http.LiftCometActor" id="385602">act</a>, _<span class="delimiter">)</span> =&gt; <a href="../../../../util/net/liftweb/util/ControlHelpers.scala.html#48608" title="(f: =&gt; Unit)net.liftweb.common.Box[Unit]">tryo</a><span class="delimiter">(</span><a href="#385602" title="net.liftweb.http.LiftCometActor">act</a> <a href="../../../../common/net/liftweb/common/SimpleActor.scala.html#29491" title="(param: Any)Unit">!</a> <a href="CometActor.scala.html#345724" title="(uniqueId: net.liftweb.http.ListenerId)net.liftweb.http.Unlisten">Unlisten</a><span class="delimiter">(</span><a href="CometActor.scala.html#344619" title="(id: Long)net.liftweb.http.ListenerId">ListenerId</a><span class="delimiter">(</span><a href="#385507" title="=&gt; Long">seqId</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#385521" title="(v1: List[net.liftweb.http.AnswerRender])Unit">onBreakout</a><span class="delimiter">(</span><a href="#385502" title="=&gt; List[net.liftweb.http.AnswerRender]">answers</a><span class="delimiter">)</span>

      <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
    <span class="delimiter">}</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()java.lang.String" id="385510">toString</a> = <span title="java.lang.String(&quot;Actor dude &quot;)" class="string">&quot;Actor dude &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#385507" title="=&gt; Long">seqId</a>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">object</span> <a title="object LiftServlet.this.BeginContinuation" id="379379">BeginContinuation</a>

  <span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="Long" id="379382">cometTimeout</a>: <span title="Long">Long</span> = <span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158957" title="=&gt; net.liftweb.common.Box[Int]">cometRequestTimeout</a> <a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; Int)Int">openOr</a> <span title="Int(120)" class="int">120</span><span class="delimiter">)</span> <span title="(x: Long)Long">*</span> <span title="Long(1000L)" class="long">1000L</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(request: net.liftweb.http.Req, session: net.liftweb.http.LiftSession, actors: List[(net.liftweb.http.LiftCometActor, Long)])Any" id="379383">setupContinuation</a><span class="delimiter">(</span><a title="net.liftweb.http.Req" id="385666">request</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a>, <a title="net.liftweb.http.LiftSession" id="385667">session</a>: <a href="LiftSession.scala.html#14496" title="net.liftweb.http.LiftSession">LiftSession</a>, <a title="List[(net.liftweb.http.LiftCometActor, Long)]" id="385668">actors</a>: <span title="List[(net.liftweb.http.LiftCometActor, Long)]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>LiftCometActor, Long<span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Any">Any</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="LiftServlet.this.ContinuationActor" id="385670">cont</a> = <span title="LiftServlet.this.ContinuationActor" class="keyword">new</span> <a href="#379378" title="LiftServlet.this.ContinuationActor">ContinuationActor</a><span class="delimiter">(</span><a href="#385666" title="net.liftweb.http.Req">request</a>, <a href="#385667" title="net.liftweb.http.LiftSession">session</a>, <a href="#385668" title="List[(net.liftweb.http.LiftCometActor, Long)]">actors</a>,
      <a title="List[net.liftweb.http.AnswerRender]" id="385672">answers</a> =&gt; <a href="#385666" title="net.liftweb.http.Req">request</a>.<a href="Req.scala.html#149145" title="=&gt; net.liftweb.http.provider.HTTPRequest">request</a>.<a href="provider/HTTPRequest.scala.html#216889" title="(what: (net.liftweb.http.Req, net.liftweb.http.LiftResponse))Boolean">resume</a><span title="Unit" class="delimiter">(</span>
        <span title="(_1: net.liftweb.http.Req, _2: net.liftweb.http.LiftResponse)(net.liftweb.http.Req, net.liftweb.http.LiftResponse)" class="delimiter">(</span><a href="#385666" title="net.liftweb.http.Req">request</a>, <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49376" title="(request: net.liftweb.http.Req, session: net.liftweb.http.LiftSession)(f: =&gt; net.liftweb.http.LiftResponse)net.liftweb.http.LiftResponse">init</a><span class="delimiter">(</span><a href="#385666" title="net.liftweb.http.Req">request</a>, <a href="#385667" title="net.liftweb.http.LiftSession">session</a><span class="delimiter">)</span>
          <span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159122" title="(in: net.liftweb.http.LiftResponse)net.liftweb.http.LiftResponse">performTransform</a><span class="delimiter">(</span>
            <a href="#379385" title="(session: net.liftweb.http.LiftSession, ret: Seq[net.liftweb.http.AnswerRender], actors: List[(net.liftweb.http.LiftCometActor, Long)])net.liftweb.http.LiftResponse">convertAnswersToCometResponse</a><span class="delimiter">(</span><a href="#385667" title="net.liftweb.http.LiftSession">session</a>,
              <a href="#385672" title="List[net.liftweb.http.AnswerRender]">answers</a>.<span title="=&gt; List[net.liftweb.http.AnswerRender]">toList</span>, <a href="#385668" title="List[(net.liftweb.http.LiftCometActor, Long)]">actors</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>


    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#385667" title="net.liftweb.http.LiftSession">session</a>.<a href="LiftSession.scala.html#230214" title="(what: (net.liftweb.actor.LiftActor, net.liftweb.http.Req))Unit">enterComet</a><span class="delimiter">(</span><a href="#385670" title="(x: LiftServlet.this.ContinuationActor)ArrowAssoc[LiftServlet.this.ContinuationActor]">cont</a> <span title="(y: net.liftweb.http.Req)(LiftServlet.this.ContinuationActor, net.liftweb.http.Req)">-&gt;</span> <a href="#385666" title="net.liftweb.http.Req">request</a><span class="delimiter">)</span>

      <a href="../../../../actor/net/liftweb/actor/LAPinger.scala.html#10537" title="object net.liftweb.actor.LAPinger">LAPinger</a>.<a href="../../../../actor/net/liftweb/actor/LAPinger.scala.html#29297" title="(to: net.liftweb.actor.SpecializedLiftActor[Any], msg: Any, delay: Long)java.util.concurrent.ScheduledFuture[Unit]">schedule</a><span class="delimiter">(</span><a href="#385670" title="LiftServlet.this.ContinuationActor">cont</a>, <a href="LiftRules.scala.html#357618" title="()net.liftweb.http.BreakOut">BreakOut</a><span class="delimiter">(</span><span class="delimiter">)</span>, <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#188664" title="(in: Long)net.liftweb.util.Helpers.TimeSpan">TimeSpan</a><a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#188674" title="implicit net.liftweb.util.ConvertableToDate.toMillis : (in: net.liftweb.util.ConvertableToDate)Long" class="delimiter">(</a><a href="#379381" title="=&gt; Long">cometTimeout</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <a href="#385666" title="net.liftweb.http.Req">request</a>.<a href="Req.scala.html#149145" title="=&gt; net.liftweb.http.provider.HTTPRequest">request</a>.<a href="provider/HTTPRequest.scala.html#216888" title="(timeout: Long)net.liftweb.http.provider.RetryState.Value">suspend</a><span class="delimiter">(</span><a href="#379381" title="=&gt; Long">cometTimeout</a> <span title="(x: Long)Long">+</span> <span title="Long(2000L)" class="long">2000L</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#385670" title="LiftServlet.this.ContinuationActor">cont</a> <a href="../../../../actor/net/liftweb/actor/LiftActor.scala.html#29502" title="(msg: Any)Unit">!</a> <a href="#379379" title="object LiftServlet.this.BeginContinuation">BeginContinuation</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(requestState: net.liftweb.http.Req, sessionActor: net.liftweb.http.LiftSession, originalRequest: net.liftweb.http.Req)Either[net.liftweb.common.Box[net.liftweb.http.LiftResponse],() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]]" id="379384">handleComet</a><span class="delimiter">(</span><a title="net.liftweb.http.Req" id="380930">requestState</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a>, <a title="net.liftweb.http.LiftSession" id="380931">sessionActor</a>: <a href="LiftSession.scala.html#14496" title="net.liftweb.http.LiftSession">LiftSession</a>, <a title="net.liftweb.http.Req" id="380932">originalRequest</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a><span class="delimiter">)</span>: <span title="Either[net.liftweb.common.Box[net.liftweb.http.LiftResponse],() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]]">Either</span><span class="delimiter">[</span>Box<span class="delimiter">[</span>LiftResponse<span class="delimiter">]</span>, <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Box<span class="delimiter">[</span>LiftResponse<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="List[(net.liftweb.http.LiftCometActor, Long)]" id="385722">actors</a>: <span title="List[(net.liftweb.http.LiftCometActor, Long)]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>LiftCometActor, Long<span class="delimiter">)</span><span class="delimiter">]</span> =
      <a href="#380930" title="net.liftweb.http.Req">requestState</a>.<a href="Req.scala.html#149194" title="=&gt; Map[String,List[String]]">params</a>.<span title="=&gt; List[(String, List[String])]">toList</span>.<span title="(f: (String, List[String]) =&gt; scala.collection.GenTraversableOnce[(net.liftweb.http.LiftCometActor, Long)])(implicit bf: scala.collection.generic.CanBuildFrom[List[(String, List[String])],(net.liftweb.http.LiftCometActor, Long),List[(net.liftweb.http.LiftCometActor, Long)]])List[(net.liftweb.http.LiftCometActor, Long)]">flatMap</span> <a href="#385753" title="List[(net.liftweb.http.LiftCometActor, Long)]" class="delimiter">{</a>
        <span class="keyword">case</span> <span title="List[(net.liftweb.http.LiftCometActor, Long)]" class="delimiter">(</span><a title="String" id="385756">name</a>, <a title="List[String]" id="385757">when</a><span class="delimiter">)</span> =&gt;
          <a href="#380931" title="net.liftweb.http.LiftSession">sessionActor</a>.<a href="LiftSession.scala.html#230317" title="(id: String)net.liftweb.common.Box[net.liftweb.http.LiftCometActor]">getAsyncComponent</a><span class="delimiter">(</span><a href="#385756" title="String">name</a><span class="delimiter">)</span>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27051" title="=&gt; List[net.liftweb.http.LiftCometActor]">toList</a>.<span title="(f: net.liftweb.http.LiftCometActor =&gt; (net.liftweb.http.LiftCometActor, Long))(implicit bf: scala.collection.generic.CanBuildFrom[List[net.liftweb.http.LiftCometActor],(net.liftweb.http.LiftCometActor, Long),List[(net.liftweb.http.LiftCometActor, Long)]])List[(net.liftweb.http.LiftCometActor, Long)]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,(net.liftweb.http.LiftCometActor, Long),List[(net.liftweb.http.LiftCometActor, Long)]]" class="delimiter">(</span><a title="net.liftweb.http.LiftCometActor" id="385783">c</a> =&gt; <span title="(_1: net.liftweb.http.LiftCometActor, _2: Long)(net.liftweb.http.LiftCometActor, Long)" class="delimiter">(</span><a href="#385783" title="net.liftweb.http.LiftCometActor">c</a>, <a href="../../../../util/net/liftweb/util/BasicTypesHelpers.scala.html#49107" title="(in: Any)Long">toLong</a><span class="delimiter">(</span><a href="#385757" title="List[String]">when</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span title="Either[net.liftweb.common.Box[net.liftweb.http.LiftResponse],() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#385722" title="List[(net.liftweb.http.LiftCometActor, Long)]">actors</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span title="(a: net.liftweb.common.Full[net.liftweb.http.InMemoryResponse])Left[net.liftweb.common.Full[net.liftweb.http.InMemoryResponse],Nothing]">Left</span><span class="delimiter">(</span><a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.InMemoryResponse)net.liftweb.common.Full[net.liftweb.http.InMemoryResponse]">Full</a><span class="delimiter">(</span><span title="net.liftweb.http.js.JsCommands" class="keyword">new</span> <a href="js/JsCommands.scala.html#14901" title="net.liftweb.http.js.JsCommands">JsCommands</a><span class="delimiter">(</span><a href="#385852" title="net.liftweb.http.js.JE.JsRaw with net.liftweb.http.js.JsCmd" class="keyword">new</a> <a href="js/JsCommands.scala.html#14910" title="anonymous class $anon extends net.liftweb.http.js.JE.JsRaw with net.liftweb.http.js.JsCmd" id="385852">JE</a>.<a href="js/JsCommands.scala.html#49657" title="net.liftweb.http.js.JE.JsRaw">JsRaw</a><span class="delimiter">(</span><span title="java.lang.String(&quot;lift_toWatch = {}&quot;)" class="string">&quot;lift_toWatch = {}&quot;</span><span class="delimiter">)</span> <span class="keyword">with</span> <a href="js/JsCommands.scala.html#14913" title="net.liftweb.http.js.JsCmd">JsCmd</a> <a href="#385851" title="(x: net.liftweb.http.js.JsCmd with Product with Serializable)List[net.liftweb.http.js.JsCmd with Product with Serializable]">::</a> <a href="js/JsCommands.scala.html#14916" title="object net.liftweb.http.js.JsCmds">JsCmds</a>.<a href="js/JsCommands.scala.html#377704" title="(where: String)net.liftweb.http.js.JsCmds.RedirectTo">RedirectTo</a><span class="delimiter">(</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158948" title="=&gt; java.lang.String">noCometSessionPage</a><span class="delimiter">)</span> <a href="#385861" title="(x: net.liftweb.http.js.JsCmds.RedirectTo)List[net.liftweb.http.js.JsCmds.RedirectTo]">::</a> <span title="object Nil">Nil</span><span class="delimiter">)</span>.<a href="js/JsCommands.scala.html#381182" title="=&gt; net.liftweb.http.InMemoryResponse">toResponse</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">else</span> <a href="#380930" title="net.liftweb.http.Req">requestState</a>.<a href="Req.scala.html#149145" title="=&gt; net.liftweb.http.provider.HTTPRequest">request</a>.<a href="provider/HTTPRequest.scala.html#216886" title="=&gt; Boolean">suspendResumeSupport_?</a> <span title="Either[net.liftweb.common.Box[net.liftweb.http.LiftResponse],() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Left[net.liftweb.common.Full[net.liftweb.http.EmptyResponse.type],Nothing]" class="keyword">true</span> =&gt; <span class="delimiter">{</span>
        <a href="#379383" title="(request: net.liftweb.http.Req, session: net.liftweb.http.LiftSession, actors: List[(net.liftweb.http.LiftCometActor, Long)])Any">setupContinuation</a><span class="delimiter">(</span><a href="#380930" title="net.liftweb.http.Req">requestState</a>, <a href="#380931" title="net.liftweb.http.LiftSession">sessionActor</a>, <a href="#385722" title="List[(net.liftweb.http.LiftCometActor, Long)]">actors</a><span class="delimiter">)</span>
        <span title="(a: net.liftweb.common.Full[net.liftweb.http.EmptyResponse.type])Left[net.liftweb.common.Full[net.liftweb.http.EmptyResponse.type],Nothing]">Left</span><span class="delimiter">(</span><a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.EmptyResponse.type)net.liftweb.common.Full[net.liftweb.http.EmptyResponse.type]">Full</a><span class="delimiter">(</span><a href="LiftResponse.scala.html#14277" title="object net.liftweb.http.EmptyResponse">EmptyResponse</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">case</span> <span title="Right[Nothing,() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]]">_</span> =&gt; <span class="delimiter">{</span>
        <span title="(b: () =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse])Right[Nothing,() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]]">Right</span><span class="delimiter">(</span><a href="#379387" title="(request: net.liftweb.http.Req, session: net.liftweb.http.LiftSession, actors: List[(net.liftweb.http.LiftCometActor, Long)], originalRequest: net.liftweb.http.Req)() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]">handleNonContinuationComet</a><span class="delimiter">(</span><a href="#380930" title="net.liftweb.http.Req">requestState</a>, <a href="#380931" title="net.liftweb.http.LiftSession">sessionActor</a>, <a href="#385722" title="List[(net.liftweb.http.LiftCometActor, Long)]">actors</a>, <a href="#380932" title="net.liftweb.http.Req">originalRequest</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(session: net.liftweb.http.LiftSession, ret: Seq[net.liftweb.http.AnswerRender], actors: List[(net.liftweb.http.LiftCometActor, Long)])net.liftweb.http.LiftResponse" id="379385">convertAnswersToCometResponse</a><span class="delimiter">(</span><a title="net.liftweb.http.LiftSession" id="385683">session</a>: <a href="LiftSession.scala.html#14496" title="net.liftweb.http.LiftSession">LiftSession</a>, <a title="Seq[net.liftweb.http.AnswerRender]" id="385684">ret</a>: <span title="Seq[net.liftweb.http.AnswerRender]">Seq</span><span class="delimiter">[</span>AnswerRender<span class="delimiter">]</span>, <a title="List[(net.liftweb.http.LiftCometActor, Long)]" id="385685">actors</a>: <span title="List[(net.liftweb.http.LiftCometActor, Long)]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>LiftCometActor, Long<span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">)</span>: <a href="LiftResponse.scala.html#14269" title="net.liftweb.http.LiftResponse">LiftResponse</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="List[net.liftweb.http.AnswerRender]" id="385929">ret2</a>: <span title="List[net.liftweb.http.AnswerRender]">List</span><span class="delimiter">[</span>AnswerRender<span class="delimiter">]</span> = <a href="#385684" title="Seq[net.liftweb.http.AnswerRender]">ret</a>.<span title="=&gt; List[net.liftweb.http.AnswerRender]">toList</span>
    <span class="keyword">val</span> <a title="String" id="385930">jsUpdateTime</a> = <a href="#385929" title="List[net.liftweb.http.AnswerRender]">ret2</a>.<span title="(f: net.liftweb.http.AnswerRender =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[List[net.liftweb.http.AnswerRender],java.lang.String,List[java.lang.String]])List[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,java.lang.String,List[java.lang.String]]" class="delimiter">(</span><a title="net.liftweb.http.AnswerRender" id="385949">ar</a> =&gt; <span title="java.lang.String(&quot;if (lift_toWatch[\'&quot;)" class="string">&quot;if (lift_toWatch['&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#385949" title="net.liftweb.http.AnswerRender">ar</a>.<a href="CometActor.scala.html#326439" title="=&gt; net.liftweb.http.LiftCometActor">who</a>.<a href="CometActor.scala.html#325343" title="=&gt; String">uniqueId</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\'] !== undefined) lift_toWatch[\'&quot;)" class="string">&quot;'] !== undefined) lift_toWatch['&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#385949" title="net.liftweb.http.AnswerRender">ar</a>.<a href="CometActor.scala.html#326439" title="=&gt; net.liftweb.http.LiftCometActor">who</a>.<a href="CometActor.scala.html#325343" title="=&gt; String">uniqueId</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\'] = \'&quot;)" class="string">&quot;'] = '&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#385949" title="net.liftweb.http.AnswerRender">ar</a>.<a href="CometActor.scala.html#326441" title="=&gt; Long">when</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\';&quot;)" class="string">&quot;';&quot;</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="List[net.liftweb.http.js.JsCmd]" id="385931">jsUpdateStuff</a> = <a href="#385929" title="List[net.liftweb.http.AnswerRender]">ret2</a>.<span title="(f: net.liftweb.http.AnswerRender =&gt; net.liftweb.http.js.JsCmd)(implicit bf: scala.collection.generic.CanBuildFrom[List[net.liftweb.http.AnswerRender],net.liftweb.http.js.JsCmd,List[net.liftweb.http.js.JsCmd]])List[net.liftweb.http.js.JsCmd]">map</span> <span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,net.liftweb.http.js.JsCmd,List[net.liftweb.http.js.JsCmd]]" class="delimiter">{</span>
      <a title="net.liftweb.http.AnswerRender" id="385990">ar</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="net.liftweb.http.js.JsCmd" id="385991">ret</a> = <a href="#385990" title="net.liftweb.http.AnswerRender">ar</a>.<a href="CometActor.scala.html#326437" title="=&gt; net.liftweb.http.XmlOrJsCmd">response</a>.<a href="CometActor.scala.html#326486" title="(session: net.liftweb.http.LiftSession, displayAll: Boolean)net.liftweb.http.js.JsCmd">toJavaScript</a><span class="delimiter">(</span><a href="#385683" title="net.liftweb.http.LiftSession">session</a>, <a href="#385990" title="net.liftweb.http.AnswerRender">ar</a>.<a href="CometActor.scala.html#326443" title="=&gt; Boolean">displayAll</a><span class="delimiter">)</span>

        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49475" title="=&gt; Map[String,net.liftweb.http.S.AFuncHolder]">functionMap</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#385683" title="net.liftweb.http.LiftSession">session</a>.<a href="LiftSession.scala.html#230223" title="(funcs: Map[String,net.liftweb.http.S.AFuncHolder], uniqueId: String, when: Long)Unit">updateFunctionMap</a><span class="delimiter">(</span><a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49475" title="=&gt; Map[String,net.liftweb.http.S.AFuncHolder]">functionMap</a>,
            <a href="#385990" title="net.liftweb.http.AnswerRender">ar</a>.<a href="CometActor.scala.html#326439" title="=&gt; net.liftweb.http.LiftCometActor">who</a>.<a href="CometActor.scala.html#325343" title="=&gt; String">uniqueId</a>, <a href="#385990" title="net.liftweb.http.AnswerRender">ar</a>.<a href="CometActor.scala.html#326441" title="=&gt; Long">when</a><span class="delimiter">)</span>
          <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49479" title="=&gt; Unit">clearFunctionMap</a>
        <span class="delimiter">}</span>

        <a href="#385991" title="net.liftweb.http.js.JsCmd">ret</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <a href="#385685" title="List[(net.liftweb.http.LiftCometActor, Long)]">actors</a> <span title="(f: (net.liftweb.http.LiftCometActor, Long) =&gt; Unit)Unit">foreach</span> <span class="delimiter">(</span><a href="#386039" title="(net.liftweb.http.LiftCometActor, Long)">_</a>.<span title="=&gt; net.liftweb.http.LiftCometActor">_1</span> <a href="../../../../common/net/liftweb/common/SimpleActor.scala.html#29491" title="(param: Any)Unit">!</a> <a href="CometActor.scala.html#14148" title="object net.liftweb.http.ClearNotices">ClearNotices</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="List[net.liftweb.http.js.JsCmd]" id="385932">addl</a>: <span title="List[net.liftweb.http.js.JsCmd]">List</span><span class="delimiter">[</span>JsCmd<span class="delimiter">]</span> =
      <span class="delimiter">(</span><span class="keyword">for</span> <span class="delimiter">{</span>
        <a title="net.liftweb.http.Req" id="386046">req</a> &lt;- <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27023" title="(f: net.liftweb.http.Req =&gt; net.liftweb.common.Box[List[net.liftweb.http.js.JsCmd]])net.liftweb.common.Box[List[net.liftweb.http.js.JsCmd]]">request</a>
        <a title="String" id="386055">rendVer</a> &lt;- <a href="#379386" title="(in: List[String])net.liftweb.common.Box[String]">extractRenderVersion</a><a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: String =&gt; List[net.liftweb.http.js.JsCmd])net.liftweb.common.Box[List[net.liftweb.http.js.JsCmd]]" class="delimiter">(</a><a href="#386046" title="net.liftweb.http.Req">req</a>.<a href="Req.scala.html#149137" title="=&gt; net.liftweb.http.ParsePath">path</a>.<a href="Req.scala.html#216847" title="=&gt; List[String]">partPath</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="LiftSession.scala.html#14488" title="object net.liftweb.http.RenderVersion">RenderVersion</a>.<a href="LiftSession.scala.html#345565" title="(v: String)(f: =&gt; List[net.liftweb.http.js.JsCmd])List[net.liftweb.http.js.JsCmd]">doWith</a><span class="delimiter">(</span><a href="#386055" title="String">rendVer</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49340" title="()List[net.liftweb.http.js.JsCmd]">jsToAppend</a>
        <span class="delimiter">}</span><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; List[net.liftweb.http.js.JsCmd])List[net.liftweb.http.js.JsCmd]">openOr</a> <span title="object Nil">Nil</span>

    <span class="delimiter">(</span><span title="net.liftweb.http.js.JsCommands" class="keyword">new</span> <a href="js/JsCommands.scala.html#14901" title="net.liftweb.http.js.JsCommands">JsCommands</a><span class="delimiter">(</span><a href="js/JsCommands.scala.html#14916" title="object net.liftweb.http.js.JsCmds">JsCmds</a>.<a href="js/JsCommands.scala.html#196384" title="(text: String)net.liftweb.http.js.JsCmds.Run">Run</a><span class="delimiter">(</span><a href="#385930" title="String">jsUpdateTime</a><span class="delimiter">)</span> <a href="#386080" title="(x: net.liftweb.http.js.JsCmd)List[net.liftweb.http.js.JsCmd]">::</a> <a href="#385931" title="List[net.liftweb.http.js.JsCmd]">jsUpdateStuff</a> <a href="#386082" title="(prefix: List[net.liftweb.http.js.JsCmd])List[net.liftweb.http.js.JsCmd]">:::</a> <a href="#385932" title="List[net.liftweb.http.js.JsCmd]">addl</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="js/JsCommands.scala.html#381182" title="=&gt; net.liftweb.http.InMemoryResponse">toResponse</a>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(in: List[String])net.liftweb.common.Box[String]" id="379386">extractRenderVersion</a><span class="delimiter">(</span><a title="List[String]" id="386047">in</a>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[String]">Box</a><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="#386047" title="List[String]">in</a> <span title="net.liftweb.common.Box[String]" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="net.liftweb.common.Full[String]">_</span> :: _ :: _ :: <a title="String" id="386111">rv</a> :: _ =&gt; <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: String)net.liftweb.common.Full[String]">Full</a><span class="delimiter">(</span><a href="#386111" title="String">rv</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <span title="net.liftweb.common.Empty.type">_</span> =&gt; <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(request: net.liftweb.http.Req, session: net.liftweb.http.LiftSession, actors: List[(net.liftweb.http.LiftCometActor, Long)], originalRequest: net.liftweb.http.Req)() =&gt; net.liftweb.common.Box[net.liftweb.http.LiftResponse]" id="379387">handleNonContinuationComet</a><span class="delimiter">(</span><a title="net.liftweb.http.Req" id="385923">request</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a>, <a title="net.liftweb.http.LiftSession" id="385924">session</a>: <a href="LiftSession.scala.html#14496" title="net.liftweb.http.LiftSession">LiftSession</a>, <a title="List[(net.liftweb.http.LiftCometActor, Long)]" id="385925">actors</a>: <span title="List[(net.liftweb.http.LiftCometActor, Long)]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>LiftCometActor, Long<span class="delimiter">)</span><span class="delimiter">]</span>,
                                         <a title="net.liftweb.http.Req" id="385926">originalRequest</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a><span class="delimiter">)</span>: <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Box<span class="delimiter">[</span>LiftResponse<span class="delimiter">]</span> = <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="net.liftweb.actor.LAFuture[List[net.liftweb.http.AnswerRender]]" id="386116">f</a> = <span title="net.liftweb.actor.LAFuture[List[net.liftweb.http.AnswerRender]]" class="keyword">new</span> <a href="../../../../actor/net/liftweb/actor/LAFuture.scala.html#10526" title="net.liftweb.actor.LAFuture[List[net.liftweb.http.AnswerRender]]">LAFuture</a><span class="delimiter">[</span>List<span class="delimiter">[</span>AnswerRender<span class="delimiter">]</span><span class="delimiter">]</span>
    <span class="keyword">val</span> <a title="LiftServlet.this.ContinuationActor" id="386117">cont</a> = <span title="LiftServlet.this.ContinuationActor" class="keyword">new</span> <a href="#379378" title="LiftServlet.this.ContinuationActor">ContinuationActor</a><span class="delimiter">(</span><a href="#385923" title="net.liftweb.http.Req">request</a>, <a href="#385924" title="net.liftweb.http.LiftSession">session</a>, <a href="#385925" title="List[(net.liftweb.http.LiftCometActor, Long)]">actors</a>,
      <a title="List[net.liftweb.http.AnswerRender]" id="386119">answers</a> =&gt; <a href="#386116" title="net.liftweb.actor.LAFuture[List[net.liftweb.http.AnswerRender]]">f</a>.<a href="../../../../actor/net/liftweb/actor/LAFuture.scala.html#15444" title="(value: List[net.liftweb.http.AnswerRender])Unit">satisfy</a><span class="delimiter">(</span><a href="#386119" title="List[net.liftweb.http.AnswerRender]">answers</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#386117" title="LiftServlet.this.ContinuationActor">cont</a> <a href="../../../../actor/net/liftweb/actor/LiftActor.scala.html#29502" title="(msg: Any)Unit">!</a> <a href="#379379" title="object LiftServlet.this.BeginContinuation">BeginContinuation</a>

      <a href="#385924" title="net.liftweb.http.LiftSession">session</a>.<a href="LiftSession.scala.html#230214" title="(what: (net.liftweb.actor.LiftActor, net.liftweb.http.Req))Unit">enterComet</a><span class="delimiter">(</span><a href="#386117" title="(x: LiftServlet.this.ContinuationActor)ArrowAssoc[LiftServlet.this.ContinuationActor]">cont</a> <span title="(y: net.liftweb.http.Req)(LiftServlet.this.ContinuationActor, net.liftweb.http.Req)">-&gt;</span> <a href="#385923" title="net.liftweb.http.Req">request</a><span class="delimiter">)</span>

      <a href="../../../../actor/net/liftweb/actor/LAPinger.scala.html#10537" title="object net.liftweb.actor.LAPinger">LAPinger</a>.<a href="../../../../actor/net/liftweb/actor/LAPinger.scala.html#29297" title="(to: net.liftweb.actor.SpecializedLiftActor[Any], msg: Any, delay: Long)java.util.concurrent.ScheduledFuture[Unit]">schedule</a><span class="delimiter">(</span><a href="#386117" title="LiftServlet.this.ContinuationActor">cont</a>, <a href="LiftRules.scala.html#357618" title="()net.liftweb.http.BreakOut">BreakOut</a><span class="delimiter">(</span><span class="delimiter">)</span>, <a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#188664" title="(in: Long)net.liftweb.util.Helpers.TimeSpan">TimeSpan</a><a href="../../../../util/net/liftweb/util/TimeHelpers.scala.html#188674" title="implicit net.liftweb.util.ConvertableToDate.toMillis : (in: net.liftweb.util.ConvertableToDate)Long" class="delimiter">(</a><a href="#379381" title="=&gt; Long">cometTimeout</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="List[net.liftweb.http.AnswerRender]" id="386121">ret2</a> = <a href="#386116" title="net.liftweb.actor.LAFuture[List[net.liftweb.http.AnswerRender]]">f</a>.<a href="../../../../actor/net/liftweb/actor/LAFuture.scala.html#15447" title="(timeout: Long)net.liftweb.common.Box[List[net.liftweb.http.AnswerRender]]">get</a><span class="delimiter">(</span><a href="#379381" title="=&gt; Long">cometTimeout</a><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; List[net.liftweb.http.AnswerRender])List[net.liftweb.http.AnswerRender]">openOr</a> <span title="object Nil">Nil</span>

      <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.LiftResponse)net.liftweb.common.Full[net.liftweb.http.LiftResponse]">Full</a><span class="delimiter">(</span><a href="S.scala.html#14641" title="object net.liftweb.http.S">S</a>.<a href="S.scala.html#49376" title="(request: net.liftweb.http.Req, session: net.liftweb.http.LiftSession)(f: =&gt; net.liftweb.http.LiftResponse)net.liftweb.http.LiftResponse">init</a><span class="delimiter">(</span><a href="#385926" title="net.liftweb.http.Req">originalRequest</a>, <a href="#385924" title="net.liftweb.http.LiftSession">session</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#379385" title="(session: net.liftweb.http.LiftSession, ret: Seq[net.liftweb.http.AnswerRender], actors: List[(net.liftweb.http.LiftCometActor, Long)])net.liftweb.http.LiftResponse">convertAnswersToCometResponse</a><span class="delimiter">(</span><a href="#385924" title="net.liftweb.http.LiftSession">session</a>, <a href="#386121" title="List[net.liftweb.http.AnswerRender]">ret2</a>, <a href="#385925" title="List[(net.liftweb.http.LiftCometActor, Long)]">actors</a><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#385924" title="net.liftweb.http.LiftSession">session</a>.<a href="LiftSession.scala.html#230215" title="(what: net.liftweb.actor.LiftActor)Unit">exitComet</a><span class="delimiter">(</span><a href="#386117" title="LiftServlet.this.ContinuationActor">cont</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">val</span> <a title="Boolean" id="379388">dumpRequestResponse</a> = <a href="../../../../util/net/liftweb/util/Props.scala.html#13579" title="object net.liftweb.util.Props">Props</a>.<a href="../../../../util/net/liftweb/util/Props.scala.html#151304" title="(name: String, defVal: Boolean)Boolean">getBool</a><span class="delimiter">(</span><span title="java.lang.String(&quot;dump.request.response&quot;)" class="string">&quot;dump.request.response&quot;</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(request: net.liftweb.http.Req, response: net.liftweb.http.BasicResponse)Unit" id="379390">logIfDump</a><span class="delimiter">(</span><a title="net.liftweb.http.Req" id="386170">request</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a>, <a title="net.liftweb.http.BasicResponse" id="386171">response</a>: <a href="LiftResponse.scala.html#14273" title="net.liftweb.http.BasicResponse">BasicResponse</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#379388" title="=&gt; Boolean">dumpRequestResponse</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.lang.String" id="386173">toDump</a> = <a href="#386170" title="net.liftweb.http.Req">request</a>.<a href="Req.scala.html#149224" title="=&gt; String">uri</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span>
        <a href="#386170" title="net.liftweb.http.Req">request</a>.<a href="Req.scala.html#149194" title="=&gt; Map[String,List[String]]">params</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span>
        <a href="#386171" title="net.liftweb.http.BasicResponse">response</a>.<a href="LiftResponse.scala.html#351634" title="=&gt; List[(String, String)]">headers</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span>
        <span class="delimiter">(</span>
          <a href="#386171" title="net.liftweb.http.BasicResponse">response</a> <span title="Any" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="java.lang.String">InMemoryResponse</span><span class="delimiter">(</span><a title="Array[Byte]" id="386174">data</a>, _, _, _<span class="delimiter">)</span> =&gt; <span title="(x$1: Array[Byte], x$2: java.lang.String)java.lang.String" class="keyword">new</span> <span title="java.lang.String">String</span><span class="delimiter">(</span><a href="#386174" title="Array[Byte]">data</a>, <span title="java.lang.String(&quot;UTF-8&quot;)" class="string">&quot;UTF-8&quot;</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <span title="java.lang.String(&quot;data&quot;)">_</span> =&gt; <span title="java.lang.String(&quot;data&quot;)" class="string">&quot;data&quot;</span>
          <span class="delimiter">}</span>
          <span class="delimiter">)</span>

      <a href="../../../../common/net/liftweb/common/Logging.scala.html#19845" title="=&gt; net.liftweb.common.Logger">logger</a>.<a href="../../../../common/net/liftweb/common/Logging.scala.html#31936" title="(msg: =&gt; AnyRef)Unit">trace</a><span class="delimiter">(</span><a href="#386173" title="java.lang.String">toDump</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Sends the  { @code HTTPResponse } to the browser using data from the
   * { @link Response } and  { @link Req }.
   */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>http<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(liftResp: net.liftweb.http.LiftResponse, response: net.liftweb.http.provider.HTTPResponse, request: net.liftweb.http.Req)Unit" id="379391">sendResponse</a><span class="delimiter">(</span><a title="net.liftweb.http.LiftResponse" id="379723">liftResp</a>: <a href="LiftResponse.scala.html#14269" title="net.liftweb.http.LiftResponse">LiftResponse</a>, <a title="net.liftweb.http.provider.HTTPResponse" id="379724">response</a>: <a href="provider/HTTPResponse.scala.html#15087" title="net.liftweb.http.provider.HTTPResponse">HTTPResponse</a>, <a title="net.liftweb.http.Req" id="379725">request</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(headers: List[(String, String)])List[(String, String)]" id="386184">fixHeaders</a><span class="delimiter">(</span><a title="List[(String, String)]" id="386190">headers</a>: <span title="List[(String, String)]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>String, String<span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#386190" title="List[(String, String)]">headers</a> <span title="(f: (String, String) =&gt; (String, String))(implicit bf: scala.collection.generic.CanBuildFrom[List[(String, String)],(String, String),List[(String, String)]])List[(String, String)]">map</span> <span class="delimiter">(</span><span class="delimiter">(</span><a title="(String, String)" id="386207">v</a><span class="delimiter">)</span> =&gt; <a href="#386207" title="(String, String)">v</a> <span title="(String, String)" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="(String, String)" class="delimiter">(</span><span title="java.lang.String(&quot;Location&quot;)" class="string">&quot;Location&quot;</span>, <a title="String" id="386210">uri</a><span class="delimiter">)</span> =&gt;
        <span class="keyword">val</span> <a title="net.liftweb.http.Req" id="386211">u</a> = <a href="#379725" title="net.liftweb.http.Req">request</a>
        <span title="(_1: String, _2: String)(String, String)" class="delimiter">(</span><a href="#386207" title="(String, String)">v</a>.<span title="=&gt; String">_1</span>, <span class="delimiter">(</span>
          <span class="delimiter">(</span><span class="keyword">for</span> <span class="delimiter">(</span>
            <a title="java.lang.String" id="386235">updated</a> &lt;- <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: java.lang.String)net.liftweb.common.Full[java.lang.String]">Full</a><span class="delimiter">(</span><span class="delimiter">(</span><span title="String" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159034" title="=&gt; net.liftweb.http.LiftRules#FactoryMaker[java.lang.String =&gt; Boolean]">excludePathFromContextPathRewriting</a>.<a href="Factory.scala.html#159330" title="(v1: java.lang.String)Boolean">vend</a><span class="delimiter">(</span><a href="#386210" title="String">uri</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#386211" title="net.liftweb.http.Req">u</a>.<a href="Req.scala.html#149139" title="=&gt; String">contextPath</a> <span class="keyword">else</span> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#386210" title="String">uri</a><span class="delimiter">)</span>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27114" title="(p: java.lang.String =&gt; Boolean)net.liftweb.common.Box[java.lang.String]">filter</a><a href="../../../../common/net/liftweb/common/Box.scala.html#27023" title="(f: java.lang.String =&gt; net.liftweb.common.Box[String])net.liftweb.common.Box[String]" class="delimiter">(</a><a title="java.lang.String" id="386228">ignore</a> =&gt; <a href="#386210" title="String">uri</a>.<span title="(x$1: java.lang.String)Boolean">startsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>;
            <a title="String =&gt; String" id="386240">rwf</a> &lt;- <a href="Req.scala.html#14583" title="object net.liftweb.http.URLRewriter">URLRewriter</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: String =&gt; String =&gt; String)net.liftweb.common.Box[String]">rewriteFunc</a><span class="delimiter">)</span> <span class="keyword">yield</span> <a href="#386240" title="(v1: String)String">rwf</a><span class="delimiter">(</span><a href="#386235" title="java.lang.String">updated</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../../common/net/liftweb/common/Box.scala.html#27017" title="(default: =&gt; String)String">openOr</a> <a href="#386210" title="String">uri</a>
          <span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="(String, String)">_</span> =&gt; <a href="#386207" title="(String, String)">v</a>
    <span class="delimiter">}</span><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="(req: net.liftweb.http.Req)(net.liftweb.common.Box[net.liftweb.http.Req], net.liftweb.common.Box[String])" id="386185">pairFromRequest</a><span class="delimiter">(</span><a title="net.liftweb.http.Req" id="386278">req</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a><span class="delimiter">)</span>: <span title="(net.liftweb.common.Box[net.liftweb.http.Req], net.liftweb.common.Box[String])" class="delimiter">(</span>Box<span class="delimiter">[</span>Req<span class="delimiter">]</span>, Box<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="net.liftweb.common.Box[String]" id="386279">acceptHeader</a> = <span class="keyword">for</span> <span class="delimiter">(</span><a title="net.liftweb.http.provider.HTTPRequest" id="386287">innerReq</a> &lt;- <a href="../../../../common/net/liftweb/common/Box.scala.html#10572" title="object net.liftweb.common.Box">Box</a>.<a href="../../../../common/net/liftweb/common/Box.scala.html#28633" title="(in: net.liftweb.http.provider.HTTPRequest)net.liftweb.common.Box[net.liftweb.http.provider.HTTPRequest]">legacyNullTest</a><a href="../../../../common/net/liftweb/common/Box.scala.html#27023" title="(f: net.liftweb.http.provider.HTTPRequest =&gt; net.liftweb.common.Box[String])net.liftweb.common.Box[String]" class="delimiter">(</a><a href="#386278" title="net.liftweb.http.Req">req</a>.<a href="Req.scala.html#149145" title="=&gt; net.liftweb.http.provider.HTTPRequest">request</a><span class="delimiter">)</span>;
                              <a title="String" id="386292">accept</a> &lt;- <a href="#386287" title="net.liftweb.http.provider.HTTPRequest">innerReq</a>.<a href="provider/HTTPRequest.scala.html#216864" title="(name: String)net.liftweb.common.Box[String]">header</a><a href="../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: String =&gt; String)net.liftweb.common.Box[String]" class="delimiter">(</a><span title="java.lang.String(&quot;Accept&quot;)" class="string">&quot;Accept&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">yield</span> <a href="#386292" title="String">accept</a>

      <span title="(_1: net.liftweb.common.Full[net.liftweb.http.Req], _2: net.liftweb.common.Box[String])(net.liftweb.common.Full[net.liftweb.http.Req], net.liftweb.common.Box[String])" class="delimiter">(</span><a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.Req)net.liftweb.common.Full[net.liftweb.http.Req]">Full</a><span class="delimiter">(</span><a href="#386278" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span>, <a href="#386279" title="net.liftweb.common.Box[String]">acceptHeader</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="net.liftweb.http.BasicResponse" id="386186">resp</a> = <a href="#379723" title="net.liftweb.http.LiftResponse">liftResp</a>.<a href="LiftResponse.scala.html#149429" title="=&gt; net.liftweb.http.BasicResponse">toResponse</a>

    <a href="#379390" title="(request: net.liftweb.http.Req, response: net.liftweb.http.BasicResponse)Unit">logIfDump</a><span class="delimiter">(</span><a href="#379725" title="net.liftweb.http.Req">request</a>, <a href="#386186" title="net.liftweb.http.BasicResponse">resp</a><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="(headers: List[(String, String)], toInsure: List[(String, String)])List[(String, String)]" id="386187">insureField</a><span class="delimiter">(</span><a title="List[(String, String)]" id="386304">headers</a>: <span title="List[(String, String)]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>String, String<span class="delimiter">)</span><span class="delimiter">]</span>, <a title="List[(String, String)]" id="386305">toInsure</a>: <span title="List[(String, String)]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>String, String<span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">)</span>: <span title="List[(String, String)]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>String, String<span class="delimiter">)</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.immutable.Map[String,String]" id="386306">org</a> = <span title="(elems: (String, String)*)scala.collection.immutable.Map[String,String]">Map</span><span class="delimiter">(</span><a href="#386304" title="List[(String, String)]">headers</a>: _*<span class="delimiter">)</span>

      <a href="#386305" title="List[(String, String)]">toInsure</a>.<span title="(z: scala.collection.immutable.Map[String,String])(f: (scala.collection.immutable.Map[String,String], (String, String)) =&gt; scala.collection.immutable.Map[String,String])scala.collection.immutable.Map[String,String]">foldLeft</span><span class="delimiter">(</span><a href="#386306" title="scala.collection.immutable.Map[String,String]">org</a><span class="delimiter">)</span> <a href="#386328" title="scala.collection.immutable.Map[String,String]" class="delimiter">{</a>
        <span class="keyword">case</span> <span title="scala.collection.immutable.Map[String,String]" class="delimiter">(</span><a title="scala.collection.immutable.Map[String,String]" id="386338">map</a>, <span class="delimiter">(</span><a title="String" id="386341">key</a>, <a title="String" id="386342">value</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
          <span title="scala.collection.immutable.Map[String,String]" class="keyword">if</span> <span class="delimiter">(</span><a href="#386338" title="scala.collection.immutable.Map[String,String]">map</a>.<span title="(key: String)Boolean">contains</span><span class="delimiter">(</span><a href="#386341" title="String">key</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#386338" title="scala.collection.immutable.Map[String,String]">map</a>
          <span class="keyword">else</span> <a href="#386338" title="scala.collection.immutable.Map[String,String]">map</a> <span title="(kv: (String, String))scala.collection.immutable.Map[String,String]">+</span> <span class="delimiter">(</span><a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#49003" title="implicit net.liftweb.util.BindHelpers.strToSuperArrowAssoc : (in: String)net.liftweb.util.Helpers.SuperArrowAssoc">key</a> <a href="../../../../util/net/liftweb/util/BindHelpers.scala.html#58380" title="(in: String)net.liftweb.util.Helpers.TheStrBindParam">-&gt;</a> <a href="#386342" title="String">value</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>.<span title="=&gt; List[(String, String)]">toList</span>

    <span class="delimiter">}</span>


    <span class="keyword">val</span> <a title="Long" id="386188">len</a> = <a href="#386186" title="net.liftweb.http.BasicResponse">resp</a>.<a href="LiftResponse.scala.html#351637" title="=&gt; Long">size</a>
    <span class="comment">// insure that certain header fields are set</span>
    <span class="keyword">val</span> <a title="List[(String, String)]" id="386189">header</a> = <span title="List[(String, String)]" class="keyword">if</span> <span class="delimiter">(</span><a href="#386186" title="net.liftweb.http.BasicResponse">resp</a>.<a href="LiftResponse.scala.html#351636" title="=&gt; Int">code</a> <span title="(x: Int)Boolean">==</span> <span title="Int(304)" class="int">304</span> <span title="(x: Boolean)Boolean">||</span> <a href="#386186" title="net.liftweb.http.BasicResponse">resp</a>.<a href="LiftResponse.scala.html#351636" title="=&gt; Int">code</a> <span title="(x: Int)Boolean">==</span> <span title="Int(303)" class="int">303</span><span class="delimiter">)</span>
      <a href="#386184" title="(headers: List[(String, String)])List[(String, String)]">fixHeaders</a><span class="delimiter">(</span><a href="#386186" title="net.liftweb.http.BasicResponse">resp</a>.<a href="LiftResponse.scala.html#351634" title="=&gt; List[(String, String)]">headers</a><span class="delimiter">)</span>
    <span class="keyword">else</span>
      <a href="#386187" title="(headers: List[(String, String)], toInsure: List[(String, String)])List[(String, String)]">insureField</a><span class="delimiter">(</span><a href="#386184" title="(headers: List[(String, String)])List[(String, String)]">fixHeaders</a><span class="delimiter">(</span><a href="#386186" title="net.liftweb.http.BasicResponse">resp</a>.<a href="LiftResponse.scala.html#351634" title="=&gt; List[(String, String)]">headers</a><span class="delimiter">)</span>,
        <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159119" title="(v1: (scala.xml.NodeSeq, net.liftweb.http.Req))List[(String, String)]">defaultHeaders</a><span class="delimiter">(</span><span title="object scala.xml.NodeSeq">NodeSeq</span>.<span title="(x: scala.xml.NodeSeq)ArrowAssoc[scala.xml.NodeSeq]">Empty</span> <span title="(y: net.liftweb.http.Req)(scala.xml.NodeSeq, net.liftweb.http.Req)">-&gt;</span> <a href="#379725" title="net.liftweb.http.Req">request</a><span class="delimiter">)</span> <a href="#386462" title="(prefix: List[(java.lang.String, java.lang.String)])List[(java.lang.String, java.lang.String)]">:::</a>
          <span class="comment">/* List((&quot;Content-Type&quot;,
        LiftRules.determineContentType(pairFromRequest(request)))) ::: */</span>
          <span class="delimiter">(</span><span title="List[(java.lang.String, java.lang.String)]" class="keyword">if</span> <span class="delimiter">(</span><a href="#386188" title="Long">len</a> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span title="(xs: (java.lang.String, java.lang.String)*)List[(java.lang.String, java.lang.String)]">List</span><span class="delimiter">(</span><span title="(_1: java.lang.String, _2: java.lang.String)(java.lang.String, java.lang.String)" class="delimiter">(</span><span title="java.lang.String(&quot;Content-Length&quot;)" class="string">&quot;Content-Length&quot;</span>, <a href="#386188" title="Long">len</a>.<span title="()java.lang.String">toString</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">else</span> <span title="object Nil">Nil</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158844" title="=&gt; net.liftweb.http.LiftRules#RulesSeq[(net.liftweb.http.BasicResponse, net.liftweb.http.provider.HTTPResponse, List[(java.lang.String, java.lang.String)], net.liftweb.common.Box[net.liftweb.http.Req]) =&gt; Any]">beforeSend</a>.<a href="LiftRules.scala.html#185552" title="=&gt; List[(net.liftweb.http.BasicResponse, net.liftweb.http.provider.HTTPResponse, List[(java.lang.String, java.lang.String)], net.liftweb.common.Box[net.liftweb.http.Req]) =&gt; Any]">toList</a>.<span title="(f: (net.liftweb.http.BasicResponse, net.liftweb.http.provider.HTTPResponse, List[(java.lang.String, java.lang.String)], net.liftweb.common.Box[net.liftweb.http.Req]) =&gt; Any =&gt; net.liftweb.common.Box[Any])Unit">foreach</span><span class="delimiter">(</span><a title="(net.liftweb.http.BasicResponse, net.liftweb.http.provider.HTTPResponse, List[(java.lang.String, java.lang.String)], net.liftweb.common.Box[net.liftweb.http.Req]) =&gt; Any" id="386539">f</a> =&gt; <a href="../../../../util/net/liftweb/util/ControlHelpers.scala.html#48608" title="(f: =&gt; Any)net.liftweb.common.Box[Any]">tryo</a><span class="delimiter">(</span><a href="#386539" title="(v1: net.liftweb.http.BasicResponse, v2: net.liftweb.http.provider.HTTPResponse, v3: List[(java.lang.String, java.lang.String)], v4: net.liftweb.common.Box[net.liftweb.http.Req])Any">f</a><span class="delimiter">(</span><a href="#386186" title="net.liftweb.http.BasicResponse">resp</a>, <a href="#379724" title="net.liftweb.http.provider.HTTPResponse">response</a>, <a href="#386189" title="List[(String, String)]">header</a>, <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.Req)net.liftweb.common.Full[net.liftweb.http.Req]">Full</a><span class="delimiter">(</span><a href="#379725" title="net.liftweb.http.Req">request</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="comment">// set the cookies</span>
    <a href="#379724" title="net.liftweb.http.provider.HTTPResponse">response</a>.<a href="provider/HTTPResponse.scala.html#364964" title="(cookies: List[net.liftweb.http.provider.HTTPCookie])Unit">addCookies</a><span class="delimiter">(</span><a href="#386186" title="net.liftweb.http.BasicResponse">resp</a>.<a href="LiftResponse.scala.html#351635" title="=&gt; List[net.liftweb.http.provider.HTTPCookie]">cookies</a><span class="delimiter">)</span>

    <span class="comment">// send the response</span>
    <a href="#379724" title="net.liftweb.http.provider.HTTPResponse">response</a>.<a href="provider/HTTPResponse.scala.html#364966" title="(headers: List[net.liftweb.http.provider.HTTPParam])Unit">addHeaders</a><span class="delimiter">(</span><a href="#386189" title="List[(String, String)]">header</a>.<span title="(f: (String, String) =&gt; net.liftweb.http.provider.HTTPParam)(implicit bf: scala.collection.generic.CanBuildFrom[List[(String, String)],net.liftweb.http.provider.HTTPParam,List[net.liftweb.http.provider.HTTPParam]])List[net.liftweb.http.provider.HTTPParam]">map</span> <a href="#386615" title="net.liftweb.http.provider.HTTPParam" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="net.liftweb.http.provider.HTTPParam" class="delimiter">(</span><a title="String" id="386618">name</a>, <a title="String" id="386619">value</a><span class="delimiter">)</span> =&gt; <a href="provider/HTTPParam.scala.html#364987" title="(name: String, value: String)net.liftweb.http.provider.HTTPParam">HTTPParam</a><span class="delimiter">(</span><a href="#386618" title="String">name</a>, <a href="#386619" title="String">value</a><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
    <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159171" title="(v1: net.liftweb.http.provider.HTTPResponse)Unit">supplimentalHeaders</a><span class="delimiter">(</span><a href="#379724" title="net.liftweb.http.provider.HTTPResponse">response</a><span class="delimiter">)</span>

    <a href="#379723" title="net.liftweb.http.LiftResponse">liftResp</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Unit">ResponseWithReason</span><span class="delimiter">(</span>_, <a title="String" id="386660">reason</a><span class="delimiter">)</span> =&gt; <a href="#379724" title="net.liftweb.http.provider.HTTPResponse">response</a> <a href="provider/HTTPResponse.scala.html#364969" title="(status: Int, reason: String)Unit">setStatusWithReason</a> <span class="delimiter">(</span><a href="#386186" title="net.liftweb.http.BasicResponse">resp</a>.<a href="LiftResponse.scala.html#351636" title="=&gt; Int">code</a>, <a href="#386660" title="String">reason</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <a href="#379724" title="net.liftweb.http.provider.HTTPResponse">response</a> <a href="provider/HTTPResponse.scala.html#364967" title="(status: Int)Unit">setStatus</a> <a href="#386186" title="net.liftweb.http.BasicResponse">resp</a>.<a href="LiftResponse.scala.html#351636" title="=&gt; Int">code</a>
    <span class="delimiter">}</span>

    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#386186" title="net.liftweb.http.BasicResponse">resp</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="LiftResponse.scala.html#14277" title="Unit">EmptyResponse</a> =&gt;
        <span class="keyword">case</span> <span title="Unit">InMemoryResponse</span><span class="delimiter">(</span><a title="Array[Byte]" id="386664">bytes</a>, _, _, _<span class="delimiter">)</span> =&gt;
          <a href="#379724" title="net.liftweb.http.provider.HTTPResponse">response</a>.<a href="provider/HTTPResponse.scala.html#364970" title="=&gt; java.io.OutputStream">outputStream</a>.<span title="(x$1: Array[Byte])Unit">write</span><span class="delimiter">(</span><a href="#386664" title="Array[Byte]">bytes</a><span class="delimiter">)</span>
          <a href="#379724" title="net.liftweb.http.provider.HTTPResponse">response</a>.<a href="provider/HTTPResponse.scala.html#364970" title="=&gt; java.io.OutputStream">outputStream</a>.<span title="()Unit">flush</span><span class="delimiter">(</span><span class="delimiter">)</span>

        <span class="keyword">case</span> <span title="Unit">StreamingResponse</span><span class="delimiter">(</span><a title="http extends AnyRef" id="386670">stream</a>, <a title="() =&gt; Unit" id="386671">endFunc</a>, _, _, _, _<span class="delimiter">)</span> =&gt;
          <span class="keyword">try</span> <span class="delimiter">{</span>
            <span class="keyword">var</span> <a title="Int" id="386672">len</a> = <span title="Int(0)" class="int">0</span>
            <span class="keyword">val</span> <a title="Array[Byte]" id="386673">ba</a> = <span title="Array[Byte]" class="keyword">new</span> <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">(</span><span title="Int(8192)" class="int">8192</span><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="java.io.OutputStream" id="386674">os</a> = <a href="#379724" title="net.liftweb.http.provider.HTTPResponse">response</a>.<a href="provider/HTTPResponse.scala.html#364970" title="=&gt; java.io.OutputStream">outputStream</a>
            <a href="#386670" title="http extends AnyRef">stream</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <a title="Unit" id="386678">jio</a>: java.io.<span title="java.io.InputStream">InputStream</span> =&gt; <a href="#386672" title="Int">len</a> = <a href="#386678" title="java.io.InputStream">jio</a>.<span title="(x$1: Array[Byte])Int">read</span><span class="delimiter">(</span><a href="#386673" title="Array[Byte]">ba</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <a title="Unit" id="386696">stream</a> =&gt; <a href="#386672" title="Int">len</a> = <a href="#386696" title="http extends AnyRef">stream</a>.<span title="(buf: Array[Byte])Int">read</span><span class="delimiter">(</span><a href="#386673" title="Array[Byte]">ba</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#386672" title="Int">len</a> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#386675" title="()Unit" class="delimiter">{</a>
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#386672" title="Int">len</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#386674" title="java.io.OutputStream">os</a>.<span title="(x$1: Array[Byte], x$2: Int, x$3: Int)Unit">write</span><span class="delimiter">(</span><a href="#386673" title="Array[Byte]">ba</a>, <span title="Int(0)" class="int">0</span>, <a href="#386672" title="Int">len</a><span class="delimiter">)</span>
              <a href="#386670" title="http extends AnyRef">stream</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <a title="Unit" id="386707">jio</a>: java.io.<span title="java.io.InputStream">InputStream</span> =&gt; <a href="#386672" title="Int">len</a> = <a href="#386707" title="java.io.InputStream">jio</a>.<span title="(x$1: Array[Byte])Int">read</span><span class="delimiter">(</span><a href="#386673" title="Array[Byte]">ba</a><span class="delimiter">)</span>
                <span class="keyword">case</span> <a title="Unit" id="386725">stream</a> =&gt; <a href="#386672" title="Int">len</a> = <a href="#386725" title="http extends AnyRef">stream</a>.<span title="(buf: Array[Byte])Int">read</span><span class="delimiter">(</span><a href="#386673" title="Array[Byte]">ba</a><span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>
            <a href="#379724" title="net.liftweb.http.provider.HTTPResponse">response</a>.<a href="provider/HTTPResponse.scala.html#364970" title="=&gt; java.io.OutputStream">outputStream</a>.<span title="()Unit">flush</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
            <a href="#386671" title="()Unit">endFunc</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>

        <span class="keyword">case</span> <span title="Unit">OutputStreamResponse</span><span class="delimiter">(</span><a title="java.io.OutputStream =&gt; Unit" id="386727">out</a>, _, _, _, _<span class="delimiter">)</span> =&gt;
          <a href="#386727" title="(v1: java.io.OutputStream)Unit">out</a><span class="delimiter">(</span><a href="#379724" title="net.liftweb.http.provider.HTTPResponse">response</a>.<a href="provider/HTTPResponse.scala.html#364970" title="=&gt; java.io.OutputStream">outputStream</a><span class="delimiter">)</span>
          <a href="#379724" title="net.liftweb.http.provider.HTTPResponse">response</a>.<a href="provider/HTTPResponse.scala.html#364970" title="=&gt; java.io.OutputStream">outputStream</a>.<span title="()Unit">flush</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Unit" id="386730">e</a>: java.io.<span title="java.io.IOException">IOException</span> =&gt; <span class="comment">// ignore IO exceptions... they happen</span>
    <span class="delimiter">}</span>

    <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#158892" title="=&gt; net.liftweb.http.LiftRules#RulesSeq[(net.liftweb.http.BasicResponse, net.liftweb.http.provider.HTTPResponse, List[(java.lang.String, java.lang.String)], net.liftweb.common.Box[net.liftweb.http.Req]) =&gt; Any]">afterSend</a>.<a href="LiftRules.scala.html#185552" title="=&gt; List[(net.liftweb.http.BasicResponse, net.liftweb.http.provider.HTTPResponse, List[(java.lang.String, java.lang.String)], net.liftweb.common.Box[net.liftweb.http.Req]) =&gt; Any]">toList</a>.<span title="(f: (net.liftweb.http.BasicResponse, net.liftweb.http.provider.HTTPResponse, List[(java.lang.String, java.lang.String)], net.liftweb.common.Box[net.liftweb.http.Req]) =&gt; Any =&gt; net.liftweb.common.Box[Any])Unit">foreach</span><span class="delimiter">(</span><a title="(net.liftweb.http.BasicResponse, net.liftweb.http.provider.HTTPResponse, List[(java.lang.String, java.lang.String)], net.liftweb.common.Box[net.liftweb.http.Req]) =&gt; Any" id="386758">f</a> =&gt; <a href="../../../../util/net/liftweb/util/ControlHelpers.scala.html#48608" title="(f: =&gt; Any)net.liftweb.common.Box[Any]">tryo</a><span class="delimiter">(</span><a href="#386758" title="(v1: net.liftweb.http.BasicResponse, v2: net.liftweb.http.provider.HTTPResponse, v3: List[(java.lang.String, java.lang.String)], v4: net.liftweb.common.Box[net.liftweb.http.Req])Any">f</a><span class="delimiter">(</span><a href="#386186" title="net.liftweb.http.BasicResponse">resp</a>, <a href="#379724" title="net.liftweb.http.provider.HTTPResponse">response</a>, <a href="#386189" title="List[(String, String)]">header</a>, <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: net.liftweb.http.Req)net.liftweb.common.Full[net.liftweb.http.Req]">Full</a><span class="delimiter">(</span><a href="#379725" title="net.liftweb.http.Req">request</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">import</span> provider.servlet._

<span class="keyword">class</span> <a title="class LiftFilter extends java.lang.Object with net.liftweb.http.provider.servlet.ServletFilterProvider with ScalaObject" id="14449">LiftFilter</a> <a href="#14449" title="ScalaObject" class="keyword">extends</a> <a href="provider/servlet/ServletFilterProvider.scala.html#15156" title="net.liftweb.http.provider.servlet.ServletFilterProvider">ServletFilterProvider</a>

<span class="keyword">private</span> <span class="keyword">class</span> <a title="class SessionIdCalc extends java.lang.Object with ScalaObject" id="14450">SessionIdCalc</a><a href="#14450" title="ScalaObject" class="delimiter">(</a><a title="net.liftweb.http.Req" id="380340">req</a>: <a href="Req.scala.html#14573" title="net.liftweb.http.Req">Req</a><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.lang.String" id="380336">CometPath</a> = <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159054" title="=&gt; java.lang.String">cometPath</a>
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="net.liftweb.common.Box[String]" id="380339">id</a>: <a href="../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[String]">Box</a><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="#380340" title="net.liftweb.http.Req">req</a>.<a href="Req.scala.html#149145" title="=&gt; net.liftweb.http.provider.HTTPRequest">request</a>.<a href="provider/HTTPRequest.scala.html#216878" title="=&gt; net.liftweb.common.Box[String]">sessionId</a> <span title="net.liftweb.common.Box[String]" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="net.liftweb.common.Full[String]">Full</span><span class="delimiter">(</span><a title="String" id="386848">id</a><span class="delimiter">)</span> =&gt; <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: String)net.liftweb.common.Full[String]">Full</a><span class="delimiter">(</span><a href="#386848" title="String">id</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <span title="net.liftweb.common.Box[String]">_</span> =&gt; <a href="#380340" title="net.liftweb.http.Req">req</a>.<a href="Req.scala.html#149137" title="=&gt; net.liftweb.http.ParsePath">path</a>.<a href="Req.scala.html#216857" title="=&gt; List[java.lang.String]">wholePath</a> <span title="net.liftweb.common.Box[String]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#380336" title="net.liftweb.common.Full[java.lang.String]">CometPath</a> :: _ :: <a title="java.lang.String" id="386866">id</a> :: _ <span class="keyword">if</span> <a href="#386866" title="java.lang.String">id</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="LiftRules.scala.html#158817" title="implicit net.liftweb.http.LiftRulesMocker.toLiftRules : (in: net.liftweb.http.LiftRulesMocker)net.liftweb.http.LiftRules">LiftRules</a>.<a href="LiftRules.scala.html#159230" title="()String">cometScriptName</a><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: java.lang.String)net.liftweb.common.Full[java.lang.String]">Full</a><span class="delimiter">(</span><a href="#386866" title="java.lang.String">id</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="net.liftweb.common.Empty.type">_</span> =&gt; <a href="../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>webkit/net/liftweb/http/auth/HttpAuthentication.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright 2007-2011 WorldWide Conferencing, LLC
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

<span class="keyword">package</span> net.liftweb
<span class="keyword">package</span> http
<span class="keyword">package</span> auth

<span class="keyword">import</span> net.liftweb.common._
<span class="keyword">import</span> net.liftweb.actor._
<span class="keyword">import</span> net.liftweb.util._
<span class="keyword">import</span> net.liftweb.util.<a href="../../../../../util/net/liftweb/util/Helpers.scala.html#13346" title="object net.liftweb.util.Helpers">Helpers</a>._
<span class="keyword">import</span> net.liftweb.http._
<span class="keyword">import</span> org.apache.commons.codec.binary._
<span class="keyword">import</span> scala.collection.mutable.<span class="delimiter">{</span>HashMap<span class="delimiter">}</span>

<span class="comment">/**
 * All http authentication methods must implement these methods.
 * The most important method to note here is the verified_? partial function
 * as this is what is used to then determine if the response specified in
 * the boot dispatcher is used or its a 401 response.
 *
 */</span>
<span class="keyword">trait</span> <a title="trait HttpAuthentication extends java.lang.Object with ScalaObject" id="14826">HttpAuthentication</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(r: net.liftweb.http.Req)net.liftweb.common.Box[String]" id="356905">header</a><span class="delimiter">(</span><a title="net.liftweb.http.Req" id="448625">r</a>: <a href="../Req.scala.html#14573" title="net.liftweb.http.Req">Req</a><span class="delimiter">)</span>: <a href="../../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[String]">Box</a><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="#448625" title="net.liftweb.http.Req">r</a>.<a href="../Req.scala.html#149145" title="=&gt; net.liftweb.http.provider.HTTPRequest">request</a>.<a href="../provider/HTTPRequest.scala.html#216864" title="(name: String)net.liftweb.common.Box[String]">header</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Authorization&quot;)" class="string">&quot;Authorization&quot;</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="=&gt; PartialFunction[net.liftweb.http.Req,Boolean]" id="356906">verified_?</a> : <span title="PartialFunction[net.liftweb.http.Req,Boolean]">PartialFunction</span><span class="delimiter">[</span>Req, Boolean<span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="=&gt; String" id="356907">realm</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>

  <span class="keyword">def</span> <a title="=&gt; net.liftweb.http.UnauthorizedResponse" id="356908">unauthorizedResponse</a>: <a href="../LiftResponse.scala.html#14228" title="net.liftweb.http.UnauthorizedResponse">UnauthorizedResponse</a> = <a href="../LiftResponse.scala.html#352174" title="(realm: String)net.liftweb.http.UnauthorizedResponse">UnauthorizedResponse</a><span class="delimiter">(</span><a href="#356907" title="=&gt; String">realm</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="=&gt; Unit" id="356909">shutDown</a> <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object net.liftweb.http.auth.NoAuthentication" id="14827">NoAuthentication</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#14826" title="net.liftweb.http.auth.HttpAuthentication">HttpAuthentication</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="=&gt; PartialFunction[net.liftweb.http.Req,Boolean]" id="357299">verified_?</a> = <a href="#448638" title="Boolean" class="delimiter">{</a><span class="keyword">case</span> <a title="Boolean(true)" id="448639">req</a> =&gt; <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object net.liftweb.http.auth.userRoles" id="14829">userRoles</a> <span title="ScalaObject" class="keyword">extends</span> <a href="../Vars.scala.html#14774" title="net.liftweb.http.RequestVar[List[net.liftweb.http.auth.Role]]">RequestVar</a><span class="delimiter">[</span>List<span class="delimiter">[</span>Role<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span title="object Nil">Nil</span><span class="delimiter">)</span>

<span class="comment">/**
 * Methods that are specific to HTTP basic are defined here.
 * The methods from the parent trait are implemented to decode the
 * Base64 encoded input from the http client.
 */</span>
case <span class="keyword">class</span> <a title="class HttpBasicAuthentication extends java.lang.Object with net.liftweb.http.auth.HttpAuthentication with ScalaObject with Product with Serializable" id="449806">HttpBasicAuthentication</a><a href="#449806" title="ScalaObject" class="delimiter">(</a><a title="String" id="449803">realmName</a>: <span title="String">String</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="PartialFunction[(String, String, net.liftweb.http.Req),Boolean]" id="449804">func</a>: <span title="PartialFunction[(String, String, net.liftweb.http.Req),Boolean]">PartialFunction</span><span class="delimiter">[</span><span class="delimiter">(</span>String, String, Req<span class="delimiter">)</span>, Boolean<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#14826" title="net.liftweb.http.auth.HttpAuthentication">HttpAuthentication</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(r: net.liftweb.http.Req)net.liftweb.common.Box[(String, String)]" id="448648">credentials</a><span class="delimiter">(</span><a title="net.liftweb.http.Req" id="448657">r</a>: <a href="../Req.scala.html#14573" title="net.liftweb.http.Req">Req</a><span class="delimiter">)</span>: <a href="../../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[(String, String)]">Box</a><span class="delimiter">[</span><span class="delimiter">(</span>String, String<span class="delimiter">)</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#356905" title="(r: net.liftweb.http.Req)net.liftweb.common.Box[String]">header</a><span class="delimiter">(</span><a href="#448657" title="net.liftweb.http.Req">r</a><span class="delimiter">)</span>.<a href="../../../../../common/net/liftweb/common/Box.scala.html#27023" title="(f: String =&gt; net.liftweb.common.Box[(String, String)])net.liftweb.common.Box[(String, String)]">flatMap</a><span class="delimiter">(</span><a title="String" id="448663">auth</a> =&gt; <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="List[java.lang.String]" id="448664">decoded</a> = <span title="(x$1: Array[Byte])java.lang.String" class="keyword">new</span> <span title="java.lang.String">String</span><span class="delimiter">(</span><span title="object org.apache.commons.codec.binary.Base64">Base64</span>.<span title="(x$1: Array[Byte])Array[Byte]">decodeBase64</span><span class="delimiter">(</span><a href="#448663" title="String">auth</a>.<span title="(x$1: Int, x$2: Int)java.lang.String">substring</span><span class="delimiter">(</span><span title="Int(6)" class="int">6</span>, <a href="#448663" title="String">auth</a>.<span title="()Int">length</span><span class="delimiter">)</span>.<span title="()Array[Byte]">getBytes</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(x$1: java.lang.String)Array[java.lang.String]">split</span><span title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">(</span><span title="java.lang.String(&quot;:&quot;)" class="string">&quot;:&quot;</span><span class="delimiter">)</span>.<span title="=&gt; List[java.lang.String]">toList</span>
      <a href="#448664" title="List[java.lang.String]">decoded</a> <span title="net.liftweb.common.Box[(String, String)]" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="net.liftweb.common.Full[(java.lang.String, java.lang.String)]" id="448788">userName</a> :: <a title="java.lang.String" id="448793">password</a> :: _ =&gt; <a href="../../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: (java.lang.String, java.lang.String))net.liftweb.common.Full[(java.lang.String, java.lang.String)]">Full</a><span class="delimiter">(</span><span title="(_1: java.lang.String, _2: java.lang.String)(java.lang.String, java.lang.String)" class="delimiter">(</span><a href="#448788" title="java.lang.String">userName</a>, <a href="#448793" title="java.lang.String">password</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="net.liftweb.common.Full[(java.lang.String, java.lang.String)]" id="448807">userName</a> :: <span title="object Nil">Nil</span> =&gt; <a href="../../../../../common/net/liftweb/common/Box.scala.html#27086" title="(value: (java.lang.String, java.lang.String))net.liftweb.common.Full[(java.lang.String, java.lang.String)]">Full</a><span class="delimiter">(</span><span title="(_1: java.lang.String, _2: java.lang.String)(java.lang.String, java.lang.String)" class="delimiter">(</span><a href="#448807" title="java.lang.String">userName</a>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="net.liftweb.common.Empty.type">_</span> =&gt; <a href="../../../../../common/net/liftweb/common/Box.scala.html#10581" title="object net.liftweb.common.Empty">Empty</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
      <span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; String" id="448649">realm</a> = <a href="#449803" title="=&gt; String">realmName</a>

  <span class="keyword">def</span> <a title="=&gt; PartialFunction[net.liftweb.http.Req,Boolean]" id="448650">verified_?</a> = <a href="#448825" title="Boolean" class="delimiter">{</a>
    <span class="keyword">case</span> <span title="Boolean" class="delimiter">(</span><a title="net.liftweb.http.Req" id="448826">req</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <a href="#448648" title="(r: net.liftweb.http.Req)net.liftweb.common.Box[(String, String)]">credentials</a><span class="delimiter">(</span><a href="#448826" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Boolean">Full</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="String" id="448830">user</a>, <a title="String" id="448831">pwd</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#449804" title="PartialFunction[(String, String, net.liftweb.http.Req),Boolean]">func</a>.<span title="(x: (String, String, net.liftweb.http.Req))Boolean">isDefinedAt</span><span title="(_1: String, _2: String, _3: net.liftweb.http.Req)(String, String, net.liftweb.http.Req)" class="delimiter">(</span><a href="#448830" title="String">user</a>, <a href="#448831" title="String">pwd</a>, <a href="#448826" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
          <a href="#449804" title="(v1: (String, String, net.liftweb.http.Req))Boolean">func</a><span title="(_1: String, _2: String, _3: net.liftweb.http.Req)(String, String, net.liftweb.http.Req)" class="delimiter">(</span><a href="#448830" title="String">user</a>, <a href="#448831" title="String">pwd</a>, <a href="#448826" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Boolean(false)">_</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

case <span class="keyword">class</span> <a title="class HttpDigestAuthentication extends java.lang.Object with net.liftweb.http.auth.HttpAuthentication with net.liftweb.common.Loggable with ScalaObject with Product with Serializable" id="449799">HttpDigestAuthentication</a><a href="#449799" title="ScalaObject" class="delimiter">(</a><a title="String" id="449796">realmName</a>: <span title="String">String</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="PartialFunction[(String, net.liftweb.http.Req, String =&gt; Boolean),Boolean]" id="449797">func</a>: <span title="PartialFunction[(String, net.liftweb.http.Req, String =&gt; Boolean),Boolean]">PartialFunction</span><span class="delimiter">[</span><span class="delimiter">(</span>String, Req, <span class="delimiter">(</span>String<span class="delimiter">)</span> =&gt; Boolean<span class="delimiter">)</span>, Boolean<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#14826" title="net.liftweb.http.auth.HttpAuthentication">HttpAuthentication</a> <span class="keyword">with</span> <a href="../../../../../common/net/liftweb/common/Logging.scala.html#10717" title="net.liftweb.common.Loggable">Loggable</a> <span class="delimiter">{</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[String,Long]" id="448907">nonceMap</a> = <span title="()scala.collection.mutable.HashMap[String,Long]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[String,Long]">HashMap</span><span class="delimiter">[</span>String, Long<span class="delimiter">]</span>

  <span class="keyword">private</span> <span class="keyword">object</span> <a title="object HttpDigestAuthentication.this.CheckAndPurge" id="448909">CheckAndPurge</a>
  <span class="keyword">private</span> <span class="keyword">object</span> <a title="object HttpDigestAuthentication.this.ShutDown" id="448911">ShutDown</a>

  <span class="keyword">object</span> <a title="object HttpDigestAuthentication.this.NonceWatcher" id="448913">NonceWatcher</a> <span title="ScalaObject" class="keyword">extends</span> <a href="../../../../../actor/net/liftweb/actor/LiftActor.scala.html#10558" title="net.liftweb.actor.LiftActor">LiftActor</a> <span class="delimiter">{</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <a title="Boolean" id="448935">keepPinging</a> = <span title="Boolean(true)" class="keyword">true</span>

    <span class="keyword">protected</span> <span class="keyword">def</span> <a title="=&gt; PartialFunction[Any,Unit]" id="448937">messageHandler</a> =
      <a href="#448945" title="Unit" class="delimiter">{</a>
        <span class="keyword">case</span> <a href="#448909" title="Unit">CheckAndPurge</a> =&gt;
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#448935" title="=&gt; Boolean">keepPinging</a><span class="delimiter">)</span> <a href="#448938" title="()Unit">doPing</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#448907" title="=&gt; scala.collection.mutable.HashMap[String,Long]">nonceMap</a>.<span title="(f: (String, Long) =&gt; Any)Unit">foreach</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="(String, Long)" id="448966">entry</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="Long" id="448967">ts</a> = <span title="object java.lang.System">System</span>.<span title="()Long">currentTimeMillis</span>
            <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#448967" title="Long">ts</a> <span title="(x: Long)Long">-</span> <a href="#448966" title="(String, Long)">entry</a>.<span title="=&gt; Long">_2</span><span class="delimiter">)</span> <span title="(x: Long)Boolean">&gt;</span> <a href="#448917" title="=&gt; Long">nonceValidityPeriod</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#448907" title="=&gt; scala.collection.mutable.HashMap[String,Long]">nonceMap</a> <span title="(key: String)HttpDigestAuthentication.this.nonceMap.type">-=</span> <a href="#448966" title="(String, Long)">entry</a>.<span title="=&gt; String">_1</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span><span class="delimiter">)</span>

        <span class="keyword">case</span> <a href="#448911" title="Unit">ShutDown</a> =&gt; <a href="#448935" title="(x$1: Boolean)Unit">keepPinging</a> = <span title="Boolean(false)" class="keyword">false</span>
      <span class="delimiter">}</span>


    <span class="keyword">private</span><span class="delimiter">[</span>auth<span class="delimiter">]</span> <span class="keyword">def</span> <a title="()Unit" id="448938">doPing</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="../../../../../util/net/liftweb/util/Schedule.scala.html#13609" title="object net.liftweb.util.Schedule">Schedule</a>.<a href="../../../../../util/net/liftweb/util/Schedule.scala.html#316905" title="(to: net.liftweb.common.SimpleActor[HttpDigestAuthentication.this.CheckAndPurge.type], msg: HttpDigestAuthentication.this.CheckAndPurge.type, delay: net.liftweb.util.Helpers.TimeSpan)java.util.concurrent.ScheduledFuture[Unit]">schedule</a> <span title="Unit" class="delimiter">(</span><span class="keyword">this</span>, <a href="#448909" title="object HttpDigestAuthentication.this.CheckAndPurge">CheckAndPurge</a>, <a href="../../../../../util/net/liftweb/util/TimeHelpers.scala.html#48777" title="implicit net.liftweb.util.TimeHelpers.intToTimeSpanBuilder : (in: Int)net.liftweb.util.Helpers.TimeSpanBuilder" class="int">5</a> <a href="../../../../../util/net/liftweb/util/TimeHelpers.scala.html#58471" title="=&gt; net.liftweb.util.Helpers.TimeSpan">seconds</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Unit" id="449023">e</a> =&gt; <a href="../../../../../common/net/liftweb/common/Logging.scala.html#19845" title="=&gt; net.liftweb.common.Logger">logger</a>.<a href="../../../../../common/net/liftweb/common/Logging.scala.html#31961" title="(msg: =&gt; AnyRef, t: Throwable)Unit">error</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Couldn\'t start NonceWatcher ping&quot;)" class="string">&quot;Couldn't start NonceWatcher ping&quot;</span>, <a href="#449023" title="java.lang.Throwable">e</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

  <span class="delimiter">}</span>

  <a href="#448913" title="object HttpDigestAuthentication.this.NonceWatcher">NonceWatcher</a>.<a href="#448938" title="()Unit">doPing</a><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Unit" id="448915">shutDown</a> = <a href="#448913" title="object HttpDigestAuthentication.this.NonceWatcher">NonceWatcher</a> <a href="../../../../../actor/net/liftweb/actor/LiftActor.scala.html#29502" title="(msg: Any)Unit">!</a> <a href="#448911" title="object HttpDigestAuthentication.this.ShutDown">ShutDown</a>

  <span class="keyword">def</span> <a title="(req: net.liftweb.http.Req)net.liftweb.common.Box[net.liftweb.http.auth.DigestAuthentication]" id="448916">getInfo</a><span class="delimiter">(</span><a title="net.liftweb.http.Req" id="449035">req</a>: <a href="../Req.scala.html#14573" title="net.liftweb.http.Req">Req</a><span class="delimiter">)</span>: <a href="../../../../../common/net/liftweb/common/Box.scala.html#10575" title="net.liftweb.common.Box[net.liftweb.http.auth.DigestAuthentication]">Box</a><span class="delimiter">[</span>DigestAuthentication<span class="delimiter">]</span> = <a href="#356905" title="(r: net.liftweb.http.Req)net.liftweb.common.Box[String]">header</a><span class="delimiter">(</span><a href="#449035" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span>.<a href="../../../../../common/net/liftweb/common/Box.scala.html#27020" title="(f: String =&gt; net.liftweb.http.auth.DigestAuthentication)net.liftweb.common.Box[net.liftweb.http.auth.DigestAuthentication]">map</a><span class="delimiter">(</span><a title="String" id="449073">auth</a> =&gt; <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="java.lang.String" id="449074">info</a> = <a href="#449073" title="String">auth</a>.<span title="(x$1: Int, x$2: Int)java.lang.String">substring</span><span class="delimiter">(</span><span title="Int(7)" class="int">7</span>, <a href="#449073" title="String">auth</a>.<span title="()Int">length</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Map[String,String]" id="449075">pairs</a> = <a href="../../../../../util/net/liftweb/util/StringHelpers.scala.html#48838" title="(props: String)Map[String,String]">splitNameValuePairs</a><span class="delimiter">(</span><a href="#449074" title="java.lang.String">info</a><span class="delimiter">)</span>
    <a href="#449792" title="(method: String, userName: String, realm: String, nonce: String, uri: String, qop: String, nc: String, cnonce: String, response: String, opaque: String)net.liftweb.http.auth.DigestAuthentication">DigestAuthentication</a><span class="delimiter">(</span><a href="#449035" title="net.liftweb.http.Req">req</a>.<a href="../Req.scala.html#149145" title="=&gt; net.liftweb.http.provider.HTTPRequest">request</a>.<a href="../provider/HTTPRequest.scala.html#216885" title="=&gt; String">method</a>.<span title="()java.lang.String">toUpperCase</span>, <a href="#449075" title="(key: String)String">pairs</a><span class="delimiter">(</span><span title="java.lang.String(&quot;username&quot;)" class="string">&quot;username&quot;</span><span class="delimiter">)</span>, <a href="#449075" title="(key: String)String">pairs</a><span class="delimiter">(</span><span title="java.lang.String(&quot;realm&quot;)" class="string">&quot;realm&quot;</span><span class="delimiter">)</span>, <a href="#449075" title="(key: String)String">pairs</a><span class="delimiter">(</span><span title="java.lang.String(&quot;nonce&quot;)" class="string">&quot;nonce&quot;</span><span class="delimiter">)</span>,
      <a href="#449075" title="(key: String)String">pairs</a><span class="delimiter">(</span><span title="java.lang.String(&quot;uri&quot;)" class="string">&quot;uri&quot;</span><span class="delimiter">)</span>, <a href="#449075" title="(key: String)String">pairs</a><span class="delimiter">(</span><span title="java.lang.String(&quot;qop&quot;)" class="string">&quot;qop&quot;</span><span class="delimiter">)</span>, <a href="#449075" title="(key: String)String">pairs</a><span class="delimiter">(</span><span title="java.lang.String(&quot;nc&quot;)" class="string">&quot;nc&quot;</span><span class="delimiter">)</span>,
      <a href="#449075" title="(key: String)String">pairs</a><span class="delimiter">(</span><span title="java.lang.String(&quot;cnonce&quot;)" class="string">&quot;cnonce&quot;</span><span class="delimiter">)</span>, <a href="#449075" title="(key: String)String">pairs</a><span class="delimiter">(</span><span title="java.lang.String(&quot;response&quot;)" class="string">&quot;response&quot;</span><span class="delimiter">)</span>, <a href="#449075" title="(key: String)String">pairs</a><span class="delimiter">(</span><span title="java.lang.String(&quot;opaque&quot;)" class="string">&quot;opaque&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
    <span class="delimiter">)</span>

  <span class="comment">/**
   * The period in milli seconds during which the nonce sent by server is valid. After this period
   * even if the auth digest matches correctly the authentication will fail.
   *
   * A useful usability would be to return something like &quot;5 seconds&quot; where seconds function is defined in TimeHelpers.
   * The default value returned is 30 seconds.
   *
   */</span>
  <span class="keyword">def</span> <a title="=&gt; Long" id="448917">nonceValidityPeriod</a>: <span title="Long">Long</span> = <a href="../../../../../util/net/liftweb/util/TimeHelpers.scala.html#48777" title="implicit net.liftweb.util.TimeHelpers.intToTimeSpanBuilder : (in: Int)net.liftweb.util.Helpers.TimeSpanBuilder" class="int">30</a> <a href="../../../../../util/net/liftweb/util/TimeHelpers.scala.html#188674" title="implicit net.liftweb.util.ConvertableToDate.toMillis : (in: net.liftweb.util.ConvertableToDate)Long">seconds</a>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; String" id="448918">realm</a> = <a href="#449796" title="=&gt; String">realmName</a>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; net.liftweb.http.UnauthorizedDigestResponse" id="448919">unauthorizedResponse</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="String" id="449272">nonce</a> = <a href="../../../../../util/net/liftweb/util/StringHelpers.scala.html#48846" title="(size: Int)String">randomString</a><span class="delimiter">(</span><span title="Int(64)" class="int">64</span><span class="delimiter">)</span>;
    <a href="#448907" title="=&gt; scala.collection.mutable.HashMap[String,Long]">nonceMap</a> <span title="(kv: (String, Long))HttpDigestAuthentication.this.nonceMap.type">+=</span> <span class="delimiter">(</span><a href="../../../../../util/net/liftweb/util/BindHelpers.scala.html#49003" title="implicit net.liftweb.util.BindHelpers.strToSuperArrowAssoc : (in: String)net.liftweb.util.Helpers.SuperArrowAssoc">nonce</a> <a href="../../../../../util/net/liftweb/util/BindHelpers.scala.html#58390" title="(in: Long)net.liftweb.util.Helpers.LongBindParam">-&gt;</a> <span title="object java.lang.System">System</span>.<span title="()Long">currentTimeMillis</span><span class="delimiter">)</span>
    <a href="../LiftResponse.scala.html#352232" title="(realm: String, qop: net.liftweb.http.Qop.Value, nonce: String, opaque: String)net.liftweb.http.UnauthorizedDigestResponse">UnauthorizedDigestResponse</a><span class="delimiter">(</span><a href="#448918" title="=&gt; String">realm</a>, <a href="../LiftResponse.scala.html#14231" title="object net.liftweb.http.Qop">Qop</a>.<a href="../LiftResponse.scala.html#352207" title="=&gt; net.liftweb.http.Qop.Value">AUTH</a>, <a href="#449272" title="String">nonce</a>, <a href="../../../../../util/net/liftweb/util/StringHelpers.scala.html#48846" title="(size: Int)String">randomString</a><span class="delimiter">(</span><span title="Int(64)" class="int">64</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; PartialFunction[net.liftweb.http.Req,Boolean]" id="448920">verified_?</a> = <a href="#449329" title="Boolean" class="delimiter">{</a>
    <span class="keyword">case</span> <span title="Boolean" class="delimiter">(</span><a title="net.liftweb.http.Req" id="449330">req</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <a href="#448916" title="(req: net.liftweb.http.Req)net.liftweb.common.Box[net.liftweb.http.auth.DigestAuthentication]">getInfo</a><span class="delimiter">(</span><a href="#449330" title="net.liftweb.http.Req">req</a><span class="delimiter">)</span> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Boolean">Full</span><span class="delimiter">(</span><a title="net.liftweb.http.auth.DigestAuthentication" id="449332">auth</a><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#449797" title="PartialFunction[(String, net.liftweb.http.Req, String =&gt; Boolean),Boolean]">func</a>.<span title="(x: (String, net.liftweb.http.Req, String =&gt; Boolean))Boolean">isDefinedAt</span><span class="delimiter">(</span><span title="(_1: String, _2: net.liftweb.http.Req, _3: String =&gt; Boolean)(String, net.liftweb.http.Req, String =&gt; Boolean)" class="delimiter">(</span><a href="#449332" title="net.liftweb.http.auth.DigestAuthentication">auth</a>.<a href="#449095" title="=&gt; String">userName</a>, <a href="#449330" title="net.liftweb.http.Req">req</a>, <a href="#448921" title="(clientAuth: net.liftweb.http.auth.DigestAuthentication)(password: String)Boolean">validate</a><a href="#449344" title="String" class="delimiter">(</a><a href="#449332" title="net.liftweb.http.auth.DigestAuthentication">auth</a><span class="delimiter">)</span> _<span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
          <a href="#449797" title="(v1: (String, net.liftweb.http.Req, String =&gt; Boolean))Boolean">func</a><span class="delimiter">(</span><span title="(_1: String, _2: net.liftweb.http.Req, _3: String =&gt; Boolean)(String, net.liftweb.http.Req, String =&gt; Boolean)" class="delimiter">(</span><a href="#449332" title="net.liftweb.http.auth.DigestAuthentication">auth</a>.<a href="#449095" title="=&gt; String">userName</a>, <a href="#449330" title="net.liftweb.http.Req">req</a>, <a href="#448921" title="(clientAuth: net.liftweb.http.auth.DigestAuthentication)(password: String)Boolean">validate</a><a href="#449356" title="String" class="delimiter">(</a><a href="#449332" title="net.liftweb.http.auth.DigestAuthentication">auth</a><span class="delimiter">)</span> _<span class="delimiter">)</span><span class="delimiter">)</span> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="Boolean" class="keyword">true</span> =&gt;
              <span class="keyword">val</span> <a title="Long" id="449360">ts</a> = <span title="object java.lang.System">System</span>.<span title="()Long">currentTimeMillis</span>
              <span class="keyword">val</span> <a title="Long" id="449361">nonceCreationTime</a>: <span title="Long">Long</span> = <a href="#448907" title="=&gt; scala.collection.mutable.HashMap[String,Long]">nonceMap</a>.<span title="(key: String, default: =&gt; Long)Long">getOrElse</span><span class="delimiter">(</span><a href="#449332" title="net.liftweb.http.auth.DigestAuthentication">auth</a>.<a href="#449097" title="=&gt; String">nonce</a>, -<span title="Long(-1L)" class="int">1</span><span class="delimiter">)</span>
              <a href="#449361" title="Long">nonceCreationTime</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <span title="Boolean(false)">-</span><span class="int">1</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
                <span class="keyword">case</span> <span title="Boolean">_</span> =&gt;
                  <span class="delimiter">(</span><a href="#449360" title="Long">ts</a> <span title="(x: Long)Long">-</span> <a href="#449361" title="Long">nonceCreationTime</a><span class="delimiter">)</span> <span title="(x: Long)Boolean">&lt;</span> <a href="#448917" title="=&gt; Long">nonceValidityPeriod</a>
              <span class="delimiter">}</span>
            <span class="keyword">case</span> <span title="Boolean(false)">_</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
          <span class="delimiter">}</span>
        <span class="keyword">case</span> <span title="Boolean(false)">_</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(clientAuth: net.liftweb.http.auth.DigestAuthentication)(password: String)Boolean" id="448921">validate</a><span class="delimiter">(</span><a title="net.liftweb.http.auth.DigestAuthentication" id="449340">clientAuth</a>: <a href="#449792" title="net.liftweb.http.auth.DigestAuthentication">DigestAuthentication</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="String" id="449341">password</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="String" id="449380">ha1</a> = <a href="../../../../../util/net/liftweb/util/SecurityHelpers.scala.html#48936" title="(in: Array[Byte])String">hexEncode</a><span class="delimiter">(</span><a href="../../../../../util/net/liftweb/util/SecurityHelpers.scala.html#48924" title="(in: Array[Byte])Array[Byte]">md5</a><span class="delimiter">(</span><span class="delimiter">(</span><a href="#449340" title="net.liftweb.http.auth.DigestAuthentication">clientAuth</a>.<a href="#449095" title="=&gt; String">userName</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;:&quot;)" class="string">&quot;:&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#449340" title="net.liftweb.http.auth.DigestAuthentication">clientAuth</a>.<a href="#449096" title="=&gt; String">realm</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;:&quot;)" class="string">&quot;:&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#449341" title="String">password</a><span class="delimiter">)</span>.<span title="(x$1: java.lang.String)Array[Byte]">getBytes</span><span class="delimiter">(</span><span title="java.lang.String(&quot;UTF-8&quot;)" class="string">&quot;UTF-8&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="String" id="449381">ha2</a> = <a href="../../../../../util/net/liftweb/util/SecurityHelpers.scala.html#48936" title="(in: Array[Byte])String">hexEncode</a><span class="delimiter">(</span><a href="../../../../../util/net/liftweb/util/SecurityHelpers.scala.html#48924" title="(in: Array[Byte])Array[Byte]">md5</a><span class="delimiter">(</span><span class="delimiter">(</span><a href="#449340" title="net.liftweb.http.auth.DigestAuthentication">clientAuth</a>.<a href="#449094" title="=&gt; String">method</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;:&quot;)" class="string">&quot;:&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#449340" title="net.liftweb.http.auth.DigestAuthentication">clientAuth</a>.<a href="#449098" title="=&gt; String">uri</a><span class="delimiter">)</span>.<span title="(x$1: java.lang.String)Array[Byte]">getBytes</span><span class="delimiter">(</span><span title="java.lang.String(&quot;UTF-8&quot;)" class="string">&quot;UTF-8&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="String" id="449382">response</a> = <a href="../../../../../util/net/liftweb/util/SecurityHelpers.scala.html#48936" title="(in: Array[Byte])String">hexEncode</a><span class="delimiter">(</span><a href="../../../../../util/net/liftweb/util/SecurityHelpers.scala.html#48924" title="(in: Array[Byte])Array[Byte]">md5</a><span class="delimiter">(</span><span class="delimiter">(</span><a href="#449380" title="String">ha1</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;:&quot;)" class="string">&quot;:&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#449340" title="net.liftweb.http.auth.DigestAuthentication">clientAuth</a>.<a href="#449097" title="=&gt; String">nonce</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;:&quot;)" class="string">&quot;:&quot;</span> <span title="(x$1: Any)java.lang.String">+</span>
            <a href="#449340" title="net.liftweb.http.auth.DigestAuthentication">clientAuth</a>.<a href="#449100" title="=&gt; String">nc</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;:&quot;)" class="string">&quot;:&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#449340" title="net.liftweb.http.auth.DigestAuthentication">clientAuth</a>.<a href="#449101" title="=&gt; String">cnonce</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;:&quot;)" class="string">&quot;:&quot;</span> <span title="(x$1: Any)java.lang.String">+</span>
            <a href="#449340" title="net.liftweb.http.auth.DigestAuthentication">clientAuth</a>.<a href="#449099" title="=&gt; String">qop</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;:&quot;)" class="string">&quot;:&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#449381" title="String">ha2</a><span class="delimiter">)</span>.<span title="(x$1: java.lang.String)Array[Byte]">getBytes</span><span class="delimiter">(</span><span title="java.lang.String(&quot;UTF-8&quot;)" class="string">&quot;UTF-8&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>;

    <span class="delimiter">(</span><a href="#449382" title="String">response</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#449340" title="net.liftweb.http.auth.DigestAuthentication">clientAuth</a>.<a href="#449102" title="=&gt; String">response</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span class="delimiter">(</span><a href="#448907" title="=&gt; scala.collection.mutable.HashMap[String,Long]">nonceMap</a>.<span title="(key: String, default: =&gt; AnyVal{def getClass(): java.lang.Class[_ &gt;: Int with Long &lt;: AnyVal]})AnyVal{def getClass(): java.lang.Class[_ &gt;: Int with Long &lt;: AnyVal]}">getOrElse</span><span class="delimiter">(</span><a href="#449340" title="net.liftweb.http.auth.DigestAuthentication">clientAuth</a>.<a href="#449097" title="=&gt; String">nonce</a>, -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span> <span title="(x$1: Any)Boolean">!=</span> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

case <span class="keyword">class</span> <a title="class DigestAuthentication extends java.lang.Object with ScalaObject with Product with Serializable" id="449792">DigestAuthentication</a><a href="#449792" title="ScalaObject" class="delimiter">(</a><a title="String" id="449094">method</a>: <span title="String">String</span>,
                                <a title="String" id="449095">userName</a>: <span title="String">String</span>,
                                <a title="String" id="449096">realm</a>: <span title="String">String</span>,
                                <a title="String" id="449097">nonce</a>: <span title="String">String</span>,
                                <a title="String" id="449098">uri</a>: <span title="String">String</span>,
                                <a title="String" id="449099">qop</a>: <span title="String">String</span>,
                                <a title="String" id="449100">nc</a>: <span title="String">String</span>,
                                <a title="String" id="449101">cnonce</a>: <span title="String">String</span>,
                                <a title="String" id="449102">response</a>: <span title="String">String</span>,
                                <a title="String" id="449103">opaque</a>: <span title="String">String</span><span class="delimiter">)</span>


<span class="keyword">sealed</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class AuthenticationScheme extends java.lang.Object with ScalaObject" id="14840">AuthenticationScheme</a> <a href="#14840" title="ScalaObject" class="delimiter">{</a>
  <span class="keyword">def</span> <a title="=&gt; String" id="449699">code</a>: <span title="String">String</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()java.lang.String" id="449700">toString</a> = <span title="java.lang.String(&quot;AuthenticationScheme(&quot;)" class="string">&quot;AuthenticationScheme(&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#449699" title="=&gt; String">code</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;)&quot;)" class="string">&quot;)&quot;</span>
<span class="delimiter">}</span>
case <span class="keyword">object</span> <a href="#449716" title="object net.liftweb.http.auth.BasicScheme" id="449721">BasicScheme</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#14840" title="net.liftweb.http.auth.AuthenticationScheme">AuthenticationScheme</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="=&gt; String" id="449708">code</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;Basic&quot;)" class="string">&quot;Basic&quot;</span>
<span class="delimiter">}</span>
case <span class="keyword">object</span> <a href="#449731" title="object net.liftweb.http.auth.DigestScheme" id="449736">DigestScheme</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#14840" title="net.liftweb.http.auth.AuthenticationScheme">AuthenticationScheme</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="=&gt; String" id="449723">code</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;Digest&quot;)" class="string">&quot;Digest&quot;</span>
<span class="delimiter">}</span>
case <span class="keyword">object</span> <a href="#449746" title="object net.liftweb.http.auth.UnknownScheme" id="449751">UnknownScheme</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#14840" title="net.liftweb.http.auth.AuthenticationScheme">AuthenticationScheme</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="=&gt; String" id="449738">code</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;Unknown&quot;)" class="string">&quot;Unknown&quot;</span>
<span class="delimiter">}</span>

<span class="keyword">sealed</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class AuthenticationAlgorithm extends java.lang.Object with ScalaObject" id="14847">AuthenticationAlgorithm</a> <a href="#14847" title="ScalaObject" class="delimiter">{</a>
  <span class="keyword">def</span> <a title="=&gt; String" id="449753">code</a>: <span title="String">String</span>
<span class="delimiter">}</span>
case <span class="keyword">object</span> <a href="#449767" title="object net.liftweb.http.auth.MD5Session" id="449772">MD5Session</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#14847" title="net.liftweb.http.auth.AuthenticationAlgorithm">AuthenticationAlgorithm</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="=&gt; String" id="449758">code</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;MD5-sess&quot;)" class="string">&quot;MD5-sess&quot;</span>
<span class="delimiter">}</span>
case <span class="keyword">object</span> <a href="#449783" title="object net.liftweb.http.auth.MD5" id="449788">MD5</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#14847" title="net.liftweb.http.auth.AuthenticationAlgorithm">AuthenticationAlgorithm</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="=&gt; String" id="449774">code</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;MD5&quot;)" class="string">&quot;MD5&quot;</span>
<span class="delimiter">}</span>


        </pre>
    </body>
</html>
<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>fj/data/Iteratee.java</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> fj.data;

<span class="keyword">import</span> fj.F;
<span class="keyword">import</span> fj.Function;
<span class="keyword">import</span> fj.P;
<span class="keyword">import</span> fj.P1;
<span class="keyword">import</span> fj.P2;
<span class="keyword">import</span> fj.Unit;

<span class="comment">/**
 * 
 */</span>
public <span class="keyword">final</span> <span class="keyword">class</span> <a title="object fj.data.Iteratee" id="10137">Iteratee</a> <span class="delimiter">{</span>

  <span class="comment">/** The input to an iteratee. */</span>
  public static <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="object fj.data.Iteratee.Input" id="27612">Input</a>&lt;<a title="Nothing" id="27613">E</a>&gt; <span class="delimiter">{</span>

    Input<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span><span class="delimiter">}</span> <span class="comment">// sealed</span>

    public <span class="keyword">abstract</span> &lt;<a title="Nothing" id="27987">Z</a>&gt; <a href="#27987" title="Z">Z</a> <a title="[Z](empty: fj.P1[Z], el: fj.P1[fj.F[E,Z]], eof: fj.P1[Z])Z" id="27985">apply</a><span class="delimiter">(</span><span class="keyword">final</span> P1&lt;<a href="#27987" title="Z">Z</a>&gt; <a title="fj.P1[Z]" id="27992">empty</a>, <span class="keyword">final</span> P1&lt;F&lt;<a href="#27613" title="E">E</a>, <a href="#27987" title="Z">Z</a>&gt;&gt; <a title="fj.P1[fj.F[E,Z]]" id="27993">el</a>, <span class="keyword">final</span> P1&lt;<a href="#27987" title="Z">Z</a>&gt; <a title="fj.P1[Z]" id="27994">eof</a><span class="delimiter">)</span>;

    <span class="comment">/** Input that has no values available */</span>
    public static <span class="keyword">final</span> &lt;<a title="Nothing" id="27975">E</a>&gt; Input&lt;<a href="#27975" title="E">E</a>&gt; <a title="[E]()fj.data.Iteratee.Input[E]" id="27973">empty</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">return</span> <span class="keyword">new</span> Input&lt;E&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        @Override
        public &lt;Z&gt; Z apply<span class="delimiter">(</span><span class="keyword">final</span> P1&lt;Z&gt; empty, <span class="keyword">final</span> P1&lt;F&lt;E, Z&gt;&gt; el, <span class="keyword">final</span> P1&lt;Z&gt; eof<span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">return</span> empty._1<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>;
    <span class="delimiter">}</span>

    <span class="comment">/** Input that is exhausted */</span>
    public static <span class="keyword">final</span> &lt;<a title="Nothing" id="27978">E</a>&gt; Input&lt;<a href="#27978" title="E">E</a>&gt; <a title="[E]()fj.data.Iteratee.Input[E]" id="27976">eof</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">return</span> <span class="keyword">new</span> Input&lt;E&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        @Override
        public &lt;Z&gt; Z apply<span class="delimiter">(</span><span class="keyword">final</span> P1&lt;Z&gt; empty, <span class="keyword">final</span> P1&lt;F&lt;E, Z&gt;&gt; el, <span class="keyword">final</span> P1&lt;Z&gt; eof<span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">return</span> eof._1<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>;
    <span class="delimiter">}</span>

    <span class="comment">/** Input that has a value available */</span>
    public static <span class="keyword">final</span> &lt;<a title="Nothing" id="27981">E</a>&gt; Input&lt;<a href="#27981" title="E">E</a>&gt; <a title="[E](element: E)fj.data.Iteratee.Input[E]" id="27979">el</a><span class="delimiter">(</span><span class="keyword">final</span> <a href="#27981" title="E">E</a> <a title="E" id="27989">element</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">return</span> <span class="keyword">new</span> Input&lt;E&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        @Override
        public &lt;Z&gt; Z apply<span class="delimiter">(</span><span class="keyword">final</span> P1&lt;Z&gt; empty, <span class="keyword">final</span> P1&lt;F&lt;E, Z&gt;&gt; el, <span class="keyword">final</span> P1&lt;Z&gt; eof<span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">return</span> el._1<span class="delimiter">(</span><span class="delimiter">)</span>.f<span class="delimiter">(</span>element<span class="delimiter">)</span>;
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>;
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/** A pure iteratee computation which is either done or needs more input */</span>
  public static <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="object fj.data.Iteratee.IterV" id="27616">IterV</a>&lt;<a title="Nothing" id="27617">E</a>, <a title="Nothing" id="27618">A</a>&gt; <span class="delimiter">{</span>

    IterV<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span><span class="delimiter">}</span> <span class="comment">// sealed</span>

    <span class="comment">/** A computation that takes an element from an input to yield a new computation */</span>
    public static &lt;<a title="Nothing" id="28002">E</a>, <a title="Nothing" id="28003">A</a>&gt; IterV&lt;<a href="#28002" title="E">E</a>, <a href="#28003" title="A">A</a>&gt; <a title="[E, A](f: fj.F[fj.data.Iteratee.Input[E],fj.data.Iteratee.IterV[E,A]])fj.data.Iteratee.IterV[E,A]" id="27999">cont</a><span class="delimiter">(</span><span class="keyword">final</span> F&lt;Input&lt;<a href="#28002" title="E">E</a>&gt;, IterV&lt;<a href="#28002" title="E">E</a>, <a href="#28003" title="A">A</a>&gt;&gt; <a title="fj.F[fj.data.Iteratee.Input[E],fj.data.Iteratee.IterV[E,A]]" id="28024">f</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">return</span> <span class="keyword">new</span> IterV&lt;E, A&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        @Override
        public &lt;Z&gt; Z fold<span class="delimiter">(</span><span class="keyword">final</span> F&lt;P2&lt;A, Input&lt;E&gt;&gt;, Z&gt; done, <span class="keyword">final</span> F&lt;F&lt;Input&lt;E&gt;, IterV&lt;E, A&gt;&gt;, Z&gt; cont<span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">return</span> cont.f<span class="delimiter">(</span>f<span class="delimiter">)</span>;
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>;
    <span class="delimiter">}</span>

    public <span class="keyword">abstract</span> &lt;<a title="Nothing" id="27772">Z</a>&gt; <a href="#27772" title="Z">Z</a> <a title="[Z](done: fj.F[fj.P2[A,fj.data.Iteratee.Input[E]],Z], cont: fj.F[fj.F[fj.data.Iteratee.Input[E],fj.data.Iteratee.IterV[E,A]],Z])Z" id="27770">fold</a><span class="delimiter">(</span><span class="keyword">final</span> F&lt;P2&lt;<a href="#27618" title="A">A</a>, Input&lt;<a href="#27617" title="E">E</a>&gt;&gt;, <a href="#27772" title="Z">Z</a>&gt; <a title="fj.F[fj.P2[A,fj.data.Iteratee.Input[E]],Z]" id="28038">done</a>, <span class="keyword">final</span> F&lt;F&lt;Input&lt;<a href="#27617" title="E">E</a>&gt;, IterV&lt;<a href="#27617" title="E">E</a>, <a href="#27618" title="A">A</a>&gt;&gt;, <a href="#27772" title="Z">Z</a>&gt; <a title="fj.F[fj.F[fj.data.Iteratee.Input[E],fj.data.Iteratee.IterV[E,A]],Z]" id="28039">cont</a><span class="delimiter">)</span>;

    <span class="comment">/** A computation that has finished */</span>
    public static &lt;<a title="Nothing" id="28007">E</a>, <a title="Nothing" id="28008">A</a>&gt; IterV&lt;<a href="#28007" title="E">E</a>, <a href="#28008" title="A">A</a>&gt; <a title="[E, A](a: A, i: fj.data.Iteratee.Input[E])fj.data.Iteratee.IterV[E,A]" id="28004">done</a><span class="delimiter">(</span><span class="keyword">final</span> <a href="#28008" title="A">A</a> <a title="A" id="28027">a</a>, <span class="keyword">final</span> Input&lt;<a href="#28007" title="E">E</a>&gt; <a title="fj.data.Iteratee.Input[E]" id="28028">i</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">final</span> P2&lt;A, Input&lt;E&gt;&gt; p = P.p<span class="delimiter">(</span>a, i<span class="delimiter">)</span>;
      <span class="keyword">return</span> <span class="keyword">new</span> IterV&lt;E, A&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        @Override
        public &lt;Z&gt; Z fold<span class="delimiter">(</span><span class="keyword">final</span> F&lt;P2&lt;A, Input&lt;E&gt;&gt;, Z&gt; done, <span class="keyword">final</span> F&lt;F&lt;Input&lt;E&gt;, IterV&lt;E, A&gt;&gt;, Z&gt; cont<span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">return</span> done.f<span class="delimiter">(</span>p<span class="delimiter">)</span>;
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>;
    <span class="delimiter">}</span>

    public <span class="keyword">final</span> <a href="#27618" title="A">A</a> <a title="()A" id="27773">run</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">final</span> F&lt;IterV&lt;E, A&gt;, Option&lt;A&gt;&gt; runCont =
        <span class="keyword">new</span> F&lt;IterV&lt;E, A&gt;, Option&lt;A&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">final</span> F&lt;P2&lt;A, Input&lt;E&gt;&gt;, Option&lt;A&gt;&gt; done = P2.&lt;A, Input&lt;E&gt;&gt;__1<span class="delimiter">(</span><span class="delimiter">)</span>.andThen<span class="delimiter">(</span>Option.&lt;A&gt;some_<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
          <span class="keyword">final</span> F&lt;F&lt;Input&lt;E&gt;, IterV&lt;E, A&gt;&gt;, Option&lt;A&gt;&gt; cont = Function.constant<span class="delimiter">(</span>Option.&lt;A&gt;none<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;

          @Override
          public Option&lt;A&gt; f<span class="delimiter">(</span><span class="keyword">final</span> IterV&lt;E, A&gt; i<span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">return</span> i.fold<span class="delimiter">(</span>done, cont<span class="delimiter">)</span>;
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>;
      <span class="keyword">final</span> F&lt;P2&lt;A, Input&lt;E&gt;&gt;, A&gt; done = P2.&lt;A, Input&lt;E&gt;&gt;__1<span class="delimiter">(</span><span class="delimiter">)</span>;
      <span class="keyword">final</span> F&lt;F&lt;Input&lt;E&gt;, IterV&lt;E, A&gt;&gt;, A&gt; cont =
        <span class="keyword">new</span> F&lt;F&lt;Input&lt;E&gt;, IterV&lt;E, A&gt;&gt;, A&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          @Override
          public A f<span class="delimiter">(</span><span class="keyword">final</span> F&lt;Input&lt;E&gt;, IterV&lt;E, A&gt;&gt; k<span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">return</span> runCont.f<span class="delimiter">(</span>k.f<span class="delimiter">(</span>Input.&lt;E&gt;eof<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>.valueE<span class="delimiter">(</span><span class="string">&quot;diverging iteratee&quot;</span><span class="delimiter">)</span>; <span class="comment">//$NON-NLS-1$</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>;
      <span class="keyword">return</span> fold<span class="delimiter">(</span>done, cont<span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/** TODO more documentation */</span>
    public <span class="keyword">final</span> &lt;<a title="Nothing" id="27776">B</a>&gt; IterV&lt;<a href="#27617" title="E">E</a>, <a href="#27776" title="B">B</a>&gt; <a title="[B](f: fj.F[A,fj.data.Iteratee.IterV[E,B]])fj.data.Iteratee.IterV[E,B]" id="27774">bind</a><span class="delimiter">(</span><span class="keyword">final</span> F&lt;<a href="#27618" title="A">A</a>, IterV&lt;<a href="#27617" title="E">E</a>, <a href="#27776" title="B">B</a>&gt;&gt; <a title="fj.F[A,fj.data.Iteratee.IterV[E,B]]" id="28042">f</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">final</span> F&lt;P2&lt;A, Input&lt;E&gt;&gt;, IterV&lt;E, B&gt;&gt; done =
        <span class="keyword">new</span> F&lt;P2&lt;A, Input&lt;E&gt;&gt;, IterV&lt;E, B&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          @Override
          public IterV&lt;E, B&gt; f<span class="delimiter">(</span><span class="keyword">final</span> P2&lt;A, Input&lt;E&gt;&gt; xe<span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">final</span> Input&lt;E&gt; e = xe._2<span class="delimiter">(</span><span class="delimiter">)</span>;
            <span class="keyword">final</span> F&lt;P2&lt;B, Input&lt;E&gt;&gt;, IterV&lt;E, B&gt;&gt; done =
              <span class="keyword">new</span> F&lt;P2&lt;B, Input&lt;E&gt;&gt;, IterV&lt;E, B&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                @Override
                public IterV&lt;E, B&gt; f<span class="delimiter">(</span><span class="keyword">final</span> P2&lt;B, Input&lt;E&gt;&gt; y_<span class="delimiter">)</span> <span class="delimiter">{</span>
                  <span class="keyword">final</span> B y = y_._1<span class="delimiter">(</span><span class="delimiter">)</span>;
                  <span class="keyword">return</span> done<span class="delimiter">(</span>y, e<span class="delimiter">)</span>;
                <span class="delimiter">}</span>
              <span class="delimiter">}</span>;
            <span class="keyword">final</span> F&lt;F&lt;Input&lt;E&gt;, IterV&lt;E, B&gt;&gt;, IterV&lt;E, B&gt;&gt; cont =
              <span class="keyword">new</span> F&lt;F&lt;Input&lt;E&gt;, IterV&lt;E, B&gt;&gt;, IterV&lt;E, B&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                @Override
                public IterV&lt;E, B&gt; f<span class="delimiter">(</span><span class="keyword">final</span> F&lt;Input&lt;E&gt;, IterV&lt;E, B&gt;&gt; k<span class="delimiter">)</span> <span class="delimiter">{</span>
                  <span class="keyword">return</span> k.f<span class="delimiter">(</span>e<span class="delimiter">)</span>;
                <span class="delimiter">}</span>
              <span class="delimiter">}</span>;
            <span class="keyword">final</span> A x = xe._1<span class="delimiter">(</span><span class="delimiter">)</span>;
            <span class="keyword">return</span> f.f<span class="delimiter">(</span>x<span class="delimiter">)</span>.fold<span class="delimiter">(</span>done, cont<span class="delimiter">)</span>;
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>;
      <span class="keyword">final</span> F&lt;F&lt;Input&lt;E&gt;, IterV&lt;E, A&gt;&gt;, IterV&lt;E, B&gt;&gt; cont =
        <span class="keyword">new</span> F&lt;F&lt;Input&lt;E&gt;, IterV&lt;E, A&gt;&gt;, IterV&lt;E, B&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          @Override
          public IterV&lt;E, B&gt; f<span class="delimiter">(</span><span class="keyword">final</span> F&lt;Input&lt;E&gt;, IterV&lt;E, A&gt;&gt; k<span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">return</span> cont<span class="delimiter">(</span><span class="keyword">new</span> F&lt;Input&lt;E&gt;, IterV&lt;E, B&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              @Override
              public IterV&lt;E, B&gt; f<span class="delimiter">(</span><span class="keyword">final</span> Input&lt;E&gt; e<span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">return</span> k.f<span class="delimiter">(</span>e<span class="delimiter">)</span>.bind<span class="delimiter">(</span>f<span class="delimiter">)</span>;
              <span class="delimiter">}</span>
            <span class="delimiter">}</span><span class="delimiter">)</span>;
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>;
      <span class="keyword">return</span> <span class="keyword">this</span>.fold<span class="delimiter">(</span>done, cont<span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/** An iteratee that counts and consumes the elements of the input */</span>
    public static <span class="keyword">final</span> &lt;<a title="Nothing" id="28011">E</a>&gt; IterV&lt;<a href="#28011" title="E">E</a>, Integer&gt; <a title="[E]()fj.data.Iteratee.IterV[E,java.lang.Integer]" id="28009">length</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">final</span> F&lt;Integer, F&lt;Input&lt;E&gt;, IterV&lt;E, Integer&gt;&gt;&gt; step =
        <span class="keyword">new</span> F&lt;Integer, F&lt;Input&lt;E&gt;, IterV&lt;E, Integer&gt;&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">final</span> F&lt;Integer, F&lt;Input&lt;E&gt;, IterV&lt;E, Integer&gt;&gt;&gt; step = <span class="keyword">this</span>;

          @Override
          public F&lt;Input&lt;E&gt;, IterV&lt;E, Integer&gt;&gt; f<span class="delimiter">(</span><span class="keyword">final</span> Integer acc<span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">final</span> P1&lt;IterV&lt;E, Integer&gt;&gt; empty =
              <span class="keyword">new</span> P1&lt;IterV&lt;E, Integer&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                @Override
                public IterV&lt;E, Integer&gt; _1<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                  <span class="keyword">return</span> cont<span class="delimiter">(</span>step.f<span class="delimiter">(</span>acc<span class="delimiter">)</span><span class="delimiter">)</span>;
                <span class="delimiter">}</span>
              <span class="delimiter">}</span>;
            <span class="keyword">final</span> P1&lt;F&lt;E, IterV&lt;E, Integer&gt;&gt;&gt; el =
              <span class="keyword">new</span> P1&lt;F&lt;E, IterV&lt;E, Integer&gt;&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                @Override
                public F&lt;E, IterV&lt;E, Integer&gt;&gt; _1<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                  <span class="keyword">return</span> P.p<span class="delimiter">(</span>cont<span class="delimiter">(</span>step.f<span class="delimiter">(</span>acc + <span class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>.&lt;E&gt;constant<span class="delimiter">(</span><span class="delimiter">)</span>;
                <span class="delimiter">}</span>
              <span class="delimiter">}</span>;
            <span class="keyword">final</span> P1&lt;IterV&lt;E, Integer&gt;&gt; eof =
              <span class="keyword">new</span> P1&lt;IterV&lt;E, Integer&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                @Override
                public IterV&lt;E, Integer&gt; _1<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                  <span class="keyword">return</span> done<span class="delimiter">(</span>acc, Input.&lt;E&gt;eof<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
                <span class="delimiter">}</span>
              <span class="delimiter">}</span>;
            <span class="keyword">return</span> <span class="keyword">new</span> F&lt;Input&lt;E&gt;, IterV&lt;E, Integer&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              @Override
              public IterV&lt;E, Integer&gt; f<span class="delimiter">(</span><span class="keyword">final</span> Input&lt;E&gt; s<span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">return</span> s.apply<span class="delimiter">(</span>empty, el, eof<span class="delimiter">)</span>;
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>;
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>;
      <span class="keyword">return</span> cont<span class="delimiter">(</span>step.f<span class="delimiter">(</span><span class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/** An iteratee that skips the first n elements of the input */</span>
    public static <span class="keyword">final</span> &lt;<a title="Nothing" id="28014">E</a>&gt; IterV&lt;<a href="#28014" title="E">E</a>, Unit&gt; <a title="[E](n: Int)fj.data.Iteratee.IterV[E,fj.Unit]" id="28012">drop</a><span class="delimiter">(</span><span class="keyword">final</span> int <a title="Int" id="28033">n</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">final</span> F&lt;Input&lt;E&gt;, IterV&lt;E, Unit&gt;&gt; step =
        <span class="keyword">new</span> F&lt;Input&lt;E&gt;, IterV&lt;E, Unit&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">final</span> F&lt;Input&lt;E&gt;, IterV&lt;E, Unit&gt;&gt; step = <span class="keyword">this</span>;

          <span class="keyword">final</span> P1&lt;IterV&lt;E, Unit&gt;&gt; empty =
            <span class="keyword">new</span> P1&lt;IterV&lt;E, Unit&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              @Override
              public IterV&lt;E, Unit&gt; _1<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">return</span> cont<span class="delimiter">(</span>step<span class="delimiter">)</span>;
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>;
          <span class="keyword">final</span> P1&lt;F&lt;E, IterV&lt;E, Unit&gt;&gt;&gt; el =
            <span class="keyword">new</span> P1&lt;F&lt;E, IterV&lt;E, Unit&gt;&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              @Override
              public F&lt;E, IterV&lt;E, Unit&gt;&gt; _1<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">return</span> P.p<span class="delimiter">(</span>IterV.&lt;E&gt;drop<span class="delimiter">(</span>n - <span class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>.&lt;E&gt;constant<span class="delimiter">(</span><span class="delimiter">)</span>;
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>;
          <span class="keyword">final</span> P1&lt;IterV&lt;E, Unit&gt;&gt; eof =
            <span class="keyword">new</span> P1&lt;IterV&lt;E, Unit&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              @Override
              public IterV&lt;E, Unit&gt; _1<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">return</span> done<span class="delimiter">(</span>Unit.unit<span class="delimiter">(</span><span class="delimiter">)</span>, Input.&lt;E&gt;eof<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>;

          @Override
          public IterV&lt;E, Unit&gt; f<span class="delimiter">(</span><span class="keyword">final</span> Input&lt;E&gt; s<span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">return</span> s.apply<span class="delimiter">(</span>empty, el, eof<span class="delimiter">)</span>;
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>;
      <span class="keyword">return</span> n == <span class="int">0</span>
        ? done<span class="delimiter">(</span>Unit.unit<span class="delimiter">(</span><span class="delimiter">)</span>, Input.&lt;E&gt;empty<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        : cont<span class="delimiter">(</span>step<span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/** An iteratee that consumes the head of the input */</span>
    public static <span class="keyword">final</span> &lt;<a title="Nothing" id="28017">E</a>&gt; IterV&lt;<a href="#28017" title="E">E</a>, <a href="Option.java.html#10291" title="fj.data.Option">Option</a>&lt;<a href="#28017" title="E">E</a>&gt;&gt; <a title="[E]()fj.data.Iteratee.IterV[E,fj.data.Option[E]]" id="28015">head</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">final</span> F&lt;Input&lt;E&gt;, IterV&lt;E, Option&lt;E&gt;&gt;&gt; step =
        <span class="keyword">new</span> F&lt;Input&lt;E&gt;, IterV&lt;E, Option&lt;E&gt;&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">final</span> F&lt;Input&lt;E&gt;, IterV&lt;E, Option&lt;E&gt;&gt;&gt; step = <span class="keyword">this</span>;

          <span class="keyword">final</span> P1&lt;IterV&lt;E, Option&lt;E&gt;&gt;&gt; empty =
            <span class="keyword">new</span> P1&lt;IterV&lt;E, Option&lt;E&gt;&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              @Override
              public IterV&lt;E, Option&lt;E&gt;&gt; _1<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">return</span> cont<span class="delimiter">(</span>step<span class="delimiter">)</span>;
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>;
          <span class="keyword">final</span> P1&lt;F&lt;E, IterV&lt;E, Option&lt;E&gt;&gt;&gt;&gt; el =
            <span class="keyword">new</span> P1&lt;F&lt;E, IterV&lt;E, Option&lt;E&gt;&gt;&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              @Override
              public F&lt;E, IterV&lt;E, Option&lt;E&gt;&gt;&gt; _1<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">return</span> <span class="keyword">new</span> F&lt;E, Iteratee.IterV&lt;E, Option&lt;E&gt;&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                  @Override
                  public IterV&lt;E, Option&lt;E&gt;&gt; f<span class="delimiter">(</span><span class="keyword">final</span> E e<span class="delimiter">)</span> <span class="delimiter">{</span>
                    <span class="keyword">return</span> done<span class="delimiter">(</span>Option.&lt;E&gt;some<span class="delimiter">(</span>e<span class="delimiter">)</span>, Input.&lt;E&gt;empty<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
                  <span class="delimiter">}</span>
                <span class="delimiter">}</span>;
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>;
          <span class="keyword">final</span> P1&lt;IterV&lt;E, Option&lt;E&gt;&gt;&gt; eof =
            <span class="keyword">new</span> P1&lt;IterV&lt;E, Option&lt;E&gt;&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              @Override
              public IterV&lt;E, Option&lt;E&gt;&gt; _1<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">return</span> done<span class="delimiter">(</span>Option.&lt;E&gt;none<span class="delimiter">(</span><span class="delimiter">)</span>, Input.&lt;E&gt;eof<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>;

          @Override
          public IterV&lt;E, Option&lt;E&gt;&gt; f<span class="delimiter">(</span><span class="keyword">final</span> Input&lt;E&gt; s<span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">return</span> s.apply<span class="delimiter">(</span>empty, el, eof<span class="delimiter">)</span>;
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>;
      <span class="keyword">return</span> cont<span class="delimiter">(</span>step<span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/** An iteratee that returns the first element of the input */</span>
    public static <span class="keyword">final</span> &lt;<a title="Nothing" id="28020">E</a>&gt; IterV&lt;<a href="#28020" title="E">E</a>, <a href="Option.java.html#10291" title="fj.data.Option">Option</a>&lt;<a href="#28020" title="E">E</a>&gt;&gt; <a title="[E]()fj.data.Iteratee.IterV[E,fj.data.Option[E]]" id="28018">peek</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">final</span> F&lt;Input&lt;E&gt;, IterV&lt;E, Option&lt;E&gt;&gt;&gt; step =
        <span class="keyword">new</span> F&lt;Input&lt;E&gt;, IterV&lt;E, Option&lt;E&gt;&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">final</span> F&lt;Input&lt;E&gt;, IterV&lt;E, Option&lt;E&gt;&gt;&gt; step = <span class="keyword">this</span>;

          <span class="keyword">final</span> P1&lt;IterV&lt;E, Option&lt;E&gt;&gt;&gt; empty =
            <span class="keyword">new</span> P1&lt;IterV&lt;E, Option&lt;E&gt;&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              @Override
              public IterV&lt;E, Option&lt;E&gt;&gt; _1<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">return</span> cont<span class="delimiter">(</span>step<span class="delimiter">)</span>;
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>;
          <span class="keyword">final</span> P1&lt;F&lt;E, IterV&lt;E, Option&lt;E&gt;&gt;&gt;&gt; el =
            <span class="keyword">new</span> P1&lt;F&lt;E, IterV&lt;E, Option&lt;E&gt;&gt;&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              @Override
              public F&lt;E, IterV&lt;E, Option&lt;E&gt;&gt;&gt; _1<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">return</span> <span class="keyword">new</span> F&lt;E, Iteratee.IterV&lt;E, Option&lt;E&gt;&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                  @Override
                  public IterV&lt;E, Option&lt;E&gt;&gt; f<span class="delimiter">(</span><span class="keyword">final</span> E e<span class="delimiter">)</span> <span class="delimiter">{</span>
                    <span class="keyword">return</span> done<span class="delimiter">(</span>Option.&lt;E&gt;some<span class="delimiter">(</span>e<span class="delimiter">)</span>, Input.&lt;E&gt;el<span class="delimiter">(</span>e<span class="delimiter">)</span><span class="delimiter">)</span>;
                  <span class="delimiter">}</span>
                <span class="delimiter">}</span>;
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>;
          <span class="keyword">final</span> P1&lt;IterV&lt;E, Option&lt;E&gt;&gt;&gt; eof =
            <span class="keyword">new</span> P1&lt;IterV&lt;E, Option&lt;E&gt;&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              @Override
              public IterV&lt;E, Option&lt;E&gt;&gt; _1<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">return</span> done<span class="delimiter">(</span>Option.&lt;E&gt;none<span class="delimiter">(</span><span class="delimiter">)</span>, Input.&lt;E&gt;eof<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>;

          @Override
          public IterV&lt;E, Option&lt;E&gt;&gt; f<span class="delimiter">(</span><span class="keyword">final</span> Input&lt;E&gt; s<span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">return</span> s.apply<span class="delimiter">(</span>empty, el, eof<span class="delimiter">)</span>;
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>;
      <span class="keyword">return</span> cont<span class="delimiter">(</span>step<span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/** An iteratee that consumes the input elements and returns them as a list in reverse order,
     * so that the last line is the first element. This allows to build a list from 2 iteratees. */</span>
    public static <span class="keyword">final</span> &lt;<a title="Nothing" id="28023">E</a>&gt; IterV&lt;<a href="#28023" title="E">E</a>, <a href="List.java.html#10232" title="fj.data.List">List</a>&lt;<a href="#28023" title="E">E</a>&gt;&gt; <a title="[E]()fj.data.Iteratee.IterV[E,fj.data.List[E]]" id="28021">list</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">final</span> F&lt;List&lt;E&gt;, F&lt;Input&lt;E&gt;, IterV&lt;E, List&lt;E&gt;&gt;&gt;&gt; step =
          <span class="keyword">new</span> F&lt;List&lt;E&gt;, F&lt;Input&lt;E&gt;, IterV&lt;E, List&lt;E&gt;&gt;&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">final</span> F&lt;List&lt;E&gt;, F&lt;Input&lt;E&gt;, IterV&lt;E, List&lt;E&gt;&gt;&gt;&gt; step = <span class="keyword">this</span>;

            @Override
            public F&lt;Input&lt;E&gt;, IterV&lt;E, List&lt;E&gt;&gt;&gt; f<span class="delimiter">(</span><span class="keyword">final</span> List&lt;E&gt; acc<span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="keyword">final</span> P1&lt;IterV&lt;E, List&lt;E&gt;&gt;&gt; empty =
                <span class="keyword">new</span> P1&lt;IterV&lt;E, List&lt;E&gt;&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                  @Override
                  public IterV&lt;E, List&lt;E&gt;&gt; _1<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                    <span class="keyword">return</span> cont<span class="delimiter">(</span>step.f<span class="delimiter">(</span>acc<span class="delimiter">)</span><span class="delimiter">)</span>;
                  <span class="delimiter">}</span>
                <span class="delimiter">}</span>;
              <span class="keyword">final</span> P1&lt;F&lt;E, IterV&lt;E, List&lt;E&gt;&gt;&gt;&gt; el =
                <span class="keyword">new</span> P1&lt;F&lt;E, IterV&lt;E, List&lt;E&gt;&gt;&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                  @Override
                  public F&lt;E, IterV&lt;E, List&lt;E&gt;&gt;&gt; _1<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                    <span class="keyword">return</span> <span class="keyword">new</span> F&lt;E, Iteratee.IterV&lt;E, List&lt;E&gt;&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                      @Override
                      public IterV&lt;E, List&lt;E&gt;&gt; f<span class="delimiter">(</span><span class="keyword">final</span> E e<span class="delimiter">)</span> <span class="delimiter">{</span>
                        <span class="keyword">return</span> cont<span class="delimiter">(</span>step.f<span class="delimiter">(</span>acc.cons<span class="delimiter">(</span>e<span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>;
                      <span class="delimiter">}</span>
                    <span class="delimiter">}</span>;
                  <span class="delimiter">}</span>
                <span class="delimiter">}</span>;
              <span class="keyword">final</span> P1&lt;IterV&lt;E, List&lt;E&gt;&gt;&gt; eof =
                <span class="keyword">new</span> P1&lt;IterV&lt;E, List&lt;E&gt;&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                  @Override
                  public IterV&lt;E, List&lt;E&gt;&gt; _1<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                    <span class="keyword">return</span> done<span class="delimiter">(</span>acc, Input.&lt;E&gt;eof<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
                  <span class="delimiter">}</span>
                <span class="delimiter">}</span>;
              <span class="keyword">return</span> <span class="keyword">new</span> F&lt;Input&lt;E&gt;, IterV&lt;E, List&lt;E&gt;&gt;&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                @Override
                public IterV&lt;E, List&lt;E&gt;&gt; f<span class="delimiter">(</span><span class="keyword">final</span> Input&lt;E&gt; s<span class="delimiter">)</span> <span class="delimiter">{</span>
                  <span class="keyword">return</span> s.apply<span class="delimiter">(</span>empty, el, eof<span class="delimiter">)</span>;
                <span class="delimiter">}</span>
              <span class="delimiter">}</span>;
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>;
        <span class="keyword">return</span> cont<span class="delimiter">(</span>step.f<span class="delimiter">(</span>List.&lt;E&gt; nil<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> Iteratee<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException<span class="delimiter">(</span><span class="delimiter">)</span>;
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>
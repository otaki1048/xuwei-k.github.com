<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>oauth/OAuth.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> dispatch.oauth
<span class="keyword">import</span> dispatch._
<span class="keyword">import</span> <a href="../core/requests.scala.html#9508" title="object dispatch.Request">Request</a>.<span class="delimiter">{</span>encode_%, decode_%<span class="delimiter">}</span>

<span class="keyword">import</span> collection.Map
<span class="keyword">import</span> collection.immutable.<span class="delimiter">{</span>TreeMap, Map=&gt;IMap<span class="delimiter">}</span>

<span class="keyword">import</span> javax.crypto
<span class="keyword">import</span> java.net.URI

<span class="keyword">import</span> org.apache.http.protocol.<span title="object org.apache.http.protocol.HTTP">HTTP</span>.UTF_8

case <span class="keyword">class</span> <a title="class Consumer extends java.lang.Object with ScalaObject with Product with Serializable" id="60515">Consumer</a><a href="#60515" title="ScalaObject" class="delimiter">(</a><a title="String" id="60510">key</a>: <span title="String">String</span>, <a title="String" id="60511">secret</a>: <span title="String">String</span><span class="delimiter">)</span>
case <span class="keyword">class</span> <a title="class Token extends java.lang.Object with ScalaObject with Product with Serializable" id="55001">Token</a><a href="#55001" title="ScalaObject" class="delimiter">(</a><a title="String" id="55276">value</a>: <span title="String">String</span>, <a title="String" id="55277">secret</a>: <span title="String">String</span><span class="delimiter">)</span>
<span class="keyword">object</span> <a title="object dispatch.oauth.Token" id="55286">Token</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="[T](m: scala.collection.Map[String,T])Option[dispatch.oauth.Token]" id="54998">apply</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="55000">T</a> &lt;: Any<span class="delimiter">]</span><span class="delimiter">(</span><a title="scala.collection.Map[String,T]" id="55045">m</a>: <span title="scala.collection.Map[String,T]">Map</span><span class="delimiter">[</span>String, T<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[dispatch.oauth.Token]">Option</span><span class="delimiter">[</span>Token<span class="delimiter">]</span> = <span title="(xs: java.lang.String*)List[java.lang.String]">List</span><span class="delimiter">(</span><span title="java.lang.String(&quot;oauth_token&quot;)" class="string">&quot;oauth_token&quot;</span>, <span title="java.lang.String(&quot;oauth_token_secret&quot;)" class="string">&quot;oauth_token_secret&quot;</span><span class="delimiter">)</span>.<span title="(f: java.lang.String =&gt; scala.collection.GenTraversableOnce[T])(implicit bf: scala.collection.generic.CanBuildFrom[List[java.lang.String],T,List[T]])List[T]">flatMap</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,T,List[T]]" class="delimiter">(</span><a href="#55045" title="scala.collection.Map[String,T]">m</a>.<a href="#55088" title="(xo: Option[T])Iterable[T]">get</a><span class="delimiter">)</span> <span title="Option[dispatch.oauth.Token]" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a title="Some[dispatch.oauth.Token]" id="55255">value</a> :: <a title="T" id="55271">secret</a> :: <span title="object Nil">Nil</span> =&gt; <span title="(x: dispatch.oauth.Token)Some[dispatch.oauth.Token]">Some</span><span class="delimiter">(</span><a href="#55001" title="(value: String, secret: String)dispatch.oauth.Token">Token</a><span class="delimiter">(</span><a href="#55255" title="T">value</a>.<span title="()java.lang.String">toString</span>, <a href="#55271" title="T">secret</a>.<span title="()java.lang.String">toString</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <span title="None.type">_</span> =&gt; <span title="object None">None</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/** Import this object's methods to add signing operators to dispatch.Request */</span>
<span class="keyword">object</span> <a title="object dispatch.oauth.OAuth" id="9760">OAuth</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="comment">/** @return oauth parameter map including signature */</span>
  <span class="keyword">def</span> <a title="(method: String, url: String, user_params: scala.collection.Map[String,Any], consumer: dispatch.oauth.Consumer, token: Option[dispatch.oauth.Token], verifier: Option[String], callback: Option[String])scala.collection.immutable.Map[java.lang.String,java.lang.String]" id="55288">sign</a><span class="delimiter">(</span><a title="String" id="55300">method</a>: <span title="String">String</span>, <a title="String" id="55301">url</a>: <span title="String">String</span>, <a title="scala.collection.Map[String,Any]" id="55302">user_params</a>: <span title="scala.collection.Map[String,Any]">Map</span><span class="delimiter">[</span>String, Any<span class="delimiter">]</span>, <a title="dispatch.oauth.Consumer" id="55303">consumer</a>: <a href="#60515" title="dispatch.oauth.Consumer">Consumer</a>, 
      <a title="Option[dispatch.oauth.Token]" id="55304">token</a>: <span title="Option[dispatch.oauth.Token]">Option</span><span class="delimiter">[</span>Token<span class="delimiter">]</span>, <a title="Option[String]" id="55305">verifier</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="Option[String]" id="55306">callback</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.immutable.Map[java.lang.String,java.lang.String]" id="55309">oauth_params</a> = <span title="(elems: (java.lang.String, java.lang.String)*)scala.collection.immutable.Map[java.lang.String,java.lang.String]">IMap</span><span class="delimiter">(</span>
      <span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;oauth_consumer_key&quot;</span> <span title="(y: String)(java.lang.String, String)">-&gt;</span> <a href="#55303" title="dispatch.oauth.Consumer">consumer</a>.<a href="#60510" title="=&gt; String">key</a>,
      <span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;oauth_signature_method&quot;</span> <span title="(y: java.lang.String)(java.lang.String, java.lang.String)">-&gt;</span> <span title="java.lang.String(&quot;HMAC-SHA1&quot;)" class="string">&quot;HMAC-SHA1&quot;</span>,
      <span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;oauth_timestamp&quot;</span> <span title="(y: java.lang.String)(java.lang.String, java.lang.String)">-&gt;</span> <span class="delimiter">(</span><span title="object java.lang.System">System</span>.<span title="()Long">currentTimeMillis</span> <span title="(x: Int)Long">/</span> <span title="Int(1000)" class="int">1000</span><span class="delimiter">)</span>.<span title="()java.lang.String">toString</span>,
      <span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;oauth_nonce&quot;</span> <span title="(y: java.lang.String)(java.lang.String, java.lang.String)">-&gt;</span> <span title="object java.lang.System">System</span>.<span title="()Long">nanoTime</span>.<span title="()java.lang.String">toString</span>,
      <span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;oauth_version&quot;</span> <span title="(y: java.lang.String)(java.lang.String, java.lang.String)">-&gt;</span> <span title="java.lang.String(&quot;1.0&quot;)" class="string">&quot;1.0&quot;</span>
    <span class="delimiter">)</span> <span title="(xs: scala.collection.GenTraversableOnce[(java.lang.String, java.lang.String)])scala.collection.immutable.Map[java.lang.String,java.lang.String]">++</span> <a href="#55304" title="Option[dispatch.oauth.Token]">token</a>.<span title="(f: dispatch.oauth.Token =&gt; (java.lang.String, String))Option[(java.lang.String, String)]">map</span> <span title="(xo: Option[(java.lang.String, String)])Iterable[(java.lang.String, String)]" class="delimiter">{</span> <span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;oauth_token&quot;</span> <span title="(y: String)(java.lang.String, String)">-&gt;</span> <a href="#55464" title="dispatch.oauth.Token">_</a>.<a href="#55276" title="=&gt; String">value</a> <span class="delimiter">}</span> <span title="(xs: scala.collection.GenTraversableOnce[(java.lang.String, java.lang.String)])scala.collection.immutable.Map[java.lang.String,java.lang.String]">++</span> 
      <a href="#55305" title="Option[String]">verifier</a>.<span title="(f: String =&gt; (java.lang.String, String))Option[(java.lang.String, String)]">map</span> <span title="(xo: Option[(java.lang.String, String)])Iterable[(java.lang.String, String)]" class="delimiter">{</span> <span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;oauth_verifier&quot;</span> <span title="(y: String)(java.lang.String, String)">-&gt;</span> <a href="#55812" title="String">_</a> <span class="delimiter">}</span> <span title="(xs: scala.collection.GenTraversableOnce[(java.lang.String, java.lang.String)])scala.collection.immutable.Map[java.lang.String,java.lang.String]">++</span>
      <a href="#55306" title="Option[String]">callback</a>.<span title="(f: String =&gt; (java.lang.String, String))Option[(java.lang.String, String)]">map</span> <span title="(xo: Option[(java.lang.String, String)])Iterable[(java.lang.String, String)]" class="delimiter">{</span> <span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;oauth_callback&quot;</span> <span title="(y: String)(java.lang.String, String)">-&gt;</span> <a href="#56152" title="String">_</a> <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="String" id="55310">encoded_ordered_params</a> = <span class="delimiter">(</span>
      <span title="()(implicit ordering: Ordering[String])scala.collection.immutable.TreeMap[String,String]" class="keyword">new</span> <span title="scala.collection.immutable.TreeMap[String,String]">TreeMap</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span> <span title="(xs: scala.collection.GenTraversableOnce[(String, String)])scala.collection.immutable.TreeMap[String,String]">++</span> <span class="delimiter">(</span><a href="#55302" title="scala.collection.Map[String,Any]">user_params</a> <span title="(xs: scala.collection.GenTraversableOnce[(String, Any)])scala.collection.Map[String,Any]">++</span> <a href="#55309" title="scala.collection.immutable.Map[java.lang.String,java.lang.String]">oauth_params</a> <span title="(f: (String, Any) =&gt; (String, String))(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.Map[String,Any],(String, String),scala.collection.Map[String,String]])scala.collection.Map[String,String]">map</span> <a href="#55294" title="(t: (String, Any))(String, String)">%%</a><span class="delimiter">)</span>
    <span class="delimiter">)</span> <span title="(f: (String, String) =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.TreeMap[String,String],java.lang.String,scala.collection.immutable.Iterable[java.lang.String]])scala.collection.immutable.Iterable[java.lang.String]">map</span> <a href="#58224" title="java.lang.String" class="delimiter">{</a> <span class="keyword">case</span> <span title="java.lang.String" class="delimiter">(</span><a title="String" id="58227">k</a>, <a title="String" id="58228">v</a><span class="delimiter">)</span> =&gt; <a href="#58227" title="String">k</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;=&quot;)" class="string">&quot;=&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#58228" title="String">v</a> <span class="delimiter">}</span> <span title="(sep: String)String">mkString</span> <span title="java.lang.String(&quot;&amp;&quot;)" class="string">&quot;&amp;&quot;</span>
    
    <span class="keyword">val</span> <a title="String" id="55311">message</a> = 
      <a href="#55293" title="(s: Seq[String])String">%%</a><span class="delimiter">(</span><a href="#55300" title="String">method</a>.<span title="()java.lang.String">toUpperCase</span> <a href="#58381" title="(x: String)List[String]">::</a> <a href="#55301" title="String">url</a> <a href="#58384" title="(x: String)List[String]">::</a> <a href="#55310" title="String">encoded_ordered_params</a> <a href="#58385" title="(x: String)List[String]">::</a> <span title="object Nil">Nil</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="java.lang.String" id="55312">SHA1</a> = <span title="java.lang.String(&quot;HmacSHA1&quot;)" class="string">&quot;HmacSHA1&quot;</span>
    <span class="keyword">val</span> <a title="String" id="55313">key_str</a> = <a href="#55293" title="(s: Seq[String])String">%%</a><span class="delimiter">(</span><a href="#55303" title="dispatch.oauth.Consumer">consumer</a>.<a href="#60511" title="=&gt; String">secret</a> <a href="#58405" title="(x: String)List[String]">::</a> <span class="delimiter">(</span><a href="#55304" title="Option[dispatch.oauth.Token]">token</a> <span title="(f: dispatch.oauth.Token =&gt; String)Option[String]">map</span> <span class="delimiter">{</span> <a href="#58411" title="dispatch.oauth.Token">_</a>.<a href="#55277" title="=&gt; String">secret</a> <span class="delimiter">}</span> <span title="(default: =&gt; String)String">getOrElse</span> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> <a href="#58406" title="(x: String)List[String]">::</a> <span title="object Nil">Nil</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="javax.crypto.spec.SecretKeySpec" id="55314">key</a> = <span title="javax.crypto.spec.SecretKeySpec" class="keyword">new</span> crypto.spec.<span title="javax.crypto.spec.SecretKeySpec">SecretKeySpec</span><span class="delimiter">(</span><a href="#55295" title="(str: String)Array[Byte]">bytes</a><span class="delimiter">(</span><a href="#55313" title="String">key_str</a><span class="delimiter">)</span>, <a href="#55312" title="java.lang.String">SHA1</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="java.lang.String" id="55315">sig</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="javax.crypto.Mac" id="58697">mac</a> = crypto.<span title="object javax.crypto.Mac">Mac</span>.<span title="(x$1: java.lang.String)javax.crypto.Mac">getInstance</span><span class="delimiter">(</span><a href="#55312" title="java.lang.String">SHA1</a><span class="delimiter">)</span>
      <a href="#58697" title="javax.crypto.Mac">mac</a>.<span title="(x$1: java.security.Key)Unit">init</span><span class="delimiter">(</span><a href="#55314" title="javax.crypto.spec.SecretKeySpec">key</a><span class="delimiter">)</span>
      <span title="(x$1: Array[Byte])java.lang.String" class="keyword">new</span> <span title="java.lang.String">String</span><span class="delimiter">(</span><a href="../core/requests.scala.html#9508" title="object dispatch.Request">Request</a>.<a href="../core/requests.scala.html#13118" title="(b: Array[Byte])Array[Byte]">encode_base64</a><span class="delimiter">(</span><a href="#58697" title="javax.crypto.Mac">mac</a>.<span title="(x$1: Array[Byte])Array[Byte]">doFinal</span><span class="delimiter">(</span><a href="#55295" title="(str: String)Array[Byte]">bytes</a><span class="delimiter">(</span><a href="#55311" title="String">message</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#55309" title="scala.collection.immutable.Map[java.lang.String,java.lang.String]">oauth_params</a> <span title="(kv: (java.lang.String, java.lang.String))scala.collection.immutable.Map[java.lang.String,java.lang.String]">+</span> <span class="delimiter">(</span><span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;oauth_signature&quot;</span> <span title="(y: java.lang.String)(java.lang.String, java.lang.String)">-&gt;</span> <a href="#55315" title="java.lang.String">sig</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  
  <span class="comment">/** Out-of-band callback code */</span>
  <span class="keyword">val</span> <a title="java.lang.String" id="55289">oob</a> = <span title="java.lang.String(&quot;oob&quot;)" class="string">&quot;oob&quot;</span>
  
  <span class="comment">/** Map with oauth_callback set to the given url */</span>
  <span class="keyword">def</span> <a title="(url: String)scala.collection.immutable.Map[java.lang.String,String]" id="55291">callback</a><span class="delimiter">(</span><a title="String" id="58817">url</a>: <span title="String">String</span><span class="delimiter">)</span> = <span title="(elems: (java.lang.String, String)*)scala.collection.immutable.Map[java.lang.String,String]">IMap</span><span class="delimiter">(</span><span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;oauth_callback&quot;</span> <span title="(y: String)(java.lang.String, String)">-&gt;</span> <a href="#58817" title="String">url</a><span class="delimiter">)</span>
  
  <span class="comment">//normalize to OAuth percent encoding</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(str: String)String" id="55292">%%</a> <span class="delimiter">(</span><a title="String" id="58116">str</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="List[(java.lang.String, java.lang.String)]" id="58840">remaps</a> = <span title="(_1: java.lang.String, _2: java.lang.String)(java.lang.String, java.lang.String)" class="delimiter">(</span><span title="java.lang.String(&quot;+&quot;)" class="string">&quot;+&quot;</span>, <span title="java.lang.String(&quot;%20&quot;)" class="string">&quot;%20&quot;</span><span class="delimiter">)</span> <a href="#58841" title="(x: (java.lang.String, java.lang.String))List[(java.lang.String, java.lang.String)]">::</a> <span title="(_1: java.lang.String, _2: java.lang.String)(java.lang.String, java.lang.String)" class="delimiter">(</span><span title="java.lang.String(&quot;%7E&quot;)" class="string">&quot;%7E&quot;</span>, <span title="java.lang.String(&quot;~&quot;)" class="string">&quot;~&quot;</span><span class="delimiter">)</span> <a href="#58848" title="(x: (java.lang.String, java.lang.String))List[(java.lang.String, java.lang.String)]">::</a> <span title="(_1: java.lang.String, _2: java.lang.String)(java.lang.String, java.lang.String)" class="delimiter">(</span><span title="java.lang.String(&quot;*&quot;)" class="string">&quot;*&quot;</span>, <span title="java.lang.String(&quot;%2A&quot;)" class="string">&quot;%2A&quot;</span><span class="delimiter">)</span> <a href="#58855" title="(x: (java.lang.String, java.lang.String))List[(java.lang.String, java.lang.String)]">::</a> <span title="object Nil">Nil</span>
    <span class="delimiter">(</span><a href="../core/requests.scala.html#13116" title="(s: String)java.lang.String">encode_%</a><span class="delimiter">(</span><a href="#58116" title="String">str</a><span class="delimiter">)</span> <a href="#58875" title="(z: java.lang.String)(op: (java.lang.String, (java.lang.String, java.lang.String)) =&gt; java.lang.String)java.lang.String">/:</a> <a href="#58840" title="List[(java.lang.String, java.lang.String)]">remaps</a><span class="delimiter">)</span> <a href="#58888" title="java.lang.String" class="delimiter">{</a> <span class="keyword">case</span> <span title="java.lang.String" class="delimiter">(</span><a title="java.lang.String" id="58898">str</a>, <span class="delimiter">(</span><a title="java.lang.String" id="58901">a</a>, <a title="java.lang.String" id="58902">b</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#58898" title="java.lang.String">str</a>.<span title="(x$1: java.lang.CharSequence, x$2: java.lang.CharSequence)java.lang.String">replace</span><span class="delimiter">(</span><a href="#58901" title="java.lang.String">a</a>,<a href="#58902" title="java.lang.String">b</a><span class="delimiter">)</span> <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(s: Seq[String])String" id="55293">%%</a> <span class="delimiter">(</span><a title="Seq[String]" id="58114">s</a>: <span title="Seq[String]">Seq</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="String">String</span> = <a href="#58114" title="Seq[String]">s</a> <span title="(f: String =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[String],String,Seq[String]])Seq[String]">map</span> <a href="#55292" title="(str: String)String">%%</a> <span title="(sep: String)String">mkString</span> <span title="java.lang.String(&quot;&amp;&quot;)" class="string">&quot;&amp;&quot;</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(t: (String, Any))(String, String)" id="55294">%%</a> <span class="delimiter">(</span><a title="(String, Any)" id="58112">t</a>: <span title="(String, Any)" class="delimiter">(</span>String, Any<span class="delimiter">)</span><span class="delimiter">)</span>: <span title="(String, String)" class="delimiter">(</span>String, String<span class="delimiter">)</span> = <span title="(_1: String, _2: String)(String, String)" class="delimiter">(</span><a href="#55292" title="(str: String)String">%%</a><span class="delimiter">(</span><a href="#58112" title="(String, Any)">t</a>.<span title="=&gt; String">_1</span><span class="delimiter">)</span>, <a href="#55292" title="(str: String)String">%%</a><span class="delimiter">(</span><a href="#58112" title="(String, Any)">t</a>.<span title="=&gt; Any">_2</span>.<span title="()java.lang.String">toString</span><span class="delimiter">)</span><span class="delimiter">)</span>
  
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(str: String)Array[Byte]" id="55295">bytes</a><span class="delimiter">(</span><a title="String" id="58690">str</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#58690" title="String">str</a>.<span title="(x$1: java.lang.String)Array[Byte]">getBytes</span><span class="delimiter">(</span><span title="java.lang.String(&quot;UTF-8&quot;)">UTF_8</span><span class="delimiter">)</span>
  
  <span class="comment">/** Add OAuth operators to dispatch.Request */</span>
  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit dispatch.oauth.OAuth.Request2RequestSigner : (r: dispatch.Request)dispatch.oauth.OAuth.RequestSigner" id="55296">Request2RequestSigner</a><span class="delimiter">(</span><a title="dispatch.Request" id="58989">r</a>: <a href="../core/requests.scala.html#9510" title="dispatch.Request">Request</a><span class="delimiter">)</span> = <span title="dispatch.oauth.OAuth.RequestSigner" class="keyword">new</span> <a href="#55298" title="dispatch.oauth.OAuth.RequestSigner">RequestSigner</a><span class="delimiter">(</span><a href="#58989" title="dispatch.Request">r</a><span class="delimiter">)</span>
  <span class="comment">/** Add String conversion since Http#str2req implicit will not chain. */</span>
  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit dispatch.oauth.OAuth.Request2RequestSigner : (r: String)dispatch.oauth.OAuth.RequestSigner" id="55297">Request2RequestSigner</a><span class="delimiter">(</span><a title="String" id="59008">r</a>: <span title="String">String</span><span class="delimiter">)</span> = <span title="dispatch.oauth.OAuth.RequestSigner" class="keyword">new</span> <a href="#55298" title="dispatch.oauth.OAuth.RequestSigner">RequestSigner</a><span class="delimiter">(</span><a href="../core/requests.scala.html#13144" title="(str: String)dispatch.Request" class="keyword">new</a> <a href="../core/requests.scala.html#9510" title="dispatch.Request">Request</a><span class="delimiter">(</span><a href="#59008" title="String">r</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">class</span> <a title="class RequestSigner extends java.lang.Object with ScalaObject" id="55298">RequestSigner</a><a href="#55298" title="ScalaObject" class="delimiter">(</a><a title="dispatch.Request" id="59007">r</a>: <a href="../core/requests.scala.html#9510" title="dispatch.Request">Request</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    @deprecated<span class="delimiter">(</span><span class="string">&quot;use &lt;@ (consumer, callback) to pass the callback in the header for a request-token request&quot;</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(consumer: dispatch.oauth.Consumer)dispatch.Request" id="58995">&lt;@</a> <span class="delimiter">(</span><a title="dispatch.oauth.Consumer" id="59017">consumer</a>: <a href="#60515" title="dispatch.oauth.Consumer">Consumer</a><span class="delimiter">)</span>: <a href="../core/requests.scala.html#9510" title="dispatch.Request">Request</a> = <a href="#59000" title="(consumer: dispatch.oauth.Consumer, token: Option[dispatch.oauth.Token], verifier: Option[String], callback: Option[String])dispatch.Request">sign</a><span class="delimiter">(</span><a href="#59017" title="dispatch.oauth.Consumer">consumer</a>, <span title="object None">None</span>, <span title="object None">None</span>, <span title="object None">None</span><span class="delimiter">)</span>
    <span class="comment">/** sign a request with a callback, e.g. a request-token request */</span>
    <span class="keyword">def</span> <a title="(consumer: dispatch.oauth.Consumer, callback: String)dispatch.Request" id="58996">&lt;@</a> <span class="delimiter">(</span><a title="dispatch.oauth.Consumer" id="59277">consumer</a>: <a href="#60515" title="dispatch.oauth.Consumer">Consumer</a>, <a title="String" id="59278">callback</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../core/requests.scala.html#9510" title="dispatch.Request">Request</a> = <a href="#59000" title="(consumer: dispatch.oauth.Consumer, token: Option[dispatch.oauth.Token], verifier: Option[String], callback: Option[String])dispatch.Request">sign</a><span class="delimiter">(</span><a href="#59277" title="dispatch.oauth.Consumer">consumer</a>, <span title="object None">None</span>, <span title="object None">None</span>, <span title="(x: String)Some[String]">Some</span><span class="delimiter">(</span><a href="#59278" title="String">callback</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="comment">/** sign a request with a consumer, token, and verifier, e.g. access-token request */</span>
    <span class="keyword">def</span> <a title="(consumer: dispatch.oauth.Consumer, token: dispatch.oauth.Token, verifier: String)dispatch.Request" id="58997">&lt;@</a> <span class="delimiter">(</span><a title="dispatch.oauth.Consumer" id="59283">consumer</a>: <a href="#60515" title="dispatch.oauth.Consumer">Consumer</a>, <a title="dispatch.oauth.Token" id="59284">token</a>: <a href="#55001" title="dispatch.oauth.Token">Token</a>, <a title="String" id="59285">verifier</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../core/requests.scala.html#9510" title="dispatch.Request">Request</a> = 
      <a href="#59000" title="(consumer: dispatch.oauth.Consumer, token: Option[dispatch.oauth.Token], verifier: Option[String], callback: Option[String])dispatch.Request">sign</a><span class="delimiter">(</span><a href="#59283" title="dispatch.oauth.Consumer">consumer</a>, <span title="(x: dispatch.oauth.Token)Some[dispatch.oauth.Token]">Some</span><span class="delimiter">(</span><a href="#59284" title="dispatch.oauth.Token">token</a><span class="delimiter">)</span>, <span title="(x: String)Some[String]">Some</span><span class="delimiter">(</span><a href="#59285" title="String">verifier</a><span class="delimiter">)</span>, <span title="object None">None</span><span class="delimiter">)</span>
    <span class="comment">/** sign a request with a consumer and a token, e.g. an OAuth-signed API request */</span>
    <span class="keyword">def</span> <a title="(consumer: dispatch.oauth.Consumer, token: dispatch.oauth.Token)dispatch.Request" id="58998">&lt;@</a> <span class="delimiter">(</span><a title="dispatch.oauth.Consumer" id="59293">consumer</a>: <a href="#60515" title="dispatch.oauth.Consumer">Consumer</a>, <a title="dispatch.oauth.Token" id="59294">token</a>: <a href="#55001" title="dispatch.oauth.Token">Token</a><span class="delimiter">)</span>: <a href="../core/requests.scala.html#9510" title="dispatch.Request">Request</a> = <a href="#59000" title="(consumer: dispatch.oauth.Consumer, token: Option[dispatch.oauth.Token], verifier: Option[String], callback: Option[String])dispatch.Request">sign</a><span class="delimiter">(</span><a href="#59293" title="dispatch.oauth.Consumer">consumer</a>, <span title="(x: dispatch.oauth.Token)Some[dispatch.oauth.Token]">Some</span><span class="delimiter">(</span><a href="#59294" title="dispatch.oauth.Token">token</a><span class="delimiter">)</span>, <span title="object None">None</span>, <span title="object None">None</span><span class="delimiter">)</span>
    
    <span class="comment">/** add token value as a query string parameter, for user authorization redirects */</span>
    <span class="keyword">def</span> <a title="(token: dispatch.oauth.Token)dispatch.Request" id="58999">with_token</a> <span class="delimiter">(</span><a title="dispatch.oauth.Token" id="59299">token</a>: <a href="#55001" title="dispatch.oauth.Token">Token</a><span class="delimiter">)</span> =  <span class="comment">// implicit use of &lt;&lt;? here causes compiler error</span>
      <a href="../core/requests.scala.html#21868" title="implicit dispatch.ImplicitRequestVerbs.toRequestVerbs : (req: dispatch.Request)dispatch.RequestVerbs">r</a> <a href="../core/requests.scala.html#34361" title="(values: Traversable[(String, String)])dispatch.Request">&lt;&lt;?</a> <span class="delimiter">(</span><span class="delimiter">(</span><span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;oauth_token&quot;</span> <span title="(y: String)(java.lang.String, String)">-&gt;</span> <a href="#59299" title="dispatch.oauth.Token">token</a>.<a href="#55276" title="=&gt; String">value</a><span class="delimiter">)</span> <a href="#59306" title="(x: (java.lang.String, String))List[(java.lang.String, String)]">::</a> <span title="object Nil">Nil</span><span class="delimiter">)</span>

    <span class="comment">/** Sign request by reading Post (&lt;&lt;) and query string parameters */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(consumer: dispatch.oauth.Consumer, token: Option[dispatch.oauth.Token], verifier: Option[String], callback: Option[String])dispatch.Request" id="59000">sign</a><span class="delimiter">(</span><a title="dispatch.oauth.Consumer" id="59019">consumer</a>: <a href="#60515" title="dispatch.oauth.Consumer">Consumer</a>, <a title="Option[dispatch.oauth.Token]" id="59020">token</a>: <span title="Option[dispatch.oauth.Token]">Option</span><span class="delimiter">[</span>Token<span class="delimiter">]</span>, <a title="Option[String]" id="59021">verifier</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="Option[String]" id="59022">callback</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="String" id="59025">oauth_url</a> = <a href="../core/requests.scala.html#21868" title="implicit dispatch.ImplicitRequestVerbs.toRequestVerbs : (req: dispatch.Request)dispatch.RequestVerbs">r</a>.<a href="../core/requests.scala.html#34366" title="=&gt; java.net.URI">to_uri</a>.<span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">toString</span>.<span title="(separator: Char)Array[String]">split</span><span title="(i: Int)String" class="delimiter">(</span><span title="Char(\'?\')" class="char">'?'</span><span class="delimiter">)</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.immutable.Map[String,String]" id="59026">query_params</a> = <a href="#59005" title="(v1: String)scala.collection.immutable.Map[String,String]">split_decode</a><span class="delimiter">(</span><a href="../core/requests.scala.html#21868" title="implicit dispatch.ImplicitRequestVerbs.toRequestVerbs : (req: dispatch.Request)dispatch.RequestVerbs">r</a>.<a href="../core/requests.scala.html#34366" title="=&gt; java.net.URI">to_uri</a>.<span title="()java.lang.String">getRawQuery</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="List[(String, String)]" id="59027">form_params</a> = <a href="#59007" title="dispatch.Request">r</a>.<a href="../core/requests.scala.html#13139" title="=&gt; Option[org.apache.http.HttpEntity]">body</a>.<span title="=&gt; List[org.apache.http.HttpEntity]">toList</span>.<span title="(f: org.apache.http.HttpEntity =&gt; scala.collection.GenTraversableOnce[(String, String)])(implicit bf: scala.collection.generic.CanBuildFrom[List[org.apache.http.HttpEntity],(String, String),List[(String, String)]])List[(String, String)]">flatMap</span> <a href="#59089" title="Traversable[(String, String)]" class="delimiter">{</a> 
        <span class="keyword">case</span> <a title="Traversable[(String, String)]" id="59090">ent</a>: <a href="../core/requests.scala.html#9514" title="dispatch.FormEntity">FormEntity</a> =&gt; <a href="#59090" title="dispatch.FormEntity">ent</a>.<a href="../core/requests.scala.html#34824" title="=&gt; Traversable[(String, String)]">oauth_params</a>
        <span class="keyword">case</span> <span title="scala.collection.immutable.Nil.type">_</span> =&gt; <span title="object Nil">Nil</span>
      <span class="delimiter">}</span>
      <span class="keyword">val</span> <a title="scala.collection.immutable.Map[java.lang.String,java.lang.String]" id="59028">oauth_params</a> = <a href="#9760" title="object dispatch.oauth.OAuth">OAuth</a>.<a href="#55288" title="(method: String, url: String, user_params: scala.collection.Map[String,Any], consumer: dispatch.oauth.Consumer, token: Option[dispatch.oauth.Token], verifier: Option[String], callback: Option[String])scala.collection.immutable.Map[java.lang.String,java.lang.String]">sign</a><span class="delimiter">(</span><a href="#59007" title="dispatch.Request">r</a>.<a href="../core/requests.scala.html#13133" title="=&gt; String">method</a>, <a href="#59025" title="String">oauth_url</a>, 
                                    <a href="#59026" title="scala.collection.immutable.Map[String,String]">query_params</a> <span title="(xs: scala.collection.GenTraversableOnce[(String, String)])scala.collection.immutable.Map[String,String]">++</span> <a href="#59027" title="List[(String, String)]">form_params</a>,
                                    <a href="#59019" title="dispatch.oauth.Consumer">consumer</a>, <a href="#59020" title="Option[dispatch.oauth.Token]">token</a>, <a href="#59021" title="Option[String]">verifier</a>, <a href="#59022" title="Option[String]">callback</a><span class="delimiter">)</span>
      <a href="../core/requests.scala.html#21868" title="implicit dispatch.ImplicitRequestVerbs.toRequestVerbs : (req: dispatch.Request)dispatch.RequestVerbs">r</a> <a href="../core/requests.scala.html#34351" title="(values: Map[String,String])dispatch.Request">&lt;:&lt;</a> <span title="(elems: (java.lang.String, java.lang.String)*)scala.collection.immutable.Map[java.lang.String,java.lang.String]">IMap</span><span class="delimiter">(</span><span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;Authorization&quot;</span> <span title="(y: java.lang.String)(java.lang.String, java.lang.String)">-&gt;</span> <span class="delimiter">(</span><span title="java.lang.String(&quot;OAuth &quot;)" class="string">&quot;OAuth &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#59028" title="scala.collection.immutable.Map[java.lang.String,java.lang.String]">oauth_params</a>.<span title="(f: (java.lang.String, java.lang.String) =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map[java.lang.String,java.lang.String],java.lang.String,scala.collection.immutable.Iterable[java.lang.String]])scala.collection.immutable.Iterable[java.lang.String]">map</span> <a href="#59225" title="java.lang.String" class="delimiter">{</a> 
        <span class="keyword">case</span> <span title="java.lang.String" class="delimiter">(</span><a title="java.lang.String" id="59228">k</a>, <a title="java.lang.String" id="59229">v</a><span class="delimiter">)</span> =&gt; <span class="delimiter">(</span><a href="../core/requests.scala.html#13116" title="(s: String)java.lang.String">encode_%</a><span class="delimiter">(</span><a href="#59228" title="java.lang.String">k</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;=\&quot;%s\&quot;&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="../core/requests.scala.html#13116" title="(s: String)java.lang.String">encode_%</a><span class="delimiter">(</span><a href="#59229" title="java.lang.String">v</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span> <span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="[T](block: scala.collection.immutable.Map[String,String] =&gt; T)dispatch.Handler[T]" id="59001">&gt;%</a> <span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="59003">T</a><span class="delimiter">]</span> <span class="delimiter">(</span><a title="scala.collection.immutable.Map[String,String] =&gt; T" id="59328">block</a>: IMap<span class="delimiter">[</span>String, String<span class="delimiter">]</span> =&gt; T<span class="delimiter">)</span> = <a href="../core/handlers.scala.html#21871" title="implicit dispatch.ImplicitHandlerVerbs.toHandlerVerbs : (req: dispatch.Request)dispatch.HandlerVerbs">r</a> <a href="../core/handlers.scala.html#28628" title="(block: String =&gt; T)dispatch.Handler[T]">&gt;-</a> <span class="delimiter">(</span> <a href="#59005" title="=&gt; String =&gt; scala.collection.immutable.Map[String,String]">split_decode</a> <span title="(g: scala.collection.immutable.Map[String,String] =&gt; T)String =&gt; T">andThen</span> <a href="#59328" title="scala.collection.immutable.Map[String,String] =&gt; T">block</a> <span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="=&gt; dispatch.Handler[dispatch.oauth.Token]" id="59004">as_token</a> = <a href="#55296" title="implicit dispatch.oauth.OAuth.Request2RequestSigner : (r: dispatch.Request)dispatch.oauth.OAuth.RequestSigner">r</a> <a href="#59001" title="(block: scala.collection.immutable.Map[String,String] =&gt; dispatch.oauth.Token)dispatch.Handler[dispatch.oauth.Token]">&gt;%</a> <span class="delimiter">{</span> <a href="#54998" title="(m: scala.collection.Map[String,String])Option[dispatch.oauth.Token]">Token</a><span class="delimiter">(</span><a href="#59363" title="scala.collection.immutable.Map[String,String]">_</a><span class="delimiter">)</span>.<span title="(default: =&gt; dispatch.oauth.Token)dispatch.oauth.Token">getOrElse</span> <span class="delimiter">{</span> <span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Token parameters not found in given map&quot;)" class="string">&quot;Token parameters not found in given map&quot;</span><span class="delimiter">)</span> <span class="delimiter">}</span> <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="String =&gt; scala.collection.immutable.Map[String,String]" id="59005">split_decode</a>: <span class="delimiter">(</span>String =&gt; IMap<span class="delimiter">[</span>String, String<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#59394" title="scala.collection.immutable.Map[String,String]" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="scala.collection.immutable.Map[String,Nothing]" class="keyword">null</span> =&gt; <span title="object scala.collection.immutable.Map">IMap</span>.<span title="scala.collection.immutable.Map[String,Nothing]">empty</span>
      <span class="keyword">case</span> <a title="scala.collection.immutable.Map[String,String]" id="59403">query</a> =&gt; <span title="object scala.collection.immutable.Map">IMap</span>.<span title="scala.collection.immutable.Map[String,Nothing]">empty</span> <span title="(xs: scala.collection.GenTraversableOnce[(String, String)])scala.collection.immutable.Map[String,String]">++</span> <a href="#59403" title="String">query</a>.<span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">trim</span>.<span title="(separator: Char)Array[String]">split</span><span title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]" class="delimiter">(</span><span title="Char(\'&amp;\')" class="char">'&amp;'</span><span class="delimiter">)</span>.<span title="(f: String =&gt; (java.lang.String, java.lang.String))(implicit bf: scala.collection.generic.CanBuildFrom[Array[String],(java.lang.String, java.lang.String),scala.collection.GenTraversableOnce[(String, String)]])scala.collection.GenTraversableOnce[(String, String)]">map</span> <span title="(implicit m: DummyImplicit)scala.collection.generic.CanBuildFrom[Array[_],(java.lang.String, java.lang.String),scala.collection.mutable.ArraySeq[(java.lang.String, java.lang.String)]]" class="delimiter">{</span> <a title="String" id="59936">nvp</a> =&gt;
        <a href="#59936" title="String">nvp</a>.<span title="(x$1: java.lang.String)Array[java.lang.String]">split</span><span title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">(</span><span title="java.lang.String(&quot;=&quot;)" class="string">&quot;=&quot;</span><span class="delimiter">)</span>.<span title="(f: java.lang.String =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Array[java.lang.String],java.lang.String,Array[java.lang.String]])Array[java.lang.String]">map</span><span title="(implicit m: scala.reflect.ClassManifest[java.lang.String])scala.collection.generic.CanBuildFrom[Array[_],java.lang.String,Array[java.lang.String]]" class="delimiter">(</span><a href="../core/requests.scala.html#13117" title="(s: String)java.lang.String">decode_%</a><span class="delimiter">)</span> <span title="(java.lang.String, java.lang.String)" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a href="#60441" title="(java.lang.String, java.lang.String)">Array</a><span class="delimiter">(</span><a title="java.lang.String" id="60447">name</a><span class="delimiter">)</span> =&gt; <a href="#60447" title="(x: java.lang.String)ArrowAssoc[java.lang.String]">name</a> <span title="(y: java.lang.String)(java.lang.String, java.lang.String)">-&gt;</span> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>
          <span class="keyword">case</span> <a href="#60464" title="(java.lang.String, java.lang.String)">Array</a><span class="delimiter">(</span><a title="java.lang.String" id="60470">name</a>, <a title="java.lang.String" id="60471">value</a><span class="delimiter">)</span> =&gt; <a href="#60470" title="(x: java.lang.String)ArrowAssoc[java.lang.String]">name</a> <span title="(y: java.lang.String)(java.lang.String, java.lang.String)">-&gt;</span> <a href="#60471" title="java.lang.String">value</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
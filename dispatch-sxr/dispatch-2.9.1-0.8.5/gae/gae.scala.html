<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>gae/gae.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> dispatch.gae

<span class="keyword">import</span> java.net._
<span class="keyword">import</span> java.util.concurrent.TimeUnit
<span class="keyword">import</span> org.apache.http.conn._
<span class="keyword">import</span> org.apache.http.params._
<span class="keyword">import</span> org.apache.http.conn.routing.HttpRoute
<span class="keyword">import</span> org.apache.http.conn.scheme._

<span class="keyword">object</span> <a title="object dispatch.gae.GAEConnectionManager" id="9570">GAEConnectionManager</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#9572" title="dispatch.gae.GAEConnectionManager">GAEConnectionManager</a>

<span class="comment">// adapted from this Java impl: http://esxx.blogspot.com/2009/06/using-apaches-httpclient-on-google-app.html</span>

<span class="keyword">class</span> <a title="class GAEConnectionManager extends java.lang.Object with org.apache.http.conn.ClientConnectionManager with ScalaObject" id="9572">GAEConnectionManager</a> <a href="#9572" title="ScalaObject" class="keyword">extends</a> <span title="org.apache.http.conn.ClientConnectionManager">ClientConnectionManager</span> <span class="delimiter">{</span>
  <span class="keyword">val</span> <a title="no_socket_factory extends java.lang.Object with org.apache.http.conn.scheme.SchemeSocketFactory" id="37903">no_socket_factory</a> = <a href="#38418" title="java.lang.Object with org.apache.http.conn.scheme.SchemeSocketFactory" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with org.apache.http.conn.scheme.SchemeSocketFactory" id="38418">SchemeSocketFactory</a> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(sock: java.net.Socket, remote: java.net.InetSocketAddress, local: java.net.InetSocketAddress, params: org.apache.http.params.HttpParams)java.net.Socket" id="38429">connectSocket</a><span class="delimiter">(</span><a title="java.net.Socket" id="38432">sock</a>: <span title="java.net.Socket">Socket</span>, <a title="java.net.InetSocketAddress" id="38433">remote</a>:<span title="java.net.InetSocketAddress">InetSocketAddress</span>, <a title="java.net.InetSocketAddress" id="38434">local</a>: <span title="java.net.InetSocketAddress">InetSocketAddress</span>, <a title="org.apache.http.params.HttpParams" id="38435">params</a>: <span title="org.apache.http.params.HttpParams">HttpParams</span><span class="delimiter">)</span>: <span title="java.net.Socket">Socket</span> = <span title="Null(null)" class="keyword">null</span>
    <span class="keyword">def</span> <a title="(params: org.apache.http.params.HttpParams)java.net.Socket" id="38430">createSocket</a><span class="delimiter">(</span><a title="org.apache.http.params.HttpParams" id="38557">params</a>: <span title="org.apache.http.params.HttpParams">HttpParams</span><span class="delimiter">)</span>: <span title="java.net.Socket">Socket</span> = <span title="Null(null)" class="keyword">null</span>
    <span class="keyword">def</span> <a title="(s: java.net.Socket)Boolean" id="38431">isSecure</a><span class="delimiter">(</span><a title="java.net.Socket" id="38559">s</a>: <span title="java.net.Socket">Socket</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span title="Boolean(false)" class="keyword">false</span>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">val</span> <a title="org.apache.http.conn.scheme.SchemeRegistry" id="37905">schemeRegistry</a> = <span title="org.apache.http.conn.scheme.SchemeRegistry" class="keyword">new</span> <span title="org.apache.http.conn.scheme.SchemeRegistry">SchemeRegistry</span>
  <a href="#37905" title="=&gt; org.apache.http.conn.scheme.SchemeRegistry">schemeRegistry</a>.<span title="(x$1: org.apache.http.conn.scheme.Scheme)org.apache.http.conn.scheme.Scheme">register</span><span class="delimiter">(</span><span title="org.apache.http.conn.scheme.Scheme" class="keyword">new</span> <span title="org.apache.http.conn.scheme.Scheme">Scheme</span><span class="delimiter">(</span><span title="java.lang.String(&quot;http&quot;)" class="string">&quot;http&quot;</span>,  <span title="Int(80)" class="int">80</span>, <a href="#37903" title="=&gt; java.lang.Object with org.apache.http.conn.scheme.SchemeSocketFactory">no_socket_factory</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <a href="#37905" title="=&gt; org.apache.http.conn.scheme.SchemeRegistry">schemeRegistry</a>.<span title="(x$1: org.apache.http.conn.scheme.Scheme)org.apache.http.conn.scheme.Scheme">register</span><span class="delimiter">(</span><span title="org.apache.http.conn.scheme.Scheme" class="keyword">new</span> <span title="org.apache.http.conn.scheme.Scheme">Scheme</span><span class="delimiter">(</span><span title="java.lang.String(&quot;https&quot;)" class="string">&quot;https&quot;</span>, <span title="Int(443)" class="int">443</span>, <a href="#37903" title="=&gt; java.lang.Object with org.apache.http.conn.scheme.SchemeSocketFactory">no_socket_factory</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()org.apache.http.conn.scheme.SchemeRegistry" id="37907">getSchemeRegistry</a>: <span title="org.apache.http.conn.scheme.SchemeRegistry">SchemeRegistry</span> = <a href="#37905" title="=&gt; org.apache.http.conn.scheme.SchemeRegistry">schemeRegistry</a>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(route: org.apache.http.conn.routing.HttpRoute, state: AnyRef)org.apache.http.conn.ClientConnectionRequest" id="37908">requestConnection</a><span class="delimiter">(</span><a title="org.apache.http.conn.routing.HttpRoute" id="38641">route</a>: <span title="org.apache.http.conn.routing.HttpRoute">HttpRoute</span>, <a title="AnyRef" id="38642">state</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span>: <span title="org.apache.http.conn.ClientConnectionRequest">ClientConnectionRequest</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="dispatch.gae.GAEConnectionManager" id="38707">mgr</a> = <a href="#9572" title="dispatch.gae.GAEConnectionManager" class="keyword">this</a>
    <a href="#38708" title="java.lang.Object with org.apache.http.conn.ClientConnectionRequest" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with org.apache.http.conn.ClientConnectionRequest" id="38708">ClientConnectionRequest</a> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="()Unit" id="38712">abortRequest</a> = <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>
      <span class="keyword">def</span> <a title="(timeout: Long, tunit: java.util.concurrent.TimeUnit)org.apache.http.conn.ManagedClientConnection" id="38713">getConnection</a><span class="delimiter">(</span><a title="Long" id="38717">timeout</a>: <span title="Long">Long</span>, <a title="java.util.concurrent.TimeUnit" id="38718">tunit</a>: <span title="java.util.concurrent.TimeUnit">TimeUnit</span><span class="delimiter">)</span>: <span title="org.apache.http.conn.ManagedClientConnection">ManagedClientConnection</span> = <span class="delimiter">{</span>
        <a href="#39164" title="(cm: org.apache.http.conn.ClientConnectionManager, route: org.apache.http.conn.routing.HttpRoute, state: AnyRef)dispatch.gae.GAEClientConnection" class="keyword">new</a> <a href="#9586" title="dispatch.gae.GAEClientConnection">GAEClientConnection</a><span class="delimiter">(</span><a href="#38707" title="dispatch.gae.GAEConnectionManager">mgr</a>, <a href="#38641" title="org.apache.http.conn.routing.HttpRoute">route</a>, <a href="#38642" title="AnyRef">state</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(conn: org.apache.http.conn.ManagedClientConnection, validDuration: Long, timeUnit: java.util.concurrent.TimeUnit)Unit" id="37909">releaseConnection</a><span class="delimiter">(</span><a title="org.apache.http.conn.ManagedClientConnection" id="39242">conn</a>: <span title="org.apache.http.conn.ManagedClientConnection">ManagedClientConnection</span>, <a title="Long" id="39243">validDuration</a>: <span title="Long">Long</span>, <a title="java.util.concurrent.TimeUnit" id="39244">timeUnit</a>: <span title="java.util.concurrent.TimeUnit">TimeUnit</span><span class="delimiter">)</span> = <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(idletime: Long, tunit: java.util.concurrent.TimeUnit)Unit" id="37910">closeIdleConnections</a><span class="delimiter">(</span><a title="Long" id="39247">idletime</a>: <span title="Long">Long</span>, <a title="java.util.concurrent.TimeUnit" id="39248">tunit</a>: <span title="java.util.concurrent.TimeUnit">TimeUnit</span><span class="delimiter">)</span> = <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="37911">closeExpiredConnections</a> = <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="37912">shutdown</a> = <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">import</span> java.io._
<span class="keyword">import</span> java.net._
<span class="keyword">import</span> java.util.concurrent.TimeUnit
<span class="keyword">import</span> org.apache.http._
<span class="keyword">import</span> org.apache.http.conn._
<span class="keyword">import</span> org.apache.http.conn.routing.HttpRoute
<span class="keyword">import</span> org.apache.http.entity.ByteArrayEntity
<span class="keyword">import</span> org.apache.http.message.BasicHttpResponse
<span class="keyword">import</span> org.apache.http.params._
<span class="keyword">import</span> org.apache.http.protocol._

<span class="keyword">import</span> com.google.appengine.api.urlfetch._

<span class="keyword">object</span> <a title="object dispatch.gae.GAEClientConnection" id="9584">GAEClientConnection</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="com.google.appengine.api.urlfetch.URLFetchService" id="39259">urlFS</a>: <span title="com.google.appengine.api.urlfetch.URLFetchService">URLFetchService</span> = <span title="object com.google.appengine.api.urlfetch.URLFetchServiceFactory">URLFetchServiceFactory</span>.<span title="()com.google.appengine.api.urlfetch.URLFetchService">getURLFetchService</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class GAEClientConnection extends java.lang.Object with org.apache.http.conn.ManagedClientConnection with ScalaObject" id="9586">GAEClientConnection</a><a href="#9586" title="ScalaObject" class="delimiter">(</a><span class="keyword">var</span> <a title="org.apache.http.conn.ClientConnectionManager" id="39238">cm</a>: <span title="org.apache.http.conn.ClientConnectionManager">ClientConnectionManager</span>, <span class="keyword">var</span> <a title="org.apache.http.conn.routing.HttpRoute" id="39239">route</a>: <span title="org.apache.http.conn.routing.HttpRoute">HttpRoute</span>, <span class="keyword">var</span> <a title="AnyRef" id="39240">state</a>: <span title="AnyRef">AnyRef</span>, <span class="keyword">var</span> <a title="Boolean" id="39241">closed</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="org.apache.http.conn.ManagedClientConnection">ManagedClientConnection</span> <span class="delimiter">{</span>
  <span class="keyword">import</span> <a href="#9584" title="object dispatch.gae.GAEClientConnection">GAEClientConnection</a>._

  <span class="keyword">def</span> <a title="(cm: org.apache.http.conn.ClientConnectionManager, route: org.apache.http.conn.routing.HttpRoute, state: AnyRef)dispatch.gae.GAEClientConnection" id="39164" class="keyword">this</a><span class="delimiter">(</span><a title="org.apache.http.conn.ClientConnectionManager" id="39235">cm</a>: <span title="org.apache.http.conn.ClientConnectionManager">ClientConnectionManager</span>, <a title="org.apache.http.conn.routing.HttpRoute" id="39236">route</a>: <span title="org.apache.http.conn.routing.HttpRoute">HttpRoute</span>, <a title="AnyRef" id="39237">state</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span> =
    <a href="#9586" title="GAEClientConnection.this.type" class="keyword">this</a><span class="delimiter">(</span><a href="#39235" title="org.apache.http.conn.ClientConnectionManager">cm</a>, <a href="#39236" title="org.apache.http.conn.routing.HttpRoute">route</a>, <a href="#39237" title="AnyRef">state</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">var</span> <a title="com.google.appengine.api.urlfetch.HTTPRequest" id="39166">request</a>: <span title="com.google.appengine.api.urlfetch.HTTPRequest">HTTPRequest</span> = _
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="com.google.appengine.api.urlfetch.HTTPResponse" id="39169">response</a>: <span title="com.google.appengine.api.urlfetch.HTTPResponse">HTTPResponse</span> = _
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Boolean" id="39172">reusable</a>: <span title="Boolean">Boolean</span> = _

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Boolean" id="39174">isSecure</a>: <span title="Boolean">Boolean</span> = <a href="#39239" title="=&gt; org.apache.http.conn.routing.HttpRoute">route</a>.<span title="()Boolean">isSecure</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()org.apache.http.conn.routing.HttpRoute" id="39175">getRoute</a>: <span title="org.apache.http.conn.routing.HttpRoute">HttpRoute</span> = <a href="#39239" title="=&gt; org.apache.http.conn.routing.HttpRoute">route</a>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()javax.net.ssl.SSLSession" id="39176">getSSLSession</a>: javax.net.ssl.<span title="javax.net.ssl.SSLSession">SSLSession</span> = <span title="Null(null)" class="keyword">null</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(route: org.apache.http.conn.routing.HttpRoute, context: org.apache.http.protocol.HttpContext, params: org.apache.http.params.HttpParams)Unit" id="39177">open</a><span class="delimiter">(</span><a title="org.apache.http.conn.routing.HttpRoute" id="39396">route</a>: <span title="org.apache.http.conn.routing.HttpRoute">HttpRoute</span>, <a title="org.apache.http.protocol.HttpContext" id="39397">context</a>: <span title="org.apache.http.protocol.HttpContext">HttpContext</span>, <a title="org.apache.http.params.HttpParams" id="39398">params</a>: <span title="org.apache.http.params.HttpParams">HttpParams</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#39193" title="()Unit">close</a>
    <a href="#9586" title="GAEClientConnection.this.type" class="keyword">this</a>.<a href="#39239" title="(x$1: org.apache.http.conn.routing.HttpRoute)Unit">route</a> = <a href="#39396" title="org.apache.http.conn.routing.HttpRoute">route</a>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(secure: Boolean, params: org.apache.http.params.HttpParams)Nothing" id="39178">tunnelTarget</a><span class="delimiter">(</span><a title="Boolean" id="39411">secure</a>: <span title="Boolean">Boolean</span>, <a title="org.apache.http.params.HttpParams" id="39412">params</a>: <span title="org.apache.http.params.HttpParams">HttpParams</span><span class="delimiter">)</span> = <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.io.IOException" class="keyword">new</span> <span title="java.io.IOException">IOException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;tunnelTarget not supported&quot;)" class="string">&quot;tunnelTarget not supported&quot;</span><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(next: org.apache.http.HttpHost, secure: Boolean, params: org.apache.http.params.HttpParams)Nothing" id="39179">tunnelProxy</a><span class="delimiter">(</span><a title="org.apache.http.HttpHost" id="39428">next</a>: <span title="org.apache.http.HttpHost">HttpHost</span>, <a title="Boolean" id="39429">secure</a>: <span title="Boolean">Boolean</span>, <a title="org.apache.http.params.HttpParams" id="39430">params</a>: <span title="org.apache.http.params.HttpParams">HttpParams</span><span class="delimiter">)</span> = <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.io.IOException" class="keyword">new</span> <span title="java.io.IOException">IOException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;tunnelProxy not supported&quot;)" class="string">&quot;tunnelProxy not supported&quot;</span><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(context: org.apache.http.protocol.HttpContext, params: org.apache.http.params.HttpParams)Nothing" id="39180">layerProtocol</a><span class="delimiter">(</span><a title="org.apache.http.protocol.HttpContext" id="39437">context</a>: <span title="org.apache.http.protocol.HttpContext">HttpContext</span>, <a title="org.apache.http.params.HttpParams" id="39438">params</a>: <span title="org.apache.http.params.HttpParams">HttpParams</span><span class="delimiter">)</span> = <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.io.IOException" class="keyword">new</span> <span title="java.io.IOException">IOException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;layerProtocol not supported&quot;)" class="string">&quot;layerProtocol not supported&quot;</span><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="39181">markReusable</a> = <a href="#39172" title="(x$1: Boolean)Unit">reusable</a> = <span title="Boolean(true)" class="keyword">true</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="39182">unmarkReusable</a> = <a href="#39172" title="(x$1: Boolean)Unit">reusable</a> = <span title="Boolean(false)" class="keyword">false</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Boolean" id="39183">isMarkedReusable</a>: <span title="Boolean">Boolean</span> = <a href="#39172" title="=&gt; Boolean">reusable</a>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(state: AnyRef)Unit" id="39184">setState</a><span class="delimiter">(</span><a title="AnyRef" id="39453">state</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span> = <a href="#9586" title="GAEClientConnection.this.type" class="keyword">this</a>.<a href="#39240" title="(x$1: AnyRef)Unit">state</a> = <a href="#39453" title="AnyRef">state</a>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()AnyRef" id="39185">getState</a>: <span title="AnyRef">AnyRef</span> = <a href="#39240" title="=&gt; AnyRef">state</a>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(duration: Long, unit: java.util.concurrent.TimeUnit)Unit" id="39186">setIdleDuration</a><span class="delimiter">(</span><a title="Long" id="39458">duration</a>: <span title="Long">Long</span>, <a title="java.util.concurrent.TimeUnit" id="39459">unit</a>: <span title="java.util.concurrent.TimeUnit">TimeUnit</span><span class="delimiter">)</span> = <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(timeout: Int)Boolean" id="39187">isResponseAvailable</a><span class="delimiter">(</span><a title="Int" id="39462">timeout</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <a href="#39169" title="=&gt; com.google.appengine.api.urlfetch.HTTPResponse">response</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(request: org.apache.http.HttpRequest)Unit" id="39188">sendRequestHeader</a><span class="delimiter">(</span><a title="org.apache.http.HttpRequest" id="39469">request</a>: <span title="org.apache.http.HttpRequest">HttpRequest</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="org.apache.http.HttpHost" id="39472">host</a> = <a href="#39239" title="=&gt; org.apache.http.conn.routing.HttpRoute">route</a>.<span title="()org.apache.http.HttpHost">getTargetHost</span>
      <span class="keyword">val</span> <a title="java.lang.String" id="39473">port</a> = <span title="java.lang.String" class="keyword">if</span> <span class="delimiter">(</span><a href="#39472" title="org.apache.http.HttpHost">host</a>.<span title="()Int">getPort</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">==</span> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span> <span class="keyword">else</span> <span title="java.lang.String(&quot;:&quot;)" class="string">&quot;:&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#39472" title="org.apache.http.HttpHost">host</a>.<span title="()Int">getPort</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.net.URI" id="39474">uri</a> = <span title="java.net.URI" class="keyword">new</span> <span title="java.net.URI">URI</span><span class="delimiter">(</span><a href="#39472" title="org.apache.http.HttpHost">host</a>.<span title="()java.lang.String">getSchemeName</span>
                        <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;://&quot;)" class="string">&quot;://&quot;</span>
                        <span title="(x$1: Any)java.lang.String">+</span> <a href="#39472" title="org.apache.http.HttpHost">host</a>.<span title="()java.lang.String">getHostName</span>
                        <span title="(x$1: Any)java.lang.String">+</span> <a href="#39473" title="java.lang.String">port</a>
                        <span title="(x$1: Any)java.lang.String">+</span> <a href="#39469" title="org.apache.http.HttpRequest">request</a>.<span title="()org.apache.http.RequestLine">getRequestLine</span>.<span title="()java.lang.String">getUri</span><span class="delimiter">)</span>

      <a href="#9586" title="GAEClientConnection.this.type" class="keyword">this</a>.<a href="#39166" title="(x$1: com.google.appengine.api.urlfetch.HTTPRequest)Unit">request</a> = <span title="(x$1: java.net.URL, x$2: com.google.appengine.api.urlfetch.HTTPMethod, x$3: com.google.appengine.api.urlfetch.FetchOptions)com.google.appengine.api.urlfetch.HTTPRequest" class="keyword">new</span> <span title="com.google.appengine.api.urlfetch.HTTPRequest">HTTPRequest</span><span class="delimiter">(</span><a href="#39474" title="java.net.URI">uri</a>.<span title="()java.net.URL">toURL</span>,
                                     <span title="object com.google.appengine.api.urlfetch.HTTPMethod">HTTPMethod</span>.<span title="(x$1: java.lang.String)com.google.appengine.api.urlfetch.HTTPMethod">valueOf</span><span class="delimiter">(</span><a href="#39469" title="org.apache.http.HttpRequest">request</a>.<span title="()org.apache.http.RequestLine">getRequestLine</span>.<span title="()java.lang.String">getMethod</span><span class="delimiter">)</span>,
                                     <span title="object com.google.appengine.api.urlfetch.FetchOptions">FetchOptions</span>.<span title="object com.google.appengine.api.urlfetch.FetchOptions.Builder">Builder</span>.<span title="()com.google.appengine.api.urlfetch.FetchOptions">disallowTruncate</span>.<span title="()com.google.appengine.api.urlfetch.FetchOptions">doNotFollowRedirects</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Nothing" id="39557">ex</a>: <span title="java.net.URISyntaxException">URISyntaxException</span> =&gt;
        <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.io.IOException" class="keyword">new</span> <span title="java.io.IOException">IOException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Malformed request URI: &quot;)" class="string">&quot;Malformed request URI: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#39557" title="java.net.URISyntaxException">ex</a>.<span title="()java.lang.String">getMessage</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="Nothing" id="39573">ex</a>: <span title="IllegalArgumentException">IllegalArgumentException</span> =&gt;
        <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.io.IOException" class="keyword">new</span> <span title="java.io.IOException">IOException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Unsupported HTTP method: &quot;)" class="string">&quot;Unsupported HTTP method: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#39573" title="IllegalArgumentException">ex</a>.<span title="()java.lang.String">getMessage</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">for</span> <span class="delimiter">(</span><a title="org.apache.http.Header" id="40302">h</a> &lt;- <a href="#39469" title="org.apache.http.HttpRequest">request</a>.<span title="(f: org.apache.http.Header =&gt; Unit)Unit">getAllHeaders</span><span class="delimiter">)</span>
      <a href="#9586" title="GAEClientConnection.this.type" class="keyword">this</a>.<a href="#39166" title="=&gt; com.google.appengine.api.urlfetch.HTTPRequest">request</a>.<span title="(x$1: com.google.appengine.api.urlfetch.HTTPHeader)Unit">addHeader</span><span class="delimiter">(</span><span title="com.google.appengine.api.urlfetch.HTTPHeader" class="keyword">new</span> <span title="com.google.appengine.api.urlfetch.HTTPHeader">HTTPHeader</span><span class="delimiter">(</span><a href="#40302" title="org.apache.http.Header">h</a>.<span title="()java.lang.String">getName</span>, <a href="#40302" title="org.apache.http.Header">h</a>.<span title="()java.lang.String">getValue</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(request: org.apache.http.HttpEntityEnclosingRequest)Unit" id="39189">sendRequestEntity</a><span class="delimiter">(</span><a title="org.apache.http.HttpEntityEnclosingRequest" id="40309">request</a>: <span title="org.apache.http.HttpEntityEnclosingRequest">HttpEntityEnclosingRequest</span> <span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.io.ByteArrayOutputStream" id="40312">baos</a> = <span title="java.io.ByteArrayOutputStream" class="keyword">new</span> <span title="java.io.ByteArrayOutputStream">ByteArrayOutputStream</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#40309" title="org.apache.http.HttpEntityEnclosingRequest">request</a>.<span title="()org.apache.http.HttpEntity">getEntity</span> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
      <a href="#40309" title="org.apache.http.HttpEntityEnclosingRequest">request</a>.<span title="()org.apache.http.HttpEntity">getEntity</span>.<span title="(x$1: java.io.OutputStream)Unit">writeTo</span><span class="delimiter">(</span><a href="#40312" title="java.io.ByteArrayOutputStream">baos</a><span class="delimiter">)</span>
    <a href="#9586" title="GAEClientConnection.this.type" class="keyword">this</a>.<a href="#39166" title="=&gt; com.google.appengine.api.urlfetch.HTTPRequest">request</a>.<span title="(x$1: Array[Byte])Unit">setPayload</span><span class="delimiter">(</span><a href="#40312" title="java.io.ByteArrayOutputStream">baos</a>.<span title="()Array[Byte]">toByteArray</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()org.apache.http.HttpResponse" id="39190">receiveResponseHeader</a>: <span title="org.apache.http.HttpResponse">HttpResponse</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#9586" title="GAEClientConnection.this.type" class="keyword">this</a>.<a href="#39169" title="=&gt; com.google.appengine.api.urlfetch.HTTPResponse">response</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#39192" title="()Unit">flush</a>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="org.apache.http.HttpResponse" id="40344">response</a>: <span title="org.apache.http.HttpResponse">HttpResponse</span> = <span title="(x$1: org.apache.http.ProtocolVersion, x$2: Int, x$3: java.lang.String)org.apache.http.message.BasicHttpResponse" class="keyword">new</span> <span title="org.apache.http.message.BasicHttpResponse">BasicHttpResponse</span><span class="delimiter">(</span><span title="org.apache.http.ProtocolVersion" class="keyword">new</span> <span title="org.apache.http.ProtocolVersion">ProtocolVersion</span><span class="delimiter">(</span><span title="java.lang.String(&quot;HTTP&quot;)" class="string">&quot;HTTP&quot;</span>, <span title="Int(1)" class="int">1</span>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>,
                                                       <a href="#9586" title="GAEClientConnection.this.type" class="keyword">this</a>.<a href="#39169" title="=&gt; com.google.appengine.api.urlfetch.HTTPResponse">response</a>.<span title="()Int">getResponseCode</span>,
                                                       <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="java.util.Iterator[com.google.appengine.api.urlfetch.HTTPHeader]" id="40345">i</a> = <a href="#9586" title="GAEClientConnection.this.type" class="keyword">this</a>.<a href="#39169" title="=&gt; com.google.appengine.api.urlfetch.HTTPResponse">response</a>.<span title="()java.util.List[com.google.appengine.api.urlfetch.HTTPHeader]">getHeaders</span>.<span title="()java.util.Iterator[com.google.appengine.api.urlfetch.HTTPHeader]">iterator</span>
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#40345" title="java.util.Iterator[com.google.appengine.api.urlfetch.HTTPHeader]">i</a>.<span title="()Boolean">hasNext</span><span class="delimiter">)</span> <a href="#40346" title="()Unit" class="delimiter">{</a>
      <span class="keyword">val</span> <a title="com.google.appengine.api.urlfetch.HTTPHeader" id="40553">h</a> = <a href="#40345" title="java.util.Iterator[com.google.appengine.api.urlfetch.HTTPHeader]">i</a>.<span title="()com.google.appengine.api.urlfetch.HTTPHeader">next</span>
      <a href="#40344" title="org.apache.http.HttpResponse">response</a>.<span title="(x$1: java.lang.String, x$2: java.lang.String)Unit">addHeader</span><span class="delimiter">(</span><a href="#40553" title="com.google.appengine.api.urlfetch.HTTPHeader">h</a>.<span title="()java.lang.String">getName</span>, <a href="#40553" title="com.google.appengine.api.urlfetch.HTTPHeader">h</a>.<span title="()java.lang.String">getValue</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="#40344" title="org.apache.http.HttpResponse">response</a>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(response: org.apache.http.HttpResponse)Unit" id="39191">receiveResponseEntity</a><span class="delimiter">(</span><a title="org.apache.http.HttpResponse" id="40556">response</a>: <span title="org.apache.http.HttpResponse">HttpResponse</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#9586" title="GAEClientConnection.this.type" class="keyword">this</a>.<a href="#39169" title="=&gt; com.google.appengine.api.urlfetch.HTTPResponse">response</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.io.IOException" class="keyword">new</span> <span title="java.io.IOException">IOException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;receiveResponseEntity called on closed connection&quot;)" class="string">&quot;receiveResponseEntity called on closed connection&quot;</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="org.apache.http.entity.ByteArrayEntity" id="40559">bae</a> = <span title="org.apache.http.entity.ByteArrayEntity" class="keyword">new</span> <span title="org.apache.http.entity.ByteArrayEntity">ByteArrayEntity</span><span class="delimiter">(</span><a href="#9586" title="GAEClientConnection.this.type" class="keyword">this</a>.<a href="#39169" title="=&gt; com.google.appengine.api.urlfetch.HTTPResponse">response</a>.<span title="()Array[Byte]">getContent</span><span class="delimiter">)</span>
    <a href="#40559" title="org.apache.http.entity.ByteArrayEntity">bae</a>.<span title="(x$1: org.apache.http.Header)Unit">setContentType</span><span class="delimiter">(</span><a href="#40556" title="org.apache.http.HttpResponse">response</a>.<span title="(x$1: java.lang.String)org.apache.http.Header">getFirstHeader</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Content-Type&quot;)" class="string">&quot;Content-Type&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#40556" title="org.apache.http.HttpResponse">response</a>.<span title="(x$1: org.apache.http.HttpEntity)Unit">setEntity</span><span class="delimiter">(</span><a href="#40559" title="org.apache.http.entity.ByteArrayEntity">bae</a><span class="delimiter">)</span>

    <span class="comment">//response = null</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="39192">flush</a> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#39166" title="=&gt; com.google.appengine.api.urlfetch.HTTPRequest">request</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#39169" title="(x$1: com.google.appengine.api.urlfetch.HTTPResponse)Unit">response</a> = <a href="#39259" title="=&gt; com.google.appengine.api.urlfetch.URLFetchService">urlFS</a>.<span title="(x$1: com.google.appengine.api.urlfetch.HTTPRequest)com.google.appengine.api.urlfetch.HTTPResponse">fetch</span><span class="delimiter">(</span><a href="#39166" title="=&gt; com.google.appengine.api.urlfetch.HTTPRequest">request</a><span class="delimiter">)</span>
      <a href="#39166" title="(x$1: com.google.appengine.api.urlfetch.HTTPRequest)Unit">request</a> = <span title="Null(null)" class="keyword">null</span>
    <span class="delimiter">}</span>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#39169" title="(x$1: com.google.appengine.api.urlfetch.HTTPResponse)Unit">response</a> = <span title="Null(null)" class="keyword">null</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="39193">close</a> <span class="delimiter">{</span>
    <a href="#39166" title="(x$1: com.google.appengine.api.urlfetch.HTTPRequest)Unit">request</a>  = <span title="Null(null)" class="keyword">null</span>
    <a href="#39169" title="(x$1: com.google.appengine.api.urlfetch.HTTPResponse)Unit">response</a> = <span title="Null(null)" class="keyword">null</span>
    <a href="#39241" title="(x$1: Boolean)Unit">closed</a>   = <span title="Boolean(true)" class="keyword">true</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Boolean" id="39194">isOpen</a>: <span title="Boolean">Boolean</span> = <span class="delimiter">(</span><a href="#39166" title="=&gt; com.google.appengine.api.urlfetch.HTTPRequest">request</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <span class="delimiter">(</span><a href="#39169" title="=&gt; com.google.appengine.api.urlfetch.HTTPResponse">response</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Boolean" id="39195">isStale</a>: <span title="Boolean">Boolean</span> = <span title="=&gt; Boolean">!</span><a href="#39194" title="()Boolean">isOpen</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#39241" title="=&gt; Boolean">closed</a>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(timeout: Int)Unit" id="39196">setSocketTimeout</a><span class="delimiter">(</span><a title="Int" id="40597">timeout</a>: <span title="Int">Int</span><span class="delimiter">)</span> = <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Int" id="39197">getSocketTimeout</a>: <span title="Int">Int</span> = -<span title="Int(-1)" class="int">1</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="39198">shutdown</a> = <a href="#39193" title="()Unit">close</a>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()org.apache.http.HttpConnectionMetrics" id="39199">getMetrics</a>: <span title="org.apache.http.HttpConnectionMetrics">HttpConnectionMetrics</span> = <span title="Null(null)" class="keyword">null</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()java.net.InetAddress" id="39200">getLocalAddress</a>: <span title="java.net.InetAddress">InetAddress</span> = <span title="Null(null)" class="keyword">null</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Int" id="39201">getLocalPort</a>: <span title="Int">Int</span> = <span title="Int(0)" class="int">0</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()java.net.InetAddress" id="39202">getRemoteAddress</a>: <span title="java.net.InetAddress">InetAddress</span> = <span title="Null(null)" class="keyword">null</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Int" id="39203">getRemotePort</a>: <span title="Int">Int</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="org.apache.http.HttpHost" id="40681">host</a>: <span title="org.apache.http.HttpHost">HttpHost</span> = <a href="#39239" title="=&gt; org.apache.http.conn.routing.HttpRoute">route</a>.<span title="()org.apache.http.HttpHost">getTargetHost</span>
    <a href="#39238" title="=&gt; org.apache.http.conn.ClientConnectionManager">cm</a>.<span title="()org.apache.http.conn.scheme.SchemeRegistry">getSchemeRegistry</span>.<span title="(x$1: org.apache.http.HttpHost)org.apache.http.conn.scheme.Scheme">getScheme</span><span class="delimiter">(</span><a href="#40681" title="org.apache.http.HttpHost">host</a><span class="delimiter">)</span>.<span title="(x$1: Int)Int">resolvePort</span><span class="delimiter">(</span><a href="#40681" title="org.apache.http.HttpHost">host</a>.<span title="()Int">getPort</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="39204">releaseConnection</a> = <a href="#39238" title="=&gt; org.apache.http.conn.ClientConnectionManager">cm</a>.<span title="(x$1: org.apache.http.conn.ManagedClientConnection, x$2: Long, x$3: java.util.concurrent.TimeUnit)Unit">releaseConnection</span><span class="delimiter">(</span><a href="#9586" title="dispatch.gae.GAEClientConnection" class="keyword">this</a>, java.lang.Long.<span title="Long(9223372036854775807L)">MAX_VALUE</span>, TimeUnit.<span title="java.util.concurrent.TimeUnit(value MILLISECONDS)">MILLISECONDS</span><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="39205">abortConnection</a> = <span class="delimiter">{</span>
    <a href="#39182" title="()Unit">unmarkReusable</a>
    <a href="#39198" title="()Unit">shutdown</a>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
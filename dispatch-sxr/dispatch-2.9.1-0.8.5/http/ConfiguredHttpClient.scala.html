<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>http/ConfiguredHttpClient.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> dispatch

<span class="keyword">import</span> org.apache.http.<span class="delimiter">{</span>HttpHost,HttpVersion,HttpRequest,HttpResponse<span class="delimiter">}</span>
<span class="keyword">import</span> org.apache.http.auth.AuthScope
<span class="keyword">import</span> org.apache.http.impl.client.<span class="delimiter">{</span>DefaultHttpClient, BasicCredentialsProvider<span class="delimiter">}</span>
<span class="keyword">import</span> org.apache.http.conn.params.ConnRouteParams
<span class="keyword">import</span> org.apache.http.params.<span class="delimiter">{</span>HttpProtocolParams, BasicHttpParams, HttpParams<span class="delimiter">}</span>

<span class="comment">/** Basic extension of DefaultHttpClient defaulting to Http 1.1, UTF8, and no Expect-Continue.
    Scopes authorization credentials to particular requests thorugh a DynamicVariable. */</span>
<span class="keyword">class</span> <a title="class ConfiguredHttpClient extends org.apache.http.impl.client.DefaultHttpClient with ScalaObject" id="9606">ConfiguredHttpClient</a><a href="#9606" title="ScalaObject" class="delimiter">(</a>
  <a title="dispatch.Http.CurrentCredentials" id="37849">credentials</a>: Http.<span title="dispatch.Http.CurrentCredentials">CurrentCredentials</span>
<span class="delimiter">)</span> <span class="keyword">extends</span> <span title="org.apache.http.impl.client.DefaultHttpClient">DefaultHttpClient</span> <span class="delimiter">{</span> 
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(params: org.apache.http.params.HttpParams)org.apache.http.params.HttpParams" id="37427">configureProxy</a><span class="delimiter">(</span><a title="org.apache.http.params.HttpParams" id="37916">params</a>: <span title="org.apache.http.params.HttpParams">HttpParams</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.util.Properties" id="37919">sys</a> = <span title="object java.lang.System">System</span>.<span title="()java.util.Properties">getProperties</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="java.lang.String" id="37920">host</a> = <a href="#37919" title="java.util.Properties">sys</a>.<span title="(x$1: java.lang.String, x$2: java.lang.String)java.lang.String">getProperty</span><span class="delimiter">(</span><span title="java.lang.String(&quot;https.proxyHost&quot;)" class="string">&quot;https.proxyHost&quot;</span>, <a href="#37919" title="java.util.Properties">sys</a>.<span title="(x$1: java.lang.String)java.lang.String">getProperty</span><span class="delimiter">(</span><span title="java.lang.String(&quot;http.proxyHost&quot;)" class="string">&quot;http.proxyHost&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="java.lang.String" id="37921">port</a> = <a href="#37919" title="java.util.Properties">sys</a>.<span title="(x$1: java.lang.String, x$2: java.lang.String)java.lang.String">getProperty</span><span class="delimiter">(</span><span title="java.lang.String(&quot;https.proxyPort&quot;)" class="string">&quot;https.proxyPort&quot;</span>, <a href="#37919" title="java.util.Properties">sys</a>.<span title="(x$1: java.lang.String)java.lang.String">getProperty</span><span class="delimiter">(</span><span title="java.lang.String(&quot;http.proxyPort&quot;)" class="string">&quot;http.proxyPort&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#37920" title="java.lang.String">host</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#37921" title="java.lang.String">port</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
      <span title="object org.apache.http.conn.params.ConnRouteParams">ConnRouteParams</span>.<span title="(x$1: org.apache.http.params.HttpParams, x$2: org.apache.http.HttpHost)Unit">setDefaultProxy</span><span class="delimiter">(</span><a href="#37916" title="org.apache.http.params.HttpParams">params</a>, <span title="(x$1: java.lang.String, x$2: Int)org.apache.http.HttpHost" class="keyword">new</span> <span title="org.apache.http.HttpHost">HttpHost</span><span class="delimiter">(</span><a href="#37920" title="java.lang.String">host</a>, <a href="#37921" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">port</a>.<span title="=&gt; Int">toInt</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#37916" title="org.apache.http.params.HttpParams">params</a>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()org.apache.http.params.HttpParams" id="37428">createHttpParams</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="org.apache.http.params.BasicHttpParams" id="41916">params</a> = <span title="org.apache.http.params.BasicHttpParams" class="keyword">new</span> <span title="org.apache.http.params.BasicHttpParams">BasicHttpParams</span>
    <span title="object org.apache.http.params.HttpProtocolParams">HttpProtocolParams</span>.<span title="(x$1: org.apache.http.params.HttpParams, x$2: org.apache.http.ProtocolVersion)Unit">setVersion</span><span class="delimiter">(</span><a href="#41916" title="org.apache.http.params.BasicHttpParams">params</a>, <span title="object org.apache.http.HttpVersion">HttpVersion</span>.<span title="org.apache.http.HttpVersion">HTTP_1_1</span><span class="delimiter">)</span>
    <span title="object org.apache.http.params.HttpProtocolParams">HttpProtocolParams</span>.<span title="(x$1: org.apache.http.params.HttpParams, x$2: java.lang.String)Unit">setContentCharset</span><span class="delimiter">(</span><a href="#41916" title="org.apache.http.params.BasicHttpParams">params</a>, <a href="../core/requests.scala.html#9508" title="object dispatch.Request">Request</a>.<a href="../core/requests.scala.html#21860" title="=&gt; java.lang.String">factoryCharset</a><span class="delimiter">)</span>
    <span title="object org.apache.http.params.HttpProtocolParams">HttpProtocolParams</span>.<span title="(x$1: org.apache.http.params.HttpParams, x$2: Boolean)Unit">setUseExpectContinue</span><span class="delimiter">(</span><a href="#41916" title="org.apache.http.params.BasicHttpParams">params</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
    <a href="#37427" title="(params: org.apache.http.params.HttpParams)org.apache.http.params.HttpParams">configureProxy</a><span class="delimiter">(</span><a href="#41916" title="org.apache.http.params.BasicHttpParams">params</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="comment">/** Follow response redirect regardless of request method */</span>
  <a href="#9606" title="(x$1: org.apache.http.client.RedirectStrategy)Unit">setRedirectStrategy</a><span class="delimiter">(</span><a href="#42010" title="org.apache.http.impl.client.DefaultRedirectStrategy" class="keyword">new</a> <a title="anonymous class $anon extends org.apache.http.impl.client.DefaultRedirectStrategy" id="42010">org</a>.apache.http.impl.client.<span title="org.apache.http.impl.client.DefaultRedirectStrategy">DefaultRedirectStrategy</span> <span class="delimiter">{</span>
    <span class="keyword">import</span> org.apache.http.protocol.HttpContext
    <span class="keyword">import</span> org.apache.http.<span title="object org.apache.http.HttpStatus">HttpStatus</span>._
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(req: org.apache.http.HttpRequest, res: org.apache.http.HttpResponse, ctx: org.apache.http.protocol.HttpContext)Boolean" id="42032">isRedirected</a><span class="delimiter">(</span><a title="org.apache.http.HttpRequest" id="42033">req</a>: <span title="org.apache.http.HttpRequest">HttpRequest</span>, <a title="org.apache.http.HttpResponse" id="42034">res</a>: <span title="org.apache.http.HttpResponse">HttpResponse</span>, <a title="org.apache.http.protocol.HttpContext" id="42035">ctx</a>: <span title="org.apache.http.protocol.HttpContext">HttpContext</span><span class="delimiter">)</span> =
      <span class="delimiter">(</span><span title="Int(302)">SC_MOVED_TEMPORARILY</span> <a href="#42086" title="(x: Int)List[Int]">::</a> <span title="Int(301)">SC_MOVED_PERMANENTLY</span> <a href="#42087" title="(x: Int)List[Int]">::</a> <span title="Int(307)">SC_TEMPORARY_REDIRECT</span> <a href="#42088" title="(x: Int)List[Int]">::</a> 
       <span title="Int(303)">SC_SEE_OTHER</span> <a href="#42089" title="(x: Int)List[Int]">::</a> <span title="object Nil">Nil</span><span class="delimiter">)</span> <span title="(elem: Any)Boolean">contains</span> <a href="#42034" title="org.apache.http.HttpResponse">res</a>.<span title="()org.apache.http.StatusLine">getStatusLine</span>.<span title="()Int">getStatusCode</span>
  <span class="delimiter">}</span><span class="delimiter">)</span>
  <a href="#9606" title="(x$1: org.apache.http.client.CredentialsProvider)Unit">setCredentialsProvider</a><span class="delimiter">(</span><a href="#42113" title="org.apache.http.impl.client.BasicCredentialsProvider" class="keyword">new</a> <a title="anonymous class $anon extends org.apache.http.impl.client.BasicCredentialsProvider" id="42113">BasicCredentialsProvider</a> <span class="delimiter">{</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(scope: org.apache.http.auth.AuthScope)org.apache.http.auth.Credentials" id="42125">getCredentials</a><span class="delimiter">(</span><a title="org.apache.http.auth.AuthScope" id="42126">scope</a>: <span title="org.apache.http.auth.AuthScope">AuthScope</span><span class="delimiter">)</span> = <a href="#37849" title="dispatch.Http.CurrentCredentials">credentials</a>.<span title="=&gt; Option[(org.apache.http.auth.AuthScope, dispatch.Credentials)]">value</span> <span title="org.apache.http.auth.Credentials" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="org.apache.http.auth.UsernamePasswordCredentials">Some</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="org.apache.http.auth.AuthScope" id="42134">auth_scope</a>, Credentials<span class="delimiter">(</span><a title="String" id="42135">n</a>, <a title="String" id="42136">p</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#42126" title="org.apache.http.auth.AuthScope">scope</a>.<span title="(x$1: org.apache.http.auth.AuthScope)Int">`match`</span><span class="delimiter">(</span><a href="#42134" title="org.apache.http.auth.AuthScope">auth_scope</a><span class="delimiter">)</span> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(0)" class="int">0</span> =&gt;
        <span title="(x$1: java.lang.String, x$2: java.lang.String)org.apache.http.auth.UsernamePasswordCredentials" class="keyword">new</span> org.apache.http.auth.<span title="org.apache.http.auth.UsernamePasswordCredentials">UsernamePasswordCredentials</span><span class="delimiter">(</span><a href="#42135" title="String">n</a>, <a href="#42136" title="String">p</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Null(null)">_</span> =&gt; <span title="Null(null)" class="keyword">null</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span><span class="delimiter">)</span>
<span class="delimiter">}</span>


        </pre>
    </body>
</html>
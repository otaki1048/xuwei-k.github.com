<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>core/handlers.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> dispatch

<span class="keyword">import</span> org.apache.http.<span class="delimiter">{</span>HttpResponse,HttpEntity<span class="delimiter">}</span>
<span class="keyword">import</span> org.apache.http.util.EntityUtils
<span class="keyword">import</span> java.util.zip.GZIPInputStream
<span class="keyword">import</span> java.io.<span class="delimiter">{</span>InputStream,OutputStream,InputStreamReader<span class="delimiter">}</span>
<span class="keyword">import</span> javax.xml.parsers.SAXParserFactory
<span class="keyword">import</span> scala.io.Source
<span class="keyword">import</span> collection.immutable.<span class="delimiter">{</span>Map =&gt; IMap<span class="delimiter">}</span>
<span class="keyword">import</span> util.control.<span title="object scala.util.control.Exception">Exception</span>._

<span class="comment">/** Request handler, contains request descriptor and a function to transform the result. */</span>
case <span class="keyword">class</span> <a title="class Handler[T] extends java.lang.Object with ScalaObject with Product with Serializable" id="25250">Handler</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="25252">T</a><span class="delimiter">]</span><a href="#25250" title="ScalaObject" class="delimiter">(</a>
  <a title="dispatch.Request" id="25371">request</a>: <a href="requests.scala.html#9510" title="dispatch.Request">Request</a>, 
  <a title="(Int, org.apache.http.HttpResponse, Option[org.apache.http.HttpEntity]) =&gt; T" id="25372">block</a>: Handler.<span title="(Int, org.apache.http.HttpResponse, Option[org.apache.http.HttpEntity]) =&gt; T">F</span><span class="delimiter">[</span>T<span class="delimiter">]</span>, 
  <a title="dispatch.package.ExceptionListener" id="25373">listener</a>: <span title="dispatch.package.ExceptionListener">ExceptionListener</span>
<span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="comment">/** @return new Handler composing after with this Handler's block */</span>
  <span class="keyword">def</span> <a title="[R](after: T =&gt; R)dispatch.Handler[R]" id="25263">~&gt;</a> <span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="25265">R</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="T =&gt; R" id="27507">after</a>: T =&gt; R<span class="delimiter">)</span> = <a href="#25371" title="dispatch.Request" id="27529">copy</a><span class="delimiter">(</span>block=<span class="delimiter">(</span><a title="Int" id="27516">code</a>, <a title="org.apache.http.HttpResponse" id="27517">res</a>, <a title="Option[org.apache.http.HttpEntity]" id="27518">ent</a><span class="delimiter">)</span> =&gt; <a href="#27507" title="(v1: T)R">after</a><span class="delimiter">(</span><a href="#25372" title="(v1: Int, v2: org.apache.http.HttpResponse, v3: Option[org.apache.http.HttpEntity])T">block</a><span class="delimiter">(</span><a href="#27516" title="Int">code</a>,<a href="#27517" title="org.apache.http.HttpResponse">res</a>,<a href="#27518" title="Option[org.apache.http.HttpEntity]">ent</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="comment">/** Set an exception listener */</span>
  <span class="keyword">def</span> <a title="(listener: dispatch.package.ExceptionListener)dispatch.Handler[T]" id="25266">&gt;!</a><span class="delimiter">(</span><a title="dispatch.package.ExceptionListener" id="27531">listener</a>: <span title="dispatch.package.ExceptionListener">ExceptionListener</span><span class="delimiter">)</span> = <a href="#25250" title="Handler.this.type" class="keyword">this</a>.<a href="#25371" title="dispatch.Request" id="27549">copy</a><span class="delimiter">(</span>listener = <a href="#27531" title="dispatch.package.ExceptionListener" id="27547">listener</a><span class="delimiter">)</span>
  <span class="comment">/** Create a new handler with block that receives all response parameters and
      this handler's block converted to parameterless function. */</span>
  <span class="keyword">def</span> <a title="[R](next: (Int, org.apache.http.HttpResponse, Option[org.apache.http.HttpEntity], () =&gt; T) =&gt; R)dispatch.Handler[R]" id="25267">apply</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="25269">R</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="(Int, org.apache.http.HttpResponse, Option[org.apache.http.HttpEntity], () =&gt; T) =&gt; R" id="27550">next</a>: <span class="delimiter">(</span>Int, HttpResponse, Option<span class="delimiter">[</span>HttpEntity<span class="delimiter">]</span>, <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; T<span class="delimiter">)</span> =&gt; R<span class="delimiter">)</span> =
    <a href="#25371" title="dispatch.Request" id="27592">copy</a><span class="delimiter">(</span>block=<span class="delimiter">{</span><span class="delimiter">(</span><a title="Int" id="27559">code</a>, <a title="org.apache.http.HttpResponse" id="27560">res</a>, <a title="Option[org.apache.http.HttpEntity]" id="27561">ent</a><span class="delimiter">)</span> =&gt;
      <a href="#27550" title="(v1: Int, v2: org.apache.http.HttpResponse, v3: Option[org.apache.http.HttpEntity], v4: () =&gt; T)R">next</a><span class="delimiter">(</span><a href="#27559" title="Int">code</a>, <a href="#27560" title="org.apache.http.HttpResponse">res</a>, <a href="#27561" title="Option[org.apache.http.HttpEntity]">ent</a>, <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#25372" title="(v1: Int, v2: org.apache.http.HttpResponse, v3: Option[org.apache.http.HttpEntity])T">block</a><span class="delimiter">(</span><a href="#27559" title="Int">code</a>, <a href="#27560" title="org.apache.http.HttpResponse">res</a>, <a href="#27561" title="Option[org.apache.http.HttpEntity]">ent</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object dispatch.Handler" id="28609">Handler</a> <span title="ScalaObject" class="delimiter">{</span> 
  <span class="keyword">type</span> <a title="[T](Int, org.apache.http.HttpResponse, Option[org.apache.http.HttpEntity]) =&gt; T" id="25240">F</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="25241">T</a><span class="delimiter">]</span> = <span class="delimiter">(</span>Int, HttpResponse, Option<span class="delimiter">[</span>HttpEntity<span class="delimiter">]</span><span class="delimiter">)</span> =&gt; T
  <span class="comment">/** Turns a simple entity handler in into a full response handler that fails if no entity */</span>
  <span class="keyword">def</span> <a title="[T](req: dispatch.Request, block: (Int, org.apache.http.HttpResponse, Option[org.apache.http.HttpEntity]) =&gt; T)dispatch.Handler[T]" id="25242">apply</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="25244">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="dispatch.Request" id="25383">req</a>: <a href="requests.scala.html#9510" title="dispatch.Request">Request</a>, <a title="(Int, org.apache.http.HttpResponse, Option[org.apache.http.HttpEntity]) =&gt; T" id="25384">block</a>: <span title="(Int, org.apache.http.HttpResponse, Option[org.apache.http.HttpEntity]) =&gt; T">F</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#25250" title="dispatch.Handler[T]">Handler</a><span class="delimiter">[</span>T<span class="delimiter">]</span> = <a href="#25250" title="(request: dispatch.Request, block: (Int, org.apache.http.HttpResponse, Option[org.apache.http.HttpEntity]) =&gt; T, listener: dispatch.package.ExceptionListener)dispatch.Handler[T]">Handler</a><span class="delimiter">(</span>
    <a href="#25383" title="dispatch.Request">req</a>, <a href="#25384" title="(Int, org.apache.http.HttpResponse, Option[org.apache.http.HttpEntity]) =&gt; T">block</a>, <span title="=&gt; util.control.Exception.Catcher[Nothing]">nothingCatcher</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="[T](req: dispatch.Request, block: org.apache.http.HttpEntity =&gt; T)dispatch.Handler[T]" id="25245">apply</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="25247">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="dispatch.Request" id="25378">req</a>: <a href="requests.scala.html#9510" title="dispatch.Request">Request</a>, <a title="org.apache.http.HttpEntity =&gt; T" id="25379">block</a>: HttpEntity =&gt; T<span class="delimiter">)</span>: <a href="#25250" title="dispatch.Handler[T]">Handler</a><span class="delimiter">[</span>T<span class="delimiter">]</span> = 
    <a href="#25242" title="(req: dispatch.Request, block: (Int, org.apache.http.HttpResponse, Option[org.apache.http.HttpEntity]) =&gt; T)dispatch.Handler[T]">Handler</a><span class="delimiter">(</span><a href="#25378" title="dispatch.Request">req</a>, <span class="delimiter">{</span> <span class="delimiter">(</span><a title="Int" id="28564">code</a>, <a title="org.apache.http.HttpResponse" id="28565">res</a>, <a title="Option[org.apache.http.HttpEntity]" id="28566">ent</a><span class="delimiter">)</span> =&gt; <a href="#28566" title="Option[org.apache.http.HttpEntity]">ent</a> <span title="T" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="T">Some</span><span class="delimiter">(</span><a title="org.apache.http.HttpEntity" id="28568">ent</a><span class="delimiter">)</span> =&gt; <a href="#25379" title="(v1: org.apache.http.HttpEntity)T">block</a><span class="delimiter">(</span><a href="#28568" title="org.apache.http.HttpEntity">ent</a><span class="delimiter">)</span> 
      <span class="keyword">case</span> <span title="Nothing">None</span> =&gt; <span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;
        | Response has no HttpEntity: %s
        | If no response body is expected, use a handler such as 
        | HandlerVerbs#&gt;| that does not require one.&quot;&quot;&quot;</span>.<span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">stripMargin</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#28565" title="org.apache.http.HttpResponse">res</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="delimiter">}</span> <span class="delimiter">)</span>
  <span class="comment">// retain factory to use with XML.load; its newInstance method is not thread-safe</span>
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="javax.xml.parsers.SAXParserFactory" id="25249">saxParserFactory</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="javax.xml.parsers.SAXParserFactory" id="27655">spf</a> = <span title="object javax.xml.parsers.SAXParserFactory">SAXParserFactory</span>.<span title="()javax.xml.parsers.SAXParserFactory">newInstance</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#27655" title="javax.xml.parsers.SAXParserFactory">spf</a>.<span title="(x$1: Boolean)Unit">setNamespaceAware</span><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
    <a href="#27655" title="javax.xml.parsers.SAXParserFactory">spf</a>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">trait</span> <a title="trait ImplicitHandlerVerbs extends java.lang.Object with ScalaObject" id="9488">ImplicitHandlerVerbs</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit dispatch.ImplicitHandlerVerbs.toHandlerVerbs : (req: dispatch.Request)dispatch.HandlerVerbs" id="21871">toHandlerVerbs</a><span class="delimiter">(</span><a title="dispatch.Request" id="28612">req</a>: <a href="requests.scala.html#9510" title="dispatch.Request">Request</a><span class="delimiter">)</span> = <span title="dispatch.HandlerVerbs" class="keyword">new</span> <a href="#9489" title="dispatch.HandlerVerbs">HandlerVerbs</a><span class="delimiter">(</span><a href="#28612" title="dispatch.Request">req</a><span class="delimiter">)</span>
  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit dispatch.ImplicitHandlerVerbs.stringToHandlerVerbs : (str: String)dispatch.HandlerVerbs" id="21872">stringToHandlerVerbs</a><span class="delimiter">(</span><a title="String" id="28657">str</a>: <span title="String">String</span><span class="delimiter">)</span> = <span title="dispatch.HandlerVerbs" class="keyword">new</span> <a href="#9489" title="dispatch.HandlerVerbs">HandlerVerbs</a><span class="delimiter">(</span><a href="requests.scala.html#13144" title="(str: String)dispatch.Request" class="keyword">new</a> <a href="requests.scala.html#9510" title="dispatch.Request">Request</a><span class="delimiter">(</span><a href="#28657" title="String">str</a><span class="delimiter">)</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class HandlerVerbs extends java.lang.Object with ScalaObject" id="9489">HandlerVerbs</a><a href="#9489" title="ScalaObject" class="delimiter">(</a><a title="dispatch.Request" id="28656">request</a>: <a href="requests.scala.html#9510" title="dispatch.Request">Request</a><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="comment">/** Handle InputStream in block, handle gzip if so encoded. Passes on any charset
      header value from response, otherwise the default charset. (See Request#&gt;\) */</span>
  <span class="keyword">def</span> <a title="[T](block: (java.io.InputStream, String) =&gt; T)dispatch.Handler[T]" id="28618">&gt;&gt;</a> <span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="28620">T</a><span class="delimiter">]</span> <span class="delimiter">(</span><a title="(java.io.InputStream, String) =&gt; T" id="28666">block</a>: <span class="delimiter">(</span>InputStream, String<span class="delimiter">)</span> =&gt; T<span class="delimiter">)</span> = <a href="#25245" title="(req: dispatch.Request, block: org.apache.http.HttpEntity =&gt; T)dispatch.Handler[T]">Handler</a><span class="delimiter">(</span><a href="#28656" title="dispatch.Request">request</a>, <span class="delimiter">{</span> <a title="org.apache.http.HttpEntity" id="28689">ent</a> =&gt;
    <span class="keyword">val</span> <a title="java.io.InputStream" id="28690">stm</a> = <span title="(_1: java.io.InputStream, _2: org.apache.http.Header)(java.io.InputStream, org.apache.http.Header)" class="delimiter">(</span><a href="#28689" title="org.apache.http.HttpEntity">ent</a>.<span title="()java.io.InputStream">getContent</span>, <a href="#28689" title="org.apache.http.HttpEntity">ent</a>.<span title="()org.apache.http.Header">getContentEncoding</span><span class="delimiter">)</span> <span title="java.io.InputStream" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="java.io.InputStream" class="delimiter">(</span><a title="java.io.InputStream" id="28700">stm</a>, <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> =&gt; <a href="#28700" title="java.io.InputStream">stm</a>
      <span class="keyword">case</span> <span title="java.util.zip.GZIPInputStream" class="delimiter">(</span><a title="java.io.InputStream" id="28703">stm</a>, <a title="org.apache.http.Header" id="28704">enc</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#28704" title="org.apache.http.Header">enc</a>.<span title="()java.lang.String">getValue</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;gzip&quot;)" class="string">&quot;gzip&quot;</span> =&gt; <span title="(x$1: java.io.InputStream)java.util.zip.GZIPInputStream" class="keyword">new</span> <span title="java.util.zip.GZIPInputStream">GZIPInputStream</span><span class="delimiter">(</span><a href="#28703" title="java.io.InputStream">stm</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="java.io.InputStream" class="delimiter">(</span><a title="java.io.InputStream" id="28772">stm</a>, _<span class="delimiter">)</span> =&gt; <a href="#28772" title="java.io.InputStream">stm</a>
    <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="String" id="28691">charset</a> = <span title="object org.apache.http.util.EntityUtils">EntityUtils</span>.<span title="(x$1: org.apache.http.HttpEntity)java.lang.String">getContentCharSet</span><span class="delimiter">(</span><a href="#28689" title="org.apache.http.HttpEntity">ent</a><span class="delimiter">)</span> <span title="String" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="String" class="keyword">null</span> =&gt; <a href="#28656" title="dispatch.Request">request</a>.<a href="requests.scala.html#13141" title="=&gt; String">defaultCharset</a>
      <span class="keyword">case</span> <a title="java.lang.String" id="28773">charset</a> =&gt; <a href="#28773" title="java.lang.String">charset</a>
    <span class="delimiter">}</span>
    <span class="keyword">try</span> <span class="delimiter">{</span> <a href="#28666" title="(v1: java.io.InputStream, v2: String)T">block</a><span class="delimiter">(</span><a href="#28690" title="java.io.InputStream">stm</a>, <a href="#28691" title="String">charset</a><span class="delimiter">)</span> <span class="delimiter">}</span>
    <span class="keyword">finally</span> <span class="delimiter">{</span> <a href="#28690" title="java.io.InputStream">stm</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">}</span>
  <span class="delimiter">}</span> <span class="delimiter">)</span>
  <span class="comment">/** Handle InputStream in block, handle gzip if so encoded. */</span>
  <span class="keyword">def</span> <a title="[T](block: java.io.InputStream =&gt; T)dispatch.Handler[T]" id="28621">&gt;&gt;</a> <span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="28623">T</a><span class="delimiter">]</span> <span class="delimiter">(</span><a title="java.io.InputStream =&gt; T" id="28779">block</a>: InputStream =&gt; T<span class="delimiter">)</span>: <a href="#25250" title="dispatch.Handler[T]">Handler</a><span class="delimiter">[</span>T<span class="delimiter">]</span> = <a href="#28618" title="(block: (java.io.InputStream, String) =&gt; T)dispatch.Handler[T]">&gt;&gt;</a> <span class="delimiter">{</span> <span class="delimiter">(</span><a title="java.io.InputStream" id="28793">stm</a>, <a title="String" id="28794">charset</a><span class="delimiter">)</span> =&gt; <a href="#28779" title="(v1: java.io.InputStream)T">block</a><span class="delimiter">(</span><a href="#28793" title="java.io.InputStream">stm</a><span class="delimiter">)</span> <span class="delimiter">}</span>
  <span class="comment">/** Handle response as a scala.io.Source, in a block. Note that Source may fail if the 
      character set it receives (determined in &gt;&gt;) is incorrect. To process resources
      that have incorrect charset headers, use &gt;&gt; ((InputStream, String) =&gt; T). */</span>
  <span class="keyword">def</span> <a title="[T](block: scala.io.Source =&gt; T)dispatch.Handler[T]" id="28624">&gt;~</a> <span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="28626">T</a><span class="delimiter">]</span> <span class="delimiter">(</span><a title="scala.io.Source =&gt; T" id="28797">block</a>: Source =&gt; T<span class="delimiter">)</span> = <a href="#28618" title="(block: (java.io.InputStream, String) =&gt; T)dispatch.Handler[T]">&gt;&gt;</a> <span class="delimiter">{</span> <span class="delimiter">(</span><a title="java.io.InputStream" id="28811">stm</a>, <a title="String" id="28812">charset</a><span class="delimiter">)</span> =&gt; 
    <a href="#28797" title="(v1: scala.io.Source)T">block</a><span class="delimiter">(</span><span title="object scala.io.Source">Source</span>.<span title="(is: java.io.InputStream, enc: String)scala.io.BufferedSource">fromInputStream</span><span class="delimiter">(</span><a href="#28811" title="java.io.InputStream">stm</a>, <a href="#28812" title="String">charset</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="comment">/** Return response as a scala.io.Source. Charset note in &gt;~  applies. */</span>
  <span class="keyword">def</span> <a title="=&gt; dispatch.Handler[scala.io.Source]" id="28627">as_source</a> = <a href="#28624" title="(block: scala.io.Source =&gt; scala.io.Source)dispatch.Handler[scala.io.Source]">&gt;~</a> <span class="delimiter">{</span> <a title="scala.io.Source" id="29252">so</a> =&gt; <a href="#29252" title="scala.io.Source">so</a> <span class="delimiter">}</span>
  <span class="comment">/** Handle some non-huge response body as a String, in a block. Charset note in &gt;~  applies. */</span>
  <span class="keyword">def</span> <a title="[T](block: String =&gt; T)dispatch.Handler[T]" id="28628">&gt;-</a> <span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="28630">T</a><span class="delimiter">]</span> <span class="delimiter">(</span><a title="String =&gt; T" id="29254">block</a>: String =&gt; T<span class="delimiter">)</span> = <a href="#28624" title="(block: scala.io.Source =&gt; T)dispatch.Handler[T]">&gt;~</a> <span class="delimiter">{</span> <a title="scala.io.Source" id="29260">so</a> =&gt; <a href="#29254" title="(v1: String)T">block</a><span class="delimiter">(</span><a href="#29260" title="scala.io.Source">so</a>.<span title="=&gt; String">mkString</span><span class="delimiter">)</span> <span class="delimiter">}</span>
  <span class="comment">/** Return some non-huge response as a String. Charset note in &gt;~  applies.*/</span>
  <span class="keyword">def</span> <a title="=&gt; dispatch.Handler[String]" id="28631">as_str</a> = <a href="#28628" title="(block: String =&gt; String)dispatch.Handler[String]">&gt;-</a> <span class="delimiter">{</span> <a title="String" id="29272">s</a> =&gt; <a href="#29272" title="String">s</a> <span class="delimiter">}</span>
  <span class="comment">/** Handle response as a java.io.Reader */</span>
  <span class="keyword">def</span> <a title="[T](block: java.io.InputStreamReader =&gt; T)dispatch.Handler[T]" id="28632">&gt;&gt;~</a> <span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="28634">T</a><span class="delimiter">]</span> <span class="delimiter">(</span><a title="java.io.InputStreamReader =&gt; T" id="29274">block</a>: InputStreamReader =&gt; T<span class="delimiter">)</span> = <a href="#28618" title="(block: (java.io.InputStream, String) =&gt; T)dispatch.Handler[T]">&gt;&gt;</a> <span class="delimiter">{</span> <span class="delimiter">(</span><a title="java.io.InputStream" id="29288">stm</a>, <a title="String" id="29289">charset</a><span class="delimiter">)</span> =&gt; 
    <a href="#29274" title="(v1: java.io.InputStreamReader)T">block</a><span class="delimiter">(</span><span title="(x$1: java.io.InputStream, x$2: java.lang.String)java.io.InputStreamReader" class="keyword">new</span> <span title="java.io.InputStreamReader">InputStreamReader</span><span class="delimiter">(</span><a href="#29288" title="java.io.InputStream">stm</a>, <a href="#29289" title="String">charset</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="comment">/** Write to the given OutputStream. */</span>
  <span class="keyword">def</span> <a title="[OS &lt;: java.io.OutputStream](out: OS)dispatch.Handler[OS]" id="28635">&gt;&gt;&gt;</a> <span class="delimiter">[</span><a title="&gt;: Nothing &lt;: java.io.OutputStream" id="28637">OS</a> &lt;: OutputStream<span class="delimiter">]</span><span class="delimiter">(</span><a title="OS" id="29381">out</a>: <a href="#28637" title="OS">OS</a><span class="delimiter">)</span> = <a href="#25245" title="(req: dispatch.Request, block: org.apache.http.HttpEntity =&gt; OS)dispatch.Handler[OS]">Handler</a><span class="delimiter">(</span><a href="#28656" title="dispatch.Request">request</a>, <span class="delimiter">{</span> <a title="org.apache.http.HttpEntity" id="29404">ent</a> =&gt; <a href="#29404" title="org.apache.http.HttpEntity">ent</a>.<span title="(x$1: java.io.OutputStream)Unit">writeTo</span><span class="delimiter">(</span><a href="#29381" title="OS">out</a><span class="delimiter">)</span>; <a href="#29381" title="OS">out</a> <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="comment">/** Process response as XML document in block */</span>
  <span class="keyword">def</span> <a title="[T](block: scala.xml.Elem =&gt; T)dispatch.Handler[T]" id="28638">&lt;&gt;</a> <span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="28640">T</a><span class="delimiter">]</span> <span class="delimiter">(</span><a title="scala.xml.Elem =&gt; T" id="29420">block</a>: xml.Elem =&gt; T<span class="delimiter">)</span> = <a href="#28632" title="(block: java.io.InputStreamReader =&gt; T)dispatch.Handler[T]">&gt;&gt;~</a> <span class="delimiter">{</span> <a title="java.io.InputStreamReader" id="29426">reader</a> =&gt; 
    <a href="#29420" title="(v1: scala.xml.Elem)T">block</a><span class="delimiter">(</span>xml.<span title="object scala.xml.XML">XML</span>.<span title="(p: scala.xml.package.SAXParser)scala.xml.factory.XMLLoader[scala.xml.Elem]">withSAXParser</span><span class="delimiter">(</span><a href="#28609" title="object dispatch.Handler">Handler</a>.<a href="#25248" title="=&gt; javax.xml.parsers.SAXParserFactory">saxParserFactory</a>.<span title="()javax.xml.parsers.SAXParser">newSAXParser</span><span class="delimiter">)</span>.<span title="(reader: java.io.Reader)scala.xml.Elem">load</span><span class="delimiter">(</span><a href="#29426" title="java.io.InputStreamReader">reader</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="comment">/** Process response as XHTML document in block, more lenient than &lt;&gt; */</span>
  <span class="keyword">def</span> <a title="[T](block: scala.xml.NodeSeq =&gt; T)dispatch.Handler[T]" id="28641">&lt;/&gt;</a> <span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="28643">T</a><span class="delimiter">]</span> <span class="delimiter">(</span><a title="scala.xml.NodeSeq =&gt; T" id="30159">block</a>: xml.NodeSeq =&gt; T<span class="delimiter">)</span> = <a href="#28624" title="(block: scala.io.Source =&gt; T)dispatch.Handler[T]">&gt;~</a> <span class="delimiter">{</span> <a title="scala.io.Source" id="30165">src</a> =&gt; 
    <a href="#30159" title="(v1: scala.xml.NodeSeq)T">block</a><span class="delimiter">(</span>xml.parsing.<span title="(source: scala.io.Source)scala.xml.NodeSeq">XhtmlParser</span><span class="delimiter">(</span><a href="#30165" title="scala.io.Source">src</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="comment">/** Process header as Map in block. Map returns empty set for header name misses. */</span>
  <span class="keyword">def</span> <a title="[T](block: scala.collection.immutable.Map[String,Set[String]] =&gt; T)dispatch.Handler[T]" id="28644">&gt;:&gt;</a> <span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="28646">T</a><span class="delimiter">]</span> <span class="delimiter">(</span><a title="scala.collection.immutable.Map[String,Set[String]] =&gt; T" id="30385">block</a>: IMap<span class="delimiter">[</span>String, Set<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span> =&gt; T<span class="delimiter">)</span> = 
    <a href="#25242" title="(req: dispatch.Request, block: (Int, org.apache.http.HttpResponse, Option[org.apache.http.HttpEntity]) =&gt; T)dispatch.Handler[T]">Handler</a><span class="delimiter">(</span><a href="#28656" title="dispatch.Request">request</a>, <span class="delimiter">(</span><a title="Int" id="30408">_</a>, <a title="org.apache.http.HttpResponse" id="30409">res</a>, <a title="Option[org.apache.http.HttpEntity]" id="30410">_</a><span class="delimiter">)</span> =&gt; 
      <a href="#30385" title="(v1: scala.collection.immutable.Map[String,Set[String]])T">block</a><span class="delimiter">(</span><span class="delimiter">(</span><span title="[A, B](elems: (A, B)*)scala.collection.immutable.Map[A,B]">IMap</span><span title="(elems: (String, Set[String])*)scala.collection.immutable.Map[String,Set[String]]" class="delimiter">[</span><span title="String">String</span>, <span title="Set[String]">Set</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(d: Set[String])scala.collection.immutable.Map[String,Set[String]]">withDefaultValue</span><span class="delimiter">(</span><span title="(elems: String*)scala.collection.immutable.Set[String]">Set</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#30738" title="(z: scala.collection.immutable.Map[String,Set[String]])(op: (scala.collection.immutable.Map[String,Set[String]], org.apache.http.Header) =&gt; scala.collection.immutable.Map[String,Set[String]])scala.collection.immutable.Map[String,Set[String]]">/:</a> <a href="#30409" title="org.apache.http.HttpResponse">res</a>.<span title="(xs: Array[org.apache.http.Header])scala.collection.mutable.ArrayOps[org.apache.http.Header]">getAllHeaders</span><span class="delimiter">)</span> <span class="delimiter">{</span> 
        <span class="delimiter">(</span><a title="scala.collection.immutable.Map[String,Set[String]]" id="31615">m</a>, <a title="org.apache.http.Header" id="31616">h</a><span class="delimiter">)</span> =&gt; <a href="#31615" title="scala.collection.immutable.Map[String,Set[String]]">m</a> <span title="(kv: (String, Set[String]))scala.collection.immutable.Map[String,Set[String]]">+</span> <span class="delimiter">(</span><a href="#31616" title="org.apache.http.Header">h</a>.<span title="(x: java.lang.String)ArrowAssoc[java.lang.String]">getName</span> <span title="(y: scala.collection.immutable.Set[String])(java.lang.String, scala.collection.immutable.Set[String])">-&gt;</span> <span class="delimiter">(</span><a href="#31615" title="(key: String)Set[String]">m</a><span class="delimiter">(</span><a href="#31616" title="org.apache.http.Header">h</a>.<span title="()java.lang.String">getName</span><span class="delimiter">)</span> <span title="(elem: String)scala.collection.immutable.Set[String]">+</span> <a href="#31616" title="org.apache.http.Header">h</a>.<span title="()java.lang.String">getValue</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="delimiter">)</span>
    <span class="delimiter">)</span>
  
  <span class="comment">/** Ignore response body. */</span>
  <span class="keyword">def</span> <a title="=&gt; dispatch.Handler[Unit]" id="28647">&gt;|</a> = <a href="#25242" title="(req: dispatch.Request, block: (Int, org.apache.http.HttpResponse, Option[org.apache.http.HttpEntity]) =&gt; Unit)dispatch.Handler[Unit]">Handler</a><span class="delimiter">(</span><a href="#28656" title="dispatch.Request">request</a>, <span class="delimiter">(</span><a title="Int" id="31801">code</a>, <a title="org.apache.http.HttpResponse" id="31802">res</a>, <a title="Option[org.apache.http.HttpEntity]" id="31803">ent</a><span class="delimiter">)</span> =&gt; <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/** Split into two request handlers, return results of each in tuple. */</span>
  <span class="keyword">def</span> <a title="[A, B](block: dispatch.HandlerVerbs =&gt; (dispatch.Handler[A], dispatch.Handler[B]))dispatch.Handler[(A, B)]" id="28648">&gt;+</a> <span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="28651">A</a>, <a title="&gt;: Nothing &lt;: Any" id="28652">B</a><span class="delimiter">]</span> <span class="delimiter">(</span><a title="dispatch.HandlerVerbs =&gt; (dispatch.Handler[A], dispatch.Handler[B])" id="31806">block</a>: HandlerVerbs =&gt; <span class="delimiter">(</span>Handler<span class="delimiter">[</span>A<span class="delimiter">]</span>, Handler<span class="delimiter">[</span>B<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#25242" title="(req: dispatch.Request, block: (Int, org.apache.http.HttpResponse, Option[org.apache.http.HttpEntity]) =&gt; (A, B))dispatch.Handler[(A, B)]">Handler</a><span class="delimiter">(</span><a href="#28656" title="dispatch.Request">request</a>, <span class="delimiter">{</span> <span class="delimiter">(</span><a title="Int" id="31829">code</a>, <a title="org.apache.http.HttpResponse" id="31830">res</a>, <a title="Option[org.apache.http.HttpEntity]" id="31831">opt_ent</a><span class="delimiter">)</span> =&gt;
      <span class="keyword">val</span> <a href="#31833" title="(dispatch.Handler[A], dispatch.Handler[B])" class="delimiter">(</a><a href="#31832" title="dispatch.Handler[A]" id="31833">a</a>, <a href="#31832" title="dispatch.Handler[B]" id="31834">b</a><span class="delimiter">)</span> = <a href="#31806" title="(v1: dispatch.HandlerVerbs)(dispatch.Handler[A], dispatch.Handler[B])">block</a><span title="(dispatch.Handler[A], dispatch.Handler[B]) @unchecked" class="delimiter">(</span><span title="dispatch.HandlerVerbs" class="keyword">new</span> <a href="#9489" title="dispatch.HandlerVerbs">HandlerVerbs</a><span class="delimiter">(</span> <a href="requests.scala.html#9515" title="object dispatch./\">/\</a> <span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="(_1: A, _2: B)(A, B)" class="delimiter">(</span><a href="#31833" title="dispatch.Handler[A]">a</a>.<a href="#25372" title="(v1: Int, v2: org.apache.http.HttpResponse, v3: Option[org.apache.http.HttpEntity])A">block</a><span class="delimiter">(</span><a href="#31829" title="Int">code</a>, <a href="#31830" title="org.apache.http.HttpResponse">res</a>, <a href="#31831" title="Option[org.apache.http.HttpEntity]">opt_ent</a><span class="delimiter">)</span>, <a href="#31834" title="dispatch.Handler[B]">b</a>.<a href="#25372" title="(v1: Int, v2: org.apache.http.HttpResponse, v3: Option[org.apache.http.HttpEntity])B">block</a><span class="delimiter">(</span><a href="#31829" title="Int">code</a>,<a href="#31830" title="org.apache.http.HttpResponse">res</a>,<a href="#31831" title="Option[org.apache.http.HttpEntity]">opt_ent</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="comment">/** Chain two request handlers. First handler returns a second, which may use
      values obtained by the first. Both are run on the same request. */</span>
  <span class="keyword">def</span> <a title="[T](block: dispatch.HandlerVerbs =&gt; dispatch.Handler[dispatch.Handler[T]])dispatch.Handler[T]" id="28653">&gt;+&gt;</a> <span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="28655">T</a><span class="delimiter">]</span> <span class="delimiter">(</span><a title="dispatch.HandlerVerbs =&gt; dispatch.Handler[dispatch.Handler[T]]" id="31863">block</a>: HandlerVerbs =&gt; Handler<span class="delimiter">[</span>Handler<span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#25242" title="(req: dispatch.Request, block: (Int, org.apache.http.HttpResponse, Option[org.apache.http.HttpEntity]) =&gt; T)dispatch.Handler[T]">Handler</a><span class="delimiter">(</span> <a href="#28656" title="dispatch.Request">request</a>, <span class="delimiter">{</span> <span class="delimiter">(</span><a title="Int" id="31886">code</a>, <a title="org.apache.http.HttpResponse" id="31887">res</a>, <a title="Option[org.apache.http.HttpEntity]" id="31888">opt_ent</a><span class="delimiter">)</span> =&gt;
      <span class="delimiter">(</span><a href="#31863" title="(v1: dispatch.HandlerVerbs)dispatch.Handler[dispatch.Handler[T]]">block</a><span class="delimiter">(</span><span title="dispatch.HandlerVerbs" class="keyword">new</span> <a href="#9489" title="dispatch.HandlerVerbs">HandlerVerbs</a><span class="delimiter">(</span> <a href="requests.scala.html#9515" title="object dispatch./\">/\</a> <span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="#25372" title="(v1: Int, v2: org.apache.http.HttpResponse, v3: Option[org.apache.http.HttpEntity])dispatch.Handler[T]">block</a><span class="delimiter">(</span><a href="#31886" title="Int">code</a>, <a href="#31887" title="org.apache.http.HttpResponse">res</a>, <a href="#31888" title="Option[org.apache.http.HttpEntity]">opt_ent</a><span class="delimiter">)</span>.<a href="#25372" title="(v1: Int, v2: org.apache.http.HttpResponse, v3: Option[org.apache.http.HttpEntity])T">block</a><span class="delimiter">(</span><a href="#31886" title="Int">code</a>, <a href="#31887" title="org.apache.http.HttpResponse">res</a>, <a href="#31888" title="Option[org.apache.http.HttpEntity]">opt_ent</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>core/callbacks.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> dispatch

<span class="keyword">import</span> org.apache.http.HttpResponse
<span class="keyword">import</span> util.control.<span title="object scala.util.control.Exception">Exception</span>._

<span class="keyword">object</span> <a title="object dispatch.Callback" id="24511">Callback</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">type</span> <a title="(org.apache.http.HttpResponse, Array[Byte], Int) =&gt; Unit" id="10427">Function</a> = <span class="delimiter">(</span>HttpResponse, Array<span class="delimiter">[</span>Byte<span class="delimiter">]</span>, Int<span class="delimiter">)</span> =&gt; Unit
  <span class="keyword">type</span> <a title="[T]org.apache.http.HttpResponse =&gt; T" id="10428">Finish</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="10429">T</a><span class="delimiter">]</span> = HttpResponse =&gt; T

  <span class="keyword">def</span> <a title="[T](request: dispatch.Request, function: (org.apache.http.HttpResponse, Array[Byte], Int) =&gt; Unit, finish: org.apache.http.HttpResponse =&gt; T)dispatch.Callback[T]" id="10430">apply</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="10432">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="dispatch.Request" id="13107">request</a>: <a href="requests.scala.html#9510" title="dispatch.Request">Request</a>, 
               <a title="(org.apache.http.HttpResponse, Array[Byte], Int) =&gt; Unit" id="13108">function</a>: Callback.<span title="(org.apache.http.HttpResponse, Array[Byte], Int) =&gt; Unit">Function</span>, 
               <a title="org.apache.http.HttpResponse =&gt; T" id="13109">finish</a>: Callback.<span title="org.apache.http.HttpResponse =&gt; T">Finish</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#24693" title="dispatch.Callback[T]">Callback</a><span class="delimiter">[</span>T<span class="delimiter">]</span> =
    <a href="#24693" title="(request: dispatch.Request, function: (org.apache.http.HttpResponse, Array[Byte], Int) =&gt; Unit, finish: org.apache.http.HttpResponse =&gt; T, listener: dispatch.package.ExceptionListener)dispatch.Callback[T]">Callback</a><span class="delimiter">(</span><a href="#13107" title="dispatch.Request">request</a>, <a href="#13108" title="(org.apache.http.HttpResponse, Array[Byte], Int) =&gt; Unit">function</a>, <a href="#13109" title="org.apache.http.HttpResponse =&gt; T">finish</a>, <span title="=&gt; util.control.Exception.Catcher[Nothing]">nothingCatcher</span><span class="delimiter">)</span>
                  

  <span class="keyword">def</span> <a title="(request: dispatch.Request, function: (org.apache.http.HttpResponse, Array[Byte], Int) =&gt; Unit)dispatch.Callback[Unit]" id="10433">apply</a><span class="delimiter">(</span><a title="dispatch.Request" id="13159">request</a>: <a href="requests.scala.html#9510" title="dispatch.Request">Request</a>, <a title="(org.apache.http.HttpResponse, Array[Byte], Int) =&gt; Unit" id="13160">function</a>: Callback.<span title="(org.apache.http.HttpResponse, Array[Byte], Int) =&gt; Unit">Function</span><span class="delimiter">)</span>: <a href="#24693" title="dispatch.Callback[Unit]">Callback</a><span class="delimiter">[</span>Unit<span class="delimiter">]</span> = 
    <a href="#10430" title="(request: dispatch.Request, function: (org.apache.http.HttpResponse, Array[Byte], Int) =&gt; Unit, finish: org.apache.http.HttpResponse =&gt; Unit)dispatch.Callback[Unit]">Callback</a><span class="delimiter">(</span><a href="#13159" title="dispatch.Request">request</a>, <a href="#13160" title="(org.apache.http.HttpResponse, Array[Byte], Int) =&gt; Unit">function</a>, <span class="delimiter">{</span> <a title="org.apache.http.HttpResponse" id="13304">_</a> =&gt; <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">}</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="[T](req: dispatch.Request, block: String =&gt; Unit)dispatch.Callback[Unit]" id="10434">strings</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="10436">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="dispatch.Request" id="13308">req</a>: <a href="requests.scala.html#9510" title="dispatch.Request">Request</a>, <a title="String =&gt; Unit" id="13309">block</a>: <span class="delimiter">(</span>String =&gt; Unit<span class="delimiter">)</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    @volatile <span class="keyword">var</span> <a title="Option[String]" id="13312">charset</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span title="object None">None</span>
    <a href="#10433" title="(request: dispatch.Request, function: (org.apache.http.HttpResponse, Array[Byte], Int) =&gt; Unit)dispatch.Callback[Unit]">Callback</a><span class="delimiter">(</span>
      <a href="#13308" title="dispatch.Request">req</a>,
      <span class="delimiter">(</span><a title="org.apache.http.HttpResponse" id="13433">res</a>, <a title="Array[Byte]" id="13434">bytes</a>, <a title="Int" id="13435">len</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="#13312" title="Option[String]">charset</a> <span title="(alternative: =&gt; Option[String])Option[String]">orElse</span> <span class="delimiter">{</span>
          <a href="#13312" title="Option[String]">charset</a> = <span class="delimiter">(</span><span class="keyword">for</span> <span class="delimiter">{</span>
            <a title="org.apache.http.Header" id="21730">ct</a> &lt;- <a href="#13433" title="org.apache.http.HttpResponse">res</a>.<span title="(x$1: java.lang.String)Array[org.apache.http.Header]">getHeaders</span><span title="(xs: Array[org.apache.http.Header])scala.collection.mutable.ArrayOps[org.apache.http.Header]" class="delimiter">(</span><span title="java.lang.String(&quot;Content-Type&quot;)" class="string">&quot;Content-Type&quot;</span><span class="delimiter">)</span>.<span title="(f: org.apache.http.Header =&gt; Option[java.lang.String])Option[java.lang.String]">headOption</span>
            <a title="org.apache.http.HeaderElement" id="21808">elem</a> &lt;- <a href="#21730" title="org.apache.http.Header">ct</a>.<span title="(xs: Array[org.apache.http.HeaderElement])scala.collection.mutable.ArrayOps[org.apache.http.HeaderElement]">getElements</span>.<span title="(f: org.apache.http.HeaderElement =&gt; Option[java.lang.String])Option[java.lang.String]">headOption</span>
            <a title="org.apache.http.NameValuePair" id="21818">param</a> &lt;- <span title="(x: org.apache.http.NameValuePair)Option[org.apache.http.NameValuePair]">Option</span><span title="(f: org.apache.http.NameValuePair =&gt; java.lang.String)Option[java.lang.String]" class="delimiter">(</span><a href="#21808" title="org.apache.http.HeaderElement">elem</a>.<span title="(x$1: java.lang.String)org.apache.http.NameValuePair">getParameterByName</span><span class="delimiter">(</span><span title="java.lang.String(&quot;charset&quot;)" class="string">&quot;charset&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="#21818" title="org.apache.http.NameValuePair">param</a>.<span title="()java.lang.String">getValue</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(alternative: =&gt; Option[java.lang.String])Option[java.lang.String]">orElse</span> <span title="(x: java.lang.String)Some[java.lang.String]">Some</span><span class="delimiter">(</span><a href="requests.scala.html#9508" title="object dispatch.Request">Request</a>.<a href="requests.scala.html#21860" title="=&gt; java.lang.String">factoryCharset</a><span class="delimiter">)</span>
          <a href="#13312" title="Option[String]">charset</a>
        <span class="delimiter">}</span> <span title="(f: String =&gt; Unit)Option[Unit]">map</span> <span class="delimiter">{</span> <a title="String" id="22002">cs</a> =&gt; <a href="#13309" title="(v1: String)Unit">block</a><span class="delimiter">(</span><span title="(x$1: Array[Byte], x$2: Int, x$3: Int, x$4: java.lang.String)java.lang.String" class="keyword">new</span> <span title="java.lang.String">String</span><span class="delimiter">(</span><a href="#13434" title="Array[Byte]">bytes</a>, <span title="Int(0)" class="int">0</span>, <a href="#13435" title="Int">len</a>, <a href="#22002" title="String">cs</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Divide input up by given regex. Buffers across inputs so strings are
   * only split on the divider, and handles any leftovers in finish. Skips
   * empty strings. */</span>
  <span class="keyword">def</span> <a title="[T](divider: String)(req: dispatch.Request, block: String =&gt; Unit)dispatch.Callback[Unit]" id="10437">stringsBy</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="10439">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="String" id="22785">divider</a>: <span title="String">String</span><span class="delimiter">)</span>
                  <span class="delimiter">(</span><a title="dispatch.Request" id="22786">req</a>: <a href="requests.scala.html#9510" title="dispatch.Request">Request</a>, <a title="String =&gt; Unit" id="22787">block</a>: <span class="delimiter">(</span>String =&gt; Unit<span class="delimiter">)</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="java.lang.String" id="22790">buffer</a> = <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>
    <a href="#10434" title="(req: dispatch.Request, block: String =&gt; Unit)dispatch.Callback[Unit]">strings</a><span class="delimiter">(</span>
      <a href="#22786" title="dispatch.Request">req</a>,
      <span class="delimiter">{</span> <a title="String" id="22793">string</a> =&gt;
        <span class="keyword">val</span> <a title="Array[java.lang.String]" id="22794">strings</a> = <span class="delimiter">(</span><a href="#22790" title="java.lang.String">buffer</a> <span title="(x$1: Any)java.lang.String">+</span> <a href="#22793" title="String">string</a><span class="delimiter">)</span>.<span title="(x$1: java.lang.String, x$2: Int)Array[java.lang.String]">split</span><span class="delimiter">(</span><a href="#22785" title="String">divider</a>, -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span>
        <a href="#22794" title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]">strings</a>.<span title="(n: Int)Array[java.lang.String]">take</span><span title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">(</span><a href="#22794" title="Array[java.lang.String]">strings</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="(p: java.lang.String =&gt; Boolean)Array[java.lang.String]">filter</span> <span title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">{</span> <span title="=&gt; Boolean">!</span><a href="#23555" title="java.lang.String">_</a>.<span title="()Boolean">isEmpty</span> <span class="delimiter">}</span>.<span title="(f: java.lang.String =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#22787" title="String =&gt; Unit">block</a><span class="delimiter">)</span>
        <a href="#22790" title="java.lang.String">buffer</a> = <a href="#22794" title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]">strings</a>.<span title="=&gt; java.lang.String">last</span>
      <span class="delimiter">}</span>
    <span class="delimiter">)</span> <a href="#10478" title="(finish: org.apache.http.HttpResponse =&gt; Unit)dispatch.Callback[Unit]">^&gt;</a> <span class="delimiter">{</span> <a title="org.apache.http.HttpResponse" id="24454">res</a> =&gt; 
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#22790" title="java.lang.String">buffer</a>.<span title="()Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#22787" title="(v1: String)Unit">block</a><span class="delimiter">(</span><a href="#22790" title="java.lang.String">buffer</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  <span class="comment">/** callback transformer for strings split on the newline character, newline removed */</span>
  <span class="keyword">def</span> <a title="[T]=&gt; (dispatch.Request, String =&gt; Unit) =&gt; dispatch.Callback[Unit]" id="10440">lines</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="10442">T</a><span class="delimiter">]</span> = <a href="#10437" title="[T](divider: String)(req: dispatch.Request, block: String =&gt; Unit)dispatch.Callback[Unit]">stringsBy</a><span title="(divider: String)(req: dispatch.Request, block: String =&gt; Unit)dispatch.Callback[Unit]" class="delimiter">[</span><a href="#10442" title="T">T</a><span class="delimiter">]</span><a href="#24461" title="dispatch.Request" class="delimiter">(</a><span title="java.lang.String(&quot;[\012\015]+&quot;)" class="string">&quot;[\n\r]+&quot;</span><span class="delimiter">)</span>_
<span class="delimiter">}</span>

case <span class="keyword">class</span> <a title="[T](x$0: dispatch.Callback[T])Option[(dispatch.Request, (org.apache.http.HttpResponse, Array[Byte], Int) =&gt; Unit, org.apache.http.HttpResponse =&gt; T, dispatch.package.ExceptionListener)]" id="24693">Callback</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="10488">T</a><span class="delimiter">]</span><a href="#24693" title="ScalaObject" class="delimiter">(</a><a title="dispatch.Request" id="24400">request</a>: <a href="requests.scala.html#9510" title="dispatch.Request">Request</a>,
                       <a title="(org.apache.http.HttpResponse, Array[Byte], Int) =&gt; Unit" id="24401">function</a>: Callback.<span title="(org.apache.http.HttpResponse, Array[Byte], Int) =&gt; Unit">Function</span>, 
                       <a title="org.apache.http.HttpResponse =&gt; T" id="24402">finish</a>: Callback.<span title="org.apache.http.HttpResponse =&gt; T">Finish</span><span class="delimiter">[</span>T<span class="delimiter">]</span>,
                       <a title="dispatch.package.ExceptionListener" id="24403">listener</a>: <span title="dispatch.package.ExceptionListener">ExceptionListener</span><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="[T](finish: org.apache.http.HttpResponse =&gt; T)dispatch.Callback[T]" id="10478">^&gt;</a> <span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="10480">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="org.apache.http.HttpResponse =&gt; T" id="24397">finish</a>: Callback.<span title="org.apache.http.HttpResponse =&gt; T">Finish</span><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#24400" title="dispatch.Request" id="24449">copy</a><span class="delimiter">(</span>finish=<span class="delimiter">{</span> <a title="org.apache.http.HttpResponse" id="24438">res</a> =&gt;
    <a href="#24693" title="Callback.this.type" class="keyword">this</a>.<a href="#24402" title="(v1: org.apache.http.HttpResponse)T">finish</a><span class="delimiter">(</span><a href="#24438" title="org.apache.http.HttpResponse">res</a><span class="delimiter">)</span>
    <a href="#24397" title="(v1: org.apache.http.HttpResponse)T">finish</a><span class="delimiter">(</span><a href="#24438" title="org.apache.http.HttpResponse">res</a><span class="delimiter">)</span>
  <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="comment">/** Set an exception listener */</span>
  <span class="keyword">def</span> <a title="(listener: dispatch.package.ExceptionListener)dispatch.Callback[T]" id="10481">^!</a><span class="delimiter">(</span><a title="dispatch.package.ExceptionListener" id="24517">listener</a>: <span title="dispatch.package.ExceptionListener">ExceptionListener</span><span class="delimiter">)</span> = <a href="#24693" title="Callback.this.type" class="keyword">this</a>.<a href="#24400" title="dispatch.Request" id="24538">copy</a><span class="delimiter">(</span>listener = <a href="#24517" title="dispatch.package.ExceptionListener" id="24535">listener</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="keyword">trait</span> <a title="trait ImplicitCallbackVerbs extends java.lang.Object with ScalaObject" id="9457">ImplicitCallbackVerbs</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit dispatch.ImplicitCallbackVerbs.toCallbackVerbs : (req: dispatch.Request)dispatch.CallbackVerbs" id="21874">toCallbackVerbs</a><span class="delimiter">(</span><a title="dispatch.Request" id="24697">req</a>: <a href="requests.scala.html#9510" title="dispatch.Request">Request</a><span class="delimiter">)</span> = <span title="dispatch.CallbackVerbs" class="keyword">new</span> <a href="#9458" title="dispatch.CallbackVerbs">CallbackVerbs</a><span class="delimiter">(</span><a href="#24697" title="dispatch.Request">req</a><span class="delimiter">)</span>
  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit dispatch.ImplicitCallbackVerbs.stringToCallbackVerbs : (str: String)dispatch.CallbackVerbs" id="21875">stringToCallbackVerbs</a><span class="delimiter">(</span><a title="String" id="24714">str</a>: <span title="String">String</span><span class="delimiter">)</span> = <span title="dispatch.CallbackVerbs" class="keyword">new</span> <a href="#9458" title="dispatch.CallbackVerbs">CallbackVerbs</a><span class="delimiter">(</span><a href="requests.scala.html#13144" title="(str: String)dispatch.Request" class="keyword">new</a> <a href="requests.scala.html#9510" title="dispatch.Request">Request</a><span class="delimiter">(</span><a href="#24714" title="String">str</a><span class="delimiter">)</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class CallbackVerbs extends java.lang.Object with ScalaObject" id="9458">CallbackVerbs</a><a href="#9458" title="ScalaObject" class="delimiter">(</a><a title="dispatch.Request" id="24713">subject</a>: <a href="requests.scala.html#9510" title="dispatch.Request">Request</a><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="keyword">import</span> <a href="#24511" title="object dispatch.Callback">Callback</a>._
  <span class="keyword">def</span> <a title="[T](callback: (org.apache.http.HttpResponse, Array[Byte], Int) =&gt; Unit)dispatch.Callback[Unit]" id="24704">^</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="24706">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="(org.apache.http.HttpResponse, Array[Byte], Int) =&gt; Unit" id="24769">callback</a>: <span title="(org.apache.http.HttpResponse, Array[Byte], Int) =&gt; Unit">Function</span><span class="delimiter">)</span> = <a href="#10433" title="(request: dispatch.Request, function: (org.apache.http.HttpResponse, Array[Byte], Int) =&gt; Unit)dispatch.Callback[Unit]">Callback</a><span class="delimiter">(</span><a href="#24713" title="dispatch.Request">subject</a>, <a href="#24769" title="(org.apache.http.HttpResponse, Array[Byte], Int) =&gt; Unit">callback</a><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="[T](callback: String =&gt; Unit)dispatch.Callback[Unit]" id="24707">^-</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="24709">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="String =&gt; Unit" id="24904">callback</a>: String =&gt; Unit<span class="delimiter">)</span> = <a href="#10434" title="(req: dispatch.Request, block: String =&gt; Unit)dispatch.Callback[Unit]">strings</a><span class="delimiter">(</span><a href="#24713" title="dispatch.Request">subject</a>, <a href="#24904" title="String =&gt; Unit">callback</a><span class="delimiter">)</span>
  <span class="comment">/** strings split on the newline character, newline removed */</span>
  <span class="keyword">def</span> <a title="[T](callback: String =&gt; Unit)dispatch.Callback[Unit]" id="24710">^--</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="24712">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="String =&gt; Unit" id="24908">callback</a>: String =&gt; Unit<span class="delimiter">)</span> = <a href="#10440" title="(v1: dispatch.Request, v2: String =&gt; Unit)dispatch.Callback[Unit]">lines</a><span class="delimiter">(</span><a href="#24713" title="dispatch.Request">subject</a>, <a href="#24908" title="String =&gt; Unit">callback</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
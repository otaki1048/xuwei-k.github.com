<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>nio/nio.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> dispatch.nio

<span class="keyword">import</span> dispatch.<span class="delimiter">{</span>Callback,Request,ExceptionListener<span class="delimiter">}</span>
<span class="keyword">import</span> org.apache.http.<span class="delimiter">{</span>HttpHost,HttpRequest,HttpResponse,HttpEntity,HttpException<span class="delimiter">}</span>
<span class="keyword">import</span> org.apache.http.message.BasicHttpEntityEnclosingRequest
<span class="keyword">import</span> org.apache.http.protocol._
<span class="keyword">import</span> org.apache.http.impl.nio.client.<span class="delimiter">{</span>DefaultHttpAsyncClient,BasicHttpAsyncRequestProducer=&gt;Producer<span class="delimiter">}</span>
<span class="keyword">import</span> org.apache.http.client.methods._
<span class="keyword">import</span> org.apache.http.params.CoreConnectionPNames
<span class="keyword">import</span> org.apache.http.params.CoreProtocolPNames
<span class="keyword">import</span> org.apache.http.nio.<span class="delimiter">{</span>ContentDecoder,IOControl,NHttpConnection<span class="delimiter">}</span>
<span class="keyword">import</span> org.apache.http.nio.entity.<span class="delimiter">{</span>ConsumingNHttpEntity,BufferingNHttpEntity<span class="delimiter">}</span>
<span class="keyword">import</span> org.apache.http.nio.client.HttpAsyncResponseConsumer
<span class="keyword">import</span> org.apache.http.nio.concurrent.FutureCallback
<span class="keyword">import</span> org.apache.http.nio.util.HeapByteBufferAllocator
<span class="keyword">import</span> java.util.concurrent.Future
<span class="keyword">import</span> java.io.IOException

<span class="keyword">object</span> <a title="object dispatch.nio.Http" id="9735">Http</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">val</span> <a title="Int" id="53847">socket_buffer_size</a> = <span class="int">8</span> <span title="Int(8192)">*</span> <span class="int">1024</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class Http extends java.lang.Object with dispatch.HttpExecutor with ScalaObject" id="9737">Http</a> <a href="#9737" title="ScalaObject" class="keyword">extends</a> dispatch.<a href="../core/executor.scala.html#9466" title="dispatch.HttpExecutor">HttpExecutor</a> <span class="delimiter">{</span>
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="org.apache.http.impl.nio.client.DefaultHttpAsyncClient" id="53851">client</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="org.apache.http.impl.nio.client.DefaultHttpAsyncClient" id="53879">cl</a> = <a href="#53852" title="=&gt; org.apache.http.impl.nio.client.DefaultHttpAsyncClient">make_client</a>
    <a href="#53879" title="org.apache.http.impl.nio.client.DefaultHttpAsyncClient">cl</a>.<span title="()Unit">start</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#53879" title="org.apache.http.impl.nio.client.DefaultHttpAsyncClient">cl</a>
  <span class="delimiter">}</span>
  <span class="keyword">def</span> <a title="=&gt; org.apache.http.impl.nio.client.DefaultHttpAsyncClient" id="53852">make_client</a> = <span title="()org.apache.http.impl.nio.client.DefaultHttpAsyncClient" class="keyword">new</span> <span title="org.apache.http.impl.nio.client.DefaultHttpAsyncClient">DefaultHttpAsyncClient</span>

  <span class="keyword">type</span> <a title="[T]dispatch.futures.StoppableFuture[T]" id="53853">HttpPackage</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="53854">T</a><span class="delimiter">]</span> = dispatch.futures.<a href="../futures/Futures.scala.html#9548" title="dispatch.futures.StoppableFuture[T]">StoppableFuture</a><span class="delimiter">[</span>T<span class="delimiter">]</span>

  <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class StoppableConsumer[T] extends java.lang.Object with org.apache.http.nio.client.HttpAsyncResponseConsumer[T] with ScalaObject" id="53855">StoppableConsumer</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="53856">T</a><span class="delimiter">]</span><a href="#53855" title="ScalaObject" class="delimiter">(</a>
    <a title="dispatch.package.ExceptionListener" id="54202">listener</a>: <span title="dispatch.package.ExceptionListener">ExceptionListener</span>
  <span class="delimiter">)</span> <span class="keyword">extends</span> <span title="org.apache.http.nio.client.HttpAsyncResponseConsumer[T]">HttpAsyncResponseConsumer</span><span class="delimiter">[</span>T<span class="delimiter">]</span> <span class="delimiter">{</span>
    @volatile <span class="keyword">var</span> <a title="Boolean" id="54176">stopping</a> = <span title="Boolean(false)" class="keyword">false</span>
    @volatile <span class="keyword">var</span> <a title="Option[Exception]" id="54179">exception</a>: <span title="Option[Exception]">Option</span><span class="delimiter">[</span>Exception<span class="delimiter">]</span> = <span title="object None">None</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(e: Exception)Unit" id="54181">setException</a><span class="delimiter">(</span><a title="Exception" id="54203">e</a>: <span title="Exception">Exception</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#54179" title="(x$1: Option[Exception])Unit">exception</a> = <span title="(x: Exception)Some[Exception]">Some</span><span class="delimiter">(</span><a href="#54203" title="Exception">e</a><span class="delimiter">)</span>
      <a href="#54202" title="dispatch.package.ExceptionListener">listener</a>.<span title="(v1: Throwable)Option[Unit]">lift</span><span title="Unit" class="delimiter">(</span><a href="#54203" title="Exception">e</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">final</span> <span class="keyword">override</span> <span class="keyword">def</span> <a title="(decoder: org.apache.http.nio.ContentDecoder, ioctrl: org.apache.http.nio.IOControl)Unit" id="54182">consumeContent</a><span class="delimiter">(</span><a title="org.apache.http.nio.ContentDecoder" id="54209">decoder</a>: <span title="org.apache.http.nio.ContentDecoder">ContentDecoder</span>, <a title="org.apache.http.nio.IOControl" id="54210">ioctrl</a>: <span title="org.apache.http.nio.IOControl">IOControl</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#54176" title="=&gt; Boolean">stopping</a> <span title="(x: Boolean)Boolean">||</span> <a href="#54179" title="=&gt; Option[Exception]">exception</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#54210" title="org.apache.http.nio.IOControl">ioctrl</a>.<span title="()Unit">shutdown</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#53855" title="()Unit">cancel</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">else</span> <a href="#54187" title="(decoder: org.apache.http.nio.ContentDecoder, ioctrl: org.apache.http.nio.IOControl)Unit">consume</a><span class="delimiter">(</span><a href="#54209" title="org.apache.http.nio.ContentDecoder">decoder</a>, <a href="#54210" title="org.apache.http.nio.IOControl">ioctrl</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Unit" id="54223">e</a>: <span title="Exception">Exception</span> =&gt;
          <a href="#54176" title="(x$1: Boolean)Unit">stopping</a> = <span title="Boolean(true)" class="keyword">true</span>
          <a href="#54181" title="(e: Exception)Unit">setException</a><span class="delimiter">(</span><a href="#54223" title="Exception">e</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    @volatile <span class="keyword">var</span> <a title="Option[org.apache.http.HttpResponse]" id="54184">response</a>: <span title="Option[org.apache.http.HttpResponse]">Option</span><span class="delimiter">[</span>HttpResponse<span class="delimiter">]</span> = <span title="object None">None</span>
    <span class="keyword">def</span> <a title="(res: org.apache.http.HttpResponse)Unit" id="54186">responseReceived</a><span class="delimiter">(</span><a title="org.apache.http.HttpResponse" id="54224">res</a>: <span title="org.apache.http.HttpResponse">HttpResponse</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#54184" title="(x$1: Option[org.apache.http.HttpResponse])Unit">response</a> = <span title="(x: org.apache.http.HttpResponse)Some[org.apache.http.HttpResponse]">Some</span><span class="delimiter">(</span><a href="#54224" title="org.apache.http.HttpResponse">res</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="(decoder: org.apache.http.nio.ContentDecoder, ioctrl: org.apache.http.nio.IOControl)Unit" id="54187">consume</a><span class="delimiter">(</span><a title="org.apache.http.nio.ContentDecoder" id="54220">decoder</a>: <span title="org.apache.http.nio.ContentDecoder">ContentDecoder</span>, <a title="org.apache.http.nio.IOControl" id="54221">ioctrl</a>: <span title="org.apache.http.nio.IOControl">IOControl</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="()Unit" id="54188">stop</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#54176" title="(x$1: Boolean)Unit">stopping</a> = <span title="Boolean(true)" class="keyword">true</span> <span class="delimiter">}</span>
    @volatile <span class="keyword">var</span> <a title="Option[T]" id="54190">result</a>: <span title="Option[T]">Option</span><span class="delimiter">[</span>T<span class="delimiter">]</span> = <span title="object None">None</span>
    <span class="keyword">def</span> <a title="()Unit" id="54192">responseCompleted</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="#54190" title="(x$1: Option[T])Unit">result</a> = <span title="(x: T)Some[T]">Some</span><span class="delimiter">(</span><a href="#54193" title="(response: org.apache.http.HttpResponse)T">completeResult</a><span class="delimiter">(</span><a href="#54184" title="=&gt; Option[org.apache.http.HttpResponse]">response</a>.<span title="(default: =&gt; org.apache.http.HttpResponse)org.apache.http.HttpResponse">getOrElse</span> <span class="delimiter">{</span>
          <span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="java.lang.String(&quot;responseCompleted called but response unset&quot;)" class="string">&quot;responseCompleted called but response unset&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Unit" id="54241">e</a>: <span title="Exception">Exception</span> =&gt; <a href="#54181" title="(e: Exception)Unit">setException</a><span class="delimiter">(</span><a href="#54241" title="Exception">e</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="(response: org.apache.http.HttpResponse)T" id="54193">completeResult</a><span class="delimiter">(</span><a title="org.apache.http.HttpResponse" id="54233">response</a>: <span title="org.apache.http.HttpResponse">HttpResponse</span><span class="delimiter">)</span>: <a href="#53856" title="T">T</a>
    <span class="comment">// asynchttpclient would a lot rather we return null here than throw an exception</span>
    <span class="keyword">def</span> <a title="()T" id="54194">getResult</a>: <a href="#53856" title="T">T</a> = <a href="#54190" title="=&gt; Option[T]">result</a>.<span title="(default: =&gt; T)T">getOrElse</span><span class="delimiter">(</span><span title="Null(null)" class="keyword">null</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="T" class="delimiter">[</span><a href="#53856" title="T">T</a><span class="delimiter">]</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(ex: Exception)Unit" id="54195">failed</a><span class="delimiter">(</span><a title="Exception" id="54249">ex</a>: <span title="Exception">Exception</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#54181" title="(e: Exception)Unit">setException</a><span class="delimiter">(</span><a href="#54249" title="Exception">ex</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  <span class="keyword">class</span> <a title="class EmptyCallback[T] extends java.lang.Object with org.apache.http.nio.concurrent.FutureCallback[T] with ScalaObject" id="53857">EmptyCallback</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="53858">T</a><span class="delimiter">]</span> <a href="#53857" title="ScalaObject" class="keyword">extends</a> <span title="org.apache.http.nio.concurrent.FutureCallback[T]">FutureCallback</span><span class="delimiter">[</span>T<span class="delimiter">]</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="()Unit" id="54259">cancelled</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="Unit" class="delimiter">{</span> <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="(res: T)Unit" id="54260">completed</a><span class="delimiter">(</span><a title="T" id="54264">res</a>: <a href="#53858" title="T">T</a><span class="delimiter">)</span> <span title="Unit" class="delimiter">{</span> <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="(ex: Exception)Unit" id="54261">failed</a><span class="delimiter">(</span><a title="Exception" id="54267">ex</a>: <span title="Exception">Exception</span><span class="delimiter">)</span> <span title="Unit" class="delimiter">{</span> <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  <span class="keyword">class</span> <a title="class ConsumerFuture[T] extends java.lang.Object with dispatch.futures.StoppableFuture[T] with ScalaObject" id="53859">ConsumerFuture</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="53860">T</a><span class="delimiter">]</span><a href="#53859" title="ScalaObject" class="delimiter">(</a>
    <a title="java.util.concurrent.Future[T]" id="54280">underlying</a>: <span title="java.util.concurrent.Future[T]">Future</span><span class="delimiter">[</span>T<span class="delimiter">]</span>, 
    <a title="Http.this.StoppableConsumer[T]" id="54281">consumer</a>: <a href="#53855" title="Http.this.StoppableConsumer[T]">StoppableConsumer</a><span class="delimiter">[</span>T<span class="delimiter">]</span>
  <span class="delimiter">)</span> <span class="keyword">extends</span> dispatch.futures.<a href="../futures/Futures.scala.html#9548" title="dispatch.futures.StoppableFuture[T]">StoppableFuture</a><span class="delimiter">[</span>T<span class="delimiter">]</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="()T" id="54274">apply</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="T" id="54284">res</a> = <a href="#54280" title="java.util.concurrent.Future[T]">underlying</a>.<span title="()T">get</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#54281" title="Http.this.StoppableConsumer[T]">consumer</a>.<a href="#54179" title="=&gt; Option[Exception]">exception</a>.<span title="(f: Exception =&gt; Nothing)Unit">foreach</span> <span class="delimiter">{</span> <span title="Nothing" class="keyword">throw</span> <a href="#54291" title="Exception">_</a> <span class="delimiter">}</span>
      <a href="#54284" title="T">res</a>
    <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="=&gt; Boolean" id="54275">isSet</a> = <a href="#54281" title="Http.this.StoppableConsumer[T]">consumer</a>.<a href="#54179" title="=&gt; Option[Exception]">exception</a>.<span title="=&gt; Boolean">isDefined</span> <span title="(x: Boolean)Boolean">||</span> <a href="#54280" title="java.util.concurrent.Future[T]">underlying</a>.<span title="()Boolean">isDone</span>
    <span class="keyword">def</span> <a title="()Unit" id="54276">stop</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span> 
      <a href="#54281" title="Http.this.StoppableConsumer[T]">consumer</a>.<a href="#54188" title="()Unit">stop</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#54280" title="java.util.concurrent.Future[T]">underlying</a>.<span title="(x$1: Boolean)Boolean">cancel</span><span title="Unit" class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  <span class="comment">/* substitute future used for blocking consumers */</span>
  <span class="keyword">trait</span> <a title="trait SubstituteFuture[T] extends java.lang.Object with dispatch.futures.StoppableFuture[T] with ScalaObject" id="53861">SubstituteFuture</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="53862">T</a><span class="delimiter">]</span> <span title="ScalaObject" class="keyword">extends</span> dispatch.futures.<a href="../futures/Futures.scala.html#9548" title="dispatch.futures.StoppableFuture[T]">StoppableFuture</a><span class="delimiter">[</span>T<span class="delimiter">]</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="=&gt; Boolean" id="54298">isSet</a> = <span title="Boolean(true)" class="keyword">true</span>
    <span class="keyword">def</span> <a title="()Unit" id="54299">stop</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="Unit" class="delimiter">{</span>  <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  <span class="keyword">class</span> <a title="class ExceptionFuture[T] extends java.lang.Object with Http.this.SubstituteFuture[T] with ScalaObject" id="53863">ExceptionFuture</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="53864">T</a><span class="delimiter">]</span><a href="#53863" title="ScalaObject" class="delimiter">(</a><a title="Throwable" id="54312">e</a>: <span title="Throwable">Throwable</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#53861" title="Http.this.SubstituteFuture[T]">SubstituteFuture</a><span class="delimiter">[</span>T<span class="delimiter">]</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="()Nothing" id="54309">apply</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span title="Nothing" class="keyword">throw</span> <a href="#54312" title="Throwable">e</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[T](host: org.apache.http.HttpHost, credsopt: Option[dispatch.Credentials], req: org.apache.http.client.methods.HttpRequestBase, block: org.apache.http.HttpResponse =&gt; T, listener: dispatch.package.ExceptionListener)Http.this.HttpPackage[T]" id="53865">execute</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="53867">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="org.apache.http.HttpHost" id="54315">host</a>: <span title="org.apache.http.HttpHost">HttpHost</span>, 
                 <a title="Option[dispatch.Credentials]" id="54316">credsopt</a>: <span title="Option[dispatch.Credentials]">Option</span><span class="delimiter">[</span>dispatch.Credentials<span class="delimiter">]</span>, 
                 <a title="org.apache.http.client.methods.HttpRequestBase" id="54317">req</a>: <span title="org.apache.http.client.methods.HttpRequestBase">HttpRequestBase</span>, 
                 <a title="org.apache.http.HttpResponse =&gt; T" id="54318">block</a>: HttpResponse =&gt; T,
                 <a title="dispatch.package.ExceptionListener" id="54319">listener</a>: <span title="dispatch.package.ExceptionListener">ExceptionListener</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#54316" title="Option[dispatch.Credentials]">credsopt</a>.<span title="(f: dispatch.Credentials =&gt; Nothing)Option[Nothing]">map</span> <span class="delimiter">{</span> <a title="dispatch.Credentials" id="54351">creds</a> =&gt;
      <span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Not yet implemented, but you can force basic auth with as_!&quot;)" class="string">&quot;Not yet implemented, but you can force basic auth with as_!&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span title="(default: =&gt; Http.this.HttpPackage[T])Http.this.HttpPackage[T]">getOrElse</span> <span class="delimiter">{</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="consumer extends Http.this.StoppableConsumer[T]" id="54357">consumer</a> = <a href="#54358" title="Http.this.StoppableConsumer[T]{def entity: Option[org.apache.http.nio.entity.ConsumingNHttpEntity]; def entity_=(x$1: Option[org.apache.http.nio.entity.ConsumingNHttpEntity]): Unit}" class="keyword">new</a> <a title="anonymous class $anon extends Http.this.StoppableConsumer[T]" id="54358">StoppableConsumer</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">(</span><a href="#54319" title="dispatch.package.ExceptionListener">listener</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          @volatile <span class="keyword">var</span> <a title="Option[org.apache.http.nio.entity.ConsumingNHttpEntity]" id="54361">entity</a>: <span title="Option[org.apache.http.nio.entity.ConsumingNHttpEntity]">Option</span><span class="delimiter">[</span>ConsumingNHttpEntity<span class="delimiter">]</span> = <span title="object None">None</span>
          <span class="keyword">def</span> <a title="(decoder: org.apache.http.nio.ContentDecoder, ioctrl: org.apache.http.nio.IOControl)Unit" id="54363">consume</a><span class="delimiter">(</span><a title="org.apache.http.nio.ContentDecoder" id="54371">decoder</a>: <span title="org.apache.http.nio.ContentDecoder">ContentDecoder</span>, <a title="org.apache.http.nio.IOControl" id="54372">ioctrl</a>: <span title="org.apache.http.nio.IOControl">IOControl</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#54358" title="(x$1: Option[Unit])Option[Unit]">synchronized</a> <span title="Unit" class="delimiter">{</span>
            <a href="#54361" title="(x$1: Option[org.apache.http.nio.entity.ConsumingNHttpEntity])Unit">entity</a> = <a href="#54361" title="=&gt; Option[org.apache.http.nio.entity.ConsumingNHttpEntity]">entity</a>.<span title="(alternative: =&gt; Option[org.apache.http.nio.entity.ConsumingNHttpEntity])Option[org.apache.http.nio.entity.ConsumingNHttpEntity]">orElse</span> <span class="delimiter">{</span>
              <span class="keyword">for</span> <span class="delimiter">{</span>
                <a title="org.apache.http.HttpResponse" id="54392">res</a> &lt;- <a href="#54184" title="(f: org.apache.http.HttpResponse =&gt; Option[org.apache.http.nio.entity.BufferingNHttpEntity])Option[org.apache.http.nio.entity.BufferingNHttpEntity]">response</a>
                <a title="org.apache.http.HttpEntity" id="54400">ent</a> &lt;- <span title="(x: org.apache.http.HttpEntity)Option[org.apache.http.HttpEntity]">Option</span><span title="(f: org.apache.http.HttpEntity =&gt; org.apache.http.nio.entity.BufferingNHttpEntity)Option[org.apache.http.nio.entity.BufferingNHttpEntity]" class="delimiter">(</span><a href="#54392" title="org.apache.http.HttpResponse">res</a>.<span title="()org.apache.http.HttpEntity">getEntity</span><span class="delimiter">)</span>
              <span class="delimiter">}</span> <span class="keyword">yield</span> <span class="delimiter">(</span><span title="org.apache.http.nio.entity.BufferingNHttpEntity" class="keyword">new</span> <span title="org.apache.http.nio.entity.BufferingNHttpEntity">BufferingNHttpEntity</span><span class="delimiter">(</span><a href="#54400" title="org.apache.http.HttpEntity">ent</a>, <span title="org.apache.http.nio.util.HeapByteBufferAllocator" class="keyword">new</span> <span title="org.apache.http.nio.util.HeapByteBufferAllocator">HeapByteBufferAllocator</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            <a href="#54361" title="=&gt; Option[org.apache.http.nio.entity.ConsumingNHttpEntity]">entity</a>.<span title="(f: org.apache.http.nio.entity.ConsumingNHttpEntity =&gt; Unit)Option[Unit]">map</span> <span class="delimiter">{</span> <a href="#54426" title="org.apache.http.nio.entity.ConsumingNHttpEntity">_</a>.<span title="(x$1: org.apache.http.nio.ContentDecoder, x$2: org.apache.http.nio.IOControl)Unit">consumeContent</span><span class="delimiter">(</span><a href="#54371" title="org.apache.http.nio.ContentDecoder">decoder</a>, <a href="#54372" title="org.apache.http.nio.IOControl">ioctrl</a><span class="delimiter">)</span> <span class="delimiter">}</span>
          <span class="delimiter">}</span> <span class="delimiter">}</span>
          <span class="keyword">def</span> <a title="(res: org.apache.http.HttpResponse)T" id="54364">completeResult</a><span class="delimiter">(</span><a title="org.apache.http.HttpResponse" id="54373">res</a>: <span title="org.apache.http.HttpResponse">HttpResponse</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
            <span class="keyword">for</span> <span class="delimiter">(</span><a title="org.apache.http.nio.entity.ConsumingNHttpEntity" id="54378">ent</a> &lt;- <a href="#54361" title="(f: org.apache.http.nio.entity.ConsumingNHttpEntity =&gt; Unit)Unit">entity</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#54373" title="org.apache.http.HttpResponse">res</a>.<span title="(x$1: org.apache.http.HttpEntity)Unit">setEntity</span><span class="delimiter">(</span><a href="#54378" title="org.apache.http.nio.entity.ConsumingNHttpEntity">ent</a><span class="delimiter">)</span>
              <a href="#54378" title="org.apache.http.nio.entity.ConsumingNHttpEntity">ent</a>.<span title="()Unit">finish</span><span class="delimiter">(</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            <a href="#54318" title="(v1: org.apache.http.HttpResponse)T">block</a><span class="delimiter">(</span><a href="#54373" title="org.apache.http.HttpResponse">res</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <span class="keyword">def</span> <a title="()Unit" id="54365">cancel</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#54361" title="=&gt; Option[org.apache.http.nio.entity.ConsumingNHttpEntity]">entity</a>.<span title="(f: org.apache.http.nio.entity.ConsumingNHttpEntity =&gt; Unit)Option[Unit]">map</span> <span title="Unit" class="delimiter">{</span> <a href="#54434" title="org.apache.http.nio.entity.ConsumingNHttpEntity">_</a>.<span title="()Unit">finish</span><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        <span title="Http.this.ConsumerFuture[T]" class="keyword">new</span> <a href="#53859" title="Http.this.ConsumerFuture[T]">ConsumerFuture</a><span class="delimiter">(</span>
          <a href="#53850" title="=&gt; org.apache.http.impl.nio.client.DefaultHttpAsyncClient">client</a>.<span title="(x$1: org.apache.http.nio.client.HttpAsyncRequestProducer, x$2: org.apache.http.nio.client.HttpAsyncResponseConsumer[T], x$3: org.apache.http.nio.concurrent.FutureCallback[T])java.util.concurrent.Future[T]">execute</span><span class="delimiter">(</span><span title="org.apache.http.impl.nio.client.BasicHttpAsyncRequestProducer" class="keyword">new</span> <span title="org.apache.http.impl.nio.client.BasicHttpAsyncRequestProducer">Producer</span><span class="delimiter">(</span><a href="#54315" title="org.apache.http.HttpHost">host</a>, <a href="#54317" title="org.apache.http.client.methods.HttpRequestBase">req</a><span class="delimiter">)</span>, <a href="#54357" title="consumer extends Http.this.StoppableConsumer[T]">consumer</a>, <span title="Http.this.EmptyCallback[T]" class="keyword">new</span> <a href="#53857" title="Http.this.EmptyCallback[T]">EmptyCallback</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>,
          <a href="#54357" title="consumer extends Http.this.StoppableConsumer[T]">consumer</a>
        <span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Http.this.ExceptionFuture[T]" id="54513">e</a> =&gt; 
          <a href="#54319" title="dispatch.package.ExceptionListener">listener</a>.<span title="(v1: Throwable)Option[Unit]">lift</span><span class="delimiter">(</span><a href="#54513" title="java.lang.Throwable">e</a><span class="delimiter">)</span>
          <span title="Http.this.ExceptionFuture[T]" class="keyword">new</span> <a href="#53863" title="Http.this.ExceptionFuture[T]">ExceptionFuture</a><span class="delimiter">(</span><a href="#54513" title="java.lang.Throwable">e</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">def</span> <a title="[T](host: org.apache.http.HttpHost, credsopt: Option[dispatch.Credentials], req: org.apache.http.client.methods.HttpRequestBase, callback: dispatch.Callback[T])Http.this.ConsumerFuture[T]" id="53868">executeWithCallback</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="53870">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="org.apache.http.HttpHost" id="54522">host</a>: <span title="org.apache.http.HttpHost">HttpHost</span>, <a title="Option[dispatch.Credentials]" id="54523">credsopt</a>: <span title="Option[dispatch.Credentials]">Option</span><span class="delimiter">[</span>dispatch.Credentials<span class="delimiter">]</span>, 
                             <a title="org.apache.http.client.methods.HttpRequestBase" id="54524">req</a>: <span title="org.apache.http.client.methods.HttpRequestBase">HttpRequestBase</span>, <a title="dispatch.Callback[T]" id="54525">callback</a>: <a href="../core/callbacks.scala.html#9455" title="dispatch.Callback[T]">Callback</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#54523" title="Option[dispatch.Credentials]">credsopt</a>.<span title="(f: dispatch.Credentials =&gt; Nothing)Option[Nothing]">map</span> <span class="delimiter">{</span> <a title="dispatch.Credentials" id="54552">creds</a> =&gt;
      <span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Not yet implemented, but you can force basic auth with as_!&quot;)" class="string">&quot;Not yet implemented, but you can force basic auth with as_!&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span title="(default: =&gt; Http.this.ConsumerFuture[T])Http.this.ConsumerFuture[T]">getOrElse</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="dispatch.nio.DecodingCallback[T]" id="54556">ioc</a> = <a href="#54892" title="(callback: dispatch.Callback[T])dispatch.nio.DecodingCallback[T]">DecodingCallback</a><span class="delimiter">(</span><a href="#54525" title="dispatch.Callback[T]">callback</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Http.this.StoppableConsumer[T]" id="54557">consumer</a> = <a href="#54580" title="Http.this.StoppableConsumer[T]" class="keyword">new</a> <a title="anonymous class $anon extends Http.this.StoppableConsumer[T]" id="54580">StoppableConsumer</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">(</span><a href="#54525" title="dispatch.Callback[T]">callback</a>.<a href="../core/callbacks.scala.html#10475" title="=&gt; dispatch.package.ExceptionListener">listener</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">override</span> <span class="keyword">def</span> <a title="(res: org.apache.http.HttpResponse)Unit" id="54582">responseReceived</a><span class="delimiter">(</span><a title="org.apache.http.HttpResponse" id="54586">res</a>: <span title="org.apache.http.HttpResponse">HttpResponse</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#54184" title="(x$1: Option[org.apache.http.HttpResponse])Unit">response</a> = <span title="(x: org.apache.http.HttpResponse)Some[org.apache.http.HttpResponse]">Some</span><span class="delimiter">(</span><a href="#54586" title="org.apache.http.HttpResponse">res</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">def</span> <a title="(decoder: org.apache.http.nio.ContentDecoder, ioctrl: org.apache.http.nio.IOControl)Unit" id="54583">consume</a><span class="delimiter">(</span><a title="org.apache.http.nio.ContentDecoder" id="54588">decoder</a>: <span title="org.apache.http.nio.ContentDecoder">ContentDecoder</span>, <a title="org.apache.http.nio.IOControl" id="54589">ioctrl</a>: <span title="org.apache.http.nio.IOControl">IOControl</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#54556" title="dispatch.nio.DecodingCallback[T]">ioc</a>.<a href="#54567" title="(response: org.apache.http.HttpResponse, decoder: org.apache.http.nio.ContentDecoder)Unit">with_decoder</a><span class="delimiter">(</span><a href="#54184" title="=&gt; Option[org.apache.http.HttpResponse]">response</a>.<span title="=&gt; org.apache.http.HttpResponse">get</span>, <a href="#54588" title="org.apache.http.nio.ContentDecoder">decoder</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">def</span> <a title="(response: org.apache.http.HttpResponse)T" id="54584">completeResult</a><span class="delimiter">(</span><a title="org.apache.http.HttpResponse" id="54590">response</a>: <span title="org.apache.http.HttpResponse">HttpResponse</span><span class="delimiter">)</span> = 
          <a href="#54525" title="dispatch.Callback[T]">callback</a>.<a href="../core/callbacks.scala.html#10473" title="(v1: org.apache.http.HttpResponse)T">finish</a><span class="delimiter">(</span><a href="#54590" title="org.apache.http.HttpResponse">response</a><span class="delimiter">)</span>
        <span class="keyword">def</span> <a title="()Unit" id="54585">cancel</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="Unit" class="delimiter">{</span> <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span title="Http.this.ConsumerFuture[T]" class="keyword">new</span> <a href="#53859" title="Http.this.ConsumerFuture[T]">ConsumerFuture</a><span class="delimiter">(</span>
        <a href="#53850" title="=&gt; org.apache.http.impl.nio.client.DefaultHttpAsyncClient">client</a>.<span title="(x$1: org.apache.http.nio.client.HttpAsyncRequestProducer, x$2: org.apache.http.nio.client.HttpAsyncResponseConsumer[T], x$3: org.apache.http.nio.concurrent.FutureCallback[T])java.util.concurrent.Future[T]">execute</span><span class="delimiter">(</span><span title="org.apache.http.impl.nio.client.BasicHttpAsyncRequestProducer" class="keyword">new</span> <span title="org.apache.http.impl.nio.client.BasicHttpAsyncRequestProducer">Producer</span><span class="delimiter">(</span><a href="#54522" title="org.apache.http.HttpHost">host</a>, <a href="#54524" title="org.apache.http.client.methods.HttpRequestBase">req</a><span class="delimiter">)</span>, <a href="#54557" title="Http.this.StoppableConsumer[T]">consumer</a>, <span title="Http.this.EmptyCallback[T]" class="keyword">new</span> <a href="#53857" title="Http.this.EmptyCallback[T]">EmptyCallback</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>,
        <a href="#54557" title="Http.this.StoppableConsumer[T]">consumer</a>
      <span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  <span class="comment">/** Does nothing, NIO executor always consumes entities it creates */</span>
  <span class="keyword">def</span> <a title="(entity: Option[org.apache.http.HttpEntity])Unit" id="53871">consumeContent</a><span class="delimiter">(</span><a title="Option[org.apache.http.HttpEntity]" id="54656">entity</a>: <span title="Option[org.apache.http.HttpEntity]">Option</span><span class="delimiter">[</span>HttpEntity<span class="delimiter">]</span><span class="delimiter">)</span> <span title="Unit" class="delimiter">{</span> <span class="delimiter">}</span>
  <span class="keyword">def</span> <a title="()Unit" id="53872">shutdownClient</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#53850" title="=&gt; org.apache.http.impl.nio.client.DefaultHttpAsyncClient">client</a>.<span title="()Unit">shutdown</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

case <span class="keyword">class</span> <a title="class DecodingCallback[T] extends java.lang.Object with ScalaObject with Product with Serializable" id="54892">DecodingCallback</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="54562">T</a><span class="delimiter">]</span><a href="#54892" title="ScalaObject" class="delimiter">(</a><a title="dispatch.Callback[T]" id="54574">callback</a>: dispatch.<a href="../core/callbacks.scala.html#9455" title="dispatch.Callback[T]">Callback</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(response: org.apache.http.HttpResponse, decoder: org.apache.http.nio.ContentDecoder)Unit" id="54567">with_decoder</a><span class="delimiter">(</span><a title="org.apache.http.HttpResponse" id="54596">response</a>: <span title="org.apache.http.HttpResponse">HttpResponse</span>, <a title="org.apache.http.nio.ContentDecoder" id="54597">decoder</a>: <span title="org.apache.http.nio.ContentDecoder">ContentDecoder</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.nio.ByteBuffer" id="54662">buffer</a> = java.nio.<span title="object java.nio.ByteBuffer">ByteBuffer</span>.<span title="(x$1: Int)java.nio.ByteBuffer">allocate</span><span class="delimiter">(</span><a href="#9735" title="object dispatch.nio.Http">Http</a>.<a href="#53847" title="=&gt; Int">socket_buffer_size</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="54663">length</a> = <a href="#54597" title="org.apache.http.nio.ContentDecoder">decoder</a>.<span title="(x$1: java.nio.ByteBuffer)Int">read</span><span class="delimiter">(</span><a href="#54662" title="java.nio.ByteBuffer">buffer</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#54663" title="Int">length</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <a href="#54574" title="=&gt; dispatch.Callback[T]">callback</a>.<a href="../core/callbacks.scala.html#10471" title="(v1: org.apache.http.HttpResponse, v2: Array[Byte], v3: Int)Unit">function</a><span class="delimiter">(</span><a href="#54596" title="org.apache.http.HttpResponse">response</a>, <a href="#54662" title="java.nio.ByteBuffer">buffer</a>.<span title="()Array[Byte]">array</span><span class="delimiter">(</span><span class="delimiter">)</span>, <a href="#54663" title="Int">length</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>com/mongodb/DBCursor.java</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">// DBCursor.java</span>

<span class="comment">/**
 *      Copyright (C) 2008 10gen Inc.
 *
 *   Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 *   you may not use this file except in compliance with the License.
 *   You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *   Unless required by applicable law or agreed to in writing, software
 *   distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *   See the License for the specific language governing permissions and
 *   limitations under the License.
 */</span>

<span class="keyword">package</span> com.mongodb;

<span class="keyword">import</span> java.util.*;

<span class="keyword">import</span> com.mongodb.DBApiLayer.Result;


<span class="comment">/** An iterator over database results.
 * Doing a &lt;code&gt;find()&lt;/code&gt; query on a collection returns a
 * &lt;code&gt;DBCursor&lt;/code&gt; thus
 *
 * &lt;blockquote&gt;&lt;pre&gt;
 * DBCursor cursor = collection.find( query );
 * if( cursor.hasNext() )
 *     DBObject obj = cursor.next();
 * &lt;/pre&gt;&lt;/blockquote&gt;
 *
 * &lt;p&gt;&lt;b&gt;Warning:&lt;/b&gt; Calling &lt;code&gt;toArray&lt;/code&gt; or &lt;code&gt;length&lt;/code&gt; on
 * a DBCursor will irrevocably turn it into an array.  This
 * means that, if the cursor was iterating over ten million results
 * (which it was lazily fetching from the database), suddenly there will
 * be a ten-million element array in memory.  Before converting to an array,
 * make sure that there are a reasonable number of results using
 * &lt;code&gt;skip()&lt;/code&gt; and &lt;code&gt;limit()&lt;/code&gt;.
 * &lt;p&gt;For example, to get an array of the 1000-1100th elements of a cursor, use
 *
 * &lt;blockquote&gt;&lt;pre&gt;
 * List&lt;DBObject&gt; obj = collection.find( query ).skip( 1000 ).limit( 100 ).toArray();
 * &lt;/pre&gt;&lt;/blockquote&gt;
 *
 * @dochub cursors
 */</span>
public <span class="keyword">class</span> <a title="object com.mongodb.DBCursor" id="7833">DBCursor</a> implements Iterator&lt;<a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a>&gt; , Iterable&lt;<a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a>&gt; <span class="delimiter">{</span>

    <span class="comment">/**
     * Initializes a new database cursor
     * @param collection collection to use
     * @param q query to perform
     * @param k keys to return from the query
     */</span>
    public DBCursor<a href="#7833" title="com.mongodb.DBCursor" class="delimiter">(</a> <a href="DBCollection.java.html#7830" title="com.mongodb.DBCollection">DBCollection</a> <a title="com.mongodb.DBCollection" id="53579">collection</a> , <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="53580">q</a> , <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="53581">k</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        _collection = collection;
        _query = q == <span class="keyword">null</span> ? <span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span><span class="delimiter">)</span> : q;
        _keysWanted = k;
        <span class="keyword">if</span> <span class="delimiter">(</span> _collection != <span class="keyword">null</span> <span class="delimiter">)</span><span class="delimiter">{</span>
            _options = _collection.getOptions<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Types of cursors: iterator or array.
     */</span>
    static enum <a title="object com.mongodb.DBCursor.CursorType" id="53237">CursorType</a> <span class="delimiter">{</span> <a title="com.mongodb.DBCursor.CursorType" id="145252">ITERATOR</a> , <a title="com.mongodb.DBCursor.CursorType" id="145253">ARRAY</a> <span class="delimiter">}</span>;

    <span class="comment">/**
     * Creates a copy of an existing database cursor.
     * The new cursor is an iterator, even if the original
     * was an array.
     *
     * @return the new cursor
     */</span>
    public <a href="#7833" title="com.mongodb.DBCursor">DBCursor</a> <a title="()com.mongodb.DBCursor" id="44539">copy</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        DBCursor c = <span class="keyword">new</span> DBCursor<span class="delimiter">(</span>_collection, _query, _keysWanted<span class="delimiter">)</span>;
        c._orderBy = _orderBy;
        c._hint = _hint;
        c._hintDBObj = _hintDBObj;
        c._limit = _limit;
        c._skip = _skip;
        c._options = _options;
        c._batchSize = _batchSize;
        c._snapshot = _snapshot;
        c._explain = _explain;
        <span class="keyword">if</span> <span class="delimiter">(</span> _specialFields != <span class="keyword">null</span> <span class="delimiter">)</span>
            c._specialFields = <span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span> _specialFields.toMap<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>;
        <span class="keyword">return</span> c;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * creates a copy of this cursor object that can be iterated.
     * Note:
     * - you can iterate the DBCursor itself without calling this method
     * - no actual data is getting copied.
     *
     * @return
     */</span>
    public Iterator&lt;<a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a>&gt; <a title="()java.util.Iterator[com.mongodb.DBObject]" id="44540">iterator</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">return</span> <span class="keyword">this</span>.copy<span class="delimiter">(</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">// ---- querty modifiers --------</span>

    <span class="comment">/**
     * Sorts this cursor's elements.
     * This method must be called before getting any object from the cursor.
     * @param orderBy the fields by which to sort
     * @return a cursor pointing to the first element of the sorted results
     */</span>
    public <a href="#7833" title="com.mongodb.DBCursor">DBCursor</a> <a title="(orderBy: com.mongodb.DBObject)com.mongodb.DBCursor" id="44541">sort</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="53250">orderBy</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span> _it != <span class="keyword">null</span> <span class="delimiter">)</span>
            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException<span class="delimiter">(</span> <span class="string">&quot;can't sort after executing query&quot;</span> <span class="delimiter">)</span>;

        _orderBy = orderBy;
        <span class="keyword">return</span> <span class="keyword">this</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * adds a special operator like $maxScan or $returnKey
     * e.g. addSpecial( &quot;$returnKey&quot; , 1 )
     * e.g. addSpecial( &quot;$maxScan&quot; , 100 )
     * @param name
     * @param o
     * @return
     * @dochub specialOperators
     */</span>
    public <a href="#7833" title="com.mongodb.DBCursor">DBCursor</a> <a title="(name: java.lang.String, o: Any)com.mongodb.DBCursor" id="44542">addSpecial</a><span class="delimiter">(</span> String <a title="java.lang.String" id="53482">name</a> , Object <a title="Any" id="53483">o</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span> _specialFields == <span class="keyword">null</span> <span class="delimiter">)</span>
            _specialFields = <span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span><span class="delimiter">)</span>;
        _specialFields.put<span class="delimiter">(</span> name , o <span class="delimiter">)</span>;
        <span class="keyword">return</span> <span class="keyword">this</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Informs the database of indexed fields of the collection in order to improve performance.
     * @param indexKeys a &lt;code&gt;DBObject&lt;/code&gt; with fields and direction
     * @return same DBCursor for chaining operations
     */</span>
    public <a href="#7833" title="com.mongodb.DBCursor">DBCursor</a> <a title="(indexKeys: com.mongodb.DBObject)com.mongodb.DBCursor" id="44543">hint</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="53301">indexKeys</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span> _it != <span class="keyword">null</span> <span class="delimiter">)</span>
            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException<span class="delimiter">(</span> <span class="string">&quot;can't hint after executing query&quot;</span> <span class="delimiter">)</span>;
        
        _hintDBObj = indexKeys;
        <span class="keyword">return</span> <span class="keyword">this</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     *  Informs the database of an indexed field of the collection in order to improve performance.
     * @param indexName the name of an index
     * @return same DBCursort for chaining operations
     */</span>
    public <a href="#7833" title="com.mongodb.DBCursor">DBCursor</a> <a title="(indexName: java.lang.String)com.mongodb.DBCursor" id="44544">hint</a><span class="delimiter">(</span> String <a title="java.lang.String" id="53299">indexName</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span> _it != <span class="keyword">null</span> <span class="delimiter">)</span>
            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException<span class="delimiter">(</span> <span class="string">&quot;can't hint after executing query&quot;</span> <span class="delimiter">)</span>;

        _hint = indexName;
        <span class="keyword">return</span> <span class="keyword">this</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Use snapshot mode for the query. Snapshot mode assures no duplicates are
     * returned, or objects missed, which were present at both the start and end
     * of the query's execution (if an object is new during the query, or deleted
     * during the query, it may or may not be returned, even with snapshot mode).
     * Note that short query responses (less than 1MB) are always effectively snapshotted.
     * Currently, snapshot mode may not be used with sorting or explicit hints.
     * @return same DBCursor for chaining operations
     */</span>
    public <a href="#7833" title="com.mongodb.DBCursor">DBCursor</a> <a title="()com.mongodb.DBCursor" id="44545">snapshot</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span>_it != <span class="keyword">null</span><span class="delimiter">)</span>
            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException<span class="delimiter">(</span><span class="string">&quot;can't snapshot after executing the query&quot;</span><span class="delimiter">)</span>;

        _snapshot = <span class="keyword">true</span>;

        <span class="keyword">return</span> <span class="keyword">this</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Returns an object containing basic information about the
     * execution of the query that created this cursor
     * This creates a &lt;code&gt;DBObject&lt;/code&gt; with the key/value pairs:
     * &quot;cursor&quot; : cursor type
     * &quot;nScanned&quot; : number of records examined by the database for this query
     * &quot;n&quot; : the number of records that the database returned
     * &quot;millis&quot; : how long it took the database to execute the query
     * @return a &lt;code&gt;DBObject&lt;/code&gt;
     * @dochub explain
     */</span>
    public <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="()com.mongodb.DBObject" id="44546">explain</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        DBCursor c = copy<span class="delimiter">(</span><span class="delimiter">)</span>;
        c._explain = <span class="keyword">true</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span>c._limit &gt; <span class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="comment">// need to pass a negative batchSize as limit for explain</span>
            c._batchSize = c._limit * -<span class="int">1</span>;
            c._limit = <span class="int">0</span>;
        <span class="delimiter">}</span>
        <span class="keyword">return</span> c.next<span class="delimiter">(</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Limits the number of elements returned.
     * Note: parameter &lt;tt&gt;n&lt;/tt&gt; should be positive, although a negative value is supported for legacy reason.
     * Passing a negative value will call {@link DBCursor#batchSize(int)} which is the preferred method.
     * @param n the number of elements to return
     * @return a cursor to iterate the results
     * @dochub limit
     */</span>
    public <a href="#7833" title="com.mongodb.DBCursor">DBCursor</a> <a title="(n: Int)com.mongodb.DBCursor" id="44547">limit</a><span class="delimiter">(</span> int <a title="Int" id="53355">n</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span> _it != <span class="keyword">null</span> <span class="delimiter">)</span>
            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException<span class="delimiter">(</span> <span class="string">&quot;can't set limit after executing query&quot;</span> <span class="delimiter">)</span>;

        <span class="keyword">if</span> <span class="delimiter">(</span>n &gt; <span class="int">0</span><span class="delimiter">)</span>
            _limit = n;
        <span class="keyword">else</span> <span class="keyword">if</span> <span class="delimiter">(</span>n &lt; <span class="int">0</span><span class="delimiter">)</span>
            batchSize<span class="delimiter">(</span>n<span class="delimiter">)</span>;
        <span class="keyword">return</span> <span class="keyword">this</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Limits the number of elements returned in one batch.
     * A cursor typically fetches a batch of result objects and store them locally.
     *
     * If &lt;tt&gt;batchSize&lt;/tt&gt; is positive, it represents the size of each batch of objects retrieved.
     * It can be adjusted to optimize performance and limit data transfer.
     *
     * If &lt;tt&gt;batchSize&lt;/tt&gt; is negative, it will limit of number objects returned, that fit within the max batch size limit (usually 4MB), and cursor will be closed.
     * For example if &lt;tt&gt;batchSize&lt;/tt&gt; is -10, then the server will return a maximum of 10 documents and as many as can fit in 4MB, then close the cursor.
     * Note that this feature is different from limit() in that documents must fit within a maximum size, and it removes the need to send a request to close the cursor server-side.
     *
     * The batch size can be changed even after a cursor is iterated, in which case the setting will apply on the next batch retrieval.
     *
     * @param n the number of elements to return in a batch
     * @return
     */</span>
    public <a href="#7833" title="com.mongodb.DBCursor">DBCursor</a> <a title="(n: Int)com.mongodb.DBCursor" id="44548">batchSize</a><span class="delimiter">(</span> int <a title="Int" id="53466">n</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="comment">// check for special case, used to have server bug with 1</span>
        <span class="keyword">if</span> <span class="delimiter">(</span> n == <span class="int">1</span> <span class="delimiter">)</span>
            n = <span class="int">2</span>;

        <span class="keyword">if</span> <span class="delimiter">(</span> _it != <span class="keyword">null</span> <span class="delimiter">)</span> <span class="delimiter">{</span>
        	<span class="keyword">if</span> <span class="delimiter">(</span>_it instanceof DBApiLayer.Result<span class="delimiter">)</span>
        		<span class="delimiter">(</span><span class="delimiter">(</span>DBApiLayer.Result<span class="delimiter">)</span>_it<span class="delimiter">)</span>.setBatchSize<span class="delimiter">(</span>n<span class="delimiter">)</span>;
        <span class="delimiter">}</span>

        _batchSize = n;
        <span class="keyword">return</span> <span class="keyword">this</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Discards a given number of elements at the beginning of the cursor.
     * @param n the number of elements to skip
     * @return a cursor pointing to the new first element of the results
     * @throws RuntimeException if the cursor has started to be iterated through
     */</span>
    public <a href="#7833" title="com.mongodb.DBCursor">DBCursor</a> <a title="(n: Int)com.mongodb.DBCursor" id="44549">skip</a><span class="delimiter">(</span> int <a title="Int" id="53358">n</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span> _it != <span class="keyword">null</span> <span class="delimiter">)</span>
            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException<span class="delimiter">(</span> <span class="string">&quot;can't set skip after executing query&quot;</span> <span class="delimiter">)</span>;
        _skip = n;
        <span class="keyword">return</span> <span class="keyword">this</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * gets the cursor id.
     * @return the cursor id, or 0 if there is no active cursor.
     */</span>
    public long <a title="()Long" id="44550">getCursorId</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    	<span class="keyword">if</span> <span class="delimiter">(</span> _it instanceof Result <span class="delimiter">)</span>
            <span class="keyword">return</span> <span class="delimiter">(</span><span class="delimiter">(</span>Result<span class="delimiter">)</span>_it<span class="delimiter">)</span>.getCursorId<span class="delimiter">(</span><span class="delimiter">)</span>;

    	<span class="keyword">return</span> <span class="int">0</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * kills the current cursor on the server.
     */</span>
    public void <a title="()Unit" id="44551">close</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    	<span class="keyword">if</span> <span class="delimiter">(</span> _it instanceof Result <span class="delimiter">)</span>
            <span class="delimiter">(</span><span class="delimiter">(</span>Result<span class="delimiter">)</span>_it<span class="delimiter">)</span>.close<span class="delimiter">(</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * makes this query ok to run on a slave node
     * @return
     */</span>
    public <a href="#7833" title="com.mongodb.DBCursor">DBCursor</a> <a title="()com.mongodb.DBCursor" id="44552">slaveOk</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">return</span> addOption<span class="delimiter">(</span> Bytes.QUERYOPTION_SLAVEOK <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * adds a query option - see Bytes.QUERYOPTION_* for list
     * @param option
     * @return
     */</span>
    public <a href="#7833" title="com.mongodb.DBCursor">DBCursor</a> <a title="(option: Int)com.mongodb.DBCursor" id="44553">addOption</a><span class="delimiter">(</span> int <a title="Int" id="53271">option</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        _options |= option;
        <span class="keyword">return</span> <span class="keyword">this</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * sets the query option - see Bytes.QUERYOPTION_* for list
     * @param options
     */</span>
    public void <a title="(options: Int)Unit" id="44554">setOptions</a><span class="delimiter">(</span> int <a title="Int" id="53289">options</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        _options = options;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * resets the query options
     */</span>
    public void <a title="()Unit" id="44555">resetOptions</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        _options = <span class="int">0</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * gets the query options
     * @return
     */</span>
    public int <a title="()Int" id="44556">getOptions</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">return</span> _options;
    <span class="delimiter">}</span>

    <span class="comment">// ----  internal stuff ------</span>

    <span class="keyword">private</span> void <a title="()Unit" id="44557">_check</a><span class="delimiter">(</span><span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span> _it != <span class="keyword">null</span> <span class="delimiter">)</span>
            <span class="keyword">return</span>;

        <span class="keyword">if</span> <span class="delimiter">(</span> _collection != <span class="keyword">null</span> &amp;&amp; _query != <span class="keyword">null</span> <span class="delimiter">)</span><span class="delimiter">{</span>

            _lookForHints<span class="delimiter">(</span><span class="delimiter">)</span>;

            DBObject foo = _query;
            <span class="keyword">if</span> <span class="delimiter">(</span> hasSpecialQueryFields<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span><span class="delimiter">{</span>
                foo = _specialFields == <span class="keyword">null</span> ? <span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span><span class="delimiter">)</span> : _specialFields;

                _addToQueryObject<span class="delimiter">(</span> foo , <span class="string">&quot;query&quot;</span> , _query , <span class="keyword">true</span> <span class="delimiter">)</span>;
                _addToQueryObject<span class="delimiter">(</span> foo , <span class="string">&quot;orderby&quot;</span> , _orderBy , <span class="keyword">false</span> <span class="delimiter">)</span>;
                <span class="keyword">if</span><span class="delimiter">(</span>_hint != <span class="keyword">null</span><span class="delimiter">)</span>
                    _addToQueryObject<span class="delimiter">(</span> foo , <span class="string">&quot;$hint&quot;</span> , _hint <span class="delimiter">)</span>;
                <span class="keyword">if</span><span class="delimiter">(</span>_hintDBObj != <span class="keyword">null</span><span class="delimiter">)</span>
                    _addToQueryObject<span class="delimiter">(</span> foo , <span class="string">&quot;$hint&quot;</span> , _hintDBObj<span class="delimiter">)</span>;

                <span class="keyword">if</span> <span class="delimiter">(</span> _explain <span class="delimiter">)</span>
                    foo.put<span class="delimiter">(</span> <span class="string">&quot;$explain&quot;</span> , <span class="keyword">true</span> <span class="delimiter">)</span>;
                <span class="keyword">if</span> <span class="delimiter">(</span> _snapshot <span class="delimiter">)</span>
                    foo.put<span class="delimiter">(</span> <span class="string">&quot;$snapshot&quot;</span>, <span class="keyword">true</span> <span class="delimiter">)</span>;
            <span class="delimiter">}</span>

            _it = _collection.__find<span class="delimiter">(</span> foo, _keysWanted, _skip, _batchSize, _limit , _options <span class="delimiter">)</span>;
        <span class="delimiter">}</span>

        <span class="keyword">if</span> <span class="delimiter">(</span> _it == <span class="keyword">null</span> <span class="delimiter">)</span><span class="delimiter">{</span>
            _it = <span class="delimiter">(</span><span class="keyword">new</span> LinkedList&lt;DBObject&gt;<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>.iterator<span class="delimiter">(</span><span class="delimiter">)</span>;
            _fake = <span class="keyword">true</span>;
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="comment">/**
     * if there is a hint to use, use it
     */</span>
    <span class="keyword">private</span> void <a title="()Unit" id="44558">_lookForHints</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>

        <span class="keyword">if</span> <span class="delimiter">(</span> _hint != <span class="keyword">null</span> <span class="delimiter">)</span> <span class="comment">// if someone set a hint, then don't do this</span>
            <span class="keyword">return</span>;

        <span class="keyword">if</span> <span class="delimiter">(</span> _collection._hintFields == <span class="keyword">null</span> <span class="delimiter">)</span>
            <span class="keyword">return</span>;

        Set&lt;String&gt; mykeys = _query.keySet<span class="delimiter">(</span><span class="delimiter">)</span>;

        <span class="keyword">for</span> <span class="delimiter">(</span> DBObject o : _collection._hintFields <span class="delimiter">)</span><span class="delimiter">{</span>

            Set&lt;String&gt; hintKeys = o.keySet<span class="delimiter">(</span><span class="delimiter">)</span>;

            <span class="keyword">if</span> <span class="delimiter">(</span> ! mykeys.containsAll<span class="delimiter">(</span> hintKeys <span class="delimiter">)</span> <span class="delimiter">)</span>
                continue;

            hint<span class="delimiter">(</span> o <span class="delimiter">)</span>;
            <span class="keyword">return</span>;
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    boolean <a title="()Boolean" id="44559">hasSpecialQueryFields</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span> _specialFields != <span class="keyword">null</span> <span class="delimiter">)</span>
            <span class="keyword">return</span> <span class="keyword">true</span>;

        <span class="keyword">if</span> <span class="delimiter">(</span> _orderBy != <span class="keyword">null</span> &amp;&amp; _orderBy.keySet<span class="delimiter">(</span><span class="delimiter">)</span>.size<span class="delimiter">(</span><span class="delimiter">)</span> &gt; <span class="int">0</span> <span class="delimiter">)</span>
            <span class="keyword">return</span> <span class="keyword">true</span>;
        
        <span class="keyword">if</span> <span class="delimiter">(</span> _hint != <span class="keyword">null</span> || _hintDBObj != <span class="keyword">null</span> || _snapshot <span class="delimiter">)</span>
            <span class="keyword">return</span> <span class="keyword">true</span>;

        <span class="keyword">return</span> _explain;
    <span class="delimiter">}</span>

    void <a title="(query: com.mongodb.DBObject, field: java.lang.String, thing: com.mongodb.DBObject, sendEmpty: Boolean)Unit" id="44560">_addToQueryObject</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="145262">query</a> , String <a title="java.lang.String" id="145263">field</a> , <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="145264">thing</a> , boolean <a title="Boolean" id="145265">sendEmpty</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span> thing == <span class="keyword">null</span> <span class="delimiter">)</span>
            <span class="keyword">return</span>;

        <span class="keyword">if</span> <span class="delimiter">(</span> ! sendEmpty &amp;&amp; thing.keySet<span class="delimiter">(</span><span class="delimiter">)</span>.size<span class="delimiter">(</span><span class="delimiter">)</span> == <span class="int">0</span> <span class="delimiter">)</span>
            <span class="keyword">return</span>;

        _addToQueryObject<span class="delimiter">(</span> query , field , thing <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    void <a title="(query: com.mongodb.DBObject, field: java.lang.String, thing: Any)Unit" id="44561">_addToQueryObject</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="145267">query</a> , String <a title="java.lang.String" id="145268">field</a> , Object <a title="Any" id="145269">thing</a> <span class="delimiter">)</span><span class="delimiter">{</span>

        <span class="keyword">if</span> <span class="delimiter">(</span> thing == <span class="keyword">null</span> <span class="delimiter">)</span>
            <span class="keyword">return</span>;

        query.put<span class="delimiter">(</span> field , thing <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    void <a title="(type: com.mongodb.DBCursor.CursorType)Unit" id="44562">_checkType</a><span class="delimiter">(</span> CursorType <a title="com.mongodb.DBCursor.CursorType" id="145271" class="keyword">type</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span> _cursorType == <span class="keyword">null</span> <span class="delimiter">)</span><span class="delimiter">{</span>
            _cursorType = <span class="keyword">type</span>;
            <span class="keyword">return</span>;
        <span class="delimiter">}</span>

        <span class="keyword">if</span> <span class="delimiter">(</span> <span class="keyword">type</span> == _cursorType <span class="delimiter">)</span>
            <span class="keyword">return</span>;

        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException<span class="delimiter">(</span> <span class="string">&quot;can't switch cursor access methods&quot;</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="()com.mongodb.DBObject" id="44563">_next</a><span class="delimiter">(</span><span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span> _cursorType == <span class="keyword">null</span> <span class="delimiter">)</span>
            _checkType<span class="delimiter">(</span> CursorType.ITERATOR <span class="delimiter">)</span>;

        _check<span class="delimiter">(</span><span class="delimiter">)</span>;

        _cur = <span class="keyword">null</span>;
        _cur = _it.next<span class="delimiter">(</span><span class="delimiter">)</span>;
        _num++;

        <span class="keyword">if</span> <span class="delimiter">(</span> _keysWanted != <span class="keyword">null</span> &amp;&amp; _keysWanted.keySet<span class="delimiter">(</span><span class="delimiter">)</span>.size<span class="delimiter">(</span><span class="delimiter">)</span> &gt; <span class="int">0</span> <span class="delimiter">)</span><span class="delimiter">{</span>
            _cur.markAsPartialObject<span class="delimiter">(</span><span class="delimiter">)</span>;
            <span class="comment">//throw new UnsupportedOperationException( &quot;need to figure out partial&quot; );</span>
        <span class="delimiter">}</span>

        <span class="keyword">if</span> <span class="delimiter">(</span> _cursorType == CursorType.ARRAY <span class="delimiter">)</span><span class="delimiter">{</span>
            _all.add<span class="delimiter">(</span> _cur <span class="delimiter">)</span>;
        <span class="delimiter">}</span>

        <span class="keyword">return</span> _cur;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * gets the number of times, so far, that the cursor retrieved a batch from the database
     * @return
     */</span>
    public int <a title="()Int" id="44564">numGetMores</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span> _fake <span class="delimiter">)</span>
            <span class="keyword">return</span> <span class="int">0</span>;

        <span class="keyword">if</span> <span class="delimiter">(</span> _it instanceof DBApiLayer.Result <span class="delimiter">)</span>
            <span class="keyword">return</span> <span class="delimiter">(</span><span class="delimiter">(</span>DBApiLayer.Result<span class="delimiter">)</span>_it<span class="delimiter">)</span>.numGetMores<span class="delimiter">(</span><span class="delimiter">)</span>;

        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException<span class="delimiter">(</span><span class="string">&quot;_it not a real result&quot;</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * gets a list containing the number of items received in each batch
     * @return
     */</span>
    public List&lt;Integer&gt; <a title="()java.util.List[java.lang.Integer]" id="44565">getSizes</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span> _fake <span class="delimiter">)</span>
            <span class="keyword">return</span> <span class="keyword">new</span> LinkedList&lt;Integer&gt;<span class="delimiter">(</span><span class="delimiter">)</span>;

        <span class="keyword">if</span> <span class="delimiter">(</span> _it instanceof DBApiLayer.Result <span class="delimiter">)</span>
            <span class="keyword">return</span> <span class="delimiter">(</span><span class="delimiter">(</span>DBApiLayer.Result<span class="delimiter">)</span>_it<span class="delimiter">)</span>.getSizes<span class="delimiter">(</span><span class="delimiter">)</span>;

        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException<span class="delimiter">(</span><span class="string">&quot;_it not a real result&quot;</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="keyword">private</span> boolean <a title="()Boolean" id="44566">_hasNext</a><span class="delimiter">(</span><span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        _check<span class="delimiter">(</span><span class="delimiter">)</span>;

        <span class="keyword">if</span> <span class="delimiter">(</span> _limit &gt; <span class="int">0</span> &amp;&amp; _num &gt;= _limit <span class="delimiter">)</span>
            <span class="keyword">return</span> <span class="keyword">false</span>;

        <span class="keyword">return</span> _it.hasNext<span class="delimiter">(</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Returns the number of objects through which the cursor has iterated.
     * @return the number of objects seen
     */</span>
    public int <a title="()Int" id="44567">numSeen</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">return</span> _num;
    <span class="delimiter">}</span>

    <span class="comment">// ----- iterator api -----</span>

    <span class="comment">/**
     * Checks if there is another object available
     * @return
     * @throws MongoException
     */</span>
    public boolean <a title="()Boolean" id="44568">hasNext</a><span class="delimiter">(</span><span class="delimiter">)</span> throws MongoException <span class="delimiter">{</span>
        _checkType<span class="delimiter">(</span> CursorType.ITERATOR <span class="delimiter">)</span>;
        <span class="keyword">return</span> _hasNext<span class="delimiter">(</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Returns the object the cursor is at and moves the cursor ahead by one.
     * @return the next element
     * @throws MongoException
     */</span>
    public <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="()com.mongodb.DBObject" id="44569">next</a><span class="delimiter">(</span><span class="delimiter">)</span> throws MongoException <span class="delimiter">{</span>
        _checkType<span class="delimiter">(</span> CursorType.ITERATOR <span class="delimiter">)</span>;
        <span class="keyword">return</span> _next<span class="delimiter">(</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Returns the element the cursor is at.
     * @return the next element
     */</span>
    public <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="()com.mongodb.DBObject" id="44570">curr</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        _checkType<span class="delimiter">(</span> CursorType.ITERATOR <span class="delimiter">)</span>;
        <span class="keyword">return</span> _cur;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Not implemented.
     */</span>
    public void <a title="()Unit" id="44571">remove</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException<span class="delimiter">(</span> <span class="string">&quot;can't remove from a cursor&quot;</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>


    <span class="comment">//  ---- array api  -----</span>

    void <a title="(n: Int)Unit" id="44572">_fill</a><span class="delimiter">(</span> int <a title="Int" id="145275">n</a> <span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        _checkType<span class="delimiter">(</span> CursorType.ARRAY <span class="delimiter">)</span>;
        <span class="keyword">while</span> <span class="delimiter">(</span> n &gt;= _all.size<span class="delimiter">(</span><span class="delimiter">)</span> &amp;&amp; _hasNext<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>
            _next<span class="delimiter">(</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * pulls back all items into an array and returns the number of objects.
     * Note: this can be resource intensive
     * @see #count()
     * @see #size()
     * @return the number of elements in the array
     * @throws MongoException
     */</span>
    public int <a title="()Int" id="44573">length</a><span class="delimiter">(</span><span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        _checkType<span class="delimiter">(</span> CursorType.ARRAY <span class="delimiter">)</span>;
        _fill<span class="delimiter">(</span> Integer.MAX_VALUE <span class="delimiter">)</span>;
        <span class="keyword">return</span> _all.size<span class="delimiter">(</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Converts this cursor to an array.
     * @return an array of elements
     * @throws MongoException
     */</span>
    public List&lt;<a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a>&gt; <a title="()java.util.List[com.mongodb.DBObject]" id="44574">toArray</a><span class="delimiter">(</span><span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">return</span> toArray<span class="delimiter">(</span> Integer.MAX_VALUE <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Converts this cursor to an array.
     * @param max the maximum number of objects to return
     * @return an array of objects
     * @throws MongoException
     */</span>
    public List&lt;<a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a>&gt; <a title="(max: Int)java.util.List[com.mongodb.DBObject]" id="44575">toArray</a><span class="delimiter">(</span> int <a title="Int" id="145278">max</a> <span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        _checkType<span class="delimiter">(</span> CursorType.ARRAY <span class="delimiter">)</span>;
        _fill<span class="delimiter">(</span> max <span class="delimiter">)</span>;
        <span class="keyword">return</span> _all;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * for testing only!
     * Iterates cursor and counts objects
     * @see #count()
     * @return num objects
     */</span>
    public int <a title="()Int" id="44576">itcount</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        int n = <span class="int">0</span>;
        <span class="keyword">while</span> <span class="delimiter">(</span> <span class="keyword">this</span>.hasNext<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span><span class="delimiter">{</span>
            <span class="keyword">this</span>.next<span class="delimiter">(</span><span class="delimiter">)</span>;
            n++;
        <span class="delimiter">}</span>
        <span class="keyword">return</span> n;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Counts the number of objects matching the query
     * This does not take limit/skip into consideration
     * @see #size()
     * @return the number of objects
     * @throws MongoException
     */</span>
    public int <a title="()Int" id="44577">count</a><span class="delimiter">(</span><span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span> _collection == <span class="keyword">null</span> <span class="delimiter">)</span>
            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException<span class="delimiter">(</span> <span class="string">&quot;why is _collection null&quot;</span> <span class="delimiter">)</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span> _collection._db == <span class="keyword">null</span> <span class="delimiter">)</span>
            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException<span class="delimiter">(</span> <span class="string">&quot;why is _collection._db null&quot;</span> <span class="delimiter">)</span>;

        <span class="keyword">return</span> <span class="delimiter">(</span>int<span class="delimiter">)</span>_collection.getCount<span class="delimiter">(</span><span class="keyword">this</span>._query, <span class="keyword">this</span>._keysWanted<span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Counts the number of objects matching the query
     * this does take limit/skip into consideration
     * @see #count()
     * @return the number of objects
     * @throws MongoException
     */</span>
    public int <a title="()Int" id="44578">size</a><span class="delimiter">(</span><span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span> _collection == <span class="keyword">null</span> <span class="delimiter">)</span>
            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException<span class="delimiter">(</span> <span class="string">&quot;why is _collection null&quot;</span> <span class="delimiter">)</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span> _collection._db == <span class="keyword">null</span> <span class="delimiter">)</span>
            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException<span class="delimiter">(</span> <span class="string">&quot;why is _collection._db null&quot;</span> <span class="delimiter">)</span>;

        <span class="keyword">return</span> <span class="delimiter">(</span>int<span class="delimiter">)</span>_collection.getCount<span class="delimiter">(</span><span class="keyword">this</span>._query, <span class="keyword">this</span>._keysWanted, <span class="keyword">this</span>._limit, <span class="keyword">this</span>._skip <span class="delimiter">)</span>;
    <span class="delimiter">}</span>


    <span class="comment">/**
     * gets the fields to be returned
     * @return
     */</span>
    public <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="()com.mongodb.DBObject" id="44579">getKeysWanted</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">return</span> _keysWanted;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * gets the query
     * @return
     */</span>
    public <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="()com.mongodb.DBObject" id="44580">getQuery</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">return</span> _query;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * gets the collection
     * @return
     */</span>
    public <a href="DBCollection.java.html#7830" title="com.mongodb.DBCollection">DBCollection</a> <a title="()com.mongodb.DBCollection" id="44581">getCollection</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">return</span> _collection;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Gets the Server Address of the server that data is pulled from.
     * Note that this information is not available if no data has been retrieved yet.
     * Availability is specific to underlying implementation and may vary.
     * @return
     */</span>
    public <a href="ServerAddress.java.html#7911" title="com.mongodb.ServerAddress">ServerAddress</a> <a title="()com.mongodb.ServerAddress" id="44582">getServerAddress</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span>_it != <span class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">if</span> <span class="delimiter">(</span>_it instanceof DBApiLayer.Result<span class="delimiter">)</span>
                <span class="keyword">return</span> <span class="delimiter">(</span><span class="delimiter">(</span>DBApiLayer.Result<span class="delimiter">)</span>_it<span class="delimiter">)</span>.getServerAddress<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="delimiter">}</span>
        <span class="keyword">return</span> <span class="keyword">null</span>;
    <span class="delimiter">}</span>

    @Override
    public String <a title="()java.lang.String" id="44583">toString</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        StringBuilder sb = <span class="keyword">new</span> StringBuilder<span class="delimiter">(</span><span class="delimiter">)</span>;
        sb.append<span class="delimiter">(</span><span class="string">&quot;Cursor id=&quot;</span><span class="delimiter">)</span>.append<span class="delimiter">(</span>getCursorId<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
        sb.append<span class="delimiter">(</span><span class="string">&quot;, ns=&quot;</span><span class="delimiter">)</span>.append<span class="delimiter">(</span>getCollection<span class="delimiter">(</span><span class="delimiter">)</span>.getFullName<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
        sb.append<span class="delimiter">(</span><span class="string">&quot;, query=&quot;</span><span class="delimiter">)</span>.append<span class="delimiter">(</span>getQuery<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span>getKeysWanted<span class="delimiter">(</span><span class="delimiter">)</span> != <span class="keyword">null</span><span class="delimiter">)</span>
            sb.append<span class="delimiter">(</span><span class="string">&quot;, fields=&quot;</span><span class="delimiter">)</span>.append<span class="delimiter">(</span>getKeysWanted<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
        sb.append<span class="delimiter">(</span><span class="string">&quot;, numIterated=&quot;</span><span class="delimiter">)</span>.append<span class="delimiter">(</span>_num<span class="delimiter">)</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span>_skip != <span class="int">0</span><span class="delimiter">)</span>
            sb.append<span class="delimiter">(</span><span class="string">&quot;, skip=&quot;</span><span class="delimiter">)</span>.append<span class="delimiter">(</span>_skip<span class="delimiter">)</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span>_limit != <span class="int">0</span><span class="delimiter">)</span>
            sb.append<span class="delimiter">(</span><span class="string">&quot;, limit=&quot;</span><span class="delimiter">)</span>.append<span class="delimiter">(</span>_limit<span class="delimiter">)</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span>_batchSize != <span class="int">0</span><span class="delimiter">)</span>
            sb.append<span class="delimiter">(</span><span class="string">&quot;, batchSize=&quot;</span><span class="delimiter">)</span>.append<span class="delimiter">(</span>_batchSize<span class="delimiter">)</span>;

        ServerAddress addr = getServerAddress<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span>addr != <span class="keyword">null</span><span class="delimiter">)</span>
            sb.append<span class="delimiter">(</span><span class="string">&quot;, addr=&quot;</span><span class="delimiter">)</span>.append<span class="delimiter">(</span>addr<span class="delimiter">)</span>;
        <span class="keyword">return</span> sb.toString<span class="delimiter">(</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">// ----  query setup ----</span>
    <span class="keyword">private</span> <span class="keyword">final</span> <a href="DBCollection.java.html#7830" title="com.mongodb.DBCollection">DBCollection</a> <a title="com.mongodb.DBCollection" id="44584">_collection</a>;
    <span class="keyword">private</span> <span class="keyword">final</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="44585">_query</a>;
    <span class="keyword">private</span> <span class="keyword">final</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="44586">_keysWanted</a>;

    <span class="keyword">private</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="44587">_orderBy</a> = <span class="keyword">null</span>;
    <span class="keyword">private</span> String <a title="java.lang.String" id="44588">_hint</a> = <span class="keyword">null</span>;
    <span class="keyword">private</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="44589">_hintDBObj</a> = <span class="keyword">null</span>;
    <span class="keyword">private</span> boolean <a title="Boolean" id="44590">_explain</a> = <span class="keyword">false</span>;
    <span class="keyword">private</span> int <a title="Int" id="44591">_limit</a> = <span class="int">0</span>;
    <span class="keyword">private</span> int <a title="Int" id="44592">_batchSize</a> = <span class="int">0</span>;
    <span class="keyword">private</span> int <a title="Int" id="44593">_skip</a> = <span class="int">0</span>;
    <span class="keyword">private</span> boolean <a title="Boolean" id="44594">_snapshot</a> = <span class="keyword">false</span>;
    <span class="keyword">private</span> int <a title="Int" id="44595">_options</a> = <span class="int">0</span>;

    <span class="keyword">private</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="44596">_specialFields</a>;

    <span class="comment">// ----  result info ----</span>
    <span class="keyword">private</span> Iterator&lt;<a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a>&gt; <a title="java.util.Iterator[com.mongodb.DBObject]" id="44597">_it</a> = <span class="keyword">null</span>;
    <span class="keyword">private</span> boolean <a title="Boolean" id="44598">_fake</a> = <span class="keyword">false</span>;

    <span class="keyword">private</span> CursorType <a title="com.mongodb.DBCursor.CursorType" id="44599">_cursorType</a> = <span class="keyword">null</span>;
    <span class="keyword">private</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="44600">_cur</a> = <span class="keyword">null</span>;
    <span class="keyword">private</span> int <a title="Int" id="44601">_num</a> = <span class="int">0</span>;

    <span class="keyword">private</span> <span class="keyword">final</span> ArrayList&lt;<a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a>&gt; <a title="java.util.ArrayList[com.mongodb.DBObject]" id="44602">_all</a> = <span class="keyword">new</span> ArrayList&lt;DBObject&gt;<span class="delimiter">(</span><span class="delimiter">)</span>;
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
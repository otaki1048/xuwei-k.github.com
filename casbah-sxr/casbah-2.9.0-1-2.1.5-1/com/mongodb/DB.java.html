<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>com/mongodb/DB.java</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">// DB.java</span>

<span class="comment">/**
 *      Copyright (C) 2008 10gen Inc.
 *
 *   Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 *   you may not use this file except in compliance with the License.
 *   You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *   Unless required by applicable law or agreed to in writing, software
 *   distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *   See the License for the specific language governing permissions and
 *   limitations under the License.
 */</span>

<span class="keyword">package</span> com.mongodb;

<span class="keyword">import</span> java.io.*;
<span class="keyword">import</span> java.util.*;

<span class="keyword">import</span> com.mongodb.util.*;

<span class="comment">/**
 * an abstract class that represents a logical database on a server
 * @dochub databases
 */</span>
public <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="object com.mongodb.DB" id="7845">DB</a> <span class="delimiter">{</span>

    <span class="comment">/**
     * @param mongo the mongo instance
     * @param name the database name
     */</span>
    public DB<span class="delimiter">(</span> Mongo mongo , String name <span class="delimiter">)</span><span class="delimiter">{</span>
        _mongo = mongo;
    	_name = name;
        _options = <span class="keyword">new</span> Bytes.OptionHolder<span class="delimiter">(</span> _mongo._netOptions <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * starts a new &quot;consistent request&quot;.
     * Following this call and until requestDone() is called, all db operations should use the same underlying connection.
     * This is useful to ensure that operations happen in a certain order with predictable results.
     */</span>
    public <span class="keyword">abstract</span> void <a title="()Unit" id="43659">requestStart</a><span class="delimiter">(</span><span class="delimiter">)</span>;

    <span class="comment">/**
     * ends the current &quot;consistent request&quot;
     */</span>
    public <span class="keyword">abstract</span> void <a title="()Unit" id="43660">requestDone</a><span class="delimiter">(</span><span class="delimiter">)</span>;

    <span class="comment">/**
     * ensure that a connection is assigned to the current &quot;consistent request&quot;
     */</span>
    public <span class="keyword">abstract</span> void <a title="()Unit" id="43661">requestEnsureConnection</a><span class="delimiter">(</span><span class="delimiter">)</span>;
    
    <span class="comment">/**
     * Returns the collection represented by the string &amp;lt;dbName&amp;gt;.&amp;lt;collectionName&amp;gt;.
     * @param name the name of the collection
     * @return the collection
     */</span>
    <span class="keyword">protected</span> <span class="keyword">abstract</span> <a href="DBCollection.java.html#7830" title="com.mongodb.DBCollection">DBCollection</a> <a title="(name: java.lang.String)com.mongodb.DBCollection" id="43662">doGetCollection</a><span class="delimiter">(</span> String <a title="java.lang.String" id="145124">name</a> <span class="delimiter">)</span>;
    
    <span class="comment">/**
     * Gets a collection with a given name.
     * If the collection does not exist, a new collection is created.
     * @param name the name of the collection to return
     * @return the collection
     */</span>
    public <span class="keyword">final</span> <a href="DBCollection.java.html#7830" title="com.mongodb.DBCollection">DBCollection</a> <a title="(name: java.lang.String)com.mongodb.DBCollection" id="43663">getCollection</a><span class="delimiter">(</span> String <a title="java.lang.String" id="53870">name</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        DBCollection c = doGetCollection<span class="delimiter">(</span> name <span class="delimiter">)</span>;
        <span class="keyword">return</span> c;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Creates a collection with a given name and options.
     * If the collection does not exist, a new collection is created.
     * Note that if the options parameter is null, the creation will be deferred to when the collection is written to.
     * Possible options:
     * &lt;dl&gt;
     * &lt;dt&gt;capped&lt;/dt&gt;&lt;dd&gt;&lt;i&gt;boolean&lt;/i&gt;: if the collection is capped&lt;/dd&gt;
     * &lt;dt&gt;size&lt;/dt&gt;&lt;dd&gt;&lt;i&gt;int&lt;/i&gt;: collection size (in bytes)&lt;/dd&gt;
     * &lt;dt&gt;max&lt;/dt&gt;&lt;dd&gt;&lt;i&gt;int&lt;/i&gt;: max number of documents&lt;/dd&gt;
     * &lt;/dl&gt;
     * @param name the name of the collection to return
     * @param options options
     * @return the collection
     */</span>
    public <span class="keyword">final</span> <a href="DBCollection.java.html#7830" title="com.mongodb.DBCollection">DBCollection</a> <a title="(name: java.lang.String, options: com.mongodb.DBObject)com.mongodb.DBCollection" id="43664">createCollection</a><span class="delimiter">(</span> String <a title="java.lang.String" id="54226">name</a>, <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="54227">options</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span> options != <span class="keyword">null</span> <span class="delimiter">)</span><span class="delimiter">{</span>
            DBObject createCmd = <span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span><span class="string">&quot;create&quot;</span>, name<span class="delimiter">)</span>;
            createCmd.putAll<span class="delimiter">(</span>options<span class="delimiter">)</span>;
            CommandResult result = command<span class="delimiter">(</span>createCmd<span class="delimiter">)</span>;
            result.throwOnError<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="delimiter">}</span>
        <span class="keyword">return</span> getCollection<span class="delimiter">(</span>name<span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    
    <span class="comment">/**
     * Returns a collection matching a given string.
     * @param s the name of the collection
     * @return the collection
     */</span>
    public <a href="DBCollection.java.html#7830" title="com.mongodb.DBCollection">DBCollection</a> <a title="(s: java.lang.String)com.mongodb.DBCollection" id="43665">getCollectionFromString</a><span class="delimiter">(</span> String <a title="java.lang.String" id="54256">s</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        DBCollection foo = <span class="keyword">null</span>;
        
        int idx = s.indexOf<span class="delimiter">(</span> <span class="string">&quot;.&quot;</span> <span class="delimiter">)</span>;
        <span class="keyword">while</span> <span class="delimiter">(</span> idx &gt;= <span class="int">0</span> <span class="delimiter">)</span><span class="delimiter">{</span>
            String b = s.substring<span class="delimiter">(</span> <span class="int">0</span> , idx <span class="delimiter">)</span>;
            s = s.substring<span class="delimiter">(</span> idx + <span class="int">1</span> <span class="delimiter">)</span>;
            <span class="keyword">if</span> <span class="delimiter">(</span> foo == <span class="keyword">null</span> <span class="delimiter">)</span>
                foo = getCollection<span class="delimiter">(</span> b <span class="delimiter">)</span>;
            <span class="keyword">else</span>
                foo = foo.getCollection<span class="delimiter">(</span> b <span class="delimiter">)</span>;
            idx = s.indexOf<span class="delimiter">(</span> <span class="string">&quot;.&quot;</span> <span class="delimiter">)</span>;
        <span class="delimiter">}</span>

        <span class="keyword">if</span> <span class="delimiter">(</span> foo != <span class="keyword">null</span> <span class="delimiter">)</span>
            <span class="keyword">return</span> foo.getCollection<span class="delimiter">(</span> s <span class="delimiter">)</span>;
        <span class="keyword">return</span> getCollection<span class="delimiter">(</span> s <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Executes a database command.
     * This method calls {@link DB#command(com.mongodb.DBObject, int) } with 0 as query option.
     * @see &lt;a href=&quot;http://mongodb.onconfluence.com/display/DOCS/List+of+Database+Commands&quot;&gt;List of Commands&lt;/a&gt;
     * @param cmd dbobject representing the command to execute
     * @return result of command from the database
     * @throws MongoException
     * @dochub commands
     */</span>
    public <a href="CommandResult.java.html#7890" title="com.mongodb.CommandResult">CommandResult</a> <a title="(cmd: com.mongodb.DBObject)com.mongodb.CommandResult" id="43666">command</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="48172">cmd</a> <span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">return</span> command<span class="delimiter">(</span> cmd , <span class="int">0</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Executes a database command.
     * @see &lt;a href=&quot;http://mongodb.onconfluence.com/display/DOCS/List+of+Database+Commands&quot;&gt;List of Commands&lt;/a&gt;
     * @param cmd dbobject representing the command to execute
     * @param options query options to use
     * @return result of command from the database
     * @dochub commands
     * @throws MongoException
     */</span>
    public <a href="CommandResult.java.html#7890" title="com.mongodb.CommandResult">CommandResult</a> <a title="(cmd: com.mongodb.DBObject, options: Int)com.mongodb.CommandResult" id="43667">command</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="48170">cmd</a> , int <a title="Int" id="48171">options</a> <span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        
        Iterator&lt;DBObject&gt; i = getCollection<span class="delimiter">(</span><span class="string">&quot;$cmd&quot;</span><span class="delimiter">)</span>.__find<span class="delimiter">(</span>cmd, <span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span><span class="delimiter">)</span>, <span class="int">0</span>, -<span class="int">1</span>, <span class="int">0</span>, options<span class="delimiter">)</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span> i == <span class="keyword">null</span> || ! i.hasNext<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>
            <span class="keyword">return</span> <span class="keyword">null</span>;
        
        CommandResult res = <span class="delimiter">(</span>CommandResult<span class="delimiter">)</span>i.next<span class="delimiter">(</span><span class="delimiter">)</span>;
        res._cmd = cmd;
        <span class="keyword">return</span> res;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Executes a database command.
     * This method constructs a simple dbobject and calls {@link DB#command(com.mongodb.DBObject) }
     * @see &lt;a href=&quot;http://mongodb.onconfluence.com/display/DOCS/List+of+Database+Commands&quot;&gt;List of Commands&lt;/a&gt;
     * @param cmd command to execute
     * @return result of command from the database
     * @throws MongoException
     */</span>
    public <a href="CommandResult.java.html#7890" title="com.mongodb.CommandResult">CommandResult</a> <a title="(cmd: java.lang.String)com.mongodb.CommandResult" id="43668">command</a><span class="delimiter">(</span> String <a title="java.lang.String" id="48169">cmd</a> <span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">return</span> command<span class="delimiter">(</span> <span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span> cmd , Boolean.TRUE <span class="delimiter">)</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Executes a database command.
     * This method constructs a simple dbobject and calls {@link DB#command(com.mongodb.DBObject, int)  }
     * @see &lt;a href=&quot;http://mongodb.onconfluence.com/display/DOCS/List+of+Database+Commands&quot;&gt;List of Commands&lt;/a&gt;
     * @param cmd command to execute
     * @param options query options to use
     * @return result of command from the database
     * @throws MongoException
     */</span>
    public <a href="CommandResult.java.html#7890" title="com.mongodb.CommandResult">CommandResult</a> <a title="(cmd: java.lang.String, options: Int)com.mongodb.CommandResult" id="43669">command</a><span class="delimiter">(</span> String <a title="java.lang.String" id="48165">cmd</a>, int <a title="Int" id="48166">options</a>  <span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">return</span> command<span class="delimiter">(</span> <span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span> cmd , Boolean.TRUE <span class="delimiter">)</span>, options <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * evaluates a function on the database.
     * This is useful if you need to touch a lot of data lightly, in which case network transfer could be a bottleneck.
     * @param code the function in javascript code
     * @param args arguments to be passed to the function
     * @return
     * @throws MongoException
     */</span>
    public <a href="CommandResult.java.html#7890" title="com.mongodb.CommandResult">CommandResult</a> <a title="(code: java.lang.String, args: &lt;repeated...&gt;[java.lang.Object])com.mongodb.CommandResult" id="43670">doEval</a><span class="delimiter">(</span> String <a title="java.lang.String" id="54233">code</a> , <span title="&lt;repeated...&gt;">Object</span> ... <a title="&lt;repeated...&gt;[java.lang.Object]" id="54234">args</a> <span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>

        <span class="keyword">return</span> command<span class="delimiter">(</span> BasicDBObjectBuilder.start<span class="delimiter">(</span><span class="delimiter">)</span>
                        .add<span class="delimiter">(</span> <span class="string">&quot;$eval&quot;</span> , code <span class="delimiter">)</span>
                        .add<span class="delimiter">(</span> <span class="string">&quot;args&quot;</span> , args <span class="delimiter">)</span>
                        .get<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * calls {@link DB#doEval(java.lang.String, java.lang.Object[]) }.
     * If the command is successful, the &quot;retval&quot; field is extracted and returned.
     * Otherwise an exception is thrown.
     * @param code the function in javascript code
     * @param args arguments to be passed to the function
     * @return
     * @throws MongoException
     */</span>
    public Object <a title="(code: java.lang.String, args: &lt;repeated...&gt;[java.lang.Object])java.lang.Object" id="43671">eval</a><span class="delimiter">(</span> String <a title="java.lang.String" id="54243">code</a> , <span title="&lt;repeated...&gt;">Object</span> ... <a title="&lt;repeated...&gt;[java.lang.Object]" id="54244">args</a> <span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        
        CommandResult res = doEval<span class="delimiter">(</span> code , args <span class="delimiter">)</span>;
        res.throwOnError<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="keyword">return</span> res.get<span class="delimiter">(</span> <span class="string">&quot;retval&quot;</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Returns the result of &quot;dbstats&quot; command
     * @return
     */</span>
    public <a href="CommandResult.java.html#7890" title="com.mongodb.CommandResult">CommandResult</a> <a title="()com.mongodb.CommandResult" id="43672">getStats</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">return</span> command<span class="delimiter">(</span><span class="string">&quot;dbstats&quot;</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Returns the name of this database.
     * @return the name
     */</span>
    public String <a title="()java.lang.String" id="43673">getName</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
	<span class="keyword">return</span> _name;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Makes this database read-only.
     * Important note: this is a convenience setting that is only known on the client side and not persisted.
     * @param b if the database should be read-only
     */</span>
    public void <a title="(b: java.lang.Boolean)Unit" id="43674">setReadOnly</a><span class="delimiter">(</span> Boolean <a title="java.lang.Boolean" id="54434">b</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        _readOnly = b;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Returns a set containing the names of all collections in this database.
     * @return the names of collections in this database
     * @throws MongoException
     */</span>
    public Set&lt;String&gt; <a title="()java.util.Set[java.lang.String]" id="43675">getCollectionNames</a><span class="delimiter">(</span><span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>

        DBCollection namespaces = getCollection<span class="delimiter">(</span><span class="string">&quot;system.namespaces&quot;</span><span class="delimiter">)</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span>namespaces == <span class="keyword">null</span><span class="delimiter">)</span>
            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException<span class="delimiter">(</span><span class="string">&quot;this is impossible&quot;</span><span class="delimiter">)</span>;

        Iterator&lt;DBObject&gt; i = namespaces.__find<span class="delimiter">(</span><span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span><span class="delimiter">)</span>, <span class="keyword">null</span>, <span class="int">0</span>, <span class="int">0</span>, <span class="int">0</span>, getOptions<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span>i == <span class="keyword">null</span><span class="delimiter">)</span>
            <span class="keyword">return</span> <span class="keyword">new</span> HashSet&lt;String&gt;<span class="delimiter">(</span><span class="delimiter">)</span>;

        List&lt;String&gt; tables = <span class="keyword">new</span> ArrayList&lt;String&gt;<span class="delimiter">(</span><span class="delimiter">)</span>;

        <span class="keyword">for</span> <span class="delimiter">(</span>; i.hasNext<span class="delimiter">(</span><span class="delimiter">)</span>;<span class="delimiter">)</span> <span class="delimiter">{</span>
            DBObject o = i.next<span class="delimiter">(</span><span class="delimiter">)</span>;
            <span class="keyword">if</span> <span class="delimiter">(</span> o.get<span class="delimiter">(</span> <span class="string">&quot;name&quot;</span> <span class="delimiter">)</span> == <span class="keyword">null</span> <span class="delimiter">)</span><span class="delimiter">{</span>
                <span class="keyword">throw</span> <span class="keyword">new</span> MongoException<span class="delimiter">(</span> <span class="string">&quot;how is name null : &quot;</span> + o <span class="delimiter">)</span>;
            <span class="delimiter">}</span>
            String n = o.get<span class="delimiter">(</span><span class="string">&quot;name&quot;</span><span class="delimiter">)</span>.toString<span class="delimiter">(</span><span class="delimiter">)</span>;
            int idx = n.indexOf<span class="delimiter">(</span><span class="string">&quot;.&quot;</span><span class="delimiter">)</span>;

            String root = n.substring<span class="delimiter">(</span><span class="int">0</span>, idx<span class="delimiter">)</span>;
            <span class="keyword">if</span> <span class="delimiter">(</span>!root.equals<span class="delimiter">(</span>_name<span class="delimiter">)</span><span class="delimiter">)</span>
                continue;

            <span class="keyword">if</span> <span class="delimiter">(</span>n.indexOf<span class="delimiter">(</span><span class="string">&quot;$&quot;</span><span class="delimiter">)</span> &gt;= <span class="int">0</span><span class="delimiter">)</span>
                continue;

            String table = n.substring<span class="delimiter">(</span>idx + <span class="int">1</span><span class="delimiter">)</span>;

            tables.add<span class="delimiter">(</span>table<span class="delimiter">)</span>;
        <span class="delimiter">}</span>

        Collections.sort<span class="delimiter">(</span>tables<span class="delimiter">)</span>;

        <span class="keyword">return</span> <span class="keyword">new</span> LinkedHashSet&lt;String&gt;<span class="delimiter">(</span>tables<span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Checks to see if a collection by name %lt;name&amp;gt; exists.
     * @param collectionName The collection to test for existence
     * @return false if no collection by that name exists, true if a match to an existing collection was found
     */</span>
    public boolean <a title="(collectionName: java.lang.String)Boolean" id="43676">collectionExists</a><span class="delimiter">(</span>String <a title="java.lang.String" id="54464">collectionName</a><span class="delimiter">)</span>
    <span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span>collectionName == <span class="keyword">null</span> || <span class="string">&quot;&quot;</span>.equals<span class="delimiter">(</span>collectionName<span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="keyword">return</span> <span class="keyword">false</span>;

        Set&lt;String&gt; collections = getCollectionNames<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span>collections.isEmpty<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="keyword">return</span> <span class="keyword">false</span>;

        <span class="keyword">for</span> <span class="delimiter">(</span>String collection : collections<span class="delimiter">)</span>
        <span class="delimiter">{</span>
            <span class="keyword">if</span> <span class="delimiter">(</span>collectionName.equalsIgnoreCase<span class="delimiter">(</span>collection<span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="keyword">return</span> <span class="keyword">true</span>;
        <span class="delimiter">}</span>

        <span class="keyword">return</span> <span class="keyword">false</span>;
    <span class="delimiter">}</span>


    <span class="comment">/**
     * Returns the name of this database.
     * @return the name
     */</span>
    @Override
    public String <a title="()java.lang.String" id="43677">toString</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">return</span> _name;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Gets the the error (if there is one) from the previous operation on this connection.
     * The result of this command will look like
     *
     * &lt;pre&gt;
     * { &quot;err&quot; :  errorMessage  , &quot;ok&quot; : 1.0 }
     * &lt;/pre&gt;
     *
     * The value for errorMessage will be null if no error occurred, or a description otherwise.
     *
     * Important note: when calling this method directly, it is undefined which connection &quot;getLastError&quot; is called on.
     * You may need to explicitly use a &quot;consistent Request&quot;, see {@link DB#requestStart()}
     * For most purposes it is better not to call this method directly but instead use {@link WriteConcern}
     *
     * @return DBObject with error and status information
     * @throws MongoException
     */</span>
    public <a href="CommandResult.java.html#7890" title="com.mongodb.CommandResult">CommandResult</a> <a title="()com.mongodb.CommandResult" id="43678">getLastError</a><span class="delimiter">(</span><span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">return</span> command<span class="delimiter">(</span><span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span><span class="string">&quot;getlasterror&quot;</span>, <span class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * @see {@link DB#getLastError()}
     * @param concern the concern associated with &quot;getLastError&quot; call
     * @return
     * @throws MongoException
     */</span>
    public <a href="CommandResult.java.html#7890" title="com.mongodb.CommandResult">CommandResult</a> <a title="(concern: com.mongodb.WriteConcern)com.mongodb.CommandResult" id="43679">getLastError</a><span class="delimiter">(</span> com.mongodb.<a href="WriteConcern.java.html#7896" title="com.mongodb.WriteConcern">WriteConcern</a> <a title="com.mongodb.WriteConcern" id="51916">concern</a> <span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">return</span> command<span class="delimiter">(</span> concern.getCommand<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * @see {@link DB#getLastError(com.mongodb.WriteConcern) }
     * @param w 
     * @param wtimeout
     * @param fsync
     * @return
     * @throws MongoException
     */</span>
    public <a href="CommandResult.java.html#7890" title="com.mongodb.CommandResult">CommandResult</a> <a title="(w: Int, wtimeout: Int, fsync: Boolean)com.mongodb.CommandResult" id="43680">getLastError</a><span class="delimiter">(</span> int <a title="Int" id="51913">w</a> , int <a title="Int" id="51914">wtimeout</a> , boolean <a title="Boolean" id="51915">fsync</a> <span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">return</span> command<span class="delimiter">(</span> <span class="delimiter">(</span><span class="keyword">new</span> com.mongodb.WriteConcern<span class="delimiter">(</span> w, wtimeout , fsync <span class="delimiter">)</span><span class="delimiter">)</span>.getCommand<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>


    <span class="comment">/**
     * Sets the write concern for this database. It Will be used for
     * writes to any collection in this database. See the
     * documentation for {@link WriteConcern} for more information.
     *
     * @param concern write concern to use
     */</span>
    public void <a title="(concern: com.mongodb.WriteConcern)Unit" id="43681">setWriteConcern</a><span class="delimiter">(</span> com.mongodb.<a href="WriteConcern.java.html#7896" title="com.mongodb.WriteConcern">WriteConcern</a> <a title="com.mongodb.WriteConcern" id="54448">concern</a> <span class="delimiter">)</span><span class="delimiter">{</span>
	<span class="keyword">if</span> <span class="delimiter">(</span>concern == <span class="keyword">null</span><span class="delimiter">)</span> <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException<span class="delimiter">(</span><span class="delimiter">)</span>;
        _concern = concern;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Gets the write concern for this database.
     * @return
     */</span>
    public com.mongodb.<a href="WriteConcern.java.html#7896" title="com.mongodb.WriteConcern">WriteConcern</a> <a title="()com.mongodb.WriteConcern" id="43682">getWriteConcern</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span> _concern != <span class="keyword">null</span> <span class="delimiter">)</span>
            <span class="keyword">return</span> _concern;
        <span class="keyword">return</span> _mongo.getWriteConcern<span class="delimiter">(</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Drops this database. Removes all data on disk. Use with caution.
     * @throws MongoException
     */</span>
    public void <a title="()Unit" id="43683">dropDatabase</a><span class="delimiter">(</span><span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>

        CommandResult res = command<span class="delimiter">(</span><span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span><span class="string">&quot;dropDatabase&quot;</span>, <span class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>;
        res.throwOnError<span class="delimiter">(</span><span class="delimiter">)</span>;
        _mongo._dbs.remove<span class="delimiter">(</span><span class="keyword">this</span>.getName<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Returns true if a user has been authenticated
     *
     * @return true if authenticated, false otherwise
     * @dochub authenticate
     */</span>
    public boolean <a title="()Boolean" id="43684">isAuthenticated</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
	<span class="keyword">return</span> <span class="delimiter">(</span> _username != <span class="keyword">null</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     *  Authenticates to db with the given name and password
     *
     * @param username name of user for this database
     * @param passwd password of user for this database
     * @return true if authenticated, false otherwise
     * @throws MongoException
     * @dochub authenticate
     */</span>
    public boolean <a title="(username: java.lang.String, passwd: Array[Char])Boolean" id="43685">authenticate</a><span class="delimiter">(</span>String <a title="java.lang.String" id="54074">username</a>, char<span class="delimiter">[</span><span title="Array" class="delimiter">]</span> <a title="Array[Char]" id="54075">passwd</a> <span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        
        <span class="keyword">if</span> <span class="delimiter">(</span> username == <span class="keyword">null</span> || passwd == <span class="keyword">null</span> <span class="delimiter">)</span>
            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException<span class="delimiter">(</span> <span class="string">&quot;username can't be null&quot;</span> <span class="delimiter">)</span>;
        
        <span class="keyword">if</span> <span class="delimiter">(</span> _username != <span class="keyword">null</span> <span class="delimiter">)</span>
	    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException<span class="delimiter">(</span> <span class="string">&quot;can't call authenticate twice on the same DBObject&quot;</span> <span class="delimiter">)</span>;
        
        String hash = _hash<span class="delimiter">(</span> username , passwd <span class="delimiter">)</span>;
        CommandResult res = _doauth<span class="delimiter">(</span> username , hash.getBytes<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span> !res.ok<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="keyword">return</span> <span class="keyword">false</span>;
        _username = username;
        _authhash = hash.getBytes<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="keyword">return</span> <span class="keyword">true</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     *  Authenticates to db with the given name and password
     *
     * @param username name of user for this database
     * @param passwd password of user for this database
     * @return the CommandResult from authenticate command
     * @throws MongoException if authentication failed due to invalid user/pass, or other exceptions like I/O
     * @dochub authenticate
     */</span>
    public <a href="CommandResult.java.html#7890" title="com.mongodb.CommandResult">CommandResult</a> <a title="(username: java.lang.String, passwd: Array[Char])com.mongodb.CommandResult" id="43686">authenticateCommand</a><span class="delimiter">(</span>String <a title="java.lang.String" id="145125">username</a>, char<span class="delimiter">[</span><span title="Array" class="delimiter">]</span> <a title="Array[Char]" id="145126">passwd</a> <span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>

        <span class="keyword">if</span> <span class="delimiter">(</span> username == <span class="keyword">null</span> || passwd == <span class="keyword">null</span> <span class="delimiter">)</span>
            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException<span class="delimiter">(</span> <span class="string">&quot;username can't be null&quot;</span> <span class="delimiter">)</span>;

        <span class="keyword">if</span> <span class="delimiter">(</span> _username != <span class="keyword">null</span> <span class="delimiter">)</span>
	    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException<span class="delimiter">(</span> <span class="string">&quot;can't call authenticate twice on the same DBObject&quot;</span> <span class="delimiter">)</span>;

        String hash = _hash<span class="delimiter">(</span> username , passwd <span class="delimiter">)</span>;
        CommandResult res = _doauth<span class="delimiter">(</span> username , hash.getBytes<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>;
        res.throwOnError<span class="delimiter">(</span><span class="delimiter">)</span>;
        _username = username;
        _authhash = hash.getBytes<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="keyword">return</span> res;
    <span class="delimiter">}</span>
    
    <span class="comment">/*
    boolean reauth(){
        if ( _username == null || _authhash == null )
            throw new IllegalStateException( &quot;no auth info!&quot; );
        return _doauth( _username , _authhash );
    }
    */</span>

    <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="(nonce: java.lang.String)com.mongodb.DBObject" id="43687">_authCommand</a><span class="delimiter">(</span> String <a title="java.lang.String" id="145127">nonce</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span> _username == <span class="keyword">null</span> || _authhash == <span class="keyword">null</span> <span class="delimiter">)</span>
            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException<span class="delimiter">(</span> <span class="string">&quot;no auth info!&quot;</span> <span class="delimiter">)</span>;

        <span class="keyword">return</span> _authCommand<span class="delimiter">(</span> nonce , _username , _authhash <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    static <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="(nonce: java.lang.String, username: java.lang.String, hash: Array[Byte])com.mongodb.DBObject" id="48168">_authCommand</a><span class="delimiter">(</span> String <a title="java.lang.String" id="145120">nonce</a> , String <a title="java.lang.String" id="145121">username</a> , byte<span class="delimiter">[</span><span title="Array" class="delimiter">]</span> <a title="Array[Byte]" id="145122">hash</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        String key = nonce + username + <span class="keyword">new</span> String<span class="delimiter">(</span> hash <span class="delimiter">)</span>;
        
        BasicDBObject cmd = <span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span><span class="delimiter">)</span>;

        cmd.put<span class="delimiter">(</span><span class="string">&quot;authenticate&quot;</span>, <span class="int">1</span><span class="delimiter">)</span>;
        cmd.put<span class="delimiter">(</span><span class="string">&quot;user&quot;</span>, username<span class="delimiter">)</span>;
        cmd.put<span class="delimiter">(</span><span class="string">&quot;nonce&quot;</span>, nonce<span class="delimiter">)</span>;
        cmd.put<span class="delimiter">(</span><span class="string">&quot;key&quot;</span>, Util.hexMD5<span class="delimiter">(</span>key.getBytes<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>;
        
        <span class="keyword">return</span> cmd;
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <a href="CommandResult.java.html#7890" title="com.mongodb.CommandResult">CommandResult</a> <a title="(username: java.lang.String, hash: Array[Byte])com.mongodb.CommandResult" id="43688">_doauth</a><span class="delimiter">(</span> String <a title="java.lang.String" id="145128">username</a> , byte<span class="delimiter">[</span><span title="Array" class="delimiter">]</span> <a title="Array[Byte]" id="145129">hash</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        CommandResult res = command<span class="delimiter">(</span><span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span><span class="string">&quot;getnonce&quot;</span>, <span class="int">1</span><span class="delimiter">)</span>, getOptions<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
        res.throwOnError<span class="delimiter">(</span><span class="delimiter">)</span>;

        DBObject cmd = _authCommand<span class="delimiter">(</span> res.getString<span class="delimiter">(</span> <span class="string">&quot;nonce&quot;</span> <span class="delimiter">)</span> , username , hash <span class="delimiter">)</span>;
        <span class="keyword">return</span> command<span class="delimiter">(</span>cmd, getOptions<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Adds a new user for this db
     * @param username
     * @param passwd
     */</span>
    public <a href="WriteResult.java.html#7959" title="com.mongodb.WriteResult">WriteResult</a> <a title="(username: java.lang.String, passwd: Array[Char])com.mongodb.WriteResult" id="43689">addUser</a><span class="delimiter">(</span> String <a title="java.lang.String" id="53920">username</a> , char<span class="delimiter">[</span><span title="Array" class="delimiter">]</span> <a title="Array[Char]" id="53921">passwd</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">return</span> addUser<span class="delimiter">(</span>username, passwd, <span class="keyword">false</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Adds a new user for this db
     * @param username
     * @param passwd
     * @param readOnly if true, user will only be able to read
     */</span>
    public <a href="WriteResult.java.html#7959" title="com.mongodb.WriteResult">WriteResult</a> <a title="(username: java.lang.String, passwd: Array[Char], readOnly: Boolean)com.mongodb.WriteResult" id="43690">addUser</a><span class="delimiter">(</span> String <a title="java.lang.String" id="53917">username</a> , char<span class="delimiter">[</span><span title="Array" class="delimiter">]</span> <a title="Array[Char]" id="53918">passwd</a>, boolean <a title="Boolean" id="53919">readOnly</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        DBCollection c = getCollection<span class="delimiter">(</span> <span class="string">&quot;system.users&quot;</span> <span class="delimiter">)</span>;
        DBObject o = c.findOne<span class="delimiter">(</span> <span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span> <span class="string">&quot;user&quot;</span> , username <span class="delimiter">)</span> <span class="delimiter">)</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span> o == <span class="keyword">null</span> <span class="delimiter">)</span>
            o = <span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span> <span class="string">&quot;user&quot;</span> , username <span class="delimiter">)</span>;
        o.put<span class="delimiter">(</span> <span class="string">&quot;pwd&quot;</span> , _hash<span class="delimiter">(</span> username , passwd <span class="delimiter">)</span> <span class="delimiter">)</span>;
        o.put<span class="delimiter">(</span> <span class="string">&quot;readOnly&quot;</span> , readOnly <span class="delimiter">)</span>;
        <span class="keyword">return</span> c.save<span class="delimiter">(</span> o <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Removes a user for this db
     * @param username
     */</span>
    public <a href="WriteResult.java.html#7959" title="com.mongodb.WriteResult">WriteResult</a> <a title="(username: java.lang.String)com.mongodb.WriteResult" id="43691">removeUser</a><span class="delimiter">(</span> String <a title="java.lang.String" id="145130">username</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        DBCollection c = getCollection<span class="delimiter">(</span> <span class="string">&quot;system.users&quot;</span> <span class="delimiter">)</span>;
        <span class="keyword">return</span> c.remove<span class="delimiter">(</span><span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span> <span class="string">&quot;user&quot;</span> , username <span class="delimiter">)</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    String <a title="(username: java.lang.String, passwd: Array[Char])java.lang.String" id="43692">_hash</a><span class="delimiter">(</span> String <a title="java.lang.String" id="145131">username</a> , char<span class="delimiter">[</span><span title="Array" class="delimiter">]</span> <a title="Array[Char]" id="145132">passwd</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        ByteArrayOutputStream bout = <span class="keyword">new</span> ByteArrayOutputStream<span class="delimiter">(</span> username.length<span class="delimiter">(</span><span class="delimiter">)</span> + <span class="int">20</span> + passwd.length <span class="delimiter">)</span>;
        <span class="keyword">try</span> <span class="delimiter">{</span>
            bout.write<span class="delimiter">(</span> username.getBytes<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>;
            bout.write<span class="delimiter">(</span> <span class="string">&quot;:mongo:&quot;</span>.getBytes<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>;
            <span class="keyword">for</span> <span class="delimiter">(</span> int i=<span class="int">0</span>; i&lt;passwd.length; i++ <span class="delimiter">)</span><span class="delimiter">{</span>
                <span class="keyword">if</span> <span class="delimiter">(</span> passwd<span class="delimiter">[</span>i<span class="delimiter">]</span> &gt;= <span class="int">128</span> <span class="delimiter">)</span>
                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException<span class="delimiter">(</span> <span class="string">&quot;can't handle non-ascii passwords yet&quot;</span> <span class="delimiter">)</span>;
                bout.write<span class="delimiter">(</span> <span class="delimiter">(</span>byte<span class="delimiter">)</span>passwd<span class="delimiter">[</span>i<span class="delimiter">]</span> <span class="delimiter">)</span>;
            <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        <span class="keyword">catch</span> <span class="delimiter">(</span> IOException ioe <span class="delimiter">)</span><span class="delimiter">{</span>
            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException<span class="delimiter">(</span> <span class="string">&quot;impossible&quot;</span> , ioe <span class="delimiter">)</span>;
        <span class="delimiter">}</span>
        <span class="keyword">return</span> Util.hexMD5<span class="delimiter">(</span> bout.toByteArray<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     *  Returns the last error that occurred since start of database or a call to &lt;code&gt;resetError()&lt;/code&gt;
     *
     *  The return object will look like
     *
     *  &lt;pre&gt;
     * { err : errorMessage, nPrev : countOpsBack, ok : 1 }
     *  &lt;/pre&gt;
     *
     * The value for errorMessage will be null of no error has occurred, otherwise the error message.
     * The value of countOpsBack will be the number of operations since the error occurred.
     *
     * Care must be taken to ensure that calls to getPreviousError go to the same connection as that
     * of the previous operation.
     * See {@link DB#requestStart()} for more information.
     *
     * @return DBObject with error and status information
     * @throws MongoException
     */</span>
    public <a href="CommandResult.java.html#7890" title="com.mongodb.CommandResult">CommandResult</a> <a title="()com.mongodb.CommandResult" id="43693">getPreviousError</a><span class="delimiter">(</span><span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">return</span> command<span class="delimiter">(</span><span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span><span class="string">&quot;getpreverror&quot;</span>, <span class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Resets the error memory for this database.
     * Used to clear all errors such that {@link DB#getPreviousError()} will return no error.
     * @throws MongoException
     */</span>
    public void <a title="()Unit" id="43694">resetError</a><span class="delimiter">(</span><span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        command<span class="delimiter">(</span><span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span><span class="string">&quot;reseterror&quot;</span>, <span class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * For testing purposes only - this method forces an error to help test error handling
     * @throws MongoException
     */</span>
    public void <a title="()Unit" id="43695">forceError</a><span class="delimiter">(</span><span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        command<span class="delimiter">(</span><span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span><span class="string">&quot;forceerror&quot;</span>, <span class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Gets the Mongo instance
     * @return
     */</span>
    public <a href="Mongo.java.html#7809" title="com.mongodb.Mongo">Mongo</a> <a title="()com.mongodb.Mongo" id="43696">getMongo</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">return</span> _mongo;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Gets another database on same server
     * @param name name of the database
     * @return
     */</span>
    public <a href="#7845" title="com.mongodb.DB">DB</a> <a title="(name: java.lang.String)com.mongodb.DB" id="43697">getSisterDB</a><span class="delimiter">(</span> String <a title="java.lang.String" id="54373">name</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">return</span> _mongo.getDB<span class="delimiter">(</span> name <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Makes it possible to execute &quot;read&quot; queries on a slave node
     */</span>
    public void <a title="()Unit" id="43698">slaveOk</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        addOption<span class="delimiter">(</span> Bytes.QUERYOPTION_SLAVEOK <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Adds the give option
     * @param option
     */</span>
    public void <a title="(option: Int)Unit" id="43699">addOption</a><span class="delimiter">(</span> int <a title="Int" id="54523">option</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        _options.add<span class="delimiter">(</span> option <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Sets the query options
     * @param options
     */</span>
    public void <a title="(options: Int)Unit" id="43700">setOptions</a><span class="delimiter">(</span> int <a title="Int" id="145133">options</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        _options.set<span class="delimiter">(</span> options <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Resets the query options
     */</span>
    public void <a title="()Unit" id="43701">resetOptions</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        _options.reset<span class="delimiter">(</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>
   
    <span class="comment">/**
     * Gets the query options
     * @return
     */</span>
    public int <a title="()Int" id="43702">getOptions</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">return</span> _options.get<span class="delimiter">(</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    public <span class="keyword">abstract</span> void <a title="(force: Boolean)Unit" id="43703">cleanCursors</a><span class="delimiter">(</span> boolean <a title="Boolean" id="145134">force</a> <span class="delimiter">)</span> throws MongoException;


    <span class="keyword">final</span> <a href="Mongo.java.html#7809" title="com.mongodb.Mongo">Mongo</a> <a title="com.mongodb.Mongo" id="43704">_mongo</a>;
    <span class="keyword">final</span> String <a title="java.lang.String" id="43705">_name</a>;

    <span class="keyword">protected</span> boolean <a title="Boolean" id="43706">_readOnly</a> = <span class="keyword">false</span>;
    <span class="keyword">private</span> com.mongodb.<a href="WriteConcern.java.html#7896" title="com.mongodb.WriteConcern">WriteConcern</a> <a title="com.mongodb.WriteConcern" id="43707">_concern</a>;
    <span class="keyword">final</span> <a href="Bytes.java.html#7963" title="object com.mongodb.Bytes">Bytes</a>.<a href="Bytes.java.html#66824" title="com.mongodb.Bytes.OptionHolder">OptionHolder</a> <a title="com.mongodb.Bytes.OptionHolder" id="43708">_options</a>;

    String <a title="java.lang.String" id="43709">_username</a>;
    byte<span class="delimiter">[</span><span title="Array" class="delimiter">]</span> <a title="Array[Byte]" id="43710">_authhash</a> = <span class="keyword">null</span>;

<span class="delimiter">}</span>

        </pre>
    </body>
</html>
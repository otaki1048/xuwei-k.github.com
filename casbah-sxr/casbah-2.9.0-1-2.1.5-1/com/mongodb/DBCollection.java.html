<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>com/mongodb/DBCollection.java</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">// DBCollection.java</span>

<span class="comment">/**
 *      Copyright (C) 2008 10gen Inc.
 *
 *   Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 *   you may not use this file except in compliance with the License.
 *   You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *   Unless required by applicable law or agreed to in writing, software
 *   distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *   See the License for the specific language governing permissions and
 *   limitations under the License.
 */</span>

<span class="keyword">package</span> com.mongodb;

<span class="comment">// Mongo</span>
<span class="keyword">import</span> java.util.*;

<span class="keyword">import</span> org.bson.types.ObjectId;

<span class="comment">/** This class provides a skeleton implementation of a database collection.  
 * &lt;p&gt;A typical invocation sequence is thus
 * &lt;blockquote&gt;&lt;pre&gt;
 *     Mongo mongo = new Mongo( new DBAddress( &quot;localhost&quot;, 127017 ) );
 *     DB db = mongo.getDB( &quot;mydb&quot; );
 *     DBCollection collection = db.getCollection( &quot;test&quot; );
 * &lt;/pre&gt;&lt;/blockquote&gt;
 * @dochub collections
 */</span>
@SuppressWarnings<span class="delimiter">(</span><span class="string">&quot;unchecked&quot;</span><span class="delimiter">)</span>
public <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="object com.mongodb.DBCollection" id="7830">DBCollection</a> <span class="delimiter">{</span>

    <span class="comment">/**
     * Saves document(s) to the database.
     * if doc doesn't have an _id, one will be added
     * you can get the _id that was added from doc after the insert
     *
     * @param arr  array of documents to save
     * @param concern the write concern
     * @return
     * @throws MongoException
     * @dochub insert
     */</span>
    public <span class="keyword">abstract</span> <a href="WriteResult.java.html#7959" title="com.mongodb.WriteResult">WriteResult</a> <a title="(arr: Array[com.mongodb.DBObject], concern: com.mongodb.WriteConcern)com.mongodb.WriteResult" id="44329">insert</a><span class="delimiter">(</span><a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a><span class="delimiter">[</span><span title="Array" class="delimiter">]</span> <a title="Array[com.mongodb.DBObject]" id="49126">arr</a> , <a href="WriteConcern.java.html#7896" title="com.mongodb.WriteConcern">WriteConcern</a> <a title="com.mongodb.WriteConcern" id="49127">concern</a> <span class="delimiter">)</span> throws MongoException;

    <span class="comment">/**
     * Inserts a document into the database.
     * if doc doesn't have an _id, one will be added
     * you can get the _id that was added from doc after the insert
     *
     * @param o 
     * @param concern the write concern
     * @return
     * @throws MongoException
     * @dochub insert
     */</span>
    public <a href="WriteResult.java.html#7959" title="com.mongodb.WriteResult">WriteResult</a> <a title="(o: com.mongodb.DBObject, concern: com.mongodb.WriteConcern)com.mongodb.WriteResult" id="44330">insert</a><span class="delimiter">(</span><a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="49124">o</a> , <a href="WriteConcern.java.html#7896" title="com.mongodb.WriteConcern">WriteConcern</a> <a title="com.mongodb.WriteConcern" id="49125">concern</a> <span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">return</span> insert<span class="delimiter">(</span> <span class="keyword">new</span> DBObject<span class="delimiter">[</span><span class="delimiter">]</span><span class="delimiter">{</span> o <span class="delimiter">}</span> , concern <span class="delimiter">)</span>;
    <span class="delimiter">}</span>


    <span class="comment">/**
     * Saves document(s) to the database.
     * if doc doesn't have an _id, one will be added
     * you can get the _id that was added from doc after the insert
     *
     * @param arr  array of documents to save
     * @return 
     * @throws MongoException
     * @dochub insert
     */</span>
    public <a href="WriteResult.java.html#7959" title="com.mongodb.WriteResult">WriteResult</a> <a title="(arr: &lt;repeated...&gt;[com.mongodb.DBObject])com.mongodb.WriteResult" id="44331">insert</a><span class="delimiter">(</span><a href="DBObject.java.html#7932" title="&lt;repeated...&gt;">DBObject</a> ... <a title="&lt;repeated...&gt;[com.mongodb.DBObject]" id="49123">arr</a><span class="delimiter">)</span> 
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">return</span> insert<span class="delimiter">(</span> arr , getWriteConcern<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Saves document(s) to the database.
     * if doc doesn't have an _id, one will be added
     * you can get the _id that was added from doc after the insert
     *
     * @param list list of documents to save
     * @return 
     * @throws MongoException
     * @dochub insert
     */</span>
    public <a href="WriteResult.java.html#7959" title="com.mongodb.WriteResult">WriteResult</a> <a title="(list: java.util.List[com.mongodb.DBObject])com.mongodb.WriteResult" id="44332">insert</a><span class="delimiter">(</span>List&lt;<a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a>&gt; <a title="java.util.List[com.mongodb.DBObject]" id="49122">list</a><span class="delimiter">)</span> 
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">return</span> insert<span class="delimiter">(</span> list.toArray<span class="delimiter">(</span> <span class="keyword">new</span> DBObject<span class="delimiter">[</span>list.size<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">]</span> <span class="delimiter">)</span> , getWriteConcern<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Saves document(s) to the database.
     * if doc doesn't have an _id, one will be added
     * you can get the _id that was added from doc after the insert
     *
     * @param list list of documents to save
     * @param concern the write concern
     * @return
     * @throws MongoException
     * @dochub insert
     */</span>
    public <a href="WriteResult.java.html#7959" title="com.mongodb.WriteResult">WriteResult</a> <a title="(list: java.util.List[com.mongodb.DBObject], concern: com.mongodb.WriteConcern)com.mongodb.WriteResult" id="44333">insert</a><span class="delimiter">(</span>List&lt;<a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a>&gt; <a title="java.util.List[com.mongodb.DBObject]" id="49120">list</a>, <a href="WriteConcern.java.html#7896" title="com.mongodb.WriteConcern">WriteConcern</a> <a title="com.mongodb.WriteConcern" id="49121">concern</a> <span class="delimiter">)</span> 
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">return</span> insert<span class="delimiter">(</span> list.toArray<span class="delimiter">(</span> <span class="keyword">new</span> DBObject<span class="delimiter">[</span>list.size<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">]</span> <span class="delimiter">)</span> , concern <span class="delimiter">)</span>;
    <span class="delimiter">}</span>


    <span class="comment">/**
     * Performs an update operation.
     * @param q search query for old object to update
     * @param o object with which to update &lt;tt&gt;q&lt;/tt&gt;
     * @param upsert if the database should create the element if it does not exist
     * @param multi if the update should be applied to all objects matching (db version 1.1.3 and above). An object will
     * not be inserted if it does not exist in the collection and upsert=true and multi=true.
     * See &lt;a href=&quot;http://www.mongodb.org/display/DOCS/Atomic+Operations&quot;&gt;http://www.mongodb.org/display/DOCS/Atomic+Operations&lt;/a&gt;
     * @param concern the write concern
     * @return
     * @throws MongoException
     * @dochub update
     */</span>
    public <span class="keyword">abstract</span> <a href="WriteResult.java.html#7959" title="com.mongodb.WriteResult">WriteResult</a> <a title="(q: com.mongodb.DBObject, o: com.mongodb.DBObject, upsert: Boolean, multi: Boolean, concern: com.mongodb.WriteConcern)com.mongodb.WriteResult" id="44334">update</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="51586">q</a> , <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="51587">o</a> , boolean <a title="Boolean" id="51588">upsert</a> , boolean <a title="Boolean" id="51589">multi</a> , <a href="WriteConcern.java.html#7896" title="com.mongodb.WriteConcern">WriteConcern</a> <a title="com.mongodb.WriteConcern" id="51590">concern</a> <span class="delimiter">)</span> throws MongoException ;

    <span class="comment">/**
     * calls {@link DBCollection#update(com.mongodb.DBObject, com.mongodb.DBObject, boolean, boolean, com.mongodb.WriteConcern)} with default WriteConcern.
     * @param q search query for old object to update
     * @param o object with which to update &lt;tt&gt;q&lt;/tt&gt;
     * @param upsert if the database should create the element if it does not exist
     * @param multi if the update should be applied to all objects matching (db version 1.1.3 and above)
     *              See http://www.mongodb.org/display/DOCS/Atomic+Operations
     * @return 
     * @throws MongoException
     * @dochub update
     */</span>
    public <a href="WriteResult.java.html#7959" title="com.mongodb.WriteResult">WriteResult</a> <a title="(q: com.mongodb.DBObject, o: com.mongodb.DBObject, upsert: Boolean, multi: Boolean)com.mongodb.WriteResult" id="44335">update</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="51582">q</a> , <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="51583">o</a> , boolean <a title="Boolean" id="51584">upsert</a> , boolean <a title="Boolean" id="51585">multi</a> <span class="delimiter">)</span> 
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">return</span> update<span class="delimiter">(</span> q , o , upsert , multi , getWriteConcern<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * calls {@link DBCollection#update(com.mongodb.DBObject, com.mongodb.DBObject, boolean, boolean)} with upsert=false and multi=false
     * @param q search query for old object to update
     * @param o object with which to update &lt;tt&gt;q&lt;/tt&gt;
     * @return
     * @throws MongoException
     * @dochub update
     */</span>
    public <a href="WriteResult.java.html#7959" title="com.mongodb.WriteResult">WriteResult</a> <a title="(q: com.mongodb.DBObject, o: com.mongodb.DBObject)com.mongodb.WriteResult" id="44336">update</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="51580">q</a> , <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="51581">o</a> <span class="delimiter">)</span> throws MongoException <span class="delimiter">{</span>
        <span class="keyword">return</span> update<span class="delimiter">(</span> q , o , <span class="keyword">false</span> , <span class="keyword">false</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * calls {@link DBCollection#update(com.mongodb.DBObject, com.mongodb.DBObject, boolean, boolean)} with upsert=false and multi=true
     * @param q search query for old object to update
     * @param o object with which to update &lt;tt&gt;q&lt;/tt&gt;
     * @return
     * @throws MongoException
     * @dochub update
     */</span>
    public <a href="WriteResult.java.html#7959" title="com.mongodb.WriteResult">WriteResult</a> <a title="(q: com.mongodb.DBObject, o: com.mongodb.DBObject)com.mongodb.WriteResult" id="44337">updateMulti</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="51704">q</a> , <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="51705">o</a> <span class="delimiter">)</span> throws MongoException <span class="delimiter">{</span>
        <span class="keyword">return</span> update<span class="delimiter">(</span> q , o , <span class="keyword">false</span> , <span class="keyword">true</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Adds any necessary fields to a given object before saving it to the collection.
     * @param o object to which to add the fields
     */</span>
    <span class="keyword">protected</span> <span class="keyword">abstract</span> void <a title="(o: com.mongodb.DBObject)Unit" id="44338">doapply</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="145208">o</a> <span class="delimiter">)</span>;

    <span class="comment">/**
     * Removes objects from the database collection.
     * @param o the object that documents to be removed must match
     * @param concern WriteConcern for this operation
     * @return 
     * @throws MongoException
     * @dochub remove
     */</span>
    public <span class="keyword">abstract</span> <a href="WriteResult.java.html#7959" title="com.mongodb.WriteResult">WriteResult</a> <a title="(o: com.mongodb.DBObject, concern: com.mongodb.WriteConcern)com.mongodb.WriteResult" id="44339">remove</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="51265">o</a> , <a href="WriteConcern.java.html#7896" title="com.mongodb.WriteConcern">WriteConcern</a> <a title="com.mongodb.WriteConcern" id="51266">concern</a> <span class="delimiter">)</span> throws MongoException ;

    <span class="comment">/**
     * calls {@link DBCollection#remove(com.mongodb.DBObject, com.mongodb.WriteConcern)} with the default WriteConcern
     * @param o the object that documents to be removed must match
     * @return
     * @throws MongoException
     * @dochub remove
     */</span>
    public <a href="WriteResult.java.html#7959" title="com.mongodb.WriteResult">WriteResult</a> <a title="(o: com.mongodb.DBObject)com.mongodb.WriteResult" id="44340">remove</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="51264">o</a> <span class="delimiter">)</span> 
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">return</span> remove<span class="delimiter">(</span> o , getWriteConcern<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>


    <span class="comment">/**
     * Finds objects
     */</span>
    <span class="keyword">abstract</span> Iterator&lt;<a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a>&gt; <a title="(ref: com.mongodb.DBObject, fields: com.mongodb.DBObject, numToSkip: Int, batchSize: Int, limit: Int, options: Int)java.util.Iterator[com.mongodb.DBObject]" id="44341">__find</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="145209">ref</a> , <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="145210">fields</a> , int <a title="Int" id="145211">numToSkip</a> , int <a title="Int" id="145212">batchSize</a> , int <a title="Int" id="145213">limit</a>, int <a title="Int" id="145214">options</a> <span class="delimiter">)</span> throws MongoException ;
    
    <span class="comment">/**
     * Calls {@link DBCollection#find(com.mongodb.DBObject, com.mongodb.DBObject, int, int)} and applies the query options
     * @param query query used to search
     * @param fields the fields of matching objects to return
     * @param numToSkip number of objects to skip
     * @param batchSize the batch size. This option has a complex behavior, see {@link DBCursor#batchSize(int) }
     * @param options - see Bytes QUERYOPTION_*
     * @return the cursor
     * @throws MongoException
     * @dochub find
     */</span>
    @Deprecated
    public <span class="keyword">final</span> <a href="DBCursor.java.html#7833" title="com.mongodb.DBCursor">DBCursor</a> <a title="(query: com.mongodb.DBObject, fields: com.mongodb.DBObject, numToSkip: Int, batchSize: Int, options: Int)com.mongodb.DBCursor" id="44342">find</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="45586">query</a> , <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="45587">fields</a> , int <a title="Int" id="45588">numToSkip</a> , int <a title="Int" id="45589">batchSize</a> , int <a title="Int" id="45590">options</a> <span class="delimiter">)</span> throws MongoException<span class="delimiter">{</span>
    	<span class="keyword">return</span> find<span class="delimiter">(</span>query, fields, numToSkip, batchSize<span class="delimiter">)</span>.addOption<span class="delimiter">(</span>options<span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    

    <span class="comment">/**
     * Finds objects from the database that match a query.
     * A DBCursor object is returned, that can be iterated to go through the results.
     *
     * @param query query used to search
     * @param fields the fields of matching objects to return
     * @param numToSkip number of objects to skip
     * @param batchSize the batch size. This option has a complex behavior, see {@link DBCursor#batchSize(int) }
     * @param options - see Bytes QUERYOPTION_*
     * @return the cursor
     * @throws MongoException
     * @dochub find
     */</span>
    @Deprecated
    public <span class="keyword">final</span> <a href="DBCursor.java.html#7833" title="com.mongodb.DBCursor">DBCursor</a> <a title="(query: com.mongodb.DBObject, fields: com.mongodb.DBObject, numToSkip: Int, batchSize: Int)com.mongodb.DBCursor" id="44343">find</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="45582">query</a> , <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="45583">fields</a> , int <a title="Int" id="45584">numToSkip</a> , int <a title="Int" id="45585">batchSize</a> <span class="delimiter">)</span> <span class="delimiter">{</span>
    	DBCursor cursor = find<span class="delimiter">(</span>query, fields<span class="delimiter">)</span>.skip<span class="delimiter">(</span>numToSkip<span class="delimiter">)</span>.batchSize<span class="delimiter">(</span>batchSize<span class="delimiter">)</span>;
    	<span class="keyword">return</span> cursor;
    <span class="delimiter">}</span>

    <span class="comment">// ------</span>

    <span class="comment">/**
     * Finds an object by its id.  
     * This compares the passed in value to the _id field of the document
     * 
     * @param obj any valid object
     * @return the object, if found, otherwise &lt;code&gt;null&lt;/code&gt;
     * @throws MongoException
     */</span>
    public <span class="keyword">final</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="(obj: Any)com.mongodb.DBObject" id="44344">findOne</a><span class="delimiter">(</span> Object <a title="Any" id="46253">obj</a> <span class="delimiter">)</span> 
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">return</span> findOne<span class="delimiter">(</span>obj, <span class="keyword">null</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Finds an object by its id.  
     * This compares the passed in value to the _id field of the document
     * 
     * @param obj any valid object
     * @param fields fields to return
     * @return the object, if found, otherwise &lt;code&gt;null&lt;/code&gt;
     * @dochub find
     */</span>
    public <span class="keyword">final</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="(obj: Any, fields: com.mongodb.DBObject)com.mongodb.DBObject" id="44345">findOne</a><span class="delimiter">(</span> Object <a title="Any" id="46251">obj</a>, <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="46252">fields</a> <span class="delimiter">)</span> <span class="delimiter">{</span>
        Iterator&lt;DBObject&gt; iterator = __find<span class="delimiter">(</span><span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span><span class="string">&quot;_id&quot;</span>, obj<span class="delimiter">)</span>, fields, <span class="int">0</span>, -<span class="int">1</span>, <span class="int">0</span>, getOptions<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>;
        <span class="keyword">return</span> <span class="delimiter">(</span>iterator != <span class="keyword">null</span> ? iterator.next<span class="delimiter">(</span><span class="delimiter">)</span> : <span class="keyword">null</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * Finds the first document in the query and updates it.
     * @param query query to match
     * @param fields fields to be returned
     * @param sort sort to apply before picking first document
     * @param remove if true, document found will be removed
     * @param update update to apply
     * @param returnNew if true, the updated document is returned, otherwise the old document is returned (or it would be lost forever)
     * @param upsert do upsert (insert if document not present)
     * @return the document
     */</span>
    public <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="(query: com.mongodb.DBObject, fields: com.mongodb.DBObject, sort: com.mongodb.DBObject, remove: Boolean, update: com.mongodb.DBObject, returnNew: Boolean, upsert: Boolean)com.mongodb.DBObject" id="44346">findAndModify</a><span class="delimiter">(</span><a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="46402">query</a>, <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="46403">fields</a>, <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="46404">sort</a>, boolean <a title="Boolean" id="46405">remove</a>, <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="46406">update</a>, boolean <a title="Boolean" id="46407">returnNew</a>, boolean <a title="Boolean" id="46408">upsert</a><span class="delimiter">)</span> <span class="delimiter">{</span>

        BasicDBObject cmd = <span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span> <span class="string">&quot;findandmodify&quot;</span>, _name<span class="delimiter">)</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span>query != <span class="keyword">null</span> &amp;&amp; !query.keySet<span class="delimiter">(</span><span class="delimiter">)</span>.isEmpty<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
            cmd.append<span class="delimiter">(</span> <span class="string">&quot;query&quot;</span>, query <span class="delimiter">)</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span>fields != <span class="keyword">null</span> &amp;&amp; !fields.keySet<span class="delimiter">(</span><span class="delimiter">)</span>.isEmpty<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
            cmd.append<span class="delimiter">(</span> <span class="string">&quot;fields&quot;</span>, fields <span class="delimiter">)</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span>sort != <span class="keyword">null</span> &amp;&amp; !sort.keySet<span class="delimiter">(</span><span class="delimiter">)</span>.isEmpty<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
            cmd.append<span class="delimiter">(</span> <span class="string">&quot;sort&quot;</span>, sort <span class="delimiter">)</span>;
    
        <span class="keyword">if</span> <span class="delimiter">(</span>remove<span class="delimiter">)</span>
            cmd.append<span class="delimiter">(</span> <span class="string">&quot;remove&quot;</span>, remove <span class="delimiter">)</span>;
        <span class="keyword">else</span> <span class="delimiter">{</span>
            <span class="keyword">if</span> <span class="delimiter">(</span>update != <span class="keyword">null</span> &amp;&amp; !update.keySet<span class="delimiter">(</span><span class="delimiter">)</span>.isEmpty<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="comment">// if 1st key doesnt start with $, then object will be inserted as is, need to check it</span>
                String key = update.keySet<span class="delimiter">(</span><span class="delimiter">)</span>.iterator<span class="delimiter">(</span><span class="delimiter">)</span>.next<span class="delimiter">(</span><span class="delimiter">)</span>;
                <span class="keyword">if</span> <span class="delimiter">(</span>key.charAt<span class="delimiter">(</span><span class="int">0</span><span class="delimiter">)</span> != <span class="char">'$'</span><span class="delimiter">)</span>
                    _checkObject<span class="delimiter">(</span>update, <span class="keyword">false</span>, <span class="keyword">false</span><span class="delimiter">)</span>;
                cmd.append<span class="delimiter">(</span> <span class="string">&quot;update&quot;</span>, update <span class="delimiter">)</span>;
            <span class="delimiter">}</span>
            <span class="keyword">if</span> <span class="delimiter">(</span>returnNew<span class="delimiter">)</span>
                cmd.append<span class="delimiter">(</span> <span class="string">&quot;new&quot;</span>, returnNew <span class="delimiter">)</span>;
            <span class="keyword">if</span> <span class="delimiter">(</span>upsert<span class="delimiter">)</span>
                cmd.append<span class="delimiter">(</span> <span class="string">&quot;upsert&quot;</span>, upsert <span class="delimiter">)</span>;
        <span class="delimiter">}</span>
        
        <span class="keyword">if</span> <span class="delimiter">(</span>remove &amp;&amp; !<span class="delimiter">(</span>update == <span class="keyword">null</span> || update.keySet<span class="delimiter">(</span><span class="delimiter">)</span>.isEmpty<span class="delimiter">(</span><span class="delimiter">)</span> || returnNew<span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="keyword">throw</span> <span class="keyword">new</span> MongoException<span class="delimiter">(</span><span class="string">&quot;FindAndModify: Remove cannot be mixed with the Update, or returnNew params!&quot;</span><span class="delimiter">)</span>;

        CommandResult res = <span class="keyword">this</span>._db.command<span class="delimiter">(</span> cmd <span class="delimiter">)</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span>res.ok<span class="delimiter">(</span><span class="delimiter">)</span> || res.getErrorMessage<span class="delimiter">(</span><span class="delimiter">)</span>.equals<span class="delimiter">(</span> <span class="string">&quot;No matching object found&quot;</span> <span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="keyword">return</span> <span class="delimiter">(</span>DBObject<span class="delimiter">)</span> res.get<span class="delimiter">(</span> <span class="string">&quot;value&quot;</span> <span class="delimiter">)</span>;
        res.throwOnError<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="keyword">return</span> <span class="keyword">null</span>;
    <span class="delimiter">}</span>

    
    <span class="comment">/**
     * calls {@link DBCollection#findAndModify(com.mongodb.DBObject, com.mongodb.DBObject, com.mongodb.DBObject, boolean, com.mongodb.DBObject, boolean, boolean)}
     * with fields=null, remove=false, returnNew=false, upsert=false
     * @param query 
     * @param sort
     * @param update
     * @return the old document
     */</span>
    public <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="(query: com.mongodb.DBObject, sort: com.mongodb.DBObject, update: com.mongodb.DBObject)com.mongodb.DBObject" id="44347">findAndModify</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="46399">query</a> , <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="46400">sort</a> , <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="46401">update</a><span class="delimiter">)</span><span class="delimiter">{</span> 
    	<span class="keyword">return</span> findAndModify<span class="delimiter">(</span> query, <span class="keyword">null</span>, sort, <span class="keyword">false</span>, update, <span class="keyword">false</span>, <span class="keyword">false</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * calls {@link DBCollection#findAndModify(com.mongodb.DBObject, com.mongodb.DBObject, com.mongodb.DBObject, boolean, com.mongodb.DBObject, boolean, boolean)}
     * with fields=null, sort=null, remove=false, returnNew=false, upsert=false
     * @param query
     * @param update
     * @return the old document
     */</span>
    public <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="(query: com.mongodb.DBObject, update: com.mongodb.DBObject)com.mongodb.DBObject" id="44348">findAndModify</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="46397">query</a> , <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="46398">update</a> <span class="delimiter">)</span> <span class="delimiter">{</span> 
    	<span class="keyword">return</span> findAndModify<span class="delimiter">(</span> query, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">false</span>, update, <span class="keyword">false</span>, <span class="keyword">false</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * calls {@link DBCollection#findAndModify(com.mongodb.DBObject, com.mongodb.DBObject, com.mongodb.DBObject, boolean, com.mongodb.DBObject, boolean, boolean)}
     * with fields=null, sort=null, remove=true, returnNew=false, upsert=false
     * @param query
     * @return the removed document
     */</span>
    public <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="(query: com.mongodb.DBObject)com.mongodb.DBObject" id="44349">findAndRemove</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="46564">query</a> <span class="delimiter">)</span> <span class="delimiter">{</span> 
    	<span class="keyword">return</span> findAndModify<span class="delimiter">(</span> query, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">true</span>, <span class="keyword">null</span>, <span class="keyword">false</span>, <span class="keyword">false</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">// --- START INDEX CODE ---</span>

    <span class="comment">/**
     * calls {@link DBCollection#createIndex(com.mongodb.DBObject, com.mongodb.DBObject)} with default index options
     * @param keys an object with a key set of the fields desired for the index
     * @throws MongoException
     */</span>
    public <span class="keyword">final</span> void <a title="(keys: com.mongodb.DBObject)Unit" id="44350">createIndex</a><span class="delimiter">(</span> <span class="keyword">final</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="45810">keys</a> <span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        createIndex<span class="delimiter">(</span> keys , defaultOptions<span class="delimiter">(</span> keys <span class="delimiter">)</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Forces creation of an index on a set of fields, if one does not already exist.
     * @param keys
     * @param options
     * @throws MongoException
     */</span>
    public <span class="keyword">abstract</span> void <a title="(keys: com.mongodb.DBObject, options: com.mongodb.DBObject)Unit" id="44351">createIndex</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="45811">keys</a> , <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="45812">options</a> <span class="delimiter">)</span> throws MongoException;

    <span class="comment">/**
     * Creates an ascending index on a field with default options, if one does not already exist.
     * @param name name of field to index on
     */</span>
    public <span class="keyword">final</span> void <a title="(name: java.lang.String)Unit" id="44352">ensureIndex</a><span class="delimiter">(</span> <span class="keyword">final</span> String <a title="java.lang.String" id="46124">name</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        ensureIndex<span class="delimiter">(</span> <span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span> name , <span class="int">1</span> <span class="delimiter">)</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * calls {@link DBCollection#ensureIndex(com.mongodb.DBObject, com.mongodb.DBObject)} with default options
     * @param keys an object with a key set of the fields desired for the index
     * @throws MongoException
     */</span>
    public <span class="keyword">final</span> void <a title="(keys: com.mongodb.DBObject)Unit" id="44353">ensureIndex</a><span class="delimiter">(</span> <span class="keyword">final</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="46123">keys</a> <span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        ensureIndex<span class="delimiter">(</span> keys , defaultOptions<span class="delimiter">(</span> keys <span class="delimiter">)</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * calls {@link DBCollection#ensureIndex(com.mongodb.DBObject, java.lang.String, boolean)} with unique=false
     * @param keys fields to use for index
     * @param name an identifier for the index
     * @throws MongoException
     * @dochub indexes
     */</span>
    public void <a title="(keys: com.mongodb.DBObject, name: java.lang.String)Unit" id="44354">ensureIndex</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="46121">keys</a> , String <a title="java.lang.String" id="46122">name</a> <span class="delimiter">)</span> 
        throws MongoException <span class="delimiter">{</span>
        ensureIndex<span class="delimiter">(</span> keys , name , <span class="keyword">false</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Ensures an index on this collection (that is, the index will be created if it does not exist).
     * @param keys fields to use for index
     * @param name an identifier for the index. If null or empty, the default name will be used.
     * @param unique if the index should be unique
     * @throws MongoException
     */</span>
    public void <a title="(keys: com.mongodb.DBObject, name: java.lang.String, unique: Boolean)Unit" id="44355">ensureIndex</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="46118">keys</a> , String <a title="java.lang.String" id="46119">name</a> , boolean <a title="Boolean" id="46120">unique</a> <span class="delimiter">)</span> 
        throws MongoException <span class="delimiter">{</span>
        DBObject options = defaultOptions<span class="delimiter">(</span> keys <span class="delimiter">)</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span>name != <span class="keyword">null</span> &amp;&amp; !name.isEmpty<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
            options.put<span class="delimiter">(</span> <span class="string">&quot;name&quot;</span> , name <span class="delimiter">)</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span> unique <span class="delimiter">)</span>
            options.put<span class="delimiter">(</span> <span class="string">&quot;unique&quot;</span> , Boolean.TRUE <span class="delimiter">)</span>;
        ensureIndex<span class="delimiter">(</span> keys , options <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Creates an index on a set of fields, if one does not already exist.
     * @param keys an object with a key set of the fields desired for the index
     * @param optionsIN options for the index (name, unique, etc)
     * @throws MongoException
     */</span>
    public <span class="keyword">final</span> void <a title="(keys: com.mongodb.DBObject, optionsIN: com.mongodb.DBObject)Unit" id="44356">ensureIndex</a><span class="delimiter">(</span> <span class="keyword">final</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="46116">keys</a> , <span class="keyword">final</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="46117">optionsIN</a> <span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>

        <span class="keyword">if</span> <span class="delimiter">(</span> checkReadOnly<span class="delimiter">(</span> <span class="keyword">false</span> <span class="delimiter">)</span> <span class="delimiter">)</span> <span class="keyword">return</span>;

        <span class="keyword">final</span> DBObject options = defaultOptions<span class="delimiter">(</span> keys <span class="delimiter">)</span>;
        <span class="keyword">for</span> <span class="delimiter">(</span> String k : optionsIN.keySet<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>
            options.put<span class="delimiter">(</span> k , optionsIN.get<span class="delimiter">(</span> k <span class="delimiter">)</span> <span class="delimiter">)</span>;

        <span class="keyword">final</span> String name = options.get<span class="delimiter">(</span> <span class="string">&quot;name&quot;</span> <span class="delimiter">)</span>.toString<span class="delimiter">(</span><span class="delimiter">)</span>;

        <span class="keyword">if</span> <span class="delimiter">(</span> _createdIndexes.contains<span class="delimiter">(</span> name <span class="delimiter">)</span> <span class="delimiter">)</span>
            <span class="keyword">return</span>;

        createIndex<span class="delimiter">(</span> keys , options <span class="delimiter">)</span>;
        _createdIndexes.add<span class="delimiter">(</span> name <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Clears all indices that have not yet been applied to this collection.
     */</span>
    public void <a title="()Unit" id="44357">resetIndexCache</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        _createdIndexes.clear<span class="delimiter">(</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="(keys: com.mongodb.DBObject)com.mongodb.DBObject" id="44358">defaultOptions</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="145215">keys</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        DBObject o = <span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span><span class="delimiter">)</span>;
        o.put<span class="delimiter">(</span> <span class="string">&quot;name&quot;</span> , genIndexName<span class="delimiter">(</span> keys <span class="delimiter">)</span> <span class="delimiter">)</span>;
        o.put<span class="delimiter">(</span> <span class="string">&quot;ns&quot;</span> , _fullName <span class="delimiter">)</span>;
        <span class="keyword">return</span> o;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Convenience method to generate an index name from the set of fields it is over.
     * @param keys the names of the fields used in this index
     * @return a string representation of this index's fields
     */</span>
    public static String <a title="(keys: com.mongodb.DBObject)java.lang.String" id="44896">genIndexName</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="52324">keys</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        String name = <span class="string">&quot;&quot;</span>;
        <span class="keyword">for</span> <span class="delimiter">(</span> String s : keys.keySet<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span><span class="delimiter">{</span>
            <span class="keyword">if</span> <span class="delimiter">(</span> name.length<span class="delimiter">(</span><span class="delimiter">)</span> &gt; <span class="int">0</span> <span class="delimiter">)</span>
                name += <span class="string">&quot;_&quot;</span>;
            name += s + <span class="string">&quot;_&quot;</span>;
            Object <span class="keyword">val</span> = keys.get<span class="delimiter">(</span> s <span class="delimiter">)</span>;
            <span class="keyword">if</span> <span class="delimiter">(</span> <span class="keyword">val</span> instanceof Number || <span class="keyword">val</span> instanceof String <span class="delimiter">)</span>
                name += <span class="keyword">val</span>.toString<span class="delimiter">(</span><span class="delimiter">)</span>.replace<span class="delimiter">(</span> <span class="char">' '</span> , <span class="char">'_'</span> <span class="delimiter">)</span>;
        <span class="delimiter">}</span>
        <span class="keyword">return</span> name;
    <span class="delimiter">}</span>

    <span class="comment">// --- END INDEX CODE ---</span>

    <span class="comment">/**
     * Set hint fields for this collection (to optimize queries).
     * @param lst a list of &lt;code&gt;DBObject&lt;/code&gt;s to be used as hints
     */</span>
    public void <a title="(lst: java.util.List[com.mongodb.DBObject])Unit" id="44359">setHintFields</a><span class="delimiter">(</span> List&lt;<a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a>&gt; <a title="java.util.List[com.mongodb.DBObject]" id="51407">lst</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        _hintFields = lst;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Queries for an object in this collection.
     * @param ref object for which to search
     * @return an iterator over the results
     * @dochub find
     */</span>
    public <span class="keyword">final</span> <a href="DBCursor.java.html#7833" title="com.mongodb.DBCursor">DBCursor</a> <a title="(ref: com.mongodb.DBObject)com.mongodb.DBCursor" id="44360">find</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="45581">ref</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">return</span> <span class="keyword">new</span> DBCursor<span class="delimiter">(</span> <span class="keyword">this</span>, ref, <span class="keyword">null</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Queries for an object in this collection.
     *
     * &lt;p&gt;
     * An empty DBObject will match every document in the collection.
     * Regardless of fields specified, the _id fields are always returned.
     * &lt;/p&gt;
     * &lt;p&gt;
     * An example that returns the &quot;x&quot; and &quot;_id&quot; fields for every document 
     * in the collection that has an &quot;x&quot; field:
     * &lt;/p&gt;
     * &lt;blockquote&gt;&lt;pre&gt;
     * BasicDBObject keys = new BasicDBObject();
     * keys.put(&quot;x&quot;, 1);
     *
     * DBCursor cursor = collection.find(new BasicDBObject(), keys); 
     * &lt;/pre&gt;&lt;/blockquote&gt;
     *
     * @param ref object for which to search
     * @param keys fields to return
     * @return a cursor to iterate over results
     * @dochub find
     */</span>
    public <span class="keyword">final</span> <a href="DBCursor.java.html#7833" title="com.mongodb.DBCursor">DBCursor</a> <a title="(ref: com.mongodb.DBObject, keys: com.mongodb.DBObject)com.mongodb.DBCursor" id="44361">find</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="45579">ref</a> , <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="45580">keys</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">return</span> <span class="keyword">new</span> DBCursor<span class="delimiter">(</span> <span class="keyword">this</span>, ref, keys <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Queries for all objects in this collection.
     * @return a cursor which will iterate over every object
     * @dochub find
     */</span>
    public <span class="keyword">final</span> <a href="DBCursor.java.html#7833" title="com.mongodb.DBCursor">DBCursor</a> <a title="()com.mongodb.DBCursor" id="44362">find</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">return</span> <span class="keyword">new</span> DBCursor<span class="delimiter">(</span> <span class="keyword">this</span>, <span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span><span class="delimiter">)</span>, <span class="keyword">null</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/** 
     * Returns a single object from this collection.
     * @return the object found, or &lt;code&gt;null&lt;/code&gt; if the collection is empty
     * @throws MongoException
     */</span>
    public <span class="keyword">final</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="()com.mongodb.DBObject" id="44363">findOne</a><span class="delimiter">(</span><span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">return</span> findOne<span class="delimiter">(</span> <span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/** 
     * Returns a single object from this collection matching the query.
     * @param o the query object
     * @return the object found, or &lt;code&gt;null&lt;/code&gt; if no such object exists
     * @throws MongoException
     */</span>
    public <span class="keyword">final</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="(o: com.mongodb.DBObject)com.mongodb.DBObject" id="44364">findOne</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="46250">o</a> <span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">return</span> findOne<span class="delimiter">(</span>o, <span class="keyword">null</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/** 
     * Returns a single object from this collection matching the query.
     * @param o the query object
     * @param fields fields to return
     * @return the object found, or &lt;code&gt;null&lt;/code&gt; if no such object exists
     * @dochub find
     */</span>
    public <span class="keyword">final</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="(o: com.mongodb.DBObject, fields: com.mongodb.DBObject)com.mongodb.DBObject" id="44365">findOne</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="46248">o</a>, <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="46249">fields</a> <span class="delimiter">)</span> <span class="delimiter">{</span>
        Iterator&lt;DBObject&gt; i = __find<span class="delimiter">(</span> o , fields , <span class="int">0</span> , -<span class="int">1</span> , <span class="int">0</span>, getOptions<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>;
        <span class="keyword">return</span> i == <span class="keyword">null</span> ? <span class="keyword">null</span> : i.next<span class="delimiter">(</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * calls {@link DBCollection#apply(com.mongodb.DBObject, boolean)} with ensureID=true
     * @param o &lt;code&gt;DBObject&lt;/code&gt; to which to add fields
     * @return the modified parameter object
     */</span>
    public <span class="keyword">final</span> Object <a title="(o: com.mongodb.DBObject)java.lang.Object" id="44366">apply</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="45762">o</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">return</span> apply<span class="delimiter">(</span> o , <span class="keyword">true</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * calls {@link DBCollection#doapply(com.mongodb.DBObject)}, optionally adding an automatic _id field
     * @param jo object to add fields to
     * @param ensureID whether to add an &lt;code&gt;_id&lt;/code&gt; field
     * @return the modified object &lt;code&gt;o&lt;/code&gt;
     */</span>
    public <span class="keyword">final</span> Object <a title="(jo: com.mongodb.DBObject, ensureID: Boolean)java.lang.Object" id="44367">apply</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="45760">jo</a> , boolean <a title="Boolean" id="45761">ensureID</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        
        Object id = jo.get<span class="delimiter">(</span> <span class="string">&quot;_id&quot;</span> <span class="delimiter">)</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span> ensureID &amp;&amp; id == <span class="keyword">null</span> <span class="delimiter">)</span><span class="delimiter">{</span>
            id = ObjectId.get<span class="delimiter">(</span><span class="delimiter">)</span>;
            jo.put<span class="delimiter">(</span> <span class="string">&quot;_id&quot;</span> , id <span class="delimiter">)</span>;
        <span class="delimiter">}</span>

        doapply<span class="delimiter">(</span> jo <span class="delimiter">)</span>;

        <span class="keyword">return</span> id;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * calls {@link DBCollection#save(com.mongodb.DBObject, com.mongodb.WriteConcern)} with default WriteConcern
     * @param jo the &lt;code&gt;DBObject&lt;/code&gt; to save
     *        will add &lt;code&gt;_id&lt;/code&gt; field to jo if needed
     * @return
     */</span>
    public <span class="keyword">final</span> <a href="WriteResult.java.html#7959" title="com.mongodb.WriteResult">WriteResult</a> <a title="(jo: com.mongodb.DBObject)com.mongodb.WriteResult" id="44368">save</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="51319">jo</a> <span class="delimiter">)</span> <span class="delimiter">{</span>
    	<span class="keyword">return</span> save<span class="delimiter">(</span>jo, getWriteConcern<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * Saves an object to this collection (does insert or update based on the object _id).
     * @param jo the &lt;code&gt;DBObject&lt;/code&gt; to save
     * @param concern the write concern
     * @return
     * @throws MongoException
     */</span>
    public <span class="keyword">final</span> <a href="WriteResult.java.html#7959" title="com.mongodb.WriteResult">WriteResult</a> <a title="(jo: com.mongodb.DBObject, concern: com.mongodb.WriteConcern)com.mongodb.WriteResult" id="44369">save</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="51317">jo</a>, <a href="WriteConcern.java.html#7896" title="com.mongodb.WriteConcern">WriteConcern</a> <a title="com.mongodb.WriteConcern" id="51318">concern</a> <span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span> checkReadOnly<span class="delimiter">(</span> <span class="keyword">true</span> <span class="delimiter">)</span> <span class="delimiter">)</span>
            <span class="keyword">return</span> <span class="keyword">null</span>;

        _checkObject<span class="delimiter">(</span> jo , <span class="keyword">false</span> , <span class="keyword">false</span> <span class="delimiter">)</span>;
        
        Object id = jo.get<span class="delimiter">(</span> <span class="string">&quot;_id&quot;</span> <span class="delimiter">)</span>;

        <span class="keyword">if</span> <span class="delimiter">(</span> id == <span class="keyword">null</span> || <span class="delimiter">(</span> id instanceof ObjectId &amp;&amp; <span class="delimiter">(</span><span class="delimiter">(</span>ObjectId<span class="delimiter">)</span>id<span class="delimiter">)</span>.isNew<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span> <span class="delimiter">)</span><span class="delimiter">{</span>
            <span class="keyword">if</span> <span class="delimiter">(</span> id != <span class="keyword">null</span> &amp;&amp; id instanceof ObjectId <span class="delimiter">)</span>
                <span class="delimiter">(</span><span class="delimiter">(</span>ObjectId<span class="delimiter">)</span>id<span class="delimiter">)</span>.notNew<span class="delimiter">(</span><span class="delimiter">)</span>;
            <span class="keyword">if</span> <span class="delimiter">(</span> concern == <span class="keyword">null</span> <span class="delimiter">)</span>
            	<span class="keyword">return</span> insert<span class="delimiter">(</span> jo <span class="delimiter">)</span>;
            <span class="keyword">else</span>
            	<span class="keyword">return</span> insert<span class="delimiter">(</span> jo, concern <span class="delimiter">)</span>;
        <span class="delimiter">}</span>

        DBObject q = <span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span><span class="delimiter">)</span>;
        q.put<span class="delimiter">(</span> <span class="string">&quot;_id&quot;</span> , id <span class="delimiter">)</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span> concern == <span class="keyword">null</span> <span class="delimiter">)</span>
        	<span class="keyword">return</span> update<span class="delimiter">(</span> q , jo , <span class="keyword">true</span> , <span class="keyword">false</span> <span class="delimiter">)</span>;
        <span class="keyword">else</span>
        	<span class="keyword">return</span> update<span class="delimiter">(</span> q , jo , <span class="keyword">true</span> , <span class="keyword">false</span> , concern <span class="delimiter">)</span>;
        	
    <span class="delimiter">}</span>
    
    <span class="comment">// ---- DB COMMANDS ----</span>
    <span class="comment">/**
     * Drops all indices from this collection
     * @throws MongoException
     */</span>
    public void <a title="()Unit" id="44370">dropIndexes</a><span class="delimiter">(</span><span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        dropIndexes<span class="delimiter">(</span> <span class="string">&quot;*&quot;</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>
        

    <span class="comment">/**
     * Drops an index from this collection
     * @param name the index name
     * @throws MongoException
     */</span>
    public void <a title="(name: java.lang.String)Unit" id="44371">dropIndexes</a><span class="delimiter">(</span> String <a title="java.lang.String" id="46102">name</a> <span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        DBObject cmd = BasicDBObjectBuilder.start<span class="delimiter">(</span><span class="delimiter">)</span>
            .add<span class="delimiter">(</span> <span class="string">&quot;deleteIndexes&quot;</span> , getName<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>
            .add<span class="delimiter">(</span> <span class="string">&quot;index&quot;</span> , name <span class="delimiter">)</span>
            .get<span class="delimiter">(</span><span class="delimiter">)</span>;
        
        resetIndexCache<span class="delimiter">(</span><span class="delimiter">)</span>;
        CommandResult res = _db.command<span class="delimiter">(</span> cmd <span class="delimiter">)</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span>res.ok<span class="delimiter">(</span><span class="delimiter">)</span> || res.getErrorMessage<span class="delimiter">(</span><span class="delimiter">)</span>.equals<span class="delimiter">(</span> <span class="string">&quot;ns not found&quot;</span> <span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="keyword">return</span>;
        res.throwOnError<span class="delimiter">(</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * Drops (deletes) this collection. Use with care.
     * @throws MongoException
     */</span>
    public void <a title="()Unit" id="44372">drop</a><span class="delimiter">(</span><span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        resetIndexCache<span class="delimiter">(</span><span class="delimiter">)</span>;
        CommandResult res =_db.command<span class="delimiter">(</span> BasicDBObjectBuilder.start<span class="delimiter">(</span><span class="delimiter">)</span>.add<span class="delimiter">(</span> <span class="string">&quot;drop&quot;</span> , getName<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>.get<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span>res.ok<span class="delimiter">(</span><span class="delimiter">)</span> || res.getErrorMessage<span class="delimiter">(</span><span class="delimiter">)</span>.equals<span class="delimiter">(</span> <span class="string">&quot;ns not found&quot;</span> <span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="keyword">return</span>;
        res.throwOnError<span class="delimiter">(</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * returns the number of documents in this collection.
     * @return
     * @throws MongoException
     */</span>
    public long <a title="()Long" id="44373">count</a><span class="delimiter">(</span><span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">return</span> getCount<span class="delimiter">(</span><span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span><span class="delimiter">)</span>, <span class="keyword">null</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * returns the number of documents that match a query.
     * @param query query to match
     * @return
     * @throws MongoException
     */</span>
    public long <a title="(query: com.mongodb.DBObject)Long" id="44374">count</a><span class="delimiter">(</span><a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="145216">query</a><span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">return</span> getCount<span class="delimiter">(</span>query, <span class="keyword">null</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>


    <span class="comment">/**
     *  calls {@link DBCollection#getCount(com.mongodb.DBObject, com.mongodb.DBObject)} with an empty query and null fields.
     *  @return number of documents that match query
     * @throws MongoException
     */</span>
    public long <a title="()Long" id="44375">getCount</a><span class="delimiter">(</span><span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">return</span> getCount<span class="delimiter">(</span><span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span><span class="delimiter">)</span>, <span class="keyword">null</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     *  calls {@link DBCollection#getCount(com.mongodb.DBObject, com.mongodb.DBObject)} with null fields.
     *  @param query query to match
     *  @return
     * @throws MongoException
     */</span>
    public long <a title="(query: com.mongodb.DBObject)Long" id="44376">getCount</a><span class="delimiter">(</span><a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="46736">query</a><span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">return</span> getCount<span class="delimiter">(</span>query, <span class="keyword">null</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     *  calls {@link DBCollection#getCount(com.mongodb.DBObject, com.mongodb.DBObject, long, long)} with limit=0 and skip=0
     *  @param query query to match
     *  @param fields fields to return
     *  @return
     * @throws MongoException
     */</span>
    public long <a title="(query: com.mongodb.DBObject, fields: com.mongodb.DBObject)Long" id="44377">getCount</a><span class="delimiter">(</span><a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="46734">query</a>, <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="46735">fields</a><span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">return</span> getCount<span class="delimiter">(</span> query , fields , <span class="int">0</span> , <span class="int">0</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     *  Returns the number of documents in the collection
     *  that match the specified query
     *
     *  @param query query to select documents to count
     *  @param fields fields to return
     *  @param limit limit the count to this value
     * @param skip number of entries to skip
     * @return number of documents that match query and fields
     * @throws MongoException
     */</span>
    public long <a title="(query: com.mongodb.DBObject, fields: com.mongodb.DBObject, limit: Long, skip: Long)Long" id="44378">getCount</a><span class="delimiter">(</span><a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="46730">query</a>, <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="46731">fields</a>, long <a title="Long" id="46732">limit</a>, long <a title="Long" id="46733">skip</a> <span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>

        BasicDBObject cmd = <span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span><span class="delimiter">)</span>;
        cmd.put<span class="delimiter">(</span><span class="string">&quot;count&quot;</span>, getName<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
        cmd.put<span class="delimiter">(</span><span class="string">&quot;query&quot;</span>, query<span class="delimiter">)</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span>fields != <span class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            cmd.put<span class="delimiter">(</span><span class="string">&quot;fields&quot;</span>, fields<span class="delimiter">)</span>;
        <span class="delimiter">}</span>
        
        <span class="keyword">if</span> <span class="delimiter">(</span> limit &gt; <span class="int">0</span> <span class="delimiter">)</span>
            cmd.put<span class="delimiter">(</span> <span class="string">&quot;limit&quot;</span> , limit <span class="delimiter">)</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span> skip &gt; <span class="int">0</span> <span class="delimiter">)</span>
            cmd.put<span class="delimiter">(</span> <span class="string">&quot;skip&quot;</span> , skip <span class="delimiter">)</span>;

        CommandResult res = _db.command<span class="delimiter">(</span>cmd,getOptions<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;

        <span class="keyword">if</span> <span class="delimiter">(</span> ! res.ok<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span><span class="delimiter">{</span>
            String errmsg = res.getErrorMessage<span class="delimiter">(</span><span class="delimiter">)</span>;
            
            <span class="keyword">if</span> <span class="delimiter">(</span> errmsg.equals<span class="delimiter">(</span><span class="string">&quot;ns does not exist&quot;</span><span class="delimiter">)</span> || 
                 errmsg.equals<span class="delimiter">(</span><span class="string">&quot;ns missing&quot;</span> <span class="delimiter">)</span> <span class="delimiter">)</span><span class="delimiter">{</span>
                <span class="comment">// for now, return 0 - lets pretend it does exist</span>
                <span class="keyword">return</span> <span class="int">0</span>;
            <span class="delimiter">}</span>

            res.throwOnError<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="delimiter">}</span>

        <span class="keyword">return</span> res.getLong<span class="delimiter">(</span><span class="string">&quot;n&quot;</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Calls {@link DBCollection#rename(java.lang.String, boolean) with dropTarget=false
     * @param newName new collection name (not a full namespace)
     * @return the new collection
     * @throws MongoException
     */</span>
    public <a href="#7830" title="com.mongodb.DBCollection">DBCollection</a> <a title="(newName: java.lang.String)com.mongodb.DBCollection" id="44379">rename</a><span class="delimiter">(</span> String <a title="java.lang.String" id="52087">newName</a> <span class="delimiter">)</span> 
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">return</span> rename<span class="delimiter">(</span>newName, <span class="keyword">false</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * renames of this collection to newName
     * @param newName new collection name (not a full namespace)
     * @param dropTarget if a collection with the new name exists, whether or not to drop it
     * @return the new collection
     * @throws MongoException
     */</span>
    public <a href="#7830" title="com.mongodb.DBCollection">DBCollection</a> <a title="(newName: java.lang.String, dropTarget: Boolean)com.mongodb.DBCollection" id="44380">rename</a><span class="delimiter">(</span> String <a title="java.lang.String" id="52085">newName</a>, boolean <a title="Boolean" id="52086">dropTarget</a> <span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        CommandResult ret = 
            _db.getSisterDB<span class="delimiter">(</span> <span class="string">&quot;admin&quot;</span> <span class="delimiter">)</span>
            .command<span class="delimiter">(</span> BasicDBObjectBuilder.start<span class="delimiter">(</span><span class="delimiter">)</span>
                      .add<span class="delimiter">(</span> <span class="string">&quot;renameCollection&quot;</span> , _fullName <span class="delimiter">)</span>
                      .add<span class="delimiter">(</span> <span class="string">&quot;to&quot;</span> , _db._name + <span class="string">&quot;.&quot;</span> + newName <span class="delimiter">)</span>
                      .add<span class="delimiter">(</span> <span class="string">&quot;dropTarget&quot;</span> , dropTarget <span class="delimiter">)</span>
                      .get<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>;
        ret.throwOnError<span class="delimiter">(</span><span class="delimiter">)</span>;
        resetIndexCache<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="keyword">return</span> _db.getCollection<span class="delimiter">(</span> newName <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * calls {@link DBCollection#group(com.mongodb.DBObject, com.mongodb.DBObject, com.mongodb.DBObject, java.lang.String, java.lang.String)} with finalize=null
     * @param key - { a : true }
     * @param cond - optional condition on query 
     * @param reduce javascript reduce function 
     * @param initial initial value for first match on a key
     * @return
     * @throws MongoException
     * @see &lt;a href=&quot;http://www.mongodb.org/display/DOCS/Aggregation&quot;&gt;http://www.mongodb.org/display/DOCS/Aggregation&lt;/a&gt;
     */</span>
    public <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="(key: com.mongodb.DBObject, cond: com.mongodb.DBObject, initial: com.mongodb.DBObject, reduce: java.lang.String)com.mongodb.DBObject" id="44381">group</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="47029">key</a> , <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="47030">cond</a> , <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="47031">initial</a> , String <a title="java.lang.String" id="47032">reduce</a> <span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        <span class="keyword">return</span> group<span class="delimiter">(</span> key , cond , initial , reduce , <span class="keyword">null</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>
        
    <span class="comment">/**
     * Applies a group operation
     * @param key - { a : true }
     * @param cond - optional condition on query 
     * @param reduce javascript reduce function 
     * @param initial initial value for first match on a key
     * @param finalize An optional function that can operate on the result(s) of the reduce function.
     * @return 
     * @throws MongoException
     * @see &lt;a href=&quot;http://www.mongodb.org/display/DOCS/Aggregation&quot;&gt;http://www.mongodb.org/display/DOCS/Aggregation&lt;/a&gt;
     */</span>
    public <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="(key: com.mongodb.DBObject, cond: com.mongodb.DBObject, initial: com.mongodb.DBObject, reduce: java.lang.String, finalize: java.lang.String)com.mongodb.DBObject" id="44382">group</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="47024">key</a> , <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="47025">cond</a> , <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="47026">initial</a> , String <a title="java.lang.String" id="47027">reduce</a> , String <a title="java.lang.String" id="47028">finalize</a> <span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        GroupCommand cmd = <span class="keyword">new</span> GroupCommand<span class="delimiter">(</span><span class="keyword">this</span>, key, cond, initial, reduce, finalize<span class="delimiter">)</span>;        
        <span class="keyword">return</span> group<span class="delimiter">(</span> cmd <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Applies a group operation
     * @param cmd the group command
     * @return
     * @throws MongoException
     * @see &lt;a href=&quot;http://www.mongodb.org/display/DOCS/Aggregation&quot;&gt;http://www.mongodb.org/display/DOCS/Aggregation&lt;/a&gt;
     */</span>
    public <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="(cmd: com.mongodb.GroupCommand)com.mongodb.DBObject" id="44383">group</a><span class="delimiter">(</span> <a href="GroupCommand.java.html#7899" title="com.mongodb.GroupCommand">GroupCommand</a> <a title="com.mongodb.GroupCommand" id="47023">cmd</a> <span class="delimiter">)</span> <span class="delimiter">{</span>
        CommandResult res =  _db.command<span class="delimiter">(</span> cmd.toDBObject<span class="delimiter">(</span><span class="delimiter">)</span>, getOptions<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>;
        res.throwOnError<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="keyword">return</span> <span class="delimiter">(</span>DBObject<span class="delimiter">)</span>res.get<span class="delimiter">(</span> <span class="string">&quot;retval&quot;</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>


    <span class="comment">/**
     * @deprecated prefer the {@link DBCollection#group(com.mongodb.GroupCommand)} which is more standard
     * Applies a group operation
     * @param args object representing the arguments to the group function
     * @return
     * @throws MongoException
     * @see &lt;a href=&quot;http://www.mongodb.org/display/DOCS/Aggregation&quot;&gt;http://www.mongodb.org/display/DOCS/Aggregation&lt;/a&gt;
     */</span>
    @Deprecated
    public <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="(args: com.mongodb.DBObject)com.mongodb.DBObject" id="44384">group</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="47022">args</a> <span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        args.put<span class="delimiter">(</span> <span class="string">&quot;ns&quot;</span> , getName<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>;  
        CommandResult res =  _db.command<span class="delimiter">(</span> <span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span> <span class="string">&quot;group&quot;</span> , args <span class="delimiter">)</span>, getOptions<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>;
        res.throwOnError<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="keyword">return</span> <span class="delimiter">(</span>DBObject<span class="delimiter">)</span>res.get<span class="delimiter">(</span> <span class="string">&quot;retval&quot;</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * find distinct values for a key
     * @param key 
     * @return
     */</span>
    public List <a title="(key: java.lang.String)java.util.List[_]" id="44385">distinct</a><span class="delimiter">(</span> String <a title="java.lang.String" id="45875">key</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">return</span> distinct<span class="delimiter">(</span> key , <span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * find distinct values for a key
     * @param key 
     * @param query query to match
     * @return
     */</span>
	public List <a title="(key: java.lang.String, query: com.mongodb.DBObject)java.util.List[_]" id="44386">distinct</a><span class="delimiter">(</span> String <a title="java.lang.String" id="45872">key</a> , <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="45873">query</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        DBObject c = BasicDBObjectBuilder.start<span class="delimiter">(</span><span class="delimiter">)</span>
            .add<span class="delimiter">(</span> <span class="string">&quot;distinct&quot;</span> , getName<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>
            .add<span class="delimiter">(</span> <span class="string">&quot;key&quot;</span> , key <span class="delimiter">)</span>
            .add<span class="delimiter">(</span> <span class="string">&quot;query&quot;</span> , query <span class="delimiter">)</span>
            .get<span class="delimiter">(</span><span class="delimiter">)</span>;
        
        CommandResult res = _db.command<span class="delimiter">(</span> c, getOptions<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>;
        res.throwOnError<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="keyword">return</span> <span class="delimiter">(</span>List<span class="delimiter">)</span><span class="delimiter">(</span>res.get<span class="delimiter">(</span> <span class="string">&quot;values&quot;</span> <span class="delimiter">)</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * performs a map reduce operation
     * Runs the command in REPLACE output mode (saves to named collection)
     * 
     * @param map
     *            map function in javascript code
     * @param outputTarget
     *            optional - leave null if want to use temp collection
     * @param reduce
     *            reduce function in javascript code
     * @param query
     *            to match
     * @return
     * @throws MongoException
     * @dochub mapreduce
     */</span>
    public <a href="MapReduceOutput.java.html#7902" title="com.mongodb.MapReduceOutput">MapReduceOutput</a> <a title="(map: java.lang.String, reduce: java.lang.String, outputTarget: java.lang.String, query: com.mongodb.DBObject)com.mongodb.MapReduceOutput" id="44387">mapReduce</a><span class="delimiter">(</span> String <a title="java.lang.String" id="145217">map</a> , String <a title="java.lang.String" id="145218">reduce</a> , String <a title="java.lang.String" id="145219">outputTarget</a> , <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="145220">query</a> <span class="delimiter">)</span> throws MongoException<span class="delimiter">{</span>
        <span class="keyword">return</span> mapReduce<span class="delimiter">(</span> <span class="keyword">new</span> MapReduceCommand<span class="delimiter">(</span> <span class="keyword">this</span> , map , reduce , outputTarget , MapReduceCommand.OutputType.REPLACE, query <span class="delimiter">)</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * performs a map reduce operation
     * Specify an outputType to control job execution
     * * INLINE - Return results inline
     * * REPLACE - Replace the output collection with the job output
     * * MERGE - Merge the job output with the existing contents of outputTarget
     * * REDUCE - Reduce the job output with the existing contents of
     * outputTarget
     * 
     * @param map
     *            map function in javascript code
     * @param outputTarget
     *            optional - leave null if want to use temp collection
     * @param outputType
     *            set the type of job output
     * @param reduce
     *            reduce function in javascript code
     * @param query
     *            to match
     * @return
     * @throws MongoException
     * @dochub mapreduce
     */</span>
    public <a href="MapReduceOutput.java.html#7902" title="com.mongodb.MapReduceOutput">MapReduceOutput</a> <a title="(map: java.lang.String, reduce: java.lang.String, outputTarget: java.lang.String, outputType: com.mongodb.MapReduceCommand.OutputType, query: com.mongodb.DBObject)com.mongodb.MapReduceOutput" id="44388">mapReduce</a><span class="delimiter">(</span> String <a title="java.lang.String" id="145221">map</a> , String <a title="java.lang.String" id="145222">reduce</a> , String <a title="java.lang.String" id="145223">outputTarget</a> , <a href="MapReduceCommand.java.html#7822" title="object com.mongodb.MapReduceCommand">MapReduceCommand</a>.<a href="MapReduceCommand.java.html#145229" title="com.mongodb.MapReduceCommand.OutputType">OutputType</a> <a title="com.mongodb.MapReduceCommand.OutputType" id="145224">outputType</a> , <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="145225">query</a> <span class="delimiter">)</span>
            throws MongoException<span class="delimiter">{</span>
        <span class="keyword">return</span> mapReduce<span class="delimiter">(</span> <span class="keyword">new</span> MapReduceCommand<span class="delimiter">(</span> <span class="keyword">this</span> , map , reduce , outputTarget , outputType , query <span class="delimiter">)</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * performs a map reduce operation
     * 
     * @param command
     *            object representing the parameters
     * @return
     * @throws MongoException
     */</span>
    public <a href="MapReduceOutput.java.html#7902" title="com.mongodb.MapReduceOutput">MapReduceOutput</a> <a title="(command: com.mongodb.MapReduceCommand)com.mongodb.MapReduceOutput" id="44389">mapReduce</a><span class="delimiter">(</span> <a href="MapReduceCommand.java.html#7821" title="com.mongodb.MapReduceCommand">MapReduceCommand</a> <a title="com.mongodb.MapReduceCommand" id="145230">command</a> <span class="delimiter">)</span> throws MongoException<span class="delimiter">{</span>
        DBObject cmd = command.toDBObject<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="comment">// if type in inline, then query options like slaveOk is fine</span>
        CommandResult res = <span class="keyword">null</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span>command.getOutputType<span class="delimiter">(</span><span class="delimiter">)</span> == MapReduceCommand.OutputType.INLINE<span class="delimiter">)</span>
            res = _db.command<span class="delimiter">(</span> cmd, getOptions<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>;
        <span class="keyword">else</span>
            res = _db.command<span class="delimiter">(</span> cmd <span class="delimiter">)</span>;
        res.throwOnError<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="keyword">return</span> <span class="keyword">new</span> MapReduceOutput<span class="delimiter">(</span> <span class="keyword">this</span> , cmd, res <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * performs a map reduce operation
     * 
     * @param command
     *            object representing the parameters
     * @return
     * @throws MongoException
     */</span>
    public <a href="MapReduceOutput.java.html#7902" title="com.mongodb.MapReduceOutput">MapReduceOutput</a> <a title="(command: com.mongodb.DBObject)com.mongodb.MapReduceOutput" id="44390">mapReduce</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="145231">command</a> <span class="delimiter">)</span> throws MongoException<span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span> command.get<span class="delimiter">(</span> <span class="string">&quot;mapreduce&quot;</span> <span class="delimiter">)</span> == <span class="keyword">null</span> &amp;&amp; command.get<span class="delimiter">(</span> <span class="string">&quot;mapReduce&quot;</span> <span class="delimiter">)</span> == <span class="keyword">null</span> <span class="delimiter">)</span>
            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException<span class="delimiter">(</span> <span class="string">&quot;need mapreduce arg&quot;</span> <span class="delimiter">)</span>;
        CommandResult res = _db.command<span class="delimiter">(</span> command <span class="delimiter">)</span>;
        res.throwOnError<span class="delimiter">(</span><span class="delimiter">)</span>;
        <span class="keyword">return</span> <span class="keyword">new</span> MapReduceOutput<span class="delimiter">(</span> <span class="keyword">this</span> , command, res <span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     *   Return a list of the indexes for this collection.  Each object
     *   in the list is the &quot;info document&quot; from MongoDB
     *
     *   @return list of index documents
     */</span>
    public List&lt;<a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a>&gt; <a title="()java.util.List[com.mongodb.DBObject]" id="44391">getIndexInfo</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        BasicDBObject cmd = <span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span><span class="delimiter">)</span>;
        cmd.put<span class="delimiter">(</span><span class="string">&quot;ns&quot;</span>, getFullName<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;

        DBCursor cur = _db.getCollection<span class="delimiter">(</span><span class="string">&quot;system.indexes&quot;</span><span class="delimiter">)</span>.find<span class="delimiter">(</span>cmd<span class="delimiter">)</span>;

        List&lt;DBObject&gt; list = <span class="keyword">new</span> ArrayList&lt;DBObject&gt;<span class="delimiter">(</span><span class="delimiter">)</span>;

        <span class="keyword">while</span><span class="delimiter">(</span>cur.hasNext<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            list.add<span class="delimiter">(</span>cur.next<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
        <span class="delimiter">}</span>

        <span class="keyword">return</span> list;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Drops an index from this collection
     * @param keys keys of the index
     * @throws MongoException
     */</span>
    public void <a title="(keys: com.mongodb.DBObject)Unit" id="44392">dropIndex</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="46056">keys</a> <span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        dropIndexes<span class="delimiter">(</span> genIndexName<span class="delimiter">(</span> keys <span class="delimiter">)</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Drops an index from this collection
     * @param name name of index to drop
     * @throws MongoException
     */</span>
    public void <a title="(name: java.lang.String)Unit" id="44393">dropIndex</a><span class="delimiter">(</span> String <a title="java.lang.String" id="46055">name</a> <span class="delimiter">)</span>
        throws MongoException <span class="delimiter">{</span>
        dropIndexes<span class="delimiter">(</span> name <span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * gets the collections statistics (&quot;collstats&quot; command)
     * @return
     */</span>
    public <a href="CommandResult.java.html#7890" title="com.mongodb.CommandResult">CommandResult</a> <a title="()com.mongodb.CommandResult" id="44394">getStats</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">return</span> getDB<span class="delimiter">(</span><span class="delimiter">)</span>.command<span class="delimiter">(</span><span class="keyword">new</span> BasicDBObject<span class="delimiter">(</span><span class="string">&quot;collstats&quot;</span>, getName<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>, getOptions<span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * returns whether or not this is a capped collection
     * @return
     */</span>
    public boolean <a title="()Boolean" id="44395">isCapped</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        CommandResult stats = getStats<span class="delimiter">(</span><span class="delimiter">)</span>;
        Object capped = stats.get<span class="delimiter">(</span><span class="string">&quot;capped&quot;</span><span class="delimiter">)</span>;
        <span class="keyword">return</span><span class="delimiter">(</span>capped != <span class="keyword">null</span> &amp;&amp; <span class="delimiter">(</span>Integer<span class="delimiter">)</span>capped == <span class="int">1</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">// ------</span>

    <span class="comment">/**
     * Initializes a new collection. No operation is actually performed on the database.
     * @param base database in which to create the collection
     * @param name the name of the collection
     */</span>
    <span class="keyword">protected</span> DBCollection<span class="delimiter">(</span> DB base , String name <span class="delimiter">)</span><span class="delimiter">{</span>
        _db = base;
        _name = name;
        _fullName = _db.getName<span class="delimiter">(</span><span class="delimiter">)</span> + <span class="string">&quot;.&quot;</span> + name;
        _options = <span class="keyword">new</span> Bytes.OptionHolder<span class="delimiter">(</span> _db._options <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="keyword">protected</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="(o: com.mongodb.DBObject, canBeNull: Boolean, query: Boolean)com.mongodb.DBObject" id="44397">_checkObject</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="145232">o</a> , boolean <a title="Boolean" id="145233">canBeNull</a> , boolean <a title="Boolean" id="145234">query</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span> o == <span class="keyword">null</span> <span class="delimiter">)</span><span class="delimiter">{</span>
            <span class="keyword">if</span> <span class="delimiter">(</span> canBeNull <span class="delimiter">)</span>
                <span class="keyword">return</span> <span class="keyword">null</span>;
            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException<span class="delimiter">(</span> <span class="string">&quot;can't be null&quot;</span> <span class="delimiter">)</span>;
        <span class="delimiter">}</span>

        <span class="keyword">if</span> <span class="delimiter">(</span> o.isPartialObject<span class="delimiter">(</span><span class="delimiter">)</span> &amp;&amp; ! query <span class="delimiter">)</span>
            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException<span class="delimiter">(</span> <span class="string">&quot;can't save partial objects&quot;</span> <span class="delimiter">)</span>;
        
        <span class="keyword">if</span> <span class="delimiter">(</span> ! query <span class="delimiter">)</span><span class="delimiter">{</span>
            _checkKeys<span class="delimiter">(</span>o<span class="delimiter">)</span>;
        <span class="delimiter">}</span>
        <span class="keyword">return</span> o;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Checks key strings for invalid characters.
     */</span>
    <span class="keyword">private</span> void <a title="(o: com.mongodb.DBObject)Unit" id="44398">_checkKeys</a><span class="delimiter">(</span> <a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a> <a title="com.mongodb.DBObject" id="145235">o</a> <span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">for</span> <span class="delimiter">(</span> String s : o.keySet<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span><span class="delimiter">{</span>
            <span class="keyword">if</span> <span class="delimiter">(</span> s.contains<span class="delimiter">(</span> <span class="string">&quot;.&quot;</span> <span class="delimiter">)</span> <span class="delimiter">)</span>
                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException<span class="delimiter">(</span> <span class="string">&quot;fields stored in the db can't have . in them&quot;</span> <span class="delimiter">)</span>;
            <span class="keyword">if</span> <span class="delimiter">(</span> s.charAt<span class="delimiter">(</span> <span class="int">0</span> <span class="delimiter">)</span> == <span class="char">'$'</span> <span class="delimiter">)</span>
                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException<span class="delimiter">(</span> <span class="string">&quot;fields stored in the db can't start with '$'&quot;</span> <span class="delimiter">)</span>;

            Object inner;
            <span class="keyword">if</span> <span class="delimiter">(</span> <span class="delimiter">(</span>inner = o.get<span class="delimiter">(</span> s <span class="delimiter">)</span><span class="delimiter">)</span> instanceof DBObject <span class="delimiter">)</span> <span class="delimiter">{</span>
                _checkKeys<span class="delimiter">(</span> <span class="delimiter">(</span>DBObject<span class="delimiter">)</span>inner <span class="delimiter">)</span>;
            <span class="delimiter">}</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Finds a collection that is prefixed with this collection's name.
     * A typical use of this might be 
     * &lt;blockquote&gt;&lt;pre&gt;
     *    DBCollection users = mongo.getCollection( &quot;wiki&quot; ).getCollection( &quot;users&quot; );
     * &lt;/pre&gt;&lt;/blockquote&gt;
     * Which is equilalent to
     * &lt;pre&gt;&lt;blockquote&gt;
     *   DBCollection users = mongo.getCollection( &quot;wiki.users&quot; );
     * &lt;/pre&gt;&lt;/blockquote&gt;
     * @param n the name of the collection to find
     * @return the matching collection
     */</span>
    public <a href="#7830" title="com.mongodb.DBCollection">DBCollection</a> <a title="(n: java.lang.String)com.mongodb.DBCollection" id="44399">getCollection</a><span class="delimiter">(</span> String <a title="java.lang.String" id="46648">n</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">return</span> _db.getCollection<span class="delimiter">(</span> _name + <span class="string">&quot;.&quot;</span> + n <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Returns the name of this collection.
     * @return  the name of this collection
     */</span>
    public String <a title="()java.lang.String" id="44400">getName</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">return</span> _name;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Returns the full name of this collection, with the database name as a prefix.
     * @return  the name of this collection
     */</span>
    public String <a title="()java.lang.String" id="44401">getFullName</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">return</span> _fullName;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Returns the database this collection is a member of.
     * @return this collection's database
     */</span>
    public <a href="DB.java.html#7845" title="com.mongodb.DB">DB</a> <a title="()com.mongodb.DB" id="44402">getDB</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">return</span> _db;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Returns if this collection's database is read-only
     * @param strict if an exception should be thrown if the database is read-only
     * @return if this collection's database is read-only
     * @throws RuntimeException if the database is read-only and &lt;code&gt;strict&lt;/code&gt; is set
     */</span>
    <span class="keyword">protected</span> boolean <a title="(strict: Boolean)Boolean" id="44403">checkReadOnly</a><span class="delimiter">(</span> boolean <a title="Boolean" id="145236">strict</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span> ! _db._readOnly <span class="delimiter">)</span>
            <span class="keyword">return</span> <span class="keyword">false</span>;

        <span class="keyword">if</span> <span class="delimiter">(</span> ! strict <span class="delimiter">)</span>
            <span class="keyword">return</span> <span class="keyword">true</span>;

        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException<span class="delimiter">(</span> <span class="string">&quot;db is read only&quot;</span> <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    @Override
    public int <a title="()Int" id="44404">hashCode</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">return</span> _fullName.hashCode<span class="delimiter">(</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    @Override
    public boolean <a title="(o: Any)Boolean" id="44405">equals</a><span class="delimiter">(</span> Object <a title="Any" id="51741">o</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">return</span> o == <span class="keyword">this</span>;
    <span class="delimiter">}</span>

    @Override
    public String <a title="()java.lang.String" id="44406">toString</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">return</span> _name;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Sets a default class for objects in this collection; null resets the class to nothing.
     * @param c the class
     * @throws IllegalArgumentException if &lt;code&gt;c&lt;/code&gt; is not a DBObject
     */</span>
    public void <a title="(c: java.lang.Class[_])Unit" id="44407">setObjectClass</a><span class="delimiter">(</span> Class <a title="java.lang.Class" id="46980">c</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span> c == <span class="keyword">null</span> <span class="delimiter">)</span><span class="delimiter">{</span> 
            <span class="comment">// reset</span>
            _wrapper = <span class="keyword">null</span>;
            _objectClass = <span class="keyword">null</span>;
            <span class="keyword">return</span>;
        <span class="delimiter">}</span>
        
        <span class="keyword">if</span> <span class="delimiter">(</span> ! DBObject.<span class="keyword">class</span>.isAssignableFrom<span class="delimiter">(</span> c <span class="delimiter">)</span> <span class="delimiter">)</span>
            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException<span class="delimiter">(</span> c.getName<span class="delimiter">(</span><span class="delimiter">)</span> + <span class="string">&quot; is not a DBObject&quot;</span> <span class="delimiter">)</span>;
        _objectClass = c;
        <span class="keyword">if</span> <span class="delimiter">(</span> ReflectionDBObject.<span class="keyword">class</span>.isAssignableFrom<span class="delimiter">(</span> c <span class="delimiter">)</span> <span class="delimiter">)</span>
            _wrapper = ReflectionDBObject.getWrapper<span class="delimiter">(</span> c <span class="delimiter">)</span>;
        <span class="keyword">else</span> 
            _wrapper = <span class="keyword">null</span>;
    <span class="delimiter">}</span>
    
    <span class="comment">/**
     * Gets the default class for objects in the collection
     * @return the class
     */</span>
    public Class <a title="()java.lang.Class[_]" id="44408">getObjectClass</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">return</span> _objectClass;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * sets the internal class
     * @param path
     * @param c
     */</span>
    public void <a title="(path: java.lang.String, c: java.lang.Class[_])Unit" id="44409">setInternalClass</a><span class="delimiter">(</span> String <a title="java.lang.String" id="51546">path</a> , Class <a title="java.lang.Class" id="51547">c</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        _internalClass.put<span class="delimiter">(</span> path , c <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * gets the internal class
     * @param path
     * @return
     */</span>
    <span class="keyword">protected</span> Class <a title="(path: java.lang.String)java.lang.Class" id="44410">getInternalClass</a><span class="delimiter">(</span> String <a title="java.lang.String" id="145237">path</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        Class c = _internalClass.get<span class="delimiter">(</span> path <span class="delimiter">)</span>;
        <span class="keyword">if</span> <span class="delimiter">(</span> c != <span class="keyword">null</span> <span class="delimiter">)</span>
            <span class="keyword">return</span> c;

        <span class="keyword">if</span> <span class="delimiter">(</span> _wrapper == <span class="keyword">null</span> <span class="delimiter">)</span>
            <span class="keyword">return</span> <span class="keyword">null</span>;
        <span class="keyword">return</span> _wrapper.getInternalClass<span class="delimiter">(</span> path <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Set the write concern for this collection. Will be used for
     * writes to this collection. Overrides any setting of write
     * concern at the DB level. See the documentation for
     * {@link WriteConcern} for more information.
     *
     * @param concern write concern to use
     */</span>
    public void <a title="(concern: com.mongodb.WriteConcern)Unit" id="44411">setWriteConcern</a><span class="delimiter">(</span> <a href="WriteConcern.java.html#7896" title="com.mongodb.WriteConcern">WriteConcern</a> <a title="com.mongodb.WriteConcern" id="52050">concern</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        _concern = concern;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Get the write concern for this collection.
     * @return
     */</span>
    public <a href="WriteConcern.java.html#7896" title="com.mongodb.WriteConcern">WriteConcern</a> <a title="()com.mongodb.WriteConcern" id="44412">getWriteConcern</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">if</span> <span class="delimiter">(</span> _concern != <span class="keyword">null</span> <span class="delimiter">)</span>
            <span class="keyword">return</span> _concern;
        <span class="keyword">return</span> _db.getWriteConcern<span class="delimiter">(</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * makes this query ok to run on a slave node
     */</span>
    public void <a title="()Unit" id="44413">slaveOk</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        addOption<span class="delimiter">(</span> Bytes.QUERYOPTION_SLAVEOK <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * adds a default query option
     * @param option
     */</span>
    public void <a title="(option: Int)Unit" id="44414">addOption</a><span class="delimiter">(</span> int <a title="Int" id="52066">option</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        _options.add<span class="delimiter">(</span> option <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * sets the default query options
     * @param options
     */</span>
    public void <a title="(options: Int)Unit" id="44415">setOptions</a><span class="delimiter">(</span> int <a title="Int" id="145238">options</a> <span class="delimiter">)</span><span class="delimiter">{</span>
        _options.set<span class="delimiter">(</span> options <span class="delimiter">)</span>;
    <span class="delimiter">}</span>

    <span class="comment">/**
     * resets the default query options
     */</span>
    public void <a title="()Unit" id="44416">resetOptions</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        _options.reset<span class="delimiter">(</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>
   
    <span class="comment">/**
     * gets the default query options
     * @return
     */</span>
    public int <a title="()Int" id="44417">getOptions</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">{</span>
        <span class="keyword">return</span> _options.get<span class="delimiter">(</span><span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    
    <span class="keyword">final</span> <a href="DB.java.html#7845" title="com.mongodb.DB">DB</a> <a title="com.mongodb.DB" id="44418">_db</a>;

    <span class="keyword">final</span> <span class="keyword">protected</span> String <a title="java.lang.String" id="44419">_name</a>;
    <span class="keyword">final</span> <span class="keyword">protected</span> String <a title="java.lang.String" id="44420">_fullName</a>;

    <span class="keyword">protected</span> List&lt;<a href="DBObject.java.html#7932" title="com.mongodb.DBObject">DBObject</a>&gt; <a title="java.util.List[com.mongodb.DBObject]" id="44421">_hintFields</a>;
    <span class="keyword">private</span> <a href="WriteConcern.java.html#7896" title="com.mongodb.WriteConcern">WriteConcern</a> <a title="com.mongodb.WriteConcern" id="44422">_concern</a> = <span class="keyword">null</span>;
    <span class="keyword">final</span> <a href="Bytes.java.html#7963" title="object com.mongodb.Bytes">Bytes</a>.<a href="Bytes.java.html#66824" title="com.mongodb.Bytes.OptionHolder">OptionHolder</a> <a title="com.mongodb.Bytes.OptionHolder" id="44423">_options</a>;

    <span class="keyword">protected</span> Class <a title="java.lang.Class" id="44424">_objectClass</a> = <span class="keyword">null</span>;
    <span class="keyword">private</span> Map&lt;String,Class&gt; <a title="java.util.Map[java.lang.String,java.lang.Class]" id="44425">_internalClass</a> = Collections.synchronizedMap<span class="delimiter">(</span> <span class="keyword">new</span> HashMap&lt;String,Class&gt;<span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">)</span>;
    <span class="keyword">private</span> <a href="ReflectionDBObject.java.html#7954" title="object com.mongodb.ReflectionDBObject">ReflectionDBObject</a>.<a href="ReflectionDBObject.java.html#145242" title="com.mongodb.ReflectionDBObject.JavaWrapper">JavaWrapper</a> <a title="com.mongodb.ReflectionDBObject.JavaWrapper" id="44426">_wrapper</a> = <span class="keyword">null</span>;

    <span class="keyword">final</span> <span class="keyword">private</span> Set&lt;String&gt; <a title="java.util.Set[java.lang.String]" id="44427">_createdIndexes</a> = <span class="keyword">new</span> HashSet&lt;String&gt;<span class="delimiter">(</span><span class="delimiter">)</span>;
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
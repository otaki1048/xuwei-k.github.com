<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>play/play/api/libs/concurrent/Promise.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> play.api.libs.concurrent

<span class="keyword">import</span> play.core._
<span class="keyword">import</span> play.api._

<span class="keyword">import</span> akka.actor._
<span class="keyword">import</span> akka.actor.<span title="object akka.actor.Actor">Actor</span>._

<span class="keyword">import</span> java.util.concurrent.<span class="delimiter">{</span> TimeUnit <span class="delimiter">}</span>

<span class="keyword">sealed</span> <span class="keyword">trait</span> <a title="trait PromiseValue[+A] extends java.lang.Object with ScalaObject" id="13134">PromiseValue</a><span class="delimiter">[</span>+<a title="&gt;: Nothing &lt;: Any" id="13393">A</a><span class="delimiter">]</span> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="=&gt; Boolean" id="76160">isDefined</a> = <a href="#13134" title="play.api.libs.concurrent.PromiseValue[A]" class="keyword">this</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span> <span class="keyword">case</span> <a href="#169127" title="Boolean(false)">Waiting</a> =&gt; <span title="Boolean(false)" class="keyword">false</span>; <span class="keyword">case</span> <span title="Boolean(true)">_</span> =&gt; <span title="Boolean(true)" class="keyword">true</span> <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">trait</span> <a title="trait NotWaiting[+A] extends java.lang.Object with play.api.libs.concurrent.PromiseValue[A] with ScalaObject" id="13164">NotWaiting</a><span class="delimiter">[</span>+<a title="&gt;: Nothing &lt;: Any" id="13394">A</a><span class="delimiter">]</span> <span title="ScalaObject" class="keyword">extends</span> <a href="#13134" title="play.api.libs.concurrent.PromiseValue[A]">PromiseValue</a><span class="delimiter">[</span>A<span class="delimiter">]</span> <span class="delimiter">{</span>
  <span class="comment">/**
   * Return the value or the promise, throw it if it held an exception
   */</span>
  <span class="keyword">def</span> <a title="=&gt; A" id="76162">get</a>: <a href="#13394" title="A">A</a> = <a href="#13164" title="play.api.libs.concurrent.NotWaiting[A]" class="keyword">this</a> <span title="A" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="Nothing">Thrown</span><span class="delimiter">(</span><a title="Throwable" id="169052">e</a><span class="delimiter">)</span> =&gt; <span title="Nothing" class="keyword">throw</span> <a href="#169052" title="Throwable">e</a>
    <span class="keyword">case</span> <span title="A">Redeemed</span><span class="delimiter">(</span><a title="A" id="169054">a</a><span class="delimiter">)</span> =&gt; <a href="#169054" title="A">a</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[B](onError: Throwable =&gt; B, onSuccess: A =&gt; B)B" id="76163">fold</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="76165">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="Throwable =&gt; B" id="169055">onError</a>: Throwable =&gt; B, <a title="A =&gt; B" id="169056">onSuccess</a>: A =&gt; B<span class="delimiter">)</span>: <a href="#76165" title="B">B</a> = <a href="#13164" title="play.api.libs.concurrent.NotWaiting[A]" class="keyword">this</a> <span title="B" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="B">Thrown</span><span class="delimiter">(</span><a title="Throwable" id="169060">e</a><span class="delimiter">)</span> =&gt; <a href="#169055" title="(v1: Throwable)B">onError</a><span class="delimiter">(</span><a href="#169060" title="Throwable">e</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <span title="B">Redeemed</span><span class="delimiter">(</span><a title="A" id="169063">r</a><span class="delimiter">)</span> =&gt; <a href="#169056" title="(v1: A)B">onSuccess</a><span class="delimiter">(</span><a href="#169063" title="A">r</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>
case <span class="keyword">class</span> <a title="class Thrown extends java.lang.Object with play.api.libs.concurrent.NotWaiting[Nothing] with ScalaObject with Product with Serializable" id="172243">Thrown</a><a href="#172243" title="ScalaObject" class="delimiter">(</a><a title="Throwable" id="168368">e</a>: scala.<span title="Throwable">Throwable</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#13164" title="play.api.libs.concurrent.NotWaiting[Nothing]">NotWaiting</a><span class="delimiter">[</span>Nothing<span class="delimiter">]</span>
case <span class="keyword">class</span> <a title="class Redeemed[+A] extends java.lang.Object with play.api.libs.concurrent.NotWaiting[A] with ScalaObject with Product with Serializable" id="172239">Redeemed</a><span class="delimiter">[</span>+<a title="&gt;: Nothing &lt;: Any" id="99621">A</a><span class="delimiter">]</span><a href="#172239" title="ScalaObject" class="delimiter">(</a><a title="A" id="168413">a</a>: <a href="#99621" title="A">A</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#13164" title="play.api.libs.concurrent.NotWaiting[A]">NotWaiting</a><span class="delimiter">[</span>A<span class="delimiter">]</span>
case <span class="keyword">object</span> <a href="#169122" title="object play.api.libs.concurrent.Waiting" id="169127">Waiting</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#13134" title="play.api.libs.concurrent.PromiseValue[Nothing]">PromiseValue</a><span class="delimiter">[</span>Nothing<span class="delimiter">]</span>

<span class="keyword">trait</span> <a title="trait Promise[+A] extends java.lang.Object with ScalaObject" id="13155">Promise</a><span class="delimiter">[</span>+<a title="&gt;: Nothing &lt;: Any" id="13396">A</a><span class="delimiter">]</span> <span title="ScalaObject" class="delimiter">{</span>

  <span class="keyword">def</span> <a title="(k: A =&gt; Unit)Unit" id="74719">onRedeem</a><span class="delimiter">(</span><a title="A =&gt; Unit" id="168344">k</a>: A =&gt; Unit<span class="delimiter">)</span>: <span title="Unit">Unit</span>

  <span class="keyword">def</span> <a title="[B](k: play.api.libs.concurrent.Promise[A] =&gt; B)play.api.libs.concurrent.Promise[B]" id="74720">extend</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="74722">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="play.api.libs.concurrent.Promise[A] =&gt; B" id="168384">k</a>: <span title="play.api.libs.concurrent.Promise[A] =&gt; B">Function1</span><span class="delimiter">[</span>Promise<span class="delimiter">[</span>A<span class="delimiter">]</span>, B<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#13155" title="play.api.libs.concurrent.Promise[B]">Promise</a><span class="delimiter">[</span>B<span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="[B](k: play.api.libs.concurrent.NotWaiting[A] =&gt; B)play.api.libs.concurrent.Promise[B]" id="74723">extend1</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="74725">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="play.api.libs.concurrent.NotWaiting[A] =&gt; B" id="99609">k</a>: <span title="play.api.libs.concurrent.NotWaiting[A] =&gt; B">Function1</span><span class="delimiter">[</span>NotWaiting<span class="delimiter">[</span>A<span class="delimiter">]</span>, B<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#13155" title="play.api.libs.concurrent.Promise[B]">Promise</a><span class="delimiter">[</span>B<span class="delimiter">]</span> = <a href="#74720" title="[B](k: play.api.libs.concurrent.Promise[A] =&gt; B)play.api.libs.concurrent.Promise[B]">extend</a><span title="(k: play.api.libs.concurrent.Promise[A] =&gt; B)play.api.libs.concurrent.Promise[B]" class="delimiter">[</span><a href="#74725" title="B">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="play.api.libs.concurrent.Promise[A]" id="169132">p</a> =&gt; <a href="#99609" title="(v1: play.api.libs.concurrent.NotWaiting[A])B">k</a><span class="delimiter">(</span><a href="#169132" title="play.api.libs.concurrent.Promise[A]">p</a>.<a href="#74726" title="=&gt; play.api.libs.concurrent.NotWaiting[A]">value</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="=&gt; play.api.libs.concurrent.NotWaiting[A]" id="74726">value</a> = <a href="#74727" title="=&gt; play.api.libs.concurrent.NotWaiting[A]">await</a>

  <span class="keyword">def</span> <a title="=&gt; play.api.libs.concurrent.NotWaiting[A]" id="74727">await</a>: <a href="#13164" title="play.api.libs.concurrent.NotWaiting[A]">NotWaiting</a><span class="delimiter">[</span>A<span class="delimiter">]</span> = <a href="#74728" title="(timeout: Long, unit: java.util.concurrent.TimeUnit)play.api.libs.concurrent.NotWaiting[A]">await</a><span class="delimiter">(</span><span title="Long(5000L)" class="int">5000</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(timeout: Long, unit: java.util.concurrent.TimeUnit)play.api.libs.concurrent.NotWaiting[A]" id="74728">await</a><span class="delimiter">(</span><a title="Long" id="76166">timeout</a>: <span title="Long">Long</span>, <a title="java.util.concurrent.TimeUnit" id="76169">unit</a>: <span title="java.util.concurrent.TimeUnit">TimeUnit</span> = TimeUnit.<span title="java.util.concurrent.TimeUnit(value MILLISECONDS)">MILLISECONDS</span><span class="delimiter">)</span>: <a href="#13164" title="play.api.libs.concurrent.NotWaiting[A]">NotWaiting</a><span class="delimiter">[</span>A<span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="(p: A =&gt; Boolean)play.api.libs.concurrent.Promise[A]" id="74729">filter</a><span class="delimiter">(</span><a title="A =&gt; Boolean" id="168620">p</a>: A =&gt; Boolean<span class="delimiter">)</span>: <a href="#13155" title="play.api.libs.concurrent.Promise[A]">Promise</a><span class="delimiter">[</span>A<span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="[B](f: A =&gt; B)play.api.libs.concurrent.Promise[B]" id="74730">map</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="74732">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="A =&gt; B" id="99566">f</a>: A =&gt; B<span class="delimiter">)</span>: <a href="#13155" title="play.api.libs.concurrent.Promise[B]">Promise</a><span class="delimiter">[</span>B<span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="[B](f: A =&gt; play.api.libs.concurrent.Promise[B])play.api.libs.concurrent.Promise[B]" id="74733">flatMap</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="74735">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="A =&gt; play.api.libs.concurrent.Promise[B]" id="74742">f</a>: A =&gt; Promise<span class="delimiter">[</span>B<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#13155" title="play.api.libs.concurrent.Promise[B]">Promise</a><span class="delimiter">[</span>B<span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="[B](other: play.api.libs.concurrent.Promise[B])play.api.libs.concurrent.Promise[Either[A,B]]" id="74736">or</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="74738">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="play.api.libs.concurrent.Promise[B]" id="169138">other</a>: <a href="#13155" title="play.api.libs.concurrent.Promise[B]">Promise</a><span class="delimiter">[</span>B<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#13155" title="play.api.libs.concurrent.Promise[Either[A,B]]">Promise</a><span class="delimiter">[</span>Either<span class="delimiter">[</span>A, B<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">import</span> scala.concurrent.stm._

    <span class="keyword">val</span> <a title="Promise extends play.api.libs.concurrent.Promise[Either[A,B]] with play.api.libs.concurrent.Redeemable[Either[A,B]]" id="169142">p</a> = <a href="#77329" title="[A]()play.api.libs.concurrent.Promise[A] with play.api.libs.concurrent.Redeemable[A]">Promise</a><span title="()play.api.libs.concurrent.Promise[Either[A,B]] with play.api.libs.concurrent.Redeemable[Either[A,B]]" class="delimiter">[</span><span title="Either[A,B]">Either</span><span class="delimiter">[</span>A, B<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.concurrent.stm.Ref[Boolean]" id="169143">ref</a> = <span title="(initialValue: Boolean)scala.concurrent.stm.Ref[Boolean]">Ref</span><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
    <a href="#13155" title="Promise.this.type" class="keyword">this</a>.<a href="#74719" title="(k: A =&gt; Unit)Unit">onRedeem</a> <span class="delimiter">{</span> <a title="A" id="169738">v</a> =&gt;
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#169143" title="scala.concurrent.stm.Ref[Boolean]">ref</a>.<span title="()Boolean">single</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Boolean" id="169827">iRedeemed</a> = <span title="(block: scala.concurrent.stm.InTxn =&gt; Boolean)(implicit mt: scala.concurrent.stm.MaybeTxn)Boolean">atomic</span> <span title="=&gt; scala.concurrent.stm.TxnUnknown.type" class="delimiter">{</span> <span class="keyword">implicit</span> <a title="scala.concurrent.stm.InTxn" id="169886">txn</a> =&gt;
          <span class="keyword">val</span> <a title="Boolean" id="169887">before</a> = <a href="#169143" title="()(implicit txn: scala.concurrent.stm.InTxn)Boolean">ref</a><a href="#169886" title="scala.concurrent.stm.InTxn" class="delimiter">(</a><span class="delimiter">)</span>
          <a href="#169143" title="(v: Boolean)(implicit txn: scala.concurrent.stm.InTxn)Unit">ref</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span title="Boolean(true)" class="keyword">true</span>
          <span title="=&gt; Boolean">!</span><a href="#169887" title="Boolean">before</a>
        <span class="delimiter">}</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#169827" title="Boolean">iRedeemed</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#169142" title="Promise extends play.api.libs.concurrent.Promise[Either[A,B]] with play.api.libs.concurrent.Redeemable[Either[A,B]]">p</a>.<a href="#99535" title="(a: =&gt; Either[A,B])Unit">redeem</a><span class="delimiter">(</span><span title="(a: A)Left[A,Nothing]">Left</span><span class="delimiter">(</span><a href="#169738" title="A">v</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <a href="#169138" title="play.api.libs.concurrent.Promise[B]">other</a>.<a href="#74719" title="(k: B =&gt; Unit)Unit">onRedeem</a> <span class="delimiter">{</span> <a title="B" id="169935">v</a> =&gt;
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#169143" title="scala.concurrent.stm.Ref[Boolean]">ref</a>.<span title="()Boolean">single</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Boolean" id="169936">iRedeemed</a> = <span title="(block: scala.concurrent.stm.InTxn =&gt; Boolean)(implicit mt: scala.concurrent.stm.MaybeTxn)Boolean">atomic</span> <span title="=&gt; scala.concurrent.stm.TxnUnknown.type" class="delimiter">{</span> <span class="keyword">implicit</span> <a title="scala.concurrent.stm.InTxn" id="169940">txn</a> =&gt;
          <span class="keyword">val</span> <a title="Boolean" id="169941">before</a> = <a href="#169143" title="()(implicit txn: scala.concurrent.stm.InTxn)Boolean">ref</a><a href="#169940" title="scala.concurrent.stm.InTxn" class="delimiter">(</a><span class="delimiter">)</span>
          <a href="#169143" title="(v: Boolean)(implicit txn: scala.concurrent.stm.InTxn)Unit">ref</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span title="Boolean(true)" class="keyword">true</span>
          <span title="=&gt; Boolean">!</span><a href="#169941" title="Boolean">before</a>
        <span class="delimiter">}</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#169936" title="Boolean">iRedeemed</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#169142" title="Promise extends play.api.libs.concurrent.Promise[Either[A,B]] with play.api.libs.concurrent.Redeemable[Either[A,B]]">p</a>.<a href="#99535" title="(a: =&gt; Either[A,B])Unit">redeem</a><span class="delimiter">(</span><span title="(b: B)Right[Nothing,B]">Right</span><span class="delimiter">(</span><a href="#169935" title="B">v</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <a href="#169142" title="Promise extends play.api.libs.concurrent.Promise[Either[A,B]] with play.api.libs.concurrent.Redeemable[Either[A,B]]">p</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[B](message: B, duration: Long, unit: java.util.concurrent.TimeUnit)play.api.libs.concurrent.Promise[Either[A,B]]" id="74739">orTimeout</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="169953">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="B" id="169947">message</a>: <a href="#169953" title="B">B</a>, <a title="Long" id="169948">duration</a>: <span title="Long">Long</span>, <a title="java.util.concurrent.TimeUnit" id="169951">unit</a>: <span title="java.util.concurrent.TimeUnit">TimeUnit</span> = TimeUnit.<span title="java.util.concurrent.TimeUnit(value MILLISECONDS)">MILLISECONDS</span><span class="delimiter">)</span>: <a href="#13155" title="play.api.libs.concurrent.Promise[Either[A,B]]">Promise</a><span class="delimiter">[</span>Either<span class="delimiter">[</span>A, B<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#74736" title="(other: play.api.libs.concurrent.Promise[B])play.api.libs.concurrent.Promise[Either[A,B]]">or</a><span class="delimiter">(</span><a href="#13156" title="object play.api.libs.concurrent.Promise">Promise</a>.<a href="#77335" title="(message: =&gt; B, duration: Long, unit: java.util.concurrent.TimeUnit)play.api.libs.concurrent.Promise[B]">timeout</a><span class="delimiter">(</span><a href="#169947" title="B">message</a>, <a href="#169948" title="Long">duration</a>, <a href="#169951" title="java.util.concurrent.TimeUnit">unit</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="keyword">trait</span> <a title="trait Redeemable[-A] extends java.lang.Object" id="13299">Redeemable</a><span class="delimiter">[</span>-<a title="&gt;: Nothing &lt;: Any" id="13397">A</a><span class="delimiter">]</span> <span title="java.lang.Object" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(a: =&gt; A)Unit" id="99535">redeem</a><span class="delimiter">(</span><a title="=&gt; A" id="99556">a</a>: =&gt; A<span class="delimiter">)</span>: <span title="Unit">Unit</span>
  <span class="keyword">def</span> <a title="(t: Throwable)Unit" id="99536">throwing</a><span class="delimiter">(</span><a title="Throwable" id="168676">t</a>: <span title="Throwable">Throwable</span><span class="delimiter">)</span>: <span title="Unit">Unit</span>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object play.api.libs.concurrent.STMPromise" id="13258">STMPromise</a> <span title="ScalaObject" class="delimiter">{</span>

  <span class="keyword">val</span> <a title="akka.actor.ActorRef" id="169995">invoker</a> = play.core.<a href="../../../core/system/Invoker.scala.html#17469" title="object play.core.Invoker">Invoker</a>.<a href="../../../core/system/Invoker.scala.html#170045" title="=&gt; akka.actor.ActorRef">promiseInvoker</a>

  <span class="keyword">class</span> <a title="class PromiseInvoker extends java.lang.Object with akka.actor.Actor with ScalaObject" id="169997">PromiseInvoker</a> <a href="#169997" title="ScalaObject" class="keyword">extends</a> <span title="akka.actor.Actor">Actor</span> <span class="delimiter">{</span>

    <span class="keyword">def</span> <a title="=&gt; PartialFunction[Any,Unit]" id="170498">receive</a> = <a href="#170612" title="Unit" class="delimiter">{</a>
      <span class="keyword">case</span> <span title="Unit">Invoke</span><span class="delimiter">(</span><a title="Any" id="170659">a</a>, <a title="Any =&gt; Unit" id="170660">k</a><span class="delimiter">)</span> =&gt; <a href="#170660" title="(v1: Any)Unit">k</a><span class="delimiter">(</span><a href="#170659" title="Any">a</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="delimiter">}</span>

  case <span class="keyword">class</span> <a title="class Invoke[A] extends java.lang.Object with ScalaObject with Product with Serializable" id="170714">Invoke</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="170617">A</a><span class="delimiter">]</span><a href="#170714" title="ScalaObject" class="delimiter">(</a><a title="A" id="170707">a</a>: <a href="#170617" title="A">A</a>, <a title="A =&gt; Unit" id="170708">k</a>: A =&gt; Unit<span class="delimiter">)</span>

<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class STMPromise[A] extends java.lang.Object with play.api.libs.concurrent.Promise[A] with play.api.libs.concurrent.Redeemable[A] with ScalaObject" id="13257">STMPromise</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="13398">A</a><span class="delimiter">]</span> <a href="#13257" title="ScalaObject" class="keyword">extends</a> <a href="#13155" title="play.api.libs.concurrent.Promise[A]">Promise</a><span class="delimiter">[</span>A<span class="delimiter">]</span> <span class="keyword">with</span> <a href="#13299" title="play.api.libs.concurrent.Redeemable[A]">Redeemable</a><span class="delimiter">[</span>A<span class="delimiter">]</span> <span class="delimiter">{</span>
  <span class="keyword">import</span> scala.concurrent.stm._

  <span class="keyword">val</span> <a title="scala.concurrent.stm.Ref[List[play.api.libs.concurrent.Promise[A] =&gt; Unit]]" id="170004">actions</a>: <span title="scala.concurrent.stm.Ref[List[play.api.libs.concurrent.Promise[A] =&gt; Unit]]">Ref</span><span class="delimiter">[</span>List<span class="delimiter">[</span>Promise<span class="delimiter">[</span>A<span class="delimiter">]</span> =&gt; Unit<span class="delimiter">]</span><span class="delimiter">]</span> = <span title="(initialValue: List[play.api.libs.concurrent.Promise[A] =&gt; Unit])(implicit om: scala.reflect.OptManifest[List[play.api.libs.concurrent.Promise[A] =&gt; Unit]])scala.concurrent.stm.Ref[List[play.api.libs.concurrent.Promise[A] =&gt; Unit]]">Ref</span><span title="(clazz: java.lang.Class[_], arg1: scala.reflect.OptManifest[_], args: scala.reflect.OptManifest[_]*)scala.reflect.ClassManifest[List[play.api.libs.concurrent.Promise[A] =&gt; Unit]]" class="delimiter">(</span>List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="keyword">var</span> <a title="scala.concurrent.stm.Ref[play.api.libs.concurrent.PromiseValue[A]]" id="170007">redeemed</a>: <span title="scala.concurrent.stm.Ref[play.api.libs.concurrent.PromiseValue[A]]">Ref</span><span class="delimiter">[</span>PromiseValue<span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">]</span> = <span title="(initialValue: play.api.libs.concurrent.PromiseValue[A])(implicit om: scala.reflect.OptManifest[play.api.libs.concurrent.PromiseValue[A]])scala.concurrent.stm.Ref[play.api.libs.concurrent.PromiseValue[A]]">Ref</span><span title="(clazz: java.lang.Class[_], arg1: scala.reflect.OptManifest[_], args: scala.reflect.OptManifest[_]*)scala.reflect.ClassManifest[play.api.libs.concurrent.PromiseValue[A]]" class="delimiter">(</span><a href="#169127" title="object play.api.libs.concurrent.Waiting">Waiting</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="[B](k: play.api.libs.concurrent.Promise[A] =&gt; B)play.api.libs.concurrent.Promise[B]" id="170009">extend</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="170011">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="play.api.libs.concurrent.Promise[A] =&gt; B" id="170816">k</a>: <span title="play.api.libs.concurrent.Promise[A] =&gt; B">Function1</span><span class="delimiter">[</span>Promise<span class="delimiter">[</span>A<span class="delimiter">]</span>, B<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#13155" title="play.api.libs.concurrent.Promise[B]">Promise</a><span class="delimiter">[</span>B<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="play.api.libs.concurrent.STMPromise[B]" id="170822">result</a> = <span title="play.api.libs.concurrent.STMPromise[B]" class="keyword">new</span> <a href="#13257" title="play.api.libs.concurrent.STMPromise[B]">STMPromise</a><span class="delimiter">[</span>B<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#170017" title="(k: play.api.libs.concurrent.Promise[A] =&gt; Unit)Unit">addAction</a><span class="delimiter">(</span><a title="play.api.libs.concurrent.Promise[A]" id="170826">p</a> =&gt; <a href="#170822" title="play.api.libs.concurrent.STMPromise[B]">result</a>.<a href="#170022" title="(body: =&gt; B)Unit">redeem</a><span class="delimiter">(</span><a href="#170816" title="(v1: play.api.libs.concurrent.Promise[A])B">k</a><span class="delimiter">(</span><a href="#170826" title="play.api.libs.concurrent.Promise[A]">p</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#170822" title="play.api.libs.concurrent.STMPromise[B]">result</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(p: A =&gt; Boolean)play.api.libs.concurrent.Promise[A]" id="170012">filter</a><span class="delimiter">(</span><a title="A =&gt; Boolean" id="170833">p</a>: A =&gt; Boolean<span class="delimiter">)</span>: <a href="#13155" title="play.api.libs.concurrent.Promise[A]">Promise</a><span class="delimiter">[</span>A<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="play.api.libs.concurrent.STMPromise[A]" id="170836">result</a> = <span title="play.api.libs.concurrent.STMPromise[A]" class="keyword">new</span> <a href="#13257" title="play.api.libs.concurrent.STMPromise[A]">STMPromise</a><span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#170016" title="(k: A =&gt; Unit)Unit">onRedeem</a><span class="delimiter">(</span><a title="A" id="170841">a</a> =&gt; <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#170833" title="(v1: A)Boolean">p</a><span class="delimiter">(</span><a href="#170841" title="A">a</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#170836" title="play.api.libs.concurrent.STMPromise[A]">result</a>.<a href="#170022" title="(body: =&gt; A)Unit">redeem</a><span class="delimiter">(</span><a href="#170841" title="A">a</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#170836" title="play.api.libs.concurrent.STMPromise[A]">result</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[B](p: PartialFunction[A,B])play.api.libs.concurrent.STMPromise[B]" id="170013">collect</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="170015">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="PartialFunction[A,B]" id="170844">p</a>: <span title="PartialFunction[A,B]">PartialFunction</span><span class="delimiter">[</span>A, B<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="play.api.libs.concurrent.STMPromise[B]" id="170847">result</a> = <span title="play.api.libs.concurrent.STMPromise[B]" class="keyword">new</span> <a href="#13257" title="play.api.libs.concurrent.STMPromise[B]">STMPromise</a><span class="delimiter">[</span>B<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#170016" title="(k: A =&gt; Unit)Unit">onRedeem</a><span class="delimiter">(</span><a title="A" id="170849">a</a> =&gt; <a href="#170844" title="PartialFunction[A,B]">p</a>.<span title="(v1: A)Option[B]">lift</span><span class="delimiter">(</span><a href="#170849" title="A">a</a><span class="delimiter">)</span>.<span title="(f: B =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#170847" title="play.api.libs.concurrent.STMPromise[B]">result</a>.<a href="#170022" title="(body: =&gt; B)Unit">redeem</a><span class="delimiter">(</span><a href="#170855" title="B">_</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#170847" title="play.api.libs.concurrent.STMPromise[B]">result</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(k: A =&gt; Unit)Unit" id="170016">onRedeem</a><span class="delimiter">(</span><a title="A =&gt; Unit" id="170837">k</a>: A =&gt; Unit<span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#170017" title="(k: play.api.libs.concurrent.Promise[A] =&gt; Unit)Unit">addAction</a><span class="delimiter">(</span><a title="play.api.libs.concurrent.Promise[A]" id="170861">p</a> =&gt; <a href="#170861" title="play.api.libs.concurrent.Promise[A]">p</a>.<a href="#74726" title="=&gt; play.api.libs.concurrent.NotWaiting[A]">value</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span> <span class="keyword">case</span> <span title="Unit">Redeemed</span><span class="delimiter">(</span><a title="A" id="170863">a</a><span class="delimiter">)</span> =&gt; <a href="#170837" title="(v1: A)Unit">k</a><span class="delimiter">(</span><a href="#170863" title="A">a</a><span class="delimiter">)</span>; <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(k: play.api.libs.concurrent.Promise[A] =&gt; Unit)Unit" id="170017">addAction</a><span class="delimiter">(</span><a title="play.api.libs.concurrent.Promise[A] =&gt; Unit" id="170823">k</a>: Promise<span class="delimiter">[</span>A<span class="delimiter">]</span> =&gt; Unit<span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#170007" title="=&gt; scala.concurrent.stm.Ref[play.api.libs.concurrent.PromiseValue[A]]">redeemed</a>.<span title="()play.api.libs.concurrent.PromiseValue[A]">single</span><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="#76160" title="=&gt; Boolean">isDefined</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#170823" title="(v1: play.api.libs.concurrent.Promise[A])Unit">k</a><span class="delimiter">(</span><a href="#13257" title="play.api.libs.concurrent.STMPromise[A]" class="keyword">this</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Boolean" id="170867">ok</a>: <span title="Boolean">Boolean</span> = <span title="(block: scala.concurrent.stm.InTxn =&gt; Boolean)(implicit mt: scala.concurrent.stm.MaybeTxn)Boolean">atomic</span> <span title="=&gt; scala.concurrent.stm.TxnUnknown.type" class="delimiter">{</span> <span class="keyword">implicit</span> <a title="scala.concurrent.stm.InTxn" id="170871">txn</a> =&gt;
        <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#170007" title="()(implicit txn: scala.concurrent.stm.InTxn)play.api.libs.concurrent.PromiseValue[A]">redeemed</a><a href="#170871" title="scala.concurrent.stm.InTxn" class="delimiter">(</a><span class="delimiter">)</span>.<a href="#76160" title="=&gt; Boolean">isDefined</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#170004" title="(v: List[play.api.libs.concurrent.Promise[A] =&gt; Unit])(implicit txn: scala.concurrent.stm.InTxn)Unit">actions</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="#170004" title="()(implicit txn: scala.concurrent.stm.InTxn)List[play.api.libs.concurrent.Promise[A] =&gt; Unit]">actions</a><a href="#170871" title="scala.concurrent.stm.InTxn" class="delimiter">(</a><span class="delimiter">)</span> <span title="(elem: play.api.libs.concurrent.Promise[A] =&gt; Unit)(implicit bf: scala.collection.generic.CanBuildFrom[List[play.api.libs.concurrent.Promise[A] =&gt; Unit],play.api.libs.concurrent.Promise[A] =&gt; Unit,List[play.api.libs.concurrent.Promise[A] =&gt; Unit]])List[play.api.libs.concurrent.Promise[A] =&gt; Unit]">:+</span> <a href="#170823" title="play.api.libs.concurrent.Promise[A] =&gt; Unit">k</a>; <span title="Boolean(true)" class="keyword">true</span> <span class="delimiter">}</span>
        <span class="keyword">else</span> <span title="Boolean(false)" class="keyword">false</span>
      <span class="delimiter">}</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#170867" title="Boolean">ok</a><span class="delimiter">)</span> <a href="#170019" title="(a: play.api.libs.concurrent.STMPromise[A], k: play.api.libs.concurrent.STMPromise[A] =&gt; Unit)Unit">invoke</a><span class="delimiter">(</span><a href="#13257" title="play.api.libs.concurrent.STMPromise[A]" class="keyword">this</a>, <a href="#170823" title="play.api.libs.concurrent.Promise[A] =&gt; Unit">k</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(timeout: Long, unit: java.util.concurrent.TimeUnit)play.api.libs.concurrent.NotWaiting[A]" id="170018">await</a><span class="delimiter">(</span><a title="Long" id="170940">timeout</a>: <span title="Long">Long</span>, <a title="java.util.concurrent.TimeUnit" id="170944">unit</a>: <span title="java.util.concurrent.TimeUnit">TimeUnit</span> = TimeUnit.<span title="java.util.concurrent.TimeUnit(value MILLISECONDS)">MILLISECONDS</span><span class="delimiter">)</span>: <a href="#13164" title="play.api.libs.concurrent.NotWaiting[A]">NotWaiting</a><span class="delimiter">[</span>A<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span title="(block: scala.concurrent.stm.InTxn =&gt; play.api.libs.concurrent.NotWaiting[A])(implicit mt: scala.concurrent.stm.MaybeTxn)play.api.libs.concurrent.NotWaiting[A]">atomic</span> <span title="=&gt; scala.concurrent.stm.TxnUnknown.type" class="delimiter">{</span> <span class="keyword">implicit</span> <a title="scala.concurrent.stm.InTxn" id="170948">txn</a> =&gt;
      <span title="play.api.libs.concurrent.NotWaiting[A]" class="keyword">if</span> <span class="delimiter">(</span><a href="#170007" title="()(implicit txn: scala.concurrent.stm.InTxn)play.api.libs.concurrent.PromiseValue[A]">redeemed</a><a href="#170948" title="scala.concurrent.stm.InTxn" class="delimiter">(</a><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#169127" title="object play.api.libs.concurrent.Waiting">Waiting</a><span class="delimiter">)</span> <a href="#170007" title="()(implicit txn: scala.concurrent.stm.InTxn)play.api.libs.concurrent.PromiseValue[A]">redeemed</a><a href="#170948" title="scala.concurrent.stm.InTxn" class="delimiter">(</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="play.api.libs.concurrent.NotWaiting[A]" class="delimiter">[</span><a href="#13164" title="play.api.libs.concurrent.NotWaiting[A]">NotWaiting</a><span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">]</span>
      <span class="keyword">else</span> <span class="delimiter">{</span>
        <span title="(timeout: Long, unit: scala.actors.threadpool.TimeUnit)(implicit txn: scala.concurrent.stm.InTxn)Unit">retryFor</span><a href="#170948" title="scala.concurrent.stm.InTxn" class="delimiter">(</a><a href="#170944" title="java.util.concurrent.TimeUnit">unit</a>.<span title="(x$1: Long)Long">toNanos</span><span class="delimiter">(</span><a href="#170940" title="Long">timeout</a><span class="delimiter">)</span>, scala.actors.threadpool.<span title="object scala.actors.threadpool.TimeUnit">TimeUnit</span>.<span title="scala.actors.threadpool.TimeUnit">NANOSECONDS</span><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.util.concurrent.TimeoutException" class="keyword">new</span> java.util.concurrent.<span title="java.util.concurrent.TimeoutException">TimeoutException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Promise timed out after &quot;)" class="string">&quot;Promise timed out after &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#170940" title="Long">timeout</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; : &quot;)" class="string">&quot; : &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#170944" title="java.util.concurrent.TimeUnit">unit</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="[T](a: T, k: T =&gt; Unit)Unit" id="170019">invoke</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="170021">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="T" id="170930">a</a>: <a href="#170021" title="T">T</a>, <a title="T =&gt; Unit" id="170931">k</a>: T =&gt; Unit<span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#13258" title="object play.api.libs.concurrent.STMPromise">STMPromise</a>.<a href="#169995" title="akka.actor.ScalaActorRef" id="171666">invoker</a> <a href="#171666" title="akka.actor.ActorRef" id="171668">!</a> <a href="#13258" title="object play.api.libs.concurrent.STMPromise">STMPromise</a>.<a href="#170714" title="(a: T, k: T =&gt; Unit)play.api.libs.concurrent.STMPromise.Invoke[T]">Invoke</a><a title="play.api.libs.concurrent.STMPromise.Invoke[T]" id="171667" class="delimiter">(</a><a href="#170930" title="T">a</a>, <a href="#170931" title="T =&gt; Unit">k</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(body: =&gt; A)Unit" id="170022">redeem</a><span class="delimiter">(</span><a title="=&gt; A" id="170827">body</a>: =&gt; A<span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Either[Throwable,A]" id="171669">result</a> = scala.util.control.<span title="object scala.util.control.Exception">Exception</span>.<span title="[T]=&gt; util.control.Exception.Catch[T]">allCatch</span><span title="util.control.Exception.Catch[A]" class="delimiter">[</span><a href="#13398" title="A">A</a><span class="delimiter">]</span>.<span title="(body: =&gt; A)Either[Throwable,A]">either</span><span class="delimiter">(</span><a href="#170827" title="=&gt; A">body</a><span class="delimiter">)</span>
    <span title="(block: scala.concurrent.stm.InTxn =&gt; Unit)(implicit mt: scala.concurrent.stm.MaybeTxn)Unit">atomic</span> <span title="=&gt; scala.concurrent.stm.TxnUnknown.type" class="delimiter">{</span> <span class="keyword">implicit</span> <a title="scala.concurrent.stm.InTxn" id="171678">txn</a> =&gt;
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#170007" title="()(implicit txn: scala.concurrent.stm.InTxn)play.api.libs.concurrent.PromiseValue[A]">redeemed</a><a href="#171678" title="scala.concurrent.stm.InTxn" class="delimiter">(</a><span class="delimiter">)</span>.<a href="#76160" title="=&gt; Boolean">isDefined</a><span class="delimiter">)</span> sys.<span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="java.lang.String(&quot;already redeemed&quot;)" class="string">&quot;already redeemed&quot;</span><span class="delimiter">)</span>
      <a href="#170007" title="(v: play.api.libs.concurrent.PromiseValue[A])(implicit txn: scala.concurrent.stm.InTxn)Unit">redeemed</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="#171669" title="Either[Throwable,A]">result</a>.<span title="(fa: Throwable =&gt; Product with play.api.libs.concurrent.NotWaiting[A] with Serializable, fb: A =&gt; Product with play.api.libs.concurrent.NotWaiting[A] with Serializable)Product with play.api.libs.concurrent.NotWaiting[A] with Serializable">fold</span><span class="delimiter">(</span><a href="#172243" title="(e: Throwable)play.api.libs.concurrent.Thrown">Thrown</a><span class="delimiter">(</span><a href="#171687" title="Throwable">_</a><span class="delimiter">)</span>, <a href="#172239" title="(a: A)play.api.libs.concurrent.Redeemed[A]">Redeemed</a><span class="delimiter">(</span><a href="#171690" title="A">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#170004" title="=&gt; scala.concurrent.stm.Ref[List[play.api.libs.concurrent.Promise[A] =&gt; Unit]]">actions</a>.<span title="=&gt; scala.concurrent.stm.Ref.View[List[play.api.libs.concurrent.Promise[A] =&gt; Unit]]">single</span>.<span title="(v: List[play.api.libs.concurrent.Promise[A] =&gt; Unit])List[play.api.libs.concurrent.Promise[A] =&gt; Unit]">swap</span><span class="delimiter">(</span>List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: play.api.libs.concurrent.Promise[A] =&gt; Unit =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#170019" title="(a: play.api.libs.concurrent.STMPromise[A], k: play.api.libs.concurrent.STMPromise[A] =&gt; Unit)Unit">invoke</a><span class="delimiter">(</span><a href="#13257" title="play.api.libs.concurrent.STMPromise[A]" class="keyword">this</a>, <a href="#171738" title="play.api.libs.concurrent.Promise[A] =&gt; Unit">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(t: Throwable)Unit" id="170023">throwing</a><span class="delimiter">(</span><a title="Throwable" id="171745">t</a>: <span title="Throwable">Throwable</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span title="(block: scala.concurrent.stm.InTxn =&gt; Unit)(implicit mt: scala.concurrent.stm.MaybeTxn)Unit">atomic</span> <span title="=&gt; scala.concurrent.stm.TxnUnknown.type" class="delimiter">{</span> <span class="keyword">implicit</span> <a title="scala.concurrent.stm.InTxn" id="171750">txn</a> =&gt;
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#170007" title="()(implicit txn: scala.concurrent.stm.InTxn)play.api.libs.concurrent.PromiseValue[A]">redeemed</a><a href="#171750" title="scala.concurrent.stm.InTxn" class="delimiter">(</a><span class="delimiter">)</span>.<a href="#76160" title="=&gt; Boolean">isDefined</a><span class="delimiter">)</span> sys.<span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="java.lang.String(&quot;already redeemed&quot;)" class="string">&quot;already redeemed&quot;</span><span class="delimiter">)</span>
      <a href="#170007" title="(v: play.api.libs.concurrent.PromiseValue[A])(implicit txn: scala.concurrent.stm.InTxn)Unit">redeemed</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="#172243" title="(e: Throwable)play.api.libs.concurrent.Thrown">Thrown</a><span class="delimiter">(</span><a href="#171745" title="Throwable">t</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#170004" title="=&gt; scala.concurrent.stm.Ref[List[play.api.libs.concurrent.Promise[A] =&gt; Unit]]">actions</a>.<span title="=&gt; scala.concurrent.stm.Ref.View[List[play.api.libs.concurrent.Promise[A] =&gt; Unit]]">single</span>.<span title="(v: List[play.api.libs.concurrent.Promise[A] =&gt; Unit])List[play.api.libs.concurrent.Promise[A] =&gt; Unit]">swap</span><span class="delimiter">(</span>List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: play.api.libs.concurrent.Promise[A] =&gt; Unit =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a href="#170019" title="(a: play.api.libs.concurrent.STMPromise[A], k: play.api.libs.concurrent.STMPromise[A] =&gt; Unit)Unit">invoke</a><span class="delimiter">(</span><a href="#13257" title="play.api.libs.concurrent.STMPromise[A]" class="keyword">this</a>, <a href="#171780" title="play.api.libs.concurrent.Promise[A] =&gt; Unit">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[B](f: A =&gt; B)play.api.libs.concurrent.Promise[B]" id="170024">map</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="170026">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="A =&gt; B" id="171787">f</a>: A =&gt; B<span class="delimiter">)</span>: <a href="#13155" title="play.api.libs.concurrent.Promise[B]">Promise</a><span class="delimiter">[</span>B<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="play.api.libs.concurrent.STMPromise[B]" id="171793">result</a> = <span title="play.api.libs.concurrent.STMPromise[B]" class="keyword">new</span> <a href="#13257" title="play.api.libs.concurrent.STMPromise[B]">STMPromise</a><span class="delimiter">[</span>B<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#13257" title="STMPromise.this.type" class="keyword">this</a>.<a href="#170017" title="(k: play.api.libs.concurrent.Promise[A] =&gt; Unit)Unit">addAction</a><span class="delimiter">(</span><a title="play.api.libs.concurrent.Promise[A]" id="171795">p</a> =&gt; <a href="#171795" title="play.api.libs.concurrent.Promise[A]">p</a>.<a href="#74726" title="=&gt; play.api.libs.concurrent.NotWaiting[A]">value</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Unit">Redeemed</span><span class="delimiter">(</span><a title="A" id="171797">a</a><span class="delimiter">)</span> =&gt; <a href="#171793" title="play.api.libs.concurrent.STMPromise[B]">result</a>.<a href="#170022" title="(body: =&gt; B)Unit">redeem</a><span class="delimiter">(</span><a href="#171787" title="(v1: A)B">f</a><span class="delimiter">(</span><a href="#171797" title="A">a</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">Thrown</span><span class="delimiter">(</span><a title="Throwable" id="171801">e</a><span class="delimiter">)</span> =&gt; <a href="#171793" title="play.api.libs.concurrent.STMPromise[B]">result</a>.<a href="#170022" title="(body: =&gt; B)Unit">redeem</a><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <a href="#171801" title="Throwable">e</a><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
    <a href="#171793" title="play.api.libs.concurrent.STMPromise[B]">result</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[B](f: A =&gt; play.api.libs.concurrent.Promise[B])play.api.libs.concurrent.STMPromise[B]" id="170027">flatMap</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="170029">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="A =&gt; play.api.libs.concurrent.Promise[B]" id="171802">f</a>: A =&gt; Promise<span class="delimiter">[</span>B<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="play.api.libs.concurrent.STMPromise[B]" id="171811">result</a> = <span title="play.api.libs.concurrent.STMPromise[B]" class="keyword">new</span> <a href="#13257" title="play.api.libs.concurrent.STMPromise[B]">STMPromise</a><span class="delimiter">[</span>B<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#13257" title="STMPromise.this.type" class="keyword">this</a>.<a href="#170017" title="(k: play.api.libs.concurrent.Promise[A] =&gt; Unit)Unit">addAction</a><span class="delimiter">(</span><a title="play.api.libs.concurrent.Promise[A]" id="171813">p</a> =&gt; <a href="#171813" title="play.api.libs.concurrent.Promise[A]">p</a>.<a href="#74726" title="=&gt; play.api.libs.concurrent.NotWaiting[A]">value</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Unit">Redeemed</span><span class="delimiter">(</span><a title="A" id="171815">a</a><span class="delimiter">)</span> =&gt;
       <span class="delimiter">(</span><span class="keyword">try</span><span class="delimiter">{</span> <a href="#171802" title="(v1: A)play.api.libs.concurrent.Promise[B]">f</a><span class="delimiter">(</span><a href="#171815" title="A">a</a><span class="delimiter">)</span><span class="delimiter">}</span><span class="keyword">catch</span><span class="delimiter">{</span><span class="keyword">case</span> <a title="Nothing" id="171817">e</a> =&gt; <span class="delimiter">{</span><span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;wow! &quot;)" class="string">&quot;wow! &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#171817" title="java.lang.Throwable">e</a><span class="delimiter">)</span>; <span title="Nothing" class="keyword">throw</span> <a href="#171817" title="java.lang.Throwable">e</a><span class="delimiter">}</span><span class="delimiter">}</span><span class="delimiter">)</span>.<a href="#74720" title="(k: play.api.libs.concurrent.Promise[B] =&gt; Unit)play.api.libs.concurrent.Promise[Unit]">extend</a><span title="Unit" class="delimiter">(</span><a title="play.api.libs.concurrent.Promise[B]" id="171824">ip</a> =&gt; <a href="#171824" title="play.api.libs.concurrent.Promise[B]">ip</a>.<a href="#74726" title="=&gt; play.api.libs.concurrent.NotWaiting[B]">value</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Unit">Redeemed</span><span class="delimiter">(</span><a title="B" id="171826">a</a><span class="delimiter">)</span> =&gt; <a href="#171811" title="play.api.libs.concurrent.STMPromise[B]">result</a>.<a href="#170022" title="(body: =&gt; B)Unit">redeem</a><span class="delimiter">(</span><a href="#171826" title="B">a</a><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Unit">Thrown</span><span class="delimiter">(</span><a title="Throwable" id="171829">e</a><span class="delimiter">)</span> =&gt; <a href="#171811" title="play.api.libs.concurrent.STMPromise[B]">result</a>.<a href="#170022" title="(body: =&gt; B)Unit">redeem</a><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <a href="#171829" title="Throwable">e</a><span class="delimiter">)</span>

        <span class="delimiter">}</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">Thrown</span><span class="delimiter">(</span><a title="Throwable" id="171831">e</a><span class="delimiter">)</span> =&gt; <a href="#171811" title="play.api.libs.concurrent.STMPromise[B]">result</a>.<a href="#170022" title="(body: =&gt; B)Unit">redeem</a><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <a href="#171831" title="Throwable">e</a><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
    <a href="#171811" title="play.api.libs.concurrent.STMPromise[B]">result</a>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object play.api.libs.concurrent.PurePromise" id="13366">PurePromise</a> <span title="ScalaObject" class="delimiter">{</span>

  <span class="keyword">def</span> <a title="[A](lazyA: =&gt; A)play.api.libs.concurrent.Promise[A]" id="171836">apply</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="171838">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="=&gt; A" id="171840">lazyA</a>: =&gt; A<span class="delimiter">)</span>: <a href="#13155" title="play.api.libs.concurrent.Promise[A]">Promise</a><span class="delimiter">[</span>A<span class="delimiter">]</span> = <a href="#171843" title="java.lang.Object with play.api.libs.concurrent.Promise[A]{}" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with play.api.libs.concurrent.Promise[A]" id="171843">Promise</a><span class="delimiter">[</span>A<span class="delimiter">]</span> <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="play.api.libs.concurrent.NotWaiting[A]" id="171847">a</a> : <a href="#13164" title="play.api.libs.concurrent.NotWaiting[A]">NotWaiting</a><span class="delimiter">[</span>A<span class="delimiter">]</span> = scala.util.control.<span title="object scala.util.control.Exception">Exception</span>.<span title="[T]=&gt; util.control.Exception.Catch[T]">allCatch</span><span title="util.control.Exception.Catch[A]" class="delimiter">[</span><a href="#171838" title="A">A</a><span class="delimiter">]</span>.<span title="(body: =&gt; A)Either[Throwable,A]">either</span><span class="delimiter">(</span><a href="#171840" title="=&gt; A">lazyA</a><span class="delimiter">)</span>.<span title="(fa: Throwable =&gt; Product with play.api.libs.concurrent.NotWaiting[A] with Serializable, fb: A =&gt; Product with play.api.libs.concurrent.NotWaiting[A] with Serializable)Product with play.api.libs.concurrent.NotWaiting[A] with Serializable">fold</span><span class="delimiter">(</span><a href="#172243" title="(e: Throwable)play.api.libs.concurrent.Thrown">Thrown</a><span class="delimiter">(</span><a href="#171927" title="Throwable">_</a><span class="delimiter">)</span>,<a href="#172239" title="(a: A)play.api.libs.concurrent.Redeemed[A]">Redeemed</a><span class="delimiter">(</span><a href="#171930" title="A">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="[A]=&gt; play.api.libs.concurrent.Promise[A]" id="171849">neverRedeemed</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="171851">A</a><span class="delimiter">]</span>: <a href="#13155" title="play.api.libs.concurrent.Promise[A]">Promise</a><span class="delimiter">[</span>A<span class="delimiter">]</span> = <a href="#171948" title="java.lang.Object with play.api.libs.concurrent.Promise[A]" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with play.api.libs.concurrent.Promise[A]" id="171948">Promise</a><span class="delimiter">[</span>A<span class="delimiter">]</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(k: A =&gt; Unit)Unit" id="171952">onRedeem</a><span class="delimiter">(</span><a title="A =&gt; Unit" id="171964">k</a>: A =&gt; Unit<span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>

      <span class="keyword">def</span> <a title="[B](k: play.api.libs.concurrent.Promise[A] =&gt; B)play.api.libs.concurrent.Promise[B]" id="171953">extend</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="171955">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="play.api.libs.concurrent.Promise[A] =&gt; B" id="171967">k</a>: <span title="play.api.libs.concurrent.Promise[A] =&gt; B">Function1</span><span class="delimiter">[</span>Promise<span class="delimiter">[</span>A<span class="delimiter">]</span>, B<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#13155" title="play.api.libs.concurrent.Promise[B]">Promise</a><span class="delimiter">[</span>B<span class="delimiter">]</span> = <a href="#171849" title="[A]=&gt; play.api.libs.concurrent.Promise[A]">neverRedeemed</a><span title="play.api.libs.concurrent.Promise[B]" class="delimiter">[</span><a href="#171955" title="B">B</a><span class="delimiter">]</span>

      <span class="keyword">def</span> <a title="(timeout: Long, unit: java.util.concurrent.TimeUnit)play.api.libs.concurrent.NotWaiting[A]" id="171956">await</a><span class="delimiter">(</span><a title="Long" id="171975">timeout</a>: <span title="Long">Long</span>, <a title="java.util.concurrent.TimeUnit" id="171979">unit</a>: <span title="java.util.concurrent.TimeUnit">TimeUnit</span> = TimeUnit.<span title="java.util.concurrent.TimeUnit(value MILLISECONDS)">MILLISECONDS</span><span class="delimiter">)</span>: <a href="#13164" title="play.api.libs.concurrent.NotWaiting[A]">NotWaiting</a><span class="delimiter">[</span>A<span class="delimiter">]</span> = <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.util.concurrent.TimeoutException" class="keyword">new</span> java.util.concurrent.<span title="java.util.concurrent.TimeoutException">TimeoutException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;will never get redeemed&quot;)" class="string">&quot;will never get redeemed&quot;</span><span class="delimiter">)</span>

      <span class="keyword">def</span> <a title="(p: A =&gt; Boolean)play.api.libs.concurrent.Promise[A]" id="171957">filter</a><span class="delimiter">(</span><a title="A =&gt; Boolean" id="171980">p</a>: A =&gt; Boolean<span class="delimiter">)</span>: <a href="#13155" title="play.api.libs.concurrent.Promise[A]">Promise</a><span class="delimiter">[</span>A<span class="delimiter">]</span> = <a href="#171948" title="java.lang.Object with play.api.libs.concurrent.Promise[A]" class="keyword">this</a>

      <span class="keyword">def</span> <a title="[B](f: A =&gt; B)play.api.libs.concurrent.Promise[B]" id="171958">map</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="171960">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="A =&gt; B" id="171983">f</a>: A =&gt; B<span class="delimiter">)</span>: <a href="#13155" title="play.api.libs.concurrent.Promise[B]">Promise</a><span class="delimiter">[</span>B<span class="delimiter">]</span> = <a href="#171849" title="[A]=&gt; play.api.libs.concurrent.Promise[A]">neverRedeemed</a><span title="play.api.libs.concurrent.Promise[B]" class="delimiter">[</span><a href="#171960" title="B">B</a><span class="delimiter">]</span>

      <span class="keyword">def</span> <a title="[B](f: A =&gt; play.api.libs.concurrent.Promise[B])play.api.libs.concurrent.Promise[B]" id="171961">flatMap</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="171963">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="A =&gt; play.api.libs.concurrent.Promise[B]" id="171990">f</a>: A =&gt; Promise<span class="delimiter">[</span>B<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#13155" title="play.api.libs.concurrent.Promise[B]">Promise</a><span class="delimiter">[</span>B<span class="delimiter">]</span> = <a href="#171849" title="[A]=&gt; play.api.libs.concurrent.Promise[A]">neverRedeemed</a><span title="play.api.libs.concurrent.Promise[B]" class="delimiter">[</span><a href="#171963" title="B">B</a><span class="delimiter">]</span>

    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(k: A =&gt; Unit)Unit" id="171852">onRedeem</a><span class="delimiter">(</span><a title="A =&gt; Unit" id="171866">k</a>: A =&gt; Unit<span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#171847" title="=&gt; play.api.libs.concurrent.NotWaiting[A]">a</a>.<a href="#76163" title="(onError: Throwable =&gt; Unit, onSuccess: A =&gt; Unit)Unit">fold</a><span class="delimiter">(</span><a title="Throwable" id="172039">_</a> =&gt; <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>, <a href="#171866" title="A =&gt; Unit">k</a><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="(timeout: Long, unit: java.util.concurrent.TimeUnit)play.api.libs.concurrent.NotWaiting[A]" id="171853">await</a><span class="delimiter">(</span><a title="Long" id="171870">timeout</a>: <span title="Long">Long</span>, <a title="java.util.concurrent.TimeUnit" id="171874">unit</a>: <span title="java.util.concurrent.TimeUnit">TimeUnit</span> = TimeUnit.<span title="java.util.concurrent.TimeUnit(value MILLISECONDS)">MILLISECONDS</span><span class="delimiter">)</span>: <a href="#13164" title="play.api.libs.concurrent.NotWaiting[A]">NotWaiting</a><span class="delimiter">[</span>A<span class="delimiter">]</span> = <a href="#171847" title="=&gt; play.api.libs.concurrent.NotWaiting[A]">a</a>

    <span class="keyword">def</span> <a title="(a: A)Nothing" id="171854">redeem</a><span class="delimiter">(</span><a title="A" id="172044">a</a>: <a href="#171838" title="A">A</a><span class="delimiter">)</span> = sys.<span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Already redeemed&quot;)" class="string">&quot;Already redeemed&quot;</span><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="(t: Throwable)Nothing" id="171855">throwing</a><span class="delimiter">(</span><a title="Throwable" id="172047">t</a>: <span title="Throwable">Throwable</span><span class="delimiter">)</span> = sys.<span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Already redeemed&quot;)" class="string">&quot;Already redeemed&quot;</span><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="[B](f: play.api.libs.concurrent.Promise[A] =&gt; B)play.api.libs.concurrent.Promise[B]" id="171856">extend</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="171858">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="play.api.libs.concurrent.Promise[A] =&gt; B" id="171875">f</a>: <span class="delimiter">(</span>Promise<span class="delimiter">[</span>A<span class="delimiter">]</span> =&gt; B<span class="delimiter">)</span><span class="delimiter">)</span>: <a href="#13155" title="play.api.libs.concurrent.Promise[B]">Promise</a><span class="delimiter">[</span>B<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <a href="#171836" title="(lazyA: =&gt; B)play.api.libs.concurrent.Promise[B]">apply</a><span class="delimiter">(</span><a href="#171875" title="(v1: play.api.libs.concurrent.Promise[A])B">f</a><span class="delimiter">(</span><a href="#171843" title="java.lang.Object with play.api.libs.concurrent.Promise[A]{}" class="keyword">this</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(p: A =&gt; Boolean)play.api.libs.concurrent.Promise[A]" id="171859">filter</a><span class="delimiter">(</span><a title="A =&gt; Boolean" id="171882">p</a>: A =&gt; Boolean<span class="delimiter">)</span> = <a href="#171847" title="=&gt; play.api.libs.concurrent.NotWaiting[A]">a</a>.<a href="#76163" title="(onError: Throwable =&gt; play.api.libs.concurrent.Promise[A], onSuccess: A =&gt; play.api.libs.concurrent.Promise[A])play.api.libs.concurrent.Promise[A]">fold</a><span class="delimiter">(</span><a title="Throwable" id="171892">_</a> =&gt; <a href="#171843" title="java.lang.Object with play.api.libs.concurrent.Promise[A]{}" class="keyword">this</a>, <a title="A" id="171894">a</a> =&gt; <span title="play.api.libs.concurrent.Promise[A]" class="keyword">if</span> <span class="delimiter">(</span><a href="#171882" title="(v1: A)Boolean">p</a><span class="delimiter">(</span><a href="#171894" title="A">a</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#171843" title="java.lang.Object with play.api.libs.concurrent.Promise[A]{}" class="keyword">this</a> <span class="keyword">else</span> <a href="#171849" title="[A]=&gt; play.api.libs.concurrent.Promise[A]">neverRedeemed</a><span title="play.api.libs.concurrent.Promise[A]" class="delimiter">[</span><a href="#171838" title="A">A</a><span class="delimiter">]</span><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="[B](f: A =&gt; B)play.api.libs.concurrent.Promise[B]" id="171860">map</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="171862">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="A =&gt; B" id="171900">f</a>: A =&gt; B<span class="delimiter">)</span>: <a href="#13155" title="play.api.libs.concurrent.Promise[B]">Promise</a><span class="delimiter">[</span>B<span class="delimiter">]</span> = <a href="#171847" title="=&gt; play.api.libs.concurrent.NotWaiting[A]">a</a>.<a href="#76163" title="(onError: Throwable =&gt; play.api.libs.concurrent.Promise[B], onSuccess: A =&gt; play.api.libs.concurrent.Promise[B])play.api.libs.concurrent.Promise[B]">fold</a><span class="delimiter">(</span><a title="Throwable" id="172061">e</a> =&gt;  <a href="#171836" title="[A](lazyA: =&gt; A)play.api.libs.concurrent.Promise[A]">PurePromise</a><span title="(lazyA: =&gt; B)play.api.libs.concurrent.Promise[B]" class="delimiter">[</span><a href="#171862" title="B">B</a><span class="delimiter">]</span><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <a href="#172061" title="Throwable">e</a><span class="delimiter">)</span>, <a title="A" id="172064">a</a> =&gt; <a href="#171836" title="[A](lazyA: =&gt; A)play.api.libs.concurrent.Promise[A]">PurePromise</a><span title="(lazyA: =&gt; B)play.api.libs.concurrent.Promise[B]" class="delimiter">[</span><a href="#171862" title="B">B</a><span class="delimiter">]</span><span class="delimiter">(</span> <a href="#171900" title="(v1: A)B">f</a><span class="delimiter">(</span><a href="#172064" title="A">a</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="[B](f: A =&gt; play.api.libs.concurrent.Promise[B])play.api.libs.concurrent.Promise[B]" id="171863">flatMap</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="171865">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="A =&gt; play.api.libs.concurrent.Promise[B]" id="171907">f</a>: A =&gt; Promise<span class="delimiter">[</span>B<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#13155" title="play.api.libs.concurrent.Promise[B]">Promise</a><span class="delimiter">[</span>B<span class="delimiter">]</span> = <a href="#171847" title="=&gt; play.api.libs.concurrent.NotWaiting[A]">a</a>.<a href="#76163" title="(onError: Throwable =&gt; play.api.libs.concurrent.Promise[B], onSuccess: A =&gt; play.api.libs.concurrent.Promise[B])play.api.libs.concurrent.Promise[B]">fold</a><span class="delimiter">(</span> <a title="Throwable" id="172075">e</a> =&gt; <a href="#171836" title="(lazyA: =&gt; Nothing)play.api.libs.concurrent.Promise[Nothing]">PurePromise</a><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <a href="#172075" title="Throwable">e</a><span class="delimiter">)</span>, <a title="A" id="172080">a</a> =&gt; <span class="keyword">try</span> <span class="delimiter">{</span> <a href="#171907" title="(v1: A)play.api.libs.concurrent.Promise[B]">f</a><span class="delimiter">(</span><a href="#172080" title="A">a</a><span class="delimiter">)</span> <span class="delimiter">}</span> <span class="keyword">catch</span><span class="delimiter">{</span><span class="keyword">case</span> <a title="play.api.libs.concurrent.Promise[Nothing]" id="172082">e</a> =&gt; <a href="#171836" title="(lazyA: =&gt; Nothing)play.api.libs.concurrent.Promise[Nothing]">PurePromise</a><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <a href="#172082" title="java.lang.Throwable">e</a><span class="delimiter">)</span><span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object play.api.libs.concurrent.Promise" id="13156">Promise</a> <span title="ScalaObject" class="delimiter">{</span>

  <span class="keyword">def</span> <a title="[A](a: A)play.api.libs.concurrent.Promise[A]" id="77326">pure</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="77328">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="A" id="99558">a</a>: <a href="#77328" title="A">A</a><span class="delimiter">)</span>: <a href="#13155" title="play.api.libs.concurrent.Promise[A]">Promise</a><span class="delimiter">[</span>A<span class="delimiter">]</span> = <a href="#171836" title="(lazyA: =&gt; A)play.api.libs.concurrent.Promise[A]">PurePromise</a><span class="delimiter">(</span><a href="#99558" title="A">a</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="[A]()play.api.libs.concurrent.Promise[A] with play.api.libs.concurrent.Redeemable[A]" id="77329">apply</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="77331">A</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="#99531" title="Promise extends play.api.libs.concurrent.Promise[A] with play.api.libs.concurrent.Redeemable[A]">Promise</a><span class="delimiter">[</span>A<span class="delimiter">]</span> <span class="keyword">with</span> Redeemable<span class="delimiter">[</span>A<span class="delimiter">]</span> = <span title="play.api.libs.concurrent.STMPromise[A]" class="keyword">new</span> <a href="#13257" title="play.api.libs.concurrent.STMPromise[A]">STMPromise</a><span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="[A](message: A, duration: akka.util.Duration)play.api.libs.concurrent.Promise[A]" id="77332">timeout</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="77334">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="A" id="169975">message</a>: <a href="#77334" title="A">A</a>, <a title="akka.util.Duration" id="169976">duration</a>: akka.util.<span title="akka.util.Duration">Duration</span><span class="delimiter">)</span>: <a href="#13155" title="play.api.libs.concurrent.Promise[A]">Promise</a><span class="delimiter">[</span>A<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#77335" title="(message: =&gt; A, duration: Long, unit: java.util.concurrent.TimeUnit)play.api.libs.concurrent.Promise[A]">timeout</a><span class="delimiter">(</span><a href="#169975" title="A">message</a>, <a href="#169976" title="akka.util.Duration">duration</a>.<span title="=&gt; Long">toMillis</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[A](message: =&gt; A, duration: Long, unit: java.util.concurrent.TimeUnit)play.api.libs.concurrent.Promise[A]" id="77335">timeout</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="169967">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="=&gt; A" id="169961">message</a>: =&gt; A, <a title="Long" id="169962">duration</a>: <span title="Long">Long</span>, <a title="java.util.concurrent.TimeUnit" id="169965">unit</a>: <span title="java.util.concurrent.TimeUnit">TimeUnit</span> = TimeUnit.<span title="java.util.concurrent.TimeUnit(value MILLISECONDS)">MILLISECONDS</span><span class="delimiter">)</span>: <a href="#13155" title="play.api.libs.concurrent.Promise[A]">Promise</a><span class="delimiter">[</span>A<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Promise extends play.api.libs.concurrent.Promise[A] with play.api.libs.concurrent.Redeemable[A]" id="172126">p</a> = <a href="#77329" title="[A]()play.api.libs.concurrent.Promise[A] with play.api.libs.concurrent.Redeemable[A]">Promise</a><span title="()play.api.libs.concurrent.Promise[A] with play.api.libs.concurrent.Redeemable[A]" class="delimiter">[</span><a href="#169967" title="A">A</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    play.core.<a href="../../../core/system/Invoker.scala.html#17469" title="object play.core.Invoker">Invoker</a>.<a href="../../../core/system/Invoker.scala.html#170043" title="=&gt; akka.actor.ActorSystem">system</a>.<span title="=&gt; akka.actor.Scheduler">scheduler</span>.<span title="(delay: akka.util.Duration)(f: =&gt; Unit)akka.actor.Cancellable">scheduleOnce</span><span class="delimiter">(</span>akka.util.<span title="(length: Long, unit: java.util.concurrent.TimeUnit)akka.util.FiniteDuration">Duration</span><span class="delimiter">(</span><a href="#169962" title="Long">duration</a>, <a href="#169965" title="java.util.concurrent.TimeUnit">unit</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#172126" title="Promise extends play.api.libs.concurrent.Promise[A] with play.api.libs.concurrent.Redeemable[A]">p</a>.<a href="#99535" title="(a: =&gt; A)Unit">redeem</a><span class="delimiter">(</span><a href="#169961" title="=&gt; A">message</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#172126" title="Promise extends play.api.libs.concurrent.Promise[A] with play.api.libs.concurrent.Redeemable[A]">p</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[A](promises: Seq[play.api.libs.concurrent.Promise[A]])play.api.libs.concurrent.Promise[Seq[A]]" id="77338">sequence</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="77340">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="Seq[play.api.libs.concurrent.Promise[A]]" id="172162">promises</a>: <span title="Seq[play.api.libs.concurrent.Promise[A]]">Seq</span><span class="delimiter">[</span>Promise<span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#13155" title="play.api.libs.concurrent.Promise[Seq[A]]">Promise</a><span class="delimiter">[</span>Seq<span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#172162" title="Seq[play.api.libs.concurrent.Promise[A]]">promises</a>.<span title="(z: play.api.libs.concurrent.Promise[Seq[A]])(op: (play.api.libs.concurrent.Promise[Seq[A]], play.api.libs.concurrent.Promise[A]) =&gt; play.api.libs.concurrent.Promise[Seq[A]])play.api.libs.concurrent.Promise[Seq[A]]">foldLeft</span><span class="delimiter">(</span><a href="#13156" title="object play.api.libs.concurrent.Promise">Promise</a>.<a href="#77326" title="(a: Seq[A])play.api.libs.concurrent.Promise[Seq[A]]">pure</a><span class="delimiter">(</span><span title="[A](elems: A*)Seq[A]">Seq</span><span title="(elems: A*)Seq[A]" class="delimiter">[</span><a href="#77340" title="A">A</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="play.api.libs.concurrent.Promise[Seq[A]]" id="172183">s</a>, <a title="play.api.libs.concurrent.Promise[A]" id="172184">p</a><span class="delimiter">)</span> =&gt; <a href="#172183" title="play.api.libs.concurrent.Promise[Seq[A]]">s</a>.<a href="#74733" title="(f: Seq[A] =&gt; play.api.libs.concurrent.Promise[Seq[A]])play.api.libs.concurrent.Promise[Seq[A]]">flatMap</a><span class="delimiter">(</span><a title="Seq[A]" id="172189">s</a> =&gt; <a href="#172184" title="play.api.libs.concurrent.Promise[A]">p</a>.<a href="#74730" title="(f: A =&gt; Seq[A])play.api.libs.concurrent.Promise[Seq[A]]">map</a><span class="delimiter">(</span><a title="A" id="172194">a</a> =&gt; <a href="#172189" title="Seq[A]">s</a> <span title="(elem: A)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[A],A,Seq[A]])Seq[A]">:+</span> <a href="#172194" title="A">a</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>


        </pre>
    </body>
</html>
<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>play/play/api/libs/openid/OpenID.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> play.api.libs.openid

<span class="keyword">import</span> play.api.libs.concurrent.Promise
<span class="keyword">import</span> play.api.libs.ws.WS
<span class="keyword">import</span> scala.util.matching.Regex
<span class="keyword">import</span> play.api.http.HeaderNames
<span class="keyword">import</span> scala.xml.Elem
<span class="keyword">import</span> java.net.URLEncoder
<span class="keyword">import</span> play.api.libs.concurrent.PurePromise
<span class="keyword">import</span> play.api.data.Form
<span class="keyword">import</span> play.api.data.<a href="../../data/Forms.scala.html#11859" title="object play.api.data.Forms">Forms</a>.<span class="delimiter">{</span> of, text, optional <span class="delimiter">}</span>
<span class="keyword">import</span> play.api.mvc.Request

case <span class="keyword">class</span> <a title="class OpenIDServer extends java.lang.Object with ScalaObject with Product with Serializable" id="209282">OpenIDServer</a><a href="#209282" title="ScalaObject" class="delimiter">(</a><a title="String" id="209228">url</a>: <span title="String">String</span>, <a title="Option[String]" id="209229">delegate</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>

case <span class="keyword">class</span> <a title="class UserInfo extends java.lang.Object with ScalaObject with Product with Serializable" id="206648">UserInfo</a><a href="#206648" title="ScalaObject" class="delimiter">(</a><a title="String" id="206883">id</a>: <span title="String">String</span>, <a title="Map[String,String]" id="206884">attributes</a>: <span title="Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="scala.collection.immutable.Map[String,Nothing]">empty</span><span class="delimiter">)</span>

<span class="comment">/**
 * provides user information for a verified user
 */</span>
<span class="keyword">object</span> <a title="object play.api.libs.openid.UserInfo" id="206899">UserInfo</a> <span title="ScalaObject" class="delimiter">{</span>

  <span class="keyword">def</span> <a title="(queryString: Map[String,Seq[String]])play.api.libs.openid.UserInfo" id="206647">apply</a><span class="delimiter">(</span><a title="Map[String,Seq[String]]" id="206713">queryString</a>: <span title="Map[String,Seq[String]]">Map</span><span class="delimiter">[</span>String, Seq<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#206648" title="play.api.libs.openid.UserInfo">UserInfo</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="206715">axAttribute</a> = <span title="scala.util.matching.Regex" class="keyword">new</span> <span title="scala.util.matching.Regex">Regex</span><span class="delimiter">(</span><span title="java.lang.String(&quot;^openid[.].+[.]value[.]([^.]+)([.]\\d+)?$&quot;)" class="string">&quot;^openid[.].+[.]value[.]([^.]+)([.]\\d+)?$&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="String" id="206716">id</a> = <a href="#206713" title="Map[String,Seq[String]]">queryString</a>.<span title="(key: String)Option[Seq[String]]">get</span><span class="delimiter">(</span><span title="java.lang.String(&quot;openid.claimedId&quot;)" class="string">&quot;openid.claimedId&quot;</span><span class="delimiter">)</span>.<span title="(f: Seq[String] =&gt; Option[String])Option[String]">flatMap</span><span class="delimiter">(</span><a href="#206724" title="Seq[String]">_</a>.<span title="=&gt; Option[String]">headOption</span><span class="delimiter">)</span>
      .<span title="(alternative: =&gt; Option[String])Option[String]">orElse</span><span class="delimiter">(</span><a href="#206713" title="Map[String,Seq[String]]">queryString</a>.<span title="(key: String)Option[Seq[String]]">get</span><span class="delimiter">(</span><span title="java.lang.String(&quot;openid.identity&quot;)" class="string">&quot;openid.identity&quot;</span><span class="delimiter">)</span>.<span title="(f: Seq[String] =&gt; Option[String])Option[String]">flatMap</span><span class="delimiter">(</span><a href="#206731" title="Seq[String]">_</a>.<span title="=&gt; Option[String]">headOption</span><span class="delimiter">)</span><span class="delimiter">)</span>
      .<span title="(default: =&gt; String)String">getOrElse</span><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <a href="OpenIDError.scala.html#15161" title="object play.api.libs.openid.Errors">Errors</a>.<a href="OpenIDError.scala.html#206741" title="object play.api.libs.openid.Errors.BAD_RESPONSE">BAD_RESPONSE</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.immutable.Map[String,String]" id="206717">attributes</a> = <a href="#206713" title="Map[String,Seq[String]]">queryString</a>.<span title="=&gt; Seq[(String, Seq[String])]">toSeq</span>.<span title="(f: (String, Seq[String]) =&gt; (Option[String], Option[String]))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(String, Seq[String])],(Option[String], Option[String]),Seq[(Option[String], Option[String])]])Seq[(Option[String], Option[String])]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(Option[String], Option[String]),Seq[(Option[String], Option[String])]]" class="delimiter">(</span><a title="(String, Seq[String])" id="206775">pair</a> =&gt; <span title="(_1: Option[String], _2: Option[String])(Option[String], Option[String])" class="delimiter">(</span><a href="#206715" title="scala.util.matching.Regex">axAttribute</a>.<span title="(source: java.lang.CharSequence)Option[scala.util.matching.Regex.Match]">findFirstMatchIn</span><span class="delimiter">(</span><a href="#206775" title="(String, Seq[String])">pair</a>.<span title="=&gt; String">_1</span><span class="delimiter">)</span>.<span title="(f: scala.util.matching.Regex.Match =&gt; String)Option[String]">map</span><span class="delimiter">(</span><a href="#206784" title="scala.util.matching.Regex.Match">_</a>.<span title="(i: Int)String">group</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#206775" title="(String, Seq[String])">pair</a>.<span title="=&gt; Seq[String]">_2</span>.<span title="=&gt; Option[String]">headOption</span><span class="delimiter">)</span><span class="delimiter">)</span>
      .<span title="(pf: PartialFunction[(Option[String], Option[String]),(String, String)])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(Option[String], Option[String])],(String, String),Seq[(String, String)]])Seq[(String, String)]">collect</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(String, String),Seq[(String, String)]]" class="delimiter">(</span><a href="#206833" title="(String, String)" class="delimiter">{</a> <span class="keyword">case</span> <span title="(String, String)" class="delimiter">(</span>Some<span class="delimiter">(</span><a title="String" id="206837">key</a><span class="delimiter">)</span>, Some<span class="delimiter">(</span><a title="String" id="206839">value</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span title="(_1: String, _2: String)(String, String)" class="delimiter">(</span><a href="#206837" title="String">key</a>, <a href="#206839" title="String">value</a><span class="delimiter">)</span> <span class="delimiter">}</span><span class="delimiter">)</span>.<span title="(implicit ev: &lt;:&lt;[(String, String),(String, String)])scala.collection.immutable.Map[String,String]">toMap</span>
    <span title="play.api.libs.openid.UserInfo" class="keyword">new</span> <a href="#206648" title="play.api.libs.openid.UserInfo">UserInfo</a><span class="delimiter">(</span><a href="#206716" title="String">id</a>, <a href="#206717" title="scala.collection.immutable.Map[String,String]">attributes</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>
<span class="comment">/**
 * provides OpenID support
 */</span>
<span class="keyword">object</span> <a title="object play.api.libs.openid.OpenID" id="15251">OpenID</a> <span title="ScalaObject" class="delimiter">{</span>

  <span class="comment">/**
   * Retrieve the URL where the user should be redirected to start the OpenID authentication process
   */</span>
  <span class="keyword">def</span> <a title="(openID: String, callbackURL: String, axRequired: Seq[(String, String)], axOptional: Seq[(String, String)])play.api.libs.concurrent.Promise[String]" id="206901">redirectURL</a><span class="delimiter">(</span><a title="String" id="206918">openID</a>: <span title="String">String</span>,
    <a title="String" id="206919">callbackURL</a>: <span title="String">String</span>,
    <a title="Seq[(String, String)]" id="206923">axRequired</a>: <span title="Seq[(String, String)]">Seq</span><span class="delimiter">[</span><span class="delimiter">(</span>String, String<span class="delimiter">)</span><span class="delimiter">]</span> = <span title="object Seq">Seq</span>.<span title="Seq[Nothing]">empty</span>,
    <a title="Seq[(String, String)]" id="206924">axOptional</a>: <span title="Seq[(String, String)]">Seq</span><span class="delimiter">[</span><span class="delimiter">(</span>String, String<span class="delimiter">)</span><span class="delimiter">]</span> = <span title="object Seq">Seq</span>.<span title="Seq[Nothing]">empty</span><span class="delimiter">)</span>: <a href="../concurrent/Promise.scala.html#13155" title="play.api.libs.concurrent.Promise[String]">Promise</a><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="String" id="206940">claimedId</a> = <a href="#206906" title="(openID: String)String">normalize</a><span class="delimiter">(</span><a href="#206918" title="String">openID</a><span class="delimiter">)</span>
    <a href="#206915" title="(openid: String)play.api.libs.concurrent.Promise[play.api.libs.openid.OpenIDServer]">discoverServer</a><span class="delimiter">(</span><a href="#206940" title="String">claimedId</a><span class="delimiter">)</span>.<a href="../concurrent/Promise.scala.html#74730" title="(f: play.api.libs.openid.OpenIDServer =&gt; java.lang.String)play.api.libs.concurrent.Promise[java.lang.String]">map</a><span class="delimiter">(</span><a title="play.api.libs.openid.OpenIDServer" id="206949">server</a> =&gt; <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Seq[(java.lang.String, String)]" id="206950">parameters</a> = <span title="(elems: (java.lang.String, String)*)Seq[(java.lang.String, String)]">Seq</span><span class="delimiter">(</span>
        <span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;openid.ns&quot;</span> <span title="(y: java.lang.String)(java.lang.String, java.lang.String)">-&gt;</span> <span title="java.lang.String(&quot;http://specs.openid.net/auth/2.0&quot;)" class="string">&quot;http://specs.openid.net/auth/2.0&quot;</span>,
        <span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;openid.mode&quot;</span> <span title="(y: java.lang.String)(java.lang.String, java.lang.String)">-&gt;</span> <span title="java.lang.String(&quot;checkid_setup&quot;)" class="string">&quot;checkid_setup&quot;</span>,
        <span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;openid.claimed_id&quot;</span> <span title="(y: String)(java.lang.String, String)">-&gt;</span> <a href="#206940" title="String">claimedId</a>,
        <span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;openid.identity&quot;</span> <span title="(y: String)(java.lang.String, String)">-&gt;</span> <a href="#206949" title="play.api.libs.openid.OpenIDServer">server</a>.<a href="#209229" title="=&gt; Option[String]">delegate</a>.<span title="(default: =&gt; String)String">getOrElse</span><span class="delimiter">(</span><a href="#206940" title="String">claimedId</a><span class="delimiter">)</span>,
        <span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;openid.return_to&quot;</span> <span title="(y: String)(java.lang.String, String)">-&gt;</span> <a href="#206919" title="String">callbackURL</a>
      <span class="delimiter">)</span> <span title="(that: scala.collection.GenTraversableOnce[(java.lang.String, String)])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(java.lang.String, String)],(java.lang.String, String),Seq[(java.lang.String, String)]])Seq[(java.lang.String, String)]">++</span> <a href="#206905" title="(axRequired: Seq[(String, String)], axOptional: Seq[(String, String)])Seq[(String, String)]">axParameters</a><span class="delimiter">(</span><a href="#206923" title="Seq[(String, String)]">axRequired</a>, <a href="#206924" title="Seq[(String, String)]">axOptional</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.lang.String" id="206951">separator</a> = <span title="java.lang.String" class="keyword">if</span> <span class="delimiter">(</span><a href="#206949" title="play.api.libs.openid.OpenIDServer">server</a>.<a href="#209228" title="=&gt; String">url</a>.<span title="(x$1: java.lang.CharSequence)Boolean">contains</span><span class="delimiter">(</span><span title="java.lang.String(&quot;?&quot;)" class="string">&quot;?&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="java.lang.String(&quot;&amp;&quot;)" class="string">&quot;&amp;&quot;</span> <span class="keyword">else</span> <span title="java.lang.String(&quot;?&quot;)" class="string">&quot;?&quot;</span>
      <a href="#206949" title="play.api.libs.openid.OpenIDServer">server</a>.<a href="#209228" title="=&gt; String">url</a> <span title="(x$1: Any)java.lang.String">+</span> <a href="#206951" title="java.lang.String">separator</a> <span title="(x$1: Any)java.lang.String">+</span> <a href="#206950" title="Seq[(java.lang.String, String)]">parameters</a>.<span title="(f: (java.lang.String, String) =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(java.lang.String, String)],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a title="(java.lang.String, String)" id="207101">pair</a> =&gt; <a href="#207101" title="(java.lang.String, String)">pair</a>.<span title="=&gt; java.lang.String">_1</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;=&quot;)" class="string">&quot;=&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="object java.net.URLEncoder">URLEncoder</span>.<span title="(x$1: java.lang.String, x$2: java.lang.String)java.lang.String">encode</span><span class="delimiter">(</span><a href="#207101" title="(java.lang.String, String)">pair</a>.<span title="=&gt; String">_2</span>, <span title="java.lang.String(&quot;UTF-8&quot;)" class="string">&quot;UTF-8&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&amp;&quot;)" class="string">&quot;&amp;&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * From a request corresponding to the callback from the OpenID server, check the identity of the current user
   */</span>
  <span class="keyword">def</span> <a title="(implicit request: play.api.mvc.Request[_])play.api.libs.concurrent.Promise[play.api.libs.openid.UserInfo]" id="206902">verifiedId</a><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="play.api.mvc.Request[_]" id="207127">request</a>: <a href="../../mvc/Http.scala.html#16009" title="play.api.mvc.Request[_]">Request</a><span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../concurrent/Promise.scala.html#13155" title="play.api.libs.concurrent.Promise[play.api.libs.openid.UserInfo]">Promise</a><span class="delimiter">[</span>UserInfo<span class="delimiter">]</span> = <a href="#206904" title="(queryString: Map[String,Seq[String]])play.api.libs.concurrent.Promise[play.api.libs.openid.UserInfo]">verifiedId</a><span class="delimiter">(</span><a href="#207127" title="play.api.mvc.Request[_]">request</a>.<a href="../../mvc/Http.scala.html#63784" title="=&gt; Map[String,Seq[String]]">queryString</a><span class="delimiter">)</span>

  <span class="comment">/**
   * For internal use
   */</span>
  <span class="keyword">def</span> <a title="(queryString: java.util.Map[String,Array[String]])play.api.libs.concurrent.Promise[play.api.libs.openid.UserInfo]" id="206903">verifiedId</a><span class="delimiter">(</span><a title="java.util.Map[String,Array[String]]" id="207138">queryString</a>: java.util.<span title="java.util.Map[String,Array[String]]">Map</span><span class="delimiter">[</span>String, Array<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../concurrent/Promise.scala.html#13155" title="play.api.libs.concurrent.Promise[play.api.libs.openid.UserInfo]">Promise</a><span class="delimiter">[</span>UserInfo<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">import</span> scala.collection.<span title="object scala.collection.JavaConversions">JavaConversions</span>._
    <a href="#206904" title="(queryString: Map[String,Seq[String]])play.api.libs.concurrent.Promise[play.api.libs.openid.UserInfo]">verifiedId</a><span class="delimiter">(</span><a href="#207138" title="(m: java.util.Map[String,Array[String]])scala.collection.mutable.Map[String,Array[String]]">queryString</a>.<span title="(implicit ev: &lt;:&lt;[(String, Array[String]),(String, Array[String])])scala.collection.immutable.Map[String,Array[String]]">toMap</span>.<span title="(f: Array[String] =&gt; Seq[String])scala.collection.immutable.Map[String,Seq[String]]">mapValues</span><span class="delimiter">(</span><a href="#208378" title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]">_</a>.<span title="=&gt; Seq[String]">toSeq</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(queryString: Map[String,Seq[String]])play.api.libs.concurrent.Promise[play.api.libs.openid.UserInfo]" id="206904">verifiedId</a><span class="delimiter">(</span><a title="Map[String,Seq[String]]" id="207136">queryString</a>: <span title="Map[String,Seq[String]]">Map</span><span class="delimiter">[</span>String, Seq<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../concurrent/Promise.scala.html#13155" title="play.api.libs.concurrent.Promise[play.api.libs.openid.UserInfo]">Promise</a><span class="delimiter">[</span>UserInfo<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span title="(_1: Option[String], _2: Option[String], _3: Option[String])(Option[String], Option[String], Option[String])" class="delimiter">(</span><a href="#207136" title="Map[String,Seq[String]]">queryString</a>.<span title="(key: String)Option[Seq[String]]">get</span><span class="delimiter">(</span><span title="java.lang.String(&quot;openid.mode&quot;)" class="string">&quot;openid.mode&quot;</span><span class="delimiter">)</span>.<span title="(f: Seq[String] =&gt; Option[String])Option[String]">flatMap</span><span class="delimiter">(</span><a href="#208515" title="Seq[String]">_</a>.<span title="=&gt; Option[String]">headOption</span><span class="delimiter">)</span>,
      <a href="#207136" title="Map[String,Seq[String]]">queryString</a>.<span title="(key: String)Option[Seq[String]]">get</span><span class="delimiter">(</span><span title="java.lang.String(&quot;openid.claimedId&quot;)" class="string">&quot;openid.claimedId&quot;</span><span class="delimiter">)</span>.<span title="(f: Seq[String] =&gt; Option[String])Option[String]">flatMap</span><span class="delimiter">(</span><a href="#208520" title="Seq[String]">_</a>.<span title="=&gt; Option[String]">headOption</span><span class="delimiter">)</span>.<span title="(alternative: =&gt; Option[String])Option[String]">orElse</span><span class="delimiter">(</span><a href="#207136" title="Map[String,Seq[String]]">queryString</a>.<span title="(key: String)Option[Seq[String]]">get</span><span class="delimiter">(</span><span title="java.lang.String(&quot;openid.identity&quot;)" class="string">&quot;openid.identity&quot;</span><span class="delimiter">)</span>.<span title="(f: Seq[String] =&gt; Option[String])Option[String]">flatMap</span><span class="delimiter">(</span><a href="#208527" title="Seq[String]">_</a>.<span title="=&gt; Option[String]">headOption</span><span class="delimiter">)</span><span class="delimiter">)</span>,
      <a href="#207136" title="Map[String,Seq[String]]">queryString</a>.<span title="(key: String)Option[Seq[String]]">get</span><span class="delimiter">(</span><span title="java.lang.String(&quot;openid.op_endpoint&quot;)" class="string">&quot;openid.op_endpoint&quot;</span><span class="delimiter">)</span>.<span title="(f: Seq[String] =&gt; Option[String])Option[String]">flatMap</span><span class="delimiter">(</span><a href="#208533" title="Seq[String]">_</a>.<span title="=&gt; Option[String]">headOption</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="play.api.libs.concurrent.Promise[play.api.libs.openid.UserInfo]" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="play.api.libs.concurrent.Promise[play.api.libs.openid.UserInfo]" class="delimiter">(</span>Some<span class="delimiter">(</span><span title="java.lang.String(&quot;id_res&quot;)" class="string">&quot;id_res&quot;</span><span class="delimiter">)</span>, Some<span class="delimiter">(</span><a title="String" id="208543">id</a><span class="delimiter">)</span>, <a title="Option[String]" id="208544">endPoint</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="play.api.libs.concurrent.Promise[String]" id="208545">server</a>: <a href="../concurrent/Promise.scala.html#13155" title="play.api.libs.concurrent.Promise[String]">Promise</a><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="#208544" title="Option[String]">endPoint</a>.<span title="(f: String =&gt; play.api.libs.concurrent.Promise[String])Option[play.api.libs.concurrent.Promise[String]]">map</span><span class="delimiter">(</span><a href="../concurrent/Promise.scala.html#171836" title="(lazyA: =&gt; String)play.api.libs.concurrent.Promise[String]">PurePromise</a><span class="delimiter">(</span><a href="#208550" title="String">_</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(default: =&gt; play.api.libs.concurrent.Promise[String])play.api.libs.concurrent.Promise[String]">getOrElse</span><span class="delimiter">(</span><a href="#206915" title="(openid: String)play.api.libs.concurrent.Promise[play.api.libs.openid.OpenIDServer]">discoverServer</a><span class="delimiter">(</span><a href="#208543" title="String">id</a><span class="delimiter">)</span>.<a href="../concurrent/Promise.scala.html#74730" title="(f: play.api.libs.openid.OpenIDServer =&gt; String)play.api.libs.concurrent.Promise[String]">map</a><span class="delimiter">(</span><a href="#208562" title="play.api.libs.openid.OpenIDServer">_</a>.<a href="#209228" title="=&gt; String">url</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#208545" title="play.api.libs.concurrent.Promise[String]">server</a>.<a href="../concurrent/Promise.scala.html#74733" title="(f: String =&gt; play.api.libs.concurrent.Promise[play.api.libs.openid.UserInfo])play.api.libs.concurrent.Promise[play.api.libs.openid.UserInfo]">flatMap</a><span class="delimiter">(</span><a title="String" id="208569">url</a> =&gt; <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="scala.collection.immutable.Map[String,Seq[String]]" id="208570">fields</a> = <a href="#207136" title="Map[String,Seq[String]]">queryString</a> <span title="(key: String)scala.collection.immutable.Map[String,Seq[String]]">-</span> <span title="java.lang.String(&quot;openid.mode&quot;)" class="string">&quot;openid.mode&quot;</span> <span title="(kv: (String, Seq[String]))scala.collection.immutable.Map[String,Seq[String]]">+</span> <span class="delimiter">(</span><span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;openid.mode&quot;</span> <span title="(y: Seq[java.lang.String])(java.lang.String, Seq[java.lang.String])">-&gt;</span> <span title="(elems: java.lang.String*)Seq[java.lang.String]">Seq</span><span class="delimiter">(</span><span title="java.lang.String(&quot;check_authentication&quot;)" class="string">&quot;check_authentication&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="../ws/WS.scala.html#15345" title="object play.api.libs.ws.WS">WS</a>.<a href="../ws/WS.scala.html#204911" title="(url: String)play.api.libs.ws.WS.WSRequestHolder">url</a><span class="delimiter">(</span><a href="#208569" title="String">url</a><span class="delimiter">)</span>.<a href="../ws/WS.scala.html#208688" title="(body: scala.collection.immutable.Map[String,Seq[String]])(implicit wrt: play.api.http.Writeable[scala.collection.immutable.Map[String,Seq[String]]], implicit ct: play.api.http.ContentTypeOf[scala.collection.immutable.Map[String,Seq[String]]])play.api.libs.concurrent.Promise[play.api.libs.ws.Response]">post</a><a href="../../http/Writeable.scala.html#90324" title="implicit play.api.http.DefaultWriteables.writeableOf_urlEncodedForm : (implicit codec: play.api.mvc.Codec)play.api.http.Writeable[Map[String,Seq[String]]]" class="delimiter">(</a><a href="#208570" title="scala.collection.immutable.Map[String,Seq[String]]">fields</a><span class="delimiter">)</span>.<a href="../concurrent/Promise.scala.html#74730" title="(f: play.api.libs.ws.Response =&gt; play.api.libs.openid.UserInfo)play.api.libs.concurrent.Promise[play.api.libs.openid.UserInfo]">map</a><span class="delimiter">(</span><a title="play.api.libs.ws.Response" id="208738">response</a> =&gt; <span class="delimiter">{</span>
              <span title="play.api.libs.openid.UserInfo" class="keyword">if</span> <span class="delimiter">(</span><a href="#208738" title="play.api.libs.ws.Response">response</a>.<a href="../ws/WS.scala.html#208746" title="=&gt; Int">status</a> <span title="(x: Int)Boolean">==</span> <span title="Int(200)" class="int">200</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#208738" title="play.api.libs.ws.Response">response</a>.<a href="../ws/WS.scala.html#208748" title="=&gt; String">body</a>.<span title="(x$1: java.lang.CharSequence)Boolean">contains</span><span class="delimiter">(</span><span title="java.lang.String(&quot;is_valid:true&quot;)" class="string">&quot;is_valid:true&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="#206647" title="(queryString: Map[String,Seq[String]])play.api.libs.openid.UserInfo">UserInfo</a><span class="delimiter">(</span><a href="#207136" title="Map[String,Seq[String]]">queryString</a><span class="delimiter">)</span>
              <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Nothing" class="keyword">throw</span> <a href="OpenIDError.scala.html#15161" title="object play.api.libs.openid.Errors">Errors</a>.<a href="OpenIDError.scala.html#206739" title="object play.api.libs.openid.Errors.AUTH_ERROR">AUTH_ERROR</a>
            <span class="delimiter">}</span><span class="delimiter">)</span>
          <span class="delimiter">}</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> <span title="play.api.libs.concurrent.Promise[Nothing]">_</span> =&gt; <a href="../concurrent/Promise.scala.html#171836" title="(lazyA: =&gt; Nothing)play.api.libs.concurrent.Promise[Nothing]">PurePromise</a><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <a href="OpenIDError.scala.html#15161" title="object play.api.libs.openid.Errors">Errors</a>.<a href="OpenIDError.scala.html#206741" title="object play.api.libs.openid.Errors.BAD_RESPONSE">BAD_RESPONSE</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(axRequired: Seq[(String, String)], axOptional: Seq[(String, String)])Seq[(String, String)]" id="206905">axParameters</a><span class="delimiter">(</span><a title="Seq[(String, String)]" id="207063">axRequired</a>: <span title="Seq[(String, String)]">Seq</span><span class="delimiter">[</span><span class="delimiter">(</span>String, String<span class="delimiter">)</span><span class="delimiter">]</span>,
    <a title="Seq[(String, String)]" id="207064">axOptional</a>: <span title="Seq[(String, String)]">Seq</span><span class="delimiter">[</span><span class="delimiter">(</span>String, String<span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Seq[(String, String)]">Seq</span><span class="delimiter">[</span><span class="delimiter">(</span>String, String<span class="delimiter">)</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span title="Seq[(String, String)]" class="keyword">if</span> <span class="delimiter">(</span><a href="#207063" title="Seq[(String, String)]">axRequired</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#207064" title="Seq[(String, String)]">axOptional</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <span title="object Nil">Nil</span>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Seq[(java.lang.String, String)]" id="208786">axRequiredParams</a> = <span title="Seq[(java.lang.String, String)]" class="keyword">if</span> <span class="delimiter">(</span><a href="#207063" title="Seq[(String, String)]">axRequired</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span title="object Nil">Nil</span>
      <span class="keyword">else</span> <span title="(elems: (java.lang.String, String)*)Seq[(java.lang.String, String)]">Seq</span><span class="delimiter">(</span><span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;openid.ax.required&quot;</span> <span title="(y: String)(java.lang.String, String)">-&gt;</span> <a href="#207063" title="Seq[(String, String)]">axRequired</a>.<span title="(f: (String, String) =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(String, String)],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#208827" title="(String, String)">_</a>.<span title="=&gt; String">_1</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="Seq[(java.lang.String, String)]" id="208787">axOptionalParams</a> = <span title="Seq[(java.lang.String, String)]" class="keyword">if</span> <span class="delimiter">(</span><a href="#207064" title="Seq[(String, String)]">axOptional</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span title="object Nil">Nil</span>
      <span class="keyword">else</span> <span title="(elems: (java.lang.String, String)*)Seq[(java.lang.String, String)]">Seq</span><span class="delimiter">(</span><span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;openid.ax.if_available&quot;</span> <span title="(y: String)(java.lang.String, String)">-&gt;</span> <a href="#207064" title="Seq[(String, String)]">axOptional</a>.<span title="(f: (String, String) =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(String, String)],String,Seq[String]])Seq[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">(</span><a href="#208890" title="(String, String)">_</a>.<span title="=&gt; String">_1</span><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="Seq[(java.lang.String, String)]" id="208788">definitions</a> = <span class="delimiter">(</span><a href="#207063" title="Seq[(String, String)]">axRequired</a> <span title="(that: scala.collection.GenTraversableOnce[(String, String)])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(String, String)],(String, String),Seq[(String, String)]])Seq[(String, String)]">++</span> <a href="#207064" title="Seq[(String, String)]">axOptional</a><span class="delimiter">)</span>.<span title="(f: (String, String) =&gt; (java.lang.String, String))(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(String, String)],(java.lang.String, String),Seq[(java.lang.String, String)]])Seq[(java.lang.String, String)]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,(java.lang.String, String),Seq[(java.lang.String, String)]]" class="delimiter">(</span><a title="(String, String)" id="208970">attribute</a> =&gt; <span class="delimiter">(</span><span title="java.lang.String(&quot;openid.ax.type.&quot;)" class="string">&quot;openid.ax.type.&quot;</span> <span title="(x: java.lang.String)ArrowAssoc[java.lang.String]">+</span> <a href="#208970" title="(String, String)">attribute</a>.<span title="=&gt; String">_1</span> <span title="(y: String)(java.lang.String, String)">-&gt;</span> <a href="#208970" title="(String, String)">attribute</a>.<span title="=&gt; String">_2</span><span class="delimiter">)</span><span class="delimiter">)</span>

      <span title="(elems: (java.lang.String, java.lang.String)*)Seq[(java.lang.String, java.lang.String)]">Seq</span><span class="delimiter">(</span><span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;openid.ns.ax&quot;</span> <span title="(y: java.lang.String)(java.lang.String, java.lang.String)">-&gt;</span> <span title="java.lang.String(&quot;http://openid.net/srv/ax/1.0&quot;)" class="string">&quot;http://openid.net/srv/ax/1.0&quot;</span>, <span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;openid.ax.mode&quot;</span> <span title="(y: java.lang.String)(java.lang.String, java.lang.String)">-&gt;</span> <span title="java.lang.String(&quot;fetch_request&quot;)" class="string">&quot;fetch_request&quot;</span><span class="delimiter">)</span> <span title="(that: scala.collection.GenTraversableOnce[(java.lang.String, java.lang.String)])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(java.lang.String, java.lang.String)],(java.lang.String, java.lang.String),Seq[(java.lang.String, java.lang.String)]])Seq[(java.lang.String, java.lang.String)]">++</span> <a href="#208786" title="Seq[(java.lang.String, String)]">axRequiredParams</a> <span title="(that: scala.collection.GenTraversableOnce[(java.lang.String, java.lang.String)])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(java.lang.String, java.lang.String)],(java.lang.String, java.lang.String),Seq[(java.lang.String, java.lang.String)]])Seq[(java.lang.String, java.lang.String)]">++</span> <a href="#208787" title="Seq[(java.lang.String, String)]">axOptionalParams</a> <span title="(that: scala.collection.GenTraversableOnce[(java.lang.String, java.lang.String)])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[(java.lang.String, java.lang.String)],(java.lang.String, java.lang.String),Seq[(String, String)]])Seq[(String, String)]">++</span> <a href="#208788" title="Seq[(java.lang.String, String)]">definitions</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(openID: String)String" id="206906">normalize</a><span class="delimiter">(</span><a title="String" id="206941">openID</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.lang.String" id="209171">trimmed</a> = <a href="#206941" title="String">openID</a>.<span title="()java.lang.String">trim</span>
    <span title="String" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#209171" title="java.lang.String">trimmed</a>.<span title="(x$1: java.lang.String)Boolean">startsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;http://&quot;)" class="string">&quot;http://&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#209171" title="java.lang.String">trimmed</a>.<span title="(x$1: java.lang.String)Boolean">startsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;https://&quot;)" class="string">&quot;https://&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="java.lang.String(&quot;http://&quot;)" class="string">&quot;http://&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#209171" title="java.lang.String">trimmed</a>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#209171" title="java.lang.String">trimmed</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="206907">providerRegex</a> = <span title="scala.util.matching.Regex" class="keyword">new</span> <span title="scala.util.matching.Regex">Regex</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&lt;link[^&gt;]+openid2[.]provider[^&gt;]+&gt;&quot;)" class="string">&quot;&quot;&quot;&lt;link[^&gt;]+openid2[.]provider[^&gt;]+&gt;&quot;&quot;&quot;</span><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="206909">serverRegex</a> = <span title="scala.util.matching.Regex" class="keyword">new</span> <span title="scala.util.matching.Regex">Regex</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&lt;link[^&gt;]+openid[.]server[^&gt;]+&gt;&quot;)" class="string">&quot;&quot;&quot;&lt;link[^&gt;]+openid[.]server[^&gt;]+&gt;&quot;&quot;&quot;</span><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="206911">localidRegex</a> = <span title="scala.util.matching.Regex" class="keyword">new</span> <span title="scala.util.matching.Regex">Regex</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&lt;link[^&gt;]+openid2[.]local_id[^&gt;]+&gt;&quot;)" class="string">&quot;&quot;&quot;&lt;link[^&gt;]+openid2[.]local_id[^&gt;]+&gt;&quot;&quot;&quot;</span><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="206913">delegateRegex</a> = <span title="scala.util.matching.Regex" class="keyword">new</span> <span title="scala.util.matching.Regex">Regex</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&lt;link[^&gt;]+openid[.]delegate[^&gt;]+&gt;&quot;)" class="string">&quot;&quot;&quot;&lt;link[^&gt;]+openid[.]delegate[^&gt;]+&gt;&quot;&quot;&quot;</span><span class="delimiter">)</span>

  <span class="comment">/**
   * Resolve the OpenID server from the user's OpenID
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(openid: String)play.api.libs.concurrent.Promise[play.api.libs.openid.OpenIDServer]" id="206915">discoverServer</a><span class="delimiter">(</span><a title="String" id="206943">openid</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../concurrent/Promise.scala.html#13155" title="play.api.libs.concurrent.Promise[play.api.libs.openid.OpenIDServer]">Promise</a><span class="delimiter">[</span>OpenIDServer<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="../ws/WS.scala.html#15345" title="object play.api.libs.ws.WS">WS</a>.<a href="../ws/WS.scala.html#204911" title="(url: String)play.api.libs.ws.WS.WSRequestHolder">url</a><span class="delimiter">(</span><a href="#206943" title="String">openid</a><span class="delimiter">)</span>.<a href="../ws/WS.scala.html#208684" title="()play.api.libs.concurrent.Promise[play.api.libs.ws.Response]">get</a><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="../concurrent/Promise.scala.html#74730" title="(f: play.api.libs.ws.Response =&gt; play.api.libs.openid.OpenIDServer)play.api.libs.concurrent.Promise[play.api.libs.openid.OpenIDServer]">map</a><span class="delimiter">(</span><a title="play.api.libs.ws.Response" id="209199">response</a> =&gt; <span class="delimiter">{</span>
      <span class="comment">// Try HTML</span>
      <span class="keyword">val</span> <a title="Option[String]" id="209200">serverUrl</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="#206907" title="=&gt; scala.util.matching.Regex">providerRegex</a>.<span title="(source: java.lang.CharSequence)Option[String]">findFirstIn</span><span class="delimiter">(</span><a href="#209199" title="play.api.libs.ws.Response">response</a>.<a href="../ws/WS.scala.html#208748" title="=&gt; String">body</a><span class="delimiter">)</span>
        .<span title="(alternative: =&gt; Option[String])Option[String]">orElse</span><span class="delimiter">(</span><a href="#206909" title="=&gt; scala.util.matching.Regex">serverRegex</a>.<span title="(source: java.lang.CharSequence)Option[String]">findFirstIn</span><span class="delimiter">(</span><a href="#209199" title="play.api.libs.ws.Response">response</a>.<a href="../ws/WS.scala.html#208748" title="=&gt; String">body</a><span class="delimiter">)</span><span class="delimiter">)</span>
        .<span title="(f: String =&gt; Option[String])Option[String]">flatMap</span><span class="delimiter">(</span><a href="#206916" title="(link: String)Option[String]">extractHref</a><span class="delimiter">(</span><a href="#209210" title="String">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Option[play.api.libs.openid.OpenIDServer]" id="209201">fromHtml</a> = <a href="#209200" title="Option[String]">serverUrl</a>.<span title="(f: String =&gt; play.api.libs.openid.OpenIDServer)Option[play.api.libs.openid.OpenIDServer]">map</span><span class="delimiter">(</span><a title="String" id="209218">url</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Option[String]" id="209219">delegate</a>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="#206911" title="=&gt; scala.util.matching.Regex">localidRegex</a>.<span title="(source: java.lang.CharSequence)Option[String]">findFirstIn</span><span class="delimiter">(</span><a href="#209199" title="play.api.libs.ws.Response">response</a>.<a href="../ws/WS.scala.html#208748" title="=&gt; String">body</a><span class="delimiter">)</span>
          .<span title="(alternative: =&gt; Option[String])Option[String]">orElse</span><span class="delimiter">(</span><a href="#206913" title="=&gt; scala.util.matching.Regex">delegateRegex</a>.<span title="(source: java.lang.CharSequence)Option[String]">findFirstIn</span><span class="delimiter">(</span><a href="#209199" title="play.api.libs.ws.Response">response</a>.<a href="../ws/WS.scala.html#208748" title="=&gt; String">body</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: String =&gt; Option[String])Option[String]">flatMap</span><span class="delimiter">(</span><a href="#206916" title="(link: String)Option[String]">extractHref</a><span class="delimiter">(</span><a href="#209226" title="String">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#209282" title="(url: String, delegate: Option[String])play.api.libs.openid.OpenIDServer">OpenIDServer</a><span class="delimiter">(</span><a href="#209218" title="String">url</a>, <a href="#209219" title="Option[String]">delegate</a><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      <span class="comment">// Try XRD</span>
      <span class="keyword">val</span> <a title="Option[play.api.libs.openid.OpenIDServer]" id="209202">fromXRD</a> = <a href="#209199" title="play.api.libs.ws.Response">response</a>.<a href="../ws/WS.scala.html#208747" title="(key: String)Option[String]">header</a><span class="delimiter">(</span><a href="../../http/StandardValues.scala.html#12593" title="object play.api.http.HeaderNames">HeaderNames</a>.<a href="../../http/StandardValues.scala.html#68380" title="=&gt; java.lang.String">CONTENT_TYPE</a><span class="delimiter">)</span>.<span title="(p: String =&gt; Boolean)Option[String]">filter</span><span class="delimiter">(</span><a href="#209240" title="String">_</a>.<span title="(x$1: java.lang.CharSequence)Boolean">contains</span><span class="delimiter">(</span><span title="java.lang.String(&quot;application/xrds+xml&quot;)" class="string">&quot;application/xrds+xml&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: String =&gt; play.api.libs.openid.OpenIDServer)Option[play.api.libs.openid.OpenIDServer]">map</span><span class="delimiter">(</span><a title="String" id="209245">_</a> =&gt;
        <a href="#209282" title="(url: String, delegate: Option[String])play.api.libs.openid.OpenIDServer">OpenIDServer</a><span class="delimiter">(</span><span class="delimiter">(</span><a href="#209199" title="play.api.libs.ws.Response">response</a>.<a href="../ws/WS.scala.html#208750" title="=&gt; scala.xml.Elem">xml</a> <span title="(that: String)scala.xml.NodeSeq">\\</span> <span title="java.lang.String(&quot;URI&quot;)" class="string">&quot;URI&quot;</span><span class="delimiter">)</span>.<span title="=&gt; String">text</span>, <span title="object None">None</span><span class="delimiter">)</span>
      <span class="delimiter">)</span>
      <a href="#209201" title="Option[play.api.libs.openid.OpenIDServer]">fromHtml</a>.<span title="(alternative: =&gt; Option[play.api.libs.openid.OpenIDServer])Option[play.api.libs.openid.OpenIDServer]">orElse</span><span class="delimiter">(</span><a href="#209202" title="Option[play.api.libs.openid.OpenIDServer]">fromXRD</a><span class="delimiter">)</span>.<span title="(default: =&gt; play.api.libs.openid.OpenIDServer)play.api.libs.openid.OpenIDServer">getOrElse</span><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <a href="OpenIDError.scala.html#15161" title="object play.api.libs.openid.Errors">Errors</a>.<a href="OpenIDError.scala.html#206745" title="object play.api.libs.openid.Errors.NETWORK_ERROR">NETWORK_ERROR</a><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(link: String)Option[String]" id="206916">extractHref</a><span class="delimiter">(</span><a title="String" id="209211">link</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span> =
    <span title="scala.util.matching.Regex" class="keyword">new</span> <span title="scala.util.matching.Regex">Regex</span><span class="delimiter">(</span><span title="java.lang.String(&quot;href=\&quot;([^\&quot;]*)\&quot;&quot;)" class="string">&quot;&quot;&quot;href=&quot;([^&quot;]*)&quot;&quot;&quot;&quot;</span><span class="delimiter">)</span>.<span title="(source: java.lang.CharSequence)Option[scala.util.matching.Regex.Match]">findFirstMatchIn</span><span class="delimiter">(</span><a href="#209211" title="String">link</a><span class="delimiter">)</span>.<span title="(f: scala.util.matching.Regex.Match =&gt; java.lang.String)Option[java.lang.String]">map</span><span class="delimiter">(</span><a href="#209263" title="scala.util.matching.Regex.Match">_</a>.<span title="(i: Int)String">group</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<span title="()java.lang.String">trim</span><span class="delimiter">)</span>

<span class="delimiter">}</span>


        </pre>
    </body>
</html>
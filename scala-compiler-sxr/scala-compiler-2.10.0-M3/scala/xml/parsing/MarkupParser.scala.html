<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/xml/parsing/MarkupParser.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
/*                     __                                               *\
**     ________ ___   / /  ___     Scala API                            **
**    / __/ __// _ | / /  / _ |    (c) 2003-2011, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */

<span class="keyword">package</span> scala.xml
<span class="keyword">package</span> parsing

<span class="keyword">import</span> scala.io.Source
<span class="keyword">import</span> scala.xml.dtd._
<span class="keyword">import</span> <a href="../Utility.scala.html#55457" title="scala.xml.Utility.type">Utility</a>.<a href="../Utility.scala.html#700395" title="scala.xml.Utility.Escapes.type">Escapes</a>.<span class="delimiter">{</span> pairs =&gt; unescape <span class="delimiter">}</span>

/**
 * An XML parser.
 *
 * Parses XML 1.0, invokes callback methods of a `MarkupHandler` and returns
 * whatever the markup handler returns. Use `ConstructingParser` if you just
 * want to parse XML to construct instances of `scala.xml.Node`.
 *
 * While XML elements are returned, DTD declarations - if handled - are
 * collected using side-effects.
 *
 * @author  Burak Emir
 * @version 1.0
 */
<span class="keyword">trait</span> <a title="trait MarkupParser extends Object with scala.xml.parsing.MarkupParserCommon with scala.xml.parsing.TokenTests" id="56396">MarkupParser</a> <a href="../../Unit.scala.html#2389" title="Unit" class="keyword">extends</a> <a href="MarkupParserCommon.scala.html#56426" title="scala.xml.parsing.MarkupParserCommon">MarkupParserCommon</a> <span class="keyword">with</span> <a href="TokenTests.scala.html#56513" title="scala.xml.parsing.TokenTests">TokenTests</a>
<span class="delimiter">{</span>
  self: MarkupParser <span class="keyword">with</span> MarkupHandler =&gt;

  <span class="keyword">type</span> <a title="Int" id="1294066">PositionType</a> = <a href="../../Int.scala.html#508" title="Int">Int</a>
  <span class="keyword">type</span> <a title="scala.io.Source" id="1294067">InputType</a>    = <a href="../../io/Source.scala.html#17465" title="scala.io.Source">Source</a>
  <span class="keyword">type</span> <a title="scala.xml.NodeSeq" id="1294068">ElementType</a>  = <a href="../NodeSeq.scala.html#55450" title="scala.xml.NodeSeq">NodeSeq</a>
  <span class="keyword">type</span> <a title="(scala.xml.MetaData, scala.xml.NamespaceBinding)" id="1294069">AttributesType</a> = <a href="../../Tuple2.scala.html#1222" title="(scala.xml.MetaData, scala.xml.NamespaceBinding)" class="delimiter">(</a>MetaData, NamespaceBinding<span class="delimiter">)</span>
  <span class="keyword">type</span> <a title="scala.xml.NamespaceBinding" id="1294070">NamespaceType</a> = <a href="../NamespaceBinding.scala.html#55606" title="scala.xml.NamespaceBinding">NamespaceBinding</a>

  <span class="keyword">def</span> <a title="(msg: String)Nothing" id="1294071">truncatedError</a><span class="delimiter">(</span><a title="String" id="1295661">msg</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Nothing">Nothing</span> = <span title="Nothing" class="keyword">throw</span> <a href="FatalError.scala.html#1295417" title="(msg: String)scala.xml.parsing.FatalError">FatalError</a><span class="delimiter">(</span><a href="#1295661" title="String">msg</a><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(tag: String)Nothing" id="1294072">errorNoEnd</a><span class="delimiter">(</span><a title="String" id="1295664">tag</a>: <span title="String">String</span><span class="delimiter">)</span> = <span title="Nothing" class="keyword">throw</span> <a href="FatalError.scala.html#1295417" title="(msg: String)scala.xml.parsing.FatalError">FatalError</a><span class="delimiter">(</span><span title="String(&quot;expected closing tag of &quot;)" class="string">&quot;expected closing tag of &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1295664" title="String">tag</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(that: Char, msg: String)Unit" id="1294073">xHandleError</a><span class="delimiter">(</span><a title="Char" id="1295667">that</a>: <a href="../../Char.scala.html#1273" title="Char">Char</a>, <a title="String" id="1295668">msg</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#1294149" title="(str: String)Unit">reportSyntaxError</a><span class="delimiter">(</span><a href="#1295668" title="String">msg</a><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="=&gt; scala.io.Source" id="1294074">input</a>: <a href="../../io/Source.scala.html#17465" title="scala.io.Source">Source</a>

  /** if true, does not remove surplus whitespace */
  <span class="keyword">val</span> <a title="=&gt; Boolean" id="1294075">preserveWS</a>: <a href="../../Boolean.scala.html#2218" title="Boolean">Boolean</a>

  <span class="keyword">def</span> <a title="(systemLiteral: String)scala.io.Source" id="1294076">externalSource</a><span class="delimiter">(</span><a title="String" id="1295682">systemLiteral</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../../io/Source.scala.html#17465" title="scala.io.Source">Source</a>

  //
  // variables, values
  //

  <span class="keyword">protected</span> <span class="keyword">var</span> <a title="scala.io.Source" id="1294078">curInput</a>: <a href="../../io/Source.scala.html#17465" title="scala.io.Source">Source</a> = <a href="#1294074" title="=&gt; scala.io.Source">input</a>

  // See ticket #3720 for motivations.
  <span class="keyword">private</span> <span class="keyword">class</span> <a title="class WithLookAhead extends scala.io.Source" id="1294080">WithLookAhead</a><a href="#1294080" title="MarkupParser.this.WithLookAhead" class="delimiter">(</a><a title="scala.io.Source" id="1295717">underlying</a>: <a href="../../io/Source.scala.html#17465" title="scala.io.Source">Source</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../io/Source.scala.html#17465" title="scala.io.Source">Source</a> <span class="delimiter">{</span>
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.Queue[Char]" id="1295687">queue</a> = collection.mutable.<a href="../../collection/generic/GenericCompanion.scala.html#60782" title="[A](elems: A*)scala.collection.mutable.Queue[A]">Queue</a><span title="(elems: Char*)scala.collection.mutable.Queue[Char]" class="delimiter">[</span><a href="../../Char.scala.html#1273" title="Char">Char</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="()BufferedIterator[Char]" id="1295689">lookahead</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../../collection/BufferedIterator.scala.html#4771" title="BufferedIterator[Char]">BufferedIterator</a><span class="delimiter">[</span>Char<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Iterator[Char]" id="1295718">iter</a> = <a href="#1295687" title="=&gt; scala.collection.mutable.Queue[Char]">queue</a>.<a href="../../collection/mutable/MutableList.scala.html#129520" title="=&gt; Iterator[Char]">iterator</a> <a href="../../collection/Iterator.scala.html#65204" title="(that: =&gt; scala.collection.GenTraversableOnce[Char])Iterator[Char]">++</a> <a href="#1295723" title="Iterator[Char]" class="keyword">new</a> <a title="anonymous class $anon extends AnyRef with Iterator[Char]" id="1295723">Iterator</a><span class="delimiter">[</span>Char<span class="delimiter">]</span> <span class="delimiter">{</span>
        <span class="keyword">def</span> <a title="=&gt; Boolean" id="1295725">hasNext</a> = <a href="#1295717" title="scala.io.Source">underlying</a>.<a href="../../io/Source.scala.html#213885" title="=&gt; Boolean">hasNext</a>
        <span class="keyword">def</span> <a title="()Char" id="1295726">next</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span> <span class="keyword">val</span> <a title="Char" id="1295733">x</a> = <a href="#1295717" title="scala.io.Source">underlying</a>.<a href="../../io/Source.scala.html#213886" title="()Char">next</a><span class="delimiter">(</span><span class="delimiter">)</span>; <a href="#1295687" title="=&gt; scala.collection.mutable.Queue[Char]">queue</a> <a href="../../collection/mutable/MutableList.scala.html#129524" title="(elem: Char)WithLookAhead.this.queue.type">+=</a> <a href="#1295733" title="Char">x</a>; <a href="#1295733" title="Char">x</a> <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <a href="#1295718" title="Iterator[Char]">iter</a>.<a href="../../collection/Iterator.scala.html#65251" title="=&gt; scala.collection.BufferedIterator[Char]">buffered</a>
    <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="iter extends AnyRef with Iterator[Char]" id="1295690">iter</a> = <a href="#1295695" title="Iterator[Char]" class="keyword">new</a> <a title="anonymous class $anon extends AnyRef with Iterator[Char]" id="1295695">Iterator</a><span class="delimiter">[</span>Char<span class="delimiter">]</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="=&gt; Boolean" id="1295697">hasNext</a> = <a href="#1295717" title="scala.io.Source">underlying</a>.<a href="../../io/Source.scala.html#213885" title="=&gt; Boolean">hasNext</a> <a href="../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <a href="../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1295687" title="=&gt; scala.collection.mutable.Queue[Char]">queue</a>.<a href="../../collection/mutable/MutableList.scala.html#129510" title="=&gt; Boolean">isEmpty</a>
      <span class="keyword">def</span> <a title="()Char" id="1295698">next</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span title="Char" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1295687" title="=&gt; scala.collection.mutable.Queue[Char]">queue</a>.<a href="../../collection/mutable/MutableList.scala.html#129510" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <a href="#1295687" title="=&gt; scala.collection.mutable.Queue[Char]">queue</a>.<a href="../../collection/mutable/Queue.scala.html#129532" title="()Char">dequeue</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#1295717" title="scala.io.Source">underlying</a>.<a href="../../io/Source.scala.html#213886" title="()Char">next</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()BufferedIterator[Char]" id="1294081">lookahead</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../../collection/BufferedIterator.scala.html#4771" title="BufferedIterator[Char]">BufferedIterator</a><span class="delimiter">[</span>Char<span class="delimiter">]</span> = <a href="#1294078" title="=&gt; scala.io.Source">curInput</a> <span class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a href="#1295752" title="BufferedIterator[Char]" id="1295753">curInputWLA</a>:WithLookAhead =&gt;
      curInputWLA.<a href="#1295689" title="()BufferedIterator[Char]">lookahead</a><a href="#1295754" title="(x: BufferedIterator[Char])BufferedIterator[Char]" class="delimiter">(</a><span class="delimiter">)</span>
    <span class="keyword">case</span> _ =&gt;
      <span class="keyword">val</span> <a title="MarkupParser.this.WithLookAhead" id="1295750">newInput</a> = <span title="MarkupParser.this.WithLookAhead" class="keyword">new</span> <a href="#1294080" title="MarkupParser.this.WithLookAhead">WithLookAhead</a><span class="delimiter">(</span><a href="#1294078" title="=&gt; scala.io.Source">curInput</a><span class="delimiter">)</span>
      <a href="#1294078" title="(x$1: scala.io.Source)Unit">curInput</a> = <a href="#1295750" title="MarkupParser.this.WithLookAhead">newInput</a>
      <a href="#1295750" title="MarkupParser.this.WithLookAhead">newInput</a>.<a href="#1295689" title="()BufferedIterator[Char]">lookahead</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>


  /** the handler of the markup, returns this */
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.xml.parsing.MarkupHandler" id="1294082">handle</a>: <a href="MarkupHandler.scala.html#56480" title="scala.xml.parsing.MarkupHandler">MarkupHandler</a> = <a href="#56396" title="parsing extends scala.xml.parsing.MarkupParser with scala.xml.parsing.MarkupHandler" class="keyword">this</a>

  /** stack of inputs */
  <span class="keyword">var</span> <a title="List[scala.io.Source]" id="1294085">inpStack</a>: <a href="../../collection/immutable/List.scala.html#12322" title="List[scala.io.Source]">List</a><span class="delimiter">[</span>Source<span class="delimiter">]</span> = <a href="../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type">Nil</a>

  /** holds the position in the source file */
  <span class="keyword">var</span> <a title="Int" id="1294088">pos</a>: <a href="../../Int.scala.html#508" title="Int">Int</a> = _

  /* used when reading external subset */
  <span class="keyword">var</span> <a title="Int" id="1294091">extIndex</a> = -<span title="Int(-1)" class="int">1</span>

  /** holds temporary values of pos */
  <span class="keyword">var</span> <a title="Int" id="1294094">tmppos</a>: <a href="../../Int.scala.html#508" title="Int">Int</a> = _

  /** holds the next character */
  <span class="keyword">var</span> <a title="Boolean" id="1294097">nextChNeeded</a>: <a href="../../Boolean.scala.html#2218" title="Boolean">Boolean</a> = <span title="Boolean(false)" class="keyword">false</span>
  <span class="keyword">var</span> <a title="Boolean" id="1294100">reachedEof</a>: <a href="../../Boolean.scala.html#2218" title="Boolean">Boolean</a> = <span title="Boolean(false)" class="keyword">false</span>
  <span class="keyword">var</span> <a title="Char" id="1294103">lastChRead</a>: <a href="../../Char.scala.html#1273" title="Char">Char</a> = _
  <span class="keyword">def</span> <a title="=&gt; Char" id="1294105">ch</a>: <a href="../../Char.scala.html#1273" title="Char">Char</a> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1294097" title="=&gt; Boolean">nextChNeeded</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1294078" title="=&gt; scala.io.Source">curInput</a>.<a href="../../io/Source.scala.html#213885" title="=&gt; Boolean">hasNext</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#1294103" title="(x$1: Char)Unit">lastChRead</a> = <a href="#1294078" title="=&gt; scala.io.Source">curInput</a>.<a href="../../io/Source.scala.html#213886" title="()Char">next</a>
        <a href="#1294088" title="(x$1: Int)Unit">pos</a> = <a href="#1294078" title="=&gt; scala.io.Source">curInput</a>.<a href="../../io/Source.scala.html#213895" title="=&gt; Int">pos</a>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Int" id="1295763">ilen</a> = <a href="#1294085" title="=&gt; List[scala.io.Source]">inpStack</a>.<a href="../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a>;
        //Console.println(&quot;  ilen = &quot;+ilen+ &quot; extIndex = &quot;+extIndex);
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#1295763" title="Int">ilen</a> <a href="../../Int.scala.html#57898" title="(x: Int)Boolean">!=</a> <a href="#1294091" title="=&gt; Int">extIndex</a><span class="delimiter">)</span> <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span><a href="#1295763" title="Int">ilen</a> <a href="../../Int.scala.html#57919" title="(x: Int)Boolean">&gt;</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          /** for external source, inpStack == Nil ! need notify of eof! */
          <a href="#1294153" title="()Unit">pop</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#1294100" title="(x$1: Boolean)Unit">reachedEof</a> = <span title="Boolean(true)" class="keyword">true</span>
          <a href="#1294103" title="(x$1: Char)Unit">lastChRead</a> = <span title="Int(0)" class="int">0</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Char" class="delimiter">[</span><a href="../../Char.scala.html#1273" title="Char">Char</a><span class="delimiter">]</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <a href="#1294097" title="(x$1: Boolean)Unit">nextChNeeded</a> = <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span>
    <a href="#1294103" title="=&gt; Char">lastChRead</a>
  <span class="delimiter">}</span>

  /** character buffer, for names */
  <span class="keyword">protected</span> <span class="keyword">val</span> <a title="StringBuilder" id="1294106">cbuf</a> = <a href="../../collection/mutable/StringBuilder.scala.html#66547" title="()StringBuilder" class="keyword">new</a> <a href="../../package.scala.html#57023" title="StringBuilder">StringBuilder</a><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">var</span> <a title="scala.xml.dtd.DTD" id="1294109">dtd</a>: <a href="../dtd/DTD.scala.html#56071" title="scala.xml.dtd.DTD">DTD</a> = <span title="Null(null)" class="keyword">null</span>

  <span class="keyword">protected</span> <span class="keyword">var</span> <a title="scala.xml.Document" id="1294112">doc</a>: <a href="../Document.scala.html#55708" title="scala.xml.Document">Document</a> = <span title="Null(null)" class="keyword">null</span>

  <span class="keyword">def</span> <a title="=&gt; Boolean" id="1294114">eof</a>: <a href="../../Boolean.scala.html#2218" title="Boolean">Boolean</a> = <span class="delimiter">{</span> <a href="#1294105" title="=&gt; Char">ch</a>; <a href="#1294100" title="=&gt; Boolean">reachedEof</a> <span class="delimiter">}</span>

  //
  // methods
  //

  /** {{{
   *  &lt;? prolog ::= xml S ... ?&gt;
   *  }}} */
  <span class="keyword">def</span> <a title="()scala.xml.MetaData" id="1294115">xmlProcInstr</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../MetaData.scala.html#55435" title="scala.xml.MetaData">MetaData</a> = <span class="delimiter">{</span>
    <a href="MarkupParserCommon.scala.html#700546" title="(that: Seq[Char])Unit">xToken</a><span class="delimiter">(</span><a href="../../LowPriorityImplicits.scala.html#8362" title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString" class="string">&quot;xml&quot;</a><span class="delimiter">)</span>
    <a href="MarkupParserCommon.scala.html#700549" title="()Unit">xSpace</a>
    <span class="keyword">val</span> <a href="#1295801" title="(x: (scala.xml.MetaData, scala.xml.NamespaceBinding))(scala.xml.MetaData, scala.xml.NamespaceBinding)" class="delimiter">(</a><a href="../../Tuple2.scala.html#61506" title="scala.xml.MetaData" id="1295778">md</a>,<a href="../../Tuple2.scala.html#61508" title="scala.xml.NamespaceBinding" id="1295779">scp</a><span class="delimiter">)</span> = <a href="#1294126" title="(pscope: scala.xml.NamespaceBinding)(scala.xml.MetaData, scala.xml.NamespaceBinding)">xAttributes</a><a href="../../Tuple2.scala.html#1222" title="(scala.xml.MetaData, scala.xml.NamespaceBinding) @unchecked" class="delimiter">(</a><a href="../TopScope.scala.html#55511" title="scala.xml.TopScope.type">TopScope</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1295779" title="scala.xml.NamespaceBinding">scp</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../TopScope.scala.html#55511" title="scala.xml.TopScope.type">TopScope</a><span class="delimiter">)</span>
      <a href="#1294149" title="(str: String)Unit">reportSyntaxError</a><span class="delimiter">(</span><span title="String(&quot;no xmlns definitions here, please.&quot;)" class="string">&quot;no xmlns definitions here, please.&quot;</span><span class="delimiter">)</span>;
    <a href="MarkupParserCommon.scala.html#700545" title="(that: Char)Unit">xToken</a><span class="delimiter">(</span><span title="Char('?')" class="char">'?'</span><span class="delimiter">)</span>
    <a href="MarkupParserCommon.scala.html#700545" title="(that: Char)Unit">xToken</a><span class="delimiter">(</span><span title="Char('&gt;')" class="char">'&gt;'</span><span class="delimiter">)</span>
    <a href="#1295778" title="scala.xml.MetaData">md</a>
  <span class="delimiter">}</span>

  /** Factored out common code.
   */
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(isProlog: Boolean)(Option[String], Option[String], Option[Boolean])" id="1294116">prologOrTextDecl</a><span class="delimiter">(</span><a title="Boolean" id="1295825">isProlog</a>: <a href="../../Boolean.scala.html#2218" title="Boolean">Boolean</a><span class="delimiter">)</span>: <a href="../../Tuple3.scala.html#214" title="(Option[String], Option[String], Option[Boolean])" class="delimiter">(</a>Option<span class="delimiter">[</span>String<span class="delimiter">]</span>, Option<span class="delimiter">[</span>String<span class="delimiter">]</span>, Option<span class="delimiter">[</span>Boolean<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Option[String]" id="1295827">info_ver</a>: <a href="../../Option.scala.html#1510" title="Option[String]">Option</a><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="../../Option.scala.html#2498" title="None.type">None</a>
    <span class="keyword">var</span> <a title="Option[String]" id="1295828">info_enc</a>: <a href="../../Option.scala.html#1510" title="Option[String]">Option</a><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="../../Option.scala.html#2498" title="None.type">None</a>
    <span class="keyword">var</span> <a title="Option[Boolean]" id="1295829">info_stdl</a>: <a href="../../Option.scala.html#1510" title="Option[Boolean]">Option</a><span class="delimiter">[</span>Boolean<span class="delimiter">]</span> = <a href="../../Option.scala.html#2498" title="None.type">None</a>

    <span class="keyword">var</span> <a title="scala.xml.MetaData" id="1295830">m</a> = <a href="#1294115" title="()scala.xml.MetaData">xmlProcInstr</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">var</span> <a title="Int" id="1295831">n</a> = <span title="Int(0)" class="int">0</span>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1295825" title="Boolean">isProlog</a><span class="delimiter">)</span>
      <a href="MarkupParserCommon.scala.html#700548" title="()Unit">xSpaceOpt</a>

    <a href="../MetaData.scala.html#601897" title="(key: String)Seq[scala.xml.Node]">m</a><a href="#1295853" title="Seq[scala.xml.Node]" class="delimiter">(</a><span title="String(&quot;version&quot;)" class="string">&quot;version&quot;</span><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#1295853" title="Unit" id="1295860" class="keyword">null</a> =&gt;
      <span class="keyword">case</span> <a href="../Text.scala.html#701645" title="Option[String]" id="1295867">Text</a><span class="delimiter">(</span><a href="#1295866" title="Unit" id="1295861" class="string">&quot;1.0&quot;</a><span class="delimiter">)</span> =&gt; <a href="#1295827" title="Option[String]">info_ver</a> = <a href="../../Option.scala.html#64111" title="(x: String)Some[String]">Some</a><span class="delimiter">(</span><span title="String(&quot;1.0&quot;)" class="string">&quot;1.0&quot;</span><span class="delimiter">)</span>; <a href="#1295831" title="Int">n</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
      <span class="keyword">case</span> _     =&gt; <a href="#1294149" title="(str: String)Unit">reportSyntaxError</a><a href="#1295862" title="(x: Unit)Unit" class="delimiter">(</a><span title="String(&quot;cannot deal with versions != 1.0&quot;)" class="string">&quot;cannot deal with versions != 1.0&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="../MetaData.scala.html#601897" title="(key: String)Seq[scala.xml.Node]">m</a><a href="#1295940" title="Seq[scala.xml.Node]" class="delimiter">(</a><span title="String(&quot;encoding&quot;)" class="string">&quot;encoding&quot;</span><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#1295940" title="Unit" id="1295944" class="keyword">null</a> =&gt;
      <span class="keyword">case</span> <a href="../Text.scala.html#701645" title="Option[String]" id="1295950">Text</a><span class="delimiter">(</span>enc<span class="delimiter">)</span> =&gt;
        <a href="#1295945" title="(x: Unit)Unit" class="keyword">if</a> <span class="delimiter">(</span><a href="../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="TokenTests.scala.html#700423" title="(ianaEncoding: Seq[Char])Boolean">isValidIANAEncoding</a><span class="delimiter">(</span><a href="../../LowPriorityImplicits.scala.html#8362" title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString">enc</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#1294149" title="(str: String)Unit">reportSyntaxError</a><span class="delimiter">(</span><span title="String(&quot;\&quot;&quot;)" class="string">&quot;\&quot;&quot;</span> <span title="(x$1: Any)String">+</span> enc <span title="(x$1: Any)String">+</span> <span title="String(&quot;\&quot; is not a valid encoding&quot;)" class="string">&quot;\&quot; is not a valid encoding&quot;</span><span class="delimiter">)</span>
        <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#1295828" title="Option[String]">info_enc</a> = <a href="../../Option.scala.html#64111" title="(x: String)Some[String]">Some</a><span class="delimiter">(</span>enc<span class="delimiter">)</span>
          <a href="#1295831" title="Int">n</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1295825" title="Boolean">isProlog</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../MetaData.scala.html#601897" title="(key: String)Seq[scala.xml.Node]">m</a><a href="#1295985" title="Seq[scala.xml.Node]" class="delimiter">(</a><span title="String(&quot;standalone&quot;)" class="string">&quot;standalone&quot;</span><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="#1295985" title="Unit" id="1295996" class="keyword">null</a> =&gt;
        <span class="keyword">case</span> <a href="../Text.scala.html#701645" title="Option[String]" id="1296004">Text</a><span class="delimiter">(</span><a href="#1296003" title="Unit" id="1295997" class="string">&quot;yes&quot;</a><span class="delimiter">)</span> =&gt; <a href="#1295829" title="Option[Boolean]">info_stdl</a> = <a href="../../Option.scala.html#64111" title="(x: Boolean)Some[Boolean]">Some</a><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>;  <a href="#1295831" title="Int">n</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
        <span class="keyword">case</span> <a href="../Text.scala.html#701645" title="Option[String]" id="1296006">Text</a><span class="delimiter">(</span><a href="#1296005" title="Unit" id="1295998" class="string">&quot;no&quot;</a><span class="delimiter">)</span>  =&gt; <a href="#1295829" title="Option[Boolean]">info_stdl</a> = <a href="../../Option.scala.html#64111" title="(x: Boolean)Some[Boolean]">Some</a><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>; <a href="#1295831" title="Int">n</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
        <span class="keyword">case</span> _     =&gt; <a href="#1294149" title="(str: String)Unit">reportSyntaxError</a><a href="#1295999" title="(x: Unit)Unit" class="delimiter">(</a><span title="String(&quot;either \'yes\' or \'no\' expected&quot;)" class="string">&quot;either 'yes' or 'no' expected&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1295830" title="scala.xml.MetaData">m</a>.<a href="../MetaData.scala.html#601903" title="=&gt; Int">length</a> <a href="../../Int.scala.html#57955" title="(x: Int)Int">-</a> <a href="#1295831" title="Int">n</a> <a href="../../Int.scala.html#57898" title="(x: Int)Boolean">!=</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="String" id="1296028">s</a> = <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#1295825" title="Boolean">isProlog</a><span class="delimiter">)</span> <span title="String(&quot;SDDecl? &quot;)" class="string">&quot;SDDecl? &quot;</span> <span class="keyword">else</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span>
      <a href="#1294149" title="(str: String)Unit">reportSyntaxError</a><span class="delimiter">(</span><a href="../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;VersionInfo EncodingDecl? %sor '?&gt;' expected!&quot;</a> <a href="../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a> <a href="#1296028" title="String">s</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="../../Tuple3.scala.html#64156" title="(_1: Option[String], _2: Option[String], _3: Option[Boolean])(Option[String], Option[String], Option[Boolean])" class="delimiter">(</a><a href="#1295827" title="Option[String]">info_ver</a>, <a href="#1295828" title="Option[String]">info_enc</a>, <a href="#1295829" title="Option[Boolean]">info_stdl</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  /** {{{
   *  &lt;? prolog ::= xml S?
   *  // this is a bit more lenient than necessary...
   *  }}} */
  <span class="keyword">def</span> <a title="()(Option[String], Option[String], Option[Boolean])" id="1294117">prolog</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../../Tuple3.scala.html#214" title="(Option[String], Option[String], Option[Boolean])" class="delimiter">(</a>Option<span class="delimiter">[</span>String<span class="delimiter">]</span>, Option<span class="delimiter">[</span>String<span class="delimiter">]</span>, Option<span class="delimiter">[</span>Boolean<span class="delimiter">]</span><span class="delimiter">)</span> =
    <a href="#1294116" title="(isProlog: Boolean)(Option[String], Option[String], Option[Boolean])">prologOrTextDecl</a><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

  /** prolog, but without standalone */
  <span class="keyword">def</span> <a title="()(Option[String], Option[String])" id="1294118">textDecl</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../../Tuple2.scala.html#1222" title="(Option[String], Option[String])" class="delimiter">(</a>Option<span class="delimiter">[</span>String<span class="delimiter">]</span>, Option<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> =
    <a href="#1294116" title="(isProlog: Boolean)(Option[String], Option[String], Option[Boolean])">prologOrTextDecl</a><a href="#1296060" title="(Option[String], Option[String])" class="delimiter">(</a><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span> <span class="keyword">case</span> <span class="delimiter">(</span>x1, x2, _<span class="delimiter">)</span>  =&gt; <a href="#1296062" title="(x: (Option[String], Option[String]))(Option[String], Option[String])" class="delimiter">(</a>x1, x2<span class="delimiter">)</span> <span class="delimiter">}</span>

  /** {{{
   *  [22]     prolog      ::= XMLDecl? Misc* (doctypedecl Misc*)?
   *  [23]     XMLDecl     ::= '&lt;?xml' VersionInfo EncodingDecl? SDDecl? S? '?&gt;'
   *  [24]     VersionInfo ::= S 'version' Eq (&quot;'&quot; VersionNum &quot;'&quot; | '&quot;' VersionNum '&quot;')
   *  [25]     Eq          ::= S? '=' S?
   *  [26]     VersionNum  ::= '1.0'
   *  [27]     Misc        ::= Comment | PI | S
   * }}} */
  <span class="keyword">def</span> <a title="()scala.xml.Document" id="1294119">document</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../Document.scala.html#55708" title="scala.xml.Document">Document</a> = <span class="delimiter">{</span>
    <a href="#1294112" title="(x$1: scala.xml.Document)Unit">doc</a> = <span title="scala.xml.Document" class="keyword">new</span> <a href="../Document.scala.html#55708" title="scala.xml.Document">Document</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <a href="#56396" title="scala.xml.parsing.&lt;refinement&gt;.type" class="keyword">this</a>.<a href="#1294109" title="(x$1: scala.xml.dtd.DTD)Unit">dtd</a> = <span title="Null(null)" class="keyword">null</span>
    <span class="keyword">var</span> <a title="(Option[String], Option[String], Option[Boolean])" id="1296067">info_prolog</a>: <a href="../../Tuple3.scala.html#214" title="(Option[String], Option[String], Option[Boolean])" class="delimiter">(</a>Option<span class="delimiter">[</span>String<span class="delimiter">]</span>, Option<span class="delimiter">[</span>String<span class="delimiter">]</span>, Option<span class="delimiter">[</span>Boolean<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="../../Tuple3.scala.html#64156" title="(_1: None.type, _2: None.type, _3: None.type)(None.type, None.type, None.type)" class="delimiter">(</a><a href="../../Option.scala.html#2498" title="None.type">None</a>, <a href="../../Option.scala.html#2498" title="None.type">None</a>, <a href="../../Option.scala.html#2498" title="None.type">None</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="Char('&lt;')" class="char">'&lt;'</span> <a href="../../Char.scala.html#58048" title="(x: Char)Boolean">!=</a> <a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#1294149" title="(str: String)Unit">reportSyntaxError</a><span class="delimiter">(</span><span title="String(&quot;&lt; expected&quot;)" class="string">&quot;&lt; expected&quot;</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <span title="Null(null)" class="keyword">null</span>
    <span class="delimiter">}</span>

    <a href="#1294125" title="()Unit">nextch</a> // is prolog ?
    <span class="keyword">var</span> <a title="scala.xml.NodeSeq" id="1296068">children</a>: <a href="../NodeSeq.scala.html#55450" title="scala.xml.NodeSeq">NodeSeq</a> = <span title="Null(null)" class="keyword">null</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="Char('?')" class="char">'?'</span> <a href="../../Char.scala.html#58041" title="(x: Char)Boolean">==</a> <a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#1294125" title="()Unit">nextch</a>
      <a href="#1296067" title="(Option[String], Option[String], Option[Boolean])">info_prolog</a> = <a href="#1294117" title="()(Option[String], Option[String], Option[Boolean])">prolog</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#1294112" title="=&gt; scala.xml.Document">doc</a>.<a href="../Document.scala.html#1266208" title="(x$1: Option[String])Unit">version</a>    = <a href="#1296067" title="(Option[String], Option[String], Option[Boolean])">info_prolog</a>.<a href="../../Tuple3.scala.html#61402" title="=&gt; Option[String]">_1</a>
      <a href="#1294112" title="=&gt; scala.xml.Document">doc</a>.<a href="../Document.scala.html#1266202" title="(x$1: Option[String])Unit">encoding</a>   = <a href="#1296067" title="(Option[String], Option[String], Option[Boolean])">info_prolog</a>.<a href="../../Tuple3.scala.html#61404" title="=&gt; Option[String]">_2</a>
      <a href="#1294112" title="=&gt; scala.xml.Document">doc</a>.<a href="../Document.scala.html#1266205" title="(x$1: Option[Boolean])Unit">standAlone</a> = <a href="#1296067" title="(Option[String], Option[String], Option[Boolean])">info_prolog</a>.<a href="../../Tuple3.scala.html#61406" title="=&gt; Option[Boolean]">_3</a>

      <a href="#1296068" title="scala.xml.NodeSeq">children</a> = <a href="#1294132" title="(pscope: scala.xml.NamespaceBinding)scala.xml.NodeSeq">content</a><span class="delimiter">(</span><a href="../TopScope.scala.html#55511" title="scala.xml.TopScope.type">TopScope</a><span class="delimiter">)</span> // DTD handled as side effect
    <span class="delimiter">}</span>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.xml.NodeBuffer" id="1296100">ts</a> = <span title="scala.xml.NodeBuffer" class="keyword">new</span> <a href="../NodeBuffer.scala.html#55600" title="scala.xml.NodeBuffer">NodeBuffer</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#1294131" title="(pscope: scala.xml.NamespaceBinding, ts: scala.xml.NodeBuffer)Unit">content1</a><span class="delimiter">(</span><a href="../TopScope.scala.html#55511" title="scala.xml.TopScope.type">TopScope</a>, <a href="#1296100" title="scala.xml.NodeBuffer">ts</a><span class="delimiter">)</span>  // DTD handled as side effect
      <a href="#1296100" title="scala.xml.NodeBuffer">ts</a> <a href="../NodeBuffer.scala.html#811636" title="(o: Any)scala.xml.NodeBuffer">&amp;+</a> <a href="#1294132" title="(pscope: scala.xml.NamespaceBinding)scala.xml.NodeSeq">content</a><span class="delimiter">(</span><a href="../TopScope.scala.html#55511" title="scala.xml.TopScope.type">TopScope</a><span class="delimiter">)</span>
      <a href="#1296068" title="scala.xml.NodeSeq">children</a> = <a href="../NodeSeq.scala.html#55451" title="scala.xml.NodeSeq.type">NodeSeq</a>.<a href="../NodeSeq.scala.html#605486" title="(s: Seq[scala.xml.Node])scala.xml.NodeSeq">fromSeq</a><span class="delimiter">(</span><a href="#1296100" title="scala.xml.NodeBuffer">ts</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    //println(&quot;[MarkupParser::document] children now: &quot;+children.toList)
    <span class="keyword">var</span> <a title="Int" id="1296069">elemCount</a> = <span title="Int(0)" class="int">0</span>
    <span class="keyword">var</span> <a title="scala.xml.Node" id="1296070">theNode</a>: <a href="../Node.scala.html#55561" title="scala.xml.Node">Node</a> = <span title="Null(null)" class="keyword">null</span>
    <span class="keyword">for</span> <span class="delimiter">(</span>c &lt;- <a href="../../collection/IterableLike.scala.html#59458" title="(f: scala.xml.Node =&gt; Unit)Unit">children</a><span class="delimiter">)</span> <a href="#1296135" title="scala.xml.Node">c</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> _:ProcInstr =&gt;
      <span class="keyword">case</span> _:Comment =&gt;
      <span class="keyword">case</span> _:EntityRef =&gt; // todo: fix entities, shouldn't be &quot;special&quot;
        <a href="#1294149" title="(str: String)Unit">reportSyntaxError</a><a href="#1296166" title="(x: Unit)Unit" class="delimiter">(</a><span title="String(&quot;no entity references allowed here&quot;)" class="string">&quot;no entity references allowed here&quot;</span><span class="delimiter">)</span>;
      <span class="keyword">case</span> <a href="#1296160" title="Unit" id="1296164">s</a>:SpecialNode =&gt;
        <a href="#1296166" title="(x: Unit)Unit" class="keyword">if</a> <span class="delimiter">(</span>s.<a href="../Node.scala.html#601855" title="()String">toString</a>.<span title="()String">trim</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()Int">length</span> <a href="../../Int.scala.html#57919" title="(x: Int)Boolean">&gt;</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> //non-empty text nodes not allowed
          <a href="#1296069" title="Int">elemCount</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+=</a> <span title="Int(2)" class="int">2</span>
      <span class="keyword">case</span> <a href="#1296160" title="Unit" id="1296165">m</a>:Node =&gt;
        <a href="#1296069" title="Int">elemCount</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
        <a href="#1296070" title="scala.xml.Node">theNode</a> = m
    <span class="delimiter">}</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="Int(1)" class="int">1</span> <a href="../../Int.scala.html#57898" title="(x: Int)Boolean">!=</a> <a href="#1296069" title="Int">elemCount</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#1294149" title="(str: String)Unit">reportSyntaxError</a><span class="delimiter">(</span><span title="String(&quot;document must contain exactly one element&quot;)" class="string">&quot;document must contain exactly one element&quot;</span><span class="delimiter">)</span>
      <a href="../../Console.scala.html#227" title="Console.type">Console</a>.<a href="../../Console.scala.html#64301" title="(x: Any)Unit">println</a><span class="delimiter">(</span><a href="#1296068" title="scala.xml.NodeSeq">children</a>.<a href="../../collection/TraversableOnce.scala.html#59174" title="=&gt; List[scala.xml.Node]">toList</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="#1294112" title="=&gt; scala.xml.Document">doc</a>.<a href="../Document.scala.html#1266188" title="(x$1: Seq[scala.xml.Node])Unit">children</a> = <a href="#1296068" title="scala.xml.NodeSeq">children</a>
    <a href="#1294112" title="=&gt; scala.xml.Document">doc</a>.<a href="../Document.scala.html#1266191" title="(x$1: scala.xml.Node)Unit">docElem</a> = <a href="#1296070" title="scala.xml.Node">theNode</a>
    <a href="#1294112" title="=&gt; scala.xml.Document">doc</a>
  <span class="delimiter">}</span>

  /** append Unicode character to name buffer*/
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(c: Char)StringBuilder" id="1294120">putChar</a><span class="delimiter">(</span><a title="Char" id="1296197">c</a>: <a href="../../Char.scala.html#1273" title="Char">Char</a><span class="delimiter">)</span> = <a href="#1294106" title="=&gt; StringBuilder">cbuf</a> <a href="../../collection/mutable/StringBuilder.scala.html#66582" title="(x: Char)StringBuilder">append</a> <a href="#1296197" title="Char">c</a>

  /** As the current code requires you to call nextch once manually
   *  after construction, this method formalizes that suboptimal reality.
   */
  <span class="keyword">def</span> <a title="=&gt; scala.xml.parsing.&lt;refinement&gt;.type" id="1294121">initialize</a>: <span class="keyword">this</span>.<span class="keyword">type</span> = <span class="delimiter">{</span>
    <a href="#1294125" title="()Unit">nextch</a>
    <a href="#56396" title="scala.xml.parsing.&lt;refinement&gt;.type" class="keyword">this</a>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="=&gt; Char" id="1294122">ch_returning_nextch</a>: <a href="../../Char.scala.html#1273" title="Char">Char</a> = <span class="delimiter">{</span> <span class="keyword">val</span> <a title="Char" id="1296206">res</a> = <a href="#1294105" title="=&gt; Char">ch</a>; <a href="#1294125" title="()Unit">nextch</a><span class="delimiter">(</span><span class="delimiter">)</span>; <a href="#1296206" title="Char">res</a> <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(name: String, pscope: scala.xml.NamespaceBinding)(scala.xml.MetaData, scala.xml.NamespaceBinding)" id="1294123">mkAttributes</a><span class="delimiter">(</span><a title="String" id="1296207">name</a>: <span title="String">String</span>, <a title="scala.xml.NamespaceBinding" id="1296208">pscope</a>: <a href="../NamespaceBinding.scala.html#55606" title="scala.xml.NamespaceBinding">NamespaceBinding</a><span class="delimiter">)</span>: <a href="../../Tuple2.scala.html#1222" title="(scala.xml.MetaData, scala.xml.NamespaceBinding)">AttributesType</a> =
    <span title="(scala.xml.MetaData, scala.xml.NamespaceBinding)" class="keyword">if</span> <span class="delimiter">(</span><a href="TokenTests.scala.html#700420" title="(ch: Char)Boolean">isNameStart</a> <span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#1294126" title="(pscope: scala.xml.NamespaceBinding)(scala.xml.MetaData, scala.xml.NamespaceBinding)">xAttributes</a><span class="delimiter">(</span><a href="#1296208" title="scala.xml.NamespaceBinding">pscope</a><span class="delimiter">)</span>
    <span class="keyword">else</span> <a href="../../Tuple2.scala.html#63804" title="(_1: scala.xml.Null.type, _2: scala.xml.NamespaceBinding)(scala.xml.Null.type, scala.xml.NamespaceBinding)" class="delimiter">(</a><a href="../Null.scala.html#55499" title="scala.xml.Null.type">Null</a>, <a href="#1296208" title="scala.xml.NamespaceBinding">pscope</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(position: Int, name: String, text: String)MarkupParser.this.ElementType" id="1294124">mkProcInstr</a><span class="delimiter">(</span><a title="Int" id="1296218">position</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <a title="String" id="1296219">name</a>: <span title="String">String</span>, <a title="String" id="1296220">text</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../NodeSeq.scala.html#55450" title="MarkupParser.this.ElementType">ElementType</a> =
    <a href="#1294082" title="=&gt; scala.xml.parsing.MarkupHandler">handle</a>.<a href="MarkupHandler.scala.html#1290233" title="(pos: Int, target: String, txt: String)scala.xml.NodeSeq">procInstr</a><span class="delimiter">(</span><a href="#1296218" title="Int">position</a>, <a href="#1296219" title="String">name</a>, <a href="#1296220" title="String">text</a><span class="delimiter">)</span>

  /** this method tells ch to get the next character when next called */
  <span class="keyword">def</span> <a title="()Unit" id="1294125">nextch</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    // Read current ch if needed
    <a href="#1294105" title="=&gt; Char">ch</a>

    // Mark next ch to be required
    <a href="#1294097" title="(x$1: Boolean)Unit">nextChNeeded</a> = <span title="Boolean(true)" class="keyword">true</span>
  <span class="delimiter">}</span>

  /** parse attribute and create namespace scope, metadata
   *  {{{
   *  [41] Attributes    ::= { S Name Eq AttValue }
   *  }}}
   */
  <span class="keyword">def</span> <a title="(pscope: scala.xml.NamespaceBinding)(scala.xml.MetaData, scala.xml.NamespaceBinding)" id="1294126">xAttributes</a><span class="delimiter">(</span><a title="scala.xml.NamespaceBinding" id="1295787">pscope</a>: <a href="../NamespaceBinding.scala.html#55606" title="scala.xml.NamespaceBinding">NamespaceBinding</a><span class="delimiter">)</span>: <a href="../../Tuple2.scala.html#1222" title="(scala.xml.MetaData, scala.xml.NamespaceBinding)" class="delimiter">(</a>MetaData, NamespaceBinding<span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="scala.xml.NamespaceBinding" id="1296225">scope</a>: <a href="../NamespaceBinding.scala.html#55606" title="scala.xml.NamespaceBinding">NamespaceBinding</a> = <a href="#1295787" title="scala.xml.NamespaceBinding">pscope</a>
    <span class="keyword">var</span> <a title="scala.xml.MetaData" id="1296226">aMap</a>: <a href="../MetaData.scala.html#55435" title="scala.xml.MetaData">MetaData</a> = <a href="../Null.scala.html#55499" title="scala.xml.Null.type">Null</a>
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="TokenTests.scala.html#700420" title="(ch: Char)Boolean">isNameStart</a><span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#1296227" title="()Unit" class="delimiter">{</a>
      <span class="keyword">val</span> <a title="Int" id="1296228">pos</a> = <a href="#56396" title="scala.xml.parsing.&lt;refinement&gt;.type" class="keyword">this</a>.<a href="#1294088" title="=&gt; Int">pos</a>

      <span class="keyword">val</span> <a title="String" id="1296229">qname</a> = <a href="MarkupParserCommon.scala.html#700524" title="=&gt; String">xName</a>
      <span class="keyword">val</span> <a title="Unit" id="1296230">_</a>     = <a href="MarkupParserCommon.scala.html#700547" title="()Unit">xEQ</a>
      <span class="keyword">val</span> <a title="String" id="1296231">value</a> = <a href="MarkupParserCommon.scala.html#700521" title="()String">xAttributeValue</a><span class="delimiter">(</span><span class="delimiter">)</span>

      <a href="../Utility.scala.html#55457" title="scala.xml.Utility.type">Utility</a>.<a href="../Utility.scala.html#700405" title="(name: String)Option[String]">prefix</a><a href="../../Option.scala.html#64115" title="=&gt; String" class="delimiter">(</a><a href="#1296229" title="String">qname</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Some<a href="#1296262" title="Boolean" id="1296264" class="delimiter">(</a><a href="#1296273" title="Unit" id="1296268" class="string">&quot;xmlns&quot;</a><span class="delimiter">)</span> =&gt;
          <span class="keyword">val</span> <a title="String" id="1296237">prefix</a> = <a href="#1296229" title="String">qname</a>.<span title="(x$1: Int, x$2: Int)String">substring</span><span class="delimiter">(</span><span title="Int(6)" class="int">6</span> /*xmlns:*/ , <a href="#1296229" title="String">qname</a>.<span title="()Int">length</span><span class="delimiter">)</span>
          <a href="#1296225" title="scala.xml.NamespaceBinding">scope</a> = <span title="scala.xml.NamespaceBinding" class="keyword">new</span> <a href="../NamespaceBinding.scala.html#55606" title="scala.xml.NamespaceBinding">NamespaceBinding</a><span class="delimiter">(</span><a href="#1296237" title="String">prefix</a>, <a href="#1296231" title="String">value</a>, <a href="#1296225" title="scala.xml.NamespaceBinding">scope</a><span class="delimiter">)</span>

        <span class="keyword">case</span> Some<span class="delimiter">(</span>prefix<span class="delimiter">)</span> =&gt;
          <span class="keyword">val</span> <a title="String" id="1296242">key</a> = <a href="#1296229" title="String">qname</a>.<span title="(x$1: Int, x$2: Int)String">substring</span><span class="delimiter">(</span>prefix.<span title="()Int">length</span><a href="../../Int.scala.html#57948" title="(x: Int)Int">+</a><span title="Int(1)" class="int">1</span>, <a href="#1296229" title="String">qname</a>.<span title="()Int">length</span><span class="delimiter">)</span>
          <a href="#1296226" title="scala.xml.MetaData">aMap</a> = <span title="scala.xml.PrefixedAttribute" class="keyword">new</span> <a href="../PrefixedAttribute.scala.html#55504" title="scala.xml.PrefixedAttribute">PrefixedAttribute</a><span class="delimiter">(</span>prefix, <a href="#1296242" title="String">key</a>, <a href="../Text.scala.html#701644" title="(data: String)scala.xml.Text">Text</a><span class="delimiter">(</span><a href="#1296231" title="String">value</a><span class="delimiter">)</span>, <a href="#1296226" title="scala.xml.MetaData">aMap</a><span class="delimiter">)</span>

        <span class="keyword">case</span> _ =&gt;
          <a href="#1296270" title="(x: Unit)Unit" class="keyword">if</a><span class="delimiter">(</span> <a href="#1296229" title="String">qname</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="String(&quot;xmlns&quot;)" class="string">&quot;xmlns&quot;</span> <span class="delimiter">)</span>
            <a href="#1296225" title="scala.xml.NamespaceBinding">scope</a> = <span title="scala.xml.NamespaceBinding" class="keyword">new</span> <a href="../NamespaceBinding.scala.html#55606" title="scala.xml.NamespaceBinding">NamespaceBinding</a><span class="delimiter">(</span><span title="Null(null)" class="keyword">null</span>, <a href="#1296231" title="String">value</a>, <a href="#1296225" title="scala.xml.NamespaceBinding">scope</a><span class="delimiter">)</span>
          <span class="keyword">else</span>
            <a href="#1296226" title="scala.xml.MetaData">aMap</a> = <span title="scala.xml.UnprefixedAttribute" class="keyword">new</span> <a href="../UnprefixedAttribute.scala.html#55564" title="scala.xml.UnprefixedAttribute">UnprefixedAttribute</a><span class="delimiter">(</span><a href="#1296229" title="String">qname</a>, <a href="../Text.scala.html#701644" title="(data: String)scala.xml.Text">Text</a><span class="delimiter">(</span><a href="#1296231" title="String">value</a><span class="delimiter">)</span>, <a href="#1296226" title="scala.xml.MetaData">aMap</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a> <a href="../../Char.scala.html#58048" title="(x: Char)Boolean">!=</a> <span title="Char('/')" class="char">'/'</span><span class="delimiter">)</span> <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a> <a href="../../Char.scala.html#58048" title="(x: Char)Boolean">!=</a> <span title="Char('&gt;')" class="char">'&gt;'</span><span class="delimiter">)</span> <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span><span title="Char('?')" class="char">'?'</span> <a href="../../Char.scala.html#58048" title="(x: Char)Boolean">!=</a> <a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="MarkupParserCommon.scala.html#700549" title="()Unit">xSpace</a>
    <span class="delimiter">}</span>

    <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1296226" title="scala.xml.MetaData">aMap</a>.<a href="../MetaData.scala.html#601922" title="(scope: scala.xml.NamespaceBinding)Boolean">wellformed</a><span class="delimiter">(</span><a href="#1296225" title="scala.xml.NamespaceBinding">scope</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#1294149" title="(str: String)Unit">reportSyntaxError</a><span class="delimiter">(</span> <span title="String(&quot;double attribute&quot;)" class="string">&quot;double attribute&quot;</span><span class="delimiter">)</span>;

    <a href="../../Tuple2.scala.html#63804" title="(_1: scala.xml.MetaData, _2: scala.xml.NamespaceBinding)(scala.xml.MetaData, scala.xml.NamespaceBinding)" class="delimiter">(</a><a href="#1296226" title="scala.xml.MetaData">aMap</a>,<a href="#1296225" title="scala.xml.NamespaceBinding">scope</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  /** entity value, terminated by either ' or &quot;. value may not contain &amp;lt;.
   *  {{{
   *       AttValue     ::= `'` { _  } `'`
   *                      | `&quot;` { _ } `&quot;`
   *  }}}
   */
  <span class="keyword">def</span> <a title="()String" id="1294127">xEntityValue</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Char" id="1296305">endch</a> = <a href="#1294105" title="=&gt; Char">ch</a>
    <a href="#1294125" title="()Unit">nextch</a>
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a> <a href="../../Char.scala.html#58048" title="(x: Char)Boolean">!=</a> <a href="#1296305" title="Char">endch</a> <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1294114" title="=&gt; Boolean">eof</a><span class="delimiter">)</span> <a href="#1296307" title="()Unit" class="delimiter">{</a>
      <a href="#1294120" title="(c: Char)StringBuilder">putChar</a><span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span>
      <a href="#1294125" title="()Unit">nextch</a>
    <span class="delimiter">}</span>
    <a href="#1294125" title="()Unit">nextch</a>
    <span class="keyword">val</span> <a title="String" id="1296306">str</a> = <a href="#1294106" title="=&gt; StringBuilder">cbuf</a>.<a href="../../collection/mutable/StringBuilder.scala.html#66605" title="()String">toString</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#1294106" title="=&gt; StringBuilder">cbuf</a>.<a href="../../collection/mutable/StringBuilder.scala.html#66552" title="(n: Int)Unit">length</a> = <span title="Int(0)" class="int">0</span>
    <a href="#1296306" title="String">str</a>
  <span class="delimiter">}</span>

  /** {{{
   *  '&lt;! CharData ::= [CDATA[ ( {char} - {char}&quot;]]&gt;&quot;{char} ) ']]&gt;'
   *
   *  see [15]
   *  }}} */
  <span class="keyword">def</span> <a title="=&gt; scala.xml.NodeSeq" id="1294128">xCharData</a>: <a href="../NodeSeq.scala.html#55450" title="scala.xml.NodeSeq">NodeSeq</a> = <span class="delimiter">{</span>
    <a href="MarkupParserCommon.scala.html#700546" title="(that: Seq[Char])Unit">xToken</a><span class="delimiter">(</span><a href="../../LowPriorityImplicits.scala.html#8362" title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString" class="string">&quot;[CDATA[&quot;</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(pos: Int, s: String)scala.xml.NodeSeq" id="1296315">mkResult</a><span class="delimiter">(</span><a title="Int" id="1296322">pos</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <a title="String" id="1296323">s</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../NodeSeq.scala.html#55450" title="scala.xml.NodeSeq">NodeSeq</a> = <span class="delimiter">{</span>
      <a href="#1294082" title="=&gt; scala.xml.parsing.MarkupHandler">handle</a>.<a href="MarkupHandler.scala.html#1290236" title="(pos: Int, txt: String)scala.xml.NodeSeq">text</a><span class="delimiter">(</span><a href="#1296322" title="Int">pos</a>, <a href="#1296323" title="String">s</a><span class="delimiter">)</span>
      <a href="../PCData.scala.html#1280417" title="(data: String)scala.xml.PCData">PCData</a><span class="delimiter">(</span><a href="#1296323" title="String">s</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="MarkupParserCommon.scala.html#700558" title="(handler: (MarkupParser.this.PositionType, String) =&gt; scala.xml.NodeSeq, positioner: () =&gt; MarkupParser.this.PositionType, until: String)scala.xml.NodeSeq">xTakeUntil</a><span class="delimiter">(</span><a href="#1296315" title="(pos: Int, s: String)scala.xml.NodeSeq">mkResult</a>, <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#1294088" title="=&gt; Int">pos</a>, <span title="String(&quot;]]&gt;&quot;)" class="string">&quot;]]&gt;&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  /** {{{
   *  Comment ::= '&lt;!--' ((Char - '-') | ('-' (Char - '-')))* '--&gt;'
   *
   * see [15]
   *  }}} */
  <span class="keyword">def</span> <a title="=&gt; scala.xml.NodeSeq" id="1294129">xComment</a>: <a href="../NodeSeq.scala.html#55450" title="scala.xml.NodeSeq">NodeSeq</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="StringBuilder" id="1296340">sb</a>: <a href="../../collection/mutable/StringBuilder.scala.html#13495" title="StringBuilder">StringBuilder</a> = <a href="../../collection/mutable/StringBuilder.scala.html#66547" title="()StringBuilder" class="keyword">new</a> <a href="../../package.scala.html#57023" title="StringBuilder">StringBuilder</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="MarkupParserCommon.scala.html#700546" title="(that: Seq[Char])Unit">xToken</a><span class="delimiter">(</span><a href="../../LowPriorityImplicits.scala.html#8362" title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString" class="string">&quot;--&quot;</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <a href="#1296341" title="()Unit" class="delimiter">{</a>
      <span title="StringBuilder" class="keyword">if</span> <span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a> <a href="../../Char.scala.html#58041" title="(x: Char)Boolean">==</a> <span title="Char('-')" class="char">'-'</span>  <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">{</span> <a href="#1296340" title="StringBuilder">sb</a>.<a href="../../collection/mutable/StringBuilder.scala.html#66582" title="(x: Char)StringBuilder">append</a><span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span>; <a href="#1294125" title="()Unit">nextch</a>; <a href="#1294105" title="=&gt; Char">ch</a> <a href="../../Char.scala.html#58041" title="(x: Char)Boolean">==</a> <span title="Char('-')" class="char">'-'</span> <span class="delimiter">}</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#1296340" title="StringBuilder">sb</a>.<a href="../../collection/mutable/StringBuilder.scala.html#66552" title="(n: Int)Unit">length</a> = <a href="#1296340" title="StringBuilder">sb</a>.<a href="../../collection/mutable/StringBuilder.scala.html#66551" title="=&gt; Int">length</a> <a href="../../Int.scala.html#57955" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span>
        <a href="#1294125" title="()Unit">nextch</a>
        <a href="MarkupParserCommon.scala.html#700545" title="(that: Char)Unit">xToken</a><span class="delimiter">(</span><span title="Char('&gt;')" class="char">'&gt;'</span><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">return</span> <a href="#1294082" title="=&gt; scala.xml.parsing.MarkupHandler">handle</a>.<a href="MarkupHandler.scala.html#1290234" title="(pos: Int, comment: String)scala.xml.NodeSeq">comment</a><span class="delimiter">(</span><a href="#1294088" title="=&gt; Int">pos</a>, <a href="#1296340" title="StringBuilder">sb</a>.<a href="../../collection/mutable/StringBuilder.scala.html#66605" title="()String">toString</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#1296340" title="StringBuilder">sb</a>.<a href="../../collection/mutable/StringBuilder.scala.html#66582" title="(x: Char)StringBuilder">append</a><span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span>
      <a href="#1294125" title="()Unit">nextch</a>
    <span class="delimiter">}</span>
    <span title="Nothing" class="keyword">throw</span> <a href="FatalError.scala.html#1295417" title="(msg: String)scala.xml.parsing.FatalError">FatalError</a><span class="delimiter">(</span><span title="String(&quot;this cannot happen&quot;)" class="string">&quot;this cannot happen&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  /* todo: move this into the NodeBuilder class */
  <span class="keyword">def</span> <a title="(pos: Int, ts: scala.xml.NodeBuffer, txt: String)Unit" id="1294130">appendText</a><span class="delimiter">(</span><a title="Int" id="1296379">pos</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <a title="scala.xml.NodeBuffer" id="1296380">ts</a>: <a href="../NodeBuffer.scala.html#55600" title="scala.xml.NodeBuffer">NodeBuffer</a>, <a title="String" id="1296381">txt</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../../Unit.scala.html#2389" title="Unit">Unit</a> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1294075" title="=&gt; Boolean">preserveWS</a><span class="delimiter">)</span>
      <a href="#1296380" title="scala.xml.NodeBuffer">ts</a> <a href="../NodeBuffer.scala.html#811636" title="(o: Any)scala.xml.NodeBuffer">&amp;+</a> <a href="#1294082" title="=&gt; scala.xml.parsing.MarkupHandler">handle</a>.<a href="MarkupHandler.scala.html#1290236" title="(pos: Int, txt: String)scala.xml.NodeSeq">text</a><span class="delimiter">(</span><a href="#1296379" title="Int">pos</a>, <a href="#1296381" title="String">txt</a><span class="delimiter">)</span>;
    <span class="keyword">else</span>
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="scala.xml.Text" id="1296401">t</a> &lt;- <a href="../TextBuffer.scala.html#55730" title="scala.xml.TextBuffer.type">TextBuffer</a>.<a href="../TextBuffer.scala.html#701587" title="(str: String)scala.xml.TextBuffer">fromString</a><span class="delimiter">(</span><a href="#1296381" title="String">txt</a><span class="delimiter">)</span>.<a href="../../collection/IterableLike.scala.html#59458" title="(f: scala.xml.Text =&gt; scala.xml.NodeBuffer)Unit">toText</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#1296380" title="scala.xml.NodeBuffer">ts</a> <a href="../NodeBuffer.scala.html#811636" title="(o: Any)scala.xml.NodeBuffer">&amp;+</a> <a href="#1294082" title="=&gt; scala.xml.parsing.MarkupHandler">handle</a>.<a href="MarkupHandler.scala.html#1290236" title="(pos: Int, txt: String)scala.xml.NodeSeq">text</a><span class="delimiter">(</span><a href="#1296379" title="Int">pos</a>, <a href="#1296401" title="scala.xml.Text">t</a>.<a href="../Atom.scala.html#701632" title="=&gt; String">text</a><span class="delimiter">)</span>;
      <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** {{{
   *  '&lt;' content1 ::=  ...
   *  }}} */
  <span class="keyword">def</span> <a title="(pscope: scala.xml.NamespaceBinding, ts: scala.xml.NodeBuffer)Unit" id="1294131">content1</a><span class="delimiter">(</span><a title="scala.xml.NamespaceBinding" id="1296101">pscope</a>: <a href="../NamespaceBinding.scala.html#55606" title="scala.xml.NamespaceBinding">NamespaceBinding</a>, <a title="scala.xml.NodeBuffer" id="1296102">ts</a>: <a href="../NodeBuffer.scala.html#55600" title="scala.xml.NodeBuffer">NodeBuffer</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#1294105" title="=&gt; Char">ch</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span class="char">'!'</span> =&gt;
        <a href="#1294125" title="()Unit">nextch</a>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="Char('[')" class="char">'['</span> <a href="../../Char.scala.html#58041" title="(x: Char)Boolean">==</a> <a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span>                 // CDATA
        <a href="#1296102" title="scala.xml.NodeBuffer">ts</a> <a href="../NodeBuffer.scala.html#811636" title="(o: Any)scala.xml.NodeBuffer">&amp;+</a> <a href="#1294128" title="=&gt; scala.xml.NodeSeq">xCharData</a>
      <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="Char('D')" class="char">'D'</span> <a href="../../Char.scala.html#58041" title="(x: Char)Boolean">==</a> <a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span> // doctypedecl, parse DTD // @todo REMOVE HACK
        <a href="#1294134" title="()Unit">parseDTD</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">else</span> // comment
        <a href="#1296102" title="scala.xml.NodeBuffer">ts</a> <a href="../NodeBuffer.scala.html#811636" title="(o: Any)scala.xml.NodeBuffer">&amp;+</a> <a href="#1294129" title="=&gt; scala.xml.NodeSeq">xComment</a>
      <span class="keyword">case</span> <span class="char">'?'</span> =&gt;                    // PI
        <a href="#1294125" title="()Unit">nextch</a>
        <a href="#1296102" title="scala.xml.NodeBuffer">ts</a> <a href="../NodeBuffer.scala.html#811636" title="(o: Any)scala.xml.NodeBuffer">&amp;+</a> <a href="MarkupParserCommon.scala.html#700519" title="=&gt; MarkupParser.this.ElementType">xProcInstr</a>
      <span class="keyword">case</span> _   =&gt;
        <a href="#1296102" title="scala.xml.NodeBuffer">ts</a> <a href="../NodeBuffer.scala.html#811636" title="Unit">&amp;+</a> <a href="#1294136" title="(pscope: scala.xml.NamespaceBinding)scala.xml.NodeSeq">element1</a><span class="delimiter">(</span><a href="#1296101" title="scala.xml.NamespaceBinding">pscope</a><span class="delimiter">)</span>      // child
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** {{{
   *  content1 ::=  '&lt;' content1 | '&amp;' charref ...
   *  }}} */
  <span class="keyword">def</span> <a title="(pscope: scala.xml.NamespaceBinding)scala.xml.NodeSeq" id="1294132">content</a><span class="delimiter">(</span><a title="scala.xml.NamespaceBinding" id="1296098">pscope</a>: <a href="../NamespaceBinding.scala.html#55606" title="scala.xml.NamespaceBinding">NamespaceBinding</a><span class="delimiter">)</span>: <a href="../NodeSeq.scala.html#55450" title="scala.xml.NodeSeq">NodeSeq</a> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="scala.xml.NodeBuffer" id="1296424">ts</a> = <span title="scala.xml.NodeBuffer" class="keyword">new</span> <a href="../NodeBuffer.scala.html#55600" title="scala.xml.NodeBuffer">NodeBuffer</a>
    <span class="keyword">var</span> <a title="Boolean" id="1296425">exit</a> = <a href="#1294114" title="=&gt; Boolean">eof</a>
    // todo: optimize seq repr.
    <span class="keyword">def</span> <a title="=&gt; scala.xml.NodeSeq{val theSeq: List[scala.xml.Node]}" id="1296426">done</a> = <a href="#1296428" title="scala.xml.NodeSeq{}" class="keyword">new</a> <a href="../NodeSeq.scala.html#55450" title="anonymous class $anon extends scala.xml.NodeSeq" id="1296428">NodeSeq</a> <span class="delimiter">{</span> <span class="keyword">val</span> <a title="List[scala.xml.Node]" id="1296430">theSeq</a> = <a href="#1296424" title="scala.xml.NodeBuffer">ts</a>.<a href="../../collection/TraversableOnce.scala.html#59174" title="=&gt; List[scala.xml.Node]">toList</a> <span class="delimiter">}</span>

    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1296425" title="Boolean">exit</a><span class="delimiter">)</span> <a href="#1296427" title="()Unit" class="delimiter">{</a>
      <a href="#1294094" title="(x$1: Int)Unit">tmppos</a> = <a href="#1294088" title="=&gt; Int">pos</a>
      <a href="#1296425" title="Boolean">exit</a> = <a href="#1294114" title="=&gt; Boolean">eof</a>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1294114" title="=&gt; Boolean">eof</a><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">return</span> <a href="#1296426" title="=&gt; scala.xml.NodeSeq{val theSeq: List[scala.xml.Node]}">done</a>

      <a href="#1294105" title="=&gt; Char">ch</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span class="char">'&lt;'</span> =&gt; // another tag
          <a href="#1294125" title="()Unit">nextch</a>; <a href="#1294105" title="=&gt; Char">ch</a> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a href="../../Char.scala.html#58041" title="Unit" id="1296448" class="char">'/'</a>    =&gt; <a href="#1296425" title="Boolean">exit</a> = <span title="Boolean(true)" class="keyword">true</span>  // end tag
            <span class="keyword">case</span> _      =&gt; <a href="#1294131" title="(pscope: scala.xml.NamespaceBinding, ts: scala.xml.NodeBuffer)Unit">content1</a><a href="#1296449" title="(x: Unit)Unit" class="delimiter">(</a><a href="#1296098" title="scala.xml.NamespaceBinding">pscope</a>, <a href="#1296424" title="scala.xml.NodeBuffer">ts</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

        // postcond: xEmbeddedBlock == false!
        <span class="keyword">case</span> <span class="char">'&amp;'</span> =&gt; // EntityRef or CharRef
          <a href="#1294125" title="()Unit">nextch</a>; <a href="#1294105" title="=&gt; Char">ch</a> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a href="../../Char.scala.html#58041" title="Any" id="1296510" class="char">'#'</a>  =&gt;  // CharacterRef
              <a href="#1294125" title="()Unit">nextch</a>
              <span class="keyword">val</span> <a title="scala.xml.NodeSeq" id="1296457">theChar</a> = <a href="#1294082" title="=&gt; scala.xml.parsing.MarkupHandler">handle</a>.<a href="MarkupHandler.scala.html#1290236" title="(pos: Int, txt: String)scala.xml.NodeSeq">text</a><span class="delimiter">(</span><a href="#1294094" title="=&gt; Int">tmppos</a>, <a href="MarkupParserCommon.scala.html#700527" title="(ch: () =&gt; Char, nextch: () =&gt; Unit)String">xCharRef</a><span class="delimiter">(</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#1294105" title="=&gt; Char">ch</a>, <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#1294125" title="()Unit">nextch</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <a href="MarkupParserCommon.scala.html#700545" title="(that: Char)Unit">xToken</a><span class="delimiter">(</span><span title="Char(';')" class="char">';'</span><span class="delimiter">)</span>;
              <a href="#1296424" title="scala.xml.NodeBuffer">ts</a> <a href="../NodeBuffer.scala.html#811636" title="(o: Any)scala.xml.NodeBuffer">&amp;+</a> <a href="#1296457" title="scala.xml.NodeSeq">theChar</a>
            <span class="keyword">case</span> _ =&gt;     // EntityRef
              <span class="keyword">val</span> <a title="String" id="1296470">n</a> = <a href="MarkupParserCommon.scala.html#700524" title="=&gt; String">xName</a>
              <a href="MarkupParserCommon.scala.html#700545" title="(that: Char)Unit">xToken</a><span class="delimiter">(</span><span title="Char(';')" class="char">';'</span><span class="delimiter">)</span>

              <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="../Utility.scala.html#1266048" title="=&gt; scala.collection.immutable.Map[String,Char]">unescape</a> <a href="../../collection/MapLike.scala.html#78421" title="(key: String)Boolean">contains</a> <a href="#1296470" title="String">n</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="#1294082" title="=&gt; scala.xml.parsing.MarkupHandler">handle</a>.<a href="MarkupHandler.scala.html#1290235" title="(pos: Int, n: String)scala.xml.NodeSeq">entityRef</a><span class="delimiter">(</span><a href="#1294094" title="=&gt; Int">tmppos</a>, <a href="#1296470" title="String">n</a><span class="delimiter">)</span>
                <a href="#1296424" title="scala.xml.NodeBuffer">ts</a> <a href="../NodeBuffer.scala.html#811636" title="(o: Any)scala.xml.NodeBuffer">&amp;+</a> <a href="../../collection/MapLike.scala.html#78420" title="(key: String)Char">unescape</a><span class="delimiter">(</span><a href="#1296470" title="String">n</a><span class="delimiter">)</span>
              <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#1294151" title="(entityName: String)Unit">push</a><span class="delimiter">(</span><a href="#1296470" title="String">n</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="keyword">case</span> _ =&gt; // text content
          <a href="#1294130" title="(pos: Int, ts: scala.xml.NodeBuffer, txt: String)Unit">appendText</a><span title="Unit" class="delimiter">(</span><a href="#1294094" title="=&gt; Int">tmppos</a>, <a href="#1296424" title="scala.xml.NodeBuffer">ts</a>, <a href="#1294137" title="=&gt; String">xText</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <a href="#1296426" title="=&gt; scala.xml.NodeSeq{val theSeq: List[scala.xml.Node]}">done</a>
  <span class="delimiter">}</span> // content(NamespaceBinding)

  /** {{{
   *  externalID ::= SYSTEM S syslit
   *                 PUBLIC S pubid S syslit
   *  }}} */
  <span class="keyword">def</span> <a title="()scala.xml.dtd.ExternalID" id="1294133">externalID</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../dtd/ExternalID.scala.html#56113" title="scala.xml.dtd.ExternalID">ExternalID</a> = <a href="#1294105" title="=&gt; Char">ch</a> <span class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span class="char">'S'</span> =&gt;
      <a href="#1294125" title="()Unit">nextch</a>
      <a href="MarkupParserCommon.scala.html#700546" title="(that: Seq[Char])Unit">xToken</a><span class="delimiter">(</span><a href="../../LowPriorityImplicits.scala.html#8362" title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString" class="string">&quot;YSTEM&quot;</a><span class="delimiter">)</span>
      <a href="MarkupParserCommon.scala.html#700549" title="()Unit">xSpace</a>
      <span class="keyword">val</span> <a title="String" id="1296530">sysID</a> = <a href="#1294138" title="()String">systemLiteral</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span title="scala.xml.dtd.SystemID" class="keyword">new</span> <a href="../dtd/ExternalID.scala.html#56023" title="scala.xml.dtd.SystemID">SystemID</a><span class="delimiter">(</span><a href="#1296530" title="String">sysID</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <span class="char">'P'</span> =&gt;
      <a href="#1294125" title="()Unit">nextch</a>; <a href="MarkupParserCommon.scala.html#700546" title="(that: Seq[Char])Unit">xToken</a><span class="delimiter">(</span><a href="../../LowPriorityImplicits.scala.html#8362" title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString" class="string">&quot;UBLIC&quot;</a><span class="delimiter">)</span>
      <a href="MarkupParserCommon.scala.html#700549" title="()Unit">xSpace</a>
      <span class="keyword">val</span> <a title="String" id="1296538">pubID</a> = <a href="#1294139" title="()String">pubidLiteral</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="MarkupParserCommon.scala.html#700549" title="()Unit">xSpace</a>
      <span class="keyword">val</span> <a title="String" id="1296539">sysID</a> = <a href="#1294138" title="()String">systemLiteral</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span title="scala.xml.dtd.PublicID" class="keyword">new</span> <a href="../dtd/ExternalID.scala.html#56068" title="scala.xml.dtd.PublicID">PublicID</a><span class="delimiter">(</span><a href="#1296538" title="String">pubID</a>, <a href="#1296539" title="String">sysID</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>


  /** parses document type declaration and assigns it to instance variable
   *  dtd.
   *  {{{
   *  &lt;! parseDTD ::= DOCTYPE name ... &gt;
   *  }}} */
  <span class="keyword">def</span> <a title="()Unit" id="1294134">parseDTD</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span> // dirty but fast
    <span class="keyword">var</span> <a title="scala.xml.dtd.ExternalID" id="1296555">extID</a>: <a href="../dtd/ExternalID.scala.html#56113" title="scala.xml.dtd.ExternalID">ExternalID</a> = <span title="Null(null)" class="keyword">null</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#56396" title="scala.xml.parsing.&lt;refinement&gt;.type" class="keyword">this</a>.<a href="#1294109" title="=&gt; scala.xml.dtd.DTD">dtd</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
      <a href="#1294149" title="(str: String)Unit">reportSyntaxError</a><span class="delimiter">(</span><span title="String(&quot;unexpected character (DOCTYPE already defined&quot;)" class="string">&quot;unexpected character (DOCTYPE already defined&quot;</span><span class="delimiter">)</span>
    <a href="MarkupParserCommon.scala.html#700546" title="(that: Seq[Char])Unit">xToken</a><span class="delimiter">(</span><a href="../../LowPriorityImplicits.scala.html#8362" title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString" class="string">&quot;DOCTYPE&quot;</a><span class="delimiter">)</span>
    <a href="MarkupParserCommon.scala.html#700549" title="()Unit">xSpace</a>
    <span class="keyword">val</span> <a title="String" id="1296556">n</a> = <a href="MarkupParserCommon.scala.html#700524" title="=&gt; String">xName</a>
    <a href="MarkupParserCommon.scala.html#700549" title="()Unit">xSpace</a>
    //external ID
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="Char('S')" class="char">'S'</span> <a href="../../Char.scala.html#58041" title="(x: Char)Boolean">==</a> <a href="#1294105" title="=&gt; Char">ch</a> <a href="../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <span title="Char('P')" class="char">'P'</span> <a href="../../Char.scala.html#58041" title="(x: Char)Boolean">==</a> <a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#1296555" title="scala.xml.dtd.ExternalID">extID</a> = <a href="#1294133" title="()scala.xml.dtd.ExternalID">externalID</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="MarkupParserCommon.scala.html#700548" title="()Unit">xSpaceOpt</a>
    <span class="delimiter">}</span>

    /* parse external subset of DTD
     */

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><span title="Null(null)" class="keyword">null</span> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#1296555" title="scala.xml.dtd.ExternalID">extID</a><span class="delimiter">)</span> <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="MarkupHandler.scala.html#1290219" title="=&gt; Boolean">isValidating</a><span class="delimiter">)</span> <span class="delimiter">{</span>

      <a href="#1294152" title="(systemId: String)Unit">pushExternal</a><span class="delimiter">(</span><a href="#1296555" title="scala.xml.dtd.ExternalID">extID</a>.<a href="../dtd/ExternalID.scala.html#811571" title="=&gt; String">systemId</a><span class="delimiter">)</span>
      <a href="#1294091" title="(x$1: Int)Unit">extIndex</a> = <a href="#1294085" title="=&gt; List[scala.io.Source]">inpStack</a>.<a href="../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a>

      <a href="#1294140" title="()Unit">extSubset</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#1294153" title="()Unit">pop</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#1294091" title="(x$1: Int)Unit">extIndex</a> = -<span title="Int(-1)" class="int">1</span>
    <span class="delimiter">}</span>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="Char('[')" class="char">'['</span> <a href="../../Char.scala.html#58041" title="(x: Char)Boolean">==</a> <a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span> <span class="delimiter">{</span> // internal subset
      <a href="#1294125" title="()Unit">nextch</a>
      /* TODO */
      <a href="#1294143" title="()Unit">intSubset</a><span class="delimiter">(</span><span class="delimiter">)</span>
      // TODO: do the DTD parsing?? ?!?!?!?!!
      <a href="MarkupParserCommon.scala.html#700545" title="(that: Char)Unit">xToken</a><span class="delimiter">(</span><span title="Char(']')" class="char">']'</span><span class="delimiter">)</span>
      <a href="MarkupParserCommon.scala.html#700548" title="()Unit">xSpaceOpt</a>
    <span class="delimiter">}</span>
    <a href="MarkupParserCommon.scala.html#700545" title="(that: Char)Unit">xToken</a><span class="delimiter">(</span><span title="Char('&gt;')" class="char">'&gt;'</span><span class="delimiter">)</span>
    <a href="#56396" title="scala.xml.parsing.&lt;refinement&gt;.type" class="keyword">this</a>.<a href="#1294109" title="(x$1: scala.xml.dtd.DTD)Unit">dtd</a> = <a href="#1296604" title="scala.xml.dtd.DTD" class="keyword">new</a> <a href="../dtd/DTD.scala.html#56071" title="anonymous class $anon extends scala.xml.dtd.DTD" id="1296604">DTD</a> <span class="delimiter">{</span>
      /*override var*/ <a href="../dtd/DTD.scala.html#1266226" title="(x$1: scala.xml.dtd.ExternalID)Unit">externalID</a> = <a href="#1296555" title="scala.xml.dtd.ExternalID">extID</a>
      /*override val */<a href="../dtd/DTD.scala.html#1266229" title="(x$1: List[scala.xml.dtd.Decl])Unit">decls</a>      = <a href="#1294082" title="=&gt; scala.xml.parsing.MarkupHandler">handle</a>.<a href="MarkupHandler.scala.html#1290221" title="=&gt; List[scala.xml.dtd.Decl]">decls</a>.<a href="../../collection/immutable/List.scala.html#63674" title="=&gt; List[scala.xml.dtd.Decl]">reverse</a>
    <span class="delimiter">}</span>
    //this.dtd.initializeEntities();
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1294112" title="=&gt; scala.xml.Document">doc</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
      <a href="#1294112" title="=&gt; scala.xml.Document">doc</a>.<a href="../Document.scala.html#1266194" title="(x$1: scala.xml.dtd.DTD)Unit">dtd</a> = <a href="#56396" title="scala.xml.parsing.&lt;refinement&gt;.type" class="keyword">this</a>.<a href="#1294109" title="=&gt; scala.xml.dtd.DTD">dtd</a>

    <a href="#1294082" title="=&gt; scala.xml.parsing.MarkupHandler">handle</a>.<a href="MarkupHandler.scala.html#1290229" title="(n: String)Unit">endDTD</a><span class="delimiter">(</span><a href="#1296556" title="String">n</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(pscope: scala.xml.NamespaceBinding)scala.xml.NodeSeq" id="1294135">element</a><span class="delimiter">(</span><a title="scala.xml.NamespaceBinding" id="1296610">pscope</a>: <a href="../NamespaceBinding.scala.html#55606" title="scala.xml.NamespaceBinding">NamespaceBinding</a><span class="delimiter">)</span>: <a href="../NodeSeq.scala.html#55450" title="scala.xml.NodeSeq">NodeSeq</a> = <span class="delimiter">{</span>
    <a href="MarkupParserCommon.scala.html#700545" title="(that: Char)Unit">xToken</a><span class="delimiter">(</span><span title="Char('&lt;')" class="char">'&lt;'</span><span class="delimiter">)</span>
    <a href="#1294136" title="(pscope: scala.xml.NamespaceBinding)scala.xml.NodeSeq">element1</a><span class="delimiter">(</span><a href="#1296610" title="scala.xml.NamespaceBinding">pscope</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  /** {{{
   *  '&lt;' element ::= xmlTag1 '&gt;'  { xmlExpr | '{' simpleExpr '}' } ETag
   *               | xmlTag1 '/' '&gt;'
   *  }}} */
  <span class="keyword">def</span> <a title="(pscope: scala.xml.NamespaceBinding)scala.xml.NodeSeq" id="1294136">element1</a><span class="delimiter">(</span><a title="scala.xml.NamespaceBinding" id="1296414">pscope</a>: <a href="../NamespaceBinding.scala.html#55606" title="scala.xml.NamespaceBinding">NamespaceBinding</a><span class="delimiter">)</span>: <a href="../NodeSeq.scala.html#55450" title="scala.xml.NodeSeq">NodeSeq</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="1296618">pos</a> = <a href="#56396" title="scala.xml.parsing.&lt;refinement&gt;.type" class="keyword">this</a>.<a href="#1294088" title="=&gt; Int">pos</a>
    <span class="keyword">val</span> <a href="#1296648" title="(x: (String, scala.xml.MetaData, scala.xml.NamespaceBinding))(String, scala.xml.MetaData, scala.xml.NamespaceBinding)" class="delimiter">(</a><a href="../../Tuple3.scala.html#61402" title="String" id="1296620">qname</a>, <span class="delimiter">(</span><a href="../../Tuple3.scala.html#61404" title="scala.xml.MetaData" id="1296621">aMap</a>, <a href="../../Tuple3.scala.html#61406" title="scala.xml.NamespaceBinding" id="1296622">scope</a><span class="delimiter">)</span><span class="delimiter">)</span> = <a href="MarkupParserCommon.scala.html#700518" title="(pscope: MarkupParser.this.NamespaceType)(String, (scala.xml.MetaData, scala.xml.NamespaceBinding))">xTag</a><a href="../../Tuple2.scala.html#1222" title="(String, (scala.xml.MetaData, scala.xml.NamespaceBinding)) @unchecked" class="delimiter">(</a><a href="#1296414" title="scala.xml.NamespaceBinding">pscope</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a href="#1296801" title="(x: (String, String))(String, String)" class="delimiter">(</a><a href="../../Tuple2.scala.html#61506" title="String" id="1296624">pre</a>, <a href="../../Tuple2.scala.html#61508" title="String" id="1296625">local</a><span class="delimiter">)</span> = <a href="../Utility.scala.html#55457" title="scala.xml.Utility.type">Utility</a>.<a href="../Utility.scala.html#700405" title="(name: String)Option[String]">prefix</a><a href="../../Option.scala.html#64115" title="=&gt; String" class="delimiter">(</a><a href="#1296620" title="String">qname</a><span class="delimiter">)</span> <a href="../../Tuple2.scala.html#1222" title="(String, String) @unchecked" class="keyword">match</a> <span class="delimiter">{</span>
      <span class="keyword">case</span> Some<a href="#1296782" title="(String, String)" id="1296783" class="delimiter">(</a>p<span class="delimiter">)</span> =&gt; <a href="#1296784" title="(x: (String, String))(String, String)" class="delimiter">(</a>p, <a href="../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">qname</a> <a href="../../collection/IndexedSeqOptimized.scala.html#60121" title="(n: Int)String">drop</a> p.<span title="()Int">length</span><a href="../../Int.scala.html#57948" title="(x: Int)Int">+</a><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      <span class="keyword">case</span> _       =&gt; <a href="#1296784" title="(x: (String, String))(String, String)" class="delimiter">(</a><span title="Null(null)" class="keyword">null</span>, <a href="#1296620" title="String">qname</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="scala.xml.NodeSeq" id="1296626">ts</a> = <span class="delimiter">{</span>
      <span title="scala.xml.NodeSeq" class="keyword">if</span> <span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a> <a href="../../Char.scala.html#58041" title="(x: Char)Boolean">==</a> <span title="Char('/')" class="char">'/'</span><span class="delimiter">)</span> <span class="delimiter">{</span>  // empty element
        <a href="MarkupParserCommon.scala.html#700546" title="(that: Seq[Char])Unit">xToken</a><span class="delimiter">(</span><a href="../../LowPriorityImplicits.scala.html#8362" title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString" class="string">&quot;/&gt;&quot;</a><span class="delimiter">)</span>
        <a href="#1294082" title="=&gt; scala.xml.parsing.MarkupHandler">handle</a>.<a href="MarkupHandler.scala.html#1290230" title="(pos: Int, pre: String, label: String, attrs: scala.xml.MetaData, scope: scala.xml.NamespaceBinding)Unit">elemStart</a><span class="delimiter">(</span><a href="#1296618" title="Int">pos</a>, <a href="#1296624" title="String">pre</a>, <a href="#1296625" title="String">local</a>, <a href="#1296621" title="scala.xml.MetaData">aMap</a>, <a href="#1296622" title="scala.xml.NamespaceBinding">scope</a><span class="delimiter">)</span>
        <a href="../NodeSeq.scala.html#55451" title="scala.xml.NodeSeq.type">NodeSeq</a>.<a href="../NodeSeq.scala.html#605484" title="=&gt; scala.xml.NodeSeq">Empty</a>
      <span class="delimiter">}</span>
      <span class="keyword">else</span> <span class="delimiter">{</span>           // element with content
        <a href="MarkupParserCommon.scala.html#700545" title="(that: Char)Unit">xToken</a><span class="delimiter">(</span><span title="Char('&gt;')" class="char">'&gt;'</span><span class="delimiter">)</span>
        <a href="#1294082" title="=&gt; scala.xml.parsing.MarkupHandler">handle</a>.<a href="MarkupHandler.scala.html#1290230" title="(pos: Int, pre: String, label: String, attrs: scala.xml.MetaData, scope: scala.xml.NamespaceBinding)Unit">elemStart</a><span class="delimiter">(</span><a href="#1296618" title="Int">pos</a>, <a href="#1296624" title="String">pre</a>, <a href="#1296625" title="String">local</a>, <a href="#1296621" title="scala.xml.MetaData">aMap</a>, <a href="#1296622" title="scala.xml.NamespaceBinding">scope</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="scala.xml.NodeSeq" id="1296816">tmp</a> = <a href="#1294132" title="(pscope: scala.xml.NamespaceBinding)scala.xml.NodeSeq">content</a><span class="delimiter">(</span><a href="#1296622" title="scala.xml.NamespaceBinding">scope</a><span class="delimiter">)</span>
        <a href="MarkupParserCommon.scala.html#700523" title="(startName: String)Unit">xEndTag</a><span class="delimiter">(</span><a href="#1296620" title="String">qname</a><span class="delimiter">)</span>
        <a href="#1296816" title="scala.xml.NodeSeq">tmp</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="scala.xml.NodeSeq" id="1296627">res</a> = <a href="#1294082" title="=&gt; scala.xml.parsing.MarkupHandler">handle</a>.<a href="MarkupHandler.scala.html#1290232" title="(pos: Int, pre: String, label: String, attrs: scala.xml.MetaData, scope: scala.xml.NamespaceBinding, empty: Boolean, args: scala.xml.NodeSeq)scala.xml.NodeSeq">elem</a><span class="delimiter">(</span><a href="#1296618" title="Int">pos</a>, <a href="#1296624" title="String">pre</a>, <a href="#1296625" title="String">local</a>, <a href="#1296621" title="scala.xml.MetaData">aMap</a>, <a href="#1296622" title="scala.xml.NamespaceBinding">scope</a>, <a href="#1296626" title="scala.xml.NodeSeq">ts</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../NodeSeq.scala.html#55451" title="scala.xml.NodeSeq.type">NodeSeq</a>.<a href="../NodeSeq.scala.html#605484" title="=&gt; scala.xml.NodeSeq">Empty</a>, <a href="#1296626" title="scala.xml.NodeSeq">ts</a><span class="delimiter">)</span>
    <a href="#1294082" title="=&gt; scala.xml.parsing.MarkupHandler">handle</a>.<a href="MarkupHandler.scala.html#1290231" title="(pos: Int, pre: String, label: String)Unit">elemEnd</a><span class="delimiter">(</span><a href="#1296618" title="Int">pos</a>, <a href="#1296624" title="String">pre</a>, <a href="#1296625" title="String">local</a><span class="delimiter">)</span>
    <a href="#1296627" title="scala.xml.NodeSeq">res</a>
  <span class="delimiter">}</span>

  /** Parse character data.
   *
   *  precondition: `xEmbeddedBlock == false` (we are not in a scala block)
   */
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; String" id="1294137">xText</a>: <span title="String">String</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Boolean" id="1296827">exit</a> = <span title="Boolean(false)" class="keyword">false</span>
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a> <a href="#1296827" title="Boolean">exit</a><span class="delimiter">)</span> <a href="#1296829" title="()Unit" class="delimiter">{</a>
      <a href="#1294120" title="(c: Char)StringBuilder">putChar</a><span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Int" id="1296830">opos</a> = <a href="#1294088" title="=&gt; Int">pos</a>
      <a href="#1294125" title="()Unit">nextch</a>

      <a href="#1296827" title="Boolean">exit</a> = <a href="#1294114" title="=&gt; Boolean">eof</a> <a href="../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <span class="delimiter">(</span> <a href="#1294105" title="=&gt; Char">ch</a> <a href="../../Char.scala.html#58041" title="(x: Char)Boolean">==</a> <span title="Char('&lt;')" class="char">'&lt;'</span> <span class="delimiter">)</span> <a href="../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <span class="delimiter">(</span> <a href="#1294105" title="=&gt; Char">ch</a> <a href="../../Char.scala.html#58041" title="(x: Char)Boolean">==</a> <span title="Char('&amp;')" class="char">'&amp;'</span> <span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="String" id="1296828">str</a> = <a href="#1294106" title="=&gt; StringBuilder">cbuf</a>.<a href="../../collection/mutable/StringBuilder.scala.html#66605" title="()String">toString</a>
    <a href="#1294106" title="=&gt; StringBuilder">cbuf</a>.<a href="../../collection/mutable/StringBuilder.scala.html#66552" title="(n: Int)Unit">length</a> = <span title="Int(0)" class="int">0</span>
    <a href="#1296828" title="String">str</a>
  <span class="delimiter">}</span>

  /** attribute value, terminated by either ' or &quot;. value may not contain &amp;lt;.
   *  {{{
   *       AttValue     ::= `'` { _ } `'`
   *                      | `&quot;` { _ } `&quot;`
   *  }}} */
  <span class="keyword">def</span> <a title="()String" id="1294138">systemLiteral</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Char" id="1296841">endch</a> = <a href="#1294105" title="=&gt; Char">ch</a>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a> <a href="../../Char.scala.html#58048" title="(x: Char)Boolean">!=</a> <span title="Char('\'')" class="char">'\''</span> <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1294105" title="=&gt; Char">ch</a> <a href="../../Char.scala.html#58048" title="(x: Char)Boolean">!=</a> <span title="Char('\&quot;')" class="char">'&quot;'</span><span class="delimiter">)</span>
      <a href="#1294149" title="(str: String)Unit">reportSyntaxError</a><span class="delimiter">(</span><span title="String(&quot;quote \' or \&quot; expected&quot;)" class="string">&quot;quote ' or \&quot; expected&quot;</span><span class="delimiter">)</span>;
    <a href="#1294125" title="()Unit">nextch</a>
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a> <a href="../../Char.scala.html#58048" title="(x: Char)Boolean">!=</a> <a href="#1296841" title="Char">endch</a> <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1294114" title="=&gt; Boolean">eof</a><span class="delimiter">)</span> <a href="#1296843" title="()Unit" class="delimiter">{</a>
      <a href="#1294120" title="(c: Char)StringBuilder">putChar</a><span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span>
      <a href="#1294125" title="()Unit">nextch</a>
    <span class="delimiter">}</span>
    <a href="#1294125" title="()Unit">nextch</a>
    <span class="keyword">val</span> <a title="String" id="1296842">str</a> = <a href="#1294106" title="=&gt; StringBuilder">cbuf</a>.<a href="../../collection/mutable/StringBuilder.scala.html#66605" title="()String">toString</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#1294106" title="=&gt; StringBuilder">cbuf</a>.<a href="../../collection/mutable/StringBuilder.scala.html#66552" title="(n: Int)Unit">length</a> = <span title="Int(0)" class="int">0</span>
    <a href="#1296842" title="String">str</a>
  <span class="delimiter">}</span>

  /** {{{
   *  [12]       PubidLiteral ::=        '&quot;' PubidChar* '&quot;' | &quot;'&quot; (PubidChar - &quot;'&quot;)* &quot;'&quot;
   *  }}} */
  <span class="keyword">def</span> <a title="()String" id="1294139">pubidLiteral</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Char" id="1296863">endch</a> = <a href="#1294105" title="=&gt; Char">ch</a>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a><a href="../../Char.scala.html#58048" title="(x: Char)Boolean">!=</a><span title="Char('\'')" class="char">'\''</span> <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1294105" title="=&gt; Char">ch</a> <a href="../../Char.scala.html#58048" title="(x: Char)Boolean">!=</a> <span title="Char('\&quot;')" class="char">'&quot;'</span><span class="delimiter">)</span>
      <a href="#1294149" title="(str: String)Unit">reportSyntaxError</a><span class="delimiter">(</span><span title="String(&quot;quote \' or \&quot; expected&quot;)" class="string">&quot;quote ' or \&quot; expected&quot;</span><span class="delimiter">)</span>;
    <a href="#1294125" title="()Unit">nextch</a>
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a> <a href="../../Char.scala.html#58048" title="(x: Char)Boolean">!=</a> <a href="#1296863" title="Char">endch</a> <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1294114" title="=&gt; Boolean">eof</a><span class="delimiter">)</span> <a href="#1296865" title="()Unit" class="delimiter">{</a>
      <a href="#1294120" title="(c: Char)StringBuilder">putChar</a><span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span>
      //println(&quot;hello '&quot;+ch+&quot;'&quot;+isPubIDChar(ch))
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="TokenTests.scala.html#700422" title="(ch: Char)Boolean">isPubIDChar</a><span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#1294149" title="(str: String)Unit">reportSyntaxError</a><span class="delimiter">(</span><span title="String(&quot;char \'&quot;)" class="string">&quot;char '&quot;</span><span title="(x$1: Any)String">+</span><a href="#1294105" title="=&gt; Char">ch</a><span title="(x$1: Any)String">+</span><span title="String(&quot;\' is not allowed in public id&quot;)" class="string">&quot;' is not allowed in public id&quot;</span><span class="delimiter">)</span>
      <a href="#1294125" title="()Unit">nextch</a>
    <span class="delimiter">}</span>
    <a href="#1294125" title="()Unit">nextch</a>
    <span class="keyword">val</span> <a title="String" id="1296864">str</a> = <a href="#1294106" title="=&gt; StringBuilder">cbuf</a>.<a href="../../collection/mutable/StringBuilder.scala.html#66605" title="()String">toString</a>
    <a href="#1294106" title="=&gt; StringBuilder">cbuf</a>.<a href="../../collection/mutable/StringBuilder.scala.html#66552" title="(n: Int)Unit">length</a> = <span title="Int(0)" class="int">0</span>
    <a href="#1296864" title="String">str</a>
  <span class="delimiter">}</span>

  //
  //  dtd parsing
  //

  <span class="keyword">def</span> <a title="()Unit" id="1294140">extSubset</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../../Unit.scala.html#2389" title="Unit">Unit</a> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="(Option[String], Option[String])" id="1296889">textdecl</a>: <a href="../../Tuple2.scala.html#1222" title="(Option[String], Option[String])" class="delimiter">(</a>Option<span class="delimiter">[</span>String<span class="delimiter">]</span>,Option<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> = <span title="Null(null)" class="keyword">null</span>
    <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a> <a href="../../Char.scala.html#58041" title="(x: Char)Boolean">==</a> <span title="Char('&lt;')" class="char">'&lt;'</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#1294125" title="()Unit">nextch</a>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a> <a href="../../Char.scala.html#58041" title="(x: Char)Boolean">==</a> <span title="Char('?')" class="char">'?'</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#1294125" title="()Unit">nextch</a>
        <a href="#1296889" title="(Option[String], Option[String])">textdecl</a> = <a href="#1294118" title="()(Option[String], Option[String])">textDecl</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span>
        <a href="#1294141" title="()Any">markupDecl1</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1294114" title="=&gt; Boolean">eof</a><span class="delimiter">)</span>
      <a href="#1294142" title="()Unit">markupDecl</a><a href="#1297275" title="()Unit" class="delimiter">(</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Any" id="1294141">markupDecl1</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="()Unit" id="1296902">doInclude</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="MarkupParserCommon.scala.html#700545" title="(that: Char)Unit">xToken</a><span class="delimiter">(</span><span title="Char('[')" class="char">'['</span><span class="delimiter">)</span>; <span title="Unit" class="keyword">while</span><span class="delimiter">(</span><span title="Char(']')" class="char">']'</span> <a href="../../Char.scala.html#58048" title="(x: Char)Boolean">!=</a> <a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span> <a href="#1294142" title="()Unit">markupDecl</a><a href="#1296904" title="()Unit" class="delimiter">(</a><span class="delimiter">)</span>; <a href="#1294125" title="()Unit">nextch</a> // ']'
    <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="()Unit" id="1296903">doIgnore</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="MarkupParserCommon.scala.html#700545" title="(that: Char)Unit">xToken</a><span class="delimiter">(</span><span title="Char('[')" class="char">'['</span><span class="delimiter">)</span>; <span title="Unit" class="keyword">while</span><span class="delimiter">(</span><span title="Char(']')" class="char">']'</span> <a href="../../Char.scala.html#58048" title="(x: Char)Boolean">!=</a> <a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span> <a href="#1294125" title="()Unit">nextch</a>; <a href="#1294125" title="()Unit">nextch</a> // ']'
    <span class="delimiter">}</span>
    <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><span title="Char('?')" class="char">'?'</span> <a href="../../Char.scala.html#58041" title="(x: Char)Boolean">==</a> <a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#1294125" title="()Unit">nextch</a>
      <a href="MarkupParserCommon.scala.html#700519" title="=&gt; MarkupParser.this.ElementType">xProcInstr</a> // simply ignore processing instructions!
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="MarkupParserCommon.scala.html#700545" title="(that: Char)Unit">xToken</a><span class="delimiter">(</span><span title="Char('!')" class="char">'!'</span><span class="delimiter">)</span>
      <a href="#1294105" title="=&gt; Char">ch</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="../../Char.scala.html#58041" title="Any" id="1297246" class="char">'-'</a> =&gt;
          <a href="#1297251" title="(x: Any)Any">xComment</a> // ignore comments

        <span class="keyword">case</span> <a href="../../Char.scala.html#58041" title="Any" id="1297247" class="char">'E'</a> =&gt;
          <a href="#1294125" title="()Unit">nextch</a>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="Char('L')" class="char">'L'</span> <a href="../../Char.scala.html#58041" title="(x: Char)Boolean">==</a> <a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#1294125" title="()Unit">nextch</a>
            <a href="#1294144" title="()Unit">elementDecl</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span>
            <a href="#1294146" title="()Unit">entityDecl</a><span class="delimiter">(</span><span class="delimiter">)</span>

        <span class="keyword">case</span> <a href="../../Char.scala.html#58041" title="Any" id="1297248" class="char">'A'</a> =&gt;
          <a href="#1294125" title="()Unit">nextch</a>
          <a href="#1294145" title="()Unit">attrDecl</a><span class="delimiter">(</span><span class="delimiter">)</span>

        <span class="keyword">case</span> <a href="../../Char.scala.html#58041" title="Any" id="1297249" class="char">'N'</a> =&gt;
          <a href="#1294125" title="()Unit">nextch</a>
          <a href="#1294147" title="()Unit">notationDecl</a><span class="delimiter">(</span><span class="delimiter">)</span>

        <span class="keyword">case</span> <a href="../../Char.scala.html#58041" title="Any" id="1297250" class="char">'['</a> <span class="keyword">if</span> <a href="#1294085" title="=&gt; List[scala.io.Source]">inpStack</a>.<a href="../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a> <a href="../../Int.scala.html#57926" title="(x: Int)Boolean">&gt;=</a> <a href="#1294091" title="=&gt; Int">extIndex</a> =&gt;
          <a href="#1294125" title="()Unit">nextch</a>
          <a href="MarkupParserCommon.scala.html#700548" title="()Unit">xSpaceOpt</a>
          <a href="#1294105" title="=&gt; Char">ch</a> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span class="char">'%'</span> =&gt;
              <a href="#1294125" title="()Unit">nextch</a>
              <span class="keyword">val</span> <a title="String" id="1297151">ent</a> = <a href="MarkupParserCommon.scala.html#700524" title="=&gt; String">xName</a>
              <a href="MarkupParserCommon.scala.html#700545" title="(that: Char)Unit">xToken</a><span class="delimiter">(</span><span title="Char(';')" class="char">';'</span><span class="delimiter">)</span>
              <a href="MarkupParserCommon.scala.html#700548" title="()Unit">xSpaceOpt</a>

              <a href="#1294151" title="(entityName: String)Unit">push</a><span class="delimiter">(</span><a href="#1297151" title="String">ent</a><span class="delimiter">)</span>
              <a href="MarkupParserCommon.scala.html#700548" title="()Unit">xSpaceOpt</a>
              <span class="keyword">val</span> <a title="String" id="1297152">stmt</a> = <a href="MarkupParserCommon.scala.html#700524" title="=&gt; String">xName</a>
              <a href="MarkupParserCommon.scala.html#700548" title="()Unit">xSpaceOpt</a>

              <a href="#1297152" title="String">stmt</a> <span class="keyword">match</span> <span class="delimiter">{</span>
                // parameter entity
                <span class="keyword">case</span> <a href="#1297160" title="Unit" id="1297165" class="string">&quot;INCLUDE&quot;</a> =&gt; <a href="#1296902" title="()Unit">doInclude</a><a href="#1297167" title="(x: Unit)Unit" class="delimiter">(</a><span class="delimiter">)</span>
                <span class="keyword">case</span> <a href="#1297160" title="Unit" id="1297166" class="string">&quot;IGNORE&quot;</a>  =&gt; <a href="#1296903" title="()Unit">doIgnore</a><a href="#1297167" title="(x: Unit)Unit" class="delimiter">(</a><span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="keyword">case</span> <span class="char">'I'</span> =&gt;
              <a href="#1294125" title="()Unit">nextch</a>
              <a href="#1294105" title="=&gt; Char">ch</a> <span class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <span class="char">'G'</span> =&gt;
                  <a href="#1294125" title="()Unit">nextch</a>
                  <a href="MarkupParserCommon.scala.html#700546" title="(that: Seq[Char])Unit">xToken</a><span class="delimiter">(</span><a href="../../LowPriorityImplicits.scala.html#8362" title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString" class="string">&quot;NORE&quot;</a><span class="delimiter">)</span>
                  <a href="MarkupParserCommon.scala.html#700548" title="()Unit">xSpaceOpt</a>
                  <a href="#1296903" title="()Unit">doIgnore</a><span class="delimiter">(</span><span class="delimiter">)</span>
                <span class="keyword">case</span> <span class="char">'N'</span> =&gt;
                  <a href="#1294125" title="()Unit">nextch</a>
                  <a href="MarkupParserCommon.scala.html#700546" title="(that: Seq[Char])Unit">xToken</a><span class="delimiter">(</span><a href="../../LowPriorityImplicits.scala.html#8362" title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString" class="string">&quot;NCLUDE&quot;</a><span class="delimiter">)</span>
                  <a href="#1296902" title="()Unit">doInclude</a><span class="delimiter">(</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <a href="MarkupParserCommon.scala.html#700545" title="(that: Char)Unit">xToken</a><span class="delimiter">(</span><span title="Char(']')" class="char">']'</span><span class="delimiter">)</span>
        <a href="MarkupParserCommon.scala.html#700545" title="(that: Char)Unit">xToken</a><span class="delimiter">(</span><span title="Char('&gt;')" class="char">'&gt;'</span><span class="delimiter">)</span>

        <span class="keyword">case</span> _  =&gt;
          <a href="#1294078" title="scala.io.Source" id="1297218">curInput</a>.<a href="../../io/Source.scala.html#416585" title="java.io.PrintStream" id="1297221">reportError</a><span class="delimiter">(</span><a href="#1294088" title="Int" id="1297219">pos</a>, <span title="String(&quot;unexpected character \'&quot;)" class="string">&quot;unexpected character '&quot;</span><span title="(x$1: Any)String">+</span><a href="#1294105" title="=&gt; Char">ch</a><a title="String" id="1297220">+</a><span title="String(&quot;\', expected some markupdecl&quot;)" class="string">&quot;', expected some markupdecl&quot;</span><span class="delimiter">)</span>
        <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a><a href="../../Char.scala.html#58048" title="(x: Char)Boolean">!=</a><span title="Char('&gt;')" class="char">'&gt;'</span><span class="delimiter">)</span>
          <a href="#1294125" title="()Unit">nextch</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="1294142">markupDecl</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../../Unit.scala.html#2389" title="Unit">Unit</a> = <a href="#1294105" title="=&gt; Char">ch</a> <span class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a href="../../Char.scala.html#58041" title="Unit" id="1297299" class="char">'%'</a> =&gt;                  // parameter entity reference
      <a href="#1294125" title="()Unit">nextch</a>
      <span class="keyword">val</span> <a title="String" id="1297276">ent</a> = <a href="MarkupParserCommon.scala.html#700524" title="=&gt; String">xName</a>
      <a href="MarkupParserCommon.scala.html#700545" title="(that: Char)Unit">xToken</a><span class="delimiter">(</span><span title="Char(';')" class="char">';'</span><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="MarkupHandler.scala.html#1290219" title="=&gt; Boolean">isValidating</a><span class="delimiter">)</span>
        <a href="#1294082" title="=&gt; scala.xml.parsing.MarkupHandler">handle</a>.<a href="MarkupHandler.scala.html#1290242" title="(name: String)Unit">peReference</a><span class="delimiter">(</span><a href="#1297276" title="String">ent</a><span class="delimiter">)</span>  //  n-v: just create PE-reference
      <span class="keyword">else</span>
        <a href="#1294151" title="(entityName: String)Unit">push</a><span class="delimiter">(</span><a href="#1297276" title="String">ent</a><span class="delimiter">)</span>                //    v: parse replacementText

    //peReference
    <span class="keyword">case</span> <a href="../../Char.scala.html#58041" title="Unit" id="1297300" class="char">'&lt;'</a> =&gt;
      <a href="#1294125" title="()Unit">nextch</a>
      <a href="#1294141" title="()Any">markupDecl1</a><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">case</span> _ <span class="keyword">if</span> <a href="TokenTests.scala.html#700415" title="(ch: Char)Boolean">isSpace</a><span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span> =&gt;
      <a href="#1297301" title="(x: Unit)Unit">xSpace</a>
    <span class="keyword">case</span> _ =&gt;
      <a href="#1294149" title="(str: String)Unit">reportSyntaxError</a><span class="delimiter">(</span><span title="String(&quot;markupdecl: unexpected character \'&quot;)" class="string">&quot;markupdecl: unexpected character '&quot;</span><span title="(x$1: Any)String">+</span><a href="#1294105" title="=&gt; Char">ch</a><span title="(x$1: Any)String">+</span><span title="String(&quot;\' #&quot;)" class="string">&quot;' #&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1294105" title="=&gt; Char">ch</a>.<a href="../../Char.scala.html#58025" title="=&gt; Int">toInt</a><span class="delimiter">)</span>
      <a href="#1294125" title="()Unit">nextch</a>
  <span class="delimiter">}</span>

  /**  &quot;rec-xml/#ExtSubset&quot; pe references may not occur within markup declarations
   */
  <span class="keyword">def</span> <a title="()Unit" id="1294143">intSubset</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    //Console.println(&quot;(DEBUG) intSubset()&quot;)
    <a href="MarkupParserCommon.scala.html#700549" title="()Unit">xSpace</a>
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><span title="Char(']')" class="char">']'</span> <a href="../../Char.scala.html#58048" title="(x: Char)Boolean">!=</a> <a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span>
      <a href="#1294142" title="()Unit">markupDecl</a><a href="#1297314" title="()Unit" class="delimiter">(</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  /** &amp;lt;! element := ELEMENT
   */
  <span class="keyword">def</span> <a title="()Unit" id="1294144">elementDecl</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="MarkupParserCommon.scala.html#700546" title="(that: Seq[Char])Unit">xToken</a><span class="delimiter">(</span><a href="../../LowPriorityImplicits.scala.html#8362" title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString" class="string">&quot;EMENT&quot;</a><span class="delimiter">)</span>
    <a href="MarkupParserCommon.scala.html#700549" title="()Unit">xSpace</a>
    <span class="keyword">val</span> <a title="String" id="1297320">n</a> = <a href="MarkupParserCommon.scala.html#700524" title="=&gt; String">xName</a>
    <a href="MarkupParserCommon.scala.html#700549" title="()Unit">xSpace</a>
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><span title="Char('&gt;')" class="char">'&gt;'</span> <a href="../../Char.scala.html#58048" title="(x: Char)Boolean">!=</a> <a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span> <a href="#1297322" title="()Unit" class="delimiter">{</a>
      //Console.println(&quot;[&quot;+ch+&quot;]&quot;)
      <a href="#1294120" title="(c: Char)StringBuilder">putChar</a><span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span>
      <a href="#1294125" title="()Unit">nextch</a>
    <span class="delimiter">}</span>
    //Console.println(&quot;END[&quot;+ch+&quot;]&quot;)
    <a href="#1294125" title="()Unit">nextch</a>
    <span class="keyword">val</span> <a title="String" id="1297321">cmstr</a> = <a href="#1294106" title="=&gt; StringBuilder">cbuf</a>.<a href="../../collection/mutable/StringBuilder.scala.html#66605" title="()String">toString</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#1294106" title="=&gt; StringBuilder">cbuf</a>.<a href="../../collection/mutable/StringBuilder.scala.html#66552" title="(n: Int)Unit">length</a> = <span title="Int(0)" class="int">0</span>
    <a href="#1294082" title="=&gt; scala.xml.parsing.MarkupHandler">handle</a>.<a href="MarkupHandler.scala.html#1290237" title="(n: String, cmstr: String)Unit">elemDecl</a><span class="delimiter">(</span><a href="#1297320" title="String">n</a>, <a href="#1297321" title="String">cmstr</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  /** {{{
   *  &lt;! attlist := ATTLIST
   *  }}} */
  <span class="keyword">def</span> <a title="()Unit" id="1294145">attrDecl</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="MarkupParserCommon.scala.html#700546" title="(that: Seq[Char])Unit">xToken</a><span class="delimiter">(</span><a href="../../LowPriorityImplicits.scala.html#8362" title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString" class="string">&quot;TTLIST&quot;</a><span class="delimiter">)</span>
    <a href="MarkupParserCommon.scala.html#700549" title="()Unit">xSpace</a>
    <span class="keyword">val</span> <a title="String" id="1297018">n</a> = <a href="MarkupParserCommon.scala.html#700524" title="=&gt; String">xName</a>
    <a href="MarkupParserCommon.scala.html#700549" title="()Unit">xSpace</a>
    <span class="keyword">var</span> <a title="List[scala.xml.dtd.AttrDecl]" id="1297019">attList</a>: <a href="../../collection/immutable/List.scala.html#12322" title="List[scala.xml.dtd.AttrDecl]">List</a><span class="delimiter">[</span>AttrDecl<span class="delimiter">]</span> = <a href="../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type">Nil</a>

    // later: find the elemDecl for n
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><span title="Char('&gt;')" class="char">'&gt;'</span> <a href="../../Char.scala.html#58048" title="(x: Char)Boolean">!=</a> <a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span> <a href="#1297020" title="()Unit" class="delimiter">{</a>
      <span class="keyword">val</span> <a title="String" id="1297032">aname</a> = <a href="MarkupParserCommon.scala.html#700524" title="=&gt; String">xName</a>
      <a href="MarkupParserCommon.scala.html#700549" title="()Unit">xSpace</a>
      // could be enumeration (foo,bar) parse this later :-/
      <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><span title="Char('\&quot;')" class="char">'&quot;'</span> <a href="../../Char.scala.html#58048" title="(x: Char)Boolean">!=</a> <a href="#1294105" title="=&gt; Char">ch</a> <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <span title="Char('\'')" class="char">'\''</span> <a href="../../Char.scala.html#58048" title="(x: Char)Boolean">!=</a> <a href="#1294105" title="=&gt; Char">ch</a> <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <span title="Char('#')" class="char">'#'</span> <a href="../../Char.scala.html#58048" title="(x: Char)Boolean">!=</a> <a href="#1294105" title="=&gt; Char">ch</a> <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <span title="Char('&lt;')" class="char">'&lt;'</span> <a href="../../Char.scala.html#58048" title="(x: Char)Boolean">!=</a> <a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span> <a href="#1297035" title="()Unit" class="delimiter">{</a>
        <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="TokenTests.scala.html#700415" title="(ch: Char)Boolean">isSpace</a><span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#1294106" title="=&gt; StringBuilder">cbuf</a>.<a href="../../collection/mutable/StringBuilder.scala.html#66582" title="(x: Char)StringBuilder">append</a><span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span>
        <a href="#1294125" title="()Unit">nextch</a>
      <span class="delimiter">}</span>
      <span class="keyword">val</span> <a title="String" id="1297033">atpe</a> = <a href="#1294106" title="=&gt; StringBuilder">cbuf</a>.<a href="../../collection/mutable/StringBuilder.scala.html#66605" title="()String">toString</a>
      <a href="#1294106" title="=&gt; StringBuilder">cbuf</a>.<a href="../../collection/mutable/StringBuilder.scala.html#66552" title="(n: Int)Unit">length</a> = <span title="Int(0)" class="int">0</span>

      <span class="keyword">val</span> <a title="scala.xml.dtd.DefaultDecl" id="1297034">defdecl</a>: <a href="../dtd/Decl.scala.html#55942" title="scala.xml.dtd.DefaultDecl">DefaultDecl</a> = <a href="#1294105" title="=&gt; Char">ch</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span class="char">'\''</span> | <span class="char">'&quot;'</span> =&gt;
          <a href="../dtd/Decl.scala.html#1288482" title="(fixed: Boolean, attValue: String)scala.xml.dtd.DEFAULT">DEFAULT</a><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span>, <a href="MarkupParserCommon.scala.html#700521" title="()String">xAttributeValue</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

        <span class="keyword">case</span> <span class="char">'#'</span> =&gt;
          <a href="#1294125" title="()Unit">nextch</a>
          <a href="MarkupParserCommon.scala.html#700524" title="=&gt; String">xName</a> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a href="#1297089" title="scala.xml.dtd.DefaultDecl" id="1297096" class="string">&quot;FIXED&quot;</a>    =&gt; <a href="MarkupParserCommon.scala.html#700549" title="()Unit">xSpace</a> ; <a href="../dtd/Decl.scala.html#1288482" title="(fixed: Boolean, attValue: String)scala.xml.dtd.DEFAULT">DEFAULT</a><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span>, <a href="MarkupParserCommon.scala.html#700521" title="()String">xAttributeValue</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <a href="#1297089" title="scala.xml.dtd.DefaultDecl" id="1297097" class="string">&quot;IMPLIED&quot;</a>  =&gt; <a href="#1297099" title="(x: scala.xml.dtd.DefaultDecl)scala.xml.dtd.DefaultDecl">IMPLIED</a>
            <span class="keyword">case</span> <a href="#1297089" title="scala.xml.dtd.DefaultDecl" id="1297098" class="string">&quot;REQUIRED&quot;</a> =&gt; <a href="#1297099" title="(x: scala.xml.dtd.DefaultDecl)scala.xml.dtd.DefaultDecl">REQUIRED</a>
          <span class="delimiter">}</span>
        <span class="keyword">case</span> _ =&gt;
          <span title="Null(null)" class="keyword">null</span>
      <span class="delimiter">}</span>
      <a href="MarkupParserCommon.scala.html#700548" title="()Unit">xSpaceOpt</a>

      <a href="#1297019" title="List[scala.xml.dtd.AttrDecl]">attList</a> <a href="../../collection/immutable/List.scala.html#63643" title="(x: scala.xml.dtd.AttrDecl)List[scala.xml.dtd.AttrDecl]">::=</a> <a href="../dtd/Decl.scala.html#1288411" title="(name: String, tpe: String, default: scala.xml.dtd.DefaultDecl)scala.xml.dtd.AttrDecl">AttrDecl</a><span class="delimiter">(</span><a href="#1297032" title="String">aname</a>, <a href="#1297033" title="String">atpe</a>, <a href="#1297034" title="scala.xml.dtd.DefaultDecl">defdecl</a><span class="delimiter">)</span>
      <a href="#1294106" title="=&gt; StringBuilder">cbuf</a>.<a href="../../collection/mutable/StringBuilder.scala.html#66552" title="(n: Int)Unit">length</a> = <span title="Int(0)" class="int">0</span>
    <span class="delimiter">}</span>
    <a href="#1294125" title="()Unit">nextch</a>
    <a href="#1294082" title="=&gt; scala.xml.parsing.MarkupHandler">handle</a>.<a href="MarkupHandler.scala.html#1290238" title="(name: String, attList: List[scala.xml.dtd.AttrDecl])Unit">attListDecl</a><span class="delimiter">(</span><a href="#1297018" title="String">n</a>, <a href="#1297019" title="List[scala.xml.dtd.AttrDecl]">attList</a>.<a href="../../collection/immutable/List.scala.html#63674" title="=&gt; List[scala.xml.dtd.AttrDecl]">reverse</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  /** {{{
   *  &lt;! element := ELEMENT
   *  }}} */
  <span class="keyword">def</span> <a title="()Unit" id="1294146">entityDecl</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Boolean" id="1296948">isParameterEntity</a> = <span title="Boolean(false)" class="keyword">false</span>
    <span class="keyword">var</span> <a title="scala.xml.dtd.EntityDef" id="1296949">entdef</a>: <a href="../dtd/Decl.scala.html#56017" title="scala.xml.dtd.EntityDef">EntityDef</a> = <span title="Null(null)" class="keyword">null</span>
    <a href="MarkupParserCommon.scala.html#700546" title="(that: Seq[Char])Unit">xToken</a><span class="delimiter">(</span><a href="../../LowPriorityImplicits.scala.html#8362" title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString" class="string">&quot;NTITY&quot;</a><span class="delimiter">)</span>
    <a href="MarkupParserCommon.scala.html#700549" title="()Unit">xSpace</a>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="Char('%')" class="char">'%'</span> <a href="../../Char.scala.html#58041" title="(x: Char)Boolean">==</a> <a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#1294125" title="()Unit">nextch</a>
      <a href="#1296948" title="Boolean">isParameterEntity</a> = <span title="Boolean(true)" class="keyword">true</span>
      <a href="MarkupParserCommon.scala.html#700549" title="()Unit">xSpace</a>
    <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="String" id="1296950">n</a> = <a href="MarkupParserCommon.scala.html#700524" title="=&gt; String">xName</a>
    <a href="MarkupParserCommon.scala.html#700549" title="()Unit">xSpace</a>
    <a href="#1294105" title="=&gt; Char">ch</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span class="char">'S'</span> | <span class="char">'P'</span> =&gt; //sy
        <span class="keyword">val</span> <a title="scala.xml.dtd.ExternalID" id="1296962">extID</a> = <a href="#1294133" title="()scala.xml.dtd.ExternalID">externalID</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1296948" title="Boolean">isParameterEntity</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="MarkupParserCommon.scala.html#700548" title="()Unit">xSpaceOpt</a>
          <a href="MarkupParserCommon.scala.html#700545" title="(that: Char)Unit">xToken</a><span class="delimiter">(</span><span title="Char('&gt;')" class="char">'&gt;'</span><span class="delimiter">)</span>
          <a href="#1294082" title="=&gt; scala.xml.parsing.MarkupHandler">handle</a>.<a href="MarkupHandler.scala.html#1290240" title="(name: String, edef: scala.xml.dtd.EntityDef)Unit">parameterEntityDecl</a><span class="delimiter">(</span><a href="#1296950" title="String">n</a>, <a href="../dtd/Decl.scala.html#1288194" title="(extID: scala.xml.dtd.ExternalID)scala.xml.dtd.ExtDef">ExtDef</a><span class="delimiter">(</span><a href="#1296962" title="scala.xml.dtd.ExternalID">extID</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span> // notation?
          <a href="MarkupParserCommon.scala.html#700549" title="()Unit">xSpace</a>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="Char('&gt;')" class="char">'&gt;'</span> <a href="../../Char.scala.html#58048" title="(x: Char)Boolean">!=</a> <a href="#1294105" title="=&gt; Char">ch</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="MarkupParserCommon.scala.html#700546" title="(that: Seq[Char])Unit">xToken</a><span class="delimiter">(</span><a href="../../LowPriorityImplicits.scala.html#8362" title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString" class="string">&quot;NDATA&quot;</a><span class="delimiter">)</span>
            <a href="MarkupParserCommon.scala.html#700549" title="()Unit">xSpace</a>
            <span class="keyword">val</span> <a title="String" id="1296976">notat</a> = <a href="MarkupParserCommon.scala.html#700524" title="=&gt; String">xName</a>
            <a href="MarkupParserCommon.scala.html#700548" title="()Unit">xSpaceOpt</a>
            <a href="MarkupParserCommon.scala.html#700545" title="(that: Char)Unit">xToken</a><span class="delimiter">(</span><span title="Char('&gt;')" class="char">'&gt;'</span><span class="delimiter">)</span>
            <a href="#1294082" title="=&gt; scala.xml.parsing.MarkupHandler">handle</a>.<a href="MarkupHandler.scala.html#1290243" title="(name: String, extID: scala.xml.dtd.ExternalID, notat: String)Unit">unparsedEntityDecl</a><span class="delimiter">(</span><a href="#1296950" title="String">n</a>, <a href="#1296962" title="scala.xml.dtd.ExternalID">extID</a>, <a href="#1296976" title="String">notat</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
            <a href="#1294125" title="()Unit">nextch</a>
            <a href="#1294082" title="=&gt; scala.xml.parsing.MarkupHandler">handle</a>.<a href="MarkupHandler.scala.html#1290241" title="(name: String, edef: scala.xml.dtd.EntityDef)Unit">parsedEntityDecl</a><span class="delimiter">(</span><a href="#1296950" title="String">n</a>, <a href="../dtd/Decl.scala.html#1288194" title="(extID: scala.xml.dtd.ExternalID)scala.xml.dtd.ExtDef">ExtDef</a><span class="delimiter">(</span><a href="#1296962" title="scala.xml.dtd.ExternalID">extID</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>

      <span class="keyword">case</span> <span class="char">'&quot;'</span> | <span class="char">'\''</span> =&gt;
        <span class="keyword">val</span> <a title="String" id="1296991">av</a> = <a href="#1294127" title="()String">xEntityValue</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="MarkupParserCommon.scala.html#700548" title="()Unit">xSpaceOpt</a>
        <a href="MarkupParserCommon.scala.html#700545" title="(that: Char)Unit">xToken</a><span class="delimiter">(</span><span title="Char('&gt;')" class="char">'&gt;'</span><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1296948" title="Boolean">isParameterEntity</a><span class="delimiter">)</span>
          <a href="#1294082" title="=&gt; scala.xml.parsing.MarkupHandler">handle</a>.<a href="MarkupHandler.scala.html#1290240" title="(name: String, edef: scala.xml.dtd.EntityDef)Unit">parameterEntityDecl</a><span class="delimiter">(</span><a href="#1296950" title="String">n</a>, <a href="../dtd/Decl.scala.html#1288386" title="(value: String)scala.xml.dtd.IntDef">IntDef</a><span class="delimiter">(</span><a href="#1296991" title="String">av</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">else</span>
          <a href="#1294082" title="=&gt; scala.xml.parsing.MarkupHandler">handle</a>.<a href="MarkupHandler.scala.html#1290241" title="(name: String, edef: scala.xml.dtd.EntityDef)Unit">parsedEntityDecl</a><span class="delimiter">(</span><a href="#1296950" title="String">n</a>, <a href="../dtd/Decl.scala.html#1288386" title="(value: String)scala.xml.dtd.IntDef">IntDef</a><span class="delimiter">(</span><a href="#1296991" title="String">av</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>
  <span class="delimiter">}</span> // entityDecl

  /** {{{
   *  'N' notationDecl ::= &quot;OTATION&quot;
   *  }}} */
  <span class="keyword">def</span> <a title="()Unit" id="1294147">notationDecl</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="MarkupParserCommon.scala.html#700546" title="(that: Seq[Char])Unit">xToken</a><span class="delimiter">(</span><a href="../../LowPriorityImplicits.scala.html#8362" title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString" class="string">&quot;OTATION&quot;</a><span class="delimiter">)</span>
    <a href="MarkupParserCommon.scala.html#700549" title="()Unit">xSpace</a>
    <span class="keyword">val</span> <a title="String" id="1297334">notat</a> = <a href="MarkupParserCommon.scala.html#700524" title="=&gt; String">xName</a>
    <a href="MarkupParserCommon.scala.html#700549" title="()Unit">xSpace</a>
    <span class="keyword">val</span> <a title="scala.xml.dtd.ExternalID" id="1297335">extID</a> = <span title="scala.xml.dtd.ExternalID" class="keyword">if</span> <span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a> <a href="../../Char.scala.html#58041" title="(x: Char)Boolean">==</a> <span title="Char('S')" class="char">'S'</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#1294133" title="()scala.xml.dtd.ExternalID">externalID</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">else</span> <span title="scala.xml.dtd.PublicID" class="keyword">if</span> <span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a> <a href="../../Char.scala.html#58041" title="(x: Char)Boolean">==</a> <span title="Char('P')" class="char">'P'</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      /** PublicID (without system, only used in NOTATION) */
      <a href="#1294125" title="()Unit">nextch</a>
      <a href="MarkupParserCommon.scala.html#700546" title="(that: Seq[Char])Unit">xToken</a><span class="delimiter">(</span><a href="../../LowPriorityImplicits.scala.html#8362" title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString" class="string">&quot;UBLIC&quot;</a><span class="delimiter">)</span>
      <a href="MarkupParserCommon.scala.html#700549" title="()Unit">xSpace</a>
      <span class="keyword">val</span> <a title="String" id="1297352">pubID</a> = <a href="#1294139" title="()String">pubidLiteral</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="MarkupParserCommon.scala.html#700548" title="()Unit">xSpaceOpt</a>
      <span class="keyword">val</span> <a title="String" id="1297353">sysID</a> = <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#1294105" title="=&gt; Char">ch</a> <a href="../../Char.scala.html#58048" title="(x: Char)Boolean">!=</a> <span title="Char('&gt;')" class="char">'&gt;'</span><span class="delimiter">)</span>
        <a href="#1294138" title="()String">systemLiteral</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">else</span>
        <span title="Null(null)" class="keyword">null</span>;
      <span title="scala.xml.dtd.PublicID" class="keyword">new</span> <a href="../dtd/ExternalID.scala.html#56068" title="scala.xml.dtd.PublicID">PublicID</a><span class="delimiter">(</span><a href="#1297352" title="String">pubID</a>, <a href="#1297353" title="String">sysID</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#1294149" title="(str: String)Unit">reportSyntaxError</a><span class="delimiter">(</span><span title="String(&quot;PUBLIC or SYSTEM expected&quot;)" class="string">&quot;PUBLIC or SYSTEM expected&quot;</span><span class="delimiter">)</span>;
      sys.<a href="../../sys/package.scala.html#57155" title="(message: String)Nothing">error</a><span class="delimiter">(</span><span title="String(&quot;died parsing notationdecl&quot;)" class="string">&quot;died parsing notationdecl&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="MarkupParserCommon.scala.html#700548" title="()Unit">xSpaceOpt</a>
    <a href="MarkupParserCommon.scala.html#700545" title="(that: Char)Unit">xToken</a><span class="delimiter">(</span><span title="Char('&gt;')" class="char">'&gt;'</span><span class="delimiter">)</span>
    <a href="#1294082" title="=&gt; scala.xml.parsing.MarkupHandler">handle</a>.<a href="MarkupHandler.scala.html#1290244" title="(notat: String, extID: scala.xml.dtd.ExternalID)Unit">notationDecl</a><span class="delimiter">(</span><a href="#1297334" title="String">notat</a>, <a href="#1297335" title="scala.xml.dtd.ExternalID">extID</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(pos: Int, str: String)Unit" id="1294148">reportSyntaxError</a><span class="delimiter">(</span><a title="Int" id="1295671">pos</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <a title="String" id="1295672">str</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#1294078" title="scala.io.Source" id="1297375">curInput</a>.<a href="../../io/Source.scala.html#416585" title="java.io.PrintStream" id="1297378">reportError</a><span class="delimiter">(</span><a href="#1295671" title="Int" id="1297376">pos</a>, <a href="#1295672" title="String" id="1297377">str</a><span class="delimiter">)</span> <span class="delimiter">}</span>
  <span class="keyword">def</span> <a title="(str: String)Unit" id="1294149">reportSyntaxError</a><span class="delimiter">(</span><a title="String" id="1295675">str</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#1294148" title="(pos: Int, str: String)Unit">reportSyntaxError</a><span class="delimiter">(</span><a href="#1294088" title="=&gt; Int">pos</a>, <a href="#1295675" title="String">str</a><span class="delimiter">)</span> <span class="delimiter">}</span>
  <span class="keyword">def</span> <a title="(pos: Int, str: String)Unit" id="1294150">reportValidationError</a><span class="delimiter">(</span><a title="Int" id="1297383">pos</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <a title="String" id="1297384">str</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#1294148" title="(pos: Int, str: String)Unit">reportSyntaxError</a><span class="delimiter">(</span><a href="#1297383" title="Int">pos</a>, <a href="#1297384" title="String">str</a><span class="delimiter">)</span> <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(entityName: String)Unit" id="1294151">push</a><span class="delimiter">(</span><a title="String" id="1296498">entityName</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1294114" title="=&gt; Boolean">eof</a><span class="delimiter">)</span>
      <a href="#1294085" title="(x$1: List[scala.io.Source])Unit">inpStack</a> = <a href="#1294078" title="=&gt; scala.io.Source">curInput</a> <a href="../../collection/immutable/List.scala.html#63643" title="(x: scala.io.Source)List[scala.io.Source]">::</a> <a href="#1294085" title="=&gt; List[scala.io.Source]">inpStack</a>

    // can't push before getting next character if needed
    <a href="#1294105" title="=&gt; Char">ch</a>

    <a href="#1294078" title="(x$1: scala.io.Source)Unit">curInput</a> = <a href="MarkupHandler.scala.html#1290228" title="(entityName: String)scala.io.Source">replacementText</a><span class="delimiter">(</span><a href="#1296498" title="String">entityName</a><span class="delimiter">)</span>
    <a href="#1294125" title="()Unit">nextch</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(systemId: String)Unit" id="1294152">pushExternal</a><span class="delimiter">(</span><a title="String" id="1296582">systemId</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1294114" title="=&gt; Boolean">eof</a><span class="delimiter">)</span>
      <a href="#1294085" title="(x$1: List[scala.io.Source])Unit">inpStack</a> = <a href="#1294078" title="=&gt; scala.io.Source">curInput</a> <a href="../../collection/immutable/List.scala.html#63643" title="(x: scala.io.Source)List[scala.io.Source]">::</a> <a href="#1294085" title="=&gt; List[scala.io.Source]">inpStack</a>

    // can't push before getting next character if needed
    <a href="#1294105" title="=&gt; Char">ch</a>

    <a href="#1294078" title="(x$1: scala.io.Source)Unit">curInput</a> = <a href="#1294076" title="(systemLiteral: String)scala.io.Source">externalSource</a><span class="delimiter">(</span><a href="#1296582" title="String">systemId</a><span class="delimiter">)</span>
    <a href="#1294125" title="()Unit">nextch</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="1294153">pop</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#1294078" title="(x$1: scala.io.Source)Unit">curInput</a> = <a href="#1294085" title="=&gt; List[scala.io.Source]">inpStack</a>.<a href="../../collection/IterableLike.scala.html#59473" title="=&gt; scala.io.Source">head</a>
    <a href="#1294085" title="(x$1: List[scala.io.Source])Unit">inpStack</a> = <a href="#1294085" title="=&gt; List[scala.io.Source]">inpStack</a>.<a href="../../collection/TraversableLike.scala.html#59012" title="=&gt; List[scala.io.Source]">tail</a>
    <a href="#1294103" title="(x$1: Char)Unit">lastChRead</a> = <a href="#1294078" title="=&gt; scala.io.Source">curInput</a>.<a href="../../io/Source.scala.html#213894" title="=&gt; Char">ch</a>
    <a href="#1294097" title="(x$1: Boolean)Unit">nextChNeeded</a> = <span title="Boolean(false)" class="keyword">false</span>
    <a href="#1294088" title="(x$1: Int)Unit">pos</a> = <a href="#1294078" title="=&gt; scala.io.Source">curInput</a>.<a href="../../io/Source.scala.html#213895" title="=&gt; Int">pos</a>
    <a href="#1294100" title="(x$1: Boolean)Unit">reachedEof</a> = <span title="Boolean(false)" class="keyword">false</span> // must be false, because of places where entity refs occur
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
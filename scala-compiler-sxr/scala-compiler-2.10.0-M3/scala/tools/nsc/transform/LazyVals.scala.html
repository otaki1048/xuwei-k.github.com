<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/transform/LazyVals.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> transform

<span class="keyword">import</span> scala.collection.<span class="delimiter">{</span> mutable, immutable <span class="delimiter">}</span>

<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class LazyVals extends scala.tools.nsc.SubComponent with scala.tools.nsc.transform.Transform with scala.tools.nsc.transform.TypingTransformers with scala.tools.nsc.ast.TreeDSL" id="45304">LazyVals</a> <a href="#45304" title="scala.tools.nsc.transform.LazyVals" class="keyword">extends</a> <a href="Transform.scala.html#44824" title="scala.tools.nsc.transform.Transform">Transform</a> <span class="keyword">with</span> <a href="TypingTransformers.scala.html#45109" title="scala.tools.nsc.transform.TypingTransformers">TypingTransformers</a> <span class="keyword">with</span> ast.<a href="../ast/TreeDSL.scala.html#29480" title="scala.tools.nsc.ast.TreeDSL">TreeDSL</a> <span class="delimiter">{</span>
  // inherits abstract value `global` and class `Phase` from Transform

  <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#560219" title="=&gt; scala.tools.nsc.Global">global</a>._                  // the global environment
  <span class="keyword">import</span> <a href="../../../reflect/internal/Definitions.scala.html#441641" title="LazyVals.this.global.definitions.type">definitions</a>._             // standard classes and methods
  <span class="keyword">import</span> <a href="../Global.scala.html#559643" title="LazyVals.this.global.typer.type">typer</a>.<span class="delimiter">{</span>typed, atOwner<span class="delimiter">}</span>    // methods to type trees
  <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#560223" title="LazyVals.this.CODE.type">CODE</a>._

  <span class="keyword">val</span> <a title="String" id="651544">phaseName</a>: <span title="String">String</span> = <span title="String(&quot;lazyvals&quot;)" class="string">&quot;lazyvals&quot;</span>
  <span class="keyword">val</span> <a title="=&gt; Int" id="651546">FLAGS_PER_WORD</a>: <a href="../../../Int.scala.html#508" title="Int">Int</a>

  <span class="keyword">def</span> <a title="(unit: LazyVals.this.global.CompilationUnit)LazyVals.this.global.Transformer" id="651547">newTransformer</a><span class="delimiter">(</span><a title="LazyVals.this.global.CompilationUnit" id="1058480">unit</a>: <a href="../CompilationUnits.scala.html#559797" title="LazyVals.this.global.CompilationUnit">CompilationUnit</a><span class="delimiter">)</span>: <a href="../ast/Trees.scala.html#559848" title="LazyVals.this.global.Transformer">Transformer</a> =
    <span title="LazyVals.this.LazyValues" class="keyword">new</span> <a href="#651551" title="LazyVals.this.LazyValues">LazyValues</a><span class="delimiter">(</span><a href="#1058480" title="LazyVals.this.global.CompilationUnit">unit</a><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: LazyVals.this.global.Symbol)Boolean" id="651548">lazyUnit</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="1058498">sym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="LazyVals.this.global.Symbol">Symbol</a><span class="delimiter">)</span> = <a href="#1058498" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; LazyVals.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#442002" title="=&gt; LazyVals.this.global.Type">resultType</a>.<a href="../../../reflect/internal/Types.scala.html#441986" title="=&gt; LazyVals.this.global.Symbol">typeSymbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#442841" title="=&gt; LazyVals.this.global.ClassSymbol">UnitClass</a>

  <span class="keyword">object</span> <a title="LazyVals.this.LocalLazyValFinder.type" id="651549">LocalLazyValFinder</a> <a href="#651550" title="LazyVals.this.LocalLazyValFinder.type" class="keyword">extends</a> <a href="../../../reflect/api/Trees.scala.html#23760" title="LazyVals.this.global.Traverser">Traverser</a> <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Boolean" id="1058512">result</a>: <a href="../../../Boolean.scala.html#2218" title="Boolean">Boolean</a>  = _

    <span class="keyword">def</span> <a title="(t: LazyVals.this.global.Tree)Boolean" id="1058514">find</a><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="1058519">t</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="LazyVals.this.global.Tree">Tree</a><span class="delimiter">)</span> = <span class="delimiter">{</span><a href="#1058512" title="(x$1: Boolean)Unit">result</a> = <span title="Boolean(false)" class="keyword">false</span>; <a href="#1058516" title="(t: LazyVals.this.global.Tree)Unit">traverse</a><span class="delimiter">(</span><a href="#1058519" title="LazyVals.this.global.Tree">t</a><span class="delimiter">)</span>; <a href="#1058512" title="=&gt; Boolean">result</a><span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="(ts: List[LazyVals.this.global.Tree])Boolean" id="1058515">find</a><span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="1058522">ts</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[LazyVals.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span><a href="#1058512" title="(x$1: Boolean)Unit">result</a> = <span title="Boolean(false)" class="keyword">false</span>; <a href="../../../reflect/api/Trees.scala.html#433536" title="(trees: List[LazyVals.this.global.Tree])Unit">traverseTrees</a><span class="delimiter">(</span><a href="#1058522" title="List[LazyVals.this.global.Tree]">ts</a><span class="delimiter">)</span>; <a href="#1058512" title="=&gt; Boolean">result</a><span class="delimiter">}</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(t: LazyVals.this.global.Tree)Unit" id="1058516">traverse</a><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="1058520">t</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="LazyVals.this.global.Tree">Tree</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1058512" title="=&gt; Boolean">result</a><span class="delimiter">)</span>
        <a href="#1058520" title="LazyVals.this.global.Tree">t</a> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> v@ValDef<a href="#1058626" title="Unit" id="1058632" class="delimiter">(</a>_, _, _, _<span class="delimiter">)</span> <span class="keyword">if</span> v.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; LazyVals.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/HasFlags.scala.html#443593" title="=&gt; Boolean">isLazy</a> =&gt;
            <a href="#1058512" title="(x$1: Boolean)Unit">result</a> = <span title="Boolean(true)" class="keyword">true</span>

          <span class="keyword">case</span> d@DefDef<a href="#1058626" title="Unit" id="1058640" class="delimiter">(</a>_, _, _, _, _, _<span class="delimiter">)</span> <span class="keyword">if</span> d.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; LazyVals.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/HasFlags.scala.html#443593" title="=&gt; Boolean">isLazy</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#651548" title="(sym: LazyVals.this.global.Symbol)Boolean">lazyUnit</a><span class="delimiter">(</span>d.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; LazyVals.this.global.Symbol">symbol</a><span class="delimiter">)</span> =&gt;
            d.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; LazyVals.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443306" title="(mask: Long)LazyVals.this.global.Symbol">resetFlag</a><span class="delimiter">(</span>symtab.Flags.<span title="Long(2147483648L)">LAZY</span><span class="delimiter">)</span>
            <a href="#1058512" title="(x$1: Boolean)Unit">result</a> = <span title="Boolean(true)" class="keyword">true</span>

          <span class="keyword">case</span> ClassDef<a href="#1058626" title="Unit" id="1058646" class="delimiter">(</a>_, _, _, _<span class="delimiter">)</span> | DefDef<a href="#1058626" title="Boolean" id="1058654" class="delimiter">(</a>_, _, _, _, _, _<span class="delimiter">)</span> | ModuleDef<a href="#1058626" title="Boolean" id="1058659" class="delimiter">(</a>_, _, _<span class="delimiter">)</span> =&gt;

          <span class="keyword">case</span> LabelDef<a href="#1058626" title="Unit" id="1058663" class="delimiter">(</a>name, _, _<span class="delimiter">)</span> <span class="keyword">if</span> <a href="../../../reflect/internal/StdNames.scala.html#441764" title="LazyVals.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#446228" title="(name: LazyVals.this.global.Name)Boolean">isLoopHeaderLabel</a><span class="delimiter">(</span>name<span class="delimiter">)</span> =&gt;

          <span class="keyword">case</span> _ =&gt;
            <span class="keyword">super</span>.<a href="../../../reflect/api/Trees.scala.html#433535" title="(tree: LazyVals.this.global.Tree)Unit">traverse</a><a href="#1058664" title="(x: Unit)Unit" class="delimiter">(</a><a href="#1058520" title="LazyVals.this.global.Tree">t</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /**
   * Transform local lazy accessors to check for the initialized bit.
   */
  <span class="keyword">class</span> <a title="class LazyValues extends LazyVals.this.TypingTransformer" id="651551">LazyValues</a><a href="#651551" title="LazyVals.this.LazyValues" class="delimiter">(</a><a title="LazyVals.this.global.CompilationUnit" id="1058497">unit</a>: <a href="../CompilationUnits.scala.html#559797" title="LazyVals.this.global.CompilationUnit">CompilationUnit</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="TypingTransformers.scala.html#650652" title="LazyVals.this.TypingTransformer">TypingTransformer</a><span class="delimiter">(</span><a href="#1058497" title="LazyVals.this.global.CompilationUnit">unit</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    /** map from method symbols to the number of lazy values it defines. */
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.Map[LazyVals.this.global.Symbol,Int]" id="1058486">lazyVals</a> = <a href="../../../reflect/internal/SymbolTable.scala.html#440630" title="LazyVals.this.global.perRunCaches.type">perRunCaches</a>.<a href="../../../reflect/internal/SymbolTable.scala.html#492850" title="[K, V]()scala.collection.mutable.HashMap[K,V]">newMap</a><span title="()scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,Int]" class="delimiter">[</span><a href="../../../reflect/internal/Symbols.scala.html#441132" title="LazyVals.this.global.Symbol">Symbol</a>, <a href="../../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span> <a href="../../../collection/mutable/Map.scala.html#78489" title="(d: Int)scala.collection.mutable.Map[LazyVals.this.global.Symbol,Int]">withDefaultValue</a> <span title="Int(0)" class="int">0</span>

    <span class="keyword">import</span> symtab.<a href="../symtab/package.scala.html#57302" title="=&gt; reflect.internal.Flags.type">Flags</a>._
    <span class="keyword">import</span> <a href="#1058486" title="=&gt; scala.collection.mutable.Map[LazyVals.this.global.Symbol,Int]">lazyVals</a>._

    /** Perform the following transformations:
     *  - for a lazy accessor inside a method, make it check the initialization bitmap
     *  - for all methods, add enough int vars to allow one flag per lazy local value
     *  - blocks in template bodies behave almost like methods. A single bitmaps section is
     *      added in the first block, for all lazy values defined in such blocks.
     *  - remove ACCESSOR flags: accessors in traits are not statically implemented,
     *    but moved to the host class. local lazy values should be statically implemented.
     */
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree" id="1058490">transform</a><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="1058684">tree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="LazyVals.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="LazyVals.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="LazyVals.this.global.Symbol" id="1058689">sym</a> = <a href="#1058684" title="LazyVals.this.global.Tree">tree</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; LazyVals.this.global.Symbol">symbol</a>
      <a href="TypingTransformers.scala.html#1050334" title="(x$1: LazyVals.this.global.Tree)Unit">curTree</a> = <a href="#1058684" title="LazyVals.this.global.Tree">tree</a>

      <a href="#1058684" title="LazyVals.this.global.Tree">tree</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> DefDef<a href="#1059309" title="LazyVals.this.global.Tree" id="1059316" class="delimiter">(</a>_, _, _, _, _, rhs<span class="delimiter">)</span> =&gt; <a href="TypingTransformers.scala.html#1050339" title="(owner: LazyVals.this.global.Symbol)(trans: =&gt; LazyVals.this.global.DefDef)LazyVals.this.global.DefDef">atOwner</a><span class="delimiter">(</span><a href="#1058684" title="LazyVals.this.global.Tree">tree</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; LazyVals.this.global.Symbol">symbol</a><span class="delimiter">)</span> <a href="#1059339" title="(x: LazyVals.this.global.Tree)LazyVals.this.global.Tree" class="delimiter">{</a>
          <span class="keyword">val</span> <a title="LazyVals.this.global.Tree" id="1058720">res</a> = <span title="LazyVals.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1058689" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; LazyVals.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#443231" title="=&gt; Boolean">isClass</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1058689" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/HasFlags.scala.html#443593" title="=&gt; Boolean">isLazy</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="LazyVals.this.global.Symbol" id="1058722">enclosingClassOrDummyOrMethod</a> = <span class="delimiter">{</span>
              <span class="keyword">val</span> <a title="LazyVals.this.global.Symbol" id="1058725">enclMethod</a> = <a href="#1058689" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443481" title="=&gt; LazyVals.this.global.Symbol">enclMethod</a>

              <span title="LazyVals.this.global.Symbol" class="keyword">if</span> <span class="delimiter">(</span><a href="#1058725" title="LazyVals.this.global.Symbol">enclMethod</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; LazyVals.this.global.NoSymbol">NoSymbol</a> <span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">val</span> <a title="LazyVals.this.global.Symbol" id="1058730">enclClass</a> = <a href="#1058689" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443480" title="=&gt; LazyVals.this.global.Symbol">enclClass</a>
                <span title="LazyVals.this.global.Symbol" class="keyword">if</span> <span class="delimiter">(</span><a href="#1058730" title="LazyVals.this.global.Symbol">enclClass</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; LazyVals.this.global.NoSymbol">NoSymbol</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1058725" title="LazyVals.this.global.Symbol">enclMethod</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#1058730" title="LazyVals.this.global.Symbol">enclClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443481" title="=&gt; LazyVals.this.global.Symbol">enclMethod</a><span class="delimiter">)</span>
                  <a href="#1058730" title="LazyVals.this.global.Symbol">enclClass</a>
                <span class="keyword">else</span>
                  <a href="#1058725" title="LazyVals.this.global.Symbol">enclMethod</a>
              <span class="delimiter">}</span> <span class="keyword">else</span>
                <a href="#1058689" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; LazyVals.this.global.Symbol">owner</a>
            <span class="delimiter">}</span>
            <span class="keyword">val</span> <a title="Int" id="1058723">idx</a> = <a href="../../../collection/MapLike.scala.html#78420" title="(key: LazyVals.this.global.Symbol)Int">lazyVals</a><span class="delimiter">(</span><a href="#1058722" title="LazyVals.this.global.Symbol">enclosingClassOrDummyOrMethod</a><span class="delimiter">)</span>
            <a href="../../../collection/mutable/MapLike.scala.html#78496" title="(key: LazyVals.this.global.Symbol, value: Int)Unit">lazyVals</a><span class="delimiter">(</span><a href="#1058722" title="LazyVals.this.global.Symbol">enclosingClassOrDummyOrMethod</a><span class="delimiter">)</span> = <a href="#1058723" title="Int">idx</a> <a href="../../../Int.scala.html#57948" title="(x: Int)Int">+</a> <span title="Int(1)" class="int">1</span>
            <span class="keyword">val</span> <a title="LazyVals.this.global.Tree" id="1058724">rhs1</a> = <a href="#1058492" title="(methOrClass: LazyVals.this.global.Symbol, tree: LazyVals.this.global.Tree, offset: Int, lazyVal: LazyVals.this.global.Symbol)LazyVals.this.global.Tree">mkLazyDef</a><span class="delimiter">(</span><a href="#1058722" title="LazyVals.this.global.Symbol">enclosingClassOrDummyOrMethod</a>, <a href="#651551" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="TypingTransformers.scala.html#1050345" title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree">transform</a><span class="delimiter">(</span>rhs<span class="delimiter">)</span>, <a href="#1058723" title="Int">idx</a>, <a href="#1058689" title="LazyVals.this.global.Symbol">sym</a><span class="delimiter">)</span>
            <a href="#1058689" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443306" title="(mask: Long)sym.type">resetFlag</a><span class="delimiter">(</span><span class="delimiter">(</span><span title="Long" class="keyword">if</span> <span class="delimiter">(</span><a href="#651548" title="(sym: LazyVals.this.global.Symbol)Boolean">lazyUnit</a><span class="delimiter">(</span><a href="#1058689" title="LazyVals.this.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="Long(0L)" class="int">0</span> <span class="keyword">else</span> <span title="Long(2147483648L)">LAZY</span><span class="delimiter">)</span> <a href="../../../Long.scala.html#58295" title="(x: Int)Long">|</a> <span title="Int(134217728)">ACCESSOR</span><span class="delimiter">)</span>
            <a href="#1058724" title="LazyVals.this.global.Tree">rhs1</a>
          <span class="delimiter">}</span> <span class="keyword">else</span>
            <a href="#651551" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="TypingTransformers.scala.html#1050345" title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree">transform</a><span class="delimiter">(</span>rhs<span class="delimiter">)</span>

          <a href="../../../reflect/api/Trees.scala.html#23753" title="(ddef: LazyVals.this.global.Tree)(applyToRhs: LazyVals.this.global.Tree =&gt; LazyVals.this.global.Tree)LazyVals.this.global.DefDef">deriveDefDef</a><span class="delimiter">(</span><a href="#1058684" title="LazyVals.this.global.Tree">tree</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="1058794">_</a> =&gt; <span title="LazyVals.this.global.analyzer.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#651549" title="LazyVals.this.LocalLazyValFinder.type">LocalLazyValFinder</a>.<a href="#1058514" title="(t: LazyVals.this.global.Tree)Boolean">find</a><span class="delimiter">(</span><a href="#1058720" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../typechecker/Typers.scala.html#560768" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#1058491" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#1058689" title="LazyVals.this.global.Symbol">sym</a>, <a href="#1058720" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#1058720" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span class="keyword">case</span> Template<a href="#1059309" title="LazyVals.this.global.Tree" id="1059320" class="delimiter">(</a>_, _, body<span class="delimiter">)</span> =&gt; <a href="TypingTransformers.scala.html#1050339" title="(owner: LazyVals.this.global.Symbol)(trans: =&gt; LazyVals.this.global.Template)LazyVals.this.global.Template">atOwner</a><span class="delimiter">(</span><a href="../../../reflect/api/Trees.scala.html#438841" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a><span class="delimiter">)</span> <a href="#1059339" title="(x: LazyVals.this.global.Tree)LazyVals.this.global.Tree" class="delimiter">{</a>
          <span class="keyword">val</span> <a title="List[LazyVals.this.global.Tree]" id="1058842">body1</a> = <a href="#651551" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="../../../reflect/api/Trees.scala.html#438848" title="(trees: List[LazyVals.this.global.Tree])List[LazyVals.this.global.Tree]">transformTrees</a><span class="delimiter">(</span>body<span class="delimiter">)</span>
          <span class="keyword">var</span> <a title="Boolean" id="1058843">added</a> = <span title="Boolean(false)" class="keyword">false</span>
          <span class="keyword">val</span> <a title="List[LazyVals.this.global.analyzer.global.Tree]" id="1058844">stats</a> =
            <span class="keyword">for</span> <span class="delimiter">(</span>stat &lt;- <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: LazyVals.this.global.Tree =&gt; LazyVals.this.global.analyzer.global.Tree)(implicit bf: scala.collection.generic.CanBuildFrom[List[LazyVals.this.global.Tree],LazyVals.this.global.analyzer.global.Tree,List[LazyVals.this.global.analyzer.global.Tree]])List[LazyVals.this.global.analyzer.global.Tree]">body1</a><span class="delimiter">)</span> <span class="keyword">yield</span> <a href="#1058865" title="LazyVals.this.global.Tree">stat</a> <span class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> Block<a href="#1058902" title="LazyVals.this.global.analyzer.global.Tree" id="1058906" class="delimiter">(</a>_, _<span class="delimiter">)</span> | Apply<a href="#1058902" title="Boolean" id="1058910" class="delimiter">(</a>_, _<span class="delimiter">)</span> | If<a href="#1058902" title="Boolean" id="1058915" class="delimiter">(</a>_, _, _<span class="delimiter">)</span> <span class="keyword">if</span> <a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1058843" title="Boolean">added</a> =&gt;
                // Avoid adding bitmaps when they are fully overshadowed by those
                // that are added inside loops
                <a href="#1058922" title="(x: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree" class="keyword">if</a> <span class="delimiter">(</span><a href="#651549" title="LazyVals.this.LocalLazyValFinder.type">LocalLazyValFinder</a>.<a href="#1058514" title="(t: LazyVals.this.global.Tree)Boolean">find</a><span class="delimiter">(</span><a href="#1058865" title="LazyVals.this.global.Tree">stat</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                  <a href="#1058843" title="Boolean">added</a> = <span title="Boolean(true)" class="keyword">true</span>
                  <a href="../typechecker/Typers.scala.html#560768" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#1058491" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#1058689" title="LazyVals.this.global.Symbol">sym</a>, <a href="#1058865" title="LazyVals.this.global.Tree">stat</a><span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#1058865" title="LazyVals.this.global.Tree">stat</a>
              <span class="keyword">case</span> ValDef<a href="#1058902" title="LazyVals.this.global.analyzer.global.Tree" id="1058921" class="delimiter">(</a>_, _, _, _<span class="delimiter">)</span> =&gt;
                <a href="../typechecker/Typers.scala.html#560768" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><a href="#1058922" title="(x: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree" class="delimiter">(</a><a href="../../../reflect/api/Trees.scala.html#23754" title="(vdef: LazyVals.this.global.Tree)(applyToRhs: LazyVals.this.global.Tree =&gt; LazyVals.this.global.Tree)LazyVals.this.global.ValDef">deriveValDef</a><span class="delimiter">(</span><a href="#1058865" title="LazyVals.this.global.Tree">stat</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1058491" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#1058865" title="LazyVals.this.global.Tree">stat</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; LazyVals.this.global.Symbol">symbol</a>, <a href="#1058900" title="LazyVals.this.global.Tree">_</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="keyword">case</span> _ =&gt;
                <a href="#1058922" title="(x: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">stat</a>
            <span class="delimiter">}</span>
          <span class="keyword">val</span> <a title="List[LazyVals.this.global.analyzer.global.Tree]" id="1058845">innerClassBitmaps</a> = <span title="List[LazyVals.this.global.analyzer.global.Tree]" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1058843" title="Boolean">added</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../../reflect/api/Trees.scala.html#438841" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a>.<a href="../../../reflect/internal/Symbols.scala.html#443231" title="=&gt; Boolean">isClass</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1058494" title="=&gt; scala.collection.mutable.Map[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]">bitmaps</a>.<a href="../../../collection/MapLike.scala.html#78421" title="(key: LazyVals.this.global.Symbol)Boolean">contains</a><span class="delimiter">(</span><a href="../../../reflect/api/Trees.scala.html#438841" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              // add bitmap to inner class if necessary
                <span class="keyword">val</span> <a title="List[LazyVals.this.global.analyzer.global.Tree]" id="1058974">toAdd0</a> = <a href="../../../collection/MapLike.scala.html#78420" title="(key: LazyVals.this.global.Symbol)List[LazyVals.this.global.Symbol]">bitmaps</a><span class="delimiter">(</span><a href="../../../reflect/api/Trees.scala.html#438841" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a><span class="delimiter">)</span>.<a href="../../../collection/TraversableLike.scala.html#58971" title="(f: LazyVals.this.global.Symbol =&gt; LazyVals.this.global.analyzer.global.Tree)(implicit bf: scala.collection.generic.CanBuildFrom[List[LazyVals.this.global.Symbol],LazyVals.this.global.analyzer.global.Tree,List[LazyVals.this.global.analyzer.global.Tree]])List[LazyVals.this.global.analyzer.global.Tree]">map</a><a href="../../../collection/immutable/List.scala.html#63282" title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,LazyVals.this.global.analyzer.global.Tree,List[LazyVals.this.global.analyzer.global.Tree]]" class="delimiter">(</a><a title="LazyVals.this.global.Symbol" id="1059019">s</a> =&gt; <a href="../typechecker/Typers.scala.html#560768" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#441817" title="(sym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.ValDef">ValDef</a><span class="delimiter">(</span><a href="#1059019" title="LazyVals.this.global.Symbol">s</a>, <a href="../ast/TreeDSL.scala.html#653589" title="=&gt; LazyVals.this.global.Literal">ZERO</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                <a href="#1058974" title="List[LazyVals.this.global.analyzer.global.Tree]">toAdd0</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76166" title="(f: LazyVals.this.global.analyzer.global.Tree =&gt; Any)Unit">foreach</a><span class="delimiter">(</span><a title="LazyVals.this.global.analyzer.global.Tree" id="1059082">t</a> =&gt; <span class="delimiter">{</span>
                    <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../reflect/api/Trees.scala.html#438841" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a>.<a href="../../../reflect/internal/Symbols.scala.html#443427" title="=&gt; LazyVals.this.global.Type">info</a>.<a href="../../../reflect/internal/Types.scala.html#442020" title="(name: LazyVals.this.global.Name)LazyVals.this.global.Symbol">decl</a><span class="delimiter">(</span><a href="#1059082" title="LazyVals.this.global.analyzer.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; LazyVals.this.global.analyzer.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443152" title="=&gt; LazyVals.this.global.analyzer.global.Symbol#NameType">name</a><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; LazyVals.this.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                      <a href="#1059082" title="LazyVals.this.global.analyzer.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; LazyVals.this.global.analyzer.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443305" title="(mask: Long)LazyVals.this.global.analyzer.global.Symbol">setFlag</a><span class="delimiter">(</span><span title="Long(1L)">PROTECTED</span><span class="delimiter">)</span>
                      <a href="../../../reflect/api/Trees.scala.html#438841" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a>.<a href="../../../reflect/internal/Symbols.scala.html#443427" title="=&gt; LazyVals.this.global.Type">info</a>.<a href="../../../reflect/internal/Types.scala.html#442019" title="=&gt; LazyVals.this.global.Scope">decls</a>.<a href="../../../reflect/internal/Scopes.scala.html#447331" title="(sym: LazyVals.this.global.analyzer.global.Symbol)LazyVals.this.global.analyzer.global.Symbol">enter</a><span class="delimiter">(</span><a href="#1059082" title="LazyVals.this.global.analyzer.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; LazyVals.this.global.analyzer.global.Symbol">symbol</a><span class="delimiter">)</span>
                    <span class="delimiter">}</span>
                <span class="delimiter">}</span><span class="delimiter">)</span>
                <a href="#1058974" title="List[LazyVals.this.global.analyzer.global.Tree]">toAdd0</a>
            <span class="delimiter">}</span> <span class="keyword">else</span> List<a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type" class="delimiter">(</a><span class="delimiter">)</span>
          <a href="../../../reflect/api/Trees.scala.html#23755" title="(templ: LazyVals.this.global.Tree)(applyToBody: List[LazyVals.this.global.Tree] =&gt; List[LazyVals.this.global.Tree])LazyVals.this.global.Template">deriveTemplate</a><span class="delimiter">(</span><a href="#1058684" title="LazyVals.this.global.Tree">tree</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="1059120">_</a> =&gt; <a href="#1058845" title="List[LazyVals.this.global.analyzer.global.Tree]">innerClassBitmaps</a> <a href="../../../collection/immutable/List.scala.html#63655" title="(that: scala.collection.GenTraversableOnce[LazyVals.this.global.analyzer.global.Tree])(implicit bf: scala.collection.generic.CanBuildFrom[List[LazyVals.this.global.analyzer.global.Tree],LazyVals.this.global.analyzer.global.Tree,List[LazyVals.this.global.Tree]])List[LazyVals.this.global.Tree]">++</a> <a href="#1058844" title="List[LazyVals.this.global.analyzer.global.Tree]">stats</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span class="keyword">case</span> ValDef<a href="#1059309" title="LazyVals.this.global.Tree" id="1059326" class="delimiter">(</a>_, _, _, _<span class="delimiter">)</span> <span class="keyword">if</span> <a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1058689" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; LazyVals.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#443270" title="=&gt; Boolean">isModule</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1058689" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; LazyVals.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#443231" title="=&gt; Boolean">isClass</a> =&gt;
          <a href="../../../reflect/api/Trees.scala.html#23754" title="(vdef: LazyVals.this.global.Tree)(applyToRhs: LazyVals.this.global.Tree =&gt; LazyVals.this.global.Tree)LazyVals.this.global.ValDef">deriveValDef</a><span class="delimiter">(</span><a href="#1058684" title="LazyVals.this.global.Tree">tree</a><span class="delimiter">)</span> <a href="#1059339" title="(x: LazyVals.this.global.Tree)LazyVals.this.global.Tree" class="delimiter">{</a> <a title="LazyVals.this.global.Tree" id="1059189">rhs0</a> =&gt;
            <span class="keyword">val</span> <a title="LazyVals.this.global.Tree" id="1059190">rhs</a> = <a href="#651551" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="TypingTransformers.scala.html#1050345" title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#1059189" title="LazyVals.this.global.Tree">rhs0</a><span class="delimiter">)</span>
            <span title="LazyVals.this.global.analyzer.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#651549" title="LazyVals.this.LocalLazyValFinder.type">LocalLazyValFinder</a>.<a href="#1058514" title="(t: LazyVals.this.global.Tree)Boolean">find</a><span class="delimiter">(</span><a href="#1059190" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../typechecker/Typers.scala.html#560768" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#1058491" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#1058689" title="LazyVals.this.global.Symbol">sym</a>, <a href="#1059190" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#1059190" title="LazyVals.this.global.Tree">rhs</a>
          <span class="delimiter">}</span>

        <span class="keyword">case</span> l@LabelDef<a href="#1059309" title="Boolean" id="1059328" class="delimiter">(</a>name0, params0, ifp0@If<a title="LazyVals.this.global.Tree" id="1059333" class="delimiter">(</a>_, _, _<span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> name0.<a href="../../../reflect/internal/Names.scala.html#444157" title="(name: String)Boolean">startsWith</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#441764" title="LazyVals.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#446173" title="=&gt; String">WHILE_PREFIX</a><span class="delimiter">)</span> =&gt;
          <span class="keyword">val</span> <a title="LazyVals.this.global.Tree" id="1059218">ifp1</a> = <a href="#651551" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="TypingTransformers.scala.html#1050345" title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree">transform</a><span class="delimiter">(</span>ifp0<span class="delimiter">)</span>
          <span class="keyword">val</span> If<a href="#1059241" title="(LazyVals.this.global.Tree, LazyVals.this.global.Tree, LazyVals.this.global.Tree)" id="1059243" class="delimiter">(</a><a href="../../../Tuple3.scala.html#61402" title="LazyVals.this.global.Tree" id="1059220">cond0</a>, <a href="../../../Tuple3.scala.html#61404" title="LazyVals.this.global.Tree" id="1059221">thenp0</a>, <a href="../../../Tuple3.scala.html#61406" title="LazyVals.this.global.Tree" id="1059222">elsep0</a><span class="delimiter">)</span> = <a href="#1059218" title="LazyVals.this.global.Tree">ifp1</a>

          <span title="LazyVals.this.global.LabelDef" class="keyword">if</span> <span class="delimiter">(</span><a href="#651549" title="LazyVals.this.LocalLazyValFinder.type">LocalLazyValFinder</a>.<a href="#1058514" title="(t: LazyVals.this.global.Tree)Boolean">find</a><span class="delimiter">(</span><a href="#1059221" title="LazyVals.this.global.Tree">thenp0</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="../../../reflect/api/Trees.scala.html#23759" title="(ldef: LazyVals.this.global.Tree)(applyToRhs: LazyVals.this.global.Tree =&gt; LazyVals.this.global.Tree)LazyVals.this.global.LabelDef">deriveLabelDef</a><span class="delimiter">(</span>l<span class="delimiter">)</span><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="1059255">_</a> =&gt; <a href="../../../reflect/api/Trees.scala.html#438839" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<a href="../../../reflect/api/Trees.scala.html#428303" title="(tree: LazyVals.this.global.Tree, cond: LazyVals.this.global.Tree, thenp: LazyVals.this.global.Tree, elsep: LazyVals.this.global.Tree)LazyVals.this.global.If">If</a><span class="delimiter">(</span><a href="#1059218" title="LazyVals.this.global.Tree">ifp1</a>, <a href="#1059220" title="LazyVals.this.global.Tree">cond0</a>, <a href="../typechecker/Typers.scala.html#560768" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#1058491" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#1058689" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; LazyVals.this.global.Symbol">owner</a>, <a href="#1059221" title="LazyVals.this.global.Tree">thenp0</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#1059222" title="LazyVals.this.global.Tree">elsep0</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">else</span>
            l

        <span class="keyword">case</span> l@LabelDef<span class="delimiter">(</span>name0, params0, block@Block<a title="LazyVals.this.global.Tree" id="1059337" class="delimiter">(</a>stats0, expr<span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">if</span> name0.<a href="../../../reflect/internal/Names.scala.html#444157" title="(name: String)Boolean">startsWith</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#441764" title="LazyVals.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#446173" title="=&gt; String">WHILE_PREFIX</a><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> name0.<a href="../../../reflect/internal/Names.scala.html#444157" title="(name: String)Boolean">startsWith</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#441764" title="LazyVals.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#446147" title="=&gt; String">DO_WHILE_PREFIX</a><span class="delimiter">)</span> =&gt;
          <span class="keyword">val</span> <a title="List[LazyVals.this.global.Tree]" id="1059288">stats1</a> = <a href="#651551" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="../../../reflect/api/Trees.scala.html#438848" title="(trees: List[LazyVals.this.global.Tree])List[LazyVals.this.global.Tree]">transformTrees</a><span class="delimiter">(</span>stats0<span class="delimiter">)</span>
          <span title="LazyVals.this.global.LabelDef" class="keyword">if</span> <span class="delimiter">(</span><a href="#651549" title="LazyVals.this.LocalLazyValFinder.type">LocalLazyValFinder</a>.<a href="#1058515" title="(ts: List[LazyVals.this.global.Tree])Boolean">find</a><span class="delimiter">(</span><a href="#1059288" title="List[LazyVals.this.global.Tree]">stats1</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="../../../reflect/api/Trees.scala.html#23759" title="(ldef: LazyVals.this.global.Tree)(applyToRhs: LazyVals.this.global.Tree =&gt; LazyVals.this.global.Tree)LazyVals.this.global.LabelDef">deriveLabelDef</a><span class="delimiter">(</span>l<span class="delimiter">)</span><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="1059294">_</a> =&gt; <a href="../../../reflect/api/Trees.scala.html#438839" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<a href="../../../reflect/api/Trees.scala.html#428293" title="(tree: LazyVals.this.global.Tree, stats: List[LazyVals.this.global.Tree], expr: LazyVals.this.global.Tree)LazyVals.this.global.Block">Block</a><span class="delimiter">(</span>block, <a href="../typechecker/Typers.scala.html#560768" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#1058491" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#1058689" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; LazyVals.this.global.Symbol">owner</a>, <a href="#1059288" title="List[LazyVals.this.global.Tree]">stats1</a>.<a href="../../../collection/IterableLike.scala.html#59473" title="=&gt; LazyVals.this.global.Tree">head</a><span class="delimiter">)</span><span class="delimiter">)</span><a href="../../../collection/immutable/List.scala.html#63643" title="(x: LazyVals.this.global.Tree)List[LazyVals.this.global.Tree]">::</a><a href="#1059288" title="List[LazyVals.this.global.Tree]">stats1</a>.<a href="../../../collection/TraversableLike.scala.html#59012" title="=&gt; List[LazyVals.this.global.Tree]">tail</a>, expr<span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">else</span>
            l

        <span class="keyword">case</span> _ =&gt; <a href="#651551" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="TypingTransformers.scala.html#1050345" title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree">transform</a><a href="#1059339" title="(x: LazyVals.this.global.Tree)LazyVals.this.global.Tree" class="delimiter">(</a><a href="#1058684" title="LazyVals.this.global.Tree">tree</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    /** Add the bitmap definitions to the rhs of a method definition.
     *  If the rhs has been tail-call transformed, insert the bitmap
     *  definitions inside the top-level label definition, so that each
     *  iteration has the lazy values un-initialized. Otherwise add them
     *  at the very beginning of the method.
     */
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree" id="1058491">addBitmapDefs</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="1058810">methSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="LazyVals.this.global.Symbol">Symbol</a>, <a title="LazyVals.this.global.Tree" id="1058811">rhs</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="LazyVals.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="LazyVals.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(stats: List[LazyVals.this.global.Tree], tree: LazyVals.this.global.Tree)LazyVals.this.global.Block" id="1059348">prependStats</a><span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="1059351">stats</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[LazyVals.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span>, <a title="LazyVals.this.global.Tree" id="1059352">tree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="LazyVals.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23624" title="LazyVals.this.global.Block">Block</a> = <a href="#1059352" title="LazyVals.this.global.Tree">tree</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Block<a href="#1059404" title="LazyVals.this.global.Block" id="1059406" class="delimiter">(</a>stats1, res<span class="delimiter">)</span> =&gt; <a href="../../../reflect/api/Trees.scala.html#427284" title="(stats: List[LazyVals.this.global.Tree], expr: LazyVals.this.global.Tree)LazyVals.this.global.Block">Block</a><a href="#1059407" title="(x: LazyVals.this.global.Block)LazyVals.this.global.Block" class="delimiter">(</a><a href="#1059351" title="List[LazyVals.this.global.Tree]">stats</a> <a href="../../../collection/immutable/List.scala.html#63646" title="(prefix: List[LazyVals.this.global.Tree])List[LazyVals.this.global.Tree]">:::</a> stats1, res<span class="delimiter">)</span>
        <span class="keyword">case</span> _ =&gt; <a href="../../../reflect/api/Trees.scala.html#427284" title="(stats: List[LazyVals.this.global.Tree], expr: LazyVals.this.global.Tree)LazyVals.this.global.Block">Block</a><a href="#1059407" title="(x: LazyVals.this.global.Block)LazyVals.this.global.Block" class="delimiter">(</a><a href="#1059351" title="List[LazyVals.this.global.Tree]">stats</a>, <a href="#1059352" title="LazyVals.this.global.Tree">tree</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="List[LazyVals.this.global.ValDef]" id="1059349">bmps</a> = <a href="../../../collection/MapLike.scala.html#78420" title="(key: LazyVals.this.global.Symbol)List[LazyVals.this.global.Symbol]">bitmaps</a><span class="delimiter">(</span><a href="#1058810" title="LazyVals.this.global.Symbol">methSym</a><span class="delimiter">)</span> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: LazyVals.this.global.Symbol =&gt; LazyVals.this.global.ValDef)(implicit bf: scala.collection.generic.CanBuildFrom[List[LazyVals.this.global.Symbol],LazyVals.this.global.ValDef,List[LazyVals.this.global.ValDef]])List[LazyVals.this.global.ValDef]">map</a> <span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#441817" title="(sym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.ValDef">ValDef</a><span class="delimiter">(</span><a href="#1059446" title="LazyVals.this.global.Symbol">_</a>, <a href="../ast/TreeDSL.scala.html#653589" title="=&gt; LazyVals.this.global.Literal">ZERO</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">def</span> <a title="(params: List[LazyVals.this.global.Ident])Boolean" id="1059350">isMatch</a><span class="delimiter">(</span><a title="List[LazyVals.this.global.Ident]" id="1059485">params</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[LazyVals.this.global.Ident]">List</a><span class="delimiter">[</span>Ident<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="#1059485" title="List[LazyVals.this.global.Ident]">params</a>.<a href="../../../collection/TraversableLike.scala.html#59012" title="=&gt; List[LazyVals.this.global.Ident]">tail</a> <a href="../../../collection/LinearSeqLike.scala.html#76110" title="(that: scala.collection.GenSeq[LazyVals.this.global.Symbol])(p: (LazyVals.this.global.Ident, LazyVals.this.global.Symbol) =&gt; Boolean)Boolean">corresponds</a> <a href="#1058810" title="LazyVals.this.global.Symbol">methSym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; LazyVals.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#442009" title="=&gt; List[LazyVals.this.global.Symbol]">params</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1059515" title="LazyVals.this.global.Ident">_</a>.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; LazyVals.this.global.Type">tpe</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#1059516" title="LazyVals.this.global.Symbol">_</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; LazyVals.this.global.Type">tpe</a><span class="delimiter">)</span>

      <span title="LazyVals.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#1059349" title="List[LazyVals.this.global.ValDef]">bmps</a>.<a href="../../../collection/IterableLike.scala.html#59464" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <a href="#1058811" title="LazyVals.this.global.Tree">rhs</a> <span class="keyword">else</span> <a href="#1058811" title="LazyVals.this.global.Tree">rhs</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Block<a href="#1059561" title="LazyVals.this.global.Tree" id="1059563" class="delimiter">(</a>assign, l @ LabelDef<a title="LazyVals.this.global.Tree" id="1059566" class="delimiter">(</a>name, params, _<span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">if</span> name.<a href="../../../Function1.scala.html#59562" title="()String">toString</a> <span title="(x$1: AnyRef)Boolean">==</span> <span class="delimiter">(</span><span title="String(&quot;_&quot;)" class="string">&quot;_&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1058810" title="LazyVals.this.global.Symbol">methSym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443152" title="=&gt; methSym.NameType">name</a><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1059350" title="(params: List[LazyVals.this.global.Ident])Boolean">isMatch</a><span class="delimiter">(</span>params<span class="delimiter">)</span> =&gt;
            <a href="../../../reflect/api/Trees.scala.html#427284" title="(stats: List[LazyVals.this.global.Tree], expr: LazyVals.this.global.Tree)LazyVals.this.global.Block">Block</a><a href="#1059567" title="(x: LazyVals.this.global.Tree)LazyVals.this.global.Tree" class="delimiter">(</a>assign, <a href="../../../reflect/api/Trees.scala.html#23759" title="(ldef: LazyVals.this.global.Tree)(applyToRhs: LazyVals.this.global.Tree =&gt; LazyVals.this.global.Tree)LazyVals.this.global.LabelDef">deriveLabelDef</a><span class="delimiter">(</span>l<span class="delimiter">)</span><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="1059549">rhs</a> =&gt; <a href="../typechecker/Typers.scala.html#560768" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#1059348" title="(stats: List[LazyVals.this.global.Tree], tree: LazyVals.this.global.Tree)LazyVals.this.global.Block">prependStats</a><span class="delimiter">(</span><a href="#1059349" title="List[LazyVals.this.global.ValDef]">bmps</a>, <a href="#1059549" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

        <span class="keyword">case</span> _ =&gt; <a href="#1059348" title="(stats: List[LazyVals.this.global.Tree], tree: LazyVals.this.global.Tree)LazyVals.this.global.Block">prependStats</a><a href="#1059567" title="(x: LazyVals.this.global.Tree)LazyVals.this.global.Tree" class="delimiter">(</a><a href="#1059349" title="List[LazyVals.this.global.ValDef]">bmps</a>, <a href="#1058811" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    /** return a 'lazified' version of rhs. Rhs should conform to the
     *  following schema:
     *  {
     *    l$ = &lt;rhs&gt;
     *    l$
     *  } or
     *  &lt;rhs&gt; when the lazy value has type Unit (for which there is no field
     *  to cache it's value.
     *
     *  The result will be a tree of the form
     *  {
     *    if ((bitmap$n &amp; MASK) == 0) {
     *       l$ = &lt;rhs&gt;
     *       bitmap$n = bimap$n | MASK
     *    }
     *    l$
     *  }
     *  where bitmap$n is an int value acting as a bitmap of initialized values. It is
     *  the 'n' is (offset / 32), the MASK is (1 &lt;&lt; (offset % 32)). If the value has type
     *  unit, no field is used to cache the value, so the resulting code is:
     *  {
     *    if ((bitmap$n &amp; MASK) == 0) {
     *       &lt;rhs&gt;;
     *       bitmap$n = bimap$n | MASK
     *    }
     *    ()
     *  }
     */
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(methOrClass: LazyVals.this.global.Symbol, tree: LazyVals.this.global.Tree, offset: Int, lazyVal: LazyVals.this.global.Symbol)LazyVals.this.global.Tree" id="1058492">mkLazyDef</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="1058779">methOrClass</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="LazyVals.this.global.Symbol">Symbol</a>, <a title="LazyVals.this.global.Tree" id="1058780">tree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="LazyVals.this.global.Tree">Tree</a>, <a title="Int" id="1058781">offset</a>: <a href="../../../Int.scala.html#508" title="Int">Int</a>, <a title="LazyVals.this.global.Symbol" id="1058782">lazyVal</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="LazyVals.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="LazyVals.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="LazyVals.this.global.Symbol" id="1059572">bitmapSym</a>           = <a href="#1058496" title="(meth: LazyVals.this.global.Symbol, offset: Int)LazyVals.this.global.Symbol">getBitmapFor</a><span class="delimiter">(</span><a href="#1058779" title="LazyVals.this.global.Symbol">methOrClass</a>, <a href="#1058781" title="Int">offset</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="LazyVals.this.global.Literal" id="1059573">mask</a>                = <a href="../ast/TreeDSL.scala.html#691641" title="(x: Any)LazyVals.this.global.Literal">LIT</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span> <a href="../../../Int.scala.html#57882" title="(x: Int)Int">&lt;&lt;</a> <span class="delimiter">(</span><a href="#1058781" title="Int">offset</a> <a href="../../../Int.scala.html#57976" title="(x: Int)Int">%</a> <a href="#651546" title="=&gt; Int">FLAGS_PER_WORD</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="LazyVals extends LazyVals.this.global.RefTree with Serializable" id="1059574">bitmapRef</a> = <span title="LazyVals extends LazyVals.this.global.RefTree with Serializable" class="keyword">if</span> <span class="delimiter">(</span><a href="#1058779" title="LazyVals.this.global.Symbol">methOrClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443231" title="=&gt; Boolean">isClass</a><span class="delimiter">)</span> <a href="../../../reflect/internal/Trees.scala.html#441840" title="(qualifier: LazyVals.this.global.Tree, sym: LazyVals.this.global.Symbol)LazyVals.this.global.Select">Select</a><span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#441838" title="(sym: LazyVals.this.global.Symbol)LazyVals.this.global.Tree">This</a><span class="delimiter">(</span><a href="#1058779" title="LazyVals.this.global.Symbol">methOrClass</a><span class="delimiter">)</span>, <a href="#1059572" title="LazyVals.this.global.Symbol">bitmapSym</a><span class="delimiter">)</span> <span class="keyword">else</span> <a href="../../../reflect/internal/Trees.scala.html#441842" title="(sym: LazyVals.this.global.Symbol)LazyVals.this.global.Ident">Ident</a><span class="delimiter">(</span><a href="#1059572" title="LazyVals.this.global.Symbol">bitmapSym</a><span class="delimiter">)</span>

      <span class="keyword">def</span> <a title="(stmt: LazyVals.this.global.Tree)LazyVals.this.global.Block" id="1059575">mkBlock</a><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="1059661">stmt</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="LazyVals.this.global.Tree">Tree</a><span class="delimiter">)</span> = <a href="../ast/TreeDSL.scala.html#653638" title="(xs: LazyVals.this.global.Tree*)LazyVals.this.global.Block">BLOCK</a><span class="delimiter">(</span><a href="#1059661" title="LazyVals.this.global.Tree">stmt</a>, <a href="#1058493" title="(bmp: LazyVals.this.global.Symbol, mask: LazyVals.this.global.Tree, bmpRef: LazyVals.this.global.Tree)LazyVals.this.global.Tree">mkSetFlag</a><span class="delimiter">(</span><a href="#1059572" title="LazyVals.this.global.Symbol">bitmapSym</a>, <a href="#1059573" title="LazyVals.this.global.Literal">mask</a>, <a href="#1059574" title="LazyVals extends LazyVals.this.global.RefTree with Serializable">bitmapRef</a><span class="delimiter">)</span>, <a href="../ast/TreeDSL.scala.html#653592" title="=&gt; LazyVals.this.global.Literal">UNIT</a><span class="delimiter">)</span>


      <span class="keyword">val</span> <a href="#1059737" title="(x: (LazyVals.this.global.Block, LazyVals.this.global.Tree))(LazyVals.this.global.Block, LazyVals.this.global.Tree)" class="delimiter">(</a><a href="../../../Tuple2.scala.html#61506" title="LazyVals.this.global.Block" id="1059577">block</a>, <a href="../../../Tuple2.scala.html#61508" title="LazyVals.this.global.Tree" id="1059578">res</a><span class="delimiter">)</span> = <a href="#1058780" title="LazyVals.this.global.Tree">tree</a> <a href="../../../Tuple2.scala.html#1222" title="(LazyVals.this.global.Block, LazyVals.this.global.Tree) @unchecked" class="keyword">match</a> <span class="delimiter">{</span>
        <span class="keyword">case</span> Block<a href="#1059698" title="(LazyVals.this.global.Block, LazyVals.this.global.Tree)" id="1059701" class="delimiter">(</a><a href="../../../collection/generic/SeqFactory.scala.html#60838" title="Option[List[LazyVals.this.global.Tree]]" id="1059720">List</a><span class="delimiter">(</span>assignment<span class="delimiter">)</span>, res<span class="delimiter">)</span> <span class="keyword">if</span> <a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#651548" title="(sym: LazyVals.this.global.Symbol)Boolean">lazyUnit</a><span class="delimiter">(</span><a href="#1058782" title="LazyVals.this.global.Symbol">lazyVal</a><span class="delimiter">)</span> =&gt;
          <a href="#1059705" title="(x: (LazyVals.this.global.Block, LazyVals.this.global.Tree))(LazyVals.this.global.Block, LazyVals.this.global.Tree)" class="delimiter">(</a><a href="#1059575" title="(stmt: LazyVals.this.global.Tree)LazyVals.this.global.Block">mkBlock</a><span class="delimiter">(</span>assignment<span class="delimiter">)</span>,  res<span class="delimiter">)</span>
        <span class="keyword">case</span> rhs                          =&gt;
          <a href="#1059705" title="(x: (LazyVals.this.global.Block, LazyVals.this.global.Tree))(LazyVals.this.global.Block, LazyVals.this.global.Tree)" class="delimiter">(</a><a href="#1059575" title="(stmt: LazyVals.this.global.Tree)LazyVals.this.global.Block">mkBlock</a><span class="delimiter">(</span>rhs<span class="delimiter">)</span>,         <a href="../ast/TreeDSL.scala.html#653592" title="=&gt; LazyVals.this.global.Literal">UNIT</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="LazyVals.this.global.Apply" id="1059579">cond</a> = <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: LazyVals.this.global.Tree)LazyVals.this.CODE.TreeMethods">bitmapRef</a> <a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: LazyVals.this.global.Tree)LazyVals.this.CODE.TreeMethods">INT_&amp;</a> <a href="#1059573" title="LazyVals.this.global.Literal">mask</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#691697" title="(other: LazyVals.this.global.Tree)LazyVals.this.global.Apply">INT_==</a> <a href="../ast/TreeDSL.scala.html#653589" title="=&gt; LazyVals.this.global.Literal">ZERO</a>

      <a href="../../../reflect/internal/Positions.scala.html#441889" title="(pos: LazyVals.this.global.Position)(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">atPos</a><span class="delimiter">(</span><a href="#1058780" title="LazyVals.this.global.Tree">tree</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; LazyVals.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="TypingTransformers.scala.html#1050330" title="=&gt; LazyVals.this.global.analyzer.Typer">localTyper</a>.<a href="../typechecker/Typers.scala.html#560768" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a> <span class="delimiter">{</span>
        <span class="keyword">def</span> <a title="=&gt; LazyVals.this.global.gen.global.Tree" id="1059772">body</a> = <a href="../Global.scala.html#559498" title="LazyVals.this.global.gen.type">gen</a>.<a href="../ast/TreeGen.scala.html#561798" title="(clazz: LazyVals.this.global.gen.global.Symbol, cond: LazyVals.this.global.gen.global.Tree, syncBody: List[LazyVals.this.global.gen.global.Tree], stats: List[LazyVals.this.global.gen.global.Tree])LazyVals.this.global.gen.global.Tree">mkDoubleCheckedLocking</a><span class="delimiter">(</span><a href="#1058779" title="LazyVals.this.global.Symbol">methOrClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443480" title="=&gt; LazyVals.this.global.Symbol">enclClass</a>, <a href="#1059579" title="LazyVals.this.global.Apply">cond</a>, <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: LazyVals.this.global.Block*)List[LazyVals.this.global.Block]">List</a><span class="delimiter">(</span><a href="#1059577" title="LazyVals.this.global.Block">block</a><span class="delimiter">)</span>, <a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span>
        <a href="../ast/TreeDSL.scala.html#653638" title="(xs: LazyVals.this.global.Tree*)LazyVals.this.global.Block">BLOCK</a><span class="delimiter">(</span><a href="#1059772" title="=&gt; LazyVals.this.global.gen.global.Tree">body</a>, <a href="#1059578" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(bmp: LazyVals.this.global.Symbol, mask: LazyVals.this.global.Tree, bmpRef: LazyVals.this.global.Tree)LazyVals.this.global.Tree" id="1058493">mkSetFlag</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="1059663">bmp</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="LazyVals.this.global.Symbol">Symbol</a>, <a title="LazyVals.this.global.Tree" id="1059664">mask</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="LazyVals.this.global.Tree">Tree</a>, <a title="LazyVals.this.global.Tree" id="1059665">bmpRef</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="LazyVals.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="LazyVals.this.global.Tree">Tree</a> =
      <a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: LazyVals.this.global.Tree)LazyVals.this.CODE.TreeMethods">bmpRef</a> <a href="../ast/TreeDSL.scala.html#691706" title="(rhs: LazyVals.this.global.Tree)LazyVals.this.global.Assign">===</a> <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#653647" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: LazyVals.this.global.Tree)LazyVals.this.CODE.TreeMethods">bmpRef</a> <a href="../ast/TreeDSL.scala.html#691694" title="(other: LazyVals.this.global.Tree)LazyVals.this.global.Apply">INT_|</a> <a href="#1059664" title="LazyVals.this.global.Tree">mask</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="scala.collection.mutable.Map[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]" id="1058494">bitmaps</a> = mutable.<a href="../../../collection/generic/GenMapFactory.scala.html#61654" title="[A, B](elems: (A, B)*)scala.collection.mutable.Map[A,B]">Map</a><span title="(elems: (LazyVals.this.global.Symbol, List[LazyVals.this.global.Symbol])*)scala.collection.mutable.Map[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]" class="delimiter">[</span><a href="../../../reflect/internal/Symbols.scala.html#441132" title="LazyVals.this.global.Symbol">Symbol</a>, <a href="../../../collection/immutable/List.scala.html#12322" title="List[LazyVals.this.global.Symbol]">List</a><span class="delimiter">[</span>Symbol<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span> <a href="../../../collection/mutable/Map.scala.html#78489" title="(d: List[LazyVals.this.global.Symbol])scala.collection.mutable.Map[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]">withDefaultValue</a> <a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type">Nil</a>

    /** Return the symbol corresponding of the right bitmap int inside meth,
     *  given offset.
     */
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(meth: LazyVals.this.global.Symbol, offset: Int)LazyVals.this.global.Symbol" id="1058496">getBitmapFor</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="1059580">meth</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="LazyVals.this.global.Symbol">Symbol</a>, <a title="Int" id="1059581">offset</a>: <a href="../../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="LazyVals.this.global.Symbol">Symbol</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Int" id="1059812">n</a> = <a href="#1059581" title="Int">offset</a> <a href="../../../Int.scala.html#57969" title="(x: Int)Int">/</a> <a href="#651546" title="=&gt; Int">FLAGS_PER_WORD</a>
      <span class="keyword">val</span> <a title="List[LazyVals.this.global.Symbol]" id="1059813">bmps</a> = <a href="../../../collection/MapLike.scala.html#78420" title="(key: LazyVals.this.global.Symbol)List[LazyVals.this.global.Symbol]">bitmaps</a><span class="delimiter">(</span><a href="#1059580" title="LazyVals.this.global.Symbol">meth</a><span class="delimiter">)</span>
      <span title="LazyVals.this.global.Symbol" class="keyword">if</span> <span class="delimiter">(</span><a href="#1059813" title="List[LazyVals.this.global.Symbol]">bmps</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57919" title="(x: Int)Boolean">&gt;</a> <a href="#1059812" title="Int">n</a><span class="delimiter">)</span>
        <a href="../../../collection/LinearSeqOptimized.scala.html#76165" title="(n: Int)LazyVals.this.global.Symbol">bmps</a><span class="delimiter">(</span><a href="#1059812" title="Int">n</a><span class="delimiter">)</span>
      <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="LazyVals.this.global.TermSymbol" id="1059844">sym</a> = <a href="#1059580" title="LazyVals.this.global.Symbol">meth</a>.<a href="../../../reflect/internal/Symbols.scala.html#443174" title="(name: LazyVals.this.global.TermName, pos: LazyVals.this.global.Position, newFlags: Long)LazyVals.this.global.TermSymbol">newVariable</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#441764" title="LazyVals.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#446761" title="(bitmapPrefix: LazyVals.this.global.Name, n: Int)bitmapPrefix.ThisNameType">newBitmapName</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#441764" title="LazyVals.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#446762" title="=&gt; LazyVals.this.global.nme.NameType">BITMAP_NORMAL</a>, <a href="#1059812" title="Int">n</a><span class="delimiter">)</span>, <a href="#1059580" title="LazyVals.this.global.Symbol">meth</a>.<a href="../../../reflect/internal/Symbols.scala.html#443167" title="=&gt; LazyVals.this.global.Position">pos</a><span class="delimiter">)</span>.<a href="../../../reflect/internal/Symbols.scala.html#443429" title="(info: LazyVals.this.global.Type)LazyVals.this.global.TermSymbol">setInfo</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#442849" title="=&gt; LazyVals.this.global.ClassSymbol">IntClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443721" title="=&gt; LazyVals.this.global.Type">tpe</a><span class="delimiter">)</span>
        <a href="../Global.scala.html#559754" title="(op: =&gt; LazyVals.this.global.TermSymbol)LazyVals.this.global.TermSymbol">beforeTyper</a> <span class="delimiter">{</span>
          <a href="#1059844" title="LazyVals.this.global.TermSymbol">sym</a> <a href="../../../reflect/internal/Symbols.scala.html#443465" title="(sym: LazyVals.this.global.Symbol, args: LazyVals.this.global.Tree*)sym.type">addAnnotation</a> <a href="../../../reflect/internal/Definitions.scala.html#442685" title="=&gt; LazyVals.this.global.ClassSymbol">VolatileAttr</a>
        <span class="delimiter">}</span>

        <a href="../../../collection/mutable/MapLike.scala.html#78496" title="(key: LazyVals.this.global.Symbol, value: List[LazyVals.this.global.Symbol])Unit">bitmaps</a><span class="delimiter">(</span><a href="#1059580" title="LazyVals.this.global.Symbol">meth</a><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="#1059844" title="LazyVals.this.global.TermSymbol">sym</a> <a href="../../../collection/immutable/List.scala.html#63643" title="(x: LazyVals.this.global.Symbol)List[LazyVals.this.global.Symbol]">::</a> <a href="#1059813" title="List[LazyVals.this.global.Symbol]">bmps</a><span class="delimiter">)</span>.<a href="../../../collection/immutable/List.scala.html#63674" title="=&gt; List[LazyVals.this.global.Symbol]">reverse</a>
        <a href="#1059844" title="LazyVals.this.global.TermSymbol">sym</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
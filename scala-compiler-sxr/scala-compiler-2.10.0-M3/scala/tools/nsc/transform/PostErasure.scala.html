<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/transform/PostErasure.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
/* NSC -- new Scala compiler
 * Copyright 2005-2012 LAMP/EPFL
 * @author Martin odersky
 */
<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> transform

/** This phase maps ErasedValueTypes to the underlying unboxed representation and
 *  performs peephole optimizations.
 */
<span class="keyword">trait</span> <a title="trait PostErasure extends scala.tools.nsc.SubComponent with scala.tools.nsc.transform.InfoTransform with scala.tools.nsc.transform.TypingTransformers" id="44161">PostErasure</a> <a href="../../../Unit.scala.html#2389" title="Unit" class="keyword">extends</a> <a href="InfoTransform.scala.html#44650" title="scala.tools.nsc.transform.InfoTransform">InfoTransform</a> <span class="keyword">with</span> <a href="TypingTransformers.scala.html#45109" title="scala.tools.nsc.transform.TypingTransformers">TypingTransformers</a> <span class="delimiter">{</span>

  <span class="keyword">val</span> <a title="=&gt; scala.tools.nsc.Global" id="651475">global</a>: <a href="../Global.scala.html#27892" title="scala.tools.nsc.Global">Global</a>
  <span class="keyword">import</span> <a href="#651475" title="=&gt; scala.tools.nsc.Global">global</a>._
  <span class="keyword">import</span> <a href="../../../reflect/internal/Definitions.scala.html#441641" title="PostErasure.this.global.definitions.type">definitions</a>._

  <span class="keyword">val</span> <a title="String" id="651478">phaseName</a>: <span title="String">String</span> = <span title="String(&quot;posterasure&quot;)" class="string">&quot;posterasure&quot;</span>

  <span class="keyword">def</span> <a title="(unit: PostErasure.this.global.CompilationUnit)PostErasure.this.global.Transformer" id="651480">newTransformer</a><span class="delimiter">(</span><a title="PostErasure.this.global.CompilationUnit" id="1064779">unit</a>: <a href="../CompilationUnits.scala.html#559797" title="PostErasure.this.global.CompilationUnit">CompilationUnit</a><span class="delimiter">)</span>: <a href="../ast/Trees.scala.html#559848" title="PostErasure.this.global.Transformer">Transformer</a> = <span title="PostErasure.this.PostErasureTransformer" class="keyword">new</span> <a href="#651485" title="PostErasure.this.PostErasureTransformer">PostErasureTransformer</a><span class="delimiter">(</span><a href="#1064779" title="PostErasure.this.global.CompilationUnit">unit</a><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Boolean" id="651481">changesBaseClasses</a> = <span title="Boolean(false)" class="keyword">false</span>

  <span class="keyword">object</span> <a title="PostErasure.this.elimErasedValueType.type" id="651482">elimErasedValueType</a> <a href="#651483" title="PostErasure.this.elimErasedValueType.type" class="keyword">extends</a> <a href="../../../reflect/internal/Types.scala.html#441429" title="PostErasure.this.global.TypeMap">TypeMap</a> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(tp: PostErasure.this.global.Type)PostErasure.this.global.Type" id="1064791">apply</a><span class="delimiter">(</span><a title="PostErasure.this.global.Type" id="1064793">tp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PostErasure.this.global.Type">Type</a><span class="delimiter">)</span> = <a href="#1064793" title="PostErasure.this.global.Type">tp</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> ErasedValueType<a href="#1064830" title="PostErasure.this.global.Type" id="1064832" class="delimiter">(</a>clazz<span class="delimiter">)</span> =&gt; <a href="../Global.scala.html#559603" title="PostErasure.this.global.erasure.type">erasure</a>.<a href="../../../reflect/internal/transform/Erasure.scala.html#459754" title="(clazz: PostErasure.this.global.erasure.global.Symbol)PostErasure.this.global.erasure.global.Type">underlyingOfValueClass</a><a href="#1064833" title="(x: PostErasure.this.global.Type)PostErasure.this.global.Type" class="delimiter">(</a>clazz<span class="delimiter">)</span>
      <span class="keyword">case</span> _ =&gt; <a href="../../../reflect/internal/Types.scala.html#460841" title="(tp: PostErasure.this.global.Type)PostErasure.this.global.Type">mapOver</a><a href="#1064833" title="(x: PostErasure.this.global.Type)PostErasure.this.global.Type" class="delimiter">(</a><a href="#1064793" title="PostErasure.this.global.Type">tp</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(sym: PostErasure.this.global.Symbol, tp: PostErasure.this.global.Type)PostErasure.this.global.Type" id="651484">transformInfo</a><span class="delimiter">(</span><a title="PostErasure.this.global.Symbol" id="1064838">sym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="PostErasure.this.global.Symbol">Symbol</a>, <a title="PostErasure.this.global.Type" id="1064839">tp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="PostErasure.this.global.Type">Type</a><span class="delimiter">)</span> = <a href="#1064791" title="(tp: PostErasure.this.global.Type)PostErasure.this.global.Type">elimErasedValueType</a><span class="delimiter">(</span><a href="#1064839" title="PostErasure.this.global.Type">tp</a><span class="delimiter">)</span>

  <span class="keyword">class</span> <a title="class PostErasureTransformer extends PostErasure.this.TypingTransformer" id="651485">PostErasureTransformer</a><a href="#651485" title="PostErasure.this.PostErasureTransformer" class="delimiter">(</a><a title="PostErasure.this.global.CompilationUnit" id="1064786">unit</a>: <a href="../CompilationUnits.scala.html#559797" title="PostErasure.this.global.CompilationUnit">CompilationUnit</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="TypingTransformers.scala.html#650652" title="PostErasure.this.TypingTransformer">TypingTransformer</a><span class="delimiter">(</span><a href="#1064786" title="PostErasure.this.global.CompilationUnit">unit</a><span class="delimiter">)</span> <span class="delimiter">{</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: PostErasure.this.global.Tree)PostErasure.this.global.Tree" id="1064785">transform</a><span class="delimiter">(</span><a title="PostErasure.this.global.Tree" id="1064849">tree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="PostErasure.this.global.Tree">Tree</a><span class="delimiter">)</span> =
      <a href="#651485" title="PostErasure.this.PostErasureTransformer" class="keyword">super</a>.<a href="TypingTransformers.scala.html#1050345" title="(tree: PostErasure.this.global.Tree)PostErasure.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#1064849" title="PostErasure.this.global.Tree">tree</a><span class="delimiter">)</span> <a href="../../../reflect/api/Trees.scala.html#425062" title="(tp: PostErasure.this.global.Type)PostErasure.this.global.Tree">setType</a> <a href="#1064791" title="(tp: PostErasure.this.global.Type)PostErasure.this.global.Type">elimErasedValueType</a><span class="delimiter">(</span><a href="#1064849" title="PostErasure.this.global.Tree">tree</a>.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; PostErasure.this.global.Type">tpe</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> // new C(arg).underlying  ==&gt;  arg
          Apply<a href="#1065172" title="Boolean" id="1065175" class="delimiter">(</a>sel @ Select<a title="Boolean" id="1065178" class="delimiter">(</a>
            Apply<a title="Boolean" id="1065182" class="delimiter">(</a>Select<a title="Boolean" id="1065186" class="delimiter">(</a>New<a title="Boolean" id="1065188" class="delimiter">(</a>tpt<span class="delimiter">)</span>, <a href="../../../reflect/internal/StdNames.scala.html#441764" title="PostErasure.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#446177" title="Boolean" id="1065252">CONSTRUCTOR</a><span class="delimiter">)</span>, <a href="../../../collection/generic/SeqFactory.scala.html#60838" title="Option[List[PostErasure.this.global.Tree]]" id="1065277">List</a><span class="delimiter">(</span>arg<span class="delimiter">)</span><span class="delimiter">)</span>,
            acc<span class="delimiter">)</span>, <a href="../../../collection/generic/SeqFactory.scala.html#60838" title="Option[List[PostErasure.this.global.Tree]]" id="1065276">List</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">if</span> <a href="../../../reflect/internal/SymbolTable.scala.html#440606" title="(ph: scala.reflect.internal.Phase)(op: =&gt; Boolean)Boolean">atPhase</a><span class="delimiter">(</span><a href="../Global.scala.html#559697" title="=&gt; PostErasure.this.global.Run">currentRun</a>.<a href="../Global.scala.html#561333" title="=&gt; scala.tools.nsc.Phase">erasurePhase</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          tpt.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; PostErasure.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#441986" title="=&gt; PostErasure.this.global.Symbol">typeSymbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443321" title="=&gt; Boolean">isDerivedValueClass</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a>
          sel.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; PostErasure.this.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">==</span> tpt.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; PostErasure.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#441986" title="=&gt; PostErasure.this.global.Symbol">typeSymbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443529" title="=&gt; PostErasure.this.global.Symbol">firstParamAccessor</a>
        <span class="delimiter">}</span> =&gt;
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../Global.scala.html#559485" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#467500" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../settings/MutableSettings.scala.html#467820" title="=&gt; Boolean">value</a><span class="delimiter">)</span> <a href="../Global.scala.html#559552" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="String(&quot;Removing &quot;)" class="string">&quot;Removing &quot;</span><span title="(x$1: Any)String">+</span><a href="#1064849" title="PostErasure.this.global.Tree">tree</a><span title="(x$1: Any)String">+</span><span title="String(&quot; -&gt; &quot;)" class="string">&quot; -&gt; &quot;</span><span title="(x$1: Any)String">+</span>arg<span class="delimiter">)</span>
          arg
        <span class="keyword">case</span> // new C(arg1) == new C(arg2)  ==&gt;  arg1 == arg2
          Apply<span class="delimiter">(</span>sel @ Select<span class="delimiter">(</span>
            Apply<span class="delimiter">(</span>Select<span class="delimiter">(</span>New<span class="delimiter">(</span>tpt1<span class="delimiter">)</span>, nme.CONSTRUCTOR<span class="delimiter">)</span>, <a href="../../../collection/generic/SeqFactory.scala.html#60838" title="Option[List[PostErasure.this.global.Tree]]" id="1065302">List</a><span class="delimiter">(</span>arg1<span class="delimiter">)</span><span class="delimiter">)</span>,
            cmp<span class="delimiter">)</span>,
            <a href="../../../collection/generic/SeqFactory.scala.html#60838" title="Option[List[PostErasure.this.global.Tree]]" id="1065301">List</a><span class="delimiter">(</span>Apply<a title="PostErasure.this.global.Tree" id="1065225" class="delimiter">(</a>Select<a title="PostErasure.this.global.Tree" id="1065229" class="delimiter">(</a>New<a title="PostErasure.this.global.Tree" id="1065231" class="delimiter">(</a>tpt2<span class="delimiter">)</span>, <a href="../../../reflect/internal/StdNames.scala.html#441764" title="PostErasure.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#446177" title="PostErasure.this.global.Tree" id="1065254">CONSTRUCTOR</a><span class="delimiter">)</span>, <a href="../../../collection/generic/SeqFactory.scala.html#60838" title="Option[List[PostErasure.this.global.Tree]]" id="1065293">List</a><span class="delimiter">(</span>arg2<span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">if</span> <a href="../../../reflect/internal/SymbolTable.scala.html#440606" title="(ph: scala.reflect.internal.Phase)(op: =&gt; Boolean)Boolean">atPhase</a><span class="delimiter">(</span><a href="../Global.scala.html#559697" title="=&gt; PostErasure.this.global.Run">currentRun</a>.<a href="../Global.scala.html#561333" title="=&gt; scala.tools.nsc.Phase">erasurePhase</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          tpt1.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; PostErasure.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#441986" title="=&gt; PostErasure.this.global.Symbol">typeSymbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443321" title="=&gt; Boolean">isDerivedValueClass</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a>
          <span class="delimiter">(</span>cmp <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/StdNames.scala.html#441764" title="PostErasure.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#446791" title="=&gt; PostErasure.this.global.TermName">EQ</a> <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> cmp <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/StdNames.scala.html#441764" title="PostErasure.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#446815" title="=&gt; PostErasure.this.global.TermName">NE</a><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a>
          tpt2.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; PostErasure.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#441986" title="=&gt; PostErasure.this.global.Symbol">typeSymbol</a> <span title="(x$1: AnyRef)Boolean">==</span> tpt1.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; PostErasure.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#441986" title="=&gt; PostErasure.this.global.Symbol">typeSymbol</a>
        <span class="delimiter">}</span> =&gt;
          <span class="keyword">val</span> <a title="PostErasure.this.global.Apply" id="1065052">result</a> = <a href="../../../reflect/api/Trees.scala.html#427174" title="(fun: PostErasure.this.global.Tree, args: List[PostErasure.this.global.Tree])PostErasure.this.global.Apply">Apply</a><span class="delimiter">(</span><a href="../../../reflect/api/Trees.scala.html#427925" title="(qualifier: PostErasure.this.global.Tree, name: PostErasure.this.global.Name)PostErasure.this.global.Select">Select</a><span class="delimiter">(</span>arg1, cmp<span class="delimiter">)</span> <a href="../../../reflect/api/Trees.scala.html#425044" title="(newpos: scala.tools.nsc.util.Position)PostErasure.this.global.Select">setPos</a> sel.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; PostErasure.this.global.Position">pos</a>, <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: PostErasure.this.global.Tree*)List[PostErasure.this.global.Tree]">List</a><span class="delimiter">(</span>arg2<span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../reflect/api/Trees.scala.html#425044" title="(newpos: scala.tools.nsc.util.Position)PostErasure.this.global.Apply">setPos</a> <a href="#1064849" title="PostErasure.this.global.Tree">tree</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; PostErasure.this.global.Position">pos</a>
          <a href="../Global.scala.html#559552" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="String(&quot;shortcircuiting equality &quot;)" class="string">&quot;shortcircuiting equality &quot;</span><span title="(x$1: Any)String">+</span><a href="#1064849" title="PostErasure.this.global.Tree">tree</a><span title="(x$1: Any)String">+</span><span title="String(&quot; -&gt; &quot;)" class="string">&quot; -&gt; &quot;</span><span title="(x$1: Any)String">+</span><a href="#1065052" title="PostErasure.this.global.Apply">result</a><span class="delimiter">)</span>
          <a href="TypingTransformers.scala.html#1050330" title="=&gt; PostErasure.this.global.analyzer.Typer">localTyper</a>.<a href="../typechecker/Typers.scala.html#560768" title="(tree: PostErasure.this.global.analyzer.global.Tree)PostErasure.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#1065052" title="PostErasure.this.global.Apply">result</a><span class="delimiter">)</span>

        <span class="keyword">case</span> // arg.asInstanceOf[T]  ==&gt;  arg      if arg.tpe == T
          Apply<span class="delimiter">(</span>TypeApply<a title="PostErasure.this.global.Tree" id="1065243" class="delimiter">(</a>cast @ Select<a title="PostErasure.this.global.Tree" id="1065245" class="delimiter">(</a>arg, asinstanceof<span class="delimiter">)</span>, <a href="../../../collection/generic/SeqFactory.scala.html#60838" title="Option[List[PostErasure.this.global.Tree]]" id="1065312">List</a><span class="delimiter">(</span>tpt<span class="delimiter">)</span><span class="delimiter">)</span>, <a href="../../../collection/generic/SeqFactory.scala.html#60838" title="Option[List[PostErasure.this.global.Tree]]" id="1065311">List</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">if</span> cast.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; PostErasure.this.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#442579" title="=&gt; PostErasure.this.global.MethodSymbol">Object_asInstanceOf</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> arg.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; PostErasure.this.global.Type">tpe</a> <a href="../../../reflect/internal/Types.scala.html#442062" title="(that: PostErasure.this.global.Type)Boolean">=:=</a> tpt.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; PostErasure.this.global.Type">tpe</a> =&gt; // !!! &lt;:&lt; ?
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../Global.scala.html#559485" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#467500" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../settings/MutableSettings.scala.html#467820" title="=&gt; Boolean">value</a><span class="delimiter">)</span> <a href="../Global.scala.html#559552" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="String(&quot;Shortening &quot;)" class="string">&quot;Shortening &quot;</span><span title="(x$1: Any)String">+</span><a href="#1064849" title="PostErasure.this.global.Tree">tree</a><span title="(x$1: Any)String">+</span><span title="String(&quot; -&gt; &quot;)" class="string">&quot; -&gt; &quot;</span><span title="(x$1: Any)String">+</span>arg<span class="delimiter">)</span>
          arg
        <span class="keyword">case</span> tree1 =&gt;
          <a href="#1065261" title="(x: PostErasure.this.global.Tree)PostErasure.this.global.Tree">tree1</a>
      <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
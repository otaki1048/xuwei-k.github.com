<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/transform/TypingTransformers.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
/* NSC -- new Scala compiler
 * Copyright 2005-2011 LAMP/EPFL
 * @author Martin Odersky
 */

<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> transform

<span class="keyword">import</span> scala.collection.<span class="delimiter">{</span> mutable, immutable <span class="delimiter">}</span>

/** A base class for transforms.
 *  A transform contains a compiler phase which applies a tree transformer.
 */
<span class="keyword">trait</span> <a title="trait TypingTransformers extends Object" id="45109">TypingTransformers</a> <a href="../../../Unit.scala.html#2389" title="Unit" class="delimiter">{</a>

  <span class="keyword">val</span> <a title="=&gt; scala.tools.nsc.Global" id="650650">global</a>: <a href="../Global.scala.html#27892" title="scala.tools.nsc.Global">Global</a>
  <span class="keyword">import</span> <a href="#650650" title="=&gt; scala.tools.nsc.Global">global</a>._

  <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class TypingTransformer extends TypingTransformers.this.global.Transformer" id="650652">TypingTransformer</a><a href="#650652" title="TypingTransformers.this.TypingTransformer" class="delimiter">(</a><a title="TypingTransformers.this.global.CompilationUnit" id="1050358">unit</a>: <a href="../CompilationUnits.scala.html#559797" title="TypingTransformers.this.global.CompilationUnit">CompilationUnit</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../ast/Trees.scala.html#559848" title="TypingTransformers.this.global.Transformer">Transformer</a> <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="TypingTransformers.this.global.analyzer.Typer" id="1050331">localTyper</a>: analyzer.<a href="../typechecker/Typers.scala.html#560207" title="TypingTransformers.this.global.analyzer.Typer">Typer</a> =
      <span title="TypingTransformers.this.global.analyzer.Typer" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../reflect/internal/SymbolTable.scala.html#440593" title="=&gt; scala.reflect.internal.Phase">phase</a>.<a href="../../../reflect/internal/Phase.scala.html#452455" title="=&gt; Boolean">erasedTypes</a><span class="delimiter">)</span>
        <a href="../Global.scala.html#559603" title="TypingTransformers.this.global.erasure.type">erasure</a>.<a href="Erasure.scala.html#651412" title="(context: TypingTransformers.this.global.erasure.Context)TypingTransformers.this.global.erasure.Eraser">newTyper</a><span class="delimiter">(</span><a href="../Global.scala.html#559603" title="TypingTransformers.this.global.erasure.type">erasure</a>.<a href="../typechecker/Contexts.scala.html#560082" title="(unit: TypingTransformers.this.global.erasure.global.CompilationUnit, tree: TypingTransformers.this.global.erasure.global.Tree, erasedTypes: Boolean)TypingTransformers.this.global.erasure.Context">rootContext</a><span class="delimiter">(</span><a href="#1050358" title="TypingTransformers.this.global.CompilationUnit">unit</a>, <a href="../../../reflect/api/Trees.scala.html#23577" title="TypingTransformers.this.global.EmptyTree.type">EmptyTree</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="TypingTransformers.this.global.analyzer.Typer" class="delimiter">[</span>analyzer.<a href="../typechecker/Typers.scala.html#560207" title="TypingTransformers.this.global.analyzer.Typer">Typer</a><span class="delimiter">]</span>
      <span class="keyword">else</span>
        <a href="../Global.scala.html#559585" title="=&gt; scala.tools.nsc.typechecker.Analyzer{val global: TypingTransformers.this.global.type}">analyzer</a>.<a href="../typechecker/Typers.scala.html#560201" title="(context: TypingTransformers.this.global.analyzer.Context)TypingTransformers.this.global.analyzer.Typer">newTyper</a><span class="delimiter">(</span><a href="../Global.scala.html#559585" title="=&gt; scala.tools.nsc.typechecker.Analyzer{val global: TypingTransformers.this.global.type}">analyzer</a>.<a href="../typechecker/Contexts.scala.html#560082" title="(unit: TypingTransformers.this.global.analyzer.global.CompilationUnit, tree: TypingTransformers.this.global.analyzer.global.Tree, erasedTypes: Boolean)TypingTransformers.this.global.analyzer.Context">rootContext</a><span class="delimiter">(</span><a href="#1050358" title="TypingTransformers.this.global.CompilationUnit">unit</a>, <a href="../../../reflect/api/Trees.scala.html#23577" title="TypingTransformers.this.global.EmptyTree.type">EmptyTree</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">protected</span> <span class="keyword">var</span> <a title="TypingTransformers.this.global.Tree" id="1050334">curTree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="TypingTransformers.this.global.Tree">Tree</a> = _
    <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(pos: TypingTransformers.this.global.Position)(tree: TypingTransformers.this.global.Tree)TypingTransformers.this.global.analyzer.global.Tree" id="1050336">typedPos</a><span class="delimiter">(</span><a title="TypingTransformers.this.global.Position" id="1079672">pos</a>: <a href="../util/Position.scala.html#52230" title="TypingTransformers.this.global.Position">Position</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="TypingTransformers.this.global.Tree" id="1079673">tree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="TypingTransformers.this.global.Tree">Tree</a><span class="delimiter">)</span> = <a href="#1050331" title="=&gt; TypingTransformers.this.global.analyzer.Typer">localTyper</a> <a href="../typechecker/Typers.scala.html#560768" title="(tree: TypingTransformers.this.global.analyzer.global.Tree)TypingTransformers.this.global.analyzer.global.Tree">typed</a> <span class="delimiter">{</span> <a href="../../../reflect/internal/Positions.scala.html#441889" title="(pos: TypingTransformers.this.global.Position)(tree: TypingTransformers.this.global.Tree)TypingTransformers.this.global.Tree">atPos</a><span class="delimiter">(</span><a href="#1079672" title="TypingTransformers.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1079673" title="TypingTransformers.this.global.Tree">tree</a><span class="delimiter">)</span> <span class="delimiter">}</span>

    /** a typer for each enclosing class */
    <span class="keyword">val</span> <a title="scala.collection.mutable.Map[TypingTransformers.this.global.Symbol,TypingTransformers.this.global.analyzer.Typer]" id="1050337">typers</a>: mutable.<a href="../../../collection/mutable/Map.scala.html#12934" title="scala.collection.mutable.Map[TypingTransformers.this.global.Symbol,TypingTransformers.this.global.analyzer.Typer]">Map</a><span class="delimiter">[</span>Symbol, analyzer.Typer<span class="delimiter">]</span> = <a href="../../../collection/mutable/HashMap.scala.html#79203" title="()scala.collection.mutable.HashMap[TypingTransformers.this.global.Symbol,TypingTransformers.this.global.analyzer.Typer]" class="keyword">new</a> mutable.<a href="../../../collection/mutable/HashMap.scala.html#12880" title="scala.collection.mutable.HashMap[TypingTransformers.this.global.Symbol,TypingTransformers.this.global.analyzer.Typer]">HashMap</a>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="[A](owner: TypingTransformers.this.global.Symbol)(trans: =&gt; A)A" id="1050339">atOwner</a><span class="delimiter">[</span><a title="" id="1050341">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="TypingTransformers.this.global.Symbol" id="1053595">owner</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="TypingTransformers.this.global.Symbol">Symbol</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="=&gt; A" id="1053596">trans</a>: =&gt; A<span class="delimiter">)</span>: <a href="#1050341" title="A">A</a> = <a href="#1050342" title="(tree: TypingTransformers.this.global.Tree, owner: TypingTransformers.this.global.Symbol)(trans: =&gt; A)A">atOwner</a><span class="delimiter">(</span><a href="#1050334" title="=&gt; TypingTransformers.this.global.Tree">curTree</a>, <a href="#1053595" title="TypingTransformers.this.global.Symbol">owner</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1053596" title="=&gt; A">trans</a><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="[A](tree: TypingTransformers.this.global.Tree, owner: TypingTransformers.this.global.Symbol)(trans: =&gt; A)A" id="1050342">atOwner</a><span class="delimiter">[</span><a title="" id="1050344">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="TypingTransformers.this.global.Tree" id="1053607">tree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="TypingTransformers.this.global.Tree">Tree</a>, <a title="TypingTransformers.this.global.Symbol" id="1053608">owner</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="TypingTransformers.this.global.Symbol">Symbol</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="=&gt; A" id="1053609">trans</a>: =&gt; A<span class="delimiter">)</span>: <a href="#1050344" title="A">A</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="TypingTransformers.this.global.analyzer.Typer" id="1079717">savedLocalTyper</a> = <a href="#1050331" title="=&gt; TypingTransformers.this.global.analyzer.Typer">localTyper</a>
//      println(&quot;transformer atOwner: &quot; + owner + &quot; isPackage? &quot; + owner.isPackage)
      <a href="#1050331" title="(x$1: TypingTransformers.this.global.analyzer.Typer)Unit">localTyper</a> = <a href="#1050331" title="=&gt; TypingTransformers.this.global.analyzer.Typer">localTyper</a>.<a href="../typechecker/Typers.scala.html#560767" title="(tree: TypingTransformers.this.global.analyzer.global.Tree, owner: TypingTransformers.this.global.analyzer.global.Symbol)TypingTransformers.this.global.analyzer.Typer">atOwner</a><span class="delimiter">(</span><a href="#1053607" title="TypingTransformers.this.global.Tree">tree</a>, <span title="TypingTransformers.this.global.Symbol" class="keyword">if</span> <span class="delimiter">(</span><a href="#1053608" title="TypingTransformers.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#443270" title="=&gt; Boolean">isModule</a><span class="delimiter">)</span> <a href="#1053608" title="TypingTransformers.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#443515" title="=&gt; TypingTransformers.this.global.Symbol">moduleClass</a> <span class="keyword">else</span> <a href="#1053608" title="TypingTransformers.this.global.Symbol">owner</a><span class="delimiter">)</span>
      <a href="#1050337" title="=&gt; scala.collection.mutable.Map[TypingTransformers.this.global.Symbol,TypingTransformers.this.global.analyzer.Typer]">typers</a> <a href="../../../collection/mutable/MapLike.scala.html#78497" title="(kv: (TypingTransformers.this.global.Symbol, TypingTransformers.this.global.analyzer.Typer))TypingTransformer.this.typers.type">+=</a> <a href="../../../Predef.scala.html#64076" title="(x: TypingTransformers.this.global.Symbol, y: TypingTransformers.this.global.analyzer.Typer)(TypingTransformers.this.global.Symbol, TypingTransformers.this.global.analyzer.Typer)">Pair</a><span class="delimiter">(</span><a href="#1053608" title="TypingTransformers.this.global.Symbol">owner</a>, <a href="#1050331" title="=&gt; TypingTransformers.this.global.analyzer.Typer">localTyper</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="A" id="1079718">result</a> = <a href="#650652" title="TypingTransformers.this.TypingTransformer" class="keyword">super</a>.<a href="../../../reflect/api/Trees.scala.html#438858" title="(owner: TypingTransformers.this.global.Symbol)(trans: =&gt; A)A">atOwner</a><span class="delimiter">(</span><a href="#1053608" title="TypingTransformers.this.global.Symbol">owner</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1053609" title="=&gt; A">trans</a><span class="delimiter">)</span>
      <a href="#1050331" title="(x$1: TypingTransformers.this.global.analyzer.Typer)Unit">localTyper</a> = <a href="#1079717" title="TypingTransformers.this.global.analyzer.Typer">savedLocalTyper</a>
      <a href="#1050337" title="=&gt; scala.collection.mutable.Map[TypingTransformers.this.global.Symbol,TypingTransformers.this.global.analyzer.Typer]">typers</a> <a href="../../../collection/mutable/MapLike.scala.html#78514" title="(key: TypingTransformers.this.global.Symbol)TypingTransformer.this.typers.type">-=</a> <a href="#1053608" title="TypingTransformers.this.global.Symbol">owner</a>
      <a href="#1079718" title="A">result</a>
    <span class="delimiter">}</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: TypingTransformers.this.global.Tree)TypingTransformers.this.global.Tree" id="1050345">transform</a><span class="delimiter">(</span><a title="TypingTransformers.this.global.Tree" id="1050352">tree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="TypingTransformers.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="TypingTransformers.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
      <a href="#1050334" title="(x$1: TypingTransformers.this.global.Tree)Unit">curTree</a> = <a href="#1050352" title="TypingTransformers.this.global.Tree">tree</a>
      <a href="#1050352" title="TypingTransformers.this.global.Tree">tree</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Template<a href="#1079803" title="TypingTransformers.this.global.Tree" id="1079808" class="delimiter">(</a>_, _, _<span class="delimiter">)</span> =&gt;
          // enter template into context chain
          <a href="#1050339" title="(owner: TypingTransformers.this.global.Symbol)(trans: =&gt; TypingTransformers.this.global.Tree)TypingTransformers.this.global.Tree">atOwner</a><span class="delimiter">(</span><a href="../../../reflect/api/Trees.scala.html#438841" title="=&gt; TypingTransformers.this.global.Symbol">currentOwner</a><span class="delimiter">)</span> <a href="#1079813" title="(x: TypingTransformers.this.global.Tree)TypingTransformers.this.global.Tree" class="delimiter">{</a> <a href="#650652" title="TypingTransformers.this.TypingTransformer" class="keyword">super</a>.<a href="../../../reflect/api/Trees.scala.html#438847" title="(tree: TypingTransformers.this.global.Tree)TypingTransformers.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#1050352" title="TypingTransformers.this.global.Tree">tree</a><span class="delimiter">)</span> <span class="delimiter">}</span>
        <span class="keyword">case</span> PackageDef<a href="#1079803" title="TypingTransformers.this.global.Tree" id="1079812" class="delimiter">(</a>_, _<span class="delimiter">)</span> =&gt;
          <a href="#1050339" title="(owner: TypingTransformers.this.global.Symbol)(trans: =&gt; TypingTransformers.this.global.Tree)TypingTransformers.this.global.Tree">atOwner</a><span class="delimiter">(</span><a href="#1050352" title="TypingTransformers.this.global.Tree">tree</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; TypingTransformers.this.global.Symbol">symbol</a><span class="delimiter">)</span> <a href="#1079813" title="(x: TypingTransformers.this.global.Tree)TypingTransformers.this.global.Tree" class="delimiter">{</a> <a href="#650652" title="TypingTransformers.this.TypingTransformer" class="keyword">super</a>.<a href="../../../reflect/api/Trees.scala.html#438847" title="(tree: TypingTransformers.this.global.Tree)TypingTransformers.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#1050352" title="TypingTransformers.this.global.Tree">tree</a><span class="delimiter">)</span> <span class="delimiter">}</span>
        <span class="keyword">case</span> _ =&gt;
          <a href="#650652" title="TypingTransformers.this.TypingTransformer" class="keyword">super</a>.<a href="../../../reflect/api/Trees.scala.html#438847" title="(tree: TypingTransformers.this.global.Tree)TypingTransformers.this.global.Tree">transform</a><a href="#1079813" title="(x: TypingTransformers.this.global.Tree)TypingTransformers.this.global.Tree" class="delimiter">(</a><a href="#1050352" title="TypingTransformers.this.global.Tree">tree</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>


        </pre>
    </body>
</html>
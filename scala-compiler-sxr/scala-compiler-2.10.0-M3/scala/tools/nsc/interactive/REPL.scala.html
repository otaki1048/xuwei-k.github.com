<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/interactive/REPL.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
/* NSC -- new Scala compiler
 * Copyright 2009-2011 Scala Solutions and LAMP/EPFL
 * @author Martin Odersky
 */
<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> interactive

<span class="keyword">import</span> scala.concurrent.SyncVar
<span class="keyword">import</span> scala.tools.nsc.util._
<span class="keyword">import</span> scala.tools.nsc.symtab._
<span class="keyword">import</span> scala.tools.nsc.ast._
<span class="keyword">import</span> scala.tools.nsc.reporters._
<span class="keyword">import</span> scala.tools.nsc.io._
<span class="keyword">import</span> scala.tools.nsc.scratchpad.<span class="delimiter">{</span>Executor, SourceInserter<span class="delimiter">}</span>
<span class="keyword">import</span> scala.tools.nsc.interpreter.AbstractFileClassLoader
<span class="keyword">import</span> java.io.<span class="delimiter">{</span>File, FileWriter<span class="delimiter">}</span>

/** Interface of interactive compiler to a client such as an IDE
 */
<span class="keyword">object</span> <a title="scala.tools.nsc.interactive.REPL.type" id="35690">REPL</a> <a href="#35691" title="scala.tools.nsc.interactive.REPL.type" class="delimiter">{</a>

  <span class="keyword">val</span> <a title="String" id="880898">versionMsg</a> = <span title="String(&quot;Scala compiler &quot;)" class="string">&quot;Scala compiler &quot;</span> <span title="(x$1: Any)String">+</span>
    <a href="../Properties.scala.html#27971" title="scala.tools.nsc.Properties.type">Properties</a>.<a href="../../../util/Properties.scala.html#68389" title="=&gt; String">versionString</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; -- &quot;)" class="string">&quot; -- &quot;</span> <span title="(x$1: Any)String">+</span>
    <a href="../Properties.scala.html#27971" title="scala.tools.nsc.Properties.type">Properties</a>.<a href="../../../util/Properties.scala.html#68391" title="=&gt; String">copyrightString</a>

  <span class="keyword">val</span> <a title="String" id="880900">prompt</a> = <span title="String(&quot;&gt; &quot;)" class="string">&quot;&gt; &quot;</span>

  <span class="keyword">var</span> <a title="scala.tools.nsc.reporters.ConsoleReporter" id="880903">reporter</a>: <a href="../reporters/ConsoleReporter.scala.html#42541" title="scala.tools.nsc.reporters.ConsoleReporter">ConsoleReporter</a> = _

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(msg: String)Unit" id="880905">replError</a><span class="delimiter">(</span><a title="String" id="880921">msg</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#880903" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#467873" title="(pos: scala.tools.nsc.util.Position, msg: String)Unit">error</a><span class="delimiter">(</span>/*new Position */<a href="../util/Position.scala.html#644185" title="(msg: String)scala.tools.nsc.util.FakePos">FakePos</a><span class="delimiter">(</span><span title="String(&quot;scalac&quot;)" class="string">&quot;scalac&quot;</span><span class="delimiter">)</span>,
                   <a href="#880921" title="String">msg</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;\n  scalac -help  gives more information&quot;)" class="string">&quot;\n  scalac -help  gives more information&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(args: Array[String])Unit" id="880906">process</a><span class="delimiter">(</span><a title="Array[String]" id="880924">args</a>: <a href="../../../Array.scala.html#292" title="Array[String]">Array</a><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.tools.nsc.Settings" id="880925">settings</a> = <span title="scala.tools.nsc.Settings" class="keyword">new</span> <a href="../Settings.scala.html#28189" title="scala.tools.nsc.Settings">Settings</a><span class="delimiter">(</span><a href="#880905" title="(msg: String)Unit">replError</a><span class="delimiter">)</span>
    <a href="#880903" title="(x$1: scala.tools.nsc.reporters.ConsoleReporter)Unit">reporter</a> = <a href="../reporters/ConsoleReporter.scala.html#467900" title="(settings: scala.tools.nsc.Settings)scala.tools.nsc.reporters.ConsoleReporter" class="keyword">new</a> <a href="../reporters/ConsoleReporter.scala.html#42541" title="scala.tools.nsc.reporters.ConsoleReporter">ConsoleReporter</a><span class="delimiter">(</span><a href="#880925" title="scala.tools.nsc.Settings">settings</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.tools.nsc.CompilerCommand" id="880926">command</a> = <span title="scala.tools.nsc.CompilerCommand" class="keyword">new</span> <a href="../CompilerCommand.scala.html#28351" title="scala.tools.nsc.CompilerCommand">CompilerCommand</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8521" title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]">args</a>.<a href="../../../collection/TraversableOnce.scala.html#59174" title="=&gt; List[String]">toList</a>, <a href="#880925" title="scala.tools.nsc.Settings">settings</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#880926" title="scala.tools.nsc.CompilerCommand">command</a>.<a href="../CompilerCommand.scala.html#598810" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/StandardScalaSettings.scala.html#467687" title="=&gt; command.settings.BooleanSetting">version</a>.<a href="../settings/MutableSettings.scala.html#467820" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
      <a href="#880903" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#467869" title="(msg: String)Unit">echo</a><span class="delimiter">(</span><a href="#880898" title="=&gt; String">versionMsg</a><span class="delimiter">)</span>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#881074" title="Unit" id="881071" class="keyword">try</a> <span class="delimiter">{</span>
        <span class="keyword">object</span> <a title="compiler.type" id="881056">compiler</a> <a href="#881057" title="compiler.type" class="keyword">extends</a> <a href="Global.scala.html#35923" title="scala.tools.nsc.interactive.Global">Global</a><span class="delimiter">(</span><a href="#880926" title="scala.tools.nsc.CompilerCommand">command</a>.<a href="../CompilerCommand.scala.html#598810" title="=&gt; scala.tools.nsc.Settings">settings</a>, <a href="#880903" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a><span class="delimiter">)</span> <span class="delimiter">{</span>
//          printTypings = true
        <span class="delimiter">}</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#880903" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#467867" title="=&gt; Boolean">hasErrors</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#880903" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/ConsoleReporter.scala.html#467918" title="()Unit">flush</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <span title="Nothing" class="keyword">return</span>
        <span class="delimiter">}</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#880926" title="scala.tools.nsc.CompilerCommand">command</a>.<a href="../CompilerCommand.scala.html#598831" title="=&gt; Boolean">shouldStopWithInfo</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#880903" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#467869" title="(msg: String)Unit">echo</a><span class="delimiter">(</span><a href="#880926" title="scala.tools.nsc.CompilerCommand">command</a>.<a href="../CompilerCommand.scala.html#598832" title="(global: scala.tools.nsc.Global)String">getInfoMessage</a><span class="delimiter">(</span><a href="#881056" title="compiler.type">compiler</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#880909" title="(comp: scala.tools.nsc.interactive.Global)Unit">run</a><span class="delimiter">(</span><a href="#881056" title="compiler.type">compiler</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> ex @ FatalError<a href="#881071" title="Unit" id="881072" class="delimiter">(</a>msg<span class="delimiter">)</span> =&gt;
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span> <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <a href="#880926" title="scala.tools.nsc.CompilerCommand">command</a>.<a href="../CompilerCommand.scala.html#598810" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#467500" title="=&gt; command.settings.BooleanSetting">debug</a>.<a href="../settings/MutableSettings.scala.html#467820" title="=&gt; Boolean">value</a><span class="delimiter">)</span> // !!!
            ex.<span title="()Unit">printStackTrace</span><span class="delimiter">(</span><span class="delimiter">)</span>;
        <a href="#880903" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#467873" title="(pos: scala.tools.nsc.util.Position, msg: String)Unit">error</a><span class="delimiter">(</span><span title="Null(null)" class="keyword">null</span>, <span title="String(&quot;fatal error: &quot;)" class="string">&quot;fatal error: &quot;</span> <span title="(x$1: Any)String">+</span> msg<span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(args: Array[String])Unit" id="880907">main</a><span class="delimiter">(</span><a title="Array[String]" id="881078">args</a>: <a href="../../../Array.scala.html#292" title="Array[String]">Array</a><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#880906" title="(args: Array[String])Unit">process</a><span class="delimiter">(</span><a href="#881078" title="Array[String]">args</a><span class="delimiter">)</span>
    /*sys.*/<a href="../../../Predef.scala.html#8457" title="(status: Int)Nothing">exit</a><span class="delimiter">(</span><span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#880903" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#467867" title="=&gt; Boolean">hasErrors</a><span class="delimiter">)</span> <span title="Int(1)" class="int">1</span> <span class="keyword">else</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>// Don't use sys yet as this has to run on 2.8.2 also.
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(action: String =&gt; Unit)Unit" id="880908">loop</a><span class="delimiter">(</span><a title="String =&gt; Unit" id="881081">action</a>: <span class="delimiter">(</span>String<span class="delimiter">)</span> =&gt; Unit<span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="../../../Console.scala.html#227" title="Console.type">Console</a>.<a href="../../../Console.scala.html#64298" title="(obj: Any)Unit">print</a><span class="delimiter">(</span><a href="#880900" title="=&gt; String">prompt</a><span class="delimiter">)</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="String" id="881082">line</a> = <a href="../../../Console.scala.html#227" title="Console.type">Console</a>.<a href="../../../Console.scala.html#64303" title="()String">readLine</a>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#881082" title="String">line</a>.<span title="()Int">length</span><span class="delimiter">(</span><span class="delimiter">)</span> <a href="../../../Int.scala.html#57919" title="(x: Int)Boolean">&gt;</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="../../../Function1.scala.html#59555" title="(v1: String)Unit">action</a><span class="delimiter">(</span><a href="#881082" title="String">line</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#880908" title="(action: String =&gt; Unit)Unit">loop</a><span class="delimiter">(</span><a href="#881081" title="String =&gt; Unit">action</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Unit">_</span>: java.io.<span title="java.io.EOFException">EOFException</span> =&gt; //nop
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** Commands:
   *
   *  reload file1 ... fileN
   *  typeat file off1 off2?
   *  complete file off1 off2?
   */
  <span class="keyword">def</span> <a title="(comp: scala.tools.nsc.interactive.Global)Unit" id="880909">run</a><span class="delimiter">(</span><a title="scala.tools.nsc.interactive.Global" id="881063">comp</a>: <a href="Global.scala.html#35923" title="scala.tools.nsc.interactive.Global">Global</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.tools.nsc.interactive.Response[Unit]" id="881091">reloadResult</a> = <span title="scala.tools.nsc.interactive.Response[Unit]" class="keyword">new</span> <a href="Response.scala.html#36451" title="scala.tools.nsc.interactive.Response[Unit]">Response</a><span class="delimiter">[</span>Unit<span class="delimiter">]</span>
    <span class="keyword">val</span> <a title="scala.tools.nsc.interactive.Response[comp.Tree]" id="881092">typeatResult</a> = <span title="scala.tools.nsc.interactive.Response[comp.Tree]" class="keyword">new</span> <a href="Response.scala.html#36451" title="scala.tools.nsc.interactive.Response[comp.Tree]">Response</a><span class="delimiter">[</span>comp.Tree<span class="delimiter">]</span>
    <span class="keyword">val</span> <a title="scala.tools.nsc.interactive.Response[List[comp.Member]]" id="881093">completeResult</a> = <span title="scala.tools.nsc.interactive.Response[List[comp.Member]]" class="keyword">new</span> <a href="Response.scala.html#36451" title="scala.tools.nsc.interactive.Response[List[comp.Member]]">Response</a><span class="delimiter">[</span>List<span class="delimiter">[</span>comp.Member<span class="delimiter">]</span><span class="delimiter">]</span>
    <span class="keyword">val</span> <a title="scala.tools.nsc.interactive.Response[comp.Tree]" id="881094">typedResult</a> = <span title="scala.tools.nsc.interactive.Response[comp.Tree]" class="keyword">new</span> <a href="Response.scala.html#36451" title="scala.tools.nsc.interactive.Response[comp.Tree]">Response</a><span class="delimiter">[</span>comp.Tree<span class="delimiter">]</span>
    <span class="keyword">val</span> <a title="scala.tools.nsc.interactive.Response[comp.Tree]" id="881095">structureResult</a> = <span title="scala.tools.nsc.interactive.Response[comp.Tree]" class="keyword">new</span> <a href="Response.scala.html#36451" title="scala.tools.nsc.interactive.Response[comp.Tree]">Response</a><span class="delimiter">[</span>comp.Tree<span class="delimiter">]</span>
    <span class="keyword">val</span> <a title="scala.tools.nsc.interactive.Response[(String, Array[Char])]" id="881096">instrumentedResult</a> = <span title="scala.tools.nsc.interactive.Response[(String, Array[Char])]" class="keyword">new</span> <a href="Response.scala.html#36451" title="scala.tools.nsc.interactive.Response[(String, Array[Char])]">Response</a><span class="delimiter">[</span><span class="delimiter">(</span>String, Array<span class="delimiter">[</span>Char<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">]</span>

    <span class="keyword">def</span> <a title="(file: String, off1: String, off2: String)scala.tools.nsc.util.RangePosition" id="881097">makePos</a><span class="delimiter">(</span><a title="String" id="881106">file</a>: <span title="String">String</span>, <a title="String" id="881107">off1</a>: <span title="String">String</span>, <a title="String" id="881108">off2</a>: <span title="String">String</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.tools.nsc.util.BatchSourceFile" id="881109">source</a> = <a href="#880910" title="(name: String)scala.tools.nsc.util.BatchSourceFile">toSourceFile</a><span class="delimiter">(</span><a href="#881106" title="String">file</a><span class="delimiter">)</span>
      <a href="#881063" title="scala.tools.nsc.interactive.Global">comp</a>.<a href="RangePositions.scala.html#663463" title="(source: scala.tools.nsc.util.SourceFile, start: Int, point: Int, end: Int)scala.tools.nsc.util.RangePosition">rangePos</a><span class="delimiter">(</span><a href="#881109" title="scala.tools.nsc.util.BatchSourceFile">source</a>, <a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">off1</a>.<a href="../../../collection/immutable/StringLike.scala.html#60721" title="=&gt; Int">toInt</a>, <a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">off1</a>.<a href="../../../collection/immutable/StringLike.scala.html#60721" title="=&gt; Int">toInt</a>, <a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">off2</a>.<a href="../../../collection/immutable/StringLike.scala.html#60721" title="=&gt; Int">toInt</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(pos: scala.tools.nsc.util.Position)Unit" id="881098">doTypeAt</a><span class="delimiter">(</span><a title="scala.tools.nsc.util.Position" id="881128">pos</a>: <a href="../util/Position.scala.html#52230" title="scala.tools.nsc.util.Position">Position</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#881063" title="scala.tools.nsc.interactive.Global">comp</a>.<a href="CompilerControl.scala.html#663400" title="(pos: comp.Position, response: comp.Response[comp.Tree])Unit">askTypeAt</a><span class="delimiter">(</span><a href="#881128" title="scala.tools.nsc.util.Position">pos</a>, <a href="#881092" title="scala.tools.nsc.interactive.Response[comp.Tree]">typeatResult</a><span class="delimiter">)</span>
      <a href="#880916" title="(svar: scala.tools.nsc.interactive.Response[comp.Tree])Option[Unit]">show</a><span title="Unit" class="delimiter">(</span><a href="#881092" title="scala.tools.nsc.interactive.Response[comp.Tree]">typeatResult</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(pos: scala.tools.nsc.util.Position)Unit" id="881099">doComplete</a><span class="delimiter">(</span><a title="scala.tools.nsc.util.Position" id="881154">pos</a>: <a href="../util/Position.scala.html#52230" title="scala.tools.nsc.util.Position">Position</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#881063" title="scala.tools.nsc.interactive.Global">comp</a>.<a href="CompilerControl.scala.html#663403" title="(pos: comp.Position, response: comp.Response[List[comp.Member]])Unit">askTypeCompletion</a><span class="delimiter">(</span><a href="#881154" title="scala.tools.nsc.util.Position">pos</a>, <a href="#881093" title="scala.tools.nsc.interactive.Response[List[comp.Member]]">completeResult</a><span class="delimiter">)</span>
      <a href="#880916" title="(svar: scala.tools.nsc.interactive.Response[List[comp.Member]])Option[Unit]">show</a><span title="Unit" class="delimiter">(</span><a href="#881093" title="scala.tools.nsc.interactive.Response[List[comp.Member]]">completeResult</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(file: String)Unit" id="881100">doTypedTree</a><span class="delimiter">(</span><a title="String" id="881160">file</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#881063" title="scala.tools.nsc.interactive.Global">comp</a>.<a href="CompilerControl.scala.html#663401" title="(source: scala.tools.nsc.util.SourceFile, forceReload: Boolean, response: comp.Response[comp.Tree])Unit">askType</a><span class="delimiter">(</span><a href="#880910" title="(name: String)scala.tools.nsc.util.BatchSourceFile">toSourceFile</a><span class="delimiter">(</span><a href="#881160" title="String">file</a><span class="delimiter">)</span>, <span title="Boolean(true)" class="keyword">true</span>, <a href="#881094" title="scala.tools.nsc.interactive.Response[comp.Tree]">typedResult</a><span class="delimiter">)</span>
      <a href="#880916" title="(svar: scala.tools.nsc.interactive.Response[comp.Tree])Option[Unit]">show</a><span title="Unit" class="delimiter">(</span><a href="#881094" title="scala.tools.nsc.interactive.Response[comp.Tree]">typedResult</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(file: String)Unit" id="881101">doStructure</a><span class="delimiter">(</span><a title="String" id="881167">file</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#881063" title="scala.tools.nsc.interactive.Global">comp</a>.<a href="CompilerControl.scala.html#663408" title="(source: scala.tools.nsc.util.SourceFile, keepLoaded: Boolean, response: comp.Response[comp.Tree])Unit">askParsedEntered</a><span class="delimiter">(</span><a href="#880910" title="(name: String)scala.tools.nsc.util.BatchSourceFile">toSourceFile</a><span class="delimiter">(</span><a href="#881167" title="String">file</a><span class="delimiter">)</span>, <span title="Boolean(false)" class="keyword">false</span>, <a href="#881095" title="scala.tools.nsc.interactive.Response[comp.Tree]">structureResult</a><span class="delimiter">)</span>
      <a href="#880916" title="(svar: scala.tools.nsc.interactive.Response[comp.Tree])Option[Unit]">show</a><span title="Unit" class="delimiter">(</span><a href="#881095" title="scala.tools.nsc.interactive.Response[comp.Tree]">structureResult</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    /** Write instrumented source file to disk.
     *  @param iFullName  The full name of the first top-level object in source
     *  @param iContents  An Array[Char] containing the instrumented source
     *  @return The name of the instrumented source file
     */
    <span class="keyword">def</span> <a title="(iFullName: String, iContents: Array[Char])String" id="881102">writeInstrumented</a><span class="delimiter">(</span><a title="String" id="881174">iFullName</a>: <span title="String">String</span>, <a title="Array[Char]" id="881175">iContents</a>: <a href="../../../Array.scala.html#292" title="Array[Char]">Array</a><span class="delimiter">[</span>Char<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="String" id="881176">iSimpleName</a> = <a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">iFullName</a> <a href="../../../collection/IndexedSeqOptimized.scala.html#60121" title="(n: Int)String">drop</a> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#881174" title="String">iFullName</a> <span title="(x$1: Int)Int">lastIndexOf</span> <span title="Int(46)" class="char">'.'</span><span class="delimiter">)</span> <a href="../../../Int.scala.html#57948" title="(x: Int)Int">+</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="String" id="881177">iSourceName</a> = <a href="#881176" title="String">iSimpleName</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;$instrumented.scala&quot;)" class="string">&quot;$instrumented.scala&quot;</span>
      <span class="keyword">val</span> <a title="java.io.FileWriter" id="881178">ifile</a> = <span title="java.io.FileWriter" class="keyword">new</span> <span title="java.io.FileWriter">FileWriter</span><span class="delimiter">(</span><a href="#881177" title="String">iSourceName</a><span class="delimiter">)</span>
      <a href="#881178" title="java.io.FileWriter">ifile</a>.<span title="(x$1: Array[Char])Unit">write</span><span class="delimiter">(</span><a href="#881175" title="Array[Char]">iContents</a><span class="delimiter">)</span>
      <a href="#881178" title="java.io.FileWriter">ifile</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#881177" title="String">iSourceName</a>
    <span class="delimiter">}</span>

    /** Compile instrumented source file
     *  @param iSourceName The name of the instrumented source file
     *  @param arguments   Further argumenrs to pass to the compiler
     *  @return Optionallu, if no -d option is given, the virtual directory
     *          contained the generated bytecode classes
     */
    <span class="keyword">def</span> <a title="(iSourceName: String, arguments: List[String])Option[scala.tools.nsc.io.AbstractFile]" id="881103">compileInstrumented</a><span class="delimiter">(</span><a title="String" id="881304">iSourceName</a>: <span title="String">String</span>, <a title="List[String]" id="881305">arguments</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[String]">List</a><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../Option.scala.html#1510" title="Option[scala.tools.nsc.io.AbstractFile]">Option</a><span class="delimiter">[</span>AbstractFile<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <a href="../../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><span class="delimiter">(</span><span title="String(&quot;compiling &quot;)" class="string">&quot;compiling &quot;</span><span title="(x$1: Any)String">+</span><a href="#881304" title="String">iSourceName</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.tools.nsc.CompilerCommand" id="881306">command</a> = <a href="../CompilerCommand.scala.html#598813" title="(arguments: List[String], error: String =&gt; Unit)scala.tools.nsc.CompilerCommand" class="keyword">new</a> <a href="../CompilerCommand.scala.html#28351" title="scala.tools.nsc.CompilerCommand">CompilerCommand</a><span class="delimiter">(</span><a href="#881304" title="String">iSourceName</a> <a href="../../../collection/immutable/List.scala.html#63643" title="(x: String)List[String]">::</a> <a href="#881305" title="List[String]">arguments</a>, <a href="#880903" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#467873" title="(pos: scala.tools.nsc.util.Position, msg: String)Unit">error</a><span class="delimiter">(</span>scala.tools.nsc.util.<a href="../util/Position.scala.html#51568" title="scala.tools.nsc.util.NoPosition.type">NoPosition</a>, <a href="#881321" title="String">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Option[scala.tools.nsc.io.VirtualDirectory]" id="881307">virtualDirectoryOpt</a> =
        <span title="Option[scala.tools.nsc.io.VirtualDirectory]" class="keyword">if</span> <span class="delimiter">(</span><a href="#881305" title="List[String]">arguments</a> <a href="../../../collection/SeqLike.scala.html#59768" title="(elem: Any)Boolean">contains</a> <span title="String(&quot;-d&quot;)" class="string">&quot;-d&quot;</span><span class="delimiter">)</span>
          <a href="../../../Option.scala.html#2498" title="None.type">None</a>
        <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="scala.tools.nsc.io.VirtualDirectory" id="881322">vdir</a> = <span title="scala.tools.nsc.io.VirtualDirectory" class="keyword">new</span> <a href="../io/VirtualDirectory.scala.html#40772" title="scala.tools.nsc.io.VirtualDirectory">VirtualDirectory</a><span class="delimiter">(</span><span title="String(&quot;(memory)&quot;)" class="string">&quot;(memory)&quot;</span>, <a href="../../../Option.scala.html#2498" title="None.type">None</a><span class="delimiter">)</span>
          <a href="#881306" title="scala.tools.nsc.CompilerCommand">command</a>.<a href="../CompilerCommand.scala.html#598810" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/MutableSettings.scala.html#467280" title="=&gt; command.settings.OutputDirs">outputDirs</a> <a href="../settings/MutableSettings.scala.html#598973" title="(dir: scala.tools.nsc.io.AbstractFile)Unit">setSingleOutput</a> <a href="#881322" title="scala.tools.nsc.io.VirtualDirectory">vdir</a>
          <a href="../../../Option.scala.html#64111" title="(x: scala.tools.nsc.io.VirtualDirectory)Some[scala.tools.nsc.io.VirtualDirectory]">Some</a><span class="delimiter">(</span><a href="#881322" title="scala.tools.nsc.io.VirtualDirectory">vdir</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="keyword">val</span> <a title="scala.tools.nsc.Global" id="881308">compiler</a> = <span title="scala.tools.nsc.Global" class="keyword">new</span> scala.tools.nsc.<a href="../Global.scala.html#27892" title="scala.tools.nsc.Global">Global</a><span class="delimiter">(</span><a href="#881306" title="scala.tools.nsc.CompilerCommand">command</a>.<a href="../CompilerCommand.scala.html#598810" title="=&gt; scala.tools.nsc.Settings">settings</a>, <a href="#880903" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="compiler.Run" id="881309">run</a> = <span title="compiler.Run" class="keyword">new</span> <a href="#881308" title="scala.tools.nsc.Global">compiler</a>.<a href="../Global.scala.html#559768" title="compiler.Run">Run</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="../../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><span class="delimiter">(</span><span title="String(&quot;compiling: &quot;)" class="string">&quot;compiling: &quot;</span><span title="(x$1: Any)String">+</span><a href="#881306" title="scala.tools.nsc.CompilerCommand">command</a>.<a href="../CompilerCommand.scala.html#598821" title="=&gt; List[String]">files</a><span class="delimiter">)</span>
      <a href="#881309" title="compiler.Run">run</a> <a href="../Global.scala.html#561366" title="(filenames: List[String])Unit">compile</a> <a href="#881306" title="scala.tools.nsc.CompilerCommand">command</a>.<a href="../CompilerCommand.scala.html#598821" title="=&gt; List[String]">files</a>
      <a href="#881307" title="Option[scala.tools.nsc.io.VirtualDirectory]">virtualDirectoryOpt</a>
    <span class="delimiter">}</span>

    /** Run instrumented bytecode file
     *  @param vdir       Optionally, the virtual directory containing the generated bytecode classes
     *  @param iFullName  The full name of the generated object
     *  @param stripped   The contents original source file without any right hand column comments.
     *  @return The generated file content containing original source in the left column
     *          and outputs in the right column
     */
    <span class="keyword">def</span> <a title="(vdirOpt: Option[scala.tools.nsc.io.AbstractFile], iFullName: String, stripped: Array[Char])Array[Char]" id="881104">runInstrumented</a><span class="delimiter">(</span><a title="Option[scala.tools.nsc.io.AbstractFile]" id="881345">vdirOpt</a>: <a href="../../../Option.scala.html#1510" title="Option[scala.tools.nsc.io.AbstractFile]">Option</a><span class="delimiter">[</span>AbstractFile<span class="delimiter">]</span>, <a title="String" id="881346">iFullName</a>: <span title="String">String</span>, <a title="Array[Char]" id="881347">stripped</a>: <a href="../../../Array.scala.html#292" title="Array[Char]">Array</a><span class="delimiter">[</span>Char<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../Array.scala.html#292" title="Array[Char]">Array</a><span class="delimiter">[</span>Char<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="ClassLoader" id="881348">defaultClassLoader</a> = <span title="()Class[_]">getClass</span>.<span title="()ClassLoader">getClassLoader</span>
      <span class="keyword">val</span> <a title="ClassLoader" id="881349">classLoader</a> = <a href="#881345" title="Option[scala.tools.nsc.io.AbstractFile]">vdirOpt</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Some<a href="#881356" title="ClassLoader" id="881357" class="delimiter">(</a>vdir<span class="delimiter">)</span> =&gt; <a href="#881360" title="(x: ClassLoader)ClassLoader" class="keyword">new</a> <a href="../interpreter/AbstractFileClassLoader.scala.html#38448" title="scala.tools.nsc.interpreter.AbstractFileClassLoader">AbstractFileClassLoader</a><span class="delimiter">(</span>vdir, <a href="#881348" title="ClassLoader">defaultClassLoader</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="../../../Option.scala.html#2498" title="ClassLoader" id="881359">None</a> =&gt; <a href="#881360" title="(x: ClassLoader)ClassLoader">defaultClassLoader</a>
      <span class="delimiter">}</span>
      <a href="../../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><span class="delimiter">(</span><span title="String(&quot;running &quot;)" class="string">&quot;running &quot;</span><span title="(x$1: Any)String">+</span><a href="#881346" title="String">iFullName</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.tools.nsc.scratchpad.SourceInserter" id="881350">si</a> = <a href="../scratchpad/SourceInserter.scala.html#881407" title="scala.tools.nsc.scratchpad.SourceInserter" class="keyword">new</a> <a href="../scratchpad/SourceInserter.scala.html#42613" title="scala.tools.nsc.scratchpad.SourceInserter">SourceInserter</a><span class="delimiter">(</span><a href="#881347" title="Array[Char]">stripped</a><span class="delimiter">)</span>
      <a href="../scratchpad/Executor.scala.html#42593" title="scala.tools.nsc.scratchpad.Executor.type">Executor</a>.<a href="../scratchpad/Executor.scala.html#881413" title="(name: String, si: scala.tools.nsc.scratchpad.SourceInserter, classLoader: ClassLoader)Unit">execute</a><span class="delimiter">(</span><a href="#881346" title="String">iFullName</a>, <a href="#881350" title="scala.tools.nsc.scratchpad.SourceInserter">si</a>, <a href="#881349" title="ClassLoader">classLoader</a><span class="delimiter">)</span>
      <a href="../../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><span class="delimiter">(</span><span title="String(&quot;done&quot;)" class="string">&quot;done&quot;</span><span class="delimiter">)</span>
      <a href="#881350" title="scala.tools.nsc.scratchpad.SourceInserter">si</a>.<a href="../scratchpad/SourceInserter.scala.html#881398" title="=&gt; Array[Char]">currentContents</a>
    <span class="delimiter">}</span>

    /** The method for implementing worksheet functionality.
     *  @param arguments  a file name, followed by optional command line arguments that are passed
     *                    to the compiler that processes the instrumented source.
     *  @param line       A line number that controls uop to which line results should be produced
     *                    If line = -1, results are produced for all expressions in the worksheet.
     *  @return           The generated file content containing original source in the left column
     *                    and outputs in the right column, or None if the presentation compiler
     *                    does not respond to askInstrumented.
     */
    <span class="keyword">def</span> <a title="(arguments: List[String], line: Int)Option[Array[Char]]" id="881105">instrument</a><span class="delimiter">(</span><a title="List[String]" id="881451">arguments</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[String]">List</a><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="Int" id="881452">line</a>: <a href="../../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">)</span>: <a href="../../../Option.scala.html#1510" title="Option[Array[Char]]">Option</a><span class="delimiter">[</span>Array<span class="delimiter">[</span>Char<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.tools.nsc.util.BatchSourceFile" id="881453">source</a> = <a href="#880910" title="(name: String)scala.tools.nsc.util.BatchSourceFile">toSourceFile</a><span class="delimiter">(</span><a href="#881451" title="List[String]">arguments</a>.<a href="../../../collection/IterableLike.scala.html#59473" title="=&gt; String">head</a><span class="delimiter">)</span>
      // strip right hand side comment column and any trailing spaces from all lines
      <span class="keyword">val</span> <a title="scala.tools.nsc.util.BatchSourceFile" id="881454">strippedSource</a> = <span title="scala.tools.nsc.util.BatchSourceFile" class="keyword">new</span> <a href="../util/SourceFile.scala.html#51315" title="scala.tools.nsc.util.BatchSourceFile">BatchSourceFile</a><span class="delimiter">(</span><a href="#881453" title="scala.tools.nsc.util.BatchSourceFile">source</a>.<a href="../util/SourceFile.scala.html#642295" title="=&gt; scala.tools.nsc.io.AbstractFile">file</a>, <a href="../scratchpad/SourceInserter.scala.html#42614" title="scala.tools.nsc.scratchpad.SourceInserter.type">SourceInserter</a>.<a href="../scratchpad/SourceInserter.scala.html#881406" title="(cs: Array[Char])Array[Char]">stripRight</a><span class="delimiter">(</span><a href="#881453" title="scala.tools.nsc.util.BatchSourceFile">source</a>.<a href="../util/SourceFile.scala.html#642297" title="=&gt; Array[Char]">content</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#881063" title="scala.tools.nsc.interactive.Global">comp</a>.<a href="CompilerControl.scala.html#663398" title="(sources: List[scala.tools.nsc.util.SourceFile], response: comp.Response[Unit])Unit">askReload</a><span class="delimiter">(</span><a href="../../../collection/immutable/List.scala.html#63291" title="(xs: scala.tools.nsc.util.BatchSourceFile*)List[scala.tools.nsc.util.BatchSourceFile]">List</a><span class="delimiter">(</span><a href="#881454" title="scala.tools.nsc.util.BatchSourceFile">strippedSource</a><span class="delimiter">)</span>, <a href="#881091" title="scala.tools.nsc.interactive.Response[Unit]">reloadResult</a><span class="delimiter">)</span>
      <a href="#881063" title="scala.tools.nsc.interactive.Global">comp</a>.<a href="CompilerControl.scala.html#663409" title="(source: scala.tools.nsc.util.SourceFile, line: Int, response: comp.Response[(String, Array[Char])])Unit">askInstrumented</a><span class="delimiter">(</span><a href="#881454" title="scala.tools.nsc.util.BatchSourceFile">strippedSource</a>, <a href="#881452" title="Int">line</a>, <a href="#881096" title="scala.tools.nsc.interactive.Response[(String, Array[Char])]">instrumentedResult</a><span class="delimiter">)</span>
      <a href="#880911" title="(svar: scala.tools.nsc.interactive.Response[(String, Array[Char])])(op: ((String, Array[Char])) =&gt; Array[Char])Option[Array[Char]]">using</a><span class="delimiter">(</span><a href="#881096" title="scala.tools.nsc.interactive.Response[(String, Array[Char])]">instrumentedResult</a><span class="delimiter">)</span> <a title="anonymous class $anonfun extends scala.runtime.AbstractFunction1[(String, Array[Char]),Array[Char]] with Serializable" id="881481" class="delimiter">{</a>
        <span class="keyword">case</span> <span class="delimiter">(</span>iFullName, iContents<span class="delimiter">)</span> =&gt;
          <span class="keyword">val</span> <a title="String" id="881487">iSourceName</a> = <a href="#881102" title="(iFullName: String, iContents: Array[Char])String">writeInstrumented</a><span class="delimiter">(</span>iFullName, iContents<span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Option[scala.tools.nsc.io.AbstractFile]" id="881488">vdirOpt</a> = <a href="#881103" title="(iSourceName: String, arguments: List[String])Option[scala.tools.nsc.io.AbstractFile]">compileInstrumented</a><span class="delimiter">(</span><a href="#881487" title="String">iSourceName</a>, <a href="#881451" title="List[String]">arguments</a>.<a href="../../../collection/TraversableLike.scala.html#59012" title="=&gt; List[String]">tail</a><span class="delimiter">)</span>
          <a href="#881104" title="(vdirOpt: Option[scala.tools.nsc.io.AbstractFile], iFullName: String, stripped: Array[Char])Array[Char]">runInstrumented</a><span class="delimiter">(</span><a href="#881488" title="Option[scala.tools.nsc.io.AbstractFile]">vdirOpt</a>, iFullName, <a href="#881454" title="scala.tools.nsc.util.BatchSourceFile">strippedSource</a>.<a href="../util/SourceFile.scala.html#642297" title="=&gt; Array[Char]">content</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <a href="#880908" title="(action: String =&gt; Unit)Unit">loop</a> <span class="delimiter">{</span> line =&gt;
      <span class="delimiter">(</span><a href="#881510" title="String">line</a> <a href="../../../Predef.scala.html#8521" title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]">split</a> <span title="String(&quot; &quot;)" class="string">&quot; &quot;</span><span class="delimiter">)</span>.<a href="../../../collection/TraversableOnce.scala.html#59174" title="=&gt; List[String]">toList</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="#882198" title="Unit" id="882182" class="string">&quot;reload&quot;</a> <a href="#882115" title="Boolean" id="882117">::</a> args =&gt;
          <a href="#881063" title="scala.tools.nsc.interactive.Global">comp</a>.<a href="CompilerControl.scala.html#663398" title="(sources: List[scala.tools.nsc.util.SourceFile], response: comp.Response[Unit])Unit">askReload</a><span class="delimiter">(</span>args <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: String =&gt; scala.tools.nsc.util.BatchSourceFile)(implicit bf: scala.collection.generic.CanBuildFrom[List[String],scala.tools.nsc.util.BatchSourceFile,List[scala.tools.nsc.util.SourceFile]])List[scala.tools.nsc.util.SourceFile]">map</a> <a href="#880910" title="(name: String)scala.tools.nsc.util.BatchSourceFile">toSourceFile</a>, <a href="#881091" title="scala.tools.nsc.interactive.Response[Unit]">reloadResult</a><span class="delimiter">)</span>
          <a href="#880916" title="(svar: scala.tools.nsc.interactive.Response[Unit])Option[Unit]">show</a><span title="Unit" class="delimiter">(</span><a href="#881091" title="scala.tools.nsc.interactive.Response[Unit]">reloadResult</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="#882199" title="Unit" id="882183" class="string">&quot;reloadAndAskType&quot;</a> :: file <a title="Unit" id="882126">::</a> millis <a title="Unit" id="882128">::</a> <a href="../../../collection/immutable/List.scala.html#11552" title="Unit" id="882184">Nil</a> =&gt;
          <a href="#881063" title="scala.tools.nsc.interactive.Global">comp</a>.<a href="CompilerControl.scala.html#663398" title="(sources: List[scala.tools.nsc.util.SourceFile], response: comp.Response[Unit])Unit">askReload</a><span class="delimiter">(</span><a href="../../../collection/immutable/List.scala.html#63291" title="(xs: scala.tools.nsc.util.BatchSourceFile*)List[scala.tools.nsc.util.BatchSourceFile]">List</a><span class="delimiter">(</span><a href="#880910" title="(name: String)scala.tools.nsc.util.BatchSourceFile">toSourceFile</a><span class="delimiter">(</span>file<span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#881091" title="scala.tools.nsc.interactive.Response[Unit]">reloadResult</a><span class="delimiter">)</span>
          <span title="Thread.type">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">millis</a>.<a href="../../../Int.scala.html#57875" title="=&gt; Long">toInt</a><span class="delimiter">)</span>
          <a href="../../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><span class="delimiter">(</span><span title="String(&quot;ask type now&quot;)" class="string">&quot;ask type now&quot;</span><span class="delimiter">)</span>
          <a href="#881063" title="scala.tools.nsc.interactive.Global">comp</a>.<a href="CompilerControl.scala.html#663401" title="(source: scala.tools.nsc.util.SourceFile, forceReload: Boolean, response: comp.Response[comp.Tree])Unit">askType</a><span class="delimiter">(</span><a href="#880910" title="(name: String)scala.tools.nsc.util.BatchSourceFile">toSourceFile</a><span class="delimiter">(</span>file<span class="delimiter">)</span>, <span title="Boolean(false)" class="keyword">false</span>, <a href="#881094" title="scala.tools.nsc.interactive.Response[comp.Tree]">typedResult</a><span class="delimiter">)</span>
          <a href="#881094" title="scala.tools.nsc.interactive.Response[comp.Tree]">typedResult</a>.<a href="Response.scala.html#663662" title="=&gt; Either[comp.Tree,Throwable]">get</a>
        <span class="keyword">case</span> <a href="../../../collection/generic/SeqFactory.scala.html#60838" title="Option[List[String]]" id="882208">List</a><span class="delimiter">(</span><a href="#882200" title="Unit" id="882185" class="string">&quot;typed&quot;</a>, file<span class="delimiter">)</span> =&gt;
          <a href="#881100" title="(file: String)Unit">doTypedTree</a><a href="#882195" title="(x: Unit)Unit" class="delimiter">(</a>file<span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="../../../collection/generic/SeqFactory.scala.html#60838" title="Option[List[String]]" id="882217">List</a><span class="delimiter">(</span><a href="#882209" title="Unit" id="882186" class="string">&quot;typeat&quot;</a>, file, off1, off2<span class="delimiter">)</span> =&gt;
          <a href="#881098" title="(pos: scala.tools.nsc.util.Position)Unit">doTypeAt</a><a href="#882195" title="(x: Unit)Unit" class="delimiter">(</a><a href="#881097" title="(file: String, off1: String, off2: String)scala.tools.nsc.util.RangePosition">makePos</a><span class="delimiter">(</span>file, off1, off2<span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="../../../collection/generic/SeqFactory.scala.html#60838" title="Option[List[String]]" id="882226">List</a><span class="delimiter">(</span><a href="#882218" title="Unit" id="882187" class="string">&quot;typeat&quot;</a>, file, off1<span class="delimiter">)</span> =&gt;
          <a href="#881098" title="(pos: scala.tools.nsc.util.Position)Unit">doTypeAt</a><a href="#882195" title="(x: Unit)Unit" class="delimiter">(</a><a href="#881097" title="(file: String, off1: String, off2: String)scala.tools.nsc.util.RangePosition">makePos</a><span class="delimiter">(</span>file, off1, off1<span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="../../../collection/generic/SeqFactory.scala.html#60838" title="Option[List[String]]" id="882235">List</a><span class="delimiter">(</span><a href="#882227" title="Unit" id="882188" class="string">&quot;complete&quot;</a>, file, off1, off2<span class="delimiter">)</span> =&gt;
          <a href="#881099" title="(pos: scala.tools.nsc.util.Position)Unit">doComplete</a><a href="#882195" title="(x: Unit)Unit" class="delimiter">(</a><a href="#881097" title="(file: String, off1: String, off2: String)scala.tools.nsc.util.RangePosition">makePos</a><span class="delimiter">(</span>file, off1, off2<span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="../../../collection/generic/SeqFactory.scala.html#60838" title="Option[List[String]]" id="882244">List</a><span class="delimiter">(</span><a href="#882236" title="Unit" id="882189" class="string">&quot;complete&quot;</a>, file, off1<span class="delimiter">)</span> =&gt;
          <a href="#881099" title="(pos: scala.tools.nsc.util.Position)Unit">doComplete</a><a href="#882195" title="(x: Unit)Unit" class="delimiter">(</a><a href="#881097" title="(file: String, off1: String, off2: String)scala.tools.nsc.util.RangePosition">makePos</a><span class="delimiter">(</span>file, off1, off1<span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="#882245" title="Unit" id="882190" class="string">&quot;instrument&quot;</a> :: arguments =&gt;
          <a href="../../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><a href="#882195" title="(x: Unit)Unit" class="delimiter">(</a><a href="#881105" title="(arguments: List[String], line: Int)Option[Array[Char]]">instrument</a><span class="delimiter">(</span>arguments, -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span>.<a href="../../../Option.scala.html#63820" title="(f: Array[Char] =&gt; String)Option[String]">map</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8528" title="implicit scala.Predef.charArrayOps : (xs: Array[Char])scala.collection.mutable.ArrayOps[Char]">_</a>.<a href="../../../collection/TraversableOnce.scala.html#59191" title="=&gt; String">mkString</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="#882246" title="Unit" id="882191" class="string">&quot;instrumentTo&quot;</a> :: line <a title="Unit" id="882169">::</a> arguments =&gt;
          <a href="../../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><a href="#882195" title="(x: Unit)Unit" class="delimiter">(</a><a href="#881105" title="(arguments: List[String], line: Int)Option[Array[Char]]">instrument</a><span class="delimiter">(</span>arguments, <a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">line</a>.<a href="../../../collection/immutable/StringLike.scala.html#60721" title="=&gt; Int">toInt</a><span class="delimiter">)</span>.<a href="../../../Option.scala.html#63820" title="(f: Array[Char] =&gt; String)Option[String]">map</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8528" title="implicit scala.Predef.charArrayOps : (xs: Array[Char])scala.collection.mutable.ArrayOps[Char]">_</a>.<a href="../../../collection/TraversableOnce.scala.html#59191" title="=&gt; String">mkString</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="../../../collection/generic/SeqFactory.scala.html#60838" title="Option[List[String]]" id="882255">List</a><span class="delimiter">(</span><a href="#882247" title="Unit" id="882192" class="string">&quot;quit&quot;</a><span class="delimiter">)</span> =&gt;
          <a href="#881063" title="scala.tools.nsc.interactive.Global">comp</a>.<a href="CompilerControl.scala.html#663411" title="()Unit">askShutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="../../../Predef.scala.html#8457" title="(status: Int)Nothing">exit</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span> // Don't use sys yet as this has to run on 2.8.2 also.
        <span class="keyword">case</span> <a href="../../../collection/generic/SeqFactory.scala.html#60838" title="Option[List[String]]" id="882264">List</a><span class="delimiter">(</span><a href="#882256" title="Unit" id="882193" class="string">&quot;structure&quot;</a>, file<span class="delimiter">)</span> =&gt;
          <a href="#881101" title="(file: String)Unit">doStructure</a><a href="#882195" title="(x: Unit)Unit" class="delimiter">(</a>file<span class="delimiter">)</span>
        <span class="keyword">case</span> _ =&gt;
          <a href="../../../Predef.scala.html#8487" title="(x: Any)Unit">print</a><a href="#882195" title="(x: Unit)Unit" class="delimiter">(</a><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;Available commands:
                  | reload &lt;file_1&gt; ... &lt;file_n&gt;
                  | reloadAndAskType &lt;file&gt; &lt;sleep-ms&gt;
                  | typed &lt;file&gt;
                  | typeat &lt;file&gt; &lt;start-pos&gt; &lt;end-pos&gt;
                  | typeat &lt;file&gt; &lt;pos&gt;
                  | complete &lt;file&gt; &lt;start-pos&gt; &lt;end-pos&gt;
                  | compile &lt;file&gt; &lt;pos&gt;
                  | instrument &lt;file&gt; &lt;arg&gt;*
                  | instrumentTo &lt;line-num&gt; &lt;file&gt; &lt;arg&gt;*
                  | structure &lt;file&gt;
                  | quit
                  |&quot;&quot;&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60712" title="=&gt; String">stripMargin</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(name: String)scala.tools.nsc.util.BatchSourceFile" id="880910">toSourceFile</a><span class="delimiter">(</span><a title="String" id="881110">name</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="../util/SourceFile.scala.html#642300" title="(_file: scala.tools.nsc.io.AbstractFile)scala.tools.nsc.util.BatchSourceFile" class="keyword">new</a> <a href="../util/SourceFile.scala.html#51315" title="scala.tools.nsc.util.BatchSourceFile">BatchSourceFile</a><span class="delimiter">(</span><span title="scala.tools.nsc.io.PlainFile" class="keyword">new</span> <a href="../io/PlainFile.scala.html#41213" title="scala.tools.nsc.io.PlainFile">PlainFile</a><span class="delimiter">(</span><a href="../io/Path.scala.html#480278" title="implicit scala.tools.nsc.io.Path.jfile2path : (jfile: scala.tools.nsc.io.JFile)scala.tools.nsc.io.Path" class="keyword">new</a> java.io.<span title="java.io.File">File</span><span class="delimiter">(</span><a href="#881110" title="String">name</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="[T, U](svar: scala.tools.nsc.interactive.Response[T])(op: T =&gt; U)Option[U]" id="880911">using</a><span class="delimiter">[</span><a title="" id="880914">T</a>, <a title="" id="880915">U</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="scala.tools.nsc.interactive.Response[T]" id="881132">svar</a>: <a href="Response.scala.html#36451" title="scala.tools.nsc.interactive.Response[T]">Response</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="T =&gt; U" id="881133">op</a>: T =&gt; U<span class="delimiter">)</span>: <a href="../../../Option.scala.html#1510" title="Option[U]">Option</a><span class="delimiter">[</span>U<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Option[U]" id="882329">res</a> = <a href="#881132" title="scala.tools.nsc.interactive.Response[T]">svar</a>.<a href="Response.scala.html#663662" title="=&gt; Either[T,Throwable]">get</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> Left<a href="#882358" title="Option[U]" id="882359" class="delimiter">(</a>result<span class="delimiter">)</span> =&gt; <a href="../../../Option.scala.html#64111" title="(x: U)Some[U]">Some</a><a href="#882361" title="(x: Option[U])Option[U]" class="delimiter">(</a><a href="../../../Function1.scala.html#59555" title="(v1: T)U">op</a><span class="delimiter">(</span>result<span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> Right<a href="#882358" title="Option[U]" id="882360" class="delimiter">(</a>exc<span class="delimiter">)</span> =&gt; exc.<span title="()Unit">printStackTrace</span>; <a href="../../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><span class="delimiter">(</span><span title="String(&quot;ERROR: &quot;)" class="string">&quot;ERROR: &quot;</span><span title="(x$1: Any)String">+</span>exc<span class="delimiter">)</span>; <a href="../../../Option.scala.html#2498" title="None.type">None</a>
    <span class="delimiter">}</span>
    <a href="#881132" title="scala.tools.nsc.interactive.Response[T]">svar</a>.<a href="Response.scala.html#663667" title="()Unit">clear</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#882329" title="Option[U]">res</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[T](svar: scala.tools.nsc.interactive.Response[T])Option[Unit]" id="880916">show</a><span class="delimiter">[</span><a title="" id="880918">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="scala.tools.nsc.interactive.Response[T]" id="881131">svar</a>: <a href="Response.scala.html#36451" title="scala.tools.nsc.interactive.Response[T]">Response</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#880911" title="(svar: scala.tools.nsc.interactive.Response[T])(op: T =&gt; Unit)Option[Unit]">using</a><span class="delimiter">(</span><a href="#881131" title="scala.tools.nsc.interactive.Response[T]">svar</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="T" id="881145">res</a> =&gt; <a href="../../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><span class="delimiter">(</span><span title="String(&quot;==&gt; &quot;)" class="string">&quot;==&gt; &quot;</span><span title="(x$1: Any)String">+</span><a href="#881145" title="T">res</a><span class="delimiter">)</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
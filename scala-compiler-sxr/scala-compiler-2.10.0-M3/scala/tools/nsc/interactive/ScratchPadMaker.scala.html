<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/interactive/ScratchPadMaker.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> interactive

<span class="keyword">import</span> util.<span class="delimiter">{</span>SourceFile, BatchSourceFile, RangePosition<span class="delimiter">}</span>
<span class="keyword">import</span> collection.mutable.ArrayBuffer
<span class="keyword">import</span> reflect.internal.<a href="../../../reflect/internal/Chars.scala.html#19084" title="scala.reflect.internal.Chars.type">Chars</a>.isLineBreakChar

<span class="keyword">trait</span> <a title="trait ScratchPadMaker extends Object" id="36424">ScratchPadMaker</a> <a href="../../../Unit.scala.html#2389" title="Unit" class="delimiter">{</a> self: Global =&gt;

  <span class="keyword">import</span> <a href="../../../reflect/internal/Definitions.scala.html#441641" title="ScratchPadMaker.this.definitions.type">definitions</a>._

  <span class="keyword">private</span> case <span class="keyword">class</span> <a title="class Patch extends AnyRef with Product with Serializable" id="890915">Patch</a><a href="../../../Product.scala.html#304" title="Product" class="delimiter">(</a><a title="Int" id="887484">offset</a>: <a href="../../../Int.scala.html#508" title="Int">Int</a>, <a title="String" id="887485">text</a>: <span title="String">String</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">class</span> <a title="class Patcher extends ScratchPadMaker.this.Traverser" id="663509">Patcher</a><a href="#663509" title="ScratchPadMaker.this.Patcher" class="delimiter">(</a><a title="Array[Char]" id="887446">contents</a>: <a href="../../../Array.scala.html#292" title="Array[Char]">Array</a><span class="delimiter">[</span>Char<span class="delimiter">]</span>, <a title="Int" id="887447">endOffset</a>: <a href="../../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../../reflect/api/Trees.scala.html#23760" title="ScratchPadMaker.this.Traverser">Traverser</a> <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="String" id="887408">objectName</a>: <span title="String">String</span> = <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span>

    <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]" id="887410">patches</a> = <a href="../../../collection/mutable/ArrayBuffer.scala.html#71778" title="()scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]" class="keyword">new</a> <a href="../../../collection/mutable/ArrayBuffer.scala.html#13216" title="scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]">ArrayBuffer</a><span class="delimiter">[</span>Patch<span class="delimiter">]</span>
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[String]" id="887412">toPrint</a> = <a href="../../../collection/mutable/ArrayBuffer.scala.html#71778" title="()scala.collection.mutable.ArrayBuffer[String]" class="keyword">new</a> <a href="../../../collection/mutable/ArrayBuffer.scala.html#13216" title="scala.collection.mutable.ArrayBuffer[String]">ArrayBuffer</a><span class="delimiter">[</span>String<span class="delimiter">]</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="887415">skipped</a> = <span title="Int(0)" class="int">0</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="887418">resNum</a>: <a href="../../../Int.scala.html#508" title="Int">Int</a> = -<span title="Int(-1)" class="int">1</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="()String" id="887420">nextRes</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
      <a href="#887418" title="(x$1: Int)Unit">resNum</a> <a href="../../../Int.scala.html#57948" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
      <span title="String(&quot;res$&quot;)" class="string">&quot;res$&quot;</span><span title="(x$1: Any)String">+</span><a href="#887418" title="=&gt; Int">resNum</a>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(name: String, tpe: ScratchPadMaker.this.Type)String" id="887421">nameType</a><span class="delimiter">(</span><a title="String" id="887456">name</a>: <span title="String">String</span>, <a title="ScratchPadMaker.this.Type" id="887457">tpe</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="ScratchPadMaker.this.Type">Type</a><span class="delimiter">)</span>: <span title="String">String</span> = <a href="#887456" title="String">name</a><span title="(x$1: Any)String">+</span><span title="String(&quot;: &quot;)" class="string">&quot;: &quot;</span><span title="(x$1: Any)String">+</span><a href="#887457" title="ScratchPadMaker.this.Type">tpe</a>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: ScratchPadMaker.this.Symbol)String" id="887422">nameType</a><span class="delimiter">(</span><a title="ScratchPadMaker.this.Symbol" id="887458">sym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="ScratchPadMaker.this.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="String">String</span> = <a href="#887421" title="(name: String, tpe: ScratchPadMaker.this.Type)String">nameType</a><span class="delimiter">(</span><a href="#887458" title="ScratchPadMaker.this.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443152" title="=&gt; sym.NameType">name</a>.<a href="../../../Function1.scala.html#59562" title="()String">toString</a>, <a href="#887458" title="ScratchPadMaker.this.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; ScratchPadMaker.this.Type">tpe</a><span class="delimiter">)</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(str: String)String" id="887423">literal</a><span class="delimiter">(</span><a title="String" id="887464">str</a>: <span title="String">String</span><span class="delimiter">)</span> = <span title="String(&quot;\&quot;\&quot;\&quot;&quot;)" class="string">&quot;\&quot;\&quot;\&quot;&quot;</span><span title="(x$1: Any)String">+</span><a href="#887464" title="String">str</a><span title="(x$1: Any)String">+</span><span title="String(&quot;\&quot;\&quot;\&quot;&quot;)" class="string">&quot;\&quot;\&quot;\&quot;&quot;</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(offset: Int)Unit" id="887424">applyPendingPatches</a><span class="delimiter">(</span><a title="Int" id="887465">offset</a>: <a href="../../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#887415" title="=&gt; Int">skipped</a> <a href="../../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#887410" title="=&gt; scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]">patches</a> <a href="../../../collection/mutable/ArrayBuffer.scala.html#71782" title="(elem: ScratchPadMaker.this.Patch)Patcher.this.patches.type">+=</a> <a href="#890915" title="(offset: Int, text: String)ScratchPadMaker.this.Patch">Patch</a><span class="delimiter">(</span><a href="#887465" title="Int">offset</a>, <span title="String(&quot;import scala.tools.nsc.scratchpad.Executor._; &quot;)" class="string">&quot;import scala.tools.nsc.scratchpad.Executor._; &quot;</span><span class="delimiter">)</span>
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="String" id="887522">msg</a> &lt;- <a href="../../../collection/mutable/ResizableArray.scala.html#71830" title="(f: String =&gt; scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch])Unit">toPrint</a><span class="delimiter">)</span> <a href="#887410" title="=&gt; scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]">patches</a> <a href="../../../collection/mutable/ArrayBuffer.scala.html#71782" title="(elem: ScratchPadMaker.this.Patch)Patcher.this.patches.type">+=</a> <a href="#890915" title="(offset: Int, text: String)ScratchPadMaker.this.Patch">Patch</a><span class="delimiter">(</span><a href="#887465" title="Int">offset</a>, <span title="String(&quot;;System.out.println(&quot;)" class="string">&quot;;System.out.println(&quot;</span><span title="(x$1: Any)String">+</span><a href="#887522" title="String">msg</a><span title="(x$1: Any)String">+</span><span title="String(&quot;)&quot;)" class="string">&quot;)&quot;</span><span class="delimiter">)</span>
      <a href="#887412" title="=&gt; scala.collection.mutable.ArrayBuffer[String]">toPrint</a>.<a href="../../../collection/mutable/ArrayBuffer.scala.html#71779" title="()Unit">clear</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(stat: ScratchPadMaker.this.Tree)Unit" id="887425">addSkip</a><span class="delimiter">(</span><a title="ScratchPadMaker.this.Tree" id="887526">stat</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="ScratchPadMaker.this.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../Unit.scala.html#2389" title="Unit">Unit</a> = <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#887526" title="ScratchPadMaker.this.Tree">stat</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; ScratchPadMaker.this.Position">pos</a>.<a href="../util/Position.scala.html#445358" title="=&gt; Int">start</a> <a href="../../../Int.scala.html#57919" title="(x: Int)Boolean">&gt;</a> <a href="#887415" title="=&gt; Int">skipped</a><span class="delimiter">)</span> <a href="#887424" title="(offset: Int)Unit">applyPendingPatches</a><span class="delimiter">(</span><a href="#887526" title="ScratchPadMaker.this.Tree">stat</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; ScratchPadMaker.this.Position">pos</a>.<a href="../util/Position.scala.html#445358" title="=&gt; Int">start</a><span class="delimiter">)</span>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#887526" title="ScratchPadMaker.this.Tree">stat</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; ScratchPadMaker.this.Position">pos</a>.<a href="../util/Position.scala.html#445358" title="=&gt; Int">start</a> <a href="../../../Int.scala.html#57926" title="(x: Int)Boolean">&gt;=</a> <a href="#887447" title="Int">endOffset</a><span class="delimiter">)</span>
        <a href="#887410" title="=&gt; scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]">patches</a> <a href="../../../collection/mutable/ArrayBuffer.scala.html#71782" title="(elem: ScratchPadMaker.this.Patch)Patcher.this.patches.type">+=</a> <a href="#890915" title="(offset: Int, text: String)ScratchPadMaker.this.Patch">Patch</a><span class="delimiter">(</span><a href="#887526" title="ScratchPadMaker.this.Tree">stat</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; ScratchPadMaker.this.Position">pos</a>.<a href="../util/Position.scala.html#445358" title="=&gt; Int">start</a>, <span title="String(&quot;;$stop()&quot;)" class="string">&quot;;$stop()&quot;</span><span class="delimiter">)</span>
      <span class="keyword">var</span> <a title="Int" id="887527">end</a> = <a href="#887526" title="ScratchPadMaker.this.Tree">stat</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; ScratchPadMaker.this.Position">pos</a>.<a href="../util/Position.scala.html#445362" title="=&gt; Int">end</a>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#887527" title="Int">end</a> <a href="../../../Int.scala.html#57919" title="(x: Int)Boolean">&gt;</a> <a href="#887415" title="=&gt; Int">skipped</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#887527" title="Int">end</a> <a href="../../../Int.scala.html#57905" title="(x: Int)Boolean">&lt;</a> <a href="#887446" title="Array[Char]">contents</a>.<a href="../../../Array.scala.html#57449" title="=&gt; Int">length</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><span class="delimiter">(</span><a href="../../../reflect/internal/Chars.scala.html#451643" title="(c: Char)Boolean">isLineBreakChar</a><span class="delimiter">(</span><a href="../../../Array.scala.html#57450" title="(i: Int)Char">contents</a><span class="delimiter">(</span><a href="#887527" title="Int">end</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#887527" title="Int">end</a> <a href="../../../Int.scala.html#57948" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
        <a href="#887410" title="=&gt; scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]">patches</a> <a href="../../../collection/mutable/ArrayBuffer.scala.html#71782" title="(elem: ScratchPadMaker.this.Patch)Patcher.this.patches.type">+=</a> <a href="#890915" title="(offset: Int, text: String)ScratchPadMaker.this.Patch">Patch</a><span class="delimiter">(</span><a href="#887526" title="ScratchPadMaker.this.Tree">stat</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; ScratchPadMaker.this.Position">pos</a>.<a href="../util/Position.scala.html#445358" title="=&gt; Int">start</a>, <span title="String(&quot;;$skip(&quot;)" class="string">&quot;;$skip(&quot;</span><span title="(x$1: Any)String">+</span><span class="delimiter">(</span><a href="#887527" title="Int">end</a><a href="../../../Int.scala.html#57955" title="(x: Int)Int">-</a><a href="#887415" title="=&gt; Int">skipped</a><span class="delimiter">)</span><span title="(x$1: Any)String">+</span><span title="String(&quot;); &quot;)" class="string">&quot;); &quot;</span><span class="delimiter">)</span>
        <a href="#887415" title="(x$1: Int)Unit">skipped</a> = <a href="#887527" title="Int">end</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(expr: ScratchPadMaker.this.Tree)Unit" id="887426">addSandbox</a><span class="delimiter">(</span><a title="ScratchPadMaker.this.Tree" id="887571">expr</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="ScratchPadMaker.this.Tree">Tree</a><span class="delimiter">)</span> = <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>
//      patches += (Patch(expr.pos.start, &quot;sandbox(&quot;), Patch(expr.pos.end, &quot;)&quot;))

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(prefix: String, expr: String)String" id="887427">resultString</a><span class="delimiter">(</span><a title="String" id="887572">prefix</a>: <span title="String">String</span>, <a title="String" id="887573">expr</a>: <span title="String">String</span><span class="delimiter">)</span> =
      <a href="#887423" title="(str: String)String">literal</a><span class="delimiter">(</span><a href="#887572" title="String">prefix</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; = &quot;)" class="string">&quot; = &quot;</span><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot; + $show(&quot;)" class="string">&quot; + $show(&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#887573" title="String">expr</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;)&quot;)" class="string">&quot;)&quot;</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(stat: ScratchPadMaker.this.Tree)Any" id="887428">traverseStat</a><span class="delimiter">(</span><a title="ScratchPadMaker.this.Tree" id="887574">stat</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="ScratchPadMaker.this.Tree">Tree</a><span class="delimiter">)</span> =
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#887574" title="ScratchPadMaker.this.Tree">stat</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; ScratchPadMaker.this.Position">pos</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="../util/Position.scala.html#51747" title="scala.tools.nsc.util.RangePosition">RangePosition</a><span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#887574" title="ScratchPadMaker.this.Tree">stat</a> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> ValDef<a href="#887909" title="Any" id="887914" class="delimiter">(</a>_, _, _, rhs<span class="delimiter">)</span> =&gt;
            <a href="#887425" title="(stat: ScratchPadMaker.this.Tree)Unit">addSkip</a><span class="delimiter">(</span><a href="#887574" title="ScratchPadMaker.this.Tree">stat</a><span class="delimiter">)</span>
            <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#887574" title="ScratchPadMaker.this.Tree">stat</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; ScratchPadMaker.this.Symbol">symbol</a>.<a href="../../../reflect/internal/HasFlags.scala.html#443593" title="=&gt; Boolean">isLazy</a><span class="delimiter">)</span>
              <a href="#887412" title="=&gt; scala.collection.mutable.ArrayBuffer[String]">toPrint</a> <a href="../../../collection/mutable/ArrayBuffer.scala.html#71782" title="(elem: String)Patcher.this.toPrint.type">+=</a> <a href="#887423" title="(str: String)String">literal</a><span class="delimiter">(</span><a href="#887422" title="(sym: ScratchPadMaker.this.Symbol)String">nameType</a><span class="delimiter">(</span><a href="#887574" title="ScratchPadMaker.this.Tree">stat</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; ScratchPadMaker.this.Symbol">symbol</a><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot; = &lt;lazy&gt;&quot;)" class="string">&quot; = &lt;lazy&gt;&quot;</span><span class="delimiter">)</span>
            <span class="keyword">else</span> <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#887574" title="ScratchPadMaker.this.Tree">stat</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; ScratchPadMaker.this.Symbol">symbol</a>.<a href="../../../reflect/internal/HasFlags.scala.html#443598" title="=&gt; Boolean">isSynthetic</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#887426" title="(expr: ScratchPadMaker.this.Tree)Unit">addSandbox</a><span class="delimiter">(</span>rhs<span class="delimiter">)</span>
              <a href="#887412" title="=&gt; scala.collection.mutable.ArrayBuffer[String]">toPrint</a> <a href="../../../collection/mutable/ArrayBuffer.scala.html#71782" title="(elem: String)Patcher.this.toPrint.type">+=</a> <a href="#887427" title="(prefix: String, expr: String)String">resultString</a><span class="delimiter">(</span><a href="#887422" title="(sym: ScratchPadMaker.this.Symbol)String">nameType</a><span class="delimiter">(</span><a href="#887574" title="ScratchPadMaker.this.Tree">stat</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; ScratchPadMaker.this.Symbol">symbol</a><span class="delimiter">)</span>, <a href="#887574" title="ScratchPadMaker.this.Tree">stat</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; ScratchPadMaker.this.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443152" title="=&gt; ScratchPadMaker.this.Symbol#NameType">name</a>.<a href="../../../Function1.scala.html#59562" title="()String">toString</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="keyword">case</span> DefDef<a href="#887909" title="Any" id="887922" class="delimiter">(</a>_, _, _, _, _, _<span class="delimiter">)</span> =&gt;
            <a href="#887425" title="(stat: ScratchPadMaker.this.Tree)Unit">addSkip</a><span class="delimiter">(</span><a href="#887574" title="ScratchPadMaker.this.Tree">stat</a><span class="delimiter">)</span>
            <a href="#887412" title="=&gt; scala.collection.mutable.ArrayBuffer[String]">toPrint</a> <a href="../../../collection/mutable/ArrayBuffer.scala.html#71782" title="(elem: String)Patcher.this.toPrint.type">+=</a> <a href="#887423" title="(str: String)String">literal</a><span class="delimiter">(</span><a href="#887422" title="(sym: ScratchPadMaker.this.Symbol)String">nameType</a><span class="delimiter">(</span><a href="#887574" title="ScratchPadMaker.this.Tree">stat</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; ScratchPadMaker.this.Symbol">symbol</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> Annotated<a href="#887909" title="Any" id="887925" class="delimiter">(</a>_, arg<span class="delimiter">)</span> =&gt;
            <a href="#887429" title="(tree: ScratchPadMaker.this.Tree)Unit">traverse</a><a href="#887929" title="(x: Any)Any" class="delimiter">(</a>arg<span class="delimiter">)</span>
          <span class="keyword">case</span> DocDef<a href="#887909" title="Any" id="887928" class="delimiter">(</a>_, defn<span class="delimiter">)</span> =&gt;
            <a href="#887429" title="(tree: ScratchPadMaker.this.Tree)Unit">traverse</a><a href="#887929" title="(x: Any)Any" class="delimiter">(</a>defn<span class="delimiter">)</span>
          <span class="keyword">case</span> _ =&gt;
            <a href="#887929" title="(x: Any)Any" class="keyword">if</a> <span class="delimiter">(</span><a href="#887574" title="ScratchPadMaker.this.Tree">stat</a>.<a href="../../../reflect/api/Trees.scala.html#425072" title="=&gt; Boolean">isTerm</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#887425" title="(stat: ScratchPadMaker.this.Tree)Unit">addSkip</a><span class="delimiter">(</span><a href="#887574" title="ScratchPadMaker.this.Tree">stat</a><span class="delimiter">)</span>
              <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#887574" title="ScratchPadMaker.this.Tree">stat</a>.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; ScratchPadMaker.this.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#441986" title="=&gt; ScratchPadMaker.this.Symbol">typeSymbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#442841" title="=&gt; ScratchPadMaker.this.ClassSymbol">UnitClass</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="#887426" title="(expr: ScratchPadMaker.this.Tree)Unit">addSandbox</a><span class="delimiter">(</span><a href="#887574" title="ScratchPadMaker.this.Tree">stat</a><span class="delimiter">)</span>
              <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
                <span class="keyword">val</span> <a title="String" id="887699">resName</a> = <a href="#887420" title="()String">nextRes</a><span class="delimiter">(</span><span class="delimiter">)</span>
                <span class="keyword">val</span> <a title="String" id="887700">dispResName</a> = <a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">resName</a> <a href="../../../collection/TraversableLike.scala.html#58981" title="(p: Char =&gt; Boolean)String">filter</a> <span class="delimiter">(</span><span title="Char('$')" class="char">'$'</span> <a href="../../../Char.scala.html#58048" title="(x: Char)Boolean">!=</a> <a href="#887875" title="Char">_</a><span class="delimiter">)</span>
                <a href="#887410" title="=&gt; scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]">patches</a> <a href="../../../collection/mutable/ArrayBuffer.scala.html#71782" title="(elem: ScratchPadMaker.this.Patch)Patcher.this.patches.type">+=</a> <a href="#890915" title="(offset: Int, text: String)ScratchPadMaker.this.Patch">Patch</a><span class="delimiter">(</span><a href="#887574" title="ScratchPadMaker.this.Tree">stat</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; ScratchPadMaker.this.Position">pos</a>.<a href="../util/Position.scala.html#445358" title="=&gt; Int">start</a>, <span title="String(&quot;val &quot;)" class="string">&quot;val &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#887699" title="String">resName</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; = &quot;)" class="string">&quot; = &quot;</span><span class="delimiter">)</span>
                <a href="#887426" title="(expr: ScratchPadMaker.this.Tree)Unit">addSandbox</a><span class="delimiter">(</span><a href="#887574" title="ScratchPadMaker.this.Tree">stat</a><span class="delimiter">)</span>
                <a href="#887412" title="=&gt; scala.collection.mutable.ArrayBuffer[String]">toPrint</a> <a href="../../../collection/mutable/ArrayBuffer.scala.html#71782" title="(elem: String)Patcher.this.toPrint.type">+=</a> <a href="#887427" title="(prefix: String, expr: String)String">resultString</a><span class="delimiter">(</span><a href="#887421" title="(name: String, tpe: ScratchPadMaker.this.Type)String">nameType</a><span class="delimiter">(</span><a href="#887700" title="String">dispResName</a>, <a href="#887574" title="ScratchPadMaker.this.Tree">stat</a>.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; ScratchPadMaker.this.Type">tpe</a><span class="delimiter">)</span>, <a href="#887699" title="String">resName</a><span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: ScratchPadMaker.this.Tree)Unit" id="887429">traverse</a><span class="delimiter">(</span><a title="ScratchPadMaker.this.Tree" id="887688">tree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="ScratchPadMaker.this.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../Unit.scala.html#2389" title="Unit">Unit</a> = <a href="#887688" title="ScratchPadMaker.this.Tree">tree</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> PackageDef<a href="#887992" title="Unit" id="887996" class="delimiter">(</a>_, _<span class="delimiter">)</span> =&gt;
        <a href="#663509" title="ScratchPadMaker.this.Patcher" class="keyword">super</a>.<a href="../../../reflect/api/Trees.scala.html#433535" title="(tree: ScratchPadMaker.this.Tree)Unit">traverse</a><a href="#888003" title="(x: Unit)Unit" class="delimiter">(</a><a href="#887688" title="ScratchPadMaker.this.Tree">tree</a><span class="delimiter">)</span>
      <span class="keyword">case</span> ModuleDef<a href="#887992" title="Unit" id="888000" class="delimiter">(</a>_, name, Template<span class="delimiter">(</span>_, _, body<span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#887408" title="=&gt; String">objectName</a>.<span title="()Int">length</span> <a href="../../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <span title="Int(0)" class="int">0</span> /* objectName.isEmpty does not compile on Java 5 due to ambiguous implicit conversions: augmentString, stringToTermName */<span class="delimiter">)</span>
          <a href="#887408" title="(x$1: String)Unit">objectName</a> = <a href="#887688" title="ScratchPadMaker.this.Tree">tree</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; ScratchPadMaker.this.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443398" title="=&gt; String">fullName</a>
        body <a href="../../../collection/LinearSeqOptimized.scala.html#76166" title="(f: ScratchPadMaker.this.Tree =&gt; Any)Unit">foreach</a> <a href="#887428" title="(stat: ScratchPadMaker.this.Tree)Any">traverseStat</a>
        <a href="#887424" title="(offset: Int)Unit">applyPendingPatches</a><span class="delimiter">(</span><a href="#887415" title="=&gt; Int">skipped</a><span class="delimiter">)</span>
      <span class="keyword">case</span> _ =&gt;
    <span class="delimiter">}</span>

    /** The patched text.
     *  @require  traverse is run first
     */
    <span class="keyword">def</span> <a title="=&gt; Array[Char]" id="887430">result</a>: <a href="../../../Array.scala.html#292" title="Array[Char]">Array</a><span class="delimiter">[</span>Char<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Int" id="888009">reslen</a> = <a href="#887446" title="Array[Char]">contents</a>.<a href="../../../Array.scala.html#57449" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57948" title="(x: Int)Int">+</a> <span class="delimiter">(</span><a href="#887410" title="=&gt; scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]">patches</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: ScratchPadMaker.this.Patch =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch],Int,scala.collection.mutable.ArrayBuffer[Int]])scala.collection.mutable.ArrayBuffer[Int]">map</a> <span class="delimiter">(</span><a href="#888034" title="ScratchPadMaker.this.Patch">_</a>.<a href="#887485" title="=&gt; String">text</a>.<span title="()Int">length</span><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../../collection/TraversableOnce.scala.html#59143" title="(implicit num: Numeric[Int])Int">sum</a>
      <span class="keyword">val</span> <a title="Array[Char]" id="888010">res</a> = <a href="../../../Array.scala.html#293" title="Array.type">Array</a>.<a href="../../../Array.scala.html#68740" title="[T](n1: Int)(implicit evidence$3: scala.reflect.ArrayTag[T])Array[T]">ofDim</a><span title="(n1: Int)(implicit evidence$3: scala.reflect.ArrayTag[Char])Array[Char]" class="delimiter">[</span><a href="../../../Char.scala.html#1273" title="Char">Char</a><span class="delimiter">]</span><a href="../../../reflect/ClassTag.scala.html#61870" title="=&gt; scala.reflect.ClassTag[Char]" class="delimiter">(</a><a href="#888009" title="Int">reslen</a><span class="delimiter">)</span>
      <span class="keyword">var</span> <a title="Int" id="888011">lastOffset</a> = <span title="Int(0)" class="int">0</span>
      <span class="keyword">var</span> <a title="Int" id="888012">from</a> = <span title="Int(0)" class="int">0</span>
      <span class="keyword">var</span> <a title="Int" id="888013">to</a> = <span title="Int(0)" class="int">0</span>
      <span class="keyword">for</span> <span class="delimiter">(</span>Patch<span class="delimiter">(</span>offset, text<span class="delimiter">)</span> &lt;- <a href="../../../collection/generic/FilterMonadic.scala.html#59082" title="(f: ScratchPadMaker.this.Patch =&gt; Unit)Unit" id="888120">patches</a><span class="delimiter">)</span> <a href="#890857" title="(x: Unit)Unit" class="delimiter">{</a>
        <span class="keyword">val</span> <a title="Int" id="888167">delta</a> = offset <a href="../../../Int.scala.html#57955" title="(x: Int)Int">-</a> <a href="#888011" title="Int">lastOffset</a>
        <a href="../Global.scala.html#559534" title="(assertion: Boolean)Unit">assert</a><span class="delimiter">(</span><a href="#888167" title="Int">delta</a> <a href="../../../Int.scala.html#57926" title="(x: Int)Boolean">&gt;=</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
        <a href="../../../Array.scala.html#293" title="Array.type">Array</a>.<a href="../../../Array.scala.html#68724" title="(src: AnyRef, srcPos: Int, dest: AnyRef, destPos: Int, length: Int)Unit">copy</a><span class="delimiter">(</span><a href="#887446" title="Array[Char]">contents</a>, <a href="#888012" title="Int">from</a>, <a href="#888010" title="Array[Char]">res</a>, <a href="#888013" title="Int">to</a>, <a href="#888167" title="Int">delta</a><span class="delimiter">)</span>
        <a href="#888012" title="Int">from</a> <a href="../../../Int.scala.html#57948" title="(x: Int)Int">+=</a> <a href="#888167" title="Int">delta</a>
        <a href="#888013" title="Int">to</a> <a href="../../../Int.scala.html#57948" title="(x: Int)Int">+=</a> <a href="#888167" title="Int">delta</a>
        <a href="#888011" title="Int">lastOffset</a> = offset
        <a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">text</a>.<a href="../../../collection/TraversableOnce.scala.html#59164" title="(xs: Array[Char], start: Int)Unit">copyToArray</a><span class="delimiter">(</span><a href="#888010" title="Array[Char]">res</a>, <a href="#888013" title="Int">to</a><span class="delimiter">)</span>
        <a href="#888013" title="Int">to</a> <a href="../../../Int.scala.html#57948" title="(x: Int)Int">+=</a> text.<span title="()Int">length</span>
      <span class="delimiter">}</span>
      <a href="../Global.scala.html#559534" title="(assertion: Boolean)Unit">assert</a><span class="delimiter">(</span><a href="#887446" title="Array[Char]">contents</a>.<a href="../../../Array.scala.html#57449" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57955" title="(x: Int)Int">-</a> <a href="#888012" title="Int">from</a> <a href="../../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <a href="#888009" title="Int">reslen</a> <a href="../../../Int.scala.html#57955" title="(x: Int)Int">-</a> <a href="#888013" title="Int">to</a><span class="delimiter">)</span>
      <a href="../../../Array.scala.html#293" title="Array.type">Array</a>.<a href="../../../Array.scala.html#68724" title="(src: AnyRef, srcPos: Int, dest: AnyRef, destPos: Int, length: Int)Unit">copy</a><span class="delimiter">(</span><a href="#887446" title="Array[Char]">contents</a>, <a href="#888012" title="Int">from</a>, <a href="#888010" title="Array[Char]">res</a>, <a href="#888013" title="Int">to</a>, <a href="#887446" title="Array[Char]">contents</a>.<a href="../../../Array.scala.html#57449" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57955" title="(x: Int)Int">-</a> <a href="#888012" title="Int">from</a><span class="delimiter">)</span>
      <a href="#888010" title="Array[Char]">res</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** Compute an instrumented version of a sourcefile.
   *  @param source  The given sourcefile.
   *  @param line    The line up to which results should be printed, -1 = whole document.
   *  @return        A pair consisting of
   *                  - the fully qualified name of the first top-level object definition in the file.
   *                    or &quot;&quot; if there are no object definitions.
   *                  - the text of the instrumented program which, when run,
   *                    prints its output and all defined values in a comment column.
   */
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(source: scala.tools.nsc.util.SourceFile, line: Int)(String, Array[Char])" id="663510">instrument</a><span class="delimiter">(</span><a title="scala.tools.nsc.util.SourceFile" id="877465">source</a>: <a href="../util/SourceFile.scala.html#51399" title="scala.tools.nsc.util.SourceFile">SourceFile</a>, <a title="Int" id="877466">line</a>: <a href="../../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">)</span>: <a href="../../../Tuple2.scala.html#1222" title="(String, Array[Char])" class="delimiter">(</a>String, Array<span class="delimiter">[</span>Char<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="ScratchPadMaker.this.Tree" id="890893">tree</a> = <a href="Global.scala.html#663351" title="(source: scala.tools.nsc.util.SourceFile, forceReload: Boolean)ScratchPadMaker.this.Tree">typedTree</a><span class="delimiter">(</span><a href="#877465" title="scala.tools.nsc.util.SourceFile">source</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="890894">endOffset</a> = <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#877466" title="Int">line</a> <a href="../../../Int.scala.html#57905" title="(x: Int)Boolean">&lt;</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#877465" title="scala.tools.nsc.util.SourceFile">source</a>.<a href="../util/SourceFile.scala.html#561662" title="=&gt; Int">length</a> <span class="keyword">else</span> <a href="#877465" title="scala.tools.nsc.util.SourceFile">source</a>.<a href="../util/SourceFile.scala.html#561666" title="(index: Int)Int">lineToOffset</a><span class="delimiter">(</span><a href="#877466" title="Int">line</a> <a href="../../../Int.scala.html#57948" title="(x: Int)Int">+</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ScratchPadMaker.this.Patcher" id="890895">patcher</a> = <span title="ScratchPadMaker.this.Patcher" class="keyword">new</span> <a href="#663509" title="ScratchPadMaker.this.Patcher">Patcher</a><span class="delimiter">(</span><a href="#877465" title="scala.tools.nsc.util.SourceFile">source</a>.<a href="../util/SourceFile.scala.html#561658" title="=&gt; Array[Char]">content</a>, <a href="#890894" title="Int">endOffset</a><span class="delimiter">)</span>
    <a href="#890895" title="ScratchPadMaker.this.Patcher">patcher</a>.<a href="#887429" title="(tree: ScratchPadMaker.this.Tree)Unit">traverse</a><span class="delimiter">(</span><a href="#890893" title="ScratchPadMaker.this.Tree">tree</a><span class="delimiter">)</span>
    <a href="../../../Tuple2.scala.html#63804" title="(_1: String, _2: Array[Char])(String, Array[Char])" class="delimiter">(</a><a href="#890895" title="ScratchPadMaker.this.Patcher">patcher</a>.<a href="#887408" title="=&gt; String">objectName</a>, <a href="#890895" title="ScratchPadMaker.this.Patcher">patcher</a>.<a href="#887430" title="=&gt; Array[Char]">result</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
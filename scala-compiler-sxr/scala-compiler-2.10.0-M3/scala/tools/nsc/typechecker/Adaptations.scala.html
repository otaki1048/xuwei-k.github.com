<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/typechecker/Adaptations.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
/* NSC -- new Scala compiler
 * Copyright 2005-2011 LAMP/EPFL
 * @author  Paul Phillips
 */

<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> typechecker

/** This trait provides logic for assessing the validity of argument
 *  adaptations, such as tupling, unit-insertion, widening, etc.  Such
 *  logic is spread around the compiler, without much ability on the
 *  part of the user to tighten the potentially dangerous bits.
 *
 *  TODO: unifying/consolidating said logic under consistent management.
 *
 *  @author  Paul Phillips
 */
<span class="keyword">trait</span> <a title="trait Adaptations extends Object" id="48153">Adaptations</a> <a href="../../../Unit.scala.html#2389" title="Unit" class="delimiter">{</a>
  self: Analyzer =&gt;

  <span class="keyword">import</span> <a href="Analyzer.scala.html#560057" title="=&gt; scala.tools.nsc.Global">global</a>._
  <span class="keyword">import</span> <a href="../../../reflect/internal/Definitions.scala.html#441641" title="Adaptations.this.global.definitions.type">definitions</a>._

  <span class="keyword">trait</span> <a title="trait Adaptation extends Object" id="560212">Adaptation</a> <a href="../../../Unit.scala.html#2389" title="Unit" class="delimiter">{</a>
    self: Typer =&gt;

    <span class="keyword">def</span> <a title="(t: Adaptations.this.global.Tree, args: List[Adaptations.this.global.Tree])Boolean" id="560833">checkValidAdaptation</a><span class="delimiter">(</span><a title="Adaptations.this.global.Tree" id="1085343">t</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Adaptations.this.global.Tree">Tree</a>, <a title="List[Adaptations.this.global.Tree]" id="1085344">args</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[Adaptations.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../Boolean.scala.html#2218" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="=&gt; Adaptations.this.global.Tree" id="1085345">applyArg</a> = <a href="#1085343" title="Adaptations.this.global.Tree">t</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Apply<a href="#1085368" title="Adaptations.this.global.Tree" id="1085372" class="delimiter">(</a>_, arg <a title="Adaptations.this.global.Tree" id="1085374">::</a> <a href="../../../collection/immutable/List.scala.html#11552" title="Adaptations.this.global.Tree" id="1085376">Nil</a><span class="delimiter">)</span> =&gt; <a href="#1085377" title="(x: Adaptations.this.global.Tree)Adaptations.this.global.Tree">arg</a>
        <span class="keyword">case</span> _                    =&gt; <a href="#1085377" title="(x: Adaptations.this.global.Tree)Adaptations.this.global.Tree">EmptyTree</a>
      <span class="delimiter">}</span>
      <span class="keyword">def</span> <a title="=&gt; String" id="1085346">callString</a> = <span class="delimiter">(</span>
        <span class="delimiter">(</span> <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#1085343" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443265" title="=&gt; Boolean">isConstructor</a><span class="delimiter">)</span> <span title="String(&quot;new &quot;)" class="string">&quot;new &quot;</span> <span class="keyword">else</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span> <span class="delimiter">)</span> <span title="(x$1: Any)String">+</span>
        <span class="delimiter">(</span> <a href="#1085343" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; Adaptations.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#443388" title="=&gt; String">decodedName</a> <span class="delimiter">)</span> <span title="(x$1: Any)String">+</span>
        <span class="delimiter">(</span> <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#1085343" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443265" title="=&gt; Boolean">isConstructor</a> <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <a href="#1085343" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443152" title="=&gt; Adaptations.this.global.Symbol#NameType">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/StdNames.scala.html#441764" title="Adaptations.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#446433" title="=&gt; Adaptations.this.global.nme.NameType">apply</a><span class="delimiter">)</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span> <span class="keyword">else</span> <span title="String(&quot;.&quot;)" class="string">&quot;.&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1085343" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443388" title="=&gt; String">decodedName</a> <span class="delimiter">)</span>
      <span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="=&gt; String" id="1085347">sigString</a> = <a href="#1085343" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; Adaptations.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#443388" title="=&gt; String">decodedName</a> <span title="(x$1: Any)String">+</span> <span class="delimiter">(</span>
        <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#1085343" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443265" title="=&gt; Boolean">isConstructor</a><span class="delimiter">)</span> <a href="#1085343" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443563" title="=&gt; String">signatureString</a>
        <span class="keyword">else</span> <span title="String(&quot;.&quot;)" class="string">&quot;.&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1085343" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443388" title="=&gt; String">decodedName</a> <span title="(x$1: Any)String">+</span> <a href="#1085343" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443563" title="=&gt; String">signatureString</a>
      <span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="=&gt; String" id="1085348">givenString</a> = <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#1085344" title="List[Adaptations.this.global.Tree]">args</a>.<a href="../../../collection/IterableLike.scala.html#59464" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <span title="String(&quot;&lt;none&gt;&quot;)" class="string">&quot;&lt;none&gt;&quot;</span> <span class="keyword">else</span> <a href="#1085344" title="List[Adaptations.this.global.Tree]">args</a>.<a href="../../../collection/TraversableOnce.scala.html#59190" title="(sep: String)String">mkString</a><span class="delimiter">(</span><span title="String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="=&gt; String" id="1085349">adaptedArgs</a> = <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#1085344" title="List[Adaptations.this.global.Tree]">args</a>.<a href="../../../collection/IterableLike.scala.html#59464" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <span title="String(&quot;(): Unit&quot;)" class="string">&quot;(): Unit&quot;</span> <span class="keyword">else</span> <a href="#1085344" title="List[Adaptations.this.global.Tree]">args</a>.<a href="../../../collection/TraversableOnce.scala.html#59189" title="(start: String, sep: String, end: String)String">mkString</a><span class="delimiter">(</span><span title="String(&quot;(&quot;)" class="string">&quot;(&quot;</span>, <span title="String(&quot;, &quot;)" class="string">&quot;, &quot;</span>, <span title="String(&quot;): &quot;)" class="string">&quot;): &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1085345" title="=&gt; Adaptations.this.global.Tree">applyArg</a>.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; Adaptations.this.global.Type">tpe</a><span class="delimiter">)</span>

      <span class="keyword">def</span> <a title="(msg: String)Unit" id="1085350">adaptWarning</a><span class="delimiter">(</span><a title="String" id="1085404">msg</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="Typers.scala.html#560636" title="=&gt; Adaptations.this.Context">context</a>.<a href="Contexts.scala.html#560986" title="(pos: Adaptations.this.global.Position, msg: String)Unit">warning</a><span class="delimiter">(</span><a href="#1085343" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; Adaptations.this.global.Position">pos</a>, <a href="#1085404" title="String">msg</a> <span title="(x$1: Any)String">+</span>
        <span title="String(&quot;\n        signature: &quot;)" class="string">&quot;\n        signature: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1085347" title="=&gt; String">sigString</a> <span title="(x$1: Any)String">+</span>
        <span title="String(&quot;\n  given arguments: &quot;)" class="string">&quot;\n  given arguments: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1085348" title="=&gt; String">givenString</a> <span title="(x$1: Any)String">+</span>
        <span title="String(&quot;\n after adaptation: &quot;)" class="string">&quot;\n after adaptation: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1085346" title="=&gt; String">callString</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;(&quot;)" class="string">&quot;(&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1085349" title="=&gt; String">adaptedArgs</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;)&quot;)" class="string">&quot;)&quot;</span>
      <span class="delimiter">)</span>
      // A one-argument method accepting Object (which may look like &quot;Any&quot;
      // at this point if the class is java defined) is a &quot;leaky target&quot; for
      // which we should be especially reluctant to insert () or auto-tuple.
      <span class="keyword">def</span> <a title="=&gt; Boolean" id="1085351">isLeakyTarget</a> = <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Boolean" id="1085412">oneArgObject</a> = <a href="#1085343" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443448" title="=&gt; List[List[Adaptations.this.global.Symbol]]">paramss</a> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span class="delimiter">(</span>param <a title="Boolean" id="1085434">::</a> <a href="../../../collection/immutable/List.scala.html#11552" title="Boolean" id="1085437">Nil</a><span class="delimiter">)</span> <a href="#1085429" title="Boolean" id="1085432">::</a> <a href="../../../collection/immutable/List.scala.html#11552" title="Boolean" id="1085438">Nil</a>  =&gt; <a href="../../../reflect/internal/Definitions.scala.html#442179" title="=&gt; Adaptations.this.global.ClassSymbol">ObjectClass</a> <a href="#1085439" title="(x: Boolean)Boolean">isSubClass</a> param.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; Adaptations.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#441986" title="=&gt; Adaptations.this.global.Symbol">typeSymbol</a>
          <span class="keyword">case</span> _                      =&gt; <a href="#1085439" title="(x: Boolean)Boolean" class="keyword">false</a>
        <span class="delimiter">}</span>
        // Unfortunately various &quot;universal&quot; methods and the manner in which
        // they are used limits our ability to enforce anything sensible until
        // an opt-in compiler option is given.
        <a href="#1085412" title="Boolean">oneArgObject</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><span class="delimiter">(</span>
             <a href="../../../reflect/internal/Definitions.scala.html#442455" title="(sym: Adaptations.this.global.Symbol)Boolean">isStringAddition</a><span class="delimiter">(</span><a href="#1085343" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Adaptations.this.global.Symbol">symbol</a><span class="delimiter">)</span>
          <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <a href="../../../reflect/internal/Definitions.scala.html#442456" title="(sym: Adaptations.this.global.Symbol)Boolean">isArrowAssoc</a><span class="delimiter">(</span><a href="#1085343" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Adaptations.this.global.Symbol">symbol</a><span class="delimiter">)</span>
          <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <a href="#1085343" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443152" title="=&gt; Adaptations.this.global.Symbol#NameType">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/StdNames.scala.html#441764" title="Adaptations.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#446513" title="=&gt; Adaptations.this.global.nme.NameType">equals_</a>
          <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <a href="#1085343" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443152" title="=&gt; Adaptations.this.global.Symbol#NameType">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/StdNames.scala.html#441764" title="Adaptations.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#446791" title="=&gt; Adaptations.this.global.TermName">EQ</a>
          <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <a href="#1085343" title="Adaptations.this.global.Tree">t</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Adaptations.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443152" title="=&gt; Adaptations.this.global.Symbol#NameType">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/StdNames.scala.html#441764" title="Adaptations.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#446815" title="=&gt; Adaptations.this.global.TermName">NE</a>
        <span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../Global.scala.html#559485" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#467522" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">noAdaptedArgs</a>.<a href="../settings/MutableSettings.scala.html#467820" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
        <a href="#1085350" title="(msg: String)Unit">adaptWarning</a><span class="delimiter">(</span><span title="String(&quot;No automatic adaptation here: use explicit parentheses.&quot;)" class="string">&quot;No automatic adaptation here: use explicit parentheses.&quot;</span><span class="delimiter">)</span>
      <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../Global.scala.html#559485" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/Warnings.scala.html#467702" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">warnAdaptedArgs</a>.<a href="../settings/MutableSettings.scala.html#467820" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
        <a href="#1085350" title="(msg: String)Unit">adaptWarning</a><span class="delimiter">(</span>
          <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#1085344" title="List[Adaptations.this.global.Tree]">args</a>.<a href="../../../collection/IterableLike.scala.html#59464" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <span title="String(&quot;Adapting argument list by inserting (): &quot;)" class="string">&quot;Adapting argument list by inserting (): &quot;</span> <span title="(x$1: Any)String">+</span> <span class="delimiter">(</span>
            <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#1085351" title="=&gt; Boolean">isLeakyTarget</a><span class="delimiter">)</span> <span title="String(&quot;leaky (Object-receiving) target makes this especially dangerous.&quot;)" class="string">&quot;leaky (Object-receiving) target makes this especially dangerous.&quot;</span>
            <span class="keyword">else</span> <span title="String(&quot;this is unlikely to be what you want.&quot;)" class="string">&quot;this is unlikely to be what you want.&quot;</span>
          <span class="delimiter">)</span>
          <span class="keyword">else</span> <span title="String(&quot;Adapting argument list by creating a &quot;)" class="string">&quot;Adapting argument list by creating a &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1085344" title="List[Adaptations.this.global.Tree]">args</a>.<a href="../../../collection/SeqLike.scala.html#59711" title="=&gt; Int">size</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;-tuple: this may not be what you want.&quot;)" class="string">&quot;-tuple: this may not be what you want.&quot;</span>
        <span class="delimiter">)</span>

      <a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="../Global.scala.html#559485" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#467522" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">noAdaptedArgs</a>.<a href="../settings/MutableSettings.scala.html#467820" title="=&gt; Boolean">value</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span title="Object" class="delimiter">}</span>

        </pre>
    </body>
</html>
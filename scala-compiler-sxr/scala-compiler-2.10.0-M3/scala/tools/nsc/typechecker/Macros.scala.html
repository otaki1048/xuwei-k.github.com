<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/typechecker/Macros.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> typechecker

<span class="keyword">import</span> symtab.<a href="../symtab/package.scala.html#57302" title="=&gt; reflect.internal.Flags.type">Flags</a>._
<span class="keyword">import</span> scala.tools.nsc.util._
<span class="keyword">import</span> scala.tools.nsc.util.<a href="../util/ClassPath.scala.html#51970" title="scala.tools.nsc.util.ClassPath.type">ClassPath</a>._
<span class="keyword">import</span> scala.reflect.ReflectionUtils
<span class="keyword">import</span> scala.collection.mutable.ListBuffer
<span class="keyword">import</span> scala.compat.<a href="../../../compat/Platform.scala.html#16515" title="scala.compat.Platform.type">Platform</a>.EOL
<span class="keyword">import</span> scala.reflect.makro.runtime.<span class="delimiter">{</span>Context =&gt; MacroContext<span class="delimiter">}</span>
<span class="keyword">import</span> scala.reflect.runtime.Mirror
<span class="keyword">import</span> util.<a href="../util/Statistics.scala.html#51448" title="scala.tools.nsc.util.Statistics.type">Statistics</a>._
<span class="keyword">import</span> scala.reflect.makro.util._

/**
 *  Code to deal with macros, namely with:
 *    * Compilation of macro definitions
 *    * Expansion of macro applications
 *
 *  Say we have in a class C:
 *
 *    def foo[T](xs: List[T]): T = macro fooBar
 *
 *  Then fooBar needs to point to a static method of the following form:
 *
 *    def fooBar[T: c.TypeTag]
 *           (c: scala.reflect.makro.Context)
 *           (xs: c.Expr[List[T]])
 *           : c.mirror.Tree = {
 *      ...
 *    }
 *
 *  Then, if foo is called in qual.foo[Int](elems), where qual: D,
 *  the macro application is expanded to a reflective invocation of fooBar with parameters
 *
 *    (simpleMacroContext{ type PrefixType = D; val prefix = qual })
 *    (Expr(elems))
 *    (TypeTag(Int))
 */
<span class="keyword">trait</span> <a title="trait Macros extends Object with scala.reflect.makro.util.Traces" id="49371">Macros</a> <a href="../../../Unit.scala.html#2389" title="Unit" class="keyword">extends</a> <a href="../../../reflect/makro/util/Traces.scala.html#24077" title="scala.reflect.makro.util.Traces">Traces</a> <span class="delimiter">{</span>
  self: Analyzer =&gt;

  <span class="keyword">import</span> <a href="Analyzer.scala.html#560057" title="=&gt; scala.tools.nsc.Global">global</a>._
  <span class="keyword">import</span> <a href="../../../reflect/internal/Definitions.scala.html#441641" title="Macros.this.global.definitions.type">definitions</a>._
  <span class="keyword">def</span> <a title="=&gt; scala.tools.nsc.Settings" id="560422">globalSettings</a> = <a href="Analyzer.scala.html#560057" title="=&gt; scala.tools.nsc.Global">global</a>.<a href="../Global.scala.html#559485" title="=&gt; scala.tools.nsc.Settings">settings</a>

  <span class="keyword">val</span> <a title="scala.collection.mutable.Map[Any,Any]" id="560423">globalMacroCache</a> = collection.mutable.<a href="../../../collection/generic/GenMapFactory.scala.html#61654" title="[A, B](elems: (A, B)*)scala.collection.mutable.Map[A,B]">Map</a><span title="(elems: (Any, Any)*)scala.collection.mutable.Map[Any,Any]" class="delimiter">[</span><span title="Any">Any</span>, <span title="Any">Any</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[Macros.this.global.Symbol,scala.collection.mutable.Map[Any,Any]]" id="560425">perRunMacroCache</a> = <a href="../../../reflect/internal/SymbolTable.scala.html#440630" title="Macros.this.global.perRunCaches.type">perRunCaches</a>.<a href="../../../reflect/internal/SymbolTable.scala.html#492850" title="[K, V]()scala.collection.mutable.HashMap[K,V]">newMap</a><span title="()scala.collection.mutable.HashMap[Macros.this.global.Symbol,scala.collection.mutable.Map[Any,Any]]" class="delimiter">[</span><a href="../../../reflect/internal/Symbols.scala.html#441132" title="Macros.this.global.Symbol">Symbol</a>, collection.mutable.<a href="../../../collection/mutable/Map.scala.html#12934" title="scala.collection.mutable.Map[Any,Any]">Map</a><span class="delimiter">[</span>Any, Any<span class="delimiter">]</span><span class="delimiter">]</span>

  /** A list of compatible macro implementation signatures.
   *
   *  In the example above:
   *    (c: scala.reflect.makro.Context)(xs: c.Expr[List[T]]): c.Expr[T]
   *
   *  @param macroDef The macro definition symbol
   *  @param tparams  The type parameters of the macro definition
   *  @param vparamss The value parameters of the macro definition
   *  @param retTpe   The return type of the macro definition
   */
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(macroDef: Macros.this.global.Symbol, tparams: List[Macros.this.global.TypeDef], vparamss: List[List[Macros.this.global.ValDef]], retTpe: Macros.this.global.Type)(List[List[List[Macros.this.global.Symbol]]], Macros.this.global.Type)" id="560427">macroImplSigs</a><span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1108950">macroDef</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="Macros.this.global.Symbol">Symbol</a>, <a title="List[Macros.this.global.TypeDef]" id="1108951">tparams</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[Macros.this.global.TypeDef]">List</a><span class="delimiter">[</span>TypeDef<span class="delimiter">]</span>, <a title="List[List[Macros.this.global.ValDef]]" id="1108952">vparamss</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[List[Macros.this.global.ValDef]]">List</a><span class="delimiter">[</span>List<span class="delimiter">[</span>ValDef<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="Macros.this.global.Type" id="1108953">retTpe</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="Macros.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../Tuple2.scala.html#1222" title="(List[List[List[Macros.this.global.Symbol]]], Macros.this.global.Type)" class="delimiter">(</a>List<span class="delimiter">[</span>List<span class="delimiter">[</span>List<span class="delimiter">[</span>Symbol<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span>, Type<span class="delimiter">)</span> = <span class="delimiter">{</span>
    // had to move method's body to an object because of the recursive dependencies between sigma and param
    <span class="keyword">object</span> <a title="SigGenerator.type" id="1108955">SigGenerator</a> <a href="#1108956" title="SigGenerator.type" class="delimiter">{</a>
      <span class="keyword">val</span> <a title="Boolean" id="1108959">hasThis</a> = <a href="#1108950" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; Macros.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#443231" title="=&gt; Boolean">isClass</a>
      <span class="keyword">val</span> <a title="Macros.this.global.Type" id="1108961">ownerTpe</a> = <a href="#1108950" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; Macros.this.global.Symbol">owner</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> owner <span class="keyword">if</span> owner.<a href="../../../reflect/internal/Symbols.scala.html#443245" title="=&gt; Boolean">isModuleClass</a> =&gt; <a href="#1108995" title="(x: Macros.this.global.Type)Macros.this.global.Type" class="keyword">new</a> <a href="../../../reflect/internal/Types.scala.html#441263" title="Macros.this.global.UniqueThisType">UniqueThisType</a><span class="delimiter">(</span><a href="#1108950" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; Macros.this.global.Symbol">owner</a><span class="delimiter">)</span>
        <span class="keyword">case</span> owner <span class="keyword">if</span> owner.<a href="../../../reflect/internal/Symbols.scala.html#443231" title="=&gt; Boolean">isClass</a> =&gt; <a href="#1108950" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; Macros.this.global.Symbol">owner</a>.<a href="#1108995" title="(x: Macros.this.global.Type)Macros.this.global.Type">tpe</a>
        <span class="keyword">case</span> _ =&gt; <a href="#1108995" title="(x: Macros.this.global.Type)Macros.this.global.Type">NoType</a>
      <span class="delimiter">}</span>
      <span class="keyword">val</span> <a title="Boolean" id="1108963">hasTparams</a> = <a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1108951" title="List[Macros.this.global.TypeDef]">tparams</a>.<a href="../../../collection/IterableLike.scala.html#59464" title="=&gt; Boolean">isEmpty</a>

      <span class="keyword">def</span> <a title="(tpe: Macros.this.global.Type)Macros.this.global.Type" id="1108965">sigma</a><span class="delimiter">(</span><a title="Macros.this.global.Type" id="1109126">tpe</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="Macros.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#441242" title="Macros.this.global.Type">Type</a> = <span class="delimiter">{</span>
        <span class="keyword">class</span> <a title="class SigmaTypeMap extends Macros.this.global.TypeMap" id="1109128">SigmaTypeMap</a> <a href="#1109128" title="SigmaTypeMap" class="keyword">extends</a> <a href="../../../reflect/internal/Types.scala.html#441429" title="Macros.this.global.TypeMap">TypeMap</a> <span class="delimiter">{</span>
          <span class="keyword">def</span> <a title="(tp: Macros.this.global.Type)Macros.this.global.Type" id="1109130">apply</a><span class="delimiter">(</span><a title="Macros.this.global.Type" id="1109132">tp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="Macros.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#441242" title="Macros.this.global.Type">Type</a> = <a href="#1109132" title="Macros.this.global.Type">tp</a> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> TypeRef<a href="#1109291" title="Macros.this.global.Type" id="1109293" class="delimiter">(</a>pre, sym, args<span class="delimiter">)</span> =&gt;
              <span class="keyword">val</span> <a title="Macros.this.global.Type" id="1109143">pre1</a> = <a href="../../../reflect/internal/Types.scala.html#461309" title="=&gt; Macros.this.global.Symbol">pre</a> <span class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> ThisType<a href="#1109199" title="Macros.this.global.Type" id="1109201" class="delimiter">(</a>sym<span class="delimiter">)</span> <span class="keyword">if</span> sym <span title="(x$1: AnyRef)Boolean">==</span> <a href="#1108950" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; Macros.this.global.Symbol">owner</a> =&gt;
                  <a href="../../../reflect/internal/Types.scala.html#461424" title="(pre: Macros.this.global.Type, sym: Macros.this.global.Symbol)Macros.this.global.Type">SingleType</a><a href="#1109207" title="(x: Macros.this.global.Type)Macros.this.global.Type" class="delimiter">(</a><a href="../../../reflect/internal/Types.scala.html#461424" title="(pre: Macros.this.global.Type, sym: Macros.this.global.Symbol)Macros.this.global.Type">SingleType</a><span class="delimiter">(</span><a href="../../../reflect/internal/Types.scala.html#461424" title="(pre: Macros.this.global.Type, sym: Macros.this.global.Symbol)Macros.this.global.Type">SingleType</a><span class="delimiter">(</span><a href="../../../reflect/internal/Types.scala.html#441258" title="Macros.this.global.NoPrefix.type">NoPrefix</a>, <a href="../../../collection/LinearSeqOptimized.scala.html#76165" title="(n: Int)Macros.this.global.TermSymbol">paramsCtx</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="../../../reflect/internal/Definitions.scala.html#442426" title="=&gt; Macros.this.global.Symbol">MacroContextPrefix</a><span class="delimiter">)</span>, <a href="../../../reflect/internal/Definitions.scala.html#442398" title="=&gt; Macros.this.global.Symbol">ExprValue</a><span class="delimiter">)</span>
                <span class="keyword">case</span> SingleType<a href="#1109199" title="Macros.this.global.Type" id="1109204" class="delimiter">(</a><a href="../../../reflect/internal/Types.scala.html#441258" title="Macros.this.global.Type" id="1109206">NoPrefix</a>, sym<span class="delimiter">)</span> =&gt;
                  <a href="../../../reflect/internal/util/Collections.scala.html#440659" title="(xss: List[List[Macros.this.global.ValDef]])(p: Macros.this.global.ValDef =&gt; Boolean)Option[Macros.this.global.ValDef]">mfind</a><span class="delimiter">(</span><a href="#1108952" title="List[List[Macros.this.global.ValDef]]">vparamss</a><span class="delimiter">)</span><a href="#1109207" title="(x: Macros.this.global.Type)Macros.this.global.Type" class="delimiter">(</a><a href="#1109182" title="Macros.this.global.ValDef">_</a>.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; Macros.this.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">==</span> sym<span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
                    <span class="keyword">case</span> Some<a href="#1109191" title="Macros.this.global.Type" id="1109192" class="delimiter">(</a>macroDefParam<span class="delimiter">)</span> =&gt;
                      <a href="../../../reflect/internal/Types.scala.html#461424" title="(pre: Macros.this.global.Type, sym: Macros.this.global.Symbol)Macros.this.global.Type">SingleType</a><a href="#1109193" title="(x: Macros.this.global.Type)Macros.this.global.Type" class="delimiter">(</a><a href="../../../reflect/internal/Types.scala.html#461424" title="(pre: Macros.this.global.Type, sym: Macros.this.global.Symbol)Macros.this.global.Type">SingleType</a><span class="delimiter">(</span><a href="../../../reflect/internal/Types.scala.html#441258" title="Macros.this.global.NoPrefix.type">NoPrefix</a>, <a href="#1108972" title="(tree: Macros.this.global.Tree)Macros.this.global.Symbol">param</a><span class="delimiter">(</span>macroDefParam<span class="delimiter">)</span><span class="delimiter">)</span>, <a href="../../../reflect/internal/Definitions.scala.html#442398" title="=&gt; Macros.this.global.Symbol">ExprValue</a><span class="delimiter">)</span>
                    <span class="keyword">case</span> _ =&gt;
                      <a href="#1109193" title="(x: Macros.this.global.Type)Macros.this.global.Type">pre</a>
                  <span class="delimiter">}</span>
                <span class="keyword">case</span> _ =&gt;
                  <a href="#1109207" title="(x: Macros.this.global.Type)Macros.this.global.Type">pre</a>
              <span class="delimiter">}</span>
              <span class="keyword">val</span> <a title="List[Macros.this.global.Type]" id="1109144">args1</a> = args <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: Macros.this.global.Type =&gt; Macros.this.global.Type)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Type],Macros.this.global.Type,List[Macros.this.global.Type]])List[Macros.this.global.Type]">map</a> <a href="../../../reflect/internal/Types.scala.html#460841" title="(tp: Macros.this.global.Type)Macros.this.global.Type">mapOver</a>
              <a href="../../../reflect/internal/Types.scala.html#448096" title="(pre: Macros.this.global.Type, sym: Macros.this.global.Symbol, args: List[Macros.this.global.Type])Macros.this.global.Type">TypeRef</a><span class="delimiter">(</span><a href="#1109143" title="Macros.this.global.Type">pre1</a>, sym, <a href="#1109144" title="List[Macros.this.global.Type]">args1</a><span class="delimiter">)</span>
            <span class="keyword">case</span> _ =&gt;
              <a href="../../../reflect/internal/Types.scala.html#460841" title="(tp: Macros.this.global.Type)Macros.this.global.Type">mapOver</a><a href="#1109294" title="(x: Macros.this.global.Type)Macros.this.global.Type" class="delimiter">(</a><a href="#1109132" title="Macros.this.global.Type">tp</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>

        <span title="SigmaTypeMap" class="keyword">new</span> <a href="#1109128" title="SigmaTypeMap">SigmaTypeMap</a><span class="delimiter">(</span><span class="delimiter">)</span> <a href="#1109130" title="(tp: Macros.this.global.Type)Macros.this.global.Type">apply</a> <a href="#1109126" title="Macros.this.global.Type">tpe</a>
      <span class="delimiter">}</span>

      <span class="keyword">def</span> <a title="(name: Macros.this.global.Name, pos: Macros.this.global.Position, tpe: Macros.this.global.Type, flags: Long)Macros.this.global.TermSymbol" id="1108966">makeParam</a><span class="delimiter">(</span><a title="Macros.this.global.Name" id="1109001">name</a>: <a href="../../../reflect/internal/Names.scala.html#440792" title="Macros.this.global.Name">Name</a>, <a title="Macros.this.global.Position" id="1109002">pos</a>: <a href="../util/Position.scala.html#52230" title="Macros.this.global.Position">Position</a>, <a title="Macros.this.global.Type" id="1109003">tpe</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="Macros.this.global.Type">Type</a>, <a title="Long" id="1109005">flags</a>: <a href="../../../Long.scala.html#1993" title="Long">Long</a> = <span title="Long(0L)" class="long">0L</span><span class="delimiter">)</span> =
        <a href="#1108950" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#443175" title="(name: Macros.this.global.TermName, pos: Macros.this.global.Position, newFlags: Long)Macros.this.global.TermSymbol">newValueParameter</a><span class="delimiter">(</span><a href="../../../reflect/internal/Names.scala.html#440756" title="implicit scala.reflect.internal.Names.promoteTermNamesAsNecessary : (name: Macros.this.global.Name)Macros.this.global.TermName">name</a>, <a href="#1109002" title="Macros.this.global.Position">pos</a>, <a href="#1109005" title="Long">flags</a><span class="delimiter">)</span> <a href="../../../reflect/internal/Symbols.scala.html#443429" title="(info: Macros.this.global.Type)Macros.this.global.TermSymbol">setInfo</a> <a href="#1109003" title="Macros.this.global.Type">tpe</a>
      <span class="keyword">val</span> <a title="Macros.this.global.TermSymbol" id="1108967">ctxParam</a> = <a href="#1108966" title="(name: Macros.this.global.Name, pos: Macros.this.global.Position, tpe: Macros.this.global.Type, flags: Long)Macros.this.global.TermSymbol">makeParam</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#441764" title="Macros.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#446577" title="=&gt; Macros.this.global.nme.NameType">macroContext</a>, <a href="#1108950" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#443167" title="=&gt; Macros.this.global.Position">pos</a>, <a href="../../../reflect/internal/Definitions.scala.html#442424" title="=&gt; Macros.this.global.ClassSymbol">MacroContextClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443721" title="=&gt; Macros.this.global.Type">tpe</a>, <span title="Long(2097152L)">SYNTHETIC</span><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="(isType: Boolean, origTpe: Macros.this.global.Type)Macros.this.global.Type" id="1108969">implType</a><span class="delimiter">(</span><a title="Boolean" id="1109031">isType</a>: <a href="../../../Boolean.scala.html#2218" title="Boolean">Boolean</a>, <a title="Macros.this.global.Type" id="1109032">origTpe</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="Macros.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#441242" title="Macros.this.global.Type">Type</a> =
        <span title="Macros.this.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#442310" title="(tp: Macros.this.global.Type)Boolean">isRepeatedParamType</a><span class="delimiter">(</span><a href="#1109032" title="Macros.this.global.Type">origTpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="../../../reflect/internal/Types.scala.html#441377" title="(tycon: Macros.this.global.Type, args: List[Macros.this.global.Type])Macros.this.global.Type">appliedType</a><span class="delimiter">(</span>
            <a href="../../../reflect/internal/Definitions.scala.html#442303" title="=&gt; Macros.this.global.ClassSymbol">RepeatedParamClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443723" title="=&gt; Macros.this.global.Type">typeConstructor</a>,
            <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: Macros.this.global.Type*)List[Macros.this.global.Type]">List</a><span class="delimiter">(</span><a href="#1108969" title="(isType: Boolean, origTpe: Macros.this.global.Type)Macros.this.global.Type">implType</a><span class="delimiter">(</span><a href="#1109031" title="Boolean">isType</a>, <a href="#1108965" title="(tpe: Macros.this.global.Type)Macros.this.global.Type">sigma</a><span class="delimiter">(</span><a href="#1109032" title="Macros.this.global.Type">origTpe</a>.<a href="../../../reflect/internal/Types.scala.html#442000" title="=&gt; List[Macros.this.global.Type]">typeArgs</a>.<a href="../../../collection/IterableLike.scala.html#59473" title="=&gt; Macros.this.global.Type">head</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="1109325">tsym</a> = <a href="../../../reflect/internal/Definitions.scala.html#442757" title="(owner: Macros.this.global.Symbol, name: Macros.this.global.Name)Macros.this.global.Symbol">getMember</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#442424" title="=&gt; Macros.this.global.ClassSymbol">MacroContextClass</a>, <span title="Macros.this.global.tpnme.NameType" class="keyword">if</span> <span class="delimiter">(</span><a href="#1109031" title="Boolean">isType</a><span class="delimiter">)</span> <a href="../../../reflect/internal/StdNames.scala.html#441756" title="Macros.this.global.tpnme.type">tpnme</a>.<a href="../../../reflect/internal/StdNames.scala.html#445902" title="=&gt; Macros.this.global.tpnme.NameType">TypeTag</a> <span class="keyword">else</span> <a href="../../../reflect/internal/StdNames.scala.html#441756" title="Macros.this.global.tpnme.type">tpnme</a>.<a href="../../../reflect/internal/StdNames.scala.html#449203" title="=&gt; Macros.this.global.tpnme.NameType">Expr</a><span class="delimiter">)</span>
          <a href="../../../reflect/internal/Types.scala.html#441371" title="(pre: Macros.this.global.Type, sym: Macros.this.global.Symbol, args: List[Macros.this.global.Type])Macros.this.global.Type">typeRef</a><span class="delimiter">(</span><a href="../../../reflect/internal/Types.scala.html#441367" title="(pre: Macros.this.global.Type, sym: Macros.this.global.Symbol)Macros.this.global.Type">singleType</a><span class="delimiter">(</span><a href="../../../reflect/internal/Types.scala.html#441258" title="Macros.this.global.NoPrefix.type">NoPrefix</a>, <a href="#1108967" title="=&gt; Macros.this.global.TermSymbol">ctxParam</a><span class="delimiter">)</span>, <a href="#1109325" title="Macros.this.global.Symbol">tsym</a>, <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: Macros.this.global.Type*)List[Macros.this.global.Type]">List</a><span class="delimiter">(</span><a href="#1108965" title="(tpe: Macros.this.global.Type)Macros.this.global.Type">sigma</a><span class="delimiter">(</span><a href="#1109032" title="Macros.this.global.Type">origTpe</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.Map[Macros.this.global.Symbol,Macros.this.global.Symbol]" id="1108970">paramCache</a> = collection.mutable.<a href="../../../collection/generic/GenMapFactory.scala.html#61654" title="[A, B](elems: (A, B)*)scala.collection.mutable.Map[A,B]">Map</a><span title="(elems: (Macros.this.global.Symbol, Macros.this.global.Symbol)*)scala.collection.mutable.Map[Macros.this.global.Symbol,Macros.this.global.Symbol]" class="delimiter">[</span><a href="../../../reflect/internal/Symbols.scala.html#441132" title="Macros.this.global.Symbol">Symbol</a>, <a href="../../../reflect/internal/Symbols.scala.html#441132" title="Macros.this.global.Symbol">Symbol</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="(tree: Macros.this.global.Tree)Macros.this.global.Symbol" id="1108972">param</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1109049">tree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="Macros.this.global.Symbol">Symbol</a> =
        <a href="#1108970" title="=&gt; scala.collection.mutable.Map[Macros.this.global.Symbol,Macros.this.global.Symbol]">paramCache</a>.<a href="../../../collection/mutable/MapLike.scala.html#78517" title="(key: Macros.this.global.Symbol, op: =&gt; Macros.this.global.Symbol)Macros.this.global.Symbol">getOrElseUpdate</a><span class="delimiter">(</span><a href="#1109049" title="Macros.this.global.Tree">tree</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Macros.this.global.Symbol">symbol</a>, <span class="delimiter">{</span>
          // [Eugene] deskolemization became necessary once I implemented inference of macro def return type
          // please, verify this solution, but for now I'll leave it here - cargo cult for the win
          <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="1109335">sym</a> = <a href="#1109049" title="Macros.this.global.Tree">tree</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Macros.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443531" title="=&gt; Macros.this.global.Symbol">deSkolemize</a>
          <span class="keyword">val</span> <a title="Macros.this.global.TermSymbol" id="1109336">sigParam</a> = <a href="#1108966" title="(name: Macros.this.global.Name, pos: Macros.this.global.Position, tpe: Macros.this.global.Type, flags: Long)Macros.this.global.TermSymbol">makeParam</a><span class="delimiter">(</span><a href="#1109335" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443152" title="=&gt; sym.NameType">name</a>, <a href="#1109335" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443167" title="=&gt; Macros.this.global.Position">pos</a>, <a href="#1108969" title="(isType: Boolean, origTpe: Macros.this.global.Type)Macros.this.global.Type">implType</a><span class="delimiter">(</span><a href="#1109335" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443230" title="=&gt; Boolean">isType</a>, <a href="#1109335" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; Macros.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1109335" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/HasFlags.scala.html#443598" title="=&gt; Boolean">isSynthetic</a><span class="delimiter">)</span> <a href="#1109336" title="Macros.this.global.TermSymbol">sigParam</a>.<a href="../../../reflect/internal/Symbols.scala.html#443311" title="(fs: Long)Unit">flags</a> <a href="../../../Long.scala.html#58295" title="(x: Int)Long">|=</a> <span title="Int(2097152)">SYNTHETIC</span>
          <a href="#1109336" title="Macros.this.global.TermSymbol">sigParam</a>
        <span class="delimiter">}</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="List[Macros.this.global.TermSymbol]" id="1108973">paramsCtx</a> = <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: Macros.this.global.TermSymbol*)List[Macros.this.global.TermSymbol]">List</a><span class="delimiter">(</span><a href="#1108967" title="=&gt; Macros.this.global.TermSymbol">ctxParam</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="List[Macros.this.global.TermSymbol]" id="1108975">paramsThis</a> = <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: Macros.this.global.TermSymbol*)List[Macros.this.global.TermSymbol]">List</a><span class="delimiter">(</span><a href="#1108966" title="(name: Macros.this.global.Name, pos: Macros.this.global.Position, tpe: Macros.this.global.Type, flags: Long)Macros.this.global.TermSymbol">makeParam</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#441764" title="Macros.this.global.nme.type">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#446575" title="=&gt; Macros.this.global.nme.NameType">macroThis</a>, <a href="#1108950" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#443167" title="=&gt; Macros.this.global.Position">pos</a>, <a href="#1108969" title="(isType: Boolean, origTpe: Macros.this.global.Type)Macros.this.global.Type">implType</a><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span>, <a href="#1108961" title="=&gt; Macros.this.global.Type">ownerTpe</a><span class="delimiter">)</span>, <span title="Long(2097152L)">SYNTHETIC</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="List[Macros.this.global.Symbol]" id="1108977">paramsTparams</a> = <a href="#1108951" title="List[Macros.this.global.TypeDef]">tparams</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: Macros.this.global.TypeDef =&gt; Macros.this.global.Symbol)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.TypeDef],Macros.this.global.Symbol,List[Macros.this.global.Symbol]])List[Macros.this.global.Symbol]">map</a> <a href="#1108972" title="(tree: Macros.this.global.Tree)Macros.this.global.Symbol">param</a>
      <span class="keyword">val</span> <a title="List[List[Macros.this.global.Symbol]]" id="1108979">paramssParams</a> = <a href="../../../reflect/internal/util/Collections.scala.html#440651" title="(xss: List[List[Macros.this.global.ValDef]])(f: Macros.this.global.ValDef =&gt; Macros.this.global.Symbol)List[List[Macros.this.global.Symbol]]">mmap</a><span class="delimiter">(</span><a href="#1108952" title="List[List[Macros.this.global.ValDef]]">vparamss</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1108972" title="(tree: Macros.this.global.Tree)Macros.this.global.Symbol">param</a><span class="delimiter">)</span>

      <span class="keyword">var</span> <a title="List[List[List[Macros.this.global.Symbol]]]" id="1108982">paramsss</a> = List<span class="delimiter">[</span>List<span class="delimiter">[</span>List<span class="delimiter">[</span>Symbol<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span><a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type" class="delimiter">(</a><span class="delimiter">)</span>
      // tparams are no longer part of a signature, they get into macro implementations via context bounds
//      if (hasTparams &amp;&amp; hasThis) paramsss :+= paramsCtx :: paramsThis :: paramsTparams :: paramssParams
//      if (hasTparams) paramsss :+= paramsCtx :: paramsTparams :: paramssParams
      // _this params are no longer part of a signature, its gets into macro implementations via Context.prefix
//      if (hasThis) paramsss :+= paramsCtx :: paramsThis :: paramssParams
      <a href="#1108982" title="(x$1: List[List[List[Macros.this.global.Symbol]]])Unit">paramsss</a> <a href="../../../collection/SeqLike.scala.html#59810" title="(elem: List[List[Macros.this.global.Symbol]])(implicit bf: scala.collection.generic.CanBuildFrom[List[List[List[Macros.this.global.Symbol]]],List[List[Macros.this.global.Symbol]],List[List[List[Macros.this.global.Symbol]]]])List[List[List[Macros.this.global.Symbol]]]">:+=</a> <a href="#1108973" title="=&gt; List[Macros.this.global.TermSymbol]">paramsCtx</a> <a href="../../../collection/immutable/List.scala.html#63643" title="(x: List[Macros.this.global.Symbol])List[List[Macros.this.global.Symbol]]">::</a> <a href="#1108979" title="=&gt; List[List[Macros.this.global.Symbol]]">paramssParams</a>

      <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="1108984">tsym</a> = <a href="../../../reflect/internal/Definitions.scala.html#442757" title="(owner: Macros.this.global.Symbol, name: Macros.this.global.Name)Macros.this.global.Symbol">getMember</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#442424" title="=&gt; Macros.this.global.ClassSymbol">MacroContextClass</a>, <a href="../../../reflect/internal/StdNames.scala.html#441756" title="Macros.this.global.tpnme.type">tpnme</a>.<a href="../../../reflect/internal/StdNames.scala.html#449203" title="=&gt; Macros.this.global.tpnme.NameType">Expr</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Macros.this.global.Type" id="1108986">implRetTpe</a> = <a href="../../../reflect/internal/Types.scala.html#441371" title="(pre: Macros.this.global.Type, sym: Macros.this.global.Symbol, args: List[Macros.this.global.Type])Macros.this.global.Type">typeRef</a><span class="delimiter">(</span><a href="../../../reflect/internal/Types.scala.html#441367" title="(pre: Macros.this.global.Type, sym: Macros.this.global.Symbol)Macros.this.global.Type">singleType</a><span class="delimiter">(</span><a href="../../../reflect/internal/Types.scala.html#441258" title="Macros.this.global.NoPrefix.type">NoPrefix</a>, <a href="#1108967" title="=&gt; Macros.this.global.TermSymbol">ctxParam</a><span class="delimiter">)</span>, <a href="#1108984" title="=&gt; Macros.this.global.Symbol">tsym</a>, <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: Macros.this.global.Type*)List[Macros.this.global.Type]">List</a><span class="delimiter">(</span><a href="#1108965" title="(tpe: Macros.this.global.Type)Macros.this.global.Type">sigma</a><span class="delimiter">(</span><a href="#1108953" title="Macros.this.global.Type">retTpe</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">import</span> <a href="#1108955" title="SigGenerator.type">SigGenerator</a>._
    <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: Macros.this.global.Symbol)Macros.this.global.Symbol">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;generating macroImplSigs for: &quot;)" class="string">&quot;generating macroImplSigs for: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1108950" title="Macros.this.global.Symbol">macroDef</a><span class="delimiter">)</span>
    <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: List[Macros.this.global.TypeDef])List[Macros.this.global.TypeDef]">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;tparams are: &quot;)" class="string">&quot;tparams are: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1108951" title="List[Macros.this.global.TypeDef]">tparams</a><span class="delimiter">)</span>
    <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: List[List[Macros.this.global.ValDef]])List[List[Macros.this.global.ValDef]]">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;vparamss are: &quot;)" class="string">&quot;vparamss are: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1108952" title="List[List[Macros.this.global.ValDef]]">vparamss</a><span class="delimiter">)</span>
    <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: Macros.this.global.Type)Macros.this.global.Type">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;retTpe is: &quot;)" class="string">&quot;retTpe is: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1108953" title="Macros.this.global.Type">retTpe</a><span class="delimiter">)</span>
    <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: (List[List[List[Macros.this.global.Symbol]]], Macros.this.global.Type))(List[List[List[Macros.this.global.Symbol]]], Macros.this.global.Type)">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;macroImplSigs are: &quot;)" class="string">&quot;macroImplSigs are: &quot;</span><span class="delimiter">)</span><a href="../../../Tuple2.scala.html#63804" title="(_1: List[List[List[Macros.this.global.Symbol]]], _2: Macros.this.global.Type)(List[List[List[Macros.this.global.Symbol]]], Macros.this.global.Type)" class="delimiter">(</a><a href="#1108982" title="=&gt; List[List[List[Macros.this.global.Symbol]]]">paramsss</a>, <a href="#1108986" title="=&gt; Macros.this.global.Type">implRetTpe</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(paramss: List[List[Macros.this.global.Symbol]], transform: (Macros.this.global.Symbol, Macros.this.global.Symbol) =&gt; Option[Macros.this.global.Symbol])List[List[Macros.this.global.Symbol]]" id="560428">transformTypeTagEvidenceParams</a><span class="delimiter">(</span><a title="List[List[Macros.this.global.Symbol]]" id="1109450">paramss</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[List[Macros.this.global.Symbol]]">List</a><span class="delimiter">[</span>List<span class="delimiter">[</span>Symbol<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="(Macros.this.global.Symbol, Macros.this.global.Symbol) =&gt; Option[Macros.this.global.Symbol]" id="1109451">transform</a>: <span class="delimiter">(</span>Symbol, Symbol<span class="delimiter">)</span> =&gt; Option<span class="delimiter">[</span>Symbol<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[List[Macros.this.global.Symbol]]">List</a><span class="delimiter">[</span>List<span class="delimiter">[</span>Symbol<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1109450" title="List[List[Macros.this.global.Symbol]]">paramss</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <a href="#1109450" title="List[List[Macros.this.global.Symbol]]">paramss</a>

    <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="1109453">wannabe</a> = <span title="Macros.this.global.Symbol" class="keyword">if</span> <span class="delimiter">(</span><a href="#1109450" title="List[List[Macros.this.global.Symbol]]">paramss</a>.<a href="../../../collection/IterableLike.scala.html#59473" title="=&gt; List[Macros.this.global.Symbol]">head</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <a href="#1109450" title="List[List[Macros.this.global.Symbol]]">paramss</a>.<a href="../../../collection/IterableLike.scala.html#59473" title="=&gt; List[Macros.this.global.Symbol]">head</a>.<a href="../../../collection/IterableLike.scala.html#59473" title="=&gt; Macros.this.global.Symbol">head</a> <span class="keyword">else</span> <a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; Macros.this.global.NoSymbol">NoSymbol</a>
    <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="1109454">contextParam</a> = <span title="Macros.this.global.Symbol" class="keyword">if</span> <span class="delimiter">(</span><a href="#1109453" title="Macros.this.global.Symbol">wannabe</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; Macros.this.global.NoSymbol">NoSymbol</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1109453" title="Macros.this.global.Symbol">wannabe</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; Macros.this.global.Type">tpe</a> <a href="../../../reflect/internal/Types.scala.html#442058" title="(that: Macros.this.global.Type)Boolean">&lt;:&lt;</a> <a href="../../../reflect/internal/Definitions.scala.html#441641" title="Macros.this.global.definitions.type">definitions</a>.<a href="../../../reflect/internal/Definitions.scala.html#442424" title="=&gt; Macros.this.global.ClassSymbol">MacroContextClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443721" title="=&gt; Macros.this.global.Type">tpe</a><span class="delimiter">)</span> <a href="#1109453" title="Macros.this.global.Symbol">wannabe</a> <span class="keyword">else</span> <a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; Macros.this.global.NoSymbol">NoSymbol</a>

    <span class="keyword">val</span> <a title="List[Macros.this.global.Symbol]" id="1109455">lastParamList0</a> = <a href="#1109450" title="List[List[Macros.this.global.Symbol]]">paramss</a>.<a href="../../../collection/TraversableLike.scala.html#59014" title="=&gt; Option[List[Macros.this.global.Symbol]]">lastOption</a> <a href="../../../Option.scala.html#63814" title="(default: =&gt; List[Macros.this.global.Symbol])List[Macros.this.global.Symbol]">getOrElse</a> <a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type">Nil</a>
    <span class="keyword">val</span> <a title="List[Macros.this.global.Symbol]" id="1109456">lastParamList</a> = <a href="#1109455" title="List[Macros.this.global.Symbol]">lastParamList0</a> <a href="../../../collection/TraversableLike.scala.html#58976" title="(f: Macros.this.global.Symbol =&gt; scala.collection.GenTraversableOnce[Macros.this.global.Symbol])(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Symbol],Macros.this.global.Symbol,List[Macros.this.global.Symbol]])List[Macros.this.global.Symbol]">flatMap</a> <span class="delimiter">(</span>param =&gt; <a href="#1109505" title="Macros.this.global.Symbol">param</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; Macros.this.global.Type">tpe</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> TypeRef<a href="#1109579" title="List[Macros.this.global.Symbol]" id="1109583" class="delimiter">(</a>SingleType<a title="List[Macros.this.global.Symbol]" id="1109586" class="delimiter">(</a><a href="../../../reflect/internal/Types.scala.html#441258" title="List[Macros.this.global.Symbol]" id="1109591">NoPrefix</a>, contextParam<span class="delimiter">)</span>, sym, <a href="../../../collection/generic/SeqFactory.scala.html#60838" title="Option[List[Macros.this.global.Type]]" id="1109603">List</a><span class="delimiter">(</span>tparam<span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
        <span class="keyword">var</span> <a title="Macros.this.global.Symbol" id="1109531">wannabe</a> = sym
        <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#1109531" title="Macros.this.global.Symbol">wannabe</a>.<a href="../../../reflect/internal/Symbols.scala.html#443232" title="=&gt; Boolean">isAliasType</a><span class="delimiter">)</span> <a href="#1109531" title="Macros.this.global.Symbol">wannabe</a> = <a href="#1109531" title="Macros.this.global.Symbol">wannabe</a>.<a href="../../../reflect/internal/Symbols.scala.html#443427" title="=&gt; Macros.this.global.Type">info</a>.<a href="../../../reflect/internal/Types.scala.html#441986" title="=&gt; Macros.this.global.Symbol">typeSymbol</a>
        <span title="List[Macros.this.global.Symbol]" class="keyword">if</span> <span class="delimiter">(</span><a href="#1109531" title="Macros.this.global.Symbol">wannabe</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../../reflect/internal/Definitions.scala.html#441641" title="Macros.this.global.definitions.type">definitions</a>.<a href="../../../reflect/internal/Definitions.scala.html#442411" title="=&gt; Macros.this.global.ClassSymbol">TypeTagClass</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1109531" title="Macros.this.global.Symbol">wannabe</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../../reflect/internal/Definitions.scala.html#441641" title="Macros.this.global.definitions.type">definitions</a>.<a href="../../../reflect/internal/Definitions.scala.html#442415" title="=&gt; Macros.this.global.ClassSymbol">ConcreteTypeTagClass</a><span class="delimiter">)</span>
          <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: Macros.this.global.Symbol*)List[Macros.this.global.Symbol]">List</a><span class="delimiter">(</span><a href="#1109505" title="Macros.this.global.Symbol">param</a><span class="delimiter">)</span>
        <span class="keyword">else</span>
          <a href="../../../Function2.scala.html#65847" title="(v1: Macros.this.global.Symbol, v2: Macros.this.global.Symbol)Option[Macros.this.global.Symbol]">transform</a><span class="delimiter">(</span><a href="#1109505" title="Macros.this.global.Symbol">param</a>, tparam.<a href="../../../reflect/internal/Types.scala.html#441986" title="=&gt; Macros.this.global.Symbol">typeSymbol</a><span class="delimiter">)</span> <a href="../../../Option.scala.html#63820" title="(f: Macros.this.global.Symbol =&gt; List[Macros.this.global.Symbol])Option[List[Macros.this.global.Symbol]]">map</a> <span class="delimiter">(</span><a href="#1109558" title="Macros.this.global.Symbol">_</a> <a href="../../../collection/immutable/List.scala.html#63643" title="(x: Macros.this.global.Symbol)List[Macros.this.global.Symbol]">::</a> <a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span> <a href="../../../Option.scala.html#63814" title="(default: =&gt; List[Macros.this.global.Symbol])List[Macros.this.global.Symbol]">getOrElse</a> <a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type">Nil</a>
      <span class="keyword">case</span> _ =&gt;
        <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: Macros.this.global.Symbol*)List[Macros.this.global.Symbol]">List</a><a href="#1109592" title="(x: List[Macros.this.global.Symbol])List[Macros.this.global.Symbol]" class="delimiter">(</a><a href="#1109505" title="Macros.this.global.Symbol">param</a><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>

    <span class="keyword">var</span> <a title="List[List[Macros.this.global.Symbol]]" id="1109457">result</a> = <a href="#1109450" title="List[List[Macros.this.global.Symbol]]">paramss</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76188" title="(n: Int)List[List[Macros.this.global.Symbol]]">dropRight</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <a href="../../../collection/SeqLike.scala.html#59810" title="(elem: List[Macros.this.global.Symbol])(implicit bf: scala.collection.generic.CanBuildFrom[List[List[Macros.this.global.Symbol]],List[Macros.this.global.Symbol],List[List[Macros.this.global.Symbol]]])List[List[Macros.this.global.Symbol]]">:+</a> <a href="#1109456" title="List[Macros.this.global.Symbol]">lastParamList</a>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1109455" title="List[Macros.this.global.Symbol]">lastParamList0</a>.<a href="../../../collection/IterableLike.scala.html#59464" title="=&gt; Boolean">isEmpty</a> <a href="../../../Boolean.scala.html#58728" title="(x: Boolean)Boolean">^</a> <a href="#1109456" title="List[Macros.this.global.Symbol]">lastParamList</a>.<a href="../../../collection/IterableLike.scala.html#59464" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#1109457" title="List[List[Macros.this.global.Symbol]]">result</a> = <a href="#1109457" title="List[List[Macros.this.global.Symbol]]">result</a> <a href="../../../collection/LinearSeqOptimized.scala.html#76188" title="(n: Int)List[List[Macros.this.global.Symbol]]">dropRight</a> <span title="Int(1)" class="int">1</span>
    <span class="delimiter">}</span>

    <a href="#1109457" title="List[List[Macros.this.global.Symbol]]">result</a>
  <span class="delimiter">}</span>

  /** As specified above, body of a macro definition must reference its implementation.
   *  This function verifies that the body indeed refers to a method, and that
   *  the referenced macro implementation is compatible with the given macro definition.
   *
   *  This means that macro implementation (fooBar in example above) must:
   *    1) Refer to a statically accessible, non-overloaded method.
   *    2) Have the right parameter lists as outlined in the SIP / in the doc comment of this class.
   *
   *  @return typechecked rhs of the given macro definition
   */
  <span class="keyword">def</span> <a title="(typer: Macros.this.Typer, ddef: Macros.this.global.DefDef)Macros.this.global.Tree" id="560429">typedMacroBody</a><span class="delimiter">(</span><a title="Macros.this.Typer" id="1109703">typer</a>: <a href="Typers.scala.html#560207" title="Macros.this.Typer">Typer</a>, <a title="Macros.this.global.DefDef" id="1109704">ddef</a>: <a href="../../../reflect/api/Trees.scala.html#23598" title="Macros.this.global.DefDef">DefDef</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#1109703" title="Macros.this.Typer">typer</a>.context
    <a href="../../../reflect/makro/util/Traces.scala.html#559471" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;typechecking macro def %s at %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1109704" title="Macros.this.global.DefDef">ddef</a>.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; Macros.this.global.Symbol">symbol</a>, <a href="#1109704" title="Macros.this.global.DefDef">ddef</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; Macros.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1109703" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#1109736" title="() =&gt; String" id="1109747">checkFeature</a><span class="delimiter">(</span><a href="#1109704" title="Macros.this.global.DefDef">ddef</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="Macros.this.global.Position" id="1109744">pos</a>, <a href="../../../reflect/internal/Definitions.scala.html#442711" title="Macros.this.global.Symbol" id="1109745">MacrosFeature</a>, immediate = <a title="Boolean(true)" id="1109746" class="keyword">true</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#1109704" title="Macros.this.global.DefDef">ddef</a>.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; Macros.this.global.Symbol">symbol</a> <a href="../../../reflect/internal/Symbols.scala.html#443305" title="(mask: Long)Macros.this.global.Symbol">setFlag</a> <span title="Long(4294967296L)">IS_ERROR</span>
      <span title="Nothing" class="keyword">return</span> <a href="../../../reflect/api/Trees.scala.html#23577" title="Macros.this.global.EmptyTree.type">EmptyTree</a>
    <span class="delimiter">}</span>

    <span class="keyword">implicit</span> <span class="keyword">class</span> <a title="class AugmentedString extends Object" id="1109708">AugmentedString</a><a href="#1109708" title="AugmentedString" class="delimiter">(</a><a title="String" id="1109723">s</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="=&gt; String" id="1109727">abbreviateCoreAliases</a>: <span title="String">String</span> = <span class="delimiter">{</span> // hack!
        <span class="keyword">var</span> <a title="String" id="1109755">result</a> = <a href="#1109723" title="String">s</a>
        <a href="#1109755" title="String">result</a> = <a href="#1109755" title="String">result</a>.<span title="(x$1: CharSequence, x$2: CharSequence)String">replace</span><span class="delimiter">(</span><span title="String(&quot;c.mirror.TypeTag&quot;)" class="string">&quot;c.mirror.TypeTag&quot;</span>, <span title="String(&quot;c.TypeTag&quot;)" class="string">&quot;c.TypeTag&quot;</span><span class="delimiter">)</span>
        <a href="#1109755" title="String">result</a> = <a href="#1109755" title="String">result</a>.<span title="(x$1: CharSequence, x$2: CharSequence)String">replace</span><span class="delimiter">(</span><span title="String(&quot;c.mirror.Expr&quot;)" class="string">&quot;c.mirror.Expr&quot;</span>, <span title="String(&quot;c.Expr&quot;)" class="string">&quot;c.Expr&quot;</span><span class="delimiter">)</span>
        <a href="#1109755" title="String">result</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">var</span> <a title="Boolean" id="1109709">hasErrors</a> = <span title="Boolean(false)" class="keyword">false</span>
    <span class="keyword">def</span> <a title="(pos: Macros.this.global.Position, msg: String)Unit" id="1109710">reportError</a><span class="delimiter">(</span><a title="Macros.this.global.Position" id="1109764">pos</a>: <a href="../util/Position.scala.html#52230" title="Macros.this.global.Position">Position</a>, <a title="String" id="1109765">msg</a>: <span title="String">String</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="#1109709" title="Boolean">hasErrors</a> = <span title="Boolean(true)" class="keyword">true</span>
      <a href="Typers.scala.html#560636" title="=&gt; Macros.this.Context">context</a>.<a href="Contexts.scala.html#560985" title="(pos: Macros.this.global.Position, msg: String)Unit">error</a><span class="delimiter">(</span><a href="#1109764" title="Macros.this.global.Position">pos</a>, <a href="#1109765" title="String">msg</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="1109711">macroDef</a> = <a href="#1109704" title="Macros.this.global.DefDef">ddef</a>.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; Macros.this.global.Symbol">symbol</a>
    <span class="keyword">val</span> <a title="Macros.this.global.Position" id="1109712">defpos</a> = <a href="#1109711" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#443167" title="=&gt; Macros.this.global.Position">pos</a>
    <span class="keyword">val</span> <a title="Macros.this.global.Position" id="1109713">implpos</a> = <a href="#1109704" title="Macros.this.global.DefDef">ddef</a>.<a href="../../../reflect/api/Trees.scala.html#427506" title="=&gt; Macros.this.global.Tree">rhs</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; Macros.this.global.Position">pos</a>
    <a href="../Global.scala.html#559533" title="(assertion: Boolean, message: =&gt; Any)Unit">assert</a><span class="delimiter">(</span><a href="#1109711" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#443278" title="=&gt; Boolean">isTermMacro</a>, <a href="#1109704" title="Macros.this.global.DefDef">ddef</a><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="()Unit" id="1109714">invalidBodyError</a><span class="delimiter">(</span><span class="delimiter">)</span> =
      <a href="#1109710" title="(pos: Macros.this.global.Position, msg: String)Unit">reportError</a><span class="delimiter">(</span><a href="#1109712" title="Macros.this.global.Position">defpos</a>,
        <span class="string">&quot;macro body has wrong shape:&quot;</span> +
        <span class="string">&quot;\n required: macro &lt;reference to implementation object&gt;.&lt;implementation method name&gt;&quot;</span> <span title="String(&quot;macro body has wrong shape:\n required: macro &lt;reference to implementation object&gt;.&lt;implementation method name&gt;\n or      : macro &lt;implementation method name&gt;&quot;)">+</span>
        <span class="string">&quot;\n or      : macro &lt;implementation method name&gt;&quot;</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(rhs: Macros.this.global.Tree)Unit" id="1109715">validatePreTyper</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1109777">rhs</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../Unit.scala.html#2389" title="Unit">Unit</a> = <a href="#1109777" title="Macros.this.global.Tree">rhs</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      // we do allow macro invocations inside macro bodies
      // personally I don't mind if pre-typer tree is a macro invocation
      // that later resolves to a valid reference to a macro implementation
      // however, I don't think that invalidBodyError() should hint at that
      // let this be an Easter Egg :)
      <span class="keyword">case</span> Apply<a href="#1109819" title="Unit" id="1109823" class="delimiter">(</a>_, _<span class="delimiter">)</span> =&gt; ;
      <span class="keyword">case</span> TypeApply<a href="#1109819" title="Unit" id="1109827" class="delimiter">(</a>_, _<span class="delimiter">)</span> =&gt; ;
      <span class="keyword">case</span> Super<a href="#1109819" title="Unit" id="1109831" class="delimiter">(</a>_, _<span class="delimiter">)</span> =&gt; ;
      <span class="keyword">case</span> This<a href="#1109819" title="Unit" id="1109834" class="delimiter">(</a>_<span class="delimiter">)</span> =&gt; ;
      <span class="keyword">case</span> Ident<a href="#1109819" title="Unit" id="1109837" class="delimiter">(</a>_<span class="delimiter">)</span> =&gt; ;
      <span class="keyword">case</span> Select<a href="#1109819" title="Unit" id="1109841" class="delimiter">(</a>_, _<span class="delimiter">)</span> =&gt; ;
      <span class="keyword">case</span> _ =&gt; <a href="#1109714" title="()Unit">invalidBodyError</a><a href="#1109842" title="(x: Unit)Unit" class="delimiter">(</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="(rhs1: Macros.this.global.Tree)Unit" id="1109716">validatePostTyper</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1109852">rhs1</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../Unit.scala.html#2389" title="Unit">Unit</a> = <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(tree: Macros.this.global.Tree)Unit" id="1109853">loop</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1109854">tree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../Unit.scala.html#2389" title="Unit">Unit</a> = <span class="delimiter">{</span>
        <span class="keyword">def</span> <a title="()Unit" id="1109855">errorNotStatic</a><span class="delimiter">(</span><span class="delimiter">)</span> =
          <a href="#1109710" title="(pos: Macros.this.global.Position, msg: String)Unit">reportError</a><span class="delimiter">(</span><a href="#1109713" title="Macros.this.global.Position">implpos</a>, <span title="String(&quot;macro implementation must be in statically accessible object&quot;)" class="string">&quot;macro implementation must be in statically accessible object&quot;</span><span class="delimiter">)</span>

        <span class="keyword">def</span> <a title="(sym: Macros.this.global.Symbol)Unit" id="1109856">ensureRoot</a><span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1109858">sym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="Macros.this.global.Symbol">Symbol</a><span class="delimiter">)</span> =
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1109858" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443270" title="=&gt; Boolean">isModule</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1109858" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443245" title="=&gt; Boolean">isModuleClass</a><span class="delimiter">)</span> <a href="#1109855" title="()Unit">errorNotStatic</a><span class="delimiter">(</span><span class="delimiter">)</span>

        <span class="keyword">def</span> <a title="(sym: Macros.this.global.Symbol)Unit" id="1109857">ensureModule</a><span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1109859">sym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="Macros.this.global.Symbol">Symbol</a><span class="delimiter">)</span> =
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1109859" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443270" title="=&gt; Boolean">isModule</a><span class="delimiter">)</span> <a href="#1109855" title="()Unit">errorNotStatic</a><span class="delimiter">(</span><span class="delimiter">)</span>

        <a href="#1109854" title="Macros.this.global.Tree">tree</a> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> TypeApply<a href="#1109902" title="Unit" id="1109905" class="delimiter">(</a>fun, _<span class="delimiter">)</span> =&gt;
            <a href="#1109853" title="(tree: Macros.this.global.Tree)Unit">loop</a><a href="#1109922" title="(x: Unit)Unit" class="delimiter">(</a>fun<span class="delimiter">)</span>
          <span class="keyword">case</span> Super<a href="#1109902" title="Unit" id="1109908" class="delimiter">(</a>qual, _<span class="delimiter">)</span> =&gt;
            <a href="#1109856" title="(sym: Macros.this.global.Symbol)Unit">ensureRoot</a><span class="delimiter">(</span><a href="#1109711" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; Macros.this.global.Symbol">owner</a><span class="delimiter">)</span>
            <a href="#1109853" title="(tree: Macros.this.global.Tree)Unit">loop</a><span class="delimiter">(</span>qual<span class="delimiter">)</span>
          <span class="keyword">case</span> This<a href="#1109902" title="Unit" id="1109911" class="delimiter">(</a>_<span class="delimiter">)</span> =&gt;
            <a href="#1109856" title="(sym: Macros.this.global.Symbol)Unit">ensureRoot</a><a href="#1109922" title="(x: Unit)Unit" class="delimiter">(</a><a href="#1109854" title="Macros.this.global.Tree">tree</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Macros.this.global.Symbol">symbol</a><span class="delimiter">)</span>
          <span class="keyword">case</span> Select<a href="#1109902" title="Boolean" id="1109913" class="delimiter">(</a>qual, name<span class="delimiter">)</span> <span class="keyword">if</span> name.<a href="../../../reflect/internal/Names.scala.html#444125" title="=&gt; Boolean">isTypeName</a> =&gt;
            <a href="#1109853" title="(tree: Macros.this.global.Tree)Unit">loop</a><a href="#1109922" title="(x: Unit)Unit" class="delimiter">(</a>qual<span class="delimiter">)</span>
          <span class="keyword">case</span> Select<span class="delimiter">(</span>qual, name<span class="delimiter">)</span> <span class="keyword">if</span> name.<a href="../../../reflect/internal/Names.scala.html#444124" title="=&gt; Boolean">isTermName</a> =&gt;
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1109854" title="Macros.this.global.Tree">tree</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Macros.this.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#1109852" title="Macros.this.global.Tree">rhs1</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Macros.this.global.Symbol">symbol</a><span class="delimiter">)</span> <a href="#1109857" title="(sym: Macros.this.global.Symbol)Unit">ensureModule</a><span class="delimiter">(</span><a href="#1109854" title="Macros.this.global.Tree">tree</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Macros.this.global.Symbol">symbol</a><span class="delimiter">)</span>
            <a href="#1109853" title="(tree: Macros.this.global.Tree)Unit">loop</a><span class="delimiter">(</span>qual<span class="delimiter">)</span>
          <span class="keyword">case</span> Ident<a href="#1109902" title="Boolean" id="1109917" class="delimiter">(</a>name<span class="delimiter">)</span> <span class="keyword">if</span> name.<a href="../../../reflect/internal/Names.scala.html#444125" title="=&gt; Boolean">isTypeName</a> =&gt;
            ;
          <span class="keyword">case</span> Ident<span class="delimiter">(</span>name<span class="delimiter">)</span> <span class="keyword">if</span> name.<a href="../../../reflect/internal/Names.scala.html#444124" title="=&gt; Boolean">isTermName</a> =&gt;
            <a href="#1109922" title="(x: Unit)Unit" class="keyword">if</a> <span class="delimiter">(</span><a href="#1109854" title="Macros.this.global.Tree">tree</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Macros.this.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#1109852" title="Macros.this.global.Tree">rhs1</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Macros.this.global.Symbol">symbol</a><span class="delimiter">)</span> <a href="#1109857" title="(sym: Macros.this.global.Symbol)Unit">ensureModule</a><span class="delimiter">(</span><a href="#1109854" title="Macros.this.global.Tree">tree</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Macros.this.global.Symbol">symbol</a><span class="delimiter">)</span>
          <span class="keyword">case</span> _ =&gt;
            <a href="#1109714" title="()Unit">invalidBodyError</a><a href="#1109922" title="(x: Unit)Unit" class="delimiter">(</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <a href="#1109853" title="(tree: Macros.this.global.Tree)Unit">loop</a><span class="delimiter">(</span><a href="#1109852" title="Macros.this.global.Tree">rhs1</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="Macros.this.global.Tree" id="1109717">rhs</a> = <a href="#1109704" title="Macros.this.global.DefDef">ddef</a>.<a href="../../../reflect/api/Trees.scala.html#427506" title="=&gt; Macros.this.global.Tree">rhs</a>
    <a href="#1109715" title="(rhs: Macros.this.global.Tree)Unit">validatePreTyper</a><span class="delimiter">(</span><a href="#1109717" title="Macros.this.global.Tree">rhs</a><span class="delimiter">)</span>
    <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#1109709" title="Boolean">hasErrors</a><span class="delimiter">)</span> <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: Macros.this.global.Symbol)Macros.this.global.Symbol">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;macro def failed to satisfy trivial preconditions: &quot;)" class="string">&quot;macro def failed to satisfy trivial preconditions: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1109711" title="Macros.this.global.Symbol">macroDef</a><span class="delimiter">)</span>

    // we use typed1 instead of typed, because otherwise adapt is going to mess us up
    // if adapt sees &lt;qualifier&gt;.&lt;method&gt;, it will want to perform eta-expansion and will fail
    // unfortunately, this means that we have to manually trigger macro expansion
    // because it's adapt which is responsible for automatic expansion during typechecking
    <span class="keyword">def</span> <a title="(rhs: Macros.this.global.Tree)Macros.this.global.Tree" id="1109718">typecheckRhs</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1109945">rhs</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Int" id="1109946">prevNumErrors</a> = <a href="../Global.scala.html#559481" title="=&gt; scala.tools.nsc.reporters.Reporter">reporter</a>.<a href="../reporters/Reporter.scala.html#467848" title="=&gt; scala.tools.nsc.reporters.Reporter#Severity">ERROR</a>.<a href="../reporters/Reporter.scala.html#467968" title="=&gt; Int">count</a> // [Eugene] funnily enough, the isErroneous check is not enough
        <span class="keyword">var</span> <a title="Macros.this.global.Tree" id="1109947">rhs1</a> = <span title="Macros.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#1109709" title="Boolean">hasErrors</a><span class="delimiter">)</span> <a href="../../../reflect/api/Trees.scala.html#23577" title="Macros.this.global.EmptyTree.type">EmptyTree</a> <span class="keyword">else</span> <a href="#1109703" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#560764" title="(tree: Macros.this.global.Tree, mode: Int, pt: Macros.this.global.Type)Macros.this.global.Tree">typed1</a><span class="delimiter">(</span><a href="#1109945" title="Macros.this.global.Tree">rhs</a>, <span title="Int(1)">EXPRmode</span>, <a href="../../../reflect/internal/Types.scala.html#441251" title="Macros.this.global.WildcardType.type">WildcardType</a><span class="delimiter">)</span>
        <span class="keyword">def</span> <a title="=&gt; Boolean" id="1109948">typecheckedWithErrors</a> = <span class="delimiter">(</span><a href="#1109947" title="Macros.this.global.Tree">rhs1</a> <a href="../../../reflect/api/Trees.scala.html#425081" title="(p: Macros.this.global.Tree =&gt; Boolean)Boolean">exists</a> <span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#441814" title="implicit scala.reflect.internal.Trees.TreeOps : (tree: Macros.this.global.Tree)Macros.this.global.TreeOps">_</a>.<a href="../../../reflect/internal/Trees.scala.html#443953" title="=&gt; Boolean">isErroneous</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <a href="../Global.scala.html#559481" title="=&gt; scala.tools.nsc.reporters.Reporter">reporter</a>.<a href="../reporters/Reporter.scala.html#467848" title="=&gt; scala.tools.nsc.reporters.Reporter#Severity">ERROR</a>.<a href="../reporters/Reporter.scala.html#467968" title="=&gt; Int">count</a> <a href="../../../Int.scala.html#57898" title="(x: Int)Boolean">!=</a> <a href="#1109946" title="Int">prevNumErrors</a>
        <span class="keyword">def</span> <a title="=&gt; Boolean" id="1109949">rhsNeedsMacroExpansion</a> = <a href="#1109947" title="Macros.this.global.Tree">rhs1</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Macros.this.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1109947" title="Macros.this.global.Tree">rhs1</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Macros.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443278" title="=&gt; Boolean">isTermMacro</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1109947" title="Macros.this.global.Tree">rhs1</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Macros.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443318" title="=&gt; Boolean">isErroneous</a>
        <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1109948" title="=&gt; Boolean">typecheckedWithErrors</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1109949" title="=&gt; Boolean">rhsNeedsMacroExpansion</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#1109947" title="Macros.this.global.Tree">rhs1</a> = <a href="#560461" title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree)Macros.this.MacroExpansionResult">macroExpand1</a><a href="#1119910" title="=&gt; Macros.this.global.Tree" class="delimiter">(</a><a href="#1109703" title="Macros.this.Typer">typer</a>, <a href="#1109947" title="Macros.this.global.Tree">rhs1</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> Success<a href="#1110062" title="Macros.this.global.Tree" id="1110063" class="delimiter">(</a>expanded<span class="delimiter">)</span> =&gt;
              <a href="#1110066" title="(x: Macros.this.global.Tree)Macros.this.global.Tree" class="keyword">try</a> <span class="delimiter">{</span>
                <span class="keyword">val</span> <a title="Macros.this.global.Tree" id="1110002">typechecked</a> = <a href="#1109703" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#560764" title="(tree: Macros.this.global.Tree, mode: Int, pt: Macros.this.global.Type)Macros.this.global.Tree">typed1</a><span class="delimiter">(</span>expanded, <span title="Int(1)">EXPRmode</span>, <a href="../../../reflect/internal/Types.scala.html#441251" title="Macros.this.global.WildcardType.type">WildcardType</a><span class="delimiter">)</span>
                <a href="../../../reflect/makro/util/Traces.scala.html#559471" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;typechecked1:%n%s%n%s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1110002" title="Macros.this.global.Tree">typechecked</a>, <a href="../../../reflect/api/TreePrinters.scala.html#23837" title="(tree: Macros.this.global.Tree)String">showRaw</a><span class="delimiter">(</span><a href="#1110002" title="Macros.this.global.Tree">typechecked</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                <a href="#1110002" title="Macros.this.global.Tree">typechecked</a>
              <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
                <a href="#560442" title="(x$1: List[scala.reflect.makro.runtime.Context])Unit">openMacros</a> = <a href="#560442" title="=&gt; List[scala.reflect.makro.runtime.Context]">openMacros</a>.<a href="../../../collection/TraversableLike.scala.html#59012" title="=&gt; List[scala.reflect.makro.runtime.Context]">tail</a>
              <span class="delimiter">}</span>
            <span class="keyword">case</span> Fallback<a href="#1110062" title="Macros.this.global.Tree" id="1110064" class="delimiter">(</a>fallback<span class="delimiter">)</span> =&gt;
              <a href="#1109703" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#560764" title="(tree: Macros.this.global.Tree, mode: Int, pt: Macros.this.global.Type)Macros.this.global.Tree">typed1</a><a href="#1110066" title="(x: Macros.this.global.Tree)Macros.this.global.Tree" class="delimiter">(</a>fallback, <span title="Int(1)">EXPRmode</span>, <a href="../../../reflect/internal/Types.scala.html#441251" title="Macros.this.global.WildcardType.type">WildcardType</a><span class="delimiter">)</span>
            <span class="keyword">case</span> Other<a href="#1110062" title="Macros.this.global.Tree" id="1110065" class="delimiter">(</a>result<span class="delimiter">)</span> =&gt;
              <a href="#1110066" title="(x: Macros.this.global.Tree)Macros.this.global.Tree">result</a>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        <a href="#1109947" title="Macros.this.global.Tree">rhs1</a>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Macros.this.global.Tree" id="1110072">ex</a>: <a href="../../../reflect/internal/Types.scala.html#441578" title="Macros.this.global.TypeError">TypeError</a> =&gt;
          <a href="#1109703" title="Macros.this.Typer">typer</a>.<a href="TypeDiagnostics.scala.html#560619" title="(context0: Macros.this.Context, pos: Macros.this.global.Position, ex: Macros.this.global.TypeError)Unit">reportTypeError</a><span class="delimiter">(</span><a href="Typers.scala.html#560636" title="=&gt; Macros.this.Context">context</a>, <a href="#1109945" title="Macros.this.global.Tree">rhs</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; Macros.this.global.Position">pos</a>, <a href="#1110072" title="Macros.this.global.TypeError">ex</a><span class="delimiter">)</span>
          <a href="#1109703" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#560626" title="=&gt; Macros.this.Inferencer">infer</a>.<a href="Infer.scala.html#562625" title="(tree: Macros.this.global.Tree)Macros.this.global.Tree">setError</a><span class="delimiter">(</span><a href="#1109945" title="Macros.this.global.Tree">rhs</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="Int" id="1109719">prevNumErrors</a> = <a href="../Global.scala.html#559481" title="=&gt; scala.tools.nsc.reporters.Reporter">reporter</a>.<a href="../reporters/Reporter.scala.html#467848" title="=&gt; scala.tools.nsc.reporters.Reporter#Severity">ERROR</a>.<a href="../reporters/Reporter.scala.html#467968" title="=&gt; Int">count</a> // funnily enough, the isErroneous check is not enough
    <span class="keyword">var</span> <a title="Macros.this.global.Tree" id="1109720">rhs1</a> = <a href="#1109718" title="(rhs: Macros.this.global.Tree)Macros.this.global.Tree">typecheckRhs</a><span class="delimiter">(</span><a href="#1109717" title="Macros.this.global.Tree">rhs</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="=&gt; Boolean" id="1109721">typecheckedWithErrors</a> = <span class="delimiter">(</span><a href="#1109720" title="Macros.this.global.Tree">rhs1</a> <a href="../../../reflect/api/Trees.scala.html#425081" title="(p: Macros.this.global.Tree =&gt; Boolean)Boolean">exists</a> <span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#441814" title="implicit scala.reflect.internal.Trees.TreeOps : (tree: Macros.this.global.Tree)Macros.this.global.TreeOps">_</a>.<a href="../../../reflect/internal/Trees.scala.html#443953" title="=&gt; Boolean">isErroneous</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <a href="../Global.scala.html#559481" title="=&gt; scala.tools.nsc.reporters.Reporter">reporter</a>.<a href="../reporters/Reporter.scala.html#467848" title="=&gt; scala.tools.nsc.reporters.Reporter#Severity">ERROR</a>.<a href="../reporters/Reporter.scala.html#467968" title="=&gt; Int">count</a> <a href="../../../Int.scala.html#57898" title="(x: Int)Boolean">!=</a> <a href="#1109719" title="Int">prevNumErrors</a>
    <a href="#1109709" title="Boolean">hasErrors</a> = <a href="#1109709" title="Boolean">hasErrors</a> <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <a href="#1109721" title="=&gt; Boolean">typecheckedWithErrors</a>
    <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#1109721" title="=&gt; Boolean">typecheckedWithErrors</a><span class="delimiter">)</span> <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: Macros.this.global.DefDef)Macros.this.global.DefDef">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;body of a macro def failed to typecheck: &quot;)" class="string">&quot;body of a macro def failed to typecheck: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1109704" title="Macros.this.global.DefDef">ddef</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="1109722">macroImpl</a> = <a href="#1109720" title="Macros.this.global.Tree">rhs1</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Macros.this.global.Symbol">symbol</a>
    <a href="#1109711" title="Macros.this.global.Symbol">macroDef</a> <a href="../../../reflect/internal/AnnotationInfos.scala.html#442129" title="(annot: Macros.this.global.AnnotationInfo)Macros.this.global.Symbol">withAnnotation</a> <a href="../../../reflect/internal/AnnotationInfos.scala.html#443059" title="(atp: Macros.this.global.Type, args: List[Macros.this.global.Tree], assocs: List[(Macros.this.global.Name, Macros.this.global.ClassfileAnnotArg)])Macros.this.global.AnnotationInfo">AnnotationInfo</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#442430" title="=&gt; Macros.this.global.ClassSymbol">MacroImplAnnotation</a>.<a href="../../../reflect/internal/Symbols.scala.html#443721" title="=&gt; Macros.this.global.Type">tpe</a>, <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: Macros.this.global.Tree*)List[Macros.this.global.Tree]">List</a><span class="delimiter">(</span><a href="#1109720" title="Macros.this.global.Tree">rhs1</a><span class="delimiter">)</span>, <a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type">Nil</a><span class="delimiter">)</span>
    <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1109709" title="Boolean">hasErrors</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1109722" title="Macros.this.global.Symbol">macroImpl</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
         <a href="#1109714" title="()Unit">invalidBodyError</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1109722" title="Macros.this.global.Symbol">macroImpl</a>.<a href="../../../reflect/internal/Symbols.scala.html#443282" title="=&gt; Boolean">isMethod</a><span class="delimiter">)</span>
           <a href="#1109714" title="()Unit">invalidBodyError</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1109722" title="Macros.this.global.Symbol">macroImpl</a>.<a href="../../../reflect/internal/Symbols.scala.html#443271" title="=&gt; Boolean">isOverloaded</a><span class="delimiter">)</span>
          <a href="#1109710" title="(pos: Macros.this.global.Position, msg: String)Unit">reportError</a><span class="delimiter">(</span><a href="#1109713" title="Macros.this.global.Position">implpos</a>, <span title="String(&quot;macro implementation cannot be overloaded&quot;)" class="string">&quot;macro implementation cannot be overloaded&quot;</span><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1109722" title="Macros.this.global.Symbol">macroImpl</a>.<a href="../../../reflect/internal/Symbols.scala.html#443447" title="=&gt; List[Macros.this.global.Symbol]">typeParams</a>.<a href="../../../collection/IterableLike.scala.html#59464" title="=&gt; Boolean">isEmpty</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1109720" title="Macros.this.global.Tree">rhs1</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="../../../reflect/api/Trees.scala.html#23684" title="Macros.this.global.TypeApply">TypeApply</a><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#1109710" title="(pos: Macros.this.global.Position, msg: String)Unit">reportError</a><span class="delimiter">(</span><a href="#1109713" title="Macros.this.global.Position">implpos</a>, <span title="String(&quot;macro implementation reference needs type arguments&quot;)" class="string">&quot;macro implementation reference needs type arguments&quot;</span><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1109709" title="Boolean">hasErrors</a><span class="delimiter">)</span>
          <a href="#1109716" title="(rhs1: Macros.this.global.Tree)Unit">validatePostTyper</a><span class="delimiter">(</span><a href="#1109720" title="Macros.this.global.Tree">rhs1</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#1109709" title="Boolean">hasErrors</a><span class="delimiter">)</span>
        <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: Macros.this.global.Symbol)Macros.this.global.Symbol">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;macro def failed to satisfy trivial preconditions: &quot;)" class="string">&quot;macro def failed to satisfy trivial preconditions: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1109711" title="Macros.this.global.Symbol">macroDef</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1109709" title="Boolean">hasErrors</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(reqparamss: List[List[Macros.this.global.Symbol]], actparamss: List[List[Macros.this.global.Symbol]], reqres: Macros.this.global.Type, actres: Macros.this.global.Type)List[String]" id="1110137">checkCompatibility</a><span class="delimiter">(</span><a title="List[List[Macros.this.global.Symbol]]" id="1110145">reqparamss</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[List[Macros.this.global.Symbol]]">List</a><span class="delimiter">[</span>List<span class="delimiter">[</span>Symbol<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="List[List[Macros.this.global.Symbol]]" id="1110146">actparamss</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[List[Macros.this.global.Symbol]]">List</a><span class="delimiter">[</span>List<span class="delimiter">[</span>Symbol<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="Macros.this.global.Type" id="1110147">reqres</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="Macros.this.global.Type">Type</a>, <a title="Macros.this.global.Type" id="1110148">actres</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="Macros.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[String]">List</a><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span class="delimiter">{</span>
        <span class="keyword">var</span> <a title="Boolean" id="1110149">hasErrors</a> = <span title="Boolean(false)" class="keyword">false</span>
        <span class="keyword">var</span> <a title="List[String]" id="1110150">errors</a> = List<span class="delimiter">[</span>String<span class="delimiter">]</span><a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type" class="delimiter">(</a><span class="delimiter">)</span>
        <span class="keyword">def</span> <a title="(msg: String)Unit" id="1110151">compatibilityError</a><span class="delimiter">(</span><a title="String" id="1110163">msg</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#1110149" title="Boolean">hasErrors</a> = <span title="Boolean(true)" class="keyword">true</span>
          <a href="#1110150" title="List[String]">errors</a> <a href="../../../collection/SeqLike.scala.html#59810" title="(elem: String)(implicit bf: scala.collection.generic.CanBuildFrom[List[String],String,List[String]])List[String]">:+=</a> <a href="#1110163" title="String">msg</a>
        <span class="delimiter">}</span>

        <span class="keyword">val</span> <a title="List[Macros.this.global.Symbol]" id="1110152">flatreqparams</a> = <a href="#1110145" title="List[List[Macros.this.global.Symbol]]">reqparamss</a>.<a href="../../../collection/generic/GenericTraversableTemplate.scala.html#59386" title="(implicit asTraversable: List[Macros.this.global.Symbol] =&gt; scala.collection.GenTraversableOnce[Macros.this.global.Symbol])List[Macros.this.global.Symbol]">flatten</a>
        <span class="keyword">val</span> <a title="List[Macros.this.global.Symbol]" id="1110153">flatactparams</a> = <a href="#1110146" title="List[List[Macros.this.global.Symbol]]">actparamss</a>.<a href="../../../collection/generic/GenericTraversableTemplate.scala.html#59386" title="(implicit asTraversable: List[Macros.this.global.Symbol] =&gt; scala.collection.GenTraversableOnce[Macros.this.global.Symbol])List[Macros.this.global.Symbol]">flatten</a>
        <span class="keyword">val</span> <a title="List[Macros.this.global.Symbol]" id="1110154">tparams</a> = <a href="#1109722" title="Macros.this.global.Symbol">macroImpl</a>.<a href="../../../reflect/internal/Symbols.scala.html#443447" title="=&gt; List[Macros.this.global.Symbol]">typeParams</a>
        <span class="keyword">val</span> <a title="List[Macros.this.global.TypeVar]" id="1110155">tvars</a> = <a href="#1110154" title="List[Macros.this.global.Symbol]">tparams</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: Macros.this.global.Symbol =&gt; Macros.this.global.TypeVar)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Symbol],Macros.this.global.TypeVar,List[Macros.this.global.TypeVar]])List[Macros.this.global.TypeVar]">map</a> <a href="Infer.scala.html#560261" title="(tparam: Macros.this.global.Symbol)Macros.this.global.TypeVar">freshVar</a>
        <span class="keyword">def</span> <a title="(which: String, extra: Macros.this.global.Symbol)String" id="1110156">lengthMsg</a><span class="delimiter">(</span><a title="String" id="1110339">which</a>: <span title="String">String</span>, <a title="Macros.this.global.Symbol" id="1110340">extra</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="Macros.this.global.Symbol">Symbol</a><span class="delimiter">)</span> =
          <span title="String(&quot;parameter lists have different length, &quot;)" class="string">&quot;parameter lists have different length, &quot;</span><span title="(x$1: Any)String">+</span><a href="#1110339" title="String">which</a><span title="(x$1: Any)String">+</span><span title="String(&quot; extra parameter &quot;)" class="string">&quot; extra parameter &quot;</span><span title="(x$1: Any)String">+</span><a href="#1110340" title="Macros.this.global.Symbol">extra</a>.<a href="../../../reflect/internal/Symbols.scala.html#443568" title="=&gt; String">defString</a>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1110146" title="List[List[Macros.this.global.Symbol]]">actparamss</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57898" title="(x: Int)Boolean">!=</a> <a href="#1110145" title="List[List[Macros.this.global.Symbol]]">reqparamss</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a><span class="delimiter">)</span>
          <a href="#1110151" title="(msg: String)Unit">compatibilityError</a><span class="delimiter">(</span><span title="String(&quot;number of parameter sections differ&quot;)" class="string">&quot;number of parameter sections differ&quot;</span><span class="delimiter">)</span>

        <span class="keyword">def</span> <a title="(slot: String, reqtpe: Macros.this.global.Type, acttpe: Macros.this.global.Type)Unit" id="1110157">checkSubType</a><span class="delimiter">(</span><a title="String" id="1110346">slot</a>: <span title="String">String</span>, <a title="Macros.this.global.Type" id="1110347">reqtpe</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="Macros.this.global.Type">Type</a>, <a title="Macros.this.global.Type" id="1110348">acttpe</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="Macros.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../Unit.scala.html#2389" title="Unit">Unit</a> = <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Boolean" id="1110349">ok</a> = <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../reflect/makro/util/Traces.scala.html#559464" title="=&gt; Boolean">macroDebugVerbose</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1110347" title="Macros.this.global.Type">reqtpe</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#1110348" title="Macros.this.global.Type">acttpe</a><span class="delimiter">)</span> <a href="../../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8576" title="implicit scala.Predef.any2stringadd : (x: Any)scala.runtime.StringAdd">reqtpe</a> <a href="../../../runtime/StringAdd.scala.html#60949" title="(other: String)String">+</a> <span title="String(&quot; &lt;: &quot;)" class="string">&quot; &lt;: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1110348" title="Macros.this.global.Type">acttpe</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;?&quot;)" class="string">&quot;?&quot;</span> <span title="(x$1: Any)String">+</span> <a href="../../../compat/Platform.scala.html#67813" title="=&gt; String">EOL</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;true&quot;)" class="string">&quot;true&quot;</span><span class="delimiter">)</span>
            <a href="../../../reflect/internal/Types.scala.html#441592" title="(op: =&gt; Boolean)Boolean">withTypesExplained</a><span class="delimiter">(</span><a href="#1110347" title="Macros.this.global.Type">reqtpe</a> <a href="../../../reflect/internal/Types.scala.html#442058" title="(that: Macros.this.global.Type)Boolean">&lt;:&lt;</a> <a href="#1110348" title="Macros.this.global.Type">acttpe</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#1110347" title="Macros.this.global.Type">reqtpe</a> <a href="../../../reflect/internal/Types.scala.html#442058" title="(that: Macros.this.global.Type)Boolean">&lt;:&lt;</a> <a href="#1110348" title="Macros.this.global.Type">acttpe</a>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1110349" title="Boolean">ok</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#1110151" title="(msg: String)Unit">compatibilityError</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;type mismatch for %s: %s does not conform to %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1110346" title="String">slot</a>, <a href="#1110347" title="Macros.this.global.Type">reqtpe</a>.<a href="#1109708" title="implicit scala.tools.nsc.typechecker.Macros.AugmentedString : (s: String)AugmentedString">toString</a>.<a href="#1109727" title="=&gt; String">abbreviateCoreAliases</a>, <a href="#1110348" title="Macros.this.global.Type">acttpe</a>.<a href="#1109708" title="implicit scala.tools.nsc.typechecker.Macros.AugmentedString : (s: String)AugmentedString">toString</a>.<a href="#1109727" title="=&gt; String">abbreviateCoreAliases</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>

        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1110149" title="Boolean">hasErrors</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">try</span> <span class="delimiter">{</span>
            <span class="keyword">for</span> <span class="delimiter">(</span><span class="delimiter">(</span>rparams, aparams<span class="delimiter">)</span> &lt;- <a href="#1110145" title="List[List[Macros.this.global.Symbol]]">reqparamss</a> <a href="../../../collection/LinearSeqOptimized.scala.html#76166" title="(f: ((List[Macros.this.global.Symbol], List[Macros.this.global.Symbol])) =&gt; Unit)Unit">zip</a> <a href="#1110146" title="List[List[Macros.this.global.Symbol]]">actparamss</a><span class="delimiter">)</span> <a href="#1110479" title="(x: Unit)Unit" class="delimiter">{</a>
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span>rparams.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57905" title="(x: Int)Boolean">&lt;</a> aparams.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a><span class="delimiter">)</span>
                <a href="#1110151" title="(msg: String)Unit">compatibilityError</a><span class="delimiter">(</span><a href="#1110156" title="(which: String, extra: Macros.this.global.Symbol)String">lengthMsg</a><span class="delimiter">(</span><span title="String(&quot;found&quot;)" class="string">&quot;found&quot;</span>, <a href="../../../collection/LinearSeqOptimized.scala.html#76165" title="(n: Int)Macros.this.global.Symbol">aparams</a><span class="delimiter">(</span>rparams.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span>aparams.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57905" title="(x: Int)Boolean">&lt;</a> rparams.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a><span class="delimiter">)</span>
                <a href="#1110151" title="(msg: String)Unit">compatibilityError</a><span class="delimiter">(</span><a href="#1110156" title="(which: String, extra: Macros.this.global.Symbol)String">lengthMsg</a><a href="#1109708" title="implicit scala.tools.nsc.typechecker.Macros.AugmentedString : (s: String)AugmentedString" class="delimiter">(</a><span title="String(&quot;required&quot;)" class="string">&quot;required&quot;</span>, <a href="../../../collection/LinearSeqOptimized.scala.html#76165" title="(n: Int)Macros.this.global.Symbol">rparams</a><span class="delimiter">(</span>aparams.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="#1109727" title="=&gt; String">abbreviateCoreAliases</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            // if the implementation signature is already deemed to be incompatible, we bail out
            // otherwise, high-order type magic employed below might crash in weird ways
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1110149" title="Boolean">hasErrors</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="keyword">for</span> <span class="delimiter">(</span><span class="delimiter">(</span>rparams, aparams<span class="delimiter">)</span> &lt;- <a href="#1110145" title="List[List[Macros.this.global.Symbol]]">reqparamss</a> <a href="../../../collection/LinearSeqOptimized.scala.html#76166" title="(f: ((List[Macros.this.global.Symbol], List[Macros.this.global.Symbol])) =&gt; Unit)Unit">zip</a> <a href="#1110146" title="List[List[Macros.this.global.Symbol]]">actparamss</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">for</span> <span class="delimiter">(</span><span class="delimiter">(</span>rparam, aparam<span class="delimiter">)</span> &lt;- rparams <a href="../../../collection/LinearSeqOptimized.scala.html#76166" title="(f: ((Macros.this.global.Symbol, Macros.this.global.Symbol)) =&gt; Unit)Unit">zip</a> aparams<span class="delimiter">)</span> <a href="#1110728" title="(x: Unit)Unit" class="delimiter">{</a>
                  <span class="keyword">def</span> <a title="(param: Macros.this.global.Symbol)Boolean" id="1110643">isRepeated</a><span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1110644">param</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="Macros.this.global.Symbol">Symbol</a><span class="delimiter">)</span> = <a href="#1110644" title="Macros.this.global.Symbol">param</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; Macros.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#441986" title="=&gt; Macros.this.global.Symbol">typeSymbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#442303" title="=&gt; Macros.this.global.ClassSymbol">RepeatedParamClass</a>
                  <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span>rparam.<a href="../../../reflect/internal/Symbols.scala.html#443152" title="=&gt; Macros.this.global.Symbol#NameType">name</a> <span title="(x$1: AnyRef)Boolean">!=</span> aparam.<a href="../../../reflect/internal/Symbols.scala.html#443152" title="=&gt; Macros.this.global.Symbol#NameType">name</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a>rparam.<a href="../../../reflect/internal/HasFlags.scala.html#443598" title="=&gt; Boolean">isSynthetic</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                    <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="1110656">rparam1</a> = rparam
                    <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="1110657">aparam1</a> = aparam
                    <a href="#1110151" title="(msg: String)Unit">compatibilityError</a><span class="delimiter">(</span><span title="String(&quot;parameter names differ: &quot;)" class="string">&quot;parameter names differ: &quot;</span><span title="(x$1: Any)String">+</span>rparam.<a href="../../../reflect/internal/Symbols.scala.html#443152" title="=&gt; Macros.this.global.Symbol#NameType">name</a><span title="(x$1: Any)String">+</span><span title="String(&quot; != &quot;)" class="string">&quot; != &quot;</span><span title="(x$1: Any)String">+</span>aparam.<a href="../../../reflect/internal/Symbols.scala.html#443152" title="=&gt; Macros.this.global.Symbol#NameType">name</a><span class="delimiter">)</span>
                  <span class="delimiter">}</span>
                  <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1110643" title="(param: Macros.this.global.Symbol)Boolean">isRepeated</a><span class="delimiter">(</span>rparam<span class="delimiter">)</span> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1110643" title="(param: Macros.this.global.Symbol)Boolean">isRepeated</a><span class="delimiter">(</span>aparam<span class="delimiter">)</span><span class="delimiter">)</span>
                    <a href="#1110151" title="(msg: String)Unit">compatibilityError</a><span class="delimiter">(</span><span title="String(&quot;types incompatible for parameter &quot;)" class="string">&quot;types incompatible for parameter &quot;</span><span title="(x$1: Any)String">+</span>rparam.<a href="../../../reflect/internal/Symbols.scala.html#443152" title="=&gt; Macros.this.global.Symbol#NameType">name</a><span title="(x$1: Any)String">+</span><span title="String(&quot;: corresponding is not a vararg parameter&quot;)" class="string">&quot;: corresponding is not a vararg parameter&quot;</span><span class="delimiter">)</span>
                  <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1110643" title="(param: Macros.this.global.Symbol)Boolean">isRepeated</a><span class="delimiter">(</span>rparam<span class="delimiter">)</span> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1110643" title="(param: Macros.this.global.Symbol)Boolean">isRepeated</a><span class="delimiter">(</span>aparam<span class="delimiter">)</span><span class="delimiter">)</span>
                    <a href="#1110151" title="(msg: String)Unit">compatibilityError</a><span class="delimiter">(</span><span title="String(&quot;types incompatible for parameter &quot;)" class="string">&quot;types incompatible for parameter &quot;</span><span title="(x$1: Any)String">+</span>aparam.<a href="../../../reflect/internal/Symbols.scala.html#443152" title="=&gt; Macros.this.global.Symbol#NameType">name</a><span title="(x$1: Any)String">+</span><span title="String(&quot;: corresponding is not a vararg parameter&quot;)" class="string">&quot;: corresponding is not a vararg parameter&quot;</span><span class="delimiter">)</span>
                  <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1110149" title="Boolean">hasErrors</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                    <span class="keyword">var</span> <a title="Macros.this.global.Type" id="1110658">atpe</a> = aparam.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; Macros.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#442042" title="(from: List[Macros.this.global.Symbol], to: List[Macros.this.global.Symbol])Macros.this.global.Type">substSym</a><span class="delimiter">(</span><a href="#1110153" title="List[Macros.this.global.Symbol]">flatactparams</a>, <a href="#1110152" title="List[Macros.this.global.Symbol]">flatreqparams</a><span class="delimiter">)</span>.<a href="../../../reflect/internal/Types.scala.html#442014" title="(formals: List[Macros.this.global.Symbol], actuals: List[Macros.this.global.Type])Macros.this.global.Type">instantiateTypeParams</a><span class="delimiter">(</span><a href="#1110154" title="List[Macros.this.global.Symbol]">tparams</a>, <a href="#1110155" title="List[Macros.this.global.TypeVar]">tvars</a><span class="delimiter">)</span>
                    <a href="#1110658" title="Macros.this.global.Type">atpe</a> = <a href="#1110658" title="Macros.this.global.Type">atpe</a>.<a href="../../../reflect/internal/Types.scala.html#442018" title="=&gt; Macros.this.global.Type">dealias</a> // SI-5706
                    // strip the { type PrefixType = ... } refinement off the Context or otherwise we get compatibility errors
                    <a href="#1110658" title="Macros.this.global.Type">atpe</a> = <a href="#1110658" title="Macros.this.global.Type">atpe</a> <span class="keyword">match</span> <span class="delimiter">{</span>
                      <span class="keyword">case</span> RefinedType<a href="#1110687" title="Macros.this.global.Type" id="1110691" class="delimiter">(</a><a href="../../../collection/generic/SeqFactory.scala.html#60838" title="Option[List[Macros.this.global.Type]]" id="1110718">List</a><span class="delimiter">(</span>tpe<span class="delimiter">)</span>, <a href="../../../reflect/internal/Scopes.scala.html#462769" title="Option[Seq[Macros.this.global.Symbol]]" id="1110717">Scope</a><span class="delimiter">(</span>sym<span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> tpe <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#442424" title="=&gt; Macros.this.global.ClassSymbol">MacroContextClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#443721" title="=&gt; Macros.this.global.Type">tpe</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> sym.<a href="../../../reflect/internal/Symbols.scala.html#443520" title="=&gt; List[Macros.this.global.Symbol]">allOverriddenSymbols</a>.<a href="../../../collection/SeqLike.scala.html#59768" title="(elem: Any)Boolean">contains</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#442427" title="=&gt; Macros.this.global.Symbol">MacroContextPrefixType</a><span class="delimiter">)</span> =&gt; <a href="../../../collection/LinearSeqOptimized.scala.html#76165" title="(n: Int)Macros.this.global.Type">tpe</a>
                      <span class="keyword">case</span> _ =&gt; <a href="#1110697" title="(x: Macros.this.global.Type)Macros.this.global.Type">atpe</a>
                    <span class="delimiter">}</span>
                    <a href="#1110157" title="(slot: String, reqtpe: Macros.this.global.Type, acttpe: Macros.this.global.Type)Unit">checkSubType</a><span class="delimiter">(</span><span title="String(&quot;parameter &quot;)" class="string">&quot;parameter &quot;</span> <span title="(x$1: Any)String">+</span> rparam.<a href="../../../reflect/internal/Symbols.scala.html#443152" title="=&gt; Macros.this.global.Symbol#NameType">name</a>, rparam.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; Macros.this.global.Type">tpe</a>, <a href="#1110658" title="Macros.this.global.Type">atpe</a><span class="delimiter">)</span>
                  <span class="delimiter">}</span>
                <span class="delimiter">}</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1110149" title="Boolean">hasErrors</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="keyword">val</span> <a title="Macros.this.global.Type" id="1110760">atpe</a> = <a href="#1110148" title="Macros.this.global.Type">actres</a>.<a href="../../../reflect/internal/Types.scala.html#442042" title="(from: List[Macros.this.global.Symbol], to: List[Macros.this.global.Symbol])Macros.this.global.Type">substSym</a><span class="delimiter">(</span><a href="#1110153" title="List[Macros.this.global.Symbol]">flatactparams</a>, <a href="#1110152" title="List[Macros.this.global.Symbol]">flatreqparams</a><span class="delimiter">)</span>.<a href="../../../reflect/internal/Types.scala.html#442014" title="(formals: List[Macros.this.global.Symbol], actuals: List[Macros.this.global.Type])Macros.this.global.Type">instantiateTypeParams</a><span class="delimiter">(</span><a href="#1110154" title="List[Macros.this.global.Symbol]">tparams</a>, <a href="#1110155" title="List[Macros.this.global.TypeVar]">tvars</a><span class="delimiter">)</span>
              <a href="#1110157" title="(slot: String, reqtpe: Macros.this.global.Type, acttpe: Macros.this.global.Type)Unit">checkSubType</a><span class="delimiter">(</span><span title="String(&quot;return type&quot;)" class="string">&quot;return type&quot;</span>, <a href="#1110760" title="Macros.this.global.Type">atpe</a>, <a href="#1110147" title="Macros.this.global.Type">reqres</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1110149" title="Boolean">hasErrors</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="keyword">val</span> <a title="List[Macros.this.global.Type]" id="1110763">targs</a> = <a href="Infer.scala.html#560270" title="(tvars: List[Macros.this.global.TypeVar], tparams: List[Macros.this.global.Symbol], variances: List[Int], upper: Boolean, depth: Int)List[Macros.this.global.Type]">solvedTypes</a><span class="delimiter">(</span><a href="#1110155" title="List[Macros.this.global.TypeVar]">tvars</a>, <a href="#1110154" title="List[Macros.this.global.Symbol]">tparams</a>, <a href="#1110154" title="List[Macros.this.global.Symbol]">tparams</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: Macros.this.global.Symbol =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Symbol],Int,List[Int]])List[Int]">map</a> <a href="Variances.scala.html#560330" title="(tp: Macros.this.global.Type)(tparam: Macros.this.global.Symbol)Int">varianceInType</a><a href="#1110782" title="Macros.this.global.Symbol" class="delimiter">(</a><a href="#1110148" title="Macros.this.global.Type">actres</a><span class="delimiter">)</span>, <span title="Boolean(false)" class="keyword">false</span>,
                <a href="../../../reflect/internal/Types.scala.html#441486" title="(ts: List[Macros.this.global.Type])Int">lubDepth</a><a href="../../../LowPriorityImplicits.scala.html#8333" title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="delimiter">(</a><a href="#1110153" title="List[Macros.this.global.Symbol]">flatactparams</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: Macros.this.global.Symbol =&gt; Macros.this.global.Type)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Symbol],Macros.this.global.Type,List[Macros.this.global.Type]])List[Macros.this.global.Type]">map</a> <span class="delimiter">(</span><a href="#1110827" title="Macros.this.global.Symbol">_</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; Macros.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../runtime/RichInt.scala.html#57859" title="(that: Int)Int">max</a> <a href="../../../reflect/internal/Types.scala.html#441486" title="(ts: List[Macros.this.global.Type])Int">lubDepth</a><span class="delimiter">(</span><a href="#1110152" title="List[Macros.this.global.Symbol]">flatreqparams</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: Macros.this.global.Symbol =&gt; Macros.this.global.Type)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Symbol],Macros.this.global.Type,List[Macros.this.global.Type]])List[Macros.this.global.Type]">map</a> <span class="delimiter">(</span><a href="#1110937" title="Macros.this.global.Symbol">_</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; Macros.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="keyword">val</span> <a title="Macros.this.SilentResult[Boolean]" id="1110764">boundsOk</a> = <a href="#1109703" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#560686" title="(op: Macros.this.Typer =&gt; Boolean, reportAmbiguousErrors: Boolean, newtree: Macros.this.global.Tree)Macros.this.SilentResult[Boolean]">silent</a><span class="delimiter">(</span><a href="#1110973" title="Macros.this.Typer">_</a>.<a href="Typers.scala.html#560626" title="=&gt; Macros.this.Inferencer">infer</a>.<a href="Infer.scala.html#562657" title="(tree: Macros.this.global.Tree, pre: Macros.this.global.Type, owner: Macros.this.global.Symbol, tparams: List[Macros.this.global.Symbol], targs: List[Macros.this.global.Type], prefix: String)Boolean">checkBounds</a><span class="delimiter">(</span><a href="#1109704" title="Macros.this.global.DefDef">ddef</a>, <a href="../../../reflect/internal/Types.scala.html#441258" title="Macros.this.global.NoPrefix.type">NoPrefix</a>, <a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; Macros.this.global.NoSymbol">NoSymbol</a>, <a href="#1110154" title="List[Macros.this.global.Symbol]">tparams</a>, <a href="#1110763" title="List[Macros.this.global.Type]">targs</a>, <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
              <a href="#1110764" title="Macros.this.SilentResult[Boolean]">boundsOk</a> <span class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> SilentResultValue<a href="#1111078" title="Unit" id="1111081" class="delimiter">(</a><a href="../../../Boolean.scala.html#58722" title="Unit" id="1111092" class="keyword">true</a><span class="delimiter">)</span> =&gt; ;
                <span class="keyword">case</span> SilentResultValue<a href="#1111078" title="Unit" id="1111086" class="delimiter">(</a><a href="../../../Boolean.scala.html#58722" title="Boolean" id="1111093" class="keyword">false</a><span class="delimiter">)</span> | SilentTypeError<a href="#1111078" title="Boolean" id="1111091" class="delimiter">(</a>_<span class="delimiter">)</span> =&gt;
                  <span class="keyword">val</span> <a title="List[Macros.this.global.TypeBounds]" id="1110988">bounds</a> = <a href="#1110154" title="List[Macros.this.global.Symbol]">tparams</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: Macros.this.global.Symbol =&gt; Macros.this.global.TypeBounds)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Symbol],Macros.this.global.TypeBounds,List[Macros.this.global.TypeBounds]])List[Macros.this.global.TypeBounds]">map</a> <span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1111005">tp</a> =&gt; <a href="#1111005" title="Macros.this.global.Symbol">tp</a>.<a href="../../../reflect/internal/Symbols.scala.html#443427" title="=&gt; Macros.this.global.Type">info</a>.<a href="../../../reflect/internal/Types.scala.html#442014" title="(formals: List[Macros.this.global.Symbol], actuals: List[Macros.this.global.Type])Macros.this.global.Type">instantiateTypeParams</a><span class="delimiter">(</span><a href="#1110154" title="List[Macros.this.global.Symbol]">tparams</a>, <a href="#1110763" title="List[Macros.this.global.Type]">targs</a><span class="delimiter">)</span>.<a href="../../../reflect/internal/Types.scala.html#441994" title="=&gt; Macros.this.global.TypeBounds">bounds</a><span class="delimiter">)</span>
                  <a href="#1110151" title="(msg: String)Unit">compatibilityError</a><span class="delimiter">(</span><span title="String(&quot;type arguments &quot;)" class="string">&quot;type arguments &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1110763" title="List[Macros.this.global.Type]">targs</a>.<a href="../../../collection/TraversableOnce.scala.html#59189" title="(start: String, sep: String, end: String)String">mkString</a><span class="delimiter">(</span><span title="String(&quot;[&quot;)" class="string">&quot;[&quot;</span>, <span title="String(&quot;,&quot;)" class="string">&quot;,&quot;</span>, <span title="String(&quot;]&quot;)" class="string">&quot;]&quot;</span><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span>
                                     <span title="String(&quot; do not conform to &quot;)" class="string">&quot; do not conform to &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1110154" title="List[Macros.this.global.Symbol]">tparams</a>.<a href="../../../collection/IterableLike.scala.html#59473" title="=&gt; Macros.this.global.Symbol">head</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; Macros.this.global.Symbol">owner</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;\'s type parameter bounds &quot;)" class="string">&quot;'s type parameter bounds &quot;</span> <span title="(x$1: Any)String">+</span>
                                     <span class="delimiter">(</span><a href="#1110154" title="List[Macros.this.global.Symbol]">tparams</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: Macros.this.global.Symbol =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Symbol],String,List[String]])List[String]">map</a> <span class="delimiter">(</span><a href="#1111046" title="Macros.this.global.Symbol">_</a>.<a href="../../../reflect/internal/Symbols.scala.html#443568" title="=&gt; String">defString</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../../collection/TraversableOnce.scala.html#59189" title="(start: String, sep: String, end: String)String">mkString</a><span class="delimiter">(</span><span title="String(&quot;[&quot;)" class="string">&quot;[&quot;</span>, <span title="String(&quot;,&quot;)" class="string">&quot;,&quot;</span>, <span title="String(&quot;]&quot;)" class="string">&quot;]&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a title="Unit" id="1111110">ex</a>: <a href="Infer.scala.html#560262" title="Macros.this.NoInstance">NoInstance</a> =&gt;
              <a href="#1110151" title="(msg: String)Unit">compatibilityError</a><span class="delimiter">(</span>
                <span title="String(&quot;type parameters &quot;)" class="string">&quot;type parameters &quot;</span><span title="(x$1: Any)String">+</span><span class="delimiter">(</span><a href="#1110154" title="List[Macros.this.global.Symbol]">tparams</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: Macros.this.global.Symbol =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Symbol],String,List[String]])List[String]">map</a> <span class="delimiter">(</span><a href="#1111121" title="Macros.this.global.Symbol">_</a>.<a href="../../../reflect/internal/Symbols.scala.html#443568" title="=&gt; String">defString</a><span class="delimiter">)</span> <a href="../../../collection/TraversableOnce.scala.html#59190" title="(sep: String)String">mkString</a> <span title="String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span title="(x$1: Any)String">+</span><span title="String(&quot; cannot be instantiated\n&quot;)" class="string">&quot; cannot be instantiated\n&quot;</span><span title="(x$1: Any)String">+</span>
                <a href="#1111110" title="Macros.this.NoInstance">ex</a>.<span title="()String">getMessage</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>

        <a href="#1110150" title="List[String]">errors</a>.<a href="../../../collection/immutable/List.scala.html#63665" title="=&gt; List[String]">toList</a>
      <span class="delimiter">}</span>

      <span class="keyword">var</span> <a title="List[List[Macros.this.global.Symbol]]" id="1110138">actparamss</a> = <a href="#1109722" title="Macros.this.global.Symbol">macroImpl</a>.<a href="../../../reflect/internal/Symbols.scala.html#443448" title="=&gt; List[List[Macros.this.global.Symbol]]">paramss</a>
      <a href="#1110138" title="List[List[Macros.this.global.Symbol]]">actparamss</a> = <a href="#560428" title="(paramss: List[List[Macros.this.global.Symbol]], transform: (Macros.this.global.Symbol, Macros.this.global.Symbol) =&gt; Option[Macros.this.global.Symbol])List[List[Macros.this.global.Symbol]]">transformTypeTagEvidenceParams</a><span class="delimiter">(</span><a href="#1110138" title="List[List[Macros.this.global.Symbol]]">actparamss</a>, <span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1111155">param</a>, <a title="Macros.this.global.Symbol" id="1111156">tparam</a><span class="delimiter">)</span> =&gt; <a href="../../../Option.scala.html#2498" title="None.type">None</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="Macros.this.global.Type" id="1110139">rettpe</a> = <span title="Macros.this.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1109704" title="Macros.this.global.DefDef">ddef</a>.<a href="../../../reflect/api/Trees.scala.html#427504" title="=&gt; Macros.this.global.Tree">tpt</a>.<a href="../../../reflect/api/Trees.scala.html#425069" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <a href="#1109703" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#560777" title="(tree: Macros.this.global.Tree)Macros.this.global.Tree">typedType</a><span class="delimiter">(</span><a href="#1109704" title="Macros.this.global.DefDef">ddef</a>.<a href="../../../reflect/api/Trees.scala.html#427504" title="=&gt; Macros.this.global.Tree">tpt</a><span class="delimiter">)</span>.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; Macros.this.global.Type">tpe</a> <span class="keyword">else</span> <a href="#560430" title="(macroDdef: Macros.this.global.DefDef, macroDef: Macros.this.global.Symbol, macroImpl: Macros.this.global.Symbol)Macros.this.global.Type">computeMacroDefTypeFromMacroImpl</a><span class="delimiter">(</span><a href="#1109704" title="Macros.this.global.DefDef">ddef</a>, <a href="#1109711" title="Macros.this.global.Symbol">macroDef</a>, <a href="#1109722" title="Macros.this.global.Symbol">macroImpl</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a href="#1111183" title="(x: (List[List[List[Macros.this.global.Symbol]]], Macros.this.global.Type))(List[List[List[Macros.this.global.Symbol]]], Macros.this.global.Type)" class="delimiter">(</a><a href="../../../Tuple2.scala.html#61506" title="List[List[List[Macros.this.global.Symbol]]]" id="1110141">reqparamsss0</a>, <a href="../../../Tuple2.scala.html#61508" title="Macros.this.global.Type" id="1110142">reqres0</a><span class="delimiter">)</span> = <a href="#560427" title="(macroDef: Macros.this.global.Symbol, tparams: List[Macros.this.global.TypeDef], vparamss: List[List[Macros.this.global.ValDef]], retTpe: Macros.this.global.Type)(List[List[List[Macros.this.global.Symbol]]], Macros.this.global.Type)">macroImplSigs</a><a href="../../../Tuple2.scala.html#1222" title="(List[List[List[Macros.this.global.Symbol]]], Macros.this.global.Type) @unchecked" class="delimiter">(</a><a href="#1109711" title="Macros.this.global.Symbol">macroDef</a>, <a href="#1109704" title="Macros.this.global.DefDef">ddef</a>.<a href="../../../reflect/api/Trees.scala.html#427500" title="=&gt; List[Macros.this.global.TypeDef]">tparams</a>, <a href="#1109704" title="Macros.this.global.DefDef">ddef</a>.<a href="../../../reflect/api/Trees.scala.html#427502" title="=&gt; List[List[Macros.this.global.ValDef]]">vparamss</a>, <a href="#1110139" title="Macros.this.global.Type">rettpe</a><span class="delimiter">)</span>
      <span class="keyword">var</span> <a title="List[List[List[Macros.this.global.Symbol]]]" id="1110143">reqparamsss</a> = <a href="#1110141" title="List[List[List[Macros.this.global.Symbol]]]">reqparamsss0</a>

      // prohibit implicit params on macro implementations
      // we don't have to do this, but it appears to be more clear than allowing them
      <span class="keyword">val</span> <a title="List[Macros.this.global.Symbol]" id="1110144">implicitParams</a> = <a href="#1110138" title="List[List[Macros.this.global.Symbol]]">actparamss</a>.<a href="../../../collection/generic/GenericTraversableTemplate.scala.html#59386" title="(implicit asTraversable: List[Macros.this.global.Symbol] =&gt; scala.collection.GenTraversableOnce[Macros.this.global.Symbol])List[Macros.this.global.Symbol]">flatten</a> <a href="../../../collection/TraversableLike.scala.html#58981" title="(p: Macros.this.global.Symbol =&gt; Boolean)List[Macros.this.global.Symbol]">filter</a> <span class="delimiter">(</span><a href="#1111230" title="Macros.this.global.Symbol">_</a>.<a href="../../../reflect/internal/HasFlags.scala.html#443592" title="=&gt; Boolean">isImplicit</a><span class="delimiter">)</span>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#1110144" title="List[Macros.this.global.Symbol]">implicitParams</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57919" title="(x: Int)Boolean">&gt;</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#1109710" title="(pos: Macros.this.global.Position, msg: String)Unit">reportError</a><span class="delimiter">(</span><a href="#1110144" title="List[Macros.this.global.Symbol]">implicitParams</a>.<a href="../../../collection/IterableLike.scala.html#59473" title="=&gt; Macros.this.global.Symbol">head</a>.<a href="../../../reflect/internal/Symbols.scala.html#443167" title="=&gt; Macros.this.global.Position">pos</a>, <span title="String(&quot;macro implementations cannot have implicit parameters other than TypeTag evidences&quot;)" class="string">&quot;macro implementations cannot have implicit parameters other than TypeTag evidences&quot;</span><span class="delimiter">)</span>
        <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: Macros.this.global.Symbol)Macros.this.global.Symbol">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;macro def failed to satisfy trivial preconditions: &quot;)" class="string">&quot;macro def failed to satisfy trivial preconditions: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1109711" title="Macros.this.global.Symbol">macroDef</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1109709" title="Boolean">hasErrors</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Macros.this.global.Type" id="1111248">reqres</a> = <a href="#1110142" title="Macros.this.global.Type">reqres0</a>
        <span class="keyword">val</span> <a title="Macros.this.global.Type" id="1111249">actres</a> = <a href="#1109722" title="Macros.this.global.Symbol">macroImpl</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; Macros.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#442006" title="=&gt; Macros.this.global.Type">finalResultType</a>
        <span class="keyword">def</span> <a title="(pss: List[List[Macros.this.global.Symbol]], restpe: Macros.this.global.Type, abbreviate: Boolean)String" id="1111250">showMeth</a><span class="delimiter">(</span><a title="List[List[Macros.this.global.Symbol]]" id="1111253">pss</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[List[Macros.this.global.Symbol]]">List</a><span class="delimiter">[</span>List<span class="delimiter">[</span>Symbol<span class="delimiter">]</span><span class="delimiter">]</span>, <a title="Macros.this.global.Type" id="1111254">restpe</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="Macros.this.global.Type">Type</a>, <a title="Boolean" id="1111255">abbreviate</a>: <a href="../../../Boolean.scala.html#2218" title="Boolean">Boolean</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
          <span class="keyword">var</span> <a title="String" id="1111256">argsPart</a> = <span class="delimiter">(</span><a href="#1111253" title="List[List[Macros.this.global.Symbol]]">pss</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: List[Macros.this.global.Symbol] =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[List[List[Macros.this.global.Symbol]],String,List[String]])List[String]">map</a> <span class="delimiter">(</span><a title="List[Macros.this.global.Symbol]" id="1111274">ps</a> =&gt; <a href="#1111274" title="List[Macros.this.global.Symbol]">ps</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: Macros.this.global.Symbol =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Symbol],String,List[String]])List[String]">map</a> <span class="delimiter">(</span><a href="#1111291" title="Macros.this.global.Symbol">_</a>.<a href="../../../reflect/internal/Symbols.scala.html#443568" title="=&gt; String">defString</a><span class="delimiter">)</span> <a href="../../../collection/TraversableOnce.scala.html#59189" title="(start: String, sep: String, end: String)String">mkString</a> <span class="delimiter">(</span><span title="String(&quot;(&quot;)" class="string">&quot;(&quot;</span>, <span title="String(&quot;, &quot;)" class="string">&quot;, &quot;</span>, <span title="String(&quot;)&quot;)" class="string">&quot;)&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../../collection/TraversableOnce.scala.html#59191" title="=&gt; String">mkString</a>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1111255" title="Boolean">abbreviate</a><span class="delimiter">)</span> <a href="#1111256" title="String">argsPart</a> = <a href="#1109708" title="implicit scala.tools.nsc.typechecker.Macros.AugmentedString : (s: String)AugmentedString">argsPart</a>.<a href="#1109727" title="=&gt; String">abbreviateCoreAliases</a>
          <span class="keyword">var</span> <a title="String" id="1111257">retPart</a> = <a href="#1111254" title="Macros.this.global.Type">restpe</a>.<a href="../../../reflect/internal/Types.scala.html#442076" title="()String">toString</a>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1111255" title="Boolean">abbreviate</a> <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <a href="#1109704" title="Macros.this.global.DefDef">ddef</a>.<a href="../../../reflect/api/Trees.scala.html#427504" title="=&gt; Macros.this.global.Tree">tpt</a>.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; Macros.this.global.Type">tpe</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#1111257" title="String">retPart</a> = <a href="#1109708" title="implicit scala.tools.nsc.typechecker.Macros.AugmentedString : (s: String)AugmentedString">retPart</a>.<a href="#1109727" title="=&gt; String">abbreviateCoreAliases</a>
          <a href="#1111256" title="String">argsPart</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1111257" title="String">retPart</a>
        <span class="delimiter">}</span>
        <span class="keyword">def</span> <a title="(addendum: String)Unit" id="1111251">compatibilityError</a><span class="delimiter">(</span><a title="String" id="1111361">addendum</a>: <span title="String">String</span><span class="delimiter">)</span> =
          <a href="#1109710" title="(pos: Macros.this.global.Position, msg: String)Unit">reportError</a><span class="delimiter">(</span><a href="#1109713" title="Macros.this.global.Position">implpos</a>,
            <span class="string">&quot;macro implementation has wrong shape:&quot;</span><span title="String(&quot;macro implementation has wrong shape:\n required: &quot;)">+</span>
            <span class="string">&quot;\n required: &quot;</span><span title="(x$1: Any)String">+</span><a href="#1111250" title="(pss: List[List[Macros.this.global.Symbol]], restpe: Macros.this.global.Type, abbreviate: Boolean)String">showMeth</a><span class="delimiter">(</span><a href="#1110143" title="List[List[List[Macros.this.global.Symbol]]]">reqparamsss</a>.<a href="../../../collection/IterableLike.scala.html#59473" title="=&gt; List[List[Macros.this.global.Symbol]]">head</a>, <a href="#1111248" title="Macros.this.global.Type">reqres</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span>
            <span class="delimiter">(</span><a href="#1110143" title="List[List[List[Macros.this.global.Symbol]]]">reqparamsss</a>.<a href="../../../collection/TraversableLike.scala.html#59012" title="=&gt; List[List[List[Macros.this.global.Symbol]]]">tail</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: List[List[Macros.this.global.Symbol]] =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[List[List[List[Macros.this.global.Symbol]]],String,List[String]])List[String]">map</a> <span class="delimiter">(</span><a title="List[List[Macros.this.global.Symbol]]" id="1111387">paramss</a> =&gt; <span title="String(&quot;\n or      : &quot;)" class="string">&quot;\n or      : &quot;</span><span title="(x$1: Any)String">+</span><a href="#1111250" title="(pss: List[List[Macros.this.global.Symbol]], restpe: Macros.this.global.Type, abbreviate: Boolean)String">showMeth</a><span class="delimiter">(</span><a href="#1111387" title="List[List[Macros.this.global.Symbol]]">paramss</a>, <a href="#1111248" title="Macros.this.global.Type">reqres</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../collection/TraversableOnce.scala.html#59190" title="(sep: String)String">mkString</a> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span><span title="(x$1: Any)String">+</span>
            <span title="String(&quot;\n found   : &quot;)" class="string">&quot;\n found   : &quot;</span><span title="(x$1: Any)String">+</span><a href="#1111250" title="(pss: List[List[Macros.this.global.Symbol]], restpe: Macros.this.global.Type, abbreviate: Boolean)String">showMeth</a><span class="delimiter">(</span><a href="#1110138" title="List[List[Macros.this.global.Symbol]]">actparamss</a>, <a href="#1111249" title="Macros.this.global.Type">actres</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span title="(x$1: Any)String">+</span>
            <span title="String(&quot;\n&quot;)" class="string">&quot;\n&quot;</span><span title="(x$1: Any)String">+</span><a href="#1111361" title="String">addendum</a><span class="delimiter">)</span>

        <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: Macros.this.global.Name)Macros.this.global.Name">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;considering &quot;)" class="string">&quot;considering &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1110143" title="List[List[List[Macros.this.global.Symbol]]]">reqparamsss</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; possibilities of compatible macro impl signatures for macro def: &quot;)" class="string">&quot; possibilities of compatible macro impl signatures for macro def: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1109704" title="Macros.this.global.DefDef">ddef</a>.<a href="../../../reflect/api/Trees.scala.html#427498" title="=&gt; Macros.this.global.Name">name</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="List[List[String]]" id="1111252">results</a> = <a href="#1110143" title="List[List[List[Macros.this.global.Symbol]]]">reqparamsss</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: List[List[Macros.this.global.Symbol]] =&gt; List[String])(implicit bf: scala.collection.generic.CanBuildFrom[List[List[List[Macros.this.global.Symbol]]],List[String],List[List[String]]])List[List[String]]">map</a> <span class="delimiter">(</span><a href="#1110137" title="(reqparamss: List[List[Macros.this.global.Symbol]], actparamss: List[List[Macros.this.global.Symbol]], reqres: Macros.this.global.Type, actres: Macros.this.global.Type)List[String]">checkCompatibility</a><span class="delimiter">(</span><a href="#1111444" title="List[List[Macros.this.global.Symbol]]">_</a>, <a href="#1110138" title="List[List[Macros.this.global.Symbol]]">actparamss</a>, <a href="#1111248" title="Macros.this.global.Type">reqres</a>, <a href="#1111249" title="Macros.this.global.Type">actres</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../reflect/makro/util/Traces.scala.html#559464" title="=&gt; Boolean">macroDebugVerbose</a><span class="delimiter">)</span> <span class="delimiter">(</span><a href="#1110143" title="List[List[List[Macros.this.global.Symbol]]]">reqparamsss</a> <a href="../../../collection/IterableLike.scala.html#59486" title="(that: scala.collection.GenIterable[List[String]])(implicit bf: scala.collection.generic.CanBuildFrom[List[List[List[Macros.this.global.Symbol]]],(List[List[Macros.this.global.Symbol]], List[String]),List[(List[List[Macros.this.global.Symbol]], List[String])]])List[(List[List[Macros.this.global.Symbol]], List[String])]">zip</a> <a href="#1111252" title="List[List[String]]">results</a><span class="delimiter">)</span> <a href="../../../collection/LinearSeqOptimized.scala.html#76166" title="(f: ((List[List[Macros.this.global.Symbol]], List[String])) =&gt; Unit)Unit">foreach</a> <a title="anonymous class $anonfun extends scala.runtime.AbstractFunction1[(List[List[Macros.this.global.Symbol]], List[String]),Unit] with Serializable" id="1111552" class="delimiter">{</a> <span class="keyword">case</span> <span class="delimiter">(</span>reqparamss, result<span class="delimiter">)</span> =&gt;
          <a href="../../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;%s %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><span title="Any" class="keyword">if</span> <span class="delimiter">(</span>result.<a href="../../../collection/IterableLike.scala.html#59464" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <span title="String(&quot;[  OK  ]&quot;)" class="string">&quot;[  OK  ]&quot;</span> <span class="keyword">else</span> <span title="String(&quot;[FAILED]&quot;)" class="string">&quot;[FAILED]&quot;</span>, reqparamss<span class="delimiter">)</span><span class="delimiter">)</span>
          result <a href="../../../collection/LinearSeqOptimized.scala.html#76166" title="(f: String =&gt; Unit)Unit">foreach</a> <span class="delimiter">(</span><a title="String" id="1111582">errorMsg</a> =&gt; <a href="../../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><span class="delimiter">(</span><span title="String(&quot;  &quot;)" class="string">&quot;  &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1111582" title="String">errorMsg</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1111252" title="List[List[String]]">results</a> <a href="../../../collection/LinearSeqOptimized.scala.html#76169" title="(p: List[String] =&gt; Boolean)Boolean">forall</a> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1111609" title="List[String]">_</a>.<a href="../../../collection/IterableLike.scala.html#59464" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">var</span> <a title="Int" id="1111610">index</a> = <a href="#1110143" title="List[List[List[Macros.this.global.Symbol]]]">reqparamsss</a> <a href="../../../collection/GenSeqLike.scala.html#59604" title="(p: List[List[Macros.this.global.Symbol]] =&gt; Boolean)Int">indexWhere</a> <span class="delimiter">(</span><a href="#1111626" title="List[List[Macros.this.global.Symbol]]">_</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <a href="#1110138" title="List[List[Macros.this.global.Symbol]]">actparamss</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a><span class="delimiter">)</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1111610" title="Int">index</a> <a href="../../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span> <a href="#1111610" title="Int">index</a> = <span title="Int(0)" class="int">0</span>
          <span class="keyword">val</span> <a title="String" id="1111611">mostRelevantMessage</a> = <a href="../../../collection/LinearSeqOptimized.scala.html#76165" title="(n: Int)List[String]">results</a><span class="delimiter">(</span><a href="#1111610" title="Int">index</a><span class="delimiter">)</span>.<a href="../../../collection/IterableLike.scala.html#59473" title="=&gt; String">head</a>
          <a href="#1111251" title="(addendum: String)Unit">compatibilityError</a><span class="delimiter">(</span><a href="#1111611" title="String">mostRelevantMessage</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="../Global.scala.html#559533" title="(assertion: Boolean, message: =&gt; Any)Unit">assert</a><span class="delimiter">(</span><span class="delimiter">(</span><a href="#1111252" title="List[List[String]]">results</a> <a href="../../../collection/TraversableLike.scala.html#58981" title="(p: List[String] =&gt; Boolean)List[List[String]]">filter</a> <span class="delimiter">(</span><a href="#1111652" title="List[String]">_</a>.<a href="../../../collection/IterableLike.scala.html#59464" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <span title="Int(1)" class="int">1</span>, <a href="#1111252" title="List[List[String]]">results</a><span class="delimiter">)</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../reflect/makro/util/Traces.scala.html#559464" title="=&gt; Boolean">macroDebugVerbose</a><span class="delimiter">)</span> <span class="delimiter">(</span><a href="#1110143" title="List[List[List[Macros.this.global.Symbol]]]">reqparamsss</a> <a href="../../../collection/IterableLike.scala.html#59486" title="(that: scala.collection.GenIterable[List[String]])(implicit bf: scala.collection.generic.CanBuildFrom[List[List[List[Macros.this.global.Symbol]]],(List[List[Macros.this.global.Symbol]], List[String]),List[(List[List[Macros.this.global.Symbol]], List[String])]])List[(List[List[Macros.this.global.Symbol]], List[String])]">zip</a> <a href="#1111252" title="List[List[String]]">results</a><span class="delimiter">)</span> <a href="../../../collection/TraversableLike.scala.html#58981" title="(p: ((List[List[Macros.this.global.Symbol]], List[String])) =&gt; Boolean)List[(List[List[Macros.this.global.Symbol]], List[String])]">filter</a> <span class="delimiter">(</span><a href="#1111719" title="(List[List[Macros.this.global.Symbol]], List[String])">_</a>.<a href="../../../Tuple2.scala.html#61508" title="=&gt; List[String]">_2</a>.<a href="../../../collection/IterableLike.scala.html#59464" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <a href="../../../collection/LinearSeqOptimized.scala.html#76166" title="(f: ((List[List[Macros.this.global.Symbol]], List[String])) =&gt; Unit)Unit">foreach</a> <a title="anonymous class $anonfun extends scala.runtime.AbstractFunction1[(List[List[Macros.this.global.Symbol]], List[String]),Unit] with Serializable" id="1111741" class="delimiter">{</a> <span class="keyword">case</span> <span class="delimiter">(</span>reqparamss, result<span class="delimiter">)</span> =&gt;
            <a href="../../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><a href="#1111751" title="(x: Unit)Unit" class="delimiter">(</a><span title="String(&quot;typechecked macro impl as: &quot;)" class="string">&quot;typechecked macro impl as: &quot;</span> <span title="(x$1: Any)String">+</span> reqparamss<span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    // if this macro definition is erroneous, then there's no sense in expanding its usages
    // in the previous prototype macro implementations were magically generated from macro definitions
    // so macro definitions and its usages couldn't be compiled in the same compilation run
    // however, now definitions and implementations are decoupled, so it's everything is possible
    // hence, we now use IS_ERROR flag to serve as an indicator that given macro definition is broken
    <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#1109709" title="Boolean">hasErrors</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#1109711" title="Macros.this.global.Symbol">macroDef</a> <a href="../../../reflect/internal/Symbols.scala.html#443305" title="(mask: Long)macroDef.type">setFlag</a> <span title="Long(4294967296L)">IS_ERROR</span>
    <span class="delimiter">}</span>

    <a href="#1109720" title="Macros.this.global.Tree">rhs1</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(macroDdef: Macros.this.global.DefDef, macroDef: Macros.this.global.Symbol, macroImpl: Macros.this.global.Symbol)Macros.this.global.Type" id="560430">computeMacroDefTypeFromMacroImpl</a><span class="delimiter">(</span><a title="Macros.this.global.DefDef" id="1111162">macroDdef</a>: <a href="../../../reflect/api/Trees.scala.html#23598" title="Macros.this.global.DefDef">DefDef</a>, <a title="Macros.this.global.Symbol" id="1111163">macroDef</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="Macros.this.global.Symbol">Symbol</a>, <a title="Macros.this.global.Symbol" id="1111164">macroImpl</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="Macros.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#441242" title="Macros.this.global.Type">Type</a> = <span class="delimiter">{</span>
    // get return type from method type
    <span class="keyword">def</span> <a title="(tpe: Macros.this.global.Type)Macros.this.global.Type" id="1111776">unwrapRet</a><span class="delimiter">(</span><a title="Macros.this.global.Type" id="1111781">tpe</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="Macros.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#441242" title="Macros.this.global.Type">Type</a> = <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(tpe: Macros.this.global.Type)Macros.this.global.Type" id="1111782">loop</a><span class="delimiter">(</span><a title="Macros.this.global.Type" id="1111783">tpe</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="Macros.this.global.Type">Type</a><span class="delimiter">)</span> = <a href="#1111783" title="Macros.this.global.Type">tpe</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> NullaryMethodType<a href="#1111791" title="Macros.this.global.Type" id="1111793" class="delimiter">(</a>ret<span class="delimiter">)</span> =&gt; <a href="#1111797" title="(x: Macros.this.global.Type)Macros.this.global.Type">ret</a>
        <span class="keyword">case</span> mtpe @ MethodType<a href="#1111791" title="Macros.this.global.Type" id="1111796" class="delimiter">(</a>_, ret<span class="delimiter">)</span> =&gt; <a href="#1111776" title="(tpe: Macros.this.global.Type)Macros.this.global.Type">unwrapRet</a><a href="#1111797" title="(x: Macros.this.global.Type)Macros.this.global.Type" class="delimiter">(</a>ret<span class="delimiter">)</span>
        <span class="keyword">case</span> _ =&gt; <a href="#1111797" title="(x: Macros.this.global.Type)Macros.this.global.Type">tpe</a>
      <span class="delimiter">}</span>

      <a href="#1111781" title="Macros.this.global.Type">tpe</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> PolyType<a href="#1111807" title="Macros.this.global.Type" id="1111810" class="delimiter">(</a>_, tpe<span class="delimiter">)</span> =&gt; <a href="#1111782" title="(tpe: Macros.this.global.Type)Macros.this.global.Type">loop</a><a href="#1111811" title="(x: Macros.this.global.Type)Macros.this.global.Type" class="delimiter">(</a>tpe<span class="delimiter">)</span>
        <span class="keyword">case</span> _ =&gt; <a href="#1111782" title="(tpe: Macros.this.global.Type)Macros.this.global.Type">loop</a><a href="#1111811" title="(x: Macros.this.global.Type)Macros.this.global.Type" class="delimiter">(</a><a href="#1111781" title="Macros.this.global.Type">tpe</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <span class="keyword">var</span> <a title="Macros.this.global.Type" id="1111777">metaType</a> = <a href="#1111776" title="(tpe: Macros.this.global.Type)Macros.this.global.Type">unwrapRet</a><span class="delimiter">(</span><a href="#1111164" title="Macros.this.global.Symbol">macroImpl</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; Macros.this.global.Type">tpe</a><span class="delimiter">)</span>

    // downgrade from metalevel-0 to metalevel-1
    <span class="keyword">def</span> <a title="(metaType: Macros.this.global.Type)Macros.this.global.Type" id="1111778">inferRuntimeType</a><span class="delimiter">(</span><a title="Macros.this.global.Type" id="1111816">metaType</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="Macros.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#441242" title="Macros.this.global.Type">Type</a> = <a href="#1111816" title="Macros.this.global.Type">metaType</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> TypeRef<a href="#1111834" title="Macros.this.global.Type" id="1111836" class="delimiter">(</a>pre, sym, args<span class="delimiter">)</span> <span class="keyword">if</span> sym.<a href="../../../reflect/internal/Symbols.scala.html#443152" title="=&gt; Macros.this.global.Symbol#NameType">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/StdNames.scala.html#441756" title="Macros.this.global.tpnme.type">tpnme</a>.<a href="../../../reflect/internal/StdNames.scala.html#449203" title="=&gt; Macros.this.global.tpnme.NameType">Expr</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> args.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <span title="Int(1)" class="int">1</span> =&gt;
        args.<a href="#1111837" title="(x: Macros.this.global.Type)Macros.this.global.Type">head</a>
      <span class="keyword">case</span> _ =&gt;
        <a href="../../../reflect/internal/Definitions.scala.html#442175" title="=&gt; Macros.this.global.ClassSymbol">AnyClass</a>.<a href="#1111837" title="(x: Macros.this.global.Type)Macros.this.global.Type">tpe</a>
    <span class="delimiter">}</span>
    <span class="keyword">var</span> <a title="Macros.this.global.Type" id="1111779">runtimeType</a> = <a href="#1111778" title="(metaType: Macros.this.global.Type)Macros.this.global.Type">inferRuntimeType</a><span class="delimiter">(</span><a href="#1111777" title="Macros.this.global.Type">metaType</a><span class="delimiter">)</span>

    // transform type parameters of a macro implementation into type parameters of a macro definition
    <a href="#1111779" title="Macros.this.global.Type">runtimeType</a> = <a href="#1111779" title="Macros.this.global.Type">runtimeType</a> <a href="../../../reflect/internal/Types.scala.html#442054" title="(f: Macros.this.global.Type =&gt; Macros.this.global.Type)Macros.this.global.Type">map</a> <a title="anonymous class $anonfun extends scala.runtime.AbstractFunction1[Macros.this.global.Type,Macros.this.global.Type] with Serializable" id="1111847" class="delimiter">{</a>
      <span class="keyword">case</span> TypeRef<a href="#1111977" title="Macros.this.global.Type" id="1111979" class="delimiter">(</a>pre, sym, args<span class="delimiter">)</span> =&gt;
        // [Eugene] not sure which of these deSkolemizes are necessary
        // sym.paramPos is unreliable (see another case below)
        <span class="keyword">val</span> <a title="List[Macros.this.global.Symbol]" id="1111855">tparams</a> = <a href="#1111164" title="Macros.this.global.Symbol">macroImpl</a>.<a href="../../../reflect/internal/Symbols.scala.html#443447" title="=&gt; List[Macros.this.global.Symbol]">typeParams</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: Macros.this.global.Symbol =&gt; Macros.this.global.Symbol)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Symbol],Macros.this.global.Symbol,List[Macros.this.global.Symbol]])List[Macros.this.global.Symbol]">map</a> <span class="delimiter">(</span><a href="#1111877" title="Macros.this.global.Symbol">_</a>.<a href="../../../reflect/internal/Symbols.scala.html#443531" title="=&gt; Macros.this.global.Symbol">deSkolemize</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="1111856">paramPos</a> = <a href="#1111855" title="List[Macros.this.global.Symbol]">tparams</a> <a href="../../../collection/GenSeqLike.scala.html#59605" title="(elem: Macros.this.global.Symbol)Int">indexOf</a> sym.<a href="../../../reflect/internal/Symbols.scala.html#443531" title="=&gt; Macros.this.global.Symbol">deSkolemize</a>
        <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="1111857">sym1</a> = <span title="Macros.this.global.Symbol" class="keyword">if</span> <span class="delimiter">(</span><a href="#1111856" title="Int">paramPos</a> <a href="../../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span> sym <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Option[Macros.this.global.AnnotationInfo]" id="1111924">ann</a> = <a href="#1111163" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/AnnotationInfos.scala.html#442127" title="(cls: Macros.this.global.Symbol)Option[Macros.this.global.AnnotationInfo]">getAnnotation</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#442430" title="=&gt; Macros.this.global.ClassSymbol">MacroImplAnnotation</a><span class="delimiter">)</span>
          <a href="#1111924" title="Option[Macros.this.global.AnnotationInfo]">ann</a> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> Some<a href="#1111963" title="Macros.this.global.Symbol" id="1111964" class="delimiter">(</a>ann<span class="delimiter">)</span> =&gt;
              <span class="keyword">val</span> TypeApply<a href="#1111946" title="List[Macros.this.global.Tree]" id="1111949" class="delimiter">(</a>_, implRefTargs<span class="delimiter">)</span> = ann.<a href="../../../collection/LinearSeqOptimized.scala.html#76165" title="(n: Int)Macros.this.global.Tree">args</a><a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree @unchecked" class="delimiter">(</a><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
              <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="1111929">implRefTarg</a> = <a href="../../../collection/LinearSeqOptimized.scala.html#76165" title="(n: Int)Macros.this.global.Tree">implRefTargs</a><span class="delimiter">(</span><a href="#1111856" title="Int">paramPos</a><span class="delimiter">)</span>.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; Macros.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#441986" title="=&gt; Macros.this.global.Symbol">typeSymbol</a>
              <a href="#1111929" title="Macros.this.global.Symbol">implRefTarg</a>
            <span class="keyword">case</span> <a href="../../../Option.scala.html#2498" title="Macros.this.global.Symbol" id="1111966">None</a> =&gt;
              <a href="#1111967" title="(x: Macros.this.global.Symbol)Macros.this.global.Symbol">sym</a>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        <a href="../../../reflect/internal/Types.scala.html#448096" title="(pre: Macros.this.global.Type, sym: Macros.this.global.Symbol, args: List[Macros.this.global.Type])Macros.this.global.Type">TypeRef</a><span class="delimiter">(</span>pre, <a href="#1111857" title="Macros.this.global.Symbol">sym1</a>, args<span class="delimiter">)</span>
      <span class="keyword">case</span> tpe =&gt;
        <a href="#1111980" title="(x: Macros.this.global.Type)Macros.this.global.Type">tpe</a>
    <span class="delimiter">}</span>

    // as stated in the spec, before being matched to macroimpl, type and value parameters of macrodef
    // undergo a special transformation, sigma, that adapts them to the different metalevel macroimpl lives in
    // as a result, we need to reverse this transformation when inferring macrodef ret from macroimpl ret
    <span class="keyword">def</span> <a title="(tpe: Macros.this.global.Type)Macros.this.global.Type" id="1111780">unsigma</a><span class="delimiter">(</span><a title="Macros.this.global.Type" id="1111991">tpe</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="Macros.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#441242" title="Macros.this.global.Type">Type</a> = <span class="delimiter">{</span>
      // unfortunately, we cannot dereference ``paramss'', because we're in the middle of inferring a type for ``macroDef''
//      val defParamss = macroDef.paramss
      <span class="keyword">val</span> <a title="List[List[Macros.this.global.Symbol]]" id="1111992">defParamss</a> = <a href="../../../reflect/internal/util/Collections.scala.html#440651" title="(xss: List[List[Macros.this.global.ValDef]])(f: Macros.this.global.ValDef =&gt; Macros.this.global.Symbol)List[List[Macros.this.global.Symbol]]">mmap</a><span class="delimiter">(</span><a href="#1111162" title="Macros.this.global.DefDef">macroDdef</a>.<a href="../../../reflect/api/Trees.scala.html#427502" title="=&gt; List[List[Macros.this.global.ValDef]]">vparamss</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1112011" title="Macros.this.global.ValDef">_</a>.<a href="../../../reflect/api/Trees.scala.html#427232" title="=&gt; Macros.this.global.Symbol">symbol</a><span class="delimiter">)</span>
      <span class="keyword">var</span> <a title="List[List[Macros.this.global.Symbol]]" id="1111993">implParamss</a> = <a href="#1111164" title="Macros.this.global.Symbol">macroImpl</a>.<a href="../../../reflect/internal/Symbols.scala.html#443448" title="=&gt; List[List[Macros.this.global.Symbol]]">paramss</a>
      <a href="#1111993" title="List[List[Macros.this.global.Symbol]]">implParamss</a> = <a href="#560428" title="(paramss: List[List[Macros.this.global.Symbol]], transform: (Macros.this.global.Symbol, Macros.this.global.Symbol) =&gt; Option[Macros.this.global.Symbol])List[List[Macros.this.global.Symbol]]">transformTypeTagEvidenceParams</a><span class="delimiter">(</span><a href="#1111993" title="List[List[Macros.this.global.Symbol]]">implParamss</a>, <span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1112015">param</a>, <a title="Macros.this.global.Symbol" id="1112016">tparam</a><span class="delimiter">)</span> =&gt; <a href="../../../Option.scala.html#2498" title="None.type">None</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="1111994">implCtxParam</a> = <span title="Macros.this.global.Symbol" class="keyword">if</span> <span class="delimiter">(</span><a href="#1111993" title="List[List[Macros.this.global.Symbol]]">implParamss</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57919" title="(x: Int)Boolean">&gt;</a> <span title="Int(0)" class="int">0</span> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../../collection/LinearSeqOptimized.scala.html#76165" title="(n: Int)List[Macros.this.global.Symbol]">implParamss</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57919" title="(x: Int)Boolean">&gt;</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="../../../collection/LinearSeqOptimized.scala.html#76165" title="(n: Int)List[Macros.this.global.Symbol]">implParamss</a><a href="../../../collection/LinearSeqOptimized.scala.html#76165" title="(n: Int)Macros.this.global.Symbol" class="delimiter">(</a><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
      <span class="keyword">def</span> <a title="(implParam: Macros.this.global.Symbol)Macros.this.global.Symbol" id="1111995">implParamToDefParam</a><span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1112051">implParam</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="Macros.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="Macros.this.global.Symbol">Symbol</a> = <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Option[(Int, Int)]" id="1112052">indices</a> = <span class="delimiter">(</span><span class="delimiter">(</span><span class="delimiter">(</span><a href="#1111993" title="List[List[Macros.this.global.Symbol]]">implParamss</a> <a href="../../../collection/immutable/List.scala.html#63667" title="(n: Int)List[List[Macros.this.global.Symbol]]">drop</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<a href="../../../collection/IterableLike.scala.html#59514" title="(implicit bf: scala.collection.generic.CanBuildFrom[List[List[Macros.this.global.Symbol]],(List[Macros.this.global.Symbol], Int),List[(List[Macros.this.global.Symbol], Int)]])List[(List[Macros.this.global.Symbol], Int)]">zipWithIndex</a><span class="delimiter">)</span> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: ((List[Macros.this.global.Symbol], Int)) =&gt; (Int, Int))(implicit bf: scala.collection.generic.CanBuildFrom[List[(List[Macros.this.global.Symbol], Int)],(Int, Int),List[(Int, Int)]])List[(Int, Int)]">map</a> <a title="anonymous class $anonfun extends scala.runtime.AbstractFunction1[(List[Macros.this.global.Symbol], Int),(Int, Int)] with Serializable" id="1112119" class="delimiter">{</a> <span class="keyword">case</span> <span class="delimiter">(</span>implParams, index<span class="delimiter">)</span> =&gt; <a href="#1112148" title="(x: (Int, Int))(Int, Int)" class="delimiter">(</a>index, implParams <a href="../../../collection/GenSeqLike.scala.html#59605" title="(elem: Macros.this.global.Symbol)Int">indexOf</a> <a href="#1112051" title="Macros.this.global.Symbol">implParam</a><span class="delimiter">)</span> <span class="delimiter">}</span> <a href="../../../collection/TraversableLike.scala.html#58981" title="(p: ((Int, Int)) =&gt; Boolean)List[(Int, Int)]">filter</a> <span class="delimiter">(</span><a href="#1112194" title="(Int, Int)">_</a>.<a href="../../../Tuple2.scala.html#61508" title="=&gt; Int">_2</a> <a href="../../../Int.scala.html#57898" title="(x: Int)Boolean">!=</a> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../../collection/TraversableLike.scala.html#59011" title="=&gt; Option[(Int, Int)]">headOption</a>
        <span class="keyword">val</span> <a title="Option[Macros.this.global.Symbol]" id="1112053">defParam</a> = <a href="#1112052" title="Option[(Int, Int)]">indices</a> <a href="../../../Option.scala.html#63826" title="(f: ((Int, Int)) =&gt; Option[Macros.this.global.Symbol])Option[Macros.this.global.Symbol]">flatMap</a> <a title="anonymous class $anonfun extends scala.runtime.AbstractFunction1[(Int, Int),Option[Macros.this.global.Symbol]] with Serializable" id="1112203" class="delimiter">{</a>
          <span class="keyword">case</span> <span class="delimiter">(</span>plistIndex, pIndex<span class="delimiter">)</span> =&gt;
            <a href="#1112258" title="(x: Option[Macros.this.global.Symbol])Option[Macros.this.global.Symbol]" class="keyword">if</a> <span class="delimiter">(</span><a href="#1111992" title="List[List[Macros.this.global.Symbol]]">defParamss</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57912" title="(x: Int)Boolean">&lt;=</a> plistIndex<span class="delimiter">)</span> <a href="../../../Option.scala.html#2498" title="None.type">None</a>
            <span class="keyword">else</span> <span title="Option[Macros.this.global.Symbol]" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../collection/LinearSeqOptimized.scala.html#76165" title="(n: Int)List[Macros.this.global.Symbol]">defParamss</a><span class="delimiter">(</span>plistIndex<span class="delimiter">)</span>.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57912" title="(x: Int)Boolean">&lt;=</a> pIndex<span class="delimiter">)</span> <a href="../../../Option.scala.html#2498" title="None.type">None</a>
            <span class="keyword">else</span> <a href="../../../Option.scala.html#64111" title="(x: Macros.this.global.Symbol)Some[Macros.this.global.Symbol]">Some</a><span class="delimiter">(</span><a href="../../../collection/LinearSeqOptimized.scala.html#76165" title="(n: Int)List[Macros.this.global.Symbol]">defParamss</a><a href="../../../collection/LinearSeqOptimized.scala.html#76165" title="(n: Int)Macros.this.global.Symbol" class="delimiter">(</a>plistIndex<span class="delimiter">)</span><span class="delimiter">(</span>pIndex<span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#1112053" title="Option[Macros.this.global.Symbol]">defParam</a>.<a href="../../../Option.scala.html#63817" title="(implicit ev: &lt;:&lt;[Null,Macros.this.global.Symbol])Macros.this.global.Symbol">orNull</a>
      <span class="delimiter">}</span>

      <span class="keyword">class</span> <a title="class UnsigmaTypeMap extends Macros.this.global.TypeMap" id="1111996">UnsigmaTypeMap</a> <a href="#1111996" title="UnsigmaTypeMap" class="keyword">extends</a> <a href="../../../reflect/internal/Types.scala.html#441429" title="Macros.this.global.TypeMap">TypeMap</a> <span class="delimiter">{</span>
        <span class="keyword">def</span> <a title="(tp: Macros.this.global.Type)Macros.this.global.Type" id="1112281">apply</a><span class="delimiter">(</span><a title="Macros.this.global.Type" id="1112283">tp</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="Macros.this.global.Type">Type</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#441242" title="Macros.this.global.Type">Type</a> = <a href="#1112283" title="Macros.this.global.Type">tp</a> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> TypeRef<a href="#1112438" title="Macros.this.global.Type" id="1112440" class="delimiter">(</a>pre, sym, args<span class="delimiter">)</span> =&gt;
            <span class="keyword">val</span> <a title="Macros.this.global.Type" id="1112294">pre1</a> = <a href="../../../reflect/internal/Types.scala.html#461427" title="=&gt; Macros.this.global.Type">pre</a> <span class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> SingleType<a href="#1112336" title="Boolean" id="1112339" class="delimiter">(</a>SingleType<a title="Boolean" id="1112342" class="delimiter">(</a>SingleType<a title="Macros.this.global.Type" id="1112345" class="delimiter">(</a><a href="../../../reflect/internal/Types.scala.html#441258" title="Macros.this.global.Type" id="1112354">NoPrefix</a>, param<span class="delimiter">)</span>, prefix<span class="delimiter">)</span>, value<span class="delimiter">)</span> <span class="keyword">if</span> param <span title="(x$1: AnyRef)Boolean">==</span> <a href="#1111994" title="Macros.this.global.Symbol">implCtxParam</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> prefix <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#442426" title="=&gt; Macros.this.global.Symbol">MacroContextPrefix</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> value <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#442398" title="=&gt; Macros.this.global.Symbol">ExprValue</a> =&gt;
                <a href="../../../reflect/internal/Types.scala.html#461307" title="(sym: Macros.this.global.Symbol)Macros.this.global.Type">ThisType</a><a href="#1112358" title="(x: Macros.this.global.Type)Macros.this.global.Type" class="delimiter">(</a><a href="#1111163" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; Macros.this.global.Symbol">owner</a><span class="delimiter">)</span>
              <span class="keyword">case</span> SingleType<span class="delimiter">(</span>SingleType<span class="delimiter">(</span><a href="../../../reflect/internal/Types.scala.html#441258" title="Macros.this.global.Type" id="1112355">NoPrefix</a>, param<span class="delimiter">)</span>, value<span class="delimiter">)</span> <span class="keyword">if</span> <a href="#1111995" title="(implParam: Macros.this.global.Symbol)Macros.this.global.Symbol">implParamToDefParam</a><span class="delimiter">(</span>param<span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> value <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#442398" title="=&gt; Macros.this.global.Symbol">ExprValue</a> =&gt;
                <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="1112334">macroDefParam</a> = <a href="#1111995" title="(implParam: Macros.this.global.Symbol)Macros.this.global.Symbol">implParamToDefParam</a><span class="delimiter">(</span>param<span class="delimiter">)</span>
                <a href="../../../reflect/internal/Types.scala.html#461424" title="(pre: Macros.this.global.Type, sym: Macros.this.global.Symbol)Macros.this.global.Type">SingleType</a><span class="delimiter">(</span><a href="../../../reflect/internal/Types.scala.html#441258" title="Macros.this.global.NoPrefix.type">NoPrefix</a>, <a href="#1112334" title="Macros.this.global.Symbol">macroDefParam</a><span class="delimiter">)</span>
              <span class="keyword">case</span> _ =&gt;
                <a href="#1112358" title="(x: Macros.this.global.Type)Macros.this.global.Type">pre</a>
            <span class="delimiter">}</span>
            <span class="keyword">val</span> <a title="List[Macros.this.global.Type]" id="1112295">args1</a> = args <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: Macros.this.global.Type =&gt; Macros.this.global.Type)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Type],Macros.this.global.Type,List[Macros.this.global.Type]])List[Macros.this.global.Type]">map</a> <a href="../../../reflect/internal/Types.scala.html#460841" title="(tp: Macros.this.global.Type)Macros.this.global.Type">mapOver</a>
            <a href="../../../reflect/internal/Types.scala.html#448096" title="(pre: Macros.this.global.Type, sym: Macros.this.global.Symbol, args: List[Macros.this.global.Type])Macros.this.global.Type">TypeRef</a><span class="delimiter">(</span><a href="#1112294" title="Macros.this.global.Type">pre1</a>, sym, <a href="#1112295" title="List[Macros.this.global.Type]">args1</a><span class="delimiter">)</span>
          <span class="keyword">case</span> _ =&gt;
            <a href="../../../reflect/internal/Types.scala.html#460841" title="(tp: Macros.this.global.Type)Macros.this.global.Type">mapOver</a><a href="#1112441" title="(x: Macros.this.global.Type)Macros.this.global.Type" class="delimiter">(</a><a href="#1112283" title="Macros.this.global.Type">tp</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span title="UnsigmaTypeMap" class="keyword">new</span> <a href="#1111996" title="UnsigmaTypeMap">UnsigmaTypeMap</a><span class="delimiter">(</span><span class="delimiter">)</span> <a href="#1112281" title="(tp: Macros.this.global.Type)Macros.this.global.Type">apply</a> <a href="#1111991" title="Macros.this.global.Type">tpe</a>
    <span class="delimiter">}</span>
    <a href="#1111779" title="Macros.this.global.Type">runtimeType</a> = <a href="#1111780" title="(tpe: Macros.this.global.Type)Macros.this.global.Type">unsigma</a><span class="delimiter">(</span><a href="#1111779" title="Macros.this.global.Type">runtimeType</a><span class="delimiter">)</span>

    <a href="#1111779" title="Macros.this.global.Type">runtimeType</a>
  <span class="delimiter">}</span>

  /** Primary mirror that is used to resolve and run macro implementations.
   *  Loads classes from -Xmacro-primary-classpath, or from -cp if the option is not specified.
   */
  <span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scala.reflect.runtime.Mirror" id="560432">primaryMirror</a>: <a href="../../../reflect/runtime/Mirror.scala.html#24615" title="scala.reflect.runtime.Mirror">Mirror</a> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="Analyzer.scala.html#560057" title="=&gt; scala.tools.nsc.Global">global</a>.<a href="../Global.scala.html#559775" title="=&gt; Boolean">forMSIL</a><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)UnsupportedOperationException" class="keyword">new</span> <a href="../../../package.scala.html#56966" title="UnsupportedOperationException">UnsupportedOperationException</a><span class="delimiter">(</span><span title="String(&quot;Scala reflection not available on this platform&quot;)" class="string">&quot;Scala reflection not available on this platform&quot;</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="ClassLoader" id="1112449">libraryClassLoader</a> = <span class="delimiter">{</span>
      <span title="ClassLoader" class="keyword">if</span> <span class="delimiter">(</span><a href="../Global.scala.html#559485" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#467623" title="=&gt; scala.tools.nsc.Settings#PathSetting">XmacroPrimaryClasspath</a>.<a href="../settings/MutableSettings.scala.html#613106" title="=&gt; String">value</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="../../../reflect/makro/util/Traces.scala.html#559471" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;primary macro mirror: initializing from -Xmacro-primary-classpath: %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="../Global.scala.html#559485" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#467623" title="=&gt; scala.tools.nsc.Settings#PathSetting">XmacroPrimaryClasspath</a>.<a href="../settings/MutableSettings.scala.html#613106" title="=&gt; String">value</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="List[java.net.URL]" id="1112462">classpath</a> = <a href="../util/ClassPath.scala.html#560403" title="(cp: String)List[java.net.URL]">toURLs</a><span class="delimiter">(</span><a href="../Global.scala.html#559485" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#467625" title="=&gt; scala.tools.nsc.Settings#PathSetting">XmacroFallbackClasspath</a>.<a href="../settings/MutableSettings.scala.html#613106" title="=&gt; String">value</a><span class="delimiter">)</span>
        <a href="../util/ScalaClassLoader.scala.html#51982" title="scala.tools.nsc.util.ScalaClassLoader.type">ScalaClassLoader</a>.<a href="../util/ScalaClassLoader.scala.html#576090" title="(urls: Seq[java.net.URL], parent: ClassLoader)scala.tools.nsc.util.ScalaClassLoader.URLClassLoader">fromURLs</a><span class="delimiter">(</span><a href="#1112462" title="List[java.net.URL]">classpath</a>, <a href="#49371" title="Macros.this.type">self</a>.<span title="()Class[_]">getClass</span>.<span title="()ClassLoader">getClassLoader</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="../../../reflect/makro/util/Traces.scala.html#559471" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;primary macro mirror: initializing from -cp: %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="Analyzer.scala.html#560057" title="=&gt; scala.tools.nsc.Global">global</a>.<a href="../Global.scala.html#559495" title="=&gt; scala.tools.nsc.util.ClassPath[Macros.this.global.platform.BinaryRepr]">classPath</a>.<a href="../util/ClassPath.scala.html#642554" title="=&gt; List[java.net.URL]">asURLs</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="List[java.net.URL]" id="1112473">classpath</a> = <a href="Analyzer.scala.html#560057" title="=&gt; scala.tools.nsc.Global">global</a>.<a href="../Global.scala.html#559495" title="=&gt; scala.tools.nsc.util.ClassPath[Macros.this.global.platform.BinaryRepr]">classPath</a>.<a href="../util/ClassPath.scala.html#642554" title="=&gt; List[java.net.URL]">asURLs</a>
        <span class="keyword">var</span> <a title="ClassLoader" id="1112474">loader</a>: <span title="ClassLoader">ClassLoader</span> = <a href="../util/ScalaClassLoader.scala.html#51982" title="scala.tools.nsc.util.ScalaClassLoader.type">ScalaClassLoader</a>.<a href="../util/ScalaClassLoader.scala.html#576090" title="(urls: Seq[java.net.URL], parent: ClassLoader)scala.tools.nsc.util.ScalaClassLoader.URLClassLoader">fromURLs</a><span class="delimiter">(</span><a href="#1112473" title="List[java.net.URL]">classpath</a>, <a href="#49371" title="Macros.this.type">self</a>.<span title="()Class[_]">getClass</span>.<span title="()ClassLoader">getClassLoader</span><span class="delimiter">)</span>

        // [Eugene] a heuristic to detect REPL
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="Analyzer.scala.html#560057" title="=&gt; scala.tools.nsc.Global">global</a>.<a href="../Global.scala.html#559485" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#467582" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">exposeEmptyPackage</a>.<a href="../settings/MutableSettings.scala.html#467820" title="=&gt; Boolean">value</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">import</span> scala.tools.nsc.interpreter._
          <span class="keyword">val</span> <a title="scala.tools.nsc.io.AbstractFile" id="1112487">virtualDirectory</a> = <a href="Analyzer.scala.html#560057" title="=&gt; scala.tools.nsc.Global">global</a>.<a href="../Global.scala.html#559485" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/MutableSettings.scala.html#467280" title="=&gt; scala.tools.nsc.Settings#OutputDirs">outputDirs</a>.<a href="../settings/MutableSettings.scala.html#598972" title="=&gt; Option[scala.tools.nsc.io.AbstractFile]">getSingleOutput</a>.<a href="../../../Option.scala.html#63813" title="=&gt; scala.tools.nsc.io.AbstractFile">get</a>
          <a href="#1112474" title="ClassLoader">loader</a> = <a href="#1112488" title="scala.tools.nsc.interpreter.AbstractFileClassLoader" class="keyword">new</a> <a href="../interpreter/AbstractFileClassLoader.scala.html#38448" title="anonymous class $anon extends scala.tools.nsc.interpreter.AbstractFileClassLoader" id="1112488">AbstractFileClassLoader</a><span class="delimiter">(</span><a href="#1112487" title="scala.tools.nsc.io.AbstractFile">virtualDirectory</a>, <a href="#1112474" title="ClassLoader">loader</a><span class="delimiter">)</span> <span class="delimiter">{</span><span class="delimiter">}</span>
        <span class="delimiter">}</span>

        <a href="#1112474" title="ClassLoader">loader</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <a href="#1112493" title="scala.reflect.runtime.Mirror" class="keyword">new</a> <a href="../../../reflect/runtime/Mirror.scala.html#24615" title="anonymous class $anon extends scala.reflect.runtime.Mirror" id="1112493">Mirror</a><span class="delimiter">(</span><a href="#1112449" title="ClassLoader">libraryClassLoader</a><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="1112495">toString</a> = <span title="String(&quot;&lt;primary macro mirror&gt;&quot;)" class="string">&quot;&lt;primary macro mirror&gt;&quot;</span> <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** Fallback mirror that is used to resolve and run macro implementations.
   *  Loads classes from -Xmacro-fallback-classpath aka &quot;macro fallback classpath&quot;.
   */
  <span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scala.reflect.runtime.Mirror" id="560434">fallbackMirror</a>: <a href="../../../reflect/runtime/Mirror.scala.html#24615" title="scala.reflect.runtime.Mirror">Mirror</a> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="Analyzer.scala.html#560057" title="=&gt; scala.tools.nsc.Global">global</a>.<a href="../Global.scala.html#559775" title="=&gt; Boolean">forMSIL</a><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)UnsupportedOperationException" class="keyword">new</span> <a href="../../../package.scala.html#56966" title="UnsupportedOperationException">UnsupportedOperationException</a><span class="delimiter">(</span><span title="String(&quot;Scala reflection not available on this platform&quot;)" class="string">&quot;Scala reflection not available on this platform&quot;</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="scala.tools.nsc.util.ScalaClassLoader.URLClassLoader" id="1112916">fallbackClassLoader</a> = <span class="delimiter">{</span>
      <a href="../../../reflect/makro/util/Traces.scala.html#559471" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;fallback macro mirror: initializing from -Xmacro-fallback-classpath: %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="../Global.scala.html#559485" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#467625" title="=&gt; scala.tools.nsc.Settings#PathSetting">XmacroFallbackClasspath</a>.<a href="../settings/MutableSettings.scala.html#613106" title="=&gt; String">value</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="List[java.net.URL]" id="1112921">classpath</a> = <a href="../util/ClassPath.scala.html#560403" title="(cp: String)List[java.net.URL]">toURLs</a><span class="delimiter">(</span><a href="../Global.scala.html#559485" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#467625" title="=&gt; scala.tools.nsc.Settings#PathSetting">XmacroFallbackClasspath</a>.<a href="../settings/MutableSettings.scala.html#613106" title="=&gt; String">value</a><span class="delimiter">)</span>
      <a href="../util/ScalaClassLoader.scala.html#51982" title="scala.tools.nsc.util.ScalaClassLoader.type">ScalaClassLoader</a>.<a href="../util/ScalaClassLoader.scala.html#576090" title="(urls: Seq[java.net.URL], parent: ClassLoader)scala.tools.nsc.util.ScalaClassLoader.URLClassLoader">fromURLs</a><span class="delimiter">(</span><a href="#1112921" title="List[java.net.URL]">classpath</a>, <a href="#49371" title="Macros.this.type">self</a>.<span title="()Class[_]">getClass</span>.<span title="()ClassLoader">getClassLoader</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="#1112929" title="scala.reflect.runtime.Mirror" class="keyword">new</a> <a href="../../../reflect/runtime/Mirror.scala.html#24615" title="anonymous class $anon extends scala.reflect.runtime.Mirror" id="1112929">Mirror</a><span class="delimiter">(</span><a href="#1112916" title="scala.tools.nsc.util.ScalaClassLoader.URLClassLoader">fallbackClassLoader</a><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="1112931">toString</a> = <span title="String(&quot;&lt;fallback macro mirror&gt;&quot;)" class="string">&quot;&lt;fallback macro mirror&gt;&quot;</span> <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** Produces a function that can be used to invoke macro implementation for a given macro definition:
   *    1) Looks up macro implementation symbol in this universe.
   *    2) Loads its enclosing class from the primary mirror.
   *    3) Loads the companion of that enclosing class from the primary mirror.
   *    4) Resolves macro implementation within the loaded companion.
   *    5) If 2-4 fails, repeats them for the fallback mirror.
   *
   *  @return Some(runtime) if macro implementation can be loaded successfully from either of the mirrors,
   *          None otherwise.
   */
  <span class="keyword">private</span> <span class="keyword">type</span> <a title="List[Any] =&gt; Any" id="560435">MacroRuntime</a> = List<span class="delimiter">[</span>Any<span class="delimiter">]</span> =&gt; Any
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.WeakHashMap[Macros.this.global.Symbol,Option[List[Any] =&gt; Any]]" id="560436">macroRuntimesCache</a> = <a href="../../../reflect/internal/SymbolTable.scala.html#440630" title="Macros.this.global.perRunCaches.type">perRunCaches</a>.<a href="../../../reflect/internal/SymbolTable.scala.html#492845" title="[K, V]()scala.collection.mutable.WeakHashMap[K,V]">newWeakMap</a><span title="()scala.collection.mutable.WeakHashMap[Macros.this.global.Symbol,Option[List[Any] =&gt; Any]]" class="delimiter">[</span><a href="../../../reflect/internal/Symbols.scala.html#441132" title="Macros.this.global.Symbol">Symbol</a>, <a href="../../../Option.scala.html#1510" title="Option[List[Any] =&gt; Any]">Option</a><span class="delimiter">[</span>MacroRuntime<span class="delimiter">]</span><span class="delimiter">]</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(macroDef: Macros.this.global.Symbol)Option[List[Any] =&gt; Any]" id="560438">macroRuntime</a><span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1113352">macroDef</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="Macros.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <a href="../../../Option.scala.html#1510" title="Option[List[Any] =&gt; Any]">Option</a><span class="delimiter">[</span>MacroRuntime<span class="delimiter">]</span> =
    <a href="#560436" title="=&gt; scala.collection.mutable.WeakHashMap[Macros.this.global.Symbol,Option[List[Any] =&gt; Any]]">macroRuntimesCache</a>.<a href="../../../collection/mutable/MapLike.scala.html#78517" title="(key: Macros.this.global.Symbol, op: =&gt; Option[List[Any] =&gt; Any])Option[List[Any] =&gt; Any]">getOrElseUpdate</a><span class="delimiter">(</span><a href="#1113352" title="Macros.this.global.Symbol">macroDef</a>, <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Option[List[Any] =&gt; Any]" id="1113356">runtime</a> = <span class="delimiter">{</span>
        <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: Macros.this.global.Symbol)Macros.this.global.Symbol">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;looking for macro implementation: &quot;)" class="string">&quot;looking for macro implementation: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1113352" title="Macros.this.global.Symbol">macroDef</a><span class="delimiter">)</span>
        <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: List[Macros.this.global.AnnotationInfo])List[Macros.this.global.AnnotationInfo]">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;macroDef is annotated with: &quot;)" class="string">&quot;macroDef is annotated with: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1113352" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#443459" title="=&gt; List[Macros.this.global.AnnotationInfo]">annotations</a><span class="delimiter">)</span>

        <span class="keyword">val</span> <a title="Option[Macros.this.global.AnnotationInfo]" id="1113357">ann</a> = <a href="#1113352" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/AnnotationInfos.scala.html#442127" title="(cls: Macros.this.global.Symbol)Option[Macros.this.global.AnnotationInfo]">getAnnotation</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#442430" title="=&gt; Macros.this.global.ClassSymbol">MacroImplAnnotation</a><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1113357" title="Option[Macros.this.global.AnnotationInfo]">ann</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../Option.scala.html#2498" title="None.type">None</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: Macros.this.global.Symbol)Macros.this.global.Symbol">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;@macroImpl annotation is missing (this means that macro definition failed to typecheck)&quot;)" class="string">&quot;@macroImpl annotation is missing (this means that macro definition failed to typecheck)&quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1113352" title="Macros.this.global.Symbol">macroDef</a><span class="delimiter">)</span>
          <span title="Nothing" class="keyword">return</span> <a href="../../../Option.scala.html#2498" title="None.type">None</a>
        <span class="delimiter">}</span>

        <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="1113358">macroImpl</a> = <a href="#1113357" title="Option[Macros.this.global.AnnotationInfo]">ann</a>.<a href="../../../Option.scala.html#63813" title="=&gt; Macros.this.global.AnnotationInfo">get</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76165" title="(n: Int)Macros.this.global.Tree">args</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Macros.this.global.Symbol">symbol</a>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1113358" title="Macros.this.global.Symbol">macroImpl</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; Macros.this.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: Macros.this.global.Symbol)Macros.this.global.Symbol">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;@macroImpl annotation is malformed (this means that macro definition failed to typecheck)&quot;)" class="string">&quot;@macroImpl annotation is malformed (this means that macro definition failed to typecheck)&quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1113352" title="Macros.this.global.Symbol">macroDef</a><span class="delimiter">)</span>
          <span title="Nothing" class="keyword">return</span> <a href="../../../Option.scala.html#2498" title="None.type">None</a>
        <span class="delimiter">}</span>

        <a href="../../../reflect/makro/util/Traces.scala.html#559471" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;resolved implementation %s at %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1113358" title="Macros.this.global.Symbol">macroImpl</a>, <a href="#1113358" title="Macros.this.global.Symbol">macroImpl</a>.<a href="../../../reflect/internal/Symbols.scala.html#443167" title="=&gt; Macros.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1113358" title="Macros.this.global.Symbol">macroImpl</a>.<a href="../../../reflect/internal/Symbols.scala.html#443318" title="=&gt; Boolean">isErroneous</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: Macros.this.global.Symbol)Macros.this.global.Symbol">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;macro implementation is erroneous (this means that either macro body or macro implementation signature failed to typecheck)&quot;)" class="string">&quot;macro implementation is erroneous (this means that either macro body or macro implementation signature failed to typecheck)&quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1113352" title="Macros.this.global.Symbol">macroDef</a><span class="delimiter">)</span>
          <span title="Nothing" class="keyword">return</span> <a href="../../../Option.scala.html#2498" title="None.type">None</a>
        <span class="delimiter">}</span>

        <span class="keyword">def</span> <a title="(macroMirror: scala.reflect.runtime.Mirror)Option[(Object, macroMirror.Symbol)]" id="1113359">loadMacroImpl</a><span class="delimiter">(</span><a title="scala.reflect.runtime.Mirror" id="1113416">macroMirror</a>: <a href="../../../reflect/runtime/Mirror.scala.html#24615" title="scala.reflect.runtime.Mirror">Mirror</a><span class="delimiter">)</span>: <a href="../../../Option.scala.html#1510" title="Option[(Object, macroMirror.Symbol)]">Option</a><span class="delimiter">[</span><span class="delimiter">(</span>Object, macroMirror.Symbol<span class="delimiter">)</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
          <span class="keyword">try</span> <span class="delimiter">{</span>
            // this logic relies on the assumptions that were valid for the old macro prototype
            // namely that macro implementations can only be defined in top-level classes and modules
            // with the new prototype that materialized in a SIP, macros need to be statically accessible, which is different
            // for example, a macro def could be defined in a trait that is implemented by an object
            // there are some more clever cases when seemingly non-static method ends up being statically accessible
            // however, the code below doesn't account for these guys, because it'd take a look of time to get it right
            // for now I leave it as a todo and move along to more the important stuff

            <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: String)String">macroTraceVerbose</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;loading implementation class from %s: &quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1113416" title="scala.reflect.runtime.Mirror">macroMirror</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1113358" title="Macros.this.global.Symbol">macroImpl</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; Macros.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#443398" title="=&gt; String">fullName</a><span class="delimiter">)</span>
            <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: String)String">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;classloader is: &quot;)" class="string">&quot;classloader is: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;%s of type %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1113416" title="scala.reflect.runtime.Mirror">macroMirror</a>.<a href="../../../reflect/runtime/Mirror.scala.html#591643" title="=&gt; ClassLoader">classLoader</a>, <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#1113416" title="scala.reflect.runtime.Mirror">macroMirror</a>.<a href="../../../reflect/runtime/Mirror.scala.html#591643" title="=&gt; ClassLoader">classLoader</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#1113416" title="scala.reflect.runtime.Mirror">macroMirror</a>.<a href="../../../reflect/runtime/Mirror.scala.html#591643" title="=&gt; ClassLoader">classLoader</a>.<span title="()Class[_]">getClass</span>.<span title="()String">toString</span> <span class="keyword">else</span> <span title="String(&quot;primordial classloader&quot;)" class="string">&quot;primordial classloader&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="keyword">def</span> <a title="(cl: ClassLoader)String" id="1113417">inferClasspath</a><span class="delimiter">(</span><a title="ClassLoader" id="1113452">cl</a>: <span title="ClassLoader">ClassLoader</span><span class="delimiter">)</span> = <a href="#1113452" title="ClassLoader">cl</a> <span class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <a href="#1113575" title="String" id="1113578">cl</a>: java.net.URLClassLoader =&gt; <span title="String(&quot;[&quot;)" class="string">&quot;[&quot;</span> <span title="(x$1: Any)String">+</span> <span class="delimiter">(</span>cl.<a href="../../../Predef.scala.html#8521" title="(xs: Array[java.net.URL])scala.collection.mutable.ArrayOps[java.net.URL]">getURLs</a> <a href="../../../collection/TraversableOnce.scala.html#59190" title="(sep: String)String">mkString</a> <span title="String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span> <a href="#1113580" title="(x: String)String">+</a> <span title="String(&quot;]&quot;)" class="string">&quot;]&quot;</span>
              <span class="keyword">case</span> <a href="#1113575" title="String" id="1113579" class="keyword">null</a> =&gt; <span title="String(&quot;[&quot;)" class="string">&quot;[&quot;</span> <span title="(x$1: Any)String">+</span> scala.tools.util.<a href="../../util/PathResolver.scala.html#52827" title="scala.tools.util.PathResolver.type">PathResolver</a>.<a href="../../util/PathResolver.scala.html#577391" title="tools.util.PathResolver.Environment.type">Environment</a>.<a href="../../util/PathResolver.scala.html#577401" title="=&gt; String">javaBootClassPath</a> <a href="#1113580" title="(x: String)String">+</a> <span title="String(&quot;]&quot;)" class="string">&quot;]&quot;</span>
              <span class="keyword">case</span> _ =&gt; <a href="#1113580" title="(x: String)String" class="string">&quot;&lt;unknown&gt;&quot;</a>
            <span class="delimiter">}</span>
            <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: String)String">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;classpath is: &quot;)" class="string">&quot;classpath is: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1113417" title="(cl: ClassLoader)String">inferClasspath</a><span class="delimiter">(</span><a href="#1113416" title="scala.reflect.runtime.Mirror">macroMirror</a>.<a href="../../../reflect/runtime/Mirror.scala.html#591643" title="=&gt; ClassLoader">classLoader</a><span class="delimiter">)</span><span class="delimiter">)</span>

            // [Eugene] relies on the fact that macro implementations can only be defined in static classes
            // [Martin to Eugene] There's similar logic buried in Symbol#flatname. Maybe we can refactor?
            <span class="keyword">def</span> <a title="(sym: Macros.this.global.Symbol)String" id="1113418">classfile</a><span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1113595">sym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="Macros.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
              <span class="keyword">def</span> <a title="(sym: Macros.this.global.Symbol)String" id="1113596">recur</a><span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1113597">sym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="Macros.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="String">String</span> = <a href="#1113597" title="Macros.this.global.Symbol">sym</a> <span class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> sym <span class="keyword">if</span> sym.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; Macros.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#443287" title="=&gt; Boolean">isPackageClass</a> =&gt;
                  <span class="keyword">val</span> <a title="String" id="1113600">suffix</a> = <span title="String" class="keyword">if</span> <span class="delimiter">(</span>sym.<a href="../../../reflect/internal/Symbols.scala.html#443245" title="=&gt; Boolean">isModuleClass</a><span class="delimiter">)</span> <span title="String(&quot;$&quot;)" class="string">&quot;$&quot;</span> <span class="keyword">else</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span>
                  sym.<a href="../../../reflect/internal/Symbols.scala.html#443398" title="=&gt; String">fullName</a> <span title="(x$1: Any)String">+</span> <a href="#1113600" title="String">suffix</a>
                <span class="keyword">case</span> sym =&gt;
                  <span class="keyword">val</span> <a title="String" id="1113604">separator</a> = <span title="String" class="keyword">if</span> <span class="delimiter">(</span>sym.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; Macros.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#443245" title="=&gt; Boolean">isModuleClass</a><span class="delimiter">)</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span> <span class="keyword">else</span> <span title="String(&quot;$&quot;)" class="string">&quot;$&quot;</span>
                  <a href="#1113596" title="(sym: Macros.this.global.Symbol)String">recur</a><span class="delimiter">(</span>sym.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; Macros.this.global.Symbol">owner</a><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <a href="#1113604" title="String">separator</a> <span title="(x$1: Any)String">+</span> sym.<a href="../../../reflect/internal/Symbols.scala.html#443392" title="=&gt; Macros.this.global.Name">javaSimpleName</a>.<a href="../../../Function1.scala.html#59562" title="()String">toString</a>
              <span class="delimiter">}</span>

              <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#1113595" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443231" title="=&gt; Boolean">isClass</a> <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <a href="#1113595" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443270" title="=&gt; Boolean">isModule</a><span class="delimiter">)</span> <a href="#1113596" title="(sym: Macros.this.global.Symbol)String">recur</a><span class="delimiter">(</span><a href="#1113595" title="Macros.this.global.Symbol">sym</a><span class="delimiter">)</span>
              <span class="keyword">else</span> <a href="#1113596" title="(sym: Macros.this.global.Symbol)String">recur</a><span class="delimiter">(</span><a href="#1113595" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443480" title="=&gt; Macros.this.global.Symbol">enclClass</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>

            // [Eugene] this doesn't work for inner classes
            // neither does macroImpl.owner.javaClassName, so I had to roll my own implementation
            //val receiverName = macroImpl.owner.fullName
            <span class="keyword">val</span> <a title="String" id="1113419">implClassName</a> = <a href="#1113418" title="(sym: Macros.this.global.Symbol)String">classfile</a><span class="delimiter">(</span><a href="#1113358" title="Macros.this.global.Symbol">macroImpl</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; Macros.this.global.Symbol">owner</a><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="macroMirror.Symbol" id="1113420">implClassSymbol</a>: macroMirror.<a href="../../../reflect/internal/Symbols.scala.html#441132" title="macroMirror.Symbol">Symbol</a> = <a href="#1113416" title="scala.reflect.runtime.Mirror">macroMirror</a>.<a href="../../../reflect/runtime/Mirror.scala.html#591648" title="(name: String)macroMirror.Symbol">symbolForName</a><span class="delimiter">(</span><a href="#1113419" title="String">implClassName</a><span class="delimiter">)</span>

            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../reflect/makro/util/Traces.scala.html#559464" title="=&gt; Boolean">macroDebugVerbose</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="../../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><span class="delimiter">(</span><span title="String(&quot;implClassSymbol is: &quot;)" class="string">&quot;implClassSymbol is: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1113420" title="macroMirror.Symbol">implClassSymbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443557" title="=&gt; String">fullNameString</a><span class="delimiter">)</span>

              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1113420" title="macroMirror.Symbol">implClassSymbol</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#1113416" title="scala.reflect.runtime.Mirror">macroMirror</a>.<a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; macroMirror.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">val</span> <a title="Class[_]" id="1113619">implClass</a> = <a href="#1113416" title="scala.reflect.runtime.Mirror">macroMirror</a>.<a href="../../../reflect/runtime/ScalaToJava.scala.html#575978" title="(clazz: macroMirror.Symbol)Class[_]">classToJava</a><span class="delimiter">(</span><a href="#1113420" title="macroMirror.Symbol">implClassSymbol</a><span class="delimiter">)</span>
                <span class="keyword">val</span> <a title="java.security.CodeSource" id="1113620">implSource</a> = <a href="#1113619" title="Class[_]">implClass</a>.<span title="()java.security.ProtectionDomain">getProtectionDomain</span>.<span title="()java.security.CodeSource">getCodeSource</span>
                <a href="../../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;implClass is %s from %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1113619" title="Class[_]">implClass</a>, <a href="#1113620" title="java.security.CodeSource">implSource</a><span class="delimiter">)</span><span class="delimiter">)</span>
                <a href="../../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;implClassLoader is %s with classpath %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1113619" title="Class[_]">implClass</a>.<span title="()ClassLoader">getClassLoader</span>, <a href="#1113417" title="(cl: ClassLoader)String">inferClasspath</a><span class="delimiter">(</span><a href="#1113619" title="Class[_]">implClass</a>.<span title="()ClassLoader">getClassLoader</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>

            <span class="keyword">val</span> <a title="macroMirror.Symbol" id="1113421">implObjSymbol</a> = <a href="#1113420" title="macroMirror.Symbol">implClassSymbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443510" title="=&gt; macroMirror.Symbol">companionModule</a>
            <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: String)String">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;implObjSymbol is: &quot;)" class="string">&quot;implObjSymbol is: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1113421" title="macroMirror.Symbol">implObjSymbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443557" title="=&gt; String">fullNameString</a><span class="delimiter">)</span>

            <span title="Option[(Object, macroMirror.Symbol)]" class="keyword">if</span> <span class="delimiter">(</span><a href="#1113421" title="macroMirror.Symbol">implObjSymbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#1113416" title="scala.reflect.runtime.Mirror">macroMirror</a>.<a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; macroMirror.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <a href="../../../Option.scala.html#2498" title="None.type">None</a>
            <span class="keyword">else</span> <span class="delimiter">{</span>
              // yet another reflection method that doesn't work for inner classes
              //val receiver = macroMirror.companionInstance(receiverClass)
              <span class="keyword">val</span> <a title="Object" id="1113645">implObj</a> = <span class="keyword">try</span> <span class="delimiter">{</span>
                <span class="keyword">val</span> <a title="Class[_]" id="1113646">implObjClass</a> = java.lang.<span title="Class.type">Class</span>.<span title="(x$1: String, x$2: Boolean, x$3: ClassLoader)Class[_]">forName</span><span class="delimiter">(</span><a href="#1113419" title="String">implClassName</a>, <span title="Boolean(true)" class="keyword">true</span>, <a href="#1113416" title="scala.reflect.runtime.Mirror">macroMirror</a>.<a href="../../../reflect/runtime/Mirror.scala.html#591643" title="=&gt; ClassLoader">classLoader</a><span class="delimiter">)</span>
                <a href="#1113646" title="Class[_]">implObjClass</a> <span title="(x$1: String)java.lang.reflect.Field">getField</span> <span title="String(&quot;MODULE$&quot;)" class="string">&quot;MODULE$&quot;</span> <span title="(x$1: Any)Object">get</span> <span title="Null(null)" class="keyword">null</span>
              <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <a title="Null" id="1113651">ex</a>: <span title="NoSuchFieldException">NoSuchFieldException</span> =&gt; <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: NoSuchFieldException)NoSuchFieldException">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;exception when loading implObj: &quot;)" class="string">&quot;exception when loading implObj: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1113651" title="NoSuchFieldException">ex</a><span class="delimiter">)</span>; <span title="Null(null)" class="keyword">null</span>
                <span class="keyword">case</span> <a title="Null" id="1113658">ex</a>: <span title="NoClassDefFoundError">NoClassDefFoundError</span> =&gt; <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: NoClassDefFoundError)NoClassDefFoundError">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;exception when loading implObj: &quot;)" class="string">&quot;exception when loading implObj: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1113658" title="NoClassDefFoundError">ex</a><span class="delimiter">)</span>; <span title="Null(null)" class="keyword">null</span>
                <span class="keyword">case</span> <a title="Null" id="1113665">ex</a>: <span title="ClassNotFoundException">ClassNotFoundException</span> =&gt; <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: ClassNotFoundException)ClassNotFoundException">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;exception when loading implObj: &quot;)" class="string">&quot;exception when loading implObj: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1113665" title="ClassNotFoundException">ex</a><span class="delimiter">)</span>; <span title="Null(null)" class="keyword">null</span>
              <span class="delimiter">}</span>

              <span title="Option[(Object, macroMirror.Symbol)]" class="keyword">if</span> <span class="delimiter">(</span><a href="#1113645" title="Object">implObj</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="../../../Option.scala.html#2498" title="None.type">None</a>
              <span class="keyword">else</span> <span class="delimiter">{</span>
                <span class="keyword">val</span> <a title="macroMirror.Symbol" id="1113677">implMethSymbol</a> = <a href="#1113421" title="macroMirror.Symbol">implObjSymbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443427" title="=&gt; macroMirror.Type">info</a>.<a href="../../../reflect/internal/Types.scala.html#442028" title="(name: macroMirror.Name)macroMirror.Symbol">member</a><span class="delimiter">(</span><a href="#1113416" title="scala.reflect.runtime.Mirror">macroMirror</a>.<a href="../../../reflect/runtime/SynchronizedOps.scala.html#576003" title="(s: String)macroMirror.TermName">newTermName</a><span class="delimiter">(</span><a href="#1113358" title="Macros.this.global.Symbol">macroImpl</a>.<a href="../../../reflect/internal/Symbols.scala.html#443152" title="=&gt; macroImpl.NameType">name</a>.<a href="../../../Function1.scala.html#59562" title="()String">toString</a><span class="delimiter">)</span><span class="delimiter">)</span>
                <a href="../../../reflect/makro/util/Traces.scala.html#559471" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><span title="String(&quot;implMethSymbol is: &quot;)" class="string">&quot;implMethSymbol is: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1113677" title="macroMirror.Symbol">implMethSymbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443557" title="=&gt; String">fullNameString</a><span class="delimiter">)</span>
                <a href="../../../reflect/makro/util/Traces.scala.html#559471" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><span title="String(&quot;jimplMethSymbol is: &quot;)" class="string">&quot;jimplMethSymbol is: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1113416" title="scala.reflect.runtime.Mirror">macroMirror</a>.<a href="../../../reflect/runtime/ScalaToJava.scala.html#575981" title="(meth: macroMirror.Symbol)java.lang.reflect.Method">methodToJava</a><span class="delimiter">(</span><a href="#1113677" title="macroMirror.Symbol">implMethSymbol</a><span class="delimiter">)</span><span class="delimiter">)</span>

                <span title="Option[(Object, macroMirror.Symbol)]" class="keyword">if</span> <span class="delimiter">(</span><a href="#1113677" title="macroMirror.Symbol">implMethSymbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#1113416" title="scala.reflect.runtime.Mirror">macroMirror</a>.<a href="../../../reflect/internal/Symbols.scala.html#441152" title="=&gt; macroMirror.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <a href="../../../Option.scala.html#2498" title="None.type">None</a>
                <span class="keyword">else</span> <span class="delimiter">{</span>
                  <a href="../../../reflect/makro/util/Traces.scala.html#559471" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;successfully loaded macro impl as (%s, %s)&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1113645" title="Object">implObj</a>, <a href="#1113677" title="macroMirror.Symbol">implMethSymbol</a><span class="delimiter">)</span><span class="delimiter">)</span>
                  <a href="../../../Option.scala.html#64111" title="(x: (Object, macroMirror.Symbol))Some[(Object, macroMirror.Symbol)]">Some</a><span class="delimiter">(</span><a href="../../../Tuple2.scala.html#63804" title="(_1: Object, _2: macroMirror.Symbol)(Object, macroMirror.Symbol)" class="delimiter">(</a><a href="#1113645" title="Object">implObj</a>, <a href="#1113677" title="macroMirror.Symbol">implMethSymbol</a><span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="delimiter">}</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a title="None.type" id="1113704">ex</a>: <span title="ClassNotFoundException">ClassNotFoundException</span> =&gt;
              <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: String)String">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;implementation class failed to load: &quot;)" class="string">&quot;implementation class failed to load: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1113704" title="ClassNotFoundException">ex</a>.<span title="()String">toString</span><span class="delimiter">)</span>
              <a href="../../../Option.scala.html#2498" title="None.type">None</a>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>

        <span class="keyword">val</span> <a title="Option[(Object, Macros.this.primaryMirror.Symbol)]" id="1113360">primary</a> = <a href="#1113359" title="(macroMirror: scala.reflect.runtime.Mirror)Option[(Object, macroMirror.Symbol)]">loadMacroImpl</a><span class="delimiter">(</span><a href="#560431" title="=&gt; scala.reflect.runtime.Mirror">primaryMirror</a><span class="delimiter">)</span>
        <a href="#1113360" title="Option[(Object, Macros.this.primaryMirror.Symbol)]">primary</a> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> Some<a href="#1113781" title="Option[List[Any] =&gt; Any]" id="1113783" class="delimiter">(</a><span class="delimiter">(</span>implObj, implMethSymbol<span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
            <span class="keyword">def</span> <a title="(args: List[Any])Any" id="1113717">runtime</a><span class="delimiter">(</span><a title="List[Any]" id="1113718">args</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[Any]">List</a><span class="delimiter">[</span>Any<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#560431" title="=&gt; scala.reflect.runtime.Mirror">primaryMirror</a>.<a href="../../../reflect/runtime/Mirror.scala.html#591654" title="(receiver: AnyRef, meth: Macros.this.primaryMirror.Symbol)(args: Any*)Any">invoke</a><span class="delimiter">(</span>implObj, implMethSymbol<span class="delimiter">)</span><span class="delimiter">(</span><a href="#1113718" title="List[Any]">args</a>: _*<span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Any" class="delimiter">[</span><span title="Any">Any</span><span class="delimiter">]</span>
            <a href="../../../Option.scala.html#64111" title="(x: List[Any] =&gt; Any)Some[List[Any] =&gt; Any]">Some</a><span class="delimiter">(</span><a href="#1113717" title="(args: List[Any])Any">runtime</a> _<span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="../../../Option.scala.html#2498" title="Option[List[Any] =&gt; Any]" id="1113785">None</a> =&gt;
            <a href="#1113786" title="(x: Option[List[Any] =&gt; Any])Option[List[Any] =&gt; Any]" class="keyword">if</a> <span class="delimiter">(</span><a href="../Global.scala.html#559485" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#467625" title="=&gt; scala.tools.nsc.Settings#PathSetting">XmacroFallbackClasspath</a>.<a href="../settings/MutableSettings.scala.html#613106" title="=&gt; String">value</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="../../../reflect/makro/util/Traces.scala.html#559471" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;trying to load macro implementation from the fallback mirror: %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="../Global.scala.html#559485" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#467625" title="=&gt; scala.tools.nsc.Settings#PathSetting">XmacroFallbackClasspath</a>.<a href="../settings/MutableSettings.scala.html#613106" title="=&gt; String">value</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="keyword">val</span> <a title="Option[(Object, Macros.this.fallbackMirror.Symbol)]" id="1113734">fallback</a> = <a href="#1113359" title="(macroMirror: scala.reflect.runtime.Mirror)Option[(Object, macroMirror.Symbol)]">loadMacroImpl</a><span class="delimiter">(</span><a href="#560433" title="=&gt; scala.reflect.runtime.Mirror">fallbackMirror</a><span class="delimiter">)</span>
              <a href="#1113734" title="Option[(Object, Macros.this.fallbackMirror.Symbol)]">fallback</a> <span class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> Some<a href="#1113767" title="Option[List[Any] =&gt; Any]" id="1113769" class="delimiter">(</a><span class="delimiter">(</span>implObj, implMethSymbol<span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
                  <span class="keyword">def</span> <a title="(args: List[Any])Any" id="1113744">runtime</a><span class="delimiter">(</span><a title="List[Any]" id="1113745">args</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[Any]">List</a><span class="delimiter">[</span>Any<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#560433" title="=&gt; scala.reflect.runtime.Mirror">fallbackMirror</a>.<a href="../../../reflect/runtime/Mirror.scala.html#591654" title="(receiver: AnyRef, meth: Macros.this.fallbackMirror.Symbol)(args: Any*)Any">invoke</a><span class="delimiter">(</span>implObj, implMethSymbol<span class="delimiter">)</span><span class="delimiter">(</span><a href="#1113745" title="List[Any]">args</a>: _*<span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Any" class="delimiter">[</span><span title="Any">Any</span><span class="delimiter">]</span>
                  <a href="../../../Option.scala.html#64111" title="(x: List[Any] =&gt; Any)Some[List[Any] =&gt; Any]">Some</a><span class="delimiter">(</span><a href="#1113744" title="(args: List[Any])Any">runtime</a> _<span class="delimiter">)</span>
                <span class="keyword">case</span> <a href="../../../Option.scala.html#2498" title="Option[List[Any] =&gt; Any]" id="1113771">None</a> =&gt;
                  <a href="#1113772" title="(x: Option[List[Any] =&gt; Any])Option[List[Any] =&gt; Any]">None</a>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
              <a href="../../../Option.scala.html#2498" title="None.type">None</a>
            <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#1113356" title="Option[List[Any] =&gt; Any]">runtime</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../Option.scala.html#2498" title="None.type">None</a><span class="delimiter">)</span> <a href="#1113352" title="Macros.this.global.Symbol">macroDef</a> <a href="../../../reflect/internal/Symbols.scala.html#443305" title="(mask: Long)macroDef.type">setFlag</a> <span title="Long(4294967296L)">IS_ERROR</span>
      <a href="#1113356" title="Option[List[Any] =&gt; Any]">runtime</a>
    <span class="delimiter">}</span><span class="delimiter">)</span>

  /** Should become private again once we're done with migrating typetag generation from implicits */
  <span class="keyword">def</span> <a title="(typer: Macros.this.Typer, prefixTree: Macros.this.global.Tree, expandeeTree: Macros.this.global.Tree)scala.reflect.makro.runtime.Context{val mirror: Macros.this.global.type}" id="560439">macroContext</a><span class="delimiter">(</span><a title="Macros.this.Typer" id="1113804">typer</a>: <a href="Typers.scala.html#560207" title="Macros.this.Typer">Typer</a>, <a title="Macros.this.global.Tree" id="1113805">prefixTree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a>, <a title="Macros.this.global.Tree" id="1113806">expandeeTree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="#1113807" title="Macros extends scala.reflect.makro.runtime.Context">MacroContext</a> <span class="delimiter">{</span> <span class="keyword">val</span> mirror: global.<span class="keyword">type</span> <span class="delimiter">}</span> =
    <a href="#1113810" title="scala.reflect.makro.runtime.Context{}" class="keyword">new</a> <a title="anonymous class $anon extends scala.reflect.makro.runtime.Context" id="1113810" class="delimiter">{</a>
      <span class="keyword">val</span> <a title="Macros.this.global.type" id="1113972">mirror</a>: global.<span class="keyword">type</span> = <a href="Analyzer.scala.html#560057" title="=&gt; scala.tools.nsc.Global">global</a>
      <span class="keyword">val</span> <a title="mirror.analyzer.Typer" id="1113973">callsiteTyper</a>: mirror.analyzer.<a href="Typers.scala.html#560207" title="mirror.analyzer.Typer">Typer</a> = <a href="#1113804" title="Macros.this.Typer">typer</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Macros.this.global.analyzer.Typer" class="delimiter">[</span>global.analyzer.<a href="Typers.scala.html#560207" title="Macros.this.global.analyzer.Typer">Typer</a><span class="delimiter">]</span>
      // todo. infer precise typetag for this Expr, namely the PrefixType member of the Context refinement
      <span class="keyword">val</span> <a title="Macros.this.global.Expr[Nothing]" id="1113974">prefix</a> = <a href="../../../reflect/api/Exprs.scala.html#431889" title="(tree: Macros.this.global.Tree)(implicit evidence$1: Macros.this.global.TypeTag[Nothing])Macros.this.global.Expr[Nothing]">Expr</a><span class="delimiter">(</span><a href="#1113805" title="Macros.this.global.Tree">prefixTree</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="../../../reflect/api/TypeTags.scala.html#23827" title="Macros.this.global.TypeTag.type">TypeTag</a>.<a href="../../../reflect/api/TypeTags.scala.html#63495" title="=&gt; Macros.this.global.TypeTag[Nothing]">Nothing</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Macros.this.global.Tree" id="1113975">expandee</a> = <a href="#1113806" title="Macros.this.global.Tree">expandeeTree</a>
    <span class="delimiter">}</span> <span class="keyword">with</span> <a href="../../../reflect/makro/runtime/Context.scala.html#23910" title="scala.reflect.makro.runtime.Context">MacroContext</a> <span class="delimiter">{</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="1113838">toString</a> = <a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;MacroContext(%s@%s +%d)&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1113975" title="=&gt; Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Macros.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443152" title="=&gt; Macros.this.global.Symbol#NameType">name</a>, <a href="#1113975" title="=&gt; Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; Macros.this.global.Position">pos</a>, <a href="../../../reflect/makro/runtime/Enclosures.scala.html#559371" title="=&gt; List[scala.reflect.makro.runtime.Context]">enclosingMacros</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57955" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span> /* exclude myself */<span class="delimiter">)</span>
    <span class="delimiter">}</span>

  /** Calculate the arguments to pass to a macro implementation when expanding the provided tree.
   *
   *  This includes inferring the exact type and instance of the macro context to pass, and also
   *  allowing for missing parameter sections in macro implementation (see ``macroImplParamsss'' for more info).
   *
   *  @return list of runtime objects to pass to the implementation obtained by ``macroRuntime''
   */
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree)Option[List[Any]]" id="560440">macroArgs</a><span class="delimiter">(</span><a title="Macros.this.Typer" id="1113992">typer</a>: <a href="Typers.scala.html#560207" title="Macros.this.Typer">Typer</a>, <a title="Macros.this.global.Tree" id="1113993">expandee</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../Option.scala.html#1510" title="Option[List[Any]]">Option</a><span class="delimiter">[</span>List<span class="delimiter">[</span>Any<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="1113995">macroDef</a>         = <a href="#1113993" title="Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Macros.this.global.Symbol">symbol</a>
    <span class="keyword">val</span> <a title="Option[List[Any] =&gt; Any]" id="1113996">runtime</a>          = <a href="#560438" title="(macroDef: Macros.this.global.Symbol)Option[List[Any] =&gt; Any]">macroRuntime</a><span class="delimiter">(</span><a href="#1113995" title="Macros.this.global.Symbol">macroDef</a><span class="delimiter">)</span> <a href="../../../Option.scala.html#63845" title="(alternative: =&gt; Option[List[Any] =&gt; Any])Option[List[Any] =&gt; Any]">orElse</a> <span class="delimiter">{</span> <span title="Nothing" class="keyword">return</span> <a href="../../../Option.scala.html#2498" title="None.type">None</a> <span class="delimiter">}</span>
    <span class="keyword">var</span> <a title="Macros.this.global.Tree" id="1113997">prefixTree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a> = <a href="../../../reflect/api/Trees.scala.html#23577" title="Macros.this.global.EmptyTree.type">EmptyTree</a>
    <span class="keyword">var</span> <a title="List[Macros.this.global.Tree]" id="1113998">typeArgs</a>         = List<span class="delimiter">[</span>Tree<span class="delimiter">]</span><a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type" class="delimiter">(</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ListBuffer[List[Macros.this.global.Expr[_]]]" id="1113999">exprArgs</a>         = <a href="../../../collection/generic/GenericCompanion.scala.html#60782" title="[A](elems: A*)scala.collection.mutable.ListBuffer[A]">ListBuffer</a><span title="(elems: List[Macros.this.global.Expr[_]]*)scala.collection.mutable.ListBuffer[List[Macros.this.global.Expr[_]]]" class="delimiter">[</span><a href="../../../collection/immutable/List.scala.html#12322" title="List[Macros.this.global.Expr[_]]">List</a><span class="delimiter">[</span>Expr<span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="(tree: Macros.this.global.Tree)Unit" id="1114000">collectMacroArgs</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1114029">tree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../Unit.scala.html#2389" title="Unit">Unit</a> = <a href="#1114029" title="Macros.this.global.Tree">tree</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> Apply<a href="#1114116" title="Unit" id="1114118" class="delimiter">(</a>fn, args<span class="delimiter">)</span> =&gt;
        // todo. infer precise typetag for this Expr, namely the declared type of the corresponding macro impl argument
        <a href="#1113999" title="scala.collection.mutable.ListBuffer[List[Macros.this.global.Expr[_]]]">exprArgs</a>.<a href="../../../collection/mutable/BufferLike.scala.html#67889" title="(elems: List[Macros.this.global.Expr[_]]*)Unit">prepend</a><span class="delimiter">(</span>args <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: Macros.this.global.Tree =&gt; Macros.this.global.Expr[Nothing])(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Tree],Macros.this.global.Expr[Nothing],List[Macros.this.global.Expr[_]]])List[Macros.this.global.Expr[_]]">map</a> <span class="delimiter">(</span><a href="../../../reflect/api/Exprs.scala.html#431889" title="(tree: Macros.this.global.Tree)(implicit evidence$1: Macros.this.global.TypeTag[Nothing])Macros.this.global.Expr[Nothing]">Expr</a><span class="delimiter">(</span><a href="#1114057" title="Macros.this.global.Tree">_</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="../../../reflect/api/TypeTags.scala.html#23827" title="Macros.this.global.TypeTag.type">TypeTag</a>.<a href="../../../reflect/api/TypeTags.scala.html#63495" title="=&gt; Macros.this.global.TypeTag[Nothing]">Nothing</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#1114000" title="(tree: Macros.this.global.Tree)Unit">collectMacroArgs</a><span class="delimiter">(</span>fn<span class="delimiter">)</span>
      <span class="keyword">case</span> TypeApply<a href="#1114116" title="Unit" id="1114120" class="delimiter">(</a>fn, args<span class="delimiter">)</span> =&gt;
        <a href="#1113998" title="List[Macros.this.global.Tree]">typeArgs</a> = args
        <a href="#1114000" title="(tree: Macros.this.global.Tree)Unit">collectMacroArgs</a><span class="delimiter">(</span>fn<span class="delimiter">)</span>
      <span class="keyword">case</span> Select<a href="#1114116" title="Unit" id="1114122" class="delimiter">(</a>qual, name<span class="delimiter">)</span> =&gt;
        <a href="#1113997" title="Macros.this.global.Tree">prefixTree</a> = qual
      <span class="keyword">case</span> _ =&gt;
    <span class="delimiter">}</span>
    <a href="#1114000" title="(tree: Macros.this.global.Tree)Unit">collectMacroArgs</a><span class="delimiter">(</span><a href="#1113993" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.reflect.makro.runtime.Context" id="1114001">context</a> = <a href="#1113993" title="Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/api/Trees.scala.html#425056" title="[T](implicit evidence$2: scala.reflect.ClassTag[T])Option[T]">attachmentOpt</a><a href="../../../reflect/ClassTag.scala.html#61898" title="(implicit evidence$2: scala.reflect.ClassTag[Macros.this.MacroAttachment])Option[Macros.this.MacroAttachment]" class="delimiter">[</a><a href="StdAttachments.scala.html#560589" title="Macros.this.MacroAttachment">MacroAttachment</a><span class="delimiter">]</span>.<a href="../../../Option.scala.html#63826" title="(f: Macros.this.MacroAttachment =&gt; Option[scala.reflect.makro.runtime.Context])Option[scala.reflect.makro.runtime.Context]">flatMap</a><span class="delimiter">(</span><a href="#1114160" title="Macros.this.MacroAttachment">_</a>.<a href="StdAttachments.scala.html#1114137" title="=&gt; Option[scala.reflect.makro.runtime.Context]">macroContext</a><span class="delimiter">)</span>.<a href="../../../Option.scala.html#63814" title="(default: =&gt; scala.reflect.makro.runtime.Context)scala.reflect.makro.runtime.Context">getOrElse</a><span class="delimiter">(</span><a href="#560439" title="(typer: Macros.this.Typer, prefixTree: Macros.this.global.Tree, expandeeTree: Macros.this.global.Tree)scala.reflect.makro.runtime.Context{val mirror: Macros.this.global.type}">macroContext</a><span class="delimiter">(</span><a href="#1113992" title="Macros.this.Typer">typer</a>, <a href="#1113997" title="Macros.this.global.Tree">prefixTree</a>, <a href="#1113993" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">var</span> <a title="List[List[Any]]" id="1114002">argss</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[List[Any]]">List</a><span class="delimiter">[</span>List<span class="delimiter">[</span>Any<span class="delimiter">]</span><span class="delimiter">]</span> = <a href="../../../collection/immutable/List.scala.html#63291" title="(xs: scala.reflect.makro.runtime.Context*)List[scala.reflect.makro.runtime.Context]">List</a><span class="delimiter">(</span><a href="#1114001" title="scala.reflect.makro.runtime.Context">context</a><span class="delimiter">)</span> <a href="../../../collection/immutable/List.scala.html#63643" title="(x: List[Object])List[List[Object]]">::</a> <a href="#1113999" title="scala.collection.mutable.ListBuffer[List[Macros.this.global.Expr[_]]]">exprArgs</a>.<a href="../../../collection/mutable/ListBuffer.scala.html#67864" title="=&gt; List[List[Macros.this.global.Expr[_]]]">toList</a>
    <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: List[List[Any]])List[List[Any]]">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;argss: &quot;)" class="string">&quot;argss: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1114002" title="List[List[Any]]">argss</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Macros.this.global.AnnotationInfo" id="1114003">ann</a> = <a href="#1113995" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/AnnotationInfos.scala.html#442127" title="(cls: Macros.this.global.Symbol)Option[Macros.this.global.AnnotationInfo]">getAnnotation</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#442430" title="=&gt; Macros.this.global.ClassSymbol">MacroImplAnnotation</a><span class="delimiter">)</span>.<a href="../../../Option.scala.html#63814" title="(default: =&gt; Macros.this.global.AnnotationInfo)Macros.this.global.AnnotationInfo">getOrElse</a><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)Error" class="keyword">new</span> <a href="../../../package.scala.html#56959" title="Error">Error</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;assertion failed. %s: %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1113995" title="Macros.this.global.Symbol">macroDef</a>, <a href="#1113995" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#443459" title="=&gt; List[Macros.this.global.AnnotationInfo]">annotations</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="1114004">macroImpl</a> = <a href="#1114003" title="Macros.this.global.AnnotationInfo">ann</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76165" title="(n: Int)Macros.this.global.Tree">args</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Macros.this.global.Symbol">symbol</a>
    <span class="keyword">var</span> <a title="List[List[Macros.this.global.Symbol]]" id="1114005">paramss</a> = <a href="#1114004" title="Macros.this.global.Symbol">macroImpl</a>.<a href="../../../reflect/internal/Symbols.scala.html#443448" title="=&gt; List[List[Macros.this.global.Symbol]]">paramss</a>
    <span class="keyword">val</span> <a title="List[Macros.this.global.Symbol]" id="1114006">tparams</a> = <a href="#1114004" title="Macros.this.global.Symbol">macroImpl</a>.<a href="../../../reflect/internal/Symbols.scala.html#443447" title="=&gt; List[Macros.this.global.Symbol]">typeParams</a>
    <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: List[List[Macros.this.global.Symbol]])List[List[Macros.this.global.Symbol]]">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;paramss: &quot;)" class="string">&quot;paramss: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1114005" title="List[List[Macros.this.global.Symbol]]">paramss</a><span class="delimiter">)</span>

    // we need to take care of all possible combos of nullary/empty-paramlist macro defs vs nullary/empty-arglist invocations
    // nullary def + nullary invocation =&gt; paramss and argss match, everything is okay
    // nullary def + empty-arglist invocation =&gt; illegal Scala code, impossible, everything is okay
    // empty-paramlist def + nullary invocation =&gt; uh-oh, we need to append a List() to argss
    // empty-paramlist def + empty-arglist invocation =&gt; paramss and argss match, everything is okay
    // that's almost it, but we need to account for the fact that paramss might have context bounds that mask the empty last paramlist
    <span class="keyword">val</span> <a title="List[List[Macros.this.global.Symbol]]" id="1114007">paramss_without_evidences</a> = <a href="#560428" title="(paramss: List[List[Macros.this.global.Symbol]], transform: (Macros.this.global.Symbol, Macros.this.global.Symbol) =&gt; Option[Macros.this.global.Symbol])List[List[Macros.this.global.Symbol]]">transformTypeTagEvidenceParams</a><span class="delimiter">(</span><a href="#1114005" title="List[List[Macros.this.global.Symbol]]">paramss</a>, <span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1118496">param</a>, <a title="Macros.this.global.Symbol" id="1118497">tparam</a><span class="delimiter">)</span> =&gt; <a href="../../../Option.scala.html#2498" title="None.type">None</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Boolean" id="1114008">isEmptyParamlistDef</a> = <a href="#1114007" title="List[List[Macros.this.global.Symbol]]">paramss_without_evidences</a>.<a href="../../../collection/TraversableOnce.scala.html#59102" title="=&gt; Boolean">nonEmpty</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1114007" title="List[List[Macros.this.global.Symbol]]">paramss_without_evidences</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76185" title="=&gt; List[Macros.this.global.Symbol]">last</a>.<a href="../../../collection/IterableLike.scala.html#59464" title="=&gt; Boolean">isEmpty</a>
    <span class="keyword">val</span> <a title="Boolean" id="1114009">isEmptyArglistInvocation</a> = <a href="#1114002" title="List[List[Any]]">argss</a>.<a href="../../../collection/TraversableOnce.scala.html#59102" title="=&gt; Boolean">nonEmpty</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1114002" title="List[List[Any]]">argss</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76185" title="=&gt; List[Any]">last</a>.<a href="../../../collection/IterableLike.scala.html#59464" title="=&gt; Boolean">isEmpty</a>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1114008" title="Boolean">isEmptyParamlistDef</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1114009" title="Boolean">isEmptyArglistInvocation</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../../reflect/makro/util/Traces.scala.html#559471" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><span title="String(&quot;isEmptyParamlistDef &amp;&amp; !isEmptyArglistInvocation: appending a List() to argss&quot;)" class="string">&quot;isEmptyParamlistDef &amp;&amp; !isEmptyArglistInvocation: appending a List() to argss&quot;</span><span class="delimiter">)</span>
      <a href="#1114002" title="List[List[Any]]">argss</a> = <a href="#1114002" title="List[List[Any]]">argss</a> <a href="../../../collection/SeqLike.scala.html#59810" title="(elem: List[Any])(implicit bf: scala.collection.generic.CanBuildFrom[List[List[Any]],List[Any],List[List[Any]]])List[List[Any]]">:+</a> <a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type">Nil</a>
    <span class="delimiter">}</span>

    // nb! check partial application against paramss without evidences
    <span class="keyword">val</span> <a title="Int" id="1114010">numParamLists</a> = <a href="#1114007" title="List[List[Macros.this.global.Symbol]]">paramss_without_evidences</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a>
    <span class="keyword">val</span> <a title="Int" id="1114011">numArgLists</a> = <a href="#1114002" title="List[List[Any]]">argss</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1114010" title="Int">numParamLists</a> <a href="../../../Int.scala.html#57898" title="(x: Int)Boolean">!=</a> <a href="#1114011" title="Int">numArgLists</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#1113992" title="Macros.this.Typer">typer</a>.<a href="ContextErrors.scala.html#560843" title="typer.TyperErrorGen.type">TyperErrorGen</a>.<a href="ContextErrors.scala.html#562552" title="(tree: Macros.this.global.Tree)Macros.this.global.Tree">MacroPartialApplicationError</a><span class="delimiter">(</span><a href="#1113993" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <a href="../../../Option.scala.html#2498" title="None.type">None</a>
    <span class="delimiter">}</span>

    // if paramss have typetag context bounds, add an arglist to argss if necessary and instantiate the corresponding evidences
    // consider the following example:
    //
    //   class D[T] {
    //     class C[U] {
    //       def foo[V] = macro Impls.foo[T, U, V]
    //     }
    //   }
    //
    //   val outer1 = new D[Int]
    //   val outer2 = new outer1.C[String]
    //   outer2.foo[Boolean]
    //
    // then T and U need to be inferred from the lexical scope of the call using ``asSeenFrom''
    // whereas V won't be resolved by asSeenFrom and need to be loaded directly from ``expandee'' which needs to contain a TypeApply node
    // also, macro implementation reference may contain a regular type as a type argument, then we pass it verbatim
    <span class="keyword">val</span> <a title="scala.collection.mutable.Map[Macros.this.global.Symbol,Macros.this.global.Type]" id="1114012">resolved</a> = collection.mutable.<a href="../../../collection/generic/GenMapFactory.scala.html#61654" title="[A, B](elems: (A, B)*)scala.collection.mutable.Map[A,B]">Map</a><span title="(elems: (Macros.this.global.Symbol, Macros.this.global.Type)*)scala.collection.mutable.Map[Macros.this.global.Symbol,Macros.this.global.Type]" class="delimiter">[</span><a href="../../../reflect/internal/Symbols.scala.html#441132" title="Macros.this.global.Symbol">Symbol</a>, <a href="../../../reflect/internal/Types.scala.html#441242" title="Macros.this.global.Type">Type</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#1114005" title="List[List[Macros.this.global.Symbol]]">paramss</a> = <a href="#560428" title="(paramss: List[List[Macros.this.global.Symbol]], transform: (Macros.this.global.Symbol, Macros.this.global.Symbol) =&gt; Option[Macros.this.global.Symbol])List[List[Macros.this.global.Symbol]]">transformTypeTagEvidenceParams</a><span class="delimiter">(</span><a href="#1114005" title="List[List[Macros.this.global.Symbol]]">paramss</a>, <span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1118564">param</a>, <a title="Macros.this.global.Symbol" id="1118565">tparam</a><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
      <span class="keyword">val</span> TypeApply<a href="#1118581" title="List[Macros.this.global.Tree]" id="1118584" class="delimiter">(</a>_, implRefTargs<span class="delimiter">)</span> = <a href="#1114003" title="Macros.this.global.AnnotationInfo">ann</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76165" title="(n: Int)Macros.this.global.Tree">args</a><a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree @unchecked" class="delimiter">(</a><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <span class="keyword">var</span> <a title="Macros.this.global.Symbol" id="1118567">implRefTarg</a> = <a href="../../../collection/LinearSeqOptimized.scala.html#76165" title="(n: Int)Macros.this.global.Tree">implRefTargs</a><span class="delimiter">(</span><a href="#1118565" title="Macros.this.global.Symbol">tparam</a>.<a href="../../../reflect/internal/Symbols.scala.html#443378" title="=&gt; Int">paramPos</a><span class="delimiter">)</span>.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; Macros.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#441986" title="=&gt; Macros.this.global.Symbol">typeSymbol</a>
      <span class="keyword">val</span> <a title="Macros.this.global.Type" id="1118568">tpe</a> = <span title="Macros.this.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="#1118567" title="Macros.this.global.Symbol">implRefTarg</a>.<a href="../../../reflect/internal/Symbols.scala.html#443257" title="=&gt; Boolean">isTypeParameterOrSkolem</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Macros.this.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="#1118567" title="Macros.this.global.Symbol">implRefTarg</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; Macros.this.global.Symbol">owner</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#1113995" title="Macros.this.global.Symbol">macroDef</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          // [Eugene] doesn't work when macro def is compiled separately from its usages
          // then implRefTarg is not a skolem and isn't equal to any of macroDef.typeParams
//          val paramPos = implRefTarg.deSkolemize.paramPos
          <span class="keyword">val</span> <a title="Int" id="1118603">paramPos</a> = <a href="#1113995" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#443447" title="=&gt; List[Macros.this.global.Symbol]">typeParams</a>.<a href="../../../collection/GenSeqLike.scala.html#59604" title="(p: Macros.this.global.Symbol =&gt; Boolean)Int">indexWhere</a><span class="delimiter">(</span><a href="#1118618" title="Macros.this.global.Symbol">_</a>.<a href="../../../reflect/internal/Symbols.scala.html#443152" title="=&gt; x$29.NameType">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#1118567" title="Macros.this.global.Symbol">implRefTarg</a>.<a href="../../../reflect/internal/Symbols.scala.html#443152" title="=&gt; Macros.this.global.Symbol#NameType">name</a><span class="delimiter">)</span>
          <a href="../../../collection/LinearSeqOptimized.scala.html#76165" title="(n: Int)Macros.this.global.Tree">typeArgs</a><span class="delimiter">(</span><a href="#1118603" title="Int">paramPos</a><span class="delimiter">)</span>.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; Macros.this.global.Type">tpe</a>
        <span class="delimiter">}</span> <span class="keyword">else</span>
          <a href="#1118567" title="Macros.this.global.Symbol">implRefTarg</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; Macros.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#442037" title="(pre: Macros.this.global.Type, clazz: Macros.this.global.Symbol)Macros.this.global.Type">asSeenFrom</a><span class="delimiter">(</span>
            <span title="Macros.this.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="#1113997" title="Macros.this.global.Tree">prefixTree</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/api/Trees.scala.html#23577" title="Macros.this.global.EmptyTree.type">EmptyTree</a><span class="delimiter">)</span> <a href="#1113995" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; Macros.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; Macros.this.global.Type">tpe</a> <span class="keyword">else</span> <a href="#1113997" title="Macros.this.global.Tree">prefixTree</a>.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; Macros.this.global.Type">tpe</a>,
            <a href="#1113995" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#443379" title="=&gt; Macros.this.global.Symbol">owner</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span>
        <a href="#1118567" title="Macros.this.global.Symbol">implRefTarg</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; Macros.this.global.Type">tpe</a>
      <a href="../../../reflect/makro/util/Traces.scala.html#559471" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;resolved tparam %s as %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1118565" title="Macros.this.global.Symbol">tparam</a>, <a href="#1118568" title="Macros.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="../../../collection/mutable/MapLike.scala.html#78496" title="(key: Macros.this.global.Symbol, value: Macros.this.global.Type)Unit">resolved</a><span class="delimiter">(</span><a href="#1118565" title="Macros.this.global.Symbol">tparam</a><span class="delimiter">)</span> = <a href="#1118568" title="Macros.this.global.Type">tpe</a>
      <a href="#1118564" title="Macros.this.global.Symbol">param</a>.<a href="../../../reflect/internal/Symbols.scala.html#443425" title="=&gt; Macros.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#441986" title="=&gt; Macros.this.global.Symbol">typeSymbol</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="../../../reflect/internal/Definitions.scala.html#441641" title="Macros.this.global.definitions.type">definitions</a>.<a href="../../../reflect/internal/Definitions.scala.html#442411" title="Unit" id="1118670">TypeTagClass</a> =&gt;
          // do nothing
        <span class="keyword">case</span> <a href="../../../reflect/internal/Definitions.scala.html#441641" title="Macros.this.global.definitions.type">definitions</a>.<a href="../../../reflect/internal/Definitions.scala.html#442415" title="Unit" id="1118671">ConcreteTypeTagClass</a> =&gt;
          <a href="#1118672" title="(x: Unit)Unit" class="keyword">if</a> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1118568" title="Macros.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#441968" title="=&gt; Boolean">isConcrete</a><span class="delimiter">)</span> <a href="#1114001" title="scala.reflect.makro.runtime.Context">context</a>.<a href="../../../reflect/makro/runtime/FrontEnds.scala.html#559410" title="(pos: context.Position, msg: String)Nothing">abort</a><span class="delimiter">(</span><a href="#1114001" title="scala.reflect.makro.runtime.Context">context</a>.<a href="../../../reflect/makro/runtime/Enclosures.scala.html#559375" title="=&gt; context.Position">enclosingPosition</a>, <a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;cannot create ConcreteTypeTag from a type %s having unresolved type parameters&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1118568" title="Macros.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
          // otherwise do nothing
        <span class="keyword">case</span> _ =&gt;
          <a href="#1118672" title="(x: Unit)Unit" class="keyword">throw</a> <span title="(x$1: String)Error" class="keyword">new</span> <a href="../../../package.scala.html#56959" title="Error">Error</a><span class="delimiter">(</span><span title="String(&quot;unsupported tpe: &quot;)" class="string">&quot;unsupported tpe: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1118568" title="Macros.this.global.Type">tpe</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="../../../Option.scala.html#64111" title="(x: Macros.this.global.Symbol)Some[Macros.this.global.Symbol]">Some</a><span class="delimiter">(</span><a href="#1118565" title="Macros.this.global.Symbol">tparam</a><span class="delimiter">)</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="List[Macros.this.global.TypeTag[Nothing]]" id="1114013">tags</a> = <a href="#1114005" title="List[List[Macros.this.global.Symbol]]">paramss</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76185" title="=&gt; List[Macros.this.global.Symbol]">last</a> <a href="../../../collection/immutable/List.scala.html#63671" title="(p: Macros.this.global.Symbol =&gt; Boolean)List[Macros.this.global.Symbol]">takeWhile</a> <span class="delimiter">(</span><a href="#1118696" title="Macros.this.global.Symbol">_</a>.<a href="../../../reflect/internal/Symbols.scala.html#443230" title="=&gt; Boolean">isType</a><span class="delimiter">)</span> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: Macros.this.global.Symbol =&gt; Macros.this.global.Type)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Symbol],Macros.this.global.Type,List[Macros.this.global.Type]])List[Macros.this.global.Type]">map</a> <span class="delimiter">(</span><a href="../../../collection/MapLike.scala.html#78420" title="(key: Macros.this.global.Symbol)Macros.this.global.Type">resolved</a><span class="delimiter">(</span><a href="#1118716" title="Macros.this.global.Symbol">_</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: Macros.this.global.Type =&gt; Macros.this.global.TypeTag[Nothing])(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Type],Macros.this.global.TypeTag[Nothing],List[Macros.this.global.TypeTag[Nothing]]])List[Macros.this.global.TypeTag[Nothing]]">map</a> <span class="delimiter">(</span><a title="Macros.this.global.Type" id="1118784">tpe</a> =&gt; <span class="delimiter">{</span>
      // generally speaking, it's impossible to calculate erasure from a tpe here
      // the tpe might be compiled by this run, so its jClass might not exist yet
      // hence I just pass `null` instead and leave this puzzle to macro programmers
      <span class="keyword">val</span> <a title="Macros.this.global.TypeTag[Nothing]" id="1118785">ttag</a> = <a href="../../../reflect/api/TypeTags.scala.html#63501" title="(tpe1: Macros.this.global.Type, erasure1: Class[_])Macros.this.global.TypeTag[Nothing]">TypeTag</a><span class="delimiter">(</span><a href="#1118784" title="Macros.this.global.Type">tpe</a>, <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
      <span title="Macros.this.global.TypeTag[Nothing]" class="keyword">if</span> <span class="delimiter">(</span><a href="#1118785" title="Macros.this.global.TypeTag[Nothing]">ttag</a>.<a href="../../../reflect/api/TypeTags.scala.html#63456" title="=&gt; Boolean">isConcrete</a><span class="delimiter">)</span> <a href="#1118785" title="Macros.this.global.TypeTag[Nothing]">ttag</a>.<a href="../../../reflect/api/TypeTags.scala.html#63458" title="=&gt; Macros.this.global.ConcreteTypeTag[Nothing]">toConcrete</a> <span class="keyword">else</span> <a href="#1118785" title="Macros.this.global.TypeTag[Nothing]">ttag</a>
    <span class="delimiter">}</span><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1114005" title="List[List[Macros.this.global.Symbol]]">paramss</a>.<a href="../../../collection/TraversableLike.scala.html#59014" title="=&gt; Option[List[Macros.this.global.Symbol]]">lastOption</a> <a href="../../../Option.scala.html#63820" title="(f: List[Macros.this.global.Symbol] =&gt; Boolean)Option[Boolean]">map</a> <span class="delimiter">(</span><a title="List[Macros.this.global.Symbol]" id="1118824">params</a> =&gt; <a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1118824" title="List[Macros.this.global.Symbol]">params</a>.<a href="../../../collection/IterableLike.scala.html#59464" title="=&gt; Boolean">isEmpty</a> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#1118824" title="List[Macros.this.global.Symbol]">params</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76169" title="(p: Macros.this.global.Symbol =&gt; Boolean)Boolean">forall</a><span class="delimiter">(</span><a href="#1118831" title="Macros.this.global.Symbol">_</a>.<a href="../../../reflect/internal/Symbols.scala.html#443230" title="=&gt; Boolean">isType</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../Option.scala.html#63814" title="(default: =&gt; Boolean)Boolean">getOrElse</a> <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span> <a href="#1114002" title="List[List[Any]]">argss</a> = <a href="#1114002" title="List[List[Any]]">argss</a> <a href="../../../collection/SeqLike.scala.html#59810" title="(elem: List[Any])(implicit bf: scala.collection.generic.CanBuildFrom[List[List[Any]],List[Any],List[List[Any]]])List[List[Any]]">:+</a> <a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type">Nil</a>
    <a href="#1114002" title="List[List[Any]]">argss</a> = <a href="#1114002" title="List[List[Any]]">argss</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76188" title="(n: Int)List[List[Any]]">dropRight</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <a href="../../../collection/SeqLike.scala.html#59810" title="(elem: List[Any])(implicit bf: scala.collection.generic.CanBuildFrom[List[List[Any]],List[Any],List[List[Any]]])List[List[Any]]">:+</a> <span class="delimiter">(</span><a href="#1114013" title="List[Macros.this.global.TypeTag[Nothing]]">tags</a> <a href="../../../collection/immutable/List.scala.html#63655" title="(that: scala.collection.GenTraversableOnce[Any])(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.TypeTag[Nothing]],Any,List[Any]])List[Any]">++</a> <a href="#1114002" title="List[List[Any]]">argss</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76185" title="=&gt; List[Any]">last</a><span class="delimiter">)</span> // todo. add support for context bounds in argss

    <a href="../Global.scala.html#559533" title="(assertion: Boolean, message: =&gt; Any)Unit">assert</a><span class="delimiter">(</span><a href="#1114002" title="List[List[Any]]">argss</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <a href="#1114005" title="List[List[Macros.this.global.Symbol]]">paramss</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a>, <a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;argss: %s, paramss: %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1114002" title="List[List[Any]]">argss</a>, <a href="#1114005" title="List[List[Macros.this.global.Symbol]]">paramss</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="List[List[Any]]" id="1114014">rawArgss</a> = <span class="keyword">for</span> <span class="delimiter">(</span><span class="delimiter">(</span>as, ps<span class="delimiter">)</span> &lt;- <a href="#1114002" title="List[List[Any]]">argss</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: ((List[Any], List[Macros.this.global.Symbol])) =&gt; List[Any])(implicit bf: scala.collection.generic.CanBuildFrom[List[(List[Any], List[Macros.this.global.Symbol])],List[Any],List[List[Any]]])List[List[Any]]">zip</a> <a href="#1114005" title="List[List[Macros.this.global.Symbol]]">paramss</a><span class="delimiter">)</span> <span class="keyword">yield</span> <span class="delimiter">{</span>
      <a href="#1119152" title="(x: List[Any])List[Any]" class="keyword">if</a> <span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#442315" title="(params: Seq[Macros.this.global.Symbol])Boolean">isVarArgsList</a><span class="delimiter">(</span>ps<span class="delimiter">)</span><span class="delimiter">)</span> as.<a href="../../../collection/immutable/List.scala.html#63666" title="(n: Int)List[Any]">take</a><span class="delimiter">(</span>ps.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57955" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <a href="../../../collection/SeqLike.scala.html#59810" title="(elem: Any)(implicit bf: scala.collection.generic.CanBuildFrom[List[Any],Any,List[Any]])List[Any]">:+</a> as.<a href="../../../collection/immutable/List.scala.html#63667" title="(n: Int)List[Any]">drop</a><span class="delimiter">(</span>ps.<a href="../../../collection/LinearSeqOptimized.scala.html#76164" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#57955" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      <span class="keyword">else</span> as
    <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="List[Any]" id="1114015">rawArgs</a> = <a href="#1114014" title="List[List[Any]]">rawArgss</a>.<a href="../../../collection/generic/GenericTraversableTemplate.scala.html#59386" title="(implicit asTraversable: List[Any] =&gt; scala.collection.GenTraversableOnce[Any])List[Any]">flatten</a>
    <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: List[Any])List[Any]">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;rawArgs: &quot;)" class="string">&quot;rawArgs: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1114015" title="List[Any]">rawArgs</a><span class="delimiter">)</span>
    <a href="../../../Option.scala.html#64111" title="(x: List[Any])Some[List[Any]]">Some</a><span class="delimiter">(</span><a href="#1114015" title="List[Any]">rawArgs</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  /** Keeps track of macros in-flight.
   *  See more informations in comments to ``openMacros'' in ``scala.reflect.makro.Context''.
   */
  <span class="keyword">var</span> <a title="List[scala.reflect.makro.runtime.Context]" id="560442">openMacros</a> = List<span class="delimiter">[</span>MacroContext<span class="delimiter">]</span><a href="../../../collection/immutable/List.scala.html#11552" title="scala.collection.immutable.Nil.type" class="delimiter">(</a><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="=&gt; scala.tools.nsc.util.Position" id="560444">enclosingMacroPosition</a> = <a href="#560442" title="=&gt; List[scala.reflect.makro.runtime.Context]">openMacros</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: scala.reflect.makro.runtime.Context =&gt; scala.tools.nsc.util.Position)(implicit bf: scala.collection.generic.CanBuildFrom[List[scala.reflect.makro.runtime.Context],scala.tools.nsc.util.Position,List[scala.tools.nsc.util.Position]])List[scala.tools.nsc.util.Position]">map</a> <span class="delimiter">(</span><a href="#563496" title="scala.reflect.makro.runtime.Context">_</a>.<a href="../../../reflect/makro/runtime/Enclosures.scala.html#559363" title="=&gt; x$34.mirror.Tree">macroApplication</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; scala.tools.nsc.util.Position">pos</a><span class="delimiter">)</span> <a href="../../../collection/LinearSeqOptimized.scala.html#76172" title="(p: scala.tools.nsc.util.Position =&gt; Boolean)Option[scala.tools.nsc.util.Position]">find</a> <span class="delimiter">(</span><a href="#563537" title="scala.tools.nsc.util.Position">_</a> <span title="(x$1: AnyRef)Boolean">ne</span> <a href="../../../reflect/internal/Positions.scala.html#441880" title="=&gt; tools.nsc.util.NoPosition.type">NoPosition</a><span class="delimiter">)</span> <a href="../../../Option.scala.html#63814" title="(default: =&gt; scala.tools.nsc.util.Position)scala.tools.nsc.util.Position">getOrElse</a> <a href="../../../reflect/internal/Positions.scala.html#441880" title="=&gt; tools.nsc.util.NoPosition.type">NoPosition</a>

  /** Performs macro expansion:
   *    1) Checks whether the expansion needs to be delayed (see ``mustDelayMacroExpansion'')
   *    2) Loads macro implementation using ``macroMirror''
   *    3) Synthesizes invocation arguments for the macro implementation
   *    4) Checks that the result is a tree bound to this universe
   *    5) Typechecks the result against the return type of the macro definition
   *
   *  If -Ymacro-debug-lite is enabled, you will get basic notifications about macro expansion
   *  along with macro expansions logged in the form that can be copy/pasted verbatim into REPL.
   *
   *  If -Ymacro-debug-verbose is enabled, you will get detailed log of how exactly this function
   *  performs class loading and method resolution in order to load the macro implementation.
   *  The log will also include other non-trivial steps of macro expansion.
   *
   *  @return
   *    the expansion result                    if the expansion has been successful,
   *    the fallback method invocation          if the expansion has been unsuccessful, but there is a fallback,
   *    the expandee unchanged                  if the expansion has been delayed,
   *    the expandee fully expanded             if the expansion has been delayed before and has been expanded now,
   *    the expandee with an error marker set   if the expansion has been cancelled due malformed arguments or implementation
   *    the expandee with an error marker set   if there has been an error
   */
  <span class="keyword">def</span> <a title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree, mode: Int, pt: Macros.this.global.Type)Macros.this.global.Tree" id="560445">macroExpand</a><span class="delimiter">(</span><a title="Macros.this.Typer" id="1119230">typer</a>: <a href="Typers.scala.html#560207" title="Macros.this.Typer">Typer</a>, <a title="Macros.this.global.Tree" id="1119231">expandee</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a>, <a title="Int" id="1119235">mode</a>: <a href="../../../Int.scala.html#508" title="Int">Int</a> = <span title="Int(1)">EXPRmode</span>, <a title="Macros.this.global.Type" id="1119236">pt</a>: <a href="../../../reflect/internal/Types.scala.html#441242" title="Macros.this.global.Type">Type</a> = <a href="../../../reflect/internal/Types.scala.html#441251" title="Macros.this.global.WildcardType.type">WildcardType</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(what: String, tree: Macros.this.global.Tree)Macros.this.global.Tree" id="1119237">fail</a><span class="delimiter">(</span><a title="String" id="1119239">what</a>: <span title="String">String</span>, <a title="Macros.this.global.Tree" id="1119240">tree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Macros.this.AbsTypeError" id="1119241">err</a> = <a href="#1119230" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#560636" title="=&gt; Macros.this.Context">context</a>.<a href="Contexts.scala.html#560935" title="=&gt; scala.collection.mutable.Set[Macros.this.AbsTypeError]">errBuffer</a>.<a href="../../../collection/IterableLike.scala.html#59473" title="=&gt; Macros.this.AbsTypeError">head</a>
      <a href="#49371" title="Macros.this.type" class="keyword">this</a>.<a href="#560460" title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree, msg: String)Macros.this.Other">fail</a><span class="delimiter">(</span><a href="#1119230" title="Macros.this.Typer">typer</a>, <a href="#1119240" title="Macros.this.global.Tree">tree</a>, <a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;failed to %s: %s at %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1119239" title="String">what</a>, <a href="#1119241" title="Macros.this.AbsTypeError">err</a>.<a href="ContextErrors.scala.html#562862" title="=&gt; String">errMsg</a>, <a href="#1119241" title="Macros.this.AbsTypeError">err</a>.<a href="ContextErrors.scala.html#562861" title="=&gt; Macros.this.global.Position">errPos</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <a href="#1119231" title="Macros.this.global.Tree">expandee</a>
    <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="scala.tools.nsc.util.Statistics.LongPair" id="1119238">start</a> = <a href="../../../reflect/internal/util/StatBase.scala.html#441048" title="(tm: scala.tools.nsc.util.Statistics.Timer)scala.tools.nsc.util.Statistics.LongPair">startTimer</a><span class="delimiter">(</span><a href="../util/Statistics.scala.html#560053" title="=&gt; scala.tools.nsc.util.Statistics.Timer">macroExpandNanos</a><span class="delimiter">)</span>
    <a href="../../../reflect/internal/util/StatBase.scala.html#441044" title="(c: scala.tools.nsc.util.Statistics.Counter)Unit">incCounter</a><span class="delimiter">(</span><a href="../util/Statistics.scala.html#560051" title="=&gt; scala.tools.nsc.util.Statistics.Counter">macroExpandCount</a><span class="delimiter">)</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#560461" title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree)Macros.this.MacroExpansionResult">macroExpand1</a><a href="#1119910" title="=&gt; Macros.this.global.Tree" class="delimiter">(</a><a href="#1119230" title="Macros.this.Typer">typer</a>, <a href="#1119231" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Success<a href="#1119598" title="Macros.this.global.Tree" id="1119599" class="delimiter">(</a>expanded<span class="delimiter">)</span> =&gt;
          <a href="#1119602" title="(x: Macros.this.global.Tree)Macros.this.global.Tree" class="keyword">try</a> <span class="delimiter">{</span>
            <span class="keyword">var</span> <a title="Macros.this.global.Type" id="1119457">expectedTpe</a> = <a href="#1119231" title="Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; Macros.this.global.Type">tpe</a>

            // [Eugene] weird situation. what's the conventional way to deal with it?
            <span class="keyword">val</span> <a title="Boolean" id="1119458">isNullaryInvocation</a> = <a href="#1119231" title="Macros.this.global.Tree">expandee</a> <span class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> TypeApply<a href="#1119481" title="Boolean" id="1119485" class="delimiter">(</a>Select<a title="Boolean" id="1119489" class="delimiter">(</a>_, _<span class="delimiter">)</span>, _<span class="delimiter">)</span> =&gt; <a href="#1119505" title="(x: Boolean)Boolean" class="keyword">true</a>
              <span class="keyword">case</span> TypeApply<span class="delimiter">(</span>Ident<a title="Boolean" id="1119496" class="delimiter">(</a>_<span class="delimiter">)</span>, _<span class="delimiter">)</span> =&gt; <a href="#1119505" title="(x: Boolean)Boolean" class="keyword">true</a>
              <span class="keyword">case</span> Select<a href="#1119481" title="Boolean" id="1119500" class="delimiter">(</a>_, _<span class="delimiter">)</span> =&gt; <a href="#1119505" title="(x: Boolean)Boolean" class="keyword">true</a>
              <span class="keyword">case</span> Ident<a href="#1119481" title="Boolean" id="1119503" class="delimiter">(</a>_<span class="delimiter">)</span> =&gt; <a href="#1119505" title="(x: Boolean)Boolean" class="keyword">true</a>
              <span class="keyword">case</span> _ =&gt; <a href="#1119505" title="(x: Boolean)Boolean" class="keyword">false</a>
            <span class="delimiter">}</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1119458" title="Boolean">isNullaryInvocation</a><span class="delimiter">)</span> <a href="#1119457" title="Macros.this.global.Type">expectedTpe</a> <span class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> NullaryMethodType<a href="#1119531" title="Unit" id="1119533" class="delimiter">(</a>restpe<span class="delimiter">)</span> =&gt;
                <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: Macros.this.global.Type)Macros.this.global.Type">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;nullary invocation of a nullary method. unwrapping expectedTpe from &quot;)" class="string">&quot;nullary invocation of a nullary method. unwrapping expectedTpe from &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1119457" title="Macros.this.global.Type">expectedTpe</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; to: &quot;)" class="string">&quot; to: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span>restpe<span class="delimiter">)</span>
                <a href="#1119457" title="Macros.this.global.Type">expectedTpe</a> = restpe
              <span class="keyword">case</span> MethodType<a href="#1119531" title="Unit" id="1119536" class="delimiter">(</a><a href="../../../collection/immutable/List.scala.html#11552" title="Unit" id="1119538">Nil</a>, restpe<span class="delimiter">)</span> =&gt;
                <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: Macros.this.global.Type)Macros.this.global.Type">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;nullary invocation of a method with an empty parameter list. unwrapping expectedTpe from &quot;)" class="string">&quot;nullary invocation of a method with an empty parameter list. unwrapping expectedTpe from &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1119457" title="Macros.this.global.Type">expectedTpe</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; to: &quot;)" class="string">&quot; to: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span>restpe<span class="delimiter">)</span>
                <a href="#1119457" title="Macros.this.global.Type">expectedTpe</a> = restpe
              <span class="keyword">case</span> _ =&gt; ;
            <span class="delimiter">}</span>

            <a href="../../../reflect/makro/util/Traces.scala.html#559471" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;typechecking1 against %s: %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1119457" title="Macros.this.global.Type">expectedTpe</a>, expanded<span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="keyword">var</span> <a title="Macros.this.global.Tree" id="1119459">typechecked</a> = <a href="#1119230" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#560636" title="=&gt; Macros.this.Context">context</a>.<a href="Contexts.scala.html#560952" title="(op: =&gt; Macros.this.global.Tree)Macros.this.global.Tree">withImplicitsEnabled</a><span class="delimiter">(</span><a href="#1119230" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#560765" title="(tree: Macros.this.global.Tree, mode: Int, pt: Macros.this.global.Type)Macros.this.global.Tree">typed</a><span class="delimiter">(</span>expanded, <span title="Int(1)">EXPRmode</span>, <a href="#1119457" title="Macros.this.global.Type">expectedTpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#1119230" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#560636" title="=&gt; Macros.this.Context">context</a>.<a href="Contexts.scala.html#560936" title="=&gt; Boolean">hasErrors</a><span class="delimiter">)</span> <a href="#1119237" title="(what: String, tree: Macros.this.global.Tree)Macros.this.global.Tree">fail</a><span class="delimiter">(</span><span title="String(&quot;typecheck against macro def return type&quot;)" class="string">&quot;typecheck against macro def return type&quot;</span>, expanded<span class="delimiter">)</span>
            <a href="../../../reflect/makro/util/Traces.scala.html#559471" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;typechecked1:%n%s%n%s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1119459" title="Macros.this.global.Tree">typechecked</a>, <a href="../../../reflect/api/TreePrinters.scala.html#23837" title="(tree: Macros.this.global.Tree)String">showRaw</a><span class="delimiter">(</span><a href="#1119459" title="Macros.this.global.Tree">typechecked</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

            <a href="../../../reflect/makro/util/Traces.scala.html#559471" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;typechecking2 against %s: %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1119236" title="Macros.this.global.Type">pt</a>, expanded<span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#1119459" title="Macros.this.global.Tree">typechecked</a> = <a href="#1119230" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#560636" title="=&gt; Macros.this.Context">context</a>.<a href="Contexts.scala.html#560952" title="(op: =&gt; Macros.this.global.Tree)Macros.this.global.Tree">withImplicitsEnabled</a><span class="delimiter">(</span><a href="#1119230" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#560765" title="(tree: Macros.this.global.Tree, mode: Int, pt: Macros.this.global.Type)Macros.this.global.Tree">typed</a><span class="delimiter">(</span><a href="#1119459" title="Macros.this.global.Tree">typechecked</a>, <span title="Int(1)">EXPRmode</span>, <a href="#1119236" title="Macros.this.global.Type">pt</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#1119230" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#560636" title="=&gt; Macros.this.Context">context</a>.<a href="Contexts.scala.html#560936" title="=&gt; Boolean">hasErrors</a><span class="delimiter">)</span> <a href="#1119237" title="(what: String, tree: Macros.this.global.Tree)Macros.this.global.Tree">fail</a><span class="delimiter">(</span><span title="String(&quot;typecheck against expected type&quot;)" class="string">&quot;typecheck against expected type&quot;</span>, expanded<span class="delimiter">)</span>
            <a href="../../../reflect/makro/util/Traces.scala.html#559471" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;typechecked2:%n%s%n%s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1119459" title="Macros.this.global.Tree">typechecked</a>, <a href="../../../reflect/api/TreePrinters.scala.html#23837" title="(tree: Macros.this.global.Tree)String">showRaw</a><span class="delimiter">(</span><a href="#1119459" title="Macros.this.global.Tree">typechecked</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

            <a href="#1119459" title="Macros.this.global.Tree">typechecked</a>
          <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
            <a href="#560442" title="(x$1: List[scala.reflect.makro.runtime.Context])Unit">openMacros</a> = <a href="#560442" title="=&gt; List[scala.reflect.makro.runtime.Context]">openMacros</a>.<a href="../../../collection/TraversableLike.scala.html#59012" title="=&gt; List[scala.reflect.makro.runtime.Context]">tail</a>
          <span class="delimiter">}</span>
        <span class="keyword">case</span> Fallback<a href="#1119598" title="Macros.this.global.Tree" id="1119600" class="delimiter">(</a>fallback<span class="delimiter">)</span> =&gt;
          <a href="#1119230" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#560636" title="=&gt; Macros.this.Context">context</a>.<a href="Contexts.scala.html#560952" title="(op: =&gt; Macros.this.global.Tree)Macros.this.global.Tree">withImplicitsEnabled</a><a href="#1119602" title="(x: Macros.this.global.Tree)Macros.this.global.Tree" class="delimiter">(</a><a href="#1119230" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#560765" title="(tree: Macros.this.global.Tree, mode: Int, pt: Macros.this.global.Type)Macros.this.global.Tree">typed</a><span class="delimiter">(</span>fallback, <span title="Int(1)">EXPRmode</span>, <a href="#1119236" title="Macros.this.global.Type">pt</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> Other<a href="#1119598" title="Macros.this.global.Tree" id="1119601" class="delimiter">(</a>result<span class="delimiter">)</span> =&gt;
          <a href="#1119602" title="(x: Macros.this.global.Tree)Macros.this.global.Tree">result</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="../../../reflect/internal/util/StatBase.scala.html#441049" title="(tm: scala.tools.nsc.util.Statistics.Timer, start: scala.tools.nsc.util.Statistics.LongPair)Unit">stopTimer</a><span class="delimiter">(</span><a href="../util/Statistics.scala.html#560053" title="=&gt; scala.tools.nsc.util.Statistics.Timer">macroExpandNanos</a>, <a href="#1119238" title="scala.tools.nsc.util.Statistics.LongPair">start</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">sealed</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class MacroExpansionResult extends AnyRef with Product with Serializable" id="560446">MacroExpansionResult</a> <a href="#560446" title="Macros.this.MacroExpansionResult" class="keyword">extends</a> <a href="../../../Product.scala.html#304" title="Product">Product</a> <span class="keyword">with</span> <a href="../../../Serializable.scala.html#1369" title="Serializable">Serializable</a>
  <span class="keyword">private</span> case <span class="keyword">class</span> <a title="class Success extends Macros.this.MacroExpansionResult with Product with Serializable" id="1121651">Success</a><a href="../../../Product.scala.html#304" title="Product" class="delimiter">(</a><a title="Macros.this.global.Tree" id="1119910">expanded</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#560446" title="Macros.this.MacroExpansionResult">MacroExpansionResult</a>
  <span class="keyword">private</span> case <span class="keyword">class</span> <a title="class Fallback extends Macros.this.MacroExpansionResult with Product with Serializable" id="1121655">Fallback</a><a href="../../../Product.scala.html#304" title="Product" class="delimiter">(</a><a title="Macros.this.global.Tree" id="1120228">fallback</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#560446" title="Macros.this.MacroExpansionResult">MacroExpansionResult</a>
  <span class="keyword">private</span> case <span class="keyword">class</span> <a title="class Other extends Macros.this.MacroExpansionResult with Product with Serializable" id="1121659">Other</a><a href="../../../Product.scala.html#304" title="Product" class="delimiter">(</a><a title="Macros.this.global.Tree" id="1119448">result</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#560446" title="Macros.this.MacroExpansionResult">MacroExpansionResult</a>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(expanded: Macros.this.global.Tree)Macros.this.Other" id="560456">Delay</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1119736">expanded</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span> = <a href="#1121659" title="(result: Macros.this.global.Tree)Macros.this.Other">Other</a><span class="delimiter">(</span><a href="#1119736" title="Macros.this.global.Tree">expanded</a><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(expanded: Macros.this.global.Tree)Macros.this.Other" id="560457">Skip</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1119739">expanded</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span> = <a href="#1121659" title="(result: Macros.this.global.Tree)Macros.this.Other">Other</a><span class="delimiter">(</span><a href="#1119739" title="Macros.this.global.Tree">expanded</a><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(expandee: Macros.this.global.Tree)Macros.this.Other" id="560458">Cancel</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1119742">expandee</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span> = <a href="#1121659" title="(result: Macros.this.global.Tree)Macros.this.Other">Other</a><span class="delimiter">(</span><a href="#1119742" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(expandee: Macros.this.global.Tree)Macros.this.Other" id="560459">Failure</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1119445">expandee</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span> = <a href="#1121659" title="(result: Macros.this.global.Tree)Macros.this.Other">Other</a><span class="delimiter">(</span><a href="#1119445" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree, msg: String)Macros.this.Other" id="560460">fail</a><span class="delimiter">(</span><a title="Macros.this.Typer" id="1119249">typer</a>: <a href="Typers.scala.html#560207" title="Macros.this.Typer">Typer</a>, <a title="Macros.this.global.Tree" id="1119250">expandee</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a>, <a title="String" id="1119254">msg</a>: <span title="String">String</span> = <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="=&gt; String" id="1119255">msgForLog</a> = <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#1119254" title="String">msg</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span><a href="#1119254" title="String">msg</a> <span title="(x$1: CharSequence)Boolean">contains</span> <span title="String(&quot;exception during macro expansion&quot;)" class="string">&quot;exception during macro expansion&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#1119254" title="String">msg</a>.<span title="(x$1: String)Array[String]">split</span><a href="../../../Predef.scala.html#8521" title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]" class="delimiter">(</a><a href="../../../compat/Platform.scala.html#67813" title="=&gt; String">EOL</a><span class="delimiter">)</span>.<a href="../../../collection/IndexedSeqOptimized.scala.html#60121" title="(n: Int)Array[String]">drop</a><a href="../../../Predef.scala.html#8521" title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]" class="delimiter">(</a><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<a href="../../../collection/TraversableLike.scala.html#59011" title="=&gt; Option[String]">headOption</a>.<a href="../../../Option.scala.html#63814" title="(default: =&gt; String)String">getOrElse</a><span class="delimiter">(</span><span title="String(&quot;?&quot;)" class="string">&quot;?&quot;</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#1119254" title="String">msg</a>
    <a href="../../../reflect/makro/util/Traces.scala.html#559470" title="(msg: =&gt; Any)Unit">macroLogLite</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;macro expansion has failed: %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1119255" title="=&gt; String">msgForLog</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Macros.this.global.Position" id="1119256">pos</a> = <span title="Macros.this.global.Position" class="keyword">if</span> <span class="delimiter">(</span><a href="#1119250" title="Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; Macros.this.global.Position">pos</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../../reflect/internal/Positions.scala.html#441880" title="=&gt; tools.nsc.util.NoPosition.type">NoPosition</a><span class="delimiter">)</span> <a href="#1119250" title="Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; Macros.this.global.Position">pos</a> <span class="keyword">else</span> <a href="#560444" title="=&gt; scala.tools.nsc.util.Position">enclosingMacroPosition</a>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1119254" title="String">msg</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#1119249" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#560636" title="=&gt; Macros.this.Context">context</a>.<a href="Contexts.scala.html#560985" title="(pos: Macros.this.global.Position, msg: String)Unit">error</a><span class="delimiter">(</span><a href="#1119256" title="Macros.this.global.Position">pos</a>, <a href="#1119254" title="String">msg</a><span class="delimiter">)</span>
    <a href="#1119249" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#560626" title="=&gt; Macros.this.Inferencer">infer</a>.<a href="Infer.scala.html#562625" title="(tree: Macros.this.global.Tree)Macros.this.global.Tree">setError</a><span class="delimiter">(</span><a href="#1119250" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
    <a href="#560459" title="(expandee: Macros.this.global.Tree)Macros.this.Other">Failure</a><span class="delimiter">(</span><a href="#1119250" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  /** Does the same as ``macroExpand'', but without typechecking the expansion
   *  Meant for internal use within the macro infrastructure, don't use it elsewhere.
   */
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree)Macros.this.MacroExpansionResult" id="560461">macroExpand1</a><span class="delimiter">(</span><a title="Macros.this.Typer" id="1109972">typer</a>: <a href="Typers.scala.html#560207" title="Macros.this.Typer">Typer</a>, <a title="Macros.this.global.Tree" id="1109973">expandee</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="#560446" title="Macros.this.MacroExpansionResult">MacroExpansionResult</a> =
    // InfoLevel.Verbose examines and prints out infos of symbols
    // by the means of this'es these symbols can climb up the lexical scope
    // when these symbols will be examined by a node printer
    // they will enumerate and analyze their children (ask for infos and tpes)
    // if one of those children involves macro expansion, things might get nasty
    // that's why I'm temporarily turning this behavior off
    <a href="../Global.scala.html#559516" title="(infolevel: Macros.this.global.nodePrinters.InfoLevel.Value)(op: =&gt; Macros.this.MacroExpansionResult)Macros.this.MacroExpansionResult">withInfoLevel</a><span class="delimiter">(</span><a href="../Global.scala.html#559514" title="Macros.this.global.nodePrinters.type">nodePrinters</a>.<a href="../ast/NodePrinters.scala.html#563603" title="Macros.this.global.nodePrinters.InfoLevel.type">InfoLevel</a>.<a href="../ast/NodePrinters.scala.html#648465" title="=&gt; Macros.this.global.nodePrinters.InfoLevel.Value">Quiet</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      // if a macro implementation is incompatible or any of the arguments are erroneous
      // there is no sense to expand the macro itself =&gt; it will only make matters worse
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1109973" title="Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Macros.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443318" title="=&gt; Boolean">isErroneous</a> <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <span class="delimiter">(</span><a href="#1109973" title="Macros.this.global.Tree">expandee</a> <a href="../../../reflect/api/Trees.scala.html#425081" title="(p: Macros.this.global.Tree =&gt; Boolean)Boolean">exists</a> <span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#441814" title="implicit scala.reflect.internal.Trees.TreeOps : (tree: Macros.this.global.Tree)Macros.this.global.TreeOps">_</a>.<a href="../../../reflect/internal/Trees.scala.html#443953" title="=&gt; Boolean">isErroneous</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="String" id="1119756">reason</a> = <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#1109973" title="Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Macros.this.global.Symbol">symbol</a>.<a href="../../../reflect/internal/Symbols.scala.html#443318" title="=&gt; Boolean">isErroneous</a><span class="delimiter">)</span> <span title="String(&quot;incompatible macro implementation&quot;)" class="string">&quot;incompatible macro implementation&quot;</span> <span class="keyword">else</span> <span title="String(&quot;erroneous arguments&quot;)" class="string">&quot;erroneous arguments&quot;</span>
        <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: Macros.this.global.Tree)Macros.this.global.Tree">macroTraceVerbose</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;cancelled macro expansion because of %s: &quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1119756" title="String">reason</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1109973" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">return</span> <a href="#560458" title="(expandee: Macros.this.global.Tree)Macros.this.Other">Cancel</a><span class="delimiter">(</span><a href="#1109972" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#560626" title="=&gt; Macros.this.Inferencer">infer</a>.<a href="Infer.scala.html#562625" title="(tree: Macros.this.global.Tree)Macros.this.global.Tree">setError</a><span class="delimiter">(</span><a href="#1109973" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="#560438" title="(macroDef: Macros.this.global.Symbol)Option[List[Any] =&gt; Any]">macroRuntime</a><a href="../../../Option.scala.html#64115" title="=&gt; List[Any] =&gt; Any" class="delimiter">(</a><a href="#1109973" title="Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Macros.this.global.Symbol">symbol</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Some<a href="#1119782" title="Macros.this.MacroExpansionResult" id="1119783" class="delimiter">(</a>runtime<span class="delimiter">)</span> =&gt;
          <a href="#560462" title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree, runtime: List[Any] =&gt; Any)Macros.this.MacroExpansionResult">macroExpandWithRuntime</a><a href="#1119786" title="(x: Macros.this.MacroExpansionResult)Macros.this.MacroExpansionResult" class="delimiter">(</a><a href="#1109972" title="Macros.this.Typer">typer</a>, <a href="#1109973" title="Macros.this.global.Tree">expandee</a>, runtime<span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="../../../Option.scala.html#2498" title="Macros.this.MacroExpansionResult" id="1119785">None</a> =&gt;
          <a href="#560463" title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree)Macros.this.MacroExpansionResult">macroExpandWithoutRuntime</a><a href="#1119786" title="(x: Macros.this.MacroExpansionResult)Macros.this.MacroExpansionResult" class="delimiter">(</a><a href="#1109972" title="Macros.this.Typer">typer</a>, <a href="#1109973" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

  /** Expands a macro when a runtime (i.e. the macro implementation) can be successfully loaded
   *  Meant for internal use within the macro infrastructure, don't use it elsewhere.
   */
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree, runtime: List[Any] =&gt; Any)Macros.this.MacroExpansionResult" id="560462">macroExpandWithRuntime</a><span class="delimiter">(</span><a title="Macros.this.Typer" id="1119774">typer</a>: <a href="Typers.scala.html#560207" title="Macros.this.Typer">Typer</a>, <a title="Macros.this.global.Tree" id="1119775">expandee</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a>, <a title="List[Any] =&gt; Any" id="1119776">runtime</a>: <a href="../../../Function1.scala.html#1207" title="List[Any] =&gt; Any">MacroRuntime</a><span class="delimiter">)</span>: <a href="#560446" title="Macros.this.MacroExpansionResult">MacroExpansionResult</a> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(sym: Macros.this.global.FreeSymbol)Unit" id="1119796">issueFreeError</a><span class="delimiter">(</span><a title="Macros.this.global.FreeSymbol" id="1119798">sym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441147" title="Macros.this.global.FreeSymbol">FreeSymbol</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="String" id="1119799">template</a> = <span class="delimiter">(</span>
          <span class="string">&quot;Macro expansion contains free @kind@ variable %s. Have you forgotten to use %s? &quot;</span>
        <span title="String(&quot;Macro expansion contains free @kind@ variable %s. Have you forgotten to use %s? If you have troubles tracking free @kind@ variables, consider using -Xlog-free-@kind@s&quot;)">+</span> <span class="string">&quot;If you have troubles tracking free @kind@ variables, consider using -Xlog-free-@kind@s&quot;</span>
      <span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="String" id="1119800">forgotten</a> = <span class="delimiter">(</span>
        <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#1119798" title="Macros.this.global.FreeSymbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443229" title="=&gt; Boolean">isTerm</a><span class="delimiter">)</span> <span title="String(&quot;eval when splicing this variable into a reifee&quot;)" class="string">&quot;eval when splicing this variable into a reifee&quot;</span>
        <span class="keyword">else</span> <span title="String(&quot;c.TypeTag annotation for this type parameter&quot;)" class="string">&quot;c.TypeTag annotation for this type parameter&quot;</span>
      <span class="delimiter">)</span>
      <a href="#1119774" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#560636" title="=&gt; Macros.this.Context">context</a>.<a href="Contexts.scala.html#560985" title="(pos: Macros.this.global.Position, msg: String)Unit">error</a><span class="delimiter">(</span><a href="#1119775" title="Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; Macros.this.global.Position">pos</a>,
        <a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">template</a>.<a href="../../../collection/immutable/StringLike.scala.html#60710" title="(literal: String, replacement: String)String">replaceAllLiterally</a><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="delimiter">(</a><span title="String(&quot;@kind@&quot;)" class="string">&quot;@kind@&quot;</span>, <a href="#1119798" title="Macros.this.global.FreeSymbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443152" title="=&gt; sym.NameType">name</a>.<a href="../../../reflect/internal/Names.scala.html#444123" title="=&gt; String">nameKind</a><span class="delimiter">)</span>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span>
          <a href="#1119798" title="Macros.this.global.FreeSymbol">sym</a>.<a href="../../../Predef.scala.html#8576" title="implicit scala.Predef.any2stringadd : (x: Any)scala.runtime.StringAdd">name</a> <a href="../../../runtime/StringAdd.scala.html#60949" title="(other: String)String">+</a> <span title="String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1119798" title="Macros.this.global.FreeSymbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#466289" title="=&gt; String">origin</a>, <a href="#1119800" title="String">forgotten</a><span class="delimiter">)</span>
      <span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="=&gt; Macros.this.MacroExpansionResult" id="1119797">macroExpandInternal</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Boolean" id="1119827">wasDelayed</a>  = <a href="#560470" title="(expandee: Macros.this.global.Tree)Boolean">isDelayed</a><span class="delimiter">(</span><a href="#1119775" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.Set[Int]" id="1119828">undetparams</a> = <a href="#560471" title="(expandee: Macros.this.global.Tree)scala.collection.mutable.Set[Int]">calculateUndetparams</a><span class="delimiter">(</span><a href="#1119775" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Boolean" id="1119829">nowDelayed</a>  = <a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1119774" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#560636" title="=&gt; Macros.this.Context">context</a>.<a href="Contexts.scala.html#560907" title="=&gt; Boolean">macrosEnabled</a> <a href="../../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <a href="#1119828" title="scala.collection.mutable.Set[Int]">undetparams</a>.<a href="../../../collection/TraversableOnce.scala.html#59102" title="=&gt; Boolean">nonEmpty</a>

      <span class="keyword">def</span> <a title="(msg: String)Macros.this.Other" id="1119830">failExpansion</a><span class="delimiter">(</span><a title="String" id="1119840">msg</a>: <span title="String">String</span> = <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> = <a href="#560460" title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree, msg: String)Macros.this.Other">fail</a><span class="delimiter">(</span><a href="#1119774" title="Macros.this.Typer">typer</a>, <a href="#1119775" title="Macros.this.global.Tree">expandee</a>, <a href="#1119840" title="String">msg</a><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="(args: List[Any])Macros.this.MacroExpansionResult" id="1119831">performExpansion</a><span class="delimiter">(</span><a title="List[Any]" id="1119841">args</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[Any]">List</a><span class="delimiter">[</span>Any<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#560446" title="Macros.this.MacroExpansionResult">MacroExpansionResult</a> = <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Int" id="1119842">numErrors</a>    = <a href="../Global.scala.html#559481" title="=&gt; scala.tools.nsc.reporters.Reporter">reporter</a>.<a href="../reporters/Reporter.scala.html#467848" title="=&gt; scala.tools.nsc.reporters.Reporter#Severity">ERROR</a>.<a href="../reporters/Reporter.scala.html#467968" title="=&gt; Int">count</a>
        <span class="keyword">def</span> <a title="=&gt; Boolean" id="1119843">hasNewErrors</a> = <a href="../Global.scala.html#559481" title="=&gt; scala.tools.nsc.reporters.Reporter">reporter</a>.<a href="../reporters/Reporter.scala.html#467848" title="=&gt; scala.tools.nsc.reporters.Reporter#Severity">ERROR</a>.<a href="../reporters/Reporter.scala.html#467968" title="=&gt; Int">count</a> <a href="../../../Int.scala.html#57919" title="(x: Int)Boolean">&gt;</a> <a href="#1119842" title="Int">numErrors</a>

        <span class="keyword">val</span> <a title="Any" id="1119844">expanded</a> = <a href="../../../Function1.scala.html#59555" title="(v1: List[Any])Any">runtime</a><span class="delimiter">(</span><a href="#1119841" title="List[Any]">args</a><span class="delimiter">)</span>

        <span title="Macros.this.MacroExpansionResult" class="keyword">if</span> <span class="delimiter">(</span><a href="#1119843" title="=&gt; Boolean">hasNewErrors</a><span class="delimiter">)</span>
          <a href="#1119830" title="(msg: String)Macros.this.Other">failExpansion</a><span class="delimiter">(</span><span class="delimiter">)</span> // errors have been reported by the macro itself
        <span class="keyword">else</span> <a href="#1119844" title="Any">expanded</a> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a href="../../../Boolean.scala.html#58725" title="Macros.this.MacroExpansionResult" id="1119937">expanded</a>: Expr<span class="delimiter">[</span>_<span class="delimiter">]</span> =&gt;
            <a href="../../../reflect/makro/util/Traces.scala.html#559471" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><span title="String(&quot;original:&quot;)" class="string">&quot;original:&quot;</span><span class="delimiter">)</span>
            <a href="../../../reflect/makro/util/Traces.scala.html#559470" title="(msg: =&gt; Any)Unit">macroLogLite</a><span class="delimiter">(</span><span title="String(&quot;&quot;)" class="string">&quot;&quot;</span> <span title="(x$1: Any)String">+</span> expanded.<a href="../../../reflect/api/Exprs.scala.html#23434" title="=&gt; Macros.this.global.Tree">tree</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;\n&quot;)" class="string">&quot;\n&quot;</span> <span title="(x$1: Any)String">+</span> <a href="../../../reflect/api/TreePrinters.scala.html#23837" title="(tree: Macros.this.global.Tree)String">showRaw</a><span class="delimiter">(</span>expanded.<a href="../../../reflect/api/Exprs.scala.html#23434" title="=&gt; Macros.this.global.Tree">tree</a><span class="delimiter">)</span><span class="delimiter">)</span>

            <a href="../../../reflect/internal/FreeVars.scala.html#441192" title="(tree: Macros.this.global.Tree)List[Macros.this.global.FreeTerm]">freeTerms</a><span class="delimiter">(</span>expanded.<a href="../../../reflect/api/Exprs.scala.html#23434" title="=&gt; Macros.this.global.Tree">tree</a><span class="delimiter">)</span> <a href="../../../collection/LinearSeqOptimized.scala.html#76166" title="(f: Macros.this.global.FreeTerm =&gt; Unit)Unit">foreach</a> <a href="#1119796" title="(sym: Macros.this.global.FreeSymbol)Unit">issueFreeError</a>
            <a href="../../../reflect/internal/FreeVars.scala.html#441193" title="(tree: Macros.this.global.Tree)List[Macros.this.global.FreeType]">freeTypes</a><span class="delimiter">(</span>expanded.<a href="../../../reflect/api/Exprs.scala.html#23434" title="=&gt; Macros.this.global.Tree">tree</a><span class="delimiter">)</span> <a href="../../../collection/LinearSeqOptimized.scala.html#76166" title="(f: Macros.this.global.FreeType =&gt; Unit)Unit">foreach</a> <a href="#1119796" title="(sym: Macros.this.global.FreeSymbol)Unit">issueFreeError</a>
            <span title="Macros.this.MacroExpansionResult" class="keyword">if</span> <span class="delimiter">(</span><a href="#1119843" title="=&gt; Boolean">hasNewErrors</a><span class="delimiter">)</span> <a href="#1119830" title="(msg: String)Macros.this.Other">failExpansion</a><span class="delimiter">(</span><span class="delimiter">)</span>

            // inherit the position from the first position-ful expandee in macro callstack
            // this is essential for sane error messages
            // now macro expansion gets typechecked against the macro definition return type
            // however, this happens in macroExpand, not here in macroExpand1
            <span class="keyword">else</span> <a href="#1121651" title="(expanded: Macros.this.global.Tree)Macros.this.Success">Success</a><span class="delimiter">(</span><a href="../../../reflect/internal/Positions.scala.html#441889" title="(pos: Macros.this.global.Position)(tree: Macros.this.global.Tree)Macros.this.global.Tree">atPos</a><span class="delimiter">(</span><a href="#560444" title="=&gt; scala.tools.nsc.util.Position">enclosingMacroPosition</a>.<a href="../util/Position.scala.html#445371" title="=&gt; scala.tools.nsc.util.Position">focus</a><span class="delimiter">)</span><span class="delimiter">(</span>expanded.<a href="../../../reflect/api/Exprs.scala.html#23434" title="=&gt; Macros.this.global.Tree">tree</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> _ =&gt;
            <a href="#1119830" title="(msg: String)Macros.this.Other">failExpansion</a><a href="#1119938" title="(x: Macros.this.MacroExpansionResult)Macros.this.MacroExpansionResult" class="delimiter">(</a>
              <span title="String(&quot;macro must return a compiler-specific expr; returned value is &quot;)" class="string">&quot;macro must return a compiler-specific expr; returned value is &quot;</span> <span title="(x$1: Any)String">+</span> <span class="delimiter">(</span>
                <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#1119844" title="Any">expanded</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="../../../reflect/api/Exprs.scala.html#23423" title="Macros.this.global.Expr[_]">Expr</a><span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span> <span title="String(&quot; Expr, but it doesn\'t belong to this compiler\'s universe&quot;)" class="string">&quot; Expr, but it doesn't belong to this compiler's universe&quot;</span>
                <span class="keyword">else</span> <span title="String(&quot; of &quot;)" class="string">&quot; of &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1119844" title="Any">expanded</a>.<span title="()Class[_]">getClass</span>
              <span class="delimiter">)</span>
            <span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span title="Macros.this.MacroExpansionResult" class="keyword">if</span> <span class="delimiter">(</span><a href="#1119827" title="Boolean">wasDelayed</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Macros.this.Other" class="keyword">if</span> <span class="delimiter">(</span><a href="#1119829" title="Boolean">nowDelayed</a><span class="delimiter">)</span> <a href="#560456" title="(expanded: Macros.this.global.Tree)Macros.this.Other">Delay</a><span class="delimiter">(</span><a href="#1119775" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
        <span class="keyword">else</span> <a href="#560457" title="(expanded: Macros.this.global.Tree)Macros.this.Other">Skip</a><span class="delimiter">(</span><a href="#560476" title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree)Macros.this.global.Tree">macroExpandAll</a><span class="delimiter">(</span><a href="#1119774" title="Macros.this.Typer">typer</a>, <a href="#1119775" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="../../../reflect/makro/util/Traces.scala.html#559470" title="(msg: =&gt; Any)Unit">macroLogLite</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;typechecking macro expansion %s at %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1119775" title="Macros.this.global.Tree">expandee</a>, <a href="#1119775" title="Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; Macros.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#560440" title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree)Option[List[Any]]">macroArgs</a><span class="delimiter">(</span><a href="#1119774" title="Macros.this.Typer">typer</a>, <a href="#1119775" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>.<a href="../../../Option.scala.html#63823" title="(ifEmpty: =&gt; Macros.this.MacroExpansionResult)(f: List[Any] =&gt; Macros.this.MacroExpansionResult)Macros.this.MacroExpansionResult">fold</a><span class="delimiter">(</span><a href="#1119830" title="(msg: String)Macros.this.Other">failExpansion</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="#560446" title="Macros.this.MacroExpansionResult">MacroExpansionResult</a><span class="delimiter">)</span> <a title="anonymous class $anonfun extends scala.runtime.AbstractFunction1[List[Any],Macros.this.MacroExpansionResult] with Serializable" id="1119958" class="delimiter">{</a>
          <span class="keyword">case</span> args @ <span class="delimiter">(</span><span class="delimiter">(</span>context: MacroContext<span class="delimiter">)</span> <a href="#1120047" title="Macros.this.MacroExpansionResult" id="1120049">::</a> _<span class="delimiter">)</span> =&gt;
            <a href="#1120051" title="(x: Macros.this.MacroExpansionResult)Macros.this.MacroExpansionResult" class="keyword">if</a> <span class="delimiter">(</span><a href="#1119829" title="Boolean">nowDelayed</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="../../../reflect/makro/util/Traces.scala.html#559470" title="(msg: =&gt; Any)Unit">macroLogLite</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;macro expansion is delayed: %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1119775" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <a href="#560468" title="=&gt; scala.collection.mutable.WeakHashMap[Macros.this.global.Tree,scala.collection.mutable.Set[Int]]">delayed</a> <a href="../../../collection/convert/Wrappers.scala.html#132523" title="(kv: (Macros.this.global.Tree, scala.collection.mutable.Set[Int]))Macros.this.delayed.type">+=</a> <a href="../../../Predef.scala.html#8484" title="(x: Macros.this.global.Tree)ArrowAssoc[Macros.this.global.Tree]">expandee</a> <a href="../../../Predef.scala.html#63591" title="(y: scala.collection.mutable.Set[Int])(Macros.this.global.Tree, scala.collection.mutable.Set[Int])">-&gt;</a> <a href="#1119828" title="scala.collection.mutable.Set[Int]">undetparams</a>
              // need to save typer context for `macroExpandAll`
              // need to save macro context to preserve enclosures
              <a href="#1119775" title="Macros.this.global.Tree">expandee</a> <a href="../../../reflect/api/Trees.scala.html#425048" title="(att: Any)Unit">attach</a> <a href="StdAttachments.scala.html#1119996" title="(delayed: Boolean, typerContext: Macros.this.Context, macroContext: Option[scala.reflect.makro.runtime.Context])Macros.this.MacroAttachment">MacroAttachment</a><span class="delimiter">(</span>delayed = <span title="Boolean(true)" class="keyword">true</span>, typerContext = <a href="#1119774" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#560636" title="=&gt; Macros.this.Context">context</a>, macroContext = <a href="../../../Option.scala.html#64111" title="(x: scala.reflect.makro.runtime.Context)Some[scala.reflect.makro.runtime.Context]">Some</a><span class="delimiter">(</span>context<span class="delimiter">)</span><span class="delimiter">)</span>
              <a href="#560456" title="(expanded: Macros.this.global.Tree)Macros.this.Other">Delay</a><span class="delimiter">(</span><a href="#1119775" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            <span class="keyword">else</span> <span class="delimiter">{</span>
              // adding stuff to openMacros is easy, but removing it is a nightmare
              // it needs to be sprinkled over several different code locations
              // why? https://github.com/scala/scala/commit/bd3eacbae21f39b1ac7fe8ade4ed71fa98e1a28d#L2R1137
              // todo. will be improved
              <a href="#560442" title="(x$1: List[scala.reflect.makro.runtime.Context])Unit">openMacros</a> <a href="../../../collection/immutable/List.scala.html#63643" title="(x: scala.reflect.makro.runtime.Context)List[scala.reflect.makro.runtime.Context]">::=</a> context
              <span class="keyword">var</span> <a title="Boolean" id="1120013">isSuccess</a> = <span title="Boolean(false)" class="keyword">false</span>
              <span class="keyword">try</span> <a href="#1119831" title="(args: List[Any])Macros.this.MacroExpansionResult">performExpansion</a><a href="#1120027" title="Macros.this.Success" class="delimiter">(</a>args<span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <a href="#1120026" title="Macros.this.MacroExpansionResult" id="1120027">x</a>: Success =&gt; <a href="#1120013" title="Boolean">isSuccess</a> = <span title="Boolean(true)" class="keyword">true</span> ; x
                <span class="keyword">case</span> x          =&gt; <a href="#1120028" title="(x: Macros.this.MacroExpansionResult)Macros.this.MacroExpansionResult">x</a>
              <span class="delimiter">}</span>
              <span class="keyword">finally</span> <span class="delimiter">{</span>
                <a href="#1119775" title="Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/api/Trees.scala.html#425051" title="(clazz: Class[_])Unit">detach</a><span class="delimiter">(</span>classOf<span title="Class[Macros.this.MacroAttachment](classOf[scala.tools.nsc.typechecker.StdAttachments$MacroAttachment])" class="delimiter">[</span>MacroAttachment<span class="delimiter">]</span><span class="delimiter">)</span>
                <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#1120013" title="Boolean">isSuccess</a><span class="delimiter">)</span> <a href="#560442" title="(x$1: List[scala.reflect.makro.runtime.Context])Unit">openMacros</a> = <a href="#560442" title="=&gt; List[scala.reflect.makro.runtime.Context]">openMacros</a>.<a href="../../../collection/TraversableLike.scala.html#59012" title="=&gt; List[scala.reflect.makro.runtime.Context]">tail</a>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">try</span> <a href="#1119797" title="=&gt; Macros.this.MacroExpansionResult">macroExpandInternal</a>
    <span class="keyword">catch</span> <span class="delimiter">{</span> <span class="keyword">case</span> <a title="Macros.this.MacroExpansionResult" id="1120061">ex</a> =&gt; <a href="#560464" title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree, ex: Throwable)Macros.this.MacroExpansionResult">handleMacroExpansionException</a><span class="delimiter">(</span><a href="#1119774" title="Macros.this.Typer">typer</a>, <a href="#1119775" title="Macros.this.global.Tree">expandee</a>, <a href="#1120061" title="Throwable">ex</a><span class="delimiter">)</span> <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree)Macros.this.MacroExpansionResult" id="560463">macroExpandWithoutRuntime</a><span class="delimiter">(</span><a title="Macros.this.Typer" id="1119778">typer</a>: <a href="Typers.scala.html#560207" title="Macros.this.Typer">Typer</a>, <a title="Macros.this.global.Tree" id="1119779">expandee</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="#560446" title="Macros.this.MacroExpansionResult">MacroExpansionResult</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="1120067">macroDef</a> = <a href="#1119779" title="Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Macros.this.global.Symbol">symbol</a>
    <span class="keyword">def</span> <a title="()None.type" id="1120068">notFound</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="#1119778" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#560636" title="=&gt; Macros.this.Context">context</a>.<a href="Contexts.scala.html#560985" title="(pos: Macros.this.global.Position, msg: String)Unit">error</a><span class="delimiter">(</span><a href="#1119779" title="Macros.this.global.Tree">expandee</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; Macros.this.global.Position">pos</a>, <span title="String(&quot;macro implementation not found: &quot;)" class="string">&quot;macro implementation not found: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1120067" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#443152" title="=&gt; macroDef.NameType">name</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)String">+</span>
        <span title="String(&quot;(the most common reason for that is that you cannot use macro implementations in the same compilation run that defines them)\n&quot;)" class="string">&quot;(the most common reason for that is that you cannot use macro implementations in the same compilation run that defines them)\n&quot;</span> <span title="(x$1: Any)String">+</span>
        <span title="String(&quot;if you do need to define macro implementations along with the rest of your program, consider two-phase compilation with -Xmacro-fallback-classpath &quot;)" class="string">&quot;if you do need to define macro implementations along with the rest of your program, consider two-phase compilation with -Xmacro-fallback-classpath &quot;</span> <span title="(x$1: Any)String">+</span>
        <span title="String(&quot;in the second phase pointing to the output of the first phase&quot;)" class="string">&quot;in the second phase pointing to the output of the first phase&quot;</span><span class="delimiter">)</span>
      <a href="../../../Option.scala.html#2498" title="None.type">None</a>
    <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="(tree: Macros.this.global.Tree)Option[Macros.this.global.Tree]" id="1120069">fallBackToOverridden</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1120074">tree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../Option.scala.html#1510" title="Option[Macros.this.global.Tree]">Option</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <a href="#1120074" title="Macros.this.global.Tree">tree</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Select<a href="#1120206" title="Option[Macros.this.global.Tree]" id="1120208" class="delimiter">(</a>qual, name<span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#1120067" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#443278" title="=&gt; Boolean">isTermMacro</a><span class="delimiter">)</span> =&gt;
          <a href="#1120067" title="Macros.this.global.Symbol">macroDef</a>.<a href="#1120213" title="(x: Option[Macros.this.global.Tree])Option[Macros.this.global.Tree]">allOverriddenSymbols</a> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> first <a href="#1120123" title="Option[Macros.this.global.Tree]" id="1120125">::</a> _ =&gt;
              <a href="../../../Option.scala.html#64111" title="(x: Macros.this.global.Select)Some[Macros.this.global.Select]">Some</a><a href="#1120126" title="(x: Option[Macros.this.global.Tree])Option[Macros.this.global.Tree]" class="delimiter">(</a><a href="../../../reflect/api/Trees.scala.html#427925" title="(qualifier: Macros.this.global.Tree, name: Macros.this.global.Name)Macros.this.global.Select">Select</a><span class="delimiter">(</span>qual, name<span class="delimiter">)</span> <a href="../../../reflect/api/Trees.scala.html#425044" title="(newpos: scala.tools.nsc.util.Position)Macros.this.global.Select">setPos</a> <a href="#1120074" title="Macros.this.global.Tree">tree</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; Macros.this.global.Position">pos</a> <a href="../../../reflect/api/Trees.scala.html#425066" title="(sym: Macros.this.global.Symbol)Macros.this.global.Select">setSymbol</a> first<span class="delimiter">)</span>
            <span class="keyword">case</span> _ =&gt;
              <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: Macros.this.global.Tree)Macros.this.global.Tree">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;macro is not overridden: &quot;)" class="string">&quot;macro is not overridden: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1120074" title="Macros.this.global.Tree">tree</a><span class="delimiter">)</span>
              <a href="#1120068" title="()None.type">notFound</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="keyword">case</span> Apply<a href="#1120206" title="Option[Macros.this.global.Tree]" id="1120210" class="delimiter">(</a>fn, args<span class="delimiter">)</span> =&gt;
          <a href="#1120069" title="(tree: Macros.this.global.Tree)Option[Macros.this.global.Tree]">fallBackToOverridden</a><a href="#1120213" title="(x: Option[Macros.this.global.Tree])Option[Macros.this.global.Tree]" class="delimiter">(</a>fn<span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> Some<a href="#1120167" title="Option[Macros.this.global.Tree]" id="1120168" class="delimiter">(</a>fn1<span class="delimiter">)</span> =&gt; <a href="../../../Option.scala.html#64111" title="(x: Macros.this.global.Apply)Some[Macros.this.global.Apply]">Some</a><a href="#1120169" title="(x: Option[Macros.this.global.Tree])Option[Macros.this.global.Tree]" class="delimiter">(</a><a href="../../../reflect/api/Trees.scala.html#427174" title="(fun: Macros.this.global.Tree, args: List[Macros.this.global.Tree])Macros.this.global.Apply">Apply</a><span class="delimiter">(</span>fn1, args<span class="delimiter">)</span> <a href="../../../reflect/api/Trees.scala.html#425044" title="(newpos: scala.tools.nsc.util.Position)Macros.this.global.Apply">setPos</a> <a href="#1120074" title="Macros.this.global.Tree">tree</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; Macros.this.global.Position">pos</a><span class="delimiter">)</span>
            <span class="keyword">case</span> _         =&gt; <a href="#1120169" title="(x: Option[Macros.this.global.Tree])Option[Macros.this.global.Tree]">None</a>
          <span class="delimiter">}</span>
        <span class="keyword">case</span> TypeApply<a href="#1120206" title="Option[Macros.this.global.Tree]" id="1120212" class="delimiter">(</a>fn, args<span class="delimiter">)</span> =&gt;
          <a href="#1120069" title="(tree: Macros.this.global.Tree)Option[Macros.this.global.Tree]">fallBackToOverridden</a><a href="#1120213" title="(x: Option[Macros.this.global.Tree])Option[Macros.this.global.Tree]" class="delimiter">(</a>fn<span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> Some<a href="#1120192" title="Option[Macros.this.global.Tree]" id="1120193" class="delimiter">(</a>fn1<span class="delimiter">)</span> =&gt; <a href="../../../Option.scala.html#64111" title="(x: Macros.this.global.TypeApply)Some[Macros.this.global.TypeApply]">Some</a><a href="#1120194" title="(x: Option[Macros.this.global.Tree])Option[Macros.this.global.Tree]" class="delimiter">(</a><a href="../../../reflect/api/Trees.scala.html#429629" title="(fun: Macros.this.global.Tree, args: List[Macros.this.global.Tree])Macros.this.global.TypeApply">TypeApply</a><span class="delimiter">(</span>fn1, args<span class="delimiter">)</span> <a href="../../../reflect/api/Trees.scala.html#425044" title="(newpos: scala.tools.nsc.util.Position)Macros.this.global.TypeApply">setPos</a> <a href="#1120074" title="Macros.this.global.Tree">tree</a>.<a href="../../../reflect/api/Trees.scala.html#425042" title="=&gt; Macros.this.global.Position">pos</a><span class="delimiter">)</span>
            <span class="keyword">case</span> _         =&gt; <a href="#1120194" title="(x: Option[Macros.this.global.Tree])Option[Macros.this.global.Tree]">None</a>
          <span class="delimiter">}</span>
        <span class="keyword">case</span> _ =&gt;
          <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: Macros.this.global.Tree)Macros.this.global.Tree">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;unexpected tree in fallback: &quot;)" class="string">&quot;unexpected tree in fallback: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#1120074" title="Macros.this.global.Tree">tree</a><span class="delimiter">)</span>
          <a href="#1120068" title="()None.type">notFound</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <a href="#1120069" title="(tree: Macros.this.global.Tree)Option[Macros.this.global.Tree]">fallBackToOverridden</a><a href="../../../Option.scala.html#64115" title="=&gt; Macros.this.global.Tree" class="delimiter">(</a><a href="#1119779" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> Some<a href="#1120234" title="Macros.this.MacroExpansionResult" id="1120235" class="delimiter">(</a>tree1<span class="delimiter">)</span> =&gt;
        <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: Macros.this.global.Tree)Macros.this.global.Tree">macroTraceLite</a><span class="delimiter">(</span><span title="String(&quot;falling back to: &quot;)" class="string">&quot;falling back to: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span>tree1<span class="delimiter">)</span>
        <a href="../Global.scala.html#559697" title="=&gt; Macros.this.global.Run">currentRun</a>.<a href="../Global.scala.html#561275" title="(x$1: Boolean)Unit">macroExpansionFailed</a> = <span title="Boolean(true)" class="keyword">true</span>
        <a href="#1121655" title="(fallback: Macros.this.global.Tree)Macros.this.Fallback">Fallback</a><span class="delimiter">(</span>tree1<span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="../../../Option.scala.html#2498" title="Macros.this.MacroExpansionResult" id="1120237">None</a> =&gt;
        <a href="#560460" title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree, msg: String)Macros.this.Other">fail</a><a href="#1120238" title="(x: Macros.this.MacroExpansionResult)Macros.this.MacroExpansionResult" class="delimiter">(</a><a href="#1119778" title="Macros.this.Typer">typer</a>, <a href="#1119779" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree, ex: Throwable)Macros.this.MacroExpansionResult" id="560464">handleMacroExpansionException</a><span class="delimiter">(</span><a title="Macros.this.Typer" id="1120062">typer</a>: <a href="Typers.scala.html#560207" title="Macros.this.Typer">Typer</a>, <a title="Macros.this.global.Tree" id="1120063">expandee</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a>, <a title="Throwable" id="1120064">ex</a>: <span title="Throwable">Throwable</span><span class="delimiter">)</span>: <a href="#560446" title="Macros.this.MacroExpansionResult">MacroExpansionResult</a> = <span class="delimiter">{</span>
    // [Eugene] any ideas about how to improve this one?
    <span class="keyword">val</span> <a title="Throwable" id="1120246">realex</a> = <a href="../../../reflect/ReflectionUtils.scala.html#3412" title="scala.reflect.ReflectionUtils.type">ReflectionUtils</a>.<a href="../../../reflect/ReflectionUtils.scala.html#63406" title="(x: Throwable)Throwable">unwrapThrowable</a><span class="delimiter">(</span><a href="#1120064" title="Throwable">ex</a><span class="delimiter">)</span>
    <a href="#1120246" title="Throwable">realex</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#1121166" title="Macros.this.MacroExpansionResult" id="1121169">realex</a>: reflect.makro.runtime.AbortMacroException =&gt;
        <a href="../../../reflect/makro/util/Traces.scala.html#559471" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;macro expansion has failed: %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span>realex.<a href="../../../reflect/makro/runtime/AbortMacroException.scala.html#559288" title="=&gt; String">msg</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#560460" title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree, msg: String)Macros.this.Other">fail</a><span class="delimiter">(</span><a href="#1120062" title="Macros.this.Typer">typer</a>, <a href="#1120063" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span> // error has been reported by abort
      <span class="keyword">case</span> <a href="../../../Boolean.scala.html#58725" title="Macros.this.MacroExpansionResult" id="1121170">err</a>: TypeError =&gt;
        <a href="../../../reflect/makro/util/Traces.scala.html#559470" title="(msg: =&gt; Any)Unit">macroLogLite</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;macro expansion has failed: %s at %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span>err.<a href="../../../reflect/internal/Types.scala.html#448881" title="=&gt; String">msg</a>, err.<a href="../../../reflect/internal/Types.scala.html#448878" title="=&gt; Macros.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">throw</span> err // error should be propagated, don't report
      <span class="keyword">case</span> _ =&gt;
        <span class="keyword">val</span> <a title="String" id="1120255">message</a> = <span class="delimiter">{</span>
          <span class="keyword">try</span> <span class="delimiter">{</span>
            // [Eugene] is there a better way?
            // [Paul] See Exceptional.scala and Origins.scala.
            <span class="keyword">val</span> <a title="Int" id="1120256">relevancyThreshold</a> = <a href="#1120246" title="Throwable">realex</a>.<span title="()Array[StackTraceElement]">getStackTrace</span><a href="../../../Predef.scala.html#8521" title="(xs: Array[StackTraceElement])scala.collection.mutable.ArrayOps[StackTraceElement]" class="delimiter">(</a><span class="delimiter">)</span>.<a href="../../../collection/GenSeqLike.scala.html#59604" title="(p: StackTraceElement =&gt; Boolean)Int">indexWhere</a><span class="delimiter">(</span><a title="StackTraceElement" id="1120577">este</a> =&gt; <a href="#1120577" title="StackTraceElement">este</a>.<span title="()String">getMethodName</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="String(&quot;macroExpand1&quot;)" class="string">&quot;macroExpand1&quot;</span><span class="delimiter">)</span>
            <span title="Option[String]" class="keyword">if</span> <span class="delimiter">(</span><a href="#1120256" title="Int">relevancyThreshold</a> <a href="../../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span> <a href="../../../Option.scala.html#2498" title="None.type">None</a>
            <span class="keyword">else</span> <span class="delimiter">{</span>
              <span class="keyword">var</span> <a title="Array[StackTraceElement]" id="1120587">relevantElements</a> = <a href="#1120246" title="Throwable">realex</a>.<span title="()Array[StackTraceElement]">getStackTrace</span><a href="../../../Predef.scala.html#8521" title="(xs: Array[StackTraceElement])scala.collection.mutable.ArrayOps[StackTraceElement]" class="delimiter">(</a><span class="delimiter">)</span>.<a href="../../../collection/IndexedSeqOptimized.scala.html#60120" title="(n: Int)Array[StackTraceElement]">take</a><span class="delimiter">(</span><a href="#1120256" title="Int">relevancyThreshold</a> <a href="../../../Int.scala.html#57948" title="(x: Int)Int">+</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
              <span class="keyword">var</span> <a title="Int" id="1120588">framesTillReflectiveInvocationOfMacroImpl</a> = <a href="../../../Predef.scala.html#8521" title="(xs: Array[StackTraceElement])scala.collection.mutable.ArrayOps[StackTraceElement]">relevantElements</a>.<a href="../../../Predef.scala.html#8521" title="(xs: Array[StackTraceElement])scala.collection.mutable.ArrayOps[StackTraceElement]">reverse</a>.<a href="../../../collection/GenSeqLike.scala.html#59604" title="(p: StackTraceElement =&gt; Boolean)Int">indexWhere</a><span class="delimiter">(</span><a href="#1121070" title="StackTraceElement">_</a>.<span title="()Boolean">isNativeMethod</span><span class="delimiter">)</span> <a href="../../../Int.scala.html#57948" title="(x: Int)Int">+</a> <span title="Int(1)" class="int">1</span>
              <a href="#1120587" title="Array[StackTraceElement]">relevantElements</a> = <a href="../../../Predef.scala.html#8521" title="(xs: Array[StackTraceElement])scala.collection.mutable.ArrayOps[StackTraceElement]">relevantElements</a> <a href="../../../collection/IndexedSeqOptimized.scala.html#60123" title="(n: Int)Array[StackTraceElement]">dropRight</a> <a href="#1120588" title="Int">framesTillReflectiveInvocationOfMacroImpl</a>

              <a href="#1120246" title="Throwable">realex</a>.<span title="(x$1: Array[StackTraceElement])Unit">setStackTrace</span><span class="delimiter">(</span><a href="#1120587" title="Array[StackTraceElement]">relevantElements</a><span class="delimiter">)</span>
              <span class="keyword">val</span> <a title="java.io.StringWriter" id="1120589">message</a> = <span title="java.io.StringWriter" class="keyword">new</span> java.io.<span title="java.io.StringWriter">StringWriter</span><span class="delimiter">(</span><span class="delimiter">)</span>
              <a href="#1120246" title="Throwable">realex</a>.<span title="(x$1: java.io.PrintWriter)Unit">printStackTrace</span><span class="delimiter">(</span><span title="java.io.PrintWriter" class="keyword">new</span> java.io.<span title="java.io.PrintWriter">PrintWriter</span><span class="delimiter">(</span><a href="#1120589" title="java.io.StringWriter">message</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <a href="../../../Option.scala.html#64111" title="(x: String)Some[String]">Some</a><span class="delimiter">(</span><a href="../../../compat/Platform.scala.html#67813" title="=&gt; String">EOL</a> <span title="(x$1: Any)String">+</span> <a href="#1120589" title="java.io.StringWriter">message</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
            // if the magic above goes boom, just fall back to uninformative, but better than nothing, getMessage
            <span class="keyword">case</span> <a title="None.type" id="1121160">ex</a>: <span title="Throwable">Throwable</span> =&gt;
              <a href="../../../Option.scala.html#2498" title="None.type">None</a>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span> <a href="../../../Option.scala.html#63814" title="(default: =&gt; String)String">getOrElse</a> <a href="#1120246" title="Throwable">realex</a>.<span title="()String">getMessage</span>
        <a href="#560460" title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree, msg: String)Macros.this.Other">fail</a><span class="delimiter">(</span><a href="#1120062" title="Macros.this.Typer">typer</a>, <a href="#1120063" title="Macros.this.global.Tree">expandee</a>, <span title="String(&quot;exception during macro expansion: &quot;)" class="string">&quot;exception during macro expansion: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#1120255" title="String">message</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** Without any restrictions on macro expansion, macro applications will expand at will,
   *  and when type inference is involved, expansions will end up using yet uninferred type params.
   *
   *  For some macros this might be ok (thanks to TreeTypeSubstituter that replaces
   *  the occurrences of undetparams with their inferred values), but in general case this won't work.
   *  E.g. for reification simple substitution is not enough - we actually need to re-reify inferred types.
   *
   *  Luckily, there exists a very simple way to fix the problem: delay macro expansion until everything is inferred.
   *  Here are the exact rules. Macro application gets delayed if any of its subtrees contain:
   *    1) type vars (tpe.isInstanceOf[TypeVar]) // [Eugene] this check is disabled right now, because TypeVars seem to be created from undetparams anyways
   *    2) undetparams (sym.isTypeParameter &amp;&amp; !sym.isSkolem)
   */
  <span class="keyword">var</span> <a title="Boolean" id="560466">hasPendingMacroExpansions</a> = <span title="Boolean(false)" class="keyword">false</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.WeakHashMap[Macros.this.global.Tree,scala.collection.mutable.Set[Int]]" id="560468">delayed</a> = <a href="../../../reflect/internal/SymbolTable.scala.html#440630" title="Macros.this.global.perRunCaches.type">perRunCaches</a>.<a href="../../../reflect/internal/SymbolTable.scala.html#492845" title="[K, V]()scala.collection.mutable.WeakHashMap[K,V]">newWeakMap</a><span title="()scala.collection.mutable.WeakHashMap[Macros.this.global.Tree,scala.collection.mutable.Set[Int]]" class="delimiter">[</span><a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a>, collection.mutable.<a href="../../../collection/mutable/Set.scala.html#13528" title="scala.collection.mutable.Set[Int]">Set</a><span class="delimiter">[</span>Int<span class="delimiter">]</span><span class="delimiter">]</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(expandee: Macros.this.global.Tree)Boolean" id="560470">isDelayed</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1119832">expandee</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span> = <a href="#560468" title="=&gt; scala.collection.mutable.WeakHashMap[Macros.this.global.Tree,scala.collection.mutable.Set[Int]]">delayed</a> <a href="../../../collection/MapLike.scala.html#78421" title="(key: Macros.this.global.Tree)Boolean">contains</a> <a href="#1119832" title="Macros.this.global.Tree">expandee</a>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(expandee: Macros.this.global.Tree)scala.collection.mutable.Set[Int]" id="560471">calculateUndetparams</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1119837">expandee</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: collection.mutable.<a href="../../../collection/mutable/Set.scala.html#13528" title="scala.collection.mutable.Set[Int]">Set</a><span class="delimiter">[</span>Int<span class="delimiter">]</span> =
    <a href="#560468" title="=&gt; scala.collection.mutable.WeakHashMap[Macros.this.global.Tree,scala.collection.mutable.Set[Int]]">delayed</a>.<a href="../../../collection/convert/Wrappers.scala.html#132522" title="(k: Macros.this.global.Tree)Option[scala.collection.mutable.Set[Int]]">get</a><span class="delimiter">(</span><a href="#1119837" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>.<a href="../../../Option.scala.html#63814" title="(default: =&gt; scala.collection.mutable.Set[Int])scala.collection.mutable.Set[Int]">getOrElse</a> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.Set[Macros.this.global.Symbol]" id="1121184">calculated</a> = collection.mutable.<a href="../../../collection/generic/GenericCompanion.scala.html#60782" title="[A](elems: A*)scala.collection.mutable.Set[A]">Set</a><span title="(elems: Macros.this.global.Symbol*)scala.collection.mutable.Set[Macros.this.global.Symbol]" class="delimiter">[</span><a href="../../../reflect/internal/Symbols.scala.html#441132" title="Macros.this.global.Symbol">Symbol</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#1119837" title="Macros.this.global.Tree">expandee</a> <a href="../../../reflect/api/Trees.scala.html#425074" title="(f: Macros.this.global.Tree =&gt; Unit)Unit">foreach</a> <span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1121188">sub</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">def</span> <a title="(sym: Macros.this.global.Symbol)Any" id="1121189">traverse</a><span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1121190">sym</a>: <a href="../../../reflect/internal/Symbols.scala.html#441132" title="Macros.this.global.Symbol">Symbol</a><span class="delimiter">)</span> = <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#1121190" title="Macros.this.global.Symbol">sym</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span><a href="#560472" title="=&gt; scala.collection.mutable.HashSet[Int]">undetparams</a> <a href="../../../collection/mutable/HashSet.scala.html#141569" title="(elem: Int)Boolean">contains</a> <a href="#1121190" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#443162" title="=&gt; Int">id</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#1121184" title="scala.collection.mutable.Set[Macros.this.global.Symbol]">calculated</a> <a href="../../../collection/mutable/SetLike.scala.html#82190" title="(elem: Macros.this.global.Symbol)calculated.type">+=</a> <a href="#1121190" title="Macros.this.global.Symbol">sym</a>
        <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#1121188" title="Macros.this.global.Tree">sub</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Macros.this.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#1121189" title="(sym: Macros.this.global.Symbol)Any">traverse</a><span class="delimiter">(</span><a href="#1121188" title="Macros.this.global.Tree">sub</a>.<a href="../../../reflect/api/Trees.scala.html#425064" title="=&gt; Macros.this.global.Symbol">symbol</a><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1121188" title="Macros.this.global.Tree">sub</a>.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; Macros.this.global.Type">tpe</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#1121188" title="Macros.this.global.Tree">sub</a>.<a href="../../../reflect/api/Trees.scala.html#425060" title="=&gt; Macros.this.global.Type">tpe</a> <a href="../../../reflect/internal/Types.scala.html#442050" title="(f: Macros.this.global.Type =&gt; Unit)Unit">foreach</a> <span class="delimiter">(</span><a title="Macros.this.global.Type" id="1121233">sub</a> =&gt; <a href="#1121189" title="(sym: Macros.this.global.Symbol)Any">traverse</a><span title="Unit" class="delimiter">(</span><a href="#1121233" title="Macros.this.global.Type">sub</a>.<a href="../../../reflect/internal/Types.scala.html#441986" title="=&gt; Macros.this.global.Symbol">typeSymbol</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
      <a href="../../../reflect/makro/util/Traces.scala.html#559471" title="(msg: =&gt; Any)Unit">macroLogVerbose</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;calculateUndetparams: %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1121184" title="scala.collection.mutable.Set[Macros.this.global.Symbol]">calculated</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#1121184" title="scala.collection.mutable.Set[Macros.this.global.Symbol]">calculated</a> <a href="../../../collection/SetLike.scala.html#71313" title="(f: Macros.this.global.Symbol =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Set[Macros.this.global.Symbol],Int,scala.collection.mutable.Set[Int]])scala.collection.mutable.Set[Int]">map</a> <span class="delimiter">(</span><a href="#1121259" title="Macros.this.global.Symbol">_</a>.<a href="../../../reflect/internal/Symbols.scala.html#443162" title="=&gt; Int">id</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.HashSet[Int]" id="560472">undetparams</a> = <a href="../../../reflect/internal/SymbolTable.scala.html#440630" title="Macros.this.global.perRunCaches.type">perRunCaches</a>.<a href="../../../reflect/internal/SymbolTable.scala.html#492855" title="[K]()scala.collection.mutable.HashSet[K]">newSet</a><span title="()scala.collection.mutable.HashSet[Int]" class="delimiter">[</span><a href="../../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">]</span>
  <span class="keyword">def</span> <a title="(newUndets: List[Macros.this.global.Symbol])Unit" id="560474">notifyUndetparamsAdded</a><span class="delimiter">(</span><a title="List[Macros.this.global.Symbol]" id="1121285">newUndets</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[Macros.this.global.Symbol]">List</a><span class="delimiter">[</span>Symbol<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../Unit.scala.html#2389" title="Unit">Unit</a> = <span class="delimiter">{</span>
    <a href="#560472" title="=&gt; scala.collection.mutable.HashSet[Int]">undetparams</a> <a href="../../../collection/generic/Growable.scala.html#60913" title="(xs: scala.collection.TraversableOnce[Int])Macros.this.undetparams.type">++=</a> <a href="#1121285" title="List[Macros.this.global.Symbol]">newUndets</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: Macros.this.global.Symbol =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Symbol],Int,scala.collection.TraversableOnce[Int]])scala.collection.TraversableOnce[Int]">map</a> <span class="delimiter">(</span><a href="#1121304" title="Macros.this.global.Symbol">_</a>.<a href="../../../reflect/internal/Symbols.scala.html#443162" title="=&gt; Int">id</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../reflect/makro/util/Traces.scala.html#559464" title="=&gt; Boolean">macroDebugVerbose</a><span class="delimiter">)</span> <a href="#1121285" title="List[Macros.this.global.Symbol]">newUndets</a> <a href="../../../collection/LinearSeqOptimized.scala.html#76166" title="(f: Macros.this.global.Symbol =&gt; Unit)Unit">foreach</a> <span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="1121351">sym</a> =&gt; <a href="../../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;undetParam added: %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#1121351" title="Macros.this.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="keyword">def</span> <a title="(undetNoMore: List[Macros.this.global.Symbol], inferreds: List[Macros.this.global.Type])Unit" id="560475">notifyUndetparamsInferred</a><span class="delimiter">(</span><a title="List[Macros.this.global.Symbol]" id="1098530">undetNoMore</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[Macros.this.global.Symbol]">List</a><span class="delimiter">[</span>Symbol<span class="delimiter">]</span>, <a title="List[Macros.this.global.Type]" id="1098531">inferreds</a>: <a href="../../../collection/immutable/List.scala.html#12322" title="List[Macros.this.global.Type]">List</a><span class="delimiter">[</span>Type<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../Unit.scala.html#2389" title="Unit">Unit</a> = <span class="delimiter">{</span>
    <a href="#560472" title="=&gt; scala.collection.mutable.HashSet[Int]">undetparams</a> <a href="../../../collection/generic/Shrinkable.scala.html#67906" title="(xs: scala.collection.TraversableOnce[Int])Macros.this.undetparams.type">--=</a> <a href="#1098530" title="List[Macros.this.global.Symbol]">undetNoMore</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: Macros.this.global.Symbol =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Symbol],Int,scala.collection.TraversableOnce[Int]])scala.collection.TraversableOnce[Int]">map</a> <span class="delimiter">(</span><a href="#1121375" title="Macros.this.global.Symbol">_</a>.<a href="../../../reflect/internal/Symbols.scala.html#443162" title="=&gt; Int">id</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../reflect/makro/util/Traces.scala.html#559464" title="=&gt; Boolean">macroDebugVerbose</a><span class="delimiter">)</span> <span class="delimiter">(</span><a href="#1098530" title="List[Macros.this.global.Symbol]">undetNoMore</a> <a href="../../../collection/IterableLike.scala.html#59486" title="(that: scala.collection.GenIterable[Macros.this.global.Type])(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Symbol],(Macros.this.global.Symbol, Macros.this.global.Type),List[(Macros.this.global.Symbol, Macros.this.global.Type)]])List[(Macros.this.global.Symbol, Macros.this.global.Type)]">zip</a> <a href="#1098531" title="List[Macros.this.global.Type]">inferreds</a><span class="delimiter">)</span> <a href="../../../collection/LinearSeqOptimized.scala.html#76166" title="(f: ((Macros.this.global.Symbol, Macros.this.global.Type)) =&gt; Unit)Unit">foreach</a> <a title="anonymous class $anonfun extends scala.runtime.AbstractFunction1[(Macros.this.global.Symbol, Macros.this.global.Type),Unit] with Serializable" id="1121476" class="delimiter">{</a> <span class="keyword">case</span> <span class="delimiter">(</span>sym, tpe<span class="delimiter">)</span> =&gt; <a href="../../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><a href="#1121489" title="(x: Unit)Unit" class="delimiter">(</a><a href="../../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;undetParam inferred: %s as %s&quot;</a>.<a href="../../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span>sym, tpe<span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">}</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#560468" title="=&gt; scala.collection.mutable.WeakHashMap[Macros.this.global.Tree,scala.collection.mutable.Set[Int]]">delayed</a>.<a href="../../../collection/MapLike.scala.html#78416" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span>
      <a href="#560468" title="=&gt; scala.collection.mutable.WeakHashMap[Macros.this.global.Tree,scala.collection.mutable.Set[Int]]">delayed</a>.<a href="../../../collection/TraversableOnce.scala.html#59174" title="=&gt; List[(Macros.this.global.Tree, scala.collection.mutable.Set[Int])]">toList</a> <a href="../../../collection/LinearSeqOptimized.scala.html#76166" title="(f: ((Macros.this.global.Tree, scala.collection.mutable.Set[Int])) =&gt; Any)Unit">foreach</a> <a title="anonymous class $anonfun extends scala.runtime.AbstractFunction1[(Macros.this.global.Tree, scala.collection.mutable.Set[Int]),Any] with Serializable" id="1121529" class="delimiter">{</a>
        <span class="keyword">case</span> <span class="delimiter">(</span>expandee, undetparams<span class="delimiter">)</span> <span class="keyword">if</span> <a href="../../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a>undetparams.<a href="../../../collection/SetLike.scala.html#71324" title="=&gt; Boolean">isEmpty</a> =&gt;
          undetparams <a href="../../../collection/generic/Shrinkable.scala.html#67906" title="(xs: scala.collection.TraversableOnce[Int])scala.collection.mutable.Set[Int]">--=</a> <a href="#1098530" title="List[Macros.this.global.Symbol]">undetNoMore</a> <a href="../../../collection/TraversableLike.scala.html#58971" title="(f: Macros.this.global.Symbol =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.Symbol],Int,scala.collection.TraversableOnce[Int]])scala.collection.TraversableOnce[Int]">map</a> <span class="delimiter">(</span><a href="#1121546" title="Macros.this.global.Symbol">_</a>.<a href="../../../reflect/internal/Symbols.scala.html#443162" title="=&gt; Int">id</a><span class="delimiter">)</span>
          <span title="Any" class="keyword">if</span> <span class="delimiter">(</span>undetparams.<a href="../../../collection/SetLike.scala.html#71324" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#560466" title="(x$1: Boolean)Unit">hasPendingMacroExpansions</a> = <span title="Boolean(true)" class="keyword">true</span>
            <a href="../util/SimpleTracer.scala.html#563196" title="(msg: String)(value: Macros.this.global.Tree)Macros.this.global.Tree">macroTraceVerbose</a><span class="delimiter">(</span><span title="String(&quot;macro expansion is pending: &quot;)" class="string">&quot;macro expansion is pending: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span>expandee<span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="keyword">case</span> _ =&gt;
          // do nothing
      <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** Performs macro expansion on all subtrees of a given tree.
   *  Innermost macros are expanded first, outermost macros are expanded last.
   *  See the documentation for ``macroExpand'' for more information.
   */
  <span class="keyword">def</span> <a title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree)Macros.this.global.Tree" id="560476">macroExpandAll</a><span class="delimiter">(</span><a title="Macros.this.Typer" id="1119943">typer</a>: <a href="Typers.scala.html#560207" title="Macros.this.Typer">Typer</a>, <a title="Macros.this.global.Tree" id="1119944">expandee</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a> =
    <a href="#1121604" title="Macros.this.global.Transformer" class="keyword">new</a> <a href="../ast/Trees.scala.html#559848" title="anonymous class $anon extends Macros.this.global.Transformer" id="1121604">Transformer</a> <span class="delimiter">{</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: Macros.this.global.Tree)Macros.this.global.Tree" id="1121606">transform</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="1121607">tree</a>: <a href="../../../reflect/api/Trees.scala.html#23570" title="Macros.this.global.Tree">Tree</a><span class="delimiter">)</span> = <a href="#1121604" title="Macros.this.global.Transformer" class="keyword">super</a>.<a href="../../../reflect/api/Trees.scala.html#438847" title="(tree: Macros.this.global.Tree)Macros.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#1121607" title="Macros.this.global.Tree">tree</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        // todo. expansion should work from the inside out
        <span class="keyword">case</span> wannabe <span class="keyword">if</span> <span class="delimiter">(</span><a href="#560468" title="=&gt; scala.collection.mutable.WeakHashMap[Macros.this.global.Tree,scala.collection.mutable.Set[Int]]">delayed</a> <a href="../../../collection/MapLike.scala.html#78421" title="(key: Macros.this.global.Tree)Boolean">contains</a> wannabe<span class="delimiter">)</span> <a href="../../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#560471" title="(expandee: Macros.this.global.Tree)scala.collection.mutable.Set[Int]">calculateUndetparams</a><span class="delimiter">(</span>wannabe<span class="delimiter">)</span>.<a href="../../../collection/SetLike.scala.html#71324" title="=&gt; Boolean">isEmpty</a> =&gt;
          <span class="keyword">val</span> <a title="Macros.this.Context" id="1121612">context</a> = wannabe.<a href="../../../reflect/api/Trees.scala.html#425053" title="[T](implicit evidence$1: scala.reflect.ClassTag[T])T">attachment</a><a href="../../../reflect/ClassTag.scala.html#61898" title="(implicit evidence$1: scala.reflect.ClassTag[Macros.this.MacroAttachment])Macros.this.MacroAttachment" class="delimiter">[</a><a href="StdAttachments.scala.html#560589" title="Macros.this.MacroAttachment">MacroAttachment</a><span class="delimiter">]</span>.<a href="StdAttachments.scala.html#1114135" title="=&gt; Macros.this.Context">typerContext</a>
          <a href="#560468" title="=&gt; scala.collection.mutable.WeakHashMap[Macros.this.global.Tree,scala.collection.mutable.Set[Int]]">delayed</a> <a href="../../../collection/convert/Wrappers.scala.html#132524" title="(key: Macros.this.global.Tree)Macros.this.delayed.type">-=</a> wannabe
          <a href="#1121612" title="Macros.this.Context">context</a>.<a href="Contexts.scala.html#560905" title="(x$1: Boolean)Unit">implicitsEnabled</a> = <a href="#1119943" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#560636" title="=&gt; Macros.this.Context">context</a>.<a href="Contexts.scala.html#560904" title="=&gt; Boolean">implicitsEnabled</a>
          <a href="#1121612" title="Macros.this.Context">context</a>.<a href="Contexts.scala.html#560911" title="(x$1: Boolean)Unit">enrichmentEnabled</a> = <a href="#1119943" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#560636" title="=&gt; Macros.this.Context">context</a>.<a href="Contexts.scala.html#560910" title="=&gt; Boolean">enrichmentEnabled</a>
          <a href="#1121612" title="Macros.this.Context">context</a>.<a href="Contexts.scala.html#560908" title="(x$1: Boolean)Unit">macrosEnabled</a> = <a href="#1119943" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#560636" title="=&gt; Macros.this.Context">context</a>.<a href="Contexts.scala.html#560907" title="=&gt; Boolean">macrosEnabled</a>
          <a href="#560445" title="(typer: Macros.this.Typer, expandee: Macros.this.global.Tree, mode: Int, pt: Macros.this.global.Type)Macros.this.global.Tree">macroExpand</a><span class="delimiter">(</span><a href="Typers.scala.html#560201" title="(context: Macros.this.Context)Macros.this.Typer">newTyper</a><span class="delimiter">(</span><a href="#1121612" title="Macros.this.Context">context</a><span class="delimiter">)</span>, wannabe, <span title="Int(1)">EXPRmode</span>, <a href="../../../reflect/internal/Types.scala.html#441251" title="Macros.this.global.WildcardType.type">WildcardType</a><span class="delimiter">)</span>
        <span class="keyword">case</span> _ =&gt;
          <a href="#1121639" title="(x: Macros.this.global.Tree)Macros.this.global.Tree">tree</a>
      <span class="delimiter">}</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>.<a href="#1121606" title="(tree: Macros.this.global.Tree)Macros.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#1119944" title="Macros.this.global.Tree">expandee</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
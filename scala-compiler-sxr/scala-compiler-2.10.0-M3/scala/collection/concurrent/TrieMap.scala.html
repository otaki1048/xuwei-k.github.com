<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/collection/concurrent/TrieMap.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
/*                     __                                               *\
**     ________ ___   / /  ___     Scala API                            **
**    / __/ __// _ | / /  / _ |    (c) 2003-2012, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */

<span class="keyword">package</span> scala.collection
<span class="keyword">package</span> concurrent



<span class="keyword">import</span> java.util.concurrent.atomic._
<span class="keyword">import</span> collection.immutable.<span class="delimiter">{</span> ListMap =&gt; ImmutableListMap <span class="delimiter">}</span>
<span class="keyword">import</span> collection.parallel.mutable.ParTrieMap
<span class="keyword">import</span> generic._
<span class="keyword">import</span> annotation.tailrec
<span class="keyword">import</span> annotation.switch



<span class="keyword">private</span><span class="delimiter">[</span>collection<span class="delimiter">]</span> <span class="keyword">final</span> <span class="keyword">class</span> <a title="class INode[K, V] extends scala.collection.concurrent.INodeBase[K,V]" id="10422">INode</a><span class="delimiter">[</span><a title="" id="10497">K</a>, <a title="" id="10498">V</a><span class="delimiter">]</span><a href="#10422" title="scala.collection.concurrent.INode[K,V]" class="delimiter">(</a><a title="scala.collection.concurrent.MainNode[K,V]" id="170200">bn</a>: <a href="MainNode.java.html#10413" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.Gen" id="170201">g</a>: <a href="Gen.java.html#10467" title="scala.collection.concurrent.Gen">Gen</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="INodeBase.java.html#10425" title="scala.collection.concurrent.INodeBase[K,V]">INodeBase</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">(</span><a href="#170201" title="scala.collection.concurrent.Gen">g</a><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="keyword">import</span> <a href="INodeBase.java.html#10426" title="scala.collection.concurrent.INodeBase.type">INodeBase</a>._

  <a href="#170173" title="(nval: scala.collection.concurrent.MainNode[K,V])Unit">WRITE</a><span class="delimiter">(</span><a href="#170200" title="scala.collection.concurrent.MainNode[K,V]">bn</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(g: scala.collection.concurrent.Gen)scala.collection.concurrent.INode[K,V]" id="170172" class="keyword">this</a><span class="delimiter">(</span><a title="scala.collection.concurrent.Gen" id="170271">g</a>: <a href="Gen.java.html#10467" title="scala.collection.concurrent.Gen">Gen</a><span class="delimiter">)</span> = <a href="#10422" title="INode.this.type" class="keyword">this</a><span class="delimiter">(</span><span title="Null(null)" class="keyword">null</span>, <a href="#170271" title="scala.collection.concurrent.Gen">g</a><span class="delimiter">)</span>

  @inline <span class="keyword">final</span> <span class="keyword">def</span> <a title="(nval: scala.collection.concurrent.MainNode[K,V])Unit" id="170173">WRITE</a><span class="delimiter">(</span><a title="scala.collection.concurrent.MainNode[K,V]" id="170209">nval</a>: <a href="MainNode.java.html#10413" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="INodeBase.java.html#10426" title="scala.collection.concurrent.INodeBase.type">INodeBase</a>.<a href="INodeBase.java.html#170206" title="java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.INodeBase[_, _],scala.collection.concurrent.MainNode[_, _]]">updater</a>.<span title="(x$1: scala.collection.concurrent.INodeBase[_, _], x$2: scala.collection.concurrent.MainNode[_, _])Unit">set</span><span class="delimiter">(</span><a href="#10422" title="scala.collection.concurrent.INode[K,V]" class="keyword">this</a>, <a href="#170209" title="scala.collection.concurrent.MainNode[K,V]">nval</a><span class="delimiter">)</span>

  @inline <span class="keyword">final</span> <span class="keyword">def</span> <a title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V])Boolean" id="170174">CAS</a><span class="delimiter">(</span><a title="scala.collection.concurrent.MainNode[K,V]" id="170281">old</a>: <a href="MainNode.java.html#10413" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.MainNode[K,V]" id="170282">n</a>: <a href="MainNode.java.html#10413" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="INodeBase.java.html#10426" title="scala.collection.concurrent.INodeBase.type">INodeBase</a>.<a href="INodeBase.java.html#170206" title="java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.INodeBase[_, _],scala.collection.concurrent.MainNode[_, _]]">updater</a>.<span title="(x$1: scala.collection.concurrent.INodeBase[_, _], x$2: scala.collection.concurrent.MainNode[_, _], x$3: scala.collection.concurrent.MainNode[_, _])Boolean">compareAndSet</span><span class="delimiter">(</span><a href="#10422" title="scala.collection.concurrent.INode[K,V]" class="keyword">this</a>, <a href="#170281" title="scala.collection.concurrent.MainNode[K,V]">old</a>, <a href="#170282" title="scala.collection.concurrent.MainNode[K,V]">n</a><span class="delimiter">)</span>

  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]" id="170175">gcasRead</a><span class="delimiter">(</span><a title="scala.collection.concurrent.TrieMap[K,V]" id="170292">ct</a>: <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="MainNode.java.html#10413" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <a href="#170176" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_READ</a><span class="delimiter">(</span><a href="#170292" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>

  @inline <span class="keyword">final</span> <span class="keyword">def</span> <a title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]" id="170176">GCAS_READ</a><span class="delimiter">(</span><a title="scala.collection.concurrent.TrieMap[K,V]" id="170342">ct</a>: <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="MainNode.java.html#10413" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="170343">m</a> = /*READ*/<a href="INodeBase.java.html#170162" title="scala.collection.concurrent.MainNode[K,V]">mainnode</a>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="170344">prevval</a> = /*READ*/<a href="#170343" title="scala.collection.concurrent.MainNode[K,V]">m</a>.<a href="MainNode.java.html#170194" title="scala.collection.concurrent.MainNode[K,V]">prev</a>
    <span title="scala.collection.concurrent.MainNode[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#170344" title="scala.collection.concurrent.MainNode[K,V]">prevval</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#170343" title="scala.collection.concurrent.MainNode[K,V]">m</a>
    <span class="keyword">else</span> <a href="#170177" title="(m: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_Complete</a><span class="delimiter">(</span><a href="#170343" title="scala.collection.concurrent.MainNode[K,V]">m</a>, <a href="#170342" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  @tailrec <span class="keyword">private</span> <span class="keyword">def</span> <a title="(m: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]" id="170177">GCAS_Complete</a><span class="delimiter">(</span><a title="scala.collection.concurrent.MainNode[K,V]" id="170347">m</a>: <a href="MainNode.java.html#10413" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.TrieMap[K,V]" id="170348">ct</a>: <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="MainNode.java.html#10413" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <span title="scala.collection.concurrent.MainNode[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#170347" title="scala.collection.concurrent.MainNode[K,V]">m</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span title="Null(null)" class="keyword">null</span> <span class="keyword">else</span> <span class="delimiter">{</span>
    // complete the GCAS
    <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="170349">prev</a> = /*READ*/<a href="#170347" title="scala.collection.concurrent.MainNode[K,V]">m</a>.<a href="MainNode.java.html#170194" title="scala.collection.concurrent.MainNode[K,V]">prev</a>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.INode[K,V]" id="170350">ctr</a> = <a href="#170348" title="scala.collection.concurrent.TrieMap[K,V]">ct</a>.<a href="#170309" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">readRoot</a><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

    <a href="#170349" title="scala.collection.concurrent.MainNode[K,V]">prev</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#170399" title="scala.collection.concurrent.MainNode[K,V]" id="170404" class="keyword">null</a> =&gt;
        <a href="#170407" title="(x: scala.collection.concurrent.MainNode[K,V])scala.collection.concurrent.MainNode[K,V]">m</a>
      <span class="keyword">case</span> <a href="#170399" title="scala.collection.concurrent.MainNode[K,V]" id="170405">fn</a>: FailedNode<span class="delimiter">[</span>_, _<span class="delimiter">]</span> =&gt; // try to commit to previous value
        <a href="#170407" title="(x: scala.collection.concurrent.MainNode[K,V])scala.collection.concurrent.MainNode[K,V]" class="keyword">if</a> <span class="delimiter">(</span><a href="#170174" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V])Boolean">CAS</a><span class="delimiter">(</span><a href="#170347" title="scala.collection.concurrent.MainNode[K,V]">m</a>, fn.<a href="MainNode.java.html#170194" title="scala.collection.concurrent.MainNode[_2316,_2317]">prev</a><span class="delimiter">)</span><span class="delimiter">)</span> fn.<a href="MainNode.java.html#170194" title="scala.collection.concurrent.MainNode[_2316,_2317]">prev</a>
        <span class="keyword">else</span> <a href="#170177" title="(m: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_Complete</a><span class="delimiter">(</span>/*READ*/<a href="INodeBase.java.html#170162" title="scala.collection.concurrent.MainNode[K,V]">mainnode</a>, <a href="#170348" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="#170399" title="scala.collection.concurrent.MainNode[K,V]" id="170406">vn</a>: MainNode<span class="delimiter">[</span>_, _<span class="delimiter">]</span> =&gt;
        // Assume that you've read the root from the generation G.
        // Assume that the snapshot algorithm is correct.
        // ==&gt; you can only reach nodes in generations &lt;= G.
        // ==&gt; `gen` is &lt;= G.
        // We know that `ctr.gen` is &gt;= G.
        // ==&gt; if `ctr.gen` = `gen` then they are both equal to G.
        // ==&gt; otherwise, we know that either `ctr.gen` &gt; G, `gen` &lt; G,
        //     or both
        <a href="#170407" title="(x: scala.collection.concurrent.MainNode[K,V])scala.collection.concurrent.MainNode[K,V]" class="keyword">if</a> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#170350" title="scala.collection.concurrent.INode[K,V]">ctr</a>.<a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span> <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#170348" title="scala.collection.concurrent.TrieMap[K,V]">ct</a>.<a href="#170322" title="=&gt; Boolean">nonReadOnly</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          // try to commit
          <span title="scala.collection.concurrent.MainNode[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#170347" title="scala.collection.concurrent.MainNode[K,V]">m</a>.<a href="MainNode.java.html#170196" title="(oldval: scala.collection.concurrent.MainNode[K,V], nval: scala.collection.concurrent.MainNode[K,V])Boolean">CAS_PREV</a><span class="delimiter">(</span><a href="#170349" title="scala.collection.concurrent.MainNode[K,V]">prev</a>, <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#170347" title="scala.collection.concurrent.MainNode[K,V]">m</a>
          <span class="keyword">else</span> <a href="#170177" title="(m: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_Complete</a><span class="delimiter">(</span><a href="#170347" title="scala.collection.concurrent.MainNode[K,V]">m</a>, <a href="#170348" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          // try to abort
          <a href="#170347" title="scala.collection.concurrent.MainNode[K,V]">m</a>.<a href="MainNode.java.html#170196" title="(oldval: scala.collection.concurrent.MainNode[K,V], nval: scala.collection.concurrent.MainNode[K,V])Boolean">CAS_PREV</a><span class="delimiter">(</span><a href="#170349" title="scala.collection.concurrent.MainNode[K,V]">prev</a>, <span title="scala.collection.concurrent.FailedNode[K,V]" class="keyword">new</span> <a href="#10401" title="scala.collection.concurrent.FailedNode[K,V]">FailedNode</a><span class="delimiter">(</span><a href="#170349" title="scala.collection.concurrent.MainNode[K,V]">prev</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#170177" title="(m: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_Complete</a><span class="delimiter">(</span>/*READ*/<a href="INodeBase.java.html#170162" title="scala.collection.concurrent.MainNode[K,V]">mainnode</a>, <a href="#170348" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  @inline <span class="keyword">final</span> <span class="keyword">def</span> <a title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean" id="170178">GCAS</a><span class="delimiter">(</span><a title="scala.collection.concurrent.MainNode[K,V]" id="170416">old</a>: <a href="MainNode.java.html#10413" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.MainNode[K,V]" id="170417">n</a>: <a href="MainNode.java.html#10413" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.TrieMap[K,V]" id="170418">ct</a>: <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../Boolean.scala.html#2218" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
    <a href="#170417" title="scala.collection.concurrent.MainNode[K,V]">n</a>.<a href="MainNode.java.html#170197" title="(nval: scala.collection.concurrent.MainNode[K,V])Unit">WRITE_PREV</a><span class="delimiter">(</span><a href="#170416" title="scala.collection.concurrent.MainNode[K,V]">old</a><span class="delimiter">)</span>
    <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#170174" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V])Boolean">CAS</a><span class="delimiter">(</span><a href="#170416" title="scala.collection.concurrent.MainNode[K,V]">old</a>, <a href="#170417" title="scala.collection.concurrent.MainNode[K,V]">n</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#170177" title="(m: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_Complete</a><span class="delimiter">(</span><a href="#170417" title="scala.collection.concurrent.MainNode[K,V]">n</a>, <a href="#170418" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
      /*READ*/<a href="#170417" title="scala.collection.concurrent.MainNode[K,V]">n</a>.<a href="MainNode.java.html#170194" title="scala.collection.concurrent.MainNode[K,V]">prev</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Boolean(false)" class="keyword">false</span>
  <span class="delimiter">}</span>

  @inline <span class="keyword">private</span> <span class="keyword">def</span> <a title="(cn: scala.collection.concurrent.MainNode[K,V])scala.collection.concurrent.INode[K,V]" id="170179">inode</a><span class="delimiter">(</span><a title="scala.collection.concurrent.MainNode[K,V]" id="170421">cn</a>: <a href="MainNode.java.html#10413" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.INode[K,V]" id="170422">nin</a> = <a href="#170172" title="(g: scala.collection.concurrent.Gen)scala.collection.concurrent.INode[K,V]" class="keyword">new</a> <a href="#10422" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">(</span><a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
    <a href="#170422" title="scala.collection.concurrent.INode[K,V]">nin</a>.<a href="#170173" title="(nval: scala.collection.concurrent.MainNode[K,V])Unit">WRITE</a><span class="delimiter">(</span><a href="#170421" title="scala.collection.concurrent.MainNode[K,V]">cn</a><span class="delimiter">)</span>
    <a href="#170422" title="scala.collection.concurrent.INode[K,V]">nin</a>
  <span class="delimiter">}</span>

  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.INode[K,V]" id="170180">copyToGen</a><span class="delimiter">(</span><a title="scala.collection.concurrent.Gen" id="170425">ngen</a>: <a href="Gen.java.html#10467" title="scala.collection.concurrent.Gen">Gen</a>, <a title="scala.collection.concurrent.TrieMap[K,V]" id="170426">ct</a>: <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.INode[K,V]" id="170427">nin</a> = <a href="#170172" title="(g: scala.collection.concurrent.Gen)scala.collection.concurrent.INode[K,V]" class="keyword">new</a> <a href="#10422" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">(</span><a href="#170425" title="scala.collection.concurrent.Gen">ngen</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="170428">main</a> = <a href="#170176" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_READ</a><span class="delimiter">(</span><a href="#170426" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
    <a href="#170427" title="scala.collection.concurrent.INode[K,V]">nin</a>.<a href="#170173" title="(nval: scala.collection.concurrent.MainNode[K,V])Unit">WRITE</a><span class="delimiter">(</span><a href="#170428" title="scala.collection.concurrent.MainNode[K,V]">main</a><span class="delimiter">)</span>
    <a href="#170427" title="scala.collection.concurrent.INode[K,V]">nin</a>
  <span class="delimiter">}</span>

  /** Inserts a key value pair, overwriting the old pair if the keys match.
   *
   *  @return        true if successful, false otherwise
   */
  @tailrec <span class="keyword">final</span> <span class="keyword">def</span> <a title="(k: K, v: V, hc: Int, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])Boolean" id="170181">rec_insert</a><span class="delimiter">(</span><a title="K" id="170431">k</a>: <a href="#10497" title="K">K</a>, <a title="V" id="170432">v</a>: <a href="#10498" title="V">V</a>, <a title="Int" id="170433">hc</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <a title="Int" id="170434">lev</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <a title="scala.collection.concurrent.INode[K,V]" id="170435">parent</a>: <a href="#10422" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.Gen" id="170436">startgen</a>: <a href="Gen.java.html#10467" title="scala.collection.concurrent.Gen">Gen</a>, <a title="scala.collection.concurrent.TrieMap[K,V]" id="170437">ct</a>: <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../Boolean.scala.html#2218" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="170438">m</a> = <a href="#170176" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_READ</a><span class="delimiter">(</span><a href="#170437" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span> // use -Yinline!

    <a href="#170438" title="scala.collection.concurrent.MainNode[K,V]">m</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#171208" title="Boolean" id="171209">cn</a>: CNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; // 1) a multiway node
        <span class="keyword">val</span> <a title="Int" id="170469">idx</a> = <span class="delimiter">(</span><a href="#170433" title="Int">hc</a> <a href="../../Int.scala.html#57884" title="(x: Int)Int">&gt;&gt;&gt;</a> <a href="#170434" title="Int">lev</a><span class="delimiter">)</span> <a href="../../Int.scala.html#57938" title="(x: Int)Int">&amp;</a> <span title="Int(31)" class="int">0x1f</span>
        <span class="keyword">val</span> <a title="Int" id="170470">flag</a> = <span title="Int(1)" class="int">1</span> <a href="../../Int.scala.html#57882" title="(x: Int)Int">&lt;&lt;</a> <a href="#170469" title="Int">idx</a>
        <span class="keyword">val</span> <a title="Int" id="170471">bmp</a> = cn.<a href="#170541" title="=&gt; Int">bitmap</a>
        <span class="keyword">val</span> <a title="Int" id="170472">mask</a> = <a href="#170470" title="Int">flag</a> <a href="../../Int.scala.html#57955" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span>
        <span class="keyword">val</span> <a title="Int" id="170473">pos</a> = <span title="Integer.type">Integer</span>.<span title="(x$1: Int)Int">bitCount</span><span class="delimiter">(</span><a href="#170471" title="Int">bmp</a> <a href="../../Int.scala.html#57938" title="(x: Int)Int">&amp;</a> <a href="#170472" title="Int">mask</a><span class="delimiter">)</span>
        <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#170471" title="Int">bmp</a> <a href="../../Int.scala.html#57938" title="(x: Int)Int">&amp;</a> <a href="#170470" title="Int">flag</a><span class="delimiter">)</span> <a href="../../Int.scala.html#57898" title="(x: Int)Boolean">!=</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          // 1a) insert below
          cn.<a href="../../Array.scala.html#57450" title="(i: Int)scala.collection.concurrent.BasicNode">array</a><a href="#170633" title="scala.collection.concurrent.INode[K,V]" class="delimiter">(</a><a href="#170473" title="Int">pos</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a href="#170632" title="Boolean" id="170633">in</a>: INode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
              <a href="#170635" title="(x: Boolean)Boolean" class="keyword">if</a> <span class="delimiter">(</span><a href="#170436" title="scala.collection.concurrent.Gen">startgen</a> <span title="(x$1: AnyRef)Boolean">eq</span> in.<a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span> in.<a href="#170181" title="(k: K, v: V, hc: Int, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])Boolean">rec_insert</a><span class="delimiter">(</span><a href="#170431" title="K">k</a>, <a href="#170432" title="V">v</a>, <a href="#170433" title="Int">hc</a>, <a href="#170434" title="Int">lev</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+</a> <span title="Int(5)" class="int">5</span>, <a href="#10422" title="scala.collection.concurrent.INode[K,V]" class="keyword">this</a>, <a href="#170436" title="scala.collection.concurrent.Gen">startgen</a>, <a href="#170437" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
              <span class="keyword">else</span> <span class="delimiter">{</span>
                <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#170178" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, cn.<a href="#170461" title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.CNode[K,V]">renewed</a><span class="delimiter">(</span><a href="#170436" title="scala.collection.concurrent.Gen">startgen</a>, <a href="#170437" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>, <a href="#170437" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#170181" title="(k: K, v: V, hc: Int, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])Boolean">rec_insert</a><span class="delimiter">(</span><a href="#170431" title="K">k</a>, <a href="#170432" title="V">v</a>, <a href="#170433" title="Int">hc</a>, <a href="#170434" title="Int">lev</a>, <a href="#170435" title="scala.collection.concurrent.INode[K,V]">parent</a>, <a href="#170436" title="scala.collection.concurrent.Gen">startgen</a>, <a href="#170437" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
                <span class="keyword">else</span> <span title="Boolean(false)" class="keyword">false</span>
              <span class="delimiter">}</span>
            <span class="keyword">case</span> <a href="#170632" title="Boolean" id="170634">sn</a>: SNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
              <a href="#170635" title="(x: Boolean)Boolean" class="keyword">if</a> <span class="delimiter">(</span>sn.<a href="#170578" title="=&gt; Int">hc</a> <a href="../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <a href="#170433" title="Int">hc</a> <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> sn.<a href="#170576" title="=&gt; K">k</a> <span title="(x$1: Any)Boolean">==</span> <a href="#170431" title="K">k</a><span class="delimiter">)</span> <a href="#170178" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, cn.<a href="#170458" title="(pos: Int, nn: scala.collection.concurrent.BasicNode, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]">updatedAt</a><span class="delimiter">(</span><a href="#170473" title="Int">pos</a>, <span title="scala.collection.concurrent.SNode[K,V]" class="keyword">new</span> <a href="#10410" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">(</span><a href="#170431" title="K">k</a>, <a href="#170432" title="V">v</a>, <a href="#170433" title="Int">hc</a><span class="delimiter">)</span>, <a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>, <a href="#170437" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
              <span class="keyword">else</span> <span class="delimiter">{</span>
                <span class="keyword">val</span> <a title="scala.collection.concurrent.CNode[K,V]" id="170585">rn</a> = <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">if</span> <span class="delimiter">(</span>cn.<a href="#170543" title="=&gt; scala.collection.concurrent.Gen">gen</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span> cn <span class="keyword">else</span> cn.<a href="#170461" title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.CNode[K,V]">renewed</a><span class="delimiter">(</span><a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a>, <a href="#170437" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
                <span class="keyword">val</span> <a title="scala.collection.concurrent.CNode[K,V]" id="170586">nn</a> = <a href="#170585" title="scala.collection.concurrent.CNode[K,V]">rn</a>.<a href="#170458" title="(pos: Int, nn: scala.collection.concurrent.BasicNode, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]">updatedAt</a><span class="delimiter">(</span><a href="#170473" title="Int">pos</a>, <a href="#170179" title="(cn: scala.collection.concurrent.MainNode[K,V])scala.collection.concurrent.INode[K,V]">inode</a><span class="delimiter">(</span><a href="#10429" title="scala.collection.concurrent.CNode.type">CNode</a>.<a href="#170588" title="(x: scala.collection.concurrent.SNode[K,V], xhc: Int, y: scala.collection.concurrent.SNode[K,V], yhc: Int, lev: Int, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.MainNode[K,V]">dual</a><span class="delimiter">(</span>sn, sn.<a href="#170578" title="=&gt; Int">hc</a>, <span title="scala.collection.concurrent.SNode[K,V]" class="keyword">new</span> <a href="#10410" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">(</span><a href="#170431" title="K">k</a>, <a href="#170432" title="V">v</a>, <a href="#170433" title="Int">hc</a><span class="delimiter">)</span>, <a href="#170433" title="Int">hc</a>, <a href="#170434" title="Int">lev</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+</a> <span title="Int(5)" class="int">5</span>, <a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
                <a href="#170178" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, <a href="#170586" title="scala.collection.concurrent.CNode[K,V]">nn</a>, <a href="#170437" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
              <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="scala.collection.concurrent.CNode[K,V]" id="170640">rn</a> = <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">if</span> <span class="delimiter">(</span>cn.<a href="#170543" title="=&gt; scala.collection.concurrent.Gen">gen</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span> cn <span class="keyword">else</span> cn.<a href="#170461" title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.CNode[K,V]">renewed</a><span class="delimiter">(</span><a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a>, <a href="#170437" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="scala.collection.concurrent.CNode[K,V]" id="170641">ncnode</a> = <a href="#170640" title="scala.collection.concurrent.CNode[K,V]">rn</a>.<a href="#170460" title="(pos: Int, flag: Int, nn: scala.collection.concurrent.BasicNode, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]">insertedAt</a><span class="delimiter">(</span><a href="#170473" title="Int">pos</a>, <a href="#170470" title="Int">flag</a>, <span title="scala.collection.concurrent.SNode[K,V]" class="keyword">new</span> <a href="#10410" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">(</span><a href="#170431" title="K">k</a>, <a href="#170432" title="V">v</a>, <a href="#170433" title="Int">hc</a><span class="delimiter">)</span>, <a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
          <a href="#170178" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, <a href="#170641" title="scala.collection.concurrent.CNode[K,V]">ncnode</a>, <a href="#170437" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="#171208" title="Boolean" id="171210">tn</a>: TNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
        <a href="#170185" title="(nd: scala.collection.concurrent.INode[K,V], ct: scala.collection.concurrent.TrieMap[K,V], lev: Int)Unit">clean</a><span class="delimiter">(</span><a href="#170435" title="scala.collection.concurrent.INode[K,V]">parent</a>, <a href="#170437" title="scala.collection.concurrent.TrieMap[K,V]">ct</a>, <a href="#170434" title="Int">lev</a> <a href="../../Int.scala.html#57955" title="(x: Int)Int">-</a> <span title="Int(5)" class="int">5</span><span class="delimiter">)</span>
        <span title="Boolean(false)" class="keyword">false</span>
      <span class="keyword">case</span> <a href="#171208" title="Boolean" id="171211">ln</a>: LNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; // 3) an l-node
        <span class="keyword">val</span> <a title="scala.collection.concurrent.LNode[K,V]" id="170711">nn</a> = ln.<a href="#170706" title="(k: K, v: V)scala.collection.concurrent.LNode[K,V]">inserted</a><span class="delimiter">(</span><a href="#170431" title="K">k</a>, <a href="#170432" title="V">v</a><span class="delimiter">)</span>
        <a href="#170178" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>ln, <a href="#170711" title="scala.collection.concurrent.LNode[K,V]">nn</a>, <a href="#170437" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** Inserts a new key value pair, given that a specific condition is met.
   *
   *  @param cond        null - don't care if the key was there; KEY_ABSENT - key wasn't there; KEY_PRESENT - key was there; other value `v` - key must be bound to `v`
   *  @return            null if unsuccessful, Option[V] otherwise (indicating previous value bound to the key)
   */
  @tailrec <span class="keyword">final</span> <span class="keyword">def</span> <a title="(k: K, v: V, hc: Int, cond: AnyRef, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])Option[V]" id="170182">rec_insertif</a><span class="delimiter">(</span><a title="K" id="171218">k</a>: <a href="#10497" title="K">K</a>, <a title="V" id="171219">v</a>: <a href="#10498" title="V">V</a>, <a title="Int" id="171220">hc</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <a title="AnyRef" id="171221">cond</a>: <span title="AnyRef">AnyRef</span>, <a title="Int" id="171222">lev</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <a title="scala.collection.concurrent.INode[K,V]" id="171223">parent</a>: <a href="#10422" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.Gen" id="171224">startgen</a>: <a href="Gen.java.html#10467" title="scala.collection.concurrent.Gen">Gen</a>, <a title="scala.collection.concurrent.TrieMap[K,V]" id="171225">ct</a>: <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../Option.scala.html#1510" title="Option[V]">Option</a><span class="delimiter">[</span>V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="171226">m</a> = <a href="#170176" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_READ</a><span class="delimiter">(</span><a href="#171225" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>  // use -Yinline!

    <a href="#171226" title="scala.collection.concurrent.MainNode[K,V]">m</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#171567" title="Option[V]" id="171568">cn</a>: CNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; // 1) a multiway node
        <span class="keyword">val</span> <a title="Int" id="171228">idx</a> = <span class="delimiter">(</span><a href="#171220" title="Int">hc</a> <a href="../../Int.scala.html#57884" title="(x: Int)Int">&gt;&gt;&gt;</a> <a href="#171222" title="Int">lev</a><span class="delimiter">)</span> <a href="../../Int.scala.html#57938" title="(x: Int)Int">&amp;</a> <span title="Int(31)" class="int">0x1f</span>
        <span class="keyword">val</span> <a title="Int" id="171229">flag</a> = <span title="Int(1)" class="int">1</span> <a href="../../Int.scala.html#57882" title="(x: Int)Int">&lt;&lt;</a> <a href="#171228" title="Int">idx</a>
        <span class="keyword">val</span> <a title="Int" id="171230">bmp</a> = cn.<a href="#170541" title="=&gt; Int">bitmap</a>
        <span class="keyword">val</span> <a title="Int" id="171231">mask</a> = <a href="#171229" title="Int">flag</a> <a href="../../Int.scala.html#57955" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span>
        <span class="keyword">val</span> <a title="Int" id="171232">pos</a> = <span title="Integer.type">Integer</span>.<span title="(x$1: Int)Int">bitCount</span><span class="delimiter">(</span><a href="#171230" title="Int">bmp</a> <a href="../../Int.scala.html#57938" title="(x: Int)Int">&amp;</a> <a href="#171231" title="Int">mask</a><span class="delimiter">)</span>
        <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#171230" title="Int">bmp</a> <a href="../../Int.scala.html#57938" title="(x: Int)Int">&amp;</a> <a href="#171229" title="Int">flag</a><span class="delimiter">)</span> <a href="../../Int.scala.html#57898" title="(x: Int)Boolean">!=</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          // 1a) insert below
          cn.<a href="../../Array.scala.html#57450" title="(i: Int)scala.collection.concurrent.BasicNode">array</a><a href="#171420" title="scala.collection.concurrent.INode[K,V]" class="delimiter">(</a><a href="#171232" title="Int">pos</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a href="#171419" title="Option[V]" id="171420">in</a>: INode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
              <a href="#171422" title="(x: Option[V])Option[V]" class="keyword">if</a> <span class="delimiter">(</span><a href="#171224" title="scala.collection.concurrent.Gen">startgen</a> <span title="(x$1: AnyRef)Boolean">eq</span> in.<a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span> in.<a href="#170182" title="(k: K, v: V, hc: Int, cond: AnyRef, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])Option[V]">rec_insertif</a><span class="delimiter">(</span><a href="#171218" title="K">k</a>, <a href="#171219" title="V">v</a>, <a href="#171220" title="Int">hc</a>, <a href="#171221" title="AnyRef">cond</a>, <a href="#171222" title="Int">lev</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+</a> <span title="Int(5)" class="int">5</span>, <a href="#10422" title="scala.collection.concurrent.INode[K,V]" class="keyword">this</a>, <a href="#171224" title="scala.collection.concurrent.Gen">startgen</a>, <a href="#171225" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
              <span class="keyword">else</span> <span class="delimiter">{</span>
                <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#170178" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, cn.<a href="#170461" title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.CNode[K,V]">renewed</a><span class="delimiter">(</span><a href="#171224" title="scala.collection.concurrent.Gen">startgen</a>, <a href="#171225" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>, <a href="#171225" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#170182" title="(k: K, v: V, hc: Int, cond: AnyRef, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])Option[V]">rec_insertif</a><span class="delimiter">(</span><a href="#171218" title="K">k</a>, <a href="#171219" title="V">v</a>, <a href="#171220" title="Int">hc</a>, <a href="#171221" title="AnyRef">cond</a>, <a href="#171222" title="Int">lev</a>, <a href="#171223" title="scala.collection.concurrent.INode[K,V]">parent</a>, <a href="#171224" title="scala.collection.concurrent.Gen">startgen</a>, <a href="#171225" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
                <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
              <span class="delimiter">}</span>
            <span class="keyword">case</span> <a href="#171419" title="Option[V]" id="171421">sn</a>: SNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; <a href="#171422" title="(x: Option[V])Option[V]">cond</a> <span class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <a href="#171391" title="Option[V]" id="171398" class="keyword">null</a> =&gt;
                <a href="#171402" title="(x: Option[V])Option[V]" class="keyword">if</a> <span class="delimiter">(</span>sn.<a href="#170578" title="=&gt; Int">hc</a> <a href="../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <a href="#171220" title="Int">hc</a> <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> sn.<a href="#170576" title="=&gt; K">k</a> <span title="(x$1: Any)Boolean">==</span> <a href="#171218" title="K">k</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                  <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#170178" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, cn.<a href="#170458" title="(pos: Int, nn: scala.collection.concurrent.BasicNode, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]">updatedAt</a><span class="delimiter">(</span><a href="#171232" title="Int">pos</a>, <span title="scala.collection.concurrent.SNode[K,V]" class="keyword">new</span> <a href="#10410" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">(</span><a href="#171218" title="K">k</a>, <a href="#171219" title="V">v</a>, <a href="#171220" title="Int">hc</a><span class="delimiter">)</span>, <a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>, <a href="#171225" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../Option.scala.html#64111" title="(x: V)Some[V]">Some</a><span class="delimiter">(</span>sn.<a href="#170577" title="=&gt; V">v</a><span class="delimiter">)</span> <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
                <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
                  <span class="keyword">val</span> <a title="scala.collection.concurrent.CNode[K,V]" id="171285">rn</a> = <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">if</span> <span class="delimiter">(</span>cn.<a href="#170543" title="=&gt; scala.collection.concurrent.Gen">gen</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span> cn <span class="keyword">else</span> cn.<a href="#170461" title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.CNode[K,V]">renewed</a><span class="delimiter">(</span><a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a>, <a href="#171225" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
                  <span class="keyword">val</span> <a title="scala.collection.concurrent.CNode[K,V]" id="171286">nn</a> = <a href="#171285" title="scala.collection.concurrent.CNode[K,V]">rn</a>.<a href="#170458" title="(pos: Int, nn: scala.collection.concurrent.BasicNode, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]">updatedAt</a><span class="delimiter">(</span><a href="#171232" title="Int">pos</a>, <a href="#170179" title="(cn: scala.collection.concurrent.MainNode[K,V])scala.collection.concurrent.INode[K,V]">inode</a><span class="delimiter">(</span><a href="#10429" title="scala.collection.concurrent.CNode.type">CNode</a>.<a href="#170588" title="(x: scala.collection.concurrent.SNode[K,V], xhc: Int, y: scala.collection.concurrent.SNode[K,V], yhc: Int, lev: Int, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.MainNode[K,V]">dual</a><span class="delimiter">(</span>sn, sn.<a href="#170578" title="=&gt; Int">hc</a>, <span title="scala.collection.concurrent.SNode[K,V]" class="keyword">new</span> <a href="#10410" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">(</span><a href="#171218" title="K">k</a>, <a href="#171219" title="V">v</a>, <a href="#171220" title="Int">hc</a><span class="delimiter">)</span>, <a href="#171220" title="Int">hc</a>, <a href="#171222" title="Int">lev</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+</a> <span title="Int(5)" class="int">5</span>, <a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
                  <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#170178" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, <a href="#171286" title="scala.collection.concurrent.CNode[K,V]">nn</a>, <a href="#171225" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../Option.scala.html#2498" title="None.type">None</a>
                  <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
                <span class="delimiter">}</span>
              <span class="keyword">case</span> <a href="#10423" title="scala.collection.concurrent.INode.type">INode</a>.<a href="#171316" title="Option[V]" id="171399">KEY_ABSENT</a> =&gt;
                <a href="#171402" title="(x: Option[V])Option[V]" class="keyword">if</a> <span class="delimiter">(</span>sn.<a href="#170578" title="=&gt; Int">hc</a> <a href="../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <a href="#171220" title="Int">hc</a> <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> sn.<a href="#170576" title="=&gt; K">k</a> <span title="(x$1: Any)Boolean">==</span> <a href="#171218" title="K">k</a><span class="delimiter">)</span> <a href="../../Option.scala.html#64111" title="(x: V)Some[V]">Some</a><span class="delimiter">(</span>sn.<a href="#170577" title="=&gt; V">v</a><span class="delimiter">)</span>
                <span class="keyword">else</span> <span class="delimiter">{</span>
                  <span class="keyword">val</span> <a title="scala.collection.concurrent.CNode[K,V]" id="171330">rn</a> = <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">if</span> <span class="delimiter">(</span>cn.<a href="#170543" title="=&gt; scala.collection.concurrent.Gen">gen</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span> cn <span class="keyword">else</span> cn.<a href="#170461" title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.CNode[K,V]">renewed</a><span class="delimiter">(</span><a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a>, <a href="#171225" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
                  <span class="keyword">val</span> <a title="scala.collection.concurrent.CNode[K,V]" id="171331">nn</a> = <a href="#171330" title="scala.collection.concurrent.CNode[K,V]">rn</a>.<a href="#170458" title="(pos: Int, nn: scala.collection.concurrent.BasicNode, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]">updatedAt</a><span class="delimiter">(</span><a href="#171232" title="Int">pos</a>, <a href="#170179" title="(cn: scala.collection.concurrent.MainNode[K,V])scala.collection.concurrent.INode[K,V]">inode</a><span class="delimiter">(</span><a href="#10429" title="scala.collection.concurrent.CNode.type">CNode</a>.<a href="#170588" title="(x: scala.collection.concurrent.SNode[K,V], xhc: Int, y: scala.collection.concurrent.SNode[K,V], yhc: Int, lev: Int, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.MainNode[K,V]">dual</a><span class="delimiter">(</span>sn, sn.<a href="#170578" title="=&gt; Int">hc</a>, <span title="scala.collection.concurrent.SNode[K,V]" class="keyword">new</span> <a href="#10410" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">(</span><a href="#171218" title="K">k</a>, <a href="#171219" title="V">v</a>, <a href="#171220" title="Int">hc</a><span class="delimiter">)</span>, <a href="#171220" title="Int">hc</a>, <a href="#171222" title="Int">lev</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+</a> <span title="Int(5)" class="int">5</span>, <a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
                  <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#170178" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, <a href="#171331" title="scala.collection.concurrent.CNode[K,V]">nn</a>, <a href="#171225" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../Option.scala.html#2498" title="None.type">None</a>
                  <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
                <span class="delimiter">}</span>
              <span class="keyword">case</span> <a href="#10423" title="scala.collection.concurrent.INode.type">INode</a>.<a href="#171314" title="Option[V]" id="171400">KEY_PRESENT</a> =&gt;
                <a href="#171402" title="(x: Option[V])Option[V]" class="keyword">if</a> <span class="delimiter">(</span>sn.<a href="#170578" title="=&gt; Int">hc</a> <a href="../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <a href="#171220" title="Int">hc</a> <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> sn.<a href="#170576" title="=&gt; K">k</a> <span title="(x$1: Any)Boolean">==</span> <a href="#171218" title="K">k</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                  <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#170178" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, cn.<a href="#170458" title="(pos: Int, nn: scala.collection.concurrent.BasicNode, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]">updatedAt</a><span class="delimiter">(</span><a href="#171232" title="Int">pos</a>, <span title="scala.collection.concurrent.SNode[K,V]" class="keyword">new</span> <a href="#10410" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">(</span><a href="#171218" title="K">k</a>, <a href="#171219" title="V">v</a>, <a href="#171220" title="Int">hc</a><span class="delimiter">)</span>, <a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>, <a href="#171225" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../Option.scala.html#64111" title="(x: V)Some[V]">Some</a><span class="delimiter">(</span>sn.<a href="#170577" title="=&gt; V">v</a><span class="delimiter">)</span> <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
                <span class="delimiter">}</span> <span class="keyword">else</span> <a href="../../Option.scala.html#2498" title="None.type">None</a>
              <span class="keyword">case</span> <a href="#171391" title="Option[V]" id="171401">otherv</a>: V =&gt;
                <a href="#171402" title="(x: Option[V])Option[V]" class="keyword">if</a> <span class="delimiter">(</span>sn.<a href="#170578" title="=&gt; Int">hc</a> <a href="../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <a href="#171220" title="Int">hc</a> <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> sn.<a href="#170576" title="=&gt; K">k</a> <span title="(x$1: Any)Boolean">==</span> <a href="#171218" title="K">k</a> <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> sn.<a href="#170577" title="=&gt; V">v</a> <span title="(x$1: Any)Boolean">==</span> otherv<span class="delimiter">)</span> <span class="delimiter">{</span>
                  <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#170178" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, cn.<a href="#170458" title="(pos: Int, nn: scala.collection.concurrent.BasicNode, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]">updatedAt</a><span class="delimiter">(</span><a href="#171232" title="Int">pos</a>, <span title="scala.collection.concurrent.SNode[K,V]" class="keyword">new</span> <a href="#10410" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">(</span><a href="#171218" title="K">k</a>, <a href="#171219" title="V">v</a>, <a href="#171220" title="Int">hc</a><span class="delimiter">)</span>, <a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>, <a href="#171225" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../Option.scala.html#64111" title="(x: V)Some[V]">Some</a><span class="delimiter">(</span>sn.<a href="#170577" title="=&gt; V">v</a><span class="delimiter">)</span> <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
                <span class="delimiter">}</span> <span class="keyword">else</span> <a href="../../Option.scala.html#2498" title="None.type">None</a>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#171221" title="AnyRef">cond</a> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a href="#171440" title="Option[V]" id="171447" class="keyword">null</a> | <a href="#10423" title="scala.collection.concurrent.INode.type">INode</a>.<a href="#171316" title="Boolean" id="171448">KEY_ABSENT</a> =&gt;
            <span class="keyword">val</span> <a title="scala.collection.concurrent.CNode[K,V]" id="171427">rn</a> = <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">if</span> <span class="delimiter">(</span>cn.<a href="#170543" title="=&gt; scala.collection.concurrent.Gen">gen</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span> cn <span class="keyword">else</span> cn.<a href="#170461" title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.CNode[K,V]">renewed</a><span class="delimiter">(</span><a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a>, <a href="#171225" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="scala.collection.concurrent.CNode[K,V]" id="171428">ncnode</a> = <a href="#171427" title="scala.collection.concurrent.CNode[K,V]">rn</a>.<a href="#170460" title="(pos: Int, flag: Int, nn: scala.collection.concurrent.BasicNode, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]">insertedAt</a><span class="delimiter">(</span><a href="#171232" title="Int">pos</a>, <a href="#171229" title="Int">flag</a>, <span title="scala.collection.concurrent.SNode[K,V]" class="keyword">new</span> <a href="#10410" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">(</span><a href="#171218" title="K">k</a>, <a href="#171219" title="V">v</a>, <a href="#171220" title="Int">hc</a><span class="delimiter">)</span>, <a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
            <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#170178" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, <a href="#171428" title="scala.collection.concurrent.CNode[K,V]">ncnode</a>, <a href="#171225" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../Option.scala.html#2498" title="None.type">None</a> <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
          <span class="keyword">case</span> <a href="#10423" title="scala.collection.concurrent.INode.type">INode</a>.<a href="#171314" title="Option[V]" id="171449">KEY_PRESENT</a> =&gt; <a href="#171451" title="(x: Option[V])Option[V]">None</a>
          <span class="keyword">case</span> <a href="#171440" title="Option[V]" id="171450">otherv</a>: V =&gt; <a href="#171451" title="(x: Option[V])Option[V]">None</a>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="#171567" title="Option[V]" id="171569">sn</a>: TNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
        <a href="#170185" title="(nd: scala.collection.concurrent.INode[K,V], ct: scala.collection.concurrent.TrieMap[K,V], lev: Int)Unit">clean</a><span class="delimiter">(</span><a href="#171223" title="scala.collection.concurrent.INode[K,V]">parent</a>, <a href="#171225" title="scala.collection.concurrent.TrieMap[K,V]">ct</a>, <a href="#171222" title="Int">lev</a> <a href="../../Int.scala.html#57955" title="(x: Int)Int">-</a> <span title="Int(5)" class="int">5</span><span class="delimiter">)</span>
        <span title="Null(null)" class="keyword">null</span>
      <span class="keyword">case</span> <a href="#171567" title="Option[V]" id="171570">ln</a>: LNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; // 3) an l-node
        @inline <span class="keyword">def</span> <a title="()Boolean" id="171477">insertln</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="scala.collection.concurrent.LNode[K,V]" id="171478">nn</a> = ln.<a href="#170706" title="(k: K, v: V)scala.collection.concurrent.LNode[K,V]">inserted</a><span class="delimiter">(</span><a href="#171218" title="K">k</a>, <a href="#171219" title="V">v</a><span class="delimiter">)</span>
          <a href="#170178" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>ln, <a href="#171478" title="scala.collection.concurrent.LNode[K,V]">nn</a>, <a href="#171225" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#171221" title="AnyRef">cond</a> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a href="#171539" title="Option[V]" id="171546" class="keyword">null</a> =&gt;
            <span class="keyword">val</span> <a title="Option[V]" id="171481">optv</a> = ln.<a href="#170708" title="(k: K)Option[V]">get</a><span class="delimiter">(</span><a href="#171218" title="K">k</a><span class="delimiter">)</span>
            <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#171477" title="()Boolean">insertln</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#171481" title="Option[V]">optv</a> <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
          <span class="keyword">case</span> <a href="#10423" title="scala.collection.concurrent.INode.type">INode</a>.<a href="#171316" title="Option[V]" id="171547">KEY_ABSENT</a> =&gt;
            ln.<a href="#170708" title="(k: K)Option[V]">get</a><a href="#171550" title="(x: Option[V])Option[V]" class="delimiter">(</a><a href="#171218" title="K">k</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <a href="../../Option.scala.html#2498" title="Option[V]" id="171496">None</a> =&gt; <a href="#171497" title="(x: Option[V])Option[V]" class="keyword">if</a> <span class="delimiter">(</span><a href="#171477" title="()Boolean">insertln</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../Option.scala.html#2498" title="None.type">None</a> <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
              <span class="keyword">case</span> optv =&gt; <a href="#171497" title="(x: Option[V])Option[V]">optv</a>
            <span class="delimiter">}</span>
          <span class="keyword">case</span> <a href="#10423" title="scala.collection.concurrent.INode.type">INode</a>.<a href="#171314" title="Option[V]" id="171548">KEY_PRESENT</a> =&gt;
            ln.<a href="#170708" title="(k: K)Option[V]">get</a><a href="#171550" title="(x: Option[V])Option[V]" class="delimiter">(</a><a href="#171218" title="K">k</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> Some<a href="#171511" title="Option[V]" id="171512" class="delimiter">(</a>v0<span class="delimiter">)</span> =&gt; <a href="#171515" title="(x: Option[V])Option[V]" class="keyword">if</a> <span class="delimiter">(</span><a href="#171477" title="()Boolean">insertln</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../Option.scala.html#64111" title="(x: V)Some[V]">Some</a><span class="delimiter">(</span>v0<span class="delimiter">)</span> <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
              <span class="keyword">case</span> <a href="../../Option.scala.html#2498" title="Option[V]" id="171514">None</a> =&gt; <a href="#171515" title="(x: Option[V])Option[V]">None</a>
            <span class="delimiter">}</span>
          <span class="keyword">case</span> <a href="#171539" title="Option[V]" id="171549">otherv</a>: V =&gt;
            ln.<a href="#170708" title="(k: K)Option[V]">get</a><a href="#171550" title="(x: Option[V])Option[V]" class="delimiter">(</a><a href="#171218" title="K">k</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> Some<a href="#171531" title="Option[V]" id="171532" class="delimiter">(</a>v0<span class="delimiter">)</span> <span class="keyword">if</span> v0 <span title="(x$1: Any)Boolean">==</span> otherv =&gt; <a href="#171533" title="(x: Option[V])Option[V]" class="keyword">if</a> <span class="delimiter">(</span><a href="#171477" title="()Boolean">insertln</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../Option.scala.html#64111" title="(x: Object with V)Some[Object with V]">Some</a><span class="delimiter">(</span>otherv<span class="delimiter">)</span> <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
              <span class="keyword">case</span> _ =&gt; <a href="#171533" title="(x: Option[V])Option[V]">None</a>
            <span class="delimiter">}</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** Looks up the value associated with the key.
   *
   *  @return          null if no value has been found, RESTART if the operation wasn't successful, or any other value otherwise
   */
  @tailrec <span class="keyword">final</span> <span class="keyword">def</span> <a title="(k: K, hc: Int, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])AnyRef" id="170183">rec_lookup</a><span class="delimiter">(</span><a title="K" id="171577">k</a>: <a href="#10497" title="K">K</a>, <a title="Int" id="171578">hc</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <a title="Int" id="171579">lev</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <a title="scala.collection.concurrent.INode[K,V]" id="171580">parent</a>: <a href="#10422" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.Gen" id="171581">startgen</a>: <a href="Gen.java.html#10467" title="scala.collection.concurrent.Gen">Gen</a>, <a title="scala.collection.concurrent.TrieMap[K,V]" id="171582">ct</a>: <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="AnyRef">AnyRef</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="171583">m</a> = <a href="#170176" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_READ</a><span class="delimiter">(</span><a href="#171582" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span> // use -Yinline!

    <a href="#171583" title="scala.collection.concurrent.MainNode[K,V]">m</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#171668" title="AnyRef" id="171669">cn</a>: CNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; // 1) a multinode
        <span class="keyword">val</span> <a title="Int" id="171585">idx</a> = <span class="delimiter">(</span><a href="#171578" title="Int">hc</a> <a href="../../Int.scala.html#57884" title="(x: Int)Int">&gt;&gt;&gt;</a> <a href="#171579" title="Int">lev</a><span class="delimiter">)</span> <a href="../../Int.scala.html#57938" title="(x: Int)Int">&amp;</a> <span title="Int(31)" class="int">0x1f</span>
        <span class="keyword">val</span> <a title="Int" id="171586">flag</a> = <span title="Int(1)" class="int">1</span> <a href="../../Int.scala.html#57882" title="(x: Int)Int">&lt;&lt;</a> <a href="#171585" title="Int">idx</a>
        <span class="keyword">val</span> <a title="Int" id="171587">bmp</a> = cn.<a href="#170541" title="=&gt; Int">bitmap</a>
        <span title="AnyRef" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#171587" title="Int">bmp</a> <a href="../../Int.scala.html#57938" title="(x: Int)Int">&amp;</a> <a href="#171586" title="Int">flag</a><span class="delimiter">)</span> <a href="../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span title="Null(null)" class="keyword">null</span> // 1a) bitmap shows no binding
        <span class="keyword">else</span> <span class="delimiter">{</span> // 1b) bitmap contains a value - descend
          <span class="keyword">val</span> <a title="Int" id="171609">pos</a> = <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#171587" title="Int">bmp</a> <a href="../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <span title="Int(-1)" class="int">0xffffffff</span><span class="delimiter">)</span> <a href="#171585" title="Int">idx</a> <span class="keyword">else</span> <span title="Integer.type">Integer</span>.<span title="(x$1: Int)Int">bitCount</span><span class="delimiter">(</span><a href="#171587" title="Int">bmp</a> <a href="../../Int.scala.html#57938" title="(x: Int)Int">&amp;</a> <span class="delimiter">(</span><a href="#171586" title="Int">flag</a> <a href="../../Int.scala.html#57955" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="scala.collection.concurrent.BasicNode" id="171610">sub</a> = cn.<a href="../../Array.scala.html#57450" title="(i: Int)scala.collection.concurrent.BasicNode">array</a><span class="delimiter">(</span><a href="#171609" title="Int">pos</a><span class="delimiter">)</span>
          <a href="#171610" title="scala.collection.concurrent.BasicNode">sub</a> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a href="#171639" title="AnyRef" id="171640">in</a>: INode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
              <a href="#171642" title="(x: AnyRef)AnyRef" class="keyword">if</a> <span class="delimiter">(</span><a href="#171582" title="scala.collection.concurrent.TrieMap[K,V]">ct</a>.<a href="#170321" title="=&gt; Boolean">isReadOnly</a> <a href="../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <span class="delimiter">(</span><a href="#171581" title="scala.collection.concurrent.Gen">startgen</a> <span title="(x$1: AnyRef)Boolean">eq</span> in.<a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span><span class="delimiter">)</span> in.<a href="#170183" title="(k: K, hc: Int, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])AnyRef">rec_lookup</a><span class="delimiter">(</span><a href="#171577" title="K">k</a>, <a href="#171578" title="Int">hc</a>, <a href="#171579" title="Int">lev</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+</a> <span title="Int(5)" class="int">5</span>, <a href="#10422" title="scala.collection.concurrent.INode[K,V]" class="keyword">this</a>, <a href="#171581" title="scala.collection.concurrent.Gen">startgen</a>, <a href="#171582" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
              <span class="keyword">else</span> <span class="delimiter">{</span>
                <span title="AnyRef" class="keyword">if</span> <span class="delimiter">(</span><a href="#170178" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, cn.<a href="#170461" title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.CNode[K,V]">renewed</a><span class="delimiter">(</span><a href="#171581" title="scala.collection.concurrent.Gen">startgen</a>, <a href="#171582" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>, <a href="#171582" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#170183" title="(k: K, hc: Int, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])AnyRef">rec_lookup</a><span class="delimiter">(</span><a href="#171577" title="K">k</a>, <a href="#171578" title="Int">hc</a>, <a href="#171579" title="Int">lev</a>, <a href="#171580" title="scala.collection.concurrent.INode[K,V]">parent</a>, <a href="#171581" title="scala.collection.concurrent.Gen">startgen</a>, <a href="#171582" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
                <span class="keyword">else</span> <span title="Nothing" class="keyword">return</span> <a href="INodeBase.java.html#170207" title="Object">RESTART</a> // used to be throw RestartException
              <span class="delimiter">}</span>
            <span class="keyword">case</span> <a href="#171639" title="AnyRef" id="171641">sn</a>: SNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; // 2) singleton node
              <a href="#171642" title="(x: AnyRef)AnyRef" class="keyword">if</a> <span class="delimiter">(</span>sn.<a href="#170578" title="=&gt; Int">hc</a> <a href="../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <a href="#171578" title="Int">hc</a> <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> sn.<a href="#170576" title="=&gt; K">k</a> <span title="(x$1: Any)Boolean">==</span> <a href="#171577" title="K">k</a><span class="delimiter">)</span> sn.<a href="#170577" title="=&gt; V">v</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span>
              <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="#171668" title="AnyRef" id="171670">tn</a>: TNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; // 3) non-live node
        <span class="keyword">def</span> <a title="(tn: scala.collection.concurrent.TNode[K,V])Object" id="171648">cleanReadOnly</a><span class="delimiter">(</span><a title="scala.collection.concurrent.TNode[K,V]" id="171649">tn</a>: <a href="#10446" title="scala.collection.concurrent.TNode[K,V]">TNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span> = <span title="Object" class="keyword">if</span> <span class="delimiter">(</span><a href="#171582" title="scala.collection.concurrent.TrieMap[K,V]">ct</a>.<a href="#170322" title="=&gt; Boolean">nonReadOnly</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#170185" title="(nd: scala.collection.concurrent.INode[K,V], ct: scala.collection.concurrent.TrieMap[K,V], lev: Int)Unit">clean</a><span class="delimiter">(</span><a href="#171580" title="scala.collection.concurrent.INode[K,V]">parent</a>, <a href="#171582" title="scala.collection.concurrent.TrieMap[K,V]">ct</a>, <a href="#171579" title="Int">lev</a> <a href="../../Int.scala.html#57955" title="(x: Int)Int">-</a> <span title="Int(5)" class="int">5</span><span class="delimiter">)</span>
          <a href="INodeBase.java.html#170207" title="Object">RESTART</a> // used to be throw RestartException
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span title="AnyRef" class="keyword">if</span> <span class="delimiter">(</span><a href="#171649" title="scala.collection.concurrent.TNode[K,V]">tn</a>.<a href="#172078" title="=&gt; Int">hc</a> <a href="../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <a href="#171578" title="Int">hc</a> <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#171649" title="scala.collection.concurrent.TNode[K,V]">tn</a>.<a href="#172076" title="=&gt; K">k</a> <span title="(x$1: Any)Boolean">==</span> <a href="#171577" title="K">k</a><span class="delimiter">)</span> <a href="#171649" title="scala.collection.concurrent.TNode[K,V]">tn</a>.<a href="#172077" title="=&gt; V">v</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span>
          <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
        <span class="delimiter">}</span>
        <a href="#171648" title="(tn: scala.collection.concurrent.TNode[K,V])Object">cleanReadOnly</a><span class="delimiter">(</span>tn<span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="#171668" title="AnyRef" id="171671">ln</a>: LNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; // 5) an l-node
        ln.<a href="#170708" title="(k: K)Option[V]">get</a><span class="delimiter">(</span><a href="#171577" title="K">k</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Option[AnyRef]" class="delimiter">[</span><a href="../../Option.scala.html#1510" title="Option[AnyRef]">Option</a><span class="delimiter">[</span>AnyRef<span class="delimiter">]</span><span class="delimiter">]</span>.<a href="#171672" title="(x: AnyRef)AnyRef">orNull</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** Removes the key associated with the given value.
   *
   *  @param v         if null, will remove the key irregardless of the value; otherwise removes only if binding contains that exact key and value
   *  @return          null if not successful, an Option[V] indicating the previous value otherwise
   */
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(k: K, v: V, hc: Int, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])Option[V]" id="170184">rec_remove</a><span class="delimiter">(</span><a title="K" id="171678">k</a>: <a href="#10497" title="K">K</a>, <a title="V" id="171679">v</a>: <a href="#10498" title="V">V</a>, <a title="Int" id="171680">hc</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <a title="Int" id="171681">lev</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <a title="scala.collection.concurrent.INode[K,V]" id="171682">parent</a>: <a href="#10422" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.Gen" id="171683">startgen</a>: <a href="Gen.java.html#10467" title="scala.collection.concurrent.Gen">Gen</a>, <a title="scala.collection.concurrent.TrieMap[K,V]" id="171684">ct</a>: <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../Option.scala.html#1510" title="Option[V]">Option</a><span class="delimiter">[</span>V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="171685">m</a> = <a href="#170176" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_READ</a><span class="delimiter">(</span><a href="#171684" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span> // use -Yinline!

    <a href="#171685" title="scala.collection.concurrent.MainNode[K,V]">m</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#171903" title="Option[V]" id="171904">cn</a>: CNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
        <span class="keyword">val</span> <a title="Int" id="171687">idx</a> = <span class="delimiter">(</span><a href="#171680" title="Int">hc</a> <a href="../../Int.scala.html#57884" title="(x: Int)Int">&gt;&gt;&gt;</a> <a href="#171681" title="Int">lev</a><span class="delimiter">)</span> <a href="../../Int.scala.html#57938" title="(x: Int)Int">&amp;</a> <span title="Int(31)" class="int">0x1f</span>
        <span class="keyword">val</span> <a title="Int" id="171688">bmp</a> = cn.<a href="#170541" title="=&gt; Int">bitmap</a>
        <span class="keyword">val</span> <a title="Int" id="171689">flag</a> = <span title="Int(1)" class="int">1</span> <a href="../../Int.scala.html#57882" title="(x: Int)Int">&lt;&lt;</a> <a href="#171687" title="Int">idx</a>
        <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#171688" title="Int">bmp</a> <a href="../../Int.scala.html#57938" title="(x: Int)Int">&amp;</a> <a href="#171689" title="Int">flag</a><span class="delimiter">)</span> <a href="../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="../../Option.scala.html#2498" title="None.type">None</a>
        <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Int" id="171711">pos</a> = <span title="Integer.type">Integer</span>.<span title="(x$1: Int)Int">bitCount</span><span class="delimiter">(</span><a href="#171688" title="Int">bmp</a> <a href="../../Int.scala.html#57938" title="(x: Int)Int">&amp;</a> <span class="delimiter">(</span><a href="#171689" title="Int">flag</a> <a href="../../Int.scala.html#57955" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="scala.collection.concurrent.BasicNode" id="171712">sub</a> = cn.<a href="../../Array.scala.html#57450" title="(i: Int)scala.collection.concurrent.BasicNode">array</a><span class="delimiter">(</span><a href="#171711" title="Int">pos</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Option[V]" id="171713">res</a> = <a href="#171712" title="scala.collection.concurrent.BasicNode">sub</a> <span class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a href="#171777" title="Option[V]" id="171778">in</a>: INode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
              <a href="#171780" title="(x: Option[V])Option[V]" class="keyword">if</a> <span class="delimiter">(</span><a href="#171683" title="scala.collection.concurrent.Gen">startgen</a> <span title="(x$1: AnyRef)Boolean">eq</span> in.<a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span> in.<a href="#170184" title="(k: K, v: V, hc: Int, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])Option[V]">rec_remove</a><span class="delimiter">(</span><a href="#171678" title="K">k</a>, <a href="#171679" title="V">v</a>, <a href="#171680" title="Int">hc</a>, <a href="#171681" title="Int">lev</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+</a> <span title="Int(5)" class="int">5</span>, <a href="#10422" title="scala.collection.concurrent.INode[K,V]" class="keyword">this</a>, <a href="#171683" title="scala.collection.concurrent.Gen">startgen</a>, <a href="#171684" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
              <span class="keyword">else</span> <span class="delimiter">{</span>
                <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#170178" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, cn.<a href="#170461" title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.CNode[K,V]">renewed</a><span class="delimiter">(</span><a href="#171683" title="scala.collection.concurrent.Gen">startgen</a>, <a href="#171684" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>, <a href="#171684" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#170184" title="(k: K, v: V, hc: Int, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])Option[V]">rec_remove</a><span class="delimiter">(</span><a href="#171678" title="K">k</a>, <a href="#171679" title="V">v</a>, <a href="#171680" title="Int">hc</a>, <a href="#171681" title="Int">lev</a>, <a href="#171682" title="scala.collection.concurrent.INode[K,V]">parent</a>, <a href="#171683" title="scala.collection.concurrent.Gen">startgen</a>, <a href="#171684" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
                <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
              <span class="delimiter">}</span>
            <span class="keyword">case</span> <a href="#171777" title="Option[V]" id="171779">sn</a>: SNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
              <a href="#171780" title="(x: Option[V])Option[V]" class="keyword">if</a> <span class="delimiter">(</span>sn.<a href="#170578" title="=&gt; Int">hc</a> <a href="../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <a href="#171680" title="Int">hc</a> <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> sn.<a href="#170576" title="=&gt; K">k</a> <span title="(x$1: Any)Boolean">==</span> <a href="#171678" title="K">k</a> <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <span class="delimiter">(</span><a href="#171679" title="V">v</a> <span title="(x$1: Any)Boolean">==</span> <span title="Null(null)" class="keyword">null</span> <a href="../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> sn.<a href="#170577" title="=&gt; V">v</a> <span title="(x$1: Any)Boolean">==</span> <a href="#171679" title="V">v</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="171734">ncn</a> = cn.<a href="#170459" title="(pos: Int, flag: Int, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]">removedAt</a><span class="delimiter">(</span><a href="#171711" title="Int">pos</a>, <a href="#171689" title="Int">flag</a>, <a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>.<a href="#170463" title="(lev: Int)scala.collection.concurrent.MainNode[K,V]">toContracted</a><span class="delimiter">(</span><a href="#171681" title="Int">lev</a><span class="delimiter">)</span>
                <span title="Some[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#170178" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, <a href="#171734" title="scala.collection.concurrent.MainNode[K,V]">ncn</a>, <a href="#171684" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../Option.scala.html#64111" title="(x: V)Some[V]">Some</a><span class="delimiter">(</span>sn.<a href="#170577" title="=&gt; V">v</a><span class="delimiter">)</span> <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
              <span class="delimiter">}</span> <span class="keyword">else</span> <a href="../../Option.scala.html#2498" title="None.type">None</a>
          <span class="delimiter">}</span>

          <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#171713" title="Option[V]">res</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../Option.scala.html#2498" title="None.type">None</a> <a href="../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <span class="delimiter">(</span><a href="#171713" title="Option[V]">res</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#171713" title="Option[V]">res</a>
          <span class="keyword">else</span> <span class="delimiter">{</span>
            @tailrec <span class="keyword">def</span> <a title="(nonlive: AnyRef)Unit" id="171789">cleanParent</a><span class="delimiter">(</span><a title="AnyRef" id="171790">nonlive</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="171791">pm</a> = <a href="#171682" title="scala.collection.concurrent.INode[K,V]">parent</a>.<a href="#170176" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_READ</a><span class="delimiter">(</span><a href="#171684" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
              <a href="#171791" title="scala.collection.concurrent.MainNode[K,V]">pm</a> <span class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <a href="#171863" title="Unit" id="171864">cn</a>: CNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
                  <span class="keyword">val</span> <a title="Int" id="171793">idx</a> = <span class="delimiter">(</span><a href="#171680" title="Int">hc</a> <a href="../../Int.scala.html#57884" title="(x: Int)Int">&gt;&gt;&gt;</a> <span class="delimiter">(</span><a href="#171681" title="Int">lev</a> <a href="../../Int.scala.html#57955" title="(x: Int)Int">-</a> <span title="Int(5)" class="int">5</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../Int.scala.html#57938" title="(x: Int)Int">&amp;</a> <span title="Int(31)" class="int">0x1f</span>
                  <span class="keyword">val</span> <a title="Int" id="171794">bmp</a> = cn.<a href="#170541" title="=&gt; Int">bitmap</a>
                  <span class="keyword">val</span> <a title="Int" id="171795">flag</a> = <span title="Int(1)" class="int">1</span> <a href="../../Int.scala.html#57882" title="(x: Int)Int">&lt;&lt;</a> <a href="#171793" title="Int">idx</a>
                  <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#171794" title="Int">bmp</a> <a href="../../Int.scala.html#57938" title="(x: Int)Int">&amp;</a> <a href="#171795" title="Int">flag</a><span class="delimiter">)</span> <a href="../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span> // somebody already removed this i-node, we're done
                  <span class="keyword">else</span> <span class="delimiter">{</span>
                    <span class="keyword">val</span> <a title="Int" id="171821">pos</a> = <span title="Integer.type">Integer</span>.<span title="(x$1: Int)Int">bitCount</span><span class="delimiter">(</span><a href="#171794" title="Int">bmp</a> <a href="../../Int.scala.html#57938" title="(x: Int)Int">&amp;</a> <span class="delimiter">(</span><a href="#171795" title="Int">flag</a> <a href="../../Int.scala.html#57955" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>
                    <span class="keyword">val</span> <a title="scala.collection.concurrent.BasicNode" id="171822">sub</a> = cn.<a href="../../Array.scala.html#57450" title="(i: Int)scala.collection.concurrent.BasicNode">array</a><span class="delimiter">(</span><a href="#171821" title="Int">pos</a><span class="delimiter">)</span>
                    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#171822" title="scala.collection.concurrent.BasicNode">sub</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#10422" title="scala.collection.concurrent.INode[K,V]" class="keyword">this</a><span class="delimiter">)</span> <a href="#171790" title="AnyRef">nonlive</a> <span class="keyword">match</span> <span class="delimiter">{</span>
                      <span class="keyword">case</span> <a href="#171856" title="Unit" id="171857">tn</a>: TNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
                        <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="171832">ncn</a> = cn.<a href="#170458" title="(pos: Int, nn: scala.collection.concurrent.BasicNode, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]">updatedAt</a><span class="delimiter">(</span><a href="#171821" title="Int">pos</a>, tn.<a href="#170688" title="=&gt; scala.collection.concurrent.SNode[K,V]">copyUntombed</a>, <a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>.<a href="#170463" title="(lev: Int)scala.collection.concurrent.MainNode[K,V]">toContracted</a><span class="delimiter">(</span><a href="#171681" title="Int">lev</a> <a href="../../Int.scala.html#57955" title="(x: Int)Int">-</a> <span title="Int(5)" class="int">5</span><span class="delimiter">)</span>
                        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#171682" title="scala.collection.concurrent.INode[K,V]">parent</a>.<a href="#170178" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>cn, <a href="#171832" title="scala.collection.concurrent.MainNode[K,V]">ncn</a>, <a href="#171684" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span>
                          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#171684" title="scala.collection.concurrent.TrieMap[K,V]">ct</a>.<a href="#170309" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">readRoot</a><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#171683" title="scala.collection.concurrent.Gen">startgen</a><span class="delimiter">)</span> <a href="#171789" title="(nonlive: AnyRef)Unit">cleanParent</a><span class="delimiter">(</span><a href="#171790" title="AnyRef">nonlive</a><span class="delimiter">)</span>
                    <span class="delimiter">}</span>
                  <span class="delimiter">}</span>
                <span class="keyword">case</span> _ =&gt; // parent is no longer a cnode, we're done
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>

            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#171682" title="scala.collection.concurrent.INode[K,V]">parent</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span> // never tomb at root
              <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="171870">n</a> = <a href="#170176" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_READ</a><span class="delimiter">(</span><a href="#171684" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#171870" title="scala.collection.concurrent.MainNode[K,V]">n</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="#10446" title="scala.collection.concurrent.TNode[_, _]">TNode</a><span class="delimiter">[</span>_, _<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>
                <a href="#171789" title="(nonlive: AnyRef)Unit">cleanParent</a><span class="delimiter">(</span><a href="#171870" title="scala.collection.concurrent.MainNode[K,V]">n</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>

            <a href="#171713" title="Option[V]">res</a>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <a href="#171903" title="Option[V]" id="171905">tn</a>: TNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
        <a href="#170185" title="(nd: scala.collection.concurrent.INode[K,V], ct: scala.collection.concurrent.TrieMap[K,V], lev: Int)Unit">clean</a><span class="delimiter">(</span><a href="#171682" title="scala.collection.concurrent.INode[K,V]">parent</a>, <a href="#171684" title="scala.collection.concurrent.TrieMap[K,V]">ct</a>, <a href="#171681" title="Int">lev</a> <a href="../../Int.scala.html#57955" title="(x: Int)Int">-</a> <span title="Int(5)" class="int">5</span><span class="delimiter">)</span>
        <span title="Null(null)" class="keyword">null</span>
      <span class="keyword">case</span> <a href="#171903" title="Option[V]" id="171906">ln</a>: LNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
        <a href="#171907" title="(x: Option[V])Option[V]" class="keyword">if</a> <span class="delimiter">(</span><a href="#171679" title="V">v</a> <span title="(x$1: Any)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Option[V]" id="171885">optv</a> = ln.<a href="#170708" title="(k: K)Option[V]">get</a><span class="delimiter">(</span><a href="#171678" title="K">k</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="171886">nn</a> = ln.<a href="#170707" title="(k: K)scala.collection.concurrent.MainNode[K,V]">removed</a><span class="delimiter">(</span><a href="#171678" title="K">k</a><span class="delimiter">)</span>
          <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#170178" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>ln, <a href="#171886" title="scala.collection.concurrent.MainNode[K,V]">nn</a>, <a href="#171684" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#171885" title="Option[V]">optv</a> <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> ln.<a href="#170708" title="(k: K)Option[V]">get</a><a href="../../Option.scala.html#64115" title="=&gt; V" class="delimiter">(</a><a href="#171678" title="K">k</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> optv @ Some<a href="#171895" title="Option[V]" id="171896" class="delimiter">(</a>v0<span class="delimiter">)</span> <span class="keyword">if</span> v0 <span title="(x$1: Any)Boolean">==</span> <a href="#171679" title="V">v</a> =&gt;
            <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="171893">nn</a> = ln.<a href="#170707" title="(k: K)scala.collection.concurrent.MainNode[K,V]">removed</a><span class="delimiter">(</span><a href="#171678" title="K">k</a><span class="delimiter">)</span>
            <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#170178" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><span class="delimiter">(</span>ln, <a href="#171893" title="scala.collection.concurrent.MainNode[K,V]">nn</a>, <a href="#171684" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span><span class="delimiter">)</span> optv <span class="keyword">else</span> <span title="Null(null)" class="keyword">null</span>
          <span class="keyword">case</span> _ =&gt; <a href="#171897" title="(x: Option[V])Option[V]">None</a>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(nd: scala.collection.concurrent.INode[K,V], ct: scala.collection.concurrent.TrieMap[K,V], lev: Int)Unit" id="170185">clean</a><span class="delimiter">(</span><a title="scala.collection.concurrent.INode[K,V]" id="170692">nd</a>: <a href="#10422" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.TrieMap[K,V]" id="170693">ct</a>: <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="Int" id="170694">lev</a>: <a href="../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="171913">m</a> = <a href="#170692" title="scala.collection.concurrent.INode[K,V]">nd</a>.<a href="#170176" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_READ</a><span class="delimiter">(</span><a href="#170693" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
    <a href="#171913" title="scala.collection.concurrent.MainNode[K,V]">m</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#171957" title="Unit" id="171958">cn</a>: CNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; <a href="#170692" title="scala.collection.concurrent.INode[K,V]">nd</a>.<a href="#170178" title="(old: scala.collection.concurrent.MainNode[K,V], n: scala.collection.concurrent.MainNode[K,V], ct: scala.collection.concurrent.TrieMap[K,V])Boolean">GCAS</a><a href="#171959" title="(x: Unit)Unit" class="delimiter">(</a>cn, cn.<a href="#170464" title="(ct: scala.collection.concurrent.TrieMap[K,V], lev: Int, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.MainNode[K,V]">toCompressed</a><span class="delimiter">(</span><a href="#170693" title="scala.collection.concurrent.TrieMap[K,V]">ct</a>, <a href="#170694" title="Int">lev</a>, <a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>, <a href="#170693" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
      <span class="keyword">case</span> _ =&gt;
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(ct: scala.collection.concurrent.TrieMap[K,V])Boolean" id="170186">isNullInode</a><span class="delimiter">(</span><a title="scala.collection.concurrent.TrieMap[K,V]" id="171964">ct</a>: <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#170176" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_READ</a><span class="delimiter">(</span><a href="#171964" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span>

  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(ct: scala.collection.concurrent.TrieMap[K,V])Int" id="170187">cachedSize</a><span class="delimiter">(</span><a title="scala.collection.concurrent.TrieMap[K,V]" id="171965">ct</a>: <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../Int.scala.html#508" title="Int">Int</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="171966">m</a> = <a href="#170176" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">GCAS_READ</a><span class="delimiter">(</span><a href="#171965" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
    <a href="#171966" title="scala.collection.concurrent.MainNode[K,V]">m</a>.<a href="MainNode.java.html#170195" title="(ct: Any)Int">cachedSize</a><span class="delimiter">(</span><a href="#171965" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  /* this is a quiescent method! */
  <span class="keyword">def</span> <a title="(lev: Int)String" id="170188">string</a><span class="delimiter">(</span><a title="Int" id="171968">lev</a>: <a href="../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">)</span> = <a href="../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;%sINode -&gt; %s&quot;</a>.<a href="../immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;  &quot;</a> <a href="../immutable/StringLike.scala.html#60700" title="(n: Int)String">*</a> <a href="#171968" title="Int">lev</a>, <a href="INodeBase.java.html#170162" title="scala.collection.concurrent.MainNode[K,V]">mainnode</a> <span class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a href="#172007" title="Any" id="172016" class="keyword">null</a> =&gt; <a href="#172020" title="(x: Any)Any" class="string">&quot;&lt;null&gt;&quot;</a>
    <span class="keyword">case</span> <a href="#172007" title="Any" id="172017">tn</a>: TNode<span class="delimiter">[</span>_, _<span class="delimiter">]</span> =&gt; <a href="../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;TNode(%s, %s, %d, !)&quot;</a>.<a href="../immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><a href="#172020" title="(x: Any)Any" class="delimiter">(</a>tn.<a href="#172076" title="=&gt; _">k</a>, tn.<a href="#172077" title="=&gt; _">v</a>, tn.<a href="#172078" title="=&gt; Int">hc</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="#172007" title="Any" id="172018">cn</a>: CNode<span class="delimiter">[</span>_, _<span class="delimiter">]</span> =&gt; cn.<a href="#170465" title="(lev: Int)String">string</a><a href="#172020" title="(x: Any)Any" class="delimiter">(</a><a href="#171968" title="Int">lev</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="#172007" title="Any" id="172019">ln</a>: LNode<span class="delimiter">[</span>_, _<span class="delimiter">]</span> =&gt; ln.<a href="#170710" title="(lev: Int)String">string</a><a href="#172020" title="(x: Any)Any" class="delimiter">(</a><a href="#171968" title="Int">lev</a><span class="delimiter">)</span>
    <span class="keyword">case</span> x =&gt; <a href="../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&lt;elem: %s&gt;&quot;</a>.<a href="../immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><a href="#172020" title="(x: Any)Any" class="delimiter">(</a>x<span class="delimiter">)</span>
  <span class="delimiter">}</span><span class="delimiter">)</span>

<span class="delimiter">}</span>


<span class="keyword">private</span><span class="delimiter">[</span>concurrent<span class="delimiter">]</span> <span class="keyword">object</span> <a title="scala.collection.concurrent.INode.type" id="10423">INode</a> <a href="#10424" title="scala.collection.concurrent.INode.type" class="delimiter">{</a>
  <span class="keyword">val</span> <a title="Object" id="171314">KEY_PRESENT</a> = <span title="Object" class="keyword">new</span> <span title="Object">AnyRef</span>
  <span class="keyword">val</span> <a title="Object" id="171316">KEY_ABSENT</a> = <span title="Object" class="keyword">new</span> <span title="Object">AnyRef</span>

  <span class="keyword">def</span> <a title="[K, V]=&gt; scala.collection.concurrent.INode[K,V]" id="171318">newRootNode</a><span class="delimiter">[</span><a title="" id="171321">K</a>, <a title="" id="171322">V</a><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.Gen" id="172033">gen</a> = <span title="scala.collection.concurrent.Gen" class="keyword">new</span> <a href="Gen.java.html#10467" title="scala.collection.concurrent.Gen">Gen</a>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.CNode[K,V]" id="172034">cn</a> = <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">new</span> <a href="#10428" title="scala.collection.concurrent.CNode[K,V]">CNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <span title="Array[scala.collection.concurrent.BasicNode]" class="keyword">new</span> <a href="../../Array.scala.html#292" title="Array[scala.collection.concurrent.BasicNode]">Array</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <a href="#172033" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
    <span title="scala.collection.concurrent.INode[K,V]" class="keyword">new</span> <a href="#10422" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">(</span><a href="#172034" title="scala.collection.concurrent.CNode[K,V]">cn</a>, <a href="#172033" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>


<span title="Object" class="keyword">private</span><span class="delimiter">[</span>concurrent<span class="delimiter">]</span> <span class="keyword">final</span> <span class="keyword">class</span> <a title="class FailedNode[K, V] extends scala.collection.concurrent.MainNode[K,V]" id="10401">FailedNode</a><span class="delimiter">[</span><a title="" id="10499">K</a>, <a title="" id="10500">V</a><span class="delimiter">]</span><a href="#10401" title="scala.collection.concurrent.FailedNode[K,V]" class="delimiter">(</a><a title="scala.collection.concurrent.MainNode[K,V]" id="170395">p</a>: <a href="MainNode.java.html#10413" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="MainNode.java.html#10413" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> <span class="delimiter">{</span>
  <a href="MainNode.java.html#170197" title="(nval: scala.collection.concurrent.MainNode[K,V])Unit">WRITE_PREV</a><span class="delimiter">(</span><a href="#170395" title="scala.collection.concurrent.MainNode[K,V]">p</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(lev: Int)Nothing" id="170378">string</a><span class="delimiter">(</span><a title="Int" id="172043">lev</a>: <a href="../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">)</span> = <span title="Nothing" class="keyword">throw</span> <span title="UnsupportedOperationException" class="keyword">new</span> <a href="../../package.scala.html#56966" title="UnsupportedOperationException">UnsupportedOperationException</a>

  <span class="keyword">def</span> <a title="(ct: AnyRef)Int" id="170379">cachedSize</a><span class="delimiter">(</span><a title="AnyRef" id="172046">ct</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span>: <a href="../../Int.scala.html#508" title="Int">Int</a> = <span title="Nothing" class="keyword">throw</span> <span title="UnsupportedOperationException" class="keyword">new</span> <a href="../../package.scala.html#56966" title="UnsupportedOperationException">UnsupportedOperationException</a>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="170380">toString</a> = <a href="../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;FailedNode(%s)&quot;</a>.<a href="../immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#170395" title="scala.collection.concurrent.MainNode[K,V]">p</a><span class="delimiter">)</span>
<span class="delimiter">}</span>


<span class="keyword">private</span><span class="delimiter">[</span>concurrent<span class="delimiter">]</span> <span class="keyword">trait</span> <a title="trait KVNode[K, V] extends Object" id="10437">KVNode</a><span class="delimiter">[</span><a title="" id="10501">K</a>, <a title="" id="10502">V</a><span class="delimiter">]</span> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="=&gt; (K, V)" id="170562">kvPair</a>: <a href="../../Tuple2.scala.html#1222" title="(K, V)" class="delimiter">(</a>K, V<span class="delimiter">)</span>
<span class="delimiter">}</span>


<span title="Object" class="keyword">private</span><span class="delimiter">[</span>collection<span class="delimiter">]</span> <span class="keyword">final</span> <span class="keyword">class</span> <a title="class SNode[K, V] extends scala.collection.concurrent.BasicNode with scala.collection.concurrent.KVNode[K,V]" id="10410">SNode</a><span class="delimiter">[</span><a title="" id="10503">K</a>, <a title="" id="10504">V</a><span class="delimiter">]</span><a href="#10410" title="scala.collection.concurrent.SNode[K,V]" class="delimiter">(</a><span class="keyword">final</span> <span class="keyword">val</span> <a title="K" id="170576">k</a>: <a href="#10503" title="K">K</a>, <span class="keyword">final</span> <span class="keyword">val</span> <a title="V" id="170577">v</a>: <a href="#10504" title="V">V</a>, <span class="keyword">final</span> <span class="keyword">val</span> <a title="Int" id="170578">hc</a>: <a href="../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">)</span>
<span class="keyword">extends</span> <a href="BasicNode.java.html#10464" title="scala.collection.concurrent.BasicNode">BasicNode</a> <span class="keyword">with</span> <a href="#10437" title="scala.collection.concurrent.KVNode[K,V]">KVNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> <span class="delimiter">{</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="=&gt; scala.collection.concurrent.SNode[K,V]" id="170557">copy</a> = <span title="scala.collection.concurrent.SNode[K,V]" class="keyword">new</span> <a href="#10410" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">(</span><a href="#170576" title="=&gt; K">k</a>, <a href="#170577" title="=&gt; V">v</a>, <a href="#170578" title="=&gt; Int">hc</a><span class="delimiter">)</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="=&gt; scala.collection.concurrent.TNode[K,V]" id="170558">copyTombed</a> = <span title="scala.collection.concurrent.TNode[K,V]" class="keyword">new</span> <a href="#10446" title="scala.collection.concurrent.TNode[K,V]">TNode</a><span class="delimiter">(</span><a href="#170576" title="=&gt; K">k</a>, <a href="#170577" title="=&gt; V">v</a>, <a href="#170578" title="=&gt; Int">hc</a><span class="delimiter">)</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="=&gt; scala.collection.concurrent.SNode[K,V]" id="170559">copyUntombed</a> = <span title="scala.collection.concurrent.SNode[K,V]" class="keyword">new</span> <a href="#10410" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">(</span><a href="#170576" title="=&gt; K">k</a>, <a href="#170577" title="=&gt; V">v</a>, <a href="#170578" title="=&gt; Int">hc</a><span class="delimiter">)</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="=&gt; (K, V)" id="170560">kvPair</a> = <a href="../../Tuple2.scala.html#63804" title="(_1: K, _2: V)(K, V)" class="delimiter">(</a><a href="#170576" title="=&gt; K">k</a>, <a href="#170577" title="=&gt; V">v</a><span class="delimiter">)</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(lev: Int)String" id="170561">string</a><span class="delimiter">(</span><a title="Int" id="172105">lev</a>: <a href="../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;  &quot;</a> <a href="../immutable/StringLike.scala.html#60700" title="(n: Int)String">*</a> <a href="#172105" title="Int">lev</a><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <a href="../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;SNode(%s, %s, %x)&quot;</a>.<a href="../immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#170576" title="=&gt; K">k</a>, <a href="#170577" title="=&gt; V">v</a>, <a href="#170578" title="=&gt; Int">hc</a><span class="delimiter">)</span>
<span class="delimiter">}</span>


<span class="keyword">private</span><span class="delimiter">[</span>collection<span class="delimiter">]</span> <span class="keyword">final</span> <span class="keyword">class</span> <a title="class TNode[K, V] extends scala.collection.concurrent.MainNode[K,V] with scala.collection.concurrent.KVNode[K,V]" id="10446">TNode</a><span class="delimiter">[</span><a title="" id="10505">K</a>, <a title="" id="10506">V</a><span class="delimiter">]</span><a href="#10446" title="scala.collection.concurrent.TNode[K,V]" class="delimiter">(</a><span class="keyword">final</span> <span class="keyword">val</span> <a title="K" id="172076">k</a>: <a href="#10505" title="K">K</a>, <span class="keyword">final</span> <span class="keyword">val</span> <a title="V" id="172077">v</a>: <a href="#10506" title="V">V</a>, <span class="keyword">final</span> <span class="keyword">val</span> <a title="Int" id="172078">hc</a>: <a href="../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">)</span>
<span class="keyword">extends</span> <a href="MainNode.java.html#10413" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> <span class="keyword">with</span> <a href="#10437" title="scala.collection.concurrent.KVNode[K,V]">KVNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> <span class="delimiter">{</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="=&gt; scala.collection.concurrent.TNode[K,V]" id="170686">copy</a> = <span title="scala.collection.concurrent.TNode[K,V]" class="keyword">new</span> <a href="#10446" title="scala.collection.concurrent.TNode[K,V]">TNode</a><span class="delimiter">(</span><a href="#172076" title="=&gt; K">k</a>, <a href="#172077" title="=&gt; V">v</a>, <a href="#172078" title="=&gt; Int">hc</a><span class="delimiter">)</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="=&gt; scala.collection.concurrent.TNode[K,V]" id="170687">copyTombed</a> = <span title="scala.collection.concurrent.TNode[K,V]" class="keyword">new</span> <a href="#10446" title="scala.collection.concurrent.TNode[K,V]">TNode</a><span class="delimiter">(</span><a href="#172076" title="=&gt; K">k</a>, <a href="#172077" title="=&gt; V">v</a>, <a href="#172078" title="=&gt; Int">hc</a><span class="delimiter">)</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="=&gt; scala.collection.concurrent.SNode[K,V]" id="170688">copyUntombed</a> = <span title="scala.collection.concurrent.SNode[K,V]" class="keyword">new</span> <a href="#10410" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">(</span><a href="#172076" title="=&gt; K">k</a>, <a href="#172077" title="=&gt; V">v</a>, <a href="#172078" title="=&gt; Int">hc</a><span class="delimiter">)</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="=&gt; (K, V)" id="170689">kvPair</a> = <a href="../../Tuple2.scala.html#63804" title="(_1: K, _2: V)(K, V)" class="delimiter">(</a><a href="#172076" title="=&gt; K">k</a>, <a href="#172077" title="=&gt; V">v</a><span class="delimiter">)</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(ct: AnyRef)Int" id="170690">cachedSize</a><span class="delimiter">(</span><a title="AnyRef" id="172149">ct</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span>: <a href="../../Int.scala.html#508" title="Int">Int</a> = <span title="Int(1)" class="int">1</span>
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(lev: Int)String" id="170691">string</a><span class="delimiter">(</span><a title="Int" id="172151">lev</a>: <a href="../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;  &quot;</a> <a href="../immutable/StringLike.scala.html#60700" title="(n: Int)String">*</a> <a href="#172151" title="Int">lev</a><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <a href="../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;TNode(%s, %s, %x, !)&quot;</a>.<a href="../immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#172076" title="=&gt; K">k</a>, <a href="#172077" title="=&gt; V">v</a>, <a href="#172078" title="=&gt; Int">hc</a><span class="delimiter">)</span>
<span class="delimiter">}</span>


<span class="keyword">private</span><span class="delimiter">[</span>collection<span class="delimiter">]</span> <span class="keyword">final</span> <span class="keyword">class</span> <a title="class LNode[K, V] extends scala.collection.concurrent.MainNode[K,V]" id="10383">LNode</a><span class="delimiter">[</span><a title="" id="10507">K</a>, <a title="" id="10508">V</a><span class="delimiter">]</span><a href="#10383" title="scala.collection.concurrent.LNode[K,V]" class="delimiter">(</a><span class="keyword">final</span> <span class="keyword">val</span> <a title="scala.collection.immutable.ListMap[K,V]" id="170730">listmap</a>: <a href="../immutable/ListMap.scala.html#12082" title="scala.collection.immutable.ListMap[K,V]">ImmutableListMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span>
<span class="keyword">extends</span> <a href="MainNode.java.html#10413" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(k: K, v: V)scala.collection.concurrent.LNode[K,V]" id="170704" class="keyword">this</a><span class="delimiter">(</span><a title="K" id="170726">k</a>: <a href="#10507" title="K">K</a>, <a title="V" id="170727">v</a>: <a href="#10508" title="V">V</a><span class="delimiter">)</span> = <a href="#10383" title="LNode.this.type" class="keyword">this</a><span class="delimiter">(</span><a href="../generic/GenMapFactory.scala.html#61654" title="(elems: (K, V)*)scala.collection.immutable.ListMap[K,V]">ImmutableListMap</a><span class="delimiter">(</span><a href="../../Predef.scala.html#8484" title="(x: K)ArrowAssoc[K]">k</a> <a href="../../Predef.scala.html#63591" title="(y: V)(K, V)">-&gt;</a> <a href="#170727" title="V">v</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(k1: K, v1: V, k2: K, v2: V)scala.collection.concurrent.LNode[K,V]" id="170705" class="keyword">this</a><span class="delimiter">(</span><a title="K" id="170718">k1</a>: <a href="#10507" title="K">K</a>, <a title="V" id="170719">v1</a>: <a href="#10508" title="V">V</a>, <a title="K" id="170720">k2</a>: <a href="#10507" title="K">K</a>, <a title="V" id="170721">v2</a>: <a href="#10508" title="V">V</a><span class="delimiter">)</span> = <a href="#10383" title="LNode.this.type" class="keyword">this</a><span class="delimiter">(</span><a href="../generic/GenMapFactory.scala.html#61654" title="(elems: (K, V)*)scala.collection.immutable.ListMap[K,V]">ImmutableListMap</a><span class="delimiter">(</span><a href="../../Predef.scala.html#8484" title="(x: K)ArrowAssoc[K]">k1</a> <a href="../../Predef.scala.html#63591" title="(y: V)(K, V)">-&gt;</a> <a href="#170719" title="V">v1</a>, <a href="../../Predef.scala.html#8484" title="(x: K)ArrowAssoc[K]">k2</a> <a href="../../Predef.scala.html#63591" title="(y: V)(K, V)">-&gt;</a> <a href="#170721" title="V">v2</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(k: K, v: V)scala.collection.concurrent.LNode[K,V]" id="170706">inserted</a><span class="delimiter">(</span><a title="K" id="170712">k</a>: <a href="#10507" title="K">K</a>, <a title="V" id="170713">v</a>: <a href="#10508" title="V">V</a><span class="delimiter">)</span> = <span title="scala.collection.concurrent.LNode[K,V]" class="keyword">new</span> <a href="#10383" title="scala.collection.concurrent.LNode[K,V]">LNode</a><span class="delimiter">(</span><a href="#170730" title="=&gt; scala.collection.immutable.ListMap[K,V]">listmap</a> <a href="../immutable/ListMap.scala.html#170740" title="(kv: (K, V))scala.collection.immutable.ListMap[K,V]">+</a> <span class="delimiter">(</span><a href="../../Tuple2.scala.html#63804" title="(_1: K, _2: V)(K, V)" class="delimiter">(</a><a href="#170712" title="K">k</a>, <a href="#170713" title="V">v</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(k: K)scala.collection.concurrent.MainNode[K,V]" id="170707">removed</a><span class="delimiter">(</span><a title="K" id="171888">k</a>: <a href="#10507" title="K">K</a><span class="delimiter">)</span>: <a href="MainNode.java.html#10413" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.immutable.ListMap[K,V]" id="172248">updmap</a> = <a href="#170730" title="=&gt; scala.collection.immutable.ListMap[K,V]">listmap</a> <a href="../immutable/ListMap.scala.html#170752" title="(key: K)scala.collection.immutable.ListMap[K,V]">-</a> <a href="#171888" title="K">k</a>
    <span title="scala.collection.concurrent.MainNode[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#172248" title="scala.collection.immutable.ListMap[K,V]">updmap</a>.<a href="../immutable/ListMap.scala.html#170735" title="=&gt; Int">size</a> <a href="../../Int.scala.html#57919" title="(x: Int)Boolean">&gt;</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span title="scala.collection.concurrent.LNode[K,V]" class="keyword">new</span> <a href="#10383" title="scala.collection.concurrent.LNode[K,V]">LNode</a><span class="delimiter">(</span><a href="#172248" title="scala.collection.immutable.ListMap[K,V]">updmap</a><span class="delimiter">)</span>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a href="#172314" title="(x: (K, V))(K, V)" class="delimiter">(</a><a href="../../Tuple2.scala.html#61506" title="K" id="172298">k</a>, <a href="../../Tuple2.scala.html#61508" title="V" id="172299">v</a><span class="delimiter">)</span> = <a href="#172248" title="scala.collection.immutable.ListMap[K,V]">updmap</a>.<a href="../immutable/ListMap.scala.html#170753" title="=&gt; Iterator[(K, V)]">iterator</a>.<a href="../Iterator.scala.html#65194" title="()(K, V)">next</a>
      <span title="scala.collection.concurrent.TNode[K,V]" class="keyword">new</span> <a href="#10446" title="scala.collection.concurrent.TNode[K,V]">TNode</a><span class="delimiter">(</span><a href="#172298" title="K">k</a>, <a href="#172299" title="V">v</a>, <a href="#176025" title="scala.collection.concurrent.TrieMap.type">TrieMap</a>.<a href="#172336" title="(k: K)Int">computeHash</a><span class="delimiter">(</span><a href="#172298" title="K">k</a><span class="delimiter">)</span><span class="delimiter">)</span> // create it tombed so that it gets compressed on subsequent accesses
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  <span class="keyword">def</span> <a title="(k: K)Option[V]" id="170708">get</a><span class="delimiter">(</span><a title="K" id="171482">k</a>: <a href="#10507" title="K">K</a><span class="delimiter">)</span> = <a href="#170730" title="=&gt; scala.collection.immutable.ListMap[K,V]">listmap</a>.<a href="../immutable/ListMap.scala.html#170736" title="(key: K)Option[V]">get</a><span class="delimiter">(</span><a href="#171482" title="K">k</a><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(ct: AnyRef)Int" id="170709">cachedSize</a><span class="delimiter">(</span><a title="AnyRef" id="172347">ct</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span>: <a href="../../Int.scala.html#508" title="Int">Int</a> = <a href="#170730" title="=&gt; scala.collection.immutable.ListMap[K,V]">listmap</a>.<a href="../immutable/ListMap.scala.html#170735" title="=&gt; Int">size</a>
  <span class="keyword">def</span> <a title="(lev: Int)String" id="170710">string</a><span class="delimiter">(</span><a title="Int" id="171993">lev</a>: <a href="../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot; &quot;</a> <a href="../immutable/StringLike.scala.html#60700" title="(n: Int)String">*</a> <a href="#171993" title="Int">lev</a><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <a href="../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;LNode(%s)&quot;</a>.<a href="../immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#170730" title="=&gt; scala.collection.immutable.ListMap[K,V]">listmap</a>.<a href="../TraversableOnce.scala.html#59190" title="(sep: String)String">mkString</a><span class="delimiter">(</span><span title="String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
<span class="delimiter">}</span>


<span class="keyword">private</span><span class="delimiter">[</span>collection<span class="delimiter">]</span> <span class="keyword">final</span> <span class="keyword">class</span> <a title="class CNode[K, V] extends scala.collection.concurrent.CNodeBase[K,V]" id="10428">CNode</a><span class="delimiter">[</span><a title="" id="10509">K</a>, <a title="" id="10510">V</a><span class="delimiter">]</span><a href="#10428" title="scala.collection.concurrent.CNode[K,V]" class="delimiter">(</a><span class="keyword">final</span> <span class="keyword">val</span> <a title="Int" id="170541">bitmap</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <span class="keyword">final</span> <span class="keyword">val</span> <a title="Array[scala.collection.concurrent.BasicNode]" id="170542">array</a>: <a href="../../Array.scala.html#292" title="Array[scala.collection.concurrent.BasicNode]">Array</a><span class="delimiter">[</span>BasicNode<span class="delimiter">]</span>, <span class="keyword">final</span> <span class="keyword">val</span> <a title="scala.collection.concurrent.Gen" id="170543">gen</a>: <a href="Gen.java.html#10467" title="scala.collection.concurrent.Gen">Gen</a><span class="delimiter">)</span>
<span class="keyword">extends</span> <a href="CNodeBase.java.html#10434" title="scala.collection.concurrent.CNodeBase[K,V]">CNodeBase</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> <span class="delimiter">{</span>

  // this should only be called from within read-only snapshots
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(ct: AnyRef)Int" id="170456">cachedSize</a><span class="delimiter">(</span><a title="AnyRef" id="172352">ct</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="172353">currsz</a> = <a href="CNodeBase.java.html#170445" title="()Int">READ_SIZE</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#172353" title="Int">currsz</a> <a href="../../Int.scala.html#57898" title="(x: Int)Boolean">!=</a> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span> <a href="#172353" title="Int">currsz</a>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Int" id="172358">sz</a> = <a href="#170457" title="(ct: scala.collection.concurrent.TrieMap[K,V])Int">computeSize</a><span class="delimiter">(</span><a href="#172352" title="AnyRef">ct</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="scala.collection.concurrent.TrieMap[K,V]" class="delimiter">[</span><a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>
      <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="CNodeBase.java.html#170445" title="()Int">READ_SIZE</a><span class="delimiter">(</span><span class="delimiter">)</span> <a href="../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span> <a href="CNodeBase.java.html#170443" title="(oldval: Int, nval: Int)Boolean">CAS_SIZE</a><a href="#172359" title="()Unit" class="delimiter">(</a>-<span title="Int(-1)" class="int">1</span>, <a href="#172358" title="Int">sz</a><span class="delimiter">)</span>
      <a href="CNodeBase.java.html#170445" title="()Int">READ_SIZE</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  // lends itself towards being parallelizable by choosing
  // a random starting offset in the array
  // =&gt; if there are concurrent size computations, they start
  //    at different positions, so they are more likely to
  //    to be independent
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(ct: scala.collection.concurrent.TrieMap[K,V])Int" id="170457">computeSize</a><span class="delimiter">(</span><a title="scala.collection.concurrent.TrieMap[K,V]" id="172360">ct</a>: <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../Int.scala.html#508" title="Int">Int</a> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Int" id="172368">i</a> = <span title="Int(0)" class="int">0</span>
    <span class="keyword">var</span> <a title="Int" id="172369">sz</a> = <span title="Int(0)" class="int">0</span>
    <span class="keyword">val</span> <a title="Int" id="172370">offset</a> = math.<a href="../../math/package.scala.html#56924" title="(x: Int)Int">abs</a><span class="delimiter">(</span>util.<a href="../../util/Random.scala.html#53302" title="scala.util.Random.type">Random</a>.<a href="../../util/Random.scala.html#172392" title="()Int">nextInt</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../Int.scala.html#57976" title="(x: Int)Int">%</a> <a href="#170542" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>.<a href="../../Array.scala.html#57449" title="=&gt; Int">length</a>
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#172368" title="Int">i</a> <a href="../../Int.scala.html#57905" title="(x: Int)Boolean">&lt;</a> <a href="#170542" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>.<a href="../../Array.scala.html#57449" title="=&gt; Int">length</a><span class="delimiter">)</span> <a href="#172371" title="()Unit" class="delimiter">{</a>
      <span class="keyword">val</span> <a title="Int" id="172417">pos</a> = <span class="delimiter">(</span><a href="#172368" title="Int">i</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+</a> <a href="#172370" title="Int">offset</a><span class="delimiter">)</span> <a href="../../Int.scala.html#57976" title="(x: Int)Int">%</a> <a href="#170542" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>.<a href="../../Array.scala.html#57449" title="=&gt; Int">length</a>
      <a href="../../Array.scala.html#57450" title="(i: Int)scala.collection.concurrent.BasicNode">array</a><a href="#172446" title="scala.collection.concurrent.INode[K,V]" class="delimiter">(</a><a href="#172417" title="Int">pos</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="#172444" title="Unit" id="172445">sn</a>: SNode<span class="delimiter">[</span>_, _<span class="delimiter">]</span> =&gt; <a href="#172369" title="Int">sz</a> <a href="#172447" title="(x: Unit)Unit">+=</a> <span title="Int(1)" class="int">1</span>
        <span class="keyword">case</span> <a href="#172444" title="Unit" id="172446">in</a>: INode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; <a href="#172369" title="Int">sz</a> <a href="#172447" title="(x: Unit)Unit">+=</a> in.<a href="#170187" title="(ct: scala.collection.concurrent.TrieMap[K,V])Int">cachedSize</a><span class="delimiter">(</span><a href="#172360" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#172368" title="Int">i</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
    <span class="delimiter">}</span>
    <a href="#172369" title="Int">sz</a>
  <span class="delimiter">}</span>

  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(pos: Int, nn: scala.collection.concurrent.BasicNode, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]" id="170458">updatedAt</a><span class="delimiter">(</span><a title="Int" id="170567">pos</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <a title="scala.collection.concurrent.BasicNode" id="170568">nn</a>: <a href="BasicNode.java.html#10464" title="scala.collection.concurrent.BasicNode">BasicNode</a>, <a title="scala.collection.concurrent.Gen" id="170569">gen</a>: <a href="Gen.java.html#10467" title="scala.collection.concurrent.Gen">Gen</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="170570">len</a> = <a href="#170542" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>.<a href="../../Array.scala.html#57449" title="=&gt; Int">length</a>
    <span class="keyword">val</span> <a title="Array[scala.collection.concurrent.BasicNode]" id="170571">narr</a> = <span title="Array[scala.collection.concurrent.BasicNode]" class="keyword">new</span> <a href="../../Array.scala.html#292" title="Array[scala.collection.concurrent.BasicNode]">Array</a><span class="delimiter">[</span>BasicNode<span class="delimiter">]</span><span class="delimiter">(</span><a href="#170570" title="Int">len</a><span class="delimiter">)</span>
    <a href="../../Array.scala.html#293" title="Array.type">Array</a>.<a href="../../Array.scala.html#68724" title="(src: AnyRef, srcPos: Int, dest: AnyRef, destPos: Int, length: Int)Unit">copy</a><span class="delimiter">(</span><a href="#170542" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>, <span title="Int(0)" class="int">0</span>, <a href="#170571" title="Array[scala.collection.concurrent.BasicNode]">narr</a>, <span title="Int(0)" class="int">0</span>, <a href="#170570" title="Int">len</a><span class="delimiter">)</span>
    <a href="../../Array.scala.html#57451" title="(i: Int, x: scala.collection.concurrent.BasicNode)Unit">narr</a><span class="delimiter">(</span><a href="#170567" title="Int">pos</a><span class="delimiter">)</span> = <a href="#170568" title="scala.collection.concurrent.BasicNode">nn</a>
    <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">new</span> <a href="#10428" title="scala.collection.concurrent.CNode[K,V]">CNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">(</span><a href="#170541" title="=&gt; Int">bitmap</a>, <a href="#170571" title="Array[scala.collection.concurrent.BasicNode]">narr</a>, <a href="#170569" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(pos: Int, flag: Int, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]" id="170459">removedAt</a><span class="delimiter">(</span><a title="Int" id="171735">pos</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <a title="Int" id="171736">flag</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <a title="scala.collection.concurrent.Gen" id="171737">gen</a>: <a href="Gen.java.html#10467" title="scala.collection.concurrent.Gen">Gen</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Array[scala.collection.concurrent.BasicNode]" id="171738">arr</a> = <a href="#170542" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>
    <span class="keyword">val</span> <a title="Int" id="171739">len</a> = <a href="#171738" title="Array[scala.collection.concurrent.BasicNode]">arr</a>.<a href="../../Array.scala.html#57449" title="=&gt; Int">length</a>
    <span class="keyword">val</span> <a title="Array[scala.collection.concurrent.BasicNode]" id="171740">narr</a> = <span title="Array[scala.collection.concurrent.BasicNode]" class="keyword">new</span> <a href="../../Array.scala.html#292" title="Array[scala.collection.concurrent.BasicNode]">Array</a><span class="delimiter">[</span>BasicNode<span class="delimiter">]</span><span class="delimiter">(</span><a href="#171739" title="Int">len</a> <a href="../../Int.scala.html#57955" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <a href="../../Array.scala.html#293" title="Array.type">Array</a>.<a href="../../Array.scala.html#68724" title="(src: AnyRef, srcPos: Int, dest: AnyRef, destPos: Int, length: Int)Unit">copy</a><span class="delimiter">(</span><a href="#171738" title="Array[scala.collection.concurrent.BasicNode]">arr</a>, <span title="Int(0)" class="int">0</span>, <a href="#171740" title="Array[scala.collection.concurrent.BasicNode]">narr</a>, <span title="Int(0)" class="int">0</span>, <a href="#171735" title="Int">pos</a><span class="delimiter">)</span>
    <a href="../../Array.scala.html#293" title="Array.type">Array</a>.<a href="../../Array.scala.html#68724" title="(src: AnyRef, srcPos: Int, dest: AnyRef, destPos: Int, length: Int)Unit">copy</a><span class="delimiter">(</span><a href="#171738" title="Array[scala.collection.concurrent.BasicNode]">arr</a>, <a href="#171735" title="Int">pos</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+</a> <span title="Int(1)" class="int">1</span>, <a href="#171740" title="Array[scala.collection.concurrent.BasicNode]">narr</a>, <a href="#171735" title="Int">pos</a>, <a href="#171739" title="Int">len</a> <a href="../../Int.scala.html#57955" title="(x: Int)Int">-</a> <a href="#171735" title="Int">pos</a> <a href="../../Int.scala.html#57955" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">new</span> <a href="#10428" title="scala.collection.concurrent.CNode[K,V]">CNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">(</span><a href="#170541" title="=&gt; Int">bitmap</a> <a href="../../Int.scala.html#57943" title="(x: Int)Int">^</a> <a href="#171736" title="Int">flag</a>, <a href="#171740" title="Array[scala.collection.concurrent.BasicNode]">narr</a>, <a href="#171737" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(pos: Int, flag: Int, nn: scala.collection.concurrent.BasicNode, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.CNode[K,V]" id="170460">insertedAt</a><span class="delimiter">(</span><a title="Int" id="170642">pos</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <a title="Int" id="170643">flag</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <a title="scala.collection.concurrent.BasicNode" id="170644">nn</a>: <a href="BasicNode.java.html#10464" title="scala.collection.concurrent.BasicNode">BasicNode</a>, <a title="scala.collection.concurrent.Gen" id="170645">gen</a>: <a href="Gen.java.html#10467" title="scala.collection.concurrent.Gen">Gen</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="170646">len</a> = <a href="#170542" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>.<a href="../../Array.scala.html#57449" title="=&gt; Int">length</a>
    <span class="keyword">val</span> <a title="Int" id="170647">bmp</a> = <a href="#170541" title="=&gt; Int">bitmap</a>
    <span class="keyword">val</span> <a title="Array[scala.collection.concurrent.BasicNode]" id="170648">narr</a> = <span title="Array[scala.collection.concurrent.BasicNode]" class="keyword">new</span> <a href="../../Array.scala.html#292" title="Array[scala.collection.concurrent.BasicNode]">Array</a><span class="delimiter">[</span>BasicNode<span class="delimiter">]</span><span class="delimiter">(</span><a href="#170646" title="Int">len</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <a href="../../Array.scala.html#293" title="Array.type">Array</a>.<a href="../../Array.scala.html#68724" title="(src: AnyRef, srcPos: Int, dest: AnyRef, destPos: Int, length: Int)Unit">copy</a><span class="delimiter">(</span><a href="#170542" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>, <span title="Int(0)" class="int">0</span>, <a href="#170648" title="Array[scala.collection.concurrent.BasicNode]">narr</a>, <span title="Int(0)" class="int">0</span>, <a href="#170642" title="Int">pos</a><span class="delimiter">)</span>
    <a href="../../Array.scala.html#57451" title="(i: Int, x: scala.collection.concurrent.BasicNode)Unit">narr</a><span class="delimiter">(</span><a href="#170642" title="Int">pos</a><span class="delimiter">)</span> = <a href="#170644" title="scala.collection.concurrent.BasicNode">nn</a>
    <a href="../../Array.scala.html#293" title="Array.type">Array</a>.<a href="../../Array.scala.html#68724" title="(src: AnyRef, srcPos: Int, dest: AnyRef, destPos: Int, length: Int)Unit">copy</a><span class="delimiter">(</span><a href="#170542" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>, <a href="#170642" title="Int">pos</a>, <a href="#170648" title="Array[scala.collection.concurrent.BasicNode]">narr</a>, <a href="#170642" title="Int">pos</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+</a> <span title="Int(1)" class="int">1</span>, <a href="#170646" title="Int">len</a> <a href="../../Int.scala.html#57955" title="(x: Int)Int">-</a> <a href="#170642" title="Int">pos</a><span class="delimiter">)</span>
    <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">new</span> <a href="#10428" title="scala.collection.concurrent.CNode[K,V]">CNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">(</span><a href="#170647" title="Int">bmp</a> <a href="../../Int.scala.html#57933" title="(x: Int)Int">|</a> <a href="#170643" title="Int">flag</a>, <a href="#170648" title="Array[scala.collection.concurrent.BasicNode]">narr</a>, <a href="#170645" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  /** Returns a copy of this cnode such that all the i-nodes below it are copied
   *  to the specified generation `ngen`.
   */
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.CNode[K,V]" id="170461">renewed</a><span class="delimiter">(</span><a title="scala.collection.concurrent.Gen" id="170508">ngen</a>: <a href="Gen.java.html#10467" title="scala.collection.concurrent.Gen">Gen</a>, <a title="scala.collection.concurrent.TrieMap[K,V]" id="170509">ct</a>: <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Int" id="170510">i</a> = <span title="Int(0)" class="int">0</span>
    <span class="keyword">val</span> <a title="Array[scala.collection.concurrent.BasicNode]" id="170511">arr</a> = <a href="#170542" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>
    <span class="keyword">val</span> <a title="Int" id="170512">len</a> = <a href="#170511" title="Array[scala.collection.concurrent.BasicNode]">arr</a>.<a href="../../Array.scala.html#57449" title="=&gt; Int">length</a>
    <span class="keyword">val</span> <a title="Array[scala.collection.concurrent.BasicNode]" id="170513">narr</a> = <span title="Array[scala.collection.concurrent.BasicNode]" class="keyword">new</span> <a href="../../Array.scala.html#292" title="Array[scala.collection.concurrent.BasicNode]">Array</a><span class="delimiter">[</span>BasicNode<span class="delimiter">]</span><span class="delimiter">(</span><a href="#170512" title="Int">len</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#170510" title="Int">i</a> <a href="../../Int.scala.html#57905" title="(x: Int)Boolean">&lt;</a> <a href="#170512" title="Int">len</a><span class="delimiter">)</span> <a href="#170514" title="()Unit" class="delimiter">{</a>
      <a href="../../Array.scala.html#57450" title="(i: Int)scala.collection.concurrent.BasicNode">arr</a><a href="#170527" title="scala.collection.concurrent.INode[K,V]" class="delimiter">(</a><a href="#170510" title="Int">i</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="#170526" title="Unit" id="170527">in</a>: INode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; <a href="../../Array.scala.html#57451" title="(i: Int, x: scala.collection.concurrent.BasicNode)Unit">narr</a><span class="delimiter">(</span><a href="#170510" title="Int">i</a><span class="delimiter">)</span> = in.<a href="#170180" title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.INode[K,V]">copyToGen</a><span class="delimiter">(</span><a href="#170508" title="scala.collection.concurrent.Gen">ngen</a>, <a href="#170509" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="#170526" title="Unit" id="170528">bn</a>: BasicNode =&gt; <a href="../../Array.scala.html#57451" title="(i: Int, x: scala.collection.concurrent.BasicNode)Unit">narr</a><span class="delimiter">(</span><a href="#170510" title="Int">i</a><span class="delimiter">)</span> = bn
      <span class="delimiter">}</span>
      <a href="#170510" title="Int">i</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
    <span class="delimiter">}</span>
    <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">new</span> <a href="#10428" title="scala.collection.concurrent.CNode[K,V]">CNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">(</span><a href="#170541" title="=&gt; Int">bitmap</a>, <a href="#170513" title="Array[scala.collection.concurrent.BasicNode]">narr</a>, <a href="#170508" title="scala.collection.concurrent.Gen">ngen</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(inode: scala.collection.concurrent.INode[K,V], inodemain: AnyRef)scala.collection.concurrent.BasicNode" id="170462">resurrect</a><span class="delimiter">(</span><a title="scala.collection.concurrent.INode[K,V]" id="171935">inode</a>: <a href="#10422" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="AnyRef" id="171936">inodemain</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span>: <a href="BasicNode.java.html#10464" title="scala.collection.concurrent.BasicNode">BasicNode</a> = <a href="#171936" title="AnyRef">inodemain</a> <span class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a href="#172464" title="scala.collection.concurrent.BasicNode" id="172465">tn</a>: TNode<span class="delimiter">[</span>_, _<span class="delimiter">]</span> =&gt; tn.<a href="#172466" title="(x: scala.collection.concurrent.BasicNode)scala.collection.concurrent.BasicNode">copyUntombed</a>
    <span class="keyword">case</span> _ =&gt; <a href="#172466" title="(x: scala.collection.concurrent.BasicNode)scala.collection.concurrent.BasicNode">inode</a>
  <span class="delimiter">}</span>

  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(lev: Int)scala.collection.concurrent.MainNode[K,V]" id="170463">toContracted</a><span class="delimiter">(</span><a title="Int" id="171761">lev</a>: <a href="../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">)</span>: <a href="MainNode.java.html#10413" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <span title="scala.collection.concurrent.MainNode[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#170542" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>.<a href="../../Array.scala.html#57449" title="=&gt; Int">length</a> <a href="../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <span title="Int(1)" class="int">1</span> <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#171761" title="Int">lev</a> <a href="../../Int.scala.html#57919" title="(x: Int)Boolean">&gt;</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="../../Array.scala.html#57450" title="(i: Int)scala.collection.concurrent.BasicNode">array</a><a href="#172483" title="scala.collection.concurrent.SNode[K,V]" class="delimiter">(</a><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a href="#172482" title="scala.collection.concurrent.MainNode[K,V]" id="172483">sn</a>: SNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; sn.<a href="#172484" title="(x: scala.collection.concurrent.MainNode[K,V])scala.collection.concurrent.MainNode[K,V]">copyTombed</a>
    <span class="keyword">case</span> _ =&gt; <a href="#172484" title="(x: scala.collection.concurrent.MainNode[K,V])scala.collection.concurrent.MainNode[K,V]" class="keyword">this</a>
  <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#10428" title="scala.collection.concurrent.CNode[K,V]" class="keyword">this</a>

  // - if the branching factor is 1 for this CNode, and the child
  //   is a tombed SNode, returns its tombed version
  // - otherwise, if there is at least one non-null node below,
  //   returns the version of this node with at least some null-inodes
  //   removed (those existing when the op began)
  // - if there are only null-i-nodes below, returns null
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(ct: scala.collection.concurrent.TrieMap[K,V], lev: Int, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.MainNode[K,V]" id="170464">toCompressed</a><span class="delimiter">(</span><a title="scala.collection.concurrent.TrieMap[K,V]" id="171915">ct</a>: <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="Int" id="171916">lev</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <a title="scala.collection.concurrent.Gen" id="171917">gen</a>: <a href="Gen.java.html#10467" title="scala.collection.concurrent.Gen">Gen</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Int" id="171918">bmp</a> = <a href="#170541" title="=&gt; Int">bitmap</a>
    <span class="keyword">var</span> <a title="Int" id="171919">i</a> = <span title="Int(0)" class="int">0</span>
    <span class="keyword">val</span> <a title="Array[scala.collection.concurrent.BasicNode]" id="171920">arr</a> = <a href="#170542" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>
    <span class="keyword">val</span> <a title="Array[scala.collection.concurrent.BasicNode]" id="171921">tmparray</a> = <span title="Array[scala.collection.concurrent.BasicNode]" class="keyword">new</span> <a href="../../Array.scala.html#292" title="Array[scala.collection.concurrent.BasicNode]">Array</a><span class="delimiter">[</span>BasicNode<span class="delimiter">]</span><span class="delimiter">(</span><a href="#171920" title="Array[scala.collection.concurrent.BasicNode]">arr</a>.<a href="../../Array.scala.html#57449" title="=&gt; Int">length</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#171919" title="Int">i</a> <a href="../../Int.scala.html#57905" title="(x: Int)Boolean">&lt;</a> <a href="#171920" title="Array[scala.collection.concurrent.BasicNode]">arr</a>.<a href="../../Array.scala.html#57449" title="=&gt; Int">length</a><span class="delimiter">)</span> <a href="#171922" title="()Unit" class="delimiter">{</a> // construct new bitmap
      <span class="keyword">val</span> <a title="scala.collection.concurrent.BasicNode" id="171927">sub</a> = <a href="../../Array.scala.html#57450" title="(i: Int)scala.collection.concurrent.BasicNode">arr</a><span class="delimiter">(</span><a href="#171919" title="Int">i</a><span class="delimiter">)</span>
      <a href="#171927" title="scala.collection.concurrent.BasicNode">sub</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="#171939" title="Unit" id="171940">in</a>: INode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
          <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="171929">inodemain</a> = in.<a href="#170175" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">gcasRead</a><span class="delimiter">(</span><a href="#171915" title="scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span>
          <a href="../../Predef.scala.html#8459" title="(assertion: Boolean)Unit">assert</a><span class="delimiter">(</span><a href="#171929" title="scala.collection.concurrent.MainNode[K,V]">inodemain</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
          <a href="../../Array.scala.html#57451" title="(i: Int, x: scala.collection.concurrent.BasicNode)Unit">tmparray</a><span class="delimiter">(</span><a href="#171919" title="Int">i</a><span class="delimiter">)</span> = <a href="#170462" title="(inode: scala.collection.concurrent.INode[K,V], inodemain: AnyRef)scala.collection.concurrent.BasicNode">resurrect</a><span class="delimiter">(</span>in, <a href="#171929" title="scala.collection.concurrent.MainNode[K,V]">inodemain</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="#171939" title="Unit" id="171941">sn</a>: SNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
          <a href="../../Array.scala.html#57451" title="(i: Int, x: scala.collection.concurrent.BasicNode)Unit">tmparray</a><span class="delimiter">(</span><a href="#171919" title="Int">i</a><span class="delimiter">)</span> = sn
      <span class="delimiter">}</span>
      <a href="#171919" title="Int">i</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
    <span class="delimiter">}</span>

    <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">new</span> <a href="#10428" title="scala.collection.concurrent.CNode[K,V]">CNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">(</span><a href="#171918" title="Int">bmp</a>, <a href="#171921" title="Array[scala.collection.concurrent.BasicNode]">tmparray</a>, <a href="#171917" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>.<a href="#170463" title="(lev: Int)scala.collection.concurrent.MainNode[K,V]">toContracted</a><span class="delimiter">(</span><a href="#171916" title="Int">lev</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span><span class="delimiter">[</span>concurrent<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(lev: Int)String" id="170465">string</a><span class="delimiter">(</span><a title="Int" id="171989">lev</a>: <a href="../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">)</span>: <span title="String">String</span> = <a href="../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;CNode %x\n%s&quot;</a>.<a href="../immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#170541" title="=&gt; Int">bitmap</a>, <a href="../../Predef.scala.html#8521" title="(xs: Array[scala.collection.concurrent.BasicNode])scala.collection.mutable.ArrayOps[scala.collection.concurrent.BasicNode]">array</a>.<a href="../TraversableLike.scala.html#58971" title="(f: scala.collection.concurrent.BasicNode =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Array[scala.collection.concurrent.BasicNode],String,Array[String]])Array[String]">map</a><a href="../../Predef.scala.html#8521" title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]" class="delimiter">(</a><a href="#172959" title="scala.collection.concurrent.BasicNode">_</a>.<a href="BasicNode.java.html#170160" title="(lev: Int)String">string</a><span class="delimiter">(</span><a href="#171989" title="Int">lev</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../TraversableOnce.scala.html#59190" title="(sep: String)String">mkString</a><span class="delimiter">(</span><span title="String(&quot;\n&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>

  /* quiescently consistent - don't call concurrently to anything involving a GCAS!! */
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="=&gt; Seq[(K, V)]" id="170466">collectElems</a>: <a href="../Seq.scala.html#5620" title="Seq[(K, V)]">Seq</a><span class="delimiter">[</span><span class="delimiter">(</span>K, V<span class="delimiter">)</span><span class="delimiter">]</span> = <a href="../../Predef.scala.html#8521" title="(xs: Array[scala.collection.concurrent.BasicNode])scala.collection.mutable.ArrayOps[scala.collection.concurrent.BasicNode]">array</a> <a href="../TraversableLike.scala.html#58976" title="(f: scala.collection.concurrent.BasicNode =&gt; scala.collection.GenTraversableOnce[(K, V)])(implicit bf: scala.collection.generic.CanBuildFrom[Array[scala.collection.concurrent.BasicNode],(K, V),Seq[(K, V)]])Seq[(K, V)]">flatMap</a> <a title="anonymous class $anonfun extends scala.runtime.AbstractFunction1[scala.collection.concurrent.BasicNode,Iterable[(K, V)]] with Serializable" id="173578" class="delimiter">{</a>
    <span class="keyword">case</span> <a href="#173698" title="Iterable[(K, V)]" id="173699">sn</a>: SNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; <a href="../../Option.scala.html#64111" title="(x: (K, V))Some[(K, V)]">Some</a><a href="#173701" title="(x: Iterable[(K, V)])Iterable[(K, V)]" class="delimiter">(</a>sn.<a href="#170560" title="=&gt; (K, V)">kvPair</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="#173698" title="Iterable[(K, V)]" id="173700">in</a>: INode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; in.<a href="#173701" title="(x: Iterable[(K, V)])Iterable[(K, V)]">mainnode</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#173687" title="Iterable[(K, V)]" id="173688">tn</a>: TNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; <a href="../../Option.scala.html#64111" title="(x: (K, V))Some[(K, V)]">Some</a><a href="#173691" title="(x: Iterable[(K, V)])Iterable[(K, V)]" class="delimiter">(</a>tn.<a href="#170689" title="=&gt; (K, V)">kvPair</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="#173687" title="Iterable[(K, V)]" id="173689">ln</a>: LNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; ln.<a href="#170730" title="=&gt; scala.collection.immutable.ListMap[K,V]">listmap</a>.<a href="#173691" title="(x: Iterable[(K, V)])Iterable[(K, V)]">toList</a>
      <span class="keyword">case</span> <a href="#173687" title="Iterable[(K, V)]" id="173690">cn</a>: CNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; cn.<a href="#173691" title="(x: Iterable[(K, V)])Iterable[(K, V)]">collectElems</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="=&gt; Seq[String]" id="170467">collectLocalElems</a>: <a href="../Seq.scala.html#5620" title="Seq[String]">Seq</a><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="../../Predef.scala.html#8521" title="(xs: Array[scala.collection.concurrent.BasicNode])scala.collection.mutable.ArrayOps[scala.collection.concurrent.BasicNode]">array</a> <a href="../TraversableLike.scala.html#58976" title="(f: scala.collection.concurrent.BasicNode =&gt; scala.collection.GenTraversableOnce[String])(implicit bf: scala.collection.generic.CanBuildFrom[Array[scala.collection.concurrent.BasicNode],String,Seq[String]])Seq[String]">flatMap</a> <a title="anonymous class $anonfun extends scala.runtime.AbstractFunction1[scala.collection.concurrent.BasicNode,Iterable[String]] with Serializable" id="174204" class="delimiter">{</a>
    <span class="keyword">case</span> <a href="#174340" title="Iterable[String]" id="174341">sn</a>: SNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; <a href="../../Option.scala.html#64111" title="(x: String)Some[String]">Some</a><a href="#174343" title="(x: Iterable[String])Iterable[String]" class="delimiter">(</a>sn.<a href="#170560" title="=&gt; (K, V)">kvPair</a>.<a href="../../Tuple2.scala.html#61508" title="=&gt; V">_2</a>.<span title="()String">toString</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="#174340" title="Iterable[String]" id="174342">in</a>: INode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; <a href="../../Option.scala.html#64111" title="(x: String)Some[String]">Some</a><a href="#174343" title="(x: Iterable[String])Iterable[String]" class="delimiter">(</a>in.<a href="../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">toString</a>.<a href="../IndexedSeqOptimized.scala.html#60121" title="(n: Int)String">drop</a><span class="delimiter">(</span><span title="Int(14)" class="int">14</span><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot;(&quot;)" class="string">&quot;(&quot;</span> <span title="(x$1: Any)String">+</span> in.<a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;)&quot;)" class="string">&quot;)&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="170468">toString</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Seq[String]" id="174384">elems</a> = <a href="#170467" title="=&gt; Seq[String]">collectLocalElems</a>
    <a href="../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;CNode(sz: %d; %s)&quot;</a>.<a href="../immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#174384" title="Seq[String]">elems</a>.<a href="../SeqLike.scala.html#59711" title="=&gt; Int">size</a>, <a href="#174384" title="Seq[String]">elems</a>.<a href="../SeqLike.scala.html#59830" title="(implicit ord: scala.math.Ordering[String])Seq[String]">sorted</a>.<a href="../TraversableOnce.scala.html#59190" title="(sep: String)String">mkString</a><span class="delimiter">(</span><span title="String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>


<span class="keyword">private</span><span class="delimiter">[</span>concurrent<span class="delimiter">]</span> <span class="keyword">object</span> <a title="scala.collection.concurrent.CNode.type" id="10429">CNode</a> <a href="#10430" title="scala.collection.concurrent.CNode.type" class="delimiter">{</a>

  <span class="keyword">def</span> <a title="[K, V](x: scala.collection.concurrent.SNode[K,V], xhc: Int, y: scala.collection.concurrent.SNode[K,V], yhc: Int, lev: Int, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.MainNode[K,V]" id="170588">dual</a><span class="delimiter">[</span><a title="" id="170591">K</a>, <a title="" id="170592">V</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="scala.collection.concurrent.SNode[K,V]" id="170593">x</a>: <a href="#10410" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="Int" id="170594">xhc</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <a title="scala.collection.concurrent.SNode[K,V]" id="170595">y</a>: <a href="#10410" title="scala.collection.concurrent.SNode[K,V]">SNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="Int" id="170596">yhc</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <a title="Int" id="170597">lev</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <a title="scala.collection.concurrent.Gen" id="170598">gen</a>: <a href="Gen.java.html#10467" title="scala.collection.concurrent.Gen">Gen</a><span class="delimiter">)</span>: <a href="MainNode.java.html#10413" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <span title="scala.collection.concurrent.MainNode[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#170597" title="Int">lev</a> <a href="../../Int.scala.html#57905" title="(x: Int)Boolean">&lt;</a> <span title="Int(35)" class="int">35</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="174454">xidx</a> = <span class="delimiter">(</span><a href="#170594" title="Int">xhc</a> <a href="../../Int.scala.html#57884" title="(x: Int)Int">&gt;&gt;&gt;</a> <a href="#170597" title="Int">lev</a><span class="delimiter">)</span> <a href="../../Int.scala.html#57938" title="(x: Int)Int">&amp;</a> <span title="Int(31)" class="int">0x1f</span>
    <span class="keyword">val</span> <a title="Int" id="174455">yidx</a> = <span class="delimiter">(</span><a href="#170596" title="Int">yhc</a> <a href="../../Int.scala.html#57884" title="(x: Int)Int">&gt;&gt;&gt;</a> <a href="#170597" title="Int">lev</a><span class="delimiter">)</span> <a href="../../Int.scala.html#57938" title="(x: Int)Int">&amp;</a> <span title="Int(31)" class="int">0x1f</span>
    <span class="keyword">val</span> <a title="Int" id="174456">bmp</a> = <span class="delimiter">(</span><span title="Int(1)" class="int">1</span> <a href="../../Int.scala.html#57882" title="(x: Int)Int">&lt;&lt;</a> <a href="#174454" title="Int">xidx</a><span class="delimiter">)</span> <a href="../../Int.scala.html#57933" title="(x: Int)Int">|</a> <span class="delimiter">(</span><span title="Int(1)" class="int">1</span> <a href="../../Int.scala.html#57882" title="(x: Int)Int">&lt;&lt;</a> <a href="#174455" title="Int">yidx</a><span class="delimiter">)</span>
    <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#174454" title="Int">xidx</a> <a href="../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> <a href="#174455" title="Int">yidx</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.concurrent.INode[K,V]" id="174489">subinode</a> = <a href="#170172" title="(g: scala.collection.concurrent.Gen)scala.collection.concurrent.INode[K,V]" class="keyword">new</a> <a href="#10422" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">(</span><a href="#170598" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>//(TrieMap.inodeupdater)
      <a href="#174489" title="scala.collection.concurrent.INode[K,V]">subinode</a>.<a href="INodeBase.java.html#170162" title="scala.collection.concurrent.MainNode[K,V]">mainnode</a> = <a href="#170588" title="(x: scala.collection.concurrent.SNode[K,V], xhc: Int, y: scala.collection.concurrent.SNode[K,V], yhc: Int, lev: Int, gen: scala.collection.concurrent.Gen)scala.collection.concurrent.MainNode[K,V]">dual</a><span class="delimiter">(</span><a href="#170593" title="scala.collection.concurrent.SNode[K,V]">x</a>, <a href="#170594" title="Int">xhc</a>, <a href="#170595" title="scala.collection.concurrent.SNode[K,V]">y</a>, <a href="#170596" title="Int">yhc</a>, <a href="#170597" title="Int">lev</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+</a> <span title="Int(5)" class="int">5</span>, <a href="#170598" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
      <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">new</span> <a href="#10428" title="scala.collection.concurrent.CNode[K,V]">CNode</a><span class="delimiter">(</span><a href="#174456" title="Int">bmp</a>, <a href="../../Array.scala.html#68728" title="(xs: scala.collection.concurrent.BasicNode*)(implicit evidence$2: scala.reflect.ArrayTag[scala.collection.concurrent.BasicNode])Array[scala.collection.concurrent.BasicNode]">Array</a><a href="../../reflect/ClassTag.scala.html#61898" title="(erasure1: Class[_])scala.reflect.ClassTag[scala.collection.concurrent.BasicNode]" class="delimiter">(</a><a href="#174489" title="scala.collection.concurrent.INode[K,V]">subinode</a><span class="delimiter">)</span>, <a href="#170598" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#174454" title="Int">xidx</a> <a href="../../Int.scala.html#57905" title="(x: Int)Boolean">&lt;</a> <a href="#174455" title="Int">yidx</a><span class="delimiter">)</span> <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">new</span> <a href="#10428" title="scala.collection.concurrent.CNode[K,V]">CNode</a><span class="delimiter">(</span><a href="#174456" title="Int">bmp</a>, <a href="../../Array.scala.html#68728" title="(xs: scala.collection.concurrent.BasicNode*)(implicit evidence$2: scala.reflect.ArrayTag[scala.collection.concurrent.BasicNode])Array[scala.collection.concurrent.BasicNode]">Array</a><a href="../../reflect/ClassTag.scala.html#61898" title="(erasure1: Class[_])scala.reflect.ClassTag[scala.collection.concurrent.BasicNode]" class="delimiter">(</a><a href="#170593" title="scala.collection.concurrent.SNode[K,V]">x</a>, <a href="#170595" title="scala.collection.concurrent.SNode[K,V]">y</a><span class="delimiter">)</span>, <a href="#170598" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
      <span class="keyword">else</span> <span title="scala.collection.concurrent.CNode[K,V]" class="keyword">new</span> <a href="#10428" title="scala.collection.concurrent.CNode[K,V]">CNode</a><span class="delimiter">(</span><a href="#174456" title="Int">bmp</a>, <a href="../../Array.scala.html#68728" title="(xs: scala.collection.concurrent.BasicNode*)(implicit evidence$2: scala.reflect.ArrayTag[scala.collection.concurrent.BasicNode])Array[scala.collection.concurrent.BasicNode]">Array</a><a href="../../reflect/ClassTag.scala.html#61898" title="(erasure1: Class[_])scala.reflect.ClassTag[scala.collection.concurrent.BasicNode]" class="delimiter">(</a><a href="#170595" title="scala.collection.concurrent.SNode[K,V]">y</a>, <a href="#170593" title="scala.collection.concurrent.SNode[K,V]">x</a><span class="delimiter">)</span>, <a href="#170598" title="scala.collection.concurrent.Gen">gen</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
    <a href="#170705" title="(k1: K, v1: V, k2: K, v2: V)scala.collection.concurrent.LNode[K,V]" class="keyword">new</a> <a href="#10383" title="scala.collection.concurrent.LNode[K,V]">LNode</a><span class="delimiter">(</span><a href="#170593" title="scala.collection.concurrent.SNode[K,V]">x</a>.<a href="#170576" title="=&gt; K">k</a>, <a href="#170593" title="scala.collection.concurrent.SNode[K,V]">x</a>.<a href="#170577" title="=&gt; V">v</a>, <a href="#170595" title="scala.collection.concurrent.SNode[K,V]">y</a>.<a href="#170576" title="=&gt; K">k</a>, <a href="#170595" title="scala.collection.concurrent.SNode[K,V]">y</a>.<a href="#170577" title="=&gt; V">v</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>


<span title="Object" class="keyword">private</span><span class="delimiter">[</span>concurrent<span class="delimiter">]</span> case <span class="keyword">class</span> <a title="class RDCSS_Descriptor[K, V] extends AnyRef with Product with Serializable" id="177387">RDCSS_Descriptor</a><span class="delimiter">[</span><a title="" id="175428">K</a>, <a title="" id="175429">V</a><span class="delimiter">]</span><a href="../../Product.scala.html#304" title="Product" class="delimiter">(</a><a title="scala.collection.concurrent.INode[K,V]" id="175492">old</a>: <a href="#10422" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.MainNode[K,V]" id="175493">expectedmain</a>: <a href="MainNode.java.html#10413" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.INode[K,V]" id="175494">nv</a>: <a href="#10422" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
  @volatile <span class="keyword">var</span> <a title="Boolean" id="174853">committed</a> = <span title="Boolean(false)" class="keyword">false</span>
<span class="delimiter">}</span>


/** A concurrent hash-trie or TrieMap is a concurrent thread-safe lock-free
 *  implementation of a hash array mapped trie. It is used to implement the
 *  concurrent map abstraction. It has particularly scalable concurrent insert
 *  and remove operations and is memory-efficient. It supports O(1), atomic,
 *  lock-free snapshots which are used to implement linearizable lock-free size,
 *  iterator and clear operations. The cost of evaluating the (lazy) snapshot is
 *  distributed across subsequent updates, thus making snapshot evaluation horizontally scalable.
 *
 *  For details, see: http://lampwww.epfl.ch/~prokopec/ctries-snapshot.pdf
 *
 *  @author Aleksandar Prokopec
 *  @since 2.10
 */
@SerialVersionUID<span class="delimiter">(</span><span class="long">0L</span> - <span class="long">6402774413839597105L</span><span class="delimiter">)</span>
<span class="keyword">final</span> <span class="keyword">class</span> <a title="class TrieMap[K, V] extends AnyRef with scala.collection.concurrent.Map[K,V] with scala.collection.mutable.MapLike[K,V,scala.collection.concurrent.TrieMap[K,V]] with scala.collection.CustomParallelizable[(K, V),scala.collection.parallel.mutable.ParTrieMap[K,V]] with Serializable" id="10416">TrieMap</a><span class="delimiter">[</span><a title="" id="10513">K</a>, <a title="" id="10514">V</a><span class="delimiter">]</span> <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">private</a> <span class="delimiter">(</span><a title="AnyRef" id="174988">r</a>: <span title="AnyRef">AnyRef</span>, <a title="java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.TrieMap[K,V],AnyRef]" id="174989">rtupd</a>: <span title="java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.TrieMap[K,V],AnyRef]">AtomicReferenceFieldUpdater</span><span class="delimiter">[</span>TrieMap<span class="delimiter">[</span>K, V<span class="delimiter">]</span>, AnyRef<span class="delimiter">]</span><span class="delimiter">)</span>
<span class="keyword">extends</span> scala.collection.concurrent.<a href="Map.scala.html#10389" title="scala.collection.concurrent.Map[K,V]">Map</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>
   <span class="keyword">with</span> scala.collection.mutable.<a href="../mutable/MapLike.scala.html#13726" title="scala.collection.mutable.MapLike[K,V,scala.collection.concurrent.TrieMap[K,V]]">MapLike</a><span class="delimiter">[</span>K, V, TrieMap<span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">]</span>
   <span class="keyword">with</span> <a href="../CustomParallelizable.scala.html#4846" title="scala.collection.CustomParallelizable[(K, V),scala.collection.parallel.mutable.ParTrieMap[K,V]]">CustomParallelizable</a><span class="delimiter">[</span><span class="delimiter">(</span>K, V<span class="delimiter">)</span>, ParTrieMap<span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">]</span>
   <span class="keyword">with</span> <a href="../../Serializable.scala.html#1369" title="Serializable">Serializable</a>
<span class="delimiter">{</span>
  <span class="keyword">import</span> <a href="#176025" title="scala.collection.concurrent.TrieMap.type">TrieMap</a>.computeHash

  <span class="keyword">private</span> <span class="keyword">var</span> <a title="java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.TrieMap[K,V],AnyRef]" id="170300">rootupdater</a> = <a href="#174989" title="java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.TrieMap[K,V],AnyRef]">rtupd</a>
  @volatile <span class="keyword">var</span> <a title="AnyRef" id="170303">root</a> = <a href="#174988" title="AnyRef">r</a>

  <span class="keyword">def</span> <a title="()scala.collection.concurrent.TrieMap[K,V]" id="170305" class="keyword">this</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="#10416" title="TrieMap.this.type" class="keyword">this</a><span class="delimiter">(</span>
    <a href="#10423" title="scala.collection.concurrent.INode.type">INode</a>.<a href="#171318" title="scala.collection.concurrent.INode[Nothing,Nothing]">newRootNode</a>,
    <span title="java.util.concurrent.atomic.AtomicReferenceFieldUpdater.type">AtomicReferenceFieldUpdater</span>.<span title="(x$1: Class[scala.collection.concurrent.TrieMap[K,V]], x$2: Class[AnyRef], x$3: String)java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.TrieMap[K,V],AnyRef]">newUpdater</span><span class="delimiter">(</span>classOf<span title="Class[scala.collection.concurrent.TrieMap[K,V]](classOf[scala.collection.concurrent.TrieMap])" class="delimiter">[</span>TrieMap<span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">]</span>, classOf<span title="Class[AnyRef](classOf[java.lang.Object])" class="delimiter">[</span>AnyRef<span class="delimiter">]</span>, <span title="String(&quot;root&quot;)" class="string">&quot;root&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">)</span>

  /* internal methods */

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(out: java.io.ObjectOutputStream)Unit" id="170306">writeObject</a><span class="delimiter">(</span><a title="java.io.ObjectOutputStream" id="175010">out</a>: java.io.<span title="java.io.ObjectOutputStream">ObjectOutputStream</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Iterator[(K, V)]" id="175123">it</a> = <a href="#170338" title="=&gt; Iterator[(K, V)]">iterator</a>
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#175123" title="Iterator[(K, V)]">it</a>.<a href="../Iterator.scala.html#65193" title="=&gt; Boolean">hasNext</a><span class="delimiter">)</span> <a href="#175124" title="()Unit" class="delimiter">{</a>
      <span class="keyword">val</span> <a href="#175142" title="(x: (K, V))(K, V)" class="delimiter">(</a><a href="../../Tuple2.scala.html#61506" title="K" id="175128">k</a>, <a href="../../Tuple2.scala.html#61508" title="V" id="175129">v</a><span class="delimiter">)</span> = <a href="#175123" title="Iterator[(K, V)]">it</a>.<a href="../Iterator.scala.html#65194" title="()(K, V)">next</a><a href="../../Tuple2.scala.html#1222" title="(K, V) @unchecked" class="delimiter">(</a><span class="delimiter">)</span>
      <a href="#175010" title="java.io.ObjectOutputStream">out</a>.<span title="(x$1: Any)Unit">writeObject</span><span class="delimiter">(</span><a href="#175128" title="K">k</a><span class="delimiter">)</span>
      <a href="#175010" title="java.io.ObjectOutputStream">out</a>.<span title="(x$1: Any)Unit">writeObject</span><span class="delimiter">(</span><a href="#175129" title="V">v</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#175010" title="java.io.ObjectOutputStream">out</a>.<span title="(x$1: Any)Unit">writeObject</span><span class="delimiter">(</span><a href="#176725" title="scala.collection.concurrent.TrieMapSerializationEnd.type">TrieMapSerializationEnd</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(in: java.io.ObjectInputStream)Unit" id="170307">readObject</a><span class="delimiter">(</span><a title="java.io.ObjectInputStream" id="175219">in</a>: java.io.<span title="java.io.ObjectInputStream">ObjectInputStream</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#170303" title="(x$1: AnyRef)Unit">root</a> = <a href="#10423" title="scala.collection.concurrent.INode.type">INode</a>.<a href="#171318" title="scala.collection.concurrent.INode[Nothing,Nothing]">newRootNode</a>
    <a href="#170300" title="(x$1: java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.TrieMap[K,V],AnyRef])Unit">rootupdater</a> = <span title="java.util.concurrent.atomic.AtomicReferenceFieldUpdater.type">AtomicReferenceFieldUpdater</span>.<span title="(x$1: Class[scala.collection.concurrent.TrieMap[K,V]], x$2: Class[AnyRef], x$3: String)java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.TrieMap[K,V],AnyRef]">newUpdater</span><span class="delimiter">(</span>classOf<span title="Class[scala.collection.concurrent.TrieMap[K,V]](classOf[scala.collection.concurrent.TrieMap])" class="delimiter">[</span>TrieMap<span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">]</span>, classOf<span title="Class[AnyRef](classOf[java.lang.Object])" class="delimiter">[</span>AnyRef<span class="delimiter">]</span>, <span title="String(&quot;root&quot;)" class="string">&quot;root&quot;</span><span class="delimiter">)</span>

    <span class="keyword">var</span> <a title="AnyRef" id="175326">obj</a>: <span title="AnyRef">AnyRef</span> = <span title="Null(null)" class="keyword">null</span>
    <a href="#175337" title="Unit" class="keyword">do</a> <span class="delimiter">{</span>
      <a href="#175326" title="AnyRef">obj</a> = <a href="#175219" title="java.io.ObjectInputStream">in</a>.<span title="()Object">readObject</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#175326" title="AnyRef">obj</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#176725" title="scala.collection.concurrent.TrieMapSerializationEnd.type">TrieMapSerializationEnd</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="K" id="175375">k</a> = <a href="#175326" title="AnyRef">obj</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="K" class="delimiter">[</span><a href="#10513" title="K">K</a><span class="delimiter">]</span>
        <span class="keyword">val</span> <a title="V" id="175376">v</a> = <a href="#175219" title="java.io.ObjectInputStream">in</a>.<span title="()Object">readObject</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="V" class="delimiter">[</span><a href="#10514" title="V">V</a><span class="delimiter">]</span>
        <a href="#170330" title="(k: K, v: V)Unit">update</a><span class="delimiter">(</span><a href="#175375" title="K">k</a>, <a href="#175376" title="V">v</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">while</span> <span class="delimiter">(</span><a href="#175326" title="AnyRef">obj</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#176725" title="scala.collection.concurrent.TrieMapSerializationEnd.type">TrieMapSerializationEnd</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  @inline <span class="keyword">final</span> <span class="keyword">def</span> <a title="(ov: AnyRef, nv: AnyRef)Boolean" id="170308">CAS_ROOT</a><span class="delimiter">(</span><a title="AnyRef" id="175387">ov</a>: <span title="AnyRef">AnyRef</span>, <a title="AnyRef" id="175388">nv</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span> = <a href="#170300" title="=&gt; java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.TrieMap[K,V],AnyRef]">rootupdater</a>.<span title="(x$1: scala.collection.concurrent.TrieMap[K,V], x$2: AnyRef, x$3: AnyRef)Boolean">compareAndSet</span><span class="delimiter">(</span><a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a>, <a href="#175387" title="AnyRef">ov</a>, <a href="#175388" title="AnyRef">nv</a><span class="delimiter">)</span>

  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(abort: Boolean)scala.collection.concurrent.INode[K,V]" id="170309">readRoot</a><span class="delimiter">(</span><a title="Boolean" id="170353">abort</a>: <a href="../../Boolean.scala.html#2218" title="Boolean">Boolean</a> = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>: <a href="#10422" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <a href="#170310" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_READ_ROOT</a><span class="delimiter">(</span><a href="#170353" title="Boolean">abort</a><span class="delimiter">)</span>

  @inline <span class="keyword">final</span> <span class="keyword">def</span> <a title="(abort: Boolean)scala.collection.concurrent.INode[K,V]" id="170310">RDCSS_READ_ROOT</a><span class="delimiter">(</span><a title="Boolean" id="175396">abort</a>: <a href="../../Boolean.scala.html#2218" title="Boolean">Boolean</a> = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>: <a href="#10422" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="AnyRef" id="175397">r</a> = /*READ*/<a href="#170303" title="=&gt; AnyRef">root</a>
    <a href="#175397" title="AnyRef">r</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#175403" title="scala.collection.concurrent.INode[K,V]" id="175404">in</a>: INode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; <a href="#175406" title="(x: scala.collection.concurrent.INode[K,V])scala.collection.concurrent.INode[K,V]">in</a>
      <span class="keyword">case</span> <a href="#175403" title="scala.collection.concurrent.INode[K,V]" id="175405">desc</a>: RDCSS_Descriptor<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; <a href="#170311" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_Complete</a><a href="#175406" title="(x: scala.collection.concurrent.INode[K,V])scala.collection.concurrent.INode[K,V]" class="delimiter">(</a><a href="#175396" title="Boolean">abort</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  @tailrec <span class="keyword">private</span> <span class="keyword">def</span> <a title="(abort: Boolean)scala.collection.concurrent.INode[K,V]" id="170311">RDCSS_Complete</a><span class="delimiter">(</span><a title="Boolean" id="175400">abort</a>: <a href="../../Boolean.scala.html#2218" title="Boolean">Boolean</a><span class="delimiter">)</span>: <a href="#10422" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="AnyRef" id="175411">v</a> = /*READ*/<a href="#170303" title="=&gt; AnyRef">root</a>
    <a href="#175411" title="AnyRef">v</a> <span class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#175479" title="scala.collection.concurrent.INode[K,V]" id="175480">in</a>: INode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt; <a href="#175482" title="(x: scala.collection.concurrent.INode[K,V])scala.collection.concurrent.INode[K,V]">in</a>
      <span class="keyword">case</span> <a href="#175479" title="scala.collection.concurrent.INode[K,V]" id="175481">desc</a>: RDCSS_Descriptor<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
        <span class="keyword">val</span> RDCSS_Descriptor<a href="#175472" title="(x: (scala.collection.concurrent.INode[K,V], scala.collection.concurrent.MainNode[K,V], scala.collection.concurrent.INode[K,V]))(scala.collection.concurrent.INode[K,V], scala.collection.concurrent.MainNode[K,V], scala.collection.concurrent.INode[K,V])" class="delimiter">(</a><a href="../../Tuple3.scala.html#61402" title="scala.collection.concurrent.INode[K,V]" id="175415">ov</a>, <a href="../../Tuple3.scala.html#61404" title="scala.collection.concurrent.MainNode[K,V]" id="175416">exp</a>, <a href="../../Tuple3.scala.html#61406" title="scala.collection.concurrent.INode[K,V]" id="175417">nv</a><span class="delimiter">)</span> = <a href="#177387" title="scala.collection.concurrent.RDCSS_Descriptor[K,V] @unchecked">desc</a>
        <span title="scala.collection.concurrent.INode[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#175400" title="Boolean">abort</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="scala.collection.concurrent.INode[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#170308" title="(ov: AnyRef, nv: AnyRef)Boolean">CAS_ROOT</a><span class="delimiter">(</span>desc, <a href="#175415" title="scala.collection.concurrent.INode[K,V]">ov</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#175415" title="scala.collection.concurrent.INode[K,V]">ov</a>
          <span class="keyword">else</span> <a href="#170311" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_Complete</a><span class="delimiter">(</span><a href="#175400" title="Boolean">abort</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="175476">oldmain</a> = <a href="#175415" title="scala.collection.concurrent.INode[K,V]">ov</a>.<a href="#170175" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">gcasRead</a><span class="delimiter">(</span><a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span>
          <span title="scala.collection.concurrent.INode[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#175476" title="scala.collection.concurrent.MainNode[K,V]">oldmain</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#175416" title="scala.collection.concurrent.MainNode[K,V]">exp</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span title="scala.collection.concurrent.INode[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#170308" title="(ov: AnyRef, nv: AnyRef)Boolean">CAS_ROOT</a><span class="delimiter">(</span>desc, <a href="#175417" title="scala.collection.concurrent.INode[K,V]">nv</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              desc.<a href="#174853" title="(x$1: Boolean)Unit">committed</a> = <span title="Boolean(true)" class="keyword">true</span>
              <a href="#175417" title="scala.collection.concurrent.INode[K,V]">nv</a>
            <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#170311" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_Complete</a><span class="delimiter">(</span><a href="#175400" title="Boolean">abort</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
            <span title="scala.collection.concurrent.INode[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#170308" title="(ov: AnyRef, nv: AnyRef)Boolean">CAS_ROOT</a><span class="delimiter">(</span>desc, <a href="#175415" title="scala.collection.concurrent.INode[K,V]">ov</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#175415" title="scala.collection.concurrent.INode[K,V]">ov</a>
            <span class="keyword">else</span> <a href="#170311" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_Complete</a><span class="delimiter">(</span><a href="#175400" title="Boolean">abort</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(ov: scala.collection.concurrent.INode[K,V], expectedmain: scala.collection.concurrent.MainNode[K,V], nv: scala.collection.concurrent.INode[K,V])Boolean" id="170312">RDCSS_ROOT</a><span class="delimiter">(</span><a title="scala.collection.concurrent.INode[K,V]" id="175487">ov</a>: <a href="#10422" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.MainNode[K,V]" id="175488">expectedmain</a>: <a href="MainNode.java.html#10413" title="scala.collection.concurrent.MainNode[K,V]">MainNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="scala.collection.concurrent.INode[K,V]" id="175489">nv</a>: <a href="#10422" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../Boolean.scala.html#2218" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.RDCSS_Descriptor[K,V]" id="175491">desc</a> = <a href="#177387" title="(old: scala.collection.concurrent.INode[K,V], expectedmain: scala.collection.concurrent.MainNode[K,V], nv: scala.collection.concurrent.INode[K,V])scala.collection.concurrent.RDCSS_Descriptor[K,V]">RDCSS_Descriptor</a><span class="delimiter">(</span><a href="#175487" title="scala.collection.concurrent.INode[K,V]">ov</a>, <a href="#175488" title="scala.collection.concurrent.MainNode[K,V]">expectedmain</a>, <a href="#175489" title="scala.collection.concurrent.INode[K,V]">nv</a><span class="delimiter">)</span>
    <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#170308" title="(ov: AnyRef, nv: AnyRef)Boolean">CAS_ROOT</a><span class="delimiter">(</span><a href="#175487" title="scala.collection.concurrent.INode[K,V]">ov</a>, <a href="#175491" title="scala.collection.concurrent.RDCSS_Descriptor[K,V]">desc</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#170311" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_Complete</a><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
      /*READ*/<a href="#175491" title="scala.collection.concurrent.RDCSS_Descriptor[K,V]">desc</a>.<a href="#174853" title="=&gt; Boolean">committed</a>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Boolean(false)" class="keyword">false</span>
  <span class="delimiter">}</span>

  @tailrec <span class="keyword">private</span> <span class="keyword">def</span> <a title="(k: K, hc: Int, v: V)Unit" id="170313">inserthc</a><span class="delimiter">(</span><a title="K" id="175506">k</a>: <a href="#10513" title="K">K</a>, <a title="Int" id="175507">hc</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <a title="V" id="175508">v</a>: <a href="#10514" title="V">V</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.INode[K,V]" id="175510">r</a> = <a href="#170310" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_READ_ROOT</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#175510" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="#170181" title="(k: K, v: V, hc: Int, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])Boolean">rec_insert</a><span class="delimiter">(</span><a href="#175506" title="K">k</a>, <a href="#175508" title="V">v</a>, <a href="#175507" title="Int">hc</a>, <span title="Int(0)" class="int">0</span>, <span title="Null(null)" class="keyword">null</span>, <a href="#175510" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a>, <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#170313" title="(k: K, hc: Int, v: V)Unit">inserthc</a><span class="delimiter">(</span><a href="#175506" title="K">k</a>, <a href="#175507" title="Int">hc</a>, <a href="#175508" title="V">v</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  @tailrec <span class="keyword">private</span> <span class="keyword">def</span> <a title="(k: K, hc: Int, v: V, cond: AnyRef)Option[V]" id="170314">insertifhc</a><span class="delimiter">(</span><a title="K" id="175520">k</a>: <a href="#10513" title="K">K</a>, <a title="Int" id="175521">hc</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <a title="V" id="175522">v</a>: <a href="#10514" title="V">V</a>, <a title="AnyRef" id="175523">cond</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span>: <a href="../../Option.scala.html#1510" title="Option[V]">Option</a><span class="delimiter">[</span>V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.INode[K,V]" id="175525">r</a> = <a href="#170310" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_READ_ROOT</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Option[V]" id="175526">ret</a> = <a href="#175525" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="#170182" title="(k: K, v: V, hc: Int, cond: AnyRef, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])Option[V]">rec_insertif</a><span class="delimiter">(</span><a href="#175520" title="K">k</a>, <a href="#175522" title="V">v</a>, <a href="#175521" title="Int">hc</a>, <a href="#175523" title="AnyRef">cond</a>, <span title="Int(0)" class="int">0</span>, <span title="Null(null)" class="keyword">null</span>, <a href="#175525" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a>, <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span>
    <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#175526" title="Option[V]">ret</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#170314" title="(k: K, hc: Int, v: V, cond: AnyRef)Option[V]">insertifhc</a><span class="delimiter">(</span><a href="#175520" title="K">k</a>, <a href="#175521" title="Int">hc</a>, <a href="#175522" title="V">v</a>, <a href="#175523" title="AnyRef">cond</a><span class="delimiter">)</span>
    <span class="keyword">else</span> <a href="#175526" title="Option[V]">ret</a>
  <span class="delimiter">}</span>

  @tailrec <span class="keyword">private</span> <span class="keyword">def</span> <a title="(k: K, hc: Int)AnyRef" id="170315">lookuphc</a><span class="delimiter">(</span><a title="K" id="175535">k</a>: <a href="#10513" title="K">K</a>, <a title="Int" id="175536">hc</a>: <a href="../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">)</span>: <span title="AnyRef">AnyRef</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.INode[K,V]" id="175538">r</a> = <a href="#170310" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_READ_ROOT</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="AnyRef" id="175539">res</a> = <a href="#175538" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="#170183" title="(k: K, hc: Int, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])AnyRef">rec_lookup</a><span class="delimiter">(</span><a href="#175535" title="K">k</a>, <a href="#175536" title="Int">hc</a>, <span title="Int(0)" class="int">0</span>, <span title="Null(null)" class="keyword">null</span>, <a href="#175538" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a>, <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span>
    <span title="AnyRef" class="keyword">if</span> <span class="delimiter">(</span><a href="#175539" title="AnyRef">res</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="INodeBase.java.html#10426" title="scala.collection.concurrent.INodeBase.type">INodeBase</a>.<a href="INodeBase.java.html#170207" title="Object">RESTART</a><span class="delimiter">)</span> <a href="#170315" title="(k: K, hc: Int)AnyRef">lookuphc</a><span class="delimiter">(</span><a href="#175535" title="K">k</a>, <a href="#175536" title="Int">hc</a><span class="delimiter">)</span>
    <span class="keyword">else</span> <a href="#175539" title="AnyRef">res</a>
  <span class="delimiter">}</span>

  /* slower:
  //@tailrec
  private def lookuphc(k: K, hc: Int): AnyRef = {
    val r = RDCSS_READ_ROOT()
    try {
      r.rec_lookup(k, hc, 0, null, r.gen, this)
    } catch {
      case RestartException =&gt;
        lookuphc(k, hc)
    }
  }
  */

  @tailrec <span class="keyword">private</span> <span class="keyword">def</span> <a title="(k: K, v: V, hc: Int)Option[V]" id="170316">removehc</a><span class="delimiter">(</span><a title="K" id="175546">k</a>: <a href="#10513" title="K">K</a>, <a title="V" id="175547">v</a>: <a href="#10514" title="V">V</a>, <a title="Int" id="175548">hc</a>: <a href="../../Int.scala.html#508" title="Int">Int</a><span class="delimiter">)</span>: <a href="../../Option.scala.html#1510" title="Option[V]">Option</a><span class="delimiter">[</span>V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.INode[K,V]" id="175550">r</a> = <a href="#170310" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_READ_ROOT</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Option[V]" id="175551">res</a> = <a href="#175550" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="#170184" title="(k: K, v: V, hc: Int, lev: Int, parent: scala.collection.concurrent.INode[K,V], startgen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])Option[V]">rec_remove</a><span class="delimiter">(</span><a href="#175546" title="K">k</a>, <a href="#175547" title="V">v</a>, <a href="#175548" title="Int">hc</a>, <span title="Int(0)" class="int">0</span>, <span title="Null(null)" class="keyword">null</span>, <a href="#175550" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="INodeBase.java.html#170163" title="scala.collection.concurrent.Gen">gen</a>, <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span>
    <span title="Option[V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#175551" title="Option[V]">res</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#175551" title="Option[V]">res</a>
    <span class="keyword">else</span> <a href="#170316" title="(k: K, v: V, hc: Int)Option[V]">removehc</a><span class="delimiter">(</span><a href="#175546" title="K">k</a>, <a href="#175547" title="V">v</a>, <a href="#175548" title="Int">hc</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; String" id="170317">string</a> = <a href="#170310" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_READ_ROOT</a><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="#170188" title="(lev: Int)String">string</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>

  /* public methods */

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; scala.collection.concurrent.TrieMap[K,V]" id="170318">seq</a> = <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; scala.collection.parallel.mutable.ParTrieMap[K,V]" id="170319">par</a> = <span title="scala.collection.parallel.mutable.ParTrieMap[K,V]" class="keyword">new</span> <a href="../parallel/mutable/ParTrieMap.scala.html#16155" title="scala.collection.parallel.mutable.ParTrieMap[K,V]">ParTrieMap</a><span class="delimiter">(</span><a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; scala.collection.concurrent.TrieMap[K,V]" id="170320">empty</a>: <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <a href="#170305" title="()scala.collection.concurrent.TrieMap[K,V]" class="keyword">new</a> <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>

  <span class="keyword">final</span> <span class="keyword">def</span> <a title="=&gt; Boolean" id="170321">isReadOnly</a> = <a href="#170300" title="=&gt; java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.TrieMap[K,V],AnyRef]">rootupdater</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span>

  <span class="keyword">final</span> <span class="keyword">def</span> <a title="=&gt; Boolean" id="170322">nonReadOnly</a> = <a href="#170300" title="=&gt; java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.TrieMap[K,V],AnyRef]">rootupdater</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span>

  /** Returns a snapshot of this TrieMap.
   *  This operation is lock-free and linearizable.
   *
   *  The snapshot is lazily updated - the first time some branch
   *  in the snapshot or this TrieMap are accessed, they are rewritten.
   *  This means that the work of rebuilding both the snapshot and this
   *  TrieMap is distributed across all the threads doing updates or accesses
   *  subsequent to the snapshot creation.
   */
  @tailrec <span class="keyword">final</span> <span class="keyword">def</span> <a title="()scala.collection.concurrent.TrieMap[K,V]" id="170323">snapshot</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.INode[K,V]" id="175676">r</a> = <a href="#170310" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_READ_ROOT</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="175677">expmain</a> = <a href="#175676" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="#170175" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">gcasRead</a><span class="delimiter">(</span><a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span>
    <span title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#170312" title="(ov: scala.collection.concurrent.INode[K,V], expectedmain: scala.collection.concurrent.MainNode[K,V], nv: scala.collection.concurrent.INode[K,V])Boolean">RDCSS_ROOT</a><span class="delimiter">(</span><a href="#175676" title="scala.collection.concurrent.INode[K,V]">r</a>, <a href="#175677" title="scala.collection.concurrent.MainNode[K,V]">expmain</a>, <a href="#175676" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="#170180" title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.INode[K,V]">copyToGen</a><span class="delimiter">(</span><span title="scala.collection.concurrent.Gen" class="keyword">new</span> <a href="Gen.java.html#10467" title="scala.collection.concurrent.Gen">Gen</a>, <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">new</span> <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">(</span><a href="#175676" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="#170180" title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.INode[K,V]">copyToGen</a><span class="delimiter">(</span><span title="scala.collection.concurrent.Gen" class="keyword">new</span> <a href="Gen.java.html#10467" title="scala.collection.concurrent.Gen">Gen</a>, <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span>, <a href="#170300" title="=&gt; java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.TrieMap[K,V],AnyRef]">rootupdater</a><span class="delimiter">)</span>
    <span class="keyword">else</span> <a href="#170323" title="()scala.collection.concurrent.TrieMap[K,V]">snapshot</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  /** Returns a read-only snapshot of this TrieMap.
   *  This operation is lock-free and linearizable.
   *
   *  The snapshot is lazily updated - the first time some branch
   *  of this TrieMap are accessed, it is rewritten. The work of creating
   *  the snapshot is thus distributed across subsequent updates
   *  and accesses on this TrieMap by all threads.
   *  Note that the snapshot itself is never rewritten unlike when calling
   *  the `snapshot` method, but the obtained snapshot cannot be modified.
   *
   *  This method is used by other methods such as `size` and `iterator`.
   */
  @tailrec <span class="keyword">final</span> <span class="keyword">def</span> <a title="()scala.collection.Map[K,V]" id="170324">readOnlySnapshot</a><span class="delimiter">(</span><span class="delimiter">)</span>: collection.<a href="../Map.scala.html#4804" title="scala.collection.Map[K,V]">Map</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.INode[K,V]" id="175690">r</a> = <a href="#170310" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_READ_ROOT</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.MainNode[K,V]" id="175691">expmain</a> = <a href="#175690" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="#170175" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">gcasRead</a><span class="delimiter">(</span><a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span>
    <span title="scala.collection.Map[K,V]" class="keyword">if</span> <span class="delimiter">(</span><a href="#170312" title="(ov: scala.collection.concurrent.INode[K,V], expectedmain: scala.collection.concurrent.MainNode[K,V], nv: scala.collection.concurrent.INode[K,V])Boolean">RDCSS_ROOT</a><span class="delimiter">(</span><a href="#175690" title="scala.collection.concurrent.INode[K,V]">r</a>, <a href="#175691" title="scala.collection.concurrent.MainNode[K,V]">expmain</a>, <a href="#175690" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="#170180" title="(ngen: scala.collection.concurrent.Gen, ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.INode[K,V]">copyToGen</a><span class="delimiter">(</span><span title="scala.collection.concurrent.Gen" class="keyword">new</span> <a href="Gen.java.html#10467" title="scala.collection.concurrent.Gen">Gen</a>, <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="scala.collection.concurrent.TrieMap[K,Nothing]" class="keyword">new</span> <a href="#10416" title="scala.collection.concurrent.TrieMap[K,Nothing]">TrieMap</a><span class="delimiter">(</span><a href="#175690" title="scala.collection.concurrent.INode[K,V]">r</a>, <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
    <span class="keyword">else</span> <a href="#170324" title="()scala.collection.Map[K,V]">readOnlySnapshot</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  @tailrec <span class="keyword">final</span> <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="170325">clear</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.INode[K,V]" id="175720">r</a> = <a href="#170310" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_READ_ROOT</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#170312" title="(ov: scala.collection.concurrent.INode[K,V], expectedmain: scala.collection.concurrent.MainNode[K,V], nv: scala.collection.concurrent.INode[K,V])Boolean">RDCSS_ROOT</a><span class="delimiter">(</span><a href="#175720" title="scala.collection.concurrent.INode[K,V]">r</a>, <a href="#175720" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="#170175" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">gcasRead</a><span class="delimiter">(</span><a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span>, <a href="#10423" title="scala.collection.concurrent.INode.type">INode</a>.<a href="#171318" title="[K, V]=&gt; scala.collection.concurrent.INode[K,V]">newRootNode</a><span title="scala.collection.concurrent.INode[K,V]" class="delimiter">[</span><a href="#10513" title="K">K</a>, <a href="#10514" title="V">V</a><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#170325" title="()Unit">clear</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(k: K)V" id="170326">lookup</a><span class="delimiter">(</span><a title="K" id="175722">k</a>: <a href="#10513" title="K">K</a><span class="delimiter">)</span>: <a href="#10514" title="V">V</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="175724">hc</a> = <a href="#172336" title="(k: K)Int">computeHash</a><span class="delimiter">(</span><a href="#175722" title="K">k</a><span class="delimiter">)</span>
    <a href="#170315" title="(k: K, hc: Int)AnyRef">lookuphc</a><span class="delimiter">(</span><a href="#175722" title="K">k</a>, <a href="#175724" title="Int">hc</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="V" class="delimiter">[</span><a href="#10514" title="V">V</a><span class="delimiter">]</span>
  <span class="delimiter">}</span>

  <span class="keyword">final</span> <span class="keyword">override</span> <span class="keyword">def</span> <a title="(k: K)V" id="170327">apply</a><span class="delimiter">(</span><a title="K" id="175728">k</a>: <a href="#10513" title="K">K</a><span class="delimiter">)</span>: <a href="#10514" title="V">V</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="175734">hc</a> = <a href="#172336" title="(k: K)Int">computeHash</a><span class="delimiter">(</span><a href="#175728" title="K">k</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="AnyRef" id="175735">res</a> = <a href="#170315" title="(k: K, hc: Int)AnyRef">lookuphc</a><span class="delimiter">(</span><a href="#175728" title="K">k</a>, <a href="#175734" title="Int">hc</a><span class="delimiter">)</span>
    <span title="V" class="keyword">if</span> <span class="delimiter">(</span><a href="#175735" title="AnyRef">res</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span title="Nothing" class="keyword">throw</span> <span title="java.util.NoSuchElementException" class="keyword">new</span> <a href="../../package.scala.html#56968" title="java.util.NoSuchElementException">NoSuchElementException</a>
    <span class="keyword">else</span> <a href="#175735" title="AnyRef">res</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="V" class="delimiter">[</span><a href="#10514" title="V">V</a><span class="delimiter">]</span>
  <span class="delimiter">}</span>

  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(k: K)Option[V]" id="170328">get</a><span class="delimiter">(</span><a title="K" id="175741">k</a>: <a href="#10513" title="K">K</a><span class="delimiter">)</span>: <a href="../../Option.scala.html#1510" title="Option[V]">Option</a><span class="delimiter">[</span>V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="175746">hc</a> = <a href="#172336" title="(k: K)Int">computeHash</a><span class="delimiter">(</span><a href="#175741" title="K">k</a><span class="delimiter">)</span>
    <a href="../../Option.scala.html#88862" title="(x: AnyRef)Option[AnyRef]">Option</a><span class="delimiter">(</span><a href="#170315" title="(k: K, hc: Int)AnyRef">lookuphc</a><span class="delimiter">(</span><a href="#175741" title="K">k</a>, <a href="#175746" title="Int">hc</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Option[V]" class="delimiter">[</span><a href="../../Option.scala.html#1510" title="Option[V]">Option</a><span class="delimiter">[</span>V<span class="delimiter">]</span><span class="delimiter">]</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(key: K, value: V)Option[V]" id="170329">put</a><span class="delimiter">(</span><a title="K" id="175753">key</a>: <a href="#10513" title="K">K</a>, <a title="V" id="175754">value</a>: <a href="#10514" title="V">V</a><span class="delimiter">)</span>: <a href="../../Option.scala.html#1510" title="Option[V]">Option</a><span class="delimiter">[</span>V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="175761">hc</a> = <a href="#172336" title="(k: K)Int">computeHash</a><span class="delimiter">(</span><a href="#175753" title="K">key</a><span class="delimiter">)</span>
    <a href="#170314" title="(k: K, hc: Int, v: V, cond: AnyRef)Option[V]">insertifhc</a><span class="delimiter">(</span><a href="#175753" title="K">key</a>, <a href="#175761" title="Int">hc</a>, <a href="#175754" title="V">value</a>, <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">final</span> <span class="keyword">override</span> <span class="keyword">def</span> <a title="(k: K, v: V)Unit" id="170330">update</a><span class="delimiter">(</span><a title="K" id="175377">k</a>: <a href="#10513" title="K">K</a>, <a title="V" id="175378">v</a>: <a href="#10514" title="V">V</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="175765">hc</a> = <a href="#172336" title="(k: K)Int">computeHash</a><span class="delimiter">(</span><a href="#175377" title="K">k</a><span class="delimiter">)</span>
    <a href="#170313" title="(k: K, hc: Int, v: V)Unit">inserthc</a><span class="delimiter">(</span><a href="#175377" title="K">k</a>, <a href="#175765" title="Int">hc</a>, <a href="#175378" title="V">v</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(kv: (K, V))TrieMap.this.type" id="170331">+=</a><span class="delimiter">(</span><a title="(K, V)" id="175769">kv</a>: <a href="../../Tuple2.scala.html#1222" title="(K, V)" class="delimiter">(</a>K, V<span class="delimiter">)</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#170330" title="(k: K, v: V)Unit">update</a><span class="delimiter">(</span><a href="#175769" title="(K, V)">kv</a>.<a href="../../Tuple2.scala.html#61506" title="=&gt; K">_1</a>, <a href="#175769" title="(K, V)">kv</a>.<a href="../../Tuple2.scala.html#61508" title="=&gt; V">_2</a><span class="delimiter">)</span>
    <a href="#10416" title="TrieMap.this.type" class="keyword">this</a>
  <span class="delimiter">}</span>

  <span class="keyword">final</span> <span class="keyword">override</span> <span class="keyword">def</span> <a title="(k: K)Option[V]" id="170332">remove</a><span class="delimiter">(</span><a title="K" id="175794">k</a>: <a href="#10513" title="K">K</a><span class="delimiter">)</span>: <a href="../../Option.scala.html#1510" title="Option[V]">Option</a><span class="delimiter">[</span>V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="175803">hc</a> = <a href="#172336" title="(k: K)Int">computeHash</a><span class="delimiter">(</span><a href="#175794" title="K">k</a><span class="delimiter">)</span>
    <a href="#170316" title="(k: K, v: V, hc: Int)Option[V]">removehc</a><span class="delimiter">(</span><a href="#175794" title="K">k</a>, <span title="Null(null)" class="keyword">null</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="V" class="delimiter">[</span><a href="#10514" title="V">V</a><span class="delimiter">]</span>, <a href="#175803" title="Int">hc</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(k: K)TrieMap.this.type" id="170333">-=</a><span class="delimiter">(</span><a title="K" id="175807">k</a>: <a href="#10513" title="K">K</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#170332" title="(k: K)Option[V]">remove</a><span class="delimiter">(</span><a href="#175807" title="K">k</a><span class="delimiter">)</span>
    <a href="#10416" title="TrieMap.this.type" class="keyword">this</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(k: K, v: V)Option[V]" id="170334">putIfAbsent</a><span class="delimiter">(</span><a title="K" id="175858">k</a>: <a href="#10513" title="K">K</a>, <a title="V" id="175859">v</a>: <a href="#10514" title="V">V</a><span class="delimiter">)</span>: <a href="../../Option.scala.html#1510" title="Option[V]">Option</a><span class="delimiter">[</span>V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="175863">hc</a> = <a href="#172336" title="(k: K)Int">computeHash</a><span class="delimiter">(</span><a href="#175858" title="K">k</a><span class="delimiter">)</span>
    <a href="#170314" title="(k: K, hc: Int, v: V, cond: AnyRef)Option[V]">insertifhc</a><span class="delimiter">(</span><a href="#175858" title="K">k</a>, <a href="#175863" title="Int">hc</a>, <a href="#175859" title="V">v</a>, <a href="#10423" title="scala.collection.concurrent.INode.type">INode</a>.<a href="#171316" title="=&gt; Object">KEY_ABSENT</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(k: K, v: V)Boolean" id="170335">remove</a><span class="delimiter">(</span><a title="K" id="175844">k</a>: <a href="#10513" title="K">K</a>, <a title="V" id="175845">v</a>: <a href="#10514" title="V">V</a><span class="delimiter">)</span>: <a href="../../Boolean.scala.html#2218" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="175867">hc</a> = <a href="#172336" title="(k: K)Int">computeHash</a><span class="delimiter">(</span><a href="#175844" title="K">k</a><span class="delimiter">)</span>
    <a href="#170316" title="(k: K, v: V, hc: Int)Option[V]">removehc</a><span class="delimiter">(</span><a href="#175844" title="K">k</a>, <a href="#175845" title="V">v</a>, <a href="#175867" title="Int">hc</a><span class="delimiter">)</span>.<a href="../../Option.scala.html#63834" title="=&gt; Boolean">nonEmpty</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(k: K, oldvalue: V, newvalue: V)Boolean" id="170336">replace</a><span class="delimiter">(</span><a title="K" id="175871">k</a>: <a href="#10513" title="K">K</a>, <a title="V" id="175872">oldvalue</a>: <a href="#10514" title="V">V</a>, <a title="V" id="175873">newvalue</a>: <a href="#10514" title="V">V</a><span class="delimiter">)</span>: <a href="../../Boolean.scala.html#2218" title="Boolean">Boolean</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="175881">hc</a> = <a href="#172336" title="(k: K)Int">computeHash</a><span class="delimiter">(</span><a href="#175871" title="K">k</a><span class="delimiter">)</span>
    <a href="#170314" title="(k: K, hc: Int, v: V, cond: AnyRef)Option[V]">insertifhc</a><span class="delimiter">(</span><a href="#175871" title="K">k</a>, <a href="#175881" title="Int">hc</a>, <a href="#175873" title="V">newvalue</a>, <a href="#175872" title="V">oldvalue</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="AnyRef" class="delimiter">[</span><span title="AnyRef">AnyRef</span><span class="delimiter">]</span><span class="delimiter">)</span>.<a href="../../Option.scala.html#63834" title="=&gt; Boolean">nonEmpty</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(k: K, v: V)Option[V]" id="170337">replace</a><span class="delimiter">(</span><a title="K" id="175885">k</a>: <a href="#10513" title="K">K</a>, <a title="V" id="175886">v</a>: <a href="#10514" title="V">V</a><span class="delimiter">)</span>: <a href="../../Option.scala.html#1510" title="Option[V]">Option</a><span class="delimiter">[</span>V<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="175889">hc</a> = <a href="#172336" title="(k: K)Int">computeHash</a><span class="delimiter">(</span><a href="#175885" title="K">k</a><span class="delimiter">)</span>
    <a href="#170314" title="(k: K, hc: Int, v: V, cond: AnyRef)Option[V]">insertifhc</a><span class="delimiter">(</span><a href="#175885" title="K">k</a>, <a href="#175889" title="Int">hc</a>, <a href="#175886" title="V">v</a>, <a href="#10423" title="scala.collection.concurrent.INode.type">INode</a>.<a href="#171314" title="=&gt; Object">KEY_PRESENT</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; Iterator[(K, V)]" id="170338">iterator</a>: <a href="../Iterator.scala.html#5383" title="Iterator[(K, V)]">Iterator</a><span class="delimiter">[</span><span class="delimiter">(</span>K, V<span class="delimiter">)</span><span class="delimiter">]</span> =
    <span title="Iterator[(K, V)]" class="keyword">if</span> <span class="delimiter">(</span><a href="#170322" title="=&gt; Boolean">nonReadOnly</a><span class="delimiter">)</span> <a href="#170324" title="()scala.collection.Map[K,V]">readOnlySnapshot</a><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="../MapLike.scala.html#78411" title="=&gt; Iterator[(K, V)]">iterator</a>
    <span class="keyword">else</span> <a href="#175941" title="scala.collection.concurrent.TrieMapIterator[K,V]" class="keyword">new</a> <a href="#10432" title="scala.collection.concurrent.TrieMapIterator[K,V]">TrieMapIterator</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Int" id="170339">cachedSize</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.concurrent.INode[K,V]" id="175964">r</a> = <a href="#170310" title="(abort: Boolean)scala.collection.concurrent.INode[K,V]">RDCSS_READ_ROOT</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#175964" title="scala.collection.concurrent.INode[K,V]">r</a>.<a href="#170187" title="(ct: scala.collection.concurrent.TrieMap[K,V])Int">cachedSize</a><span class="delimiter">(</span><a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]" class="keyword">this</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Int" id="170340">size</a>: <a href="../../Int.scala.html#508" title="Int">Int</a> =
    <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#170322" title="=&gt; Boolean">nonReadOnly</a><span class="delimiter">)</span> <a href="#170324" title="()scala.collection.Map[K,V]">readOnlySnapshot</a><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="../TraversableOnce.scala.html#59101" title="=&gt; Int">size</a>
    <span class="keyword">else</span> <a href="#170339" title="()Int">cachedSize</a><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; String" id="170341">stringPrefix</a> = <span title="String(&quot;TrieMap&quot;)" class="string">&quot;TrieMap&quot;</span>

<span class="delimiter">}</span>


<span class="keyword">object</span> <a title="scala.collection.concurrent.TrieMap.type" id="176025">TrieMap</a> <a href="#10418" title="scala.collection.concurrent.TrieMap.type" class="keyword">extends</a> <a href="../generic/MutableMapFactory.scala.html#11025" title="scala.collection.generic.MutableMapFactory[scala.collection.concurrent.TrieMap]">MutableMapFactory</a><span class="delimiter">[</span>TrieMap<span class="delimiter">]</span> <span class="delimiter">{</span>
  <span class="keyword">val</span> <a title="java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.INodeBase[_, _],scala.collection.concurrent.MainNode[_, _]]" id="172324">inodeupdater</a> = <span title="java.util.concurrent.atomic.AtomicReferenceFieldUpdater.type">AtomicReferenceFieldUpdater</span>.<span title="(x$1: Class[scala.collection.concurrent.INodeBase[_, _]], x$2: Class[scala.collection.concurrent.MainNode[_, _]], x$3: String)java.util.concurrent.atomic.AtomicReferenceFieldUpdater[scala.collection.concurrent.INodeBase[_, _],scala.collection.concurrent.MainNode[_, _]]">newUpdater</span><span class="delimiter">(</span>classOf<span title="Class[scala.collection.concurrent.INodeBase[_, _]](classOf[scala.collection.concurrent.INodeBase])" class="delimiter">[</span>INodeBase<span class="delimiter">[</span>_, _<span class="delimiter">]</span><span class="delimiter">]</span>, classOf<span title="Class[scala.collection.concurrent.MainNode[_, _]](classOf[scala.collection.concurrent.MainNode])" class="delimiter">[</span>MainNode<span class="delimiter">[</span>_, _<span class="delimiter">]</span><span class="delimiter">]</span>, <span title="String(&quot;mainnode&quot;)" class="string">&quot;mainnode&quot;</span><span class="delimiter">)</span>

  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="[K, V]=&gt; scala.collection.generic.CanBuildFrom[scala.collection.concurrent.TrieMap.Coll,(K, V),scala.collection.concurrent.TrieMap[K,V]]" id="172326">canBuildFrom</a><span class="delimiter">[</span><a title="" id="172329">K</a>, <a title="" id="172330">V</a><span class="delimiter">]</span>: <a href="../generic/CanBuildFrom.scala.html#11076" title="scala.collection.generic.CanBuildFrom[scala.collection.concurrent.TrieMap.Coll,(K, V),scala.collection.concurrent.TrieMap[K,V]]">CanBuildFrom</a><span class="delimiter">[</span>Coll, <span class="delimiter">(</span>K, V<span class="delimiter">)</span>, TrieMap<span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">]</span> = <span title="scala.collection.concurrent.TrieMap.MapCanBuildFrom[K,V]" class="keyword">new</span> <a href="../generic/GenMapFactory.scala.html#61664" title="scala.collection.concurrent.TrieMap.MapCanBuildFrom[K,V]">MapCanBuildFrom</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="[K, V]=&gt; scala.collection.concurrent.TrieMap[K,V]" id="172331">empty</a><span class="delimiter">[</span><a title="" id="172334">K</a>, <a title="" id="172335">V</a><span class="delimiter">]</span>: <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <a href="#170305" title="()scala.collection.concurrent.TrieMap[K,V]" class="keyword">new</a> <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>

  @inline <span class="keyword">final</span> <span class="keyword">def</span> <a title="[K](k: K)Int" id="172336">computeHash</a><span class="delimiter">[</span><a title="" id="172338">K</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="K" id="172339">k</a>: <a href="#172338" title="K">K</a><span class="delimiter">)</span>: <a href="../../Int.scala.html#508" title="Int">Int</a> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Int" id="176016">hcode</a> = <a href="#172339" title="K">k</a>.<span title="()Int">hashCode</span>
    <a href="#176016" title="Int">hcode</a> = <a href="#176016" title="Int">hcode</a> <a href="../../Int.scala.html#57962" title="(x: Int)Int">*</a> <span title="Int(-1640532531)" class="int">0x9e3775cd</span>
    <a href="#176016" title="Int">hcode</a> = java.lang.<span title="Integer.type">Integer</span>.<span title="(x$1: Int)Int">reverseBytes</span><span class="delimiter">(</span><a href="#176016" title="Int">hcode</a><span class="delimiter">)</span>
    <a href="#176016" title="Int">hcode</a> <a href="../../Int.scala.html#57962" title="(x: Int)Int">*</a> <span title="Int(-1640532531)" class="int">0x9e3775cd</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>


<span class="keyword">private</span><span class="delimiter">[</span>collection<span class="delimiter">]</span> <span class="keyword">class</span> <a title="class TrieMapIterator[K, V] extends AnyRef with Iterator[(K, V)]" id="10432">TrieMapIterator</a><span class="delimiter">[</span><a title="" id="175944">K</a>, <a title="" id="175945">V</a><span class="delimiter">]</span><a href="#10432" title="scala.collection.concurrent.TrieMapIterator[K,V]" class="delimiter">(</a><span class="keyword">var</span> <a title="Int" id="175937">level</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <span class="keyword">private</span> <span class="keyword">var</span> <a title="scala.collection.concurrent.TrieMap[K,V]" id="175938">ct</a>: <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="Boolean" id="175941">mustInit</a>: <a href="../../Boolean.scala.html#2218" title="Boolean">Boolean</a> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../Iterator.scala.html#5383" title="Iterator[(K, V)]">Iterator</a><span class="delimiter">[</span><span class="delimiter">(</span>K, V<span class="delimiter">)</span><span class="delimiter">]</span> <span class="delimiter">{</span>
  <span class="keyword">var</span> <a title="Array[Array[scala.collection.concurrent.BasicNode]]" id="175911">stack</a> = <span title="Array[Array[scala.collection.concurrent.BasicNode]]" class="keyword">new</span> <a href="../../Array.scala.html#292" title="Array[Array[scala.collection.concurrent.BasicNode]]">Array</a><span class="delimiter">[</span>Array<span class="delimiter">[</span>BasicNode<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span title="Int(7)" class="int">7</span><span class="delimiter">)</span>
  <span class="keyword">var</span> <a title="Array[Int]" id="175914">stackpos</a> = <span title="Array[Int]" class="keyword">new</span> <a href="../../Array.scala.html#292" title="Array[Int]">Array</a><span class="delimiter">[</span>Int<span class="delimiter">]</span><span class="delimiter">(</span><span title="Int(7)" class="int">7</span><span class="delimiter">)</span>
  <span class="keyword">var</span> <a title="Int" id="175917">depth</a> = -<span title="Int(-1)" class="int">1</span>
  <span class="keyword">var</span> <a title="Iterator[(K, V)]" id="175920">subiter</a>: <a href="../Iterator.scala.html#5383" title="Iterator[(K, V)]">Iterator</a><span class="delimiter">[</span><span class="delimiter">(</span>K, V<span class="delimiter">)</span><span class="delimiter">]</span> = <span title="Null(null)" class="keyword">null</span>
  <span class="keyword">var</span> <a title="scala.collection.concurrent.KVNode[K,V]" id="175923">current</a>: <a href="#10437" title="scala.collection.concurrent.KVNode[K,V]">KVNode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span> = <span title="Null(null)" class="keyword">null</span>

  <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#175941" title="Boolean">mustInit</a><span class="delimiter">)</span> <a href="#175929" title="()Unit">initialize</a><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="=&gt; Boolean" id="175925">hasNext</a> = <span class="delimiter">(</span><a href="#175923" title="=&gt; scala.collection.concurrent.KVNode[K,V]">current</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="../../Boolean.scala.html#58724" title="(x: Boolean)Boolean">||</a> <span class="delimiter">(</span><a href="#175920" title="=&gt; Iterator[(K, V)]">subiter</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="()(K, V)" id="175926">next</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span title="(K, V)" class="keyword">if</span> <span class="delimiter">(</span><a href="#175925" title="=&gt; Boolean">hasNext</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="(K, V)" id="176043">r</a>: <a href="../../Tuple2.scala.html#1222" title="(K, V)" class="delimiter">(</a>K, V<span class="delimiter">)</span> = <span title="Null(null)" class="keyword">null</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#175920" title="=&gt; Iterator[(K, V)]">subiter</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#176043" title="(K, V)">r</a> = <a href="#175920" title="=&gt; Iterator[(K, V)]">subiter</a>.<a href="../Iterator.scala.html#65194" title="()(K, V)">next</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#175928" title="()Unit">checkSubiter</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#176043" title="(K, V)">r</a> = <a href="#175923" title="=&gt; scala.collection.concurrent.KVNode[K,V]">current</a>.<a href="#170562" title="=&gt; (K, V)">kvPair</a>
      <a href="#175930" title="()Unit">advance</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#176043" title="(K, V)">r</a>
  <span class="delimiter">}</span> <span class="keyword">else</span> <a href="../Iterator.scala.html#5384" title="scala.collection.Iterator.type">Iterator</a>.<a href="../Iterator.scala.html#89020" title="=&gt; Iterator[Nothing]">empty</a>.<a href="../Iterator.scala.html#65194" title="()Nothing">next</a><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(in: scala.collection.concurrent.INode[K,V])Unit" id="175927">readin</a><span class="delimiter">(</span><a title="scala.collection.concurrent.INode[K,V]" id="176047">in</a>: <a href="#10422" title="scala.collection.concurrent.INode[K,V]">INode</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#176047" title="scala.collection.concurrent.INode[K,V]">in</a>.<a href="#170175" title="(ct: scala.collection.concurrent.TrieMap[K,V])scala.collection.concurrent.MainNode[K,V]">gcasRead</a><a href="#176068" title="scala.collection.concurrent.CNode[K,V]" class="delimiter">(</a><a href="#175938" title="=&gt; scala.collection.concurrent.TrieMap[K,V]">ct</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a href="#176065" title="Unit" id="176068">cn</a>: CNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
      <a href="#175917" title="(x$1: Int)Unit">depth</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
      <a href="../../Array.scala.html#57451" title="(i: Int, x: Array[scala.collection.concurrent.BasicNode])Unit">stack</a><span class="delimiter">(</span><a href="#175917" title="=&gt; Int">depth</a><span class="delimiter">)</span> = cn.<a href="#170542" title="=&gt; Array[scala.collection.concurrent.BasicNode]">array</a>
      <a href="../../Array.scala.html#57451" title="(i: Int, x: Int)Unit">stackpos</a><span class="delimiter">(</span><a href="#175917" title="=&gt; Int">depth</a><span class="delimiter">)</span> = -<span title="Int(-1)" class="int">1</span>
      <a href="#175930" title="()Unit">advance</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="#176065" title="Unit" id="176069">tn</a>: TNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
      <a href="#175923" title="(x$1: scala.collection.concurrent.KVNode[K,V])Unit">current</a> = tn
    <span class="keyword">case</span> <a href="#176065" title="Unit" id="176070">ln</a>: LNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
      <a href="#175920" title="(x$1: Iterator[(K, V)])Unit">subiter</a> = ln.<a href="#170730" title="=&gt; scala.collection.immutable.ListMap[K,V]">listmap</a>.<a href="../immutable/ListMap.scala.html#170753" title="=&gt; Iterator[(K, V)]">iterator</a>
      <a href="#175928" title="()Unit">checkSubiter</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <a href="#176065" title="Unit" id="176071" class="keyword">null</a> =&gt;
      <a href="#175923" title="(x$1: scala.collection.concurrent.KVNode[K,V])Unit">current</a> = <span title="Null(null)" class="keyword">null</span>
  <span class="delimiter">}</span>

  @inline <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="175928">checkSubiter</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#58721" title="=&gt; Boolean">!</a><a href="#175920" title="=&gt; Iterator[(K, V)]">subiter</a>.<a href="../Iterator.scala.html#65193" title="=&gt; Boolean">hasNext</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#175920" title="(x$1: Iterator[(K, V)])Unit">subiter</a> = <span title="Null(null)" class="keyword">null</span>
    <a href="#175930" title="()Unit">advance</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  @inline <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="175929">initialize</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="../../Predef.scala.html#8459" title="(assertion: Boolean)Unit">assert</a><span class="delimiter">(</span><a href="#175938" title="=&gt; scala.collection.concurrent.TrieMap[K,V]">ct</a>.<a href="#170321" title="=&gt; Boolean">isReadOnly</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="scala.collection.concurrent.INode[K,V]" id="176082">r</a> = <a href="#175938" title="scala.collection.concurrent.TrieMap[K,V]" id="176085">ct</a>.<a href="#175396" title="Boolean" id="176086">RDCSS_READ_ROOT</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#175927" title="(in: scala.collection.concurrent.INode[K,V])Unit">readin</a><span class="delimiter">(</span><a href="#176082" title="scala.collection.concurrent.INode[K,V]">r</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="175930">advance</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../../Unit.scala.html#2389" title="Unit">Unit</a> = <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#175917" title="=&gt; Int">depth</a> <a href="../../Int.scala.html#57926" title="(x: Int)Boolean">&gt;=</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="176091">npos</a> = <a href="../../Array.scala.html#57450" title="(i: Int)Int">stackpos</a><span class="delimiter">(</span><a href="#175917" title="=&gt; Int">depth</a><span class="delimiter">)</span> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+</a> <span title="Int(1)" class="int">1</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#176091" title="Int">npos</a> <a href="../../Int.scala.html#57905" title="(x: Int)Boolean">&lt;</a> <a href="../../Array.scala.html#57450" title="(i: Int)Array[scala.collection.concurrent.BasicNode]">stack</a><span class="delimiter">(</span><a href="#175917" title="=&gt; Int">depth</a><span class="delimiter">)</span>.<a href="../../Array.scala.html#57449" title="=&gt; Int">length</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../Array.scala.html#57451" title="(i: Int, x: Int)Unit">stackpos</a><span class="delimiter">(</span><a href="#175917" title="=&gt; Int">depth</a><span class="delimiter">)</span> = <a href="#176091" title="Int">npos</a>
      <a href="../../Array.scala.html#57450" title="(i: Int)Array[scala.collection.concurrent.BasicNode]">stack</a><a href="../../Array.scala.html#57450" title="(i: Int)scala.collection.concurrent.BasicNode" class="delimiter">(</a><a href="#175917" title="=&gt; Int">depth</a><span class="delimiter">)</span><a href="#176104" title="scala.collection.concurrent.SNode[K,V]" class="delimiter">(</a><a href="#176091" title="Int">npos</a><span class="delimiter">)</span> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="#176103" title="Unit" id="176104">sn</a>: SNode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
          <a href="#175923" title="(x$1: scala.collection.concurrent.KVNode[K,V])Unit">current</a> = sn
        <span class="keyword">case</span> <a href="#176103" title="Unit" id="176105">in</a>: INode<span class="delimiter">[</span>K, V<span class="delimiter">]</span> =&gt;
          <a href="#175927" title="(in: scala.collection.concurrent.INode[K,V])Unit">readin</a><a href="#176106" title="(x: Unit)Unit" class="delimiter">(</a>in<span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#175917" title="(x$1: Int)Unit">depth</a> <a href="../../Int.scala.html#57955" title="(x: Int)Int">-=</a> <span title="Int(1)" class="int">1</span>
      <a href="#175930" title="()Unit">advance</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#175923" title="(x$1: scala.collection.concurrent.KVNode[K,V])Unit">current</a> = <span title="Null(null)" class="keyword">null</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(_lev: Int, _ct: scala.collection.concurrent.TrieMap[K,V], _mustInit: Boolean)scala.collection.concurrent.TrieMapIterator[K,V]" id="175931">newIterator</a><span class="delimiter">(</span><a title="Int" id="176117">_lev</a>: <a href="../../Int.scala.html#508" title="Int">Int</a>, <a title="scala.collection.concurrent.TrieMap[K,V]" id="176118">_ct</a>: <a href="#10416" title="scala.collection.concurrent.TrieMap[K,V]">TrieMap</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span>, <a title="Boolean" id="176119">_mustInit</a>: <a href="../../Boolean.scala.html#2218" title="Boolean">Boolean</a><span class="delimiter">)</span> = <span title="scala.collection.concurrent.TrieMapIterator[K,V]" class="keyword">new</span> <a href="#10432" title="scala.collection.concurrent.TrieMapIterator[K,V]">TrieMapIterator</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">(</span><a href="#176117" title="Int">_lev</a>, <a href="#176118" title="scala.collection.concurrent.TrieMap[K,V]">_ct</a>, <a href="#176119" title="Boolean">_mustInit</a><span class="delimiter">)</span>

  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(it: scala.collection.concurrent.TrieMapIterator[K,V])Unit" id="175932">dupTo</a><span class="delimiter">(</span><a title="scala.collection.concurrent.TrieMapIterator[K,V]" id="176122">it</a>: <a href="#10432" title="scala.collection.concurrent.TrieMapIterator[K,V]">TrieMapIterator</a><span class="delimiter">[</span>K, V<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#176122" title="scala.collection.concurrent.TrieMapIterator[K,V]">it</a>.<a href="#175937" title="(x$1: Int)Unit">level</a> = <a href="#10432" title="TrieMapIterator.this.type" class="keyword">this</a>.<a href="#175937" title="=&gt; Int">level</a>
    <a href="#176122" title="scala.collection.concurrent.TrieMapIterator[K,V]">it</a>.<a href="#175938" title="(x$1: scala.collection.concurrent.TrieMap[K,V])Unit">ct</a> = <a href="#10432" title="TrieMapIterator.this.type" class="keyword">this</a>.<a href="#175938" title="=&gt; scala.collection.concurrent.TrieMap[K,V]">ct</a>
    <a href="#176122" title="scala.collection.concurrent.TrieMapIterator[K,V]">it</a>.<a href="#175917" title="(x$1: Int)Unit">depth</a> = <a href="#10432" title="TrieMapIterator.this.type" class="keyword">this</a>.<a href="#175917" title="=&gt; Int">depth</a>
    <a href="#176122" title="scala.collection.concurrent.TrieMapIterator[K,V]">it</a>.<a href="#175923" title="(x$1: scala.collection.concurrent.KVNode[K,V])Unit">current</a> = <a href="#10432" title="TrieMapIterator.this.type" class="keyword">this</a>.<a href="#175923" title="=&gt; scala.collection.concurrent.KVNode[K,V]">current</a>

    // these need a deep copy
    <a href="../../Array.scala.html#293" title="Array.type">Array</a>.<a href="../../Array.scala.html#68724" title="(src: AnyRef, srcPos: Int, dest: AnyRef, destPos: Int, length: Int)Unit">copy</a><span class="delimiter">(</span><a href="#10432" title="TrieMapIterator.this.type" class="keyword">this</a>.<a href="#175911" title="=&gt; Array[Array[scala.collection.concurrent.BasicNode]]">stack</a>, <span title="Int(0)" class="int">0</span>, <a href="#176122" title="scala.collection.concurrent.TrieMapIterator[K,V]">it</a>.<a href="#175911" title="=&gt; Array[Array[scala.collection.concurrent.BasicNode]]">stack</a>, <span title="Int(0)" class="int">0</span>, <span title="Int(7)" class="int">7</span><span class="delimiter">)</span>
    <a href="../../Array.scala.html#293" title="Array.type">Array</a>.<a href="../../Array.scala.html#68724" title="(src: AnyRef, srcPos: Int, dest: AnyRef, destPos: Int, length: Int)Unit">copy</a><span class="delimiter">(</span><a href="#10432" title="TrieMapIterator.this.type" class="keyword">this</a>.<a href="#175914" title="=&gt; Array[Int]">stackpos</a>, <span title="Int(0)" class="int">0</span>, <a href="#176122" title="scala.collection.concurrent.TrieMapIterator[K,V]">it</a>.<a href="#175914" title="=&gt; Array[Int]">stackpos</a>, <span title="Int(0)" class="int">0</span>, <span title="Int(7)" class="int">7</span><span class="delimiter">)</span>

    // this one needs to be evaluated
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#10432" title="TrieMapIterator.this.type" class="keyword">this</a>.<a href="#175920" title="=&gt; Iterator[(K, V)]">subiter</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#176122" title="scala.collection.concurrent.TrieMapIterator[K,V]">it</a>.<a href="#175920" title="(x$1: Iterator[(K, V)])Unit">subiter</a> = <span title="Null(null)" class="keyword">null</span>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="List[(K, V)]" id="176130">lst</a> = <a href="#10432" title="TrieMapIterator.this.type" class="keyword">this</a>.<a href="#175920" title="=&gt; Iterator[(K, V)]">subiter</a>.<a href="../TraversableOnce.scala.html#59174" title="=&gt; List[(K, V)]">toList</a>
      <a href="#10432" title="TrieMapIterator.this.type" class="keyword">this</a>.<a href="#175920" title="(x$1: Iterator[(K, V)])Unit">subiter</a> = <a href="#176130" title="List[(K, V)]">lst</a>.<a href="../LinearSeqLike.scala.html#76109" title="=&gt; Iterator[(K, V)]">iterator</a>
      <a href="#176122" title="scala.collection.concurrent.TrieMapIterator[K,V]">it</a>.<a href="#175920" title="(x$1: Iterator[(K, V)])Unit">subiter</a> = <a href="#176130" title="List[(K, V)]">lst</a>.<a href="../LinearSeqLike.scala.html#76109" title="=&gt; Iterator[(K, V)]">iterator</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** Returns a sequence of iterators over subsets of this iterator.
   *  It's used to ease the implementation of splitters for a parallel version of the TrieMap.
   */
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="()Seq[Iterator[(K, V)]]" id="175933">subdivide</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../Seq.scala.html#5620" title="Seq[Iterator[(K, V)]]">Seq</a><span class="delimiter">[</span>Iterator<span class="delimiter">[</span><span class="delimiter">(</span>K, V<span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">]</span> = <span title="Seq[Iterator[(K, V)]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#175920" title="=&gt; Iterator[(K, V)]">subiter</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    // the case where an LNode is being iterated
    <span class="keyword">val</span> <a title="Iterator[(K, V)]" id="176133">it</a> = <a href="#175920" title="=&gt; Iterator[(K, V)]">subiter</a>
    <a href="#175920" title="(x$1: Iterator[(K, V)])Unit">subiter</a> = <span title="Null(null)" class="keyword">null</span>
    <a href="#175930" title="()Unit">advance</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#10432" title="TrieMapIterator.this.type" class="keyword">this</a>.<a href="#175937" title="(x$1: Int)Unit">level</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
    <a href="../generic/GenericCompanion.scala.html#60782" title="(elems: Iterator[(K, V)]*)Seq[Iterator[(K, V)]]">Seq</a><span class="delimiter">(</span><a href="#176133" title="Iterator[(K, V)]">it</a>, <a href="#10432" title="scala.collection.concurrent.TrieMapIterator[K,V]" class="keyword">this</a><span class="delimiter">)</span>
  <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Seq[scala.collection.concurrent.TrieMapIterator[K,V]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#175917" title="=&gt; Int">depth</a> <a href="../../Int.scala.html#57891" title="(x: Int)Boolean">==</a> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#10432" title="TrieMapIterator.this.type" class="keyword">this</a>.<a href="#175937" title="(x$1: Int)Unit">level</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
    <a href="../generic/GenericCompanion.scala.html#60782" title="(elems: scala.collection.concurrent.TrieMapIterator[K,V]*)Seq[scala.collection.concurrent.TrieMapIterator[K,V]]">Seq</a><span class="delimiter">(</span><a href="#10432" title="scala.collection.concurrent.TrieMapIterator[K,V]" class="keyword">this</a><span class="delimiter">)</span>
  <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Int" id="176157">d</a> = <span title="Int(0)" class="int">0</span>
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#176157" title="Int">d</a> <a href="../../Int.scala.html#57912" title="(x: Int)Boolean">&lt;=</a> <a href="#175917" title="=&gt; Int">depth</a><span class="delimiter">)</span> <a href="#176158" title="()Unit" class="delimiter">{</a>
      <span class="keyword">val</span> <a title="Int" id="176163">rem</a> = <a href="../../Array.scala.html#57450" title="(i: Int)Array[scala.collection.concurrent.BasicNode]">stack</a><span class="delimiter">(</span><a href="#176157" title="Int">d</a><span class="delimiter">)</span>.<a href="../../Array.scala.html#57449" title="=&gt; Int">length</a> <a href="../../Int.scala.html#57955" title="(x: Int)Int">-</a> <span title="Int(1)" class="int">1</span> <a href="../../Int.scala.html#57955" title="(x: Int)Int">-</a> <a href="../../Array.scala.html#57450" title="(i: Int)Int">stackpos</a><span class="delimiter">(</span><a href="#176157" title="Int">d</a><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#176163" title="Int">rem</a> <a href="../../Int.scala.html#57919" title="(x: Int)Boolean">&gt;</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a href="#176408" title="(x: (Array[scala.collection.concurrent.BasicNode], Array[scala.collection.concurrent.BasicNode]))(Array[scala.collection.concurrent.BasicNode], Array[scala.collection.concurrent.BasicNode])" class="delimiter">(</a><a href="../../Tuple2.scala.html#61506" title="Array[scala.collection.concurrent.BasicNode]" id="176177">arr1</a>, <a href="../../Tuple2.scala.html#61508" title="Array[scala.collection.concurrent.BasicNode]" id="176178">arr2</a><span class="delimiter">)</span> = <a href="../../Array.scala.html#57450" title="(i: Int)Array[scala.collection.concurrent.BasicNode]">stack</a><a href="../../Predef.scala.html#8521" title="(xs: Array[scala.collection.concurrent.BasicNode])scala.collection.mutable.ArrayOps[scala.collection.concurrent.BasicNode]" class="delimiter">(</a><a href="#176157" title="Int">d</a><span class="delimiter">)</span>.<a href="../IndexedSeqOptimized.scala.html#60121" title="(n: Int)Array[scala.collection.concurrent.BasicNode]">drop</a><a href="../../Predef.scala.html#8521" title="(xs: Array[scala.collection.concurrent.BasicNode])scala.collection.mutable.ArrayOps[scala.collection.concurrent.BasicNode]" class="delimiter">(</a><a href="../../Array.scala.html#57450" title="(i: Int)Int">stackpos</a><span class="delimiter">(</span><a href="#176157" title="Int">d</a><span class="delimiter">)</span> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<a href="../IndexedSeqOptimized.scala.html#60124" title="(n: Int)(Array[scala.collection.concurrent.BasicNode], Array[scala.collection.concurrent.BasicNode])">splitAt</a><a href="../../Tuple2.scala.html#1222" title="(Array[scala.collection.concurrent.BasicNode], Array[scala.collection.concurrent.BasicNode]) @unchecked" class="delimiter">(</a><a href="#176163" title="Int">rem</a> <a href="../../Int.scala.html#57969" title="(x: Int)Int">/</a> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span>
        <a href="../../Array.scala.html#57451" title="(i: Int, x: Array[scala.collection.concurrent.BasicNode])Unit">stack</a><span class="delimiter">(</span><a href="#176157" title="Int">d</a><span class="delimiter">)</span> = <a href="#176177" title="Array[scala.collection.concurrent.BasicNode]">arr1</a>
        <a href="../../Array.scala.html#57451" title="(i: Int, x: Int)Unit">stackpos</a><span class="delimiter">(</span><a href="#176157" title="Int">d</a><span class="delimiter">)</span> = -<span title="Int(-1)" class="int">1</span>
        <span class="keyword">val</span> <a title="scala.collection.concurrent.TrieMapIterator[K,V]" id="176179">it</a> = <a href="#175931" title="(_lev: Int, _ct: scala.collection.concurrent.TrieMap[K,V], _mustInit: Boolean)scala.collection.concurrent.TrieMapIterator[K,V]">newIterator</a><span class="delimiter">(</span><a href="#175937" title="=&gt; Int">level</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+</a> <span title="Int(1)" class="int">1</span>, <a href="#175938" title="=&gt; scala.collection.concurrent.TrieMap[K,V]">ct</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
        <a href="#176179" title="scala.collection.concurrent.TrieMapIterator[K,V]">it</a>.<a href="../../Array.scala.html#57451" title="(i: Int, x: Array[scala.collection.concurrent.BasicNode])Unit">stack</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> = <a href="#176178" title="Array[scala.collection.concurrent.BasicNode]">arr2</a>
        <a href="#176179" title="scala.collection.concurrent.TrieMapIterator[K,V]">it</a>.<a href="../../Array.scala.html#57451" title="(i: Int, x: Int)Unit">stackpos</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> = -<span title="Int(-1)" class="int">1</span>
        <a href="#176179" title="scala.collection.concurrent.TrieMapIterator[K,V]">it</a>.<a href="#175917" title="(x$1: Int)Unit">depth</a> = <span title="Int(0)" class="int">0</span>
        <a href="#176179" title="scala.collection.concurrent.TrieMapIterator[K,V]">it</a>.<a href="#175930" title="()Unit">advance</a><span class="delimiter">(</span><span class="delimiter">)</span> // &lt;-- fix it
        <a href="#10432" title="TrieMapIterator.this.type" class="keyword">this</a>.<a href="#175937" title="(x$1: Int)Unit">level</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
        <span title="Nothing" class="keyword">return</span> <a href="../generic/GenericCompanion.scala.html#60782" title="(elems: scala.collection.concurrent.TrieMapIterator[K,V]*)Seq[scala.collection.concurrent.TrieMapIterator[K,V]]">Seq</a><span class="delimiter">(</span><a href="#10432" title="scala.collection.concurrent.TrieMapIterator[K,V]" class="keyword">this</a>, <a href="#176179" title="scala.collection.concurrent.TrieMapIterator[K,V]">it</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#176157" title="Int">d</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
    <span class="delimiter">}</span>
    <a href="#10432" title="TrieMapIterator.this.type" class="keyword">this</a>.<a href="#175937" title="(x$1: Int)Unit">level</a> <a href="../../Int.scala.html#57948" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
    <a href="../generic/GenericCompanion.scala.html#60782" title="(elems: scala.collection.concurrent.TrieMapIterator[K,V]*)Seq[scala.collection.concurrent.TrieMapIterator[K,V]]">Seq</a><span class="delimiter">(</span><a href="#10432" title="scala.collection.concurrent.TrieMapIterator[K,V]" class="keyword">this</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="175934">printDebug</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><span class="delimiter">(</span><span title="String(&quot;ctrie iterator&quot;)" class="string">&quot;ctrie iterator&quot;</span><span class="delimiter">)</span>
    <a href="../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><span class="delimiter">(</span><a href="../../Predef.scala.html#8524" title="implicit scala.Predef.intArrayOps : (xs: Array[Int])scala.collection.mutable.ArrayOps[Int]">stackpos</a>.<a href="../TraversableOnce.scala.html#59190" title="(sep: String)String">mkString</a><span class="delimiter">(</span><span title="String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><span class="delimiter">(</span><span title="String(&quot;depth: &quot;)" class="string">&quot;depth: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#175917" title="=&gt; Int">depth</a><span class="delimiter">)</span>
    <a href="../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><span class="delimiter">(</span><span title="String(&quot;curr.: &quot;)" class="string">&quot;curr.: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#175923" title="=&gt; scala.collection.concurrent.KVNode[K,V]">current</a><span class="delimiter">)</span>
    <a href="../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><span class="delimiter">(</span><a href="../../Predef.scala.html#8521" title="(xs: Array[Array[scala.collection.concurrent.BasicNode]])scala.collection.mutable.ArrayOps[Array[scala.collection.concurrent.BasicNode]]">stack</a>.<a href="../TraversableOnce.scala.html#59190" title="(sep: String)String">mkString</a><span class="delimiter">(</span><span title="String(&quot;\n&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>


<span class="keyword">private</span><span class="delimiter">[</span>concurrent<span class="delimiter">]</span> <span class="keyword">object</span> <a title="scala.collection.concurrent.RestartException.type" id="176706">RestartException</a> <a href="#10394" title="scala.collection.concurrent.RestartException.type" class="keyword">extends</a> util.control.<a href="../../util/control/ControlThrowable.scala.html#53835" title="scala.util.control.ControlThrowable">ControlThrowable</a>


/** Only used for ctrie serialization. */
@SerialVersionUID<span class="delimiter">(</span><span class="long">0L</span> - <span class="long">7237891413820527142L</span><span class="delimiter">)</span>
<span class="keyword">private</span><span class="delimiter">[</span>concurrent<span class="delimiter">]</span> case <span class="keyword">object</span> <a href="#176711" title="scala.collection.concurrent.TrieMapSerializationEnd.type" id="176725">TrieMapSerializationEnd</a>


<a href="#10397" title="scala.collection.concurrent.TrieMapSerializationEnd.type" class="keyword">private</a><span class="delimiter">[</span>concurrent<span class="delimiter">]</span> <span class="keyword">object</span> <a title="scala.collection.concurrent.Debug.type" id="10378">Debug</a> <a href="#10379" title="scala.collection.concurrent.Debug.type" class="delimiter">{</a>
  <span class="keyword">import</span> collection._

  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.util.concurrent.ConcurrentLinkedQueue[AnyRef]" id="176729">logbuffer</a> = <span title="java.util.concurrent.ConcurrentLinkedQueue[AnyRef]" class="keyword">new</span> java.util.concurrent.<span title="java.util.concurrent.ConcurrentLinkedQueue[AnyRef]">ConcurrentLinkedQueue</span><span class="delimiter">[</span>AnyRef<span class="delimiter">]</span>

  <span class="keyword">def</span> <a title="(s: AnyRef)Boolean" id="176730">log</a><span class="delimiter">(</span><a title="AnyRef" id="177353">s</a>: <span title="AnyRef">AnyRef</span><span class="delimiter">)</span> = <a href="#176728" title="=&gt; java.util.concurrent.ConcurrentLinkedQueue[AnyRef]">logbuffer</a>.<span title="(x$1: AnyRef)Boolean">add</span><span class="delimiter">(</span><a href="#177353" title="AnyRef">s</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="()Unit" id="176731">flush</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">for</span> <span class="delimiter">(</span><a title="AnyRef" id="177374">s</a> &lt;- <a href="../JavaConversions.scala.html#4727" title="scala.collection.JavaConversions.type">JavaConversions</a>.<a href="../convert/WrapAsScala.scala.html#131988" title="(it: java.util.Iterator[AnyRef])Iterator[AnyRef]">asScalaIterator</a><a href="../Iterator.scala.html#65240" title="(f: AnyRef =&gt; Unit)Unit" class="delimiter">(</a><a href="#176728" title="=&gt; java.util.concurrent.ConcurrentLinkedQueue[AnyRef]">logbuffer</a>.<span title="()java.util.Iterator[AnyRef]">iterator</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../Console.scala.html#227" title="Console.type">Console</a>.<a href="../../Console.scala.html#64271" title="=&gt; java.io.PrintStream">out</a>.<span title="(x$1: String)Unit">println</span><span class="delimiter">(</span><a href="#177374" title="AnyRef">s</a>.<span title="()String">toString</span><span class="delimiter">)</span>
    <a href="#176728" title="=&gt; java.util.concurrent.ConcurrentLinkedQueue[AnyRef]">logbuffer</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="176732">clear</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#176728" title="=&gt; java.util.concurrent.ConcurrentLinkedQueue[AnyRef]">logbuffer</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>











        </pre>
    </body>
</html>
<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/reflect/reify/Reifier.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scala.reflect
<span class="keyword">package</span> reify

<span class="keyword">import</span> scala.tools.nsc.Global
<span class="keyword">import</span> scala.reflect.makro.ReificationError
<span class="keyword">import</span> scala.reflect.makro.UnexpectedReificationError

/** Given a tree or a type, generate a tree that when executed at runtime produces the original tree or type.
 *  See more info in the comments to ``reify'' in scala.reflect.api.Universe.
 *
 *  @author Martin Odersky
 *  @version 2.10
 */
<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class Reifier extends Object with scala.reflect.reify.Phases with scala.reflect.reify.Errors" id="24098">Reifier</a> <a href="#24098" title="scala.reflect.reify.Reifier" class="keyword">extends</a> <a href="Phases.scala.html#24092" title="scala.reflect.reify.Phases">Phases</a>
                          <span class="keyword">with</span> <a href="Errors.scala.html#24161" title="scala.reflect.reify.Errors">Errors</a> <span class="delimiter">{</span>

  <span class="keyword">val</span> <a title="=&gt; scala.tools.nsc.Global" id="563316">mirror</a>: <a href="../../tools/nsc/Global.scala.html#27892" title="scala.tools.nsc.Global">Global</a>
  <span class="keyword">import</span> <a href="#563316" title="=&gt; scala.tools.nsc.Global">mirror</a>._
  <span class="keyword">import</span> <a href="../internal/Definitions.scala.html#441641" title="Reifier.this.mirror.definitions.type">definitions</a>._
  <span class="keyword">import</span> <a href="../../tools/nsc/ast/Trees.scala.html#559838" title="Reifier.this.mirror.treeInfo.type">treeInfo</a>._

  <span class="keyword">val</span> <a title="=&gt; Reifier.this.mirror.analyzer.Typer" id="563320">typer</a>: mirror.analyzer.<a href="../../tools/nsc/typechecker/Typers.scala.html#560207" title="Reifier.this.mirror.analyzer.Typer">Typer</a>
  <span class="keyword">val</span> <a title="=&gt; Reifier.this.mirror.Tree" id="563321">prefix</a>: <a href="../api/Trees.scala.html#23570" title="Reifier.this.mirror.Tree">Tree</a>
  <span class="keyword">val</span> <a title="=&gt; Any" id="563322">reifee</a>: <span title="Any">Any</span>
  <span class="keyword">val</span> <a title="=&gt; Boolean" id="563323">dontSpliceAtTopLevel</a>: <a href="../../Boolean.scala.html#2218" title="Boolean">Boolean</a>
  <span class="keyword">val</span> <a title="=&gt; Boolean" id="563324">concrete</a>: <a href="../../Boolean.scala.html#2218" title="Boolean">Boolean</a>

  /**
   *  For ``reifee'' and other reification parameters, generate a tree of the form
   *
   *    {
   *      val $mr = &lt;[ prefix ]&gt;
   *      $mr.Expr[T](rtree)       // if data is a Tree
   *      $mr.TypeTag[T](rtree)    // if data is a Type
   *    }
   *
   *  where
   *
   *    - `prefix` is the tree that represents the universe
   *       the result will be bound to
   *    - `rtree` is code that generates `reifee` at runtime.
   *    - `T` is the type that corresponds to `data`.
   *
   *  This is not a method, but a value to indicate the fact that Reifier instances are a one-off.
   */
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="Reifier.this.mirror.Tree" id="563326">reified</a>: <a href="../api/Trees.scala.html#23570" title="Reifier.this.mirror.Tree">Tree</a> = <span class="delimiter">{</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      // [Eugene] conventional way of doing this?
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#563321" title="=&gt; Reifier.this.mirror.Tree">prefix</a> <a href="../api/Trees.scala.html#425081" title="(p: Reifier.this.mirror.Tree =&gt; Boolean)Boolean">exists</a> <span class="delimiter">(</span><a href="../internal/Trees.scala.html#441814" title="implicit scala.reflect.internal.Trees.TreeOps : (tree: Reifier.this.mirror.Tree)Reifier.this.mirror.TreeOps">_</a>.<a href="../internal/Trees.scala.html#443953" title="=&gt; Boolean">isErroneous</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="Errors.scala.html#563288" title="(prefix: Reifier.this.mirror.Tree)Nothing">CannotReifyErroneousPrefix</a><span class="delimiter">(</span><a href="#563321" title="=&gt; Reifier.this.mirror.Tree">prefix</a><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#563321" title="=&gt; Reifier.this.mirror.Tree">prefix</a>.<a href="../api/Trees.scala.html#425060" title="=&gt; Reifier.this.mirror.Type">tpe</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="Errors.scala.html#563286" title="(prefix: Reifier.this.mirror.Tree)Nothing">CannotReifyUntypedPrefix</a><span class="delimiter">(</span><a href="#563321" title="=&gt; Reifier.this.mirror.Tree">prefix</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="Reifier.this.mirror.Apply" id="568834">rtree</a> = <a href="#563322" title="=&gt; Any">reifee</a> <span class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="../../Boolean.scala.html#58725" title="Reifier.this.mirror.Apply" id="569192">tree</a>: Tree =&gt;
          <a href="../../tools/nsc/util/SimpleTracer.scala.html#563196" title="(msg: String)(value: String)String">reifyTrace</a><span class="delimiter">(</span><span title="String(&quot;reifying = &quot;)" class="string">&quot;reifying = &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="../../tools/nsc/Global.scala.html#559558" title="Reifier.this.mirror.opt.type">opt</a>.<a href="../../tools/nsc/Global.scala.html#561530" title="=&gt; Boolean">showTrees</a><span class="delimiter">)</span> <span title="String(&quot;\n&quot;)" class="string">&quot;\n&quot;</span> <span title="(x$1: Any)String">+</span> <a href="../../tools/nsc/Global.scala.html#559514" title="Reifier.this.mirror.nodePrinters.type">nodePrinters</a>.<a href="../../Function1.scala.html#59555" title="(v1: Reifier.this.mirror.nodePrinters.global.Tree)String">nodeToString</a><span class="delimiter">(</span>tree<span class="delimiter">)</span>.<span title="()String">trim</span> <span class="keyword">else</span> tree.<a href="../api/Trees.scala.html#425088" title="()String">toString</a><span class="delimiter">)</span>
          <a href="../../tools/nsc/util/SimpleTracer.scala.html#563196" title="(msg: String)(value: Reifier.this.mirror.Position)Reifier.this.mirror.Position">reifyTrace</a><span class="delimiter">(</span><span title="String(&quot;reifee is located at: &quot;)" class="string">&quot;reifee is located at: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span>tree.<a href="../api/Trees.scala.html#425042" title="=&gt; Reifier.this.mirror.Position">pos</a><span class="delimiter">)</span>
          <a href="../../tools/nsc/util/SimpleTracer.scala.html#563196" title="(msg: String)(value: Reifier.this.mirror.Tree)Reifier.this.mirror.Tree">reifyTrace</a><span class="delimiter">(</span><span title="String(&quot;prefix = &quot;)" class="string">&quot;prefix = &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#563321" title="=&gt; Reifier.this.mirror.Tree">prefix</a><span class="delimiter">)</span>
          // [Eugene] conventional way of doing this?
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span>tree <a href="../api/Trees.scala.html#425081" title="(p: Reifier.this.mirror.Tree =&gt; Boolean)Boolean">exists</a> <span class="delimiter">(</span><a href="../internal/Trees.scala.html#441814" title="implicit scala.reflect.internal.Trees.TreeOps : (tree: Reifier.this.mirror.Tree)Reifier.this.mirror.TreeOps">_</a>.<a href="../internal/Trees.scala.html#443953" title="=&gt; Boolean">isErroneous</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="Errors.scala.html#563289" title="(reifee: Any)Nothing">CannotReifyErroneousReifee</a><span class="delimiter">(</span><a href="#563321" title="=&gt; Reifier.this.mirror.Tree">prefix</a><span class="delimiter">)</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span>tree.<a href="../api/Trees.scala.html#425060" title="=&gt; Reifier.this.mirror.Type">tpe</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="Errors.scala.html#563287" title="(reifee: Any)Nothing">CannotReifyUntypedReifee</a><span class="delimiter">(</span>tree<span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Reifier.this.mirror.Tree =&gt; Reifier.this.mirror.Tree" id="568862">pipeline</a> = <a href="Phases.scala.html#563313" title="=&gt; Reifier.this.mirror.Tree =&gt; Reifier.this.mirror.Tree">mkReificationPipeline</a>
          <span class="keyword">val</span> <a title="Reifier.this.mirror.Tree" id="568863">rtree</a> = <a href="../../Function1.scala.html#59555" title="(v1: Reifier.this.mirror.Tree)Reifier.this.mirror.Tree">pipeline</a><span class="delimiter">(</span>tree<span class="delimiter">)</span>

          // consider the following code snippet
          //
          //   val x = reify { class C; new C }
          //
          // inferred type for x will be C
          // but C ceases to exist after reification so this type is clearly incorrect
          // however, reify is &quot;just&quot; a library function, so it cannot affect type inference
          //
          // hence we crash here even though the reification itself goes well
          // fortunately, all that it takes to fix the error is to cast &quot;new C&quot; to Object
          // so I'm not very much worried about introducing this restriction
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span>tree.<a href="../api/Trees.scala.html#425060" title="=&gt; Reifier.this.mirror.Type">tpe</a> <a href="../internal/Types.scala.html#442055" title="(p: Reifier.this.mirror.Type =&gt; Boolean)Boolean">exists</a> <span class="delimiter">(</span><a title="Reifier.this.mirror.Type" id="568907">sub</a> =&gt; <a href="#568907" title="Reifier.this.mirror.Type">sub</a>.<a href="phases/Calculate.scala.html#563297" title="implicit scala.reflect.reify.phases.Calculate.RichSymbol : (sym: Reifier.this.mirror.Symbol)Reifier.this.RichSymbol">typeSymbol</a>.<a href="phases/Calculate.scala.html#563563" title="=&gt; Boolean">isLocalToReifee</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="Errors.scala.html#563282" title="(tree: Reifier.this.mirror.Tree)Nothing">CannotReifyReifeeThatHasTypeLocalToReifee</a><span class="delimiter">(</span>tree<span class="delimiter">)</span>

          <span class="keyword">val</span> <a title="Reifier.this.mirror.analyzer.global.Type" id="568864">taggedType</a> = <a href="#563320" title="=&gt; Reifier.this.mirror.analyzer.Typer">typer</a>.<a href="../../tools/nsc/typechecker/Typers.scala.html#560754" title="(tree: Reifier.this.mirror.analyzer.global.Tree, owner: Reifier.this.mirror.analyzer.global.Symbol)Reifier.this.mirror.analyzer.global.Type">packedType</a><span class="delimiter">(</span>tree, <a href="../internal/Symbols.scala.html#441152" title="=&gt; Reifier.this.mirror.NoSymbol">NoSymbol</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Reifier.this.mirror.ModuleSymbol" id="568865">tagModule</a> = <span title="Reifier.this.mirror.ModuleSymbol" class="keyword">if</span> <span class="delimiter">(</span><a href="codegen/Types.scala.html#563387" title="=&gt; Boolean">reificationIsConcrete</a><span class="delimiter">)</span> <a href="../internal/Definitions.scala.html#442417" title="=&gt; Reifier.this.mirror.ModuleSymbol">ConcreteTypeTagModule</a> <span class="keyword">else</span> <a href="../internal/Definitions.scala.html#442413" title="=&gt; Reifier.this.mirror.ModuleSymbol">TypeTagModule</a>
          <span class="keyword">val</span> <a title="Reifier.this.mirror.TypeApply" id="568866">tagCtor</a> = <a href="../api/Trees.scala.html#429629" title="(fun: Reifier.this.mirror.Tree, args: List[Reifier.this.mirror.Tree])Reifier.this.mirror.TypeApply">TypeApply</a><span class="delimiter">(</span><a href="../api/Trees.scala.html#427925" title="(qualifier: Reifier.this.mirror.Tree, name: Reifier.this.mirror.Name)Reifier.this.mirror.Select">Select</a><span class="delimiter">(</span><a href="../api/Trees.scala.html#427669" title="(name: Reifier.this.mirror.Name)Reifier.this.mirror.Ident">Ident</a><span class="delimiter">(</span><a href="../internal/StdNames.scala.html#441764" title="Reifier.this.mirror.nme.type">nme</a>.<a href="../internal/StdNames.scala.html#446195" title="=&gt; Reifier.this.mirror.nme.NameType">MIRROR_SHORT</a><span class="delimiter">)</span>, <a href="#568865" title="Reifier.this.mirror.ModuleSymbol">tagModule</a>.<a href="../internal/Symbols.scala.html#449106" title="=&gt; Reifier.this.mirror.TermName">name</a><span class="delimiter">)</span>, <a href="../../collection/immutable/List.scala.html#63291" title="(xs: Reifier.this.mirror.TypeTree*)List[Reifier.this.mirror.TypeTree]">List</a><span class="delimiter">(</span><a href="../api/Trees.scala.html#23746" title="(tp: Reifier.this.mirror.Type)Reifier.this.mirror.TypeTree">TypeTree</a><span class="delimiter">(</span><a href="#568864" title="Reifier.this.mirror.analyzer.global.Type">taggedType</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Reifier.this.mirror.TypeApply" id="568867">exprCtor</a> = <a href="../api/Trees.scala.html#429629" title="(fun: Reifier.this.mirror.Tree, args: List[Reifier.this.mirror.Tree])Reifier.this.mirror.TypeApply">TypeApply</a><span class="delimiter">(</span><a href="../api/Trees.scala.html#427925" title="(qualifier: Reifier.this.mirror.Tree, name: Reifier.this.mirror.Name)Reifier.this.mirror.Select">Select</a><span class="delimiter">(</span><a href="../api/Trees.scala.html#427669" title="(name: Reifier.this.mirror.Name)Reifier.this.mirror.Ident">Ident</a><span class="delimiter">(</span><a href="../internal/StdNames.scala.html#441764" title="Reifier.this.mirror.nme.type">nme</a>.<a href="../internal/StdNames.scala.html#446195" title="=&gt; Reifier.this.mirror.nme.NameType">MIRROR_SHORT</a><span class="delimiter">)</span>, <a href="../internal/Definitions.scala.html#442399" title="=&gt; Reifier.this.mirror.Symbol">ExprModule</a>.<a href="../internal/Symbols.scala.html#443152" title="=&gt; Reifier.this.mirror.definitions.ExprModule.NameType">name</a><span class="delimiter">)</span>, <a href="../../collection/immutable/List.scala.html#63291" title="(xs: Reifier.this.mirror.TypeTree*)List[Reifier.this.mirror.TypeTree]">List</a><span class="delimiter">(</span><a href="../api/Trees.scala.html#23746" title="(tp: Reifier.this.mirror.Type)Reifier.this.mirror.TypeTree">TypeTree</a><span class="delimiter">(</span><a href="#568864" title="Reifier.this.mirror.analyzer.global.Type">taggedType</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="List[Reifier.this.mirror.Tree]" id="568868">tagArgs</a> = <a href="../../collection/immutable/List.scala.html#63291" title="(xs: Reifier.this.mirror.Tree*)List[Reifier.this.mirror.Tree]">List</a><span class="delimiter">(</span><a href="phases/Reify.scala.html#563374" title="(reifee: Any)Reifier.this.mirror.Tree">reify</a><span class="delimiter">(</span><a href="#568864" title="Reifier.this.mirror.analyzer.global.Type">taggedType</a><span class="delimiter">)</span>, <a href="package.scala.html#57132" title="(global: scala.tools.nsc.Global)(typer0: global.analyzer.Typer, tpe: global.Type, concrete: Boolean)global.Tree">reifyErasure</a><span class="delimiter">(</span><a href="#563316" title="=&gt; scala.tools.nsc.Global">mirror</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#563320" title="=&gt; Reifier.this.mirror.analyzer.Typer">typer</a>, <a href="#568864" title="Reifier.this.mirror.analyzer.global.Type">taggedType</a>, concrete = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="../api/Trees.scala.html#427174" title="(fun: Reifier.this.mirror.Tree, args: List[Reifier.this.mirror.Tree])Reifier.this.mirror.Apply">Apply</a><span class="delimiter">(</span><a href="../api/Trees.scala.html#427174" title="(fun: Reifier.this.mirror.Tree, args: List[Reifier.this.mirror.Tree])Reifier.this.mirror.Apply">Apply</a><span class="delimiter">(</span><a href="#568867" title="Reifier.this.mirror.TypeApply">exprCtor</a>, <a href="../../collection/immutable/List.scala.html#63291" title="(xs: Reifier.this.mirror.Tree*)List[Reifier.this.mirror.Tree]">List</a><span class="delimiter">(</span><a href="#568863" title="Reifier.this.mirror.Tree">rtree</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="../../collection/immutable/List.scala.html#63291" title="(xs: Reifier.this.mirror.Apply*)List[Reifier.this.mirror.Apply]">List</a><span class="delimiter">(</span><a href="../api/Trees.scala.html#427174" title="(fun: Reifier.this.mirror.Tree, args: List[Reifier.this.mirror.Tree])Reifier.this.mirror.Apply">Apply</a><span class="delimiter">(</span><a href="#568866" title="Reifier.this.mirror.TypeApply">tagCtor</a>, <a href="#568868" title="List[Reifier.this.mirror.Tree]">tagArgs</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

        <span class="keyword">case</span> <a href="../../Boolean.scala.html#58725" title="Reifier.this.mirror.Apply" id="569193">tpe</a>: Type =&gt;
          <a href="../../tools/nsc/util/SimpleTracer.scala.html#563196" title="(msg: String)(value: String)String">reifyTrace</a><span class="delimiter">(</span><span title="String(&quot;reifying = &quot;)" class="string">&quot;reifying = &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span>tpe.<a href="../internal/Types.scala.html#442076" title="()String">toString</a><span class="delimiter">)</span>
          <a href="../../tools/nsc/util/SimpleTracer.scala.html#563196" title="(msg: String)(value: Reifier.this.mirror.Tree)Reifier.this.mirror.Tree">reifyTrace</a><span class="delimiter">(</span><span title="String(&quot;prefix = &quot;)" class="string">&quot;prefix = &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#563321" title="=&gt; Reifier.this.mirror.Tree">prefix</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Reifier.this.mirror.Tree" id="569092">rtree</a> = <a href="phases/Reify.scala.html#563374" title="(reifee: Any)Reifier.this.mirror.Tree">reify</a><span class="delimiter">(</span>tpe<span class="delimiter">)</span>

          <span class="keyword">val</span> <a title="Reifier.this.mirror.Type" id="569093">taggedType</a> = tpe
          <span class="keyword">val</span> <a title="Reifier.this.mirror.ModuleSymbol" id="569094">tagModule</a> = <span title="Reifier.this.mirror.ModuleSymbol" class="keyword">if</span> <span class="delimiter">(</span><a href="codegen/Types.scala.html#563387" title="=&gt; Boolean">reificationIsConcrete</a><span class="delimiter">)</span> <a href="../internal/Definitions.scala.html#442417" title="=&gt; Reifier.this.mirror.ModuleSymbol">ConcreteTypeTagModule</a> <span class="keyword">else</span> <a href="../internal/Definitions.scala.html#442413" title="=&gt; Reifier.this.mirror.ModuleSymbol">TypeTagModule</a>
          <span class="keyword">val</span> <a title="Reifier.this.mirror.TypeApply" id="569095">ctor</a> = <a href="../api/Trees.scala.html#429629" title="(fun: Reifier.this.mirror.Tree, args: List[Reifier.this.mirror.Tree])Reifier.this.mirror.TypeApply">TypeApply</a><span class="delimiter">(</span><a href="../api/Trees.scala.html#427925" title="(qualifier: Reifier.this.mirror.Tree, name: Reifier.this.mirror.Name)Reifier.this.mirror.Select">Select</a><span class="delimiter">(</span><a href="../api/Trees.scala.html#427669" title="(name: Reifier.this.mirror.Name)Reifier.this.mirror.Ident">Ident</a><span class="delimiter">(</span><a href="../internal/StdNames.scala.html#441764" title="Reifier.this.mirror.nme.type">nme</a>.<a href="../internal/StdNames.scala.html#446195" title="=&gt; Reifier.this.mirror.nme.NameType">MIRROR_SHORT</a><span class="delimiter">)</span>, <a href="#569094" title="Reifier.this.mirror.ModuleSymbol">tagModule</a>.<a href="../internal/Symbols.scala.html#449106" title="=&gt; Reifier.this.mirror.TermName">name</a><span class="delimiter">)</span>, <a href="../../collection/immutable/List.scala.html#63291" title="(xs: Reifier.this.mirror.TypeTree*)List[Reifier.this.mirror.TypeTree]">List</a><span class="delimiter">(</span><a href="../api/Trees.scala.html#23746" title="(tp: Reifier.this.mirror.Type)Reifier.this.mirror.TypeTree">TypeTree</a><span class="delimiter">(</span><a href="#569093" title="Reifier.this.mirror.Type">taggedType</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="List[Reifier.this.mirror.Tree]" id="569096">args</a> = <a href="../../collection/immutable/List.scala.html#63291" title="(xs: Reifier.this.mirror.Tree*)List[Reifier.this.mirror.Tree]">List</a><span class="delimiter">(</span><a href="#569092" title="Reifier.this.mirror.Tree">rtree</a>, <a href="package.scala.html#57132" title="(global: scala.tools.nsc.Global)(typer0: global.analyzer.Typer, tpe: global.Type, concrete: Boolean)global.Tree">reifyErasure</a><span class="delimiter">(</span><a href="#563316" title="=&gt; scala.tools.nsc.Global">mirror</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#563320" title="=&gt; Reifier.this.mirror.analyzer.Typer">typer</a>, <a href="#569093" title="Reifier.this.mirror.Type">taggedType</a>, concrete = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="../api/Trees.scala.html#427174" title="(fun: Reifier.this.mirror.Tree, args: List[Reifier.this.mirror.Tree])Reifier.this.mirror.Apply">Apply</a><span class="delimiter">(</span><a href="#569095" title="Reifier.this.mirror.TypeApply">ctor</a>, <a href="#569096" title="List[Reifier.this.mirror.Tree]">args</a><span class="delimiter">)</span>

        <span class="keyword">case</span> _ =&gt;
          <a href="#569194" title="(x: Reifier.this.mirror.Apply)Reifier.this.mirror.Apply" class="keyword">throw</a> <span title="(x$1: String)Error" class="keyword">new</span> <a href="../../package.scala.html#56959" title="Error">Error</a><span class="delimiter">(</span><a href="../../Predef.scala.html#8578" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;reifee %s of type %s is not supported&quot;</a>.<a href="../../collection/immutable/StringLike.scala.html#60730" title="(args: Any*)String">format</a><span class="delimiter">(</span><a href="#563322" title="=&gt; Any">reifee</a>, <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#563322" title="=&gt; Any">reifee</a> <span title="(x$1: Any)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span title="String(&quot;null&quot;)" class="string">&quot;null&quot;</span> <span class="keyword">else</span> <a href="#563322" title="=&gt; Any">reifee</a>.<span title="()Class[_]">getClass</span>.<span title="()String">toString</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="Reifier.this.mirror.ValDef" id="568835">mirrorAlias</a> = <a href="../api/Trees.scala.html#428215" title="(mods: Reifier.this.mirror.Modifiers, name: Reifier.this.mirror.TermName, tpt: Reifier.this.mirror.Tree, rhs: Reifier.this.mirror.Tree)Reifier.this.mirror.ValDef">ValDef</a><span class="delimiter">(</span><a href="../internal/Trees.scala.html#441811" title="=&gt; Reifier.this.mirror.Modifiers">NoMods</a>, <a href="../internal/StdNames.scala.html#441764" title="Reifier.this.mirror.nme.type">nme</a>.<a href="../internal/StdNames.scala.html#446195" title="=&gt; Reifier.this.mirror.nme.NameType">MIRROR_SHORT</a>, <a href="../api/Trees.scala.html#436950" title="(ref: Reifier.this.mirror.Tree)Reifier.this.mirror.SingletonTypeTree">SingletonTypeTree</a><span class="delimiter">(</span><a href="#563321" title="=&gt; Reifier.this.mirror.Tree">prefix</a><span class="delimiter">)</span>, <a href="#563321" title="=&gt; Reifier.this.mirror.Tree">prefix</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Reifier.this.mirror.Block" id="568836">wrapped</a> = <a href="../api/Trees.scala.html#427284" title="(stats: List[Reifier.this.mirror.Tree], expr: Reifier.this.mirror.Tree)Reifier.this.mirror.Block">Block</a><span class="delimiter">(</span><a href="#568835" title="Reifier.this.mirror.ValDef">mirrorAlias</a> <a href="../../collection/immutable/List.scala.html#63643" title="(x: Reifier.this.mirror.Tree)List[Reifier.this.mirror.Tree]">::</a> <a href="codegen/Symbols.scala.html#563359" title="=&gt; List[Reifier.this.mirror.Tree]">symbolTable</a>, <a href="#568834" title="Reifier.this.mirror.Apply">rtree</a><span class="delimiter">)</span>

      // todo. why do we resetAllAttrs?
      //
      // typically we do some preprocessing before reification and
      // the code emitted/moved around during preprocessing is very hard to typecheck, so we leave it as it is
      // however this &quot;as it is&quot; sometimes doesn't make any sense
      //
      // ===example 1===
      // we move a freevar from a nested symbol table to a top-level symbol table,
      // and then the reference to mr$ becomes screwed up, because nested symbol tables are already typechecked,
      // so we have an mr$ symbol that points to the nested mr$ rather than to the top-level one.
      //
      // ===example 2===
      // we inline a freevar by replacing a reference to it, e.g. $mr.Apply($mr.Select($mr.Ident($mr.newTermName(&quot;$mr&quot;)), $mr.newTermName(&quot;Ident&quot;)), List($mr.Ident($mr.newTermName(&quot;free$x&quot;))))
      // with its original binding (e.g. $mr.Ident(&quot;x&quot;))
      // we'd love to typecheck the result, but we cannot do this easily, because $mr is external to this tree
      // what's even worse, sometimes $mr can point to the top-level symbol table's $mr, which doesn't have any symbol/type yet -
      // it's just a ValDef that will be emitted only after the reification is completed
      //
      // hence, the simplest solution is to erase all attrs so that invalid (as well as non-existent) bindings get rebound correctly
      // this is ugly, but it's the best we can do
      //
      // todo. this is a common problem with non-trivial macros in our current macro system
      // needs to be solved some day
      //
      // list of non-hygienic transformations:
      // 1) local freetype inlining in Nested
      // 2) external freevar moving in Nested
      // 3) local freeterm inlining in Metalevels
      // 4) trivial tree splice inlining in Reify (Trees.scala)
      // 5) trivial type splice inlining in Reify (Types.scala)
      <span class="keyword">val</span> <a title="scala.collection.immutable.Set[Reifier.this.mirror.treeInfo.global.Symbol]" id="568837">freevarBindings</a> = <a href="codegen/Symbols.scala.html#563359" title="=&gt; List[Reifier.this.mirror.Tree]">symbolTable</a> <a href="../../collection/TraversableLike.scala.html#58983" title="(pf: PartialFunction[Reifier.this.mirror.Tree,Reifier.this.mirror.treeInfo.global.Symbol])(implicit bf: scala.collection.generic.CanBuildFrom[List[Reifier.this.mirror.Tree],Reifier.this.mirror.treeInfo.global.Symbol,List[Reifier.this.mirror.treeInfo.global.Symbol]])List[Reifier.this.mirror.treeInfo.global.Symbol]">collect</a> <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[Reifier.this.mirror.Tree,Reifier.this.mirror.treeInfo.global.Symbol] with Serializable" id="569296" class="delimiter">{</a> <span class="keyword">case</span> entry @ <a href="../internal/TreeInfo.scala.html#504676" title="Option[(Reifier.this.mirror.treeInfo.global.Tree, Reifier.this.mirror.treeInfo.global.TermName, Reifier.this.mirror.treeInfo.global.Tree, Long, String)]" id="569314">FreeDef</a><span class="delimiter">(</span>_, _, binding, _, _<span class="delimiter">)</span> =&gt; binding.<a href="#569290" title="(x: B1)B1">symbol</a> <span class="delimiter">}</span> <a href="../../collection/TraversableOnce.scala.html#59181" title="scala.collection.immutable.Set[Reifier.this.mirror.treeInfo.global.Symbol]">toSet</a>
      // [Eugene] yeah, ugly and extremely brittle, but we do need to do resetAttrs. will be fixed later
      <span class="keyword">var</span> <a title="scala.collection.immutable.Set[Reifier.this.mirror.Symbol]" id="568838">importantSymbols</a> = <a href="../../collection/generic/GenericCompanion.scala.html#60782" title="[A](elems: A*)scala.collection.immutable.Set[A]">Set</a><span title="(elems: Reifier.this.mirror.Symbol*)scala.collection.immutable.Set[Reifier.this.mirror.Symbol]" class="delimiter">[</span><a href="../internal/Symbols.scala.html#441132" title="Reifier.this.mirror.Symbol">Symbol</a><span class="delimiter">]</span><span class="delimiter">(</span><a href="../internal/Definitions.scala.html#442235" title="=&gt; Reifier.this.mirror.ModuleSymbol">PredefModule</a>, <a href="../internal/Definitions.scala.html#442251" title="=&gt; Reifier.this.mirror.Symbol">ScalaRunTimeModule</a><span class="delimiter">)</span>
      <a href="#568838" title="scala.collection.immutable.Set[Reifier.this.mirror.Symbol]">importantSymbols</a> <a href="../../collection/SetLike.scala.html#71321" title="(elems: scala.collection.GenTraversableOnce[Reifier.this.mirror.Symbol])scala.collection.immutable.Set[Reifier.this.mirror.Symbol]">++=</a> <a href="#568838" title="scala.collection.immutable.Set[Reifier.this.mirror.Symbol]">importantSymbols</a> <a href="../../collection/SetLike.scala.html#71313" title="(f: Reifier.this.mirror.Symbol =&gt; Reifier.this.mirror.Symbol)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Set[Reifier.this.mirror.Symbol],Reifier.this.mirror.Symbol,scala.collection.immutable.Set[Reifier.this.mirror.Symbol]])scala.collection.immutable.Set[Reifier.this.mirror.Symbol]">map</a> <span class="delimiter">(</span><a href="#569457" title="Reifier.this.mirror.Symbol">_</a>.<a href="../internal/Symbols.scala.html#443511" title="=&gt; Reifier.this.mirror.Symbol">companionSymbol</a><span class="delimiter">)</span>
      <a href="#568838" title="scala.collection.immutable.Set[Reifier.this.mirror.Symbol]">importantSymbols</a> <a href="../../collection/SetLike.scala.html#71321" title="(elems: scala.collection.GenTraversableOnce[Reifier.this.mirror.Symbol])scala.collection.immutable.Set[Reifier.this.mirror.Symbol]">++=</a> <a href="#568838" title="scala.collection.immutable.Set[Reifier.this.mirror.Symbol]">importantSymbols</a> <a href="../../collection/SetLike.scala.html#71313" title="(f: Reifier.this.mirror.Symbol =&gt; Reifier.this.mirror.Symbol)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Set[Reifier.this.mirror.Symbol],Reifier.this.mirror.Symbol,scala.collection.immutable.Set[Reifier.this.mirror.Symbol]])scala.collection.immutable.Set[Reifier.this.mirror.Symbol]">map</a> <span class="delimiter">(</span><a href="#569567" title="Reifier.this.mirror.Symbol">_</a>.<a href="../internal/Symbols.scala.html#443515" title="=&gt; Reifier.this.mirror.Symbol">moduleClass</a><span class="delimiter">)</span>
      <a href="#568838" title="scala.collection.immutable.Set[Reifier.this.mirror.Symbol]">importantSymbols</a> <a href="../../collection/SetLike.scala.html#71321" title="(elems: scala.collection.GenTraversableOnce[Reifier.this.mirror.Symbol])scala.collection.immutable.Set[Reifier.this.mirror.Symbol]">++=</a> <a href="#568838" title="scala.collection.immutable.Set[Reifier.this.mirror.Symbol]">importantSymbols</a> <a href="../../collection/SetLike.scala.html#71313" title="(f: Reifier.this.mirror.Symbol =&gt; Reifier.this.mirror.Symbol)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Set[Reifier.this.mirror.Symbol],Reifier.this.mirror.Symbol,scala.collection.immutable.Set[Reifier.this.mirror.Symbol]])scala.collection.immutable.Set[Reifier.this.mirror.Symbol]">map</a> <span class="delimiter">(</span><a href="#569677" title="Reifier.this.mirror.Symbol">_</a>.<a href="../internal/Symbols.scala.html#443512" title="=&gt; Reifier.this.mirror.Symbol">linkedClassOfClass</a><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="(sym: Reifier.this.mirror.Symbol)Boolean" id="568839">importantSymbol</a><span class="delimiter">(</span><a title="Reifier.this.mirror.Symbol" id="569727">sym</a>: <a href="../internal/Symbols.scala.html#441132" title="Reifier.this.mirror.Symbol">Symbol</a><span class="delimiter">)</span>: <a href="../../Boolean.scala.html#2218" title="Boolean">Boolean</a> = <a href="#569727" title="Reifier.this.mirror.Symbol">sym</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span> <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#569727" title="Reifier.this.mirror.Symbol">sym</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../internal/Symbols.scala.html#441152" title="=&gt; Reifier.this.mirror.NoSymbol">NoSymbol</a> <a href="../../Boolean.scala.html#58725" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../collection/GenSetLike.scala.html#65156" title="(elem: Reifier.this.mirror.Symbol)Boolean">importantSymbols</a><span class="delimiter">(</span><a href="#569727" title="Reifier.this.mirror.Symbol">sym</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Reifier.this.mirror.Block" id="568840">untyped</a> = <a href="../../tools/nsc/ast/Trees.scala.html#559852" title="(x: Reifier.this.mirror.Block, leaveAlone: Reifier.this.mirror.Tree =&gt; Boolean)Reifier.this.mirror.Block">resetAllAttrs</a><span class="delimiter">(</span><a href="#568836" title="Reifier.this.mirror.Block">wrapped</a>, leaveAlone = <a title="anonymous class $anonfun extends scala.runtime.AbstractFunction1[Reifier.this.mirror.Tree,Boolean] with Serializable" id="569758" class="delimiter">{</a>
        <span class="keyword">case</span> ValDef<a href="#569776" title="Boolean" id="569781" class="delimiter">(</a>_, mr, _, _<span class="delimiter">)</span> <span class="keyword">if</span> mr <span title="(x$1: AnyRef)Boolean">==</span> <a href="../internal/StdNames.scala.html#441764" title="Reifier.this.mirror.nme.type">nme</a>.<a href="../internal/StdNames.scala.html#446195" title="=&gt; Reifier.this.mirror.nme.NameType">MIRROR_SHORT</a> =&gt; <a href="#569782" title="(x: Boolean)Boolean" class="keyword">true</a>
        <span class="keyword">case</span> tree <span class="keyword">if</span> <a href="#568837" title="scala.collection.immutable.Set[Reifier.this.mirror.treeInfo.global.Symbol]">freevarBindings</a> <a href="../../collection/SetLike.scala.html#71318" title="(elem: Reifier.this.mirror.treeInfo.global.Symbol)Boolean">contains</a> tree.<a href="../api/Trees.scala.html#425064" title="=&gt; Reifier.this.mirror.Symbol">symbol</a> =&gt; <a href="#569782" title="(x: Boolean)Boolean" class="keyword">true</a>
        <span class="keyword">case</span> tree <span class="keyword">if</span> <a href="#568839" title="(sym: Reifier.this.mirror.Symbol)Boolean">importantSymbol</a><span class="delimiter">(</span>tree.<a href="../api/Trees.scala.html#425064" title="=&gt; Reifier.this.mirror.Symbol">symbol</a><span class="delimiter">)</span> =&gt; <a href="#569782" title="(x: Boolean)Boolean" class="keyword">true</a>
        <span class="keyword">case</span> _ =&gt; <a href="#569782" title="(x: Boolean)Boolean" class="keyword">false</a>
      <span class="delimiter">}</span><span class="delimiter">)</span>

      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="codegen/Util.scala.html#563440" title="=&gt; Boolean">reifyCopypaste</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="codegen/Util.scala.html#563438" title="=&gt; Boolean">reifyDebug</a><span class="delimiter">)</span> <a href="../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><span class="delimiter">(</span><span title="String(&quot;=============================&quot;)" class="string">&quot;=============================&quot;</span><span class="delimiter">)</span>
        <a href="../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><span class="delimiter">(</span><a href="NodePrinters.scala.html#563620" title="(prefix: Reifier.this.reifiedNodePrinters.global.Tree, tree: Reifier.this.reifiedNodePrinters.global.Tree)String">reifiedNodeToString</a><span class="delimiter">(</span><a href="#563321" title="=&gt; Reifier.this.mirror.Tree">prefix</a>, <a href="#568840" title="Reifier.this.mirror.Block">untyped</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="codegen/Util.scala.html#563438" title="=&gt; Boolean">reifyDebug</a><span class="delimiter">)</span> <a href="../../Predef.scala.html#8489" title="(x: Any)Unit">println</a><span class="delimiter">(</span><span title="String(&quot;=============================&quot;)" class="string">&quot;=============================&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="../../tools/nsc/util/SimpleTracer.scala.html#563196" title="(msg: String)(value: Reifier.this.mirror.Block)Reifier.this.mirror.Block">reifyTrace</a><span class="delimiter">(</span><span title="String(&quot;reified = &quot;)" class="string">&quot;reified = &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#568840" title="Reifier.this.mirror.Block">untyped</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="#568840" title="Reifier.this.mirror.Block">untyped</a>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Nothing" id="569833">ex</a>: <a href="../makro/Reifiers.scala.html#23258" title="scala.reflect.makro.ReificationError">ReificationError</a> =&gt;
        <span title="Nothing" class="keyword">throw</span> <a href="#569833" title="scala.reflect.makro.ReificationError">ex</a>
      <span class="keyword">case</span> <a title="Nothing" id="569834">ex</a>: <a href="../makro/Reifiers.scala.html#23225" title="scala.reflect.makro.UnexpectedReificationError">UnexpectedReificationError</a> =&gt;
        <span title="Nothing" class="keyword">throw</span> <a href="#569834" title="scala.reflect.makro.UnexpectedReificationError">ex</a>
      <span class="keyword">case</span> <a title="Nothing" id="569835">ex</a>: <span title="Throwable">Throwable</span> =&gt;
        <span title="Nothing" class="keyword">throw</span> <span title="scala.reflect.makro.UnexpectedReificationError" class="keyword">new</span> <a href="../makro/Reifiers.scala.html#23225" title="scala.reflect.makro.UnexpectedReificationError">UnexpectedReificationError</a><span class="delimiter">(</span><a href="Errors.scala.html#563281" title="=&gt; scala.tools.nsc.util.Position">defaultErrorPosition</a>, <span title="String(&quot;reification crashed&quot;)" class="string">&quot;reification crashed&quot;</span>, <a href="#569835" title="Throwable">ex</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>
        </pre>
    </body>
</html>
<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/util/SourceFile.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* NSC -- new Scala compiler
 * Copyright 2005-2011 LAMP/EPFL
 * @author  Martin Odersky
 */</span>


<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> util

<span class="keyword">import</span> io.<span class="delimiter">{</span> AbstractFile, VirtualFile <span class="delimiter">}</span>
<span class="keyword">import</span> scala.collection.mutable.ArrayBuffer
<span class="keyword">import</span> annotation.tailrec
<span class="keyword">import</span> java.util.regex.Pattern
<span class="keyword">import</span> java.io.IOException
<span class="keyword">import</span> <a href="Chars.scala.html#30375" title="object scala.tools.nsc.util.Chars">Chars</a>._

<span class="comment">/** abstract base class of a source file used in the compiler */</span>
<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class SourceFile extends java.lang.Object with ScalaObject" id="30392">SourceFile</a> <a href="#30392" title="ScalaObject" class="delimiter">{</a>
  <span class="keyword">def</span> <a title="=&gt; Array[Char]" id="96499">content</a> : <span title="Array[Char]">Array</span><span class="delimiter">[</span>Char<span class="delimiter">]</span>         <span class="comment">// normalized, must end in SU</span>
  <span class="keyword">def</span> <a title="=&gt; scala.tools.nsc.io.AbstractFile" id="96500">file</a>    : <a href="../io/AbstractFile.scala.html#21459" title="scala.tools.nsc.io.AbstractFile">AbstractFile</a>
  <span class="keyword">def</span> <a title="(idx: Int)Boolean" id="96501">isLineBreak</a><span class="delimiter">(</span><a title="Int" id="608642">idx</a> : <span title="Int">Int</span><span class="delimiter">)</span> : <span title="Boolean">Boolean</span>
  <span class="keyword">def</span> <a title="=&gt; Boolean" id="96502">isSelfContained</a>: <span title="Boolean">Boolean</span>
  <span class="keyword">def</span> <a title="=&gt; Int" id="96503">length</a> : <span title="Int">Int</span>
  <span class="keyword">def</span> <a title="(offset: Int)scala.tools.nsc.util.Position" id="96504">position</a><span class="delimiter">(</span><a title="Int" id="97352">offset</a>: <span title="Int">Int</span><span class="delimiter">)</span> : <a href="Position.scala.html#30599" title="scala.tools.nsc.util.Position">Position</a> = <span class="delimiter">{</span>
    <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#97352" title="Int">offset</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#96503" title="=&gt; Int">length</a>, <a href="#96500" title="implicit scala.Predef.any2stringadd : (x: Any)scala.runtime.StringAdd">file</a> <span title="(other: String)java.lang.String">+</span> <span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#97352" title="Int">offset</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &gt;= &quot;)" class="string">&quot; &gt;= &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#96503" title="=&gt; Int">length</a><span class="delimiter">)</span>
    <span title="scala.tools.nsc.util.OffsetPosition" class="keyword">new</span> <a href="Position.scala.html#30965" title="scala.tools.nsc.util.OffsetPosition">OffsetPosition</a><span class="delimiter">(</span><a href="#30392" title="scala.tools.nsc.util.SourceFile" class="keyword">this</a>, <a href="#97352" title="Int">offset</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="keyword">def</span> <a title="(line: Int, column: Int)scala.tools.nsc.util.Position" id="96505">position</a><span class="delimiter">(</span><a title="Int" id="97349">line</a>: <span title="Int">Int</span>, <a title="Int" id="97350">column</a>: <span title="Int">Int</span><span class="delimiter">)</span> : <a href="Position.scala.html#30599" title="scala.tools.nsc.util.Position">Position</a> = <span title="scala.tools.nsc.util.OffsetPosition" class="keyword">new</span> <a href="Position.scala.html#30965" title="scala.tools.nsc.util.OffsetPosition">OffsetPosition</a><span class="delimiter">(</span><a href="#30392" title="scala.tools.nsc.util.SourceFile" class="keyword">this</a>, <a href="#96507" title="(index: Int)Int">lineToOffset</a><span class="delimiter">(</span><a href="#97349" title="Int">line</a><span class="delimiter">)</span> <span title="(x: Int)Int">+</span> <a href="#97350" title="Int">column</a><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(offset: Int)Int" id="96506">offsetToLine</a><span class="delimiter">(</span><a title="Int" id="606326">offset</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Int">Int</span> 
  <span class="keyword">def</span> <a title="(index: Int)Int" id="96507">lineToOffset</a><span class="delimiter">(</span><a title="Int" id="606337">index</a> : <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Int">Int</span>
  <span class="comment">/** Map a position to a position in the underlying source file.
   *  For regular source files, simply return the argument.
   */</span>
  <span class="keyword">def</span> <a title="(position: scala.tools.nsc.util.Position)scala.tools.nsc.util.Position" id="96508">positionInUltimateSource</a><span class="delimiter">(</span><a title="scala.tools.nsc.util.Position" id="414311">position</a>: <a href="Position.scala.html#30599" title="scala.tools.nsc.util.Position">Position</a><span class="delimiter">)</span> = <a href="#414311" title="scala.tools.nsc.util.Position">position</a>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="96509">toString</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="String">String</span> = <a href="#96500" title="=&gt; scala.tools.nsc.io.AbstractFile">file</a>.<a href="../io/AbstractFile.scala.html#96452" title="=&gt; String">name</a> <span class="comment">/* + &quot;:&quot; + content.length */</span>
  <span class="keyword">def</span> <a title="(offset: Int)java.lang.String" id="96510">dbg</a><span class="delimiter">(</span><a title="Int" id="608657">offset</a>: <span title="Int">Int</span><span class="delimiter">)</span> = <span class="delimiter">(</span><span title="scala.tools.nsc.util.OffsetPosition" class="keyword">new</span> <a href="Position.scala.html#30965" title="scala.tools.nsc.util.OffsetPosition">OffsetPosition</a><span class="delimiter">(</span><a href="#30392" title="scala.tools.nsc.util.SourceFile" class="keyword">this</a>, <a href="#608657" title="Int">offset</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="Position.scala.html#97219" title="=&gt; java.lang.String">dbgString</a>
  <span class="keyword">def</span> <a title="=&gt; String" id="96511">path</a> = <a href="#96500" title="=&gt; scala.tools.nsc.io.AbstractFile">file</a>.<a href="../io/AbstractFile.scala.html#96453" title="=&gt; String">path</a>

  <span class="keyword">def</span> <a title="(offset: Int, text: String)Boolean" id="96512">beginsWith</a><span class="delimiter">(</span><a title="Int" id="608660">offset</a>: <span title="Int">Int</span>, <a title="String" id="608661">text</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> =
    <span class="delimiter">(</span><a href="#96499" title="implicit scala.Predef.charArrayOps : (xs: Array[Char])scala.collection.mutable.ArrayOps[Char]">content</a> <span title="implicit scala.Predef.charArrayOps : (xs: Array[Char])scala.collection.mutable.ArrayOps[Char]">drop</span> <a href="#608660" title="Int">offset</a><span class="delimiter">)</span> <span title="(that: scala.collection.GenSeq[Char])Boolean">startsWith</span> <a href="#608661" title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString">text</a>

  <span class="keyword">def</span> <a title="(index: Int)String" id="96513">lineToString</a><span class="delimiter">(</span><a title="Int" id="606255">index</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="String">String</span> =
    <a href="#96499" title="implicit scala.Predef.charArrayOps : (xs: Array[Char])scala.collection.mutable.ArrayOps[Char]">content</a> <span title="implicit scala.Predef.charArrayOps : (xs: Array[Char])scala.collection.mutable.ArrayOps[Char]">drop</span> <a href="#96507" title="(index: Int)Int">lineToOffset</a><span class="delimiter">(</span><a href="#606255" title="Int">index</a><span class="delimiter">)</span> <span title="implicit scala.Predef.charArrayOps : (xs: Array[Char])scala.collection.mutable.ArrayOps[Char]">takeWhile</span> <span class="delimiter">(</span><a title="Char" id="609581">c</a> =&gt; <span title="=&gt; Boolean">!</span><a href="Chars.scala.html#94169" title="(c: Char)Boolean">isLineBreakChar</a><span class="delimiter">(</span><a href="#609581" title="Char">c</a>.<span title="=&gt; Char">toChar</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="=&gt; String">mkString</span>
    
  @tailrec
  <span class="keyword">final</span> <span class="keyword">def</span> <a title="(offset: Int)Int" id="96514">skipWhitespace</a><span class="delimiter">(</span><a title="Int" id="609718">offset</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Int">Int</span> =  
    <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#96499" title="(i: Int)Char">content</a><span title="implicit scala.LowPriorityImplicits.charWrapper : (c: Char)scala.runtime.RichChar" class="delimiter">(</span><a href="#609718" title="Int">offset</a><span class="delimiter">)</span>.<span title="=&gt; Boolean">isWhitespace</span><span class="delimiter">)</span> <a href="#96514" title="(offset: Int)Int">skipWhitespace</a><span class="delimiter">(</span><a href="#609718" title="Int">offset</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#609718" title="Int">offset</a>
  
  <span class="keyword">def</span> <a title="(pos: scala.tools.nsc.util.Position)Option[String]" id="96515">identifier</a><span class="delimiter">(</span><a title="scala.tools.nsc.util.Position" id="609726">pos</a>: <a href="Position.scala.html#30599" title="scala.tools.nsc.util.Position">Position</a><span class="delimiter">)</span>: <span title="Option[String]">Option</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span title="object None">None</span>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object scala.tools.nsc.util.ScriptSourceFile" id="31083">ScriptSourceFile</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="comment">/** Length of the script header from the given content, if there is one.
   *  The header begins with &quot;#!&quot; or &quot;::#!&quot; and ends with a line starting
   *  with &quot;!#&quot; or &quot;::!#&quot;.
   */</span>
  <span class="keyword">def</span> <a title="(cs: Array[Char])Int" id="109733">headerLength</a><span class="delimiter">(</span><a title="Array[Char]" id="109761">cs</a>: <span title="Array[Char]">Array</span><span class="delimiter">[</span>Char<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.util.regex.Pattern" id="609729">headerPattern</a> = <span title="object java.util.regex.Pattern">Pattern</span>.<span title="(x$1: java.lang.String, x$2: Int)java.util.regex.Pattern">compile</span><span class="delimiter">(</span><span title="java.lang.String(&quot;^(::)?!#.*(\\r|\\n|\\r\\n)&quot;)" class="string">&quot;&quot;&quot;^(::)?!#.*(\r|\n|\r\n)&quot;&quot;&quot;</span>, Pattern.<span title="Int(8)">MULTILINE</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="List[java.lang.String]" id="609730">headerStarts</a>  = <span title="(xs: java.lang.String*)List[java.lang.String]">List</span><span class="delimiter">(</span><span title="java.lang.String(&quot;#!&quot;)" class="string">&quot;#!&quot;</span>, <span title="java.lang.String(&quot;::#!&quot;)" class="string">&quot;::#!&quot;</span><span class="delimiter">)</span>
    
    <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#609730" title="List[java.lang.String]">headerStarts</a> <span title="(p: java.lang.String =&gt; Boolean)Boolean">exists</span> <span class="delimiter">(</span><a href="#109761" title="implicit scala.Predef.charArrayOps : (xs: Array[Char])scala.collection.mutable.ArrayOps[Char]">cs</a> <span title="(that: scala.collection.GenSeq[Char])Boolean">startsWith</span> <a href="#609746" title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString">_</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.util.regex.Matcher" id="610217">matcher</a> = <a href="#609729" title="java.util.regex.Pattern">headerPattern</a> <span title="(x$1: java.lang.CharSequence)java.util.regex.Matcher">matcher</span> <a href="#109761" title="implicit scala.Predef.charArrayOps : (xs: Array[Char])scala.collection.mutable.ArrayOps[Char]">cs</a>.<span title="=&gt; String">mkString</span>
      <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#610217" title="java.util.regex.Matcher">matcher</a>.<span title="()Boolean">find</span><span class="delimiter">)</span> <a href="#610217" title="java.util.regex.Matcher">matcher</a>.<span title="()Int">end</span>
      <span class="keyword">else</span> <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.io.IOException" class="keyword">new</span> <span title="java.io.IOException">IOException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;script file does not close its header with !# or ::!#&quot;)" class="string">&quot;script file does not close its header with !# or ::!#&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">else</span> <span title="Int(0)" class="int">0</span>
  <span class="delimiter">}</span>
  <span class="keyword">def</span> <a title="(cs: Array[Char])Array[Char]" id="109734">stripHeader</a><span class="delimiter">(</span><a title="Array[Char]" id="610392">cs</a>: <span title="Array[Char]">Array</span><span class="delimiter">[</span>Char<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Array[Char]">Array</span><span class="delimiter">[</span>Char<span class="delimiter">]</span> = <a href="#610392" title="implicit scala.Predef.charArrayOps : (xs: Array[Char])scala.collection.mutable.ArrayOps[Char]">cs</a> <span title="(n: Int)Array[Char]">drop</span> <a href="#109733" title="(cs: Array[Char])Int">headerLength</a><span class="delimiter">(</span><a href="#610392" title="Array[Char]">cs</a><span class="delimiter">)</span>
  
  <span class="keyword">def</span> <a title="(file: scala.tools.nsc.io.AbstractFile, content: Array[Char])scala.tools.nsc.util.ScriptSourceFile" id="109735">apply</a><span class="delimiter">(</span><a title="scala.tools.nsc.io.AbstractFile" id="109736">file</a>: <a href="../io/AbstractFile.scala.html#21459" title="scala.tools.nsc.io.AbstractFile">AbstractFile</a>, <a title="Array[Char]" id="109737">content</a>: <span title="Array[Char]">Array</span><span class="delimiter">[</span>Char<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.tools.nsc.util.BatchSourceFile" id="109740">underlying</a> = <span title="scala.tools.nsc.util.BatchSourceFile" class="keyword">new</span> <a href="#30812" title="scala.tools.nsc.util.BatchSourceFile">BatchSourceFile</a><span class="delimiter">(</span><a href="#109736" title="scala.tools.nsc.io.AbstractFile">file</a>, <a href="#109737" title="Array[Char]">content</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="109741">headerLen</a> = <a href="#109733" title="(cs: Array[Char])Int">headerLength</a><span class="delimiter">(</span><a href="#109737" title="Array[Char]">content</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.tools.nsc.util.ScriptSourceFile" id="109742">stripped</a> = <span title="scala.tools.nsc.util.ScriptSourceFile" class="keyword">new</span> <a href="#31082" title="scala.tools.nsc.util.ScriptSourceFile">ScriptSourceFile</a><span class="delimiter">(</span><a href="#109740" title="scala.tools.nsc.util.BatchSourceFile">underlying</a>, <a href="#109737" title="implicit scala.Predef.charArrayOps : (xs: Array[Char])scala.collection.mutable.ArrayOps[Char]">content</a> <span title="(n: Int)Array[Char]">drop</span> <a href="#109741" title="Int">headerLen</a>, <a href="#109741" title="Int">headerLen</a><span class="delimiter">)</span>
    
    <a href="#109742" title="scala.tools.nsc.util.ScriptSourceFile">stripped</a>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>
<span class="keyword">import</span> <a href="#31083" title="object scala.tools.nsc.util.ScriptSourceFile">ScriptSourceFile</a>._

<span class="keyword">class</span> <a title="class ScriptSourceFile extends scala.tools.nsc.util.BatchSourceFile with ScalaObject" id="31082">ScriptSourceFile</a><a href="#31082" title="ScalaObject" class="delimiter">(</a><a title="scala.tools.nsc.util.BatchSourceFile" id="109773">underlying</a>: <a href="#30812" title="scala.tools.nsc.util.BatchSourceFile">BatchSourceFile</a>, <a title="Array[Char]" id="109774">content</a>: <span title="Array[Char]">Array</span><span class="delimiter">[</span>Char<span class="delimiter">]</span>, <span class="keyword">override</span> <span class="keyword">val</span> <a title="Int" id="109775">start</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#30812" title="scala.tools.nsc.util.BatchSourceFile">BatchSourceFile</a><span class="delimiter">(</span><a href="#109773" title="scala.tools.nsc.util.BatchSourceFile">underlying</a>.<a href="#109757" title="=&gt; scala.tools.nsc.io.AbstractFile">file</a>, <a href="#109774" title="Array[Char]">content</a><span class="delimiter">)</span> <span class="delimiter">{</span>  
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Boolean" id="109771">isSelfContained</a> = <span title="Boolean(false)" class="keyword">false</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(pos: scala.tools.nsc.util.Position)scala.tools.nsc.util.Position" id="109772">positionInUltimateSource</a><span class="delimiter">(</span><a title="scala.tools.nsc.util.Position" id="610530">pos</a>: <a href="Position.scala.html#30599" title="scala.tools.nsc.util.Position">Position</a><span class="delimiter">)</span> =
    <span title="scala.tools.nsc.util.Position" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#610530" title="scala.tools.nsc.util.Position">pos</a>.<a href="Position.scala.html#97188" title="=&gt; Boolean">isDefined</a><span class="delimiter">)</span> <a href="#31082" title="scala.tools.nsc.util.ScriptSourceFile" class="keyword">super</a>.<a href="#96508" title="(position: scala.tools.nsc.util.Position)scala.tools.nsc.util.Position">positionInUltimateSource</a><span class="delimiter">(</span><a href="#610530" title="scala.tools.nsc.util.Position">pos</a><span class="delimiter">)</span>
    <span class="keyword">else</span> <span title="scala.tools.nsc.util.OffsetPosition" class="keyword">new</span> <a href="Position.scala.html#30965" title="scala.tools.nsc.util.OffsetPosition">OffsetPosition</a><span class="delimiter">(</span><a href="#109773" title="scala.tools.nsc.util.BatchSourceFile">underlying</a>, <a href="#610530" title="scala.tools.nsc.util.Position">pos</a>.<a href="Position.scala.html#97195" title="=&gt; Int">point</a> <span title="(x: Int)Int">+</span> <a href="#109775" title="=&gt; Int">start</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/** a file whose contents do not change over time */</span>
<span class="keyword">class</span> <a title="class BatchSourceFile extends scala.tools.nsc.util.SourceFile with ScalaObject" id="30812">BatchSourceFile</a><a href="#30812" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="scala.tools.nsc.io.AbstractFile" id="109757">file</a> : <a href="../io/AbstractFile.scala.html#21459" title="scala.tools.nsc.io.AbstractFile">AbstractFile</a>, <span class="keyword">val</span> <a title="Array[Char]" id="109758">content</a>: <span title="Array[Char]">Array</span><span class="delimiter">[</span>Char<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#30392" title="scala.tools.nsc.util.SourceFile">SourceFile</a> <span class="delimiter">{</span>
  
  <span class="keyword">def</span> <a title="(_file: scala.tools.nsc.io.AbstractFile)scala.tools.nsc.util.BatchSourceFile" id="96523" class="keyword">this</a><span class="delimiter">(</span><a title="scala.tools.nsc.io.AbstractFile" id="109749">_file</a>: <a href="../io/AbstractFile.scala.html#21459" title="scala.tools.nsc.io.AbstractFile">AbstractFile</a><span class="delimiter">)</span>                 = <a href="#30812" title="BatchSourceFile.this.type" class="keyword">this</a><span class="delimiter">(</span><a href="#109749" title="scala.tools.nsc.io.AbstractFile">_file</a>, <a href="#109749" title="scala.tools.nsc.io.AbstractFile">_file</a>.<a href="../io/AbstractFile.scala.html#96472" title="=&gt; Array[Char]">toCharArray</a><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(sourceName: String, cs: Seq[Char])scala.tools.nsc.util.BatchSourceFile" id="96524" class="keyword">this</a><span class="delimiter">(</span><a title="String" id="109747">sourceName</a>: <span title="String">String</span>, <a title="Seq[Char]" id="109748">cs</a>: <span title="Seq[Char]">Seq</span><span class="delimiter">[</span>Char<span class="delimiter">]</span><span class="delimiter">)</span>   = <a href="#30812" title="BatchSourceFile.this.type" class="keyword">this</a><span class="delimiter">(</span><a href="../io/VirtualFile.scala.html#261261" title="(name: String)scala.tools.nsc.io.VirtualFile" class="keyword">new</a> <a href="../io/VirtualFile.scala.html#21132" title="scala.tools.nsc.io.VirtualFile">VirtualFile</a><span class="delimiter">(</span><a href="#109747" title="String">sourceName</a><span class="delimiter">)</span>, <a href="#109748" title="Seq[Char]">cs</a>.<span title="(implicit evidence$1: ClassManifest[Char])Array[Char]">toArray</span><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(file: scala.tools.nsc.io.AbstractFile, cs: Seq[Char])scala.tools.nsc.util.BatchSourceFile" id="96525" class="keyword">this</a><span class="delimiter">(</span><a title="scala.tools.nsc.io.AbstractFile" id="109745">file</a>: <a href="../io/AbstractFile.scala.html#21459" title="scala.tools.nsc.io.AbstractFile">AbstractFile</a>, <a title="Seq[Char]" id="109746">cs</a>: <span title="Seq[Char]">Seq</span><span class="delimiter">[</span>Char<span class="delimiter">]</span><span class="delimiter">)</span>   = <a href="#30812" title="BatchSourceFile.this.type" class="keyword">this</a><span class="delimiter">(</span><a href="#109745" title="scala.tools.nsc.io.AbstractFile">file</a>, <a href="#109746" title="Seq[Char]">cs</a>.<span title="(implicit evidence$1: ClassManifest[Char])Array[Char]">toArray</span><span class="delimiter">)</span>
    
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(that: Any)Boolean" id="96526">equals</a><span class="delimiter">(</span><a title="Any" id="610595">that</a> : <span title="Any">Any</span><span class="delimiter">)</span> = <a href="#610595" title="Any">that</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a title="Boolean" id="610598">that</a> : <a href="#30812" title="scala.tools.nsc.util.BatchSourceFile">BatchSourceFile</a> =&gt; <a href="#109757" title="=&gt; scala.tools.nsc.io.AbstractFile">file</a>.<a href="../io/AbstractFile.scala.html#96453" title="=&gt; String">path</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#610598" title="scala.tools.nsc.util.BatchSourceFile">that</a>.<a href="#109757" title="=&gt; scala.tools.nsc.io.AbstractFile">file</a>.<a href="../io/AbstractFile.scala.html#96453" title="=&gt; String">path</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#96530" title="=&gt; Int">start</a> <span title="(x: Int)Boolean">==</span> <a href="#610598" title="scala.tools.nsc.util.BatchSourceFile">that</a>.<a href="#96530" title="=&gt; Int">start</a>
    <span class="keyword">case</span> <span title="Boolean(false)">_</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
  <span class="delimiter">}</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Int" id="96527">hashCode</a> = <a href="#109757" title="=&gt; scala.tools.nsc.io.AbstractFile">file</a>.<a href="../io/AbstractFile.scala.html#96453" title="=&gt; String">path</a>.<span title="()Int">##</span> <span title="(x: Int)Int">+</span> <a href="#96530" title="=&gt; Int">start</a>.<span title="()Int">##</span>
  <span class="keyword">val</span> <a title="Int" id="96528">length</a> = <a href="#109758" title="=&gt; Array[Char]">content</a>.<span title="=&gt; Int">length</span>
  <span class="keyword">def</span> <a title="=&gt; Int" id="96530">start</a> = <span title="Int(0)" class="int">0</span>
  <span class="keyword">def</span> <a title="=&gt; Boolean" id="96531">isSelfContained</a> = <span title="Boolean(true)" class="keyword">true</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(pos: scala.tools.nsc.util.Position)Option[String]" id="96532">identifier</a><span class="delimiter">(</span><a title="scala.tools.nsc.util.Position" id="610617">pos</a>: <a href="Position.scala.html#30599" title="scala.tools.nsc.util.Position">Position</a><span class="delimiter">)</span> = 
    <span title="Option[String]" class="keyword">if</span> <span class="delimiter">(</span><a href="#610617" title="scala.tools.nsc.util.Position">pos</a>.<a href="Position.scala.html#97188" title="=&gt; Boolean">isDefined</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#610617" title="scala.tools.nsc.util.Position">pos</a>.<a href="Position.scala.html#97187" title="=&gt; scala.tools.nsc.util.SourceFile">source</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#30812" title="scala.tools.nsc.util.BatchSourceFile" class="keyword">this</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#610617" title="scala.tools.nsc.util.Position">pos</a>.<a href="Position.scala.html#97195" title="=&gt; Int">point</a> <span title="(x: Int)Boolean">!=</span> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(c: Char)Boolean" id="610630">isOK</a><span class="delimiter">(</span><a title="Char" id="610631">c</a>: <span title="Char">Char</span><span class="delimiter">)</span> = <a href="Chars.scala.html#94173" title="(c: Char)Boolean">isIdentifierPart</a><span class="delimiter">(</span><a href="#610631" title="Char">c</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <a href="Chars.scala.html#94180" title="(c: Char)Boolean">isOperatorPart</a><span class="delimiter">(</span><a href="#610631" title="Char">c</a><span class="delimiter">)</span>
      <span title="(x: java.lang.String)Some[java.lang.String]">Some</span><span class="delimiter">(</span><span title="(x$1: Array[Char])java.lang.String" class="keyword">new</span> <span title="java.lang.String">String</span><span class="delimiter">(</span><a href="#109758" title="implicit scala.Predef.charArrayOps : (xs: Array[Char])scala.collection.mutable.ArrayOps[Char]">content</a> <span title="implicit scala.Predef.charArrayOps : (xs: Array[Char])scala.collection.mutable.ArrayOps[Char]">drop</span> <a href="#610617" title="scala.tools.nsc.util.Position">pos</a>.<a href="Position.scala.html#97195" title="=&gt; Int">point</a> <span title="(p: Char =&gt; Boolean)Array[Char]">takeWhile</span> <a href="#610630" title="(c: Char)Boolean">isOK</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#30812" title="scala.tools.nsc.util.BatchSourceFile" class="keyword">super</a>.<a href="#96515" title="(pos: scala.tools.nsc.util.Position)Option[String]">identifier</a><span class="delimiter">(</span><a href="#610617" title="scala.tools.nsc.util.Position">pos</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  
  <span class="keyword">def</span> <a title="(idx: Int)Boolean" id="96533">isLineBreak</a><span class="delimiter">(</span><a title="Int" id="611006">idx</a>: <span title="Int">Int</span><span class="delimiter">)</span> =
    <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#611006" title="Int">idx</a> <span title="(x: Int)Boolean">&gt;=</span> <a href="#96528" title="=&gt; Int">length</a><span class="delimiter">)</span> <span title="Boolean(false)" class="keyword">false</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Char" id="611013">ch</a> = <a href="#109758" title="(i: Int)Char">content</a><span class="delimiter">(</span><a href="#611006" title="Int">idx</a><span class="delimiter">)</span>
      <span class="comment">// don't identify the CR in CR LF as a line break, since LF will do.</span>
      <span title="Boolean" class="keyword">if</span> <span class="delimiter">(</span><a href="#611013" title="Char">ch</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'\\r\')">CR</span><span class="delimiter">)</span> <span class="delimiter">(</span><a href="#611006" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span> <span title="(x: Int)Boolean">==</span> <a href="#96528" title="=&gt; Int">length</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <span class="delimiter">(</span><a href="#109758" title="(i: Int)Char">content</a><span class="delimiter">(</span><a href="#611006" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span title="(x: Char)Boolean">!=</span> <span title="Char(\'\\n\')">LF</span><span class="delimiter">)</span>
      <span class="keyword">else</span> <a href="Chars.scala.html#94169" title="(c: Char)Boolean">isLineBreakChar</a><span class="delimiter">(</span><a href="#611013" title="Char">ch</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(cs: Array[Char])Array[Int]" id="96534">calculateLineIndices</a><span class="delimiter">(</span><a title="Array[Char]" id="611036">cs</a>: <span title="Array[Char]">Array</span><span class="delimiter">[</span>Char<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[Int]" id="611039">buf</a> = <span title="()scala.collection.mutable.ArrayBuffer[Int]" class="keyword">new</span> <span title="scala.collection.mutable.ArrayBuffer[Int]">ArrayBuffer</span><span class="delimiter">[</span>Int<span class="delimiter">]</span>
    <a href="#611039" title="scala.collection.mutable.ArrayBuffer[Int]">buf</a> <span title="(elem: Int)buf.type">+=</span> <span title="Int(0)" class="int">0</span>
    <span class="keyword">for</span> <span class="delimiter">(</span><a title="Int" id="611183">i</a> &lt;- <span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(f: Int =&gt; Any)Unit">until</span> <a href="#611036" title="Array[Char]">cs</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span> <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#96533" title="(idx: Int)Boolean">isLineBreak</a><span class="delimiter">(</span><a href="#611183" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#611039" title="scala.collection.mutable.ArrayBuffer[Int]">buf</a> <span title="(elem: Int)buf.type">+=</span> <a href="#611183" title="Int">i</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>
    <a href="#611039" title="scala.collection.mutable.ArrayBuffer[Int]">buf</a> <span title="(elem: Int)buf.type">+=</span> <a href="#611036" title="Array[Char]">cs</a>.<span title="=&gt; Int">length</span> <span class="comment">// sentinel, so that findLine below works smoother</span>
    <a href="#611039" title="scala.collection.mutable.ArrayBuffer[Int]">buf</a>.<span title="(implicit evidence$1: ClassManifest[Int])Array[Int]">toArray</span>
  <span class="delimiter">}</span>  
  <span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="Array[Int]" id="96536">lineIndices</a>: <span title="Array[Int]">Array</span><span class="delimiter">[</span>Int<span class="delimiter">]</span> = <a href="#96534" title="(cs: Array[Char])Array[Int]">calculateLineIndices</a><span class="delimiter">(</span><a href="#109758" title="=&gt; Array[Char]">content</a><span class="delimiter">)</span>  

  <span class="keyword">def</span> <a title="(index: Int)Int" id="96537">lineToOffset</a><span class="delimiter">(</span><a title="Int" id="606652">index</a> : <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <a href="#96535" title="(i: Int)Int">lineIndices</a><span class="delimiter">(</span><a href="#606652" title="Int">index</a><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="96539">lastLine</a> = <span title="Int(0)" class="int">0</span>

  <span class="comment">/** Convert offset to line in this source file
   *  Lines are numbered from 0
   */</span>
  <span class="keyword">def</span> <a title="(offset: Int)Int" id="96541">offsetToLine</a><span class="delimiter">(</span><a title="Int" id="606641">offset</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Array[Int]" id="611297">lines</a> = <a href="#96535" title="=&gt; Array[Int]">lineIndices</a>
    <span class="keyword">def</span> <a title="(lo: Int, hi: Int, mid: Int)Int" id="611298">findLine</a><span class="delimiter">(</span><a title="Int" id="611299">lo</a>: <span title="Int">Int</span>, <a title="Int" id="611300">hi</a>: <span title="Int">Int</span>, <a title="Int" id="611301">mid</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Int">Int</span> =
      <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#606641" title="Int">offset</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#611297" title="(i: Int)Int">lines</a><span class="delimiter">(</span><a href="#611301" title="Int">mid</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#611298" title="(lo: Int, hi: Int, mid: Int)Int">findLine</a><span class="delimiter">(</span><a href="#611299" title="Int">lo</a>, <a href="#611301" title="Int">mid</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span>, <span class="delimiter">(</span><a href="#611299" title="Int">lo</a> <span title="(x: Int)Int">+</span> <a href="#611301" title="Int">mid</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span title="(x: Int)Int">/</span> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span>
      <span class="keyword">else</span> <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#606641" title="Int">offset</a> <span title="(x: Int)Boolean">&gt;=</span> <a href="#611297" title="(i: Int)Int">lines</a><span class="delimiter">(</span><a href="#611301" title="Int">mid</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#611298" title="(lo: Int, hi: Int, mid: Int)Int">findLine</a><span class="delimiter">(</span><a href="#611301" title="Int">mid</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>, <a href="#611300" title="Int">hi</a>, <span class="delimiter">(</span><a href="#611301" title="Int">mid</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span> <span title="(x: Int)Int">+</span> <a href="#611300" title="Int">hi</a><span class="delimiter">)</span> <span title="(x: Int)Int">/</span> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span>
      <span class="keyword">else</span> <a href="#611301" title="Int">mid</a>
    <a href="#96539" title="(x$1: Int)Unit">lastLine</a> = <a href="#611298" title="(lo: Int, hi: Int, mid: Int)Int">findLine</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#611297" title="Array[Int]">lines</a>.<span title="=&gt; Int">length</span>, <a href="#96539" title="=&gt; Int">lastLine</a><span class="delimiter">)</span>
    <a href="#96539" title="=&gt; Int">lastLine</a>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
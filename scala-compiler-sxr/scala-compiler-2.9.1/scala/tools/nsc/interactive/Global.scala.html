<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/interactive/Global.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* NSC -- new Scala compiler
 * Copyright 2009-2011 Scala Solutions and LAMP/EPFL
 * @author Martin Odersky
 */</span>
<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> interactive

<span class="keyword">import</span> java.io.<span class="delimiter">{</span> PrintWriter, StringWriter, FileReader, FileWriter <span class="delimiter">}</span>
<span class="keyword">import</span> collection.mutable.<span class="delimiter">{</span>ArrayBuffer, ListBuffer, SynchronizedBuffer, HashMap<span class="delimiter">}</span>

<span class="keyword">import</span> scala.collection.mutable
<span class="keyword">import</span> mutable.<span class="delimiter">{</span>LinkedHashMap, SynchronizedMap,LinkedHashSet, SynchronizedSet<span class="delimiter">}</span>
<span class="keyword">import</span> scala.concurrent.SyncVar
<span class="keyword">import</span> scala.util.control.ControlThrowable
<span class="keyword">import</span> scala.tools.nsc.io.<span class="delimiter">{</span> AbstractFile, LogReplay, Logger, NullLogger, Replayer <span class="delimiter">}</span>
<span class="keyword">import</span> scala.tools.nsc.util.<span class="delimiter">{</span> SourceFile, BatchSourceFile, Position, RangePosition, NoPosition, WorkScheduler, MultiHashMap <span class="delimiter">}</span>
<span class="keyword">import</span> scala.tools.nsc.reporters._
<span class="keyword">import</span> scala.tools.nsc.symtab._
<span class="keyword">import</span> scala.tools.nsc.ast._
<span class="keyword">import</span> scala.tools.nsc.io.<a href="../io/Pickler.scala.html#21278" title="object scala.tools.nsc.io.Pickler">Pickler</a>._
<span class="keyword">import</span> scala.tools.nsc.typechecker.DivergentImplicit
<span class="keyword">import</span> scala.annotation.tailrec
<span class="keyword">import</span> scala.reflect.generic.<span title="object scala.reflect.generic.Flags">Flags</span>.<span class="delimiter">{</span>ACCESSOR, PARAMACCESSOR<span class="delimiter">}</span>

<span class="comment">/** The main class of the presentation compiler in an interactive environment such as an IDE
 */</span>
<span class="keyword">class</span> <a title="class Global extends scala.tools.nsc.Global with scala.tools.nsc.interactive.CompilerControl with scala.tools.nsc.interactive.RangePositions with scala.tools.nsc.interactive.ContextTrees with scala.tools.nsc.interactive.RichCompilationUnits with scala.tools.nsc.interactive.Picklers with ScalaObject" id="17265">Global</a><a href="#17265" title="ScalaObject" class="delimiter">(</a><a title="scala.tools.nsc.Settings" id="124591">settings</a>: <a href="../Settings.scala.html#10928" title="scala.tools.nsc.Settings">Settings</a>, <a title="scala.tools.nsc.reporters.Reporter" id="124592">reporter</a>: <a href="../reporters/Reporter.scala.html#22883" title="scala.tools.nsc.reporters.Reporter">Reporter</a>, <a title="String" id="124595">projectName</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> 
  <span class="keyword">extends</span> scala.tools.nsc.<a href="../Global.scala.html#10562" title="scala.tools.nsc.Global">Global</a><span class="delimiter">(</span><a href="#124591" title="scala.tools.nsc.Settings">settings</a>, <a href="#124592" title="scala.tools.nsc.reporters.Reporter">reporter</a><span class="delimiter">)</span> 
     <span class="keyword">with</span> <a href="CompilerControl.scala.html#17714" title="scala.tools.nsc.interactive.CompilerControl">CompilerControl</a> 
     <span class="keyword">with</span> <a href="RangePositions.scala.html#17669" title="scala.tools.nsc.interactive.RangePositions">RangePositions</a>
     <span class="keyword">with</span> <a href="ContextTrees.scala.html#17567" title="scala.tools.nsc.interactive.ContextTrees">ContextTrees</a> 
     <span class="keyword">with</span> <a href="RichCompilationUnits.scala.html#17447" title="scala.tools.nsc.interactive.RichCompilationUnits">RichCompilationUnits</a> 
     <span class="keyword">with</span> <a href="Picklers.scala.html#17966" title="scala.tools.nsc.interactive.Picklers">Picklers</a> <span class="delimiter">{</span> 

  <span class="keyword">import</span> <a href="../symtab/Definitions.scala.html#67699" title="object Global.this.definitions">definitions</a>._

  <span class="keyword">val</span> <a title="Boolean" id="124305">debugIDE</a>: <span title="Boolean">Boolean</span> = <a href="#124591" title="scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#36832" title="=&gt; Global.this.settings.BooleanSetting">YpresentationDebug</a>.<a href="../settings/MutableSettings.scala.html#42149" title="=&gt; Global.this.settings.YpresentationDebug.T">value</a>
  <span class="keyword">val</span> <a title="Boolean" id="124307">verboseIDE</a>: <span title="Boolean">Boolean</span> = <a href="#124591" title="scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#36830" title="=&gt; Global.this.settings.BooleanSetting">YpresentationVerbose</a>.<a href="../settings/MutableSettings.scala.html#42149" title="=&gt; Global.this.settings.YpresentationVerbose.T">value</a>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; Global.this.settings.YpresentationReplay.T" id="124309">replayName</a> = <a href="#124591" title="scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#36836" title="=&gt; Global.this.settings.StringSetting">YpresentationReplay</a>.<a href="../settings/MutableSettings.scala.html#42149" title="=&gt; Global.this.settings.YpresentationReplay.T">value</a>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; Global.this.settings.YpresentationLog.T" id="124310">logName</a> = <a href="#124591" title="scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#36834" title="=&gt; Global.this.settings.StringSetting">YpresentationLog</a>.<a href="../settings/MutableSettings.scala.html#42149" title="=&gt; Global.this.settings.YpresentationLog.T">value</a>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; Global.this.settings.YpresentationDelay.T" id="124311">afterTypeDelay</a> = <a href="#124591" title="scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#36838" title="=&gt; Global.this.settings.IntSetting">YpresentationDelay</a>.<a href="../settings/MutableSettings.scala.html#42149" title="=&gt; Global.this.settings.YpresentationDelay.T">value</a>
  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">val</span> <a title="Int(10)" id="124312">SleepTime</a> = <span title="Int(10)" class="int">10</span>

  <span class="keyword">val</span> <a title="scala.tools.nsc.io.LogReplay" id="124314">log</a> =
    <span title="scala.tools.nsc.io.LogReplay" class="keyword">if</span> <span class="delimiter">(</span><a href="#124309" title="=&gt; Global.this.settings.YpresentationReplay.T">replayName</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> <span title="scala.tools.nsc.io.Replayer" class="keyword">new</span> <a href="../io/Replayer.scala.html#21373" title="scala.tools.nsc.io.Replayer">Replayer</a><span class="delimiter">(</span><span title="java.io.FileReader" class="keyword">new</span> <span title="java.io.FileReader">FileReader</span><span class="delimiter">(</span><a href="#124309" title="=&gt; Global.this.settings.YpresentationReplay.T">replayName</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">else</span> <span title="scala.tools.nsc.io.LogReplay" class="keyword">if</span> <span class="delimiter">(</span><a href="#124310" title="=&gt; Global.this.settings.YpresentationLog.T">logName</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> <span title="scala.tools.nsc.io.Logger" class="keyword">new</span> <a href="../io/Replayer.scala.html#21640" title="scala.tools.nsc.io.Logger">Logger</a><span class="delimiter">(</span><span title="java.io.FileWriter" class="keyword">new</span> <span title="java.io.FileWriter">FileWriter</span><span class="delimiter">(</span><a href="#124310" title="=&gt; Global.this.settings.YpresentationLog.T">logName</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">else</span> <a href="../io/Replayer.scala.html#21110" title="object scala.tools.nsc.io.NullLogger">NullLogger</a>

  <span class="keyword">import</span> <a href="#124314" title="=&gt; scala.tools.nsc.io.LogReplay">log</a>.logreplay
  <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;interactive compiler from 20 Feb&quot;)" class="string">&quot;interactive compiler from 20 Feb&quot;</span><span class="delimiter">)</span>
  <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;logger: &quot;)" class="string">&quot;logger: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#124314" title="=&gt; scala.tools.nsc.io.LogReplay">log</a>.<span title="()java.lang.Class[_]">getClass</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; writing to &quot;)" class="string">&quot; writing to &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span class="delimiter">(</span><span title="java.io.File" class="keyword">new</span> java.io.<span title="java.io.File">File</span><span class="delimiter">(</span><a href="#124310" title="=&gt; Global.this.settings.YpresentationLog.T">logName</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="()java.lang.String">getAbsolutePath</span><span class="delimiter">)</span>
  <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;classpath: &quot;)" class="string">&quot;classpath: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="../Global.scala.html#64841" title="=&gt; scala.tools.nsc.util.ClassPath[_]">classPath</a><span class="delimiter">)</span>
  
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Long" id="124318">curTime</a> = <span title="object java.lang.System">System</span>.<span title="()Long">nanoTime</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; java.lang.String" id="124320">timeStep</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Long" id="311784">last</a> = <a href="#124318" title="=&gt; Long">curTime</a>
    <a href="#124318" title="(x$1: Long)Unit">curTime</a> = <span title="object java.lang.System">System</span>.<span title="()Long">nanoTime</span>
    <span title="java.lang.String(&quot;, delay = &quot;)" class="string">&quot;, delay = &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span class="delimiter">(</span><a href="#124318" title="=&gt; Long">curTime</a> <span title="(x: Long)Long">-</span> <a href="#311784" title="Long">last</a><span class="delimiter">)</span> <span title="(x: Int)Long">/</span> <span title="Int(1000000)" class="int">1000000</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;ms&quot;)" class="string">&quot;ms&quot;</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Print msg only when debugIDE is true. */</span>
  @inline <span class="keyword">final</span> <span class="keyword">def</span> <a title="(msg: =&gt; String)Unit" id="124321">debugLog</a><span class="delimiter">(</span><a title="=&gt; String" id="308971">msg</a>: =&gt; String<span class="delimiter">)</span> = 
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#124305" title="=&gt; Boolean">debugIDE</a><span class="delimiter">)</span> <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;[%s] %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#124595" title="String">projectName</a>, <a href="#308971" title="=&gt; String">msg</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/** Inform with msg only when verboseIDE is true. */</span>
  @inline <span class="keyword">final</span> <span class="keyword">def</span> <a title="(msg: =&gt; String)Unit" id="124322">informIDE</a><span class="delimiter">(</span><a title="=&gt; String" id="311793">msg</a>: =&gt; String<span class="delimiter">)</span> =
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#124307" title="=&gt; Boolean">verboseIDE</a><span class="delimiter">)</span> <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;[%s][%s]&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#124595" title="String">projectName</a>, <a href="#311793" title="=&gt; String">msg</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Boolean" id="124323">forInteractive</a> = <span title="Boolean(true)" class="keyword">true</span>
  
  <span class="comment">/** A map of all loaded files to the rich compilation units that correspond to them.
   */</span> 
  <span class="keyword">val</span> <a title="unitOfFile extends scala.collection.mutable.LinkedHashMap[scala.tools.nsc.io.AbstractFile,Global.this.RichCompilationUnit] with scala.collection.mutable.SynchronizedMap[scala.tools.nsc.io.AbstractFile,Global.this.RichCompilationUnit]" id="124324">unitOfFile</a> = <a href="#308821" title="scala.collection.mutable.LinkedHashMap[scala.tools.nsc.io.AbstractFile,Global.this.RichCompilationUnit] with scala.collection.mutable.SynchronizedMap[scala.tools.nsc.io.AbstractFile,Global.this.RichCompilationUnit]" class="keyword">new</a> <a title="anonymous class $anon extends scala.collection.mutable.LinkedHashMap[scala.tools.nsc.io.AbstractFile,Global.this.RichCompilationUnit] with scala.collection.mutable.SynchronizedMap[scala.tools.nsc.io.AbstractFile,Global.this.RichCompilationUnit]" id="308821">LinkedHashMap</a><span class="delimiter">[</span>AbstractFile, RichCompilationUnit<span class="delimiter">]</span> <span class="keyword">with</span>
                       <span title="scala.collection.mutable.SynchronizedMap[scala.tools.nsc.io.AbstractFile,Global.this.RichCompilationUnit]">SynchronizedMap</span><span class="delimiter">[</span>AbstractFile, RichCompilationUnit<span class="delimiter">]</span> <span class="delimiter">{</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(key: scala.tools.nsc.io.AbstractFile, value: Global.this.RichCompilationUnit)Option[Global.this.RichCompilationUnit]" id="308906">put</a><span class="delimiter">(</span><a title="scala.tools.nsc.io.AbstractFile" id="308924">key</a>: <a href="../io/AbstractFile.scala.html#21448" title="scala.tools.nsc.io.AbstractFile">AbstractFile</a>, <a title="Global.this.RichCompilationUnit" id="308925">value</a>: <a href="RichCompilationUnits.scala.html#124544" title="Global.this.RichCompilationUnit">RichCompilationUnit</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Option[Global.this.RichCompilationUnit]" id="308963">r</a> = <a href="#308821" title="scala.collection.mutable.LinkedHashMap[scala.tools.nsc.io.AbstractFile,Global.this.RichCompilationUnit] with scala.collection.mutable.SynchronizedMap[scala.tools.nsc.io.AbstractFile,Global.this.RichCompilationUnit]" class="keyword">super</a>.<span title="(key: scala.tools.nsc.io.AbstractFile, value: Global.this.RichCompilationUnit)Option[Global.this.RichCompilationUnit]">put</span><span class="delimiter">(</span><a href="#308924" title="scala.tools.nsc.io.AbstractFile">key</a>, <a href="#308925" title="Global.this.RichCompilationUnit">value</a><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#308963" title="Option[Global.this.RichCompilationUnit]">r</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;added unit for &quot;)" class="string">&quot;added unit for &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#308924" title="scala.tools.nsc.io.AbstractFile">key</a><span class="delimiter">)</span>
      <a href="#308963" title="Option[Global.this.RichCompilationUnit]">r</a>
    <span class="delimiter">}</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(key: scala.tools.nsc.io.AbstractFile)Option[Global.this.RichCompilationUnit]" id="308907">remove</a><span class="delimiter">(</span><a title="scala.tools.nsc.io.AbstractFile" id="309623">key</a>: <a href="../io/AbstractFile.scala.html#21448" title="scala.tools.nsc.io.AbstractFile">AbstractFile</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Option[Global.this.RichCompilationUnit]" id="309634">r</a> = <a href="#308821" title="scala.collection.mutable.LinkedHashMap[scala.tools.nsc.io.AbstractFile,Global.this.RichCompilationUnit] with scala.collection.mutable.SynchronizedMap[scala.tools.nsc.io.AbstractFile,Global.this.RichCompilationUnit]" class="keyword">super</a>.<span title="(key: scala.tools.nsc.io.AbstractFile)Option[Global.this.RichCompilationUnit]">remove</span><span class="delimiter">(</span><a href="#309623" title="scala.tools.nsc.io.AbstractFile">key</a><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#309634" title="(xo: Option[Global.this.RichCompilationUnit])Iterable[Global.this.RichCompilationUnit]">r</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;removed unit for &quot;)" class="string">&quot;removed unit for &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#309623" title="scala.tools.nsc.io.AbstractFile">key</a><span class="delimiter">)</span>
      <a href="#309634" title="Option[Global.this.RichCompilationUnit]">r</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  <span class="comment">/** A list containing all those files that need to be removed
   *  Units are removed by getUnit, typically once a unit is finished compiled.
   */</span>
  <span class="keyword">protected</span> <span class="keyword">val</span> <a title="toBeRemoved extends scala.collection.mutable.ArrayBuffer[scala.tools.nsc.io.AbstractFile] with scala.collection.mutable.SynchronizedBuffer[scala.tools.nsc.io.AbstractFile]" id="124326">toBeRemoved</a> = <a href="#309859" title="scala.collection.mutable.ArrayBuffer[scala.tools.nsc.io.AbstractFile] with scala.collection.mutable.SynchronizedBuffer[scala.tools.nsc.io.AbstractFile]" class="keyword">new</a> <a title="anonymous class $anon extends scala.collection.mutable.ArrayBuffer[scala.tools.nsc.io.AbstractFile] with scala.collection.mutable.SynchronizedBuffer[scala.tools.nsc.io.AbstractFile]" id="309859">ArrayBuffer</a><span class="delimiter">[</span>AbstractFile<span class="delimiter">]</span> <span class="keyword">with</span> <span title="scala.collection.mutable.SynchronizedBuffer[scala.tools.nsc.io.AbstractFile]">SynchronizedBuffer</span><span class="delimiter">[</span>AbstractFile<span class="delimiter">]</span>
  
  <span class="keyword">class</span> <a title="class ResponseMap extends scala.tools.nsc.util.MultiHashMap[scala.tools.nsc.util.SourceFile,Global.this.Response[Global.this.Tree]] with ScalaObject" id="124328">ResponseMap</a> <a href="#124328" title="ScalaObject" class="keyword">extends</a> <a href="../util/MultiHashMap.scala.html#30879" title="scala.tools.nsc.util.MultiHashMap[scala.tools.nsc.util.SourceFile,Global.this.Response[Global.this.Tree]]">MultiHashMap</a><span class="delimiter">[</span>SourceFile, Response<span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">]</span> <span class="delimiter">{</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(binding: (scala.tools.nsc.util.SourceFile, Set[Global.this.Response[Global.this.Tree]]))ResponseMap.this.type" id="311664">+=</a> <span class="delimiter">(</span><a title="(scala.tools.nsc.util.SourceFile, Set[Global.this.Response[Global.this.Tree]])" id="311805">binding</a>: <span title="(scala.tools.nsc.util.SourceFile, Set[Global.this.Response[Global.this.Tree]])" class="delimiter">(</span>SourceFile, Set<span class="delimiter">[</span>Response<span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#124355" title="=&gt; Boolean">interruptsEnabled</a>, <span title="java.lang.String(&quot;delayed operation within an ask&quot;)" class="string">&quot;delayed operation within an ask&quot;</span><span class="delimiter">)</span>
      <a href="#124328" title="Global.this.ResponseMap" class="keyword">super</a>.<span title="(kv: (scala.tools.nsc.util.SourceFile, scala.collection.immutable.Set[Global.this.Response[Global.this.Tree]]))ResponseMap.this.type">+=</span><span class="delimiter">(</span><a href="#311805" title="(scala.tools.nsc.util.SourceFile, Set[Global.this.Response[Global.this.Tree]])">binding</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  <span class="comment">/** A map that associates with each abstract file the set of responses that are waiting
   *  (via waitLoadedTyped) for the unit associated with the abstract file to be loaded and completely typechecked.
   */</span>
  <span class="keyword">protected</span> <span class="keyword">val</span> <a title="Global.this.ResponseMap" id="124329">waitLoadedTypeResponses</a> = <span title="Global.this.ResponseMap" class="keyword">new</span> <a href="#124328" title="Global.this.ResponseMap">ResponseMap</a>
 
  <span class="comment">/** A map that associates with each abstract file the set of responses that ware waiting
   *  (via build) for the unit associated with the abstract file to be parsed and entered
   */</span>
  <span class="keyword">protected</span> <span class="keyword">var</span> <a title="Global.this.ResponseMap" id="124332">getParsedEnteredResponses</a> = <span title="Global.this.ResponseMap" class="keyword">new</span> <a href="#124328" title="Global.this.ResponseMap">ResponseMap</a>
  
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(rmap: Global.this.ResponseMap)Unit" id="124334">cleanResponses</a><span class="delimiter">(</span><a title="Global.this.ResponseMap" id="311844">rmap</a>: <a href="#124328" title="Global.this.ResponseMap">ResponseMap</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">for</span> <span class="delimiter">(</span><span class="delimiter">(</span><a title="scala.tools.nsc.util.SourceFile" id="311884">source</a>, <a title="scala.collection.immutable.Set[Global.this.Response[Global.this.Tree]]" id="311885">rs</a><span class="delimiter">)</span> &lt;- <a href="#311844" title="Global.this.ResponseMap">rmap</a>.<a href="#311855" title="(f: (scala.tools.nsc.util.SourceFile, scala.collection.immutable.Set[Global.this.Response[Global.this.Tree]]) =&gt; Any)Unit">toList</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="Global.this.Response[Global.this.Tree]" id="311902">r</a> &lt;- <a href="#311885" title="(f: Global.this.Response[Global.this.Tree] =&gt; Unit)Unit">rs</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#124339" title="(s: scala.tools.nsc.util.SourceFile)Option[Global.this.RichCompilationUnit]">getUnit</a><span class="delimiter">(</span><a href="#311884" title="scala.tools.nsc.util.SourceFile">source</a><span class="delimiter">)</span>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span>
          <a href="#311902" title="Global.this.Response[Global.this.Tree]">r</a> <a href="Response.scala.html#124724" title="(exc: Throwable)Unit">raise</a> <span title="scala.tools.nsc.interactive.NoSuchUnitError" class="keyword">new</span> <a href="CompilerControl.scala.html#18083" title="scala.tools.nsc.interactive.NoSuchUnitError">NoSuchUnitError</a><span class="delimiter">(</span><a href="#311884" title="scala.tools.nsc.util.SourceFile">source</a>.<a href="../util/SourceFile.scala.html#96521" title="=&gt; scala.tools.nsc.io.AbstractFile">file</a><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#311902" title="Global.this.Response[Global.this.Tree]">r</a>.<a href="Response.scala.html#124727" title="=&gt; Boolean">isComplete</a><span class="delimiter">)</span> 
          <a href="#311844" title="(key: scala.tools.nsc.util.SourceFile, value: scala.collection.immutable.Set[Global.this.Response[Global.this.Tree]])Unit">rmap</a><span class="delimiter">(</span><a href="#311884" title="scala.tools.nsc.util.SourceFile">source</a><span class="delimiter">)</span> <span title="(elem: Global.this.Response[Global.this.Tree])scala.collection.immutable.Set[Global.this.Response[Global.this.Tree]]">-=</span> <a href="#311902" title="Global.this.Response[Global.this.Tree]">r</a>
      <span class="delimiter">}</span>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#311844" title="(key: scala.tools.nsc.util.SourceFile)scala.collection.immutable.Set[Global.this.Response[Global.this.Tree]]">rmap</a><span class="delimiter">(</span><a href="#311884" title="scala.tools.nsc.util.SourceFile">source</a><span class="delimiter">)</span>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span>
        <a href="#311844" title="Global.this.ResponseMap">rmap</a> <span title="(key: scala.tools.nsc.util.SourceFile)rmap.type">-=</span> <a href="#311884" title="scala.tools.nsc.util.SourceFile">source</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="124335">cleanAllResponses</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#124334" title="(rmap: Global.this.ResponseMap)Unit">cleanResponses</a><span class="delimiter">(</span><a href="#124329" title="=&gt; Global.this.ResponseMap">waitLoadedTypeResponses</a><span class="delimiter">)</span>
    <a href="#124334" title="(rmap: Global.this.ResponseMap)Unit">cleanResponses</a><span class="delimiter">(</span><a href="#124332" title="=&gt; Global.this.ResponseMap">getParsedEnteredResponses</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(rmap: Global.this.ResponseMap)Unit" id="124336">checkNoOutstanding</a><span class="delimiter">(</span><a title="Global.this.ResponseMap" id="312011">rmap</a>: <a href="#124328" title="Global.this.ResponseMap">ResponseMap</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <span class="keyword">for</span> <span class="delimiter">(</span><span class="delimiter">(</span>_, <a title="scala.collection.immutable.Set[Global.this.Response[Global.this.Tree]]" id="312046">rs</a><span class="delimiter">)</span> &lt;- <a href="#312011" title="Global.this.ResponseMap">rmap</a>.<a href="#312018" title="(f: (scala.tools.nsc.util.SourceFile, scala.collection.immutable.Set[Global.this.Response[Global.this.Tree]]) =&gt; Unit)Unit">toList</a>; <a title="Global.this.Response[Global.this.Tree]" id="312063">r</a> &lt;- <a href="#312046" title="(f: Global.this.Response[Global.this.Tree] =&gt; Unit)Unit">rs</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;ERROR: missing response, request will be discarded&quot;)" class="string">&quot;ERROR: missing response, request will be discarded&quot;</span><span class="delimiter">)</span>
      <a href="#312063" title="Global.this.Response[Global.this.Tree]">r</a> <a href="Response.scala.html#124724" title="(exc: Throwable)Unit">raise</a> <span title="scala.tools.nsc.interactive.MissingResponse" class="keyword">new</span> <a href="CompilerControl.scala.html#17375" title="scala.tools.nsc.interactive.MissingResponse">MissingResponse</a>
    <span class="delimiter">}</span>
  
  <span class="keyword">def</span> <a title="()Unit" id="124337">checkNoResponsesOutstanding</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#124336" title="(rmap: Global.this.ResponseMap)Unit">checkNoOutstanding</a><span class="delimiter">(</span><a href="#124329" title="=&gt; Global.this.ResponseMap">waitLoadedTypeResponses</a><span class="delimiter">)</span>
    <a href="#124336" title="(rmap: Global.this.ResponseMap)Unit">checkNoOutstanding</a><span class="delimiter">(</span><a href="#124332" title="=&gt; Global.this.ResponseMap">getParsedEnteredResponses</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** The compilation unit corresponding to a source file
   *  if it does not yet exist create a new one atomically
   *  Note: We want to remove this.
   */</span>
  <span class="keyword">protected</span><span class="delimiter">[</span>interactive<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(source: scala.tools.nsc.util.SourceFile)Global.this.RichCompilationUnit" id="124338">getOrCreateUnitOf</a><span class="delimiter">(</span><a title="scala.tools.nsc.util.SourceFile" id="309853">source</a>: <a href="../util/SourceFile.scala.html#30381" title="scala.tools.nsc.util.SourceFile">SourceFile</a><span class="delimiter">)</span>: <a href="RichCompilationUnits.scala.html#124544" title="Global.this.RichCompilationUnit">RichCompilationUnit</a> =
    <a href="#124324" title="=&gt; scala.collection.mutable.LinkedHashMap[scala.tools.nsc.io.AbstractFile,Global.this.RichCompilationUnit] with scala.collection.mutable.SynchronizedMap[scala.tools.nsc.io.AbstractFile,Global.this.RichCompilationUnit]">unitOfFile</a>.<span title="(key: scala.tools.nsc.io.AbstractFile, default: =&gt; Global.this.RichCompilationUnit)Global.this.RichCompilationUnit">getOrElse</span><span class="delimiter">(</span><a href="#309853" title="scala.tools.nsc.util.SourceFile">source</a>.<a href="../util/SourceFile.scala.html#96521" title="=&gt; scala.tools.nsc.io.AbstractFile">file</a>, <span class="delimiter">{</span> <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;precondition violated: &quot;)" class="string">&quot;precondition violated: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#309853" title="scala.tools.nsc.util.SourceFile">source</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; is not loaded&quot;)" class="string">&quot; is not loaded&quot;</span><span class="delimiter">)</span>; <span title="java.lang.Exception" class="keyword">new</span> <span title="java.lang.Exception">Exception</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()Unit">printStackTrace</span><span class="delimiter">(</span><span class="delimiter">)</span>; <span title="Global.this.RichCompilationUnit" class="keyword">new</span> <a href="RichCompilationUnits.scala.html#124544" title="Global.this.RichCompilationUnit">RichCompilationUnit</a><span class="delimiter">(</span><a href="#309853" title="scala.tools.nsc.util.SourceFile">source</a><span class="delimiter">)</span> <span class="delimiter">}</span><span class="delimiter">)</span>

  <span class="comment">/** Work through toBeRemoved list to remove any units.
   *  Then return optionally unit associated with given source.
   */</span>
  <span class="keyword">protected</span><span class="delimiter">[</span>interactive<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(s: scala.tools.nsc.util.SourceFile)Option[Global.this.RichCompilationUnit]" id="124339">getUnit</a><span class="delimiter">(</span><a title="scala.tools.nsc.util.SourceFile" id="308814">s</a>: <a href="../util/SourceFile.scala.html#30381" title="scala.tools.nsc.util.SourceFile">SourceFile</a><span class="delimiter">)</span>: <span title="Option[Global.this.RichCompilationUnit]">Option</span><span class="delimiter">[</span>RichCompilationUnit<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#124326" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.tools.nsc.io.AbstractFile] with scala.collection.mutable.SynchronizedBuffer[scala.tools.nsc.io.AbstractFile]">toBeRemoved</a>.<span title="(x$1: Unit)Unit">synchronized</span> <span class="delimiter">{</span>
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="scala.tools.nsc.io.AbstractFile" id="312128">f</a> &lt;- <a href="#124326" title="(f: scala.tools.nsc.io.AbstractFile =&gt; Unit)Unit">toBeRemoved</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#124324" title="=&gt; scala.collection.mutable.LinkedHashMap[scala.tools.nsc.io.AbstractFile,Global.this.RichCompilationUnit] with scala.collection.mutable.SynchronizedMap[scala.tools.nsc.io.AbstractFile,Global.this.RichCompilationUnit]">unitOfFile</a> <span title="(key: scala.tools.nsc.io.AbstractFile)Global.this.unitOfFile.type">-=</span> <a href="#312128" title="scala.tools.nsc.io.AbstractFile">f</a>
        <a href="#124341" title="(x$1: List[scala.tools.nsc.util.SourceFile])Unit">allSources</a> = <a href="#124341" title="=&gt; List[scala.tools.nsc.util.SourceFile]">allSources</a> <span title="(p: scala.tools.nsc.util.SourceFile =&gt; Boolean)List[scala.tools.nsc.util.SourceFile]">filter</span> <span class="delimiter">(</span><a href="#312146" title="scala.tools.nsc.util.SourceFile">_</a>.<a href="../util/SourceFile.scala.html#96521" title="=&gt; scala.tools.nsc.io.AbstractFile">file</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#312128" title="scala.tools.nsc.io.AbstractFile">f</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#124326" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.tools.nsc.io.AbstractFile] with scala.collection.mutable.SynchronizedBuffer[scala.tools.nsc.io.AbstractFile]">toBeRemoved</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#124324" title="=&gt; scala.collection.mutable.LinkedHashMap[scala.tools.nsc.io.AbstractFile,Global.this.RichCompilationUnit] with scala.collection.mutable.SynchronizedMap[scala.tools.nsc.io.AbstractFile,Global.this.RichCompilationUnit]">unitOfFile</a> <span title="(key: scala.tools.nsc.io.AbstractFile)Option[Global.this.RichCompilationUnit]">get</span> <a href="#308814" title="scala.tools.nsc.util.SourceFile">s</a>.<a href="../util/SourceFile.scala.html#96521" title="=&gt; scala.tools.nsc.io.AbstractFile">file</a>
  <span class="delimiter">}</span>

  <span class="comment">/** A list giving all files to be typechecked in the order they should be checked.
   */</span>
  <span class="keyword">protected</span> <span class="keyword">var</span> <a title="List[scala.tools.nsc.util.SourceFile]" id="124341">allSources</a>: <span title="List[scala.tools.nsc.util.SourceFile]">List</span><span class="delimiter">[</span>SourceFile<span class="delimiter">]</span> = List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>

  <span class="comment">/** The currently active typer run */</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Global.this.TyperRun" id="124344">currentTyperRun</a>: <a href="#124432" title="Global.this.TyperRun">TyperRun</a> = _
  <a href="#124433" title="()Unit">newTyperRun</a><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="comment">/** Is a background compiler run needed?
   *  Note: outOfDate is true as long as there is a background compile scheduled or going on.
   */</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Boolean" id="124347">outOfDate</a> = <span title="Boolean(false)" class="keyword">false</span>
  
  <span class="keyword">def</span> <a title="=&gt; Boolean" id="124349">isOutOfDate</a>: <span title="Boolean">Boolean</span> = <a href="#124347" title="=&gt; Boolean">outOfDate</a>
    
  <span class="keyword">def</span> <a title="()Unit" id="124350">demandNewCompilerRun</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#124347" title="=&gt; Boolean">outOfDate</a><span class="delimiter">)</span> <span title="Nothing" class="keyword">throw</span> <span title="scala.tools.nsc.interactive.FreshRunReq" class="keyword">new</span> <a href="CompilerControl.scala.html#17870" title="scala.tools.nsc.interactive.FreshRunReq">FreshRunReq</a> <span class="comment">// cancel background compile</span>
    <span class="keyword">else</span> <a href="#124347" title="(x$1: Boolean)Unit">outOfDate</a> = <span title="Boolean(true)" class="keyword">true</span>            <span class="comment">// proceed normally and enable new background compile</span>
  <span class="delimiter">}</span>

  <span class="keyword">protected</span><span class="delimiter">[</span>interactive<span class="delimiter">]</span> <span class="keyword">var</span> <a title="Int" id="124352">minRunId</a> = <span title="Int(1)" class="int">1</span>
  
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Boolean" id="124355">interruptsEnabled</a> = <span title="Boolean(true)" class="keyword">true</span> 

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Global.this.Response[_]" id="124357">NoResponse</a>: <a href="Response.scala.html#17903" title="Global.this.Response[_]">Response</a><span class="delimiter">[</span>_<span class="delimiter">]</span> = <span title="Global.this.Response[Any]" class="keyword">new</span> <a href="Response.scala.html#17903" title="Global.this.Response[Any]">Response</a><span class="delimiter">[</span>Any<span class="delimiter">]</span>

  <span class="comment">/** The response that is currently pending, i.e. the compiler
   *  is working on providing an asnwer for it.
   */</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Global.this.Response[_]" id="124360">pendingResponse</a>: <a href="Response.scala.html#17903" title="Global.this.Response[_]">Response</a><span class="delimiter">[</span>_<span class="delimiter">]</span> = <a href="#124357" title="=&gt; Global.this.Response[_]">NoResponse</a> 

  <span class="comment">// ----------- Overriding hooks in nsc.Global -----------------------</span>
  
  <span class="comment">/** Called from parser, which signals hereby that a method definition has been parsed.
   */</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(pos: Global.this.Position)Unit" id="124362">signalParseProgress</a><span class="delimiter">(</span><a title="Global.this.Position" id="312177">pos</a>: <a href="../util/Position.scala.html#30588" title="Global.this.Position">Position</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#124387" title="(pos: Global.this.Position)Unit">checkForMoreWork</a><span class="delimiter">(</span><a href="#312177" title="Global.this.Position">pos</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  
  <span class="comment">/** Called from typechecker, which signals hereby that a node has been completely typechecked.
   *  If the node includes unit.targetPos, abandons run and returns newly attributed tree.
   *  Otherwise, if there's some higher priority work to be done, also abandons run with a FreshRunReq.
   *  @param  context  The context that typechecked the node
   *  @param  old      The original node
   *  @param  result   The transformed node
   */</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(context: Global.this.Context, old: Global.this.Tree, result: Global.this.Tree)Unit" id="124363">signalDone</a><span class="delimiter">(</span><a title="Global.this.Context" id="312182">context</a>: <a href="../typechecker/Contexts.scala.html#105654" title="Global.this.Context">Context</a>, <a title="Global.this.Tree" id="312183">old</a>: <span title="Global.this.Tree">Tree</span>, <a title="Global.this.Tree" id="312184">result</a>: <span title="Global.this.Tree">Tree</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#124355" title="=&gt; Boolean">interruptsEnabled</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="../Global.scala.html#64911" title="object Global.this.analyzer">analyzer</a>.<a href="../typechecker/Namers.scala.html#105673" title="=&gt; Int">lockedCount</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span> 
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#312182" title="Global.this.Context">context</a>.<a href="../typechecker/Contexts.scala.html#106749" title="=&gt; Global.this.analyzer.global.CompilationUnit">unit</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> 
          <a href="#312184" title="Global.this.Tree">result</a>.<span title="=&gt; Global.this.Position">pos</span>.<a href="../util/Position.scala.html#97212" title="=&gt; Boolean">isOpaqueRange</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> 
          <span class="delimiter">(</span><a href="#312184" title="Global.this.Tree">result</a>.<span title="=&gt; Global.this.Position">pos</span> <a href="../util/Position.scala.html#97229" title="(pos: scala.tools.nsc.util.Position)Boolean">includes</a> <a href="#312182" title="Global.this.Context">context</a>.<a href="../typechecker/Contexts.scala.html#106749" title="=&gt; Global.this.analyzer.global.CompilationUnit">unit</a>.<a href="../CompilationUnits.scala.html#96448" title="=&gt; Global.this.analyzer.global.Position">targetPos</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">var</span> <a title="Global.this.Tree" id="312199">located</a> = <span title="Global.this.TypedLocator" class="keyword">new</span> <a href="RangePositions.scala.html#124524" title="Global.this.TypedLocator">TypedLocator</a><span class="delimiter">(</span><a href="#312182" title="Global.this.Context">context</a>.<a href="../typechecker/Contexts.scala.html#106749" title="=&gt; Global.this.analyzer.global.CompilationUnit">unit</a>.<a href="../CompilationUnits.scala.html#96448" title="=&gt; Global.this.analyzer.global.Position">targetPos</a><span class="delimiter">)</span> <a href="RangePositions.scala.html#310204" title="(root: Global.this.Tree)Global.this.Tree">locateIn</a> <a href="#312184" title="Global.this.Tree">result</a>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#312199" title="Global.this.Tree">located</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#17265" title="object Global.this.EmptyTree">EmptyTree</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;something\'s wrong: no &quot;)" class="string">&quot;something's wrong: no &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#312182" title="Global.this.Context">context</a>.<a href="../typechecker/Contexts.scala.html#106749" title="=&gt; Global.this.analyzer.global.CompilationUnit">unit</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; in &quot;)" class="string">&quot; in &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#312184" title="Global.this.Tree">result</a><span title="(x$1: Any)java.lang.String">+</span><a href="#312184" title="Global.this.Tree">result</a>.<span title="=&gt; Global.this.Position">pos</span><span class="delimiter">)</span>
          <a href="#312199" title="Global.this.Tree">located</a> = <a href="#312184" title="Global.this.Tree">result</a>
        <span class="delimiter">}</span>
        <span title="Nothing" class="keyword">throw</span> <span title="Global.this.TyperResult" class="keyword">new</span> <a href="#124434" title="Global.this.TyperResult">TyperResult</a><span class="delimiter">(</span><a href="#312199" title="Global.this.Tree">located</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="#124387" title="(pos: Global.this.Position)Unit">checkForMoreWork</a><span class="delimiter">(</span><a href="#312183" title="Global.this.Tree">old</a>.<span title="=&gt; Global.this.Position">pos</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Unit" id="312219">ex</a>: <a href="RangePositions.scala.html#124522" title="Global.this.ValidateException">ValidateException</a> =&gt; <span class="comment">// Ignore, this will have been reported elsewhere</span>
          <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;validate exception caught: &quot;)" class="string">&quot;validate exception caught: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#312219" title="Global.this.ValidateException">ex</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="Nothing" id="312223">ex</a>: <span title="Throwable">Throwable</span> =&gt;
          <a href="#124314" title="=&gt; scala.tools.nsc.io.LogReplay">log</a>.<a href="../io/Replayer.scala.html#308990" title="()Unit">flush</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <span title="Nothing" class="keyword">throw</span> <a href="#312223" title="java.lang.Throwable">ex</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Called from typechecker every time a context is created.
   *  Registers the context in a context tree
   */</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(c: Global.this.Context)Unit" id="124364">registerContext</a><span class="delimiter">(</span><a title="Global.this.Context" id="312228">c</a>: <a href="../typechecker/Contexts.scala.html#105654" title="Global.this.Context">Context</a><span class="delimiter">)</span> = <a href="#312228" title="Global.this.Context">c</a>.<a href="../typechecker/Contexts.scala.html#106749" title="=&gt; Global.this.analyzer.global.CompilationUnit">unit</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a title="Unit" id="312232">u</a>: <a href="RichCompilationUnits.scala.html#124544" title="Global.this.RichCompilationUnit">RichCompilationUnit</a> =&gt; <a href="ContextTrees.scala.html#124534" title="(contexts: Global.this.Contexts, context: Global.this.Context)Unit">addContext</a><span class="delimiter">(</span><a href="#312232" title="Global.this.RichCompilationUnit">u</a>.<a href="RichCompilationUnits.scala.html#309712" title="=&gt; Global.this.Contexts">contexts</a>, <a href="#312228" title="Global.this.Context">c</a><span class="delimiter">)</span>
    <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
  <span class="delimiter">}</span>

  <span class="comment">/** The top level classes and objects currently seen in the presentation compiler
   */</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.LinkedHashSet[Global.this.Symbol]" id="124365">currentTopLevelSyms</a> = <span title="scala.collection.mutable.LinkedHashSet[Global.this.Symbol]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.LinkedHashSet[Global.this.Symbol]">LinkedHashSet</span><span class="delimiter">[</span>Symbol<span class="delimiter">]</span>

  <span class="comment">/** The top level classes and objects no longer seen in the presentation compiler
   */</span>
  <span class="keyword">val</span> <a title="deletedTopLevelSyms extends scala.collection.mutable.LinkedHashSet[Global.this.Symbol] with scala.collection.mutable.SynchronizedSet[Global.this.Symbol]" id="124367">deletedTopLevelSyms</a> = <a href="#310034" title="scala.collection.mutable.LinkedHashSet[Global.this.Symbol] with scala.collection.mutable.SynchronizedSet[Global.this.Symbol]" class="keyword">new</a> <a title="anonymous class $anon extends scala.collection.mutable.LinkedHashSet[Global.this.Symbol] with scala.collection.mutable.SynchronizedSet[Global.this.Symbol]" id="310034">mutable</a>.<span title="scala.collection.mutable.LinkedHashSet[Global.this.Symbol]">LinkedHashSet</span><span class="delimiter">[</span>Symbol<span class="delimiter">]</span> <span class="keyword">with</span> mutable.<span title="scala.collection.mutable.SynchronizedSet[Global.this.Symbol]">SynchronizedSet</span><span class="delimiter">[</span>Symbol<span class="delimiter">]</span>

  <span class="comment">/** Called from typechecker every time a top-level class or object is entered.
   */</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(sym: Global.this.Symbol)Unit" id="124369">registerTopLevelSym</a><span class="delimiter">(</span><a title="Global.this.Symbol" id="312242">sym</a>: <a href="../symtab/Symbols.scala.html#67331" title="Global.this.Symbol">Symbol</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#124365" title="=&gt; scala.collection.mutable.LinkedHashSet[Global.this.Symbol]">currentTopLevelSyms</a> <span title="(elem: Global.this.Symbol)Global.this.currentTopLevelSyms.type">+=</span> <a href="#312242" title="Global.this.Symbol">sym</a> <span class="delimiter">}</span>

  <span class="comment">/** Symbol loaders in the IDE parse all source files loaded from a package for
   *  top-level idents. Therefore, we can detect top-level symbols that have a name
   *  different from their source file
   */</span>
  <span class="keyword">override</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="loaders extends scala.tools.nsc.symtab.BrowsingLoaders" id="124371">loaders</a> = <a href="#311713" title="scala.tools.nsc.symtab.BrowsingLoaders{}" class="keyword">new</a> <a href="../symtab/BrowsingLoaders.scala.html#23218" title="anonymous class $anon extends scala.tools.nsc.symtab.BrowsingLoaders" id="311713">BrowsingLoaders</a> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Global.this.type" id="311721">global</a>: Global.<span class="keyword">this</span>.<span class="keyword">type</span> = <a href="#17265" title="Global.this.type">Global</a>.<span class="keyword">this</span>
  <span class="delimiter">}</span>

  <span class="comment">// ----------------- Polling ---------------------------------------</span>
  
  case <span class="keyword">class</span> <a title="class WorkEvent extends java.lang.Object with ScalaObject with Product with Serializable" id="312285">WorkEvent</a><a href="#312285" title="ScalaObject" class="delimiter">(</a><a title="Int" id="315111">atNode</a>: <span title="Int">Int</span>, <a title="Long" id="315112">atMillis</a>: <span title="Long">Long</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="124376">moreWorkAtNode</a>: <span title="Int">Int</span> = -<span title="Int(-1)" class="int">1</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="124379">nodesSeen</a> = <span title="Int(0)" class="int">0</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Boolean" id="124382">lastWasReload</a> = <span title="Boolean(false)" class="keyword">false</span>
  
  <span class="comment">/** The number of pollForWorks after which the presentation compiler yields.
   *  Yielding improves responsiveness on systems with few cores because it
   *  gives the UI thread a chance to get new tasks and interrupt the presentation
   *  compiler with them.
   */</span>
  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">val</span> <a title="Int(10)" id="124384">yieldPeriod</a> = <span title="Int(10)" class="int">10</span>

  <span class="comment">/** Called from runner thread and signalDone:
   *  Poll for interrupts and execute them immediately.
   *  Then, poll for exceptions and execute them. 
   *  Then, poll for work reload/typedTreeAt/doFirst commands during background checking.
   *  @param pos   The position of the tree if polling while typechecking, NoPosition otherwise
   *  
   */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>interactive<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(pos: Global.this.Position)Unit" id="124386">pollForWork</a><span class="delimiter">(</span><a title="Global.this.Position" id="312328">pos</a>: <a href="../util/Position.scala.html#30588" title="Global.this.Position">Position</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#124355" title="=&gt; Boolean">interruptsEnabled</a><span class="delimiter">)</span> <span title="Nothing" class="keyword">return</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#312328" title="Global.this.Position">pos</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../symtab/Positions.scala.html#67902" title="=&gt; tools.nsc.util.NoPosition.type">NoPosition</a> <span title="(x: Boolean)Boolean">||</span> <a href="#124379" title="=&gt; Int">nodesSeen</a> <span title="(x: Int)Int">%</span> <span title="Int(10)">yieldPeriod</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <span title="object java.lang.Thread">Thread</span>.<span title="()Unit">`yield`</span><span class="delimiter">(</span><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="()Option[Global.this.WorkEvent]" id="312330">nodeWithWork</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Option[Global.this.WorkEvent]">Option</span><span class="delimiter">[</span>WorkEvent<span class="delimiter">]</span> =
      <span title="Option[Global.this.WorkEvent]" class="keyword">if</span> <span class="delimiter">(</span><a href="CompilerControl.scala.html#124445" title="=&gt; scala.tools.nsc.util.WorkScheduler">scheduler</a>.<a href="../util/WorkScheduler.scala.html#124748" title="=&gt; Boolean">moreWork</a> <span title="(x: Boolean)Boolean">||</span> <a href="#124360" title="=&gt; Global.this.Response[_]">pendingResponse</a>.<a href="Response.scala.html#124729" title="=&gt; Boolean">isCancelled</a><span class="delimiter">)</span> <span title="(x: Global.this.WorkEvent)Some[Global.this.WorkEvent]">Some</span><span class="delimiter">(</span><span title="Global.this.WorkEvent" class="keyword">new</span> <a href="#312285" title="Global.this.WorkEvent">WorkEvent</a><span class="delimiter">(</span><a href="#124379" title="=&gt; Int">nodesSeen</a>, <span title="object java.lang.System">System</span>.<span title="()Long">currentTimeMillis</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">else</span> <span title="object None">None</span>

    <a href="#124379" title="(x$1: Int)Unit">nodesSeen</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
    <a href="../io/Replayer.scala.html#308986" title="(event: String, x: =&gt; Option[Global.this.WorkEvent])(implicit evidence$1: scala.tools.nsc.io.Pickler[Global.this.WorkEvent])Option[Global.this.WorkEvent]">logreplay</a><a href="Picklers.scala.html#124578" title="=&gt; scala.tools.nsc.io.Pickler[Global.this.WorkEvent]" class="delimiter">(</a><span title="java.lang.String(&quot;atnode&quot;)" class="string">&quot;atnode&quot;</span>, <a href="#312330" title="()Option[Global.this.WorkEvent]">nodeWithWork</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span>WorkEvent<span class="delimiter">(</span><a title="Int" id="312410">id</a>, _<span class="delimiter">)</span><span class="delimiter">)</span> =&gt; 
        <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;some work at node &quot;)" class="string">&quot;some work at node &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#312410" title="Int">id</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; current = &quot;)" class="string">&quot; current = &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#124379" title="=&gt; Int">nodesSeen</a><span class="delimiter">)</span>
<span class="comment">//        assert(id &gt;= nodesSeen) </span>
        <a href="#124376" title="(x$1: Int)Unit">moreWorkAtNode</a> = <a href="#312410" title="Int">id</a>
      <span class="keyword">case</span> <span title="Unit">None</span> =&gt;
    <span class="delimiter">}</span>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#124379" title="=&gt; Int">nodesSeen</a> <span title="(x: Int)Boolean">&gt;=</span> <a href="#124376" title="=&gt; Int">moreWorkAtNode</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      
      <a href="../io/Replayer.scala.html#308986" title="(event: String, x: =&gt; Option[scala.tools.nsc.util.InterruptReq])(implicit evidence$1: scala.tools.nsc.io.Pickler[scala.tools.nsc.util.InterruptReq])Option[scala.tools.nsc.util.InterruptReq]">logreplay</a><a href="Picklers.scala.html#124579" title="=&gt; scala.tools.nsc.io.Pickler[scala.tools.nsc.util.InterruptReq]" class="delimiter">(</a><span title="java.lang.String(&quot;asked&quot;)" class="string">&quot;asked&quot;</span>, <a href="CompilerControl.scala.html#124445" title="=&gt; scala.tools.nsc.util.WorkScheduler">scheduler</a>.<a href="../util/WorkScheduler.scala.html#124754" title="()Option[scala.tools.nsc.util.InterruptReq]">pollInterrupt</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="scala.tools.nsc.util.InterruptReq" id="312458">ir</a><span class="delimiter">)</span> =&gt;
          <span class="keyword">try</span> <span class="delimiter">{</span>
            <a href="#124355" title="(x$1: Boolean)Unit">interruptsEnabled</a> = <span title="Boolean(false)" class="keyword">false</span>
            <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;ask started&quot;)" class="string">&quot;ask started&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#124320" title="=&gt; java.lang.String">timeStep</a><span class="delimiter">)</span>
            <a href="#312458" title="scala.tools.nsc.util.InterruptReq">ir</a>.<a href="../util/InterruptReq.scala.html#312391" title="()Unit">execute</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
            <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;ask finished&quot;)" class="string">&quot;ask finished&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#124320" title="=&gt; java.lang.String">timeStep</a><span class="delimiter">)</span>
            <a href="#124355" title="(x$1: Boolean)Unit">interruptsEnabled</a> = <span title="Boolean(true)" class="keyword">true</span>
          <span class="delimiter">}</span>
          <a href="#124386" title="(pos: Global.this.Position)Unit">pollForWork</a><span class="delimiter">(</span><a href="#312328" title="Global.this.Position">pos</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
      <span class="delimiter">}</span>
     
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../io/Replayer.scala.html#308985" title="(event: String, x: =&gt; Boolean)Boolean">logreplay</a><span class="delimiter">(</span><span title="java.lang.String(&quot;cancelled&quot;)" class="string">&quot;cancelled&quot;</span>, <a href="#124360" title="=&gt; Global.this.Response[_]">pendingResponse</a>.<a href="Response.scala.html#124729" title="=&gt; Boolean">isCancelled</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> 
        <span title="Nothing" class="keyword">throw</span> <a href="#315120" title="object scala.tools.nsc.interactive.CancelException">CancelException</a>
      <span class="delimiter">}</span>
    
      <a href="../io/Replayer.scala.html#308986" title="(event: String, x: =&gt; Option[Throwable])(implicit evidence$1: scala.tools.nsc.io.Pickler[Throwable])Option[Throwable]">logreplay</a><a href="Picklers.scala.html#124554" title="=&gt; scala.tools.nsc.io.Pickler[Throwable]" class="delimiter">(</a><span title="java.lang.String(&quot;exception thrown&quot;)" class="string">&quot;exception thrown&quot;</span>, <a href="CompilerControl.scala.html#124445" title="=&gt; scala.tools.nsc.util.WorkScheduler">scheduler</a>.<a href="../util/WorkScheduler.scala.html#124753" title="()Option[Throwable]">pollThrowable</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="scala.tools.nsc.interactive.FreshRunReq" id="312513">ex</a>: <a href="CompilerControl.scala.html#17870" title="scala.tools.nsc.interactive.FreshRunReq">FreshRunReq</a><span class="delimiter">)</span> =&gt; 
          <a href="#124433" title="()Unit">newTyperRun</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#124352" title="(x$1: Int)Unit">minRunId</a> = <a href="../Global.scala.html#64992" title="=&gt; Int">currentRunId</a>
          <a href="#124350" title="()Unit">demandNewCompilerRun</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Nothing">Some</span><span class="delimiter">(</span><a title="java.lang.Throwable" id="312515">ex</a>: <span title="Throwable">Throwable</span><span class="delimiter">)</span> =&gt; <a href="#124314" title="=&gt; scala.tools.nsc.io.LogReplay">log</a>.<a href="../io/Replayer.scala.html#308990" title="()Unit">flush</a><span class="delimiter">(</span><span class="delimiter">)</span>; <span title="Nothing" class="keyword">throw</span> <a href="#312515" title="java.lang.Throwable">ex</a>
        <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
      <span class="delimiter">}</span>
     
      <a href="#124382" title="(x$1: Boolean)Unit">lastWasReload</a> = <span title="Boolean(false)" class="keyword">false</span>
    
      <a href="../io/Replayer.scala.html#308986" title="(event: String, x: =&gt; Option[() =&gt; Unit])(implicit evidence$1: scala.tools.nsc.io.Pickler[() =&gt; Unit])Option[() =&gt; Unit]">logreplay</a><a href="Picklers.scala.html#124590" title="=&gt; scala.tools.nsc.io.Pickler[() =&gt; Unit]" class="delimiter">(</a><span title="java.lang.String(&quot;workitem&quot;)" class="string">&quot;workitem&quot;</span>, <a href="CompilerControl.scala.html#124445" title="=&gt; scala.tools.nsc.util.WorkScheduler">scheduler</a>.<a href="../util/WorkScheduler.scala.html#124749" title="()Option[() =&gt; Unit]">nextWorkItem</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="() =&gt; Unit" id="312563">action</a><span class="delimiter">)</span> =&gt;
          <span class="keyword">try</span> <span class="delimiter">{</span>
            <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;picked up work item at &quot;)" class="string">&quot;picked up work item at &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#312328" title="Global.this.Position">pos</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#312563" title="() =&gt; Unit">action</a><span title="(x$1: Any)java.lang.String">+</span><a href="#124320" title="=&gt; java.lang.String">timeStep</a><span class="delimiter">)</span>
            <a href="#312563" title="()Unit">action</a><span class="delimiter">(</span><span class="delimiter">)</span>
            <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;done with work item: &quot;)" class="string">&quot;done with work item: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#312563" title="() =&gt; Unit">action</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
            <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;quitting work item: &quot;)" class="string">&quot;quitting work item: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#312563" title="() =&gt; Unit">action</a><span title="(x$1: Any)java.lang.String">+</span><a href="#124320" title="=&gt; java.lang.String">timeStep</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="keyword">case</span> <span title="Unit">None</span> =&gt;
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(pos: Global.this.Position)Unit" id="124387">checkForMoreWork</a><span class="delimiter">(</span><a title="Global.this.Position" id="312180">pos</a>: <a href="../util/Position.scala.html#30588" title="Global.this.Position">Position</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Global.this.TyperRun" id="312564">typerRun</a> = <a href="#124344" title="=&gt; Global.this.TyperRun">currentTyperRun</a>
    <a href="#124386" title="(pos: Global.this.Position)Unit">pollForWork</a><span class="delimiter">(</span><a href="#312180" title="Global.this.Position">pos</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#312564" title="Global.this.TyperRun">typerRun</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#124344" title="=&gt; Global.this.TyperRun">currentTyperRun</a><span class="delimiter">)</span> <a href="#124350" title="()Unit">demandNewCompilerRun</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(source: scala.tools.nsc.util.SourceFile, start: Int, length: Int)String" id="124388">debugInfo</a><span class="delimiter">(</span><a title="scala.tools.nsc.util.SourceFile" id="312569">source</a> : <a href="../util/SourceFile.scala.html#30381" title="scala.tools.nsc.util.SourceFile">SourceFile</a>, <a title="Int" id="312570">start</a> : <span title="Int">Int</span>, <a title="Int" id="312571">length</a> : <span title="Int">Int</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
    <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;DEBUG INFO &quot;)" class="string">&quot;DEBUG INFO &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#312569" title="scala.tools.nsc.util.SourceFile">source</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#312570" title="Int">start</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#312571" title="Int">length</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="312573">end</a> = <a href="#312570" title="Int">start</a><span title="(x: Int)Int">+</span><a href="#312571" title="Int">length</a>
    <span class="keyword">val</span> <a title="scala.tools.nsc.util.RangePosition" id="312574">pos</a> = <a href="RangePositions.scala.html#124505" title="(source: scala.tools.nsc.util.SourceFile, start: Int, point: Int, end: Int)scala.tools.nsc.util.RangePosition">rangePos</a><span class="delimiter">(</span><a href="#312569" title="scala.tools.nsc.util.SourceFile">source</a>, <a href="#312570" title="Int">start</a>, <a href="#312570" title="Int">start</a>, <a href="#312573" title="Int">end</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Global.this.Tree" id="312575">tree</a> = <a href="CompilerControl.scala.html#124455" title="(pos: Global.this.Position)Global.this.Tree">locateTree</a><span class="delimiter">(</span><a href="#312574" title="scala.tools.nsc.util.RangePosition">pos</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="java.io.StringWriter" id="312576">sw</a> = <span title="java.io.StringWriter" class="keyword">new</span> <span title="java.io.StringWriter">StringWriter</span>
    <span class="keyword">val</span> <a title="java.io.PrintWriter" id="312577">pw</a> = <span title="java.io.PrintWriter" class="keyword">new</span> <span title="java.io.PrintWriter">PrintWriter</span><span class="delimiter">(</span><a href="#312576" title="java.io.StringWriter">sw</a><span class="delimiter">)</span>
    <a href="../ast/TreePrinters.scala.html#67889" title="(writer: java.io.PrintWriter)Global.this.TreePrinter">newTreePrinter</a><span class="delimiter">(</span><a href="#312577" title="java.io.PrintWriter">pw</a><span class="delimiter">)</span>.<a href="../ast/TreePrinters.scala.html#122425" title="(tree: Global.this.Tree)Unit">print</a><span class="delimiter">(</span><a href="#312575" title="Global.this.Tree">tree</a><span class="delimiter">)</span>
    <a href="#312577" title="java.io.PrintWriter">pw</a>.<span title="()Unit">flush</span>
    
    <span class="keyword">val</span> <a title="scala.tools.nsc.interactive.Response[Global.this.Tree]" id="312578">typed</a> = <span title="Global.this.Response[Global.this.Tree]" class="keyword">new</span> <a href="Response.scala.html#17903" title="Global.this.Response[Global.this.Tree]">Response</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span>
    <a href="CompilerControl.scala.html#124461" title="(pos: Global.this.Position, response: Global.this.Response[Global.this.Tree])Unit">askTypeAt</a><span class="delimiter">(</span><a href="#312574" title="scala.tools.nsc.util.RangePosition">pos</a>, <a href="#312578" title="scala.tools.nsc.interactive.Response[Global.this.Tree]">typed</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="java.lang.String" id="312579">typ</a> = <a href="#312578" title="scala.tools.nsc.interactive.Response[Global.this.Tree]">typed</a>.<a href="Response.scala.html#124725" title="=&gt; Either[Global.this.Tree,Throwable]">get</a>.<span title="=&gt; Either.LeftProjection[Global.this.Tree,Throwable]">left</span>.<span title="=&gt; Option[Global.this.Tree]">toOption</span> <span title="java.lang.String" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="java.lang.String">Some</span><span class="delimiter">(</span><a title="Global.this.Tree" id="312623">tree</a><span class="delimiter">)</span> =&gt;
        <span class="keyword">val</span> <a title="java.io.StringWriter" id="312624">sw</a> = <span title="java.io.StringWriter" class="keyword">new</span> <span title="java.io.StringWriter">StringWriter</span>
        <span class="keyword">val</span> <a title="java.io.PrintWriter" id="312625">pw</a> = <span title="java.io.PrintWriter" class="keyword">new</span> <span title="java.io.PrintWriter">PrintWriter</span><span class="delimiter">(</span><a href="#312624" title="java.io.StringWriter">sw</a><span class="delimiter">)</span>
        <a href="../ast/TreePrinters.scala.html#67889" title="(writer: java.io.PrintWriter)Global.this.TreePrinter">newTreePrinter</a><span class="delimiter">(</span><a href="#312625" title="java.io.PrintWriter">pw</a><span class="delimiter">)</span>.<a href="../ast/TreePrinters.scala.html#122425" title="(tree: Global.this.Tree)Unit">print</a><span class="delimiter">(</span><a href="#312623" title="Global.this.Tree">tree</a><span class="delimiter">)</span>
        <a href="#312625" title="java.io.PrintWriter">pw</a>.<span title="()Unit">flush</span>
        <a href="#312624" title="java.io.StringWriter">sw</a>.<span title="()java.lang.String">toString</span>
      <span class="keyword">case</span> <span title="java.lang.String(&quot;&lt;None&gt;&quot;)">None</span> =&gt; <span title="java.lang.String(&quot;&lt;None&gt;&quot;)" class="string">&quot;&lt;None&gt;&quot;</span>      
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="scala.tools.nsc.interactive.Response[List[Global.this.Member]]" id="312580">completionResponse</a> = <span title="Global.this.Response[List[Global.this.Member]]" class="keyword">new</span> <a href="Response.scala.html#17903" title="Global.this.Response[List[Global.this.Member]]">Response</a><span class="delimiter">[</span>List<span class="delimiter">[</span>Member<span class="delimiter">]</span><span class="delimiter">]</span>
    <a href="CompilerControl.scala.html#124464" title="(pos: Global.this.Position, response: Global.this.Response[List[Global.this.Member]])Unit">askTypeCompletion</a><span class="delimiter">(</span><a href="#312574" title="scala.tools.nsc.util.RangePosition">pos</a>, <a href="#312580" title="scala.tools.nsc.interactive.Response[List[Global.this.Member]]">completionResponse</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="String" id="312581">completion</a> = <a href="#312580" title="scala.tools.nsc.interactive.Response[List[Global.this.Member]]">completionResponse</a>.<a href="Response.scala.html#124725" title="=&gt; Either[List[Global.this.Member],Throwable]">get</a>.<span title="=&gt; Either.LeftProjection[List[Global.this.Member],Throwable]">left</span>.<span title="=&gt; Option[List[Global.this.Member]]">toOption</span> <span title="String" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="String">Some</span><span class="delimiter">(</span><a title="List[Global.this.Member]" id="312653">members</a><span class="delimiter">)</span> =&gt;
        <a href="#312653" title="List[Global.this.Member]">members</a> <span title="(sep: String)String">mkString</span> <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span>
      <span class="keyword">case</span> <span title="java.lang.String(&quot;&lt;None&gt;&quot;)">None</span> =&gt; <span title="java.lang.String(&quot;&lt;None&gt;&quot;)" class="string">&quot;&lt;None&gt;&quot;</span>      
    <span class="delimiter">}</span>
    
    <a href="#312569" title="scala.tools.nsc.util.SourceFile">source</a>.<a href="../util/SourceFile.scala.html#96520" title="implicit scala.Predef.charArrayOps : (xs: Array[Char])scala.collection.mutable.ArrayOps[Char]">content</a>.<span title="=&gt; java.lang.Object with scala.collection.mutable.IndexedSeqView[Char,Array[Char]]">view</span>.<span title="(n: Int)scala.collection.mutable.IndexedSeqView[Char,Array[Char]]">drop</span><span class="delimiter">(</span><a href="#312570" title="Int">start</a><span class="delimiter">)</span>.<span title="(n: Int)scala.collection.mutable.IndexedSeqView[Char,Array[Char]]">take</span><span class="delimiter">(</span><a href="#312571" title="Int">length</a><span class="delimiter">)</span>.<span title="=&gt; String">mkString</span><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; : &quot;)" class="string">&quot; : &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#312569" title="scala.tools.nsc.util.SourceFile">source</a>.<a href="../util/SourceFile.scala.html#96532" title="=&gt; String">path</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; (&quot;)" class="string">&quot; (&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#312570" title="Int">start</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#312573" title="Int">end</a><span title="(x$1: Any)java.lang.String">+</span>
    <span title="java.lang.String(&quot;)\012\012locateTree:\012&quot;)" class="string">&quot;)\n\nlocateTree:\n&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#312576" title="java.io.StringWriter">sw</a>.<span title="()java.lang.String">toString</span><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;\012\012askTypeAt:\012&quot;)" class="string">&quot;\n\naskTypeAt:\n&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#312579" title="java.lang.String">typ</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;\012\012completion:\012&quot;)" class="string">&quot;\n\ncompletion:\n&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#312581" title="String">completion</a>
  <span class="delimiter">}</span>

  <span class="comment">// ----------------- The Background Runner Thread -----------------------</span>

  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="124390">threadId</a> = <span title="Int(0)" class="int">0</span>

  <span class="comment">/** The current presentation compiler runner */</span>
  @volatile <span class="keyword">private</span><span class="delimiter">[</span>interactive<span class="delimiter">]</span> <span class="keyword">var</span> <a title="java.lang.Thread" id="124393">compileRunner</a> = <a href="#124395" title="()java.lang.Thread">newRunnerThread</a><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="comment">/** Create a new presentation compiler runner.
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="()java.lang.Thread" id="124395">newRunnerThread</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="java.lang.Thread">Thread</span> = <span class="delimiter">{</span>
    <a href="#124390" title="(x$1: Int)Unit">threadId</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
    <a href="#124393" title="(x$1: java.lang.Thread)Unit">compileRunner</a> = <span title="scala.tools.nsc.interactive.PresentationCompilerThread" class="keyword">new</span> <a href="PresentationCompilerThread.scala.html#17693" title="scala.tools.nsc.interactive.PresentationCompilerThread">PresentationCompilerThread</a><span class="delimiter">(</span><a href="#17265" title="scala.tools.nsc.interactive.Global" class="keyword">this</a>, <a href="#124595" title="String">projectName</a><span class="delimiter">)</span>
    <a href="#124393" title="=&gt; java.lang.Thread">compileRunner</a>.<span title="()Unit">start</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#124393" title="=&gt; java.lang.Thread">compileRunner</a>
  <span class="delimiter">}</span>
  
  <span class="comment">/** Compile all loaded source files in the order given by `allSources`.
   */</span> 
  <span class="keyword">private</span><span class="delimiter">[</span>interactive<span class="delimiter">]</span> <span class="keyword">final</span> <span class="keyword">def</span> <a title="()Unit" id="124396">backgroundCompile</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#124322" title="(msg: =&gt; String)Unit">informIDE</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Starting new presentation compiler type checking pass&quot;)" class="string">&quot;Starting new presentation compiler type checking pass&quot;</span><span class="delimiter">)</span>
    <a href="#124592" title="scala.tools.nsc.reporters.Reporter">reporter</a>.<a href="../reporters/Reporter.scala.html#68012" title="()Unit">reset</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="comment">// remove any files in first that are no longer maintained by presentation compiler (i.e. closed)</span>
    <a href="#124341" title="(x$1: List[scala.tools.nsc.util.SourceFile])Unit">allSources</a> = <a href="#124341" title="=&gt; List[scala.tools.nsc.util.SourceFile]">allSources</a> <span title="(p: scala.tools.nsc.util.SourceFile =&gt; Boolean)List[scala.tools.nsc.util.SourceFile]">filter</span> <span class="delimiter">(</span><a title="scala.tools.nsc.util.SourceFile" id="313252">s</a> =&gt; <a href="#124324" title="=&gt; scala.collection.mutable.LinkedHashMap[scala.tools.nsc.io.AbstractFile,Global.this.RichCompilationUnit] with scala.collection.mutable.SynchronizedMap[scala.tools.nsc.io.AbstractFile,Global.this.RichCompilationUnit]">unitOfFile</a> <span title="(key: scala.tools.nsc.io.AbstractFile)Boolean">contains</span> <span class="delimiter">(</span><a href="#313252" title="scala.tools.nsc.util.SourceFile">s</a>.<a href="../util/SourceFile.scala.html#96521" title="=&gt; scala.tools.nsc.io.AbstractFile">file</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="comment">// ensure all loaded units are parsed</span>
    <span class="keyword">for</span> <span class="delimiter">(</span><a title="scala.tools.nsc.util.SourceFile" id="313276">s</a> &lt;- <a href="#124341" title="(f: scala.tools.nsc.util.SourceFile =&gt; Unit)Unit">allSources</a>; <a title="Global.this.RichCompilationUnit" id="313281">unit</a> &lt;- <a href="#124339" title="(s: scala.tools.nsc.util.SourceFile)Option[Global.this.RichCompilationUnit]">getUnit</a><span title="(f: Global.this.RichCompilationUnit =&gt; Unit)Unit" class="delimiter">(</span><a href="#313276" title="scala.tools.nsc.util.SourceFile">s</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#124387" title="(pos: Global.this.Position)Unit">checkForMoreWork</a><span class="delimiter">(</span><a href="../symtab/Positions.scala.html#67902" title="=&gt; tools.nsc.util.NoPosition.type">NoPosition</a><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#313281" title="Global.this.RichCompilationUnit">unit</a>.<a href="RichCompilationUnits.scala.html#309701" title="=&gt; Boolean">isUpToDate</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#313281" title="Global.this.RichCompilationUnit">unit</a>.<a href="RichCompilationUnits.scala.html#309696" title="=&gt; Int">status</a> <span title="(x: Int)Boolean">!=</span> <span title="Int(-1)">JustParsed</span><span class="delimiter">)</span> <a href="#124398" title="(unit: Global.this.RichCompilationUnit)Unit">reset</a><span class="delimiter">(</span><a href="#313281" title="Global.this.RichCompilationUnit">unit</a><span class="delimiter">)</span> <span class="comment">// reparse previously typechecked units.</span>
      <a href="#124399" title="(unit: Global.this.RichCompilationUnit)Unit">parseAndEnter</a><span class="delimiter">(</span><a href="#313281" title="Global.this.RichCompilationUnit">unit</a><span class="delimiter">)</span>
      <a href="#124397" title="()Unit">serviceParsedEntered</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="comment">// sleep window</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#124311" title="=&gt; Global.this.settings.YpresentationDelay.T">afterTypeDelay</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#124382" title="=&gt; Boolean">lastWasReload</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Long" id="313300">limit</a> = <span title="object java.lang.System">System</span>.<span title="()Long">currentTimeMillis</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Long">+</span> <a href="#124311" title="=&gt; Global.this.settings.YpresentationDelay.T">afterTypeDelay</a>
      <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><span title="object java.lang.System">System</span>.<span title="()Long">currentTimeMillis</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Long)Boolean">&lt;</span> <a href="#313300" title="Long">limit</a><span class="delimiter">)</span> <a href="#313305" title="()Unit" class="delimiter">{</a>
        <span title="object java.lang.Thread">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><span title="Long(10L)">SleepTime</span><span class="delimiter">)</span>
        <a href="#124387" title="(pos: Global.this.Position)Unit">checkForMoreWork</a><span class="delimiter">(</span><a href="../symtab/Positions.scala.html#67902" title="=&gt; tools.nsc.util.NoPosition.type">NoPosition</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="comment">// ensure all loaded units are typechecked</span>
    <span class="keyword">for</span> <span class="delimiter">(</span><a title="scala.tools.nsc.util.SourceFile" id="313333">s</a> &lt;- <a href="#124341" title="(f: scala.tools.nsc.util.SourceFile =&gt; Unit)Unit">allSources</a>; <a title="Global.this.RichCompilationUnit" id="313337">unit</a> &lt;- <a href="#124339" title="(s: scala.tools.nsc.util.SourceFile)Option[Global.this.RichCompilationUnit]">getUnit</a><span title="(f: Global.this.RichCompilationUnit =&gt; Unit)Unit" class="delimiter">(</span><a href="#313333" title="scala.tools.nsc.util.SourceFile">s</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#313337" title="Global.this.RichCompilationUnit">unit</a>.<a href="RichCompilationUnits.scala.html#309701" title="=&gt; Boolean">isUpToDate</a><span class="delimiter">)</span> <a href="#124400" title="(unit: Global.this.RichCompilationUnit)Unit">typeCheck</a><span class="delimiter">(</span><a href="#313337" title="Global.this.RichCompilationUnit">unit</a><span class="delimiter">)</span>
      <span class="keyword">else</span> <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;already up to date: &quot;)" class="string">&quot;already up to date: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#313337" title="Global.this.RichCompilationUnit">unit</a><span class="delimiter">)</span>
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="Global.this.Response[Global.this.Tree]" id="313373">r</a> &lt;- <a href="#124329" title="(key: scala.tools.nsc.util.SourceFile)scala.collection.immutable.Set[Global.this.Response[Global.this.Tree]]">waitLoadedTypeResponses</a><span title="(f: Global.this.Response[Global.this.Tree] =&gt; Unit)Unit" class="delimiter">(</span><a href="#313337" title="Global.this.RichCompilationUnit">unit</a>.<a href="../CompilationUnits.scala.html#96423" title="=&gt; scala.tools.nsc.util.SourceFile">source</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#313373" title="Global.this.Response[Global.this.Tree]">r</a> <a href="Response.scala.html#124723" title="(x: Global.this.Tree)Unit">set</a> <a href="#313337" title="Global.this.RichCompilationUnit">unit</a>.<a href="../CompilationUnits.scala.html#96431" title="=&gt; Global.this.Tree">body</a>
      <a href="#124397" title="()Unit">serviceParsedEntered</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
        
    <span class="comment">// clean out stale waiting responses</span>
    <a href="#124335" title="()Unit">cleanAllResponses</a><span class="delimiter">(</span><span class="delimiter">)</span>
 
    <span class="comment">// wind down</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#124329" title="=&gt; Global.this.ResponseMap">waitLoadedTypeResponses</a>.<span title="=&gt; Boolean">nonEmpty</span> <span title="(x: Boolean)Boolean">||</span> <a href="#124332" title="=&gt; Global.this.ResponseMap">getParsedEnteredResponses</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="comment">// need another cycle to treat those</span>
      <a href="#124433" title="()Unit">newTyperRun</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#124396" title="()Unit">backgroundCompile</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#124347" title="(x$1: Boolean)Unit">outOfDate</a> = <span title="Boolean(false)" class="keyword">false</span>
      <a href="#124322" title="(msg: =&gt; String)Unit">informIDE</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Everything is now up to date&quot;)" class="string">&quot;Everything is now up to date&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>  
  <span class="delimiter">}</span>

  <span class="comment">/** Service all pending getParsedEntered requests
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="124397">serviceParsedEntered</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Boolean" id="313379">atOldRun</a> = <span title="Boolean(true)" class="keyword">true</span>
    <span class="keyword">for</span> <span class="delimiter">(</span><span class="delimiter">(</span><a title="scala.tools.nsc.util.SourceFile" id="313435">source</a>, <a title="scala.collection.immutable.Set[Global.this.Response[Global.this.Tree]]" id="313436">rs</a><span class="delimiter">)</span> &lt;- <a href="#124332" title="(f: (scala.tools.nsc.util.SourceFile, scala.collection.immutable.Set[Global.this.Response[Global.this.Tree]]) =&gt; Unit)Unit">getParsedEnteredResponses</a>; <a title="Global.this.Response[Global.this.Tree]" id="313453">r</a> &lt;- <a href="#313436" title="(f: Global.this.Response[Global.this.Tree] =&gt; Unit)Unit">rs</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#313379" title="Boolean">atOldRun</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#124433" title="()Unit">newTyperRun</a><span class="delimiter">(</span><span class="delimiter">)</span>; <a href="#313379" title="Boolean">atOldRun</a> = <span title="Boolean(false)" class="keyword">false</span> <span class="delimiter">}</span>
      <a href="#124430" title="(source: scala.tools.nsc.util.SourceFile, response: Global.this.Response[Global.this.Tree])Unit">getParsedEnteredNow</a><span class="delimiter">(</span><a href="#313435" title="scala.tools.nsc.util.SourceFile">source</a>, <a href="#313453" title="Global.this.Response[Global.this.Tree]">r</a><span class="delimiter">)</span>  
    <span class="delimiter">}</span>
    <a href="#124332" title="=&gt; Global.this.ResponseMap">getParsedEnteredResponses</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  
  <span class="comment">/** Reset unit to unloaded state */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(unit: Global.this.RichCompilationUnit)Unit" id="124398">reset</a><span class="delimiter">(</span><a title="Global.this.RichCompilationUnit" id="313289">unit</a>: <a href="RichCompilationUnits.scala.html#124544" title="Global.this.RichCompilationUnit">RichCompilationUnit</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#313289" title="Global.this.RichCompilationUnit">unit</a>.<a href="../CompilationUnits.scala.html#96439" title="=&gt; scala.collection.mutable.HashSet[Global.this.Symbol]">depends</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#313289" title="Global.this.RichCompilationUnit">unit</a>.<a href="../CompilationUnits.scala.html#96441" title="=&gt; scala.collection.mutable.HashSet[Global.this.Symbol]">defined</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#313289" title="Global.this.RichCompilationUnit">unit</a>.<a href="../CompilationUnits.scala.html#96443" title="=&gt; scala.collection.mutable.HashMap[Global.this.Symbol,Global.this.Tree]">synthetics</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#313289" title="Global.this.RichCompilationUnit">unit</a>.<a href="../CompilationUnits.scala.html#96445" title="=&gt; scala.collection.mutable.ListBuffer[() =&gt; Unit]">toCheck</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#313289" title="Global.this.RichCompilationUnit">unit</a>.<a href="RichCompilationUnits.scala.html#309711" title="(p: Global.this.Position)Unit">targetPos</a> = <a href="../symtab/Positions.scala.html#67902" title="=&gt; tools.nsc.util.NoPosition.type">NoPosition</a>
    <a href="#313289" title="Global.this.RichCompilationUnit">unit</a>.<a href="RichCompilationUnits.scala.html#309712" title="=&gt; Global.this.Contexts">contexts</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#313289" title="Global.this.RichCompilationUnit">unit</a>.<a href="RichCompilationUnits.scala.html#309705" title="=&gt; scala.collection.mutable.ArrayBuffer[scala.tools.nsc.interactive.Problem]">problems</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#313289" title="Global.this.RichCompilationUnit">unit</a>.<a href="../CompilationUnits.scala.html#96432" title="(x$1: Global.this.Tree)Unit">body</a> = <a href="#17265" title="object Global.this.EmptyTree">EmptyTree</a>
    <a href="#313289" title="Global.this.RichCompilationUnit">unit</a>.<a href="RichCompilationUnits.scala.html#309697" title="(x$1: Int)Unit">status</a> = <span title="Int(-2)">NotLoaded</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Parse unit and create a name index, unless this has already been done before */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(unit: Global.this.RichCompilationUnit)Unit" id="124399">parseAndEnter</a><span class="delimiter">(</span><a title="Global.this.RichCompilationUnit" id="313291">unit</a>: <a href="RichCompilationUnits.scala.html#124544" title="Global.this.RichCompilationUnit">RichCompilationUnit</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = 
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#313291" title="Global.this.RichCompilationUnit">unit</a>.<a href="RichCompilationUnits.scala.html#309696" title="=&gt; Int">status</a> <span title="(x: Int)Boolean">==</span> <span title="Int(-2)">NotLoaded</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;parsing: &quot;)" class="string">&quot;parsing: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#313291" title="Global.this.RichCompilationUnit">unit</a><span class="delimiter">)</span>
      <a href="#124344" title="=&gt; Global.this.TyperRun">currentTyperRun</a>.<a href="../Global.scala.html#72385" title="(unit: Global.this.CompilationUnit)Unit">compileLate</a><span class="delimiter">(</span><a href="#313291" title="Global.this.RichCompilationUnit">unit</a><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#124305" title="=&gt; Boolean">debugIDE</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#124592" title="scala.tools.nsc.reporters.Reporter">reporter</a>.<a href="../reporters/Reporter.scala.html#68004" title="=&gt; Boolean">hasErrors</a><span class="delimiter">)</span> <a href="RangePositions.scala.html#124521" title="(tree: Global.this.Tree)Unit">validatePositions</a><span class="delimiter">(</span><a href="#313291" title="Global.this.RichCompilationUnit">unit</a>.<a href="../CompilationUnits.scala.html#96431" title="=&gt; Global.this.Tree">body</a><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#313291" title="Global.this.RichCompilationUnit">unit</a>.<a href="../CompilationUnits.scala.html#96457" title="=&gt; Boolean">isJava</a><span class="delimiter">)</span> <a href="#124401" title="(unit: Global.this.RichCompilationUnit)Unit">syncTopLevelSyms</a><span class="delimiter">(</span><a href="#313291" title="Global.this.RichCompilationUnit">unit</a><span class="delimiter">)</span>
      <a href="#313291" title="Global.this.RichCompilationUnit">unit</a>.<a href="RichCompilationUnits.scala.html#309697" title="(x$1: Int)Unit">status</a> = <span title="Int(-1)">JustParsed</span>
    <span class="delimiter">}</span>
  
  <span class="comment">/** Make sure unit is typechecked
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(unit: Global.this.RichCompilationUnit)Unit" id="124400">typeCheck</a><span class="delimiter">(</span><a title="Global.this.RichCompilationUnit" id="313338">unit</a>: <a href="RichCompilationUnits.scala.html#124544" title="Global.this.RichCompilationUnit">RichCompilationUnit</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;type checking: &quot;)" class="string">&quot;type checking: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#313338" title="Global.this.RichCompilationUnit">unit</a><span class="delimiter">)</span>
    <a href="#124399" title="(unit: Global.this.RichCompilationUnit)Unit">parseAndEnter</a><span class="delimiter">(</span><a href="#313338" title="Global.this.RichCompilationUnit">unit</a><span class="delimiter">)</span>
    <a href="#313338" title="Global.this.RichCompilationUnit">unit</a>.<a href="RichCompilationUnits.scala.html#309697" title="(x$1: Int)Unit">status</a> = <span title="Int(0)">PartiallyChecked</span>
    <a href="#124344" title="=&gt; Global.this.TyperRun">currentTyperRun</a>.<a href="#311693" title="(unit: Global.this.CompilationUnit)Unit">typeCheck</a><span class="delimiter">(</span><a href="#313338" title="Global.this.RichCompilationUnit">unit</a><span class="delimiter">)</span>
    <a href="#313338" title="Global.this.RichCompilationUnit">unit</a>.<a href="RichCompilationUnits.scala.html#309716" title="(x$1: Global.this.Tree)Unit">lastBody</a> = <a href="#313338" title="Global.this.RichCompilationUnit">unit</a>.<a href="../CompilationUnits.scala.html#96431" title="=&gt; Global.this.Tree">body</a>
    <a href="#313338" title="Global.this.RichCompilationUnit">unit</a>.<a href="RichCompilationUnits.scala.html#309697" title="(x$1: Int)Unit">status</a> = <a href="../Global.scala.html#64992" title="=&gt; Int">currentRunId</a>
  <span class="delimiter">}</span>

  <span class="comment">/** Update deleted and current top-level symbols sets */</span>
  <span class="keyword">def</span> <a title="(unit: Global.this.RichCompilationUnit)Unit" id="124401">syncTopLevelSyms</a><span class="delimiter">(</span><a title="Global.this.RichCompilationUnit" id="313490">unit</a>: <a href="RichCompilationUnits.scala.html#124544" title="Global.this.RichCompilationUnit">RichCompilationUnit</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.LinkedHashSet[Global.this.Symbol]" id="313496">deleted</a> = <a href="#124365" title="=&gt; scala.collection.mutable.LinkedHashSet[Global.this.Symbol]">currentTopLevelSyms</a> <span title="(p: Global.this.Symbol =&gt; Boolean)scala.collection.mutable.LinkedHashSet[Global.this.Symbol]">filter</span> <span class="delimiter">{</span> <a title="Global.this.Symbol" id="313500">sym</a> =&gt;
      <span class="comment">/** We sync after namer phase and it resets all the top-level symbols
       *  that survive the new parsing
       *  round to NoPeriod.
       */</span>
      <a href="#313500" title="Global.this.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107643" title="=&gt; scala.tools.nsc.io.AbstractFile">sourceFile</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#313490" title="Global.this.RichCompilationUnit">unit</a>.<a href="../CompilationUnits.scala.html#96423" title="=&gt; scala.tools.nsc.util.SourceFile">source</a>.<a href="../util/SourceFile.scala.html#96521" title="=&gt; scala.tools.nsc.io.AbstractFile">file</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> 
      <a href="#313500" title="Global.this.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107401" title="=&gt; Global.this.Period">validTo</a> <span title="(x: Int)Boolean">!=</span> <span title="Int(0)">NoPeriod</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> 
      <a href="../symtab/SymbolTable.scala.html#64809" title="(period: Global.this.Period)Global.this.RunId">runId</a><span class="delimiter">(</span><a href="#313500" title="Global.this.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107401" title="=&gt; Global.this.Period">validTo</a><span class="delimiter">)</span> <span title="(x: Int)Boolean">&lt;</span> <a href="../Global.scala.html#64992" title="=&gt; Int">currentRunId</a> 
    <span class="delimiter">}</span>
    <span class="keyword">for</span> <span class="delimiter">(</span><a title="Global.this.Symbol" id="313537">d</a> &lt;- <a href="#313496" title="(f: Global.this.Symbol =&gt; scala.collection.mutable.LinkedHashSet[Global.this.Symbol])Unit">deleted</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#313537" title="Global.this.Symbol">d</a>.<a href="../symtab/Symbols.scala.html#107541" title="=&gt; Global.this.Symbol">owner</a>.<a href="../symtab/Symbols.scala.html#107564" title="=&gt; Global.this.Type">info</a>.<a href="../symtab/Types.scala.html#105487" title="=&gt; Global.this.Scope">decls</a> <a href="../symtab/Scopes.scala.html#113092" title="(sym: Global.this.Symbol)Unit">unlink</a> <a href="#313537" title="Global.this.Symbol">d</a>
      <a href="#124367" title="=&gt; scala.collection.mutable.LinkedHashSet[Global.this.Symbol] with scala.collection.mutable.SynchronizedSet[Global.this.Symbol]">deletedTopLevelSyms</a> <span title="(elem: Global.this.Symbol)Global.this.deletedTopLevelSyms.type">+=</span> <a href="#313537" title="Global.this.Symbol">d</a>
      <a href="#124365" title="=&gt; scala.collection.mutable.LinkedHashSet[Global.this.Symbol]">currentTopLevelSyms</a> <span title="(elem: Global.this.Symbol)Global.this.currentTopLevelSyms.type">-=</span> <a href="#313537" title="Global.this.Symbol">d</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
      
  <span class="comment">/** Move list of files to front of allSources */</span>
  <span class="keyword">def</span> <a title="(fs: List[scala.tools.nsc.util.SourceFile])Unit" id="124402">moveToFront</a><span class="delimiter">(</span><a title="List[scala.tools.nsc.util.SourceFile]" id="310899">fs</a>: <span title="List[scala.tools.nsc.util.SourceFile]">List</span><span class="delimiter">[</span>SourceFile<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#124341" title="(x$1: List[scala.tools.nsc.util.SourceFile])Unit">allSources</a> = <a href="#310899" title="List[scala.tools.nsc.util.SourceFile]">fs</a> <a href="#313570" title="(prefix: List[scala.tools.nsc.util.SourceFile])List[scala.tools.nsc.util.SourceFile]">:::</a> <span class="delimiter">(</span><a href="#124341" title="=&gt; List[scala.tools.nsc.util.SourceFile]">allSources</a> <span title="(that: scala.collection.GenSeq[scala.tools.nsc.util.SourceFile])List[scala.tools.nsc.util.SourceFile]">diff</span> <a href="#310899" title="List[scala.tools.nsc.util.SourceFile]">fs</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">// ----------------- Implementations of client commands -----------------------</span>
  
  <span class="keyword">def</span> <a title="[T](result: Global.this.Response[T])(op: =&gt; T)Unit" id="124403">respond</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="124405">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="Global.this.Response[T]" id="310403">result</a>: <a href="Response.scala.html#17903" title="Global.this.Response[T]">Response</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="=&gt; T" id="310404">op</a>: =&gt; T<span class="delimiter">)</span>: <span title="Unit">Unit</span> = 
    <a href="#124406" title="(response: Global.this.Response[T])(op: =&gt; Stream[T])Unit">respondGradually</a><span class="delimiter">(</span><a href="#310403" title="Global.this.Response[T]">result</a><span class="delimiter">)</span><span class="delimiter">(</span><span title="(xs: T*)scala.collection.immutable.Stream[T]">Stream</span><span class="delimiter">(</span><a href="#310404" title="=&gt; T">op</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="[T](response: Global.this.Response[T])(op: =&gt; Stream[T])Unit" id="124406">respondGradually</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="124408">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="Global.this.Response[T]" id="313594">response</a>: <a href="Response.scala.html#17903" title="Global.this.Response[T]">Response</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="=&gt; Stream[T]" id="313595">op</a>: =&gt; Stream<span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.tools.nsc.interactive.Response[_]" id="313613">prevResponse</a> = <a href="#124360" title="=&gt; Global.this.Response[_]">pendingResponse</a>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#124360" title="(x$1: Global.this.Response[_])Unit">pendingResponse</a> = <a href="#313594" title="Global.this.Response[T]">response</a>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#313594" title="Global.this.Response[T]">response</a>.<a href="Response.scala.html#124729" title="=&gt; Boolean">isCancelled</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">var</span> <a title="Stream[T]" id="313617">results</a> = <a href="#313595" title="=&gt; Stream[T]">op</a>
        <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#313594" title="Global.this.Response[T]">response</a>.<a href="Response.scala.html#124729" title="=&gt; Boolean">isCancelled</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#313617" title="Stream[T]">results</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <a href="#313618" title="()Unit" class="delimiter">{</a>
          <span class="keyword">val</span> <a title="T" id="313642">result</a> = <a href="#313617" title="Stream[T]">results</a>.<span title="=&gt; T">head</span>
          <a href="#313617" title="Stream[T]">results</a> = <a href="#313617" title="Stream[T]">results</a>.<span title="=&gt; scala.collection.immutable.Stream[T]">tail</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#313617" title="Stream[T]">results</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#313594" title="Global.this.Response[T]">response</a> <a href="Response.scala.html#124723" title="(x: T)Unit">set</a> <a href="#313642" title="T">result</a>
            <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;responded&quot;)" class="string">&quot;responded&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#124320" title="=&gt; java.lang.String">timeStep</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#313594" title="Global.this.Response[T]">response</a> <a href="Response.scala.html#124722" title="(x: T)Unit">setProvisionally</a> <a href="#313642" title="T">result</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#315120" title="Unit">CancelException</a> =&gt;
        <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;cancelled&quot;)" class="string">&quot;cancelled&quot;</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="Nothing" id="313685">ex</a>: <a href="CompilerControl.scala.html#17870" title="scala.tools.nsc.interactive.FreshRunReq">FreshRunReq</a> =&gt;
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#124305" title="=&gt; Boolean">debugIDE</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;FreshRunReq thrown during response&quot;)" class="string">&quot;FreshRunReq thrown during response&quot;</span><span class="delimiter">)</span>
          <a href="#313685" title="scala.tools.nsc.interactive.FreshRunReq">ex</a>.<span title="()Unit">printStackTrace</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#313594" title="Global.this.Response[T]">response</a> <a href="Response.scala.html#124724" title="(exc: Throwable)Unit">raise</a> <a href="#313685" title="scala.tools.nsc.interactive.FreshRunReq">ex</a>
        <span title="Nothing" class="keyword">throw</span> <a href="#313685" title="scala.tools.nsc.interactive.FreshRunReq">ex</a>
      <span class="keyword">case</span> <a title="Unit" id="313690">ex</a> =&gt;
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#124305" title="=&gt; Boolean">debugIDE</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;exception thrown during response: &quot;)" class="string">&quot;exception thrown during response: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#313690" title="java.lang.Throwable">ex</a><span class="delimiter">)</span>
          <a href="#313690" title="java.lang.Throwable">ex</a>.<span title="()Unit">printStackTrace</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#313594" title="Global.this.Response[T]">response</a> <a href="Response.scala.html#124724" title="(exc: Throwable)Unit">raise</a> <a href="#313690" title="java.lang.Throwable">ex</a>
    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#124360" title="(x$1: Global.this.Response[_])Unit">pendingResponse</a> = <a href="#313613" title="scala.tools.nsc.interactive.Response[_]">prevResponse</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(source: scala.tools.nsc.util.SourceFile)Unit" id="124409">reloadSource</a><span class="delimiter">(</span><a title="scala.tools.nsc.util.SourceFile" id="313697">source</a>: <a href="../util/SourceFile.scala.html#30381" title="scala.tools.nsc.util.SourceFile">SourceFile</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Global.this.RichCompilationUnit" id="313699">unit</a> = <span title="Global.this.RichCompilationUnit" class="keyword">new</span> <a href="RichCompilationUnits.scala.html#124544" title="Global.this.RichCompilationUnit">RichCompilationUnit</a><span class="delimiter">(</span><a href="#313697" title="scala.tools.nsc.util.SourceFile">source</a><span class="delimiter">)</span>
    <a href="#124324" title="(key: scala.tools.nsc.io.AbstractFile, value: Global.this.RichCompilationUnit)Unit">unitOfFile</a><span class="delimiter">(</span><a href="#313697" title="scala.tools.nsc.util.SourceFile">source</a>.<a href="../util/SourceFile.scala.html#96521" title="=&gt; scala.tools.nsc.io.AbstractFile">file</a><span class="delimiter">)</span> = <a href="#313699" title="Global.this.RichCompilationUnit">unit</a>
    <a href="#124398" title="(unit: Global.this.RichCompilationUnit)Unit">reset</a><span class="delimiter">(</span><a href="#313699" title="Global.this.RichCompilationUnit">unit</a><span class="delimiter">)</span>
    <span class="comment">//parseAndEnter(unit)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Make sure a set of compilation units is loaded and parsed */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sources: List[scala.tools.nsc.util.SourceFile])Unit" id="124410">reloadSources</a><span class="delimiter">(</span><a title="List[scala.tools.nsc.util.SourceFile]" id="313704">sources</a>: <span title="List[scala.tools.nsc.util.SourceFile]">List</span><span class="delimiter">[</span>SourceFile<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#124433" title="()Unit">newTyperRun</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#124352" title="(x$1: Int)Unit">minRunId</a> = <a href="../Global.scala.html#64992" title="=&gt; Int">currentRunId</a>
    <a href="#313704" title="List[scala.tools.nsc.util.SourceFile]">sources</a> <span title="(f: scala.tools.nsc.util.SourceFile =&gt; Unit)Unit">foreach</span> <a href="#124409" title="(source: scala.tools.nsc.util.SourceFile)Unit">reloadSource</a>
    <a href="#124402" title="(fs: List[scala.tools.nsc.util.SourceFile])Unit">moveToFront</a><span class="delimiter">(</span><a href="#313704" title="List[scala.tools.nsc.util.SourceFile]">sources</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Make sure a set of compilation units is loaded and parsed */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>interactive<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(sources: List[scala.tools.nsc.util.SourceFile], response: Global.this.Response[Unit])Unit" id="124411">reload</a><span class="delimiter">(</span><a title="List[scala.tools.nsc.util.SourceFile]" id="310701">sources</a>: <span title="List[scala.tools.nsc.util.SourceFile]">List</span><span class="delimiter">[</span>SourceFile<span class="delimiter">]</span>, <a title="Global.this.Response[Unit]" id="310702">response</a>: <a href="Response.scala.html#17903" title="Global.this.Response[Unit]">Response</a><span class="delimiter">[</span>Unit<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#124322" title="(msg: =&gt; String)Unit">informIDE</a><span class="delimiter">(</span><span title="java.lang.String(&quot;reload: &quot;)" class="string">&quot;reload: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#310701" title="List[scala.tools.nsc.util.SourceFile]">sources</a><span class="delimiter">)</span>
    <a href="#124382" title="(x$1: Boolean)Unit">lastWasReload</a> = <span title="Boolean(true)" class="keyword">true</span>
    <a href="#124403" title="(result: Global.this.Response[Unit])(op: =&gt; Unit)Unit">respond</a><span class="delimiter">(</span><a href="#310702" title="Global.this.Response[Unit]">response</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#124410" title="(sources: List[scala.tools.nsc.util.SourceFile])Unit">reloadSources</a><span class="delimiter">(</span><a href="#310701" title="List[scala.tools.nsc.util.SourceFile]">sources</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#124350" title="()Unit">demandNewCompilerRun</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span><span class="delimiter">[</span>interactive<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(sources: List[scala.tools.nsc.util.SourceFile], response: Global.this.Response[Unit])Unit" id="124412">filesDeleted</a><span class="delimiter">(</span><a title="List[scala.tools.nsc.util.SourceFile]" id="310773">sources</a>: <span title="List[scala.tools.nsc.util.SourceFile]">List</span><span class="delimiter">[</span>SourceFile<span class="delimiter">]</span>, <a title="Global.this.Response[Unit]" id="310774">response</a>: <a href="Response.scala.html#17903" title="Global.this.Response[Unit]">Response</a><span class="delimiter">[</span>Unit<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#124322" title="(msg: =&gt; String)Unit">informIDE</a><span class="delimiter">(</span><span title="java.lang.String(&quot;files deleted: &quot;)" class="string">&quot;files deleted: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#310773" title="List[scala.tools.nsc.util.SourceFile]">sources</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.immutable.Set[scala.tools.nsc.io.AbstractFile]" id="313734">deletedFiles</a> = <a href="#310773" title="List[scala.tools.nsc.util.SourceFile]">sources</a>.<span title="(f: scala.tools.nsc.util.SourceFile =&gt; scala.tools.nsc.io.AbstractFile)(implicit bf: scala.collection.generic.CanBuildFrom[List[scala.tools.nsc.util.SourceFile],scala.tools.nsc.io.AbstractFile,List[scala.tools.nsc.io.AbstractFile]])List[scala.tools.nsc.io.AbstractFile]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,scala.tools.nsc.io.AbstractFile,List[scala.tools.nsc.io.AbstractFile]]" class="delimiter">(</span><a href="#313752" title="scala.tools.nsc.util.SourceFile">_</a>.<a href="../util/SourceFile.scala.html#96521" title="=&gt; scala.tools.nsc.io.AbstractFile">file</a><span class="delimiter">)</span>.<span title="scala.collection.immutable.Set[scala.tools.nsc.io.AbstractFile]">toSet</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.LinkedHashSet[Global.this.Symbol]" id="313735">deletedSyms</a> = <a href="#124365" title="=&gt; scala.collection.mutable.LinkedHashSet[Global.this.Symbol]">currentTopLevelSyms</a> <span title="(p: Global.this.Symbol =&gt; Boolean)scala.collection.mutable.LinkedHashSet[Global.this.Symbol]">filter</span> <span class="delimiter">{</span><a title="Global.this.Symbol" id="313792">sym</a> =&gt; <a href="#313734" title="scala.collection.immutable.Set[scala.tools.nsc.io.AbstractFile]">deletedFiles</a> <span title="(elem: scala.tools.nsc.io.AbstractFile)Boolean">contains</span> <a href="#313792" title="Global.this.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107643" title="=&gt; scala.tools.nsc.io.AbstractFile">sourceFile</a><span class="delimiter">}</span>
    <span class="keyword">for</span> <span class="delimiter">(</span><a title="Global.this.Symbol" id="313814">d</a> &lt;- <a href="#313735" title="(f: Global.this.Symbol =&gt; scala.collection.mutable.LinkedHashSet[Global.this.Symbol])Unit">deletedSyms</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#313814" title="Global.this.Symbol">d</a>.<a href="../symtab/Symbols.scala.html#107541" title="=&gt; Global.this.Symbol">owner</a>.<a href="../symtab/Symbols.scala.html#107564" title="=&gt; Global.this.Type">info</a>.<a href="../symtab/Types.scala.html#105487" title="=&gt; Global.this.Scope">decls</a> <a href="../symtab/Scopes.scala.html#113092" title="(sym: Global.this.Symbol)Unit">unlink</a> <a href="#313814" title="Global.this.Symbol">d</a>
      <a href="#124367" title="=&gt; scala.collection.mutable.LinkedHashSet[Global.this.Symbol] with scala.collection.mutable.SynchronizedSet[Global.this.Symbol]">deletedTopLevelSyms</a> <span title="(elem: Global.this.Symbol)Global.this.deletedTopLevelSyms.type">+=</span> <a href="#313814" title="Global.this.Symbol">d</a>
      <a href="#124365" title="=&gt; scala.collection.mutable.LinkedHashSet[Global.this.Symbol]">currentTopLevelSyms</a> <span title="(elem: Global.this.Symbol)Global.this.currentTopLevelSyms.type">-=</span> <a href="#313814" title="Global.this.Symbol">d</a>
    <span class="delimiter">}</span>
    <a href="#310773" title="List[scala.tools.nsc.util.SourceFile]">sources</a> <span title="(f: scala.tools.nsc.util.SourceFile =&gt; Option[Global.this.RichCompilationUnit])Unit">foreach</span> <span class="delimiter">(</span><a href="CompilerControl.scala.html#124453" title="(s: scala.tools.nsc.util.SourceFile)Option[Global.this.RichCompilationUnit]">removeUnitOf</a><span class="delimiter">(</span><a href="#313844" title="scala.tools.nsc.util.SourceFile">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#124352" title="(x$1: Int)Unit">minRunId</a> = <a href="../Global.scala.html#64992" title="=&gt; Int">currentRunId</a>
    <a href="#124403" title="(result: Global.this.Response[Unit])(op: =&gt; Unit)Unit">respond</a><span class="delimiter">(</span><a href="#310774" title="Global.this.Response[Unit]">response</a><span class="delimiter">)</span> <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#124350" title="()Unit">demandNewCompilerRun</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>


  <span class="comment">/** A fully attributed tree located at position `pos` */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(pos: Global.this.Position)Global.this.Tree" id="124413">typedTreeAt</a><span class="delimiter">(</span><a title="Global.this.Position" id="313854">pos</a>: <a href="../util/Position.scala.html#30588" title="Global.this.Position">Position</a><span class="delimiter">)</span>: <span title="Global.this.Tree">Tree</span> = <a href="#124339" title="(s: scala.tools.nsc.util.SourceFile)Option[Global.this.RichCompilationUnit]">getUnit</a><span class="delimiter">(</span><a href="#313854" title="Global.this.Position">pos</a>.<a href="../util/Position.scala.html#97208" title="=&gt; scala.tools.nsc.util.SourceFile">source</a><span class="delimiter">)</span> <span title="Global.this.Tree" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="Global.this.Tree">None</span> =&gt;
      <a href="#124410" title="(sources: List[scala.tools.nsc.util.SourceFile])Unit">reloadSources</a><span class="delimiter">(</span><span title="(xs: scala.tools.nsc.util.SourceFile*)List[scala.tools.nsc.util.SourceFile]">List</span><span class="delimiter">(</span><a href="#313854" title="Global.this.Position">pos</a>.<a href="../util/Position.scala.html#97208" title="=&gt; scala.tools.nsc.util.SourceFile">source</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Global.this.Tree" id="313856">result</a> = <a href="#124413" title="(pos: Global.this.Position)Global.this.Tree">typedTreeAt</a><span class="delimiter">(</span><a href="#313854" title="Global.this.Position">pos</a><span class="delimiter">)</span>
      <a href="CompilerControl.scala.html#124453" title="(s: scala.tools.nsc.util.SourceFile)Option[Global.this.RichCompilationUnit]">removeUnitOf</a><span class="delimiter">(</span><a href="#313854" title="Global.this.Position">pos</a>.<a href="../util/Position.scala.html#97208" title="=&gt; scala.tools.nsc.util.SourceFile">source</a><span class="delimiter">)</span>
      <a href="#313856" title="Global.this.Tree">result</a>
    <span class="keyword">case</span> <span title="Global.this.Tree">Some</span><span class="delimiter">(</span><a title="Global.this.RichCompilationUnit" id="313865">unit</a><span class="delimiter">)</span> =&gt;  
      <a href="#124322" title="(msg: =&gt; String)Unit">informIDE</a><span class="delimiter">(</span><span title="java.lang.String(&quot;typedTreeAt &quot;)" class="string">&quot;typedTreeAt &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#313854" title="Global.this.Position">pos</a><span class="delimiter">)</span>
      <a href="#124399" title="(unit: Global.this.RichCompilationUnit)Unit">parseAndEnter</a><span class="delimiter">(</span><a href="#313865" title="Global.this.RichCompilationUnit">unit</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Global.this.Tree" id="313866">tree</a> = <a href="CompilerControl.scala.html#124455" title="(pos: Global.this.Position)Global.this.Tree">locateTree</a><span class="delimiter">(</span><a href="#313854" title="Global.this.Position">pos</a><span class="delimiter">)</span>
      <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;at pos &quot;)" class="string">&quot;at pos &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#313854" title="Global.this.Position">pos</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; was found: &quot;)" class="string">&quot; was found: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#313866" title="Global.this.Tree">tree</a>.<span title="()java.lang.Class[_]">getClass</span><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#313866" title="Global.this.Tree">tree</a>.<span title="=&gt; Global.this.Position">pos</span>.<a href="../util/Position.scala.html#97241" title="=&gt; String">show</a><span class="delimiter">)</span>
      <a href="#313866" title="Global.this.Tree">tree</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Unit">Import</span><span class="delimiter">(</span><a title="Global.this.Tree" id="313871">expr</a>, _<span class="delimiter">)</span> =&gt;
          <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;import found&quot;)" class="string">&quot;import found&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#313871" title="Global.this.Tree">expr</a>.<span title="=&gt; Global.this.Type">tpe</span><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#313871" title="Global.this.Tree">expr</a>.<span title="=&gt; Global.this.Type">tpe</span>.<a href="../symtab/Types.scala.html#105490" title="=&gt; List[Global.this.Symbol]">members</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
      <span class="delimiter">}</span>
      <span title="Global.this.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#124418" title="(tree: Global.this.Tree)Global.this.Type">stabilizedType</a><span class="delimiter">(</span><a href="#313866" title="Global.this.Tree">tree</a><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;already attributed: &quot;)" class="string">&quot;already attributed: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#313866" title="Global.this.Tree">tree</a>.<span title="=&gt; Global.this.Symbol">symbol</span><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#313866" title="Global.this.Tree">tree</a>.<span title="=&gt; Global.this.Type">tpe</span><span class="delimiter">)</span>
        <a href="#313866" title="Global.this.Tree">tree</a>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="#313865" title="Global.this.RichCompilationUnit">unit</a>.<a href="RichCompilationUnits.scala.html#309711" title="(p: Global.this.Position)Unit">targetPos</a> = <a href="#313854" title="Global.this.Position">pos</a>
        <span class="keyword">try</span> <span class="delimiter">{</span>
          <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;starting targeted type check&quot;)" class="string">&quot;starting targeted type check&quot;</span><span class="delimiter">)</span>
          <a href="#124400" title="(unit: Global.this.RichCompilationUnit)Unit">typeCheck</a><span class="delimiter">(</span><a href="#313865" title="Global.this.RichCompilationUnit">unit</a><span class="delimiter">)</span>
          <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;tree not found at &quot;)" class="string">&quot;tree not found at &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#313854" title="Global.this.Position">pos</a><span class="delimiter">)</span>
          <a href="#17265" title="object Global.this.EmptyTree">EmptyTree</a>
        <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a title="Global.this.Tree" id="313877">ex</a>: <a href="#124434" title="Global.this.TyperResult">TyperResult</a> =&gt; <span title="Global.this.Locator" class="keyword">new</span> <a href="RangePositions.scala.html#124523" title="Global.this.Locator">Locator</a><span class="delimiter">(</span><a href="#313854" title="Global.this.Position">pos</a><span class="delimiter">)</span> <a href="RangePositions.scala.html#310204" title="(root: Global.this.Tree)Global.this.Tree">locateIn</a> <a href="#313877" title="Global.this.TyperResult">ex</a>.<a href="#312218" title="=&gt; Global.this.Tree">tree</a>
        <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
          <a href="#313865" title="Global.this.RichCompilationUnit">unit</a>.<a href="RichCompilationUnits.scala.html#309711" title="(p: Global.this.Position)Unit">targetPos</a> = <a href="../symtab/Positions.scala.html#67902" title="=&gt; tools.nsc.util.NoPosition.type">NoPosition</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/** A fully attributed tree corresponding to the entire compilation unit  */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(source: scala.tools.nsc.util.SourceFile, forceReload: Boolean)Global.this.Tree" id="124414">typedTree</a><span class="delimiter">(</span><a title="scala.tools.nsc.util.SourceFile" id="313880">source</a>: <a href="../util/SourceFile.scala.html#30381" title="scala.tools.nsc.util.SourceFile">SourceFile</a>, <a title="Boolean" id="313881">forceReload</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="Global.this.Tree">Tree</span> = <span class="delimiter">{</span>
    <a href="#124322" title="(msg: =&gt; String)Unit">informIDE</a><span class="delimiter">(</span><span title="java.lang.String(&quot;typedTree &quot;)" class="string">&quot;typedTree &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#313880" title="scala.tools.nsc.util.SourceFile">source</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; forceReload: &quot;)" class="string">&quot; forceReload: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#313881" title="Boolean">forceReload</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Global.this.RichCompilationUnit" id="313883">unit</a> = <a href="#124338" title="(source: scala.tools.nsc.util.SourceFile)Global.this.RichCompilationUnit">getOrCreateUnitOf</a><span class="delimiter">(</span><a href="#313880" title="scala.tools.nsc.util.SourceFile">source</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#313881" title="Boolean">forceReload</a><span class="delimiter">)</span> <a href="#124398" title="(unit: Global.this.RichCompilationUnit)Unit">reset</a><span class="delimiter">(</span><a href="#313883" title="Global.this.RichCompilationUnit">unit</a><span class="delimiter">)</span>
    <a href="#124399" title="(unit: Global.this.RichCompilationUnit)Unit">parseAndEnter</a><span class="delimiter">(</span><a href="#313883" title="Global.this.RichCompilationUnit">unit</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#313883" title="Global.this.RichCompilationUnit">unit</a>.<a href="RichCompilationUnits.scala.html#309696" title="=&gt; Int">status</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(0)">PartiallyChecked</span><span class="delimiter">)</span> <a href="#124400" title="(unit: Global.this.RichCompilationUnit)Unit">typeCheck</a><span class="delimiter">(</span><a href="#313883" title="Global.this.RichCompilationUnit">unit</a><span class="delimiter">)</span>
    <a href="#313883" title="Global.this.RichCompilationUnit">unit</a>.<a href="../CompilationUnits.scala.html#96431" title="=&gt; Global.this.Tree">body</a>
  <span class="delimiter">}</span>

  <span class="comment">/** Set sync var `response` to a fully attributed tree located at position `pos`  */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>interactive<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(pos: Global.this.Position, response: Global.this.Response[Global.this.Tree])Unit" id="124415">getTypedTreeAt</a><span class="delimiter">(</span><a title="Global.this.Position" id="310845">pos</a>: <a href="../util/Position.scala.html#30588" title="Global.this.Position">Position</a>, <a title="Global.this.Response[Global.this.Tree]" id="310846">response</a>: <a href="Response.scala.html#17903" title="Global.this.Response[Global.this.Tree]">Response</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#124403" title="(result: Global.this.Response[Global.this.Tree])(op: =&gt; Global.this.Tree)Unit">respond</a><span class="delimiter">(</span><a href="#310846" title="Global.this.Response[Global.this.Tree]">response</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#124413" title="(pos: Global.this.Position)Global.this.Tree">typedTreeAt</a><span class="delimiter">(</span><a href="#310845" title="Global.this.Position">pos</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Set sync var `response` to a fully attributed tree corresponding to the
   *  entire compilation unit  */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>interactive<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(source: scala.tools.nsc.util.SourceFile, forceReload: Boolean, response: Global.this.Response[Global.this.Tree])Unit" id="124416">getTypedTree</a><span class="delimiter">(</span><a title="scala.tools.nsc.util.SourceFile" id="310859">source</a>: <a href="../util/SourceFile.scala.html#30381" title="scala.tools.nsc.util.SourceFile">SourceFile</a>, <a title="Boolean" id="310860">forceReload</a>: <span title="Boolean">Boolean</span>, <a title="Global.this.Response[Global.this.Tree]" id="310861">response</a>: <a href="Response.scala.html#17903" title="Global.this.Response[Global.this.Tree]">Response</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#124403" title="(result: Global.this.Response[Global.this.Tree])(op: =&gt; Global.this.Tree)Unit">respond</a><span class="delimiter">(</span><a href="#310861" title="Global.this.Response[Global.this.Tree]">response</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#124414" title="(source: scala.tools.nsc.util.SourceFile, forceReload: Boolean)Global.this.Tree">typedTree</a><span class="delimiter">(</span><a href="#310859" title="scala.tools.nsc.util.SourceFile">source</a>, <a href="#310860" title="Boolean">forceReload</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Implements CompilerControl.askLinkPos */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>interactive<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(sym: Global.this.Symbol, source: scala.tools.nsc.util.SourceFile, response: Global.this.Response[Global.this.Position])Unit" id="124417">getLinkPos</a><span class="delimiter">(</span><a title="Global.this.Symbol" id="310917">sym</a>: <a href="../symtab/Symbols.scala.html#67331" title="Global.this.Symbol">Symbol</a>, <a title="scala.tools.nsc.util.SourceFile" id="310918">source</a>: <a href="../util/SourceFile.scala.html#30381" title="scala.tools.nsc.util.SourceFile">SourceFile</a>, <a title="Global.this.Response[Global.this.Position]" id="310919">response</a>: <a href="Response.scala.html#17903" title="Global.this.Response[Global.this.Position]">Response</a><span class="delimiter">[</span>Position<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#124322" title="(msg: =&gt; String)Unit">informIDE</a><span class="delimiter">(</span><span title="java.lang.String(&quot;getLinkPos &quot;)" class="string">&quot;getLinkPos &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#310917" title="Global.this.Symbol">sym</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#310918" title="scala.tools.nsc.util.SourceFile">source</a><span class="delimiter">)</span>
    <a href="#124403" title="(result: Global.this.Response[Global.this.Position])(op: =&gt; Global.this.Position)Unit">respond</a><span class="delimiter">(</span><a href="#310919" title="Global.this.Response[Global.this.Position]">response</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Boolean" id="313909">preExisting</a> = <a href="#124324" title="=&gt; scala.collection.mutable.LinkedHashMap[scala.tools.nsc.io.AbstractFile,Global.this.RichCompilationUnit] with scala.collection.mutable.SynchronizedMap[scala.tools.nsc.io.AbstractFile,Global.this.RichCompilationUnit]">unitOfFile</a> <span title="(key: scala.tools.nsc.io.AbstractFile)Boolean">isDefinedAt</span> <a href="#310918" title="scala.tools.nsc.util.SourceFile">source</a>.<a href="../util/SourceFile.scala.html#96521" title="=&gt; scala.tools.nsc.io.AbstractFile">file</a>
      <span class="keyword">val</span> <a title="List[Global.this.Symbol]" id="313910">originalTypeParams</a> = <a href="#310917" title="Global.this.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107541" title="=&gt; Global.this.Symbol">owner</a>.<a href="../symtab/Symbols.scala.html#107579" title="=&gt; List[Global.this.Symbol]">typeParams</a>
      <a href="#124410" title="(sources: List[scala.tools.nsc.util.SourceFile])Unit">reloadSources</a><span class="delimiter">(</span><span title="(xs: scala.tools.nsc.util.SourceFile*)List[scala.tools.nsc.util.SourceFile]">List</span><span class="delimiter">(</span><a href="#310918" title="scala.tools.nsc.util.SourceFile">source</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#124399" title="(unit: Global.this.RichCompilationUnit)Unit">parseAndEnter</a><span class="delimiter">(</span><a href="#124339" title="(s: scala.tools.nsc.util.SourceFile)Option[Global.this.RichCompilationUnit]">getUnit</a><span class="delimiter">(</span><a href="#310918" title="scala.tools.nsc.util.SourceFile">source</a><span class="delimiter">)</span>.<span title="=&gt; Global.this.RichCompilationUnit">get</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Global.this.Symbol" id="313911">owner</a> = <a href="#310917" title="Global.this.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107541" title="=&gt; Global.this.Symbol">owner</a>
      <span title="Global.this.Position" class="keyword">if</span> <span class="delimiter">(</span><a href="#313911" title="Global.this.Symbol">owner</a>.<span title="=&gt; Boolean">isClass</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Global.this.Type" id="313922">pre</a> = <a href="../symtab/Types.scala.html#313926" title="(tp: Global.this.Type)Global.this.Type">adaptToNewRunMap</a><span class="delimiter">(</span><a href="../symtab/Types.scala.html#148254" title="(sym: Global.this.Symbol)Global.this.Type">ThisType</a><span class="delimiter">(</span><a href="#313911" title="Global.this.Symbol">owner</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Global.this.Symbol" id="313923">newsym</a> = <a href="#313922" title="Global.this.Type">pre</a>.<a href="../symtab/Types.scala.html#105488" title="(name: Global.this.Name)Global.this.Symbol">decl</a><span class="delimiter">(</span><a href="#310917" title="Global.this.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107548" title="=&gt; Global.this.Name">name</a><span class="delimiter">)</span> <a href="../symtab/Symbols.scala.html#107592" title="(cond: Global.this.Symbol =&gt; Boolean)Global.this.Symbol">filter</a> <span class="delimiter">{</span> <a title="Global.this.Symbol" id="313938">alt</a> =&gt;
          <a href="#310917" title="Global.this.Symbol">sym</a>.<span title="=&gt; Boolean">isType</span> <span title="(x: Boolean)Boolean">||</span> <span class="delimiter">{</span>
            <span class="keyword">try</span> <span class="delimiter">{</span>
              <span class="keyword">val</span> <a title="Global.this.Type" id="313939">tp1</a> = <a href="#313922" title="Global.this.Type">pre</a>.<a href="../symtab/Types.scala.html#105502" title="(sym: Global.this.Symbol)Global.this.Type">memberType</a><a href="#124435" title="(x: =&gt; Global.this.Type)Global.this.OnTypeError[Global.this.Type]" class="delimiter">(</a><a href="#313938" title="Global.this.Symbol">alt</a><span class="delimiter">)</span> <a href="#310009" title="(alt: =&gt; Global.this.Type)Global.this.Type">onTypeError</a> <a href="../symtab/Types.scala.html#67406" title="object Global.this.NoType">NoType</a>
              <span class="keyword">val</span> <a title="Global.this.Type" id="313940">tp2</a> = <a href="../symtab/Types.scala.html#313926" title="(tp: Global.this.Type)Global.this.Type">adaptToNewRunMap</a><span class="delimiter">(</span><a href="#310917" title="Global.this.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107562" title="=&gt; Global.this.Type">tpe</a><span class="delimiter">)</span> <a href="../symtab/Types.scala.html#105505" title="(from: List[Global.this.Symbol], to: List[Global.this.Symbol])Global.this.Type">substSym</a> <span class="delimiter">(</span><a href="#313910" title="List[Global.this.Symbol]">originalTypeParams</a>, <a href="#313911" title="Global.this.Symbol">owner</a>.<a href="../symtab/Symbols.scala.html#107579" title="=&gt; List[Global.this.Symbol]">typeParams</a><span class="delimiter">)</span>
              <a href="../symtab/Types.scala.html#67616" title="(tp1: Global.this.Type, tp2: Global.this.Type, alwaysMatchSimple: Boolean)Boolean">matchesType</a><span class="delimiter">(</span><a href="#313939" title="Global.this.Type">tp1</a>, <a href="#313940" title="Global.this.Type">tp2</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <a title="Boolean" id="313989">ex</a>: <span title="Throwable">Throwable</span> =&gt;
                <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;error in hyperlinking: &quot;)" class="string">&quot;error in hyperlinking: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#313989" title="java.lang.Throwable">ex</a><span class="delimiter">)</span>
                <a href="#313989" title="java.lang.Throwable">ex</a>.<span title="()Unit">printStackTrace</span><span class="delimiter">(</span><span class="delimiter">)</span>
                <span title="Boolean(false)" class="keyword">false</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#313909" title="Boolean">preExisting</a><span class="delimiter">)</span> <a href="CompilerControl.scala.html#124453" title="(s: scala.tools.nsc.util.SourceFile)Option[Global.this.RichCompilationUnit]">removeUnitOf</a><span class="delimiter">(</span><a href="#310918" title="scala.tools.nsc.util.SourceFile">source</a><span class="delimiter">)</span>
        <span title="Global.this.Position" class="keyword">if</span> <span class="delimiter">(</span><a href="#313923" title="Global.this.Symbol">newsym</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../symtab/Symbols.scala.html#67339" title="object Global.this.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;link not found &quot;)" class="string">&quot;link not found &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#310917" title="Global.this.Symbol">sym</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#310918" title="scala.tools.nsc.util.SourceFile">source</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#313922" title="Global.this.Type">pre</a><span class="delimiter">)</span>
          <a href="../symtab/Positions.scala.html#67902" title="=&gt; tools.nsc.util.NoPosition.type">NoPosition</a>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Global.this.Position" class="keyword">if</span> <span class="delimiter">(</span><a href="#313923" title="Global.this.Symbol">newsym</a>.<span title="=&gt; Boolean">isOverloaded</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#124591" title="scala.tools.nsc.Settings">settings</a>.<a href="../settings/StandardScalaSettings.scala.html#36879" title="=&gt; Global.this.settings.BooleanSetting">uniqid</a>.<a href="../settings/MutableSettings.scala.html#42150" title="(arg: Global.this.settings.uniqid.T)Unit">value</a> = <span title="Boolean(true)" class="keyword">true</span>
          <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;link ambiguous &quot;)" class="string">&quot;link ambiguous &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#310917" title="Global.this.Symbol">sym</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#310918" title="scala.tools.nsc.util.SourceFile">source</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#313922" title="Global.this.Type">pre</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#313923" title="Global.this.Symbol">newsym</a>.<a href="../symtab/Symbols.scala.html#107591" title="=&gt; List[Global.this.Symbol]">alternatives</a><span class="delimiter">)</span>
          <a href="../symtab/Positions.scala.html#67902" title="=&gt; tools.nsc.util.NoPosition.type">NoPosition</a>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;link found for &quot;)" class="string">&quot;link found for &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#313923" title="Global.this.Symbol">newsym</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#313923" title="Global.this.Symbol">newsym</a>.<a href="../symtab/Symbols.scala.html#107404" title="=&gt; Global.this.Position">pos</a><span class="delimiter">)</span>
          <a href="#313923" title="Global.this.Symbol">newsym</a>.<a href="../symtab/Symbols.scala.html#107404" title="=&gt; Global.this.Position">pos</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;link not in class &quot;)" class="string">&quot;link not in class &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#310917" title="Global.this.Symbol">sym</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#310918" title="scala.tools.nsc.util.SourceFile">source</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#313911" title="Global.this.Symbol">owner</a><span class="delimiter">)</span>
        <a href="../symtab/Positions.scala.html#67902" title="=&gt; tools.nsc.util.NoPosition.type">NoPosition</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(tree: Global.this.Tree)Global.this.Type" id="124418">stabilizedType</a><span class="delimiter">(</span><a title="Global.this.Tree" id="313872">tree</a>: <span title="Global.this.Tree">Tree</span><span class="delimiter">)</span>: <a href="../symtab/Types.scala.html#67392" title="Global.this.Type">Type</a> = <a href="#313872" title="Global.this.Tree">tree</a> <span title="Global.this.Type" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="Global.this.Type">Ident</span><span class="delimiter">(</span>_<span class="delimiter">)</span> <span class="keyword">if</span> <a href="#313872" title="Global.this.Tree">tree</a>.<span title="=&gt; Global.this.Symbol">symbol</span>.<a href="../symtab/Symbols.scala.html#107514" title="=&gt; Boolean">isStable</a> =&gt; 
      <a href="../symtab/Types.scala.html#67479" title="(pre: Global.this.Type, sym: Global.this.Symbol)Global.this.Type">singleType</a><span class="delimiter">(</span><a href="../symtab/Types.scala.html#67408" title="object Global.this.NoPrefix">NoPrefix</a>, <a href="#313872" title="Global.this.Tree">tree</a>.<span title="=&gt; Global.this.Symbol">symbol</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <span title="Global.this.Type">Select</span><span class="delimiter">(</span><a title="Global.this.Tree" id="314017">qual</a>, _<span class="delimiter">)</span> <span class="keyword">if</span> <a href="#314017" title="Global.this.Tree">qual</a>.<span title="=&gt; Global.this.Type">tpe</span> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#313872" title="Global.this.Tree">tree</a>.<span title="=&gt; Global.this.Symbol">symbol</span>.<a href="../symtab/Symbols.scala.html#107514" title="=&gt; Boolean">isStable</a> =&gt; 
      <a href="../symtab/Types.scala.html#67479" title="(pre: Global.this.Type, sym: Global.this.Symbol)Global.this.Type">singleType</a><span class="delimiter">(</span><a href="#314017" title="Global.this.Tree">qual</a>.<span title="=&gt; Global.this.Type">tpe</span>, <a href="#313872" title="Global.this.Tree">tree</a>.<span title="=&gt; Global.this.Symbol">symbol</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <span title="Global.this.Type">Import</span><span class="delimiter">(</span><a title="Global.this.Tree" id="314025">expr</a>, <a title="List[Global.this.ImportSelector]" id="314026">selectors</a><span class="delimiter">)</span> =&gt;
      <a href="#313872" title="Global.this.Tree">tree</a>.<span title="=&gt; Global.this.Symbol">symbol</span>.<a href="../symtab/Symbols.scala.html#107564" title="=&gt; Global.this.Type">info</a> <span title="Global.this.Type" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Global.this.Type">analyzer</span>.ImportType<span class="delimiter">(</span><a title="Global.this.analyzer.global.Tree" id="314029">expr</a><span class="delimiter">)</span> =&gt; <a href="#314029" title="Global.this.analyzer.global.Tree">expr</a> <span title="Global.this.Type" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a title="Global.this.Type" id="314030">s</a>@Select<span class="delimiter">(</span><a title="Global.this.Tree" id="314034">qual</a>, <a title="Global.this.Name" id="314035">name</a><span class="delimiter">)</span> =&gt; <a href="../symtab/Types.scala.html#67479" title="(pre: Global.this.Type, sym: Global.this.Symbol)Global.this.Type">singleType</a><span class="delimiter">(</span><a href="#314034" title="Global.this.Tree">qual</a>.<span title="=&gt; Global.this.Type">tpe</span>, <a href="#314030" title="Global.this.Select">s</a>.<span title="=&gt; Global.this.Symbol">symbol</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a title="Global.this.Type" id="314036">i</a> : <span title="Global.this.Ident">Ident</span> =&gt; <a href="#314036" title="Global.this.Ident">i</a>.<span title="=&gt; Global.this.Type">tpe</span>
          <span class="keyword">case</span> <span title="Global.this.Type">_</span> =&gt; <a href="#313872" title="Global.this.Tree">tree</a>.<span title="=&gt; Global.this.Type">tpe</span>
        <span class="delimiter">}</span>
        <span class="keyword">case</span> <span title="Global.this.Type">_</span> =&gt; <a href="#313872" title="Global.this.Tree">tree</a>.<span title="=&gt; Global.this.Type">tpe</span>
      <span class="delimiter">}</span>
    
    <span class="keyword">case</span> <span title="Global.this.Type">_</span> =&gt; <a href="#313872" title="Global.this.Tree">tree</a>.<span title="=&gt; Global.this.Type">tpe</span>
  <span class="delimiter">}</span>

  <span class="keyword">import</span> <a href="../Global.scala.html#64911" title="object Global.this.analyzer">analyzer</a>.<span class="delimiter">{</span>SearchResult, ImplicitSearch<span class="delimiter">}</span>

  <span class="keyword">private</span><span class="delimiter">[</span>interactive<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(pos: Global.this.Position, response: Global.this.Response[List[Global.this.Member]])Unit" id="124420">getScopeCompletion</a><span class="delimiter">(</span><a title="Global.this.Position" id="310887">pos</a>: <a href="../util/Position.scala.html#30588" title="Global.this.Position">Position</a>, <a title="Global.this.Response[List[Global.this.Member]]" id="310888">response</a>: <a href="Response.scala.html#17903" title="Global.this.Response[List[Global.this.Member]]">Response</a><span class="delimiter">[</span>List<span class="delimiter">[</span>Member<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#124322" title="(msg: =&gt; String)Unit">informIDE</a><span class="delimiter">(</span><span title="java.lang.String(&quot;getScopeCompletion&quot;)" class="string">&quot;getScopeCompletion&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#310887" title="Global.this.Position">pos</a><span class="delimiter">)</span>
    <a href="#124403" title="(result: Global.this.Response[List[Global.this.Member]])(op: =&gt; List[Global.this.Member])Unit">respond</a><span class="delimiter">(</span><a href="#310888" title="Global.this.Response[List[Global.this.Member]]">response</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#124425" title="(pos: Global.this.Position)List[Global.this.ScopeMember]">scopeMembers</a><span class="delimiter">(</span><a href="#310887" title="Global.this.Position">pos</a><span class="delimiter">)</span> <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Global.this.TermName" id="124421">Dollar</a> = <a href="../symtab/Names.scala.html#66914" title="(s: String)Global.this.TermName">newTermName</a><span class="delimiter">(</span><span title="java.lang.String(&quot;$&quot;)" class="string">&quot;$&quot;</span><span class="delimiter">)</span>
  
  <span class="keyword">private</span> <span class="keyword">class</span> <a title="class Members[M &lt;: Global.this.Member] extends scala.collection.mutable.LinkedHashMap[Global.this.Name,Set[M]] with ScalaObject" id="124423">Members</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Global.this.Member" id="124424">M</a> &lt;: Member<span class="delimiter">]</span> <a href="#124423" title="ScalaObject" class="keyword">extends</a> <span title="scala.collection.mutable.LinkedHashMap[Global.this.Name,Set[M]]">LinkedHashMap</span><span class="delimiter">[</span>Name, Set<span class="delimiter">[</span>M<span class="delimiter">]</span><span class="delimiter">]</span> <span class="delimiter">{</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(key: Global.this.Name)scala.collection.immutable.Set[M]" id="314047">default</a><span class="delimiter">(</span><a title="Global.this.Name" id="314069">key</a>: <a href="../symtab/Names.scala.html#66925" title="Global.this.Name">Name</a><span class="delimiter">)</span> = <span title="(elems: M*)scala.collection.immutable.Set[M]">Set</span><span class="delimiter">(</span><span class="delimiter">)</span>
    
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: Global.this.Symbol, symtpe: Global.this.Type, ms: Set[M])Option[M]" id="314048">matching</a><span class="delimiter">(</span><a title="Global.this.Symbol" id="314089">sym</a>: <a href="../symtab/Symbols.scala.html#67331" title="Global.this.Symbol">Symbol</a>, <a title="Global.this.Type" id="314090">symtpe</a>: <a href="../symtab/Types.scala.html#67392" title="Global.this.Type">Type</a>, <a title="Set[M]" id="314091">ms</a>: <span title="Set[M]">Set</span><span class="delimiter">[</span>M<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[M]">Option</span><span class="delimiter">[</span>M<span class="delimiter">]</span> = <a href="#314091" title="Set[M]">ms</a>.<span title="(p: M =&gt; Boolean)Option[M]">find</span> <span class="delimiter">{</span> <a title="M" id="314098">m</a> =&gt;
      <span class="delimiter">(</span><a href="#314098" title="M">m</a>.<a href="CompilerControl.scala.html#310443" title="=&gt; Global.this.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107548" title="=&gt; Global.this.Name">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#314089" title="Global.this.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107548" title="=&gt; Global.this.Name">name</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span class="delimiter">(</span><a href="#314098" title="M">m</a>.<a href="CompilerControl.scala.html#310443" title="=&gt; Global.this.Symbol">sym</a>.<span title="=&gt; Boolean">isType</span> <span title="(x: Boolean)Boolean">||</span> <span class="delimiter">(</span><a href="#314098" title="M">m</a>.<a href="CompilerControl.scala.html#310444" title="=&gt; Global.this.Type">tpe</a> <a href="../symtab/Types.scala.html#105522" title="(that: Global.this.Type)Boolean">matches</a> <a href="#314090" title="Global.this.Type">symtpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(m: M, sym: Global.this.Symbol, implicitlyAdded: Boolean)Boolean" id="314049">keepSecond</a><span class="delimiter">(</span><a title="M" id="314107">m</a>: <a href="#124424" title="M">M</a>, <a title="Global.this.Symbol" id="314108">sym</a>: <a href="../symtab/Symbols.scala.html#67331" title="Global.this.Symbol">Symbol</a>, <a title="Boolean" id="314109">implicitlyAdded</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = 
      <a href="#314107" title="M">m</a>.<a href="CompilerControl.scala.html#310443" title="=&gt; Global.this.Symbol">sym</a>.<span title="(mask: Long)Boolean">hasFlag</span><span class="delimiter">(</span>ACCESSOR <span title="Long(671088640L)">|</span> PARAMACCESSOR<span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> 
      <span title="=&gt; Boolean">!</span><a href="#314108" title="Global.this.Symbol">sym</a>.<span title="(mask: Long)Boolean">hasFlag</span><span class="delimiter">(</span>ACCESSOR <span title="Long(671088640L)">|</span> PARAMACCESSOR<span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
      <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#314109" title="Boolean">implicitlyAdded</a> <span title="(x: Boolean)Boolean">||</span> <a href="#314107" title="M">m</a>.<a href="CompilerControl.scala.html#310446" title="=&gt; Boolean">implicitlyAdded</a><span class="delimiter">)</span>
    
    <span class="keyword">def</span> <a title="(sym: Global.this.Symbol, pre: Global.this.Type, implicitlyAdded: Boolean)(toMember: (Global.this.Symbol, Global.this.Type) =&gt; M)Unit" id="314050">add</a><span class="delimiter">(</span><a title="Global.this.Symbol" id="314119">sym</a>: <a href="../symtab/Symbols.scala.html#67331" title="Global.this.Symbol">Symbol</a>, <a title="Global.this.Type" id="314120">pre</a>: <a href="../symtab/Types.scala.html#67392" title="Global.this.Type">Type</a>, <a title="Boolean" id="314121">implicitlyAdded</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="(Global.this.Symbol, Global.this.Type) =&gt; M" id="314122">toMember</a>: <span class="delimiter">(</span>Symbol, Type<span class="delimiter">)</span> =&gt; M<span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#314119" title="Global.this.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107466" title="=&gt; Boolean">isGetter</a> <span title="(x: Boolean)Boolean">||</span> <a href="#314119" title="Global.this.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107467" title="=&gt; Boolean">isSetter</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#314119" title="Global.this.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107603" title="=&gt; Global.this.Symbol">accessed</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../symtab/Symbols.scala.html#67339" title="object Global.this.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#314050" title="(sym: Global.this.Symbol, pre: Global.this.Type, implicitlyAdded: Boolean)(toMember: (Global.this.Symbol, Global.this.Type) =&gt; M)Unit">add</a><span class="delimiter">(</span><a href="#314119" title="Global.this.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107603" title="=&gt; Global.this.Symbol">accessed</a>, <a href="#314120" title="Global.this.Type">pre</a>, <a href="#314121" title="Boolean">implicitlyAdded</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#314122" title="(Global.this.Symbol, Global.this.Type) =&gt; M">toMember</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#314119" title="Global.this.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107548" title="=&gt; Global.this.Name">name</a>.<a href="#17265" title="implicit scala.reflect.generic.StdNames.stringToTermName : (s: String)Global.this.TermName">decode</a>.<a href="../symtab/Names.scala.html#96623" title="(subname: Global.this.Name)Boolean">containsName</a><span class="delimiter">(</span><a href="#124421" title="=&gt; Global.this.TermName">Dollar</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#314119" title="Global.this.Symbol">sym</a>.<span title="=&gt; Boolean">isSynthetic</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#314119" title="Global.this.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107569" title="=&gt; Boolean">hasRawInfo</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Global.this.Type" id="314148">symtpe</a> = <a href="#314120" title="Global.this.Type">pre</a>.<a href="../symtab/Types.scala.html#105502" title="(sym: Global.this.Symbol)Global.this.Type">memberType</a><a href="#124435" title="(x: =&gt; Global.this.Type)Global.this.OnTypeError[Global.this.Type]" class="delimiter">(</a><a href="#314119" title="Global.this.Symbol">sym</a><span class="delimiter">)</span> <a href="#310009" title="(alt: =&gt; Global.this.Type)Global.this.Type">onTypeError</a> <a href="../symtab/Types.scala.html#67399" title="object Global.this.ErrorType">ErrorType</a>
        <a href="#314048" title="(sym: Global.this.Symbol, symtpe: Global.this.Type, ms: Set[M])Option[M]">matching</a><span class="delimiter">(</span><a href="#314119" title="Global.this.Symbol">sym</a>, <a href="#314148" title="Global.this.Type">symtpe</a>, <a href="#124423" title="(key: Global.this.Name)Set[M]" class="keyword">this</a><span class="delimiter">(</span><a href="#314119" title="Global.this.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107548" title="=&gt; Global.this.Name">name</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="M" id="314193">m</a><span class="delimiter">)</span> =&gt;
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#314049" title="(m: M, sym: Global.this.Symbol, implicitlyAdded: Boolean)Boolean">keepSecond</a><span class="delimiter">(</span><a href="#314193" title="M">m</a>, <a href="#314119" title="Global.this.Symbol">sym</a>, <a href="#314121" title="Boolean">implicitlyAdded</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="comment">//print(&quot; -+ &quot;+sym.name)</span>
              <a href="#124423" title="(key: Global.this.Name, value: Set[M])Unit" class="keyword">this</a><span class="delimiter">(</span><a href="#314119" title="Global.this.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107548" title="=&gt; Global.this.Name">name</a><span class="delimiter">)</span> = <a href="#124423" title="(key: Global.this.Name)Set[M]" class="keyword">this</a><span class="delimiter">(</span><a href="#314119" title="Global.this.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107548" title="=&gt; Global.this.Name">name</a><span class="delimiter">)</span> <span title="(elem: M)scala.collection.immutable.Set[M]">-</span> <a href="#314193" title="M">m</a> <span title="(elem: M)scala.collection.immutable.Set[M]">+</span> <a href="#314122" title="(v1: Global.this.Symbol, v2: Global.this.Type)M">toMember</a><span class="delimiter">(</span><a href="#314119" title="Global.this.Symbol">sym</a>, <a href="#314148" title="Global.this.Type">symtpe</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="keyword">case</span> <span title="Unit">None</span> =&gt;  
            <span class="comment">//print(&quot; + &quot;+sym.name)</span>
            <a href="#124423" title="(key: Global.this.Name, value: Set[M])Unit" class="keyword">this</a><span class="delimiter">(</span><a href="#314119" title="Global.this.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107548" title="=&gt; Global.this.Name">name</a><span class="delimiter">)</span> = <a href="#124423" title="(key: Global.this.Name)Set[M]" class="keyword">this</a><span class="delimiter">(</span><a href="#314119" title="Global.this.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107548" title="=&gt; Global.this.Name">name</a><span class="delimiter">)</span> <span title="(elem: M)scala.collection.immutable.Set[M]">+</span> <a href="#314122" title="(v1: Global.this.Symbol, v2: Global.this.Type)M">toMember</a><span class="delimiter">(</span><a href="#314119" title="Global.this.Symbol">sym</a>, <a href="#314148" title="Global.this.Type">symtpe</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="=&gt; List[M]" id="314051">allMembers</a>: <span title="List[M]">List</span><span class="delimiter">[</span>M<span class="delimiter">]</span> = <a href="#124423" title="=&gt; Iterable[Set[M]]">values</a>.<span title="=&gt; List[Set[M]]">toList</span>.<span title="(implicit asTraversable: Set[M] =&gt; scala.collection.TraversableOnce[M])List[M]">flatten</span>
  <span class="delimiter">}</span>
  
  <span class="comment">/** Return all members visible without prefix in context enclosing `pos`. */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(pos: Global.this.Position)List[Global.this.ScopeMember]" id="124425">scopeMembers</a><span class="delimiter">(</span><a title="Global.this.Position" id="314044">pos</a>: <a href="../util/Position.scala.html#30588" title="Global.this.Position">Position</a><span class="delimiter">)</span>: <span title="List[Global.this.ScopeMember]">List</span><span class="delimiter">[</span>ScopeMember<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#124413" title="(pos: Global.this.Position)Global.this.Tree">typedTreeAt</a><span class="delimiter">(</span><a href="#314044" title="Global.this.Position">pos</a><span class="delimiter">)</span> <span class="comment">// to make sure context is entered</span>
    <span class="keyword">val</span> <a title="Global.this.Context" id="314327">context</a> = <a href="CompilerControl.scala.html#124457" title="(pos: Global.this.Position)Global.this.Context">doLocateContext</a><span class="delimiter">(</span><a href="#314044" title="Global.this.Position">pos</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Global.this.Members[Global.this.ScopeMember]" id="314328">locals</a> = <span title="Global.this.Members[Global.this.ScopeMember]" class="keyword">new</span> <a href="#124423" title="Global.this.Members[Global.this.ScopeMember]">Members</a><span class="delimiter">[</span>ScopeMember<span class="delimiter">]</span>
    <span class="keyword">def</span> <a title="(sym: Global.this.Symbol, pre: Global.this.Type, viaImport: Global.this.Tree)Unit" id="314329">addScopeMember</a><span class="delimiter">(</span><a title="Global.this.Symbol" id="314334">sym</a>: <a href="../symtab/Symbols.scala.html#67331" title="Global.this.Symbol">Symbol</a>, <a title="Global.this.Type" id="314335">pre</a>: <a href="../symtab/Types.scala.html#67392" title="Global.this.Type">Type</a>, <a title="Global.this.Tree" id="314336">viaImport</a>: <span title="Global.this.Tree">Tree</span><span class="delimiter">)</span> =
      <a href="#314328" title="Global.this.Members[Global.this.ScopeMember]">locals</a>.<a href="#314050" title="(sym: Global.this.Symbol, pre: Global.this.Type, implicitlyAdded: Boolean)(toMember: (Global.this.Symbol, Global.this.Type) =&gt; Global.this.ScopeMember)Unit">add</a><span class="delimiter">(</span><a href="#314334" title="Global.this.Symbol">sym</a>, <a href="#314335" title="Global.this.Type">pre</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="delimiter">(</span><a title="Global.this.Symbol" id="314339">s</a>, <a title="Global.this.Type" id="314340">st</a><span class="delimiter">)</span> =&gt;
        <span title="Global.this.ScopeMember" class="keyword">new</span> <a href="CompilerControl.scala.html#124482" title="Global.this.ScopeMember">ScopeMember</a><span class="delimiter">(</span><a href="#314339" title="Global.this.Symbol">s</a>, <a href="#314340" title="Global.this.Type">st</a>, <a href="#314327" title="Global.this.Context">context</a>.<a href="../typechecker/Contexts.scala.html#106860" title="(sym: Global.this.analyzer.global.Symbol, pre: Global.this.analyzer.global.Type, superAccess: Boolean)Boolean">isAccessible</a><span class="delimiter">(</span><a href="#314339" title="Global.this.Symbol">s</a>, <a href="#314335" title="Global.this.Type">pre</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>, <a href="#314336" title="Global.this.Tree">viaImport</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="comment">//print(&quot;add scope members&quot;)</span>
    <span class="keyword">var</span> <a title="Global.this.Context" id="314330">cx</a> = <a href="#314327" title="Global.this.Context">context</a>
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#314330" title="Global.this.Context">cx</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="ContextTrees.scala.html#124528" title="=&gt; Global.this.analyzer.Context">NoContext</a><span class="delimiter">)</span> <a href="#314332" title="()Unit" class="delimiter">{</a>
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="Global.this.analyzer.global.Symbol" id="314395">sym</a> &lt;- <a href="#314330" title="Global.this.Context">cx</a>.<a href="../symtab/Scopes.scala.html#113100" title="(p: Global.this.analyzer.global.Symbol =&gt; Unit)Unit">scope</a><span class="delimiter">)</span>
        <a href="#314329" title="(sym: Global.this.Symbol, pre: Global.this.Type, viaImport: Global.this.Tree)Unit">addScopeMember</a><span class="delimiter">(</span><a href="#314395" title="Global.this.analyzer.global.Symbol">sym</a>, <a href="../symtab/Types.scala.html#67408" title="object Global.this.NoPrefix">NoPrefix</a>, <a href="#17265" title="object Global.this.EmptyTree">EmptyTree</a><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#314330" title="Global.this.Context">cx</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#314330" title="Global.this.Context">cx</a>.<a href="../typechecker/Contexts.scala.html#106764" title="=&gt; Global.this.analyzer.Context">enclClass</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Global.this.analyzer.global.Type" id="314402">pre</a> = <a href="#314330" title="Global.this.Context">cx</a>.<a href="../typechecker/Contexts.scala.html#106788" title="=&gt; Global.this.analyzer.global.Type">prefix</a>
        <span class="keyword">for</span> <span class="delimiter">(</span><a title="Global.this.analyzer.global.Symbol" id="314428">sym</a> &lt;- <a href="#314402" title="Global.this.analyzer.global.Type">pre</a>.<a href="../symtab/Types.scala.html#105490" title="(f: Global.this.analyzer.global.Symbol =&gt; Unit)Unit">members</a><span class="delimiter">)</span> 
          <a href="#314329" title="(sym: Global.this.Symbol, pre: Global.this.Type, viaImport: Global.this.Tree)Unit">addScopeMember</a><span class="delimiter">(</span><a href="#314428" title="Global.this.analyzer.global.Symbol">sym</a>, <a href="#314402" title="Global.this.analyzer.global.Type">pre</a>, <a href="#17265" title="object Global.this.EmptyTree">EmptyTree</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#314330" title="Global.this.Context">cx</a> = <a href="#314330" title="Global.this.Context">cx</a>.<a href="../typechecker/Contexts.scala.html#106761" title="=&gt; Global.this.analyzer.Context">outer</a>
    <span class="delimiter">}</span>
    <span class="comment">//print(&quot;\nadd imported members&quot;)</span>
    <span class="keyword">for</span> <span class="delimiter">(</span><a title="Global.this.analyzer.ImportInfo" id="314455">imp</a> &lt;- <a href="#314327" title="Global.this.Context">context</a>.<a href="../typechecker/Contexts.scala.html#106779" title="(f: Global.this.analyzer.ImportInfo =&gt; Unit)Unit">imports</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Global.this.analyzer.global.Type" id="314469">pre</a> = <a href="#314455" title="Global.this.analyzer.ImportInfo">imp</a>.<a href="../typechecker/Contexts.scala.html#314463" title="=&gt; Global.this.analyzer.global.Tree">qual</a>.<span title="=&gt; Global.this.analyzer.global.Type">tpe</span>
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="Global.this.analyzer.global.Symbol" id="314495">sym</a> &lt;- <a href="#314455" title="Global.this.analyzer.ImportInfo">imp</a>.<a href="../typechecker/Contexts.scala.html#314466" title="(f: Global.this.analyzer.global.Symbol =&gt; Unit)Unit">allImportedSymbols</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#314329" title="(sym: Global.this.Symbol, pre: Global.this.Type, viaImport: Global.this.Tree)Unit">addScopeMember</a><span class="delimiter">(</span><a href="#314495" title="Global.this.analyzer.global.Symbol">sym</a>, <a href="#314469" title="Global.this.analyzer.global.Type">pre</a>, <a href="#314455" title="Global.this.analyzer.ImportInfo">imp</a>.<a href="../typechecker/Contexts.scala.html#314463" title="=&gt; Global.this.analyzer.global.Tree">qual</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <span class="comment">// println()</span>
    <span class="keyword">val</span> <a title="List[Global.this.ScopeMember]" id="314331">result</a> = <a href="#314328" title="Global.this.Members[Global.this.ScopeMember]">locals</a>.<a href="#314051" title="=&gt; List[Global.this.ScopeMember]">allMembers</a>
<span class="comment">//    if (debugIDE) for (m &lt;- result) println(m)</span>
    <a href="#314331" title="List[Global.this.ScopeMember]">result</a>
  <span class="delimiter">}</span>

  <span class="keyword">private</span><span class="delimiter">[</span>interactive<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(pos: Global.this.Position, response: Global.this.Response[List[Global.this.Member]])Unit" id="124426">getTypeCompletion</a><span class="delimiter">(</span><a title="Global.this.Position" id="310874">pos</a>: <a href="../util/Position.scala.html#30588" title="Global.this.Position">Position</a>, <a title="Global.this.Response[List[Global.this.Member]]" id="310875">response</a>: <a href="Response.scala.html#17903" title="Global.this.Response[List[Global.this.Member]]">Response</a><span class="delimiter">[</span>List<span class="delimiter">[</span>Member<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#124322" title="(msg: =&gt; String)Unit">informIDE</a><span class="delimiter">(</span><span title="java.lang.String(&quot;getTypeCompletion &quot;)" class="string">&quot;getTypeCompletion &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#310874" title="Global.this.Position">pos</a><span class="delimiter">)</span>
    <a href="#124406" title="(response: Global.this.Response[List[Global.this.Member]])(op: =&gt; Stream[List[Global.this.Member]])Unit">respondGradually</a><span class="delimiter">(</span><a href="#310875" title="Global.this.Response[List[Global.this.Member]]">response</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#124427" title="(pos: Global.this.Position)Stream[List[Global.this.TypeMember]]">typeMembers</a><span class="delimiter">(</span><a href="#310874" title="Global.this.Position">pos</a><span class="delimiter">)</span> <span class="delimiter">}</span>
    <span class="comment">//if (debugIDE) typeMembers(pos)</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(pos: Global.this.Position)Stream[List[Global.this.TypeMember]]" id="124427">typeMembers</a><span class="delimiter">(</span><a title="Global.this.Position" id="314505">pos</a>: <a href="../util/Position.scala.html#30588" title="Global.this.Position">Position</a><span class="delimiter">)</span>: <span title="Stream[List[Global.this.TypeMember]]">Stream</span><span class="delimiter">[</span>List<span class="delimiter">[</span>TypeMember<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Global.this.Tree" id="314507">tree</a> = <a href="#124413" title="(pos: Global.this.Position)Global.this.Tree">typedTreeAt</a><span class="delimiter">(</span><a href="#314505" title="Global.this.Position">pos</a><span class="delimiter">)</span>

    <span class="comment">// if tree consists of just x. or x.fo where fo is not yet a full member name</span>
    <span class="comment">// ignore the selection and look in just x.</span>
    <a href="#314507" title="Global.this.Tree">tree</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Unit">Select</span><span class="delimiter">(</span><a title="Global.this.Tree" id="314518">qual</a>, <a title="Global.this.Name" id="314519">name</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#314507" title="Global.this.Tree">tree</a>.<span title="=&gt; Global.this.Type">tpe</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../symtab/Types.scala.html#67399" title="object Global.this.ErrorType">ErrorType</a> =&gt; <a href="#314507" title="Global.this.Tree">tree</a> = <a href="#314518" title="Global.this.Tree">qual</a>
      <span class="keyword">case</span> <span title="Unit">_</span> =&gt; 
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="Global.this.Context" id="314508">context</a> = <a href="CompilerControl.scala.html#124457" title="(pos: Global.this.Position)Global.this.Context">doLocateContext</a><span class="delimiter">(</span><a href="#314505" title="Global.this.Position">pos</a><span class="delimiter">)</span>

    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#314507" title="Global.this.Tree">tree</a>.<span title="=&gt; Global.this.Type">tpe</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
      <span class="comment">// TODO: guard with try/catch to deal with ill-typed qualifiers.</span>
      <a href="#314507" title="Global.this.Tree">tree</a> = <a href="../Global.scala.html#64911" title="object Global.this.analyzer">analyzer</a>.<a href="../typechecker/Typers.scala.html#105745" title="(context: Global.this.analyzer.Context)Global.this.analyzer.Typer">newTyper</a><span class="delimiter">(</span><a href="#314508" title="Global.this.Context">context</a><span class="delimiter">)</span>.<a href="../typechecker/Typers.scala.html#106068" title="(tree: Global.this.analyzer.global.Tree)Global.this.analyzer.global.Tree">typedQualifier</a><span class="delimiter">(</span><a href="#314507" title="Global.this.Tree">tree</a><span class="delimiter">)</span>
      
    <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;typeMembers at &quot;)" class="string">&quot;typeMembers at &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#314507" title="Global.this.Tree">tree</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#314507" title="Global.this.Tree">tree</a>.<span title="=&gt; Global.this.Type">tpe</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Boolean" id="314509">superAccess</a> = <a href="#314507" title="Global.this.Tree">tree</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><span title="Global.this.Super">Super</span><span class="delimiter">]</span>
    <span class="keyword">val</span> <a title="Global.this.Members[Global.this.TypeMember]" id="314510">members</a> = <span title="Global.this.Members[Global.this.TypeMember]" class="keyword">new</span> <a href="#124423" title="Global.this.Members[Global.this.TypeMember]">Members</a><span class="delimiter">[</span>TypeMember<span class="delimiter">]</span>

    <span class="keyword">def</span> <a title="(sym: Global.this.Symbol, pre: Global.this.Type, inherited: Boolean, viaView: Global.this.Symbol)Unit" id="314511">addTypeMember</a><span class="delimiter">(</span><a title="Global.this.Symbol" id="314550">sym</a>: <a href="../symtab/Symbols.scala.html#67331" title="Global.this.Symbol">Symbol</a>, <a title="Global.this.Type" id="314551">pre</a>: <a href="../symtab/Types.scala.html#67392" title="Global.this.Type">Type</a>, <a title="Boolean" id="314552">inherited</a>: <span title="Boolean">Boolean</span>, <a title="Global.this.Symbol" id="314553">viaView</a>: <a href="../symtab/Symbols.scala.html#67331" title="Global.this.Symbol">Symbol</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Boolean" id="314554">implicitlyAdded</a> = <a href="#314553" title="Global.this.Symbol">viaView</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../symtab/Symbols.scala.html#67339" title="object Global.this.NoSymbol">NoSymbol</a>
      <a href="#314510" title="Global.this.Members[Global.this.TypeMember]">members</a>.<a href="#314050" title="(sym: Global.this.Symbol, pre: Global.this.Type, implicitlyAdded: Boolean)(toMember: (Global.this.Symbol, Global.this.Type) =&gt; Global.this.TypeMember)Unit">add</a><span class="delimiter">(</span><a href="#314550" title="Global.this.Symbol">sym</a>, <a href="#314551" title="Global.this.Type">pre</a>, <a href="#314554" title="Boolean">implicitlyAdded</a><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="delimiter">(</span><a title="Global.this.Symbol" id="314561">s</a>, <a title="Global.this.Type" id="314562">st</a><span class="delimiter">)</span> =&gt;
        <span title="Global.this.TypeMember" class="keyword">new</span> <a href="CompilerControl.scala.html#124479" title="Global.this.TypeMember">TypeMember</a><span class="delimiter">(</span><a href="#314561" title="Global.this.Symbol">s</a>, <a href="#314562" title="Global.this.Type">st</a>, 
          <a href="#314508" title="Global.this.Context">context</a>.<a href="../typechecker/Contexts.scala.html#106860" title="(sym: Global.this.analyzer.global.Symbol, pre: Global.this.analyzer.global.Type, superAccess: Boolean)Boolean">isAccessible</a><span class="delimiter">(</span><a href="#314561" title="Global.this.Symbol">s</a>, <a href="#314551" title="Global.this.Type">pre</a>, <a href="#314509" title="Boolean">superAccess</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#314554" title="Boolean">implicitlyAdded</a><span class="delimiter">)</span>,
          <a href="#314552" title="Boolean">inherited</a>,
          <a href="#314553" title="Global.this.Symbol">viaView</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="comment">/** Create a function application of a given view function to `tree` and typechecked it.
     */</span>
    <span class="keyword">def</span> <a title="(view: Global.this.analyzer.SearchResult)Global.this.Tree" id="314512">viewApply</a><span class="delimiter">(</span><a title="Global.this.analyzer.SearchResult" id="314571">view</a>: <a href="../typechecker/Implicits.scala.html#105798" title="Global.this.analyzer.SearchResult">SearchResult</a><span class="delimiter">)</span>: <span title="Global.this.Tree">Tree</span> = <span class="delimiter">{</span>
      <span title="(assertion: Boolean)Unit">assert</span><span class="delimiter">(</span><a href="#314571" title="Global.this.analyzer.SearchResult">view</a>.<a href="../typechecker/Implicits.scala.html#314574" title="=&gt; Global.this.analyzer.global.Tree">tree</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#17265" title="object Global.this.EmptyTree">EmptyTree</a><span class="delimiter">)</span>
      <a href="../Global.scala.html#64911" title="object Global.this.analyzer">analyzer</a>.<a href="../typechecker/Typers.scala.html#105745" title="(context: Global.this.analyzer.Context)Global.this.analyzer.Typer">newTyper</a><span class="delimiter">(</span><a href="#314508" title="Global.this.Context">context</a>.<a href="../typechecker/Contexts.scala.html#106844" title="(reportAmbiguousErrors: Boolean)Global.this.analyzer.Context">makeImplicit</a><span class="delimiter">(</span>reportAmbiguousErrors = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span>
        .<a href="../typechecker/Typers.scala.html#106063" title="(tree: Global.this.analyzer.global.Tree)Global.this.analyzer.global.Tree">typed</a><a href="#124435" title="(x: =&gt; Global.this.analyzer.global.Tree)Global.this.OnTypeError[Global.this.analyzer.global.Tree]" class="delimiter">(</a><a href="#17265" title="(fun: Global.this.Tree, args: List[Global.this.Tree])Global.this.Apply">Apply</a><span class="delimiter">(</span><a href="#314571" title="Global.this.analyzer.SearchResult">view</a>.<a href="../typechecker/Implicits.scala.html#314574" title="=&gt; Global.this.analyzer.global.Tree">tree</a>, <span title="(xs: Global.this.Tree*)List[Global.this.Tree]">List</span><span class="delimiter">(</span><a href="#314507" title="Global.this.Tree">tree</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(pos: scala.tools.nsc.util.Position)Global.this.Apply">setPos</span> <a href="#314507" title="Global.this.Tree">tree</a>.<span title="=&gt; Global.this.Position">pos</span><span class="delimiter">)</span>
        .<a href="#310009" title="(alt: =&gt; Global.this.analyzer.global.Tree)Global.this.analyzer.global.Tree">onTypeError</a><span class="delimiter">(</span><a href="#17265" title="object Global.this.EmptyTree">EmptyTree</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">val</span> <a title="Global.this.Type" id="314513">pre</a> = <a href="#124418" title="(tree: Global.this.Tree)Global.this.Type">stabilizedType</a><span class="delimiter">(</span><a href="#314507" title="Global.this.Tree">tree</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Global.this.analyzer.global.Type" id="314514">ownerTpe</a> = <a href="#314507" title="Global.this.Tree">tree</a>.<span title="=&gt; Global.this.Type">tpe</span> <span title="Global.this.analyzer.global.Type" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Global.this.analyzer.global.Type">analyzer</span>.ImportType<span class="delimiter">(</span><a title="Global.this.analyzer.global.Tree" id="314639">expr</a><span class="delimiter">)</span> =&gt; <a href="#314639" title="Global.this.analyzer.global.Tree">expr</a>.<span title="=&gt; Global.this.analyzer.global.Type">tpe</span>
      <span class="keyword">case</span> <span title="Global.this.Type" class="keyword">null</span> =&gt; <a href="#314513" title="Global.this.Type">pre</a>
      <span class="keyword">case</span> <span title="Global.this.Type">_</span> =&gt; <a href="#314507" title="Global.this.Tree">tree</a>.<span title="=&gt; Global.this.Type">tpe</span>
    <span class="delimiter">}</span>

    <span class="comment">//print(&quot;add members&quot;)</span>
    <span class="keyword">for</span> <span class="delimiter">(</span><a title="Global.this.analyzer.global.Symbol" id="314661">sym</a> &lt;- <a href="#314514" title="Global.this.analyzer.global.Type">ownerTpe</a>.<a href="../symtab/Types.scala.html#105490" title="(f: Global.this.analyzer.global.Symbol =&gt; Unit)Unit">members</a><span class="delimiter">)</span>
      <a href="#314511" title="(sym: Global.this.Symbol, pre: Global.this.Type, inherited: Boolean, viaView: Global.this.Symbol)Unit">addTypeMember</a><span class="delimiter">(</span><a href="#314661" title="Global.this.analyzer.global.Symbol">sym</a>, <a href="#314513" title="Global.this.Type">pre</a>, <a href="#314661" title="Global.this.analyzer.global.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107541" title="=&gt; Global.this.analyzer.global.Symbol">owner</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#314514" title="Global.this.analyzer.global.Type">ownerTpe</a>.<a href="../symtab/Types.scala.html#105454" title="=&gt; Global.this.analyzer.global.Symbol">typeSymbol</a>, <a href="../symtab/Symbols.scala.html#67339" title="object Global.this.NoSymbol">NoSymbol</a><span class="delimiter">)</span>
    <a href="#314510" title="Global.this.Members[Global.this.TypeMember]">members</a>.<a href="#314051" title="=&gt; List[Global.this.TypeMember]">allMembers</a> <a href="#314668" title="(hd: List[Global.this.TypeMember])scala.collection.immutable.Stream[List[Global.this.TypeMember]]">#::</a> <span title="(stream: =&gt; scala.collection.immutable.Stream[List[Global.this.TypeMember]])scala.collection.immutable.Stream.ConsWrapper[List[Global.this.TypeMember]]" class="delimiter">{</span>
      <span class="comment">//print(&quot;\nadd pimped&quot;)</span>
      <span class="keyword">val</span> <a title="List[Global.this.analyzer.SearchResult]" id="314669">applicableViews</a>: <span title="List[Global.this.analyzer.SearchResult]">List</span><span class="delimiter">[</span>SearchResult<span class="delimiter">]</span> = 
        <span title="List[Global.this.analyzer.SearchResult]" class="keyword">if</span> <span class="delimiter">(</span><a href="#314514" title="Global.this.analyzer.global.Type">ownerTpe</a>.<a href="../symtab/Types.scala.html#105486" title="=&gt; Boolean">isErroneous</a><span class="delimiter">)</span> List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>
        <span class="keyword">else</span> <span title="Global.this.analyzer.ImplicitSearch" class="keyword">new</span> <a href="../typechecker/Implicits.scala.html#105811" title="Global.this.analyzer.ImplicitSearch">ImplicitSearch</a><span class="delimiter">(</span>
          <a href="#314507" title="Global.this.Tree">tree</a>, <a href="../symtab/Definitions.scala.html#106491" title="(formals: List[Global.this.Type], restpe: Global.this.Type)Global.this.Type">functionType</a><span class="delimiter">(</span><span title="(xs: Global.this.analyzer.global.Type*)List[Global.this.analyzer.global.Type]">List</span><span class="delimiter">(</span><a href="#314514" title="Global.this.analyzer.global.Type">ownerTpe</a><span class="delimiter">)</span>, <a href="../symtab/Definitions.scala.html#106216" title="=&gt; Global.this.Symbol">AnyClass</a>.<a href="../symtab/Symbols.scala.html#107562" title="=&gt; Global.this.Type">tpe</a><span class="delimiter">)</span>, isView = <span title="Boolean(true)" class="keyword">true</span>, 
          <a href="#314508" title="Global.this.Context">context</a>.<a href="../typechecker/Contexts.scala.html#106844" title="(reportAmbiguousErrors: Boolean)Global.this.analyzer.Context">makeImplicit</a><span class="delimiter">(</span>reportAmbiguousErrors = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../typechecker/Implicits.scala.html#314716" title="=&gt; List[Global.this.analyzer.SearchResult]">allImplicits</a>
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="Global.this.analyzer.SearchResult" id="314820">view</a> &lt;- <a href="#314669" title="(f: Global.this.analyzer.SearchResult =&gt; Unit)Unit">applicableViews</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Global.this.Tree" id="314821">vtree</a> = <a href="#314512" title="(view: Global.this.analyzer.SearchResult)Global.this.Tree">viewApply</a><span class="delimiter">(</span><a href="#314820" title="Global.this.analyzer.SearchResult">view</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Global.this.Type" id="314822">vpre</a> = <a href="#124418" title="(tree: Global.this.Tree)Global.this.Type">stabilizedType</a><span class="delimiter">(</span><a href="#314821" title="Global.this.Tree">vtree</a><span class="delimiter">)</span>
        <span class="keyword">for</span> <span class="delimiter">(</span><a title="Global.this.Symbol" id="314848">sym</a> &lt;- <a href="#314821" title="Global.this.Tree">vtree</a>.<span title="=&gt; Global.this.Type">tpe</span>.<a href="../symtab/Types.scala.html#105490" title="(f: Global.this.Symbol =&gt; Unit)Unit">members</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#314511" title="(sym: Global.this.Symbol, pre: Global.this.Type, inherited: Boolean, viaView: Global.this.Symbol)Unit">addTypeMember</a><span class="delimiter">(</span><a href="#314848" title="Global.this.Symbol">sym</a>, <a href="#314822" title="Global.this.Type">vpre</a>, <span title="Boolean(false)" class="keyword">false</span>, <a href="#314820" title="Global.this.analyzer.SearchResult">view</a>.<a href="../typechecker/Implicits.scala.html#314574" title="=&gt; Global.this.analyzer.global.Tree">tree</a>.<span title="=&gt; Global.this.analyzer.global.Symbol">symbol</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span class="comment">//println()</span>
      <span title="(xs: List[Global.this.TypeMember]*)scala.collection.immutable.Stream[List[Global.this.TypeMember]]">Stream</span><span class="delimiter">(</span><a href="#314510" title="Global.this.Members[Global.this.TypeMember]">members</a>.<a href="#314051" title="=&gt; List[Global.this.TypeMember]">allMembers</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  <span class="comment">/** Implements CompilerControl.askLoadedTyped */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>interactive<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(source: scala.tools.nsc.util.SourceFile, response: Global.this.Response[Global.this.Tree], onSameThread: Boolean)Unit" id="124428">waitLoadedTyped</a><span class="delimiter">(</span><a title="scala.tools.nsc.util.SourceFile" id="310932">source</a>: <a href="../util/SourceFile.scala.html#30381" title="scala.tools.nsc.util.SourceFile">SourceFile</a>, <a title="Global.this.Response[Global.this.Tree]" id="310933">response</a>: <a href="Response.scala.html#17903" title="Global.this.Response[Global.this.Tree]">Response</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span>, <a title="Boolean" id="310936">onSameThread</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#124339" title="(s: scala.tools.nsc.util.SourceFile)Option[Global.this.RichCompilationUnit]">getUnit</a><span class="delimiter">(</span><a href="#310932" title="scala.tools.nsc.util.SourceFile">source</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="Global.this.RichCompilationUnit" id="314910">unit</a><span class="delimiter">)</span> =&gt;
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#314910" title="Global.this.RichCompilationUnit">unit</a>.<a href="RichCompilationUnits.scala.html#309701" title="=&gt; Boolean">isUpToDate</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;already typed&quot;)" class="string">&quot;already typed&quot;</span><span class="delimiter">)</span>; 
          <a href="#310933" title="Global.this.Response[Global.this.Tree]">response</a> <a href="Response.scala.html#124723" title="(x: Global.this.Tree)Unit">set</a> <a href="#314910" title="Global.this.RichCompilationUnit">unit</a>.<a href="../CompilationUnits.scala.html#96431" title="=&gt; Global.this.Tree">body</a>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#310936" title="Boolean">onSameThread</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#124416" title="(source: scala.tools.nsc.util.SourceFile, forceReload: Boolean, response: Global.this.Response[Global.this.Tree])Unit">getTypedTree</a><span class="delimiter">(</span><a href="#310932" title="scala.tools.nsc.util.SourceFile">source</a>, forceReload = <span title="Boolean(false)" class="keyword">false</span>, <a href="#310933" title="Global.this.Response[Global.this.Tree]">response</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;wait for later&quot;)" class="string">&quot;wait for later&quot;</span><span class="delimiter">)</span>
          <a href="#124347" title="(x$1: Boolean)Unit">outOfDate</a> = <span title="Boolean(true)" class="keyword">true</span>
          <a href="#124329" title="(key: scala.tools.nsc.util.SourceFile, value: scala.collection.immutable.Set[Global.this.Response[Global.this.Tree]])Unit">waitLoadedTypeResponses</a><span class="delimiter">(</span><a href="#310932" title="scala.tools.nsc.util.SourceFile">source</a><span class="delimiter">)</span> <span title="(elem: Global.this.Response[Global.this.Tree])scala.collection.immutable.Set[Global.this.Response[Global.this.Tree]]">+=</span> <a href="#310933" title="Global.this.Response[Global.this.Tree]">response</a>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="Unit">None</span> =&gt;
        <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;load unit and type&quot;)" class="string">&quot;load unit and type&quot;</span><span class="delimiter">)</span>
        <span class="keyword">try</span> <a href="#124410" title="(sources: List[scala.tools.nsc.util.SourceFile])Unit">reloadSources</a><span class="delimiter">(</span><span title="(xs: scala.tools.nsc.util.SourceFile*)List[scala.tools.nsc.util.SourceFile]">List</span><span class="delimiter">(</span><a href="#310932" title="scala.tools.nsc.util.SourceFile">source</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">finally</span> <a href="#124428" title="(source: scala.tools.nsc.util.SourceFile, response: Global.this.Response[Global.this.Tree], onSameThread: Boolean)Unit">waitLoadedTyped</a><span class="delimiter">(</span><a href="#310932" title="scala.tools.nsc.util.SourceFile">source</a>, <a href="#310933" title="Global.this.Response[Global.this.Tree]">response</a>, <a href="#310936" title="Boolean">onSameThread</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  <span class="comment">/** Implements CompilerControl.askParsedEntered */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>interactive<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(source: scala.tools.nsc.util.SourceFile, keepLoaded: Boolean, response: Global.this.Response[Global.this.Tree], onSameThread: Boolean)Unit" id="124429">getParsedEntered</a><span class="delimiter">(</span><a title="scala.tools.nsc.util.SourceFile" id="310949">source</a>: <a href="../util/SourceFile.scala.html#30381" title="scala.tools.nsc.util.SourceFile">SourceFile</a>, <a title="Boolean" id="310950">keepLoaded</a>: <span title="Boolean">Boolean</span>, <a title="Global.this.Response[Global.this.Tree]" id="310951">response</a>: <a href="Response.scala.html#17903" title="Global.this.Response[Global.this.Tree]">Response</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span>, <a title="Boolean" id="310954">onSameThread</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#124339" title="(s: scala.tools.nsc.util.SourceFile)Option[Global.this.RichCompilationUnit]">getUnit</a><span class="delimiter">(</span><a href="#310949" title="scala.tools.nsc.util.SourceFile">source</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="Global.this.RichCompilationUnit" id="314965">unit</a><span class="delimiter">)</span> =&gt;
        <a href="#124430" title="(source: scala.tools.nsc.util.SourceFile, response: Global.this.Response[Global.this.Tree])Unit">getParsedEnteredNow</a><span class="delimiter">(</span><a href="#310949" title="scala.tools.nsc.util.SourceFile">source</a>, <a href="#310951" title="Global.this.Response[Global.this.Tree]">response</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">None</span> =&gt;
        <span class="keyword">try</span> <span class="delimiter">{</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#310950" title="Boolean">keepLoaded</a> <span title="(x: Boolean)Boolean">||</span> <a href="#124347" title="=&gt; Boolean">outOfDate</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#310954" title="Boolean">onSameThread</a><span class="delimiter">)</span>
            <a href="#124410" title="(sources: List[scala.tools.nsc.util.SourceFile])Unit">reloadSources</a><span class="delimiter">(</span><span title="(xs: scala.tools.nsc.util.SourceFile*)List[scala.tools.nsc.util.SourceFile]">List</span><span class="delimiter">(</span><a href="#310949" title="scala.tools.nsc.util.SourceFile">source</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#310950" title="Boolean">keepLoaded</a> <span title="(x: Boolean)Boolean">||</span> <span title="=&gt; Boolean">!</span><a href="#124347" title="=&gt; Boolean">outOfDate</a> <span title="(x: Boolean)Boolean">||</span> <a href="#310954" title="Boolean">onSameThread</a><span class="delimiter">)</span>
            <a href="#124430" title="(source: scala.tools.nsc.util.SourceFile, response: Global.this.Response[Global.this.Tree])Unit">getParsedEnteredNow</a><span class="delimiter">(</span><a href="#310949" title="scala.tools.nsc.util.SourceFile">source</a>, <a href="#310951" title="Global.this.Response[Global.this.Tree]">response</a><span class="delimiter">)</span>
          <span class="keyword">else</span> 
            <a href="#124332" title="=&gt; Global.this.ResponseMap">getParsedEnteredResponses</a><span class="delimiter">(</span><a href="#310949" title="scala.tools.nsc.util.SourceFile">source</a><span class="delimiter">)</span> <span title="(elem: Global.this.Response[Global.this.Tree])scala.collection.immutable.Set[Global.this.Response[Global.this.Tree]]">+=</span> <a href="#310951" title="Global.this.Response[Global.this.Tree]">response</a>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Parses and enters given source file, stroring parse tree in response */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(source: scala.tools.nsc.util.SourceFile, response: Global.this.Response[Global.this.Tree])Unit" id="124430">getParsedEnteredNow</a><span class="delimiter">(</span><a title="scala.tools.nsc.util.SourceFile" id="313454">source</a>: <a href="../util/SourceFile.scala.html#30381" title="scala.tools.nsc.util.SourceFile">SourceFile</a>, <a title="Global.this.Response[Global.this.Tree]" id="313455">response</a>: <a href="Response.scala.html#17903" title="Global.this.Response[Global.this.Tree]">Response</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#124403" title="(result: Global.this.Response[Global.this.Tree])(op: =&gt; Global.this.Tree)Unit">respond</a><span class="delimiter">(</span><a href="#313455" title="Global.this.Response[Global.this.Tree]">response</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="CompilerControl.scala.html#124448" title="(source: scala.tools.nsc.util.SourceFile)(op: Global.this.RichCompilationUnit =&gt; Global.this.Tree)Global.this.Tree">onUnitOf</a><span class="delimiter">(</span><a href="#313454" title="scala.tools.nsc.util.SourceFile">source</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a title="Global.this.RichCompilationUnit" id="315046">unit</a> =&gt;
        <a href="#124399" title="(unit: Global.this.RichCompilationUnit)Unit">parseAndEnter</a><span class="delimiter">(</span><a href="#315046" title="Global.this.RichCompilationUnit">unit</a><span class="delimiter">)</span>
        <a href="#315046" title="Global.this.RichCompilationUnit">unit</a>.<a href="../CompilationUnits.scala.html#96431" title="=&gt; Global.this.Tree">body</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">// ---------------- Helper classes ---------------------------</span>

  <span class="comment">/** A transformer that replaces tree `from` with tree `to` in a given tree */</span>
  <span class="keyword">class</span> <a title="class TreeReplacer extends Global.this.Transformer with ScalaObject" id="124431">TreeReplacer</a><a href="#124431" title="ScalaObject" class="delimiter">(</a><a title="Global.this.Tree" id="315058">from</a>: <span title="Global.this.Tree">Tree</span>, <a title="Global.this.Tree" id="315059">to</a>: <span title="Global.this.Tree">Tree</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../ast/Trees.scala.html#67836" title="Global.this.Transformer">Transformer</a> <span class="delimiter">{</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(t: Global.this.Tree)Global.this.Tree" id="315054">transform</a><span class="delimiter">(</span><a title="Global.this.Tree" id="315060">t</a>: <span title="Global.this.Tree">Tree</span><span class="delimiter">)</span>: <span title="Global.this.Tree">Tree</span> = <span class="delimiter">{</span>
      <span title="Global.this.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#315060" title="Global.this.Tree">t</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#315058" title="Global.this.Tree">from</a><span class="delimiter">)</span> <a href="#315059" title="Global.this.Tree">to</a>
      <span class="keyword">else</span> <span title="Global.this.Tree" class="keyword">if</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#315060" title="Global.this.Tree">t</a>.<span title="=&gt; Global.this.Position">pos</span> <a href="../util/Position.scala.html#97229" title="(pos: scala.tools.nsc.util.Position)Boolean">includes</a> <a href="#315058" title="Global.this.Tree">from</a>.<span title="=&gt; Global.this.Position">pos</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <a href="#315060" title="Global.this.Tree">t</a>.<span title="=&gt; Global.this.Position">pos</span>.<a href="../util/Position.scala.html#97210" title="=&gt; Boolean">isTransparent</a><span class="delimiter">)</span> <a href="#124431" title="Global.this.TreeReplacer" class="keyword">super</a>.<a href="../ast/Trees.scala.html#162576" title="(tree: Global.this.Tree)Global.this.Tree">transform</a><span class="delimiter">(</span><a href="#315060" title="Global.this.Tree">t</a><span class="delimiter">)</span>
      <span class="keyword">else</span> <a href="#315060" title="Global.this.Tree">t</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/** The typer run */</span>
  <span class="keyword">class</span> <a title="class TyperRun extends Global.this.Run with ScalaObject" id="124432">TyperRun</a> <a href="#124432" title="ScalaObject" class="keyword">extends</a> <a href="../Global.scala.html#64994" title="Global.this.Run">Run</a> <span class="delimiter">{</span>
    <span class="comment">// units is always empty</span>

    <span class="comment">/** canRedefine is used to detect double declarations of classes and objects
     *  in multiple source files.
     *  Since the IDE rechecks units several times in the same run, these tests
     *  are disabled by always returning true here.
     */</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(sym: Global.this.Symbol)Boolean" id="311692">canRedefine</a><span class="delimiter">(</span><a title="Global.this.Symbol" id="315070">sym</a>: <a href="../symtab/Symbols.scala.html#67331" title="Global.this.Symbol">Symbol</a><span class="delimiter">)</span> = <span title="Boolean(true)" class="keyword">true</span>

    <span class="keyword">def</span> <a title="(unit: Global.this.CompilationUnit)Unit" id="311693">typeCheck</a><span class="delimiter">(</span><a title="Global.this.CompilationUnit" id="313492">unit</a>: <a href="../CompilationUnits.scala.html#67953" title="Global.this.CompilationUnit">CompilationUnit</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
      <a href="#311694" title="(phase: scala.tools.nsc.Phase, unit: Global.this.CompilationUnit)Unit">applyPhase</a><span class="delimiter">(</span><a href="../Global.scala.html#72332" title="=&gt; scala.tools.nsc.Phase">typerPhase</a>, <a href="#313492" title="Global.this.CompilationUnit">unit</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="comment">/** Apply a phase to a compilation unit
     *  @return true iff typechecked correctly
     */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(phase: scala.tools.nsc.Phase, unit: Global.this.CompilationUnit)Unit" id="311694">applyPhase</a><span class="delimiter">(</span><a title="scala.tools.nsc.Phase" id="315074">phase</a>: <a href="../Phase.scala.html#10619" title="scala.tools.nsc.Phase">Phase</a>, <a title="Global.this.CompilationUnit" id="315075">unit</a>: <a href="../CompilationUnits.scala.html#67953" title="Global.this.CompilationUnit">CompilationUnit</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../symtab/SymbolTable.scala.html#64815" title="(ph: scala.tools.nsc.Phase)(op: =&gt; Unit)Unit">atPhase</a><span class="delimiter">(</span><a href="#315074" title="scala.tools.nsc.Phase">phase</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#315074" title="scala.tools.nsc.Phase">phase</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Global.this.GlobalPhase" class="delimiter">[</span><a href="../Global.scala.html#64902" title="Global.this.GlobalPhase">GlobalPhase</a><span class="delimiter">]</span> <a href="../Global.scala.html#110133" title="(unit: Global.this.CompilationUnit)Unit">applyPhase</a> <a href="#315075" title="Global.this.CompilationUnit">unit</a> <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  <span class="keyword">def</span> <a title="()Unit" id="124433">newTyperRun</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#124344" title="(x$1: Global.this.TyperRun)Unit">currentTyperRun</a> = <span title="Global.this.TyperRun" class="keyword">new</span> <a href="#124432" title="Global.this.TyperRun">TyperRun</a>
  <span class="delimiter">}</span>

  <span class="keyword">class</span> <a title="class TyperResult extends java.lang.Throwable with scala.util.control.ControlThrowable with ScalaObject" id="124434">TyperResult</a><a href="#124434" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="Global.this.Tree" id="312218">tree</a>: <span title="Global.this.Tree">Tree</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="scala.util.control.ControlThrowable">ControlThrowable</span>
  
  <span title="(assertion: Boolean)Unit">assert</span><span class="delimiter">(</span><a href="../Global.scala.html#64895" title="=&gt; scala.tools.nsc.Phase">globalPhase</a>.<a href="../Phase.scala.html#102966" title="=&gt; Int">id</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
  
  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="[T](x: =&gt; T)Global.this.OnTypeError[T]" id="124435">addOnTypeError</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="124437">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="=&gt; T" id="124629">x</a>: =&gt; T<span class="delimiter">)</span>: <a href="#124438" title="Global.this.OnTypeError[T]">OnTypeError</a><span class="delimiter">[</span>T<span class="delimiter">]</span> = <span title="Global.this.OnTypeError[T]" class="keyword">new</span> <a href="#124438" title="Global.this.OnTypeError[T]">OnTypeError</a><span class="delimiter">(</span><a href="#124629" title="=&gt; T">x</a><span class="delimiter">)</span>
  
  <span class="keyword">class</span> <a title="class OnTypeError[T] extends java.lang.Object with ScalaObject" id="124438">OnTypeError</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="124439">T</a><span class="delimiter">]</span><a href="#124438" title="ScalaObject" class="delimiter">(</a><a title="=&gt; T" id="315099">op</a>: =&gt; T<span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(alt: =&gt; T)T" id="310009">onTypeError</a><span class="delimiter">(</span><a title="=&gt; T" id="313946">alt</a>: =&gt; T<span class="delimiter">)</span> = <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#315099" title="=&gt; T">op</a>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="T" id="313949">ex</a>: <a href="../symtab/Types.scala.html#67669" title="Global.this.TypeError">TypeError</a> =&gt; 
        <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;type error caught: &quot;)" class="string">&quot;type error caught: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#313949" title="Global.this.TypeError">ex</a><span class="delimiter">)</span>
        <a href="#313946" title="=&gt; T">alt</a>
      <span class="keyword">case</span> <a title="T" id="313959">ex</a>: <a href="../typechecker/Implicits.scala.html#29814" title="scala.tools.nsc.typechecker.DivergentImplicit">DivergentImplicit</a> =&gt;
        <a href="#124321" title="(msg: =&gt; String)Unit">debugLog</a><span class="delimiter">(</span><span title="java.lang.String(&quot;divergent implicit caught: &quot;)" class="string">&quot;divergent implicit caught: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#313959" title="scala.tools.nsc.typechecker.DivergentImplicit">ex</a><span class="delimiter">)</span>
        <a href="#313946" title="=&gt; T">alt</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object scala.tools.nsc.interactive.CancelException" id="315120">CancelException</a> <span title="ScalaObject" class="keyword">extends</span> <span title="java.lang.Exception">Exception</span>


        </pre>
    </body>
</html>
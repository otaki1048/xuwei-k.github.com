<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/interactive/RangePositions.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* NSC -- new Scala compiler
 * Copyright 2009-2011 Scala Solutions and LAMP/EPFL
 * @author Martin Odersky
 */</span>
<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> interactive

<span class="keyword">import</span> ast.Trees
<span class="keyword">import</span> symtab.Positions
<span class="keyword">import</span> scala.tools.nsc.util.<span class="delimiter">{</span>SourceFile, Position, RangePosition, NoPosition, WorkScheduler<span class="delimiter">}</span>
<span class="keyword">import</span> scala.collection.mutable.ListBuffer

<span class="comment">/** Handling range positions
 *  atPos, the main method in this trait, will add positions to a tree,
 *  and will ensure the following properties:
 *
 *    1. All nodes between the root of the tree and nodes that already have positions
 *       will be assigned positions.
 *    2. No node which already has a position will be assigned a different range; however
 *       a RangePosition might become a TransparentPosition.
 *    3. The position of each assigned node includes the positions of each of its children.
 *    4. The positions of all solid descendants of children of an assigned node
 *       are mutually non-overlapping.
 *
 * Here, the solid descendant of a node are:
 *
 *   If the node has a TransparentPosition, the solid descendants of all its children
 *   Otherwise, the singleton consisting of the node itself.
 */</span>
<span class="keyword">trait</span> <a title="trait RangePositions extends java.lang.Object with scala.tools.nsc.ast.Trees with scala.tools.nsc.symtab.Positions with ScalaObject" id="17669">RangePositions</a> <span title="ScalaObject" class="keyword">extends</span> <a href="../ast/Trees.scala.html#11591" title="scala.tools.nsc.ast.Trees">Trees</a> <span class="keyword">with</span> <a href="../symtab/Positions.scala.html#23974" title="scala.tools.nsc.symtab.Positions">Positions</a> <span class="delimiter">{</span> 
self: scala.tools.nsc.Global =&gt;

  case <span class="keyword">class</span> <a title="class Range extends java.lang.Object with ScalaObject with Product with Serializable" id="319438">Range</a><a href="#319438" title="ScalaObject" class="delimiter">(</a><a title="RangePositions.this.Position" id="319787">pos</a>: <a href="../util/Position.scala.html#30588" title="RangePositions.this.Position">Position</a>, <a title="RangePositions.this.Tree" id="319788">tree</a>: <span title="RangePositions.this.Tree">Tree</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="=&gt; Boolean" id="319407">isFree</a> = <a href="#319788" title="=&gt; RangePositions.this.Tree">tree</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#17669" title="object RangePositions.this.EmptyTree">EmptyTree</a>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(source: scala.tools.nsc.util.SourceFile, start: Int, point: Int, end: Int)scala.tools.nsc.util.RangePosition" id="124505">rangePos</a><span class="delimiter">(</span><a title="scala.tools.nsc.util.SourceFile" id="312588">source</a>: <a href="../util/SourceFile.scala.html#30381" title="scala.tools.nsc.util.SourceFile">SourceFile</a>, <a title="Int" id="312589">start</a>: <span title="Int">Int</span>, <a title="Int" id="312590">point</a>: <span title="Int">Int</span>, <a title="Int" id="312591">end</a>: <span title="Int">Int</span><span class="delimiter">)</span> = 
    <span title="scala.tools.nsc.util.RangePosition" class="keyword">new</span> <a href="../util/Position.scala.html#31173" title="scala.tools.nsc.util.RangePosition">RangePosition</a><span class="delimiter">(</span><a href="#312588" title="scala.tools.nsc.util.SourceFile">source</a>, <a href="#312589" title="Int">start</a>, <a href="#312590" title="Int">point</a>, <a href="#312591" title="Int">end</a><span class="delimiter">)</span>

  <span class="comment">/** A position that wraps a set of trees.
   *  The point of the wrapping position is the point of the default position.
   *  If some of the trees are ranges, returns a range position enclosing all ranges
   *  Otherwise returns default position.
   */</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(default: RangePositions.this.Position, trees: List[RangePositions.this.Tree])RangePositions.this.Position" id="124506">wrappingPos</a><span class="delimiter">(</span><a title="RangePositions.this.Position" id="319481">default</a>: <a href="../util/Position.scala.html#30588" title="RangePositions.this.Position">Position</a>, <a title="List[RangePositions.this.Tree]" id="319482">trees</a>: <span title="List[RangePositions.this.Tree]">List</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../util/Position.scala.html#30588" title="RangePositions.this.Position">Position</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="List[RangePositions.this.Tree]" id="319488">ranged</a> = <a href="#319482" title="List[RangePositions.this.Tree]">trees</a> <span title="(p: RangePositions.this.Tree =&gt; Boolean)List[RangePositions.this.Tree]">filter</span> <span class="delimiter">(</span><a href="#319492" title="RangePositions.this.Tree">_</a>.<span title="=&gt; RangePositions.this.Position">pos</span>.<a href="../util/Position.scala.html#97211" title="=&gt; Boolean">isRange</a><span class="delimiter">)</span>
    <span title="RangePositions.this.Position" class="keyword">if</span> <span class="delimiter">(</span><a href="#319488" title="List[RangePositions.this.Tree]">ranged</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#319481" title="RangePositions.this.Position">default</a>.<a href="../util/Position.scala.html#97227" title="=&gt; scala.tools.nsc.util.Position">focus</a>
    <span class="keyword">else</span> <span title="scala.tools.nsc.util.RangePosition" class="keyword">new</span> <a href="../util/Position.scala.html#31173" title="scala.tools.nsc.util.RangePosition">RangePosition</a><span class="delimiter">(</span><a href="#319481" title="RangePositions.this.Position">default</a>.<a href="../util/Position.scala.html#97208" title="=&gt; scala.tools.nsc.util.SourceFile">source</a>, <span class="delimiter">(</span><a href="#319488" title="List[RangePositions.this.Tree]">ranged</a> <span title="(f: RangePositions.this.Tree =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[List[RangePositions.this.Tree],Int,List[Int]])List[Int]">map</span> <span class="delimiter">(</span><a href="#319509" title="RangePositions.this.Tree">_</a>.<span title="=&gt; RangePositions.this.Position">pos</span>.<a href="../util/Position.scala.html#97214" title="=&gt; Int">start</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(implicit cmp: Ordering[Int])Int">min</span>, <a href="#319481" title="RangePositions.this.Position">default</a>.<a href="../util/Position.scala.html#97216" title="=&gt; Int">point</a>, <span class="delimiter">(</span><a href="#319488" title="List[RangePositions.this.Tree]">ranged</a> <span title="(f: RangePositions.this.Tree =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[List[RangePositions.this.Tree],Int,List[Int]])List[Int]">map</span> <span class="delimiter">(</span><a href="#319615" title="RangePositions.this.Tree">_</a>.<span title="=&gt; RangePositions.this.Position">pos</span>.<a href="../util/Position.scala.html#97218" title="=&gt; Int">end</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(implicit cmp: Ordering[Int])Int">max</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** A position that wraps a non-empty set of trees.
   *  The point of the wrapping position is the point of the first trees' position.
   *  If some of the trees are ranges, returns a range position enclosing all ranges
   *  Otherwise returns first tree's position.
   */</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(trees: List[RangePositions.this.Tree])RangePositions.this.Position" id="124507">wrappingPos</a><span class="delimiter">(</span><a title="List[RangePositions.this.Tree]" id="319707">trees</a>: <span title="List[RangePositions.this.Tree]">List</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../util/Position.scala.html#30588" title="RangePositions.this.Position">Position</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="RangePositions.this.Position" id="319710">headpos</a> = <a href="#319707" title="List[RangePositions.this.Tree]">trees</a>.<span title="=&gt; RangePositions.this.Tree">head</span>.<span title="=&gt; RangePositions.this.Position">pos</span>
    <span title="RangePositions.this.Position" class="keyword">if</span> <span class="delimiter">(</span><a href="#319710" title="RangePositions.this.Position">headpos</a>.<a href="../util/Position.scala.html#97209" title="=&gt; Boolean">isDefined</a><span class="delimiter">)</span> <a href="#124506" title="(default: RangePositions.this.Position, trees: List[RangePositions.this.Tree])RangePositions.this.Position">wrappingPos</a><span class="delimiter">(</span><a href="#319710" title="RangePositions.this.Position">headpos</a>, <a href="#319707" title="List[RangePositions.this.Tree]">trees</a><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#319710" title="RangePositions.this.Position">headpos</a>
  <span class="delimiter">}</span>

<span class="comment">/*
  override def integratePos(tree: Tree, pos: Position) = 
    if (pos.isSynthetic &amp;&amp; !tree.pos.isSynthetic) tree.syntheticDuplicate 
    else tree
*/</span>

  <span class="comment">// -------------- ensuring no overlaps -------------------------------</span>

  <span class="keyword">def</span> <a title="(tree: RangePositions.this.Tree)List[RangePositions.this.Tree]" id="124508">solidDescendants</a><span class="delimiter">(</span><a title="RangePositions.this.Tree" id="311267">tree</a>: <span title="RangePositions.this.Tree">Tree</span><span class="delimiter">)</span>: <span title="List[RangePositions.this.Tree]">List</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span> = 
    <span title="List[RangePositions.this.Tree]" class="keyword">if</span> <span class="delimiter">(</span><a href="#311267" title="RangePositions.this.Tree">tree</a>.<span title="=&gt; RangePositions.this.Position">pos</span>.<a href="../util/Position.scala.html#97210" title="=&gt; Boolean">isTransparent</a><span class="delimiter">)</span> <a href="#311267" title="RangePositions.this.Tree">tree</a>.<span title="=&gt; List[RangePositions.this.Tree]">children</span> <span title="(f: RangePositions.this.Tree =&gt; scala.collection.GenTraversableOnce[RangePositions.this.Tree])(implicit bf: scala.collection.generic.CanBuildFrom[List[RangePositions.this.Tree],RangePositions.this.Tree,List[RangePositions.this.Tree]])List[RangePositions.this.Tree]">flatMap</span> <a href="#124508" title="(tree: RangePositions.this.Tree)List[RangePositions.this.Tree]">solidDescendants</a> 
    <span class="keyword">else</span> <span title="(xs: RangePositions.this.Tree*)List[RangePositions.this.Tree]">List</span><span class="delimiter">(</span><a href="#311267" title="RangePositions.this.Tree">tree</a><span class="delimiter">)</span>

  <span class="comment">/** A free range from `lo` to `hi` */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(lo: Int, hi: Int)RangePositions.this.Range" id="124509">free</a><span class="delimiter">(</span><a title="Int" id="319784">lo</a>: <span title="Int">Int</span>, <a title="Int" id="319785">hi</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="#319438" title="RangePositions.this.Range">Range</a> = 
    <a href="#319438" title="(pos: RangePositions.this.Position, tree: RangePositions.this.Tree)RangePositions.this.Range">Range</a><span class="delimiter">(</span><span title="scala.tools.nsc.util.RangePosition" class="keyword">new</span> <a href="../util/Position.scala.html#31173" title="scala.tools.nsc.util.RangePosition">RangePosition</a><span class="delimiter">(</span><span title="Null(null)" class="keyword">null</span>, <a href="#319784" title="Int">lo</a>, <a href="#319784" title="Int">lo</a>, <a href="#319785" title="Int">hi</a><span class="delimiter">)</span>, <a href="#17669" title="object RangePositions.this.EmptyTree">EmptyTree</a><span class="delimiter">)</span>

  <span class="comment">/** The maximal free range */</span>
  <span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="RangePositions.this.Range" id="124511">maxFree</a>: <a href="#319438" title="RangePositions.this.Range">Range</a> = <a href="#124509" title="(lo: Int, hi: Int)RangePositions.this.Range">free</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, Int.<span title="Int(2147483647)">MaxValue</span><span class="delimiter">)</span>

  <span class="comment">/** A singleton list of a non-empty range from `lo` to `hi`, or else the empty List */</span> 
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(lo: Int, hi: Int)List[RangePositions.this.Range]" id="124512">maybeFree</a><span class="delimiter">(</span><a title="Int" id="319794">lo</a>: <span title="Int">Int</span>, <a title="Int" id="319795">hi</a>: <span title="Int">Int</span><span class="delimiter">)</span> = 
    <span title="List[RangePositions.this.Range]" class="keyword">if</span> <span class="delimiter">(</span><a href="#319794" title="Int">lo</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#319795" title="Int">hi</a><span class="delimiter">)</span> <span title="(xs: RangePositions.this.Range*)List[RangePositions.this.Range]">List</span><span class="delimiter">(</span><a href="#124509" title="(lo: Int, hi: Int)RangePositions.this.Range">free</a><span class="delimiter">(</span><a href="#319794" title="Int">lo</a>, <a href="#319795" title="Int">hi</a><span class="delimiter">)</span><span class="delimiter">)</span> 
    <span class="keyword">else</span> List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>

  <span class="comment">/** Insert `pos` into ranges `rs` if possible;
   *  otherwise add conflicting trees to `conflicting`.
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(rs: List[RangePositions.this.Range], t: RangePositions.this.Tree, conflicting: scala.collection.mutable.ListBuffer[RangePositions.this.Tree])List[RangePositions.this.Range]" id="124513">insert</a><span class="delimiter">(</span><a title="List[RangePositions.this.Range]" id="319818">rs</a>: <span title="List[RangePositions.this.Range]">List</span><span class="delimiter">[</span>Range<span class="delimiter">]</span>, <a title="RangePositions.this.Tree" id="319819">t</a>: <span title="RangePositions.this.Tree">Tree</span>, <a title="scala.collection.mutable.ListBuffer[RangePositions.this.Tree]" id="319820">conflicting</a>: <span title="scala.collection.mutable.ListBuffer[RangePositions.this.Tree]">ListBuffer</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="List[RangePositions.this.Range]">List</span><span class="delimiter">[</span>Range<span class="delimiter">]</span> = <a href="#319818" title="List[RangePositions.this.Range]">rs</a> <span title="List[RangePositions.this.Range]" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a href="#319823" title="List[RangePositions.this.Range]">List</a><span class="delimiter">(</span><span class="delimiter">)</span> =&gt;
      <span title="(assertion: Boolean)Unit">assert</span><span class="delimiter">(</span><a href="#319820" title="scala.collection.mutable.ListBuffer[RangePositions.this.Tree]">conflicting</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span>
      <a href="#319818" title="List[RangePositions.this.Range]">rs</a>
    <span class="keyword">case</span> <a title="List[RangePositions.this.Range]" id="319851">r</a> :: <a title="List[RangePositions.this.Range]" id="319852">rs1</a> =&gt;
      <span title="(assertion: Boolean)Unit">assert</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#319819" title="RangePositions.this.Tree">t</a>.<span title="=&gt; RangePositions.this.Position">pos</span>.<a href="../util/Position.scala.html#97210" title="=&gt; Boolean">isTransparent</a><span class="delimiter">)</span>
      <span title="List[RangePositions.this.Range]" class="keyword">if</span> <span class="delimiter">(</span><a href="#319851" title="RangePositions.this.Range">r</a>.<a href="#319407" title="=&gt; Boolean">isFree</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span class="delimiter">(</span><a href="#319851" title="RangePositions.this.Range">r</a>.<a href="#319787" title="=&gt; RangePositions.this.Position">pos</a> <a href="../util/Position.scala.html#97229" title="(pos: scala.tools.nsc.util.Position)Boolean">includes</a> <a href="#319819" title="RangePositions.this.Tree">t</a>.<span title="=&gt; RangePositions.this.Position">pos</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
<span class="comment">//      println(&quot;subdividing &quot;+r+&quot;/&quot;+t.pos)</span>
        <a href="#124512" title="(lo: Int, hi: Int)List[RangePositions.this.Range]">maybeFree</a><span class="delimiter">(</span><a href="#319819" title="RangePositions.this.Tree">t</a>.<span title="=&gt; RangePositions.this.Position">pos</span>.<a href="../util/Position.scala.html#97218" title="=&gt; Int">end</a>, <a href="#319851" title="RangePositions.this.Range">r</a>.<a href="#319787" title="=&gt; RangePositions.this.Position">pos</a>.<a href="../util/Position.scala.html#97218" title="=&gt; Int">end</a><span class="delimiter">)</span> <a href="#319855" title="(prefix: List[RangePositions.this.Range])List[RangePositions.this.Range]">:::</a> <span title="(xs: RangePositions.this.Range*)List[RangePositions.this.Range]">List</span><span class="delimiter">(</span><a href="#319438" title="(pos: RangePositions.this.Position, tree: RangePositions.this.Tree)RangePositions.this.Range">Range</a><span class="delimiter">(</span><a href="#319819" title="RangePositions.this.Tree">t</a>.<span title="=&gt; RangePositions.this.Position">pos</span>, <a href="#319819" title="RangePositions.this.Tree">t</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#319856" title="(prefix: List[RangePositions.this.Range])List[RangePositions.this.Range]">:::</a> <a href="#124512" title="(lo: Int, hi: Int)List[RangePositions.this.Range]">maybeFree</a><span class="delimiter">(</span><a href="#319851" title="RangePositions.this.Range">r</a>.<a href="#319787" title="=&gt; RangePositions.this.Position">pos</a>.<a href="../util/Position.scala.html#97214" title="=&gt; Int">start</a>, <a href="#319819" title="RangePositions.this.Tree">t</a>.<span title="=&gt; RangePositions.this.Position">pos</span>.<a href="../util/Position.scala.html#97214" title="=&gt; Int">start</a><span class="delimiter">)</span> <a href="#319864" title="(prefix: List[RangePositions.this.Range])List[RangePositions.this.Range]">:::</a> <a href="#319852" title="List[RangePositions.this.Range]">rs1</a>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#319851" title="RangePositions.this.Range">r</a>.<a href="#319407" title="=&gt; Boolean">isFree</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span class="delimiter">(</span><a href="#319851" title="RangePositions.this.Range">r</a>.<a href="#319787" title="=&gt; RangePositions.this.Position">pos</a> <a href="../util/Position.scala.html#97233" title="(pos: scala.tools.nsc.util.Position)Boolean">overlaps</a> <a href="#319819" title="RangePositions.this.Tree">t</a>.<span title="=&gt; RangePositions.this.Position">pos</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#319820" title="scala.collection.mutable.ListBuffer[RangePositions.this.Tree]">conflicting</a> <span title="(x: RangePositions.this.Tree)conflicting.type">+=</span> <a href="#319851" title="RangePositions.this.Range">r</a>.<a href="#319788" title="=&gt; RangePositions.this.Tree">tree</a> 
        <a href="#319851" title="RangePositions.this.Range">r</a> <a href="#319937" title="(x: RangePositions.this.Range)List[RangePositions.this.Range]">::</a> <a href="#124513" title="(rs: List[RangePositions.this.Range], t: RangePositions.this.Tree, conflicting: scala.collection.mutable.ListBuffer[RangePositions.this.Tree])List[RangePositions.this.Range]">insert</a><span class="delimiter">(</span><a href="#319852" title="List[RangePositions.this.Range]">rs1</a>, <a href="#319819" title="RangePositions.this.Tree">t</a>, <a href="#319820" title="scala.collection.mutable.ListBuffer[RangePositions.this.Tree]">conflicting</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Replace elem `t` of `ts` by `replacement` list. */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(ts: List[RangePositions.this.Tree], t: RangePositions.this.Tree, replacement: List[RangePositions.this.Tree])List[RangePositions.this.Tree]" id="124514">replace</a><span class="delimiter">(</span><a title="List[RangePositions.this.Tree]" id="319943">ts</a>: <span title="List[RangePositions.this.Tree]">List</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span>, <a title="RangePositions.this.Tree" id="319944">t</a>: <span title="RangePositions.this.Tree">Tree</span>, <a title="List[RangePositions.this.Tree]" id="319945">replacement</a>: <span title="List[RangePositions.this.Tree]">List</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="List[RangePositions.this.Tree]">List</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span> = 
    <span title="List[RangePositions.this.Tree]" class="keyword">if</span> <span class="delimiter">(</span><a href="#319943" title="List[RangePositions.this.Tree]">ts</a>.<span title="=&gt; RangePositions.this.Tree">head</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#319944" title="RangePositions.this.Tree">t</a><span class="delimiter">)</span> <a href="#319945" title="List[RangePositions.this.Tree]">replacement</a> <a href="#319952" title="(prefix: List[RangePositions.this.Tree])List[RangePositions.this.Tree]">:::</a> <a href="#319943" title="List[RangePositions.this.Tree]">ts</a>.<span title="=&gt; List[RangePositions.this.Tree]">tail</span>
    <span class="keyword">else</span> <a href="#319943" title="List[RangePositions.this.Tree]">ts</a>.<span title="=&gt; RangePositions.this.Tree">head</span> <a href="#319960" title="(x: RangePositions.this.Tree)List[RangePositions.this.Tree]">::</a> <a href="#124514" title="(ts: List[RangePositions.this.Tree], t: RangePositions.this.Tree, replacement: List[RangePositions.this.Tree])List[RangePositions.this.Tree]">replace</a><span class="delimiter">(</span><a href="#319943" title="List[RangePositions.this.Tree]">ts</a>.<span title="=&gt; List[RangePositions.this.Tree]">tail</span>, <a href="#319944" title="RangePositions.this.Tree">t</a>, <a href="#319945" title="List[RangePositions.this.Tree]">replacement</a><span class="delimiter">)</span>

  <span class="comment">/** Ensure that given tree has no positions that overlap with
   *  any of the positions of `others`. This is done by
   *  shortening the range or assigning TransparentPositions
   *  to some of the nodes in `tree`.
   */</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: RangePositions.this.Tree, others: List[RangePositions.this.Tree])Unit" id="124515">ensureNonOverlapping</a><span class="delimiter">(</span><a title="RangePositions.this.Tree" id="319966">tree</a>: <span title="RangePositions.this.Tree">Tree</span>, <a title="List[RangePositions.this.Tree]" id="319967">others</a>: <span title="List[RangePositions.this.Tree]">List</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(pos: RangePositions.this.Position)Boolean" id="319971">isOverlapping</a><span class="delimiter">(</span><a title="RangePositions.this.Position" id="319972">pos</a>: <a href="../util/Position.scala.html#30588" title="RangePositions.this.Position">Position</a><span class="delimiter">)</span> = 
      <a href="#319972" title="RangePositions.this.Position">pos</a>.<a href="../util/Position.scala.html#97211" title="=&gt; Boolean">isRange</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span class="delimiter">(</span><a href="#319967" title="List[RangePositions.this.Tree]">others</a> <span title="(p: RangePositions.this.Tree =&gt; Boolean)Boolean">exists</span> <span class="delimiter">(</span><a href="#319972" title="RangePositions.this.Position">pos</a> <a href="../util/Position.scala.html#97233" title="(pos: scala.tools.nsc.util.Position)Boolean">overlaps</a> <a href="#319979" title="RangePositions.this.Tree">_</a>.<span title="=&gt; RangePositions.this.Position">pos</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#319971" title="(pos: RangePositions.this.Position)Boolean">isOverlapping</a><span class="delimiter">(</span><a href="#319966" title="RangePositions.this.Tree">tree</a>.<span title="=&gt; RangePositions.this.Position">pos</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="List[RangePositions.this.Tree]" id="319980">children</a> = <a href="#319966" title="RangePositions.this.Tree">tree</a>.<span title="=&gt; List[RangePositions.this.Tree]">children</span>
      <a href="#319980" title="List[RangePositions.this.Tree]">children</a> <span title="(f: RangePositions.this.Tree =&gt; Unit)Unit">foreach</span> <span class="delimiter">(</span><a href="#124515" title="(tree: RangePositions.this.Tree, others: List[RangePositions.this.Tree])Unit">ensureNonOverlapping</a><span class="delimiter">(</span><a href="#320000" title="RangePositions.this.Tree">_</a>, <a href="#319967" title="List[RangePositions.this.Tree]">others</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#319966" title="RangePositions.this.Tree">tree</a>.<span title="=&gt; RangePositions.this.Position">pos</span>.<a href="../util/Position.scala.html#97212" title="=&gt; Boolean">isOpaqueRange</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="RangePositions.this.Position" id="320002">wpos</a> = <a href="#124506" title="(default: RangePositions.this.Position, trees: List[RangePositions.this.Tree])RangePositions.this.Position">wrappingPos</a><span class="delimiter">(</span><a href="#319966" title="RangePositions.this.Tree">tree</a>.<span title="=&gt; RangePositions.this.Position">pos</span>.<a href="../util/Position.scala.html#97227" title="=&gt; scala.tools.nsc.util.Position">focus</a>, <a href="#319980" title="List[RangePositions.this.Tree]">children</a><span class="delimiter">)</span>
        <a href="#319966" title="RangePositions.this.Tree">tree</a> <span title="(pos: RangePositions.this.Position)tree.type">setPos</span> <span class="delimiter">(</span><span title="RangePositions.this.Position" class="keyword">if</span> <span class="delimiter">(</span><a href="#319971" title="(pos: RangePositions.this.Position)Boolean">isOverlapping</a><span class="delimiter">(</span><a href="#320002" title="RangePositions.this.Position">wpos</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#319966" title="RangePositions.this.Tree">tree</a>.<span title="=&gt; RangePositions.this.Position">pos</span>.<a href="../util/Position.scala.html#97213" title="=&gt; scala.tools.nsc.util.Position">makeTransparent</a> <span class="keyword">else</span> <a href="#320002" title="RangePositions.this.Position">wpos</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Does given list of trees have mutually non-overlapping positions?
   *  pre: None of the trees is transparent
   */</span>
  <span class="keyword">def</span> <a title="(cts: List[RangePositions.this.Tree])List[(RangePositions.this.Tree, RangePositions.this.Tree)]" id="124516">findOverlapping</a><span class="delimiter">(</span><a title="List[RangePositions.this.Tree]" id="320008">cts</a>: <span title="List[RangePositions.this.Tree]">List</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="List[(RangePositions.this.Tree, RangePositions.this.Tree)]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>Tree, Tree<span class="delimiter">)</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="List[RangePositions.this.Range]" id="320010">ranges</a> = <span title="(xs: RangePositions.this.Range*)List[RangePositions.this.Range]">List</span><span class="delimiter">(</span><a href="#124510" title="=&gt; RangePositions.this.Range">maxFree</a><span class="delimiter">)</span>
    <span class="keyword">for</span> <span class="delimiter">(</span><a title="RangePositions.this.Tree" id="320037">ct</a> &lt;- <a href="#320008" title="(f: RangePositions.this.Tree =&gt; Unit)Unit">cts</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#320037" title="RangePositions.this.Tree">ct</a>.<span title="=&gt; RangePositions.this.Position">pos</span>.<a href="../util/Position.scala.html#97212" title="=&gt; Boolean">isOpaqueRange</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="scala.collection.mutable.ListBuffer[RangePositions.this.Tree]" id="320038">conflicting</a> = <span title="scala.collection.mutable.ListBuffer[RangePositions.this.Tree]" class="keyword">new</span> <span title="scala.collection.mutable.ListBuffer[RangePositions.this.Tree]">ListBuffer</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span>
        <a href="#320010" title="List[RangePositions.this.Range]">ranges</a> = <a href="#124513" title="(rs: List[RangePositions.this.Range], t: RangePositions.this.Tree, conflicting: scala.collection.mutable.ListBuffer[RangePositions.this.Tree])List[RangePositions.this.Range]">insert</a><span class="delimiter">(</span><a href="#320010" title="List[RangePositions.this.Range]">ranges</a>, <a href="#320037" title="RangePositions.this.Tree">ct</a>, <a href="#320038" title="scala.collection.mutable.ListBuffer[RangePositions.this.Tree]">conflicting</a><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#320038" title="scala.collection.mutable.ListBuffer[RangePositions.this.Tree]">conflicting</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <span title="Nothing" class="keyword">return</span> <a href="#320038" title="scala.collection.mutable.ListBuffer[RangePositions.this.Tree]">conflicting</a>.<span title="=&gt; List[RangePositions.this.Tree]">toList</span> <span title="(f: RangePositions.this.Tree =&gt; (RangePositions.this.Tree, RangePositions.this.Tree))(implicit bf: scala.collection.generic.CanBuildFrom[List[RangePositions.this.Tree],(RangePositions.this.Tree, RangePositions.this.Tree),List[(RangePositions.this.Tree, RangePositions.this.Tree)]])List[(RangePositions.this.Tree, RangePositions.this.Tree)]">map</span> <span class="delimiter">(</span><a title="RangePositions.this.Tree" id="320069">t</a> =&gt; <span title="(_1: RangePositions.this.Tree, _2: RangePositions.this.Tree)(RangePositions.this.Tree, RangePositions.this.Tree)" class="delimiter">(</span><a href="#320069" title="RangePositions.this.Tree">t</a>, <a href="#320037" title="RangePositions.this.Tree">ct</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">// -------------- setting positions -------------------------------</span>

  <span class="comment">/** Set position of all children of a node
   *  @param  pos   A target position.
   *                Uses the point of the position as the point of all positions it assigns.
   *                Uses the start of this position as an Offset position for unpositioed trees
   *                without children.
   *  @param  trees  The children to position. All children must be positionable. 
   */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(pos: RangePositions.this.Position, trees: List[RangePositions.this.Tree])Unit" id="124517">setChildrenPos</a><span class="delimiter">(</span><a title="RangePositions.this.Position" id="320111">pos</a>: <a href="../util/Position.scala.html#30588" title="RangePositions.this.Position">Position</a>, <a title="List[RangePositions.this.Tree]" id="320112">trees</a>: <span title="List[RangePositions.this.Tree]">List</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="keyword">try</span> <span class="delimiter">{</span>
    <span class="keyword">for</span> <span class="delimiter">(</span><a title="RangePositions.this.Tree" id="320133">tree</a> &lt;- <a href="#320112" title="(f: RangePositions.this.Tree =&gt; Any)Unit">trees</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#320133" title="RangePositions.this.Tree">tree</a>.<span title="=&gt; Boolean">isEmpty</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#320133" title="RangePositions.this.Tree">tree</a>.<span title="=&gt; RangePositions.this.Position">pos</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../symtab/Positions.scala.html#67902" title="=&gt; tools.nsc.util.NoPosition.type">NoPosition</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="List[RangePositions.this.Tree]" id="320139">children</a> = <a href="#320133" title="RangePositions.this.Tree">tree</a>.<span title="=&gt; List[RangePositions.this.Tree]">children</span>
        <span title="tree.type" class="keyword">if</span> <span class="delimiter">(</span><a href="#320139" title="List[RangePositions.this.Tree]">children</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#320133" title="RangePositions.this.Tree">tree</a> <span title="(pos: RangePositions.this.Position)tree.type">setPos</span> <a href="#320111" title="RangePositions.this.Position">pos</a>.<a href="../util/Position.scala.html#97227" title="=&gt; scala.tools.nsc.util.Position">focus</a>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#124517" title="(pos: RangePositions.this.Position, trees: List[RangePositions.this.Tree])Unit">setChildrenPos</a><span class="delimiter">(</span><a href="#320111" title="RangePositions.this.Position">pos</a>, <a href="#320139" title="List[RangePositions.this.Tree]">children</a><span class="delimiter">)</span>
          <a href="#320133" title="RangePositions.this.Tree">tree</a> <span title="(pos: RangePositions.this.Position)tree.type">setPos</span> <a href="#124506" title="(default: RangePositions.this.Position, trees: List[RangePositions.this.Tree])RangePositions.this.Position">wrappingPos</a><span class="delimiter">(</span><a href="#320111" title="RangePositions.this.Position">pos</a>, <a href="#320139" title="List[RangePositions.this.Tree]">children</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a title="Nothing" id="320154">ex</a>: <span title="Exception">Exception</span> =&gt;
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;error while set children pos &quot;)" class="string">&quot;error while set children pos &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#320111" title="RangePositions.this.Position">pos</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; of &quot;)" class="string">&quot; of &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#320112" title="List[RangePositions.this.Tree]">trees</a><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">throw</span> <a href="#320154" title="Exception">ex</a>
  <span class="delimiter">}</span>

  <span class="comment">/** Position a tree.
   *  This means: Set position of a node and position all its unpositioned children.
   */</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="[T &lt;: RangePositions.this.Tree](pos: RangePositions.this.Position)(tree: T)T" id="124518">atPos</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: RangePositions.this.Tree" id="124520">T</a> &lt;: Tree<span class="delimiter">]</span><span class="delimiter">(</span><a title="RangePositions.this.Position" id="320157">pos</a>: <a href="../util/Position.scala.html#30588" title="RangePositions.this.Position">Position</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="T" id="320158">tree</a>: <a href="#124520" title="T">T</a><span class="delimiter">)</span>: <a href="#124520" title="T">T</a> =
    <span title="T" class="keyword">if</span> <span class="delimiter">(</span><a href="#320157" title="RangePositions.this.Position">pos</a>.<a href="../util/Position.scala.html#97212" title="=&gt; Boolean">isOpaqueRange</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#320158" title="T">tree</a>.<span title="=&gt; Boolean">isEmpty</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#320158" title="T">tree</a>.<span title="=&gt; RangePositions.this.Position">pos</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../symtab/Positions.scala.html#67902" title="=&gt; tools.nsc.util.NoPosition.type">NoPosition</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#320158" title="T">tree</a>.<span title="(pos: RangePositions.this.Position)tree.type">setPos</span><span class="delimiter">(</span><a href="#320157" title="RangePositions.this.Position">pos</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="List[RangePositions.this.Tree]" id="320171">children</a> = <a href="#320158" title="T">tree</a>.<span title="=&gt; List[RangePositions.this.Tree]">children</span>
        <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#320171" title="List[RangePositions.this.Tree]">children</a>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#320171" title="List[RangePositions.this.Tree]">children</a>.<span title="=&gt; List[RangePositions.this.Tree]">tail</span>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#124518" title="(pos: RangePositions.this.Position)(tree: RangePositions.this.Tree)RangePositions.this.Tree">atPos</a><span class="delimiter">(</span><a href="#320157" title="RangePositions.this.Position">pos</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#320171" title="List[RangePositions.this.Tree]">children</a>.<span title="=&gt; RangePositions.this.Tree">head</span><span class="delimiter">)</span>
          <span class="keyword">else</span> <a href="#124517" title="(pos: RangePositions.this.Position, trees: List[RangePositions.this.Tree])Unit">setChildrenPos</a><span class="delimiter">(</span><a href="#320157" title="RangePositions.this.Position">pos</a>, <a href="#320171" title="List[RangePositions.this.Tree]">children</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <a href="#320158" title="T">tree</a>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#17669" title="&lt;none&gt; extends scala.tools.nsc.interactive.RangePositions with scala.tools.nsc.Global" class="keyword">super</a>.<a href="../ast/Trees.scala.html#67851" title="(pos: RangePositions.this.Position)(tree: T)T">atPos</a><span class="delimiter">(</span><a href="#320157" title="RangePositions.this.Position">pos</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#320158" title="T">tree</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="comment">// ---------------- Validating positions ----------------------------------</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: RangePositions.this.Tree)Unit" id="124521">validatePositions</a><span class="delimiter">(</span><a title="RangePositions.this.Tree" id="313485">tree</a>: <span title="RangePositions.this.Tree">Tree</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(prefix: String, tree: RangePositions.this.Tree)Unit" id="320199">reportTree</a><span class="delimiter">(</span><a title="String" id="320202">prefix</a> : <span title="String">String</span>, <a title="RangePositions.this.Tree" id="320203">tree</a> : <span title="RangePositions.this.Tree">Tree</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.lang.Object" id="320204">source</a> = <span title="java.lang.Object" class="keyword">if</span> <span class="delimiter">(</span><a href="#320203" title="RangePositions.this.Tree">tree</a>.<span title="=&gt; RangePositions.this.Position">pos</span>.<a href="../util/Position.scala.html#97209" title="=&gt; Boolean">isDefined</a><span class="delimiter">)</span> <a href="#320203" title="RangePositions.this.Tree">tree</a>.<span title="=&gt; RangePositions.this.Position">pos</span>.<a href="../util/Position.scala.html#97208" title="=&gt; scala.tools.nsc.util.SourceFile">source</a> <span class="keyword">else</span> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>
      <a href="../Global.scala.html#64873" title="(msg: String)Unit">inform</a><span class="delimiter">(</span><span title="java.lang.String(&quot;== &quot;)" class="string">&quot;== &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#320202" title="String">prefix</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; tree [&quot;)" class="string">&quot; tree [&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#320203" title="RangePositions.this.Tree">tree</a>.<span title="=&gt; Int">id</span><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;] of type &quot;)" class="string">&quot;] of type &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#320203" title="RangePositions.this.Tree">tree</a>.<span title="=&gt; java.lang.String">productPrefix</span><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; at &quot;)" class="string">&quot; at &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#320203" title="RangePositions.this.Tree">tree</a>.<span title="=&gt; RangePositions.this.Position">pos</span>.<a href="../util/Position.scala.html#97241" title="=&gt; String">show</a><span title="(x$1: Any)java.lang.String">+</span><a href="#320204" title="java.lang.Object">source</a><span class="delimiter">)</span>
      <a href="../Global.scala.html#64873" title="(msg: String)Unit">inform</a><span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
      <a href="../Global.scala.html#64873" title="(msg: String)Unit">inform</a><span class="delimiter">(</span><a href="#320203" title="RangePositions.this.Tree">tree</a>.<span title="()String">toString</span><span class="delimiter">)</span>
      <a href="../Global.scala.html#64873" title="(msg: String)Unit">inform</a><span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(msg: String)(body: =&gt; Unit)Unit" id="320200">positionError</a><span class="delimiter">(</span><a title="String" id="320245">msg</a>: <span title="String">String</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="=&gt; Unit" id="320246">body</a> : =&gt; Unit<span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../Global.scala.html#64873" title="(msg: String)Unit">inform</a><span class="delimiter">(</span><span title="java.lang.String(&quot;======= Bad positions: &quot;)" class="string">&quot;======= Bad positions: &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#320245" title="String">msg</a><span class="delimiter">)</span>
      <a href="../Global.scala.html#64873" title="(msg: String)Unit">inform</a><span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
      <a href="#320246" title="=&gt; Unit">body</a>
      <a href="../Global.scala.html#64873" title="(msg: String)Unit">inform</a><span class="delimiter">(</span><span title="java.lang.String(&quot;=== While validating&quot;)" class="string">&quot;=== While validating&quot;</span><span class="delimiter">)</span>
      <a href="../Global.scala.html#64873" title="(msg: String)Unit">inform</a><span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
      <a href="../Global.scala.html#64873" title="(msg: String)Unit">inform</a><span class="delimiter">(</span><a href="#313485" title="RangePositions.this.Tree">tree</a>.<span title="()String">toString</span><span class="delimiter">)</span>
      <a href="../Global.scala.html#64873" title="(msg: String)Unit">inform</a><span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
      <a href="../Global.scala.html#64873" title="(msg: String)Unit">inform</a><span class="delimiter">(</span><span title="java.lang.String(&quot;=======&quot;)" class="string">&quot;=======&quot;</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">throw</span> <span title="RangePositions.this.ValidateException" class="keyword">new</span> <a href="#124522" title="RangePositions.this.ValidateException">ValidateException</a><span class="delimiter">(</span><a href="#320245" title="String">msg</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(tree: RangePositions.this.Tree, encltree: RangePositions.this.Tree)Unit" id="320201">validate</a><span class="delimiter">(</span><a title="RangePositions.this.Tree" id="320297">tree</a>: <span title="RangePositions.this.Tree">Tree</span>, <a title="RangePositions.this.Tree" id="320298">encltree</a>: <span title="RangePositions.this.Tree">Tree</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#320297" title="RangePositions.this.Tree">tree</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#320297" title="RangePositions.this.Tree">tree</a>.<span title="=&gt; RangePositions.this.Position">pos</span>.<a href="../util/Position.scala.html#97209" title="=&gt; Boolean">isDefined</a><span class="delimiter">)</span> 
          <a href="#320200" title="(msg: String)(body: =&gt; Unit)Unit">positionError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Unpositioned tree [&quot;)" class="string">&quot;Unpositioned tree [&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#320297" title="RangePositions.this.Tree">tree</a>.<span title="=&gt; Int">id</span><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;]&quot;)" class="string">&quot;]&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#320199" title="(prefix: String, tree: RangePositions.this.Tree)Unit">reportTree</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Unpositioned&quot;)" class="string">&quot;Unpositioned&quot;</span>, <a href="#320297" title="RangePositions.this.Tree">tree</a><span class="delimiter">)</span> <span class="delimiter">}</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#320297" title="RangePositions.this.Tree">tree</a>.<span title="=&gt; RangePositions.this.Position">pos</span>.<a href="../util/Position.scala.html#97211" title="=&gt; Boolean">isRange</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#320298" title="RangePositions.this.Tree">encltree</a>.<span title="=&gt; RangePositions.this.Position">pos</span>.<a href="../util/Position.scala.html#97211" title="=&gt; Boolean">isRange</a><span class="delimiter">)</span>
            <a href="#320200" title="(msg: String)(body: =&gt; Unit)Unit">positionError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Synthetic tree [&quot;)" class="string">&quot;Synthetic tree [&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#320298" title="RangePositions.this.Tree">encltree</a>.<span title="=&gt; Int">id</span><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;] contains nonsynthetic tree [&quot;)" class="string">&quot;] contains nonsynthetic tree [&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#320297" title="RangePositions.this.Tree">tree</a>.<span title="=&gt; Int">id</span><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;]&quot;)" class="string">&quot;]&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#320199" title="(prefix: String, tree: RangePositions.this.Tree)Unit">reportTree</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Enclosing&quot;)" class="string">&quot;Enclosing&quot;</span>, <a href="#320298" title="RangePositions.this.Tree">encltree</a><span class="delimiter">)</span>
            <a href="#320199" title="(prefix: String, tree: RangePositions.this.Tree)Unit">reportTree</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Enclosed&quot;)" class="string">&quot;Enclosed&quot;</span>, <a href="#320297" title="RangePositions.this.Tree">tree</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><span class="delimiter">(</span><a href="#320298" title="RangePositions.this.Tree">encltree</a>.<span title="=&gt; RangePositions.this.Position">pos</span> <a href="../util/Position.scala.html#97229" title="(pos: scala.tools.nsc.util.Position)Boolean">includes</a> <a href="#320297" title="RangePositions.this.Tree">tree</a>.<span title="=&gt; RangePositions.this.Position">pos</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#320200" title="(msg: String)(body: =&gt; Unit)Unit">positionError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Enclosing tree [&quot;)" class="string">&quot;Enclosing tree [&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#320298" title="RangePositions.this.Tree">encltree</a>.<span title="=&gt; Int">id</span><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;] does not include tree [&quot;)" class="string">&quot;] does not include tree [&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#320297" title="RangePositions.this.Tree">tree</a>.<span title="=&gt; Int">id</span><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;]&quot;)" class="string">&quot;]&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#320199" title="(prefix: String, tree: RangePositions.this.Tree)Unit">reportTree</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Enclosing&quot;)" class="string">&quot;Enclosing&quot;</span>, <a href="#320298" title="RangePositions.this.Tree">encltree</a><span class="delimiter">)</span>
              <a href="#320199" title="(prefix: String, tree: RangePositions.this.Tree)Unit">reportTree</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Enclosed&quot;)" class="string">&quot;Enclosed&quot;</span>, <a href="#320297" title="RangePositions.this.Tree">tree</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          
          <a href="#124516" title="(cts: List[RangePositions.this.Tree])List[(RangePositions.this.Tree, RangePositions.this.Tree)]">findOverlapping</a><span class="delimiter">(</span><a href="#320297" title="RangePositions.this.Tree">tree</a>.<span title="=&gt; List[RangePositions.this.Tree]">children</span> <span title="(f: RangePositions.this.Tree =&gt; scala.collection.GenTraversableOnce[RangePositions.this.Tree])(implicit bf: scala.collection.generic.CanBuildFrom[List[RangePositions.this.Tree],RangePositions.this.Tree,List[RangePositions.this.Tree]])List[RangePositions.this.Tree]">flatMap</span> <a href="#124508" title="(tree: RangePositions.this.Tree)List[RangePositions.this.Tree]">solidDescendants</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a href="#320347" title="Unit">List</a><span class="delimiter">(</span><span class="delimiter">)</span> =&gt; ;
            <span class="keyword">case</span> <a title="Unit" id="320358">xs</a> =&gt; <span class="delimiter">{</span>
              <a href="#320200" title="(msg: String)(body: =&gt; Unit)Unit">positionError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Overlapping trees &quot;)" class="string">&quot;Overlapping trees &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#320358" title="List[(RangePositions.this.Tree, RangePositions.this.Tree)]">xs</a>.<span title="(f: (RangePositions.this.Tree, RangePositions.this.Tree) =&gt; (Int, Int))(implicit bf: scala.collection.generic.CanBuildFrom[List[(RangePositions.this.Tree, RangePositions.this.Tree)],(Int, Int),List[(Int, Int)]])List[(Int, Int)]">map</span> <a href="#320375" title="(Int, Int)" class="delimiter">{</a> <span class="keyword">case</span> <span title="(Int, Int)" class="delimiter">(</span><a title="RangePositions.this.Tree" id="320378">x</a>, <a title="RangePositions.this.Tree" id="320379">y</a><span class="delimiter">)</span> =&gt; <span title="(_1: Int, _2: Int)(Int, Int)" class="delimiter">(</span><a href="#320378" title="RangePositions.this.Tree">x</a>.<span title="=&gt; Int">id</span>, <a href="#320379" title="RangePositions.this.Tree">y</a>.<span title="=&gt; Int">id</span><span class="delimiter">)</span> <span class="delimiter">}</span>.<span title="(start: String, sep: String, end: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="#320199" title="(prefix: String, tree: RangePositions.this.Tree)Unit">reportTree</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Ancestor&quot;)" class="string">&quot;Ancestor&quot;</span>, <a href="#320297" title="RangePositions.this.Tree">tree</a><span class="delimiter">)</span>
                <span class="keyword">for</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="RangePositions.this.Tree" id="320452">x</a>, <a title="RangePositions.this.Tree" id="320453">y</a><span class="delimiter">)</span> &lt;- <a href="#320358" title="(f: (RangePositions.this.Tree, RangePositions.this.Tree) =&gt; Unit)Unit">xs</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                  <a href="#320199" title="(prefix: String, tree: RangePositions.this.Tree)Unit">reportTree</a><span class="delimiter">(</span><span title="java.lang.String(&quot;First overlapping&quot;)" class="string">&quot;First overlapping&quot;</span>, <a href="#320452" title="RangePositions.this.Tree">x</a><span class="delimiter">)</span>
                  <a href="#320199" title="(prefix: String, tree: RangePositions.this.Tree)Unit">reportTree</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Second overlapping&quot;)" class="string">&quot;Second overlapping&quot;</span>, <a href="#320453" title="RangePositions.this.Tree">y</a><span class="delimiter">)</span>
                <span class="delimiter">}</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        <span class="keyword">for</span> <span class="delimiter">(</span><a title="RangePositions.this.Tree" id="320523">ct</a> &lt;- <a href="#320297" title="RangePositions.this.Tree">tree</a>.<span title="=&gt; List[RangePositions.this.Tree]">children</span> <span title="(f: RangePositions.this.Tree =&gt; Unit)Unit">flatMap</span> <a href="#124508" title="(tree: RangePositions.this.Tree)List[RangePositions.this.Tree]">solidDescendants</a><span class="delimiter">)</span> <a href="#320201" title="(tree: RangePositions.this.Tree, encltree: RangePositions.this.Tree)Unit">validate</a><span class="delimiter">(</span><a href="#320523" title="RangePositions.this.Tree">ct</a>, <a href="#320297" title="RangePositions.this.Tree">tree</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <a href="#320201" title="(tree: RangePositions.this.Tree, encltree: RangePositions.this.Tree)Unit">validate</a><span class="delimiter">(</span><a href="#313485" title="RangePositions.this.Tree">tree</a>, <a href="#313485" title="RangePositions.this.Tree">tree</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">class</span> <a title="class ValidateException extends java.lang.Exception with ScalaObject" id="124522">ValidateException</a><a href="#124522" title="ScalaObject" class="delimiter">(</a><a title="String" id="320296">msg</a> : <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="java.lang.Exception">Exception</span><span class="delimiter">(</span><a href="#320296" title="String">msg</a><span class="delimiter">)</span>

  <span class="comment">// ---------------- Locating trees ----------------------------------</span>

  <span class="comment">/** A locator for trees with given positions.
   *  Given a position `pos`, locator.apply returns
   *  the smallest tree that encloses `pos`.
   */</span>
  <span class="keyword">class</span> <a title="class Locator extends RangePositions.this.Traverser with ScalaObject" id="124523">Locator</a><a href="#124523" title="ScalaObject" class="delimiter">(</a><a title="RangePositions.this.Position" id="310207">pos</a>: <a href="../util/Position.scala.html#30588" title="RangePositions.this.Position">Position</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../ast/Trees.scala.html#67837" title="RangePositions.this.Traverser">Traverser</a> <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="RangePositions.this.Tree" id="310202">last</a>: <span title="RangePositions.this.Tree">Tree</span> = _
    <span class="keyword">def</span> <a title="(root: RangePositions.this.Tree)RangePositions.this.Tree" id="310204">locateIn</a><span class="delimiter">(</span><a title="RangePositions.this.Tree" id="310209">root</a>: <span title="RangePositions.this.Tree">Tree</span><span class="delimiter">)</span>: <span title="RangePositions.this.Tree">Tree</span> = <span class="delimiter">{</span>
      <a href="#124523" title="Locator.this.type" class="keyword">this</a>.<a href="#310202" title="(x$1: RangePositions.this.Tree)Unit">last</a> = <a href="#17669" title="object RangePositions.this.EmptyTree">EmptyTree</a>
      <a href="#310206" title="(t: RangePositions.this.Tree)Unit">traverse</a><span class="delimiter">(</span><a href="#310209" title="RangePositions.this.Tree">root</a><span class="delimiter">)</span>
      <a href="#124523" title="Locator.this.type" class="keyword">this</a>.<a href="#310202" title="=&gt; RangePositions.this.Tree">last</a>
    <span class="delimiter">}</span>
    <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(t: RangePositions.this.Tree)Boolean" id="310205">isEligible</a><span class="delimiter">(</span><a title="RangePositions.this.Tree" id="320541">t</a>: <span title="RangePositions.this.Tree">Tree</span><span class="delimiter">)</span> = <span title="=&gt; Boolean">!</span><a href="#320541" title="RangePositions.this.Tree">t</a>.<span title="=&gt; RangePositions.this.Position">pos</span>.<a href="../util/Position.scala.html#97210" title="=&gt; Boolean">isTransparent</a>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(t: RangePositions.this.Tree)Unit" id="310206">traverse</a><span class="delimiter">(</span><a title="RangePositions.this.Tree" id="320535">t</a>: <span title="RangePositions.this.Tree">Tree</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#320535" title="RangePositions.this.Tree">t</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Unit" id="320544">tt</a> : <a href="../ast/Trees.scala.html#67815" title="RangePositions.this.TypeTree">TypeTree</a> <span class="keyword">if</span> <a href="#320544" title="RangePositions.this.TypeTree">tt</a>.<a href="../ast/Trees.scala.html#135861" title="=&gt; RangePositions.this.Tree">original</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span> =&gt; <a href="#310206" title="(t: RangePositions.this.Tree)Unit">traverse</a><span class="delimiter">(</span><a href="#320544" title="RangePositions.this.TypeTree">tt</a>.<a href="../ast/Trees.scala.html#135861" title="=&gt; RangePositions.this.Tree">original</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#320535" title="RangePositions.this.Tree">t</a>.<span title="=&gt; RangePositions.this.Position">pos</span> <a href="../util/Position.scala.html#97229" title="(pos: scala.tools.nsc.util.Position)Boolean">includes</a> <a href="#310207" title="RangePositions.this.Position">pos</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#310205" title="(t: RangePositions.this.Tree)Boolean">isEligible</a><span class="delimiter">(</span><a href="#320535" title="RangePositions.this.Tree">t</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#310202" title="(x$1: RangePositions.this.Tree)Unit">last</a> = <a href="#320535" title="RangePositions.this.Tree">t</a>
            <a href="#124523" title="RangePositions.this.Locator" class="keyword">super</a>.<a href="../ast/Trees.scala.html#162670" title="(tree: RangePositions.this.Tree)Unit">traverse</a><span class="delimiter">(</span><a href="#320535" title="RangePositions.this.Tree">t</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#320535" title="RangePositions.this.Tree">t</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a title="Unit" id="320552">mdef</a>: <span title="RangePositions.this.MemberDef">MemberDef</span> =&gt;
              <a href="#124523" title="(trees: List[RangePositions.this.Tree])Unit">traverseTrees</a><span class="delimiter">(</span><a href="#320552" title="RangePositions.this.MemberDef">mdef</a>.<span title="=&gt; RangePositions.this.Modifiers">mods</span>.<span title="=&gt; List[RangePositions.this.Tree]">annotations</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
          <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">class</span> <a title="class TypedLocator extends RangePositions.this.Locator with ScalaObject" id="124524">TypedLocator</a><a href="#124524" title="ScalaObject" class="delimiter">(</a><a title="RangePositions.this.Position" id="312204">pos</a>: <a href="../util/Position.scala.html#30588" title="RangePositions.this.Position">Position</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#124523" title="RangePositions.this.Locator">Locator</a><span class="delimiter">(</span><a href="#312204" title="RangePositions.this.Position">pos</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">override</span> <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(t: RangePositions.this.Tree)Boolean" id="312203">isEligible</a><span class="delimiter">(</span><a title="RangePositions.this.Tree" id="320557">t</a>: <span title="RangePositions.this.Tree">Tree</span><span class="delimiter">)</span> = <a href="#124524" title="RangePositions.this.TypedLocator" class="keyword">super</a>.<a href="#310205" title="(t: RangePositions.this.Tree)Boolean">isEligible</a><span class="delimiter">(</span><a href="#320557" title="RangePositions.this.Tree">t</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#320557" title="RangePositions.this.Tree">t</a>.<span title="=&gt; RangePositions.this.Type">tpe</span> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
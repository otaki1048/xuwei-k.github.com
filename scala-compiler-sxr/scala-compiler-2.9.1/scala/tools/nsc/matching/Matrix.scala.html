<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/matching/Matrix.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* NSC -- new Scala compiler
 * Copyright 2005-2011 LAMP/EPFL
 * Author: Paul Phillips
 */</span>

<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> matching

<span class="keyword">import</span> transform.ExplicitOuter
<span class="keyword">import</span> symtab.Flags
<span class="keyword">import</span> scala.collection.mutable

<span class="keyword">trait</span> <a title="trait Matrix extends java.lang.Object with scala.tools.nsc.matching.MatrixAdditions with ScalaObject" id="22559">Matrix</a> <span title="ScalaObject" class="keyword">extends</span> <a href="MatrixAdditions.scala.html#22535" title="scala.tools.nsc.matching.MatrixAdditions">MatrixAdditions</a> <span class="delimiter">{</span>
  self: ExplicitOuter <span class="keyword">with</span> ParallelMatching =&gt;

  <span class="keyword">import</span> <a href="../transform/TypingTransformers.scala.html#110301" title="=&gt; scala.tools.nsc.Global">global</a>.<span class="delimiter">{</span> typer =&gt; _, _ <span class="delimiter">}</span>
  <span class="keyword">import</span> <a href="../Global.scala.html#64911" title="object Matrix.this.global.analyzer">analyzer</a>.Typer
  <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#105837" title="object Matrix.this.CODE">CODE</a>._
  <span class="keyword">import</span> <a href="MatchSupport.scala.html#110939" title="object Matrix.this.Debug">Debug</a>._
  <span class="keyword">import</span> <a href="../symtab/Flags.scala.html#24068" title="object scala.tools.nsc.symtab.Flags">Flags</a>.<span class="delimiter">{</span> SYNTHETIC, MUTABLE <span class="delimiter">}</span>

  <span class="keyword">private</span><span class="delimiter">[</span>matching<span class="delimiter">]</span> <span class="keyword">val</span> <a title="Long" id="110965">NO_EXHAUSTIVE</a> = Flags.<span title="Long(274877906944L)">TRANS_FLAG</span>

  <span class="comment">/** Translation of match expressions.
   *
   *  `p':  pattern
   *  `g':  guard
   *  `bx': body index
   *
   *   internal representation is (tvars:List[Symbol], rows:List[Row])
   *
   *         tmp1      tmp_n
   *    Row( p_11  ...  p_1n   g_1  b_1 ) + subst
   *
   *    Row( p_m1  ...  p_mn   g_m  b_m ) + subst
   *
   * Implementation based on the algorithm described in
   *
   *   &quot;A Term Pattern-Match Compiler Inspired by Finite Automata Theory&quot;
   *   Mikael Pettersson
   *   ftp://ftp.ida.liu.se/pub/labs/pelab/papers/cc92pmc.ps.gz
   *
   *  @author Burak Emir
   */</span>

  <span class="comment">/** &quot;The Mixture Rule&quot;

        {v=pat1, pats1 .. } {q1} 
  match {..               } {..} 
        {v=patn, patsn .. } {qn} 

  The is the real work-horse of the algorithm. There is some column whose top-most pattern is a 
  constructor. (Forsimplicity, itisdepicted above asthe left-most column, but anycolumn will do.) 
  The goal is to build a test state with the variablevand some outgoing arcs (one for each construc- 
  tor and possibly a default arc). Foreach constructor in the selected column, its arc is deﬁned as 
  follows: 

  Let {i1,...,ij} be the rows-indices of the patterns in the column that match c. Since the pat- 
  terns are viewed as regular expressions, this will be the indices of the patterns that either 
  have the same constructor c, or are wildcards. 

  Let {pat1,...,patj} be the patterns in the column corresponding to the indices computed 
  above, and let nbe the arity of the constructor c, i.e. the number of sub-patterns it has. For 
  eachpati, its n sub-patterns are extracted; if pat i is a wildcard, nwildcards are produced 
  instead, each tagged with the right path variable. This results in a pattern matrix with n 
  columns and j rows. This matrix is then appended to the result of selecting, from each col- 
  umn in the rest of the original matrix, those rows whose indices are in {i1,...,ij}. Finally 
  the indices are used to select the corresponding ﬁnal states that go with these rows. Note 
  that the order of the indices is signiﬁcant; selected rows do not change their relative orders. 
  The arc for the constructor c is now deﬁned as (c’,state), where c’ is cwith any 
  immediate sub-patterns replaced by their path variables (thus c’ is a simple pattern), and 
  state is the result of recursively applying match to the new matrix and the new sequence 
  of ﬁnal states. 

  Finally, the possibility for matching failure is considered. If the set of constructors is exhaustive, 
  then no more arcs are computed. Otherwise, a default arc(_,state)is the last arc. If there are 
  any wildcard patterns in the selected column, then their rows are selected from the rest of the 
  matrix and the ﬁnal states, and the state is the result of applying match to the new matrix and 
  states. Otherwise,the error state is used after its reference count has been incremented. 
  **/</span>
  
  <span class="comment">/** Handles all translation of pattern matching.
   */</span>
  <span class="keyword">def</span> <a title="(selector: Matrix.this.global.Tree, cases: List[Matrix.this.global.CaseDef], isChecked: Boolean, context: Matrix.this.MatrixContext)Matrix.this.global.Tree" id="110967">handlePattern</a><span class="delimiter">(</span>
    <a title="Matrix.this.global.Tree" id="400428">selector</a>: <span title="Matrix.this.global.Tree">Tree</span>,         <span class="comment">// tree being matched upon (called scrutinee after this)</span>
    <a title="List[Matrix.this.global.CaseDef]" id="400429">cases</a>: <span title="List[Matrix.this.global.CaseDef]">List</span><span class="delimiter">[</span>CaseDef<span class="delimiter">]</span>,   <span class="comment">// list of cases in the match</span>
    <a title="Boolean" id="400430">isChecked</a>: <span title="Boolean">Boolean</span>,     <span class="comment">// whether exhaustiveness checking is enabled (disabled with @unchecked)</span>
    <a title="Matrix.this.MatrixContext" id="400431">context</a>: <a href="#400782" title="Matrix.this.MatrixContext">MatrixContext</a><span class="delimiter">)</span>: <span title="Matrix.this.global.Tree">Tree</span> =
  <span class="delimiter">{</span>
    <span class="keyword">import</span> <a href="#400431" title="Matrix.this.MatrixContext">context</a>._
    <a href="MatchSupport.scala.html#399139" title="(f: String, xs: Any*)Unit">TRACE</a><span class="delimiter">(</span><span title="java.lang.String(&quot;handlePattern&quot;)" class="string">&quot;handlePattern&quot;</span>, <span title="java.lang.String(&quot;(%s: %s) match { %s cases }&quot;)" class="string">&quot;(%s: %s) match { %s cases }&quot;</span>, <a href="#400428" title="Matrix.this.global.Tree">selector</a>, <a href="#400428" title="Matrix.this.global.Tree">selector</a>.<span title="=&gt; Matrix.this.global.Type">tpe</span>, <a href="#400429" title="List[Matrix.this.global.CaseDef]">cases</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="context.MatrixInit" id="400482">matrixInit</a>: <a href="#400527" title="context.MatrixInit">MatrixInit</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="context.PatternVar" id="400500">v</a> = <a href="#400476" title="(root: Matrix.this.global.Tree, checked: Boolean, _tpe: Matrix.this.global.Type, label: String)context.PatternVar">copyVar</a><span class="delimiter">(</span><a href="#400428" title="Matrix.this.global.Tree">selector</a>, <a href="#400430" title="Boolean">isChecked</a>, <a href="#400428" title="Matrix.this.global.Tree">selector</a>.<span title="=&gt; Matrix.this.global.Type">tpe</span>, <span title="java.lang.String(&quot;temp&quot;)" class="string">&quot;temp&quot;</span><span class="delimiter">)</span>
      <a href="#400527" title="(roots: List[context.PatternVar], cases: List[Matrix.this.global.CaseDef], default: Matrix.this.global.Tree)context.MatrixInit">MatrixInit</a><span class="delimiter">(</span><span title="(xs: context.PatternVar*)List[context.PatternVar]">List</span><span class="delimiter">(</span><a href="#400500" title="context.PatternVar">v</a><span class="delimiter">)</span>, <a href="#400429" title="List[Matrix.this.global.CaseDef]">cases</a>, <a href="../ast/Trees.scala.html#67851" title="(pos: Matrix.this.global.Position)(tree: Matrix.this.global.Throw)Matrix.this.global.Throw">atPos</a><span class="delimiter">(</span><a href="#400428" title="Matrix.this.global.Tree">selector</a>.<span title="=&gt; Matrix.this.global.Position">pos</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#113977" title="(arg: Matrix.this.global.Tree)Matrix.this.global.Throw">MATCHERROR</a><span class="delimiter">(</span><a href="#400500" title="context.PatternVar">v</a>.<a href="#400520" title="=&gt; Matrix.this.global.analyzer.global.Tree">ident</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="matrix extends Matrix.this.MatchMatrix" id="400483">matrix</a> = <a href="#400579" title="Matrix.this.MatchMatrix{}" class="keyword">new</a> <a href="ParallelMatching.scala.html#110927" title="anonymous class $anon extends Matrix.this.MatchMatrix" id="400579">MatchMatrix</a><span class="delimiter">(</span><a href="#400431" title="Matrix.this.MatrixContext">context</a><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="context.MatrixInit" id="400646">data</a> = <a href="#400482" title="context.MatrixInit">matrixInit</a> <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="Matrix.this.global.analyzer.global.Tree" id="400484">mch</a>     = <a href="#402661" title="=&gt; Matrix.this.global.analyzer.Typer">typer</a> <a href="../typechecker/Typers.scala.html#106063" title="(tree: Matrix.this.global.analyzer.global.Tree)Matrix.this.global.analyzer.global.Tree">typed</a> <a href="#400483" title="matrix extends Matrix.this.MatchMatrix">matrix</a>.<a href="ParallelMatching.scala.html#400604" title="=&gt; matrix.Rep">expansion</a>.<a href="ParallelMatching.scala.html#400701" title="()Matrix.this.global.Tree">toTree</a>
    <span class="keyword">val</span> <a title="Matrix.this.global.analyzer.global.Tree" id="400485">dfatree</a> = <a href="#402661" title="=&gt; Matrix.this.global.analyzer.Typer">typer</a> <a href="../typechecker/Typers.scala.html#106063" title="(tree: Matrix.this.global.analyzer.global.Tree)Matrix.this.global.analyzer.global.Tree">typed</a> <a href="../transform/TypingTransformers.scala.html#110301" title="(stats: List[Matrix.this.global.Tree], expr: Matrix.this.global.Tree)Matrix.this.global.Block">Block</a><span class="delimiter">(</span><a href="#400483" title="matrix extends Matrix.this.MatchMatrix">matrix</a>.<a href="#400666" title="=&gt; context.MatrixInit">data</a>.<a href="#400497" title="=&gt; List[Matrix.this.global.analyzer.global.ValDef]">valDefs</a>, <a href="#400484" title="Matrix.this.global.analyzer.global.Tree">mch</a><span class="delimiter">)</span>

    <span class="comment">// redundancy check</span>
    <a href="#400483" title="matrix extends Matrix.this.MatchMatrix">matrix</a>.<a href="ParallelMatching.scala.html#400602" title="=&gt; List[Product with Serializable with matrix.State]">targets</a> <span title="(p: Product with Serializable with matrix.State =&gt; Boolean)List[Product with Serializable with matrix.State]">filter</span> <span class="delimiter">(</span><a href="#401582" title="&lt;none&gt; extends Product with Serializable with matrix.State">_</a>.<a href="ParallelMatching.scala.html#401140" title="=&gt; Boolean">unreached</a><span class="delimiter">)</span> <span title="(f: Product with Serializable with matrix.State =&gt; Unit)Unit">foreach</span> <span class="delimiter">(</span><a title="&lt;none&gt; extends Product with Serializable with matrix.State" id="401619">cs</a> =&gt; <a href="#402659" title="=&gt; Matrix.this.global.CompilationUnit">cunit</a>.<a href="../CompilationUnits.scala.html#96451" title="(pos: Matrix.this.global.Position, msg: String)Unit">error</a><span class="delimiter">(</span><a href="#401619" title="&lt;none&gt; extends Product with Serializable with matrix.State">cs</a>.<a href="ParallelMatching.scala.html#401132" title="=&gt; Matrix.this.global.Tree">body</a>.<span title="=&gt; Matrix.this.global.Position">pos</span>, <span title="java.lang.String(&quot;unreachable code&quot;)" class="string">&quot;unreachable code&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="comment">// optimize performs squeezing and resets any remaining NO_EXHAUSTIVE</span>
    <a href="MatchSupport.scala.html#399141" title="(s: String)(x: Matrix.this.global.Tree)Matrix.this.global.Tree">tracing</a><span class="delimiter">(</span><span title="java.lang.String(&quot;handlePattern&quot;)" class="string">&quot;handlePattern&quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#400483" title="matrix extends Matrix.this.MatchMatrix">matrix</a> <a href="MatrixAdditions.scala.html#400583" title="(tree: Matrix.this.global.Tree)Matrix.this.global.Tree">optimize</a> <a href="#400485" title="Matrix.this.global.analyzer.global.Tree">dfatree</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  case <span class="keyword">class</span> <a title="class MatrixContext extends java.lang.Object with Matrix.this.Squeezer with ScalaObject with Product with Serializable" id="400782">MatrixContext</a><a href="#400782" title="ScalaObject" class="delimiter">(</a>
    <a title="Matrix.this.global.CompilationUnit" id="402659">cunit</a>: <a href="../CompilationUnits.scala.html#67953" title="Matrix.this.global.CompilationUnit">CompilationUnit</a>,       <span class="comment">// current unit</span>
    <a title="Matrix.this.global.Tree =&gt; Matrix.this.global.Tree" id="402660">handleOuter</a>: Tree =&gt; Tree,    <span class="comment">// for outer pointer</span>
    <a title="Matrix.this.global.analyzer.Typer" id="402661">typer</a>: <a href="../typechecker/Typers.scala.html#105749" title="Matrix.this.global.analyzer.Typer">Typer</a>,                 <span class="comment">// a local typer</span>
    <a title="Matrix.this.global.Symbol" id="402662">owner</a>: <a href="../symtab/Symbols.scala.html#67331" title="Matrix.this.global.Symbol">Symbol</a>,                <span class="comment">// the current owner</span>
    <a title="Matrix.this.global.Type" id="402663">matchResultType</a>: <a href="../symtab/Types.scala.html#67392" title="Matrix.this.global.Type">Type</a><span class="delimiter">)</span>        <span class="comment">// the expected result type of the whole match</span>
      <span class="keyword">extends</span> <a href="MatrixAdditions.scala.html#110955" title="Matrix.this.Squeezer">Squeezer</a>
  <span class="delimiter">{</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="[T](x: T, alt: T)T" id="400457">ifNull</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="400459">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="T" id="401683">x</a>: <a href="#400459" title="T">T</a>, <a title="T" id="401684">alt</a>: <a href="#400459" title="T">T</a><span class="delimiter">)</span> = <span title="T" class="keyword">if</span> <span class="delimiter">(</span><a href="#401683" title="T">x</a> <span title="(x$1: Any)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#401684" title="T">alt</a> <span class="keyword">else</span> <a href="#401683" title="T">x</a>
    
    <span class="comment">// NO_EXHAUSTIVE communicates there should be no exhaustiveness checking</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(checked: Boolean)List[Long]" id="400460">flags</a><span class="delimiter">(</span><a title="Boolean" id="401689">checked</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> = <span title="List[Long]" class="keyword">if</span> <span class="delimiter">(</span><a href="#401689" title="Boolean">checked</a><span class="delimiter">)</span> <span title="object Nil">Nil</span> <span class="keyword">else</span> <span title="(xs: Long*)List[Long]">List</span><span class="delimiter">(</span><a href="#110965" title="=&gt; Long">NO_EXHAUSTIVE</a><span class="delimiter">)</span>
    
    <span class="comment">// Recording the symbols of the synthetics we create so we don't go clearing</span>
    <span class="comment">// anyone else's mutable flags.</span>
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.HashSet[Matrix.this.global.Symbol]" id="400461">_syntheticSyms</a> = mutable.<span title="[A](elems: A*)scala.collection.mutable.HashSet[A]">HashSet</span><span title="(elems: Matrix.this.global.Symbol*)scala.collection.mutable.HashSet[Matrix.this.global.Symbol]" class="delimiter">[</span><a href="../symtab/Symbols.scala.html#67331" title="Matrix.this.global.Symbol">Symbol</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="()Unit" id="400463">clearSyntheticSyms</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="#400461" title="=&gt; scala.collection.mutable.HashSet[Matrix.this.global.Symbol]">_syntheticSyms</a> <span title="(f: Matrix.this.global.Symbol =&gt; Matrix.this.global.Symbol)Unit">foreach</span> <span class="delimiter">(</span><a href="#401722" title="Matrix.this.global.Symbol">_</a> <a href="../symtab/Symbols.scala.html#107554" title="(mask: Long)x$2.type">resetFlag</a> <span class="delimiter">(</span><a href="#110965" title="=&gt; Long">NO_EXHAUSTIVE</a><span title="(x: Int)Long">|</span><span title="Int(4096)">MUTABLE</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#36747" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../settings/MutableSettings.scala.html#42149" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
        <a href="../Global.scala.html#64883" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Cleared NO_EXHAUSTIVE/MUTABLE on &quot;)" class="string">&quot;Cleared NO_EXHAUSTIVE/MUTABLE on &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#400461" title="=&gt; scala.collection.mutable.HashSet[Matrix.this.global.Symbol]">_syntheticSyms</a>.<span title="=&gt; Int">size</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; synthetic symbols.&quot;)" class="string">&quot; synthetic symbols.&quot;</span><span class="delimiter">)</span>
      <a href="#400461" title="=&gt; scala.collection.mutable.HashSet[Matrix.this.global.Symbol]">_syntheticSyms</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="(sym: Matrix.this.global.Symbol)Matrix.this.global.Symbol" id="400464">recordSyntheticSym</a><span class="delimiter">(</span><a title="Matrix.this.global.Symbol" id="401736">sym</a>: <a href="../symtab/Symbols.scala.html#67331" title="Matrix.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <a href="../symtab/Symbols.scala.html#67331" title="Matrix.this.global.Symbol">Symbol</a> = <span class="delimiter">{</span>
      <a href="#400461" title="=&gt; scala.collection.mutable.HashSet[Matrix.this.global.Symbol]">_syntheticSyms</a> <span title="(elem: Matrix.this.global.Symbol)MatrixContext.this._syntheticSyms.type">+=</span> <a href="#401736" title="Matrix.this.global.Symbol">sym</a>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#400461" title="=&gt; scala.collection.mutable.HashSet[Matrix.this.global.Symbol]">_syntheticSyms</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(25000)" class="int">25000</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#402659" title="=&gt; Matrix.this.global.CompilationUnit">cunit</a>.<a href="../CompilationUnits.scala.html#96451" title="(pos: Matrix.this.global.Position, msg: String)Unit">error</a><span class="delimiter">(</span><a href="#402662" title="=&gt; Matrix.this.global.Symbol">owner</a>.<a href="../symtab/Symbols.scala.html#107404" title="=&gt; Matrix.this.global.Position">pos</a>, <span title="java.lang.String(&quot;Sanity check failed: over 25000 symbols created for pattern match.&quot;)" class="string">&quot;Sanity check failed: over 25000 symbols created for pattern match.&quot;</span><span class="delimiter">)</span>
        <a href="../symtab/SymbolTable.scala.html#64790" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="java.lang.String(&quot;This is a bug in the pattern matcher.&quot;)" class="string">&quot;This is a bug in the pattern matcher.&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#401736" title="Matrix.this.global.Symbol">sym</a>
    <span class="delimiter">}</span>

    case <span class="keyword">class</span> <a title="class MatrixInit extends java.lang.Object with ScalaObject with Product with Serializable" id="400527">MatrixInit</a><a href="#400527" title="ScalaObject" class="delimiter">(</a>
      <a title="List[MatrixContext.this.PatternVar]" id="400529">roots</a>: <span title="List[MatrixContext.this.PatternVar]">List</span><span class="delimiter">[</span>PatternVar<span class="delimiter">]</span>,
      <a title="List[Matrix.this.global.CaseDef]" id="400530">cases</a>: <span title="List[Matrix.this.global.CaseDef]">List</span><span class="delimiter">[</span>CaseDef<span class="delimiter">]</span>,
      <a title="Matrix.this.global.Tree" id="400531">default</a>: <span title="Matrix.this.global.Tree">Tree</span>
    <span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="=&gt; List[Matrix.this.global.Symbol]" id="400496">tvars</a> = <a href="#400529" title="=&gt; List[MatrixContext.this.PatternVar]">roots</a> <span title="(f: MatrixContext.this.PatternVar =&gt; Matrix.this.global.Symbol)(implicit bf: scala.collection.generic.CanBuildFrom[List[MatrixContext.this.PatternVar],Matrix.this.global.Symbol,List[Matrix.this.global.Symbol]])List[Matrix.this.global.Symbol]">map</span> <span class="delimiter">(</span><a href="#401778" title="MatrixContext.this.PatternVar">_</a>.<a href="#402045" title="=&gt; Matrix.this.global.Symbol">lhs</a><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="=&gt; List[Matrix.this.global.analyzer.global.ValDef]" id="400497">valDefs</a> = <a href="#400529" title="=&gt; List[MatrixContext.this.PatternVar]">roots</a> <span title="(f: MatrixContext.this.PatternVar =&gt; Matrix.this.global.analyzer.global.ValDef)(implicit bf: scala.collection.generic.CanBuildFrom[List[MatrixContext.this.PatternVar],Matrix.this.global.analyzer.global.ValDef,List[Matrix.this.global.analyzer.global.ValDef]])List[Matrix.this.global.analyzer.global.ValDef]">map</span> <span class="delimiter">(</span><a href="#400743" title="MatrixContext.this.PatternVar">_</a>.<a href="#400522" title="=&gt; Matrix.this.global.analyzer.global.ValDef">valDef</a><span class="delimiter">)</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="400498">toString</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;MatrixInit(roots = %s, %d cases)&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="MatchSupport.scala.html#399135" title="(x: Any)String">pp</a><span class="delimiter">(</span><a href="#400529" title="=&gt; List[MatrixContext.this.PatternVar]">roots</a><span class="delimiter">)</span>, <a href="#400530" title="=&gt; List[Matrix.this.global.CaseDef]">cases</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit scala.tools.nsc.matching.Matrix.MatrixContext.pvlist2pvgroup : (xs: List[MatrixContext.this.PatternVar])MatrixContext.this.PatternVarGroup" id="400468">pvlist2pvgroup</a><span class="delimiter">(</span><a title="List[MatrixContext.this.PatternVar]" id="400755">xs</a>: <span title="List[MatrixContext.this.PatternVar]">List</span><span class="delimiter">[</span>PatternVar<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#400473" title="MatrixContext.this.PatternVarGroup">PatternVarGroup</a> =
      <a href="#401641" title="(xs: List[MatrixContext.this.PatternVar])MatrixContext.this.PatternVarGroup">PatternVarGroup</a><span class="delimiter">(</span><a href="#400755" title="List[MatrixContext.this.PatternVar]">xs</a><span class="delimiter">)</span>
    
    <span class="keyword">object</span> <a title="object MatrixContext.this.PatternVarGroup" id="400469">PatternVarGroup</a> <span title="ScalaObject" class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(xs: MatrixContext.this.PatternVar*)MatrixContext.this.PatternVarGroup" id="401640">apply</a><span class="delimiter">(</span><a title="MatrixContext.this.PatternVar*" id="401671">xs</a>: <span title="MatrixContext.this.PatternVar*">PatternVar</span>*<span class="delimiter">)</span> = <span title="MatrixContext.this.PatternVarGroup" class="keyword">new</span> <a href="#400473" title="MatrixContext.this.PatternVarGroup">PatternVarGroup</a><span class="delimiter">(</span><a href="#401671" title="MatrixContext.this.PatternVar*">xs</a>.<span title="=&gt; List[MatrixContext.this.PatternVar]">toList</span><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="(xs: List[MatrixContext.this.PatternVar])MatrixContext.this.PatternVarGroup" id="401641">apply</a><span class="delimiter">(</span><a title="List[MatrixContext.this.PatternVar]" id="401645">xs</a>: <span title="List[MatrixContext.this.PatternVar]">List</span><span class="delimiter">[</span>PatternVar<span class="delimiter">]</span><span class="delimiter">)</span> = <span title="MatrixContext.this.PatternVarGroup" class="keyword">new</span> <a href="#400473" title="MatrixContext.this.PatternVarGroup">PatternVarGroup</a><span class="delimiter">(</span><a href="#401645" title="List[MatrixContext.this.PatternVar]">xs</a><span class="delimiter">)</span>
      
      <span class="comment">// XXX - transitional</span>
      <span class="keyword">def</span> <a title="(vlist: List[Matrix.this.Binding], freeVars: List[Matrix.this.global.Symbol])MatrixContext.this.PatternVarGroup" id="401642">fromBindings</a><span class="delimiter">(</span><a title="List[Matrix.this.Binding]" id="401864">vlist</a>: <span title="List[Matrix.this.Binding]">List</span><span class="delimiter">[</span>Binding<span class="delimiter">]</span>, <a title="List[Matrix.this.global.Symbol]" id="401868">freeVars</a>: <span title="List[Matrix.this.global.Symbol]">List</span><span class="delimiter">[</span>Symbol<span class="delimiter">]</span> = <span title="object Nil">Nil</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
        <span class="keyword">def</span> <a title="(v: Matrix.this.global.Symbol)Option[Matrix.this.Binding]" id="401869">vmap</a><span class="delimiter">(</span><a title="Matrix.this.global.Symbol" id="401872">v</a>: <a href="../symtab/Symbols.scala.html#67331" title="Matrix.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="Option[Matrix.this.Binding]">Option</span><span class="delimiter">[</span>Binding<span class="delimiter">]</span> = <a href="#401864" title="List[Matrix.this.Binding]">vlist</a> <span title="(p: Matrix.this.Binding =&gt; Boolean)Option[Matrix.this.Binding]">find</span> <span class="delimiter">(</span><a href="#401879" title="Matrix.this.Binding">_</a>.<a href="PatternBindings.scala.html#401882" title="=&gt; Matrix.this.global.Symbol">pvar</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#401872" title="Matrix.this.global.Symbol">v</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="List[Matrix.this.Binding]" id="401870">info</a> = 
          <span title="List[Matrix.this.Binding]" class="keyword">if</span> <span class="delimiter">(</span><a href="#401868" title="List[Matrix.this.global.Symbol]">freeVars</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#401864" title="List[Matrix.this.Binding]">vlist</a>
          <span class="keyword">else</span> <span class="delimiter">(</span><a href="#401868" title="List[Matrix.this.global.Symbol]">freeVars</a> <span title="(f: Matrix.this.global.Symbol =&gt; Option[Matrix.this.Binding])(implicit bf: scala.collection.generic.CanBuildFrom[List[Matrix.this.global.Symbol],Option[Matrix.this.Binding],List[Option[Matrix.this.Binding]]])List[Option[Matrix.this.Binding]]">map</span> <a href="#401869" title="(v: Matrix.this.global.Symbol)Option[Matrix.this.Binding]">vmap</a><span class="delimiter">)</span>.<a href="#401970" title="(implicit asTraversable: Option[Matrix.this.Binding] =&gt; scala.collection.TraversableOnce[Matrix.this.Binding])List[Matrix.this.Binding]">flatten</a>
        
        <span class="keyword">val</span> <a title="List[MatrixContext.this.PatternVar]" id="401871">xs</a> =
          <span class="keyword">for</span> <span class="delimiter">(</span>Binding<span class="delimiter">(</span><a title="Matrix.this.global.Symbol" id="402043">lhs</a>, <a title="Matrix.this.global.Symbol" id="402044">rhs</a><span class="delimiter">)</span> &lt;- <a href="#401870" title="(f: Matrix.this.Binding =&gt; MatrixContext.this.PatternVar)(implicit bf: scala.collection.generic.CanBuildFrom[List[Matrix.this.Binding],MatrixContext.this.PatternVar,List[MatrixContext.this.PatternVar]])List[MatrixContext.this.PatternVar]">info</a><span class="delimiter">)</span> <span class="keyword">yield</span>
            <span title="MatrixContext.this.PatternVar" class="keyword">new</span> <a href="#400474" title="MatrixContext.this.PatternVar">PatternVar</a><span class="delimiter">(</span><a href="#402043" title="Matrix.this.global.Symbol">lhs</a>, <a href="../ast/Trees.scala.html#67813" title="(sym: Matrix.this.global.Symbol)Matrix.this.global.Ident">Ident</a><span class="delimiter">(</span><a href="#402044" title="Matrix.this.global.Symbol">rhs</a><span class="delimiter">)</span> <span title="(tp: Matrix.this.global.Type)Matrix.this.global.Ident">setType</span> <a href="#402043" title="Matrix.this.global.Symbol">lhs</a>.<a href="../symtab/Symbols.scala.html#107562" title="=&gt; Matrix.this.global.Type">tpe</a>, <span title="=&gt; Boolean">!</span><span class="delimiter">(</span><a href="#402044" title="Matrix.this.global.Symbol">rhs</a> <span title="(mask: Long)Boolean">hasFlag</span> <a href="#110965" title="=&gt; Long">NO_EXHAUSTIVE</a><span class="delimiter">)</span><span class="delimiter">)</span>
        
        <span title="MatrixContext.this.PatternVarGroup" class="keyword">new</span> <a href="#400473" title="MatrixContext.this.PatternVarGroup">PatternVarGroup</a><span class="delimiter">(</span><a href="#401871" title="List[MatrixContext.this.PatternVar]">xs</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
      
    <span class="keyword">val</span> <a title="MatrixContext.this.PatternVarGroup" id="400471">emptyPatternVarGroup</a> = <a href="#401640" title="(xs: MatrixContext.this.PatternVar*)MatrixContext.this.PatternVarGroup">PatternVarGroup</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">class</span> <a title="class PatternVarGroup extends java.lang.Object with ScalaObject" id="400473">PatternVarGroup</a><a href="#400473" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="List[MatrixContext.this.PatternVar]" id="401670">pvs</a>: <span title="List[MatrixContext.this.PatternVar]">List</span><span class="delimiter">[</span>PatternVar<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="=&gt; List[Matrix.this.global.Symbol]" id="401652">syms</a>    = <a href="#401670" title="=&gt; List[MatrixContext.this.PatternVar]">pvs</a> <span title="(f: MatrixContext.this.PatternVar =&gt; Matrix.this.global.Symbol)(implicit bf: scala.collection.generic.CanBuildFrom[List[MatrixContext.this.PatternVar],Matrix.this.global.Symbol,List[Matrix.this.global.Symbol]])List[Matrix.this.global.Symbol]">map</span> <span class="delimiter">(</span><a href="#402113" title="MatrixContext.this.PatternVar">_</a>.<a href="#400518" title="=&gt; Matrix.this.global.Symbol">sym</a><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="=&gt; List[Matrix.this.global.analyzer.global.ValDef]" id="401653">valDefs</a> = <a href="#401670" title="=&gt; List[MatrixContext.this.PatternVar]">pvs</a> <span title="(f: MatrixContext.this.PatternVar =&gt; Matrix.this.global.analyzer.global.ValDef)(implicit bf: scala.collection.generic.CanBuildFrom[List[MatrixContext.this.PatternVar],Matrix.this.global.analyzer.global.ValDef,List[Matrix.this.global.analyzer.global.ValDef]])List[Matrix.this.global.analyzer.global.ValDef]">map</span> <span class="delimiter">(</span><a href="#402157" title="MatrixContext.this.PatternVar">_</a>.<a href="#400522" title="=&gt; Matrix.this.global.analyzer.global.ValDef">valDef</a><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="=&gt; List[Matrix.this.global.analyzer.global.Tree]" id="401654">idents</a>  = <a href="#401670" title="=&gt; List[MatrixContext.this.PatternVar]">pvs</a> <span title="(f: MatrixContext.this.PatternVar =&gt; Matrix.this.global.analyzer.global.Tree)(implicit bf: scala.collection.generic.CanBuildFrom[List[MatrixContext.this.PatternVar],Matrix.this.global.analyzer.global.Tree,List[Matrix.this.global.analyzer.global.Tree]])List[Matrix.this.global.analyzer.global.Tree]">map</span> <span class="delimiter">(</span><a href="#402198" title="MatrixContext.this.PatternVar">_</a>.<a href="#400520" title="=&gt; Matrix.this.global.analyzer.global.Tree">ident</a><span class="delimiter">)</span>
      
      <span class="keyword">def</span> <a title="(index: Int)(MatrixContext.this.PatternVar, MatrixContext.this.PatternVarGroup)" id="401655">extractIndex</a><span class="delimiter">(</span><a title="Int" id="402226">index</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="(MatrixContext.this.PatternVar, MatrixContext.this.PatternVarGroup)" class="delimiter">(</span>PatternVar, PatternVarGroup<span class="delimiter">)</span> = <span class="delimiter">{</span>
        <span class="keyword">val</span> <a href="#402229" title="(MatrixContext.this.PatternVar, List[MatrixContext.this.PatternVar])" class="delimiter">(</a><a href="#402228" title="MatrixContext.this.PatternVar" id="402229">t</a>, <a href="#402228" title="List[MatrixContext.this.PatternVar]" id="402230">ts</a><span class="delimiter">)</span> = <a href="#22559" title="Matrix.this.type">self</a>.<a href="MatchSupport.scala.html#110944" title="(xs: List[MatrixContext.this.PatternVar], n: Int)(MatrixContext.this.PatternVar, List[MatrixContext.this.PatternVar])">extractIndex</a><span title="(MatrixContext.this.PatternVar, List[MatrixContext.this.PatternVar]) @unchecked" class="delimiter">(</span><a href="#401670" title="=&gt; List[MatrixContext.this.PatternVar]">pvs</a>, <a href="#402226" title="Int">index</a><span class="delimiter">)</span>
        <span title="(_1: MatrixContext.this.PatternVar, _2: MatrixContext.this.PatternVarGroup)(MatrixContext.this.PatternVar, MatrixContext.this.PatternVarGroup)" class="delimiter">(</span><a href="#402229" title="MatrixContext.this.PatternVar">t</a>, <a href="#401641" title="(xs: List[MatrixContext.this.PatternVar])MatrixContext.this.PatternVarGroup">PatternVarGroup</a><span class="delimiter">(</span><a href="#402230" title="List[MatrixContext.this.PatternVar]">ts</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> 
      
      <span class="keyword">def</span> <a title="=&gt; Boolean" id="401656">isEmpty</a> = <a href="#401670" title="=&gt; List[MatrixContext.this.PatternVar]">pvs</a>.<span title="=&gt; Boolean">isEmpty</span>
      <span class="keyword">def</span> <a title="=&gt; Int" id="401657">size</a> = <a href="#401670" title="=&gt; List[MatrixContext.this.PatternVar]">pvs</a>.<span title="=&gt; Int">size</span>
      <span class="keyword">def</span> <a title="=&gt; MatrixContext.this.PatternVar" id="401658">head</a> = <a href="#401670" title="=&gt; List[MatrixContext.this.PatternVar]">pvs</a>.<span title="=&gt; MatrixContext.this.PatternVar">head</span>
      <span class="keyword">def</span> <a title="(t: MatrixContext.this.PatternVar)MatrixContext.this.PatternVarGroup" id="401659">::</a><span class="delimiter">(</span><a title="MatrixContext.this.PatternVar" id="402280">t</a>: <a href="#400474" title="MatrixContext.this.PatternVar">PatternVar</a><span class="delimiter">)</span> = <a href="#401641" title="(xs: List[MatrixContext.this.PatternVar])MatrixContext.this.PatternVarGroup">PatternVarGroup</a><span class="delimiter">(</span><a href="#402280" title="MatrixContext.this.PatternVar">t</a> <a href="#402291" title="(x: MatrixContext.this.PatternVar)List[MatrixContext.this.PatternVar]">::</a> <a href="#401670" title="=&gt; List[MatrixContext.this.PatternVar]">pvs</a><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="(ts: List[MatrixContext.this.PatternVar])MatrixContext.this.PatternVarGroup" id="401660">:::</a><span class="delimiter">(</span><a title="List[MatrixContext.this.PatternVar]" id="402297">ts</a>: <span title="List[MatrixContext.this.PatternVar]">List</span><span class="delimiter">[</span>PatternVar<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#401641" title="(xs: List[MatrixContext.this.PatternVar])MatrixContext.this.PatternVarGroup">PatternVarGroup</a><span class="delimiter">(</span><a href="#402297" title="List[MatrixContext.this.PatternVar]">ts</a> <a href="#402308" title="(prefix: List[MatrixContext.this.PatternVar])List[MatrixContext.this.PatternVar]">:::</a> <a href="#401670" title="=&gt; List[MatrixContext.this.PatternVar]">pvs</a><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="(other: MatrixContext.this.PatternVarGroup)MatrixContext.this.PatternVarGroup" id="401661">++</a><span class="delimiter">(</span><a title="MatrixContext.this.PatternVarGroup" id="402316">other</a>: <a href="#400473" title="MatrixContext.this.PatternVarGroup">PatternVarGroup</a><span class="delimiter">)</span> = <a href="#401641" title="(xs: List[MatrixContext.this.PatternVar])MatrixContext.this.PatternVarGroup">PatternVarGroup</a><span class="delimiter">(</span><a href="#401670" title="=&gt; List[MatrixContext.this.PatternVar]">pvs</a> <a href="#402327" title="(prefix: List[MatrixContext.this.PatternVar])List[MatrixContext.this.PatternVar]">:::</a> <a href="#402316" title="MatrixContext.this.PatternVarGroup">other</a>.<a href="#401670" title="=&gt; List[MatrixContext.this.PatternVar]">pvs</a><span class="delimiter">)</span>
      
      <span class="keyword">def</span> <a title="(i: Int)MatrixContext.this.PatternVar" id="401662">apply</a><span class="delimiter">(</span><a title="Int" id="402335">i</a>: <span title="Int">Int</span><span class="delimiter">)</span> = <a href="#401670" title="(n: Int)MatrixContext.this.PatternVar">pvs</a><span class="delimiter">(</span><a href="#402335" title="Int">i</a><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="=&gt; List[(MatrixContext.this.PatternVar, Int)]" id="401663">zipWithIndex</a> = <a href="#401670" title="=&gt; List[MatrixContext.this.PatternVar]">pvs</a>.<span title="(implicit bf: scala.collection.generic.CanBuildFrom[List[MatrixContext.this.PatternVar],(MatrixContext.this.PatternVar, Int),List[(MatrixContext.this.PatternVar, Int)]])List[(MatrixContext.this.PatternVar, Int)]">zipWithIndex</span>
      <span class="keyword">def</span> <a title="=&gt; scala.collection.immutable.Range" id="401664">indices</a> = <a href="#401670" title="=&gt; List[MatrixContext.this.PatternVar]">pvs</a>.<span title="=&gt; scala.collection.immutable.Range">indices</span>
      <span class="keyword">def</span> <a title="[T](f: MatrixContext.this.PatternVar =&gt; T)List[T]" id="401665">map</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="401667">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="MatrixContext.this.PatternVar =&gt; T" id="402391">f</a>: PatternVar =&gt; T<span class="delimiter">)</span> = <a href="#401670" title="=&gt; List[MatrixContext.this.PatternVar]">pvs</a> <span title="(f: MatrixContext.this.PatternVar =&gt; T)(implicit bf: scala.collection.generic.CanBuildFrom[List[MatrixContext.this.PatternVar],T,List[T]])List[T]">map</span> <a href="#402391" title="MatrixContext.this.PatternVar =&gt; T">f</a>
      <span class="keyword">def</span> <a title="(p: MatrixContext.this.PatternVar =&gt; Boolean)MatrixContext.this.PatternVarGroup" id="401668">filter</a><span class="delimiter">(</span><a title="MatrixContext.this.PatternVar =&gt; Boolean" id="402431">p</a>: PatternVar =&gt; Boolean<span class="delimiter">)</span> = <a href="#401641" title="(xs: List[MatrixContext.this.PatternVar])MatrixContext.this.PatternVarGroup">PatternVarGroup</a><span class="delimiter">(</span><a href="#401670" title="=&gt; List[MatrixContext.this.PatternVar]">pvs</a> <span title="(p: MatrixContext.this.PatternVar =&gt; Boolean)List[MatrixContext.this.PatternVar]">filter</span> <a href="#402431" title="MatrixContext.this.PatternVar =&gt; Boolean">p</a><span class="delimiter">)</span>
      
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="401669">toString</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="MatchSupport.scala.html#399135" title="(x: Any)String">pp</a><span class="delimiter">(</span><a href="#401670" title="=&gt; List[MatrixContext.this.PatternVar]">pvs</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="comment">/** Every temporary variable allocated is put in a PatternVar.
     */</span>
    <span class="keyword">class</span> <a title="class PatternVar extends java.lang.Object with ScalaObject" id="400474">PatternVar</a><a href="#400474" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="Matrix.this.global.Symbol" id="402045">lhs</a>: <a href="../symtab/Symbols.scala.html#67331" title="Matrix.this.global.Symbol">Symbol</a>, <span class="keyword">val</span> <a title="Matrix.this.global.Tree" id="402046">rhs</a>: <span title="Matrix.this.global.Tree">Tree</span>, <span class="keyword">val</span> <a title="Boolean" id="402047">checked</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="=&gt; Matrix.this.global.Symbol" id="400518">sym</a> = <a href="#402045" title="=&gt; Matrix.this.global.Symbol">lhs</a>
      <span class="keyword">def</span> <a title="=&gt; Matrix.this.global.Type" id="400519">tpe</a> = <a href="#402045" title="=&gt; Matrix.this.global.Symbol">lhs</a>.<a href="../symtab/Symbols.scala.html#107562" title="=&gt; Matrix.this.global.Type">tpe</a>

      <span class="comment">// See #1427 for an example of a crash which occurs unless we retype:</span>
      <span class="comment">// in that instance there is an existential in the pattern.</span>
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="Matrix.this.global.analyzer.global.Tree" id="400521">ident</a>  = <a href="#402661" title="=&gt; Matrix.this.global.analyzer.Typer">typer</a> <a href="../typechecker/Typers.scala.html#106063" title="(tree: Matrix.this.global.analyzer.global.Tree)Matrix.this.global.analyzer.global.Tree">typed</a> <a href="../ast/Trees.scala.html#67813" title="(sym: Matrix.this.global.Symbol)Matrix.this.global.Ident">Ident</a><span class="delimiter">(</span><a href="#402045" title="=&gt; Matrix.this.global.Symbol">lhs</a><span class="delimiter">)</span>
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="Matrix.this.global.analyzer.global.ValDef" id="400523">valDef</a> = <a href="#402661" title="=&gt; Matrix.this.global.analyzer.Typer">typer</a> <a href="../typechecker/Typers.scala.html#106025" title="(vdef: Matrix.this.global.analyzer.global.ValDef)Matrix.this.global.analyzer.global.ValDef">typedValDef</a> <a href="../ast/Trees.scala.html#67794" title="(sym: Matrix.this.global.Symbol, rhs: Matrix.this.global.Tree)Matrix.this.global.ValDef">ValDef</a><span class="delimiter">(</span><a href="#402045" title="=&gt; Matrix.this.global.Symbol">lhs</a>, <a href="#402046" title="=&gt; Matrix.this.global.Tree">rhs</a><span class="delimiter">)</span>

      <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="400524">toString</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;%s: %s = %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#402045" title="=&gt; Matrix.this.global.Symbol">lhs</a>, <a href="#400519" title="=&gt; Matrix.this.global.Type">tpe</a>, <a href="#402046" title="=&gt; Matrix.this.global.Tree">rhs</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="comment">/** Sets the rhs to EmptyTree, which makes the valDef ignored in Scrutinee.
     */</span>
    <span class="keyword">def</span> <a title="(lhs: Matrix.this.global.Symbol, checked: Boolean)MatrixContext.this.PatternVar" id="400475">specialVar</a><span class="delimiter">(</span><a title="Matrix.this.global.Symbol" id="402460">lhs</a>: <a href="../symtab/Symbols.scala.html#67331" title="Matrix.this.global.Symbol">Symbol</a>, <a title="Boolean" id="402461">checked</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> =
      <span title="MatrixContext.this.PatternVar" class="keyword">new</span> <a href="#400474" title="MatrixContext.this.PatternVar">PatternVar</a><span class="delimiter">(</span><a href="#402460" title="Matrix.this.global.Symbol">lhs</a>, <a href="../transform/TypingTransformers.scala.html#110301" title="object Matrix.this.global.EmptyTree">EmptyTree</a>, <a href="#402461" title="Boolean">checked</a><span class="delimiter">)</span>
    
    <span class="comment">/** Given a tree, creates a new synthetic variable of the same type
     *  and assigns the tree to it.
     */</span>
    <span class="keyword">def</span> <a title="(root: Matrix.this.global.Tree, checked: Boolean, _tpe: Matrix.this.global.Type, label: String)MatrixContext.this.PatternVar" id="400476">copyVar</a><span class="delimiter">(</span>
      <a title="Matrix.this.global.Tree" id="400501">root</a>: <span title="Matrix.this.global.Tree">Tree</span>,
      <a title="Boolean" id="400502">checked</a>: <span title="Boolean">Boolean</span>,
      <a title="Matrix.this.global.Type" id="400506">_tpe</a>: <a href="../symtab/Types.scala.html#67392" title="Matrix.this.global.Type">Type</a> = <span title="Null(null)" class="keyword">null</span>,
      <a title="String" id="400507">label</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;temp&quot;)" class="string">&quot;temp&quot;</span><span class="delimiter">)</span>: <a href="#400474" title="MatrixContext.this.PatternVar">PatternVar</a> =
    <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Matrix.this.global.Type" id="402464">tpe</a>   = <a href="#400457" title="(x: Matrix.this.global.Type, alt: Matrix.this.global.Type)Matrix.this.global.Type">ifNull</a><span class="delimiter">(</span><a href="#400506" title="Matrix.this.global.Type">_tpe</a>, <a href="#400501" title="Matrix.this.global.Tree">root</a>.<span title="=&gt; Matrix.this.global.Type">tpe</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Matrix.this.global.TermName" id="402465">name</a>  = <a href="#402659" title="=&gt; Matrix.this.global.CompilationUnit">cunit</a>.<a href="../CompilationUnits.scala.html#96429" title="(prefix: String)Matrix.this.global.TermName">freshTermName</a><span class="delimiter">(</span><a href="#400507" title="String">label</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Matrix.this.global.Symbol" id="402466">sym</a>   = <a href="#400479" title="(pos: Matrix.this.global.Position, tpe: Matrix.this.global.Type, flags: List[Long], name: Matrix.this.global.TermName)Matrix.this.global.Symbol">newVar</a><span class="delimiter">(</span><a href="#400501" title="Matrix.this.global.Tree">root</a>.<span title="=&gt; Matrix.this.global.Position">pos</span>, <a href="#402464" title="Matrix.this.global.Type">tpe</a>, <a href="#400460" title="(checked: Boolean)List[Long]">flags</a><span class="delimiter">(</span><a href="#400502" title="Boolean">checked</a><span class="delimiter">)</span>, <a href="#402465" title="Matrix.this.global.TermName">name</a><span class="delimiter">)</span>

      <a href="MatchSupport.scala.html#399141" title="(s: String)(x: MatrixContext.this.PatternVar)MatrixContext.this.PatternVar">tracing</a><span class="delimiter">(</span><span title="java.lang.String(&quot;copy&quot;)" class="string">&quot;copy&quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><span title="MatrixContext.this.PatternVar" class="keyword">new</span> <a href="#400474" title="MatrixContext.this.PatternVar">PatternVar</a><span class="delimiter">(</span><a href="#402466" title="Matrix.this.global.Symbol">sym</a>, <a href="#400501" title="Matrix.this.global.Tree">root</a>, <a href="#400502" title="Boolean">checked</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="comment">/** Creates a new synthetic variable of the specified type and
     *  assigns the result of f(symbol) to it.
     */</span>
    <span class="keyword">def</span> <a title="(tpe: Matrix.this.global.Type, f: Matrix.this.global.Symbol =&gt; Matrix.this.global.Tree, checked: Boolean)MatrixContext.this.PatternVar" id="400477">createVar</a><span class="delimiter">(</span><a title="Matrix.this.global.Type" id="402485">tpe</a>: <a href="../symtab/Types.scala.html#67392" title="Matrix.this.global.Type">Type</a>, <a title="Matrix.this.global.Symbol =&gt; Matrix.this.global.Tree" id="402486">f</a>: Symbol =&gt; Tree, <a title="Boolean" id="402487">checked</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Matrix.this.global.Symbol" id="402490">lhs</a> = <a href="#400479" title="(pos: Matrix.this.global.Position, tpe: Matrix.this.global.Type, flags: List[Long], name: Matrix.this.global.TermName)Matrix.this.global.Symbol">newVar</a><span class="delimiter">(</span><a href="#402662" title="=&gt; Matrix.this.global.Symbol">owner</a>.<a href="../symtab/Symbols.scala.html#107404" title="=&gt; Matrix.this.global.Position">pos</a>, <a href="#402485" title="Matrix.this.global.Type">tpe</a>, <a href="#400460" title="(checked: Boolean)List[Long]">flags</a><span class="delimiter">(</span><a href="#402487" title="Boolean">checked</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Matrix.this.global.Tree" id="402491">rhs</a> = <a href="#402486" title="(v1: Matrix.this.global.Symbol)Matrix.this.global.Tree">f</a><span class="delimiter">(</span><a href="#402490" title="Matrix.this.global.Symbol">lhs</a><span class="delimiter">)</span>
      
      <a href="MatchSupport.scala.html#399141" title="(s: String)(x: MatrixContext.this.PatternVar)MatrixContext.this.PatternVar">tracing</a><span class="delimiter">(</span><span title="java.lang.String(&quot;create&quot;)" class="string">&quot;create&quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><span title="MatrixContext.this.PatternVar" class="keyword">new</span> <a href="#400474" title="MatrixContext.this.PatternVar">PatternVar</a><span class="delimiter">(</span><a href="#402490" title="Matrix.this.global.Symbol">lhs</a>, <a href="#402491" title="Matrix.this.global.Tree">rhs</a>, <a href="#402487" title="Boolean">checked</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>      
    <span class="keyword">def</span> <a title="(tpe: Matrix.this.global.Type, f: Matrix.this.global.Symbol =&gt; Matrix.this.global.Tree, checked: Boolean)MatrixContext.this.PatternVar" id="400478">createLazy</a><span class="delimiter">(</span><a title="Matrix.this.global.Type" id="402501">tpe</a>: <a href="../symtab/Types.scala.html#67392" title="Matrix.this.global.Type">Type</a>, <a title="Matrix.this.global.Symbol =&gt; Matrix.this.global.Tree" id="402502">f</a>: Symbol =&gt; Tree, <a title="Boolean" id="402503">checked</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Matrix.this.global.Symbol" id="402506">lhs</a> = <a href="#400479" title="(pos: Matrix.this.global.Position, tpe: Matrix.this.global.Type, flags: List[Long], name: Matrix.this.global.TermName)Matrix.this.global.Symbol">newVar</a><span class="delimiter">(</span><a href="#402662" title="=&gt; Matrix.this.global.Symbol">owner</a>.<a href="../symtab/Symbols.scala.html#107404" title="=&gt; Matrix.this.global.Position">pos</a>, <a href="#402501" title="Matrix.this.global.Type">tpe</a>, Flags.<span title="Long(2147483648L)">LAZY</span> <a href="#402508" title="(x: Long)List[Long]">::</a> <a href="#400460" title="(checked: Boolean)List[Long]">flags</a><span class="delimiter">(</span><a href="#402503" title="Boolean">checked</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Matrix.this.global.Tree" id="402507">rhs</a> = <a href="#402502" title="(v1: Matrix.this.global.Symbol)Matrix.this.global.Tree">f</a><span class="delimiter">(</span><a href="#402506" title="Matrix.this.global.Symbol">lhs</a><span class="delimiter">)</span>
      
      <a href="MatchSupport.scala.html#399141" title="(s: String)(x: MatrixContext.this.PatternVar)MatrixContext.this.PatternVar">tracing</a><span class="delimiter">(</span><span title="java.lang.String(&quot;createLazy&quot;)" class="string">&quot;createLazy&quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><span title="MatrixContext.this.PatternVar" class="keyword">new</span> <a href="#400474" title="MatrixContext.this.PatternVar">PatternVar</a><span class="delimiter">(</span><a href="#402506" title="Matrix.this.global.Symbol">lhs</a>, <a href="#402507" title="Matrix.this.global.Tree">rhs</a>, <a href="#402503" title="Boolean">checked</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(pos: Matrix.this.global.Position, tpe: Matrix.this.global.Type, flags: List[Long], name: Matrix.this.global.TermName)Matrix.this.global.Symbol" id="400479">newVar</a><span class="delimiter">(</span>
      <a title="Matrix.this.global.Position" id="402472">pos</a>: <a href="../util/Position.scala.html#30588" title="Matrix.this.global.Position">Position</a>,
      <a title="Matrix.this.global.Type" id="402473">tpe</a>: <a href="../symtab/Types.scala.html#67392" title="Matrix.this.global.Type">Type</a>,
      <a title="List[Long]" id="402477">flags</a>: <span title="List[Long]">List</span><span class="delimiter">[</span>Long<span class="delimiter">]</span> = <span title="object Nil">Nil</span>,
      <a title="Matrix.this.global.TermName" id="402478">name</a>: <a href="../symtab/Names.scala.html#66926" title="Matrix.this.global.TermName">TermName</a> = <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>: <a href="../symtab/Symbols.scala.html#67331" title="Matrix.this.global.Symbol">Symbol</a> =
    <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Matrix.this.global.TermName" id="402521">n</a> = <span title="Matrix.this.global.TermName" class="keyword">if</span> <span class="delimiter">(</span><a href="#402478" title="Matrix.this.global.TermName">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#402659" title="=&gt; Matrix.this.global.CompilationUnit">cunit</a>.<a href="../CompilationUnits.scala.html#96429" title="(prefix: String)Matrix.this.global.TermName">freshTermName</a><span class="delimiter">(</span><span title="java.lang.String(&quot;temp&quot;)" class="string">&quot;temp&quot;</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#402478" title="Matrix.this.global.TermName">name</a>
      <span class="comment">// careful: pos has special meaning </span>
      <a href="#400464" title="(sym: Matrix.this.global.Symbol)Matrix.this.global.Symbol">recordSyntheticSym</a><span class="delimiter">(</span><a href="#402662" title="=&gt; Matrix.this.global.Symbol">owner</a>.<a href="../symtab/Symbols.scala.html#107422" title="(pos: Matrix.this.global.Position, name: Matrix.this.global.TermName)Matrix.this.global.TermSymbol">newVariable</a><span class="delimiter">(</span><a href="#402472" title="Matrix.this.global.Position">pos</a>, <a href="#402521" title="Matrix.this.global.TermName">n</a><span class="delimiter">)</span> <a href="../symtab/Symbols.scala.html#107566" title="(info: Matrix.this.global.Type)Matrix.this.global.TermSymbol">setInfo</a> <a href="#402473" title="Matrix.this.global.Type">tpe</a> <a href="../symtab/Symbols.scala.html#107553" title="(mask: Long)Matrix.this.global.TermSymbol">setFlag</a> <span class="delimiter">(</span><span title="Int(2097152)">SYNTHETIC</span>.<span title="=&gt; Long">toLong</span> <a href="#402533" title="(z: Long)(op: (Long, Long) =&gt; Long)Long">/:</a> <a href="#402477" title="List[Long]">flags</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#402546" title="Long">_</a><span title="(x: Long)Long">|</span><a href="#402547" title="Long">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>
        </pre>
    </body>
</html>
<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/transform/LazyVals.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> transform

<span class="keyword">import</span> scala.collection.<span class="delimiter">{</span> mutable, immutable <span class="delimiter">}</span>

<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class LazyVals extends scala.tools.nsc.SubComponent with scala.tools.nsc.transform.Transform with scala.tools.nsc.transform.TypingTransformers with scala.tools.nsc.ast.TreeDSL with ScalaObject" id="25766">LazyVals</a> <a href="#25766" title="ScalaObject" class="keyword">extends</a> <a href="Transform.scala.html#27209" title="scala.tools.nsc.transform.Transform">Transform</a> <span class="keyword">with</span> <a href="TypingTransformers.scala.html#27002" title="scala.tools.nsc.transform.TypingTransformers">TypingTransformers</a> <span class="keyword">with</span> ast.<a href="../ast/TreeDSL.scala.html#11731" title="scala.tools.nsc.ast.TreeDSL">TreeDSL</a> <span class="delimiter">{</span>
  <span class="comment">// inherits abstract value `global' and class `Phase' from Transform</span>

  <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#105692" title="=&gt; scala.tools.nsc.Global">global</a>._                  <span class="comment">// the global environment</span>
  <span class="keyword">import</span> <a href="../symtab/Definitions.scala.html#67688" title="object LazyVals.this.global.definitions">definitions</a>._             <span class="comment">// standard classes and methods</span>
  <span class="keyword">import</span> <a href="../Global.scala.html#64954" title="object LazyVals.this.global.typer">typer</a>.<span class="delimiter">{</span>typed, atOwner<span class="delimiter">}</span>    <span class="comment">// methods to type trees</span>
  <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#105696" title="object LazyVals.this.CODE">CODE</a>._

  <span class="keyword">val</span> <a title="String" id="111675">phaseName</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;lazyvals&quot;)" class="string">&quot;lazyvals&quot;</span>
  <span class="keyword">val</span> <a title="=&gt; Int" id="111677">FLAGS_PER_WORD</a>: <span title="Int">Int</span>

  <span class="keyword">def</span> <a title="(unit: LazyVals.this.global.CompilationUnit)LazyVals.this.global.Transformer" id="111678">newTransformer</a><span class="delimiter">(</span><a title="LazyVals.this.global.CompilationUnit" id="507169">unit</a>: <a href="../CompilationUnits.scala.html#67942" title="LazyVals.this.global.CompilationUnit">CompilationUnit</a><span class="delimiter">)</span>: <a href="../ast/Trees.scala.html#67825" title="LazyVals.this.global.Transformer">Transformer</a> =
    <span title="LazyVals.this.LazyValues" class="keyword">new</span> <a href="#111682" title="LazyVals.this.LazyValues">LazyValues</a><span class="delimiter">(</span><a href="#507169" title="LazyVals.this.global.CompilationUnit">unit</a><span class="delimiter">)</span>
  
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: LazyVals.this.global.Symbol)Boolean" id="111679">lazyUnit</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="507187">sym</a>: <a href="../symtab/Symbols.scala.html#67320" title="LazyVals.this.global.Symbol">Symbol</a><span class="delimiter">)</span> = <a href="#507187" title="LazyVals.this.global.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107421" title="=&gt; LazyVals.this.global.Type">tpe</a>.<a href="../symtab/Types.scala.html#105327" title="=&gt; LazyVals.this.global.Type">resultType</a>.<a href="../symtab/Types.scala.html#105313" title="=&gt; LazyVals.this.global.Symbol">typeSymbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../symtab/Definitions.scala.html#106577" title="=&gt; LazyVals.this.global.Symbol">UnitClass</a>

  <span class="keyword">object</span> <a title="object LazyVals.this.LocalLazyValFinder" id="111680">LocalLazyValFinder</a> <span title="ScalaObject" class="keyword">extends</span> <a href="../ast/Trees.scala.html#67826" title="LazyVals.this.global.Traverser">Traverser</a> <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Boolean" id="507201">result</a>: <span title="Boolean">Boolean</span>  = _
      
    <span class="keyword">def</span> <a title="(t: LazyVals.this.global.Tree)Boolean" id="507203">find</a><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="507208">t</a>: <span title="LazyVals.this.global.Tree">Tree</span><span class="delimiter">)</span> = <span class="delimiter">{</span><a href="#507201" title="(x$1: Boolean)Unit">result</a> = <span title="Boolean(false)" class="keyword">false</span>; <a href="#507205" title="(t: LazyVals.this.global.Tree)Unit">traverse</a><span class="delimiter">(</span><a href="#507208" title="LazyVals.this.global.Tree">t</a><span class="delimiter">)</span>; <a href="#507201" title="=&gt; Boolean">result</a><span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="(ts: List[LazyVals.this.global.Tree])Boolean" id="507204">find</a><span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="507217">ts</a>: <span title="List[LazyVals.this.global.Tree]">List</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span><a href="#507201" title="(x$1: Boolean)Unit">result</a> = <span title="Boolean(false)" class="keyword">false</span>; <span title="(trees: List[LazyVals.this.global.Tree])Unit">traverseTrees</span><span class="delimiter">(</span><a href="#507217" title="List[LazyVals.this.global.Tree]">ts</a><span class="delimiter">)</span>; <a href="#507201" title="=&gt; Boolean">result</a><span class="delimiter">}</span>  
    
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(t: LazyVals.this.global.Tree)Unit" id="507205">traverse</a><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="507211">t</a>: <span title="LazyVals.this.global.Tree">Tree</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#507201" title="=&gt; Boolean">result</a><span class="delimiter">)</span>
        <a href="#507211" title="LazyVals.this.global.Tree">t</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a title="Unit" id="507221">v</a>@ValDef<span class="delimiter">(</span>_, _, _, _<span class="delimiter">)</span> <span class="keyword">if</span> <a href="#507221" title="LazyVals.this.global.ValDef">v</a>.<span title="=&gt; LazyVals.this.global.Symbol">symbol</span>.<span title="=&gt; Boolean">isLazy</span> =&gt;
            <a href="#507201" title="(x$1: Boolean)Unit">result</a> = <span title="Boolean(true)" class="keyword">true</span>

          <span class="keyword">case</span> <a title="Unit" id="507231">d</a>@DefDef<span class="delimiter">(</span>_, _, _, _, _, _<span class="delimiter">)</span> <span class="keyword">if</span> <a href="#507231" title="LazyVals.this.global.DefDef">d</a>.<span title="=&gt; LazyVals.this.global.Symbol">symbol</span>.<span title="=&gt; Boolean">isLazy</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#111679" title="(sym: LazyVals.this.global.Symbol)Boolean">lazyUnit</a><span class="delimiter">(</span><a href="#507231" title="LazyVals.this.global.DefDef">d</a>.<span title="=&gt; LazyVals.this.global.Symbol">symbol</span><span class="delimiter">)</span> =&gt;
            <a href="#507231" title="LazyVals.this.global.DefDef">d</a>.<span title="=&gt; LazyVals.this.global.Symbol">symbol</span>.<a href="../symtab/Symbols.scala.html#107413" title="(mask: Long)LazyVals.this.global.Symbol">resetFlag</a><span class="delimiter">(</span>symtab.Flags.<span title="Long(2147483648L)">LAZY</span><span class="delimiter">)</span>
            <a href="#507201" title="(x$1: Boolean)Unit">result</a> = <span title="Boolean(true)" class="keyword">true</span>
              
          <span class="keyword">case</span> <span title="Unit">ClassDef</span><span class="delimiter">(</span>_, _, _, _<span class="delimiter">)</span> | DefDef<span class="delimiter">(</span>_, _, _, _, _, _<span class="delimiter">)</span> | ModuleDef<span class="delimiter">(</span>_, _, _<span class="delimiter">)</span> =&gt;
              
          <span class="keyword">case</span> <span title="Unit">LabelDef</span><span class="delimiter">(</span><a title="LazyVals.this.global.TermName" id="507293">name</a>, _, _<span class="delimiter">)</span> <span class="keyword">if</span> <a href="../symtab/StdNames.scala.html#67713" title="object LazyVals.this.global.nme">nme</a>.<a href="../symtab/NameManglers.scala.html#115607" title="(name: LazyVals.this.global.Name)Boolean">isLoopHeaderLabel</a><span class="delimiter">(</span><a href="#507293" title="LazyVals.this.global.TermName">name</a><span class="delimiter">)</span> =&gt;
              
          <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
            <span class="keyword">super</span>.<a href="../ast/Trees.scala.html#162606" title="(tree: LazyVals.this.global.Tree)Unit">traverse</a><span class="delimiter">(</span><a href="#507211" title="LazyVals.this.global.Tree">t</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  <span class="comment">/**
   * Transform local lazy accessors to check for the initialized bit.
   */</span>
  <span class="keyword">class</span> <a title="class LazyValues extends LazyVals.this.TypingTransformer with ScalaObject" id="111682">LazyValues</a><a href="#111682" title="ScalaObject" class="delimiter">(</a><a title="LazyVals.this.global.CompilationUnit" id="507186">unit</a>: <a href="../CompilationUnits.scala.html#67942" title="LazyVals.this.global.CompilationUnit">CompilationUnit</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="TypingTransformers.scala.html#110163" title="LazyVals.this.TypingTransformer">TypingTransformer</a><span class="delimiter">(</span><a href="#507186" title="LazyVals.this.global.CompilationUnit">unit</a><span class="delimiter">)</span> <span class="delimiter">{</span>    
    <span class="comment">/** map from method symbols to the number of lazy values it defines. */</span>
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,Int]" id="507175">lazyVals</a> = <a href="#507299" title="scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,Int]" class="keyword">new</a> <a title="anonymous class $anon extends scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,Int]" id="507299">mutable</a>.<span title="scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,Int]">HashMap</span><span class="delimiter">[</span>Symbol, Int<span class="delimiter">]</span> <span class="delimiter">{</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="(meth: LazyVals.this.global.Symbol)Int" id="507301">default</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="507302">meth</a>: <a href="../symtab/Symbols.scala.html#67320" title="LazyVals.this.global.Symbol">Symbol</a><span class="delimiter">)</span> = <span title="Int(0)" class="int">0</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">import</span> symtab.<a href="../symtab/Flags.scala.html#24079" title="object scala.tools.nsc.symtab.Flags">Flags</a>._
    <span class="keyword">import</span> <a href="#507175" title="=&gt; scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,Int]">lazyVals</a>._

    <span class="comment">/** Perform the following transformations:
     *  - for a lazy accessor inside a method, make it check the initialization bitmap
     *  - for all methods, add enough int vars to allow one flag per lazy local value
     *  - blocks in template bodies behave almost like methods. A single bitmaps section is
     *      added in the first block, for all lazy values defined in such blocks.
     *  - remove ACCESSOR flags: accessors in traits are not statically implemented,  
     *    but moved to the host class. local lazy values should be statically implemented.
     */</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree" id="507179">transform</a><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="507385">tree</a>: <span title="LazyVals.this.global.Tree">Tree</span><span class="delimiter">)</span>: <span title="LazyVals.this.global.Tree">Tree</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="LazyVals.this.global.Symbol" id="507390">sym</a> = <a href="#507385" title="LazyVals.this.global.Tree">tree</a>.<span title="=&gt; LazyVals.this.global.Symbol">symbol</span>
      <a href="TypingTransformers.scala.html#501484" title="(x$1: LazyVals.this.global.Tree)Unit">curTree</a> = <a href="#507385" title="LazyVals.this.global.Tree">tree</a>
      
      <a href="#507385" title="LazyVals.this.global.Tree">tree</a> <span title="LazyVals.this.global.Tree" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="LazyVals.this.global.DefDef">DefDef</span><span class="delimiter">(</span><a title="LazyVals.this.global.Modifiers" id="507401">mods</a>, <a title="LazyVals.this.global.TermName" id="507402">name</a>, <a title="List[LazyVals.this.global.TypeDef]" id="507403">tparams</a>, <a title="List[List[LazyVals.this.global.ValDef]]" id="507404">vparams</a>, <a title="LazyVals.this.global.Tree" id="507405">tpt</a>, <a title="LazyVals.this.global.Tree" id="507406">rhs</a><span class="delimiter">)</span> =&gt; <a href="TypingTransformers.scala.html#501489" title="(owner: LazyVals.this.global.Symbol)(trans: =&gt; LazyVals.this.global.DefDef)LazyVals.this.global.DefDef">atOwner</a><span class="delimiter">(</span><a href="#507385" title="LazyVals.this.global.Tree">tree</a>.<span title="=&gt; LazyVals.this.global.Symbol">symbol</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="LazyVals.this.global.Tree" id="507426">res</a> = <span title="LazyVals.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#507390" title="LazyVals.this.global.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107400" title="=&gt; LazyVals.this.global.Symbol">owner</a>.<span title="=&gt; Boolean">isClass</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#507390" title="LazyVals.this.global.Symbol">sym</a>.<span title="=&gt; Boolean">isLazy</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="LazyVals.this.global.Symbol" id="507427">enclosingClassOrDummyOrMethod</a> = <span class="delimiter">{</span>
              <span class="keyword">val</span> <a title="LazyVals.this.global.Symbol" id="507430">enclMethod</a> = <a href="#507390" title="LazyVals.this.global.Symbol">sym</a>.<span title="=&gt; LazyVals.this.global.Symbol">enclMethod</span>
              
              <span title="LazyVals.this.global.Symbol" class="keyword">if</span> <span class="delimiter">(</span><a href="#507430" title="LazyVals.this.global.Symbol">enclMethod</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../symtab/Symbols.scala.html#67328" title="object LazyVals.this.global.NoSymbol">NoSymbol</a> <span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">val</span> <a title="LazyVals.this.global.Symbol" id="507435">enclClass</a> = <a href="#507390" title="LazyVals.this.global.Symbol">sym</a>.<span title="=&gt; LazyVals.this.global.Symbol">enclClass</span>
                <span title="LazyVals.this.global.Symbol" class="keyword">if</span> <span class="delimiter">(</span><a href="#507435" title="LazyVals.this.global.Symbol">enclClass</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../symtab/Symbols.scala.html#67328" title="object LazyVals.this.global.NoSymbol">NoSymbol</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#507430" title="LazyVals.this.global.Symbol">enclMethod</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#507435" title="LazyVals.this.global.Symbol">enclClass</a>.<span title="=&gt; LazyVals.this.global.Symbol">enclMethod</span><span class="delimiter">)</span>
                  <a href="#507435" title="LazyVals.this.global.Symbol">enclClass</a>
                <span class="keyword">else</span>
                  <a href="#507430" title="LazyVals.this.global.Symbol">enclMethod</a>
              <span class="delimiter">}</span> <span class="keyword">else</span>
                <a href="#507390" title="LazyVals.this.global.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107400" title="=&gt; LazyVals.this.global.Symbol">owner</a>
            <span class="delimiter">}</span>
            <span class="keyword">val</span> <a title="Int" id="507428">idx</a> = <a href="#507175" title="(key: LazyVals.this.global.Symbol)Int">lazyVals</a><span class="delimiter">(</span><a href="#507427" title="LazyVals.this.global.Symbol">enclosingClassOrDummyOrMethod</a><span class="delimiter">)</span>
            <a href="#507175" title="(key: LazyVals.this.global.Symbol, value: Int)Unit">lazyVals</a><span class="delimiter">(</span><a href="#507427" title="LazyVals.this.global.Symbol">enclosingClassOrDummyOrMethod</a><span class="delimiter">)</span> = <a href="#507428" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>
            <span class="keyword">val</span> <a title="LazyVals.this.global.Tree" id="507429">rhs1</a> = <a href="#507181" title="(methOrClass: LazyVals.this.global.Symbol, tree: LazyVals.this.global.Tree, offset: Int, lazyVal: LazyVals.this.global.Symbol)LazyVals.this.global.Tree">mkLazyDef</a><span class="delimiter">(</span><a href="#507427" title="LazyVals.this.global.Symbol">enclosingClassOrDummyOrMethod</a>, <a href="#111682" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="TypingTransformers.scala.html#501495" title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#507406" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span>, <a href="#507428" title="Int">idx</a>, <a href="#507390" title="LazyVals.this.global.Symbol">sym</a><span class="delimiter">)</span>
            <a href="#507390" title="LazyVals.this.global.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107413" title="(mask: Long)sym.type">resetFlag</a><span class="delimiter">(</span><span class="delimiter">(</span><span title="Long" class="keyword">if</span> <span class="delimiter">(</span><a href="#111679" title="(sym: LazyVals.this.global.Symbol)Boolean">lazyUnit</a><span class="delimiter">(</span><a href="#507390" title="LazyVals.this.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="Long(0L)" class="int">0</span> <span class="keyword">else</span> <span title="Long(2147483648L)">LAZY</span><span class="delimiter">)</span> <span title="(x: Int)Long">|</span> <span title="Int(134217728)">ACCESSOR</span><span class="delimiter">)</span>
            <a href="#507429" title="LazyVals.this.global.Tree">rhs1</a>
          <span class="delimiter">}</span> <span class="keyword">else</span>
            <a href="#111682" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="TypingTransformers.scala.html#501495" title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#507406" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span>

          <a href="../ast/Trees.scala.html#162504" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<a href="../ast/Trees.scala.html#162409" title="(tree: LazyVals.this.global.Tree, mods: LazyVals.this.global.Modifiers, name: LazyVals.this.global.Name, tparams: List[LazyVals.this.global.TypeDef], vparamss: List[List[LazyVals.this.global.ValDef]], tpt: LazyVals.this.global.Tree, rhs: LazyVals.this.global.Tree)LazyVals.this.global.DefDef">DefDef</a><span class="delimiter">(</span><a href="#507385" title="LazyVals.this.global.Tree">tree</a>, <a href="#507401" title="LazyVals.this.global.Modifiers">mods</a>, <a href="#507402" title="LazyVals.this.global.TermName">name</a>, <a href="#507403" title="List[LazyVals.this.global.TypeDef]">tparams</a>, <a href="#507404" title="List[List[LazyVals.this.global.ValDef]]">vparams</a>, <a href="#507405" title="LazyVals.this.global.Tree">tpt</a>,
                  <span title="LazyVals.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#111680" title="object LazyVals.this.LocalLazyValFinder">LocalLazyValFinder</a>.<a href="#507203" title="(t: LazyVals.this.global.Tree)Boolean">find</a><span class="delimiter">(</span><a href="#507426" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../typechecker/Typers.scala.html#105922" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#507180" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#507390" title="LazyVals.this.global.Symbol">sym</a>, <a href="#507426" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#507426" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span class="keyword">case</span> <span title="LazyVals.this.global.Template">Template</span><span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="507530">parents</a>, <a title="LazyVals.this.global.ValDef" id="507531">self</a>, <a title="List[LazyVals.this.global.Tree]" id="507532">body</a><span class="delimiter">)</span> =&gt; <a href="TypingTransformers.scala.html#501489" title="(owner: LazyVals.this.global.Symbol)(trans: =&gt; LazyVals.this.global.Template)LazyVals.this.global.Template">atOwner</a><span class="delimiter">(</span><a href="../ast/Trees.scala.html#162506" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="List[LazyVals.this.global.Tree]" id="507548">body1</a> = <a href="#111682" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="../ast/Trees.scala.html#162513" title="(trees: List[LazyVals.this.global.Tree])List[LazyVals.this.global.Tree]">transformTrees</a><span class="delimiter">(</span><a href="#507532" title="List[LazyVals.this.global.Tree]">body</a><span class="delimiter">)</span>
          <span class="keyword">var</span> <a title="Boolean" id="507549">added</a> = <span title="Boolean(false)" class="keyword">false</span>
          <span class="keyword">val</span> <a title="List[LazyVals.this.global.analyzer.global.Tree]" id="507550">stats</a> = 
            <span class="keyword">for</span> <span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="507570">stat</a> &lt;- <a href="#507548" title="(f: LazyVals.this.global.Tree =&gt; LazyVals.this.global.analyzer.global.Tree)(implicit bf: scala.collection.generic.CanBuildFrom[List[LazyVals.this.global.Tree],LazyVals.this.global.analyzer.global.Tree,List[LazyVals.this.global.analyzer.global.Tree]])List[LazyVals.this.global.analyzer.global.Tree]">body1</a><span class="delimiter">)</span> <span class="keyword">yield</span> <a href="#507570" title="LazyVals.this.global.Tree">stat</a> <span title="LazyVals.this.global.analyzer.global.Tree" class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <span title="LazyVals.this.global.analyzer.global.Tree">Block</span><span class="delimiter">(</span>_, _<span class="delimiter">)</span> | Apply<span class="delimiter">(</span>_, _<span class="delimiter">)</span> | If<span class="delimiter">(</span>_, _, _<span class="delimiter">)</span> <span class="keyword">if</span> <span title="=&gt; Boolean">!</span><a href="#507549" title="Boolean">added</a> =&gt;
                <span class="comment">// Avoid adding bitmaps when they are fully overshadowed by those</span>
                <span class="comment">// that are added inside loops</span>
                <span title="LazyVals.this.global.analyzer.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#111680" title="object LazyVals.this.LocalLazyValFinder">LocalLazyValFinder</a>.<a href="#507203" title="(t: LazyVals.this.global.Tree)Boolean">find</a><span class="delimiter">(</span><a href="#507570" title="LazyVals.this.global.Tree">stat</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                  <a href="#507549" title="Boolean">added</a> = <span title="Boolean(true)" class="keyword">true</span>
                  <a href="../typechecker/Typers.scala.html#105922" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#507180" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#507390" title="LazyVals.this.global.Symbol">sym</a>, <a href="#507570" title="LazyVals.this.global.Tree">stat</a><span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#507570" title="LazyVals.this.global.Tree">stat</a>
              <span class="keyword">case</span> <span title="LazyVals.this.global.analyzer.global.Tree">ValDef</span><span class="delimiter">(</span><a title="LazyVals.this.global.Modifiers" id="507593">mods</a>, <a title="LazyVals.this.global.TermName" id="507594">name</a>, <a title="LazyVals.this.global.Tree" id="507595">tpt</a>, <a title="LazyVals.this.global.Tree" id="507596">rhs</a><span class="delimiter">)</span> =&gt;
                <a href="../typechecker/Typers.scala.html#105922" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="../ast/Trees.scala.html#162504" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<a href="../ast/Trees.scala.html#162408" title="(tree: LazyVals.this.global.Tree, mods: LazyVals.this.global.Modifiers, name: LazyVals.this.global.Name, tpt: LazyVals.this.global.Tree, rhs: LazyVals.this.global.Tree)LazyVals.this.global.ValDef">ValDef</a><span class="delimiter">(</span><a href="#507570" title="LazyVals.this.global.Tree">stat</a>, <a href="#507593" title="LazyVals.this.global.Modifiers">mods</a>, <a href="#507594" title="LazyVals.this.global.TermName">name</a>, <a href="#507595" title="LazyVals.this.global.Tree">tpt</a>, <a href="#507180" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#507570" title="LazyVals.this.global.Tree">stat</a>.<span title="=&gt; LazyVals.this.global.Symbol">symbol</span>, <a href="#507596" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="LazyVals.this.global.Tree">_</span> =&gt; 
                <a href="#507570" title="LazyVals.this.global.Tree">stat</a>
            <span class="delimiter">}</span>
          <span class="keyword">val</span> <a title="List[LazyVals.this.global.analyzer.global.Tree]" id="507551">innerClassBitmaps</a> = <span title="List[LazyVals.this.global.analyzer.global.Tree]" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#507549" title="Boolean">added</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="../ast/Trees.scala.html#162506" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a>.<span title="=&gt; Boolean">isClass</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#507183" title="=&gt; scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]{def default(meth: LazyVals.this.global.Symbol): scala.collection.immutable.Nil.type}">bitmaps</a>.<span title="(key: LazyVals.this.global.Symbol)Boolean">contains</span><span class="delimiter">(</span><a href="../ast/Trees.scala.html#162506" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="comment">// add bitmap to inner class if necessary</span>
                <span class="keyword">val</span> <a title="List[LazyVals.this.global.analyzer.global.Tree]" id="507632">toAdd0</a> = <a href="#507183" title="(key: LazyVals.this.global.Symbol)List[LazyVals.this.global.Symbol]">bitmaps</a><span class="delimiter">(</span><a href="../ast/Trees.scala.html#162506" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a><span class="delimiter">)</span>.<span title="(f: LazyVals.this.global.Symbol =&gt; LazyVals.this.global.analyzer.global.Tree)(implicit bf: scala.collection.generic.CanBuildFrom[List[LazyVals.this.global.Symbol],LazyVals.this.global.analyzer.global.Tree,List[LazyVals.this.global.analyzer.global.Tree]])List[LazyVals.this.global.analyzer.global.Tree]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,LazyVals.this.global.analyzer.global.Tree,List[LazyVals.this.global.analyzer.global.Tree]]" class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="507662">s</a> =&gt; <a href="../typechecker/Typers.scala.html#105922" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="../ast/Trees.scala.html#67783" title="(sym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.ValDef">ValDef</a><span class="delimiter">(</span><a href="#507662" title="LazyVals.this.global.Symbol">s</a>, <a href="../ast/TreeDSL.scala.html#113810" title="=&gt; LazyVals.this.global.Literal">ZERO</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                <a href="#507632" title="List[LazyVals.this.global.analyzer.global.Tree]">toAdd0</a>.<span title="(f: LazyVals.this.global.analyzer.global.Tree =&gt; Any)Unit">foreach</span><span class="delimiter">(</span><a title="LazyVals.this.global.analyzer.global.Tree" id="507725">t</a> =&gt; <span class="delimiter">{</span>
                    <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="../ast/Trees.scala.html#162506" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a>.<a href="../symtab/Symbols.scala.html#107423" title="=&gt; LazyVals.this.global.Type">info</a>.<a href="../symtab/Types.scala.html#105347" title="(name: LazyVals.this.global.Name)LazyVals.this.global.Symbol">decl</a><span class="delimiter">(</span><a href="#507725" title="LazyVals.this.global.analyzer.global.Tree">t</a>.<span title="=&gt; LazyVals.this.global.analyzer.global.Symbol">symbol</span>.<a href="../symtab/Symbols.scala.html#107407" title="=&gt; LazyVals.this.global.analyzer.global.Name">name</a><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../symtab/Symbols.scala.html#67328" title="object LazyVals.this.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                      <a href="#507725" title="LazyVals.this.global.analyzer.global.Tree">t</a>.<span title="=&gt; LazyVals.this.global.analyzer.global.Symbol">symbol</span>.<a href="../symtab/Symbols.scala.html#107412" title="(mask: Long)LazyVals.this.global.analyzer.global.Symbol">setFlag</a><span class="delimiter">(</span><span title="Long(1L)">PROTECTED</span><span class="delimiter">)</span>
                      <a href="../ast/Trees.scala.html#162506" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a>.<a href="../symtab/Symbols.scala.html#107423" title="=&gt; LazyVals.this.global.Type">info</a>.<a href="../symtab/Types.scala.html#105346" title="=&gt; LazyVals.this.global.Scope">decls</a>.<a href="../symtab/Scopes.scala.html#112946" title="(sym: LazyVals.this.global.Symbol)LazyVals.this.global.Symbol">enter</a><span class="delimiter">(</span><a href="#507725" title="LazyVals.this.global.analyzer.global.Tree">t</a>.<span title="=&gt; LazyVals.this.global.analyzer.global.Symbol">symbol</span><span class="delimiter">)</span>
                    <span class="delimiter">}</span>
                <span class="delimiter">}</span><span class="delimiter">)</span>
                <a href="#507632" title="List[LazyVals.this.global.analyzer.global.Tree]">toAdd0</a>
            <span class="delimiter">}</span> <span class="keyword">else</span> List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>
          <a href="../ast/Trees.scala.html#162504" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<a href="../ast/Trees.scala.html#162414" title="(tree: LazyVals.this.global.Tree, parents: List[LazyVals.this.global.Tree], self: LazyVals.this.global.ValDef, body: List[LazyVals.this.global.Tree])LazyVals.this.global.Template">Template</a><span class="delimiter">(</span><a href="#507385" title="LazyVals.this.global.Tree">tree</a>, <a href="#507530" title="List[LazyVals.this.global.Tree]">parents</a>, <a href="#507531" title="LazyVals.this.global.ValDef">self</a>, <a href="#507551" title="List[LazyVals.this.global.analyzer.global.Tree]">innerClassBitmaps</a> <span title="(that: scala.collection.GenTraversableOnce[LazyVals.this.global.analyzer.global.Tree])(implicit bf: scala.collection.generic.CanBuildFrom[List[LazyVals.this.global.analyzer.global.Tree],LazyVals.this.global.analyzer.global.Tree,List[LazyVals.this.global.Tree]])List[LazyVals.this.global.Tree]">++</span> <a href="#507550" title="List[LazyVals.this.global.analyzer.global.Tree]">stats</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span class="keyword">case</span> <span title="LazyVals.this.global.ValDef">ValDef</span><span class="delimiter">(</span><a title="LazyVals.this.global.Modifiers" id="507848">mods</a>, <a title="LazyVals.this.global.TermName" id="507849">name</a>, <a title="LazyVals.this.global.Tree" id="507850">tpt</a>, <a title="LazyVals.this.global.Tree" id="507851">rhs0</a><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#507390" title="LazyVals.this.global.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107400" title="=&gt; LazyVals.this.global.Symbol">owner</a>.<span title="=&gt; Boolean">isModule</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#507390" title="LazyVals.this.global.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107400" title="=&gt; LazyVals.this.global.Symbol">owner</a>.<span title="=&gt; Boolean">isClass</span><span class="delimiter">)</span> =&gt;
          <span class="keyword">val</span> <a title="LazyVals.this.global.Tree" id="507852">rhs</a> = <a href="#111682" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="TypingTransformers.scala.html#501495" title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#507851" title="LazyVals.this.global.Tree">rhs0</a><span class="delimiter">)</span>
          <a href="../ast/Trees.scala.html#162504" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<a href="../ast/Trees.scala.html#162408" title="(tree: LazyVals.this.global.Tree, mods: LazyVals.this.global.Modifiers, name: LazyVals.this.global.Name, tpt: LazyVals.this.global.Tree, rhs: LazyVals.this.global.Tree)LazyVals.this.global.ValDef">ValDef</a><span class="delimiter">(</span><a href="#507385" title="LazyVals.this.global.Tree">tree</a>, <a href="#507848" title="LazyVals.this.global.Modifiers">mods</a>, <a href="#507849" title="LazyVals.this.global.TermName">name</a>, <a href="#507850" title="LazyVals.this.global.Tree">tpt</a>,
                  <span title="LazyVals.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#111680" title="object LazyVals.this.LocalLazyValFinder">LocalLazyValFinder</a>.<a href="#507203" title="(t: LazyVals.this.global.Tree)Boolean">find</a><span class="delimiter">(</span><a href="#507852" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../typechecker/Typers.scala.html#105922" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#507180" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#507390" title="LazyVals.this.global.Symbol">sym</a>, <a href="#507852" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#507852" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span>

        <span class="keyword">case</span> <a title="LazyVals.this.global.Tree" id="507862">l</a>@LabelDef<span class="delimiter">(</span><a title="LazyVals.this.global.TermName" id="507868">name0</a>, <a title="List[LazyVals.this.global.Ident]" id="507869">params0</a>, <a title="LazyVals.this.global.If" id="507870">ifp0</a>@If<span class="delimiter">(</span>_, _, _<span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#507868" title="LazyVals.this.global.TermName">name0</a>.<a href="../symtab/Names.scala.html#96606" title="(name: String)Boolean">startsWith</a><span class="delimiter">(</span><a href="../symtab/StdNames.scala.html#67713" title="object LazyVals.this.global.nme">nme</a>.<a href="../symtab/StdNames.scala.html#115522" title="=&gt; java.lang.String">WHILE_PREFIX</a><span class="delimiter">)</span> =&gt;
          <span class="keyword">val</span> <a title="LazyVals.this.global.Tree" id="507881">ifp1</a> = <a href="#111682" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="TypingTransformers.scala.html#501495" title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#507870" title="LazyVals.this.global.If">ifp0</a><span class="delimiter">)</span>
          <span class="keyword">val</span> If<a href="#507883" title="(LazyVals.this.global.Tree, LazyVals.this.global.Tree, LazyVals.this.global.Tree)" class="delimiter">(</a><a href="#507882" title="LazyVals.this.global.Tree" id="507883">cond0</a>, <a href="#507882" title="LazyVals.this.global.Tree" id="507884">thenp0</a>, <a href="#507882" title="LazyVals.this.global.Tree" id="507885">elsep0</a><span class="delimiter">)</span> = <a href="#507881" title="LazyVals.this.global.Tree">ifp1</a> 
          <span title="LazyVals.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#111680" title="object LazyVals.this.LocalLazyValFinder">LocalLazyValFinder</a>.<a href="#507203" title="(t: LazyVals.this.global.Tree)Boolean">find</a><span class="delimiter">(</span><a href="#507884" title="LazyVals.this.global.Tree">thenp0</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="../ast/Trees.scala.html#162504" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<a href="../ast/Trees.scala.html#162411" title="(tree: LazyVals.this.global.Tree, name: LazyVals.this.global.Name, params: List[LazyVals.this.global.Ident], rhs: LazyVals.this.global.Tree)LazyVals.this.global.LabelDef">LabelDef</a><span class="delimiter">(</span><a href="#507862" title="LazyVals.this.global.LabelDef">l</a>, <a href="#507868" title="LazyVals.this.global.TermName">name0</a>, <a href="#507869" title="List[LazyVals.this.global.Ident]">params0</a>,
                    <a href="../ast/Trees.scala.html#162504" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<a href="../ast/Trees.scala.html#162425" title="(tree: LazyVals.this.global.Tree, cond: LazyVals.this.global.Tree, thenp: LazyVals.this.global.Tree, elsep: LazyVals.this.global.Tree)LazyVals.this.global.If">If</a><span class="delimiter">(</span><a href="#507881" title="LazyVals.this.global.Tree">ifp1</a>, <a href="#507883" title="LazyVals.this.global.Tree">cond0</a>, <a href="../typechecker/Typers.scala.html#105922" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#507180" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#507390" title="LazyVals.this.global.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107400" title="=&gt; LazyVals.this.global.Symbol">owner</a>, <a href="#507884" title="LazyVals.this.global.Tree">thenp0</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#507885" title="LazyVals.this.global.Tree">elsep0</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">else</span>
            <a href="#507862" title="LazyVals.this.global.LabelDef">l</a>

        <span class="keyword">case</span> <a title="LazyVals.this.global.Tree" id="507918">l</a>@LabelDef<span class="delimiter">(</span><a title="LazyVals.this.global.TermName" id="507924">name0</a>, <a title="List[LazyVals.this.global.Ident]" id="507925">params0</a>, <a title="LazyVals.this.global.Block" id="507926">block</a>@Block<span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="507931">stats0</a>, _<span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">if</span> <a href="#507924" title="LazyVals.this.global.TermName">name0</a>.<a href="../symtab/Names.scala.html#96606" title="(name: String)Boolean">startsWith</a><span class="delimiter">(</span><a href="../symtab/StdNames.scala.html#67713" title="object LazyVals.this.global.nme">nme</a>.<a href="../symtab/StdNames.scala.html#115522" title="=&gt; java.lang.String">WHILE_PREFIX</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <a href="#507924" title="LazyVals.this.global.TermName">name0</a>.<a href="../symtab/Names.scala.html#96606" title="(name: String)Boolean">startsWith</a><span class="delimiter">(</span><a href="../symtab/StdNames.scala.html#67713" title="object LazyVals.this.global.nme">nme</a>.<a href="../symtab/StdNames.scala.html#115506" title="=&gt; java.lang.String">DO_WHILE_PREFIX</a><span class="delimiter">)</span> =&gt;
          <span class="keyword">val</span> <a title="List[LazyVals.this.global.Tree]" id="507943">stats1</a> = <a href="#111682" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="../ast/Trees.scala.html#162513" title="(trees: List[LazyVals.this.global.Tree])List[LazyVals.this.global.Tree]">transformTrees</a><span class="delimiter">(</span><a href="#507931" title="List[LazyVals.this.global.Tree]">stats0</a><span class="delimiter">)</span>
          <span title="LazyVals.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#111680" title="object LazyVals.this.LocalLazyValFinder">LocalLazyValFinder</a>.<a href="#507204" title="(ts: List[LazyVals.this.global.Tree])Boolean">find</a><span class="delimiter">(</span><a href="#507943" title="List[LazyVals.this.global.Tree]">stats1</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="../ast/Trees.scala.html#162504" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<a href="../ast/Trees.scala.html#162411" title="(tree: LazyVals.this.global.Tree, name: LazyVals.this.global.Name, params: List[LazyVals.this.global.Ident], rhs: LazyVals.this.global.Tree)LazyVals.this.global.LabelDef">LabelDef</a><span class="delimiter">(</span><a href="#507918" title="LazyVals.this.global.LabelDef">l</a>, <a href="#507924" title="LazyVals.this.global.TermName">name0</a>, <a href="#507925" title="List[LazyVals.this.global.Ident]">params0</a>,
                    <a href="../ast/Trees.scala.html#162504" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<a href="../ast/Trees.scala.html#162415" title="(tree: LazyVals.this.global.Tree, stats: List[LazyVals.this.global.Tree], expr: LazyVals.this.global.Tree)LazyVals.this.global.Block">Block</a><span class="delimiter">(</span><a href="#507926" title="LazyVals.this.global.Block">block</a>, <a href="../typechecker/Typers.scala.html#105922" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#507180" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#507390" title="LazyVals.this.global.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107400" title="=&gt; LazyVals.this.global.Symbol">owner</a>, <a href="#507943" title="List[LazyVals.this.global.Tree]">stats1</a>.<span title="=&gt; LazyVals.this.global.Tree">head</span><span class="delimiter">)</span><span class="delimiter">)</span><a href="#507953" title="(x: LazyVals.this.global.Tree)List[LazyVals.this.global.Tree]">::</a><a href="#507943" title="List[LazyVals.this.global.Tree]">stats1</a>.<span title="=&gt; List[LazyVals.this.global.Tree]">tail</span>, <a href="#507926" title="LazyVals.this.global.Block">block</a>.<span title="=&gt; LazyVals.this.global.Tree">expr</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">else</span>
            <a href="#507918" title="LazyVals.this.global.LabelDef">l</a>

        <span class="keyword">case</span> <span title="LazyVals.this.global.Tree">_</span> =&gt; <a href="#111682" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="TypingTransformers.scala.html#501495" title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#507385" title="LazyVals.this.global.Tree">tree</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="comment">/** Add the bitmap definitions to the rhs of a method definition.
     *  If the rhs has been tail-call transformed, insert the bitmap
     *  definitions inside the top-level label definition, so that each
     *  iteration has the lazy values un-initialized. Otherwise add them
     *  at the very beginning of the method.
     */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree" id="507180">addBitmapDefs</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="507513">methSym</a>: <a href="../symtab/Symbols.scala.html#67320" title="LazyVals.this.global.Symbol">Symbol</a>, <a title="LazyVals.this.global.Tree" id="507514">rhs</a>: <span title="LazyVals.this.global.Tree">Tree</span><span class="delimiter">)</span>: <span title="LazyVals.this.global.Tree">Tree</span> = <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(stats: List[LazyVals.this.global.Tree], tree: LazyVals.this.global.Tree)LazyVals.this.global.Block" id="507964">prependStats</a><span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="507967">stats</a>: <span title="List[LazyVals.this.global.Tree]">List</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span>, <a title="LazyVals.this.global.Tree" id="507968">tree</a>: <span title="LazyVals.this.global.Tree">Tree</span><span class="delimiter">)</span>: <span title="LazyVals.this.global.Block">Block</span> = <a href="#507968" title="LazyVals.this.global.Tree">tree</a> <span title="LazyVals.this.global.Block" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="LazyVals.this.global.Block">Block</span><span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="507973">stats1</a>, <a title="LazyVals.this.global.Tree" id="507974">res</a><span class="delimiter">)</span> =&gt; <a href="../ast/TreeDSL.scala.html#105692" title="(stats: List[LazyVals.this.global.Tree], expr: LazyVals.this.global.Tree)LazyVals.this.global.Block">Block</a><span class="delimiter">(</span><a href="#507967" title="List[LazyVals.this.global.Tree]">stats</a> <a href="#507987" title="(prefix: List[LazyVals.this.global.Tree])List[LazyVals.this.global.Tree]">:::</a> <a href="#507973" title="List[LazyVals.this.global.Tree]">stats1</a>, <a href="#507974" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="LazyVals.this.global.Block">_</span> =&gt; <a href="../ast/TreeDSL.scala.html#105692" title="(stats: List[LazyVals.this.global.Tree], expr: LazyVals.this.global.Tree)LazyVals.this.global.Block">Block</a><span class="delimiter">(</span><a href="#507967" title="List[LazyVals.this.global.Tree]">stats</a>, <a href="#507968" title="LazyVals.this.global.Tree">tree</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="List[LazyVals.this.global.ValDef]" id="507965">bmps</a> = <a href="#507183" title="(key: LazyVals.this.global.Symbol)List[LazyVals.this.global.Symbol]">bitmaps</a><span class="delimiter">(</span><a href="#507513" title="LazyVals.this.global.Symbol">methSym</a><span class="delimiter">)</span> <span title="(f: LazyVals.this.global.Symbol =&gt; LazyVals.this.global.ValDef)(implicit bf: scala.collection.generic.CanBuildFrom[List[LazyVals.this.global.Symbol],LazyVals.this.global.ValDef,List[LazyVals.this.global.ValDef]])List[LazyVals.this.global.ValDef]">map</span> <span class="delimiter">(</span><a href="../ast/Trees.scala.html#67783" title="(sym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.ValDef">ValDef</a><span class="delimiter">(</span><a href="#508044" title="LazyVals.this.global.Symbol">_</a>, <a href="../ast/TreeDSL.scala.html#113810" title="=&gt; LazyVals.this.global.Literal">ZERO</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">def</span> <a title="(params: List[LazyVals.this.global.Ident])Boolean" id="507966">isMatch</a><span class="delimiter">(</span><a title="List[LazyVals.this.global.Ident]" id="508082">params</a>: <span title="List[LazyVals.this.global.Ident]">List</span><span class="delimiter">[</span>Ident<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="#508082" title="List[LazyVals.this.global.Ident]">params</a>.<span title="=&gt; List[LazyVals.this.global.Ident]">tail</span> <span title="(that: scala.collection.GenSeq[LazyVals.this.global.Symbol])(p: (LazyVals.this.global.Ident, LazyVals.this.global.Symbol) =&gt; Boolean)Boolean">corresponds</span> <a href="#507513" title="LazyVals.this.global.Symbol">methSym</a>.<a href="../symtab/Symbols.scala.html#107421" title="=&gt; LazyVals.this.global.Type">tpe</a>.<a href="../symtab/Types.scala.html#105334" title="=&gt; List[LazyVals.this.global.Symbol]">params</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#508117" title="LazyVals.this.global.Ident">_</a>.<span title="=&gt; LazyVals.this.global.Type">tpe</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#508118" title="LazyVals.this.global.Symbol">_</a>.<a href="../symtab/Symbols.scala.html#107421" title="=&gt; LazyVals.this.global.Type">tpe</a><span class="delimiter">)</span>

      <span title="LazyVals.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#507965" title="List[LazyVals.this.global.ValDef]">bmps</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#507514" title="LazyVals.this.global.Tree">rhs</a> <span class="keyword">else</span> <a href="#507514" title="LazyVals.this.global.Tree">rhs</a> <span title="LazyVals.this.global.Tree" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="LazyVals.this.global.Block">Block</span><span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="508128">assign</a>, <a title="LazyVals.this.global.LabelDef" id="508129">l</a> @ LabelDef<span class="delimiter">(</span><a title="LazyVals.this.global.TermName" id="508135">name</a>, <a title="List[LazyVals.this.global.Ident]" id="508136">params</a>, <a title="LazyVals.this.global.Tree" id="508137">rhs1</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">if</span> <a href="#508135" title="LazyVals.this.global.TermName">name</a>.<a href="../symtab/Names.scala.html#96583" title="()String">toString</a> <span title="(x$1: AnyRef)Boolean">==</span> <span class="delimiter">(</span><span title="java.lang.String(&quot;_&quot;)" class="string">&quot;_&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#507513" title="LazyVals.this.global.Symbol">methSym</a>.<a href="../symtab/Symbols.scala.html#107407" title="=&gt; LazyVals.this.global.Name">name</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#507966" title="(params: List[LazyVals.this.global.Ident])Boolean">isMatch</a><span class="delimiter">(</span><a href="#508136" title="List[LazyVals.this.global.Ident]">params</a><span class="delimiter">)</span> =&gt;
            <a href="../ast/TreeDSL.scala.html#105692" title="(stats: List[LazyVals.this.global.Tree], expr: LazyVals.this.global.Tree)LazyVals.this.global.Block">Block</a><span class="delimiter">(</span><a href="#508128" title="List[LazyVals.this.global.Tree]">assign</a>, <a href="../ast/Trees.scala.html#162504" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<a href="../ast/Trees.scala.html#162411" title="(tree: LazyVals.this.global.Tree, name: LazyVals.this.global.Name, params: List[LazyVals.this.global.Ident], rhs: LazyVals.this.global.Tree)LazyVals.this.global.LabelDef">LabelDef</a><span class="delimiter">(</span><a href="#508129" title="LazyVals.this.global.LabelDef">l</a>, <a href="#508135" title="LazyVals.this.global.TermName">name</a>, <a href="#508136" title="List[LazyVals.this.global.Ident]">params</a>, <a href="../typechecker/Typers.scala.html#105922" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#507964" title="(stats: List[LazyVals.this.global.Tree], tree: LazyVals.this.global.Tree)LazyVals.this.global.Block">prependStats</a><span class="delimiter">(</span><a href="#507965" title="List[LazyVals.this.global.ValDef]">bmps</a>, <a href="#508137" title="LazyVals.this.global.Tree">rhs1</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

        <span class="keyword">case</span> <span title="LazyVals.this.global.Block">_</span> =&gt; <a href="#507964" title="(stats: List[LazyVals.this.global.Tree], tree: LazyVals.this.global.Tree)LazyVals.this.global.Block">prependStats</a><span class="delimiter">(</span><a href="#507965" title="List[LazyVals.this.global.ValDef]">bmps</a>, <a href="#507514" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    
    <span class="comment">/** return a 'lazified' version of rhs. Rhs should conform to the
     *  following schema:
     *  {
     *    l$ = &lt;rhs&gt; 
     *    l$
     *  } or
     *  &lt;rhs&gt; when the lazy value has type Unit (for which there is no field
     *  to cache it's value.
     * 
     *  The result will be a tree of the form
     *  {
     *    if ((bitmap$n &amp; MASK) == 0) {
     *       l$ = &lt;rhs&gt;
     *       bitmap$n = bimap$n | MASK
     *    }
     *    l$
     *  }
     *  where bitmap$n is an int value acting as a bitmap of initialized values. It is
     *  the 'n' is (offset / 32), the MASK is (1 &lt;&lt; (offset % 32)). If the value has type
     *  unit, no field is used to cache the value, so the resulting code is:
     *  {
     *    if ((bitmap$n &amp; MASK) == 0) {
     *       &lt;rhs&gt;;
     *       bitmap$n = bimap$n | MASK
     *    }
     *    ()
     *  }
     */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(methOrClass: LazyVals.this.global.Symbol, tree: LazyVals.this.global.Tree, offset: Int, lazyVal: LazyVals.this.global.Symbol)LazyVals.this.global.Tree" id="507181">mkLazyDef</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="507479">methOrClass</a>: <a href="../symtab/Symbols.scala.html#67320" title="LazyVals.this.global.Symbol">Symbol</a>, <a title="LazyVals.this.global.Tree" id="507480">tree</a>: <span title="LazyVals.this.global.Tree">Tree</span>, <a title="Int" id="507481">offset</a>: <span title="Int">Int</span>, <a title="LazyVals.this.global.Symbol" id="507482">lazyVal</a>: <a href="../symtab/Symbols.scala.html#67320" title="LazyVals.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="LazyVals.this.global.Tree">Tree</span> = <span class="delimiter">{</span>      
      <span class="keyword">val</span> <a title="LazyVals.this.global.Symbol" id="508161">bitmapSym</a>           = <a href="#507185" title="(meth: LazyVals.this.global.Symbol, offset: Int)LazyVals.this.global.Symbol">getBitmapFor</a><span class="delimiter">(</span><a href="#507479" title="LazyVals.this.global.Symbol">methOrClass</a>, <a href="#507481" title="Int">offset</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="LazyVals.this.global.Literal" id="508162">mask</a>                = <a href="../ast/TreeDSL.scala.html#149290" title="(x: Any)LazyVals.this.global.Literal">LIT</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span> <span title="(x: Int)Int">&lt;&lt;</span> <span class="delimiter">(</span><a href="#507481" title="Int">offset</a> <span title="(x: Int)Int">%</span> <a href="#111677" title="=&gt; Int">FLAGS_PER_WORD</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="&lt;none&gt; extends LazyVals.this.global.RefTree with Serializable" id="508163">bitmapRef</a> = <span title="&lt;none&gt; extends LazyVals.this.global.RefTree with Serializable" class="keyword">if</span> <span class="delimiter">(</span><a href="#507479" title="LazyVals.this.global.Symbol">methOrClass</a>.<span title="=&gt; Boolean">isClass</span><span class="delimiter">)</span> <a href="../ast/Trees.scala.html#67801" title="(qualifier: LazyVals.this.global.Tree, sym: LazyVals.this.global.Symbol)LazyVals.this.global.Select">Select</a><span class="delimiter">(</span><a href="../ast/Trees.scala.html#67800" title="(sym: LazyVals.this.global.Symbol)LazyVals.this.global.Tree">This</a><span class="delimiter">(</span><a href="#507479" title="LazyVals.this.global.Symbol">methOrClass</a><span class="delimiter">)</span>, <a href="#508161" title="LazyVals.this.global.Symbol">bitmapSym</a><span class="delimiter">)</span> <span class="keyword">else</span> <a href="../ast/Trees.scala.html#67802" title="(sym: LazyVals.this.global.Symbol)LazyVals.this.global.Ident">Ident</a><span class="delimiter">(</span><a href="#508161" title="LazyVals.this.global.Symbol">bitmapSym</a><span class="delimiter">)</span>

      <span class="keyword">def</span> <a title="(stmt: LazyVals.this.global.Tree)LazyVals.this.global.Block" id="508164">mkBlock</a><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="508241">stmt</a>: <span title="LazyVals.this.global.Tree">Tree</span><span class="delimiter">)</span> = <a href="../ast/TreeDSL.scala.html#113858" title="(xs: LazyVals.this.global.Tree*)LazyVals.this.global.Block">BLOCK</a><span class="delimiter">(</span><a href="#508241" title="LazyVals.this.global.Tree">stmt</a>, <a href="#507182" title="(bmp: LazyVals.this.global.Symbol, mask: LazyVals.this.global.Tree, bmpRef: LazyVals.this.global.Tree)LazyVals.this.global.Tree">mkSetFlag</a><span class="delimiter">(</span><a href="#508161" title="LazyVals.this.global.Symbol">bitmapSym</a>, <a href="#508162" title="LazyVals.this.global.Literal">mask</a>, <a href="#508163" title="&lt;none&gt; extends LazyVals.this.global.RefTree with Serializable">bitmapRef</a><span class="delimiter">)</span>, <a href="../ast/TreeDSL.scala.html#113813" title="=&gt; LazyVals.this.global.Literal">UNIT</a><span class="delimiter">)</span>


      <span class="keyword">val</span> <a href="#508166" title="(LazyVals.this.global.Block, LazyVals.this.global.Tree)" class="delimiter">(</a><a href="#508165" title="LazyVals.this.global.Block" id="508166">block</a>, <a href="#508165" title="LazyVals.this.global.Tree" id="508167">res</a><span class="delimiter">)</span> = <a href="#507480" title="LazyVals.this.global.Tree">tree</a> <span title="(LazyVals.this.global.Block, LazyVals.this.global.Tree)" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="(LazyVals.this.global.Block, LazyVals.this.global.Tree)">Block</span><span class="delimiter">(</span><a href="#508252" title="(x: List[LazyVals.this.global.Tree])Some[List[LazyVals.this.global.Tree]]">List</a><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="508263">assignment</a><span class="delimiter">)</span>, <a title="LazyVals.this.global.Tree" id="508264">res</a><span class="delimiter">)</span> <span class="keyword">if</span> <span title="=&gt; Boolean">!</span><a href="#111679" title="(sym: LazyVals.this.global.Symbol)Boolean">lazyUnit</a><span class="delimiter">(</span><a href="#507482" title="LazyVals.this.global.Symbol">lazyVal</a><span class="delimiter">)</span> =&gt;
          <span title="(_1: LazyVals.this.global.Block, _2: LazyVals.this.global.Tree)(LazyVals.this.global.Block, LazyVals.this.global.Tree)" class="delimiter">(</span><a href="#508164" title="(stmt: LazyVals.this.global.Tree)LazyVals.this.global.Block">mkBlock</a><span class="delimiter">(</span><a href="#508263" title="LazyVals.this.global.Tree">assignment</a><span class="delimiter">)</span>,  <a href="#508264" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="(LazyVals.this.global.Block, LazyVals.this.global.Literal)" id="508271">rhs</a>                          =&gt;
          <span title="(_1: LazyVals.this.global.Block, _2: LazyVals.this.global.Literal)(LazyVals.this.global.Block, LazyVals.this.global.Literal)" class="delimiter">(</span><a href="#508164" title="(stmt: LazyVals.this.global.Tree)LazyVals.this.global.Block">mkBlock</a><span class="delimiter">(</span><a href="#508271" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span>,         <a href="../ast/TreeDSL.scala.html#113813" title="=&gt; LazyVals.this.global.Literal">UNIT</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      
      <span class="keyword">val</span> <a title="LazyVals.this.global.Apply" id="508168">cond</a> = <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#113868" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: LazyVals.this.global.Tree)LazyVals.this.CODE.TreeMethods">bitmapRef</a> <a href="../ast/TreeDSL.scala.html#113868" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: LazyVals.this.global.Tree)LazyVals.this.CODE.TreeMethods">INT_&amp;</a> <a href="#508162" title="LazyVals.this.global.Literal">mask</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#149371" title="(other: LazyVals.this.global.Tree)LazyVals.this.global.Apply">INT_==</a> <a href="../ast/TreeDSL.scala.html#113810" title="=&gt; LazyVals.this.global.Literal">ZERO</a>

      <a href="../ast/Trees.scala.html#67840" title="(pos: LazyVals.this.global.Position)(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">atPos</a><span class="delimiter">(</span><a href="#507480" title="LazyVals.this.global.Tree">tree</a>.<span title="=&gt; LazyVals.this.global.Position">pos</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="TypingTransformers.scala.html#501480" title="=&gt; LazyVals.this.global.analyzer.Typer">localTyper</a>.<a href="../typechecker/Typers.scala.html#105922" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a> <span class="delimiter">{</span>
        <span class="keyword">def</span> <a title="=&gt; LazyVals.this.global.gen.global.Tree" id="508315">body</a> = <a href="../Global.scala.html#64832" title="object LazyVals.this.global.gen">gen</a>.<a href="../ast/TreeGen.scala.html#105470" title="(clazz: LazyVals.this.global.gen.global.Symbol, cond: LazyVals.this.global.gen.global.Tree, syncBody: List[LazyVals.this.global.gen.global.Tree], stats: List[LazyVals.this.global.gen.global.Tree])LazyVals.this.global.gen.global.Tree">mkDoubleCheckedLocking</a><span class="delimiter">(</span><a href="#507479" title="LazyVals.this.global.Symbol">methOrClass</a>.<span title="=&gt; LazyVals.this.global.Symbol">enclClass</span>, <a href="#508168" title="LazyVals.this.global.Apply">cond</a>, <span title="(xs: LazyVals.this.global.Block*)List[LazyVals.this.global.Block]">List</span><span class="delimiter">(</span><a href="#508166" title="LazyVals.this.global.Block">block</a><span class="delimiter">)</span>, <span title="object Nil">Nil</span><span class="delimiter">)</span>
        <a href="../ast/TreeDSL.scala.html#113858" title="(xs: LazyVals.this.global.Tree*)LazyVals.this.global.Block">BLOCK</a><span class="delimiter">(</span><a href="#508315" title="=&gt; LazyVals.this.global.gen.global.Tree">body</a>, <a href="#508167" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
     
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(bmp: LazyVals.this.global.Symbol, mask: LazyVals.this.global.Tree, bmpRef: LazyVals.this.global.Tree)LazyVals.this.global.Tree" id="507182">mkSetFlag</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="508243">bmp</a>: <a href="../symtab/Symbols.scala.html#67320" title="LazyVals.this.global.Symbol">Symbol</a>, <a title="LazyVals.this.global.Tree" id="508244">mask</a>: <span title="LazyVals.this.global.Tree">Tree</span>, <a title="LazyVals.this.global.Tree" id="508245">bmpRef</a>: <span title="LazyVals.this.global.Tree">Tree</span><span class="delimiter">)</span>: <span title="LazyVals.this.global.Tree">Tree</span> =
      <a href="../ast/TreeDSL.scala.html#113868" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: LazyVals.this.global.Tree)LazyVals.this.CODE.TreeMethods">bmpRef</a> <a href="../ast/TreeDSL.scala.html#149380" title="(rhs: LazyVals.this.global.Tree)LazyVals.this.global.Assign">===</a> <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#113868" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: LazyVals.this.global.Tree)LazyVals.this.CODE.TreeMethods">bmpRef</a> <a href="../ast/TreeDSL.scala.html#149368" title="(other: LazyVals.this.global.Tree)LazyVals.this.global.Apply">INT_|</a> <a href="#508244" title="LazyVals.this.global.Tree">mask</a><span class="delimiter">)</span>
    
    <span class="keyword">val</span> <a title="bitmaps extends scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]" id="507183">bitmaps</a> = <a href="#507340" title="scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]" class="keyword">new</a> <a title="anonymous class $anon extends scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]" id="507340">mutable</a>.<span title="scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]">HashMap</span><span class="delimiter">[</span>Symbol, List<span class="delimiter">[</span>Symbol<span class="delimiter">]</span><span class="delimiter">]</span> <span class="delimiter">{</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="(meth: LazyVals.this.global.Symbol)scala.collection.immutable.Nil.type" id="507342">default</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="507343">meth</a>: <a href="../symtab/Symbols.scala.html#67320" title="LazyVals.this.global.Symbol">Symbol</a><span class="delimiter">)</span> = <span title="object Nil">Nil</span>
    <span class="delimiter">}</span>
    
    <span class="comment">/** Return the symbol corresponding of the right bitmap int inside meth,
     *  given offset.
     */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(meth: LazyVals.this.global.Symbol, offset: Int)LazyVals.this.global.Symbol" id="507185">getBitmapFor</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="508169">meth</a>: <a href="../symtab/Symbols.scala.html#67320" title="LazyVals.this.global.Symbol">Symbol</a>, <a title="Int" id="508170">offset</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="../symtab/Symbols.scala.html#67320" title="LazyVals.this.global.Symbol">Symbol</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Int" id="508350">n</a> = <a href="#508170" title="Int">offset</a> <span title="(x: Int)Int">/</span> <a href="#111677" title="=&gt; Int">FLAGS_PER_WORD</a>
      <span class="keyword">val</span> <a title="List[LazyVals.this.global.Symbol]" id="508351">bmps</a> = <a href="#507183" title="(key: LazyVals.this.global.Symbol)List[LazyVals.this.global.Symbol]">bitmaps</a><span class="delimiter">(</span><a href="#508169" title="LazyVals.this.global.Symbol">meth</a><span class="delimiter">)</span>
      <span title="LazyVals.this.global.Symbol" class="keyword">if</span> <span class="delimiter">(</span><a href="#508351" title="List[LazyVals.this.global.Symbol]">bmps</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">&gt;</span> <a href="#508350" title="Int">n</a><span class="delimiter">)</span> 
        <a href="#508351" title="(n: Int)LazyVals.this.global.Symbol">bmps</a><span class="delimiter">(</span><a href="#508350" title="Int">n</a><span class="delimiter">)</span>
      <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="LazyVals.this.global.TermSymbol" id="508373">sym</a> = <a href="#508169" title="LazyVals.this.global.Symbol">meth</a>.<a href="../symtab/Symbols.scala.html#107281" title="(pos: LazyVals.this.global.Position, name: LazyVals.this.global.TermName)LazyVals.this.global.TermSymbol">newVariable</a><span class="delimiter">(</span><a href="#508169" title="LazyVals.this.global.Symbol">meth</a>.<a href="../symtab/Symbols.scala.html#107263" title="=&gt; LazyVals.this.global.Position">pos</a>, <a href="../symtab/StdNames.scala.html#67713" title="object LazyVals.this.global.nme">nme</a>.<a href="../symtab/StdNames.scala.html#115495" title="(n: Int)LazyVals.this.global.TermName">bitmapName</a><span class="delimiter">(</span><a href="#508350" title="Int">n</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../symtab/Symbols.scala.html#107425" title="(info: LazyVals.this.global.Type)LazyVals.this.global.TermSymbol">setInfo</a><span class="delimiter">(</span><a href="../symtab/Definitions.scala.html#106585" title="=&gt; LazyVals.this.global.Symbol">IntClass</a>.<a href="../symtab/Symbols.scala.html#107421" title="=&gt; LazyVals.this.global.Type">tpe</a><span class="delimiter">)</span>
        <a href="../symtab/SymbolTable.scala.html#64804" title="(ph: scala.tools.nsc.Phase)(op: =&gt; Unit)Unit">atPhase</a><span class="delimiter">(</span><a href="../Global.scala.html#64980" title="=&gt; LazyVals.this.global.Run">currentRun</a>.<a href="../Global.scala.html#72321" title="=&gt; scala.tools.nsc.Phase">typerPhase</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#508373" title="LazyVals.this.global.TermSymbol">sym</a> <a href="../symtab/Symbols.scala.html#107272" title="(annot: LazyVals.this.global.AnnotationInfo)Unit">addAnnotation</a> <a href="../symtab/AnnotationInfos.scala.html#134132" title="(atp: LazyVals.this.global.Type, args: List[LazyVals.this.global.Tree], assocs: List[(LazyVals.this.global.Name, LazyVals.this.global.ClassfileAnnotArg)])LazyVals.this.global.AnnotationInfo">AnnotationInfo</a><span class="delimiter">(</span><a href="../symtab/Definitions.scala.html#106489" title="=&gt; LazyVals.this.global.Symbol">VolatileAttr</a>.<a href="../symtab/Symbols.scala.html#107421" title="=&gt; LazyVals.this.global.Type">tpe</a>, <span title="object Nil">Nil</span>, <span title="object Nil">Nil</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        
        <a href="#507183" title="(key: LazyVals.this.global.Symbol, value: List[LazyVals.this.global.Symbol])Unit">bitmaps</a><span class="delimiter">(</span><a href="#508169" title="LazyVals.this.global.Symbol">meth</a><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="#508373" title="LazyVals.this.global.TermSymbol">sym</a> <a href="#508398" title="(x: LazyVals.this.global.Symbol)List[LazyVals.this.global.Symbol]">::</a> <a href="#508351" title="List[LazyVals.this.global.Symbol]">bmps</a><span class="delimiter">)</span>.<span title="=&gt; List[LazyVals.this.global.Symbol]">reverse</span>
        <a href="#508373" title="LazyVals.this.global.TermSymbol">sym</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
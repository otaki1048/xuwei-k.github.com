<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/interpreter/ExprTyper.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* NSC -- new Scala compiler
 * Copyright 2005-2011 LAMP/EPFL
 * @author  Paul Phillips
 */</span>

<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> interpreter

<span class="keyword">import</span> util.BatchSourceFile
<span class="keyword">import</span> ast.parser.<a href="../ast/parser/Tokens.scala.html#12650" title="object scala.tools.nsc.ast.parser.Tokens">Tokens</a>.EOF

<span class="keyword">trait</span> <a title="trait ExprTyper extends java.lang.Object with ScalaObject" id="19012">ExprTyper</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">val</span> <a title="=&gt; scala.tools.nsc.interpreter.IMain" id="336338">repl</a>: <a href="IMain.scala.html#19846" title="scala.tools.nsc.interpreter.IMain">IMain</a>
  <span class="keyword">import</span> <a href="#336338" title="=&gt; scala.tools.nsc.interpreter.IMain">repl</a>._
  <span class="keyword">import</span> <a href="IMain.scala.html#123371" title="=&gt; scala.tools.nsc.Global">global</a>.<span class="delimiter">{</span> reporter =&gt; _, _ <span class="delimiter">}</span>
  <span class="keyword">import</span> <a href="../Global.scala.html#64909" title="object ExprTyper.this.repl.global.syntaxAnalyzer">syntaxAnalyzer</a>.UnitParser
  <span class="keyword">import</span> <a href="IMain.scala.html#123377" title="object ExprTyper.this.repl.naming">naming</a>.freshInternalVarName
  
  <span class="keyword">object</span> <a title="object ExprTyper.this.codeParser" id="336343">codeParser</a> <span title="ScalaObject" class="keyword">extends</span> <span class="delimiter">{</span> <span class="keyword">val</span> <a title="ExprTyper.this.repl.global.type" id="336372">global</a>: repl.global.<span class="keyword">type</span> = <a href="#336338" title="=&gt; scala.tools.nsc.interpreter.IMain">repl</a>.<a href="IMain.scala.html#123371" title="=&gt; scala.tools.nsc.Global">global</a> <span class="delimiter">}</span> <span class="keyword">with</span> <a href="CodeHandlers.scala.html#18574" title="scala.tools.nsc.interpreter.CodeHandlers[ExprTyper.this.repl.global.Tree]">CodeHandlers</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="[T](code: String, rule: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; T)T" id="336359">applyRule</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="336361">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="String" id="336373">code</a>: <span title="String">String</span>, <a title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; T" id="336374">rule</a>: UnitParser =&gt; T<span class="delimiter">)</span>: <a href="#336361" title="T">T</a> = <span class="delimiter">{</span>
      <a href="IMain.scala.html#123345" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/AbstractReporter.scala.html#72230" title="()Unit">reset</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="ExprTyper.this.repl.global.CompilationUnit" id="336378">unit</a>    = <span title="ExprTyper.this.repl.global.CompilationUnit" class="keyword">new</span> <a href="../CompilationUnits.scala.html#67953" title="ExprTyper.this.repl.global.CompilationUnit">CompilationUnit</a><span class="delimiter">(</span><a href="../util/SourceFile.scala.html#96545" title="(sourceName: String, cs: Seq[Char])scala.tools.nsc.util.BatchSourceFile" class="keyword">new</a> <a href="../util/SourceFile.scala.html#30801" title="scala.tools.nsc.util.BatchSourceFile">BatchSourceFile</a><span class="delimiter">(</span><span title="java.lang.String(&quot;&lt;console&gt;&quot;)" class="string">&quot;&lt;console&gt;&quot;</span>, <a href="#336373" title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString">code</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser" id="336379">scanner</a> = <a href="../ast/parser/Parsers.scala.html#171730" title="(unit: ExprTyper.this.repl.global.syntaxAnalyzer.global.CompilationUnit)ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser" class="keyword">new</a> <a href="../ast/parser/Parsers.scala.html#96022" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">UnitParser</a><span class="delimiter">(</span><a href="#336378" title="ExprTyper.this.repl.global.CompilationUnit">unit</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="T" id="336380">result</a>  = <a href="#336374" title="(v1: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser)T">rule</a><span class="delimiter">(</span><a href="#336379" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">scanner</a><span class="delimiter">)</span>
      <span title="AnyVal" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="IMain.scala.html#123345" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#68004" title="=&gt; Boolean">hasErrors</a><span class="delimiter">)</span>
        <a href="#336379" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">scanner</a>.<a href="../ast/parser/Parsers.scala.html#169133" title="(token: Int)Int">accept</a><span class="delimiter">(</span><span title="Int(0)">EOF</span><span class="delimiter">)</span>
      
      <a href="#336380" title="T">result</a>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(code: String)Nothing" id="336362">decl</a><span class="delimiter">(</span><a title="String" id="336418">code</a>: <span title="String">String</span><span class="delimiter">)</span>  = <a href="CodeHandlers.scala.html#18575" title="object scala.tools.nsc.interpreter.CodeHandlers">CodeHandlers</a>.<a href="CodeHandlers.scala.html#332542" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="java.lang.String(&quot;todo&quot;)" class="string">&quot;todo&quot;</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)Nothing" id="336363">defn</a><span class="delimiter">(</span><a title="String" id="336421">code</a>: <span title="String">String</span><span class="delimiter">)</span>  = <a href="CodeHandlers.scala.html#18575" title="object scala.tools.nsc.interpreter.CodeHandlers">CodeHandlers</a>.<a href="CodeHandlers.scala.html#332542" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="java.lang.String(&quot;todo&quot;)" class="string">&quot;todo&quot;</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree" id="336364">expr</a><span class="delimiter">(</span><a title="String" id="336424">code</a>: <span title="String">String</span><span class="delimiter">)</span>  = <a href="#336359" title="(code: String, rule: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree)ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">applyRule</a><span class="delimiter">(</span><a href="#336424" title="String">code</a>, <a href="#336431" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">_</a>.<a href="../ast/parser/Parsers.scala.html#169221" title="()ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">expr</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree" id="336365">impt</a><span class="delimiter">(</span><a title="String" id="336439">code</a>: <span title="String">String</span><span class="delimiter">)</span>  = <a href="#336359" title="(code: String, rule: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree)ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">applyRule</a><span class="delimiter">(</span><a href="#336439" title="String">code</a>, <a href="#336446" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">_</a>.<a href="../ast/parser/Parsers.scala.html#169276" title="()ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">importExpr</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]" id="336366">impts</a><span class="delimiter">(</span><a title="String" id="336449">code</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#336359" title="(code: String, rule: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree])List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">applyRule</a><span class="delimiter">(</span><a href="#336449" title="String">code</a>, <a href="#336456" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">_</a>.<a href="../ast/parser/Parsers.scala.html#169275" title="()List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">importClause</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]" id="336367">stmts</a><span class="delimiter">(</span><a title="String" id="336459">code</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#336359" title="(code: String, rule: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree])List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">applyRule</a><span class="delimiter">(</span><a href="#336459" title="String">code</a>, <a href="#336475" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">_</a>.<a href="../ast/parser/Parsers.scala.html#169304" title="(isPre: Boolean)(ExprTyper.this.repl.global.syntaxAnalyzer.global.ValDef, List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree])">templateStatSeq</a><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>.<span title="=&gt; List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">_2</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)ExprTyper.this.repl.global.Tree" id="336368">stmt</a><span class="delimiter">(</span><a title="String" id="336479">code</a>: <span title="String">String</span><span class="delimiter">)</span>  = <a href="#336367" title="(code: String)List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">stmts</a><span class="delimiter">(</span><a href="#336479" title="String">code</a><span class="delimiter">)</span> <span title="ExprTyper.this.repl.global.Tree" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#336483" title="ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">List</a><span class="delimiter">(</span><a title="ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree" id="336505">t</a><span class="delimiter">)</span>  =&gt; <a href="#336505" title="ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">t</a>
      <span class="keyword">case</span> <a title="Nothing" id="336506">xs</a>       =&gt; <a href="CodeHandlers.scala.html#18575" title="object scala.tools.nsc.interpreter.CodeHandlers">CodeHandlers</a>.<a href="CodeHandlers.scala.html#332542" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Not a single statement: &quot;)" class="string">&quot;Not a single statement: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#336506" title="List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">xs</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  <span class="comment">/** Parse a line into a sequence of trees. Returns None if the input is incomplete. */</span>
  <span class="keyword">def</span> <a title="(line: String)Option[List[ExprTyper.this.repl.global.Tree]]" id="336345">parse</a><span class="delimiter">(</span><a title="String" id="336509">line</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[List[ExprTyper.this.repl.global.Tree]]">Option</span><span class="delimiter">[</span>List<span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Boolean" id="336511">isIncomplete</a> = <span title="Boolean(false)" class="keyword">false</span>
    <a href="IMain.scala.html#123345" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#67998" title="(handler: (scala.tools.nsc.util.Position, String) =&gt; Unit)(thunk: =&gt; Option[List[ExprTyper.this.repl.global.Tree]])Option[List[ExprTyper.this.repl.global.Tree]]">withIncompleteHandler</a><span class="delimiter">(</span><span class="delimiter">(</span><a title="scala.tools.nsc.util.Position" id="336523">_</a>, <a title="String" id="336524">_</a><span class="delimiter">)</span> =&gt; <a href="#336511" title="Boolean">isIncomplete</a> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]" id="336526">trees</a> = <a href="#336343" title="object ExprTyper.this.codeParser">codeParser</a>.<a href="#336367" title="(code: String)List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">stmts</a><span class="delimiter">(</span><a href="#336509" title="String">line</a><span class="delimiter">)</span>
      <span title="Option[List[ExprTyper.this.repl.global.Tree]]" class="keyword">if</span> <span class="delimiter">(</span><a href="IMain.scala.html#123345" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#68004" title="=&gt; Boolean">hasErrors</a><span class="delimiter">)</span> <span title="(x: scala.collection.immutable.Nil.type)Some[scala.collection.immutable.Nil.type]">Some</span><span class="delimiter">(</span><span title="object Nil">Nil</span><span class="delimiter">)</span>
      <span class="keyword">else</span> <span title="Option[List[ExprTyper.this.repl.global.Tree]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#336511" title="Boolean">isIncomplete</a><span class="delimiter">)</span> <span title="object None">None</span>
      <span class="keyword">else</span> <span title="(x: List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree])Some[List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]]">Some</span><span class="delimiter">(</span><a href="#336526" title="List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">trees</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  <span class="comment">// TODO: integrate these into a CodeHandler[Type].</span>
  
  <span class="comment">// XXX literals.</span>
  <span class="comment">// 1) Identifiers defined in the repl.</span>
  <span class="comment">// 2) A path loadable via getModule.</span>
  <span class="comment">// 3) Try interpreting it as an expression.</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="336347">typeOfExpressionDepth</a> = <span title="Int(0)" class="int">0</span>
  <span class="keyword">def</span> <a title="(expr: String, silent: Boolean)Option[ExprTyper.this.repl.global.Type]" id="336349">typeOfExpression</a><span class="delimiter">(</span><a title="String" id="336546">expr</a>: <span title="String">String</span>, <a title="Boolean" id="336549">silent</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>: <span title="Option[ExprTyper.this.repl.global.Type]">Option</span><span class="delimiter">[</span>Type<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="ReplConfig.scala.html#31875" title="(msg: =&gt; String)Unit">repltrace</a><span class="delimiter">(</span><span title="java.lang.String(&quot;typeOfExpression(&quot;)" class="string">&quot;typeOfExpression(&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#336546" title="String">expr</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;)&quot;)" class="string">&quot;)&quot;</span><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#336347" title="=&gt; Int">typeOfExpressionDepth</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="ReplConfig.scala.html#31874" title="(msg: =&gt; String)Unit">repldbg</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Terminating typeOfExpression recursion for expression: &quot;)" class="string">&quot;Terminating typeOfExpression recursion for expression: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#336546" title="String">expr</a><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <span title="object None">None</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="=&gt; Option[ExprTyper.this.repl.global.Type]" id="336550">asQualifiedImport</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="String" id="336576">name</a> = <a href="#336546" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">expr</a>.<span title="(p: Char =&gt; Boolean)String">takeWhile</span><span class="delimiter">(</span><a href="#336826" title="Char">_</a> <span title="(x: Char)Boolean">!=</span> <span title="Char(\'.\')" class="char">'.'</span><span class="delimiter">)</span>
      <a href="Imports.scala.html#123322" title="(name: String)Option[ExprTyper.this.repl.global.TermSymbol]">importedTermNamed</a><span class="delimiter">(</span><a href="#336576" title="String">name</a><span class="delimiter">)</span> <span title="(f: ExprTyper.this.repl.global.TermSymbol =&gt; Option[ExprTyper.this.repl.global.Type])Option[ExprTyper.this.repl.global.Type]">flatMap</span> <span class="delimiter">{</span> <a title="ExprTyper.this.repl.global.TermSymbol" id="337399">sym</a> =&gt;
        <a href="#336349" title="(expr: String, silent: Boolean)Option[ExprTyper.this.repl.global.Type]">typeOfExpression</a><span class="delimiter">(</span><a href="#337399" title="ExprTyper.this.repl.global.TermSymbol">sym</a>.<span title="=&gt; String">fullName</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#336546" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">expr</a>.<span title="(n: Int)String">drop</span><span class="delimiter">(</span><a href="#336576" title="String">name</a>.<span title="()Int">length</span><span class="delimiter">)</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="=&gt; Option[ExprTyper.this.repl.global.Type]" id="336551">asModule</a> = <a href="IMain.scala.html#123473" title="(name: String)Option[ExprTyper.this.repl.global.Symbol]">safeModule</a><span class="delimiter">(</span><a href="#336546" title="String">expr</a><span class="delimiter">)</span> <span title="(f: ExprTyper.this.repl.global.Symbol =&gt; ExprTyper.this.repl.global.Type)Option[ExprTyper.this.repl.global.Type]">map</span> <span class="delimiter">(</span><a href="#337527" title="ExprTyper.this.repl.global.Symbol">_</a>.<a href="../symtab/Symbols.scala.html#107562" title="=&gt; ExprTyper.this.repl.global.Type">tpe</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="=&gt; Option[ExprTyper.this.repl.global.Type]" id="336552">asExpr</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="String" id="337529">lhs</a> = <a href="Naming.scala.html#336164" title="()String">freshInternalVarName</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.lang.String" id="337530">line</a> = <span title="java.lang.String(&quot;lazy val &quot;)" class="string">&quot;lazy val &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#337529" title="String">lhs</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; =\012&quot;)" class="string">&quot; =\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#336546" title="String">expr</a>

      <a href="IMain.scala.html#123452" title="(line: String, synthetic: Boolean)scala.tools.nsc.interpreter.package.IR.Result">interpret</a><span class="delimiter">(</span><a href="#337530" title="java.lang.String">line</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <span title="Option[ExprTyper.this.repl.global.Type]" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="package.scala.html#31891" title="Option[ExprTyper.this.repl.global.Type]">IR</a>.<a href="Results.scala.html#337574" title="object scala.tools.nsc.interpreter.package.IR.Success">Success</a> =&gt; <a href="#336349" title="(expr: String, silent: Boolean)Option[ExprTyper.this.repl.global.Type]">typeOfExpression</a><span class="delimiter">(</span><a href="#337529" title="String">lhs</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="None.type">_</span>          =&gt; <span title="object None">None</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="()Option[ExprTyper.this.repl.global.Type]" id="336553">evaluate</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="#336347" title="(x$1: Int)Unit">typeOfExpressionDepth</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
      <span class="keyword">try</span> <a href="IMain.scala.html#123477" title="(id: String)Option[ExprTyper.this.repl.global.Type]">typeOfTerm</a><span class="delimiter">(</span><a href="#336546" title="String">expr</a><span class="delimiter">)</span> <span title="(alternative: =&gt; Option[ExprTyper.this.repl.global.Type])Option[ExprTyper.this.repl.global.Type]">orElse</span> <a href="#336551" title="=&gt; Option[ExprTyper.this.repl.global.Type]">asModule</a> <span title="(alternative: =&gt; Option[ExprTyper.this.repl.global.Type])Option[ExprTyper.this.repl.global.Type]">orElse</span> <a href="#336552" title="=&gt; Option[ExprTyper.this.repl.global.Type]">asExpr</a> <span title="(alternative: =&gt; Option[ExprTyper.this.repl.global.Type])Option[ExprTyper.this.repl.global.Type]">orElse</span> <a href="#336550" title="=&gt; Option[ExprTyper.this.repl.global.Type]">asQualifiedImport</a>
      <span class="keyword">finally</span> <a href="#336347" title="(x$1: Int)Unit">typeOfExpressionDepth</a> <span title="(x: Int)Int">-=</span> <span title="Int(1)" class="int">1</span>
    <span class="delimiter">}</span>
    
    <span class="comment">// Don't presently have a good way to suppress undesirable success output</span>
    <span class="comment">// while letting errors through, so it is first trying it silently: if there</span>
    <span class="comment">// is an error, and errors are desired, then it re-evaluates non-silently</span>
    <span class="comment">// to induce the error message.</span>
    <a href="IMain.scala.html#123392" title="(operation: =&gt; Option[ExprTyper.this.repl.global.Type])Option[ExprTyper.this.repl.global.Type]">beSilentDuring</a><span class="delimiter">(</span><a href="#336553" title="()Option[ExprTyper.this.repl.global.Type]">evaluate</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(alternative: =&gt; Option[ExprTyper.this.repl.global.Type])Option[ExprTyper.this.repl.global.Type]">orElse</span> <a href="IMain.scala.html#123392" title="(operation: =&gt; Option[ExprTyper.this.repl.global.Type])Option[ExprTyper.this.repl.global.Type]">beSilentDuring</a><span class="delimiter">(</span><a href="#336350" title="(code: String)Option[ExprTyper.this.repl.global.Type]">typeOfDeclaration</a><span class="delimiter">(</span><a href="#336546" title="String">expr</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(alternative: =&gt; Option[ExprTyper.this.repl.global.Type])Option[ExprTyper.this.repl.global.Type]">orElse</span> <span class="delimiter">{</span>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#336549" title="Boolean">silent</a><span class="delimiter">)</span>
        <a href="#336553" title="()Option[ExprTyper.this.repl.global.Type]">evaluate</a><span class="delimiter">(</span><span class="delimiter">)</span>
      
      <span title="object None">None</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  <span class="comment">// Since people will be giving us &quot;:t def foo = 5&quot; even though that is not an</span>
  <span class="comment">// expression, we have a means of typing declarations too.</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(code: String)Option[ExprTyper.this.repl.global.Type]" id="336350">typeOfDeclaration</a><span class="delimiter">(</span><a title="String" id="337616">code</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[ExprTyper.this.repl.global.Type]">Option</span><span class="delimiter">[</span>Type<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="ReplConfig.scala.html#31875" title="(msg: =&gt; String)Unit">repltrace</a><span class="delimiter">(</span><span title="java.lang.String(&quot;typeOfDeclaration(&quot;)" class="string">&quot;typeOfDeclaration(&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#337616" title="String">code</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;)&quot;)" class="string">&quot;)&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="String" id="337631">obname</a> = <a href="Naming.scala.html#336164" title="()String">freshInternalVarName</a><span class="delimiter">(</span><span class="delimiter">)</span>
    
    <a href="IMain.scala.html#123452" title="(line: String, synthetic: Boolean)scala.tools.nsc.interpreter.package.IR.Result">interpret</a><span class="delimiter">(</span><span title="java.lang.String(&quot;object &quot;)" class="string">&quot;object &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#337631" title="String">obname</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; {\012&quot;)" class="string">&quot; {\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#337616" title="String">code</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012}\012&quot;)" class="string">&quot;\n}\n&quot;</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <span title="Option[ExprTyper.this.repl.global.Type]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="package.scala.html#31891" title="Option[ExprTyper.this.repl.global.Type]">IR</a>.<a href="Results.scala.html#337574" title="object scala.tools.nsc.interpreter.package.IR.Success">Success</a> =&gt;
        <span class="keyword">val</span> <a title="ExprTyper.this.repl.global.Symbol" id="337634">sym</a> = <a href="IMain.scala.html#123478" title="(id: String)ExprTyper.this.repl.global.Symbol">symbolOfTerm</a><span class="delimiter">(</span><a href="#337631" title="String">obname</a><span class="delimiter">)</span>
        <span title="Option[ExprTyper.this.repl.global.Type]" class="keyword">if</span> <span class="delimiter">(</span><a href="#337634" title="ExprTyper.this.repl.global.Symbol">sym</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../symtab/Symbols.scala.html#67339" title="object ExprTyper.this.repl.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <span title="object None">None</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="comment">// TODO: bitmap$n is not marked synthetic.</span>
          <span class="keyword">val</span> <a title="List[ExprTyper.this.repl.global.Symbol]" id="337641">decls</a> = <a href="#337634" title="ExprTyper.this.repl.global.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107562" title="=&gt; ExprTyper.this.repl.global.Type">tpe</a>.<a href="../symtab/Types.scala.html#105487" title="=&gt; ExprTyper.this.repl.global.Scope">decls</a>.<a href="../symtab/Scopes.scala.html#113097" title="=&gt; List[ExprTyper.this.repl.global.Symbol]">toList</a> <span title="(p: ExprTyper.this.repl.global.Symbol =&gt; Boolean)List[ExprTyper.this.repl.global.Symbol]">filterNot</span> <span class="delimiter">(</span><a title="ExprTyper.this.repl.global.Symbol" id="337662">x</a> =&gt; <a href="#337662" title="ExprTyper.this.repl.global.Symbol">x</a>.<a href="../symtab/Symbols.scala.html#107475" title="=&gt; Boolean">isConstructor</a> <span title="(x: Boolean)Boolean">||</span> <a href="#337662" title="ExprTyper.this.repl.global.Symbol">x</a>.<span title="=&gt; Boolean">isPrivate</span> <span title="(x: Boolean)Boolean">||</span> <span class="delimiter">(</span><a href="#337662" title="ExprTyper.this.repl.global.Symbol">x</a>.<a href="../symtab/Symbols.scala.html#107548" title="=&gt; ExprTyper.this.repl.global.Name">name</a>.<a href="../symtab/Names.scala.html#96604" title="()String">toString</a> <span title="(x$1: java.lang.CharSequence)Boolean">contains</span> <span title="java.lang.String(&quot;$&quot;)" class="string">&quot;$&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="ReplConfig.scala.html#31875" title="(msg: =&gt; String)Unit">repltrace</a><span class="delimiter">(</span><span title="java.lang.String(&quot;decls: &quot;)" class="string">&quot;decls: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#337641" title="List[ExprTyper.this.repl.global.Symbol]">decls</a><span class="delimiter">)</span>
          <a href="#337641" title="List[ExprTyper.this.repl.global.Symbol]">decls</a>.<span title="=&gt; Option[ExprTyper.this.repl.global.Symbol]">lastOption</span> <span title="(f: ExprTyper.this.repl.global.Symbol =&gt; ExprTyper.this.repl.global.Type)Option[ExprTyper.this.repl.global.Type]">map</span> <span class="delimiter">(</span><a title="ExprTyper.this.repl.global.Symbol" id="337667">decl</a> =&gt; <a href="IMain.scala.html#123450" title="(sym: ExprTyper.this.repl.global.Symbol, memberName: ExprTyper.this.repl.global.Name)ExprTyper.this.repl.global.Type">typeCleanser</a><span class="delimiter">(</span><a href="#337634" title="ExprTyper.this.repl.global.Symbol">sym</a>, <a href="#337667" title="ExprTyper.this.repl.global.Symbol">decl</a>.<a href="../symtab/Symbols.scala.html#107548" title="=&gt; ExprTyper.this.repl.global.Name">name</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="None.type">_</span>          =&gt;
        <span title="object None">None</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>    
  <span class="comment">// def compileAndTypeExpr(expr: String): Option[Typer] = {</span>
  <span class="comment">//   class TyperRun extends Run {</span>
  <span class="comment">//     override def stopPhase(name: String) = name == &quot;superaccessors&quot;</span>
  <span class="comment">//   }</span>
  <span class="comment">// }</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
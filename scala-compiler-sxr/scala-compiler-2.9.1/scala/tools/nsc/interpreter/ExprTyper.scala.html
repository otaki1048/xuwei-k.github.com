<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/interpreter/ExprTyper.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* NSC -- new Scala compiler
 * Copyright 2005-2011 LAMP/EPFL
 * @author  Paul Phillips
 */</span>

<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> interpreter

<span class="keyword">import</span> util.BatchSourceFile
<span class="keyword">import</span> ast.parser.<a href="../ast/parser/Tokens.scala.html#12661" title="object scala.tools.nsc.ast.parser.Tokens">Tokens</a>.EOF

<span class="keyword">trait</span> <a title="trait ExprTyper extends java.lang.Object with ScalaObject" id="19023">ExprTyper</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">val</span> <a title="=&gt; scala.tools.nsc.interpreter.IMain" id="336275">repl</a>: <a href="IMain.scala.html#19857" title="scala.tools.nsc.interpreter.IMain">IMain</a>
  <span class="keyword">import</span> <a href="#336275" title="=&gt; scala.tools.nsc.interpreter.IMain">repl</a>._
  <span class="keyword">import</span> <a href="IMain.scala.html#123193" title="=&gt; scala.tools.nsc.Global">global</a>.<span class="delimiter">{</span> reporter =&gt; _, _ <span class="delimiter">}</span>
  <span class="keyword">import</span> <a href="../Global.scala.html#64898" title="object ExprTyper.this.repl.global.syntaxAnalyzer">syntaxAnalyzer</a>.UnitParser
  <span class="keyword">import</span> <a href="IMain.scala.html#123199" title="object ExprTyper.this.repl.naming">naming</a>.freshInternalVarName
  
  <span class="keyword">object</span> <a title="object ExprTyper.this.codeParser" id="336280">codeParser</a> <span title="ScalaObject" class="keyword">extends</span> <span class="delimiter">{</span> <span class="keyword">val</span> <a title="ExprTyper.this.repl.global.type" id="336309">global</a>: repl.global.<span class="keyword">type</span> = <a href="#336275" title="=&gt; scala.tools.nsc.interpreter.IMain">repl</a>.<a href="IMain.scala.html#123193" title="=&gt; scala.tools.nsc.Global">global</a> <span class="delimiter">}</span> <span class="keyword">with</span> <a href="CodeHandlers.scala.html#18585" title="scala.tools.nsc.interpreter.CodeHandlers[ExprTyper.this.repl.global.Tree]">CodeHandlers</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="[T](code: String, rule: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; T)T" id="336296">applyRule</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="336298">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="String" id="336310">code</a>: <span title="String">String</span>, <a title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; T" id="336311">rule</a>: UnitParser =&gt; T<span class="delimiter">)</span>: <a href="#336298" title="T">T</a> = <span class="delimiter">{</span>
      <a href="IMain.scala.html#123167" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/AbstractReporter.scala.html#72219" title="()Unit">reset</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="ExprTyper.this.repl.global.CompilationUnit" id="336315">unit</a>    = <span title="ExprTyper.this.repl.global.CompilationUnit" class="keyword">new</span> <a href="../CompilationUnits.scala.html#67942" title="ExprTyper.this.repl.global.CompilationUnit">CompilationUnit</a><span class="delimiter">(</span><a href="../util/SourceFile.scala.html#96524" title="(sourceName: String, cs: Seq[Char])scala.tools.nsc.util.BatchSourceFile" class="keyword">new</a> <a href="../util/SourceFile.scala.html#30812" title="scala.tools.nsc.util.BatchSourceFile">BatchSourceFile</a><span class="delimiter">(</span><span title="java.lang.String(&quot;&lt;console&gt;&quot;)" class="string">&quot;&lt;console&gt;&quot;</span>, <a href="#336310" title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString">code</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser" id="336316">scanner</a> = <a href="../ast/parser/Parsers.scala.html#171666" title="(unit: ExprTyper.this.repl.global.syntaxAnalyzer.global.CompilationUnit)ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser" class="keyword">new</a> <a href="../ast/parser/Parsers.scala.html#96001" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">UnitParser</a><span class="delimiter">(</span><a href="#336315" title="ExprTyper.this.repl.global.CompilationUnit">unit</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="T" id="336317">result</a>  = <a href="#336311" title="(v1: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser)T">rule</a><span class="delimiter">(</span><a href="#336316" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">scanner</a><span class="delimiter">)</span>
      <span title="AnyVal" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="IMain.scala.html#123167" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#67993" title="=&gt; Boolean">hasErrors</a><span class="delimiter">)</span>
        <a href="#336316" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">scanner</a>.<a href="../ast/parser/Parsers.scala.html#169069" title="(token: Int)Int">accept</a><span class="delimiter">(</span><span title="Int(0)">EOF</span><span class="delimiter">)</span>
      
      <a href="#336317" title="T">result</a>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(code: String)Nothing" id="336299">decl</a><span class="delimiter">(</span><a title="String" id="336355">code</a>: <span title="String">String</span><span class="delimiter">)</span>  = <a href="CodeHandlers.scala.html#18586" title="object scala.tools.nsc.interpreter.CodeHandlers">CodeHandlers</a>.<a href="CodeHandlers.scala.html#332479" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="java.lang.String(&quot;todo&quot;)" class="string">&quot;todo&quot;</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)Nothing" id="336300">defn</a><span class="delimiter">(</span><a title="String" id="336358">code</a>: <span title="String">String</span><span class="delimiter">)</span>  = <a href="CodeHandlers.scala.html#18586" title="object scala.tools.nsc.interpreter.CodeHandlers">CodeHandlers</a>.<a href="CodeHandlers.scala.html#332479" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="java.lang.String(&quot;todo&quot;)" class="string">&quot;todo&quot;</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree" id="336301">expr</a><span class="delimiter">(</span><a title="String" id="336361">code</a>: <span title="String">String</span><span class="delimiter">)</span>  = <a href="#336296" title="(code: String, rule: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree)ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">applyRule</a><span class="delimiter">(</span><a href="#336361" title="String">code</a>, <a href="#336368" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">_</a>.<a href="../ast/parser/Parsers.scala.html#169157" title="()ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">expr</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree" id="336302">impt</a><span class="delimiter">(</span><a title="String" id="336376">code</a>: <span title="String">String</span><span class="delimiter">)</span>  = <a href="#336296" title="(code: String, rule: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree)ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">applyRule</a><span class="delimiter">(</span><a href="#336376" title="String">code</a>, <a href="#336383" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">_</a>.<a href="../ast/parser/Parsers.scala.html#169212" title="()ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">importExpr</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]" id="336303">impts</a><span class="delimiter">(</span><a title="String" id="336386">code</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#336296" title="(code: String, rule: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree])List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">applyRule</a><span class="delimiter">(</span><a href="#336386" title="String">code</a>, <a href="#336393" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">_</a>.<a href="../ast/parser/Parsers.scala.html#169211" title="()List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">importClause</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]" id="336304">stmts</a><span class="delimiter">(</span><a title="String" id="336396">code</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#336296" title="(code: String, rule: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree])List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">applyRule</a><span class="delimiter">(</span><a href="#336396" title="String">code</a>, <a href="#336412" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">_</a>.<a href="../ast/parser/Parsers.scala.html#169240" title="(isPre: Boolean)(ExprTyper.this.repl.global.syntaxAnalyzer.global.ValDef, List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree])">templateStatSeq</a><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>.<span title="=&gt; List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">_2</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)ExprTyper.this.repl.global.Tree" id="336305">stmt</a><span class="delimiter">(</span><a title="String" id="336416">code</a>: <span title="String">String</span><span class="delimiter">)</span>  = <a href="#336304" title="(code: String)List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">stmts</a><span class="delimiter">(</span><a href="#336416" title="String">code</a><span class="delimiter">)</span> <span title="ExprTyper.this.repl.global.Tree" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#336420" title="ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">List</a><span class="delimiter">(</span><a title="ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree" id="336442">t</a><span class="delimiter">)</span>  =&gt; <a href="#336442" title="ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">t</a>
      <span class="keyword">case</span> <a title="Nothing" id="336443">xs</a>       =&gt; <a href="CodeHandlers.scala.html#18586" title="object scala.tools.nsc.interpreter.CodeHandlers">CodeHandlers</a>.<a href="CodeHandlers.scala.html#332479" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Not a single statement: &quot;)" class="string">&quot;Not a single statement: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#336443" title="List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">xs</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  <span class="comment">/** Parse a line into a sequence of trees. Returns None if the input is incomplete. */</span>
  <span class="keyword">def</span> <a title="(line: String)Option[List[ExprTyper.this.repl.global.Tree]]" id="336282">parse</a><span class="delimiter">(</span><a title="String" id="336446">line</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[List[ExprTyper.this.repl.global.Tree]]">Option</span><span class="delimiter">[</span>List<span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Boolean" id="336448">isIncomplete</a> = <span title="Boolean(false)" class="keyword">false</span>
    <a href="IMain.scala.html#123167" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#67987" title="(handler: (scala.tools.nsc.util.Position, String) =&gt; Unit)(thunk: =&gt; Option[List[ExprTyper.this.repl.global.Tree]])Option[List[ExprTyper.this.repl.global.Tree]]">withIncompleteHandler</a><span class="delimiter">(</span><span class="delimiter">(</span><a title="scala.tools.nsc.util.Position" id="336460">_</a>, <a title="String" id="336461">_</a><span class="delimiter">)</span> =&gt; <a href="#336448" title="Boolean">isIncomplete</a> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]" id="336463">trees</a> = <a href="#336280" title="object ExprTyper.this.codeParser">codeParser</a>.<a href="#336304" title="(code: String)List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">stmts</a><span class="delimiter">(</span><a href="#336446" title="String">line</a><span class="delimiter">)</span>
      <span title="Option[List[ExprTyper.this.repl.global.Tree]]" class="keyword">if</span> <span class="delimiter">(</span><a href="IMain.scala.html#123167" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#67993" title="=&gt; Boolean">hasErrors</a><span class="delimiter">)</span> <span title="(x: scala.collection.immutable.Nil.type)Some[scala.collection.immutable.Nil.type]">Some</span><span class="delimiter">(</span><span title="object Nil">Nil</span><span class="delimiter">)</span>
      <span class="keyword">else</span> <span title="Option[List[ExprTyper.this.repl.global.Tree]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#336448" title="Boolean">isIncomplete</a><span class="delimiter">)</span> <span title="object None">None</span>
      <span class="keyword">else</span> <span title="(x: List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree])Some[List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]]">Some</span><span class="delimiter">(</span><a href="#336463" title="List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">trees</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  
  <span class="comment">// TODO: integrate these into a CodeHandler[Type].</span>
  
  <span class="comment">// XXX literals.</span>
  <span class="comment">// 1) Identifiers defined in the repl.</span>
  <span class="comment">// 2) A path loadable via getModule.</span>
  <span class="comment">// 3) Try interpreting it as an expression.</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="336284">typeOfExpressionDepth</a> = <span title="Int(0)" class="int">0</span>
  <span class="keyword">def</span> <a title="(expr: String, silent: Boolean)Option[ExprTyper.this.repl.global.Type]" id="336286">typeOfExpression</a><span class="delimiter">(</span><a title="String" id="336483">expr</a>: <span title="String">String</span>, <a title="Boolean" id="336486">silent</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>: <span title="Option[ExprTyper.this.repl.global.Type]">Option</span><span class="delimiter">[</span>Type<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="ReplConfig.scala.html#31886" title="(msg: =&gt; String)Unit">repltrace</a><span class="delimiter">(</span><span title="java.lang.String(&quot;typeOfExpression(&quot;)" class="string">&quot;typeOfExpression(&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#336483" title="String">expr</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;)&quot;)" class="string">&quot;)&quot;</span><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#336284" title="=&gt; Int">typeOfExpressionDepth</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="ReplConfig.scala.html#31885" title="(msg: =&gt; String)Unit">repldbg</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Terminating typeOfExpression recursion for expression: &quot;)" class="string">&quot;Terminating typeOfExpression recursion for expression: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#336483" title="String">expr</a><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <span title="object None">None</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="=&gt; Option[ExprTyper.this.repl.global.Type]" id="336487">asQualifiedImport</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="String" id="336513">name</a> = <a href="#336483" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">expr</a>.<span title="(p: Char =&gt; Boolean)String">takeWhile</span><span class="delimiter">(</span><a href="#336763" title="Char">_</a> <span title="(x: Char)Boolean">!=</span> <span title="Char(\'.\')" class="char">'.'</span><span class="delimiter">)</span>
      <a href="Imports.scala.html#123144" title="(name: String)Option[ExprTyper.this.repl.global.TermSymbol]">importedTermNamed</a><span class="delimiter">(</span><a href="#336513" title="String">name</a><span class="delimiter">)</span> <span title="(f: ExprTyper.this.repl.global.TermSymbol =&gt; Option[ExprTyper.this.repl.global.Type])Option[ExprTyper.this.repl.global.Type]">flatMap</span> <span class="delimiter">{</span> <a title="ExprTyper.this.repl.global.TermSymbol" id="337336">sym</a> =&gt;
        <a href="#336286" title="(expr: String, silent: Boolean)Option[ExprTyper.this.repl.global.Type]">typeOfExpression</a><span class="delimiter">(</span><a href="#337336" title="ExprTyper.this.repl.global.TermSymbol">sym</a>.<span title="=&gt; String">fullName</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#336483" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">expr</a>.<span title="(n: Int)String">drop</span><span class="delimiter">(</span><a href="#336513" title="String">name</a>.<span title="()Int">length</span><span class="delimiter">)</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="=&gt; Option[ExprTyper.this.repl.global.Type]" id="336488">asModule</a> = <a href="IMain.scala.html#123295" title="(name: String)Option[ExprTyper.this.repl.global.Symbol]">safeModule</a><span class="delimiter">(</span><a href="#336483" title="String">expr</a><span class="delimiter">)</span> <span title="(f: ExprTyper.this.repl.global.Symbol =&gt; ExprTyper.this.repl.global.Type)Option[ExprTyper.this.repl.global.Type]">map</span> <span class="delimiter">(</span><a href="#337464" title="ExprTyper.this.repl.global.Symbol">_</a>.<a href="../symtab/Symbols.scala.html#107421" title="=&gt; ExprTyper.this.repl.global.Type">tpe</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="=&gt; Option[ExprTyper.this.repl.global.Type]" id="336489">asExpr</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="String" id="337466">lhs</a> = <a href="Naming.scala.html#336101" title="()String">freshInternalVarName</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.lang.String" id="337467">line</a> = <span title="java.lang.String(&quot;lazy val &quot;)" class="string">&quot;lazy val &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#337466" title="String">lhs</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; =\012&quot;)" class="string">&quot; =\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#336483" title="String">expr</a>

      <a href="IMain.scala.html#123274" title="(line: String, synthetic: Boolean)scala.tools.nsc.interpreter.package.IR.Result">interpret</a><span class="delimiter">(</span><a href="#337467" title="java.lang.String">line</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <span title="Option[ExprTyper.this.repl.global.Type]" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="package.scala.html#31902" title="Option[ExprTyper.this.repl.global.Type]">IR</a>.<a href="Results.scala.html#337511" title="object scala.tools.nsc.interpreter.package.IR.Success">Success</a> =&gt; <a href="#336286" title="(expr: String, silent: Boolean)Option[ExprTyper.this.repl.global.Type]">typeOfExpression</a><span class="delimiter">(</span><a href="#337466" title="String">lhs</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="None.type">_</span>          =&gt; <span title="object None">None</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="()Option[ExprTyper.this.repl.global.Type]" id="336490">evaluate</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="#336284" title="(x$1: Int)Unit">typeOfExpressionDepth</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
      <span class="keyword">try</span> <a href="IMain.scala.html#123299" title="(id: String)Option[ExprTyper.this.repl.global.Type]">typeOfTerm</a><span class="delimiter">(</span><a href="#336483" title="String">expr</a><span class="delimiter">)</span> <span title="(alternative: =&gt; Option[ExprTyper.this.repl.global.Type])Option[ExprTyper.this.repl.global.Type]">orElse</span> <a href="#336488" title="=&gt; Option[ExprTyper.this.repl.global.Type]">asModule</a> <span title="(alternative: =&gt; Option[ExprTyper.this.repl.global.Type])Option[ExprTyper.this.repl.global.Type]">orElse</span> <a href="#336489" title="=&gt; Option[ExprTyper.this.repl.global.Type]">asExpr</a> <span title="(alternative: =&gt; Option[ExprTyper.this.repl.global.Type])Option[ExprTyper.this.repl.global.Type]">orElse</span> <a href="#336487" title="=&gt; Option[ExprTyper.this.repl.global.Type]">asQualifiedImport</a>
      <span class="keyword">finally</span> <a href="#336284" title="(x$1: Int)Unit">typeOfExpressionDepth</a> <span title="(x: Int)Int">-=</span> <span title="Int(1)" class="int">1</span>
    <span class="delimiter">}</span>
    
    <span class="comment">// Don't presently have a good way to suppress undesirable success output</span>
    <span class="comment">// while letting errors through, so it is first trying it silently: if there</span>
    <span class="comment">// is an error, and errors are desired, then it re-evaluates non-silently</span>
    <span class="comment">// to induce the error message.</span>
    <a href="IMain.scala.html#123214" title="(operation: =&gt; Option[ExprTyper.this.repl.global.Type])Option[ExprTyper.this.repl.global.Type]">beSilentDuring</a><span class="delimiter">(</span><a href="#336490" title="()Option[ExprTyper.this.repl.global.Type]">evaluate</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(alternative: =&gt; Option[ExprTyper.this.repl.global.Type])Option[ExprTyper.this.repl.global.Type]">orElse</span> <a href="IMain.scala.html#123214" title="(operation: =&gt; Option[ExprTyper.this.repl.global.Type])Option[ExprTyper.this.repl.global.Type]">beSilentDuring</a><span class="delimiter">(</span><a href="#336287" title="(code: String)Option[ExprTyper.this.repl.global.Type]">typeOfDeclaration</a><span class="delimiter">(</span><a href="#336483" title="String">expr</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(alternative: =&gt; Option[ExprTyper.this.repl.global.Type])Option[ExprTyper.this.repl.global.Type]">orElse</span> <span class="delimiter">{</span>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#336486" title="Boolean">silent</a><span class="delimiter">)</span>
        <a href="#336490" title="()Option[ExprTyper.this.repl.global.Type]">evaluate</a><span class="delimiter">(</span><span class="delimiter">)</span>
      
      <span title="object None">None</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  <span class="comment">// Since people will be giving us &quot;:t def foo = 5&quot; even though that is not an</span>
  <span class="comment">// expression, we have a means of typing declarations too.</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(code: String)Option[ExprTyper.this.repl.global.Type]" id="336287">typeOfDeclaration</a><span class="delimiter">(</span><a title="String" id="337553">code</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[ExprTyper.this.repl.global.Type]">Option</span><span class="delimiter">[</span>Type<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="ReplConfig.scala.html#31886" title="(msg: =&gt; String)Unit">repltrace</a><span class="delimiter">(</span><span title="java.lang.String(&quot;typeOfDeclaration(&quot;)" class="string">&quot;typeOfDeclaration(&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#337553" title="String">code</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;)&quot;)" class="string">&quot;)&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="String" id="337568">obname</a> = <a href="Naming.scala.html#336101" title="()String">freshInternalVarName</a><span class="delimiter">(</span><span class="delimiter">)</span>
    
    <a href="IMain.scala.html#123274" title="(line: String, synthetic: Boolean)scala.tools.nsc.interpreter.package.IR.Result">interpret</a><span class="delimiter">(</span><span title="java.lang.String(&quot;object &quot;)" class="string">&quot;object &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#337568" title="String">obname</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; {\012&quot;)" class="string">&quot; {\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#337553" title="String">code</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012}\012&quot;)" class="string">&quot;\n}\n&quot;</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <span title="Option[ExprTyper.this.repl.global.Type]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="package.scala.html#31902" title="Option[ExprTyper.this.repl.global.Type]">IR</a>.<a href="Results.scala.html#337511" title="object scala.tools.nsc.interpreter.package.IR.Success">Success</a> =&gt;
        <span class="keyword">val</span> <a title="ExprTyper.this.repl.global.Symbol" id="337571">sym</a> = <a href="IMain.scala.html#123300" title="(id: String)ExprTyper.this.repl.global.Symbol">symbolOfTerm</a><span class="delimiter">(</span><a href="#337568" title="String">obname</a><span class="delimiter">)</span>
        <span title="Option[ExprTyper.this.repl.global.Type]" class="keyword">if</span> <span class="delimiter">(</span><a href="#337571" title="ExprTyper.this.repl.global.Symbol">sym</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../symtab/Symbols.scala.html#67328" title="object ExprTyper.this.repl.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <span title="object None">None</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="comment">// TODO: bitmap$n is not marked synthetic.</span>
          <span class="keyword">val</span> <a title="List[ExprTyper.this.repl.global.Symbol]" id="337578">decls</a> = <a href="#337571" title="ExprTyper.this.repl.global.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#107421" title="=&gt; ExprTyper.this.repl.global.Type">tpe</a>.<a href="../symtab/Types.scala.html#105346" title="=&gt; ExprTyper.this.repl.global.Scope">decls</a>.<a href="../symtab/Scopes.scala.html#112957" title="=&gt; List[ExprTyper.this.repl.global.Symbol]">toList</a> <span title="(p: ExprTyper.this.repl.global.Symbol =&gt; Boolean)List[ExprTyper.this.repl.global.Symbol]">filterNot</span> <span class="delimiter">(</span><a title="ExprTyper.this.repl.global.Symbol" id="337599">x</a> =&gt; <a href="#337599" title="ExprTyper.this.repl.global.Symbol">x</a>.<a href="../symtab/Symbols.scala.html#107334" title="=&gt; Boolean">isConstructor</a> <span title="(x: Boolean)Boolean">||</span> <a href="#337599" title="ExprTyper.this.repl.global.Symbol">x</a>.<span title="=&gt; Boolean">isPrivate</span> <span title="(x: Boolean)Boolean">||</span> <span class="delimiter">(</span><a href="#337599" title="ExprTyper.this.repl.global.Symbol">x</a>.<a href="../symtab/Symbols.scala.html#107407" title="=&gt; ExprTyper.this.repl.global.Name">name</a>.<a href="../symtab/Names.scala.html#96583" title="()String">toString</a> <span title="(x$1: java.lang.CharSequence)Boolean">contains</span> <span title="java.lang.String(&quot;$&quot;)" class="string">&quot;$&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="ReplConfig.scala.html#31886" title="(msg: =&gt; String)Unit">repltrace</a><span class="delimiter">(</span><span title="java.lang.String(&quot;decls: &quot;)" class="string">&quot;decls: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#337578" title="List[ExprTyper.this.repl.global.Symbol]">decls</a><span class="delimiter">)</span>
          <a href="#337578" title="List[ExprTyper.this.repl.global.Symbol]">decls</a>.<span title="=&gt; Option[ExprTyper.this.repl.global.Symbol]">lastOption</span> <span title="(f: ExprTyper.this.repl.global.Symbol =&gt; ExprTyper.this.repl.global.Type)Option[ExprTyper.this.repl.global.Type]">map</span> <span class="delimiter">(</span><a title="ExprTyper.this.repl.global.Symbol" id="337604">decl</a> =&gt; <a href="IMain.scala.html#123272" title="(sym: ExprTyper.this.repl.global.Symbol, memberName: ExprTyper.this.repl.global.Name)ExprTyper.this.repl.global.Type">typeCleanser</a><span class="delimiter">(</span><a href="#337571" title="ExprTyper.this.repl.global.Symbol">sym</a>, <a href="#337604" title="ExprTyper.this.repl.global.Symbol">decl</a>.<a href="../symtab/Symbols.scala.html#107407" title="=&gt; ExprTyper.this.repl.global.Name">name</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="None.type">_</span>          =&gt;
        <span title="object None">None</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>    
  <span class="comment">// def compileAndTypeExpr(expr: String): Option[Typer] = {</span>
  <span class="comment">//   class TyperRun extends Run {</span>
  <span class="comment">//     override def stopPhase(name: String) = name == &quot;superaccessors&quot;</span>
  <span class="comment">//   }</span>
  <span class="comment">// }</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
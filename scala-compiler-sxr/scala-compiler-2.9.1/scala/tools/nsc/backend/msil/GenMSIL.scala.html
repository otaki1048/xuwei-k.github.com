<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/backend/msil/GenMSIL.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* NSC -- new scala compiler
 * Copyright 2005-2011 LAMP/EPFL
 * @author Nikolay Mihaylov
 */</span>


<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> backend.msil

<span class="keyword">import</span> java.io.<span class="delimiter">{</span>File, IOException<span class="delimiter">}</span>
<span class="keyword">import</span> java.nio.<span class="delimiter">{</span>ByteBuffer, ByteOrder<span class="delimiter">}</span>

<span class="keyword">import</span> scala.collection.mutable.<span class="delimiter">{</span>Map, HashMap, HashSet, Stack, ListBuffer<span class="delimiter">}</span>
<span class="keyword">import</span> scala.tools.nsc.symtab._

<span class="keyword">import</span> ch.epfl.lamp.compiler.msil.<span class="delimiter">{</span>Type =&gt; MsilType, _<span class="delimiter">}</span>
<span class="keyword">import</span> ch.epfl.lamp.compiler.msil.emit._
<span class="keyword">import</span> ch.epfl.lamp.compiler.msil.util.PECustomMod

<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class GenMSIL extends scala.tools.nsc.SubComponent with ScalaObject" id="15494">GenMSIL</a> <a href="#15494" title="ScalaObject" class="keyword">extends</a> <a href="../../SubComponent.scala.html#10961" title="scala.tools.nsc.SubComponent">SubComponent</a> <span class="delimiter">{</span>
  <span class="keyword">import</span> <a href="../../SubComponent.scala.html#95939" title="=&gt; scala.tools.nsc.Global">global</a>._
  <span class="keyword">import</span> <a href="../../Global.scala.html#64893" title="=&gt; scala.tools.nsc.symtab.SymbolLoaders{val global: GenMSIL.this.global.type}">loaders</a>.clrTypes
  <span class="keyword">import</span> <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<span class="delimiter">{</span>types, constructors, methods, fields<span class="delimiter">}</span>
  <span class="keyword">import</span> <a href="../../Global.scala.html#64847" title="object GenMSIL.this.global.icodes">icodes</a>._
  <span class="keyword">import</span> <a href="../../Global.scala.html#64847" title="object GenMSIL.this.global.icodes">icodes</a>.<a href="../icode/Opcodes.scala.html#96996" title="object GenMSIL.this.global.icodes.opcodes">opcodes</a>._

  <span class="comment">/** Create a new phase */</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(p: scala.tools.nsc.Phase)GenMSIL.this.MsilPhase" id="195820">newPhase</a><span class="delimiter">(</span><a title="scala.tools.nsc.Phase" id="242101">p</a>: <a href="../../Phase.scala.html#10619" title="scala.tools.nsc.Phase">Phase</a><span class="delimiter">)</span> = <span title="GenMSIL.this.MsilPhase" class="keyword">new</span> <a href="#195823" title="GenMSIL.this.MsilPhase">MsilPhase</a><span class="delimiter">(</span><a href="#242101" title="scala.tools.nsc.Phase">p</a><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="java.lang.String" id="195821">phaseName</a> = <span title="java.lang.String(&quot;msil&quot;)" class="string">&quot;msil&quot;</span>
  <span class="comment">/** MSIL code generation phase
   */</span>
  <span class="keyword">class</span> <a title="class MsilPhase extends GenMSIL.this.global.GlobalPhase with ScalaObject" id="195823">MsilPhase</a><a href="#195823" title="ScalaObject" class="delimiter">(</a><a title="scala.tools.nsc.Phase" id="242112">prev</a>: <a href="../../Phase.scala.html#10619" title="scala.tools.nsc.Phase">Phase</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../Global.scala.html#64902" title="GenMSIL.this.global.GlobalPhase">GlobalPhase</a><span class="delimiter">(</span><a href="#242112" title="scala.tools.nsc.Phase">prev</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="=&gt; java.lang.String" id="242107">name</a> = <a href="#195821" title="=&gt; java.lang.String">phaseName</a>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Long" id="242108">newFlags</a> = <a href="../../SubComponent.scala.html#95948" title="=&gt; Long">phaseNewFlags</a>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Boolean" id="242109">erasedTypes</a> = <span title="Boolean(true)" class="keyword">true</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="242110">run</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36747" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; Boolean">value</a><span class="delimiter">)</span> <a href="../../Global.scala.html#64873" title="(msg: String)Unit">inform</a><span class="delimiter">(</span><span title="java.lang.String(&quot;[running phase &quot;)" class="string">&quot;[running phase &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#242107" title="=&gt; java.lang.String">name</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; on icode]&quot;)" class="string">&quot; on icode]&quot;</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="GenMSIL.this.BytecodeGenerator" id="242125">codeGenerator</a> = <span title="GenMSIL.this.BytecodeGenerator" class="keyword">new</span> <a href="#195824" title="GenMSIL.this.BytecodeGenerator">BytecodeGenerator</a>

      <span class="comment">//classes is ICodes.classes, a HashMap[Symbol, IClass]</span>
      <a href="../icode/ICodes.scala.html#96940" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.global.Symbol,GenMSIL.this.global.icodes.IClass]">classes</a>.<span title="=&gt; Iterable[GenMSIL.this.global.icodes.IClass]">values</span> <span title="(f: GenMSIL.this.global.icodes.IClass =&gt; Unit)Unit">foreach</span> <a href="#242125" title="GenMSIL.this.BytecodeGenerator">codeGenerator</a>.<a href="#242292" title="(cls: GenMSIL.this.global.icodes.IClass)Unit">findEntryPoint</a>
      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span> <a href="../../Global.scala.html#64888" title="object GenMSIL.this.global.opt">opt</a>.<a href="../../Global.scala.html#97508" title="=&gt; Option[GenMSIL.this.global.Name]">showClass</a>.<span title="=&gt; Boolean">isDefined</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span class="delimiter">(</span><a href="#242125" title="GenMSIL.this.BytecodeGenerator">codeGenerator</a>.<a href="#242286" title="=&gt; GenMSIL.this.global.Symbol">entryPoint</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">)</span> <span class="delimiter">{</span> <span class="comment">// TODO introduce dedicated setting instead</span>
        <span class="keyword">val</span> <a title="String" id="242374">entryclass</a> = <a href="../../Global.scala.html#64888" title="object GenMSIL.this.global.opt">opt</a>.<a href="../../Global.scala.html#97508" title="=&gt; Option[GenMSIL.this.global.Name]">showClass</a>.<span title="=&gt; GenMSIL.this.global.Name">get</span>.<a href="../../symtab/Names.scala.html#96604" title="()String">toString</a> 
        <a href="../../Global.scala.html#64874" title="(msg: String)Unit">warning</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Couldn\'t find entry class &quot;)" class="string">&quot;Couldn't find entry class &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#242374" title="String">entryclass</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="#242125" title="GenMSIL.this.BytecodeGenerator">codeGenerator</a>.<a href="#242228" title="()Unit">initAssembly</a>

      <span class="keyword">val</span> <a title="List[GenMSIL.this.global.icodes.IClass]" id="242126">classesSorted</a> = <a href="../icode/ICodes.scala.html#96940" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.global.Symbol,GenMSIL.this.global.icodes.IClass]">classes</a>.<span title="=&gt; Iterable[GenMSIL.this.global.icodes.IClass]">values</span>.<span title="=&gt; List[GenMSIL.this.global.icodes.IClass]">toList</span>.<span title="(f: GenMSIL.this.global.icodes.IClass =&gt; Int)(implicit ord: scala.math.Ordering[Int])List[GenMSIL.this.global.icodes.IClass]">sortBy</span><span title="object scala.math.Ordering.Int" class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IClass" id="242384">c</a> =&gt; <a href="#242384" title="GenMSIL.this.global.icodes.IClass">c</a>.<a href="../icode/Members.scala.html#97411" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../symtab/Symbols.scala.html#107399" title="=&gt; Int">id</a><span class="delimiter">)</span> <span class="comment">// simplifies comparing cross-compiler vs. .exe output </span>
      <a href="#242126" title="List[GenMSIL.this.global.icodes.IClass]">classesSorted</a> <span title="(f: GenMSIL.this.global.icodes.IClass =&gt; Unit)Unit">foreach</span> <a href="#242125" title="GenMSIL.this.BytecodeGenerator">codeGenerator</a>.<a href="#242299" title="(iclass: GenMSIL.this.global.icodes.IClass)Unit">createTypeBuilder</a>
      <a href="#242126" title="List[GenMSIL.this.global.icodes.IClass]">classesSorted</a> <span title="(f: GenMSIL.this.global.icodes.IClass =&gt; Unit)Unit">foreach</span> <a href="#242125" title="GenMSIL.this.BytecodeGenerator">codeGenerator</a>.<a href="#242300" title="(iclass: GenMSIL.this.global.icodes.IClass)Unit">createClassMembers</a>

      <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="#242126" title="List[GenMSIL.this.global.icodes.IClass]">classesSorted</a> <span title="(f: GenMSIL.this.global.icodes.IClass =&gt; Unit)Unit">foreach</span> <a href="#242125" title="GenMSIL.this.BytecodeGenerator">codeGenerator</a>.<a href="#242235" title="(iclass: GenMSIL.this.global.icodes.IClass)Unit">genClass</a>
      <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
        <a href="#242125" title="GenMSIL.this.BytecodeGenerator">codeGenerator</a>.<a href="#242232" title="()Unit">writeAssembly</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(unit: GenMSIL.this.global.CompilationUnit)Unit" id="242111">apply</a><span class="delimiter">(</span><a title="GenMSIL.this.global.CompilationUnit" id="242498">unit</a>: <a href="../../CompilationUnits.scala.html#67953" title="GenMSIL.this.global.CompilationUnit">CompilationUnit</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../symtab/SymbolTable.scala.html#64790" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="java.lang.String(&quot;MSIL works on icode classes, not on compilation units!&quot;)" class="string">&quot;MSIL works on icode classes, not on compilation units!&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * MSIL bytecode generator.
   *
   */</span>
  <span class="keyword">class</span> <a title="class BytecodeGenerator extends java.lang.Object with ScalaObject" id="195824">BytecodeGenerator</a> <a href="#195824" title="ScalaObject" class="delimiter">{</a>

    <span class="keyword">val</span> <a title="java.lang.String" id="242136">MODULE_INSTANCE_NAME</a> = <span title="java.lang.String(&quot;MODULE$&quot;)" class="string">&quot;MODULE$&quot;</span>

    <span class="keyword">import</span> <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<span class="delimiter">{</span>VOID =&gt; MVOID, BOOLEAN =&gt; MBOOL, BYTE =&gt; MBYTE, SHORT =&gt; MSHORT,
                   CHAR =&gt; MCHAR, INT =&gt; MINT, LONG =&gt; MLONG, FLOAT =&gt; MFLOAT,
                   DOUBLE =&gt; MDOUBLE, OBJECT =&gt; MOBJECT, STRING =&gt; MSTRING,
                   STRING_ARRAY =&gt; MSTRING_ARRAY,
                   SYMTAB_CONSTR =&gt; SYMTAB_ATTRIBUTE_CONSTRUCTOR,
                   SYMTAB_DEFAULT_CONSTR =&gt; SYMTAB_ATTRIBUTE_EMPTY_CONSTRUCTOR<span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="242139">EXCEPTION</a> = <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205492" title="(name: String)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><span title="java.lang.String(&quot;System.Exception&quot;)" class="string">&quot;System.Exception&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="242141">MBYTE_ARRAY</a> = <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205494" title="(elemType: ch.epfl.lamp.compiler.msil.Type)ch.epfl.lamp.compiler.msil.Type">mkArrayType</a><span class="delimiter">(</span><a href="../../symtab/clr/CLRTypes.scala.html#205402" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MBYTE</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="242143">ICLONEABLE</a> = <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205492" title="(name: String)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><span title="java.lang.String(&quot;System.ICloneable&quot;)" class="string">&quot;System.ICloneable&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="242145">MEMBERWISE_CLONE</a> = <a href="../../symtab/clr/CLRTypes.scala.html#205447" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MOBJECT</a>.<span title="(x$1: java.lang.String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="java.lang.String(&quot;MemberwiseClone&quot;)" class="string">&quot;MemberwiseClone&quot;</span>, <span title="object ch.epfl.lamp.compiler.msil.Type">MsilType</span>.<span title="Array[ch.epfl.lamp.compiler.msil.Type]">EmptyTypes</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="242147">MMONITOR</a>       = <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205492" title="(name: String)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><span title="java.lang.String(&quot;System.Threading.Monitor&quot;)" class="string">&quot;System.Threading.Monitor&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="242149">MMONITOR_ENTER</a> = <a href="#242147" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MMONITOR</a>.<span title="(x$1: java.lang.String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Enter&quot;)" class="string">&quot;Enter&quot;</span>, <span title="(xs: ch.epfl.lamp.compiler.msil.Type*)(implicit evidence$2: scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type])Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span title="(clazz: java.lang.Class[_])scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type]" class="delimiter">(</span><a href="../../symtab/clr/CLRTypes.scala.html#205447" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MOBJECT</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="242151">MMONITOR_EXIT</a>  = <a href="#242147" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MMONITOR</a>.<span title="(x$1: java.lang.String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Exit&quot;)" class="string">&quot;Exit&quot;</span>, <span title="(xs: ch.epfl.lamp.compiler.msil.Type*)(implicit evidence$2: scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type])Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span title="(clazz: java.lang.Class[_])scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type]" class="delimiter">(</span><a href="../../symtab/clr/CLRTypes.scala.html#205447" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MOBJECT</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="242153">MSTRING_BUILDER</a> = <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205492" title="(name: String)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><span title="java.lang.String(&quot;System.Text.StringBuilder&quot;)" class="string">&quot;System.Text.StringBuilder&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.ConstructorInfo" id="242155">MSTRING_BUILDER_CONSTR</a> = <a href="#242153" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MSTRING_BUILDER</a>.<span title="(x$1: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.ConstructorInfo">GetConstructor</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.Type">MsilType</span>.<span title="Array[ch.epfl.lamp.compiler.msil.Type]">EmptyTypes</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="242157">MSTRING_BUILDER_TOSTRING</a> = <a href="#242153" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MSTRING_BUILDER</a>.<span title="(x$1: java.lang.String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="java.lang.String(&quot;ToString&quot;)" class="string">&quot;ToString&quot;</span>,
                                                             <span title="object ch.epfl.lamp.compiler.msil.Type">MsilType</span>.<span title="Array[ch.epfl.lamp.compiler.msil.Type]">EmptyTypes</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="242159">TYPE_FROM_HANDLE</a> =
      <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205492" title="(name: String)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><span title="java.lang.String(&quot;System.Type&quot;)" class="string">&quot;System.Type&quot;</span><span class="delimiter">)</span>.<span title="(x$1: java.lang.String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="java.lang.String(&quot;GetTypeFromHandle&quot;)" class="string">&quot;GetTypeFromHandle&quot;</span>, <span title="(xs: ch.epfl.lamp.compiler.msil.Type*)(implicit evidence$2: scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type])Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span title="(clazz: java.lang.Class[_])scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type]" class="delimiter">(</span><a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205492" title="(name: String)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><span title="java.lang.String(&quot;System.RuntimeTypeHandle&quot;)" class="string">&quot;System.RuntimeTypeHandle&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="242161">INT_PTR</a> = <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205492" title="(name: String)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><span title="java.lang.String(&quot;System.IntPtr&quot;)" class="string">&quot;System.IntPtr&quot;</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="GenMSIL.this.global.Symbol" id="242163">JOBJECT</a> = <a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106220" title="=&gt; GenMSIL.this.global.Symbol">ObjectClass</a>
    <span class="keyword">val</span> <a title="GenMSIL.this.global.Symbol" id="242165">JSTRING</a> = <a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106300" title="=&gt; GenMSIL.this.global.Symbol">StringClass</a>

    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="242167">SystemConvert</a> = <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205492" title="(name: String)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><span title="java.lang.String(&quot;System.Convert&quot;)" class="string">&quot;System.Convert&quot;</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Array[ch.epfl.lamp.compiler.msil.Type]" id="242169">objParam</a> = <span title="(xs: ch.epfl.lamp.compiler.msil.Type*)(implicit evidence$2: scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type])Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span title="(clazz: java.lang.Class[_])scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type]" class="delimiter">(</span><a href="../../symtab/clr/CLRTypes.scala.html#205447" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MOBJECT</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="242171">toBool</a>:   <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span> = <a href="#242167" title="=&gt; ch.epfl.lamp.compiler.msil.Type">SystemConvert</a>.<span title="(x$1: java.lang.String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="java.lang.String(&quot;ToBoolean&quot;)" class="string">&quot;ToBoolean&quot;</span>, <a href="#242169" title="=&gt; Array[ch.epfl.lamp.compiler.msil.Type]">objParam</a><span class="delimiter">)</span> <span class="comment">// see comment in emitUnbox </span>
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="242173">toSByte</a>:  <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span> = <a href="#242167" title="=&gt; ch.epfl.lamp.compiler.msil.Type">SystemConvert</a>.<span title="(x$1: java.lang.String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="java.lang.String(&quot;ToSByte&quot;)" class="string">&quot;ToSByte&quot;</span>,   <a href="#242169" title="=&gt; Array[ch.epfl.lamp.compiler.msil.Type]">objParam</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="242175">toShort</a>:  <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span> = <a href="#242167" title="=&gt; ch.epfl.lamp.compiler.msil.Type">SystemConvert</a>.<span title="(x$1: java.lang.String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="java.lang.String(&quot;ToInt16&quot;)" class="string">&quot;ToInt16&quot;</span>,   <a href="#242169" title="=&gt; Array[ch.epfl.lamp.compiler.msil.Type]">objParam</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="242177">toChar</a>:   <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span> = <a href="#242167" title="=&gt; ch.epfl.lamp.compiler.msil.Type">SystemConvert</a>.<span title="(x$1: java.lang.String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="java.lang.String(&quot;ToChar&quot;)" class="string">&quot;ToChar&quot;</span>,    <a href="#242169" title="=&gt; Array[ch.epfl.lamp.compiler.msil.Type]">objParam</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="242179">toInt</a>:    <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span> = <a href="#242167" title="=&gt; ch.epfl.lamp.compiler.msil.Type">SystemConvert</a>.<span title="(x$1: java.lang.String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="java.lang.String(&quot;ToInt32&quot;)" class="string">&quot;ToInt32&quot;</span>,   <a href="#242169" title="=&gt; Array[ch.epfl.lamp.compiler.msil.Type]">objParam</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="242181">toLong</a>:   <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span> = <a href="#242167" title="=&gt; ch.epfl.lamp.compiler.msil.Type">SystemConvert</a>.<span title="(x$1: java.lang.String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="java.lang.String(&quot;ToInt64&quot;)" class="string">&quot;ToInt64&quot;</span>,   <a href="#242169" title="=&gt; Array[ch.epfl.lamp.compiler.msil.Type]">objParam</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="242183">toFloat</a>:  <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span> = <a href="#242167" title="=&gt; ch.epfl.lamp.compiler.msil.Type">SystemConvert</a>.<span title="(x$1: java.lang.String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="java.lang.String(&quot;ToSingle&quot;)" class="string">&quot;ToSingle&quot;</span>,  <a href="#242169" title="=&gt; Array[ch.epfl.lamp.compiler.msil.Type]">objParam</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="242185">toDouble</a>: <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span> = <a href="#242167" title="=&gt; ch.epfl.lamp.compiler.msil.Type">SystemConvert</a>.<span title="(x$1: java.lang.String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="java.lang.String(&quot;ToDouble&quot;)" class="string">&quot;ToDouble&quot;</span>,  <a href="#242169" title="=&gt; Array[ch.epfl.lamp.compiler.msil.Type]">objParam</a><span class="delimiter">)</span>

    <span class="comment">//val boxedUnit: FieldInfo = msilType(definitions.BoxedUnitModule.info).GetField(&quot;UNIT&quot;)</span>
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.FieldInfo" id="242187">boxedUnit</a>: <span title="ch.epfl.lamp.compiler.msil.FieldInfo">FieldInfo</span> = <a href="../../symtab/clr/CLRTypes.scala.html#205480" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)ch.epfl.lamp.compiler.msil.FieldInfo">fields</a><span class="delimiter">(</span><a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106600" title="=&gt; GenMSIL.this.global.Symbol">BoxedUnit_UNIT</a><span class="delimiter">)</span>

    <span class="comment">// Scala attributes</span>
    <span class="comment">// symtab.Definitions -&gt; object (singleton..)</span>
    <span class="keyword">val</span> <a title="GenMSIL.this.global.Type" id="242189">SerializableAttr</a> = <a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106624" title="=&gt; GenMSIL.this.global.Symbol">SerializableAttr</a>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.Type">tpe</a>
    <span class="keyword">val</span> <a title="GenMSIL.this.global.Type" id="242191">CloneableAttr</a>    = <a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106635" title="(fullname: GenMSIL.this.global.Name)GenMSIL.this.global.Symbol">getClass</a><span class="delimiter">(</span><a href="../../SubComponent.scala.html#95939" title="implicit scala.reflect.generic.StdNames.stringToTermName : (s: String)GenMSIL.this.global.TermName" class="string">&quot;scala.cloneable&quot;</a><span class="delimiter">)</span>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.Type">tpe</a>
    <span class="keyword">val</span> <a title="GenMSIL.this.global.Type" id="242193">TransientAtt</a>     = <a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106635" title="(fullname: GenMSIL.this.global.Name)GenMSIL.this.global.Symbol">getClass</a><span class="delimiter">(</span><a href="../../SubComponent.scala.html#95939" title="implicit scala.reflect.generic.StdNames.stringToTermName : (s: String)GenMSIL.this.global.TermName" class="string">&quot;scala.transient&quot;</a><span class="delimiter">)</span>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.Type">tpe</a>
    <span class="comment">// remoting: the architectures are too different, no mapping (no portable code</span>
    <span class="comment">// possible)</span>

    <span class="comment">// java instance methods that are mapped to static methods in .net</span>
    <span class="comment">// these will need to be called with OpCodes.Call (not Callvirt)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.HashSet[GenMSIL.this.global.Symbol]" id="242195">dynToStatMapped</a>: <span title="scala.collection.mutable.HashSet[GenMSIL.this.global.Symbol]">HashSet</span><span class="delimiter">[</span>Symbol<span class="delimiter">]</span> = <span title="()scala.collection.mutable.HashSet[GenMSIL.this.global.Symbol]" class="keyword">new</span> <span title="scala.collection.mutable.HashSet[GenMSIL.this.global.Symbol]">HashSet</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <a href="#242197" title="()Unit">initMappings</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="comment">/** Create the mappings between java and .net classes and methods */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="242197">initMappings</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#242298" title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit">mapType</a><span class="delimiter">(</span><a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106216" title="=&gt; GenMSIL.this.global.Symbol">AnyClass</a>, <a href="../../symtab/clr/CLRTypes.scala.html#205447" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MOBJECT</a><span class="delimiter">)</span>
      <a href="#242298" title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit">mapType</a><span class="delimiter">(</span><a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106218" title="=&gt; GenMSIL.this.global.Symbol">AnyRefClass</a>, <a href="../../symtab/clr/CLRTypes.scala.html#205447" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MOBJECT</a><span class="delimiter">)</span>
      <span class="comment">//mapType(definitions.NullClass, clrTypes.getType(&quot;scala.AllRef$&quot;))</span>
      <span class="comment">//mapType(definitions.NothingClass, clrTypes.getType(&quot;scala.All$&quot;))</span>
      <span class="comment">// FIXME: for some reason the upper two lines map to null</span>
      <a href="#242298" title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit">mapType</a><span class="delimiter">(</span><a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106226" title="=&gt; GenMSIL.this.global.Symbol">NullClass</a>, <a href="#242139" title="=&gt; ch.epfl.lamp.compiler.msil.Type">EXCEPTION</a><span class="delimiter">)</span>
      <a href="#242298" title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit">mapType</a><span class="delimiter">(</span><a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106228" title="=&gt; GenMSIL.this.global.Symbol">NothingClass</a>, <a href="#242139" title="=&gt; ch.epfl.lamp.compiler.msil.Type">EXCEPTION</a><span class="delimiter">)</span>

      <a href="#242298" title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit">mapType</a><span class="delimiter">(</span><a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106734" title="=&gt; GenMSIL.this.global.Symbol">BooleanClass</a>, <a href="../../symtab/clr/CLRTypes.scala.html#205435" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MBOOL</a><span class="delimiter">)</span>
      <a href="#242298" title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit">mapType</a><span class="delimiter">(</span><a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106720" title="=&gt; GenMSIL.this.global.Symbol">ByteClass</a>, <a href="../../symtab/clr/CLRTypes.scala.html#205402" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MBYTE</a><span class="delimiter">)</span>
      <a href="#242298" title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit">mapType</a><span class="delimiter">(</span><a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106722" title="=&gt; GenMSIL.this.global.Symbol">ShortClass</a>, <a href="../../symtab/clr/CLRTypes.scala.html#205408" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MSHORT</a><span class="delimiter">)</span>
      <a href="#242298" title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit">mapType</a><span class="delimiter">(</span><a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106724" title="=&gt; GenMSIL.this.global.Symbol">CharClass</a>, <a href="../../symtab/clr/CLRTypes.scala.html#205414" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MCHAR</a><span class="delimiter">)</span>
      <a href="#242298" title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit">mapType</a><span class="delimiter">(</span><a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106726" title="=&gt; GenMSIL.this.global.Symbol">IntClass</a>, <a href="../../symtab/clr/CLRTypes.scala.html#205417" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MINT</a><span class="delimiter">)</span>
      <a href="#242298" title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit">mapType</a><span class="delimiter">(</span><a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106728" title="=&gt; GenMSIL.this.global.Symbol">LongClass</a>, <a href="../../symtab/clr/CLRTypes.scala.html#205423" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MLONG</a><span class="delimiter">)</span>
      <a href="#242298" title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit">mapType</a><span class="delimiter">(</span><a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106730" title="=&gt; GenMSIL.this.global.Symbol">FloatClass</a>, <a href="../../symtab/clr/CLRTypes.scala.html#205429" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MFLOAT</a><span class="delimiter">)</span>
      <a href="#242298" title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit">mapType</a><span class="delimiter">(</span><a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106732" title="=&gt; GenMSIL.this.global.Symbol">DoubleClass</a>, <a href="../../symtab/clr/CLRTypes.scala.html#205432" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MDOUBLE</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">var</span> <a title="GenMSIL.this.global.icodes.IClass" id="242199">clasz</a>: <a href="../icode/Members.scala.html#96982" title="GenMSIL.this.global.icodes.IClass">IClass</a> = _
    <span class="keyword">var</span> <a title="GenMSIL.this.global.icodes.IMethod" id="242202">method</a>: <a href="../icode/Members.scala.html#96984" title="GenMSIL.this.global.icodes.IMethod">IMethod</a> = _

    <span class="keyword">var</span> <a title="ch.epfl.lamp.compiler.msil.emit.AssemblyBuilder" id="242205">massembly</a>: <span title="ch.epfl.lamp.compiler.msil.emit.AssemblyBuilder">AssemblyBuilder</span> = _
    <span class="keyword">var</span> <a title="ch.epfl.lamp.compiler.msil.emit.ModuleBuilder" id="242208">mmodule</a>: <span title="ch.epfl.lamp.compiler.msil.emit.ModuleBuilder">ModuleBuilder</span> = _
    <span class="keyword">var</span> <a title="ch.epfl.lamp.compiler.msil.emit.ILGenerator" id="242211">mcode</a>: <span title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">ILGenerator</span> = _

    <span class="keyword">var</span> <a title="String" id="242214">assemName</a>: <span title="String">String</span> = _
    <span class="keyword">var</span> <a title="java.lang.String" id="242217">firstSourceName</a> = <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>
    <span class="keyword">var</span> <a title="java.io.File" id="242220">outDir</a>: <span title="java.io.File">File</span> = _
    <span class="keyword">var</span> <a title="java.io.File" id="242223">srcPath</a>: <span title="java.io.File">File</span> = _
    <span class="keyword">var</span> <a title="String" id="242226">moduleName</a>: <span title="String">String</span> = _

    <span class="keyword">def</span> <a title="()Unit" id="242228">initAssembly</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>

      <a href="#242214" title="(x$1: String)Unit">assemName</a> = <a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36659" title="=&gt; scala.tools.nsc.Settings#StringSetting">assemname</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; java.lang.String">value</a>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#242214" title="=&gt; String">assemName</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#242286" title="=&gt; GenMSIL.this.global.Symbol">entryPoint</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#242214" title="(x$1: String)Unit">assemName</a> = <a href="#242281" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#242286" title="=&gt; GenMSIL.this.global.Symbol">entryPoint</a>.<span title="=&gt; GenMSIL.this.global.Symbol">enclClass</span><span class="delimiter">)</span>
          <span class="comment">// remove the $ at the end (from module-name)</span>
          <a href="#242214" title="(x$1: String)Unit">assemName</a> = <a href="#242214" title="=&gt; String">assemName</a>.<span title="(x$1: Int, x$2: Int)java.lang.String">substring</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#242214" title="=&gt; String">assemName</a>.<span title="()Int">length</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="comment">// assuming filename of first source file</span>
          <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#242217" title="=&gt; java.lang.String">firstSourceName</a>.<span title="(x$1: java.lang.String)Boolean">endsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;.scala&quot;)" class="string">&quot;.scala&quot;</span><span class="delimiter">)</span>, <a href="#242217" title="=&gt; java.lang.String">firstSourceName</a><span class="delimiter">)</span>
          <a href="#242214" title="(x$1: String)Unit">assemName</a> = <a href="#242217" title="=&gt; java.lang.String">firstSourceName</a>.<span title="(x$1: Int, x$2: Int)java.lang.String">substring</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#242217" title="=&gt; java.lang.String">firstSourceName</a>.<span title="()Int">length</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Int">-</span> <span title="Int(6)" class="int">6</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#242214" title="=&gt; String">assemName</a>.<span title="(x$1: java.lang.String)Boolean">endsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;.msil&quot;)" class="string">&quot;.msil&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#242214" title="(x$1: String)Unit">assemName</a> = <a href="#242214" title="=&gt; String">assemName</a>.<span title="(x$1: Int, x$2: Int)java.lang.String">substring</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#242214" title="=&gt; String">assemName</a>.<span title="()Int">length</span><span class="delimiter">(</span><span class="delimiter">)</span><span title="(x: Int)Int">-</span><span title="Int(5)" class="int">5</span><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#242214" title="=&gt; String">assemName</a>.<span title="(x$1: java.lang.String)Boolean">endsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;.il&quot;)" class="string">&quot;.il&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#242214" title="(x$1: String)Unit">assemName</a> = <a href="#242214" title="=&gt; String">assemName</a>.<span title="(x$1: Int, x$2: Int)java.lang.String">substring</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#242214" title="=&gt; String">assemName</a>.<span title="()Int">length</span><span class="delimiter">(</span><span class="delimiter">)</span><span title="(x: Int)Int">-</span><span title="Int(3)" class="int">3</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="java.io.File" id="243220">f</a>: <span title="java.io.File">File</span> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#242214" title="=&gt; String">assemName</a><span class="delimiter">)</span>
        <a href="#242214" title="(x$1: String)Unit">assemName</a> = <a href="#243220" title="java.io.File">f</a>.<span title="()java.lang.String">getName</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      
      <a href="#242220" title="(x$1: java.io.File)Unit">outDir</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36729" title="=&gt; scala.tools.nsc.Settings#OutputSetting">outdir</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; java.lang.String">value</a><span class="delimiter">)</span>

      <a href="#242223" title="(x$1: java.io.File)Unit">srcPath</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36665" title="=&gt; scala.tools.nsc.Settings#StringSetting">sourcedir</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; java.lang.String">value</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.AssemblyName" id="243186">assemblyName</a> = <span title="ch.epfl.lamp.compiler.msil.AssemblyName" class="keyword">new</span> <span title="ch.epfl.lamp.compiler.msil.AssemblyName">AssemblyName</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#243186" title="ch.epfl.lamp.compiler.msil.AssemblyName">assemblyName</a>.<span title="java.lang.String">Name</span> = <a href="#242214" title="=&gt; String">assemName</a>
      <a href="#242205" title="(x$1: ch.epfl.lamp.compiler.msil.emit.AssemblyBuilder)Unit">massembly</a> = <span title="object ch.epfl.lamp.compiler.msil.emit.AssemblyBuilderFactory">AssemblyBuilderFactory</span>.<span title="(name: ch.epfl.lamp.compiler.msil.AssemblyName)ch.epfl.lamp.compiler.msil.emit.AssemblyBuilder">DefineDynamicAssembly</span><span class="delimiter">(</span><a href="#243186" title="ch.epfl.lamp.compiler.msil.AssemblyName">assemblyName</a><span class="delimiter">)</span>

      <a href="#242226" title="(x$1: String)Unit">moduleName</a> = <a href="#242214" title="=&gt; String">assemName</a> <span class="comment">// + (if (entryPoint == null) &quot;.dll&quot; else &quot;.exe&quot;)</span>
      <span class="comment">// filename here: .dll or .exe (in both parameters), second: give absolute-path</span>
      <a href="#242208" title="(x$1: ch.epfl.lamp.compiler.msil.emit.ModuleBuilder)Unit">mmodule</a> = <a href="#242205" title="=&gt; ch.epfl.lamp.compiler.msil.emit.AssemblyBuilder">massembly</a>.<span title="(name: String, fileName: String)ch.epfl.lamp.compiler.msil.emit.ModuleBuilder">DefineDynamicModule</span><span class="delimiter">(</span><a href="#242226" title="=&gt; String">moduleName</a>,
                                              <span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#242220" title="=&gt; java.io.File">outDir</a>, <a href="#242226" title="=&gt; String">moduleName</a><span class="delimiter">)</span>.<span title="()java.lang.String">getAbsolutePath</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="(assertion: Boolean)Unit">assert</span> <span class="delimiter">(</span><a href="#242208" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ModuleBuilder">mmodule</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>


    <span class="comment">/**
     * Form of the custom Attribute parameter (Ecma-335.pdf)
     *      - p. 163 for CustomAttrib Form,
     *      - p. 164 for FixedArg Form (Array and Element) (if array or not is known!)
     *  !! least significant byte first if values longer than one byte !!
     *
     * 1: Prolog (unsigned int16, value 0x0001) -&gt; symtab[0] = 0x01, symtab[1] = 0x00
     * 2: FixedArgs (directly the data, get number and types from related constructor)
     *  2.1: length of the array (unsigned int32, 4 bytes, least significant first)
     *  2.2: the byte array data
     * 3: NumNamed (unsigned int16, number of named fields and properties, 0x0000)
     */</span>
    <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol, tBuilder: ch.epfl.lamp.compiler.msil.emit.TypeBuilder)Unit" id="242229">addSymtabAttribute</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="243376">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a>, <a title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" id="243377">tBuilder</a>: <span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="()Unit" id="243379">addMarker</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Array[Byte]" id="243380">markerSymtab</a> = <span title="Array[Byte]" class="keyword">new</span> <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">(</span><span title="Int(4)" class="int">4</span><span class="delimiter">)</span>
        <a href="#243380" title="(i: Int, x: Byte)Unit">markerSymtab</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> = <span title="Int(1)" class="int">1</span>.<span title="=&gt; Byte">toByte</span>
        <a href="#243377" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a>.<span title="(constr: ch.epfl.lamp.compiler.msil.ConstructorInfo, value: Array[Byte])Unit">SetCustomAttribute</span><span class="delimiter">(</span><a href="../../symtab/clr/CLRTypes.scala.html#205465" title="=&gt; ch.epfl.lamp.compiler.msil.ConstructorInfo">SYMTAB_ATTRIBUTE_EMPTY_CONSTRUCTOR</a>, <a href="#243380" title="Array[Byte]">markerSymtab</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="comment">// both conditions are needed (why exactly..?)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#243377" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a>.<span title="java.lang.String">Name</span>.<span title="(x$1: java.lang.String)Boolean">endsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;$&quot;)" class="string">&quot;$&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <a href="#243376" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; Boolean">isModuleClass</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#243379" title="()Unit">addMarker</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="../../Global.scala.html#64991" title="=&gt; GenMSIL.this.global.Run">currentRun</a>.<a href="../../Global.scala.html#72369" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.Symbol,scala.reflect.generic.PickleBuffer]">symData</a>.<span title="(key: GenMSIL.this.global.Symbol)Option[scala.reflect.generic.PickleBuffer]">get</span><span class="delimiter">(</span><a href="#243376" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="scala.reflect.generic.PickleBuffer" id="243403">pickle</a><span class="delimiter">)</span> =&gt;
            <span class="keyword">var</span> <a title="Int" id="243404">size</a> = <a href="#243403" title="scala.reflect.generic.PickleBuffer">pickle</a>.<span title="=&gt; Int">writeIndex</span>
            <span class="keyword">val</span> <a title="Array[Byte]" id="243405">symtab</a> = <span title="Array[Byte]" class="keyword">new</span> <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">(</span><a href="#243404" title="Int">size</a> <span title="(x: Int)Int">+</span> <span title="Int(8)" class="int">8</span><span class="delimiter">)</span>
            <a href="#243405" title="(i: Int, x: Byte)Unit">symtab</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> = <span title="Int(1)" class="int">1</span>.<span title="=&gt; Byte">toByte</span>
            <span class="keyword">for</span> <span class="delimiter">(</span><a title="Int" id="243546">i</a> &lt;- <span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(f: Int =&gt; Unit)Unit">until</span> <span title="Int(6)" class="int">6</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#243405" title="(i: Int, x: Byte)Unit">symtab</a><span class="delimiter">(</span><a href="#243546" title="Int">i</a><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="#243404" title="Int">size</a> <span title="(x: Int)Int">&amp;</span> <span title="Int(255)" class="int">0xff</span><span class="delimiter">)</span>.<span title="=&gt; Byte">toByte</span>
              <a href="#243404" title="Int">size</a> = <a href="#243404" title="Int">size</a> <span title="(x: Int)Int">&gt;&gt;</span> <span title="Int(8)" class="int">8</span>
            <span class="delimiter">}</span>
            java.lang.<span title="object java.lang.System">System</span>.<span title="(x$1: Any, x$2: Int, x$3: Any, x$4: Int, x$5: Int)Unit">arraycopy</span><span class="delimiter">(</span><a href="#243403" title="scala.reflect.generic.PickleBuffer">pickle</a>.<span title="=&gt; Array[Byte]">bytes</span>, <span title="Int(0)" class="int">0</span>, <a href="#243405" title="Array[Byte]">symtab</a>, <span title="Int(6)" class="int">6</span>, <a href="#243403" title="scala.reflect.generic.PickleBuffer">pickle</a>.<span title="=&gt; Int">writeIndex</span><span class="delimiter">)</span>

            <a href="#243377" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a>.<span title="(constr: ch.epfl.lamp.compiler.msil.ConstructorInfo, value: Array[Byte])Unit">SetCustomAttribute</span><span class="delimiter">(</span><a href="../../symtab/clr/CLRTypes.scala.html#205462" title="=&gt; ch.epfl.lamp.compiler.msil.ConstructorInfo">SYMTAB_ATTRIBUTE_CONSTRUCTOR</a>, <a href="#243405" title="Array[Byte]">symtab</a><span class="delimiter">)</span>

            <a href="../../Global.scala.html#64991" title="=&gt; GenMSIL.this.global.Run">currentRun</a>.<a href="../../Global.scala.html#72369" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.Symbol,scala.reflect.generic.PickleBuffer]">symData</a> <span title="(key: GenMSIL.this.global.Symbol)scala.collection.mutable.HashMap[GenMSIL.this.global.Symbol,scala.reflect.generic.PickleBuffer]">-=</span> <a href="#243376" title="GenMSIL.this.global.Symbol">sym</a>
            <a href="../../Global.scala.html#64991" title="=&gt; GenMSIL.this.global.Run">currentRun</a>.<a href="../../Global.scala.html#72369" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.Symbol,scala.reflect.generic.PickleBuffer]">symData</a> <span title="(key: GenMSIL.this.global.Symbol)scala.collection.mutable.HashMap[GenMSIL.this.global.Symbol,scala.reflect.generic.PickleBuffer]">-=</span> <a href="#243376" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107623" title="=&gt; GenMSIL.this.global.Symbol">companionSymbol</a>

          <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
            <a href="#243379" title="()Unit">addMarker</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Mutates `member` adding CLR attributes (if any) based on sym.annotations. 
     * Please notice that CLR custom modifiers are a different beast (see customModifiers below) 
     * and thus shouldn't be added by this method.   
     */</span>
    <span class="keyword">def</span> <a title="(member: ch.epfl.lamp.compiler.msil.emit.ICustomAttributeSetter, annotations: List[GenMSIL.this.global.AnnotationInfo])Unit" id="242230">addAttributes</a><span class="delimiter">(</span><a title="ch.epfl.lamp.compiler.msil.emit.ICustomAttributeSetter" id="243590">member</a>: <span title="ch.epfl.lamp.compiler.msil.emit.ICustomAttributeSetter">ICustomAttributeSetter</span>, <a title="List[GenMSIL.this.global.AnnotationInfo]" id="243591">annotations</a>: <span title="List[GenMSIL.this.global.AnnotationInfo]">List</span><span class="delimiter">[</span>AnnotationInfo<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="List[Null]" id="243593">attributes</a> = <a href="#243591" title="List[GenMSIL.this.global.AnnotationInfo]">annotations</a>.<span title="(f: GenMSIL.this.global.AnnotationInfo =&gt; GenMSIL.this.global.Symbol)(implicit bf: scala.collection.generic.CanBuildFrom[List[GenMSIL.this.global.AnnotationInfo],GenMSIL.this.global.Symbol,List[GenMSIL.this.global.Symbol]])List[GenMSIL.this.global.Symbol]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,GenMSIL.this.global.Symbol,List[GenMSIL.this.global.Symbol]]" class="delimiter">(</span><a href="#243610" title="GenMSIL.this.global.AnnotationInfo">_</a>.<a href="../../symtab/AnnotationInfos.scala.html#133491" title="=&gt; GenMSIL.this.global.Type">atp</a>.<a href="../../symtab/Types.scala.html#105454" title="=&gt; GenMSIL.this.global.Symbol">typeSymbol</a><span class="delimiter">)</span>.<span title="(pf: PartialFunction[GenMSIL.this.global.Symbol,Null])(implicit bf: scala.collection.generic.CanBuildFrom[List[GenMSIL.this.global.Symbol],Null,List[Null]])List[Null]">collect</span> <a href="#243657" title="Null" class="delimiter">{</a>
        <span class="keyword">case</span> <a href="../../symtab/Definitions.scala.html#67699" title="Null(null)">definitions</a>.<a href="../../symtab/Definitions.scala.html#106628" title="=&gt; GenMSIL.this.global.Symbol">TransientAttr</a> =&gt; <span title="Null(null)" class="keyword">null</span> <span class="comment">// TODO this is just an example </span>
      <span class="delimiter">}</span>
      <span title="Nothing" class="keyword">return</span> <span class="comment">// TODO: implement at some point</span>
    <span class="delimiter">}</span>

    <span class="comment">/**
     * What's a CLR custom modifier? Intro available as source comments in compiler.msil.CustomModifier.
     * It's basically a marker associated with a location (think of FieldInfo, ParameterInfo, and PropertyInfo) 
     * and thus that marker (be it optional or required) becomes part of the signature of that location. 
     * Some annotations will become CLR attributes (see addAttributes above), others custom modifiers (this method).   
     */</span>
    <span class="keyword">def</span> <a title="(annotations: List[GenMSIL.this.global.AnnotationInfo])Array[ch.epfl.lamp.compiler.msil.CustomModifier]" id="242231">customModifiers</a><span class="delimiter">(</span><a title="List[GenMSIL.this.global.AnnotationInfo]" id="243685">annotations</a>: <span title="List[GenMSIL.this.global.AnnotationInfo]">List</span><span class="delimiter">[</span>AnnotationInfo<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Array[ch.epfl.lamp.compiler.msil.CustomModifier]">Array</span><span class="delimiter">[</span>CustomModifier<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <a href="#243685" title="List[GenMSIL.this.global.AnnotationInfo]">annotations</a>.<span title="(f: GenMSIL.this.global.AnnotationInfo =&gt; GenMSIL.this.global.Symbol)(implicit bf: scala.collection.generic.CanBuildFrom[List[GenMSIL.this.global.AnnotationInfo],GenMSIL.this.global.Symbol,List[GenMSIL.this.global.Symbol]])List[GenMSIL.this.global.Symbol]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,GenMSIL.this.global.Symbol,List[GenMSIL.this.global.Symbol]]" class="delimiter">(</span><a href="#243713" title="GenMSIL.this.global.AnnotationInfo">_</a>.<a href="../../symtab/AnnotationInfos.scala.html#133491" title="=&gt; GenMSIL.this.global.Type">atp</a>.<a href="../../symtab/Types.scala.html#105454" title="=&gt; GenMSIL.this.global.Symbol">typeSymbol</a><span class="delimiter">)</span>.<span title="(pf: PartialFunction[GenMSIL.this.global.Symbol,ch.epfl.lamp.compiler.msil.CustomModifier])(implicit bf: scala.collection.generic.CanBuildFrom[List[GenMSIL.this.global.Symbol],ch.epfl.lamp.compiler.msil.CustomModifier,List[ch.epfl.lamp.compiler.msil.CustomModifier]])List[ch.epfl.lamp.compiler.msil.CustomModifier]">collect</span> <a href="#243756" title="ch.epfl.lamp.compiler.msil.CustomModifier" class="delimiter">{</a>
        <span class="keyword">case</span> <a href="../../symtab/Definitions.scala.html#67699" title="ch.epfl.lamp.compiler.msil.CustomModifier">definitions</a>.<a href="../../symtab/Definitions.scala.html#106630" title="=&gt; GenMSIL.this.global.Symbol">VolatileAttr</a>  =&gt; <span title="ch.epfl.lamp.compiler.msil.CustomModifier" class="keyword">new</span> <span title="ch.epfl.lamp.compiler.msil.CustomModifier">CustomModifier</span><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span>, <span title="object ch.epfl.lamp.compiler.msil.CustomModifier">CustomModifier</span>.<span title="()ch.epfl.lamp.compiler.msil.Type">VolatileMarker</span><span class="delimiter">)</span> 
      <span class="delimiter">}</span> <span title="(implicit evidence$1: ClassManifest[ch.epfl.lamp.compiler.msil.CustomModifier])Array[ch.epfl.lamp.compiler.msil.CustomModifier]">toArray</span>
    <span class="delimiter">}</span>
      
    
    
    <span class="comment">/*
      if (settings.debug.value)
        log(&quot;creating annotations: &quot; + annotations + &quot; for member : &quot; + member)
      for (annot@ AnnotationInfo(typ, annArgs, nvPairs) &lt;- annotations ;
           if annot.isConstant)
           //!typ.typeSymbol.isJavaDefined
      {
//        assert(consts.length &lt;= 1,
//               &quot;too many constant arguments for annotations; &quot;+consts.toString())

        // Problem / TODO having the symbol of the annotations type would be nicer
        // (i hope that type.typeSymbol is the same as the one in types2create)
        // AND: this will crash if the annotations Type is already compiled (-&gt; not a typeBuilder)
        // when this is solved, types2create will be the same as icodes.classes, thus superfluous
        val annType: TypeBuilder = getType(typ.typeSymbol).asInstanceOf[TypeBuilder]
//        val annType: MsilType = getType(typ.typeSymbol)

        // Problem / TODO: i have no idea which constructor is used. This
        // information should be available in AnnotationInfo.
        annType.CreateType() // else, GetConstructors can't be used
        val constr: ConstructorInfo = annType.GetConstructors()(0)
        // prevent a second call of CreateType, only needed because there's no
        // other way than GetConstructors()(0) to get the constructor, if there's
        // no constructor symbol available.

        val args: Array[Byte] =
          getAttributeArgs(
            annArgs map (_.constant.get),
            (for((n,v) &lt;- nvPairs) yield (n, v.constant.get)))
        member.SetCustomAttribute(constr, args)
      }
    } */</span>

<span class="comment">/*    def getAttributeArgs(consts: List[Constant], nvPairs: List[(Name, Constant)]): Array[Byte] = {
      val buf = ByteBuffer.allocate(2048) // FIXME: this may be not enough!
      buf.order(ByteOrder.LITTLE_ENDIAN)
      buf.putShort(1.toShort) // signature

      def emitSerString(str: String) = {
          // this is wrong, it has to be the length of the UTF-8 byte array, which
          // may be longer (see clr-book on page 302)
//          val length: Int = str.length
            val strBytes: Array[Byte] = try {
              str.getBytes(&quot;UTF-8&quot;)
            } catch {
              case _: Error =&gt; abort(&quot;could not get byte-array for string: &quot; + str)
            }
            val length: Int = strBytes.length //this length is stored big-endian
            if (length &lt; 128)
              buf.put(length.toByte)
            else if (length &lt; (1&lt;&lt;14)) {
              buf.put(((length &gt;&gt; 8) | 0x80).toByte) // the bits 14 and 15 of length are '0'
              buf.put((length | 0xff).toByte)
            } else if (length &lt; (1 &lt;&lt; 29)) {
              buf.put(((length &gt;&gt; 24) | 0xc0).toByte)
              buf.put(((length &gt;&gt; 16) &amp; 0xff).toByte)
              buf.put(((length &gt;&gt;  8) &amp; 0xff).toByte)
              buf.put(((length      ) &amp; 0xff).toByte)
            } else
              abort(&quot;string too long for attribute parameter: &quot; + length)
            buf.put(strBytes)
      }

      def emitConst(const: Constant): Unit = const.tag match {
        case BooleanTag =&gt; buf.put((if (const.booleanValue) 1 else 0).toByte)
        case ByteTag =&gt; buf.put(const.byteValue)
        case ShortTag =&gt; buf.putShort(const.shortValue)
        case CharTag =&gt; buf.putChar(const.charValue)
        case IntTag =&gt; buf.putInt(const.intValue)
        case LongTag =&gt; buf.putLong(const.longValue)
        case FloatTag =&gt; buf.putFloat(const.floatValue)
        case DoubleTag =&gt; buf.putDouble(const.doubleValue)
        case StringTag =&gt;
          val str: String = const.stringValue
          if (str == null) {
            buf.put(0xff.toByte)
          } else {
            emitSerString(str)
          }
        case ArrayTag =&gt;
          val arr: Array[Constant] = const.arrayValue
          if (arr == null) {
            buf.putInt(0xffffffff)
          } else {
            buf.putInt(arr.length)
            arr.foreach(emitConst)
          }

        // TODO: other Tags: NoTag, UnitTag, ClassTag, EnumTag, ArrayTag ???

        case _ =&gt; abort(&quot;could not handle attribute argument: &quot; + const)
      }

      consts foreach emitConst
      buf.putShort(nvPairs.length.toShort)
      def emitNamedArg(nvPair: (Name, Constant)) {
        // the named argument is a property of the attribute (it can't be a field, since
        //  all fields in scala are private)
        buf.put(0x54.toByte)

        def emitType(c: Constant) = c.tag match { // type of the constant, Ecma-335.pdf, page 151
          case BooleanTag =&gt; buf.put(0x02.toByte)
          case ByteTag =&gt;    buf.put(0x05.toByte)
          case ShortTag =&gt;   buf.put(0x06.toByte)
          case CharTag =&gt;    buf.put(0x07.toByte)
          case IntTag =&gt;     buf.put(0x08.toByte)
          case LongTag =&gt;    buf.put(0x0a.toByte)
          case FloatTag =&gt;   buf.put(0x0c.toByte)
          case DoubleTag =&gt;  buf.put(0x0d.toByte)
          case StringTag =&gt;  buf.put(0x0e.toByte)

          // TODO: other Tags: NoTag, UnitTag, ClassTag, EnumTag ???

          // ArrayTag falls in here
          case _ =&gt; abort(&quot;could not handle attribute argument: &quot; + c)
        }

        val cnst: Constant = nvPair._2
        if (cnst.tag == ArrayTag) {
          buf.put(0x1d.toByte)
          emitType(cnst.arrayValue(0)) // FIXME: will crash if array length = 0
        } else if (cnst.tag == EnumTag) {
          buf.put(0x55.toByte)
          // TODO: put a SerString (don't know what exactly, names of the enums somehow..)
              } else {
          buf.put(0x51.toByte)
          emitType(cnst)
        }

        emitSerString(nvPair._1.toString)
        emitConst(nvPair._2)
      }

      val length = buf.position()
      buf.array().slice(0, length)
    } */</span>

    <span class="keyword">def</span> <a title="()Unit" id="242232">writeAssembly</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#242286" title="=&gt; GenMSIL.this.global.Symbol">entryPoint</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#242286" title="=&gt; GenMSIL.this.global.Symbol">entryPoint</a>.<span title="=&gt; GenMSIL.this.global.Symbol">enclClass</span>.<span title="=&gt; Boolean">isModuleClass</span>, <a href="#242286" title="=&gt; GenMSIL.this.global.Symbol">entryPoint</a>.<span title="=&gt; GenMSIL.this.global.Symbol">enclClass</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="243812">mainMethod</a> = <a href="../../symtab/clr/CLRTypes.scala.html#205478" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)ch.epfl.lamp.compiler.msil.MethodInfo">methods</a><span class="delimiter">(</span><a href="#242286" title="=&gt; GenMSIL.this.global.Symbol">entryPoint</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Array[ch.epfl.lamp.compiler.msil.Type]" id="243813">stringArrayTypes</a>: <span title="Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span class="delimiter">[</span>MsilType<span class="delimiter">]</span> = <span title="(xs: ch.epfl.lamp.compiler.msil.Type*)(implicit evidence$2: scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type])Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span title="(clazz: java.lang.Class[_])scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type]" class="delimiter">(</span><a href="../../symtab/clr/CLRTypes.scala.html#205453" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MSTRING_ARRAY</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder" id="243814">globalMain</a> = <a href="#242208" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ModuleBuilder">mmodule</a>.<span title="(name: String, attributes: Int, returnType: ch.epfl.lamp.compiler.msil.Type, paramTypes: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.emit.MethodBuilder">DefineGlobalMethod</span><span class="delimiter">(</span>
          <span title="java.lang.String(&quot;Main&quot;)" class="string">&quot;Main&quot;</span>, MethodAttributes.Public <span title="Int(22)">|</span> MethodAttributes.Static,
          <a href="../../symtab/clr/CLRTypes.scala.html#205438" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MVOID</a>, <a href="#243813" title="Array[ch.epfl.lamp.compiler.msil.Type]">stringArrayTypes</a><span class="delimiter">)</span>
        <a href="#243814" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">globalMain</a>.<span title="(pos: Int, attr: Int, name: String)ch.epfl.lamp.compiler.msil.emit.ParameterBuilder">DefineParameter</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, ParameterAttributes.<span title="Int(0)">None</span>, <span title="java.lang.String(&quot;args&quot;)" class="string">&quot;args&quot;</span><span class="delimiter">)</span>
        <a href="#242205" title="=&gt; ch.epfl.lamp.compiler.msil.emit.AssemblyBuilder">massembly</a>.<span title="(entryMethod: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">SetEntryPoint</span><span class="delimiter">(</span><a href="#243814" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">globalMain</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.ILGenerator" id="243815">code</a> = <a href="#243814" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">globalMain</a>.<span title="()ch.epfl.lamp.compiler.msil.emit.ILGenerator">GetILGenerator</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.FieldInfo" id="243816">moduleField</a> = <a href="#242306" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.FieldInfo">getModuleInstanceField</a><span class="delimiter">(</span><a href="#242286" title="=&gt; GenMSIL.this.global.Symbol">entryPoint</a>.<span title="=&gt; GenMSIL.this.global.Symbol">enclClass</span><span class="delimiter">)</span>
        <a href="#243815" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldsfld</span>, <a href="#243816" title="ch.epfl.lamp.compiler.msil.FieldInfo">moduleField</a><span class="delimiter">)</span>
        <a href="#243815" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldarg_0</span><span class="delimiter">)</span>
        <a href="#243815" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Callvirt</span>, <a href="#243812" title="ch.epfl.lamp.compiler.msil.MethodInfo">mainMethod</a><span class="delimiter">)</span>
        <a href="#243815" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ret</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#242233" title="()Unit">createTypes</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">var</span> <a title="String" id="243806">outDirName</a>: <span title="String">String</span> = <span title="Null(null)" class="keyword">null</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36779" title="=&gt; scala.tools.nsc.Settings#StringSetting">Ygenjavap</a>.<a href="../../settings/MutableSettings.scala.html#42148" title="=&gt; Boolean">isDefault</a><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="comment">// we reuse the JVM-sounding setting because it's conceptually similar</span>
          <a href="#243806" title="String">outDirName</a> = <a href="#242220" title="=&gt; java.io.File">outDir</a>.<span title="()java.lang.String">getPath</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#242205" title="=&gt; ch.epfl.lamp.compiler.msil.emit.AssemblyBuilder">massembly</a>.<span title="(fileName: String)Unit">Save</span><span class="delimiter">(</span><a href="#243806" title="String">outDirName</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\\&quot;)" class="string">&quot;\\&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#242214" title="=&gt; String">assemName</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;.msil&quot;)" class="string">&quot;.msil&quot;</span><span class="delimiter">)</span> <span class="comment">/* use SingleFileILPrinterVisitor */</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#243806" title="String">outDirName</a> = <a href="#242223" title="=&gt; java.io.File">srcPath</a>.<span title="()java.lang.String">getPath</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#242205" title="=&gt; ch.epfl.lamp.compiler.msil.emit.AssemblyBuilder">massembly</a>.<span title="(destPath: String, sourceFilesPath: String)Unit">Save</span><span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36779" title="=&gt; scala.tools.nsc.Settings#StringSetting">Ygenjavap</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; java.lang.String">value</a>, <a href="#243806" title="String">outDirName</a><span class="delimiter">)</span>  <span class="comment">/* use MultipleFilesILPrinterVisitor */</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Nothing" id="245618">e</a>:<span title="java.io.IOException">IOException</span> =&gt; <a href="../../symtab/SymbolTable.scala.html#64790" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Could not write to &quot;)" class="string">&quot;Could not write to &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#243806" title="String">outDirName</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#245618" title="java.io.IOException">e</a>.<span title="()java.lang.String">getMessage</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="242233">createTypes</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="245655">sym</a> &lt;- <a href="../icode/ICodes.scala.html#96940" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.global.Symbol,GenMSIL.this.global.icodes.IClass]">classes</a>.<span title="(f: GenMSIL.this.global.icodes.global.Symbol =&gt; Unit)Unit">keys</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.IClass" id="245656">iclass</a>   = <a href="../icode/ICodes.scala.html#96940" title="(key: GenMSIL.this.global.icodes.global.Symbol)GenMSIL.this.global.icodes.IClass">classes</a><span class="delimiter">(</span><a href="#245655" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" id="245657">tBuilder</a> = <a href="../../symtab/clr/CLRTypes.scala.html#205474" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)ch.epfl.lamp.compiler.msil.Type">types</a><span class="delimiter">(</span><a href="#245655" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" class="delimiter">[</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span><span class="delimiter">]</span>
          
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36747" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
          <a href="../../Global.scala.html#64883" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Calling CreatType for &quot;)" class="string">&quot;Calling CreatType for &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#245655" title="GenMSIL.this.global.icodes.global.Symbol">sym</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#245657" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a>.<span title="()java.lang.String">toString</span><span class="delimiter">)</span>

        <a href="#245657" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a>.<span title="()ch.epfl.lamp.compiler.msil.Type">CreateType</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#245657" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a>.<span title="(sourceFilepath: String)Unit">setSourceFilepath</span><span class="delimiter">(</span><a href="#245656" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#97420" title="=&gt; GenMSIL.this.global.icodes.global.CompilationUnit">cunit</a>.<a href="../../CompilationUnits.scala.html#96423" title="=&gt; scala.tools.nsc.util.SourceFile">source</a>.<a href="../../util/SourceFile.scala.html#96521" title="=&gt; scala.tools.nsc.io.AbstractFile">file</a>.<a href="../../io/AbstractFile.scala.html#96474" title="=&gt; String">path</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span><span class="delimiter">[</span>GenMSIL<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(iclass: GenMSIL.this.global.icodes.IClass)String" id="242234">ilasmFileName</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IClass" id="245713">iclass</a>: <a href="../icode/Members.scala.html#96982" title="GenMSIL.this.global.icodes.IClass">IClass</a><span class="delimiter">)</span> : <span title="String">String</span> = <span class="delimiter">{</span>
      <span class="comment">// method.sourceFile contains just the filename</span>
      <a href="#245713" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#97420" title="=&gt; GenMSIL.this.global.icodes.global.CompilationUnit">cunit</a>.<a href="../../CompilationUnits.scala.html#96423" title="=&gt; scala.tools.nsc.util.SourceFile">source</a>.<a href="../../util/SourceFile.scala.html#96521" title="=&gt; scala.tools.nsc.io.AbstractFile">file</a>.<a href="../../io/AbstractFile.scala.html#96506" title="()String">toString</a>.<span title="(x$1: java.lang.CharSequence, x$2: java.lang.CharSequence)java.lang.String">replace</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\\&quot;)" class="string">&quot;\\&quot;</span>, <span title="java.lang.String(&quot;\\\\&quot;)" class="string">&quot;\\\\&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span><span class="delimiter">[</span>GenMSIL<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(iclass: GenMSIL.this.global.icodes.IClass)Unit" id="242235">genClass</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IClass" id="242492">iclass</a>: <a href="../icode/Members.scala.html#96982" title="GenMSIL.this.global.icodes.IClass">IClass</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.global.Symbol" id="245723">sym</a> = <a href="#242492" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#97411" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36747" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
        <a href="../../Global.scala.html#64883" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Generating class &quot;)" class="string">&quot;Generating class &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#245723" title="GenMSIL.this.global.icodes.global.Symbol">sym</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; flags: &quot;)" class="string">&quot; flags: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="../../symtab/Flags.scala.html#24068" title="object scala.tools.nsc.symtab.Flags">Flags</a>.<span title="(flags: Long)String">flagsToString</span><span class="delimiter">(</span><a href="#245723" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107551" title="=&gt; Long">flags</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#242199" title="(x$1: GenMSIL.this.global.icodes.IClass)Unit">clasz</a> = <a href="#242492" title="GenMSIL.this.global.icodes.IClass">iclass</a>

      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" id="245724">tBuilder</a> = <a href="#242296" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#245723" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" class="delimiter">[</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span><span class="delimiter">]</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#242304" title="(sym: GenMSIL.this.global.Symbol)Boolean">isCloneable</a><span class="delimiter">(</span><a href="#245723" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="comment">// FIXME: why there's no nme.clone_ ?</span>
        <span class="comment">// &quot;Clone&quot;: if the code is non-portable, &quot;Clone&quot; is defined, not &quot;clone&quot;</span>
        <span class="comment">// TODO: improve condition (should override AnyRef.clone)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#242492" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#97417" title="=&gt; List[GenMSIL.this.global.icodes.IMethod]">methods</a>.<span title="(p: GenMSIL.this.global.icodes.IMethod =&gt; Boolean)Boolean">forall</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IMethod" id="245759">m</a> =&gt; <span class="delimiter">{</span>
          <span title="=&gt; Boolean">!</span><span class="delimiter">(</span><span class="delimiter">(</span><a href="#245759" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197788" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../symtab/Symbols.scala.html#107548" title="=&gt; GenMSIL.this.global.icodes.global.Name">name</a>.<a href="../../symtab/Names.scala.html#96604" title="()String">toString</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="java.lang.String(&quot;clone&quot;)" class="string">&quot;clone&quot;</span> <span title="(x: Boolean)Boolean">||</span> <a href="#245759" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197788" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../symtab/Symbols.scala.html#107548" title="=&gt; GenMSIL.this.global.icodes.global.Name">name</a>.<a href="../../symtab/Names.scala.html#96604" title="()String">toString</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="java.lang.String(&quot;Clone&quot;)" class="string">&quot;Clone&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
            <a href="#245759" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197788" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.icodes.global.Type">tpe</a>.<a href="../../symtab/Types.scala.html#105476" title="=&gt; List[GenMSIL.this.global.icodes.global.Type]">paramTypes</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
        <span class="delimiter">}</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36747" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
            <a href="../../Global.scala.html#64883" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;auto-generating cloneable method for &quot;)" class="string">&quot;auto-generating cloneable method for &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#245723" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Short" id="245782">attrs</a>: <span title="Short">Short</span> = <span class="delimiter">(</span>MethodAttributes.Public | MethodAttributes.Virtual <span title="Int(198)">|</span>
                              MethodAttributes.HideBySig<span class="delimiter">)</span>.<span title="=&gt; Short">toShort</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder" id="245783">cloneMethod</a> = <a href="#245724" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a>.<span title="(name: String, attrs: Short, returnType: ch.epfl.lamp.compiler.msil.Type, paramTypes: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.emit.MethodBuilder">DefineMethod</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Clone&quot;)" class="string">&quot;Clone&quot;</span>, <a href="#245782" title="Short">attrs</a>, <a href="../../symtab/clr/CLRTypes.scala.html#205447" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MOBJECT</a>,
                                                  <span title="object ch.epfl.lamp.compiler.msil.Type">MsilType</span>.<span title="Array[ch.epfl.lamp.compiler.msil.Type]">EmptyTypes</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.ILGenerator" id="245784">clCode</a> = <a href="#245783" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">cloneMethod</a>.<span title="()ch.epfl.lamp.compiler.msil.emit.ILGenerator">GetILGenerator</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#245784" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">clCode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldarg_0</span><span class="delimiter">)</span>
          <a href="#245784" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">clCode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#242145" title="=&gt; ch.epfl.lamp.compiler.msil.MethodInfo">MEMBERWISE_CLONE</a><span class="delimiter">)</span>
          <a href="#245784" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">clCode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ret</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="Int" id="245725">line</a> = <a href="#245723" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107404" title="=&gt; GenMSIL.this.global.icodes.global.Position">pos</a>.<a href="../../util/Position.scala.html#97235" title="=&gt; Int">line</a>
      <a href="#245724" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a>.<span title="(sourceLine: Int, sourceFilename: String)Unit">setPosition</span><span class="delimiter">(</span><a href="#245725" title="Int">line</a>, <a href="#242234" title="(iclass: GenMSIL.this.global.icodes.IClass)String">ilasmFileName</a><span class="delimiter">(</span><a href="#242492" title="GenMSIL.this.global.icodes.IClass">iclass</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#242302" title="(sym: GenMSIL.this.global.Symbol)Boolean">isTopLevelModule</a><span class="delimiter">(</span><a href="#245723" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#245723" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107620" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">companionClass</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/Symbols.scala.html#67339" title="object GenMSIL.this.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span>
          <a href="#242310" title="(sym: GenMSIL.this.global.Symbol)Unit">dumpMirrorClass</a><span class="delimiter">(</span><a href="#245723" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>
        <span class="keyword">else</span>
          <a href="../../Global.scala.html#64883" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;No mirror class for module with linked class: &quot;)" class="string">&quot;No mirror class for module with linked class: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span>
              <a href="#245723" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<span title="=&gt; String">fullName</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="#242229" title="(sym: GenMSIL.this.global.Symbol, tBuilder: ch.epfl.lamp.compiler.msil.emit.TypeBuilder)Unit">addSymtabAttribute</a><span class="delimiter">(</span><a href="#245723" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>, <a href="#245724" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a><span class="delimiter">)</span>
      <a href="#242230" title="(member: ch.epfl.lamp.compiler.msil.emit.ICustomAttributeSetter, annotations: List[GenMSIL.this.global.AnnotationInfo])Unit">addAttributes</a><span class="delimiter">(</span><a href="#245724" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a>, <a href="#245723" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107411" title="=&gt; List[GenMSIL.this.global.icodes.global.AnnotationInfo]">annotations</a><span class="delimiter">)</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#242492" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#97411" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106394" title="=&gt; GenMSIL.this.global.Symbol">ArrayClass</a><span class="delimiter">)</span>
        <a href="#242492" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#97417" title="=&gt; List[GenMSIL.this.global.icodes.IMethod]">methods</a> <span title="(f: GenMSIL.this.global.icodes.IMethod =&gt; Unit)Unit">foreach</span> <a href="#242236" title="(m: GenMSIL.this.global.icodes.IMethod)Unit">genMethod</a>

    <span class="delimiter">}</span> <span class="comment">//genClass</span>


    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(m: GenMSIL.this.global.icodes.IMethod)Unit" id="242236">genMethod</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IMethod" id="245839">m</a>: <a href="../icode/Members.scala.html#96984" title="GenMSIL.this.global.icodes.IMethod">IMethod</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36747" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
        <a href="../../Global.scala.html#64883" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Generating method &quot;)" class="string">&quot;Generating method &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#245839" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197788" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; flags: &quot;)" class="string">&quot; flags: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="../../symtab/Flags.scala.html#24068" title="object scala.tools.nsc.symtab.Flags">Flags</a>.<span title="(flags: Long)String">flagsToString</span><span class="delimiter">(</span><a href="#245839" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197788" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../symtab/Symbols.scala.html#107551" title="=&gt; Long">flags</a><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span>
            <span title="java.lang.String(&quot; owner: &quot;)" class="string">&quot; owner: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#245839" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197788" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">owner</a><span class="delimiter">)</span>
      <a href="#242202" title="(x$1: GenMSIL.this.global.icodes.IMethod)Unit">method</a> = <a href="#245839" title="GenMSIL.this.global.icodes.IMethod">m</a>
      <a href="#242290" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.Local,ch.epfl.lamp.compiler.msil.emit.LocalBuilder]">localBuilders</a>.<span title="()Unit">clear</span>
      <a href="#242280" title="(m: GenMSIL.this.global.icodes.IMethod)Unit">computeLocalVarsIndex</a><span class="delimiter">(</span><a href="#245839" title="GenMSIL.this.global.icodes.IMethod">m</a><span class="delimiter">)</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#245839" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197788" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../symtab/Symbols.scala.html#107473" title="=&gt; Boolean">isClassConstructor</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#242211" title="(x$1: ch.epfl.lamp.compiler.msil.emit.ILGenerator)Unit">mcode</a> = <a href="../../symtab/clr/CLRTypes.scala.html#205476" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)ch.epfl.lamp.compiler.msil.ConstructorInfo">constructors</a><span class="delimiter">(</span><a href="#245839" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197788" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="ch.epfl.lamp.compiler.msil.emit.ConstructorBuilder" class="delimiter">[</span><span title="ch.epfl.lamp.compiler.msil.emit.ConstructorBuilder">ConstructorBuilder</span><span class="delimiter">]</span>.<span title="()ch.epfl.lamp.compiler.msil.emit.ILGenerator">GetILGenerator</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder" id="245895">mBuilder</a> = <a href="../../symtab/clr/CLRTypes.scala.html#205478" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)ch.epfl.lamp.compiler.msil.MethodInfo">methods</a><span class="delimiter">(</span><a href="#245839" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197788" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder" class="delimiter">[</span><span title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">MethodBuilder</span><span class="delimiter">]</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#245895" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">mBuilder</a>.<span title="()Boolean">IsAbstract</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">try</span> <span class="delimiter">{</span>
            <a href="#242211" title="(x$1: ch.epfl.lamp.compiler.msil.emit.ILGenerator)Unit">mcode</a> = <a href="#245895" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">mBuilder</a>.<span title="()ch.epfl.lamp.compiler.msil.emit.ILGenerator">GetILGenerator</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a title="Nothing" id="245911">e</a>: <span title="Exception">Exception</span> =&gt;
              java.lang.<span title="object java.lang.System">System</span>.<span title="java.io.PrintStream">out</span>.<span title="(x$1: java.lang.String)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;m.symbol       = &quot;)" class="string">&quot;m.symbol       = &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="../../symtab/Flags.scala.html#24068" title="object scala.tools.nsc.symtab.Flags">Flags</a>.<span title="(flags: Long)String">flagsToString</span><span class="delimiter">(</span><a href="#245839" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197788" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../symtab/Symbols.scala.html#107551" title="=&gt; Long">flags</a><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#245839" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197788" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a><span class="delimiter">)</span>
              java.lang.<span title="object java.lang.System">System</span>.<span title="java.io.PrintStream">out</span>.<span title="(x$1: java.lang.String)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;m.symbol.owner = &quot;)" class="string">&quot;m.symbol.owner = &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="../../symtab/Flags.scala.html#24068" title="object scala.tools.nsc.symtab.Flags">Flags</a>.<span title="(flags: Long)String">flagsToString</span><span class="delimiter">(</span><a href="#245839" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197788" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">owner</a>.<a href="../../symtab/Symbols.scala.html#107551" title="=&gt; Long">flags</a><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#245839" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197788" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">owner</a><span class="delimiter">)</span>
              java.lang.<span title="object java.lang.System">System</span>.<span title="java.io.PrintStream">out</span>.<span title="(x$1: java.lang.String)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;mBuilder       = &quot;)" class="string">&quot;mBuilder       = &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#245895" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">mBuilder</a><span class="delimiter">)</span>
              java.lang.<span title="object java.lang.System">System</span>.<span title="java.io.PrintStream">out</span>.<span title="(x$1: java.lang.String)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;mBuilder.DeclaringType = &quot;)" class="string">&quot;mBuilder.DeclaringType = &quot;</span> <span title="(x$1: Any)java.lang.String">+</span>
                                 <span title="object ch.epfl.lamp.compiler.msil.TypeAttributes">TypeAttributes</span>.<span title="(x$1: Int)java.lang.String">toString</span><span class="delimiter">(</span><a href="#245895" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">mBuilder</a>.<span title="ch.epfl.lamp.compiler.msil.Type">DeclaringType</span>.<span title="Int">Attributes</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span>
                                 <span title="java.lang.String(&quot;::&quot;)" class="string">&quot;::&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#245895" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">mBuilder</a>.<span title="ch.epfl.lamp.compiler.msil.Type">DeclaringType</span><span class="delimiter">)</span>
              <span title="Nothing" class="keyword">throw</span> <a href="#245911" title="Exception">e</a>
          <span class="delimiter">}</span>
          <span class="keyword">else</span>
            <a href="#242211" title="(x$1: ch.epfl.lamp.compiler.msil.emit.ILGenerator)Unit">mcode</a> = <span title="Null(null)" class="keyword">null</span>
      <span class="delimiter">}</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.Local" id="245986">local</a> &lt;- <a href="#245839" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197809" title="(f: GenMSIL.this.global.icodes.Local =&gt; Unit)Unit">locals</a> ; <span class="keyword">if</span> <span title="=&gt; Boolean">!</span><span class="delimiter">(</span><a href="#245839" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197812" title="=&gt; List[GenMSIL.this.global.icodes.Local]">params</a> <span title="(elem: Any)Boolean">contains</span> <a href="#245986" title="GenMSIL.this.global.icodes.Local">local</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36747" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
            <a href="../../Global.scala.html#64883" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;add local var: &quot;)" class="string">&quot;add local var: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#245986" title="GenMSIL.this.global.icodes.Local">local</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;, of kind &quot;)" class="string">&quot;, of kind &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#245986" title="GenMSIL.this.global.icodes.Local">local</a>.<a href="../icode/Members.scala.html#197981" title="=&gt; GenMSIL.this.global.icodes.TypeKind">kind</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="245987">t</a>: <span title="ch.epfl.lamp.compiler.msil.Type">MsilType</span> = <a href="#242293" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#245986" title="GenMSIL.this.global.icodes.Local">local</a>.<a href="../icode/Members.scala.html#197981" title="=&gt; GenMSIL.this.global.icodes.TypeKind">kind</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.LocalBuilder" id="245988">localBuilder</a> = <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(localType: ch.epfl.lamp.compiler.msil.Type)ch.epfl.lamp.compiler.msil.emit.LocalBuilder">DeclareLocal</span><span class="delimiter">(</span><a href="#245987" title="ch.epfl.lamp.compiler.msil.Type">t</a><span class="delimiter">)</span>
          <a href="#245988" title="ch.epfl.lamp.compiler.msil.emit.LocalBuilder">localBuilder</a>.<span title="(name: String)Unit">SetLocalSymInfo</span><span class="delimiter">(</span><a href="#242281" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#245986" title="GenMSIL.this.global.icodes.Local">local</a>.<a href="../icode/Members.scala.html#197979" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#242290" title="(key: GenMSIL.this.global.icodes.Local, value: ch.epfl.lamp.compiler.msil.emit.LocalBuilder)Unit">localBuilders</a><span class="delimiter">(</span><a href="#245986" title="GenMSIL.this.global.icodes.Local">local</a><span class="delimiter">)</span> = <a href="#245988" title="ch.epfl.lamp.compiler.msil.emit.LocalBuilder">localBuilder</a>
        <span class="delimiter">}</span>
        <a href="#242244" title="(m: GenMSIL.this.global.icodes.IMethod)Unit">genCode</a><span class="delimiter">(</span><a href="#245839" title="GenMSIL.this.global.icodes.IMethod">m</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span class="delimiter">}</span>

    <span class="comment">/** Special linearizer for methods with at least one exception handler. This
     *  linearizer brings all basic blocks in the right order so that nested
     *  try-catch and try-finally blocks can be emitted.
     */</span>
    <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.MSILLinearizer" id="242237">msilLinearizer</a> = <span title="GenMSIL.this.global.icodes.MSILLinearizer" class="keyword">new</span> <a href="../icode/Linearizers.scala.html#97152" title="GenMSIL.this.global.icodes.MSILLinearizer">MSILLinearizer</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,ch.epfl.lamp.compiler.msil.emit.Label]" id="242239">labels</a>: <span title="scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,ch.epfl.lamp.compiler.msil.emit.Label]">HashMap</span><span class="delimiter">[</span>BasicBlock, Label<span class="delimiter">]</span> = <span title="()scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,ch.epfl.lamp.compiler.msil.emit.Label]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,ch.epfl.lamp.compiler.msil.emit.Label]">HashMap</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="comment">/* when emitting .line, it's enough to include the full filename just once per method, thus reducing filesize. 
     * this scheme relies on the fact that the entry block is emitted first. */</span>
    <span class="keyword">var</span> <a title="Boolean" id="242242">dbFilenameSeen</a> = <span title="Boolean(false)" class="keyword">false</span>  

    <span class="keyword">def</span> <a title="(m: GenMSIL.this.global.icodes.IMethod)Unit" id="242244">genCode</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IMethod" id="246007">m</a>: <a href="../icode/Members.scala.html#96984" title="GenMSIL.this.global.icodes.IMethod">IMethod</a><span class="delimiter">)</span> <span class="delimiter">{</span>

      <span class="keyword">def</span> <a title="(blocks: List[GenMSIL.this.global.icodes.BasicBlock])Unit" id="246014">makeLabels</a><span class="delimiter">(</span><a title="List[GenMSIL.this.global.icodes.BasicBlock]" id="246016">blocks</a>: <span title="List[GenMSIL.this.global.icodes.BasicBlock]">List</span><span class="delimiter">[</span>BasicBlock<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36747" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
          <a href="../../Global.scala.html#64883" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Making labels for: &quot;)" class="string">&quot;Making labels for: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#242202" title="=&gt; GenMSIL.this.global.icodes.IMethod">method</a><span class="delimiter">)</span>
        <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.BasicBlock" id="246039">bb</a> &lt;- <a href="#246016" title="(f: GenMSIL.this.global.icodes.BasicBlock =&gt; Unit)Unit">blocks</a><span class="delimiter">)</span> <a href="#242239" title="(key: GenMSIL.this.global.icodes.BasicBlock, value: ch.epfl.lamp.compiler.msil.emit.Label)Unit">labels</a><span class="delimiter">(</span><a href="#246039" title="GenMSIL.this.global.icodes.BasicBlock">bb</a><span class="delimiter">)</span> = <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="()ch.epfl.lamp.compiler.msil.emit.Label">DefineLabel</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="#242239" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,ch.epfl.lamp.compiler.msil.emit.Label]">labels</a>.<span title="()Unit">clear</span>

      <span class="keyword">var</span> <a title="List[GenMSIL.this.global.icodes.BasicBlock]" id="246015">linearization</a> = <span title="List[GenMSIL.this.global.icodes.BasicBlock]" class="keyword">if</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#246007" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197797" title="=&gt; List[GenMSIL.this.global.icodes.ExceptionHandler]">exh</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#242237" title="=&gt; GenMSIL.this.global.icodes.MSILLinearizer">msilLinearizer</a>.<a href="../icode/Linearizers.scala.html#216284" title="(m: GenMSIL.this.global.icodes.IMethod)List[GenMSIL.this.global.icodes.BasicBlock]">linearize</a><span class="delimiter">(</span><a href="#246007" title="GenMSIL.this.global.icodes.IMethod">m</a><span class="delimiter">)</span>
                          <span class="keyword">else</span> <a href="../icode/ICodes.scala.html#96944" title="=&gt; GenMSIL.this.global.icodes.Linearizer">linearizer</a>.<a href="../icode/Linearizers.scala.html#215360" title="(c: GenMSIL.this.global.icodes.IMethod)List[GenMSIL.this.global.icodes.BasicBlock]">linearize</a><span class="delimiter">(</span><a href="#246007" title="GenMSIL.this.global.icodes.IMethod">m</a><span class="delimiter">)</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#246007" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197797" title="=&gt; List[GenMSIL.this.global.icodes.ExceptionHandler]">exh</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span>
        <a href="#246015" title="List[GenMSIL.this.global.icodes.BasicBlock]">linearization</a> = <a href="#242270" title="(blocks: List[GenMSIL.this.global.icodes.BasicBlock], m: GenMSIL.this.global.icodes.IMethod)List[GenMSIL.this.global.icodes.BasicBlock]">computeExceptionMaps</a><span class="delimiter">(</span><a href="#246015" title="List[GenMSIL.this.global.icodes.BasicBlock]">linearization</a>, <a href="#246007" title="GenMSIL.this.global.icodes.IMethod">m</a><span class="delimiter">)</span>

      <a href="#246014" title="(blocks: List[GenMSIL.this.global.icodes.BasicBlock])Unit">makeLabels</a><span class="delimiter">(</span><a href="#246015" title="List[GenMSIL.this.global.icodes.BasicBlock]">linearization</a><span class="delimiter">)</span>

      <span class="comment">// debug val blocksInM = m.code.blocks.toList.sortBy(bb =&gt; bb.label)</span>
      <span class="comment">// debug val blocksInL = linearization.sortBy(bb =&gt; bb.label)</span>
      <span class="comment">// debug val MButNotL  = (blocksInM.toSet) diff (blocksInL.toSet) // if non-empty, a jump to B fails to find a label for B (case CJUMP, case CZJUMP)</span>
      <span class="comment">// debug if(!MButNotL.isEmpty) { }</span>

      <a href="#242242" title="(x$1: Boolean)Unit">dbFilenameSeen</a> = <span title="Boolean(false)" class="keyword">false</span>
      <a href="#242245" title="(blocks: List[GenMSIL.this.global.icodes.BasicBlock], previous: GenMSIL.this.global.icodes.BasicBlock)Unit">genBlocks</a><span class="delimiter">(</span><a href="#246015" title="List[GenMSIL.this.global.icodes.BasicBlock]">linearization</a><span class="delimiter">)</span>

      <span class="comment">// RETURN inside exception blocks are replaced by Leave. The target of the</span>
      <span class="comment">// leave is a `Ret` outside any exception block (generated here).</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#242256" title="=&gt; GenMSIL.this.global.icodes.IMethod">handlerReturnMethod</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#246007" title="GenMSIL.this.global.icodes.IMethod">m</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">MarkLabel</span><span class="delimiter">(</span><a href="#242262" title="=&gt; ch.epfl.lamp.compiler.msil.emit.Label">handlerReturnLabel</a><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#242265" title="=&gt; GenMSIL.this.global.icodes.TypeKind">handlerReturnKind</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../icode/TypeKinds.scala.html#97018" title="object GenMSIL.this.global.icodes.UNIT">UNIT</a><span class="delimiter">)</span>
          <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.emit.LocalBuilder)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldloc</span>, <a href="#242259" title="=&gt; ch.epfl.lamp.compiler.msil.emit.LocalBuilder">handlerReturnLocal</a><span class="delimiter">)</span>
        <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ret</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="#242246" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,List[GenMSIL.this.global.icodes.ExceptionHandler]]">beginExBlock</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#242248" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,GenMSIL.this.global.icodes.ExceptionHandler]">beginCatchBlock</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#242250" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,List[GenMSIL.this.global.icodes.ExceptionHandler]]">endExBlock</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#242268" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.ExceptionHandler,ch.epfl.lamp.compiler.msil.emit.Label]">endFinallyLabels</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(blocks: List[GenMSIL.this.global.icodes.BasicBlock], previous: GenMSIL.this.global.icodes.BasicBlock)Unit" id="242245">genBlocks</a><span class="delimiter">(</span><a title="List[GenMSIL.this.global.icodes.BasicBlock]" id="246068">blocks</a>: <span title="List[GenMSIL.this.global.icodes.BasicBlock]">List</span><span class="delimiter">[</span>BasicBlock<span class="delimiter">]</span>, <a title="GenMSIL.this.global.icodes.BasicBlock" id="246071">previous</a>: <a href="../icode/BasicBlocks.scala.html#96991" title="GenMSIL.this.global.icodes.BasicBlock">BasicBlock</a> = <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#246068" title="List[GenMSIL.this.global.icodes.BasicBlock]">blocks</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Unit">Nil</span> =&gt; <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="Unit" id="246096">x</a> :: <span title="object Nil">Nil</span> =&gt; <a href="#242271" title="(block: GenMSIL.this.global.icodes.BasicBlock, prev: GenMSIL.this.global.icodes.BasicBlock, next: GenMSIL.this.global.icodes.BasicBlock)Unit">genBlock</a><span class="delimiter">(</span><a href="#246096" title="GenMSIL.this.global.icodes.BasicBlock">x</a>, prev = <a href="#246071" title="GenMSIL.this.global.icodes.BasicBlock">previous</a>, next = <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="Unit" id="246105">x</a> :: <a title="GenMSIL.this.global.icodes.BasicBlock" id="246113">y</a> :: <a title="List[GenMSIL.this.global.icodes.BasicBlock]" id="246114">ys</a> =&gt; <a href="#242271" title="(block: GenMSIL.this.global.icodes.BasicBlock, prev: GenMSIL.this.global.icodes.BasicBlock, next: GenMSIL.this.global.icodes.BasicBlock)Unit">genBlock</a><span class="delimiter">(</span><a href="#246105" title="GenMSIL.this.global.icodes.BasicBlock">x</a>, prev = <a href="#246071" title="GenMSIL.this.global.icodes.BasicBlock">previous</a>, next = <a href="#246113" title="GenMSIL.this.global.icodes.BasicBlock">y</a><span class="delimiter">)</span>; <a href="#242245" title="(blocks: List[GenMSIL.this.global.icodes.BasicBlock], previous: GenMSIL.this.global.icodes.BasicBlock)Unit">genBlocks</a><span class="delimiter">(</span><a href="#246113" title="GenMSIL.this.global.icodes.BasicBlock">y</a> <a href="#246115" title="(x: GenMSIL.this.global.icodes.BasicBlock)List[GenMSIL.this.global.icodes.BasicBlock]">::</a> <a href="#246114" title="List[GenMSIL.this.global.icodes.BasicBlock]">ys</a>, previous = <a href="#246105" title="GenMSIL.this.global.icodes.BasicBlock">x</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="comment">// the try blocks starting at a certain BasicBlock</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,List[GenMSIL.this.global.icodes.ExceptionHandler]]" id="242246">beginExBlock</a> = <span title="()scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,List[GenMSIL.this.global.icodes.ExceptionHandler]]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,List[GenMSIL.this.global.icodes.ExceptionHandler]]">HashMap</span><span class="delimiter">[</span>BasicBlock, List<span class="delimiter">[</span>ExceptionHandler<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="comment">// the catch blocks starting / endling at a certain BasicBlock</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,GenMSIL.this.global.icodes.ExceptionHandler]" id="242248">beginCatchBlock</a> = <span title="()scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,GenMSIL.this.global.icodes.ExceptionHandler]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,GenMSIL.this.global.icodes.ExceptionHandler]">HashMap</span><span class="delimiter">[</span>BasicBlock, ExceptionHandler<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,List[GenMSIL.this.global.icodes.ExceptionHandler]]" id="242250">endExBlock</a> = <span title="()scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,List[GenMSIL.this.global.icodes.ExceptionHandler]]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,List[GenMSIL.this.global.icodes.ExceptionHandler]]">HashMap</span><span class="delimiter">[</span>BasicBlock, List<span class="delimiter">[</span>ExceptionHandler<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="comment">/** When emitting the code (genBlock), the number of currently active try / catch
     *  blocks. When seeing a `RETURN' inside a try / catch, we need to
     *   - store the result in a local (if it's not UNIT)
     *   - emit `Leave handlerReturnLabel` instead of the Return
     *   - emit code at the end: load the local and return its value
     */</span>
    <span class="keyword">var</span> <a title="scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]" id="242253">currentHandlers</a> = <span title="()scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]" class="keyword">new</span> <span title="scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">Stack</span><span class="delimiter">[</span>ExceptionHandler<span class="delimiter">]</span>
    <span class="comment">// The IMethod the Local/Label/Kind below belong to</span>
    <span class="keyword">var</span> <a title="GenMSIL.this.global.icodes.IMethod" id="242256">handlerReturnMethod</a>: <a href="../icode/Members.scala.html#96984" title="GenMSIL.this.global.icodes.IMethod">IMethod</a> = _
    <span class="comment">// Stores the result when returning inside an exception block</span>
    <span class="keyword">var</span> <a title="ch.epfl.lamp.compiler.msil.emit.LocalBuilder" id="242259">handlerReturnLocal</a>: <span title="ch.epfl.lamp.compiler.msil.emit.LocalBuilder">LocalBuilder</span> = _
    <span class="comment">// Label for a return instruction outside any exception block</span>
    <span class="keyword">var</span> <a title="ch.epfl.lamp.compiler.msil.emit.Label" id="242262">handlerReturnLabel</a>: <span title="ch.epfl.lamp.compiler.msil.emit.Label">Label</span> = _
    <span class="comment">// The result kind.</span>
    <span class="keyword">var</span> <a title="GenMSIL.this.global.icodes.TypeKind" id="242265">handlerReturnKind</a>: <a href="../icode/TypeKinds.scala.html#97012" title="GenMSIL.this.global.icodes.TypeKind">TypeKind</a> = _
    <span class="keyword">def</span> <a title="(kind: GenMSIL.this.global.icodes.TypeKind)(ch.epfl.lamp.compiler.msil.emit.LocalBuilder, ch.epfl.lamp.compiler.msil.emit.Label)" id="242267">returnFromHandler</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="246121">kind</a>: <a href="../icode/TypeKinds.scala.html#97012" title="GenMSIL.this.global.icodes.TypeKind">TypeKind</a><span class="delimiter">)</span>: <span title="(ch.epfl.lamp.compiler.msil.emit.LocalBuilder, ch.epfl.lamp.compiler.msil.emit.Label)" class="delimiter">(</span>LocalBuilder, Label<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#242256" title="=&gt; GenMSIL.this.global.icodes.IMethod">handlerReturnMethod</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#242202" title="=&gt; GenMSIL.this.global.icodes.IMethod">method</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#242256" title="(x$1: GenMSIL.this.global.icodes.IMethod)Unit">handlerReturnMethod</a> = <a href="#242202" title="=&gt; GenMSIL.this.global.icodes.IMethod">method</a>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#246121" title="GenMSIL.this.global.icodes.TypeKind">kind</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../icode/TypeKinds.scala.html#97018" title="object GenMSIL.this.global.icodes.UNIT">UNIT</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#242259" title="(x$1: ch.epfl.lamp.compiler.msil.emit.LocalBuilder)Unit">handlerReturnLocal</a> = <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(localType: ch.epfl.lamp.compiler.msil.Type)ch.epfl.lamp.compiler.msil.emit.LocalBuilder">DeclareLocal</span><span class="delimiter">(</span><a href="#242293" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#246121" title="GenMSIL.this.global.icodes.TypeKind">kind</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#242259" title="=&gt; ch.epfl.lamp.compiler.msil.emit.LocalBuilder">handlerReturnLocal</a>.<span title="(name: String)Unit">SetLocalSymInfo</span><span class="delimiter">(</span><span title="java.lang.String(&quot;$handlerReturn&quot;)" class="string">&quot;$handlerReturn&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#242262" title="(x$1: ch.epfl.lamp.compiler.msil.emit.Label)Unit">handlerReturnLabel</a> = <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="()ch.epfl.lamp.compiler.msil.emit.Label">DefineLabel</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#242265" title="(x$1: GenMSIL.this.global.icodes.TypeKind)Unit">handlerReturnKind</a> = <a href="#246121" title="GenMSIL.this.global.icodes.TypeKind">kind</a>
      <span class="delimiter">}</span>
      <span title="(_1: ch.epfl.lamp.compiler.msil.emit.LocalBuilder, _2: ch.epfl.lamp.compiler.msil.emit.Label)(ch.epfl.lamp.compiler.msil.emit.LocalBuilder, ch.epfl.lamp.compiler.msil.emit.Label)" class="delimiter">(</span><a href="#242259" title="=&gt; ch.epfl.lamp.compiler.msil.emit.LocalBuilder">handlerReturnLocal</a>, <a href="#242262" title="=&gt; ch.epfl.lamp.compiler.msil.emit.Label">handlerReturnLabel</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="comment">/** For try/catch nested inside a finally, we can't use `Leave OutsideFinally`, the
     *  Leave target has to be inside the finally (and it has to be the `endfinally` instruction).
     *  So for every finalizer, we have a label which marks the place of the `endfinally`,
     *  nested try/catch blocks will leave there.
     */</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.ExceptionHandler,ch.epfl.lamp.compiler.msil.emit.Label]" id="242268">endFinallyLabels</a> = <span title="()scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.ExceptionHandler,ch.epfl.lamp.compiler.msil.emit.Label]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.ExceptionHandler,ch.epfl.lamp.compiler.msil.emit.Label]">HashMap</span><span class="delimiter">[</span>ExceptionHandler, Label<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="comment">/** Computes which blocks are the beginning / end of a try or catch block */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(blocks: List[GenMSIL.this.global.icodes.BasicBlock], m: GenMSIL.this.global.icodes.IMethod)List[GenMSIL.this.global.icodes.BasicBlock]" id="242270">computeExceptionMaps</a><span class="delimiter">(</span><a title="List[GenMSIL.this.global.icodes.BasicBlock]" id="246065">blocks</a>: <span title="List[GenMSIL.this.global.icodes.BasicBlock]">List</span><span class="delimiter">[</span>BasicBlock<span class="delimiter">]</span>, <a title="GenMSIL.this.global.icodes.IMethod" id="246066">m</a>: <a href="../icode/Members.scala.html#96984" title="GenMSIL.this.global.icodes.IMethod">IMethod</a><span class="delimiter">)</span>: <span title="List[GenMSIL.this.global.icodes.BasicBlock]">List</span><span class="delimiter">[</span>BasicBlock<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.HashSet[GenMSIL.this.global.icodes.BasicBlock]" id="246144">visitedBlocks</a> = <span title="()scala.collection.mutable.HashSet[GenMSIL.this.global.icodes.BasicBlock]" class="keyword">new</span> <span title="scala.collection.mutable.HashSet[GenMSIL.this.global.icodes.BasicBlock]">HashSet</span><span class="delimiter">[</span>BasicBlock<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

      <span class="comment">// handlers which have not been introduced so far</span>
      <span class="keyword">var</span> <a title="List[GenMSIL.this.global.icodes.ExceptionHandler]" id="246145">openHandlers</a> = <a href="#246066" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197797" title="=&gt; List[GenMSIL.this.global.icodes.ExceptionHandler]">exh</a>


      <span class="comment">/** Example
       *   try {
       *     try {
       *         // *1*
       *     } catch {
       *       case h1 =&gt;
       *     }
       *   } catch {
       *     case h2 =&gt;
       *     case h3 =&gt;
       *       try {
       *
       *       } catch {
       *         case h4 =&gt;  // *2*
       *         case h5 =&gt;
       *       }
       *   }
       */</span>

      <span class="comment">// Stack of nested try blocks. Each bloc has a List of ExceptionHandler (multiple</span>
      <span class="comment">// catch statements). Example *1*: Stack(List(h2, h3), List(h1))</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]" id="246146">currentTryHandlers</a> = <span title="()scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]" class="keyword">new</span> <span title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]">Stack</span><span class="delimiter">[</span>List<span class="delimiter">[</span>ExceptionHandler<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

      <span class="comment">// Stack of nested catch blocks. The head of the list is the current catch block. The</span>
      <span class="comment">// tail is all following catch blocks. Example *2*: Stack(List(h3), List(h4, h5))</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]" id="246147">currentCatchHandlers</a> = <span title="()scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]" class="keyword">new</span> <span title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]">Stack</span><span class="delimiter">[</span>List<span class="delimiter">[</span>ExceptionHandler<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

      <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.BasicBlock" id="246172">b</a> &lt;- <a href="#246065" title="(f: GenMSIL.this.global.icodes.BasicBlock =&gt; scala.collection.mutable.HashSet[GenMSIL.this.global.icodes.BasicBlock])Unit">blocks</a><span class="delimiter">)</span> <span class="delimiter">{</span>

        <span class="comment">// are we past the current catch blocks?</span>
        <span class="keyword">def</span> <a title="()List[GenMSIL.this.global.icodes.ExceptionHandler]" id="246173">endHandlers</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="List[GenMSIL.this.global.icodes.ExceptionHandler]">List</span><span class="delimiter">[</span>ExceptionHandler<span class="delimiter">]</span> = <span class="delimiter">{</span>
          <span class="keyword">var</span> <a title="List[GenMSIL.this.global.icodes.ExceptionHandler]" id="246181">res</a>: <span title="List[GenMSIL.this.global.icodes.ExceptionHandler]">List</span><span class="delimiter">[</span>ExceptionHandler<span class="delimiter">]</span> = <span title="object Nil">Nil</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#246147" title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]">currentCatchHandlers</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.ExceptionHandler" id="246191">handler</a> = <a href="#246147" title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]">currentCatchHandlers</a>.<span title="=&gt; List[GenMSIL.this.global.icodes.ExceptionHandler]">top</span>.<span title="=&gt; GenMSIL.this.global.icodes.ExceptionHandler">head</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#246191" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a>.<a href="../icode/ExceptionHandlers.scala.html#203163" title="=&gt; List[GenMSIL.this.global.icodes.BasicBlock]">blocks</a>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#246172" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="comment">// all blocks of the handler are either visited, or not part of the linearization (i.e. dead)</span>
              <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#246191" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a>.<a href="../icode/ExceptionHandlers.scala.html#203163" title="=&gt; List[GenMSIL.this.global.icodes.BasicBlock]">blocks</a>.<span title="(p: GenMSIL.this.global.icodes.BasicBlock =&gt; Boolean)Boolean">forall</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.BasicBlock" id="246206">b</a> =&gt; <a href="#246144" title="scala.collection.mutable.HashSet[GenMSIL.this.global.icodes.BasicBlock]">visitedBlocks</a>.<span title="(elem: GenMSIL.this.global.icodes.BasicBlock)Boolean">contains</span><span class="delimiter">(</span><a href="#246206" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <span title="=&gt; Boolean">!</span><a href="#246065" title="List[GenMSIL.this.global.icodes.BasicBlock]">blocks</a>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#246206" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span><span class="delimiter">)</span>,
                     <span title="java.lang.String(&quot;Bad linearization of basic blocks inside catch. Found block not part of the handler\012&quot;)" class="string">&quot;Bad linearization of basic blocks inside catch. Found block not part of the handler\n&quot;</span><span title="(x$1: Any)java.lang.String">+</span>
                     <a href="#246172" title="GenMSIL.this.global.icodes.BasicBlock">b</a>.<a href="../icode/BasicBlocks.scala.html#197761" title="=&gt; String">fullString</a> <span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;\012while in catch-part of\012&quot;)" class="string">&quot;\nwhile in catch-part of\n&quot;</span><span title="(x$1: Any)java.lang.String">+</span> <a href="#246191" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a><span class="delimiter">)</span>

              <span class="keyword">val</span> <a title="List[GenMSIL.this.global.icodes.ExceptionHandler]" id="246193">rest</a> = <a href="#246147" title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]">currentCatchHandlers</a>.<span title="()List[GenMSIL.this.global.icodes.ExceptionHandler]">pop</span>.<span title="=&gt; List[GenMSIL.this.global.icodes.ExceptionHandler]">tail</span>
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#246193" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">rest</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="comment">// all catch blocks of that exception handler are covered</span>
                <a href="#246181" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">res</a> = <a href="#246191" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a> <a href="#246211" title="(x: GenMSIL.this.global.icodes.ExceptionHandler)List[GenMSIL.this.global.icodes.ExceptionHandler]">::</a> <a href="#246173" title="()List[GenMSIL.this.global.icodes.ExceptionHandler]">endHandlers</a><span class="delimiter">(</span><span class="delimiter">)</span>
              <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
                <span class="comment">// there are more catch blocks for that try (handlers covering the same)</span>
                <a href="#246147" title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]">currentCatchHandlers</a>.<span title="(elem: List[GenMSIL.this.global.icodes.ExceptionHandler])currentCatchHandlers.type">push</span><span class="delimiter">(</span><a href="#246193" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">rest</a><span class="delimiter">)</span>
                <a href="#242248" title="(key: GenMSIL.this.global.icodes.BasicBlock, value: GenMSIL.this.global.icodes.ExceptionHandler)Unit">beginCatchBlock</a><span class="delimiter">(</span><a href="#246172" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span> = <a href="#246193" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">rest</a>.<span title="=&gt; GenMSIL.this.global.icodes.ExceptionHandler">head</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
          <a href="#246181" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">res</a>
        <span class="delimiter">}</span>
        <span class="keyword">val</span> <a title="List[GenMSIL.this.global.icodes.ExceptionHandler]" id="246174">end</a> = <a href="#246173" title="()List[GenMSIL.this.global.icodes.ExceptionHandler]">endHandlers</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#246174" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">end</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#242250" title="(key: GenMSIL.this.global.icodes.BasicBlock, value: List[GenMSIL.this.global.icodes.ExceptionHandler])Unit">endExBlock</a><span class="delimiter">(</span><a href="#246172" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span> = <a href="#246174" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">end</a>

        <span class="comment">// are we past the current try block?</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#246146" title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]">currentTryHandlers</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.ExceptionHandler" id="246231">handler</a> = <a href="#246146" title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]">currentTryHandlers</a>.<span title="=&gt; List[GenMSIL.this.global.icodes.ExceptionHandler]">top</span>.<span title="=&gt; GenMSIL.this.global.icodes.ExceptionHandler">head</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#246231" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a>.<a href="../icode/ExceptionHandlers.scala.html#203162" title="(b: GenMSIL.this.global.icodes.BasicBlock)Boolean">covers</a><span class="delimiter">(</span><a href="#246172" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="comment">// all of the covered blocks are visited, or not part of the linearization</span>
            <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#246231" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a>.<a href="../icode/ExceptionHandlers.scala.html#203158" title="=&gt; scala.collection.immutable.Set[GenMSIL.this.global.icodes.BasicBlock]">covered</a>.<span title="(p: GenMSIL.this.global.icodes.BasicBlock =&gt; Boolean)Boolean">forall</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.BasicBlock" id="246250">b</a> =&gt; <a href="#246144" title="scala.collection.mutable.HashSet[GenMSIL.this.global.icodes.BasicBlock]">visitedBlocks</a>.<span title="(elem: GenMSIL.this.global.icodes.BasicBlock)Boolean">contains</span><span class="delimiter">(</span><a href="#246250" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <span title="=&gt; Boolean">!</span><a href="#246065" title="List[GenMSIL.this.global.icodes.BasicBlock]">blocks</a>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#246250" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span><span class="delimiter">)</span>,
                   <span title="java.lang.String(&quot;Bad linearization of basic blocks inside try. Found non-covered block\012&quot;)" class="string">&quot;Bad linearization of basic blocks inside try. Found non-covered block\n&quot;</span><span title="(x$1: Any)java.lang.String">+</span>
                   <a href="#246172" title="GenMSIL.this.global.icodes.BasicBlock">b</a>.<a href="../icode/BasicBlocks.scala.html#197761" title="=&gt; String">fullString</a> <span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;\012while in try-part of\012&quot;)" class="string">&quot;\nwhile in try-part of\n&quot;</span><span title="(x$1: Any)java.lang.String">+</span> <a href="#246231" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a><span class="delimiter">)</span>

            <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#246231" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a>.<a href="../icode/ExceptionHandlers.scala.html#203157" title="=&gt; GenMSIL.this.global.icodes.BasicBlock">startBlock</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#246172" title="GenMSIL.this.global.icodes.BasicBlock">b</a>,
                   <span title="java.lang.String(&quot;Bad linearization of basic blocks. The entry block of a catch does not directly follow the try\012&quot;)" class="string">&quot;Bad linearization of basic blocks. The entry block of a catch does not directly follow the try\n&quot;</span><span title="(x$1: Any)java.lang.String">+</span>
                   <a href="#246172" title="GenMSIL.this.global.icodes.BasicBlock">b</a>.<a href="../icode/BasicBlocks.scala.html#197761" title="=&gt; String">fullString</a> <span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span title="(x$1: Any)java.lang.String">+</span> <a href="#246231" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a><span class="delimiter">)</span>

            <span class="keyword">val</span> <a title="List[GenMSIL.this.global.icodes.ExceptionHandler]" id="246234">handlers</a> = <a href="#246146" title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]">currentTryHandlers</a>.<span title="()List[GenMSIL.this.global.icodes.ExceptionHandler]">pop</span>
            <a href="#246147" title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]">currentCatchHandlers</a>.<span title="(elem: List[GenMSIL.this.global.icodes.ExceptionHandler])currentCatchHandlers.type">push</span><span class="delimiter">(</span><a href="#246234" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">handlers</a><span class="delimiter">)</span>
            <a href="#242248" title="(key: GenMSIL.this.global.icodes.BasicBlock, value: GenMSIL.this.global.icodes.ExceptionHandler)Unit">beginCatchBlock</a><span class="delimiter">(</span><a href="#246172" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span> = <a href="#246231" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>

        <span class="comment">// are there try blocks starting at b?</span>
        <span class="keyword">val</span> <a href="#246176" title="(List[GenMSIL.this.global.icodes.ExceptionHandler], List[GenMSIL.this.global.icodes.ExceptionHandler])" class="delimiter">(</a><a href="#246175" title="List[GenMSIL.this.global.icodes.ExceptionHandler]" id="246176">newHandlers</a>, <a href="#246175" title="List[GenMSIL.this.global.icodes.ExceptionHandler]" id="246177">stillOpen</a><span class="delimiter">)</span> = <a href="#246145" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">openHandlers</a>.<span title="(p: GenMSIL.this.global.icodes.ExceptionHandler =&gt; Boolean)(List[GenMSIL.this.global.icodes.ExceptionHandler], List[GenMSIL.this.global.icodes.ExceptionHandler])">partition</span><span title="(List[GenMSIL.this.global.icodes.ExceptionHandler], List[GenMSIL.this.global.icodes.ExceptionHandler]) @unchecked" class="delimiter">(</span><a href="#246269" title="GenMSIL.this.global.icodes.ExceptionHandler">_</a>.<a href="../icode/ExceptionHandlers.scala.html#203162" title="(b: GenMSIL.this.global.icodes.BasicBlock)Boolean">covers</a><span class="delimiter">(</span><a href="#246172" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#246145" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">openHandlers</a> = <a href="#246177" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">stillOpen</a>

        <span class="keyword">val</span> <a title="scala.collection.immutable.Map[Int,List[GenMSIL.this.global.icodes.ExceptionHandler]]" id="246178">newHandlersBySize</a> = <a href="#246176" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">newHandlers</a>.<span title="(f: GenMSIL.this.global.icodes.ExceptionHandler =&gt; Int)scala.collection.immutable.Map[Int,List[GenMSIL.this.global.icodes.ExceptionHandler]]">groupBy</span><span class="delimiter">(</span><a href="#246287" title="GenMSIL.this.global.icodes.ExceptionHandler">_</a>.<a href="../icode/ExceptionHandlers.scala.html#203158" title="=&gt; scala.collection.immutable.Set[GenMSIL.this.global.icodes.BasicBlock]">covered</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
        <span class="comment">// big handlers first, smaller ones are nested inside the try of the big one</span>
        <span class="comment">// (checked by the assertions below)</span>
        <span class="keyword">val</span> <a title="List[Int]" id="246179">sizes</a> = <a href="#246178" title="scala.collection.immutable.Map[Int,List[GenMSIL.this.global.icodes.ExceptionHandler]]">newHandlersBySize</a>.<span title="=&gt; Iterable[Int]">keys</span>.<span title="=&gt; List[Int]">toList</span>.<span title="(lt: (Int, Int) =&gt; Boolean)List[Int]">sortWith</span><span class="delimiter">(</span><a href="#246293" title="Int">_</a> <span title="(x: Int)Boolean">&gt;</span> <a href="#246294" title="Int">_</a><span class="delimiter">)</span>

        <span class="keyword">val</span> <a title="scala.collection.mutable.ListBuffer[GenMSIL.this.global.icodes.ExceptionHandler]" id="246180">beginHandlers</a> = <span title="scala.collection.mutable.ListBuffer[GenMSIL.this.global.icodes.ExceptionHandler]" class="keyword">new</span> <span title="scala.collection.mutable.ListBuffer[GenMSIL.this.global.icodes.ExceptionHandler]">ListBuffer</span><span class="delimiter">[</span>ExceptionHandler<span class="delimiter">]</span>
        <span class="keyword">for</span> <span class="delimiter">(</span><a title="Int" id="246318">s</a> &lt;- <a href="#246179" title="(f: Int =&gt; scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]])Unit">sizes</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="List[GenMSIL.this.global.icodes.ExceptionHandler]" id="246319">sHandlers</a> = <a href="#246178" title="(key: Int)List[GenMSIL.this.global.icodes.ExceptionHandler]">newHandlersBySize</a><span class="delimiter">(</span><a href="#246318" title="Int">s</a><span class="delimiter">)</span>
          <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.ExceptionHandler" id="246366">h</a> &lt;- <a href="#246319" title="(f: GenMSIL.this.global.icodes.ExceptionHandler =&gt; Unit)Unit">sHandlers</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#246366" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a>.<a href="../icode/ExceptionHandlers.scala.html#203158" title="=&gt; scala.collection.immutable.Set[GenMSIL.this.global.icodes.BasicBlock]">covered</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#246319" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">sHandlers</a>.<span title="=&gt; GenMSIL.this.global.icodes.ExceptionHandler">head</span>.<a href="../icode/ExceptionHandlers.scala.html#203158" title="=&gt; scala.collection.immutable.Set[GenMSIL.this.global.icodes.BasicBlock]">covered</a>,
                   <span title="java.lang.String(&quot;bad nesting of exception handlers. same size, but not covering same blocks\012&quot;)" class="string">&quot;bad nesting of exception handlers. same size, but not covering same blocks\n&quot;</span><span title="(x$1: Any)java.lang.String">+</span>
                   <a href="#246366" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a> <span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span title="(x$1: Any)java.lang.String">+</span> <a href="#246319" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">sHandlers</a>.<span title="=&gt; GenMSIL.this.global.icodes.ExceptionHandler">head</span><span class="delimiter">)</span>
            <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#246366" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a>.<a href="../icode/ExceptionHandlers.scala.html#203153" title="=&gt; GenMSIL.this.global.icodes.TypeKind">resultKind</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#246319" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">sHandlers</a>.<span title="=&gt; GenMSIL.this.global.icodes.ExceptionHandler">head</span>.<a href="../icode/ExceptionHandlers.scala.html#203153" title="=&gt; GenMSIL.this.global.icodes.TypeKind">resultKind</a>,
                   <span title="java.lang.String(&quot;bad nesting of exception handlers. same size, but the same resultKind\012&quot;)" class="string">&quot;bad nesting of exception handlers. same size, but the same resultKind\n&quot;</span><span title="(x$1: Any)java.lang.String">+</span>
                   <a href="#246366" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a> <span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span title="(x$1: Any)java.lang.String">+</span> <a href="#246319" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">sHandlers</a>.<span title="=&gt; GenMSIL.this.global.icodes.ExceptionHandler">head</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.ExceptionHandler" id="246401">bigger</a> &lt;- <a href="#246180" title="(f: GenMSIL.this.global.icodes.ExceptionHandler =&gt; Unit)Unit">beginHandlers</a>; <a title="GenMSIL.this.global.icodes.ExceptionHandler" id="246420">h</a> &lt;- <a href="#246319" title="(f: GenMSIL.this.global.icodes.ExceptionHandler =&gt; Unit)Unit">sHandlers</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#246420" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a>.<a href="../icode/ExceptionHandlers.scala.html#203158" title="=&gt; scala.collection.immutable.Set[GenMSIL.this.global.icodes.BasicBlock]">covered</a>.<span title="(that: scala.collection.GenSet[GenMSIL.this.global.icodes.BasicBlock])Boolean">subsetOf</span><span class="delimiter">(</span><a href="#246401" title="GenMSIL.this.global.icodes.ExceptionHandler">bigger</a>.<a href="../icode/ExceptionHandlers.scala.html#203158" title="=&gt; scala.collection.immutable.Set[GenMSIL.this.global.icodes.BasicBlock]">covered</a><span class="delimiter">)</span>,
                   <span title="java.lang.String(&quot;bad nesting of exception handlers. try blocks of smaller handler are not nested in bigger one.\012&quot;)" class="string">&quot;bad nesting of exception handlers. try blocks of smaller handler are not nested in bigger one.\n&quot;</span><span title="(x$1: Any)java.lang.String">+</span>
                   <a href="#246420" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a> <span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span title="(x$1: Any)java.lang.String">+</span> <a href="#246401" title="GenMSIL.this.global.icodes.ExceptionHandler">bigger</a><span class="delimiter">)</span>
            <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#246420" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a>.<a href="../icode/ExceptionHandlers.scala.html#203163" title="=&gt; List[GenMSIL.this.global.icodes.BasicBlock]">blocks</a>.<span title="scala.collection.immutable.Set[GenMSIL.this.global.icodes.BasicBlock]">toSet</span>.<span title="(that: scala.collection.GenSet[GenMSIL.this.global.icodes.BasicBlock])Boolean">subsetOf</span><span class="delimiter">(</span><a href="#246401" title="GenMSIL.this.global.icodes.ExceptionHandler">bigger</a>.<a href="../icode/ExceptionHandlers.scala.html#203158" title="=&gt; scala.collection.immutable.Set[GenMSIL.this.global.icodes.BasicBlock]">covered</a><span class="delimiter">)</span>,
                   <span title="java.lang.String(&quot;bad nesting of exception handlers. catch blocks of smaller handler are not nested in bigger one.\012&quot;)" class="string">&quot;bad nesting of exception handlers. catch blocks of smaller handler are not nested in bigger one.\n&quot;</span><span title="(x$1: Any)java.lang.String">+</span>
                   <a href="#246420" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a> <span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span title="(x$1: Any)java.lang.String">+</span> <a href="#246401" title="GenMSIL.this.global.icodes.ExceptionHandler">bigger</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <a href="#246180" title="scala.collection.mutable.ListBuffer[GenMSIL.this.global.icodes.ExceptionHandler]">beginHandlers</a> <span title="(x: GenMSIL.this.global.icodes.ExceptionHandler)beginHandlers.type">+=</span> <a href="#246319" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">sHandlers</a>.<span title="=&gt; GenMSIL.this.global.icodes.ExceptionHandler">head</span>
          <a href="#246146" title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]">currentTryHandlers</a>.<span title="(elem: List[GenMSIL.this.global.icodes.ExceptionHandler])currentTryHandlers.type">push</span><span class="delimiter">(</span><a href="#246319" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">sHandlers</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#242246" title="(key: GenMSIL.this.global.icodes.BasicBlock, value: List[GenMSIL.this.global.icodes.ExceptionHandler])Unit">beginExBlock</a><span class="delimiter">(</span><a href="#246172" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span> = <a href="#246180" title="scala.collection.mutable.ListBuffer[GenMSIL.this.global.icodes.ExceptionHandler]">beginHandlers</a>.<span title="=&gt; List[GenMSIL.this.global.icodes.ExceptionHandler]">toList</span>
        <a href="#246144" title="scala.collection.mutable.HashSet[GenMSIL.this.global.icodes.BasicBlock]">visitedBlocks</a> <span title="(elem: GenMSIL.this.global.icodes.BasicBlock)visitedBlocks.type">+=</span> <a href="#246172" title="GenMSIL.this.global.icodes.BasicBlock">b</a>
      <span class="delimiter">}</span>

      <span class="comment">// if there handlers left (i.e. handlers covering nothing, or a</span>
      <span class="comment">// non-existent (dead) block), remove their catch-blocks.</span>
      <span class="keyword">val</span> <a title="List[GenMSIL.this.global.icodes.BasicBlock]" id="246148">liveBlocks</a> = <span title="List[GenMSIL.this.global.icodes.BasicBlock]" class="keyword">if</span> <span class="delimiter">(</span><a href="#246145" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">openHandlers</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#246065" title="List[GenMSIL.this.global.icodes.BasicBlock]">blocks</a> <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="#246065" title="List[GenMSIL.this.global.icodes.BasicBlock]">blocks</a>.<span title="(p: GenMSIL.this.global.icodes.BasicBlock =&gt; Boolean)List[GenMSIL.this.global.icodes.BasicBlock]">filter</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.BasicBlock" id="246474">b</a> =&gt; <a href="#246145" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">openHandlers</a>.<span title="(p: GenMSIL.this.global.icodes.ExceptionHandler =&gt; Boolean)Boolean">forall</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.ExceptionHandler" id="246483">h</a> =&gt; <span title="=&gt; Boolean">!</span><a href="#246483" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a>.<a href="../icode/ExceptionHandlers.scala.html#203163" title="=&gt; List[GenMSIL.this.global.icodes.BasicBlock]">blocks</a>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#246474" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="comment">/** There might be open handlers, but no more blocks. happens when try/catch end
       *  with `throw` or `return`
       *     def foo() { try { .. throw } catch { _ =&gt; .. throw } }
       *
       *  In this case we need some code after the catch block for the auto-generated
       *  `leave` instruction. So we're adding a (dead) `throw new Exception`.
       */</span>
      <span class="keyword">val</span> <a title="List[GenMSIL.this.global.icodes.ExceptionHandler]" id="246149">rest</a> = <a href="#246147" title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]">currentCatchHandlers</a>.<span title="(f: List[GenMSIL.this.global.icodes.ExceptionHandler] =&gt; GenMSIL.this.global.icodes.ExceptionHandler)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]],GenMSIL.this.global.icodes.ExceptionHandler,scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]])scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Stack.Coll,GenMSIL.this.global.icodes.ExceptionHandler,scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]]" class="delimiter">(</span><a title="List[GenMSIL.this.global.icodes.ExceptionHandler]" id="246500">handlers</a> =&gt; <span class="delimiter">{</span>
        <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#246500" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">handlers</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span>, <a href="#246500" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">handlers</a><span class="delimiter">)</span>
        <a href="#246500" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">handlers</a>.<span title="=&gt; GenMSIL.this.global.icodes.ExceptionHandler">head</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>.<span title="=&gt; List[GenMSIL.this.global.icodes.ExceptionHandler]">toList</span>

      <span title="List[GenMSIL.this.global.icodes.BasicBlock]" class="keyword">if</span> <span class="delimiter">(</span><a href="#246149" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">rest</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#246148" title="List[GenMSIL.this.global.icodes.BasicBlock]">liveBlocks</a>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.BasicBlock" id="246629">b</a> = <a href="#246066" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197791" title="=&gt; GenMSIL.this.global.icodes.Code">code</a>.<a href="../icode/Members.scala.html#197883" title="=&gt; GenMSIL.this.global.icodes.BasicBlock">newBlock</a>
        <a href="#246629" title="GenMSIL.this.global.icodes.BasicBlock">b</a>.<a href="../icode/BasicBlocks.scala.html#197729" title="(instrs: Seq[GenMSIL.this.global.icodes.Instruction])Unit">emit</a><span class="delimiter">(</span><span title="(elems: Product with GenMSIL.this.global.icodes.Instruction with Serializable*)Seq[Product with GenMSIL.this.global.icodes.Instruction with Serializable]">Seq</span><span class="delimiter">(</span>
          <a href="../icode/Opcodes.scala.html#208190" title="(kind: GenMSIL.this.global.icodes.REFERENCE)GenMSIL.this.global.icodes.opcodes.NEW">NEW</a><span class="delimiter">(</span><a href="../icode/TypeKinds.scala.html#196396" title="(cls: GenMSIL.this.global.icodes.global.Symbol)GenMSIL.this.global.icodes.REFERENCE">REFERENCE</a><span class="delimiter">(</span><a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106246" title="=&gt; GenMSIL.this.global.Symbol">ThrowableClass</a><span class="delimiter">)</span><span class="delimiter">)</span>,
          <a href="../icode/Opcodes.scala.html#206163" title="(typ: GenMSIL.this.global.icodes.TypeKind)GenMSIL.this.global.icodes.opcodes.DUP">DUP</a><span class="delimiter">(</span><a href="../icode/TypeKinds.scala.html#196396" title="(cls: GenMSIL.this.global.icodes.global.Symbol)GenMSIL.this.global.icodes.REFERENCE">REFERENCE</a><span class="delimiter">(</span><a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106220" title="=&gt; GenMSIL.this.global.Symbol">ObjectClass</a><span class="delimiter">)</span><span class="delimiter">)</span>,
          <a href="../icode/Opcodes.scala.html#208506" title="(method: GenMSIL.this.global.icodes.global.Symbol, style: GenMSIL.this.global.icodes.opcodes.InvokeStyle)GenMSIL.this.global.icodes.opcodes.CALL_METHOD">CALL_METHOD</a><span class="delimiter">(</span><a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106246" title="=&gt; GenMSIL.this.global.Symbol">ThrowableClass</a>.<a href="../../symtab/Symbols.scala.html#107597" title="=&gt; GenMSIL.this.global.Symbol">primaryConstructor</a>, <a href="../icode/Opcodes.scala.html#208828" title="(onInstance: Boolean)GenMSIL.this.global.icodes.opcodes.Static">Static</a><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span><span class="delimiter">)</span>,
          <a href="../icode/Opcodes.scala.html#202748" title="(clasz: GenMSIL.this.global.icodes.global.Symbol)GenMSIL.this.global.icodes.opcodes.THROW">THROW</a><span class="delimiter">(</span><a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106246" title="=&gt; GenMSIL.this.global.Symbol">ThrowableClass</a><span class="delimiter">)</span>
        <span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#246629" title="GenMSIL.this.global.icodes.BasicBlock">b</a>.<a href="../icode/BasicBlocks.scala.html#197733" title="()Unit">close</a>
        <a href="#242250" title="(key: GenMSIL.this.global.icodes.BasicBlock, value: List[GenMSIL.this.global.icodes.ExceptionHandler])Unit">endExBlock</a><span class="delimiter">(</span><a href="#246629" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span> = <a href="#246149" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">rest</a>
        <a href="#246148" title="List[GenMSIL.this.global.icodes.BasicBlock]">liveBlocks</a> <a href="#246673" title="(prefix: List[GenMSIL.this.global.icodes.BasicBlock])List[GenMSIL.this.global.icodes.BasicBlock]">:::</a> <span title="(xs: GenMSIL.this.global.icodes.BasicBlock*)List[GenMSIL.this.global.icodes.BasicBlock]">List</span><span class="delimiter">(</span><a href="#246629" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="comment">/**
     *  @param block the BasicBlock to emit code for
     *  @param next  the following BasicBlock, `null` if `block` is the last one
     */</span>
    <span class="keyword">def</span> <a title="(block: GenMSIL.this.global.icodes.BasicBlock, prev: GenMSIL.this.global.icodes.BasicBlock, next: GenMSIL.this.global.icodes.BasicBlock)Unit" id="242271">genBlock</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.BasicBlock" id="246097">block</a>: <a href="../icode/BasicBlocks.scala.html#96991" title="GenMSIL.this.global.icodes.BasicBlock">BasicBlock</a>, <a title="GenMSIL.this.global.icodes.BasicBlock" id="246098">prev</a>: <a href="../icode/BasicBlocks.scala.html#96991" title="GenMSIL.this.global.icodes.BasicBlock">BasicBlock</a>, <a title="GenMSIL.this.global.icodes.BasicBlock" id="246099">next</a>: <a href="../icode/BasicBlocks.scala.html#96991" title="GenMSIL.this.global.icodes.BasicBlock">BasicBlock</a><span class="delimiter">)</span> <span class="delimiter">{</span>

      <span class="keyword">def</span> <a title="(local: GenMSIL.this.global.icodes.Local, msg: String, loadAddr: Boolean)Unit" id="246688">loadLocalOrAddress</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.Local" id="246693">local</a>: <a href="../icode/Members.scala.html#96985" title="GenMSIL.this.global.icodes.Local">Local</a>, <a title="String" id="246694">msg</a> : <span title="String">String</span> , <a title="Boolean" id="246695">loadAddr</a> : <span title="Boolean">Boolean</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36747" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
          <a href="../../Global.scala.html#64883" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><a href="#246694" title="String">msg</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; for &quot;)" class="string">&quot; for &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#246693" title="GenMSIL.this.global.icodes.Local">local</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Boolean" id="246696">isArg</a> = <a href="#246693" title="GenMSIL.this.global.icodes.Local">local</a>.<a href="../icode/Members.scala.html#197983" title="=&gt; Boolean">arg</a>
        <span class="keyword">val</span> <a title="Int" id="246697">i</a> = <a href="#246693" title="GenMSIL.this.global.icodes.Local">local</a>.<a href="../icode/Members.scala.html#197986" title="=&gt; Int">index</a>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#246696" title="Boolean">isArg</a><span class="delimiter">)</span>
          <a href="#242274" title="(code: ch.epfl.lamp.compiler.msil.emit.ILGenerator, loadAddr: Boolean)(i: Int)Unit">loadArg</a><span class="delimiter">(</span><a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>, <a href="#246695" title="Boolean">loadAddr</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#246697" title="Int">i</a><span class="delimiter">)</span>
        <span class="keyword">else</span>
          <a href="#242275" title="(i: Int, local: GenMSIL.this.global.icodes.Local, code: ch.epfl.lamp.compiler.msil.emit.ILGenerator, loadAddr: Boolean)Unit">loadLocal</a><span class="delimiter">(</span><a href="#246697" title="Int">i</a>, <a href="#246693" title="GenMSIL.this.global.icodes.Local">local</a>, <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>, <a href="#246695" title="Boolean">loadAddr</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">def</span> <a title="(field: GenMSIL.this.global.Symbol, isStatic: Boolean, msg: String, loadAddr: Boolean)Unit" id="246689">loadFieldOrAddress</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="246864">field</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a>, <a title="Boolean" id="246865">isStatic</a>: <span title="Boolean">Boolean</span>, <a title="String" id="246866">msg</a>: <span title="String">String</span>, <a title="Boolean" id="246867">loadAddr</a> : <span title="Boolean">Boolean</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36747" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
          <a href="../../Global.scala.html#64883" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><a href="#246866" title="String">msg</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; with owner: &quot;)" class="string">&quot; with owner: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#246864" title="GenMSIL.this.global.Symbol">field</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.Symbol">owner</a> <span title="(x$1: Any)java.lang.String">+</span>
              <span title="java.lang.String(&quot; flags: &quot;)" class="string">&quot; flags: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="../../symtab/Flags.scala.html#24068" title="object scala.tools.nsc.symtab.Flags">Flags</a>.<span title="(flags: Long)String">flagsToString</span><span class="delimiter">(</span><a href="#246864" title="GenMSIL.this.global.Symbol">field</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.Symbol">owner</a>.<a href="../../symtab/Symbols.scala.html#107551" title="=&gt; Long">flags</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">var</span> <a title="ch.epfl.lamp.compiler.msil.FieldInfo" id="246868">fieldInfo</a> = <a href="../../symtab/clr/CLRTypes.scala.html#205480" title="=&gt; scala.collection.mutable.Map[GenMSIL.this.global.loaders.clrTypes.global.Symbol,ch.epfl.lamp.compiler.msil.FieldInfo]">fields</a>.<span title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)Option[ch.epfl.lamp.compiler.msil.FieldInfo]">get</span><span class="delimiter">(</span><a href="#246864" title="GenMSIL.this.global.Symbol">field</a><span class="delimiter">)</span> <span title="ch.epfl.lamp.compiler.msil.FieldInfo" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.FieldInfo">Some</span><span class="delimiter">(</span><a title="ch.epfl.lamp.compiler.msil.FieldInfo" id="246878">fInfo</a><span class="delimiter">)</span> =&gt; <a href="#246878" title="ch.epfl.lamp.compiler.msil.FieldInfo">fInfo</a>
          <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.FieldInfo">None</span> =&gt;
            <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.FieldInfo" id="246879">fInfo</a> = <a href="#242296" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#246864" title="GenMSIL.this.global.Symbol">field</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.Symbol">owner</a><span class="delimiter">)</span>.<span title="(x$1: java.lang.String)ch.epfl.lamp.compiler.msil.FieldInfo">GetField</span><span class="delimiter">(</span><a href="#242281" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#246864" title="GenMSIL.this.global.Symbol">field</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="../../symtab/clr/CLRTypes.scala.html#205480" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol, value: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">fields</a><span class="delimiter">(</span><a href="#246864" title="GenMSIL.this.global.Symbol">field</a><span class="delimiter">)</span> = <a href="#246879" title="ch.epfl.lamp.compiler.msil.FieldInfo">fInfo</a>
            <a href="#246879" title="ch.epfl.lamp.compiler.msil.FieldInfo">fInfo</a>
        <span class="delimiter">}</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#246868" title="ch.epfl.lamp.compiler.msil.FieldInfo">fieldInfo</a>.<span title="()Boolean">IsVolatile</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Volatile</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#246868" title="ch.epfl.lamp.compiler.msil.FieldInfo">fieldInfo</a>.<span title="()Boolean">IsLiteral</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#246867" title="Boolean">loadAddr</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">Emit</span><span class="delimiter">(</span><span title="ch.epfl.lamp.compiler.msil.emit.OpCode" class="keyword">if</span> <span class="delimiter">(</span><a href="#246865" title="Boolean">isStatic</a><span class="delimiter">)</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldsflda</span> <span class="keyword">else</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldflda</span>, <a href="#246868" title="ch.epfl.lamp.compiler.msil.FieldInfo">fieldInfo</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
            <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">Emit</span><span class="delimiter">(</span><span title="ch.epfl.lamp.compiler.msil.emit.OpCode" class="keyword">if</span> <span class="delimiter">(</span><a href="#246865" title="Boolean">isStatic</a><span class="delimiter">)</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldsfld</span> <span class="keyword">else</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldfld</span>, <a href="#246868" title="ch.epfl.lamp.compiler.msil.FieldInfo">fieldInfo</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#246867" title="Boolean">loadAddr</a>, <span title="java.lang.String(&quot;can\'t take AddressOf a literal field (not even with readonly. prefix) because no memory was allocated to such field ...&quot;)" class="string">&quot;can't take AddressOf a literal field (not even with readonly. prefix) because no memory was allocated to such field ...&quot;</span><span class="delimiter">)</span>
          <span class="comment">// TODO the above can be overcome by loading the value, boxing, and finally unboxing. An address to a copy of the raw value will be on the stack.</span>
         <span class="comment">/*  We perform `field inlining' as required by CLR.
          *  Emit as for a CONSTANT ICode stmt, with the twist that the constant value is available
          *  as a java.lang.Object and its .NET type allows constant initialization in CLR, i.e. that type
          *  is one of I1, I2, I4, I8, R4, R8, CHAR, BOOLEAN, STRING, or CLASS (in this last case,
          *  only accepting nullref as value). See Table 9-1 in Lidin's book on ILAsm. */</span>
          <span class="keyword">val</span> <a title="java.lang.Object" id="246894">value</a> = <a href="#246868" title="ch.epfl.lamp.compiler.msil.FieldInfo">fieldInfo</a>.<span title="()java.lang.Object">getValue</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#246894" title="java.lang.Object">value</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldnull</span><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="246903">typ</a> = <span title="ch.epfl.lamp.compiler.msil.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="#246868" title="ch.epfl.lamp.compiler.msil.FieldInfo">fieldInfo</a>.<span title="ch.epfl.lamp.compiler.msil.Type">FieldType</span>.<span title="()Boolean">IsEnum</span><span class="delimiter">)</span> <a href="#246868" title="ch.epfl.lamp.compiler.msil.FieldInfo">fieldInfo</a>.<span title="ch.epfl.lamp.compiler.msil.Type">FieldType</span>.<span title="()ch.epfl.lamp.compiler.msil.Type">getUnderlyingType</span>
                      <span class="keyword">else</span> <a href="#246868" title="ch.epfl.lamp.compiler.msil.FieldInfo">fieldInfo</a>.<span title="ch.epfl.lamp.compiler.msil.Type">FieldType</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#246903" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205450" title="=&gt; ch.epfl.lamp.compiler.msil.Type">STRING</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: String)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldstr</span>, <a href="#246894" title="java.lang.Object">value</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="String" class="delimiter">[</span><span title="String">String</span><span class="delimiter">]</span><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#246903" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205435" title="=&gt; ch.epfl.lamp.compiler.msil.Type">BOOLEAN</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="ch.epfl.lamp.compiler.msil.emit.OpCode" class="keyword">if</span> <span class="delimiter">(</span><a href="#246894" title="java.lang.Object">value</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Boolean" class="delimiter">[</span><span title="Boolean">Boolean</span><span class="delimiter">]</span><span class="delimiter">)</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_1</span>
                           <span class="keyword">else</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_0</span><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#246903" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205402" title="=&gt; ch.epfl.lamp.compiler.msil.Type">BYTE</a> <span title="(x: Boolean)Boolean">||</span> <a href="#246903" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205405" title="=&gt; ch.epfl.lamp.compiler.msil.Type">UBYTE</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#242273" title="(value: Int, code: ch.epfl.lamp.compiler.msil.emit.ILGenerator)Unit">loadI4</a><span class="delimiter">(</span><a href="#246894" title="java.lang.Object">value</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="=&gt; Int" class="delimiter">[</span><span title="Byte">Byte</span><span class="delimiter">]</span>, <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#246903" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205408" title="=&gt; ch.epfl.lamp.compiler.msil.Type">SHORT</a> <span title="(x: Boolean)Boolean">||</span> <a href="#246903" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205411" title="=&gt; ch.epfl.lamp.compiler.msil.Type">USHORT</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#242273" title="(value: Int, code: ch.epfl.lamp.compiler.msil.emit.ILGenerator)Unit">loadI4</a><span class="delimiter">(</span><a href="#246894" title="java.lang.Object">value</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Int" class="delimiter">[</span><span title="Int">Int</span><span class="delimiter">]</span>, <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#246903" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205414" title="=&gt; ch.epfl.lamp.compiler.msil.Type">CHAR</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#242273" title="(value: Int, code: ch.epfl.lamp.compiler.msil.emit.ILGenerator)Unit">loadI4</a><span class="delimiter">(</span><a href="#246894" title="java.lang.Object">value</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="=&gt; Int" class="delimiter">[</span><span title="Char">Char</span><span class="delimiter">]</span>, <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#246903" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205417" title="=&gt; ch.epfl.lamp.compiler.msil.Type">INT</a> <span title="(x: Boolean)Boolean">||</span> <a href="#246903" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205420" title="=&gt; ch.epfl.lamp.compiler.msil.Type">UINT</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#242273" title="(value: Int, code: ch.epfl.lamp.compiler.msil.emit.ILGenerator)Unit">loadI4</a><span class="delimiter">(</span><a href="#246894" title="java.lang.Object">value</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Int" class="delimiter">[</span><span title="Int">Int</span><span class="delimiter">]</span>, <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#246903" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205423" title="=&gt; ch.epfl.lamp.compiler.msil.Type">LONG</a> <span title="(x: Boolean)Boolean">||</span> <a href="#246903" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205426" title="=&gt; ch.epfl.lamp.compiler.msil.Type">ULONG</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Long)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I8</span>, <a href="#246894" title="java.lang.Object">value</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Long" class="delimiter">[</span><span title="Long">Long</span><span class="delimiter">]</span><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#246903" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205429" title="=&gt; ch.epfl.lamp.compiler.msil.Type">FLOAT</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Float)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_R4</span>, <a href="#246894" title="java.lang.Object">value</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Float" class="delimiter">[</span><span title="Float">Float</span><span class="delimiter">]</span><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#246903" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205432" title="=&gt; ch.epfl.lamp.compiler.msil.Type">DOUBLE</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Double)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_R8</span>, <a href="#246894" title="java.lang.Object">value</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Double" class="delimiter">[</span><span title="Double">Double</span><span class="delimiter">]</span><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
              <span class="comment">/* TODO one more case is described in Partition II, 16.2: bytearray(...) */</span>
              <a href="../../symtab/SymbolTable.scala.html#64790" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Unknown type for static literal field: &quot;)" class="string">&quot;Unknown type for static literal field: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#246868" title="ch.epfl.lamp.compiler.msil.FieldInfo">fieldInfo</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="comment">/** Creating objects works differently on .NET. On the JVM
       *  - NEW(type) =&gt; reference on Stack
       *  - DUP, load arguments, CALL_METHOD(constructor)
       *
       * On .NET, the NEW and DUP are ignored, but we emit a special method call
       *  - load arguments
       *  - NewObj(constructor) =&gt; reference on stack
       *
       * This variable tells whether the previous instruction was a NEW,
       * we expect a DUP which is not emitted. */</span>
      <span class="keyword">var</span> <a title="Boolean" id="246690">previousWasNEW</a> = <span title="Boolean(false)" class="keyword">false</span>

      <span class="keyword">var</span> <a title="Int" id="246691">lastLineNr</a>: <span title="Int">Int</span> = <span title="Int(0)" class="int">0</span>
      <span class="keyword">var</span> <a title="GenMSIL.this.global.Position" id="246692">lastPos</a>: <a href="../../util/Position.scala.html#30588" title="GenMSIL.this.global.Position">Position</a> = <a href="../../symtab/Positions.scala.html#67902" title="=&gt; tools.nsc.util.NoPosition.type">NoPosition</a>


      <span class="comment">// EndExceptionBlock must happen before MarkLabel because it adds the</span>
      <span class="comment">// Leave instruction. Otherwise, labels(block) points to the Leave</span>
      <span class="comment">// (inside the catch) instead of the instruction afterwards.</span>
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="List[GenMSIL.this.global.icodes.ExceptionHandler]" id="246986">handlers</a> &lt;- <a href="#242250" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,List[GenMSIL.this.global.icodes.ExceptionHandler]]">endExBlock</a>.<span title="(key: GenMSIL.this.global.icodes.BasicBlock)Option[List[GenMSIL.this.global.icodes.ExceptionHandler]]">get</span><span title="(f: List[GenMSIL.this.global.icodes.ExceptionHandler] =&gt; Unit)Unit" class="delimiter">(</span><a href="#246097" title="GenMSIL.this.global.icodes.BasicBlock">block</a><span class="delimiter">)</span>; <a title="GenMSIL.this.global.icodes.ExceptionHandler" id="247006">exh</a> &lt;- <a href="#246986" title="(f: GenMSIL.this.global.icodes.ExceptionHandler =&gt; Unit)Unit">handlers</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#242253" title="=&gt; scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">currentHandlers</a>.<span title="()GenMSIL.this.global.icodes.ExceptionHandler">pop</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="keyword">for</span> <span class="delimiter">(</span><a title="ch.epfl.lamp.compiler.msil.emit.Label" id="247014">l</a> &lt;- <a href="#242268" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.ExceptionHandler,ch.epfl.lamp.compiler.msil.emit.Label]">endFinallyLabels</a>.<span title="(key: GenMSIL.this.global.icodes.ExceptionHandler)Option[ch.epfl.lamp.compiler.msil.emit.Label]">get</span><span title="(f: ch.epfl.lamp.compiler.msil.emit.Label =&gt; Unit)Unit" class="delimiter">(</span><a href="#247006" title="GenMSIL.this.global.icodes.ExceptionHandler">exh</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">MarkLabel</span><span class="delimiter">(</span><a href="#247014" title="ch.epfl.lamp.compiler.msil.emit.Label">l</a><span class="delimiter">)</span>
        <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="()Unit">EndExceptionBlock</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">MarkLabel</span><span class="delimiter">(</span><a href="#242239" title="(key: GenMSIL.this.global.icodes.BasicBlock)ch.epfl.lamp.compiler.msil.emit.Label">labels</a><span class="delimiter">(</span><a href="#246097" title="GenMSIL.this.global.icodes.BasicBlock">block</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36747" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
        <a href="../../Global.scala.html#64883" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Generating code for block: &quot;)" class="string">&quot;Generating code for block: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#246097" title="GenMSIL.this.global.icodes.BasicBlock">block</a><span class="delimiter">)</span>

      <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.ExceptionHandler" id="247055">handler</a> &lt;- <a href="#242248" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,GenMSIL.this.global.icodes.ExceptionHandler]">beginCatchBlock</a>.<span title="(key: GenMSIL.this.global.icodes.BasicBlock)Option[GenMSIL.this.global.icodes.ExceptionHandler]">get</span><span title="(f: GenMSIL.this.global.icodes.ExceptionHandler =&gt; Unit)Unit" class="delimiter">(</span><a href="#246097" title="GenMSIL.this.global.icodes.BasicBlock">block</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#242253" title="=&gt; scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">currentHandlers</a>.<span title="=&gt; Boolean">isEmpty</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#242253" title="=&gt; scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">currentHandlers</a>.<span title="=&gt; GenMSIL.this.global.icodes.ExceptionHandler">top</span>.<a href="../icode/ExceptionHandlers.scala.html#203158" title="=&gt; scala.collection.immutable.Set[GenMSIL.this.global.icodes.BasicBlock]">covered</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#247055" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a>.<a href="../icode/ExceptionHandlers.scala.html#203158" title="=&gt; scala.collection.immutable.Set[GenMSIL.this.global.icodes.BasicBlock]">covered</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#242253" title="=&gt; scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">currentHandlers</a>.<span title="()GenMSIL.this.global.icodes.ExceptionHandler">pop</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#242253" title="=&gt; scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">currentHandlers</a>.<span title="(elem: GenMSIL.this.global.icodes.ExceptionHandler)scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">push</span><span class="delimiter">(</span><a href="#247055" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#247055" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a>.<a href="../icode/ExceptionHandlers.scala.html#203141" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">cls</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/Symbols.scala.html#67339" title="object GenMSIL.this.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="comment">// `finally` blocks are represented the same as `catch`, but with no catch-type</span>
          <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="()Unit">BeginFinallyBlock</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="247120">t</a> = <a href="#242296" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#247055" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a>.<a href="../icode/ExceptionHandlers.scala.html#203141" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">cls</a><span class="delimiter">)</span>
          <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(exceptionType: ch.epfl.lamp.compiler.msil.Type)Unit">BeginCatchBlock</span><span class="delimiter">(</span><a href="#247120" title="ch.epfl.lamp.compiler.msil.Type">t</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="List[GenMSIL.this.global.icodes.ExceptionHandler]" id="247129">handlers</a> &lt;- <a href="#242246" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,List[GenMSIL.this.global.icodes.ExceptionHandler]]">beginExBlock</a>.<span title="(key: GenMSIL.this.global.icodes.BasicBlock)Option[List[GenMSIL.this.global.icodes.ExceptionHandler]]">get</span><span title="(f: List[GenMSIL.this.global.icodes.ExceptionHandler] =&gt; Unit)Unit" class="delimiter">(</span><a href="#246097" title="GenMSIL.this.global.icodes.BasicBlock">block</a><span class="delimiter">)</span>; <a title="GenMSIL.this.global.icodes.ExceptionHandler" id="247149">exh</a> &lt;- <a href="#247129" title="(f: GenMSIL.this.global.icodes.ExceptionHandler =&gt; Unit)Unit">handlers</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#242253" title="=&gt; scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">currentHandlers</a>.<span title="(elem: GenMSIL.this.global.icodes.ExceptionHandler)scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">push</span><span class="delimiter">(</span><a href="#247149" title="GenMSIL.this.global.icodes.ExceptionHandler">exh</a><span class="delimiter">)</span>
        <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="()Unit">BeginExceptionBlock</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.Instruction" id="247173">instr</a> &lt;- <a href="../icode/BasicBlocks.scala.html#197715" title="(f: GenMSIL.this.global.icodes.Instruction =&gt; Unit)Unit">block</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">try</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Int" id="247174">currentLineNr</a> = <a href="#247173" title="GenMSIL.this.global.icodes.Instruction">instr</a>.<a href="../icode/Opcodes.scala.html#198010" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../../util/Position.scala.html#97235" title="=&gt; Int">line</a>
          <span class="keyword">val</span> <a title="Boolean" id="247175">skip</a> = <span title="Boolean" class="keyword">if</span><span class="delimiter">(</span><a href="#247173" title="GenMSIL.this.global.icodes.Instruction">instr</a>.<a href="../icode/Opcodes.scala.html#198010" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../../util/Position.scala.html#97211" title="=&gt; Boolean">isRange</a><span class="delimiter">)</span> <a href="#247173" title="GenMSIL.this.global.icodes.Instruction">instr</a>.<a href="../icode/Opcodes.scala.html#198010" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../../util/Position.scala.html#97234" title="(pos: scala.tools.nsc.util.Position)Boolean">sameRange</a><span class="delimiter">(</span><a href="#246692" title="GenMSIL.this.global.Position">lastPos</a><span class="delimiter">)</span> <span class="keyword">else</span> <span class="delimiter">(</span><a href="#247174" title="Int">currentLineNr</a> <span title="(x: Int)Boolean">==</span> <a href="#246691" title="Int">lastLineNr</a><span class="delimiter">)</span>;  
          <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#247175" title="Boolean">skip</a> <span title="(x: Boolean)Boolean">||</span> <span title="=&gt; Boolean">!</span><a href="#242242" title="=&gt; Boolean">dbFilenameSeen</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="java.lang.String" id="247193">fileName</a> = <span title="java.lang.String" class="keyword">if</span><span class="delimiter">(</span><a href="#242242" title="=&gt; Boolean">dbFilenameSeen</a><span class="delimiter">)</span> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span> <span class="keyword">else</span> <span class="delimiter">{</span><a href="#242242" title="(x$1: Boolean)Unit">dbFilenameSeen</a> = <span title="Boolean(true)" class="keyword">true</span>; <a href="#242234" title="(iclass: GenMSIL.this.global.icodes.IClass)String">ilasmFileName</a><span class="delimiter">(</span><a href="#242199" title="=&gt; GenMSIL.this.global.icodes.IClass">clasz</a><span class="delimiter">)</span><span class="delimiter">}</span>; 
            <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#247173" title="GenMSIL.this.global.icodes.Instruction">instr</a>.<a href="../icode/Opcodes.scala.html#198010" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../../util/Position.scala.html#97211" title="=&gt; Boolean">isRange</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="keyword">val</span> <a title="Int" id="247194">startLine</a> = <a href="#247173" title="GenMSIL.this.global.icodes.Instruction">instr</a>.<a href="../icode/Opcodes.scala.html#198010" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../../util/Position.scala.html#97226" title="=&gt; scala.tools.nsc.util.Position">focusStart</a>.<a href="../../util/Position.scala.html#97235" title="=&gt; Int">line</a>
              <span class="keyword">val</span> <a title="Int" id="247195">endLine</a>   = <a href="#247173" title="GenMSIL.this.global.icodes.Instruction">instr</a>.<a href="../icode/Opcodes.scala.html#198010" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../../util/Position.scala.html#97228" title="=&gt; scala.tools.nsc.util.Position">focusEnd</a>.<a href="../../util/Position.scala.html#97235" title="=&gt; Int">line</a>
              <span class="keyword">val</span> <a title="Int" id="247196">startCol</a>  = <a href="#247173" title="GenMSIL.this.global.icodes.Instruction">instr</a>.<a href="../icode/Opcodes.scala.html#198010" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../../util/Position.scala.html#97226" title="=&gt; scala.tools.nsc.util.Position">focusStart</a>.<a href="../../util/Position.scala.html#97236" title="=&gt; Int">column</a> 
              <span class="keyword">val</span> <a title="Int" id="247197">endCol</a>    = <a href="#247173" title="GenMSIL.this.global.icodes.Instruction">instr</a>.<a href="../icode/Opcodes.scala.html#198010" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../../util/Position.scala.html#97228" title="=&gt; scala.tools.nsc.util.Position">focusEnd</a>.<a href="../../util/Position.scala.html#97236" title="=&gt; Int">column</a>
              <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(startLine: Int, endLine: Int, startCol: Int, endCol: Int, filename: String)Unit">setPosition</span><span class="delimiter">(</span><a href="#247194" title="Int">startLine</a>, <a href="#247195" title="Int">endLine</a>, <a href="#247196" title="Int">startCol</a>, <a href="#247197" title="Int">endCol</a>, <a href="#247193" title="java.lang.String">fileName</a><span class="delimiter">)</span> 
            <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
              <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(line: Int, filename: String)Unit">setPosition</span><span class="delimiter">(</span><a href="#247173" title="GenMSIL.this.global.icodes.Instruction">instr</a>.<a href="../icode/Opcodes.scala.html#198010" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../../util/Position.scala.html#97235" title="=&gt; Int">line</a>, <a href="#247193" title="java.lang.String">fileName</a><span class="delimiter">)</span> 
            <span class="delimiter">}</span>
            <a href="#246691" title="Int">lastLineNr</a> = <a href="#247174" title="Int">currentLineNr</a> 
            <a href="#246692" title="GenMSIL.this.global.Position">lastPos</a> = <a href="#247173" title="GenMSIL.this.global.icodes.Instruction">instr</a>.<a href="../icode/Opcodes.scala.html#198010" title="=&gt; scala.tools.nsc.util.Position">pos</a>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span> <span class="keyword">case</span> <span title="Unit">_</span>: <span title="UnsupportedOperationException">UnsupportedOperationException</span> =&gt; <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">}</span>

        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#246690" title="Boolean">previousWasNEW</a><span class="delimiter">)</span>
          <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#247173" title="GenMSIL.this.global.icodes.Instruction">instr</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="../icode/Opcodes.scala.html#113769" title="GenMSIL.this.global.icodes.opcodes.DUP">DUP</a><span class="delimiter">]</span>, <a href="#246097" title="GenMSIL.this.global.icodes.BasicBlock">block</a><span class="delimiter">)</span>

        <a href="#247173" title="GenMSIL.this.global.icodes.Instruction">instr</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Unit">THIS</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="247213">clasz</a><span class="delimiter">)</span> =&gt;
            <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldarg_0</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">CONSTANT</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Constant" id="247217">const</a><span class="delimiter">)</span> =&gt;
            <a href="#247217" title="GenMSIL.this.global.icodes.global.Constant">const</a>.<span title="=&gt; Int">tag</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <span title="Unit">UnitTag</span>    =&gt; <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">BooleanTag</span> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="ch.epfl.lamp.compiler.msil.emit.OpCode" class="keyword">if</span> <span class="delimiter">(</span><a href="#247217" title="GenMSIL.this.global.icodes.global.Constant">const</a>.<span title="=&gt; Boolean">booleanValue</span><span class="delimiter">)</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_1</span>
                                            <span class="keyword">else</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_0</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">ByteTag</span>    =&gt; <a href="#242273" title="(value: Int, code: ch.epfl.lamp.compiler.msil.emit.ILGenerator)Unit">loadI4</a><span class="delimiter">(</span><a href="#247217" title="GenMSIL.this.global.icodes.global.Constant">const</a>.<span title="=&gt; Int">byteValue</span>, <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">ShortTag</span>   =&gt; <a href="#242273" title="(value: Int, code: ch.epfl.lamp.compiler.msil.emit.ILGenerator)Unit">loadI4</a><span class="delimiter">(</span><a href="#247217" title="GenMSIL.this.global.icodes.global.Constant">const</a>.<span title="=&gt; Int">shortValue</span>, <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">CharTag</span>    =&gt; <a href="#242273" title="(value: Int, code: ch.epfl.lamp.compiler.msil.emit.ILGenerator)Unit">loadI4</a><span class="delimiter">(</span><a href="#247217" title="GenMSIL.this.global.icodes.global.Constant">const</a>.<span title="=&gt; Int">charValue</span>, <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">IntTag</span>     =&gt; <a href="#242273" title="(value: Int, code: ch.epfl.lamp.compiler.msil.emit.ILGenerator)Unit">loadI4</a><span class="delimiter">(</span><a href="#247217" title="GenMSIL.this.global.icodes.global.Constant">const</a>.<span title="=&gt; Int">intValue</span>, <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">LongTag</span>    =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Long)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I8</span>, <a href="#247217" title="GenMSIL.this.global.icodes.global.Constant">const</a>.<span title="=&gt; Long">longValue</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">FloatTag</span>   =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Float)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_R4</span>, <a href="#247217" title="GenMSIL.this.global.icodes.global.Constant">const</a>.<span title="=&gt; Float">floatValue</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">DoubleTag</span>  =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Double)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_R8</span>, <a href="#247217" title="GenMSIL.this.global.icodes.global.Constant">const</a>.<span title="=&gt; Double">doubleValue</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">StringTag</span>  =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: String)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldstr</span>, <a href="#247217" title="GenMSIL.this.global.icodes.global.Constant">const</a>.<span title="=&gt; String">stringValue</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">NullTag</span>    =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldnull</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">ClassTag</span>   =&gt;
                <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.Type)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldtoken</span>, <a href="#242294" title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#247217" title="GenMSIL.this.global.icodes.global.Constant">const</a>.<span title="=&gt; GenMSIL.this.global.icodes.global.Type">typeValue</span><span class="delimiter">)</span><span class="delimiter">)</span>
                <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#242159" title="=&gt; ch.epfl.lamp.compiler.msil.MethodInfo">TYPE_FROM_HANDLE</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Nothing">_</span>          =&gt; <a href="../../symtab/SymbolTable.scala.html#64790" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Unknown constant value: &quot;)" class="string">&quot;Unknown constant value: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#247217" title="GenMSIL.this.global.icodes.global.Constant">const</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>

          <span class="keyword">case</span> <span title="Unit">LOAD_ARRAY_ITEM</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="247255">kind</a><span class="delimiter">)</span> =&gt;
            <span class="delimiter">(</span><a href="#247255" title="GenMSIL.this.global.icodes.TypeKind">kind</a>: @<a href="../icode/TypeKinds.scala.html#97012" title="GenMSIL.this.global.icodes.TypeKind @unchecked">unchecked</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97020" title="Unit">BOOL</a>           =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldelem_I1</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97022" title="Unit">BYTE</a>           =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldelem_I1</span><span class="delimiter">)</span> <span class="comment">// I1 for System.SByte, i.e. a scala.Byte </span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97024" title="Unit">SHORT</a>          =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldelem_I2</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97026" title="Unit">CHAR</a>           =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldelem_U2</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97028" title="Unit">INT</a>            =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldelem_I4</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97030" title="Unit">LONG</a>           =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldelem_I8</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97032" title="Unit">FLOAT</a>          =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldelem_R4</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97034" title="Unit">DOUBLE</a>         =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldelem_R8</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">REFERENCE</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="247273">cls</a><span class="delimiter">)</span> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldelem_Ref</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">ARRAY</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="247277">elem</a><span class="delimiter">)</span>    =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldelem_Ref</span><span class="delimiter">)</span>

              <span class="comment">// case UNIT is not possible: an Array[Unit] will be an</span>
              <span class="comment">//  Array[scala.runtime.BoxedUnit] (-&gt; case REFERENCE)</span>
            <span class="delimiter">}</span>

          <span class="keyword">case</span> <span title="Unit">LOAD_LOCAL</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.Local" id="247281">local</a><span class="delimiter">)</span> =&gt; <a href="#246688" title="(local: GenMSIL.this.global.icodes.Local, msg: String, loadAddr: Boolean)Unit">loadLocalOrAddress</a><span class="delimiter">(</span><a href="#247281" title="GenMSIL.this.global.icodes.Local">local</a>, <span title="java.lang.String(&quot;load_local&quot;)" class="string">&quot;load_local&quot;</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">CIL_LOAD_LOCAL_ADDRESS</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.Local" id="247283">local</a><span class="delimiter">)</span> =&gt; <a href="#246688" title="(local: GenMSIL.this.global.icodes.Local, msg: String, loadAddr: Boolean)Unit">loadLocalOrAddress</a><span class="delimiter">(</span><a href="#247283" title="GenMSIL.this.global.icodes.Local">local</a>, <span title="java.lang.String(&quot;cil_load_local_address&quot;)" class="string">&quot;cil_load_local_address&quot;</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">LOAD_FIELD</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="247286">field</a>, <a title="Boolean" id="247287">isStatic</a><span class="delimiter">)</span> =&gt; <a href="#246689" title="(field: GenMSIL.this.global.Symbol, isStatic: Boolean, msg: String, loadAddr: Boolean)Unit">loadFieldOrAddress</a><span class="delimiter">(</span><a href="#247286" title="GenMSIL.this.global.icodes.global.Symbol">field</a>, <a href="#247287" title="Boolean">isStatic</a>, <span title="java.lang.String(&quot;load_field&quot;)" class="string">&quot;load_field&quot;</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">CIL_LOAD_FIELD_ADDRESS</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="247290">field</a>, <a title="Boolean" id="247291">isStatic</a><span class="delimiter">)</span> =&gt; <a href="#246689" title="(field: GenMSIL.this.global.Symbol, isStatic: Boolean, msg: String, loadAddr: Boolean)Unit">loadFieldOrAddress</a><span class="delimiter">(</span><a href="#247290" title="GenMSIL.this.global.icodes.global.Symbol">field</a>, <a href="#247291" title="Boolean">isStatic</a>, <span title="java.lang.String(&quot;cil_load_field_address&quot;)" class="string">&quot;cil_load_field_address&quot;</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">CIL_LOAD_ARRAY_ITEM_ADDRESS</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="247293">kind</a><span class="delimiter">)</span> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.Type)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldelema</span>, <a href="#242293" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#247293" title="GenMSIL.this.global.icodes.TypeKind">kind</a><span class="delimiter">)</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">CIL_NEWOBJ</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="247305">msym</a><span class="delimiter">)</span> =&gt;
            <span title="(assertion: Boolean)Unit">assert</span><span class="delimiter">(</span><a href="#247305" title="GenMSIL.this.global.icodes.global.Symbol">msym</a>.<a href="../../symtab/Symbols.scala.html#107473" title="=&gt; Boolean">isClassConstructor</a><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.ConstructorInfo" id="247306">constructorInfo</a>: <span title="ch.epfl.lamp.compiler.msil.ConstructorInfo">ConstructorInfo</span> = <a href="#242321" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.ConstructorInfo">getConstructor</a><span class="delimiter">(</span><a href="#247305" title="GenMSIL.this.global.icodes.global.Symbol">msym</a><span class="delimiter">)</span>
            <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.ConstructorInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Newobj</span>, <a href="#247306" title="ch.epfl.lamp.compiler.msil.ConstructorInfo">constructorInfo</a><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">LOAD_MODULE</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="247316">module</a><span class="delimiter">)</span> =&gt;
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36747" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
              <a href="../../Global.scala.html#64883" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Generating LOAD_MODULE for: &quot;)" class="string">&quot;Generating LOAD_MODULE for: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#242330" title="(sym: GenMSIL.this.global.Symbol)String">showsym</a><span class="delimiter">(</span><a href="#247316" title="GenMSIL.this.global.icodes.global.Symbol">module</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldsfld</span>, <a href="#242306" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.FieldInfo">getModuleInstanceField</a><span class="delimiter">(</span><a href="#247316" title="GenMSIL.this.global.icodes.global.Symbol">module</a><span class="delimiter">)</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">STORE_ARRAY_ITEM</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="247325">kind</a><span class="delimiter">)</span> =&gt;
            <span class="delimiter">(</span><a href="#247325" title="GenMSIL.this.global.icodes.TypeKind">kind</a>: @<a href="../icode/TypeKinds.scala.html#97012" title="GenMSIL.this.global.icodes.TypeKind @unchecked">unchecked</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97020" title="Unit">BOOL</a>           =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stelem_I1</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97022" title="Unit">BYTE</a>           =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stelem_I1</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97024" title="Unit">SHORT</a>          =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stelem_I2</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97026" title="Unit">CHAR</a>           =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stelem_I2</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97028" title="Unit">INT</a>            =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stelem_I4</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97030" title="Unit">LONG</a>           =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stelem_I8</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97032" title="Unit">FLOAT</a>          =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stelem_R4</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97034" title="Unit">DOUBLE</a>         =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stelem_R8</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">REFERENCE</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="247343">cls</a><span class="delimiter">)</span> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stelem_Ref</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">ARRAY</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="247347">elem</a><span class="delimiter">)</span>    =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stelem_Ref</span><span class="delimiter">)</span> <span class="comment">// @TODO: test this! (occurs when calling a Array[Object]* vararg param method)</span>

              <span class="comment">// case UNIT not possible (see comment at LOAD_ARRAY_ITEM)</span>
            <span class="delimiter">}</span>

          <span class="keyword">case</span> <span title="Unit">STORE_LOCAL</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.Local" id="247351">local</a><span class="delimiter">)</span> =&gt;
            <span class="keyword">val</span> <a title="Boolean" id="247352">isArg</a> = <a href="#247351" title="GenMSIL.this.global.icodes.Local">local</a>.<a href="../icode/Members.scala.html#197983" title="=&gt; Boolean">arg</a>
            <span class="keyword">val</span> <a title="Int" id="247353">i</a> = <a href="#247351" title="GenMSIL.this.global.icodes.Local">local</a>.<a href="../icode/Members.scala.html#197986" title="=&gt; Int">index</a>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36747" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
              <a href="../../Global.scala.html#64883" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;store_local for &quot;)" class="string">&quot;store_local for &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#247351" title="GenMSIL.this.global.icodes.Local">local</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;, index &quot;)" class="string">&quot;, index &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#247353" title="Int">i</a><span class="delimiter">)</span>

            <span class="comment">// there are some locals defined by the compiler that</span>
            <span class="comment">// are isArg and are need to be stored.</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#247352" title="Boolean">isArg</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#247353" title="Int">i</a> <span title="(x: Int)Boolean">&gt;=</span> -<span title="Int(-128)" class="int">128</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#247353" title="Int">i</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(127)" class="int">127</span><span class="delimiter">)</span>
                <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Int)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Starg_S</span>, <a href="#247353" title="Int">i</a><span class="delimiter">)</span>
              <span class="keyword">else</span>
                <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Int)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Starg</span>, <a href="#247353" title="Int">i</a><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
              <a href="#247353" title="Int">i</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <span title="Unit" class="int">0</span> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stloc_0</span><span class="delimiter">)</span>
                <span class="keyword">case</span> <span title="Unit" class="int">1</span> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stloc_1</span><span class="delimiter">)</span>
                <span class="keyword">case</span> <span title="Unit" class="int">2</span> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stloc_2</span><span class="delimiter">)</span>
                <span class="keyword">case</span> <span title="Unit" class="int">3</span> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stloc_3</span><span class="delimiter">)</span>
                <span class="keyword">case</span> <span title="Unit">_</span>      =&gt;
                  <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#247353" title="Int">i</a> <span title="(x: Int)Boolean">&gt;=</span> -<span title="Int(-128)" class="int">128</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#247353" title="Int">i</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(127)" class="int">127</span><span class="delimiter">)</span>
                    <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.emit.LocalBuilder)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stloc_S</span>, <a href="#242290" title="(key: GenMSIL.this.global.icodes.Local)ch.epfl.lamp.compiler.msil.emit.LocalBuilder">localBuilders</a><span class="delimiter">(</span><a href="#247351" title="GenMSIL.this.global.icodes.Local">local</a><span class="delimiter">)</span><span class="delimiter">)</span>
                  <span class="keyword">else</span>
                    <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.emit.LocalBuilder)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stloc</span>, <a href="#242290" title="(key: GenMSIL.this.global.icodes.Local)ch.epfl.lamp.compiler.msil.emit.LocalBuilder">localBuilders</a><span class="delimiter">(</span><a href="#247351" title="GenMSIL.this.global.icodes.Local">local</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>

          <span class="keyword">case</span> <span title="Unit">STORE_THIS</span><span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;
            <span class="comment">// this only works for impl classes because the self parameter comes first</span>
            <span class="comment">// in the method signature. If that changes, this code has to be revisited.</span>
            <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Int)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Starg_S</span>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">STORE_FIELD</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="247434">field</a>, <a title="Boolean" id="247435">isStatic</a><span class="delimiter">)</span> =&gt;
            <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.FieldInfo" id="247436">fieldInfo</a> = <a href="../../symtab/clr/CLRTypes.scala.html#205480" title="=&gt; scala.collection.mutable.Map[GenMSIL.this.global.loaders.clrTypes.global.Symbol,ch.epfl.lamp.compiler.msil.FieldInfo]">fields</a>.<span title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)Option[ch.epfl.lamp.compiler.msil.FieldInfo]">get</span><span class="delimiter">(</span><a href="#247434" title="GenMSIL.this.global.icodes.global.Symbol">field</a><span class="delimiter">)</span> <span title="ch.epfl.lamp.compiler.msil.FieldInfo" class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.FieldInfo">Some</span><span class="delimiter">(</span><a title="ch.epfl.lamp.compiler.msil.FieldInfo" id="247440">fInfo</a><span class="delimiter">)</span> =&gt; <a href="#247440" title="ch.epfl.lamp.compiler.msil.FieldInfo">fInfo</a>
              <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.FieldInfo">None</span> =&gt;
                <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.FieldInfo" id="247441">fInfo</a> = <a href="#242296" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#247434" title="GenMSIL.this.global.icodes.global.Symbol">field</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">owner</a><span class="delimiter">)</span>.<span title="(x$1: java.lang.String)ch.epfl.lamp.compiler.msil.FieldInfo">GetField</span><span class="delimiter">(</span><a href="#242281" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#247434" title="GenMSIL.this.global.icodes.global.Symbol">field</a><span class="delimiter">)</span><span class="delimiter">)</span>
                <a href="../../symtab/clr/CLRTypes.scala.html#205480" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol, value: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">fields</a><span class="delimiter">(</span><a href="#247434" title="GenMSIL.this.global.icodes.global.Symbol">field</a><span class="delimiter">)</span> = <a href="#247441" title="ch.epfl.lamp.compiler.msil.FieldInfo">fInfo</a>
                <a href="#247441" title="ch.epfl.lamp.compiler.msil.FieldInfo">fInfo</a>
            <span class="delimiter">}</span>
            <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">Emit</span><span class="delimiter">(</span><span title="ch.epfl.lamp.compiler.msil.emit.OpCode" class="keyword">if</span> <span class="delimiter">(</span><a href="#247435" title="Boolean">isStatic</a><span class="delimiter">)</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stsfld</span> <span class="keyword">else</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stfld</span>, <a href="#247436" title="ch.epfl.lamp.compiler.msil.FieldInfo">fieldInfo</a><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">CALL_PRIMITIVE</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.Primitive" id="247449">primitive</a><span class="delimiter">)</span> =&gt;
            <a href="#242272" title="(primitive: GenMSIL.this.global.icodes.Primitive, pos: GenMSIL.this.global.Position)Unit">genPrimitive</a><span class="delimiter">(</span><a href="#247449" title="GenMSIL.this.global.icodes.Primitive">primitive</a>, <a href="#247173" title="GenMSIL.this.global.icodes.Instruction">instr</a>.<a href="../icode/Opcodes.scala.html#198010" title="=&gt; scala.tools.nsc.util.Position">pos</a><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">CALL_METHOD</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="247455">msym</a>, <a title="GenMSIL.this.global.icodes.opcodes.InvokeStyle" id="247456">style</a><span class="delimiter">)</span> =&gt;
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#247455" title="GenMSIL.this.global.icodes.global.Symbol">msym</a>.<a href="../../symtab/Symbols.scala.html#107473" title="=&gt; Boolean">isClassConstructor</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.ConstructorInfo" id="247457">constructorInfo</a>: <span title="ch.epfl.lamp.compiler.msil.ConstructorInfo">ConstructorInfo</span> = <a href="#242321" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.ConstructorInfo">getConstructor</a><span class="delimiter">(</span><a href="#247455" title="GenMSIL.this.global.icodes.global.Symbol">msym</a><span class="delimiter">)</span>
              <span class="delimiter">(</span><a href="#247456" title="GenMSIL.this.global.icodes.opcodes.InvokeStyle">style</a>: @<a href="../icode/Opcodes.scala.html#113787" title="GenMSIL.this.global.icodes.opcodes.InvokeStyle @unchecked">unchecked</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
                <span class="comment">// normal constructor calls are Static..</span>
                <span class="keyword">case</span> <span title="Unit">Static</span><span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;
                  <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#242202" title="=&gt; GenMSIL.this.global.icodes.IMethod">method</a>.<a href="../icode/Members.scala.html#197788" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../symtab/Symbols.scala.html#107473" title="=&gt; Boolean">isClassConstructor</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#242202" title="=&gt; GenMSIL.this.global.icodes.IMethod">method</a>.<a href="../icode/Members.scala.html#197788" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">owner</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#247455" title="GenMSIL.this.global.icodes.global.Symbol">msym</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">owner</a><span class="delimiter">)</span>
                    <span class="comment">// we're generating a constructor (method: IMethod is a constructor), and we're</span>
                    <span class="comment">// calling another constructor of the same class.</span>

                    <span class="comment">// @LUC TODO: this can probably break, namely when having: class A { def this() { new A() } }</span>
                    <span class="comment">// instead, we should instruct the CALL_METHOD with additional information, know whether it's</span>
                    <span class="comment">// an instance creation constructor call or not.</span>
                    <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.ConstructorInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#247457" title="ch.epfl.lamp.compiler.msil.ConstructorInfo">constructorInfo</a><span class="delimiter">)</span>
                  <span class="keyword">else</span>
                    <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.ConstructorInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Newobj</span>, <a href="#247457" title="ch.epfl.lamp.compiler.msil.ConstructorInfo">constructorInfo</a><span class="delimiter">)</span>
                <span class="keyword">case</span> <span title="Unit">SuperCall</span><span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;
                  <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.ConstructorInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#247457" title="ch.epfl.lamp.compiler.msil.ConstructorInfo">constructorInfo</a><span class="delimiter">)</span>
                  <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#242303" title="(sym: GenMSIL.this.global.Symbol)Boolean">isStaticModule</a><span class="delimiter">(</span><a href="#242199" title="=&gt; GenMSIL.this.global.icodes.IClass">clasz</a>.<a href="../icode/Members.scala.html#97411" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
                      <a href="#242288" title="=&gt; scala.collection.mutable.HashSet[GenMSIL.this.global.Symbol]">notInitializedModules</a>.<span title="(elem: GenMSIL.this.global.Symbol)Boolean">contains</span><span class="delimiter">(</span><a href="#242199" title="=&gt; GenMSIL.this.global.icodes.IClass">clasz</a>.<a href="../icode/Members.scala.html#97411" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
                      <a href="#242202" title="=&gt; GenMSIL.this.global.icodes.IMethod">method</a>.<a href="../icode/Members.scala.html#197788" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../symtab/Symbols.scala.html#107473" title="=&gt; Boolean">isClassConstructor</a><span class="delimiter">)</span>
                    <span class="delimiter">{</span>
                      <a href="#242288" title="=&gt; scala.collection.mutable.HashSet[GenMSIL.this.global.Symbol]">notInitializedModules</a> <span title="(elem: GenMSIL.this.global.Symbol)BytecodeGenerator.this.notInitializedModules.type">-=</span> <a href="#242199" title="=&gt; GenMSIL.this.global.icodes.IClass">clasz</a>.<a href="../icode/Members.scala.html#97411" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>
                      <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldarg_0</span><span class="delimiter">)</span>
                      <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stsfld</span>, <a href="#242306" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.FieldInfo">getModuleInstanceField</a><span class="delimiter">(</span><a href="#242199" title="=&gt; GenMSIL.this.global.icodes.IClass">clasz</a>.<a href="../icode/Members.scala.html#97411" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a><span class="delimiter">)</span><span class="delimiter">)</span>
                    <span class="delimiter">}</span>
              <span class="delimiter">}</span>

            <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
              
              <span class="keyword">var</span> <a title="Boolean" id="247503">doEmit</a> = <span title="Boolean(true)" class="keyword">true</span>
              <a href="#242297" title="(sym: GenMSIL.this.global.Symbol)Option[ch.epfl.lamp.compiler.msil.Type]">getTypeOpt</a><span class="delimiter">(</span><a href="#247455" title="GenMSIL.this.global.icodes.global.Symbol">msym</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">owner</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="ch.epfl.lamp.compiler.msil.Type" id="247509">typ</a><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#247509" title="ch.epfl.lamp.compiler.msil.Type">typ</a>.<span title="()Boolean">IsEnum</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
                  <span class="keyword">def</span> <a title="()Unit" id="247510">negBool</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
                    <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_0</span><span class="delimiter">)</span>
                    <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ceq</span><span class="delimiter">)</span>
                  <span class="delimiter">}</span>
                  <a href="#247503" title="Boolean">doEmit</a> = <span title="Boolean(false)" class="keyword">false</span>
                  <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.global.Name" id="247511">name</a> = <a href="#247455" title="GenMSIL.this.global.icodes.global.Symbol">msym</a>.<a href="../../symtab/Symbols.scala.html#107548" title="=&gt; GenMSIL.this.global.icodes.global.Name">name</a>
                  <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#247511" title="GenMSIL.this.global.icodes.global.Name">name</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../symtab/StdNames.scala.html#67724" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../symtab/StdNames.scala.html#115676" title="=&gt; GenMSIL.this.global.TermName">EQ</a><span class="delimiter">)</span>       <span class="delimiter">{</span> <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ceq</span><span class="delimiter">)</span> <span class="delimiter">}</span>
                  <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#247511" title="GenMSIL.this.global.icodes.global.Name">name</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../symtab/StdNames.scala.html#67724" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../symtab/StdNames.scala.html#115700" title="=&gt; GenMSIL.this.global.TermName">NE</a><span class="delimiter">)</span>  <span class="delimiter">{</span> <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ceq</span><span class="delimiter">)</span>; <a href="#247510" title="()Unit">negBool</a> <span class="delimiter">}</span>
                  <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#247511" title="GenMSIL.this.global.icodes.global.Name">name</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../symtab/StdNames.scala.html#67724" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../symtab/StdNames.scala.html#115692" title="=&gt; GenMSIL.this.global.TermName">LT</a><span class="delimiter">)</span>  <span class="delimiter">{</span> <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Clt</span><span class="delimiter">)</span> <span class="delimiter">}</span>
                  <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#247511" title="GenMSIL.this.global.icodes.global.Name">name</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../symtab/StdNames.scala.html#67724" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../symtab/StdNames.scala.html#115686" title="=&gt; GenMSIL.this.global.TermName">LE</a><span class="delimiter">)</span>  <span class="delimiter">{</span> <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Cgt</span><span class="delimiter">)</span>; <a href="#247510" title="()Unit">negBool</a> <span class="delimiter">}</span>
                  <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#247511" title="GenMSIL.this.global.icodes.global.Name">name</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../symtab/StdNames.scala.html#67724" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../symtab/StdNames.scala.html#115682" title="=&gt; GenMSIL.this.global.TermName">GT</a><span class="delimiter">)</span>  <span class="delimiter">{</span> <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Cgt</span><span class="delimiter">)</span> <span class="delimiter">}</span>
                  <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#247511" title="GenMSIL.this.global.icodes.global.Name">name</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../symtab/StdNames.scala.html#67724" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../symtab/StdNames.scala.html#115680" title="=&gt; GenMSIL.this.global.TermName">GE</a><span class="delimiter">)</span>  <span class="delimiter">{</span> <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Clt</span><span class="delimiter">)</span>; <a href="#247510" title="()Unit">negBool</a> <span class="delimiter">}</span>
                  <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#247511" title="GenMSIL.this.global.icodes.global.Name">name</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../symtab/StdNames.scala.html#67724" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../symtab/StdNames.scala.html#115702" title="=&gt; GenMSIL.this.global.TermName">OR</a><span class="delimiter">)</span>  <span class="delimiter">{</span> <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Or</span><span class="delimiter">)</span> <span class="delimiter">}</span>
                  <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#247511" title="GenMSIL.this.global.icodes.global.Name">name</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../symtab/StdNames.scala.html#67724" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../symtab/StdNames.scala.html#115670" title="=&gt; GenMSIL.this.global.TermName">AND</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">And</span><span class="delimiter">)</span> <span class="delimiter">}</span>
                  <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#247511" title="GenMSIL.this.global.icodes.global.Name">name</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../symtab/StdNames.scala.html#67724" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../symtab/StdNames.scala.html#115708" title="=&gt; GenMSIL.this.global.TermName">XOR</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Xor</span><span class="delimiter">)</span> <span class="delimiter">}</span>
                  <span class="keyword">else</span>
                    <a href="#247503" title="Boolean">doEmit</a> = <span title="Boolean(true)" class="keyword">true</span>
                <span class="delimiter">}</span>
                <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>

              <span class="comment">// method: implicit view(FunctionX[PType0, PType1, ...,PTypeN, ResType]):DelegateType</span>
              <span class="keyword">val</span> <a href="#247505" title="(Boolean, GenMSIL.this.global.Type, GenMSIL.this.global.Type)" class="delimiter">(</a><a href="#247504" title="Boolean" id="247505">isDelegateView</a>, <a href="#247504" title="GenMSIL.this.global.Type" id="247506">paramType</a>, <a href="#247504" title="GenMSIL.this.global.Type" id="247507">resType</a><span class="delimiter">)</span> = <a href="../../symtab/SymbolTable.scala.html#64815" title="(ph: scala.tools.nsc.Phase)(op: =&gt; (Boolean, GenMSIL.this.global.Type, GenMSIL.this.global.Type))(Boolean, GenMSIL.this.global.Type, GenMSIL.this.global.Type)">atPhase</a><span class="delimiter">(</span><a href="../../Global.scala.html#64991" title="=&gt; GenMSIL.this.global.Run">currentRun</a>.<a href="../../Global.scala.html#72332" title="=&gt; scala.tools.nsc.Phase">typerPhase</a><span class="delimiter">)</span> <span title="(Boolean, GenMSIL.this.global.Type, GenMSIL.this.global.Type) @unchecked" class="delimiter">{</span>
                <a href="#247455" title="GenMSIL.this.global.icodes.global.Symbol">msym</a>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.icodes.global.Type">tpe</a> <span title="(Boolean, GenMSIL.this.global.Type, GenMSIL.this.global.Type)" class="keyword">match</span> <span class="delimiter">{</span>
                  <span class="keyword">case</span> <span title="(Boolean, GenMSIL.this.global.Type, GenMSIL.this.global.Type)">MethodType</span><span class="delimiter">(</span><a title="List[GenMSIL.this.global.Symbol]" id="247540">params</a>, <a title="GenMSIL.this.global.Type" id="247541">resultType</a><span class="delimiter">)</span>
                  <span class="keyword">if</span> <span class="delimiter">(</span><a href="#247540" title="List[GenMSIL.this.global.Symbol]">params</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#247455" title="GenMSIL.this.global.icodes.global.Symbol">msym</a>.<a href="../../symtab/Symbols.scala.html#107548" title="=&gt; GenMSIL.this.global.icodes.global.Name">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/StdNames.scala.html#67724" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../symtab/StdNames.scala.html#115604" title="=&gt; GenMSIL.this.global.nme.NameType">view_</a><span class="delimiter">)</span> =&gt;
                    <span class="keyword">val</span> <a title="GenMSIL.this.global.Type" id="247552">paramType</a> = <a href="#247540" title="(n: Int)GenMSIL.this.global.Symbol">params</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.Type">tpe</a>
                    <span class="keyword">val</span> <a title="Boolean" id="247553">isDel</a> = <a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106511" title="(delegateType: GenMSIL.this.global.Type, functionType: GenMSIL.this.global.Type)Boolean">isCorrespondingDelegate</a><span class="delimiter">(</span><a href="#247541" title="GenMSIL.this.global.Type">resultType</a>, <a href="#247552" title="GenMSIL.this.global.Type">paramType</a><span class="delimiter">)</span>
                    <span title="(_1: Boolean, _2: GenMSIL.this.global.Type, _3: GenMSIL.this.global.Type)(Boolean, GenMSIL.this.global.Type, GenMSIL.this.global.Type)" class="delimiter">(</span><a href="#247553" title="Boolean">isDel</a>, <a href="#247552" title="GenMSIL.this.global.Type">paramType</a>, <a href="#247541" title="GenMSIL.this.global.Type">resultType</a><span class="delimiter">)</span>
                  <span class="keyword">case</span> <span title="(Boolean, Null, Null)">_</span> =&gt; <span title="(_1: Boolean, _2: Null, _3: Null)(Boolean, Null, Null)" class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span>, <span title="Null(null)" class="keyword">null</span>, <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
                <span class="delimiter">}</span>
              <span class="delimiter">}</span>
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#247503" title="Boolean">doEmit</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#247505" title="Boolean">isDelegateView</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="#247503" title="Boolean">doEmit</a> = <span title="Boolean(false)" class="keyword">false</span>
                <a href="#242318" title="(functionType: GenMSIL.this.global.Type, delegateType: GenMSIL.this.global.Type)Unit">createDelegateCaller</a><span class="delimiter">(</span><a href="#247506" title="GenMSIL.this.global.Type">paramType</a>, <a href="#247507" title="GenMSIL.this.global.Type">resType</a><span class="delimiter">)</span>
              <span class="delimiter">}</span>

              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#247503" title="Boolean">doEmit</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
                  <span class="delimiter">(</span><a href="#247455" title="GenMSIL.this.global.icodes.global.Symbol">msym</a>.<a href="../../symtab/Symbols.scala.html#107548" title="=&gt; GenMSIL.this.global.icodes.global.Name">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/StdNames.scala.html#67724" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../symtab/StdNames.scala.html#115704" title="=&gt; GenMSIL.this.global.TermName">PLUS</a> <span title="(x: Boolean)Boolean">||</span> <a href="#247455" title="GenMSIL.this.global.icodes.global.Symbol">msym</a>.<a href="../../symtab/Symbols.scala.html#107548" title="=&gt; GenMSIL.this.global.icodes.global.Name">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/StdNames.scala.html#67724" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../symtab/StdNames.scala.html#115694" title="=&gt; GenMSIL.this.global.TermName">MINUS</a><span class="delimiter">)</span>
                  <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205495" title="(t: ch.epfl.lamp.compiler.msil.Type)Boolean">isDelegateType</a><span class="delimiter">(</span><a href="#242294" title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#247455" title="GenMSIL.this.global.icodes.global.Symbol">msym</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">owner</a>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.icodes.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="delimiter">{</span>
                <a href="#247503" title="Boolean">doEmit</a> = <span title="Boolean(false)" class="keyword">false</span>
                <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="248317">methodInfo</a>: <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span> = <a href="#242323" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.MethodInfo">getMethod</a><span class="delimiter">(</span><a href="#247455" title="GenMSIL.this.global.icodes.global.Symbol">msym</a><span class="delimiter">)</span>
                <span class="comment">// call it as a static method, even if the compiler (symbol) thinks it's virtual</span>
                <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#248317" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a><span class="delimiter">)</span>
                <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.Type)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Castclass</span>, <a href="#242294" title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#247455" title="GenMSIL.this.global.icodes.global.Symbol">msym</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">owner</a>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.icodes.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>

              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#247503" title="Boolean">doEmit</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106506" title="=&gt; List[GenMSIL.this.global.Symbol]">Delegate_scalaCallers</a>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#247455" title="GenMSIL.this.global.icodes.global.Symbol">msym</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="#247503" title="Boolean">doEmit</a> = <span title="Boolean(false)" class="keyword">false</span>
                <span class="keyword">val</span> <a title="GenMSIL.this.global.Symbol" id="248333">methodSym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a> = <a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106509" title="(key: GenMSIL.this.global.Symbol)GenMSIL.this.global.Symbol">Delegate_scalaCallerTargets</a><span class="delimiter">(</span><a href="#247455" title="GenMSIL.this.global.icodes.global.Symbol">msym</a><span class="delimiter">)</span>
                <span class="keyword">val</span> <a title="GenMSIL.this.global.Type" id="248334">delegateType</a>: <a href="../../symtab/Types.scala.html#67392" title="GenMSIL.this.global.Type">Type</a> = <a href="#247455" title="GenMSIL.this.global.icodes.global.Symbol">msym</a>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.icodes.global.Type">tpe</a> <span title="GenMSIL.this.global.Type" class="keyword">match</span> <span class="delimiter">{</span>
                  <span class="keyword">case</span> <span title="GenMSIL.this.global.Type">MethodType</span><span class="delimiter">(</span>_, <a title="GenMSIL.this.global.Type" id="248366">retType</a><span class="delimiter">)</span> =&gt; <a href="#248366" title="GenMSIL.this.global.Type">retType</a>
                  <span class="keyword">case</span> <span title="Nothing">_</span> =&gt; <a href="../../symtab/SymbolTable.scala.html#64790" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="java.lang.String(&quot;not a method type: &quot;)" class="string">&quot;not a method type: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#247455" title="GenMSIL.this.global.icodes.global.Symbol">msym</a>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.icodes.global.Type">tpe</a><span class="delimiter">)</span>
                <span class="delimiter">}</span>
                <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="248335">methodInfo</a>: <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span> = <a href="#242323" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.MethodInfo">getMethod</a><span class="delimiter">(</span><a href="#248333" title="GenMSIL.this.global.Symbol">methodSym</a><span class="delimiter">)</span>
                <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.ConstructorInfo" id="248336">delegCtor</a> = <a href="#242294" title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#248334" title="GenMSIL.this.global.Type">delegateType</a><span class="delimiter">)</span>.<span title="(x$1: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.ConstructorInfo">GetConstructor</span><span class="delimiter">(</span><span title="(xs: ch.epfl.lamp.compiler.msil.Type*)(implicit evidence$2: scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type])Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span title="(clazz: java.lang.Class[_])scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type]" class="delimiter">(</span><a href="../../symtab/clr/CLRTypes.scala.html#205447" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MOBJECT</a>, <a href="#242161" title="=&gt; ch.epfl.lamp.compiler.msil.Type">INT_PTR</a><span class="delimiter">)</span><span class="delimiter">)</span>
                <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#248333" title="GenMSIL.this.global.Symbol">methodSym</a>.<a href="../../symtab/Symbols.scala.html#107525" title="=&gt; Boolean">isStatic</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                  <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldftn</span>, <a href="#248335" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a><span class="delimiter">)</span>
                <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
                  <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Dup</span><span class="delimiter">)</span>
                  <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldvirtftn</span>, <a href="#248335" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a><span class="delimiter">)</span>
                <span class="delimiter">}</span>
                <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.ConstructorInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Newobj</span>, <a href="#248336" title="ch.epfl.lamp.compiler.msil.ConstructorInfo">delegCtor</a><span class="delimiter">)</span>
              <span class="delimiter">}</span>

              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#247503" title="Boolean">doEmit</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="248413">methodInfo</a>: <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span> = <a href="#242323" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.MethodInfo">getMethod</a><span class="delimiter">(</span><a href="#247455" title="GenMSIL.this.global.icodes.global.Symbol">msym</a><span class="delimiter">)</span>
                <span class="delimiter">(</span><a href="#247456" title="GenMSIL.this.global.icodes.opcodes.InvokeStyle">style</a>: @<a href="../icode/Opcodes.scala.html#113787" title="GenMSIL.this.global.icodes.opcodes.InvokeStyle @unchecked">unchecked</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
                  <span class="keyword">case</span> <span title="Unit">SuperCall</span><span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;
                    <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#248413" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a><span class="delimiter">)</span>
                  <span class="keyword">case</span> <a href="../icode/Opcodes.scala.html#113788" title="Unit">Dynamic</a> =&gt;
                    <span class="comment">// methodInfo.DeclaringType is null for global methods </span>
                    <span class="keyword">val</span> <a title="Boolean" id="248419">isValuetypeMethod</a> = <span class="delimiter">(</span><a href="#248413" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a>.<span title="ch.epfl.lamp.compiler.msil.Type">DeclaringType</span> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span class="delimiter">(</span><a href="#248413" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a>.<span title="ch.epfl.lamp.compiler.msil.Type">DeclaringType</span>.<span title="()Boolean">IsValueType</span><span class="delimiter">)</span>
                    <span class="keyword">val</span> <a title="Boolean" id="248420">isValuetypeVirtualMethod</a> = <a href="#248419" title="Boolean">isValuetypeMethod</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span class="delimiter">(</span><a href="#248413" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a>.<span title="()Boolean">IsVirtual</span><span class="delimiter">)</span> 
                    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#242195" title="(elem: GenMSIL.this.global.Symbol)Boolean">dynToStatMapped</a><span class="delimiter">(</span><a href="#247455" title="GenMSIL.this.global.icodes.global.Symbol">msym</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                      <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#248413" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a><span class="delimiter">)</span>
                    <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#248420" title="Boolean">isValuetypeVirtualMethod</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                      <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.Type)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Constrained</span>, <a href="#248413" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a>.<span title="ch.epfl.lamp.compiler.msil.Type">DeclaringType</span><span class="delimiter">)</span>
                      <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Callvirt</span>, <a href="#248413" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a><span class="delimiter">)</span>
                    <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#248419" title="Boolean">isValuetypeMethod</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                      <span class="comment">// otherwise error &quot;Callvirt on a value type method&quot; ensues </span>
                      <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#248413" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a><span class="delimiter">)</span>
                    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
                      <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Callvirt</span>, <a href="#248413" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a><span class="delimiter">)</span>
                    <span class="delimiter">}</span>
                  <span class="keyword">case</span> <span title="Unit">Static</span><span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;
                    <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#248413" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a>.<span title="()Boolean">IsVirtual</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="()Boolean">Ldarg0WasJustEmitted</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                      <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Callvirt</span>, <a href="#248413" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a><span class="delimiter">)</span>
                    <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#248413" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a><span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>
            <span class="delimiter">}</span>

          <span class="keyword">case</span> <span title="Unit">BOX</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="248469">boxType</a><span class="delimiter">)</span> =&gt;
            <a href="#242319" title="(code: ch.epfl.lamp.compiler.msil.emit.ILGenerator, boxType: GenMSIL.this.global.icodes.TypeKind)Unit">emitBox</a><span class="delimiter">(</span><a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>, <a href="#248469" title="GenMSIL.this.global.icodes.TypeKind">boxType</a><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">UNBOX</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="248471">boxType</a><span class="delimiter">)</span> =&gt;
            <a href="#242320" title="(code: ch.epfl.lamp.compiler.msil.emit.ILGenerator, boxType: GenMSIL.this.global.icodes.TypeKind)Unit">emitUnbox</a><span class="delimiter">(</span><a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>, <a href="#248471" title="GenMSIL.this.global.icodes.TypeKind">boxType</a><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">CIL_UNBOX</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="248473">boxType</a><span class="delimiter">)</span> =&gt;
            <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.Type)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Unbox</span>, <a href="#242293" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#248473" title="GenMSIL.this.global.icodes.TypeKind">boxType</a><span class="delimiter">)</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">CIL_INITOBJ</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="248485">valueType</a><span class="delimiter">)</span> =&gt;
            <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.Type)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Initobj</span>, <a href="#242293" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#248485" title="GenMSIL.this.global.icodes.TypeKind">valueType</a><span class="delimiter">)</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">NEW</span><span class="delimiter">(</span>REFERENCE<span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="248498">cls</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
            <span class="comment">// the next instruction must be a DUP, see comment on `var previousWasNEW`</span>
            <a href="#246690" title="Boolean">previousWasNEW</a> = <span title="Boolean(true)" class="keyword">true</span>

          <span class="comment">// works also for arrays and reference-types</span>
          <span class="keyword">case</span> <span title="Unit">CREATE_ARRAY</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="248501">elem</a>, <a title="Int" id="248502">dims</a><span class="delimiter">)</span> =&gt;
            <span class="comment">// TODO: handle multi dimensional arrays</span>
            <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#248502" title="Int">dims</a> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span>, <span title="java.lang.String(&quot;Can\'t handle multi dimensional arrays&quot;)" class="string">&quot;Can't handle multi dimensional arrays&quot;</span><span class="delimiter">)</span>
            <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.Type)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Newarr</span>, <a href="#242293" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#248501" title="GenMSIL.this.global.icodes.TypeKind">elem</a><span class="delimiter">)</span><span class="delimiter">)</span>

          <span class="comment">// works for arrays and reference-types</span>
          <span class="keyword">case</span> <span title="Unit">IS_INSTANCE</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="248520">tpe</a><span class="delimiter">)</span> =&gt;
            <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.Type)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Isinst</span>, <a href="#242293" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#248520" title="GenMSIL.this.global.icodes.TypeKind">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldnull</span><span class="delimiter">)</span>
            <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ceq</span><span class="delimiter">)</span>
            <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_0</span><span class="delimiter">)</span>
            <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ceq</span><span class="delimiter">)</span>

          <span class="comment">// works for arrays and reference-types</span>
          <span class="comment">// part from the scala reference: &quot;S &lt;: T does not imply</span>
          <span class="comment">//  Array[S] &lt;: Array[T] in Scala. However, it is possible</span>
          <span class="comment">//  to cast an array of S to an array of T if such a cast</span>
          <span class="comment">//  is permitted in the host environment.&quot;</span>
          <span class="keyword">case</span> <span title="Unit">CHECK_CAST</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="248540">tpknd</a><span class="delimiter">)</span> =&gt;
            <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="248541">tMSIL</a> = <a href="#242293" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#248540" title="GenMSIL.this.global.icodes.TypeKind">tpknd</a><span class="delimiter">)</span>
              <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.Type)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Castclass</span>, <a href="#248541" title="ch.epfl.lamp.compiler.msil.Type">tMSIL</a><span class="delimiter">)</span>

          <span class="comment">// no SWITCH is generated when there's</span>
          <span class="comment">//  - a default case (&quot;case _ =&gt; ...&quot;) in the matching expr</span>
          <span class="comment">//  - OR is used (&quot;case 1 | 2 =&gt; ...&quot;)</span>
          <span class="keyword">case</span> <span title="Unit">SWITCH</span><span class="delimiter">(</span><a title="List[List[Int]]" id="248554">tags</a>, <a title="List[GenMSIL.this.global.icodes.BasicBlock]" id="248555">branches</a><span class="delimiter">)</span> =&gt;
            <span class="comment">// tags is List[List[Int]]; a list of integers for every label.</span>
            <span class="comment">//    if the int on stack is 4, and 4 is in the second list =&gt; jump</span>
            <span class="comment">//    to second label</span>
            <span class="comment">// branches is List[BasicBlock]</span>
            <span class="comment">//    the labels to jump to (the last one is the default one)</span>

            <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.LocalBuilder" id="248556">switchLocal</a> = <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(localType: ch.epfl.lamp.compiler.msil.Type)ch.epfl.lamp.compiler.msil.emit.LocalBuilder">DeclareLocal</span><span class="delimiter">(</span><a href="../../symtab/clr/CLRTypes.scala.html#205417" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MINT</a><span class="delimiter">)</span>
            <span class="comment">// several switch variables will appear with the same name in the</span>
            <span class="comment">//  assembly code, but this makes no truble</span>
            <a href="#248556" title="ch.epfl.lamp.compiler.msil.emit.LocalBuilder">switchLocal</a>.<span title="(name: String)Unit">SetLocalSymInfo</span><span class="delimiter">(</span><span title="java.lang.String(&quot;$switch_var&quot;)" class="string">&quot;$switch_var&quot;</span><span class="delimiter">)</span>

            <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.emit.LocalBuilder)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stloc</span>, <a href="#248556" title="ch.epfl.lamp.compiler.msil.emit.LocalBuilder">switchLocal</a><span class="delimiter">)</span>
            <span class="keyword">var</span> <a title="Int" id="248557">i</a> = <span title="Int(0)" class="int">0</span>
            <span class="keyword">for</span> <span class="delimiter">(</span><a title="List[Int]" id="248582">l</a> &lt;- <a href="#248554" title="(f: List[Int] =&gt; Unit)Unit">tags</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="keyword">var</span> <a title="ch.epfl.lamp.compiler.msil.emit.Label" id="248583">targetLabel</a> = <a href="#242239" title="(key: GenMSIL.this.global.icodes.BasicBlock)ch.epfl.lamp.compiler.msil.emit.Label">labels</a><span class="delimiter">(</span><a href="#248555" title="(n: Int)GenMSIL.this.global.icodes.BasicBlock">branches</a><span class="delimiter">(</span><a href="#248557" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="keyword">for</span> <span class="delimiter">(</span><a title="Int" id="248625">i</a> &lt;- <a href="#248582" title="(f: Int =&gt; Unit)Unit">l</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.emit.LocalBuilder)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldloc</span>, <a href="#248556" title="ch.epfl.lamp.compiler.msil.emit.LocalBuilder">switchLocal</a><span class="delimiter">)</span>
                <a href="#242273" title="(value: Int, code: ch.epfl.lamp.compiler.msil.emit.ILGenerator)Unit">loadI4</a><span class="delimiter">(</span><a href="#248625" title="Int">i</a>, <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a><span class="delimiter">)</span>
                <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Beq</span>, <a href="#248583" title="ch.epfl.lamp.compiler.msil.emit.Label">targetLabel</a><span class="delimiter">)</span>
              <span class="delimiter">}</span>
              <a href="#248557" title="Int">i</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
            <span class="delimiter">}</span>
            <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.Label" id="248558">defaultTarget</a> = <a href="#242239" title="(key: GenMSIL.this.global.icodes.BasicBlock)ch.epfl.lamp.compiler.msil.emit.Label">labels</a><span class="delimiter">(</span><a href="#248555" title="(n: Int)GenMSIL.this.global.icodes.BasicBlock">branches</a><span class="delimiter">(</span><a href="#248557" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#246099" title="GenMSIL.this.global.icodes.BasicBlock">next</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#248558" title="ch.epfl.lamp.compiler.msil.emit.Label">defaultTarget</a><span class="delimiter">)</span>
              <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Br</span>, <a href="#248558" title="ch.epfl.lamp.compiler.msil.emit.Label">defaultTarget</a><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">JUMP</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.BasicBlock" id="248671">whereto</a><span class="delimiter">)</span> =&gt;
            <span class="keyword">val</span> <a href="#248673" title="(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label])" class="delimiter">(</a><a href="#248672" title="Boolean" id="248673">leaveHandler</a>, <a href="#248672" title="Boolean" id="248674">leaveFinally</a>, <a href="#248672" title="Option[ch.epfl.lamp.compiler.msil.emit.Label]" id="248675">lfTarget</a><span class="delimiter">)</span> = <a href="#242276" title="(from: GenMSIL.this.global.icodes.BasicBlock, to: GenMSIL.this.global.icodes.BasicBlock)(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label])">leavesHandler</a><span title="(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label]) @unchecked" class="delimiter">(</span><a href="#246097" title="GenMSIL.this.global.icodes.BasicBlock">block</a>, <a href="#248671" title="GenMSIL.this.global.icodes.BasicBlock">whereto</a><span class="delimiter">)</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#248673" title="Boolean">leaveHandler</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#248674" title="Boolean">leaveFinally</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#248675" title="Option[ch.epfl.lamp.compiler.msil.emit.Label]">lfTarget</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Leave</span>, <a href="#248675" title="Option[ch.epfl.lamp.compiler.msil.emit.Label]">lfTarget</a>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.Label">get</span><span class="delimiter">)</span>
                <span class="keyword">else</span> <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Endfinally</span><span class="delimiter">)</span>
              <span class="delimiter">}</span> <span class="keyword">else</span>
                <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Leave</span>, <a href="#242239" title="(key: GenMSIL.this.global.icodes.BasicBlock)ch.epfl.lamp.compiler.msil.emit.Label">labels</a><span class="delimiter">(</span><a href="#248671" title="GenMSIL.this.global.icodes.BasicBlock">whereto</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#246099" title="GenMSIL.this.global.icodes.BasicBlock">next</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#248671" title="GenMSIL.this.global.icodes.BasicBlock">whereto</a><span class="delimiter">)</span>
              <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Br</span>, <a href="#242239" title="(key: GenMSIL.this.global.icodes.BasicBlock)ch.epfl.lamp.compiler.msil.emit.Label">labels</a><span class="delimiter">(</span><a href="#248671" title="GenMSIL.this.global.icodes.BasicBlock">whereto</a><span class="delimiter">)</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">CJUMP</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.BasicBlock" id="248746">success</a>, <a title="GenMSIL.this.global.icodes.BasicBlock" id="248747">failure</a>, <a title="GenMSIL.this.global.icodes.TestOp" id="248748">cond</a>, <a title="GenMSIL.this.global.icodes.TypeKind" id="248749">kind</a><span class="delimiter">)</span> =&gt;
            <span class="comment">// cond is TestOp (see Primitives.scala), and can take</span>
            <span class="comment">// values EQ, NE, LT, GE LE, GT</span>
            <span class="comment">// kind is TypeKind</span>
            <span class="keyword">val</span> <a title="Boolean" id="248750">isFloat</a> = <a href="#248749" title="GenMSIL.this.global.icodes.TypeKind">kind</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../icode/TypeKinds.scala.html#97032" title="object GenMSIL.this.global.icodes.FLOAT">FLOAT</a> <span title="(x: Boolean)Boolean">||</span> <a href="#248749" title="GenMSIL.this.global.icodes.TypeKind">kind</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../icode/TypeKinds.scala.html#97034" title="object GenMSIL.this.global.icodes.DOUBLE">DOUBLE</a>
            <span class="keyword">val</span> <a title="(GenMSIL.this.global.icodes.TestOp, ch.epfl.lamp.compiler.msil.emit.Label) =&gt; Unit" id="248751">emit</a> = <span class="delimiter">(</span>c: <a href="../icode/Primitives.scala.html#97104" title="GenMSIL.this.global.icodes.TestOp">TestOp</a>, l: <span title="ch.epfl.lamp.compiler.msil.emit.Label">Label</span><span class="delimiter">)</span> =&gt; <a href="#242278" title="(condition: GenMSIL.this.global.icodes.TestOp, dest: ch.epfl.lamp.compiler.msil.emit.Label, isFloat: Boolean)Unit">emitBr</a><span class="delimiter">(</span><a href="#248761" title="GenMSIL.this.global.icodes.TestOp">c</a>, <a href="#248762" title="ch.epfl.lamp.compiler.msil.emit.Label">l</a>, <a href="#248750" title="Boolean">isFloat</a><span class="delimiter">)</span>
            <a href="#242277" title="(block: GenMSIL.this.global.icodes.BasicBlock, cond: GenMSIL.this.global.icodes.TestOp, success: GenMSIL.this.global.icodes.BasicBlock, failure: GenMSIL.this.global.icodes.BasicBlock, next: GenMSIL.this.global.icodes.BasicBlock, emitBrFun: (GenMSIL.this.global.icodes.TestOp, ch.epfl.lamp.compiler.msil.emit.Label) =&gt; Unit)Unit">emitCondBr</a><span class="delimiter">(</span><a href="#246097" title="GenMSIL.this.global.icodes.BasicBlock">block</a>, <a href="#248748" title="GenMSIL.this.global.icodes.TestOp">cond</a>, <a href="#248746" title="GenMSIL.this.global.icodes.BasicBlock">success</a>, <a href="#248747" title="GenMSIL.this.global.icodes.BasicBlock">failure</a>, <a href="#246099" title="GenMSIL.this.global.icodes.BasicBlock">next</a>, <a href="#248751" title="(GenMSIL.this.global.icodes.TestOp, ch.epfl.lamp.compiler.msil.emit.Label) =&gt; Unit">emit</a><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">CZJUMP</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.BasicBlock" id="248778">success</a>, <a title="GenMSIL.this.global.icodes.BasicBlock" id="248779">failure</a>, <a title="GenMSIL.this.global.icodes.TestOp" id="248780">cond</a>, <a title="GenMSIL.this.global.icodes.TypeKind" id="248781">kind</a><span class="delimiter">)</span> =&gt;
            <a href="#242277" title="(block: GenMSIL.this.global.icodes.BasicBlock, cond: GenMSIL.this.global.icodes.TestOp, success: GenMSIL.this.global.icodes.BasicBlock, failure: GenMSIL.this.global.icodes.BasicBlock, next: GenMSIL.this.global.icodes.BasicBlock, emitBrFun: (GenMSIL.this.global.icodes.TestOp, ch.epfl.lamp.compiler.msil.emit.Label) =&gt; Unit)Unit">emitCondBr</a><span class="delimiter">(</span><a href="#246097" title="GenMSIL.this.global.icodes.BasicBlock">block</a>, <a href="#248780" title="GenMSIL.this.global.icodes.TestOp">cond</a>, <a href="#248778" title="GenMSIL.this.global.icodes.BasicBlock">success</a>, <a href="#248779" title="GenMSIL.this.global.icodes.BasicBlock">failure</a>, <a href="#246099" title="GenMSIL.this.global.icodes.BasicBlock">next</a>, <a href="#242279" title="(cond: GenMSIL.this.global.icodes.TestOp, dest: ch.epfl.lamp.compiler.msil.emit.Label)Unit">emitBrBool</a><span class="delimiter">(</span><a href="#248783" title="GenMSIL.this.global.icodes.TestOp">_</a>, <a href="#248784" title="ch.epfl.lamp.compiler.msil.emit.Label">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">RETURN</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="248789">kind</a><span class="delimiter">)</span> =&gt;
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#242253" title="=&gt; scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">currentHandlers</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span>
              <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ret</span><span class="delimiter">)</span>
            <span class="keyword">else</span> <span class="delimiter">{</span>
              <span class="keyword">val</span> <a href="#248794" title="(ch.epfl.lamp.compiler.msil.emit.LocalBuilder, ch.epfl.lamp.compiler.msil.emit.Label)" class="delimiter">(</a><a href="#248793" title="ch.epfl.lamp.compiler.msil.emit.LocalBuilder" id="248794">local</a>, <a href="#248793" title="ch.epfl.lamp.compiler.msil.emit.Label" id="248795">label</a><span class="delimiter">)</span> = <a href="#242267" title="(kind: GenMSIL.this.global.icodes.TypeKind)(ch.epfl.lamp.compiler.msil.emit.LocalBuilder, ch.epfl.lamp.compiler.msil.emit.Label)">returnFromHandler</a><span title="(ch.epfl.lamp.compiler.msil.emit.LocalBuilder, ch.epfl.lamp.compiler.msil.emit.Label) @unchecked" class="delimiter">(</span><a href="#248789" title="GenMSIL.this.global.icodes.TypeKind">kind</a><span class="delimiter">)</span>
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#248789" title="GenMSIL.this.global.icodes.TypeKind">kind</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../icode/TypeKinds.scala.html#97018" title="object GenMSIL.this.global.icodes.UNIT">UNIT</a><span class="delimiter">)</span>
                <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.emit.LocalBuilder)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stloc</span>, <a href="#248794" title="ch.epfl.lamp.compiler.msil.emit.LocalBuilder">local</a><span class="delimiter">)</span>
              <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Leave</span>, <a href="#248795" title="ch.epfl.lamp.compiler.msil.emit.Label">label</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>

          <span class="keyword">case</span> <span title="Unit">THROW</span><span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;
            <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Throw</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">DROP</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="248822">kind</a><span class="delimiter">)</span> =&gt;
            <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Pop</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">DUP</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="248826">kind</a><span class="delimiter">)</span> =&gt;
            <span class="comment">// see comment on `var previousWasNEW`</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#246690" title="Boolean">previousWasNEW</a><span class="delimiter">)</span>
              <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Dup</span><span class="delimiter">)</span>
            <span class="keyword">else</span>
              <a href="#246690" title="Boolean">previousWasNEW</a> = <span title="Boolean(false)" class="keyword">false</span>

          <span class="keyword">case</span> <span title="Unit">MONITOR_ENTER</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt;
            <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#242149" title="=&gt; ch.epfl.lamp.compiler.msil.MethodInfo">MMONITOR_ENTER</a><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">MONITOR_EXIT</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt;
            <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#242151" title="=&gt; ch.epfl.lamp.compiler.msil.MethodInfo">MMONITOR_EXIT</a><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">SCOPE_ENTER</span><span class="delimiter">(</span>_<span class="delimiter">)</span> | SCOPE_EXIT<span class="delimiter">(</span>_<span class="delimiter">)</span> | LOAD_EXCEPTION<span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;
            <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

      <span class="delimiter">}</span> <span class="comment">// end for (instr &lt;- b) { .. }</span>
    <span class="delimiter">}</span> <span class="comment">// end genBlock</span>

    <span class="keyword">def</span> <a title="(primitive: GenMSIL.this.global.icodes.Primitive, pos: GenMSIL.this.global.Position)Unit" id="242272">genPrimitive</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.Primitive" id="247450">primitive</a>: <a href="../icode/Primitives.scala.html#97064" title="GenMSIL.this.global.icodes.Primitive">Primitive</a>, <a title="GenMSIL.this.global.Position" id="247451">pos</a>: <a href="../../util/Position.scala.html#30588" title="GenMSIL.this.global.Position">Position</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#247450" title="GenMSIL.this.global.icodes.Primitive">primitive</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Unit">Negation</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="248842">kind</a><span class="delimiter">)</span> =&gt;
          <a href="#248842" title="GenMSIL.this.global.icodes.TypeKind">kind</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="comment">// CHECK: is ist possible to get this for BOOL? in this case, verify.</span>
            <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97020" title="Unit">BOOL</a> | <a href="../icode/TypeKinds.scala.html#97022" title="object GenMSIL.this.global.icodes.BYTE">BYTE</a> | <a href="../icode/TypeKinds.scala.html#97026" title="object GenMSIL.this.global.icodes.CHAR">CHAR</a> | <a href="../icode/TypeKinds.scala.html#97024" title="object GenMSIL.this.global.icodes.SHORT">SHORT</a> | <a href="../icode/TypeKinds.scala.html#97028" title="object GenMSIL.this.global.icodes.INT">INT</a> | <a href="../icode/TypeKinds.scala.html#97030" title="object GenMSIL.this.global.icodes.LONG">LONG</a> | <a href="../icode/TypeKinds.scala.html#97032" title="object GenMSIL.this.global.icodes.FLOAT">FLOAT</a> | <a href="../icode/TypeKinds.scala.html#97034" title="object GenMSIL.this.global.icodes.DOUBLE">DOUBLE</a> =&gt;
              <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Neg</span><span class="delimiter">)</span>

            <span class="keyword">case</span> <span title="Nothing">_</span> =&gt; <a href="../../symtab/SymbolTable.scala.html#64790" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Impossible to negate a &quot;)" class="string">&quot;Impossible to negate a &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#248842" title="GenMSIL.this.global.icodes.TypeKind">kind</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

        <span class="keyword">case</span> <span title="Unit">Arithmetic</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.ArithmeticOp" id="248849">op</a>, <a title="GenMSIL.this.global.icodes.TypeKind" id="248850">kind</a><span class="delimiter">)</span> =&gt;
          <a href="#248849" title="GenMSIL.this.global.icodes.ArithmeticOp">op</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#97118" title="Unit">ADD</a> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Add</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#97120" title="Unit">SUB</a> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Sub</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#97122" title="Unit">MUL</a> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Mul</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#97124" title="Unit">DIV</a> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Div</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#97126" title="Unit">REM</a> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Rem</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#97128" title="Unit">NOT</a> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Not</span><span class="delimiter">)</span> <span class="comment">//bitwise complement (one's complement)</span>
            <span class="keyword">case</span> <span title="Nothing">_</span> =&gt; <a href="../../symtab/SymbolTable.scala.html#64790" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Unknown arithmetic primitive &quot;)" class="string">&quot;Unknown arithmetic primitive &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#247450" title="GenMSIL.this.global.icodes.Primitive">primitive</a> <span class="delimiter">)</span>
          <span class="delimiter">}</span>

        <span class="keyword">case</span> <span title="Unit">Logical</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.LogicalOp" id="248867">op</a>, <a title="GenMSIL.this.global.icodes.TypeKind" id="248868">kind</a><span class="delimiter">)</span> =&gt; <a href="#248867" title="GenMSIL.this.global.icodes.LogicalOp">op</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#97138" title="Unit">AND</a> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">And</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#97140" title="Unit">OR</a> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Or</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#97142" title="Unit">XOR</a> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Xor</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span class="keyword">case</span> <span title="Unit">Shift</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.ShiftOp" id="248877">op</a>, <a title="GenMSIL.this.global.icodes.TypeKind" id="248878">kind</a><span class="delimiter">)</span> =&gt; <a href="#248877" title="GenMSIL.this.global.icodes.ShiftOp">op</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#97131" title="Unit">LSL</a> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Shl</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#97133" title="Unit">ASR</a> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Shr</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#97135" title="Unit">LSR</a> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Shr_Un</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span class="keyword">case</span> <span title="Unit">Conversion</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="248887">src</a>, <a title="GenMSIL.this.global.icodes.TypeKind" id="248888">dst</a><span class="delimiter">)</span> =&gt;
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36747" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
            <a href="../../Global.scala.html#64883" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Converting from: &quot;)" class="string">&quot;Converting from: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#248887" title="GenMSIL.this.global.icodes.TypeKind">src</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; to: &quot;)" class="string">&quot; to: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#248888" title="GenMSIL.this.global.icodes.TypeKind">dst</a><span class="delimiter">)</span>

          <a href="#248888" title="GenMSIL.this.global.icodes.TypeKind">dst</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97022" title="Unit">BYTE</a> =&gt;   <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Conv_I1</span><span class="delimiter">)</span> <span class="comment">// I1 for System.SByte, i.e. a scala.Byte</span>
            <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97024" title="Unit">SHORT</a> =&gt;  <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Conv_I2</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97026" title="Unit">CHAR</a> =&gt;   <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Conv_U2</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97028" title="Unit">INT</a> =&gt;    <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Conv_I4</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97030" title="Unit">LONG</a> =&gt;   <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Conv_I8</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97032" title="Unit">FLOAT</a> =&gt;  <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Conv_R4</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97034" title="Unit">DOUBLE</a> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Conv_R8</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
              <span title="object Console">Console</span>.<span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Illegal conversion at: &quot;)" class="string">&quot;Illegal conversion at: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#242199" title="=&gt; GenMSIL.this.global.icodes.IClass">clasz</a> <span title="(x$1: Any)java.lang.String">+</span>
                              <span title="java.lang.String(&quot; at: &quot;)" class="string">&quot; at: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#247451" title="GenMSIL.this.global.Position">pos</a>.<a href="../../util/Position.scala.html#97208" title="=&gt; scala.tools.nsc.util.SourceFile">source</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;:&quot;)" class="string">&quot;:&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#247451" title="GenMSIL.this.global.Position">pos</a>.<a href="../../util/Position.scala.html#97235" title="=&gt; Int">line</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

        <span class="keyword">case</span> <span title="Unit">ArrayLength</span><span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;
          <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldlen</span><span class="delimiter">)</span>

        <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#97092" title="Unit">StartConcat</a> =&gt;
          <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.ConstructorInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Newobj</span>, <a href="#242155" title="=&gt; ch.epfl.lamp.compiler.msil.ConstructorInfo">MSTRING_BUILDER_CONSTR</a><span class="delimiter">)</span>


        <span class="keyword">case</span> <span title="Unit">StringConcat</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="248916">el</a><span class="delimiter">)</span> =&gt;
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="248917">elemType</a> : <span title="ch.epfl.lamp.compiler.msil.Type">MsilType</span> = <a href="#248916" title="GenMSIL.this.global.icodes.TypeKind">el</a> <span title="ch.epfl.lamp.compiler.msil.Type" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.Type">REFERENCE</span><span class="delimiter">(</span>_<span class="delimiter">)</span> | ARRAY<span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt; <a href="../../symtab/clr/CLRTypes.scala.html#205447" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MOBJECT</a>
            <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.Type">_</span> =&gt; <a href="#242293" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#248916" title="GenMSIL.this.global.icodes.TypeKind">el</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

          <span class="keyword">val</span> <a title="Array[ch.epfl.lamp.compiler.msil.Type]" id="248918">argTypes</a>:<span title="Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span class="delimiter">[</span>MsilType<span class="delimiter">]</span> = <span title="(xs: ch.epfl.lamp.compiler.msil.Type*)(implicit evidence$2: scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type])Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span title="(clazz: java.lang.Class[_])scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type]" class="delimiter">(</span><a href="#248917" title="ch.epfl.lamp.compiler.msil.Type">elemType</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="248919">stringBuilderAppend</a> = <a href="#242153" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MSTRING_BUILDER</a>.<span title="(x$1: java.lang.String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Append&quot;)" class="string">&quot;Append&quot;</span>, <a href="#248918" title="Array[ch.epfl.lamp.compiler.msil.Type]">argTypes</a> <span class="delimiter">)</span>
          <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Callvirt</span>,  <a href="#248919" title="ch.epfl.lamp.compiler.msil.MethodInfo">stringBuilderAppend</a><span class="delimiter">)</span>

        <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#97094" title="Unit">EndConcat</a> =&gt;
          <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Callvirt</span>, <a href="#242157" title="=&gt; ch.epfl.lamp.compiler.msil.MethodInfo">MSTRING_BUILDER_TOSTRING</a><span class="delimiter">)</span>

        <span class="keyword">case</span> <span title="Nothing">_</span> =&gt;
          <a href="../../symtab/SymbolTable.scala.html#64790" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Unimplemented primitive &quot;)" class="string">&quot;Unimplemented primitive &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#247450" title="GenMSIL.this.global.icodes.Primitive">primitive</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="comment">// end genPrimitive</span>


    <span class="comment">////////////////////// loading ///////////////////////</span>

    <span class="keyword">def</span> <a title="(value: Int, code: ch.epfl.lamp.compiler.msil.emit.ILGenerator)Unit" id="242273">loadI4</a><span class="delimiter">(</span><a title="Int" id="246926">value</a>: <span title="Int">Int</span>, <a title="ch.epfl.lamp.compiler.msil.emit.ILGenerator" id="246927">code</a>: <span title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">ILGenerator</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#246926" title="Int">value</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Unit">-</span><span class="int">1</span> =&gt; <a href="#246927" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_M1</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit" class="int">0</span>  =&gt; <a href="#246927" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_0</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit" class="int">1</span>  =&gt; <a href="#246927" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_1</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit" class="int">2</span>  =&gt; <a href="#246927" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_2</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit" class="int">3</span>  =&gt; <a href="#246927" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_3</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit" class="int">4</span>  =&gt; <a href="#246927" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_4</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit" class="int">5</span>  =&gt; <a href="#246927" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_5</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit" class="int">6</span>  =&gt; <a href="#246927" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_6</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit" class="int">7</span>  =&gt; <a href="#246927" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_7</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit" class="int">8</span>  =&gt; <a href="#246927" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_8</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">_</span>  =&gt;
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#246926" title="Int">value</a> <span title="(x: Int)Boolean">&gt;=</span> -<span title="Int(-128)" class="int">128</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#246926" title="Int">value</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(127)" class="int">127</span><span class="delimiter">)</span>
          <a href="#246927" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Int)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_S</span>, <a href="#246926" title="Int">value</a><span class="delimiter">)</span>
        <span class="keyword">else</span>
          <a href="#246927" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Int)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4</span>, <a href="#246926" title="Int">value</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(code: ch.epfl.lamp.compiler.msil.emit.ILGenerator, loadAddr: Boolean)(i: Int)Unit" id="242274">loadArg</a><span class="delimiter">(</span><a title="ch.epfl.lamp.compiler.msil.emit.ILGenerator" id="246701">code</a>: <span title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">ILGenerator</span>, <a title="Boolean" id="246702">loadAddr</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="Int" id="246703">i</a>: <span title="Int">Int</span><span class="delimiter">)</span> =
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#246702" title="Boolean">loadAddr</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#246703" title="Int">i</a> <span title="(x: Int)Boolean">&gt;=</span> -<span title="Int(-128)" class="int">128</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#246703" title="Int">i</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(127)" class="int">127</span><span class="delimiter">)</span>
          <a href="#246701" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Int)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldarga_S</span>, <a href="#246703" title="Int">i</a><span class="delimiter">)</span>
        <span class="keyword">else</span>
          <a href="#246701" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Int)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldarga</span>, <a href="#246703" title="Int">i</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="#246703" title="Int">i</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Unit" class="int">0</span> =&gt; <a href="#246701" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldarg_0</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Unit" class="int">1</span> =&gt; <a href="#246701" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldarg_1</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Unit" class="int">2</span> =&gt; <a href="#246701" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldarg_2</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Unit" class="int">3</span> =&gt; <a href="#246701" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldarg_3</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Unit">_</span>      =&gt;
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#246703" title="Int">i</a> <span title="(x: Int)Boolean">&gt;=</span> -<span title="Int(-128)" class="int">128</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#246703" title="Int">i</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(127)" class="int">127</span><span class="delimiter">)</span>
              <a href="#246701" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Int)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldarg_S</span>, <a href="#246703" title="Int">i</a><span class="delimiter">)</span>
            <span class="keyword">else</span>
              <a href="#246701" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Int)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldarg</span>, <a href="#246703" title="Int">i</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(i: Int, local: GenMSIL.this.global.icodes.Local, code: ch.epfl.lamp.compiler.msil.emit.ILGenerator, loadAddr: Boolean)Unit" id="242275">loadLocal</a><span class="delimiter">(</span><a title="Int" id="246746">i</a>: <span title="Int">Int</span>, <a title="GenMSIL.this.global.icodes.Local" id="246747">local</a>: <a href="../icode/Members.scala.html#96985" title="GenMSIL.this.global.icodes.Local">Local</a>, <a title="ch.epfl.lamp.compiler.msil.emit.ILGenerator" id="246748">code</a>: <span title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">ILGenerator</span>, <a title="Boolean" id="246749">loadAddr</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> =
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#246749" title="Boolean">loadAddr</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#246746" title="Int">i</a> <span title="(x: Int)Boolean">&gt;=</span> -<span title="Int(-128)" class="int">128</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#246746" title="Int">i</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(127)" class="int">127</span><span class="delimiter">)</span>
          <a href="#246748" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.emit.LocalBuilder)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldloca_S</span>, <a href="#242290" title="(key: GenMSIL.this.global.icodes.Local)ch.epfl.lamp.compiler.msil.emit.LocalBuilder">localBuilders</a><span class="delimiter">(</span><a href="#246747" title="GenMSIL.this.global.icodes.Local">local</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">else</span>
          <a href="#246748" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.emit.LocalBuilder)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldloca</span>, <a href="#242290" title="(key: GenMSIL.this.global.icodes.Local)ch.epfl.lamp.compiler.msil.emit.LocalBuilder">localBuilders</a><span class="delimiter">(</span><a href="#246747" title="GenMSIL.this.global.icodes.Local">local</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="#246746" title="Int">i</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Unit" class="int">0</span> =&gt; <a href="#246748" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldloc_0</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Unit" class="int">1</span> =&gt; <a href="#246748" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldloc_1</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Unit" class="int">2</span> =&gt; <a href="#246748" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldloc_2</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Unit" class="int">3</span> =&gt; <a href="#246748" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldloc_3</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Unit">_</span>      =&gt;
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#246746" title="Int">i</a> <span title="(x: Int)Boolean">&gt;=</span> -<span title="Int(-128)" class="int">128</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#246746" title="Int">i</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(127)" class="int">127</span><span class="delimiter">)</span>
              <a href="#246748" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.emit.LocalBuilder)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldloc_S</span>, <a href="#242290" title="(key: GenMSIL.this.global.icodes.Local)ch.epfl.lamp.compiler.msil.emit.LocalBuilder">localBuilders</a><span class="delimiter">(</span><a href="#246747" title="GenMSIL.this.global.icodes.Local">local</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="keyword">else</span>
              <a href="#246748" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.emit.LocalBuilder)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldloc</span>, <a href="#242290" title="(key: GenMSIL.this.global.icodes.Local)ch.epfl.lamp.compiler.msil.emit.LocalBuilder">localBuilders</a><span class="delimiter">(</span><a href="#246747" title="GenMSIL.this.global.icodes.Local">local</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    <span class="comment">////////////////////// branches ///////////////////////</span>

    <span class="comment">/** Returns a Triple (Boolean, Boolean, Option[Label])
     *   - whether the jump leaves some exception block (try / catch / finally)
     *   - whether it leaves a finally handler (finally block, but not it's try / catch)
     *   - a label where to jump for leaving the finally handler
     *     . None to leave directly using `endfinally`
     *     . Some(label) to emit `leave label` (for try / catch inside a finally handler)
     */</span>
    <span class="keyword">def</span> <a title="(from: GenMSIL.this.global.icodes.BasicBlock, to: GenMSIL.this.global.icodes.BasicBlock)(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label])" id="242276">leavesHandler</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.BasicBlock" id="248676">from</a>: <a href="../icode/BasicBlocks.scala.html#96991" title="GenMSIL.this.global.icodes.BasicBlock">BasicBlock</a>, <a title="GenMSIL.this.global.icodes.BasicBlock" id="248677">to</a>: <a href="../icode/BasicBlocks.scala.html#96991" title="GenMSIL.this.global.icodes.BasicBlock">BasicBlock</a><span class="delimiter">)</span>: <span title="(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label])" class="delimiter">(</span>Boolean, Boolean, Option<span class="delimiter">[</span>Label<span class="delimiter">]</span><span class="delimiter">)</span> =
      <span title="(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label])" class="keyword">if</span> <span class="delimiter">(</span><a href="#242253" title="=&gt; scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">currentHandlers</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span title="(_1: Boolean, _2: Boolean, _3: None.type)(Boolean, Boolean, None.type)" class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span>, <span title="Boolean(false)" class="keyword">false</span>, <span title="object None">None</span><span class="delimiter">)</span>
      <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.ExceptionHandler" id="249010">h</a> = <a href="#242253" title="=&gt; scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">currentHandlers</a>.<span title="=&gt; GenMSIL.this.global.icodes.ExceptionHandler">head</span>
        <span class="keyword">val</span> <a title="Boolean" id="249011">leaveHead</a> = <span class="delimiter">{</span> <a href="#249010" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a>.<a href="../icode/ExceptionHandlers.scala.html#203162" title="(b: GenMSIL.this.global.icodes.BasicBlock)Boolean">covers</a><span class="delimiter">(</span><a href="#248676" title="GenMSIL.this.global.icodes.BasicBlock">from</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">!=</span> <a href="#249010" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a>.<a href="../icode/ExceptionHandlers.scala.html#203162" title="(b: GenMSIL.this.global.icodes.BasicBlock)Boolean">covers</a><span class="delimiter">(</span><a href="#248677" title="GenMSIL.this.global.icodes.BasicBlock">to</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span>
                          <a href="#249010" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a>.<a href="../icode/ExceptionHandlers.scala.html#203163" title="=&gt; List[GenMSIL.this.global.icodes.BasicBlock]">blocks</a>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#248676" title="GenMSIL.this.global.icodes.BasicBlock">from</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">!=</span> <a href="#249010" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a>.<a href="../icode/ExceptionHandlers.scala.html#203163" title="=&gt; List[GenMSIL.this.global.icodes.BasicBlock]">blocks</a>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#248677" title="GenMSIL.this.global.icodes.BasicBlock">to</a><span class="delimiter">)</span> <span class="delimiter">}</span>
        <span title="(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label])" class="keyword">if</span> <span class="delimiter">(</span><a href="#249011" title="Boolean">leaveHead</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="comment">// we leave the innermost exception block.</span>
          <span class="comment">// find out if we also leave som e `finally` handler</span>
          <a href="#242253" title="=&gt; scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">currentHandlers</a>.<span title="(p: GenMSIL.this.global.icodes.ExceptionHandler =&gt; Boolean)Option[GenMSIL.this.global.icodes.ExceptionHandler]">find</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.ExceptionHandler" id="249031">e</a> =&gt; <span class="delimiter">{</span>
            <a href="#249031" title="GenMSIL.this.global.icodes.ExceptionHandler">e</a>.<a href="../icode/ExceptionHandlers.scala.html#203141" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">cls</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/Symbols.scala.html#67339" title="object GenMSIL.this.global.NoSymbol">NoSymbol</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#249031" title="GenMSIL.this.global.icodes.ExceptionHandler">e</a>.<a href="../icode/ExceptionHandlers.scala.html#203163" title="=&gt; List[GenMSIL.this.global.icodes.BasicBlock]">blocks</a>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#248676" title="GenMSIL.this.global.icodes.BasicBlock">from</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">!=</span> <a href="#249031" title="GenMSIL.this.global.icodes.ExceptionHandler">e</a>.<a href="../icode/ExceptionHandlers.scala.html#203163" title="=&gt; List[GenMSIL.this.global.icodes.BasicBlock]">blocks</a>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#248677" title="GenMSIL.this.global.icodes.BasicBlock">to</a><span class="delimiter">)</span>
          <span class="delimiter">}</span><span class="delimiter">)</span> <span title="(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label])" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label])">Some</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.ExceptionHandler" id="249042">finallyHandler</a><span class="delimiter">)</span> =&gt;
              <span title="(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label])" class="keyword">if</span> <span class="delimiter">(</span><a href="#249010" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#249042" title="GenMSIL.this.global.icodes.ExceptionHandler">finallyHandler</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="comment">// the finally handler is the innermost, so we can emit `endfinally` directly</span>
                <span title="(_1: Boolean, _2: Boolean, _3: None.type)(Boolean, Boolean, None.type)" class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span>, <span title="Boolean(true)" class="keyword">true</span>, <span title="object None">None</span><span class="delimiter">)</span>
              <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
                <span class="comment">// we need to `Leave` to the `endfinally` of the next outer finally handler</span>
                <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.Label" id="249056">l</a> = <a href="#242268" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.ExceptionHandler,ch.epfl.lamp.compiler.msil.emit.Label]">endFinallyLabels</a>.<span title="(key: GenMSIL.this.global.icodes.ExceptionHandler, op: =&gt; ch.epfl.lamp.compiler.msil.emit.Label)ch.epfl.lamp.compiler.msil.emit.Label">getOrElseUpdate</span><span class="delimiter">(</span><a href="#249042" title="GenMSIL.this.global.icodes.ExceptionHandler">finallyHandler</a>, <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="()ch.epfl.lamp.compiler.msil.emit.Label">DefineLabel</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
                <span title="(_1: Boolean, _2: Boolean, _3: Some[ch.epfl.lamp.compiler.msil.emit.Label])(Boolean, Boolean, Some[ch.epfl.lamp.compiler.msil.emit.Label])" class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span>, <span title="Boolean(true)" class="keyword">true</span>, <span title="(x: ch.epfl.lamp.compiler.msil.emit.Label)Some[ch.epfl.lamp.compiler.msil.emit.Label]">Some</span><span class="delimiter">(</span><a href="#249056" title="ch.epfl.lamp.compiler.msil.emit.Label">l</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="keyword">case</span> <span title="(Boolean, Boolean, None.type)">None</span> =&gt;
              <span title="(_1: Boolean, _2: Boolean, _3: None.type)(Boolean, Boolean, None.type)" class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span>, <span title="Boolean(false)" class="keyword">false</span>, <span title="object None">None</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span title="(_1: Boolean, _2: Boolean, _3: None.type)(Boolean, Boolean, None.type)" class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span>, <span title="Boolean(false)" class="keyword">false</span>, <span title="object None">None</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(block: GenMSIL.this.global.icodes.BasicBlock, cond: GenMSIL.this.global.icodes.TestOp, success: GenMSIL.this.global.icodes.BasicBlock, failure: GenMSIL.this.global.icodes.BasicBlock, next: GenMSIL.this.global.icodes.BasicBlock, emitBrFun: (GenMSIL.this.global.icodes.TestOp, ch.epfl.lamp.compiler.msil.emit.Label) =&gt; Unit)Unit" id="242277">emitCondBr</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.BasicBlock" id="248767">block</a>: <a href="../icode/BasicBlocks.scala.html#96991" title="GenMSIL.this.global.icodes.BasicBlock">BasicBlock</a>, <a title="GenMSIL.this.global.icodes.TestOp" id="248768">cond</a>: <a href="../icode/Primitives.scala.html#97104" title="GenMSIL.this.global.icodes.TestOp">TestOp</a>, <a title="GenMSIL.this.global.icodes.BasicBlock" id="248769">success</a>: <a href="../icode/BasicBlocks.scala.html#96991" title="GenMSIL.this.global.icodes.BasicBlock">BasicBlock</a>, <a title="GenMSIL.this.global.icodes.BasicBlock" id="248770">failure</a>: <a href="../icode/BasicBlocks.scala.html#96991" title="GenMSIL.this.global.icodes.BasicBlock">BasicBlock</a>,
                   <a title="GenMSIL.this.global.icodes.BasicBlock" id="248771">next</a>: <a href="../icode/BasicBlocks.scala.html#96991" title="GenMSIL.this.global.icodes.BasicBlock">BasicBlock</a>, <a title="(GenMSIL.this.global.icodes.TestOp, ch.epfl.lamp.compiler.msil.emit.Label) =&gt; Unit" id="248772">emitBrFun</a>: <span class="delimiter">(</span>TestOp, Label<span class="delimiter">)</span> =&gt; Unit<span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a href="#249090" title="(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label])" class="delimiter">(</a><a href="#249089" title="Boolean" id="249090">sLeaveHandler</a>, <a href="#249089" title="Boolean" id="249091">sLeaveFinally</a>, <a href="#249089" title="Option[ch.epfl.lamp.compiler.msil.emit.Label]" id="249092">slfTarget</a><span class="delimiter">)</span> = <a href="#242276" title="(from: GenMSIL.this.global.icodes.BasicBlock, to: GenMSIL.this.global.icodes.BasicBlock)(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label])">leavesHandler</a><span title="(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label]) @unchecked" class="delimiter">(</span><a href="#248767" title="GenMSIL.this.global.icodes.BasicBlock">block</a>, <a href="#248769" title="GenMSIL.this.global.icodes.BasicBlock">success</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a href="#249094" title="(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label])" class="delimiter">(</a><a href="#249093" title="Boolean" id="249094">fLeaveHandler</a>, <a href="#249093" title="Boolean" id="249095">fLeaveFinally</a>, <a href="#249093" title="Option[ch.epfl.lamp.compiler.msil.emit.Label]" id="249096">flfTarget</a><span class="delimiter">)</span> = <a href="#242276" title="(from: GenMSIL.this.global.icodes.BasicBlock, to: GenMSIL.this.global.icodes.BasicBlock)(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label])">leavesHandler</a><span title="(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label]) @unchecked" class="delimiter">(</span><a href="#248767" title="GenMSIL.this.global.icodes.BasicBlock">block</a>, <a href="#248770" title="GenMSIL.this.global.icodes.BasicBlock">failure</a><span class="delimiter">)</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#249090" title="Boolean">sLeaveHandler</a> <span title="(x: Boolean)Boolean">||</span> <a href="#249094" title="Boolean">fLeaveHandler</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Option[ch.epfl.lamp.compiler.msil.emit.Label]" id="249127">sLabelOpt</a> = <span title="Option[ch.epfl.lamp.compiler.msil.emit.Label]" class="keyword">if</span> <span class="delimiter">(</span><a href="#249090" title="Boolean">sLeaveHandler</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.Label" id="249128">leaveSLabel</a> = <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="()ch.epfl.lamp.compiler.msil.emit.Label">DefineLabel</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#248772" title="(v1: GenMSIL.this.global.icodes.TestOp, v2: ch.epfl.lamp.compiler.msil.emit.Label)Unit">emitBrFun</a><span class="delimiter">(</span><a href="#248768" title="GenMSIL.this.global.icodes.TestOp">cond</a>, <a href="#249128" title="ch.epfl.lamp.compiler.msil.emit.Label">leaveSLabel</a><span class="delimiter">)</span>
          <span title="(x: ch.epfl.lamp.compiler.msil.emit.Label)Some[ch.epfl.lamp.compiler.msil.emit.Label]">Some</span><span class="delimiter">(</span><a href="#249128" title="ch.epfl.lamp.compiler.msil.emit.Label">leaveSLabel</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#248772" title="(v1: GenMSIL.this.global.icodes.TestOp, v2: ch.epfl.lamp.compiler.msil.emit.Label)Unit">emitBrFun</a><span class="delimiter">(</span><a href="#248768" title="GenMSIL.this.global.icodes.TestOp">cond</a>, <a href="#242239" title="(key: GenMSIL.this.global.icodes.BasicBlock)ch.epfl.lamp.compiler.msil.emit.Label">labels</a><span class="delimiter">(</span><a href="#248769" title="GenMSIL.this.global.icodes.BasicBlock">success</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span title="object None">None</span>
        <span class="delimiter">}</span>

        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#249094" title="Boolean">fLeaveHandler</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#249095" title="Boolean">fLeaveFinally</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#249096" title="Option[ch.epfl.lamp.compiler.msil.emit.Label]">flfTarget</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Leave</span>, <a href="#249096" title="Option[ch.epfl.lamp.compiler.msil.emit.Label]">flfTarget</a>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.Label">get</span><span class="delimiter">)</span>
            <span class="keyword">else</span> <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Endfinally</span><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span>
            <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Leave</span>, <a href="#242239" title="(key: GenMSIL.this.global.icodes.BasicBlock)ch.epfl.lamp.compiler.msil.emit.Label">labels</a><span class="delimiter">(</span><a href="#248770" title="GenMSIL.this.global.icodes.BasicBlock">failure</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span>
          <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Br</span>, <a href="#242239" title="(key: GenMSIL.this.global.icodes.BasicBlock)ch.epfl.lamp.compiler.msil.emit.Label">labels</a><span class="delimiter">(</span><a href="#248770" title="GenMSIL.this.global.icodes.BasicBlock">failure</a><span class="delimiter">)</span><span class="delimiter">)</span>

        <a href="#249127" title="Option[ch.epfl.lamp.compiler.msil.emit.Label]">sLabelOpt</a>.<span title="(f: ch.epfl.lamp.compiler.msil.emit.Label =&gt; Unit)Option[Unit]">map</span><span title="Unit" class="delimiter">(</span><a title="ch.epfl.lamp.compiler.msil.emit.Label" id="249208">l</a> =&gt; <span class="delimiter">{</span>
          <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">MarkLabel</span><span class="delimiter">(</span><a href="#249208" title="ch.epfl.lamp.compiler.msil.emit.Label">l</a><span class="delimiter">)</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#249091" title="Boolean">sLeaveFinally</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#249092" title="Option[ch.epfl.lamp.compiler.msil.emit.Label]">slfTarget</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Leave</span>, <a href="#249092" title="Option[ch.epfl.lamp.compiler.msil.emit.Label]">slfTarget</a>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.Label">get</span><span class="delimiter">)</span>
            <span class="keyword">else</span> <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Endfinally</span><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span>
            <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Leave</span>, <a href="#242239" title="(key: GenMSIL.this.global.icodes.BasicBlock)ch.epfl.lamp.compiler.msil.emit.Label">labels</a><span class="delimiter">(</span><a href="#248769" title="GenMSIL.this.global.icodes.BasicBlock">success</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#248771" title="GenMSIL.this.global.icodes.BasicBlock">next</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#248769" title="GenMSIL.this.global.icodes.BasicBlock">success</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#248772" title="(v1: GenMSIL.this.global.icodes.TestOp, v2: ch.epfl.lamp.compiler.msil.emit.Label)Unit">emitBrFun</a><span class="delimiter">(</span><a href="#248768" title="GenMSIL.this.global.icodes.TestOp">cond</a>.<a href="../icode/Primitives.scala.html#203395" title="()GenMSIL.this.global.icodes.TestOp">negate</a>, <a href="#242239" title="(key: GenMSIL.this.global.icodes.BasicBlock)ch.epfl.lamp.compiler.msil.emit.Label">labels</a><span class="delimiter">(</span><a href="#248770" title="GenMSIL.this.global.icodes.BasicBlock">failure</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#248772" title="(v1: GenMSIL.this.global.icodes.TestOp, v2: ch.epfl.lamp.compiler.msil.emit.Label)Unit">emitBrFun</a><span class="delimiter">(</span><a href="#248768" title="GenMSIL.this.global.icodes.TestOp">cond</a>, <a href="#242239" title="(key: GenMSIL.this.global.icodes.BasicBlock)ch.epfl.lamp.compiler.msil.emit.Label">labels</a><span class="delimiter">(</span><a href="#248769" title="GenMSIL.this.global.icodes.BasicBlock">success</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#248771" title="GenMSIL.this.global.icodes.BasicBlock">next</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#248770" title="GenMSIL.this.global.icodes.BasicBlock">failure</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Br</span>, <a href="#242239" title="(key: GenMSIL.this.global.icodes.BasicBlock)ch.epfl.lamp.compiler.msil.emit.Label">labels</a><span class="delimiter">(</span><a href="#248770" title="GenMSIL.this.global.icodes.BasicBlock">failure</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(condition: GenMSIL.this.global.icodes.TestOp, dest: ch.epfl.lamp.compiler.msil.emit.Label, isFloat: Boolean)Unit" id="242278">emitBr</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TestOp" id="248763">condition</a>: <a href="../icode/Primitives.scala.html#97104" title="GenMSIL.this.global.icodes.TestOp">TestOp</a>, <a title="ch.epfl.lamp.compiler.msil.emit.Label" id="248764">dest</a>: <span title="ch.epfl.lamp.compiler.msil.emit.Label">Label</span>, <a title="Boolean" id="248765">isFloat</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#248763" title="GenMSIL.this.global.icodes.TestOp">condition</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#97105" title="Unit">EQ</a> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Beq</span>, <a href="#248764" title="ch.epfl.lamp.compiler.msil.emit.Label">dest</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#97107" title="Unit">NE</a> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Bne_Un</span>, <a href="#248764" title="ch.epfl.lamp.compiler.msil.emit.Label">dest</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#97109" title="Unit">LT</a> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="ch.epfl.lamp.compiler.msil.emit.OpCode" class="keyword">if</span> <span class="delimiter">(</span><a href="#248765" title="Boolean">isFloat</a><span class="delimiter">)</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Blt_Un</span> <span class="keyword">else</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Blt</span>, <a href="#248764" title="ch.epfl.lamp.compiler.msil.emit.Label">dest</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#97111" title="Unit">GE</a> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="ch.epfl.lamp.compiler.msil.emit.OpCode" class="keyword">if</span> <span class="delimiter">(</span><a href="#248765" title="Boolean">isFloat</a><span class="delimiter">)</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Bge_Un</span> <span class="keyword">else</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Bge</span>, <a href="#248764" title="ch.epfl.lamp.compiler.msil.emit.Label">dest</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#97113" title="Unit">LE</a> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="ch.epfl.lamp.compiler.msil.emit.OpCode" class="keyword">if</span> <span class="delimiter">(</span><a href="#248765" title="Boolean">isFloat</a><span class="delimiter">)</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ble_Un</span> <span class="keyword">else</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ble</span>, <a href="#248764" title="ch.epfl.lamp.compiler.msil.emit.Label">dest</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#97115" title="Unit">GT</a> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="ch.epfl.lamp.compiler.msil.emit.OpCode" class="keyword">if</span> <span class="delimiter">(</span><a href="#248765" title="Boolean">isFloat</a><span class="delimiter">)</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Bgt_Un</span> <span class="keyword">else</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Bgt</span>, <a href="#248764" title="ch.epfl.lamp.compiler.msil.emit.Label">dest</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(cond: GenMSIL.this.global.icodes.TestOp, dest: ch.epfl.lamp.compiler.msil.emit.Label)Unit" id="242279">emitBrBool</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TestOp" id="248785">cond</a>: <a href="../icode/Primitives.scala.html#97104" title="GenMSIL.this.global.icodes.TestOp">TestOp</a>, <a title="ch.epfl.lamp.compiler.msil.emit.Label" id="248786">dest</a>: <span title="ch.epfl.lamp.compiler.msil.emit.Label">Label</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#248785" title="GenMSIL.this.global.icodes.TestOp">cond</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="comment">// EQ -&gt; Brfalse, NE -&gt; Brtrue; this is because we come from</span>
        <span class="comment">// a CZJUMP. If the value on the stack is 0 (e.g. a boolean</span>
        <span class="comment">// method returned false), and we are in the case EQ, then</span>
        <span class="comment">// we need to emit Brfalse (EQ Zero means false). vice versa</span>
        <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#97105" title="Unit">EQ</a> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Brfalse</span>, <a href="#248786" title="ch.epfl.lamp.compiler.msil.emit.Label">dest</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#97107" title="Unit">NE</a> =&gt; <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Brtrue</span>, <a href="#248786" title="ch.epfl.lamp.compiler.msil.emit.Label">dest</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="comment">////////////////////// local vars ///////////////////////</span>

    <span class="comment">/**
     * Compute the indexes of each local variable of the given
     * method.
     */</span>
    <span class="keyword">def</span> <a title="(m: GenMSIL.this.global.icodes.IMethod)Unit" id="242280">computeLocalVarsIndex</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IMethod" id="245849">m</a>: <a href="../icode/Members.scala.html#96984" title="GenMSIL.this.global.icodes.IMethod">IMethod</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">var</span> <a title="Int" id="249324">idx</a> = <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#245849" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197788" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../symtab/Symbols.scala.html#107527" title="=&gt; Boolean">isStaticMember</a><span class="delimiter">)</span> <span title="Int(0)" class="int">0</span> <span class="keyword">else</span> <span title="Int(1)" class="int">1</span>

      <span class="keyword">val</span> <a title="List[GenMSIL.this.global.icodes.Local]" id="249325">params</a> = <a href="#245849" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197812" title="=&gt; List[GenMSIL.this.global.icodes.Local]">params</a>
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.Local" id="249346">l</a> &lt;- <a href="#249325" title="(f: GenMSIL.this.global.icodes.Local =&gt; Unit)Unit">params</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36747" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
          <a href="../../Global.scala.html#64883" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Index value for parameter &quot;)" class="string">&quot;Index value for parameter &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#249346" title="GenMSIL.this.global.icodes.Local">l</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#249324" title="Int">idx</a><span class="delimiter">)</span>
        <a href="#249346" title="GenMSIL.this.global.icodes.Local">l</a>.<a href="../icode/Members.scala.html#197987" title="(x$1: Int)Unit">index</a> = <a href="#249324" title="Int">idx</a>
        <a href="#249324" title="Int">idx</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span> <span class="comment">// sizeOf(l.kind)</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="List[GenMSIL.this.global.icodes.Local]" id="249326">locvars</a> = <a href="#245849" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197809" title="=&gt; List[GenMSIL.this.global.icodes.Local]">locals</a> <span title="(p: GenMSIL.this.global.icodes.Local =&gt; Boolean)List[GenMSIL.this.global.icodes.Local]">filterNot</span> <span class="delimiter">(</span><a href="#249325" title="List[GenMSIL.this.global.icodes.Local]">params</a> <a href="#249360" title="(elem: Any)Boolean">contains</a><span class="delimiter">)</span>
      <a href="#249324" title="Int">idx</a> = <span title="Int(0)" class="int">0</span>

      <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.Local" id="249380">l</a> &lt;- <a href="#249326" title="(f: GenMSIL.this.global.icodes.Local =&gt; Unit)Unit">locvars</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36747" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
          <a href="../../Global.scala.html#64883" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Index value for local variable &quot;)" class="string">&quot;Index value for local variable &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#249380" title="GenMSIL.this.global.icodes.Local">l</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#249324" title="Int">idx</a><span class="delimiter">)</span>
        <a href="#249380" title="GenMSIL.this.global.icodes.Local">l</a>.<a href="../icode/Members.scala.html#197987" title="(x$1: Int)Unit">index</a> = <a href="#249324" title="Int">idx</a>
        <a href="#249324" title="Int">idx</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span> <span class="comment">// sizeOf(l.kind)</span>
      <span class="delimiter">}</span>

    <span class="delimiter">}</span>

    <span class="comment">////////////////////// Utilities ////////////////////////</span>

    <span class="comment">/** Return the a name of this symbol that can be used on the .NET
     * platform. It removes spaces from names.
     *
     * Special handling: scala.All and scala.AllRef are 'erased' to
     * scala.All$ and scala.AllRef$. This is needed because they are
     * not real classes, and they mean 'abrupt termination upon evaluation
     * of that expression' or 'null' respectively. This handling is
     * done already in GenICode, but here we need to remove references
     * from method signatures to these types, because such classes can
     * not exist in the classpath: the type checker will be very confused.
     */</span>
    <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)String" id="242281">msilName</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="243202">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="String" id="249389">suffix</a>: <span title="String">String</span> = <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#243202" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; Boolean">hasModuleFlag</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#243202" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; Boolean">isMethod</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
                               <span title="=&gt; Boolean">!</span><a href="#243202" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; Boolean">isImplClass</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
                               <span title="=&gt; Boolean">!</span><a href="#243202" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; Boolean">isJavaDefined</span><span class="delimiter">)</span> <span title="java.lang.String(&quot;$&quot;)" class="string">&quot;$&quot;</span> <span class="keyword">else</span> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>
      <span class="comment">// Flags.JAVA: &quot;symbol was not defined by a scala-class&quot; (java, or .net-class)</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#243202" title="GenMSIL.this.global.Symbol">sym</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106228" title="=&gt; GenMSIL.this.global.Symbol">NothingClass</a><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">return</span> <span title="java.lang.String(&quot;scala.runtime.Nothing$&quot;)" class="string">&quot;scala.runtime.Nothing$&quot;</span>
      <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#243202" title="GenMSIL.this.global.Symbol">sym</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106226" title="=&gt; GenMSIL.this.global.Symbol">NullClass</a><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">return</span> <span title="java.lang.String(&quot;scala.runtime.Null$&quot;)" class="string">&quot;scala.runtime.Null$&quot;</span>

      <span class="delimiter">(</span><span title="implicit scala.Predef.any2stringadd : (x: Any)scala.runtime.StringAdd" class="keyword">if</span> <span class="delimiter">(</span><a href="#243202" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; Boolean">isClass</span> <span title="(x: Boolean)Boolean">||</span> <span class="delimiter">(</span><a href="#243202" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; Boolean">isModule</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#243202" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; Boolean">isMethod</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="java.lang.Object" class="keyword">if</span> <span class="delimiter">(</span><a href="#243202" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107532" title="=&gt; Boolean">isNestedClass</a><span class="delimiter">)</span> <a href="#243202" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107648" title="=&gt; GenMSIL.this.global.Name">simpleName</a>
        <span class="keyword">else</span> <a href="#243202" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; String">fullName</span>
       <span class="delimiter">}</span> <span class="keyword">else</span>
         <a href="#243202" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107648" title="=&gt; GenMSIL.this.global.Name">simpleName</a>.<a href="../../symtab/Names.scala.html#96604" title="()String">toString</a><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()java.lang.String">trim</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(other: String)java.lang.String">+</span> <a href="#249389" title="String">suffix</a>
    <span class="delimiter">}</span>


    <span class="comment">////////////////////// flags ///////////////////////</span>

    <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)Int" id="242282">msilTypeFlags</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="249415">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">var</span> <a title="Int" id="249417">mf</a>: <span title="Int">Int</span> = TypeAttributes.AutoLayout <span title="Int(0)">|</span> TypeAttributes.AnsiClass

      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#249415" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107532" title="=&gt; Boolean">isNestedClass</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#249417" title="Int">mf</a> = <a href="#249417" title="Int">mf</a> <span title="(x: Int)Int">|</span> <span class="delimiter">(</span><span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#249415" title="GenMSIL.this.global.Symbol">sym</a> <span title="(mask: Long)Boolean">hasFlag</span> Flags.<span title="Long(4L)">PRIVATE</span><span class="delimiter">)</span> TypeAttributes.<span title="Int(3)">NestedPrivate</span> <span class="keyword">else</span> TypeAttributes.<span title="Int(2)">NestedPublic</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="#249417" title="Int">mf</a> = <a href="#249417" title="Int">mf</a> <span title="(x: Int)Int">|</span> <span class="delimiter">(</span><span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#249415" title="GenMSIL.this.global.Symbol">sym</a> <span title="(mask: Long)Boolean">hasFlag</span> Flags.<span title="Long(4L)">PRIVATE</span><span class="delimiter">)</span> TypeAttributes.<span title="Int(0)">NotPublic</span> <span class="keyword">else</span> TypeAttributes.<span title="Int(1)">Public</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#249417" title="Int">mf</a> = <a href="#249417" title="Int">mf</a> <span title="(x: Int)Int">|</span> <span class="delimiter">(</span><span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#249415" title="GenMSIL.this.global.Symbol">sym</a> <span title="(mask: Long)Boolean">hasFlag</span> Flags.<span title="Long(8L)">ABSTRACT</span><span class="delimiter">)</span> TypeAttributes.<span title="Int(128)">Abstract</span> <span class="keyword">else</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <a href="#249417" title="Int">mf</a> = <a href="#249417" title="Int">mf</a> <span title="(x: Int)Int">|</span> <span class="delimiter">(</span><span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#249415" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107480" title="=&gt; Boolean">isTrait</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#249415" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; Boolean">isImplClass</span><span class="delimiter">)</span> TypeAttributes.<span title="Int(32)">Interface</span> <span class="keyword">else</span> TypeAttributes.<span title="Int(0)">Class</span><span class="delimiter">)</span>
      <a href="#249417" title="Int">mf</a> = <a href="#249417" title="Int">mf</a> <span title="(x: Int)Int">|</span> <span class="delimiter">(</span><span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#249415" title="GenMSIL.this.global.Symbol">sym</a> <span title="=&gt; Boolean">isFinal</span><span class="delimiter">)</span> TypeAttributes.<span title="Int(256)">Sealed</span> <span class="keyword">else</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>

      <a href="#249415" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107411" title="=&gt; List[GenMSIL.this.global.AnnotationInfo]">annotations</a> <span title="(f: GenMSIL.this.global.AnnotationInfo =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="GenMSIL.this.global.AnnotationInfo" id="249467">a</a> =&gt; <a href="#249467" title="GenMSIL.this.global.AnnotationInfo">a</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Unit">AnnotationInfo</span><span class="delimiter">(</span><a href="#242189" title="=&gt; GenMSIL.this.global.Type">SerializableAttr</a>, _, _<span class="delimiter">)</span> =&gt;
          <span class="comment">// TODO: add the Serializable TypeAttribute also if the annotation</span>
          <span class="comment">// System.SerializableAttribute is present (.net annotation, not scala)</span>
          <span class="comment">//  Best way to do it: compare with</span>
          <span class="comment">//  definitions.getClass(&quot;System.SerializableAttribute&quot;).tpe</span>
          <span class="comment">//  when frontend available</span>
          <a href="#249417" title="Int">mf</a> = <a href="#249417" title="Int">mf</a> <span title="(x: Int)Int">|</span> TypeAttributes.<span title="Int(8192)">Serializable</span>
        <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">}</span>

      <a href="#249417" title="Int">mf</a>
      <span class="comment">// static: not possible (or?)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)Short" id="242283">msilMethodFlags</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="249476">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="Short">Short</span> = <span class="delimiter">{</span>
      <span class="keyword">var</span> <a title="Int" id="249478">mf</a>: <span title="Int">Int</span> = MethodAttributes.<span title="Short(128)">HideBySig</span> <span title="(x: Short)Int">|</span>
        <span class="delimiter">(</span><span title="Short" class="keyword">if</span> <span class="delimiter">(</span><a href="#249476" title="GenMSIL.this.global.Symbol">sym</a> <span title="(mask: Long)Boolean">hasFlag</span> Flags.<span title="Long(4L)">PRIVATE</span><span class="delimiter">)</span> MethodAttributes.<span title="Short(1)">Private</span>
         <span class="keyword">else</span> MethodAttributes.<span title="Short(6)">Public</span><span class="delimiter">)</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#249476" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107473" title="=&gt; Boolean">isClassConstructor</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#249476" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107527" title="=&gt; Boolean">isStaticMember</a><span class="delimiter">)</span>
          <a href="#249478" title="Int">mf</a> = <a href="#249478" title="Int">mf</a> <span title="(x: Short)Int">|</span> FieldAttributes.<span title="Short(16)">Static</span> <span class="comment">// coincidentally, same value as for MethodAttributes.Static ...</span>
        <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#249478" title="Int">mf</a> = <a href="#249478" title="Int">mf</a> <span title="(x: Short)Int">|</span> MethodAttributes.<span title="Short(64)">Virtual</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#249476" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; Boolean">isFinal</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#242296" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#249476" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.Symbol">owner</a><span class="delimiter">)</span>.<span title="()Boolean">IsInterface</span><span class="delimiter">)</span>
            <a href="#249478" title="Int">mf</a> = <a href="#249478" title="Int">mf</a> <span title="(x: Short)Int">|</span> MethodAttributes.<span title="Short(32)">Final</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#249476" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; Boolean">isDeferred</span> <span title="(x: Boolean)Boolean">||</span> <a href="#242296" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#249476" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.Symbol">owner</a><span class="delimiter">)</span>.<span title="()Boolean">IsInterface</span><span class="delimiter">)</span>
            <a href="#249478" title="Int">mf</a> = <a href="#249478" title="Int">mf</a> <span title="(x: Short)Int">|</span> MethodAttributes.<span title="Short(1024)">Abstract</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#249476" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107527" title="=&gt; Boolean">isStaticMember</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#249478" title="Int">mf</a> = <a href="#249478" title="Int">mf</a> <span title="(x: Short)Int">|</span> MethodAttributes.<span title="Short(16)">Static</span>
      <span class="delimiter">}</span>

      <span class="comment">// constructors of module classes should be private</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#249476" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107519" title="=&gt; Boolean">isPrimaryConstructor</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#242302" title="(sym: GenMSIL.this.global.Symbol)Boolean">isTopLevelModule</a><span class="delimiter">(</span><a href="#249476" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.Symbol">owner</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#249478" title="Int">mf</a> <span title="(x: Short)Int">|=</span> MethodAttributes.<span title="Short(1)">Private</span>
        <a href="#249478" title="Int">mf</a> <span title="(x: Int)Int">&amp;=</span> <span title="=&gt; Int">~</span><span class="delimiter">(</span>MethodAttributes.<span title="Short(6)">Public</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="#249478" title="Int">mf</a>.<span title="=&gt; Short">toShort</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)Short" id="242284">msilFieldFlags</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="249511">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="Short">Short</span> = <span class="delimiter">{</span>
      <span class="keyword">var</span> <a title="Int" id="249513">mf</a>: <span title="Int">Int</span> =
        <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#249511" title="GenMSIL.this.global.Symbol">sym</a> <span title="(mask: Long)Boolean">hasFlag</span> Flags.<span title="Long(4L)">PRIVATE</span><span class="delimiter">)</span> FieldAttributes.<span title="Int(1)">Private</span>
        <span class="keyword">else</span> <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#249511" title="GenMSIL.this.global.Symbol">sym</a> <span title="(mask: Long)Boolean">hasFlag</span> Flags.<span title="Long(1L)">PROTECTED</span><span class="delimiter">)</span> FieldAttributes.<span title="Int(5)">FamORAssem</span>
        <span class="keyword">else</span> FieldAttributes.<span title="Int(6)">Public</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#249511" title="GenMSIL.this.global.Symbol">sym</a> <span title="(mask: Long)Boolean">hasFlag</span> Flags.<span title="Long(32L)">FINAL</span><span class="delimiter">)</span>
        <a href="#249513" title="Int">mf</a> = <a href="#249513" title="Int">mf</a> <span title="(x: Short)Int">|</span> FieldAttributes.<span title="Short(32)">InitOnly</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#249511" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107527" title="=&gt; Boolean">isStaticMember</a><span class="delimiter">)</span>
        <a href="#249513" title="Int">mf</a> = <a href="#249513" title="Int">mf</a> <span title="(x: Short)Int">|</span> FieldAttributes.<span title="Short(16)">Static</span>

      <span class="comment">// TRANSIENT: &quot;not serialized&quot;, VOLATILE: doesn't exist on .net</span>
      <span class="comment">// TODO: add this annotation also if the class has the custom attribute</span>
      <span class="comment">// System.NotSerializedAttribute</span>
      <a href="#249511" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107411" title="=&gt; List[GenMSIL.this.global.AnnotationInfo]">annotations</a>.<span title="(f: GenMSIL.this.global.AnnotationInfo =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span> <a title="GenMSIL.this.global.AnnotationInfo" id="249543">a</a> =&gt; <a href="#249543" title="GenMSIL.this.global.AnnotationInfo">a</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Unit">AnnotationInfo</span><span class="delimiter">(</span><a href="#242193" title="=&gt; GenMSIL.this.global.Type">TransientAtt</a>, _, _<span class="delimiter">)</span> =&gt;
          <a href="#249513" title="Int">mf</a> = <a href="#249513" title="Int">mf</a> <span title="(x: Short)Int">|</span> FieldAttributes.<span title="Short(128)">NotSerialized</span>
        <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>

      <a href="#249513" title="Int">mf</a>.<span title="=&gt; Short">toShort</span>
    <span class="delimiter">}</span>

    <span class="comment">////////////////////// builders, types ///////////////////////</span>

    <span class="keyword">var</span> <a title="GenMSIL.this.global.Symbol" id="242286">entryPoint</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a> = _

    <span class="keyword">val</span> <a title="scala.collection.mutable.HashSet[GenMSIL.this.global.Symbol]" id="242288">notInitializedModules</a>: <span title="scala.collection.mutable.HashSet[GenMSIL.this.global.Symbol]">HashSet</span><span class="delimiter">[</span>Symbol<span class="delimiter">]</span> = <span title="()scala.collection.mutable.HashSet[GenMSIL.this.global.Symbol]" class="keyword">new</span> <span title="scala.collection.mutable.HashSet[GenMSIL.this.global.Symbol]">HashSet</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="comment">// TODO: create fields also in def createType, and not in genClass,</span>
    <span class="comment">// add a getField method (it only works as it is because fields never</span>
    <span class="comment">// accessed from outside a class)</span>

    <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.Local,ch.epfl.lamp.compiler.msil.emit.LocalBuilder]" id="242290">localBuilders</a>: <span title="scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.Local,ch.epfl.lamp.compiler.msil.emit.LocalBuilder]">HashMap</span><span class="delimiter">[</span>Local, LocalBuilder<span class="delimiter">]</span> = <span title="()scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.Local,ch.epfl.lamp.compiler.msil.emit.LocalBuilder]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.Local,ch.epfl.lamp.compiler.msil.emit.LocalBuilder]">HashMap</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">private</span><span class="delimiter">[</span>GenMSIL<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(cls: GenMSIL.this.global.icodes.IClass)Unit" id="242292">findEntryPoint</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IClass" id="242364">cls</a>: <a href="../icode/Members.scala.html#96982" title="GenMSIL.this.global.icodes.IClass">IClass</a><span class="delimiter">)</span> <span class="delimiter">{</span>

      <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)Boolean" id="249557">isEntryPoint</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="249558">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>:<span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#242303" title="(sym: GenMSIL.this.global.Symbol)Boolean">isStaticModule</a><span class="delimiter">(</span><a href="#249558" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.Symbol">owner</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#242281" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#249558" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;main&quot;)" class="string">&quot;main&quot;</span><span class="delimiter">)</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#249558" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.Type">tpe</a>.<a href="../../symtab/Types.scala.html#105476" title="=&gt; List[GenMSIL.this.global.Type]">paramTypes</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="../icode/TypeKinds.scala.html#97048" title="(t: GenMSIL.this.global.icodes.global.Type)GenMSIL.this.global.icodes.TypeKind">toTypeKind</a><span class="delimiter">(</span><a href="#249558" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.Type">tpe</a>.<a href="../../symtab/Types.scala.html#105476" title="(n: Int)GenMSIL.this.global.Type">paramTypes</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <span title="Unit">ARRAY</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="249579">elem</a><span class="delimiter">)</span> =&gt;
                <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#249579" title="GenMSIL.this.global.icodes.TypeKind">elem</a>.<a href="../icode/TypeKinds.scala.html#196006" title="=&gt; GenMSIL.this.global.icodes.global.Type">toType</a>.<a href="../../symtab/Types.scala.html#105454" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">typeSymbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106300" title="=&gt; GenMSIL.this.global.Symbol">StringClass</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                  <span title="Nothing" class="keyword">return</span> <span title="Boolean(true)" class="keyword">true</span>
                <span class="delimiter">}</span>
              <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span title="Boolean(false)" class="keyword">false</span>
      <span class="delimiter">}</span>

      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><span class="delimiter">(</span><a href="#242286" title="=&gt; GenMSIL.this.global.Symbol">entryPoint</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="../../Global.scala.html#64888" title="object GenMSIL.this.global.opt">opt</a>.<a href="../../Global.scala.html#97508" title="=&gt; Option[GenMSIL.this.global.Name]">showClass</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <span class="delimiter">{</span>  <span class="comment">// TODO introduce dedicated setting instead </span>
        <span class="keyword">val</span> <a title="String" id="249591">entryclass</a> = <a href="../../Global.scala.html#64888" title="object GenMSIL.this.global.opt">opt</a>.<a href="../../Global.scala.html#97508" title="=&gt; Option[GenMSIL.this.global.Name]">showClass</a>.<span title="=&gt; GenMSIL.this.global.Name">get</span>.<a href="../../symtab/Names.scala.html#96604" title="()String">toString</a> 
        <span class="keyword">val</span> <a title="String" id="249592">cfn</a> = <a href="#242364" title="GenMSIL.this.global.icodes.IClass">cls</a>.<a href="../icode/Members.scala.html#97411" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<span title="=&gt; String">fullName</span>
        <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#249592" title="String">cfn</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#249591" title="String">entryclass</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IMethod" id="249610">m</a> &lt;- <a href="#242364" title="GenMSIL.this.global.icodes.IClass">cls</a>.<a href="../icode/Members.scala.html#97417" title="(f: GenMSIL.this.global.icodes.IMethod =&gt; Unit)Unit">methods</a>; <span class="keyword">if</span> <a href="#249557" title="(sym: GenMSIL.this.global.Symbol)Boolean">isEntryPoint</a><span class="delimiter">(</span><a href="#249610" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197788" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#242286" title="(x$1: GenMSIL.this.global.Symbol)Unit">entryPoint</a> = <a href="#249610" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197788" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a> <span class="delimiter">}</span>
          <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#242286" title="=&gt; GenMSIL.this.global.Symbol">entryPoint</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="../../Global.scala.html#64874" title="(msg: String)Unit">warning</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Couldn\'t find main method in class &quot;)" class="string">&quot;Couldn't find main method in class &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#249592" title="String">cfn</a><span class="delimiter">)</span> <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#242217" title="=&gt; java.lang.String">firstSourceName</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#242364" title="GenMSIL.this.global.icodes.IClass">cls</a>.<a href="../icode/Members.scala.html#97411" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../symtab/Symbols.scala.html#107643" title="=&gt; scala.tools.nsc.io.AbstractFile">sourceFile</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="comment">// is null for nested classes</span>
          <a href="#242217" title="(x$1: java.lang.String)Unit">firstSourceName</a> = <a href="#242364" title="GenMSIL.this.global.icodes.IClass">cls</a>.<a href="../icode/Members.scala.html#97411" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../symtab/Symbols.scala.html#107643" title="=&gt; scala.tools.nsc.io.AbstractFile">sourceFile</a>.<a href="../../io/AbstractFile.scala.html#96473" title="=&gt; String">name</a>
    <span class="delimiter">}</span>

    <span class="comment">// #####################################################################</span>
    <span class="comment">// get and create types</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type" id="242293">msilType</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="245998">t</a>: <a href="../icode/TypeKinds.scala.html#97012" title="GenMSIL.this.global.icodes.TypeKind">TypeKind</a><span class="delimiter">)</span>: <span title="ch.epfl.lamp.compiler.msil.Type">MsilType</span> = <span class="delimiter">(</span><a href="#245998" title="GenMSIL.this.global.icodes.TypeKind">t</a>: @<a href="../icode/TypeKinds.scala.html#97012" title="GenMSIL.this.global.icodes.TypeKind @unchecked">unchecked</a><span class="delimiter">)</span> <span title="ch.epfl.lamp.compiler.msil.Type" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97018" title="ch.epfl.lamp.compiler.msil.Type">UNIT</a>           =&gt; <a href="../../symtab/clr/CLRTypes.scala.html#205438" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MVOID</a>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97020" title="ch.epfl.lamp.compiler.msil.Type">BOOL</a>           =&gt; <a href="../../symtab/clr/CLRTypes.scala.html#205435" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MBOOL</a>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97022" title="ch.epfl.lamp.compiler.msil.Type">BYTE</a>           =&gt; <a href="../../symtab/clr/CLRTypes.scala.html#205402" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MBYTE</a>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97024" title="ch.epfl.lamp.compiler.msil.Type">SHORT</a>          =&gt; <a href="../../symtab/clr/CLRTypes.scala.html#205408" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MSHORT</a>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97026" title="ch.epfl.lamp.compiler.msil.Type">CHAR</a>           =&gt; <a href="../../symtab/clr/CLRTypes.scala.html#205414" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MCHAR</a>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97028" title="ch.epfl.lamp.compiler.msil.Type">INT</a>            =&gt; <a href="../../symtab/clr/CLRTypes.scala.html#205417" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MINT</a>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97030" title="ch.epfl.lamp.compiler.msil.Type">LONG</a>           =&gt; <a href="../../symtab/clr/CLRTypes.scala.html#205423" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MLONG</a>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97032" title="ch.epfl.lamp.compiler.msil.Type">FLOAT</a>          =&gt; <a href="../../symtab/clr/CLRTypes.scala.html#205429" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MFLOAT</a>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97034" title="ch.epfl.lamp.compiler.msil.Type">DOUBLE</a>         =&gt; <a href="../../symtab/clr/CLRTypes.scala.html#205432" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MDOUBLE</a>
      <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.Type">REFERENCE</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="249628">cls</a><span class="delimiter">)</span> =&gt; <a href="#242296" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#249628" title="GenMSIL.this.global.icodes.global.Symbol">cls</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.Type">ARRAY</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="249630">elem</a><span class="delimiter">)</span>    =&gt;
        <a href="#242293" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#249630" title="GenMSIL.this.global.icodes.TypeKind">elem</a><span class="delimiter">)</span> <span title="ch.epfl.lamp.compiler.msil.Type" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="comment">// For type builders, cannot call &quot;clrTypes.mkArrayType&quot; because this looks up</span>
          <span class="comment">// the type &quot;tp&quot; in the assembly (not in the HashMap &quot;types&quot; of the backend).</span>
          <span class="comment">// This can fail for nested types because the builders are not complete yet.</span>
          <span class="keyword">case</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="249637">tb</a>: <span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span> =&gt; <a href="#249637" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tb</a>.<span title="()ch.epfl.lamp.compiler.msil.Type">MakeArrayType</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="249638">tp</a>: <span title="ch.epfl.lamp.compiler.msil.Type">MsilType</span> =&gt; <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205494" title="(elemType: ch.epfl.lamp.compiler.msil.Type)ch.epfl.lamp.compiler.msil.Type">mkArrayType</a><span class="delimiter">(</span><a href="#249638" title="ch.epfl.lamp.compiler.msil.Type">tp</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type" id="242294">msilType</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Type" id="245996">tpe</a>: <a href="../../symtab/Types.scala.html#67392" title="GenMSIL.this.global.Type">Type</a><span class="delimiter">)</span>: <span title="ch.epfl.lamp.compiler.msil.Type">MsilType</span> = <a href="#242293" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="../icode/TypeKinds.scala.html#97048" title="(t: GenMSIL.this.global.icodes.global.Type)GenMSIL.this.global.icodes.TypeKind">toTypeKind</a><span class="delimiter">(</span><a href="#245996" title="GenMSIL.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)Array[ch.epfl.lamp.compiler.msil.Type]" id="242295">msilParamTypes</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="249645">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span class="delimiter">[</span>MsilType<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <a href="#249645" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.Type">tpe</a>.<a href="../../symtab/Types.scala.html#105476" title="=&gt; List[GenMSIL.this.global.Type]">paramTypes</a>.<span title="(f: GenMSIL.this.global.Type =&gt; ch.epfl.lamp.compiler.msil.Type)(implicit bf: scala.collection.generic.CanBuildFrom[List[GenMSIL.this.global.Type],ch.epfl.lamp.compiler.msil.Type,List[ch.epfl.lamp.compiler.msil.Type]])List[ch.epfl.lamp.compiler.msil.Type]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,ch.epfl.lamp.compiler.msil.Type,List[ch.epfl.lamp.compiler.msil.Type]]" class="delimiter">(</span><a href="#242294" title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">)</span>.<span title="(implicit evidence$1: ClassManifest[ch.epfl.lamp.compiler.msil.Type])Array[ch.epfl.lamp.compiler.msil.Type]">toArray</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type" id="242296">getType</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="245731">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span> = <a href="#242297" title="(sym: GenMSIL.this.global.Symbol)Option[ch.epfl.lamp.compiler.msil.Type]">getTypeOpt</a><span class="delimiter">(</span><a href="#245731" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>.<span title="(default: =&gt; ch.epfl.lamp.compiler.msil.Type)ch.epfl.lamp.compiler.msil.Type">getOrElse</span><span class="delimiter">(</span><a href="../../symtab/SymbolTable.scala.html#64790" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><a href="#242330" title="(sym: GenMSIL.this.global.Symbol)String">showsym</a><span class="delimiter">(</span><a href="#245731" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="comment">/**
     * Get an MSIL type from a symbol. First look in the clrTypes.types map, then
     * lookup the name using clrTypes.getType
     */</span>
    <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)Option[ch.epfl.lamp.compiler.msil.Type]" id="242297">getTypeOpt</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="245734">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="Option[ch.epfl.lamp.compiler.msil.Type]">Option</span><span class="delimiter">[</span>MsilType<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Option[ch.epfl.lamp.compiler.msil.Type]" id="249720">tmp</a> = <a href="../../symtab/clr/CLRTypes.scala.html#205474" title="=&gt; scala.collection.mutable.Map[GenMSIL.this.global.loaders.clrTypes.global.Symbol,ch.epfl.lamp.compiler.msil.Type]">types</a>.<span title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)Option[ch.epfl.lamp.compiler.msil.Type]">get</span><span class="delimiter">(</span><a href="#245734" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>
      <a href="#249720" title="Option[ch.epfl.lamp.compiler.msil.Type]">tmp</a> <span title="Option[ch.epfl.lamp.compiler.msil.Type]" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Some[ch.epfl.lamp.compiler.msil.Type]" id="249723">typ</a> @ Some<span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt; <a href="#249723" title="Some[ch.epfl.lamp.compiler.msil.Type]">typ</a>
        <span class="keyword">case</span> <span title="Option[ch.epfl.lamp.compiler.msil.Type]">None</span> =&gt;
          <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)String" id="249725">typeString</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="249728">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="java.lang.String" id="249729">s</a> = <span title="java.lang.String" class="keyword">if</span> <span class="delimiter">(</span><a href="#249728" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107532" title="=&gt; Boolean">isNestedClass</a><span class="delimiter">)</span> <a href="#249725" title="(sym: GenMSIL.this.global.Symbol)String">typeString</a><span class="delimiter">(</span><a href="#249728" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.Symbol">owner</a><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;+&quot;)" class="string">&quot;+&quot;</span><span title="(x$1: Any)java.lang.String">+</span> <a href="#249728" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107648" title="=&gt; GenMSIL.this.global.Name">simpleName</a>
                    <span class="keyword">else</span> <a href="#249728" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; String">fullName</span>
            <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#249728" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; Boolean">isModuleClass</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#249728" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107480" title="=&gt; Boolean">isTrait</a><span class="delimiter">)</span> <a href="#249729" title="java.lang.String">s</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;$&quot;)" class="string">&quot;$&quot;</span> <span class="keyword">else</span> <a href="#249729" title="java.lang.String">s</a>
          <span class="delimiter">}</span>
          <span class="keyword">val</span> <a title="String" id="249726">name</a> = <a href="#249725" title="(sym: GenMSIL.this.global.Symbol)String">typeString</a><span class="delimiter">(</span><a href="#245734" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="249727">typ</a> = <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205492" title="(name: String)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#249726" title="String">name</a><span class="delimiter">)</span>
          <span title="Option[ch.epfl.lamp.compiler.msil.Type]" class="keyword">if</span> <span class="delimiter">(</span><a href="#249727" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
            <span title="object None">None</span>
          <span class="keyword">else</span> <span class="delimiter">{</span>
            <a href="../../symtab/clr/CLRTypes.scala.html#205474" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol, value: ch.epfl.lamp.compiler.msil.Type)Unit">types</a><span class="delimiter">(</span><a href="#245734" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span> = <a href="#249727" title="ch.epfl.lamp.compiler.msil.Type">typ</a>
            <span title="(x: ch.epfl.lamp.compiler.msil.Type)Some[ch.epfl.lamp.compiler.msil.Type]">Some</span><span class="delimiter">(</span><a href="#249727" title="ch.epfl.lamp.compiler.msil.Type">typ</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit" id="242298">mapType</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="243183">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a>, <a title="ch.epfl.lamp.compiler.msil.Type" id="243184">mType</a>: <span title="ch.epfl.lamp.compiler.msil.Type">MsilType</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#243184" title="ch.epfl.lamp.compiler.msil.Type">mType</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span>, <a href="#242330" title="(sym: GenMSIL.this.global.Symbol)String">showsym</a><span class="delimiter">(</span><a href="#243183" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="../../symtab/clr/CLRTypes.scala.html#205474" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol, value: ch.epfl.lamp.compiler.msil.Type)Unit">types</a><span class="delimiter">(</span><a href="#243183" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span> = <a href="#243184" title="ch.epfl.lamp.compiler.msil.Type">mType</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(iclass: GenMSIL.this.global.icodes.IClass)Unit" id="242299">createTypeBuilder</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IClass" id="242462">iclass</a>: <a href="../icode/Members.scala.html#96982" title="GenMSIL.this.global.icodes.IClass">IClass</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="comment">/**
       * First look in the clrTypes.types map, if that fails check if it's a class being compiled, otherwise
       * lookup by name (clrTypes.getType calls the static method msil.Type.GetType(fullname)).
       */</span>
      <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type" id="249747">msilTypeFromSym</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="249755">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="ch.epfl.lamp.compiler.msil.Type">MsilType</span> = <span class="delimiter">{</span>
        <a href="../../symtab/clr/CLRTypes.scala.html#205474" title="=&gt; scala.collection.mutable.Map[GenMSIL.this.global.loaders.clrTypes.global.Symbol,ch.epfl.lamp.compiler.msil.Type]">types</a>.<span title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)Option[ch.epfl.lamp.compiler.msil.Type]">get</span><span class="delimiter">(</span><a href="#249755" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>.<span title="(default: =&gt; ch.epfl.lamp.compiler.msil.Type)ch.epfl.lamp.compiler.msil.Type">getOrElse</span> <span class="delimiter">{</span>
          <a href="../icode/ICodes.scala.html#96940" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.global.Symbol,GenMSIL.this.global.icodes.IClass]">classes</a>.<span title="(key: GenMSIL.this.global.icodes.global.Symbol)Option[GenMSIL.this.global.icodes.IClass]">get</span><span class="delimiter">(</span><a href="#249755" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span> <span title="ch.epfl.lamp.compiler.msil.Type" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">Some</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IClass" id="249762">iclass</a><span class="delimiter">)</span> =&gt;
	              <a href="#249748" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.emit.TypeBuilder">msilTypeBuilderFromSym</a><span class="delimiter">(</span><a href="#249755" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>
            <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.Type">None</span> =&gt;
              <a href="#242296" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#249755" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.emit.TypeBuilder" id="249748">msilTypeBuilderFromSym</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="249763">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span> = <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><span class="delimiter">(</span><a href="../../symtab/clr/CLRTypes.scala.html#205474" title="=&gt; scala.collection.mutable.Map[GenMSIL.this.global.loaders.clrTypes.global.Symbol,ch.epfl.lamp.compiler.msil.Type]">types</a>.<span title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)Boolean">contains</span><span class="delimiter">(</span><a href="#249763" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="../../symtab/clr/CLRTypes.scala.html#205474" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)ch.epfl.lamp.compiler.msil.Type">types</a><span class="delimiter">(</span><a href="#249763" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.IClass" id="249781">iclass</a> = <a href="../icode/ICodes.scala.html#96940" title="(key: GenMSIL.this.global.icodes.global.Symbol)GenMSIL.this.global.icodes.IClass">classes</a><span class="delimiter">(</span><a href="#249763" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>
          <span title="(assertion: Boolean)Unit">assert</span><span class="delimiter">(</span><a href="#249781" title="GenMSIL.this.global.icodes.IClass">iclass</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
          <a href="#242299" title="(iclass: GenMSIL.this.global.icodes.IClass)Unit">createTypeBuilder</a><span class="delimiter">(</span><a href="#249781" title="GenMSIL.this.global.icodes.IClass">iclass</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="../../symtab/clr/CLRTypes.scala.html#205474" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)ch.epfl.lamp.compiler.msil.Type">types</a><span class="delimiter">(</span><a href="#249763" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" class="delimiter">[</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span><span class="delimiter">]</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.global.Symbol" id="249749">sym</a> = <a href="#242462" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#97411" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../symtab/clr/CLRTypes.scala.html#205474" title="=&gt; scala.collection.mutable.Map[GenMSIL.this.global.loaders.clrTypes.global.Symbol,ch.epfl.lamp.compiler.msil.Type]">types</a>.<span title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)Boolean">contains</span><span class="delimiter">(</span><a href="#249749" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="../../symtab/clr/CLRTypes.scala.html#205474" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)ch.epfl.lamp.compiler.msil.Type">types</a><span class="delimiter">(</span><a href="#249749" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span><span class="delimiter">]</span><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">return</span>

      <span class="keyword">def</span> <a title="(s: GenMSIL.this.global.Symbol)Boolean" id="249750">isInterface</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="249833">s</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span> = <a href="#249833" title="GenMSIL.this.global.Symbol">s</a>.<a href="../../symtab/Symbols.scala.html#107480" title="=&gt; Boolean">isTrait</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#249833" title="GenMSIL.this.global.Symbol">s</a>.<span title="=&gt; Boolean">isImplClass</span>
      <span class="keyword">val</span> <a title="List[GenMSIL.this.global.Type]" id="249751">parents</a>: <span title="List[GenMSIL.this.global.Type]">List</span><span class="delimiter">[</span>Type<span class="delimiter">]</span> =
        <span title="List[GenMSIL.this.global.Type]" class="keyword">if</span> <span class="delimiter">(</span><a href="#249749" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107564" title="=&gt; GenMSIL.this.global.icodes.global.Type">info</a>.<a href="../../symtab/Types.scala.html#105463" title="=&gt; List[GenMSIL.this.global.icodes.global.Type]">parents</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span title="(xs: GenMSIL.this.global.Type*)List[GenMSIL.this.global.Type]">List</span><span class="delimiter">(</span><a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106220" title="=&gt; GenMSIL.this.global.Symbol">ObjectClass</a>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.Type">tpe</a><span class="delimiter">)</span>
        <span class="keyword">else</span> <a href="#249749" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107564" title="=&gt; GenMSIL.this.global.icodes.global.Type">info</a>.<a href="../../symtab/Types.scala.html#105463" title="=&gt; List[GenMSIL.this.global.icodes.global.Type]">parents</a>.<span title="=&gt; List[GenMSIL.this.global.icodes.global.Type]">distinct</span>

      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="249752">superType</a> : <span title="ch.epfl.lamp.compiler.msil.Type">MsilType</span> = <span title="ch.epfl.lamp.compiler.msil.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="#249750" title="(s: GenMSIL.this.global.Symbol)Boolean">isInterface</a><span class="delimiter">(</span><a href="#249749" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="Null(null)" class="keyword">null</span> <span class="keyword">else</span> <a href="#249747" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">msilTypeFromSym</a><span class="delimiter">(</span><a href="#249751" title="List[GenMSIL.this.global.Type]">parents</a>.<span title="=&gt; GenMSIL.this.global.Type">head</span>.<a href="../../symtab/Types.scala.html#105454" title="=&gt; GenMSIL.this.global.Symbol">typeSymbol</a><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36747" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
        <a href="../../Global.scala.html#64883" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;super type: &quot;)" class="string">&quot;super type: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#249751" title="(n: Int)GenMSIL.this.global.Type">parents</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<a href="../../symtab/Types.scala.html#105454" title="=&gt; GenMSIL.this.global.Symbol">typeSymbol</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;, msil type: &quot;)" class="string">&quot;, msil type: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#249752" title="ch.epfl.lamp.compiler.msil.Type">superType</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="Array[ch.epfl.lamp.compiler.msil.Type]" id="249753">interfaces</a>: <span title="Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span class="delimiter">[</span>MsilType<span class="delimiter">]</span> =
	<a href="#249751" title="List[GenMSIL.this.global.Type]">parents</a>.<span title="=&gt; List[GenMSIL.this.global.Type]">tail</span>.<span title="(f: GenMSIL.this.global.Type =&gt; ch.epfl.lamp.compiler.msil.Type)(implicit bf: scala.collection.generic.CanBuildFrom[List[GenMSIL.this.global.Type],ch.epfl.lamp.compiler.msil.Type,List[ch.epfl.lamp.compiler.msil.Type]])List[ch.epfl.lamp.compiler.msil.Type]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,ch.epfl.lamp.compiler.msil.Type,List[ch.epfl.lamp.compiler.msil.Type]]" class="delimiter">(</span><a title="GenMSIL.this.global.Type" id="249874">p</a> =&gt; <a href="#249747" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">msilTypeFromSym</a><span class="delimiter">(</span><a href="#249874" title="GenMSIL.this.global.Type">p</a>.<a href="../../symtab/Types.scala.html#105454" title="=&gt; GenMSIL.this.global.Symbol">typeSymbol</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(implicit evidence$1: ClassManifest[ch.epfl.lamp.compiler.msil.Type])Array[ch.epfl.lamp.compiler.msil.Type]">toArray</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#249751" title="List[GenMSIL.this.global.Type]">parents</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36747" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; Boolean">value</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../../Global.scala.html#64883" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;interfaces:&quot;)" class="string">&quot;interfaces:&quot;</span><span class="delimiter">)</span>
          <span class="keyword">for</span> <span class="delimiter">(</span><a title="Int" id="250026">i</a> &lt;- <span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span>.<span title="(end: Int)scala.collection.immutable.Range">until</span><span title="(f: Int =&gt; Unit)Unit" class="delimiter">(</span><a href="#249753" title="Array[ch.epfl.lamp.compiler.msil.Type]">interfaces</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="../../Global.scala.html#64883" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;  type: &quot;)" class="string">&quot;  type: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#249751" title="(n: Int)GenMSIL.this.global.Type">parents</a><span class="delimiter">(</span><a href="#250026" title="Int">i</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<a href="../../symtab/Types.scala.html#105454" title="=&gt; GenMSIL.this.global.Symbol">typeSymbol</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;, msil type: &quot;)" class="string">&quot;, msil type: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#249753" title="(i: Int)ch.epfl.lamp.compiler.msil.Type">interfaces</a><span class="delimiter">(</span><a href="#250026" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" id="249754">tBuilder</a> = <span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" class="keyword">if</span> <span class="delimiter">(</span><a href="#249749" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107532" title="=&gt; Boolean">isNestedClass</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" id="250040">ownerT</a> = <a href="#249748" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.emit.TypeBuilder">msilTypeBuilderFromSym</a><span class="delimiter">(</span><a href="#249749" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">owner</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" class="delimiter">[</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span><span class="delimiter">]</span>
        <a href="#250040" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">ownerT</a>.<span title="(name: String, attributes: Int, baseType: ch.epfl.lamp.compiler.msil.Type, interfaces: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.emit.TypeBuilder">DefineNestedType</span><span class="delimiter">(</span><a href="#242281" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#249749" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>, <a href="#242282" title="(sym: GenMSIL.this.global.Symbol)Int">msilTypeFlags</a><span class="delimiter">(</span><a href="#249749" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>, <a href="#249752" title="ch.epfl.lamp.compiler.msil.Type">superType</a>, <a href="#249753" title="Array[ch.epfl.lamp.compiler.msil.Type]">interfaces</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="#242208" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ModuleBuilder">mmodule</a>.<span title="(typeName: String, attributes: Int, baseType: ch.epfl.lamp.compiler.msil.Type, interfaces: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.emit.TypeBuilder">DefineType</span><span class="delimiter">(</span><a href="#242281" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#249749" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>, <a href="#242282" title="(sym: GenMSIL.this.global.Symbol)Int">msilTypeFlags</a><span class="delimiter">(</span><a href="#249749" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>, <a href="#249752" title="ch.epfl.lamp.compiler.msil.Type">superType</a>, <a href="#249753" title="Array[ch.epfl.lamp.compiler.msil.Type]">interfaces</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#242298" title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit">mapType</a><span class="delimiter">(</span><a href="#249749" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>, <a href="#249754" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="comment">// createTypeBuilder</span>

    <span class="keyword">def</span> <a title="(iclass: GenMSIL.this.global.icodes.IClass)Unit" id="242300">createClassMembers</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IClass" id="242477">iclass</a>: <a href="../icode/Members.scala.html#96982" title="GenMSIL.this.global.icodes.IClass">IClass</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="#242301" title="(iclass: GenMSIL.this.global.icodes.IClass)Unit">createClassMembers0</a><span class="delimiter">(</span><a href="#242477" title="GenMSIL.this.global.icodes.IClass">iclass</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Nothing" id="250045">e</a>: <span title="Throwable">Throwable</span> =&gt;
          java.lang.<span title="object java.lang.System">System</span>.<span title="java.io.PrintStream">err</span>.<span title="(x$1: java.lang.String)Unit">println</span><span class="delimiter">(</span><a href="#242330" title="(sym: GenMSIL.this.global.Symbol)String">showsym</a><span class="delimiter">(</span><a href="#242477" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#97411" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a><span class="delimiter">)</span><span class="delimiter">)</span>
          java.lang.<span title="object java.lang.System">System</span>.<span title="java.io.PrintStream">err</span>.<span title="(x$1: java.lang.String)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;with methods = &quot;)" class="string">&quot;with methods = &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#242477" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#97417" title="=&gt; List[GenMSIL.this.global.icodes.IMethod]">methods</a><span class="delimiter">)</span>
          <span title="Nothing" class="keyword">throw</span> <a href="#250045" title="java.lang.Throwable">e</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(iclass: GenMSIL.this.global.icodes.IClass)Unit" id="242301">createClassMembers0</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IClass" id="250043">iclass</a>: <a href="../icode/Members.scala.html#96982" title="GenMSIL.this.global.icodes.IClass">IClass</a><span class="delimiter">)</span> <span class="delimiter">{</span>

      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" id="250054">mtype</a> = <a href="#242296" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#250043" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#97411" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" class="delimiter">[</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span><span class="delimiter">]</span>

      <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IField" id="250080">ifield</a> &lt;- <a href="#250043" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#97414" title="(f: GenMSIL.this.global.icodes.IField =&gt; Unit)Unit">fields</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.global.Symbol" id="250081">sym</a> = <a href="#250080" title="GenMSIL.this.global.icodes.IField">ifield</a>.<a href="../icode/Members.scala.html#210687" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36747" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
          <a href="../../Global.scala.html#64883" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Adding field: &quot;)" class="string">&quot;Adding field: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#250081" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<span title="=&gt; String">fullName</span><span class="delimiter">)</span>

        <span class="keyword">var</span> <a title="Short" id="250082">attributes</a> = <a href="#242284" title="(sym: GenMSIL.this.global.Symbol)Short">msilFieldFlags</a><span class="delimiter">(</span><a href="#250081" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.util.PECustomMod" id="250083">fieldTypeWithCustomMods</a> = 
          <span title="ch.epfl.lamp.compiler.msil.util.PECustomMod" class="keyword">new</span> <span title="ch.epfl.lamp.compiler.msil.util.PECustomMod">PECustomMod</span><span class="delimiter">(</span><a href="#242294" title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#250081" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.icodes.global.Type">tpe</a><span class="delimiter">)</span>, 
                          <a href="#242231" title="(annotations: List[GenMSIL.this.global.AnnotationInfo])Array[ch.epfl.lamp.compiler.msil.CustomModifier]">customModifiers</a><span class="delimiter">(</span><a href="#250081" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107411" title="=&gt; List[GenMSIL.this.global.icodes.global.AnnotationInfo]">annotations</a><span class="delimiter">)</span><span class="delimiter">)</span> 
        <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.FieldBuilder" id="250084">fBuilder</a> = <a href="#250054" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">mtype</a>.<span title="(name: String, fieldTypeWithMods: ch.epfl.lamp.compiler.msil.util.PECustomMod, attrs: Short)ch.epfl.lamp.compiler.msil.emit.FieldBuilder">DefineField</span><span class="delimiter">(</span><a href="#242281" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#250081" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>, 
                                         <a href="#250083" title="ch.epfl.lamp.compiler.msil.util.PECustomMod">fieldTypeWithCustomMods</a>, 
                                         <a href="#250082" title="Short">attributes</a><span class="delimiter">)</span>
        <a href="../../symtab/clr/CLRTypes.scala.html#205480" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol, value: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">fields</a><span class="delimiter">(</span><a href="#250081" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span> = <a href="#250084" title="ch.epfl.lamp.compiler.msil.emit.FieldBuilder">fBuilder</a>
        <a href="#242230" title="(member: ch.epfl.lamp.compiler.msil.emit.ICustomAttributeSetter, annotations: List[GenMSIL.this.global.AnnotationInfo])Unit">addAttributes</a><span class="delimiter">(</span><a href="#250084" title="ch.epfl.lamp.compiler.msil.emit.FieldBuilder">fBuilder</a>, <a href="#250081" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107411" title="=&gt; List[GenMSIL.this.global.icodes.global.AnnotationInfo]">annotations</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="comment">// all iclass.fields iterated over</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#242303" title="(sym: GenMSIL.this.global.Symbol)Boolean">isStaticModule</a><span class="delimiter">(</span><a href="#250043" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#97411" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Option[GenMSIL.this.global.icodes.IMethod]" id="250103">sc</a> = <a href="#250043" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#97433" title="=&gt; Option[GenMSIL.this.global.icodes.IMethod]">lookupStaticCtor</a>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#250103" title="Option[GenMSIL.this.global.icodes.IMethod]">sc</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.IMethod" id="250104">m</a> = <a href="#250103" title="Option[GenMSIL.this.global.icodes.IMethod]">sc</a>.<span title="=&gt; GenMSIL.this.global.icodes.IMethod">get</span>
          <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.BasicBlock" id="250105">oldLastBlock</a> = <a href="#250104" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197791" title="=&gt; GenMSIL.this.global.icodes.Code">code</a>.<a href="../icode/Members.scala.html#197864" title="=&gt; scala.collection.mutable.ListBuffer[GenMSIL.this.global.icodes.BasicBlock]">blocks</a>.<span title="=&gt; GenMSIL.this.global.icodes.BasicBlock">last</span>
          <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.BasicBlock" id="250106">lastBlock</a> = <a href="#250104" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197791" title="=&gt; GenMSIL.this.global.icodes.Code">code</a>.<a href="../icode/Members.scala.html#197883" title="=&gt; GenMSIL.this.global.icodes.BasicBlock">newBlock</a>
          <a href="#250105" title="GenMSIL.this.global.icodes.BasicBlock">oldLastBlock</a>.<a href="../icode/BasicBlocks.scala.html#197720" title="(pos: Int, instr: GenMSIL.this.global.icodes.Instruction)Boolean">replaceInstruction</a><span class="delimiter">(</span><a href="#250105" title="GenMSIL.this.global.icodes.BasicBlock">oldLastBlock</a>.<a href="../icode/BasicBlocks.scala.html#197718" title="=&gt; Int">length</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span>, <a href="../icode/Opcodes.scala.html#202681" title="(whereto: GenMSIL.this.global.icodes.BasicBlock)GenMSIL.this.global.icodes.opcodes.JUMP">JUMP</a><span class="delimiter">(</span><a href="#250106" title="GenMSIL.this.global.icodes.BasicBlock">lastBlock</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="comment">// call object's private ctor from static ctor</span>
          <a href="#250106" title="GenMSIL.this.global.icodes.BasicBlock">lastBlock</a>.<a href="../icode/BasicBlocks.scala.html#197727" title="(instr: GenMSIL.this.global.icodes.Instruction)Unit">emit</a><span class="delimiter">(</span><a href="../icode/Opcodes.scala.html#208793" title="(method: GenMSIL.this.global.icodes.global.Symbol)GenMSIL.this.global.icodes.opcodes.CIL_NEWOBJ">CIL_NEWOBJ</a><span class="delimiter">(</span><a href="#250043" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#97411" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../symtab/Symbols.scala.html#107597" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">primaryConstructor</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#250106" title="GenMSIL.this.global.icodes.BasicBlock">lastBlock</a>.<a href="../icode/BasicBlocks.scala.html#197727" title="(instr: GenMSIL.this.global.icodes.Instruction)Unit">emit</a><span class="delimiter">(</span><a href="../icode/Opcodes.scala.html#206884" title="(typ: GenMSIL.this.global.icodes.TypeKind)GenMSIL.this.global.icodes.opcodes.DROP">DROP</a><span class="delimiter">(</span><a href="../icode/TypeKinds.scala.html#97048" title="(t: GenMSIL.this.global.icodes.global.Type)GenMSIL.this.global.icodes.TypeKind">toTypeKind</a><span class="delimiter">(</span><a href="#250043" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#97411" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.icodes.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#250106" title="GenMSIL.this.global.icodes.BasicBlock">lastBlock</a> <a href="../icode/BasicBlocks.scala.html#197727" title="(instr: GenMSIL.this.global.icodes.Instruction)Unit">emit</a> <a href="../icode/Opcodes.scala.html#202718" title="(kind: GenMSIL.this.global.icodes.TypeKind)GenMSIL.this.global.icodes.opcodes.RETURN">RETURN</a><span class="delimiter">(</span><a href="../icode/TypeKinds.scala.html#97018" title="object GenMSIL.this.global.icodes.UNIT">UNIT</a><span class="delimiter">)</span>
          <a href="#250106" title="GenMSIL.this.global.icodes.BasicBlock">lastBlock</a>.<a href="../icode/BasicBlocks.scala.html#197733" title="()Unit">close</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#250043" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#97411" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106394" title="=&gt; GenMSIL.this.global.Symbol">ArrayClass</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IMethod" id="250181">m</a>: <a href="../icode/Members.scala.html#96984" title="GenMSIL.this.global.icodes.IMethod">IMethod</a> &lt;- <a href="#250043" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#97417" title="(f: GenMSIL.this.global.icodes.IMethod =&gt; Unit)Unit">methods</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.global.Symbol" id="250182">sym</a> = <a href="#250181" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197788" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36747" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
          <a href="../../Global.scala.html#64883" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Creating MethodBuilder for &quot;)" class="string">&quot;Creating MethodBuilder for &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="../../symtab/Flags.scala.html#24068" title="object scala.tools.nsc.symtab.Flags">Flags</a>.<span title="(flags: Long)String">flagsToString</span><span class="delimiter">(</span><a href="#250182" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107551" title="=&gt; Long">flags</a><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span>
              <a href="#250182" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">owner</a>.<span title="=&gt; String">fullName</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;::&quot;)" class="string">&quot;::&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#250182" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107548" title="=&gt; GenMSIL.this.global.icodes.global.Name">name</a><span class="delimiter">)</span>

        <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" id="250183">ownerType</a> = <a href="#242296" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#250182" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<span title="=&gt; GenMSIL.this.global.icodes.global.Symbol">enclClass</span><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" class="delimiter">[</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span><span class="delimiter">]</span>
        <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#250054" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">mtype</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#250183" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">ownerType</a>, <span title="java.lang.String(&quot;mtype = &quot;)" class="string">&quot;mtype = &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#250054" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">mtype</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;; ownerType = &quot;)" class="string">&quot;; ownerType = &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#250183" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">ownerType</a><span class="delimiter">)</span>
        <span class="keyword">var</span> <a title="Array[ch.epfl.lamp.compiler.msil.Type]" id="250184">paramTypes</a> = <a href="#242295" title="(sym: GenMSIL.this.global.Symbol)Array[ch.epfl.lamp.compiler.msil.Type]">msilParamTypes</a><span class="delimiter">(</span><a href="#250182" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Short" id="250185">attr</a> = <a href="#242283" title="(sym: GenMSIL.this.global.Symbol)Short">msilMethodFlags</a><span class="delimiter">(</span><a href="#250182" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>

        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#250181" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197788" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../symtab/Symbols.scala.html#107473" title="=&gt; Boolean">isClassConstructor</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.ConstructorBuilder" id="250199">constr</a> =
            <a href="#250183" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">ownerType</a>.<span title="(attrs: Short, callingConvention: Short, paramTypes: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.emit.ConstructorBuilder">DefineConstructor</span><span class="delimiter">(</span><a href="#250185" title="Short">attr</a>, CallingConventions.<span title="Short(1)">Standard</span>, <a href="#250184" title="Array[ch.epfl.lamp.compiler.msil.Type]">paramTypes</a><span class="delimiter">)</span>
          <span class="keyword">for</span> <span class="delimiter">(</span><a title="Int" id="250306">i</a> &lt;- <span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span>.<span title="(end: Int)scala.collection.immutable.Range">until</span><span title="(f: Int =&gt; ch.epfl.lamp.compiler.msil.emit.ParameterBuilder)Unit" class="delimiter">(</span><a href="#250184" title="Array[ch.epfl.lamp.compiler.msil.Type]">paramTypes</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#250199" title="ch.epfl.lamp.compiler.msil.emit.ConstructorBuilder">constr</a>.<span title="(pos: Int, attr: Int, name: String)ch.epfl.lamp.compiler.msil.emit.ParameterBuilder">DefineParameter</span><span class="delimiter">(</span><a href="#250306" title="Int">i</a>, ParameterAttributes.<span title="Int(0)">None</span>, <a href="#242281" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#250181" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197812" title="(n: Int)GenMSIL.this.global.icodes.Local">params</a><span class="delimiter">(</span><a href="#250306" title="Int">i</a><span class="delimiter">)</span>.<a href="../icode/Members.scala.html#197979" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <a href="#242322" title="(sym: GenMSIL.this.global.Symbol, cInfo: ch.epfl.lamp.compiler.msil.ConstructorInfo)Unit">mapConstructor</a><span class="delimiter">(</span><a href="#250182" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>, <a href="#250199" title="ch.epfl.lamp.compiler.msil.emit.ConstructorBuilder">constr</a><span class="delimiter">)</span>
          <a href="#242230" title="(member: ch.epfl.lamp.compiler.msil.emit.ICustomAttributeSetter, annotations: List[GenMSIL.this.global.AnnotationInfo])Unit">addAttributes</a><span class="delimiter">(</span><a href="#250199" title="ch.epfl.lamp.compiler.msil.emit.ConstructorBuilder">constr</a>, <a href="#250182" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107411" title="=&gt; List[GenMSIL.this.global.icodes.global.AnnotationInfo]">annotations</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">var</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="250322">resType</a> = <a href="#242293" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#250181" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197803" title="=&gt; GenMSIL.this.global.icodes.TypeKind">returnType</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder" id="250323">method</a> =
            <a href="#250183" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">ownerType</a>.<span title="(name: String, attrs: Short, returnType: ch.epfl.lamp.compiler.msil.Type, paramTypes: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.emit.MethodBuilder">DefineMethod</span><span class="delimiter">(</span><a href="#242281" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#250182" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>, <a href="#250185" title="Short">attr</a>, <a href="#250322" title="ch.epfl.lamp.compiler.msil.Type">resType</a>, <a href="#250184" title="Array[ch.epfl.lamp.compiler.msil.Type]">paramTypes</a><span class="delimiter">)</span>
          <span class="keyword">for</span> <span class="delimiter">(</span><a title="Int" id="250429">i</a> &lt;- <span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span>.<span title="(end: Int)scala.collection.immutable.Range">until</span><span title="(f: Int =&gt; ch.epfl.lamp.compiler.msil.emit.ParameterBuilder)Unit" class="delimiter">(</span><a href="#250184" title="Array[ch.epfl.lamp.compiler.msil.Type]">paramTypes</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#250323" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">method</a>.<span title="(pos: Int, attr: Int, name: String)ch.epfl.lamp.compiler.msil.emit.ParameterBuilder">DefineParameter</span><span class="delimiter">(</span><a href="#250429" title="Int">i</a>, ParameterAttributes.<span title="Int(0)">None</span>, <a href="#242281" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#250181" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197812" title="(n: Int)GenMSIL.this.global.icodes.Local">params</a><span class="delimiter">(</span><a href="#250429" title="Int">i</a><span class="delimiter">)</span>.<a href="../icode/Members.scala.html#197979" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="../../symtab/clr/CLRTypes.scala.html#205478" title="=&gt; scala.collection.mutable.Map[GenMSIL.this.global.loaders.clrTypes.global.Symbol,ch.epfl.lamp.compiler.msil.MethodInfo]">methods</a>.<span title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)Boolean">contains</span><span class="delimiter">(</span><a href="#250182" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#242324" title="(sym: GenMSIL.this.global.Symbol, mInfo: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">mapMethod</a><span class="delimiter">(</span><a href="#250182" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>, <a href="#250323" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">method</a><span class="delimiter">)</span>
          <a href="#242230" title="(member: ch.epfl.lamp.compiler.msil.emit.ICustomAttributeSetter, annotations: List[GenMSIL.this.global.AnnotationInfo])Unit">addAttributes</a><span class="delimiter">(</span><a href="#250323" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">method</a>, <a href="#250182" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107411" title="=&gt; List[GenMSIL.this.global.icodes.global.AnnotationInfo]">annotations</a><span class="delimiter">)</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36747" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
            <a href="../../Global.scala.html#64883" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;\011 created MethodBuilder &quot;)" class="string">&quot;\t created MethodBuilder &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#250323" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">method</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span class="delimiter">}</span> <span class="comment">// method builders created for non-array iclass</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#242303" title="(sym: GenMSIL.this.global.Symbol)Boolean">isStaticModule</a><span class="delimiter">(</span><a href="#250043" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#97411" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#242305" title="(sym: GenMSIL.this.global.Symbol)Unit">addModuleInstanceField</a><span class="delimiter">(</span><a href="#250043" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#97411" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a><span class="delimiter">)</span>
        <a href="#242288" title="=&gt; scala.collection.mutable.HashSet[GenMSIL.this.global.Symbol]">notInitializedModules</a> <span title="(elem: GenMSIL.this.global.Symbol)BytecodeGenerator.this.notInitializedModules.type">+=</span> <a href="#250043" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#97411" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#250043" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#97433" title="=&gt; Option[GenMSIL.this.global.icodes.IMethod]">lookupStaticCtor</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#242309" title="(sym: GenMSIL.this.global.Symbol)Unit">addStaticInit</a><span class="delimiter">(</span><a href="#250043" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#97411" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    <span class="delimiter">}</span> <span class="comment">// createClassMembers0</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)Boolean" id="242302">isTopLevelModule</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="245804">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> =
      <a href="../../symtab/SymbolTable.scala.html#64815" title="(ph: scala.tools.nsc.Phase)(op: =&gt; Boolean)Boolean">atPhase</a> <span class="delimiter">(</span><a href="../../Global.scala.html#64991" title="=&gt; GenMSIL.this.global.Run">currentRun</a>.<a href="../../Global.scala.html#72336" title="=&gt; scala.tools.nsc.Phase">refchecksPhase</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#245804" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; Boolean">isModuleClass</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#245804" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; Boolean">isImplClass</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#245804" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107532" title="=&gt; Boolean">isNestedClass</a>
      <span class="delimiter">}</span>

    <span class="comment">// if the module is lifted it does not need to be initialized in</span>
    <span class="comment">// its static constructor, and the MODULE$ field is not required.</span>
    <span class="comment">// the outer class will care about it.</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)Boolean" id="242303">isStaticModule</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="247479">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
      <span class="comment">// .net inner classes: removed '!sym.hasFlag(Flags.LIFTED)', added</span>
      <span class="comment">// 'sym.isStatic'. -&gt; no longer compatible without skipping flatten!</span>
      <a href="#247479" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; Boolean">isModuleClass</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#247479" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107525" title="=&gt; Boolean">isStatic</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#247479" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; Boolean">isImplClass</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)Boolean" id="242304">isCloneable</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="245745">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
      <span title="=&gt; Boolean">!</span><a href="#245745" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107411" title="=&gt; List[GenMSIL.this.global.AnnotationInfo]">annotations</a>.<span title="(p: GenMSIL.this.global.AnnotationInfo =&gt; Boolean)Boolean">forall</span><span class="delimiter">(</span> <a title="GenMSIL.this.global.AnnotationInfo" id="250501">a</a> =&gt; <a href="#250501" title="GenMSIL.this.global.AnnotationInfo">a</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Boolean(false)">AnnotationInfo</span><span class="delimiter">(</span><a href="#242191" title="=&gt; GenMSIL.this.global.Type">CloneableAttr</a>, _, _<span class="delimiter">)</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
        <span class="keyword">case</span> <span title="Boolean(true)">_</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)Unit" id="242305">addModuleInstanceField</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="250474">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36747" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
        <a href="../../Global.scala.html#64883" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Adding Module-Instance Field for &quot;)" class="string">&quot;Adding Module-Instance Field for &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#242330" title="(sym: GenMSIL.this.global.Symbol)String">showsym</a><span class="delimiter">(</span><a href="#250474" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" id="250505">tBuilder</a> = <a href="#242296" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#250474" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" class="delimiter">[</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span><span class="delimiter">]</span>
      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.FieldBuilder" id="250506">fb</a> = <a href="#250505" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a>.<span title="(name: String, fieldType: ch.epfl.lamp.compiler.msil.Type, attrs: Short)ch.epfl.lamp.compiler.msil.emit.FieldBuilder">DefineField</span><span class="delimiter">(</span><a href="#242136" title="=&gt; java.lang.String">MODULE_INSTANCE_NAME</a>,
                           <a href="#250505" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a>,
                           <span class="delimiter">(</span>FieldAttributes.Public <span title="Int(22)">|</span>
                            <span class="comment">//FieldAttributes.InitOnly |</span>
                            FieldAttributes.Static<span class="delimiter">)</span>.<span title="=&gt; Short">toShort</span><span class="delimiter">)</span>
      <a href="../../symtab/clr/CLRTypes.scala.html#205480" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol, value: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">fields</a><span class="delimiter">(</span><a href="#250474" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span> = <a href="#250506" title="ch.epfl.lamp.compiler.msil.emit.FieldBuilder">fb</a>
    <span class="delimiter">}</span>


    <span class="comment">// the symbol may be a object-symbol (module-symbol), or a module-class-symbol</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.FieldInfo" id="242306">getModuleInstanceField</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="243934">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="ch.epfl.lamp.compiler.msil.FieldInfo">FieldInfo</span> = <span class="delimiter">{</span>
      <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#243934" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; Boolean">isModule</span> <span title="(x: Boolean)Boolean">||</span> <a href="#243934" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; Boolean">isModuleClass</span>, <span title="java.lang.String(&quot;Expected module: &quot;)" class="string">&quot;Expected module: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#242330" title="(sym: GenMSIL.this.global.Symbol)String">showsym</a><span class="delimiter">(</span><a href="#243934" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="comment">// when called by LOAD_MODULE, the corresponding type maybe doesn't</span>
      <span class="comment">// exist yet -&gt; make a getType</span>
      <span class="keyword">val</span> <a title="GenMSIL.this.global.Symbol" id="250520">moduleClassSym</a> = <span title="GenMSIL.this.global.Symbol" class="keyword">if</span> <span class="delimiter">(</span><a href="#243934" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; Boolean">isModule</span><span class="delimiter">)</span> <a href="#243934" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107627" title="=&gt; GenMSIL.this.global.Symbol">moduleClass</a> <span class="keyword">else</span> <a href="#243934" title="GenMSIL.this.global.Symbol">sym</a>

      <span class="comment">// TODO: get module field for modules not defined in the</span>
      <span class="comment">// source currently compiling (e.g. Console)</span>

      <a href="../../symtab/clr/CLRTypes.scala.html#205480" title="=&gt; scala.collection.mutable.Map[GenMSIL.this.global.loaders.clrTypes.global.Symbol,ch.epfl.lamp.compiler.msil.FieldInfo]">fields</a> <span title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)Option[ch.epfl.lamp.compiler.msil.FieldInfo]">get</span> <a href="#250520" title="GenMSIL.this.global.Symbol">moduleClassSym</a> <span title="ch.epfl.lamp.compiler.msil.FieldInfo" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.FieldInfo">Some</span><span class="delimiter">(</span><a title="ch.epfl.lamp.compiler.msil.FieldInfo" id="250526">sym</a><span class="delimiter">)</span> =&gt; <a href="#250526" title="ch.epfl.lamp.compiler.msil.FieldInfo">sym</a>
        <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.FieldInfo">None</span> =&gt;
          <span class="comment">//val mclass = types(moduleClassSym)</span>
          <span class="keyword">val</span> <a title="String" id="250527">nameInMetadata</a> = <a href="#242307" title="(csym: GenMSIL.this.global.Symbol)String">nestingAwareFullClassname</a><span class="delimiter">(</span><a href="#250520" title="GenMSIL.this.global.Symbol">moduleClassSym</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="250528">mClass</a> = <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205492" title="(name: String)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#250527" title="String">nameInMetadata</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.FieldInfo" id="250529">mfield</a> = <a href="#250528" title="ch.epfl.lamp.compiler.msil.Type">mClass</a>.<span title="(x$1: java.lang.String)ch.epfl.lamp.compiler.msil.FieldInfo">GetField</span><span class="delimiter">(</span><span title="java.lang.String(&quot;MODULE$&quot;)" class="string">&quot;MODULE$&quot;</span><span class="delimiter">)</span>
          <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#250529" title="ch.epfl.lamp.compiler.msil.FieldInfo">mfield</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span>, <span title="java.lang.String(&quot;module not found &quot;)" class="string">&quot;module not found &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#242330" title="(sym: GenMSIL.this.global.Symbol)String">showsym</a><span class="delimiter">(</span><a href="#250520" title="GenMSIL.this.global.Symbol">moduleClassSym</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="../../symtab/clr/CLRTypes.scala.html#205480" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol, value: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">fields</a><span class="delimiter">(</span><a href="#250520" title="GenMSIL.this.global.Symbol">moduleClassSym</a><span class="delimiter">)</span> = <a href="#250529" title="ch.epfl.lamp.compiler.msil.FieldInfo">mfield</a>
          <a href="#250529" title="ch.epfl.lamp.compiler.msil.FieldInfo">mfield</a>
      <span class="delimiter">}</span>

      <span class="comment">//fields(moduleClassSym)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(csym: GenMSIL.this.global.Symbol)String" id="242307">nestingAwareFullClassname</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="250530">csym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span> : <span title="String">String</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.lang.String" id="250536">suffix</a> = <a href="#242308" title="(sym: GenMSIL.this.global.Symbol)java.lang.String">moduleSuffix</a><span class="delimiter">(</span><a href="#250530" title="GenMSIL.this.global.Symbol">csym</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.lang.String" id="250537">res</a> = <span title="java.lang.String" class="keyword">if</span> <span class="delimiter">(</span><a href="#250530" title="GenMSIL.this.global.Symbol">csym</a>.<a href="../../symtab/Symbols.scala.html#107532" title="=&gt; Boolean">isNestedClass</a><span class="delimiter">)</span>
        <a href="#242307" title="(csym: GenMSIL.this.global.Symbol)String">nestingAwareFullClassname</a><span class="delimiter">(</span><a href="#250530" title="GenMSIL.this.global.Symbol">csym</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.Symbol">owner</a><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;+&quot;)" class="string">&quot;+&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#250530" title="GenMSIL.this.global.Symbol">csym</a>.<span title="=&gt; String">encodedName</span>
      <span class="keyword">else</span>
        <a href="#250530" title="GenMSIL.this.global.Symbol">csym</a>.<span title="=&gt; String">fullName</span>
      <a href="#250537" title="java.lang.String">res</a> <span title="(x$1: Any)java.lang.String">+</span> <a href="#250536" title="java.lang.String">suffix</a>
    <span class="delimiter">}</span>

  <span class="comment">/** cut&amp;pasted from GenJVM */</span>
  <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)java.lang.String" id="242308">moduleSuffix</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="250538">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span> =
    <span title="java.lang.String" class="keyword">if</span> <span class="delimiter">(</span><a href="#250538" title="GenMSIL.this.global.Symbol">sym</a>.<span title="(mask: Long)Boolean">hasFlag</span><span class="delimiter">(</span>Flags.<span title="Long(256L)">MODULE</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#250538" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; Boolean">isMethod</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
       <span title="=&gt; Boolean">!</span><a href="#250538" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; Boolean">isImplClass</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#250538" title="GenMSIL.this.global.Symbol">sym</a>.<span title="(mask: Long)Boolean">hasFlag</span><span class="delimiter">(</span>Flags.<span title="Long(1048576L)">JAVA</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="java.lang.String(&quot;$&quot;)" class="string">&quot;$&quot;</span>
    <span class="keyword">else</span> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>;

    <span class="comment">/** Adds a static initializer which creates an instance of the module
     *  class (calls the primary constructor). A special primary constructor
     *  will be generated (notInitializedModules) which stores the new instance
     *  in the MODULE$ field right after the super call.
     */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)Unit" id="242309">addStaticInit</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="250485">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" id="250543">tBuilder</a> = <a href="#242296" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#250485" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" class="delimiter">[</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span><span class="delimiter">]</span>

      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.ConstructorBuilder" id="250544">staticInit</a> = <a href="#250543" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a>.<span title="(attrs: Short, callingConvention: Short, paramTypes: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.emit.ConstructorBuilder">DefineConstructor</span><span class="delimiter">(</span>
        <span class="delimiter">(</span>MethodAttributes.Static <span title="Int(22)">|</span> MethodAttributes.Public<span class="delimiter">)</span>.<span title="=&gt; Short">toShort</span>,
        CallingConventions.<span title="Short(1)">Standard</span>,
        <span title="object ch.epfl.lamp.compiler.msil.Type">MsilType</span>.<span title="Array[ch.epfl.lamp.compiler.msil.Type]">EmptyTypes</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.ILGenerator" id="250545">sicode</a> = <a href="#250544" title="ch.epfl.lamp.compiler.msil.emit.ConstructorBuilder">staticInit</a>.<span title="()ch.epfl.lamp.compiler.msil.emit.ILGenerator">GetILGenerator</span><span class="delimiter">(</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.ConstructorInfo" id="250546">instanceConstructor</a> = <a href="../../symtab/clr/CLRTypes.scala.html#205476" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)ch.epfl.lamp.compiler.msil.ConstructorInfo">constructors</a><span class="delimiter">(</span><a href="#250485" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107597" title="=&gt; GenMSIL.this.global.Symbol">primaryConstructor</a><span class="delimiter">)</span>

      <span class="comment">// there are no constructor parameters. assuming the constructor takes no parameter</span>
      <span class="comment">// is fine: we call (in the static constructor) the constructor of the module class,</span>
      <span class="comment">// which takes no arguments - an object definition cannot take constructor arguments.</span>
      <a href="#250545" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">sicode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.ConstructorInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Newobj</span>, <a href="#250546" title="ch.epfl.lamp.compiler.msil.ConstructorInfo">instanceConstructor</a><span class="delimiter">)</span>
      <span class="comment">// the stsfld is done in the instance constructor, just after the super call.</span>
      <a href="#250545" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">sicode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Pop</span><span class="delimiter">)</span>

      <a href="#250545" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">sicode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ret</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)Unit" id="242310">dumpMirrorClass</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="245811">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="250574">tBuilder</a> = <a href="#242296" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#245811" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>
      <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#245811" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; Boolean">isModuleClass</span>, <span title="java.lang.String(&quot;Can\'t generate Mirror-Class for the Non-Module class &quot;)" class="string">&quot;Can't generate Mirror-Class for the Non-Module class &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#245811" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36747" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
        <a href="../../Global.scala.html#64883" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Dumping mirror class for object: &quot;)" class="string">&quot;Dumping mirror class for object: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#245811" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="String" id="250575">moduleName</a> = <a href="#242281" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#245811" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.lang.String" id="250576">mirrorName</a> = <a href="#250575" title="String">moduleName</a>.<span title="(x$1: Int, x$2: Int)java.lang.String">substring</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#250575" title="String">moduleName</a>.<span title="()Int">length</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" id="250577">mirrorTypeBuilder</a> = <a href="#242208" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ModuleBuilder">mmodule</a>.<span title="(typeName: String, attributes: Int, baseType: ch.epfl.lamp.compiler.msil.Type, interfaces: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.emit.TypeBuilder">DefineType</span><span class="delimiter">(</span><a href="#250576" title="java.lang.String">mirrorName</a>,
                                                 TypeAttributes.Class |
                                                 TypeAttributes.Public <span title="Int(257)">|</span>
                                                 TypeAttributes.Sealed,
                                                 <a href="../../symtab/clr/CLRTypes.scala.html#205447" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MOBJECT</a>,
                                                 <span title="object ch.epfl.lamp.compiler.msil.Type">MsilType</span>.<span title="Array[ch.epfl.lamp.compiler.msil.Type]">EmptyTypes</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.IClass" id="250578">iclass</a> = <a href="../icode/ICodes.scala.html#96940" title="(key: GenMSIL.this.global.icodes.global.Symbol)GenMSIL.this.global.icodes.IClass">classes</a><span class="delimiter">(</span><a href="#245811" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>

      <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="250630">m</a> &lt;- <a href="#245811" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.Type">tpe</a>.<a href="../../symtab/Types.scala.html#105491" title="(f: GenMSIL.this.global.Symbol =&gt; Unit)Unit">nonPrivateMembers</a>
           <span class="keyword">if</span> <a href="#250630" title="GenMSIL.this.global.Symbol">m</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.Symbol">owner</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../symtab/Definitions.scala.html#67699" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106220" title="=&gt; GenMSIL.this.global.Symbol">ObjectClass</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#250630" title="GenMSIL.this.global.Symbol">m</a>.<span title="=&gt; Boolean">isProtected</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
           <a href="#250630" title="GenMSIL.this.global.Symbol">m</a>.<span title="=&gt; Boolean">isMethod</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#250630" title="GenMSIL.this.global.Symbol">m</a>.<a href="../../symtab/Symbols.scala.html#107473" title="=&gt; Boolean">isClassConstructor</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#250630" title="GenMSIL.this.global.Symbol">m</a>.<a href="../../symtab/Symbols.scala.html#107527" title="=&gt; Boolean">isStaticMember</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#250630" title="GenMSIL.this.global.Symbol">m</a>.<span title="=&gt; Boolean">isCase</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
           <span title="=&gt; Boolean">!</span><a href="#250630" title="GenMSIL.this.global.Symbol">m</a>.<span title="=&gt; Boolean">isDeferred</span><span class="delimiter">)</span>
        <span class="delimiter">{</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64829" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36747" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#42149" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
            <a href="../../Global.scala.html#64883" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;   Mirroring method: &quot;)" class="string">&quot;   Mirroring method: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#250630" title="GenMSIL.this.global.Symbol">m</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Array[ch.epfl.lamp.compiler.msil.Type]" id="250631">paramTypes</a> = <a href="#242295" title="(sym: GenMSIL.this.global.Symbol)Array[ch.epfl.lamp.compiler.msil.Type]">msilParamTypes</a><span class="delimiter">(</span><a href="#250630" title="GenMSIL.this.global.Symbol">m</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Array[String]" id="250632">paramNames</a>: <span title="Array[String]">Array</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span title="Array[String]" class="keyword">new</span> <span title="Array[String]">Array</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">(</span><a href="#250631" title="Array[ch.epfl.lamp.compiler.msil.Type]">paramTypes</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
          <span class="keyword">for</span> <span class="delimiter">(</span><a title="Int" id="250742">i</a> &lt;- <span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(f: Int =&gt; Unit)Unit">until</span> <a href="#250631" title="Array[ch.epfl.lamp.compiler.msil.Type]">paramTypes</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
            <a href="#250632" title="(i: Int, x: String)Unit">paramNames</a><span class="delimiter">(</span><a href="#250742" title="Int">i</a><span class="delimiter">)</span> = <span title="java.lang.String(&quot;x_&quot;)" class="string">&quot;x_&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#250742" title="Int">i</a>

          <span class="comment">// CHECK: verify if getMethodName is better than msilName</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder" id="250633">mirrorMethod</a> = <a href="#250577" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">mirrorTypeBuilder</a>.<span title="(name: String, attrs: Short, returnType: ch.epfl.lamp.compiler.msil.Type, paramTypes: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.emit.MethodBuilder">DefineMethod</span><span class="delimiter">(</span><a href="#242281" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#250630" title="GenMSIL.this.global.Symbol">m</a><span class="delimiter">)</span>,
                                                            <span class="delimiter">(</span>MethodAttributes.Public <span title="Int(22)">|</span>
                                                            MethodAttributes.Static<span class="delimiter">)</span>.<span title="=&gt; Short">toShort</span>,
                                                            <a href="#242294" title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#250630" title="GenMSIL.this.global.Symbol">m</a>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.Type">tpe</a>.<a href="../../symtab/Types.scala.html#105468" title="=&gt; GenMSIL.this.global.Type">resultType</a><span class="delimiter">)</span>,
                                                            <a href="#250631" title="Array[ch.epfl.lamp.compiler.msil.Type]">paramTypes</a><span class="delimiter">)</span>

          <span class="keyword">var</span> <a title="Int" id="250634">i</a> = <span title="Int(0)" class="int">0</span>
          <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#250634" title="Int">i</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#250631" title="Array[ch.epfl.lamp.compiler.msil.Type]">paramTypes</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span> <a href="#250637" title="()Unit" class="delimiter">{</a>
            <a href="#250633" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">mirrorMethod</a>.<span title="(pos: Int, attr: Int, name: String)ch.epfl.lamp.compiler.msil.emit.ParameterBuilder">DefineParameter</span><span class="delimiter">(</span><a href="#250634" title="Int">i</a>, ParameterAttributes.<span title="Int(0)">None</span>, <a href="#250632" title="(i: Int)String">paramNames</a><span class="delimiter">(</span><a href="#250634" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#250634" title="Int">i</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
          <span class="delimiter">}</span>

          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.ILGenerator" id="250635">mirrorCode</a> = <a href="#250633" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">mirrorMethod</a>.<span title="()ch.epfl.lamp.compiler.msil.emit.ILGenerator">GetILGenerator</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#250635" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">mirrorCode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldsfld</span>, <a href="#242306" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.FieldInfo">getModuleInstanceField</a><span class="delimiter">(</span><a href="#245811" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="250636">mInfo</a> = <a href="#242323" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.MethodInfo">getMethod</a><span class="delimiter">(</span><a href="#250630" title="GenMSIL.this.global.Symbol">m</a><span class="delimiter">)</span>
          <span class="keyword">for</span> <span class="delimiter">(</span><a title="Int" id="250870">paramidx</a> &lt;- <span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span>.<span title="(end: Int)scala.collection.immutable.Range">until</span><span title="(f: Int =&gt; Unit)Unit" class="delimiter">(</span><a href="#250631" title="Array[ch.epfl.lamp.compiler.msil.Type]">paramTypes</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="Array[ch.epfl.lamp.compiler.msil.ParameterInfo]" id="250871">mInfoParams</a> = <a href="#250636" title="ch.epfl.lamp.compiler.msil.MethodInfo">mInfo</a>.<span title="()Array[ch.epfl.lamp.compiler.msil.ParameterInfo]">GetParameters</span>
            <span class="keyword">val</span> <a title="Boolean" id="250872">loadAddr</a> = <a href="#250871" title="(i: Int)ch.epfl.lamp.compiler.msil.ParameterInfo">mInfoParams</a><span class="delimiter">(</span><a href="#250870" title="Int">paramidx</a><span class="delimiter">)</span>.<span title="ch.epfl.lamp.compiler.msil.Type">ParameterType</span>.<span title="()Boolean">IsByRef</span>
            <a href="#242274" title="(code: ch.epfl.lamp.compiler.msil.emit.ILGenerator, loadAddr: Boolean)(i: Int)Unit">loadArg</a><span class="delimiter">(</span><a href="#250635" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">mirrorCode</a>, <a href="#250872" title="Boolean">loadAddr</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#250870" title="Int">paramidx</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

          <a href="#250635" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">mirrorCode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Callvirt</span>, <a href="#242323" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.MethodInfo">getMethod</a><span class="delimiter">(</span><a href="#250630" title="GenMSIL.this.global.Symbol">m</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#250635" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">mirrorCode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ret</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

      <a href="#242229" title="(sym: GenMSIL.this.global.Symbol, tBuilder: ch.epfl.lamp.compiler.msil.emit.TypeBuilder)Unit">addSymtabAttribute</a><span class="delimiter">(</span><a href="#245811" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; GenMSIL.this.global.Symbol">sourceModule</span>, <a href="#250577" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">mirrorTypeBuilder</a><span class="delimiter">)</span>

      <a href="#250577" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">mirrorTypeBuilder</a>.<span title="()ch.epfl.lamp.compiler.msil.Type">CreateType</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#250577" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">mirrorTypeBuilder</a>.<span title="(sourceFilepath: String)Unit">setSourceFilepath</span><span class="delimiter">(</span><a href="#250578" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#97420" title="=&gt; GenMSIL.this.global.icodes.global.CompilationUnit">cunit</a>.<a href="../../CompilationUnits.scala.html#96423" title="=&gt; scala.tools.nsc.util.SourceFile">source</a>.<a href="../../util/SourceFile.scala.html#96521" title="=&gt; scala.tools.nsc.io.AbstractFile">file</a>.<a href="../../io/AbstractFile.scala.html#96474" title="=&gt; String">path</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>


    <span class="comment">// #####################################################################</span>
    <span class="comment">// delegate callers</span>

    <span class="keyword">var</span> <a title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" id="242312">delegateCallers</a>: <span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span> = _
    <span class="keyword">var</span> <a title="Int" id="242315">nbDelegateCallers</a>: <span title="Int">Int</span> = <span title="Int(0)" class="int">0</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="242317">initDelegateCallers</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="#242312" title="(x$1: ch.epfl.lamp.compiler.msil.emit.TypeBuilder)Unit">delegateCallers</a> = <a href="#242208" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ModuleBuilder">mmodule</a>.<span title="(typeName: String, attributes: Int)ch.epfl.lamp.compiler.msil.emit.TypeBuilder">DefineType</span><span class="delimiter">(</span><span title="java.lang.String(&quot;$DelegateCallers&quot;)" class="string">&quot;$DelegateCallers&quot;</span>, TypeAttributes.Public <span title="Int(257)">|</span>
                                          TypeAttributes.Sealed<span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(functionType: GenMSIL.this.global.Type, delegateType: GenMSIL.this.global.Type)Unit" id="242318">createDelegateCaller</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Type" id="247602">functionType</a>: <a href="../../symtab/Types.scala.html#67392" title="GenMSIL.this.global.Type">Type</a>, <a title="GenMSIL.this.global.Type" id="247603">delegateType</a>: <a href="../../symtab/Types.scala.html#67392" title="GenMSIL.this.global.Type">Type</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#242312" title="=&gt; ch.epfl.lamp.compiler.msil.emit.TypeBuilder">delegateCallers</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
        <a href="#242317" title="()Unit">initDelegateCallers</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="comment">// create a field an store the function-object</span>
      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="247606">mFunctionType</a>: <span title="ch.epfl.lamp.compiler.msil.Type">MsilType</span> = <a href="#242294" title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#247602" title="GenMSIL.this.global.Type">functionType</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.FieldBuilder" id="247607">anonfunField</a>: <span title="ch.epfl.lamp.compiler.msil.emit.FieldBuilder">FieldBuilder</span> = <a href="#242312" title="=&gt; ch.epfl.lamp.compiler.msil.emit.TypeBuilder">delegateCallers</a>.<span title="(name: String, fieldType: ch.epfl.lamp.compiler.msil.Type, attrs: Short)ch.epfl.lamp.compiler.msil.emit.FieldBuilder">DefineField</span><span class="delimiter">(</span>
        <span title="java.lang.String(&quot;$anonfunField$$&quot;)" class="string">&quot;$anonfunField$$&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#242315" title="=&gt; Int">nbDelegateCallers</a>, <a href="#247606" title="ch.epfl.lamp.compiler.msil.Type">mFunctionType</a>,
        <span class="delimiter">(</span>FieldAttributes.InitOnly | FieldAttributes.Public <span title="Int(54)">|</span> FieldAttributes.Static<span class="delimiter">)</span>.<span title="=&gt; Short">toShort</span><span class="delimiter">)</span>
      <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stsfld</span>, <a href="#247607" title="ch.epfl.lamp.compiler.msil.emit.FieldBuilder">anonfunField</a><span class="delimiter">)</span>


      <span class="comment">// create the static caller method and the delegate object</span>
      <span class="keyword">val</span> <a href="#247609" title="(List[GenMSIL.this.global.Symbol], GenMSIL.this.global.Type)" class="delimiter">(</a><a href="#247608" title="List[GenMSIL.this.global.Symbol]" id="247609">params</a>, <a href="#247608" title="GenMSIL.this.global.Type" id="247610">returnType</a><span class="delimiter">)</span> = <a href="#247603" title="GenMSIL.this.global.Type">delegateType</a>.<a href="../../symtab/Types.scala.html#105495" title="(name: GenMSIL.this.global.Name)GenMSIL.this.global.Symbol">member</a><span class="delimiter">(</span><a href="../../symtab/StdNames.scala.html#67724" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../symtab/StdNames.scala.html#115450" title="=&gt; GenMSIL.this.global.nme.NameType">apply</a><span class="delimiter">)</span>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.Type">tpe</a> <span title="(List[GenMSIL.this.global.Symbol], GenMSIL.this.global.Type)" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="(List[GenMSIL.this.global.Symbol], GenMSIL.this.global.Type)">MethodType</span><span class="delimiter">(</span><a title="List[GenMSIL.this.global.Symbol]" id="247701">delParams</a>, <a title="GenMSIL.this.global.Type" id="247702">delReturn</a><span class="delimiter">)</span> =&gt; <span title="(_1: List[GenMSIL.this.global.Symbol], _2: GenMSIL.this.global.Type)(List[GenMSIL.this.global.Symbol], GenMSIL.this.global.Type)" class="delimiter">(</span><a href="#247701" title="List[GenMSIL.this.global.Symbol]">delParams</a>, <a href="#247702" title="GenMSIL.this.global.Type">delReturn</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Nothing">_</span> =&gt; <a href="../../symtab/SymbolTable.scala.html#64790" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="java.lang.String(&quot;not a delegate type: &quot;)" class="string">&quot;not a delegate type: &quot;</span>  <span title="(x$1: Any)java.lang.String">+</span> <a href="#247603" title="GenMSIL.this.global.Type">delegateType</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder" id="247611">caller</a>: <span title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">MethodBuilder</span> = <a href="#242312" title="=&gt; ch.epfl.lamp.compiler.msil.emit.TypeBuilder">delegateCallers</a>.<span title="(name: String, attrs: Short, returnType: ch.epfl.lamp.compiler.msil.Type, paramTypes: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.emit.MethodBuilder">DefineMethod</span><span class="delimiter">(</span>
        <span title="java.lang.String(&quot;$delegateCaller$$&quot;)" class="string">&quot;$delegateCaller$$&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#242315" title="=&gt; Int">nbDelegateCallers</a>,
        <span class="delimiter">(</span>MethodAttributes.Final | MethodAttributes.Public <span title="Int(54)">|</span> MethodAttributes.Static<span class="delimiter">)</span>.<span title="=&gt; Short">toShort</span>,
        <a href="#242294" title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#247610" title="GenMSIL.this.global.Type">returnType</a><span class="delimiter">)</span>, <span class="delimiter">(</span><a href="#247609" title="List[GenMSIL.this.global.Symbol]">params</a> <span title="(f: GenMSIL.this.global.Symbol =&gt; GenMSIL.this.global.Type)(implicit bf: scala.collection.generic.CanBuildFrom[List[GenMSIL.this.global.Symbol],GenMSIL.this.global.Type,List[GenMSIL.this.global.Type]])List[GenMSIL.this.global.Type]">map</span> <span class="delimiter">(</span><a href="#247762" title="GenMSIL.this.global.Symbol">_</a>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: GenMSIL.this.global.Type =&gt; ch.epfl.lamp.compiler.msil.Type)(implicit bf: scala.collection.generic.CanBuildFrom[List[GenMSIL.this.global.Type],ch.epfl.lamp.compiler.msil.Type,List[ch.epfl.lamp.compiler.msil.Type]])List[ch.epfl.lamp.compiler.msil.Type]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,ch.epfl.lamp.compiler.msil.Type,List[ch.epfl.lamp.compiler.msil.Type]]" class="delimiter">(</span><a href="#242294" title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">)</span>.<span title="(implicit evidence$1: ClassManifest[ch.epfl.lamp.compiler.msil.Type])Array[ch.epfl.lamp.compiler.msil.Type]">toArray</span><span class="delimiter">)</span>
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="Int" id="248003">i</a> &lt;- <span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(f: Int =&gt; ch.epfl.lamp.compiler.msil.emit.ParameterBuilder)Unit">until</span> <a href="#247609" title="List[GenMSIL.this.global.Symbol]">params</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
        <a href="#247611" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">caller</a>.<span title="(pos: Int, attr: Int, name: String)ch.epfl.lamp.compiler.msil.emit.ParameterBuilder">DefineParameter</span><span class="delimiter">(</span><a href="#248003" title="Int">i</a>, ParameterAttributes.<span title="Int(0)">None</span>, <span title="java.lang.String(&quot;arg&quot;)" class="string">&quot;arg&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#248003" title="Int">i</a><span class="delimiter">)</span> <span class="comment">// FIXME: use name of parameter symbol </span>
      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.ConstructorInfo" id="247612">delegCtor</a> = <a href="#242294" title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#247603" title="GenMSIL.this.global.Type">delegateType</a><span class="delimiter">)</span>.<span title="(x$1: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.ConstructorInfo">GetConstructor</span><span class="delimiter">(</span><span title="(xs: ch.epfl.lamp.compiler.msil.Type*)(implicit evidence$2: scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type])Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span title="(clazz: java.lang.Class[_])scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type]" class="delimiter">(</span><a href="../../symtab/clr/CLRTypes.scala.html#205447" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MOBJECT</a>, <a href="#242161" title="=&gt; ch.epfl.lamp.compiler.msil.Type">INT_PTR</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldnull</span><span class="delimiter">)</span>
      <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldftn</span>, <a href="#247611" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">caller</a><span class="delimiter">)</span>
      <a href="#242211" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.ConstructorInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Newobj</span>, <a href="#247612" title="ch.epfl.lamp.compiler.msil.ConstructorInfo">delegCtor</a><span class="delimiter">)</span>


      <span class="comment">// create the static caller method body</span>
      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="247613">functionApply</a>: <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span> = <a href="#242323" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.MethodInfo">getMethod</a><span class="delimiter">(</span><a href="#247602" title="GenMSIL.this.global.Type">functionType</a>.<a href="../../symtab/Types.scala.html#105495" title="(name: GenMSIL.this.global.Name)GenMSIL.this.global.Symbol">member</a><span class="delimiter">(</span><a href="../../symtab/StdNames.scala.html#67724" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../symtab/StdNames.scala.html#115450" title="=&gt; GenMSIL.this.global.nme.NameType">apply</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.ILGenerator" id="247614">dcode</a>: <span title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">ILGenerator</span> = <a href="#247611" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">caller</a>.<span title="()ch.epfl.lamp.compiler.msil.emit.ILGenerator">GetILGenerator</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#247614" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">dcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldsfld</span>, <a href="#247607" title="ch.epfl.lamp.compiler.msil.emit.FieldBuilder">anonfunField</a><span class="delimiter">)</span>
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="Int" id="248180">i</a> &lt;- <span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(f: Int =&gt; Unit)Unit">until</span> <a href="#247609" title="List[GenMSIL.this.global.Symbol]">params</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#242274" title="(code: ch.epfl.lamp.compiler.msil.emit.ILGenerator, loadAddr: Boolean)(i: Int)Unit">loadArg</a><span class="delimiter">(</span><a href="#247614" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">dcode</a>, <span title="Boolean(false)" class="keyword">false</span> <span class="comment">/* TODO confirm whether passing actual as-is to formal is correct wrt the ByRef attribute of the param */</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#248180" title="Int">i</a><span class="delimiter">)</span>
        <a href="#242319" title="(code: ch.epfl.lamp.compiler.msil.emit.ILGenerator, boxType: GenMSIL.this.global.icodes.TypeKind)Unit">emitBox</a><span class="delimiter">(</span><a href="#247614" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">dcode</a>, <a href="../icode/TypeKinds.scala.html#97048" title="(t: GenMSIL.this.global.icodes.global.Type)GenMSIL.this.global.icodes.TypeKind">toTypeKind</a><span class="delimiter">(</span><a href="#247609" title="(n: Int)GenMSIL.this.global.Symbol">params</a><span class="delimiter">(</span><a href="#248180" title="Int">i</a><span class="delimiter">)</span>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#247614" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">dcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Callvirt</span>, <a href="#247613" title="ch.epfl.lamp.compiler.msil.MethodInfo">functionApply</a><span class="delimiter">)</span>
      <a href="#242320" title="(code: ch.epfl.lamp.compiler.msil.emit.ILGenerator, boxType: GenMSIL.this.global.icodes.TypeKind)Unit">emitUnbox</a><span class="delimiter">(</span><a href="#247614" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">dcode</a>, <a href="../icode/TypeKinds.scala.html#97048" title="(t: GenMSIL.this.global.icodes.global.Type)GenMSIL.this.global.icodes.TypeKind">toTypeKind</a><span class="delimiter">(</span><a href="#247610" title="GenMSIL.this.global.Type">returnType</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#247614" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">dcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ret</span><span class="delimiter">)</span>

      <a href="#242315" title="(x$1: Int)Unit">nbDelegateCallers</a> = <a href="#242315" title="=&gt; Int">nbDelegateCallers</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>

    <span class="delimiter">}</span> <span class="comment">//def createDelegateCaller</span>

    <span class="keyword">def</span> <a title="(code: ch.epfl.lamp.compiler.msil.emit.ILGenerator, boxType: GenMSIL.this.global.icodes.TypeKind)Unit" id="242319">emitBox</a><span class="delimiter">(</span><a title="ch.epfl.lamp.compiler.msil.emit.ILGenerator" id="248181">code</a>: <span title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">ILGenerator</span>, <a title="GenMSIL.this.global.icodes.TypeKind" id="248182">boxType</a>: <a href="../icode/TypeKinds.scala.html#97012" title="GenMSIL.this.global.icodes.TypeKind">TypeKind</a><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="#248182" title="GenMSIL.this.global.icodes.TypeKind">boxType</a>: @<a href="../icode/TypeKinds.scala.html#97012" title="GenMSIL.this.global.icodes.TypeKind @unchecked">unchecked</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="comment">// doesn't make sense, unit as parameter..</span>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97018" title="Unit">UNIT</a>   =&gt; <a href="#248181" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldsfld</span>, <a href="#242187" title="=&gt; ch.epfl.lamp.compiler.msil.FieldInfo">boxedUnit</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97020" title="Unit">BOOL</a> | <a href="../icode/TypeKinds.scala.html#97022" title="object GenMSIL.this.global.icodes.BYTE">BYTE</a> | <a href="../icode/TypeKinds.scala.html#97024" title="object GenMSIL.this.global.icodes.SHORT">SHORT</a> | <a href="../icode/TypeKinds.scala.html#97026" title="object GenMSIL.this.global.icodes.CHAR">CHAR</a> | <a href="../icode/TypeKinds.scala.html#97028" title="object GenMSIL.this.global.icodes.INT">INT</a> | <a href="../icode/TypeKinds.scala.html#97030" title="object GenMSIL.this.global.icodes.LONG">LONG</a> | <a href="../icode/TypeKinds.scala.html#97032" title="object GenMSIL.this.global.icodes.FLOAT">FLOAT</a> | <a href="../icode/TypeKinds.scala.html#97034" title="object GenMSIL.this.global.icodes.DOUBLE">DOUBLE</a> =&gt;
        <a href="#248181" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.Type)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Box</span>, <a href="#242293" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#248182" title="GenMSIL.this.global.icodes.TypeKind">boxType</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">REFERENCE</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="248200">cls</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205490" title="(cls: GenMSIL.this.global.loaders.clrTypes.global.Symbol)Boolean">isValueType</a><span class="delimiter">(</span><a href="#248200" title="GenMSIL.this.global.icodes.global.Symbol">cls</a><span class="delimiter">)</span> =&gt; 
        <a href="#248181" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.Type)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Box</span>, <span class="delimiter">(</span><a href="#242293" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#248182" title="GenMSIL.this.global.icodes.TypeKind">boxType</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">REFERENCE</span><span class="delimiter">(</span>_<span class="delimiter">)</span> | ARRAY<span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;
        <a href="../../Global.scala.html#64874" title="(msg: String)Unit">warning</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Tried to BOX a non-valuetype.&quot;)" class="string">&quot;Tried to BOX a non-valuetype.&quot;</span><span class="delimiter">)</span>
        <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(code: ch.epfl.lamp.compiler.msil.emit.ILGenerator, boxType: GenMSIL.this.global.icodes.TypeKind)Unit" id="242320">emitUnbox</a><span class="delimiter">(</span><a title="ch.epfl.lamp.compiler.msil.emit.ILGenerator" id="248230">code</a>: <span title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">ILGenerator</span>, <a title="GenMSIL.this.global.icodes.TypeKind" id="248231">boxType</a>: <a href="../icode/TypeKinds.scala.html#97012" title="GenMSIL.this.global.icodes.TypeKind">TypeKind</a><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="#248231" title="GenMSIL.this.global.icodes.TypeKind">boxType</a>: @<a href="../icode/TypeKinds.scala.html#97012" title="GenMSIL.this.global.icodes.TypeKind @unchecked">unchecked</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97018" title="Unit">UNIT</a>   =&gt; <a href="#248230" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Pop</span><span class="delimiter">)</span>
      <span class="comment">/* (1) it's essential to keep the code emitted here (as of now plain calls to System.Convert.ToBlaBla methods)
             behaviorally.equiv.wrt. BoxesRunTime.unboxToBlaBla methods 
             (case null: that's easy, case boxed: track changes to unboxBlaBla)
         (2) See also: asInstanceOf to cast from Any to number, 
             tracked in http://lampsvn.epfl.ch/trac/scala/ticket/4437  */</span>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97020" title="Unit">BOOL</a>   =&gt; <a href="#248230" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#242171" title="=&gt; ch.epfl.lamp.compiler.msil.MethodInfo">toBool</a><span class="delimiter">)</span> 
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97022" title="Unit">BYTE</a>   =&gt; <a href="#248230" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#242173" title="=&gt; ch.epfl.lamp.compiler.msil.MethodInfo">toSByte</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97024" title="Unit">SHORT</a>  =&gt; <a href="#248230" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#242175" title="=&gt; ch.epfl.lamp.compiler.msil.MethodInfo">toShort</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97026" title="Unit">CHAR</a>   =&gt; <a href="#248230" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#242177" title="=&gt; ch.epfl.lamp.compiler.msil.MethodInfo">toChar</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97028" title="Unit">INT</a>    =&gt; <a href="#248230" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#242179" title="=&gt; ch.epfl.lamp.compiler.msil.MethodInfo">toInt</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97030" title="Unit">LONG</a>   =&gt; <a href="#248230" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#242181" title="=&gt; ch.epfl.lamp.compiler.msil.MethodInfo">toLong</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97032" title="Unit">FLOAT</a>  =&gt; <a href="#248230" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#242183" title="=&gt; ch.epfl.lamp.compiler.msil.MethodInfo">toFloat</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#97034" title="Unit">DOUBLE</a> =&gt; <a href="#248230" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#242185" title="=&gt; ch.epfl.lamp.compiler.msil.MethodInfo">toDouble</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">REFERENCE</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="248269">cls</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="../../symtab/SymbolLoaders.scala.html#104738" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#205490" title="(cls: GenMSIL.this.global.loaders.clrTypes.global.Symbol)Boolean">isValueType</a><span class="delimiter">(</span><a href="#248269" title="GenMSIL.this.global.icodes.global.Symbol">cls</a><span class="delimiter">)</span> =&gt;
        <a href="#248230" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.Type)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Unbox</span>, <a href="#242293" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#248231" title="GenMSIL.this.global.icodes.TypeKind">boxType</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#248230" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.Type)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldobj</span>, <a href="#242293" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#248231" title="GenMSIL.this.global.icodes.TypeKind">boxType</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">REFERENCE</span><span class="delimiter">(</span>_<span class="delimiter">)</span> | ARRAY<span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;
        <a href="../../Global.scala.html#64874" title="(msg: String)Unit">warning</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Tried to UNBOX a non-valuetype.&quot;)" class="string">&quot;Tried to UNBOX a non-valuetype.&quot;</span><span class="delimiter">)</span>
        <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="comment">// #####################################################################</span>
    <span class="comment">// get and create methods / constructors</span>
 
    <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.ConstructorInfo" id="242321">getConstructor</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="247309">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="ch.epfl.lamp.compiler.msil.ConstructorInfo">ConstructorInfo</span> = <a href="../../symtab/clr/CLRTypes.scala.html#205476" title="=&gt; scala.collection.mutable.Map[GenMSIL.this.global.loaders.clrTypes.global.Symbol,ch.epfl.lamp.compiler.msil.ConstructorInfo]">constructors</a>.<span title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)Option[ch.epfl.lamp.compiler.msil.ConstructorInfo]">get</span><span class="delimiter">(</span><a href="#247309" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span> <span title="ch.epfl.lamp.compiler.msil.ConstructorInfo" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.ConstructorInfo">Some</span><span class="delimiter">(</span><a title="ch.epfl.lamp.compiler.msil.ConstructorInfo" id="250885">constr</a><span class="delimiter">)</span> =&gt; <a href="#250885" title="ch.epfl.lamp.compiler.msil.ConstructorInfo">constr</a>
      <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.ConstructorInfo">None</span> =&gt;
        <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="250886">mClass</a> = <a href="#242296" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#247309" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.Symbol">owner</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.ConstructorInfo" id="250887">constr</a> = <a href="#250886" title="ch.epfl.lamp.compiler.msil.Type">mClass</a>.<span title="(x$1: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.ConstructorInfo">GetConstructor</span><span class="delimiter">(</span><a href="#242295" title="(sym: GenMSIL.this.global.Symbol)Array[ch.epfl.lamp.compiler.msil.Type]">msilParamTypes</a><span class="delimiter">(</span><a href="#247309" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span title="ch.epfl.lamp.compiler.msil.ConstructorInfo" class="keyword">if</span> <span class="delimiter">(</span><a href="#250887" title="ch.epfl.lamp.compiler.msil.ConstructorInfo">constr</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          java.lang.<span title="object java.lang.System">System</span>.<span title="java.io.PrintStream">out</span>.<span title="(x$1: java.lang.String)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Cannot find constructor &quot;)" class="string">&quot;Cannot find constructor &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#247309" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.Symbol">owner</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;::&quot;)" class="string">&quot;::&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#247309" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107548" title="=&gt; GenMSIL.this.global.Name">name</a><span class="delimiter">)</span>
          java.lang.<span title="object java.lang.System">System</span>.<span title="java.io.PrintStream">out</span>.<span title="(x$1: java.lang.String)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;scope = &quot;)" class="string">&quot;scope = &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#247309" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.Symbol">owner</a>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.Type">tpe</a>.<a href="../../symtab/Types.scala.html#105487" title="=&gt; GenMSIL.this.global.Scope">decls</a><span class="delimiter">)</span>
          <a href="../../symtab/SymbolTable.scala.html#64790" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><a href="#247309" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; String">fullName</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#242322" title="(sym: GenMSIL.this.global.Symbol, cInfo: ch.epfl.lamp.compiler.msil.ConstructorInfo)Unit">mapConstructor</a><span class="delimiter">(</span><a href="#247309" title="GenMSIL.this.global.Symbol">sym</a>, <a href="#250887" title="ch.epfl.lamp.compiler.msil.ConstructorInfo">constr</a><span class="delimiter">)</span>
          <a href="#250887" title="ch.epfl.lamp.compiler.msil.ConstructorInfo">constr</a>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol, cInfo: ch.epfl.lamp.compiler.msil.ConstructorInfo)Unit" id="242322">mapConstructor</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="250316">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a>, <a title="ch.epfl.lamp.compiler.msil.ConstructorInfo" id="250317">cInfo</a>: <span title="ch.epfl.lamp.compiler.msil.ConstructorInfo">ConstructorInfo</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="../../symtab/clr/CLRTypes.scala.html#205476" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol, value: ch.epfl.lamp.compiler.msil.ConstructorInfo)Unit">constructors</a><span class="delimiter">(</span><a href="#250316" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span> = <a href="#250317" title="ch.epfl.lamp.compiler.msil.ConstructorInfo">cInfo</a>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.MethodInfo" id="242323">getMethod</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="248074">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span> = <span class="delimiter">{</span>

        <a href="../../symtab/clr/CLRTypes.scala.html#205478" title="=&gt; scala.collection.mutable.Map[GenMSIL.this.global.loaders.clrTypes.global.Symbol,ch.epfl.lamp.compiler.msil.MethodInfo]">methods</a>.<span title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)Option[ch.epfl.lamp.compiler.msil.MethodInfo]">get</span><span class="delimiter">(</span><a href="#248074" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span> <span title="ch.epfl.lamp.compiler.msil.MethodInfo" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.MethodInfo">Some</span><span class="delimiter">(</span><a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="250904">method</a><span class="delimiter">)</span> =&gt; <a href="#250904" title="ch.epfl.lamp.compiler.msil.MethodInfo">method</a>
        <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.MethodInfo">None</span> =&gt;
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="250905">mClass</a> = <a href="#242296" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#248074" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.Symbol">owner</a><span class="delimiter">)</span>
          <span class="keyword">try</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="250906">method</a> = <a href="#250905" title="ch.epfl.lamp.compiler.msil.Type">mClass</a>.<span title="(x$1: java.lang.String, x$2: Array[ch.epfl.lamp.compiler.msil.Type], x$3: ch.epfl.lamp.compiler.msil.Type)ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><a href="#242281" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#248074" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>, <a href="#242295" title="(sym: GenMSIL.this.global.Symbol)Array[ch.epfl.lamp.compiler.msil.Type]">msilParamTypes</a><span class="delimiter">(</span><a href="#248074" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>,
                                          <a href="#242294" title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#248074" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.Type">tpe</a>.<a href="../../symtab/Types.scala.html#105468" title="=&gt; GenMSIL.this.global.Type">resultType</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span title="ch.epfl.lamp.compiler.msil.MethodInfo" class="keyword">if</span> <span class="delimiter">(</span><a href="#250906" title="ch.epfl.lamp.compiler.msil.MethodInfo">method</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              java.lang.<span title="object java.lang.System">System</span>.<span title="java.io.PrintStream">out</span>.<span title="(x$1: java.lang.String)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Cannot find method &quot;)" class="string">&quot;Cannot find method &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#248074" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.Symbol">owner</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;::&quot;)" class="string">&quot;::&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#242281" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#248074" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span>
              java.lang.<span title="object java.lang.System">System</span>.<span title="java.io.PrintStream">out</span>.<span title="(x$1: java.lang.String)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;scope = &quot;)" class="string">&quot;scope = &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#248074" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.Symbol">owner</a>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.Type">tpe</a>.<a href="../../symtab/Types.scala.html#105487" title="=&gt; GenMSIL.this.global.Scope">decls</a><span class="delimiter">)</span>
              <a href="../../symtab/SymbolTable.scala.html#64790" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><a href="#248074" title="GenMSIL.this.global.Symbol">sym</a>.<span title="=&gt; String">fullName</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            <span class="keyword">else</span> <span class="delimiter">{</span>
              <a href="#242324" title="(sym: GenMSIL.this.global.Symbol, mInfo: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">mapMethod</a><span class="delimiter">(</span><a href="#248074" title="GenMSIL.this.global.Symbol">sym</a>, <a href="#250906" title="ch.epfl.lamp.compiler.msil.MethodInfo">method</a><span class="delimiter">)</span>
              <a href="#250906" title="ch.epfl.lamp.compiler.msil.MethodInfo">method</a>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
          <span class="keyword">catch</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a title="Nothing" id="250936">e</a>: <span title="Exception">Exception</span> =&gt;
              <span title="object Console">Console</span>.<span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;While looking up &quot;)" class="string">&quot;While looking up &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#250905" title="ch.epfl.lamp.compiler.msil.Type">mClass</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;::&quot;)" class="string">&quot;::&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#248074" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107655" title="=&gt; java.lang.String">nameString</a><span class="delimiter">)</span>
            <span title="object Console">Console</span>.<span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\011&quot;)" class="string">&quot;\t&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#242330" title="(sym: GenMSIL.this.global.Symbol)String">showsym</a><span class="delimiter">(</span><a href="#248074" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span title="Nothing" class="keyword">throw</span> <a href="#250936" title="Exception">e</a>
          <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="comment">/*
     * add a mapping between sym and mInfo
     */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol, mInfo: ch.epfl.lamp.compiler.msil.MethodInfo)Unit" id="242324">mapMethod</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="250467">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a>, <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="250468">mInfo</a>: <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span> <span class="delimiter">(</span><a href="#250468" title="ch.epfl.lamp.compiler.msil.MethodInfo">mInfo</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span>, <a href="#250468" title="ch.epfl.lamp.compiler.msil.MethodInfo">mInfo</a><span class="delimiter">)</span>
      <a href="../../symtab/clr/CLRTypes.scala.html#205478" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol, value: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">methods</a><span class="delimiter">(</span><a href="#250467" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span> = <a href="#250468" title="ch.epfl.lamp.compiler.msil.MethodInfo">mInfo</a>
    <span class="delimiter">}</span>

    <span class="comment">/*
     * add mapping between sym and method with newName, paramTypes of newClass
     */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol, newClass: ch.epfl.lamp.compiler.msil.Type, newName: String, paramTypes: Array[ch.epfl.lamp.compiler.msil.Type])Unit" id="242325">mapMethod</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="250462">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a>, <a title="ch.epfl.lamp.compiler.msil.Type" id="250463">newClass</a>: <span title="ch.epfl.lamp.compiler.msil.Type">MsilType</span>, <a title="String" id="250464">newName</a>: <span title="String">String</span>, <a title="Array[ch.epfl.lamp.compiler.msil.Type]" id="250465">paramTypes</a>: <span title="Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span class="delimiter">[</span>MsilType<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="250949">methodInfo</a> = <a href="#250463" title="ch.epfl.lamp.compiler.msil.Type">newClass</a>.<span title="(x$1: java.lang.String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><a href="#250464" title="String">newName</a>, <a href="#250465" title="Array[ch.epfl.lamp.compiler.msil.Type]">paramTypes</a><span class="delimiter">)</span>
      <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#250949" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span>, <span title="java.lang.String(&quot;Can\'t find mapping for &quot;)" class="string">&quot;Can't find mapping for &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#250462" title="GenMSIL.this.global.Symbol">sym</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; -&gt; &quot;)" class="string">&quot; -&gt; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span>
             <a href="#250464" title="String">newName</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;(&quot;)" class="string">&quot;(&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#250465" title="Array[ch.epfl.lamp.compiler.msil.Type]">paramTypes</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;)&quot;)" class="string">&quot;)&quot;</span><span class="delimiter">)</span>
      <a href="#242324" title="(sym: GenMSIL.this.global.Symbol, mInfo: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">mapMethod</a><span class="delimiter">(</span><a href="#250462" title="GenMSIL.this.global.Symbol">sym</a>, <a href="#250949" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#250949" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a>.<span title="()Boolean">IsStatic</span><span class="delimiter">)</span> 
        <a href="#242195" title="=&gt; scala.collection.mutable.HashSet[GenMSIL.this.global.Symbol]">dynToStatMapped</a> <span title="(elem: GenMSIL.this.global.Symbol)BytecodeGenerator.this.dynToStatMapped.type">+=</span> <a href="#250462" title="GenMSIL.this.global.Symbol">sym</a>
    <span class="delimiter">}</span>

    <span class="comment">/*
     * add mapping between method with name and paramTypes of clazz to
     * method with newName and newParamTypes of newClass (used for instance
     * for &quot;wait&quot;)
     */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(clazz: GenMSIL.this.global.Symbol, name: GenMSIL.this.global.Name, paramTypes: Array[GenMSIL.this.global.Type], newClass: ch.epfl.lamp.compiler.msil.Type, newName: String, newParamTypes: Array[ch.epfl.lamp.compiler.msil.Type])Unit" id="242326">mapMethod</a><span class="delimiter">(</span>
      <a title="GenMSIL.this.global.Symbol" id="250455">clazz</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a>, <a title="GenMSIL.this.global.Name" id="250456">name</a>: <a href="../../symtab/Names.scala.html#66925" title="GenMSIL.this.global.Name">Name</a>, <a title="Array[GenMSIL.this.global.Type]" id="250457">paramTypes</a>: <span title="Array[GenMSIL.this.global.Type]">Array</span><span class="delimiter">[</span>Type<span class="delimiter">]</span>,
      <a title="ch.epfl.lamp.compiler.msil.Type" id="250458">newClass</a>: <span title="ch.epfl.lamp.compiler.msil.Type">MsilType</span>, <a title="String" id="250459">newName</a>: <span title="String">String</span>, <a title="Array[ch.epfl.lamp.compiler.msil.Type]" id="250460">newParamTypes</a>: <span title="Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span class="delimiter">[</span>MsilType<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="GenMSIL.this.global.Symbol" id="250971">methodSym</a> = <a href="#242329" title="(clazz: GenMSIL.this.global.Symbol, name: GenMSIL.this.global.Name, paramTypes: Array[GenMSIL.this.global.Type])GenMSIL.this.global.Symbol">lookupMethod</a><span class="delimiter">(</span><a href="#250455" title="GenMSIL.this.global.Symbol">clazz</a>, <a href="#250456" title="GenMSIL.this.global.Name">name</a>, <a href="#250457" title="Array[GenMSIL.this.global.Type]">paramTypes</a><span class="delimiter">)</span>
        <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#250971" title="GenMSIL.this.global.Symbol">methodSym</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span>, <span title="java.lang.String(&quot;cannot find method &quot;)" class="string">&quot;cannot find method &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#250456" title="GenMSIL.this.global.Name">name</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;(&quot;)" class="string">&quot;(&quot;</span> <span title="(x$1: Any)java.lang.String">+</span>
               <a href="#250457" title="Array[GenMSIL.this.global.Type]">paramTypes</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;)&quot;)" class="string">&quot;)&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; in class &quot;)" class="string">&quot; in class &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#250455" title="GenMSIL.this.global.Symbol">clazz</a><span class="delimiter">)</span>
        <a href="#242325" title="(sym: GenMSIL.this.global.Symbol, newClass: ch.epfl.lamp.compiler.msil.Type, newName: String, paramTypes: Array[ch.epfl.lamp.compiler.msil.Type])Unit">mapMethod</a><span class="delimiter">(</span><a href="#250971" title="GenMSIL.this.global.Symbol">methodSym</a>, <a href="#250458" title="ch.epfl.lamp.compiler.msil.Type">newClass</a>, <a href="#250459" title="String">newName</a>, <a href="#250460" title="Array[ch.epfl.lamp.compiler.msil.Type]">newParamTypes</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span class="comment">/*
     * add mapping for member with name and paramTypes to member
     * newName of newClass (same parameters)
     */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(clazz: GenMSIL.this.global.Symbol, name: GenMSIL.this.global.Name, paramTypes: Array[GenMSIL.this.global.Type], newClass: ch.epfl.lamp.compiler.msil.Type, newName: String)Unit" id="242327">mapMethod</a><span class="delimiter">(</span>
      <a title="GenMSIL.this.global.Symbol" id="250449">clazz</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a>, <a title="GenMSIL.this.global.Name" id="250450">name</a>: <a href="../../symtab/Names.scala.html#66925" title="GenMSIL.this.global.Name">Name</a>, <a title="Array[GenMSIL.this.global.Type]" id="250451">paramTypes</a>: <span title="Array[GenMSIL.this.global.Type]">Array</span><span class="delimiter">[</span>Type<span class="delimiter">]</span>,
      <a title="ch.epfl.lamp.compiler.msil.Type" id="250452">newClass</a>: <span title="ch.epfl.lamp.compiler.msil.Type">MsilType</span>, <a title="String" id="250453">newName</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#242326" title="(clazz: GenMSIL.this.global.Symbol, name: GenMSIL.this.global.Name, paramTypes: Array[GenMSIL.this.global.Type], newClass: ch.epfl.lamp.compiler.msil.Type, newName: String, newParamTypes: Array[ch.epfl.lamp.compiler.msil.Type])Unit">mapMethod</a><span class="delimiter">(</span><a href="#250449" title="GenMSIL.this.global.Symbol">clazz</a>, <a href="#250450" title="GenMSIL.this.global.Name">name</a>, <a href="#250451" title="Array[GenMSIL.this.global.Type]">paramTypes</a>, <a href="#250452" title="ch.epfl.lamp.compiler.msil.Type">newClass</a>, <a href="#250453" title="String">newName</a>, <a href="#250451" title="(xs: Array[GenMSIL.this.global.Type])scala.collection.mutable.ArrayOps[GenMSIL.this.global.Type]">paramTypes</a> <span title="(f: GenMSIL.this.global.Type =&gt; ch.epfl.lamp.compiler.msil.Type)(implicit bf: scala.collection.generic.CanBuildFrom[Array[GenMSIL.this.global.Type],ch.epfl.lamp.compiler.msil.Type,Array[ch.epfl.lamp.compiler.msil.Type]])Array[ch.epfl.lamp.compiler.msil.Type]">map</span> <a href="#242294" title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span class="comment">/*
     * add mapping for all methods with name of clazz to the corresponding
     * method (same parameters) with newName of newClass
     */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(clazz: GenMSIL.this.global.Symbol, name: GenMSIL.this.global.Name, newClass: ch.epfl.lamp.compiler.msil.Type, newName: String)Unit" id="242328">mapMethod</a><span class="delimiter">(</span>
      <a title="GenMSIL.this.global.Symbol" id="250444">clazz</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a>, <a title="GenMSIL.this.global.Name" id="250445">name</a>: <a href="../../symtab/Names.scala.html#66925" title="GenMSIL.this.global.Name">Name</a>,
      <a title="ch.epfl.lamp.compiler.msil.Type" id="250446">newClass</a>: <span title="ch.epfl.lamp.compiler.msil.Type">MsilType</span>, <a title="String" id="250447">newName</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="GenMSIL.this.global.Symbol" id="251492">memberSym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a> = <a href="#250444" title="GenMSIL.this.global.Symbol">clazz</a>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.Type">tpe</a>.<a href="../../symtab/Types.scala.html#105495" title="(name: GenMSIL.this.global.Name)GenMSIL.this.global.Symbol">member</a><span class="delimiter">(</span><a href="#250445" title="GenMSIL.this.global.Name">name</a><span class="delimiter">)</span>
        <a href="#251492" title="GenMSIL.this.global.Symbol">memberSym</a>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.Type">tpe</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="comment">// alternatives: List[Symbol]</span>
          <span class="keyword">case</span> <span title="Unit">OverloadedType</span><span class="delimiter">(</span>_, <a title="List[GenMSIL.this.global.Symbol]" id="251536">alternatives</a><span class="delimiter">)</span> =&gt;
            <a href="#251536" title="List[GenMSIL.this.global.Symbol]">alternatives</a>.<span title="(f: GenMSIL.this.global.Symbol =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="251556">s</a> =&gt; <a href="#242325" title="(sym: GenMSIL.this.global.Symbol, newClass: ch.epfl.lamp.compiler.msil.Type, newName: String, paramTypes: Array[ch.epfl.lamp.compiler.msil.Type])Unit">mapMethod</a><span class="delimiter">(</span><a href="#251556" title="GenMSIL.this.global.Symbol">s</a>, <a href="#250446" title="ch.epfl.lamp.compiler.msil.Type">newClass</a>, <a href="#250447" title="String">newName</a>, <a href="#242295" title="(sym: GenMSIL.this.global.Symbol)Array[ch.epfl.lamp.compiler.msil.Type]">msilParamTypes</a><span class="delimiter">(</span><a href="#251556" title="GenMSIL.this.global.Symbol">s</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

          <span class="comment">// paramTypes: List[Type], resType: Type</span>
          <span class="keyword">case</span> <span title="Unit">MethodType</span><span class="delimiter">(</span><a title="List[GenMSIL.this.global.Symbol]" id="251566">params</a>, <a title="GenMSIL.this.global.Type" id="251567">resType</a><span class="delimiter">)</span> =&gt;
            <a href="#242325" title="(sym: GenMSIL.this.global.Symbol, newClass: ch.epfl.lamp.compiler.msil.Type, newName: String, paramTypes: Array[ch.epfl.lamp.compiler.msil.Type])Unit">mapMethod</a><span class="delimiter">(</span><a href="#251492" title="GenMSIL.this.global.Symbol">memberSym</a>, <a href="#250446" title="ch.epfl.lamp.compiler.msil.Type">newClass</a>, <a href="#250447" title="String">newName</a>, <a href="#242295" title="(sym: GenMSIL.this.global.Symbol)Array[ch.epfl.lamp.compiler.msil.Type]">msilParamTypes</a><span class="delimiter">(</span><a href="#251492" title="GenMSIL.this.global.Symbol">memberSym</a><span class="delimiter">)</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Nothing">_</span> =&gt;
            <a href="../../symtab/SymbolTable.scala.html#64790" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="java.lang.String(&quot;member not found: &quot;)" class="string">&quot;member not found: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#250444" title="GenMSIL.this.global.Symbol">clazz</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#250445" title="GenMSIL.this.global.Name">name</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>


    <span class="comment">/*
     * find the method in clazz with name and paramTypes
     */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(clazz: GenMSIL.this.global.Symbol, name: GenMSIL.this.global.Name, paramTypes: Array[GenMSIL.this.global.Type])GenMSIL.this.global.Symbol" id="242329">lookupMethod</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="250972">clazz</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a>, <a title="GenMSIL.this.global.Name" id="250973">name</a>: <a href="../../symtab/Names.scala.html#66925" title="GenMSIL.this.global.Name">Name</a>, <a title="Array[GenMSIL.this.global.Type]" id="250974">paramTypes</a>: <span title="Array[GenMSIL.this.global.Type]">Array</span><span class="delimiter">[</span>Type<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="GenMSIL.this.global.Symbol" id="251576">memberSym</a> = <a href="#250972" title="GenMSIL.this.global.Symbol">clazz</a>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.Type">tpe</a>.<a href="../../symtab/Types.scala.html#105495" title="(name: GenMSIL.this.global.Name)GenMSIL.this.global.Symbol">member</a><span class="delimiter">(</span><a href="#250973" title="GenMSIL.this.global.Name">name</a><span class="delimiter">)</span>
      <a href="#251576" title="GenMSIL.this.global.Symbol">memberSym</a>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.Type">tpe</a> <span title="GenMSIL.this.global.Symbol" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="GenMSIL.this.global.Symbol">OverloadedType</span><span class="delimiter">(</span>_, <a title="List[GenMSIL.this.global.Symbol]" id="251579">alternatives</a><span class="delimiter">)</span> =&gt;
          <a href="#251579" title="List[GenMSIL.this.global.Symbol]">alternatives</a>.<span title="(p: GenMSIL.this.global.Symbol =&gt; Boolean)Option[GenMSIL.this.global.Symbol]">find</span><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="251586">s</a> =&gt; <span class="delimiter">{</span>
            <span class="keyword">var</span> <a title="Int" id="251587">i</a>: <span title="Int">Int</span> = <span title="Int(0)" class="int">0</span>
            <span class="keyword">var</span> <a title="Boolean" id="251588">typesOK</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#250974" title="Array[GenMSIL.this.global.Type]">paramTypes</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <a href="#251586" title="GenMSIL.this.global.Symbol">s</a>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.Type">tpe</a>.<a href="../../symtab/Types.scala.html#105476" title="=&gt; List[GenMSIL.this.global.Type]">paramTypes</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span title="Unit" class="keyword">while</span><span class="delimiter">(</span><a href="#251587" title="Int">i</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#250974" title="Array[GenMSIL.this.global.Type]">paramTypes</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span> <a href="#251595" title="()Unit" class="delimiter">{</a>
                <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#250974" title="(i: Int)GenMSIL.this.global.Type">paramTypes</a><span class="delimiter">(</span><a href="#251587" title="Int">i</a><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#251586" title="GenMSIL.this.global.Symbol">s</a>.<a href="../../symtab/Symbols.scala.html#107562" title="=&gt; GenMSIL.this.global.Type">tpe</a>.<a href="../../symtab/Types.scala.html#105476" title="(n: Int)GenMSIL.this.global.Type">paramTypes</a><span class="delimiter">(</span><a href="#251587" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
                  <a href="#251588" title="Boolean">typesOK</a> = <span title="Boolean(false)" class="keyword">false</span>
                <a href="#251587" title="Int">i</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
              <a href="#251588" title="Boolean">typesOK</a> = <span title="Boolean(false)" class="keyword">false</span>
            <span class="delimiter">}</span>
            <a href="#251588" title="Boolean">typesOK</a>
          <span class="delimiter">}</span><span class="delimiter">)</span> <span title="GenMSIL.this.global.Symbol" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="GenMSIL.this.global.Symbol">Some</span><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="251618">sym</a><span class="delimiter">)</span> =&gt; <a href="#251618" title="GenMSIL.this.global.Symbol">sym</a>
            <span class="keyword">case</span> <span title="Nothing">None</span> =&gt; <a href="../../symtab/SymbolTable.scala.html#64790" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="java.lang.String(&quot;member of &quot;)" class="string">&quot;member of &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#250972" title="GenMSIL.this.global.Symbol">clazz</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#250973" title="GenMSIL.this.global.Name">name</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;(&quot;)" class="string">&quot;(&quot;</span> <span title="(x$1: Any)java.lang.String">+</span>
                               <a href="#250974" title="Array[GenMSIL.this.global.Type]">paramTypes</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;) not found&quot;)" class="string">&quot;) not found&quot;</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>

        <span class="keyword">case</span> <span title="GenMSIL.this.global.Symbol">MethodType</span><span class="delimiter">(</span>_, _<span class="delimiter">)</span> =&gt; <a href="#251576" title="GenMSIL.this.global.Symbol">memberSym</a>

        <span class="keyword">case</span> <span title="Nothing">_</span> =&gt; <a href="../../symtab/SymbolTable.scala.html#64790" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="java.lang.String(&quot;member not found: &quot;)" class="string">&quot;member not found: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#250973" title="GenMSIL.this.global.Name">name</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; of &quot;)" class="string">&quot; of &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#250972" title="GenMSIL.this.global.Symbol">clazz</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)String" id="242330">showsym</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="245742">sym</a>: <a href="../../symtab/Symbols.scala.html#67331" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">(</span><a href="#245742" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107657" title="()String">toString</a> <span title="(x$1: Any)java.lang.String">+</span>
      <span title="java.lang.String(&quot;\012  symbol = &quot;)" class="string">&quot;\n  symbol = &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="../../symtab/Flags.scala.html#24068" title="object scala.tools.nsc.symtab.Flags">Flags</a>.<span title="(flags: Long)String">flagsToString</span><span class="delimiter">(</span><a href="#245742" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107551" title="=&gt; Long">flags</a><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#245742" title="GenMSIL.this.global.Symbol">sym</a> <span title="(x$1: Any)java.lang.String">+</span>
      <span title="java.lang.String(&quot;\012  owner  = &quot;)" class="string">&quot;\n  owner  = &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="../../symtab/Flags.scala.html#24068" title="object scala.tools.nsc.symtab.Flags">Flags</a>.<span title="(flags: Long)String">flagsToString</span><span class="delimiter">(</span><a href="#245742" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.Symbol">owner</a>.<a href="../../symtab/Symbols.scala.html#107551" title="=&gt; Long">flags</a><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#245742" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107541" title="=&gt; GenMSIL.this.global.Symbol">owner</a>
    <span class="delimiter">)</span>

  <span class="delimiter">}</span> <span class="comment">// class BytecodeGenerator</span>

<span class="delimiter">}</span> <span class="comment">// class GenMSIL</span>

        </pre>
    </body>
</html>
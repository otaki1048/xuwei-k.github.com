<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/backend/opt/ClosureElimination.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
 <span class="comment">/* NSC -- new Scala compiler
 * Copyright 2005-2011 LAMP/EPFL
 * @author  Iulian Dragos
 */</span>


<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> backend.opt

<span class="keyword">import</span> scala.collection.mutable.<span class="delimiter">{</span>Map, HashMap<span class="delimiter">}</span>
<span class="keyword">import</span> scala.tools.nsc.backend.icode.analysis.LubException
<span class="keyword">import</span> scala.tools.nsc.symtab._

<span class="comment">/**
 *  @author Iulian Dragos
 */</span>
<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class ClosureElimination extends scala.tools.nsc.SubComponent with ScalaObject" id="15755">ClosureElimination</a> <a href="#15755" title="ScalaObject" class="keyword">extends</a> <a href="../../SubComponent.scala.html#10972" title="scala.tools.nsc.SubComponent">SubComponent</a> <span class="delimiter">{</span>
  <span class="keyword">import</span> <a href="../../SubComponent.scala.html#95918" title="=&gt; scala.tools.nsc.Global">global</a>._
  <span class="keyword">import</span> <a href="../../Global.scala.html#64836" title="object ClosureElimination.this.global.icodes">icodes</a>._
  <span class="keyword">import</span> <a href="../../Global.scala.html#64836" title="object ClosureElimination.this.global.icodes">icodes</a>.<a href="../icode/Opcodes.scala.html#96975" title="object ClosureElimination.this.global.icodes.opcodes">opcodes</a>._

  <span class="keyword">val</span> <a title="java.lang.String" id="112120">phaseName</a> = <span title="java.lang.String(&quot;closelim&quot;)" class="string">&quot;closelim&quot;</span>

  <span class="comment">/** Create a new phase */</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(p: scala.tools.nsc.Phase)ClosureElimination.this.ClosureEliminationPhase" id="112122">newPhase</a><span class="delimiter">(</span><a title="scala.tools.nsc.Phase" id="113691">p</a>: <a href="../../Phase.scala.html#10630" title="scala.tools.nsc.Phase">Phase</a><span class="delimiter">)</span> = <span title="ClosureElimination.this.ClosureEliminationPhase" class="keyword">new</span> <a href="#112125" title="ClosureElimination.this.ClosureEliminationPhase">ClosureEliminationPhase</a><span class="delimiter">(</span><a href="#113691" title="scala.tools.nsc.Phase">p</a><span class="delimiter">)</span>

  <span class="comment">/** A simple peephole optimizer. */</span>
  <span class="keyword">val</span> <a title="ClosureElimination.this.PeepholeOpt" id="112123">peephole</a> = <a href="#251570" title="ClosureElimination.this.PeepholeOpt" class="keyword">new</a> <a href="#112127" title="anonymous class $anon extends ClosureElimination.this.PeepholeOpt" id="251570">PeepholeOpt</a> <span class="delimiter">{</span>

    <span class="keyword">def</span> <a title="(bb: ClosureElimination.this.global.icodes.BasicBlock, i1: ClosureElimination.this.global.icodes.Instruction, i2: ClosureElimination.this.global.icodes.Instruction)Option[List[ClosureElimination.this.global.icodes.Instruction]]" id="251582">peep</a><span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.BasicBlock" id="251583">bb</a>: <a href="../icode/BasicBlocks.scala.html#96970" title="ClosureElimination.this.global.icodes.BasicBlock">BasicBlock</a>, <a title="ClosureElimination.this.global.icodes.Instruction" id="251584">i1</a>: <a href="../icode/Opcodes.scala.html#96974" title="ClosureElimination.this.global.icodes.Instruction">Instruction</a>, <a title="ClosureElimination.this.global.icodes.Instruction" id="251585">i2</a>: <a href="../icode/Opcodes.scala.html#96974" title="ClosureElimination.this.global.icodes.Instruction">Instruction</a><span class="delimiter">)</span> = <span title="(_1: ClosureElimination.this.global.icodes.Instruction, _2: ClosureElimination.this.global.icodes.Instruction)(ClosureElimination.this.global.icodes.Instruction, ClosureElimination.this.global.icodes.Instruction)" class="delimiter">(</span><a href="#251584" title="ClosureElimination.this.global.icodes.Instruction">i1</a>, <a href="#251585" title="ClosureElimination.this.global.icodes.Instruction">i2</a><span class="delimiter">)</span> <span title="Option[List[ClosureElimination.this.global.icodes.Instruction]]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Option[List[ClosureElimination.this.global.icodes.Instruction]]" class="delimiter">(</span>CONSTANT<span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.global.Constant" id="251599">c</a><span class="delimiter">)</span>, DROP<span class="delimiter">(</span>_<span class="delimiter">)</span><span class="delimiter">)</span> =&gt; 
        <span title="Option[List[ClosureElimination.this.global.icodes.Instruction]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#251599" title="ClosureElimination.this.global.icodes.global.Constant">c</a>.<span title="=&gt; Int">tag</span> <span title="(x: Int)Boolean">==</span> <span title="Int(1)">UnitTag</span><span class="delimiter">)</span> <span title="(x: List[ClosureElimination.this.global.icodes.Instruction])Some[List[ClosureElimination.this.global.icodes.Instruction]]">Some</span><span class="delimiter">(</span><span title="(xs: ClosureElimination.this.global.icodes.Instruction*)List[ClosureElimination.this.global.icodes.Instruction]">List</span><span class="delimiter">(</span><a href="#251585" title="ClosureElimination.this.global.icodes.Instruction">i2</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">else</span> <span title="(x: scala.collection.immutable.Nil.type)Some[scala.collection.immutable.Nil.type]">Some</span><span class="delimiter">(</span><span title="object Nil">Nil</span><span class="delimiter">)</span>

      <span class="keyword">case</span> <span title="Option[List[ClosureElimination.this.global.icodes.Instruction]]" class="delimiter">(</span>LOAD_LOCAL<span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.Local" id="251634">x</a><span class="delimiter">)</span>, STORE_LOCAL<span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.Local" id="251636">y</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
        <span title="Option[List[ClosureElimination.this.global.icodes.Instruction]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#251634" title="ClosureElimination.this.global.icodes.Local">x</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#251636" title="ClosureElimination.this.global.icodes.Local">y</a><span class="delimiter">)</span> <span title="(x: scala.collection.immutable.Nil.type)Some[scala.collection.immutable.Nil.type]">Some</span><span class="delimiter">(</span><span title="object Nil">Nil</span><span class="delimiter">)</span> <span class="keyword">else</span> <span title="object None">None</span>

      <span class="keyword">case</span> <span title="Option[List[ClosureElimination.this.global.icodes.Instruction]]" class="delimiter">(</span>STORE_LOCAL<span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.Local" id="251643">x</a><span class="delimiter">)</span>, LOAD_LOCAL<span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.Local" id="251645">y</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#251643" title="ClosureElimination.this.global.icodes.Local">x</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#251645" title="ClosureElimination.this.global.icodes.Local">y</a><span class="delimiter">)</span> =&gt;
        <span class="keyword">var</span> <a title="scala.collection.immutable.Set[ClosureElimination.this.global.icodes.liveness.global.icodes.Local]" id="251650">liveOut</a> = <a href="#251577" title="=&gt; ClosureElimination.this.global.icodes.liveness.LivenessAnalysis">liveness</a>.<a href="../icode/analysis/DataFlowAnalysis.scala.html#223909" title="(key: ClosureElimination.this.global.icodes.liveness.global.icodes.BasicBlock)scala.collection.immutable.Set[ClosureElimination.this.global.icodes.liveness.global.icodes.Local]">out</a><span class="delimiter">(</span><a href="#251583" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a><span class="delimiter">)</span>
        <span title="Option[List[ClosureElimination.this.global.icodes.Instruction]]" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#251650" title="(elem: ClosureElimination.this.global.icodes.liveness.global.icodes.Local)Boolean">liveOut</a><span class="delimiter">(</span><a href="#251643" title="ClosureElimination.this.global.icodes.Local">x</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../../Global.scala.html#64872" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;store/load to a dead local? &quot;)" class="string">&quot;store/load to a dead local? &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#251643" title="ClosureElimination.this.global.icodes.Local">x</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Array[ClosureElimination.this.global.icodes.Instruction]" id="251698">instrs</a> = <a href="#251583" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a>.<a href="../icode/BasicBlocks.scala.html#197648" title="=&gt; Array[ClosureElimination.this.global.icodes.Instruction]">getArray</a>
          <span class="keyword">var</span> <a title="Int" id="251699">idx</a> = <a href="#251698" title="Array[ClosureElimination.this.global.icodes.Instruction]">instrs</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span>
          <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#251699" title="Int">idx</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span class="delimiter">(</span><a href="#251698" title="(i: Int)ClosureElimination.this.global.icodes.Instruction">instrs</a><span class="delimiter">(</span><a href="#251699" title="Int">idx</a><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">ne</span> <a href="#251585" title="ClosureElimination.this.global.icodes.Instruction">i2</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#251700" title="()Unit" class="delimiter">{</a>
            <a href="#251650" title="scala.collection.immutable.Set[ClosureElimination.this.global.icodes.liveness.global.icodes.Local]">liveOut</a> = <a href="#251577" title="=&gt; ClosureElimination.this.global.icodes.liveness.LivenessAnalysis">liveness</a>.<a href="../icode/analysis/Liveness.scala.html#225879" title="(out: scala.collection.immutable.Set[ClosureElimination.this.global.icodes.liveness.global.icodes.Local], i: ClosureElimination.this.global.icodes.liveness.global.icodes.Instruction)scala.collection.immutable.Set[ClosureElimination.this.global.icodes.liveness.global.icodes.Local]">interpret</a><span class="delimiter">(</span><a href="#251650" title="scala.collection.immutable.Set[ClosureElimination.this.global.icodes.liveness.global.icodes.Local]">liveOut</a>, <a href="#251698" title="(i: Int)ClosureElimination.this.global.icodes.Instruction">instrs</a><span class="delimiter">(</span><a href="#251699" title="Int">idx</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#251699" title="Int">idx</a> <span title="(x: Int)Int">-=</span> <span title="Int(1)" class="int">1</span>
          <span class="delimiter">}</span>
          <span title="Option[List[ClosureElimination.this.global.icodes.Instruction]]" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#251650" title="(elem: ClosureElimination.this.global.icodes.liveness.global.icodes.Local)Boolean">liveOut</a><span class="delimiter">(</span><a href="#251643" title="ClosureElimination.this.global.icodes.Local">x</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="../../Global.scala.html#64872" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;removing dead store/load &quot;)" class="string">&quot;removing dead store/load &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#251643" title="ClosureElimination.this.global.icodes.Local">x</a><span class="delimiter">)</span>
            <span title="(x: scala.collection.immutable.Nil.type)Some[scala.collection.immutable.Nil.type]">Some</span><span class="delimiter">(</span><span title="object Nil">Nil</span><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <span title="object None">None</span>
        <span class="delimiter">}</span> <span class="keyword">else</span>
          <span title="(x: List[Product with ClosureElimination.this.global.icodes.Instruction with Serializable])Some[List[Product with ClosureElimination.this.global.icodes.Instruction with Serializable]]">Some</span><span class="delimiter">(</span><span title="(xs: Product with ClosureElimination.this.global.icodes.Instruction with Serializable*)List[Product with ClosureElimination.this.global.icodes.Instruction with Serializable]">List</span><span class="delimiter">(</span><a href="../icode/Opcodes.scala.html#206099" title="(typ: ClosureElimination.this.global.icodes.TypeKind)ClosureElimination.this.global.icodes.opcodes.DUP">DUP</a><span class="delimiter">(</span><a href="#251643" title="ClosureElimination.this.global.icodes.Local">x</a>.<a href="../icode/Members.scala.html#197917" title="=&gt; ClosureElimination.this.global.icodes.TypeKind">kind</a><span class="delimiter">)</span>, <a href="../icode/Opcodes.scala.html#202746" title="(local: ClosureElimination.this.global.icodes.Local)ClosureElimination.this.global.icodes.opcodes.STORE_LOCAL">STORE_LOCAL</a><span class="delimiter">(</span><a href="#251643" title="ClosureElimination.this.global.icodes.Local">x</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">case</span> <span title="Some[scala.collection.immutable.Nil.type]" class="delimiter">(</span>LOAD_LOCAL<span class="delimiter">(</span>_<span class="delimiter">)</span>, DROP<span class="delimiter">(</span>_<span class="delimiter">)</span><span class="delimiter">)</span> | <span class="delimiter">(</span>DUP<span class="delimiter">(</span>_<span class="delimiter">)</span>, DROP<span class="delimiter">(</span>_<span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
        <span title="(x: scala.collection.immutable.Nil.type)Some[scala.collection.immutable.Nil.type]">Some</span><span class="delimiter">(</span><span title="object Nil">Nil</span><span class="delimiter">)</span>

      <span class="keyword">case</span> <span title="Some[scala.collection.immutable.Nil.type]" class="delimiter">(</span>BOX<span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.TypeKind" id="251781">t1</a><span class="delimiter">)</span>, UNBOX<span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.TypeKind" id="251783">t2</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#251781" title="ClosureElimination.this.global.icodes.TypeKind">t1</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#251783" title="ClosureElimination.this.global.icodes.TypeKind">t2</a><span class="delimiter">)</span> =&gt;
        <span title="(x: scala.collection.immutable.Nil.type)Some[scala.collection.immutable.Nil.type]">Some</span><span class="delimiter">(</span><span title="object Nil">Nil</span><span class="delimiter">)</span>

      <span class="keyword">case</span> <span title="Option[List[ClosureElimination.this.global.icodes.Instruction]]" class="delimiter">(</span>LOAD_FIELD<span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.global.Symbol" id="251795">sym</a>, <a title="Boolean" id="251796">isStatic</a><span class="delimiter">)</span>, DROP<span class="delimiter">(</span>_<span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <span title="=&gt; Boolean">!</span><a href="#251795" title="ClosureElimination.this.global.icodes.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107273" title="(cls: ClosureElimination.this.global.icodes.global.Symbol)Boolean">hasAnnotation</a><span class="delimiter">(</span><a href="../../symtab/Definitions.scala.html#67688" title="object ClosureElimination.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106489" title="=&gt; ClosureElimination.this.global.Symbol">VolatileAttr</a><span class="delimiter">)</span> =&gt;
        <span title="Option[List[ClosureElimination.this.global.icodes.Instruction]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#251796" title="Boolean">isStatic</a><span class="delimiter">)</span>
          <span title="(x: scala.collection.immutable.Nil.type)Some[scala.collection.immutable.Nil.type]">Some</span><span class="delimiter">(</span><span title="object Nil">Nil</span><span class="delimiter">)</span>
        <span class="keyword">else</span>
          <span title="(x: List[ClosureElimination.this.global.icodes.opcodes.DROP])Some[List[ClosureElimination.this.global.icodes.opcodes.DROP]]">Some</span><span class="delimiter">(</span><a href="../icode/Opcodes.scala.html#206820" title="(typ: ClosureElimination.this.global.icodes.TypeKind)ClosureElimination.this.global.icodes.opcodes.DROP">DROP</a><span class="delimiter">(</span><a href="../icode/TypeKinds.scala.html#196332" title="(cls: ClosureElimination.this.global.icodes.global.Symbol)ClosureElimination.this.global.icodes.REFERENCE">REFERENCE</a><span class="delimiter">(</span><a href="../../symtab/Definitions.scala.html#67688" title="object ClosureElimination.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106079" title="=&gt; ClosureElimination.this.global.Symbol">ObjectClass</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#251804" title="(x: ClosureElimination.this.global.icodes.opcodes.DROP)List[ClosureElimination.this.global.icodes.opcodes.DROP]">::</a> <span title="object Nil">Nil</span><span class="delimiter">)</span>

      <span class="keyword">case</span> <span title="None.type">_</span> =&gt; <span title="object None">None</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/** The closure elimination phase.
   */</span>
  <span class="keyword">class</span> <a title="class ClosureEliminationPhase extends ClosureElimination.this.global.icodes.ICodePhase with ScalaObject" id="112125">ClosureEliminationPhase</a><a href="#112125" title="ScalaObject" class="delimiter">(</a><a title="scala.tools.nsc.Phase" id="113701">prev</a>: <a href="../../Phase.scala.html#10630" title="scala.tools.nsc.Phase">Phase</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../icode/ICodes.scala.html#96950" title="ClosureElimination.this.global.icodes.ICodePhase">ICodePhase</a><span class="delimiter">(</span><a href="#113701" title="scala.tools.nsc.Phase">prev</a><span class="delimiter">)</span> <span class="delimiter">{</span>

    <span class="keyword">def</span> <a title="=&gt; java.lang.String" id="113697">name</a> = <a href="#112120" title="=&gt; java.lang.String">phaseName</a>
    <span class="keyword">val</span> <a title="ClosureElimination.this.ClosureElim" id="113698">closser</a> = <span title="ClosureElimination.this.ClosureElim" class="keyword">new</span> <a href="#112126" title="ClosureElimination.this.ClosureElim">ClosureElim</a>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(c: ClosureElimination.this.global.icodes.IClass)Unit" id="113700">apply</a><span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.IClass" id="251842">c</a>: <a href="../icode/Members.scala.html#96961" title="ClosureElimination.this.global.icodes.IClass">IClass</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
      <a href="#113698" title="=&gt; ClosureElimination.this.ClosureElim">closser</a> <a href="#251832" title="(cls: ClosureElimination.this.global.icodes.IClass)Unit">analyzeClass</a> <a href="#251842" title="ClosureElimination.this.global.icodes.IClass">c</a>
  <span class="delimiter">}</span>

  <span class="comment">/** 
   * Remove references to the environment through fields of a closure object. 
   * This has to be run after an 'apply' method has been inlined, but it still 
   * references the closure object.
   *
   */</span>
  <span class="keyword">class</span> <a title="class ClosureElim extends java.lang.Object with ScalaObject" id="112126">ClosureElim</a> <a href="#112126" title="ScalaObject" class="delimiter">{</a>
    <span class="keyword">def</span> <a title="(cls: ClosureElimination.this.global.icodes.IClass)Unit" id="251832">analyzeClass</a><span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.IClass" id="251850">cls</a>: <a href="../icode/Members.scala.html#96961" title="ClosureElimination.this.global.icodes.IClass">IClass</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64818" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36752" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">Xcloselim</a>.<a href="../../settings/MutableSettings.scala.html#42162" title="=&gt; Boolean">value</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#251850" title="ClosureElimination.this.global.icodes.IClass">cls</a>.<a href="../icode/Members.scala.html#97396" title="=&gt; List[ClosureElimination.this.global.icodes.IMethod]">methods</a> <span title="(f: ClosureElimination.this.global.icodes.IMethod =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="ClosureElimination.this.global.icodes.IMethod" id="251883">m</a> =&gt; 
        <a href="#251836" title="(m: ClosureElimination.this.global.icodes.IMethod)Unit">analyzeMethod</a><span class="delimiter">(</span><a href="#251883" title="ClosureElimination.this.global.icodes.IMethod">m</a><span class="delimiter">)</span>
        <a href="#251579" title="(m: ClosureElimination.this.global.icodes.IMethod)Unit">peephole</a><span class="delimiter">(</span><a href="#251883" title="ClosureElimination.this.global.icodes.IMethod">m</a><span class="delimiter">)</span>
     <span class="delimiter">}</span><span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="ClosureElimination.this.global.copyPropagation.CopyAnalysis" id="251833">cpp</a> = <span title="ClosureElimination.this.global.copyPropagation.CopyAnalysis" class="keyword">new</span> <a href="../../Global.scala.html#64844" title="object ClosureElimination.this.global.copyPropagation">copyPropagation</a>.<a href="../icode/analysis/CopyPropagation.scala.html#107176" title="ClosureElimination.this.global.copyPropagation.CopyAnalysis">CopyAnalysis</a>

    <span class="keyword">import</span> <a href="../../Global.scala.html#64844" title="object ClosureElimination.this.global.copyPropagation">copyPropagation</a>._

    <span class="comment">/* Some embryonic copy propagation. */</span>
    <span class="keyword">def</span> <a title="(m: ClosureElimination.this.global.icodes.IMethod)Unit" id="251836">analyzeMethod</a><span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.IMethod" id="251884">m</a>: <a href="../icode/Members.scala.html#96963" title="ClosureElimination.this.global.icodes.IMethod">IMethod</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="keyword">try</span> <span class="delimiter">{</span><span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#251884" title="ClosureElimination.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197727" title="=&gt; ClosureElimination.this.global.icodes.Code">code</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../Global.scala.html#64872" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Analyzing &quot;)" class="string">&quot;Analyzing &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#251884" title="ClosureElimination.this.global.icodes.IMethod">m</a><span class="delimiter">)</span>
      <a href="#251833" title="=&gt; ClosureElimination.this.global.copyPropagation.CopyAnalysis">cpp</a>.<a href="../icode/analysis/CopyPropagation.scala.html#223931" title="(m: ClosureElimination.this.global.copyPropagation.global.icodes.IMethod)Unit">init</a><span class="delimiter">(</span><a href="#251884" title="ClosureElimination.this.global.icodes.IMethod">m</a><span class="delimiter">)</span>
      <a href="#251833" title="=&gt; ClosureElimination.this.global.copyPropagation.CopyAnalysis">cpp</a>.<a href="../icode/analysis/CopyPropagation.scala.html#223932" title="()Unit">run</a>

      <span class="keyword">for</span> <span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.BasicBlock" id="251920">bb</a> &lt;- <a href="../icode/ICodes.scala.html#96923" title="=&gt; ClosureElimination.this.global.icodes.Linearizer">linearizer</a>.<a href="../icode/Linearizers.scala.html#215296" title="(c: ClosureElimination.this.global.icodes.IMethod)List[ClosureElimination.this.global.icodes.BasicBlock]">linearize</a><span title="(f: ClosureElimination.this.global.icodes.BasicBlock =&gt; Unit)Unit" class="delimiter">(</span><a href="#251884" title="ClosureElimination.this.global.icodes.IMethod">m</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">var</span> <a title="ClosureElim.this.cpp.lattice.Elem" id="251921">info</a> = <a href="#251833" title="=&gt; ClosureElimination.this.global.copyPropagation.CopyAnalysis">cpp</a>.<a href="../icode/analysis/DataFlowAnalysis.scala.html#223907" title="(key: ClosureElim.this.cpp.P)ClosureElim.this.cpp.lattice.Elem">in</a><span class="delimiter">(</span><a href="#251920" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64818" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36760" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#42162" title="=&gt; Boolean">value</a><span class="delimiter">)</span> <a href="../../Global.scala.html#64872" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Cpp info at entry to block &quot;)" class="string">&quot;Cpp info at entry to block &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#251920" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#251921" title="ClosureElim.this.cpp.lattice.Elem">info</a><span class="delimiter">)</span>

        <span class="keyword">for</span> <span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.Instruction" id="251967">i</a> &lt;- <a href="../icode/BasicBlocks.scala.html#197651" title="(f: ClosureElimination.this.global.icodes.Instruction =&gt; Unit)Unit">bb</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#251967" title="ClosureElimination.this.global.icodes.Instruction">i</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="Unit">LOAD_LOCAL</span><span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.Local" id="251969">l</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#251921" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#223471" title="=&gt; ClosureElim.this.cpp.lattice.Bindings">bindings</a> <span title="(key: ClosureElimination.this.global.copyPropagation.Location)Boolean">isDefinedAt</span> <a href="../icode/analysis/CopyPropagation.scala.html#223069" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.LocalVar">LocalVar</a><span class="delimiter">(</span><a href="#251969" title="ClosureElimination.this.global.icodes.Local">l</a><span class="delimiter">)</span> =&gt;
              <span class="keyword">val</span> <a title="ClosureElimination.this.global.copyPropagation.Value" id="251984">t</a> = <a href="#251921" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#223480" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.Value">getBinding</a><span class="delimiter">(</span><a href="#251969" title="ClosureElimination.this.global.icodes.Local">l</a><span class="delimiter">)</span>
              <a href="#251984" title="ClosureElimination.this.global.copyPropagation.Value">t</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <span title="Unit">Deref</span><span class="delimiter">(</span>LocalVar<span class="delimiter">(</span>_<span class="delimiter">)</span><span class="delimiter">)</span> | Deref<span class="delimiter">(</span><a href="../icode/analysis/CopyPropagation.scala.html#107155" title="object ClosureElimination.this.global.copyPropagation.This">This</a><span class="delimiter">)</span> | Const<span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;
                  <a href="#251920" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a>.<a href="../icode/BasicBlocks.scala.html#197657" title="(oldInstr: ClosureElimination.this.global.icodes.Instruction, newInstr: ClosureElimination.this.global.icodes.Instruction)Boolean">replaceInstruction</a><span class="delimiter">(</span><a href="#251967" title="ClosureElimination.this.global.icodes.Instruction">i</a>, <a href="#251837" title="(v: ClosureElimination.this.global.copyPropagation.Value)ClosureElimination.this.global.icodes.Instruction">valueToInstruction</a><span class="delimiter">(</span><a href="#251984" title="ClosureElimination.this.global.copyPropagation.Value">t</a><span class="delimiter">)</span><span class="delimiter">)</span>;
                  <a href="../../Global.scala.html#64872" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;replaced &quot;)" class="string">&quot;replaced &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#251967" title="ClosureElimination.this.global.icodes.Instruction">i</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; with &quot;)" class="string">&quot; with &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#251984" title="ClosureElimination.this.global.copyPropagation.Value">t</a><span class="delimiter">)</span>

                <span class="keyword">case</span> <span title="Unit">_</span> =&gt; 
                  <a href="#251920" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a>.<a href="../icode/BasicBlocks.scala.html#197657" title="(oldInstr: ClosureElimination.this.global.icodes.Instruction, newInstr: ClosureElimination.this.global.icodes.Instruction)Boolean">replaceInstruction</a><span class="delimiter">(</span><a href="#251967" title="ClosureElimination.this.global.icodes.Instruction">i</a>, <a href="../icode/Opcodes.scala.html#206409" title="(local: ClosureElimination.this.global.icodes.Local)ClosureElimination.this.global.icodes.opcodes.LOAD_LOCAL">LOAD_LOCAL</a><span class="delimiter">(</span><a href="#251921" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#223479" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.global.icodes.Local">getAlias</a><span class="delimiter">(</span><a href="#251969" title="ClosureElimination.this.global.icodes.Local">l</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                  <a href="../../Global.scala.html#64872" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;replaced &quot;)" class="string">&quot;replaced &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#251967" title="ClosureElimination.this.global.icodes.Instruction">i</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; with &quot;)" class="string">&quot; with &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#251921" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#223479" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.global.icodes.Local">getAlias</a><span class="delimiter">(</span><a href="#251969" title="ClosureElimination.this.global.icodes.Local">l</a><span class="delimiter">)</span><span class="delimiter">)</span>

              <span class="delimiter">}</span>

            <span class="keyword">case</span> <span title="Unit">LOAD_FIELD</span><span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.global.Symbol" id="252017">f</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span> <span class="comment">/* if accessible(f, m.symbol) */</span> =&gt;
              <span class="keyword">def</span> <a title="(r: ClosureElimination.this.global.copyPropagation.Record)Unit" id="252018">replaceFieldAccess</a><span class="delimiter">(</span><a title="ClosureElimination.this.global.copyPropagation.Record" id="252019">r</a>: <a href="../icode/analysis/CopyPropagation.scala.html#107158" title="ClosureElimination.this.global.copyPropagation.Record">Record</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">val</span> Record<a href="#252021" title="(ClosureElimination.this.global.copyPropagation.global.Symbol, scala.collection.mutable.Map[ClosureElimination.this.global.copyPropagation.global.Symbol,ClosureElimination.this.global.copyPropagation.Value])" class="delimiter">(</a><a href="#252020" title="ClosureElimination.this.global.copyPropagation.global.Symbol" id="252021">cls</a>, <a href="#252020" title="scala.collection.mutable.Map[ClosureElimination.this.global.copyPropagation.global.Symbol,ClosureElimination.this.global.copyPropagation.Value]" id="252022">bindings</a><span class="delimiter">)</span> = <a href="#252019" title="ClosureElimination.this.global.copyPropagation.Record">r</a>
                <a href="#251921" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#223483" title="(r: ClosureElimination.this.global.copyPropagation.Record, f: ClosureElimination.this.global.copyPropagation.global.Symbol)Option[ClosureElimination.this.global.copyPropagation.Value]">getFieldNonRecordValue</a><span class="delimiter">(</span><a href="#252019" title="ClosureElimination.this.global.copyPropagation.Record">r</a>, <a href="#252017" title="ClosureElimination.this.global.icodes.global.Symbol">f</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
                	<span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="ClosureElimination.this.global.copyPropagation.Value" id="252040">v</a><span class="delimiter">)</span> =&gt;
                		<a href="#251920" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a>.<a href="../icode/BasicBlocks.scala.html#197658" title="(oldInstr: ClosureElimination.this.global.icodes.Instruction, is: List[ClosureElimination.this.global.icodes.Instruction])Boolean">replaceInstruction</a><span class="delimiter">(</span><a href="#251967" title="ClosureElimination.this.global.icodes.Instruction">i</a>, 
                				<a href="../icode/Opcodes.scala.html#206820" title="(typ: ClosureElimination.this.global.icodes.TypeKind)ClosureElimination.this.global.icodes.opcodes.DROP">DROP</a><span class="delimiter">(</span><a href="../icode/TypeKinds.scala.html#196332" title="(cls: ClosureElimination.this.global.icodes.global.Symbol)ClosureElimination.this.global.icodes.REFERENCE">REFERENCE</a><span class="delimiter">(</span><a href="#252021" title="ClosureElimination.this.global.copyPropagation.global.Symbol">cls</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#252045" title="(x: ClosureElimination.this.global.icodes.Instruction)List[ClosureElimination.this.global.icodes.Instruction]">::</a> <a href="#251837" title="(v: ClosureElimination.this.global.copyPropagation.Value)ClosureElimination.this.global.icodes.Instruction">valueToInstruction</a><span class="delimiter">(</span><a href="#252040" title="ClosureElimination.this.global.copyPropagation.Value">v</a><span class="delimiter">)</span> <a href="#252048" title="(x: ClosureElimination.this.global.icodes.Instruction)List[ClosureElimination.this.global.icodes.Instruction]">::</a> <span title="object Nil">Nil</span><span class="delimiter">)</span>;
                		<a href="../../Global.scala.html#64872" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Replaced &quot;)" class="string">&quot;Replaced &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#251967" title="ClosureElimination.this.global.icodes.Instruction">i</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; with &quot;)" class="string">&quot; with &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#251921" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#223483" title="(r: ClosureElimination.this.global.copyPropagation.Record, f: ClosureElimination.this.global.copyPropagation.global.Symbol)Option[ClosureElimination.this.global.copyPropagation.Value]">getFieldNonRecordValue</a><span class="delimiter">(</span><a href="#252019" title="ClosureElimination.this.global.copyPropagation.Record">r</a>, <a href="#252017" title="ClosureElimination.this.global.icodes.global.Symbol">f</a><span class="delimiter">)</span><span class="delimiter">)</span>;
                	<span class="keyword">case</span> <span title="Unit">None</span> =&gt;
                <span class="delimiter">}</span>
              <span class="delimiter">}</span>

              <a href="#251921" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#223473" title="(n: Int)ClosureElimination.this.global.copyPropagation.Value">stack</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <a title="Unit" id="252069">r</a> @ Record<span class="delimiter">(</span>_, <a title="scala.collection.mutable.Map[ClosureElimination.this.global.copyPropagation.global.Symbol,ClosureElimination.this.global.copyPropagation.Value]" id="252072">bindings</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#252072" title="scala.collection.mutable.Map[ClosureElimination.this.global.copyPropagation.global.Symbol,ClosureElimination.this.global.copyPropagation.Value]">bindings</a> <span title="(key: ClosureElimination.this.global.copyPropagation.global.Symbol)Boolean">isDefinedAt</span> <a href="#252017" title="ClosureElimination.this.global.icodes.global.Symbol">f</a> =&gt;
                  <a href="#252018" title="(r: ClosureElimination.this.global.copyPropagation.Record)Unit">replaceFieldAccess</a><span class="delimiter">(</span><a href="#252069" title="ClosureElimination.this.global.copyPropagation.Record">r</a><span class="delimiter">)</span>

                <span class="keyword">case</span> <span title="Unit">Deref</span><span class="delimiter">(</span>LocalVar<span class="delimiter">(</span><a title="ClosureElimination.this.global.copyPropagation.global.icodes.Local" id="252077">l</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
                  <a href="#251921" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#223480" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.Value">getBinding</a><span class="delimiter">(</span><a href="#252077" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">l</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
                    <span class="keyword">case</span> <a title="Unit" id="252080">r</a> @ Record<span class="delimiter">(</span>_, <a title="scala.collection.mutable.Map[ClosureElimination.this.global.copyPropagation.global.Symbol,ClosureElimination.this.global.copyPropagation.Value]" id="252083">bindings</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#252083" title="scala.collection.mutable.Map[ClosureElimination.this.global.copyPropagation.global.Symbol,ClosureElimination.this.global.copyPropagation.Value]">bindings</a> <span title="(key: ClosureElimination.this.global.copyPropagation.global.Symbol)Boolean">isDefinedAt</span> <a href="#252017" title="ClosureElimination.this.global.icodes.global.Symbol">f</a> =&gt;
                      <a href="#252018" title="(r: ClosureElimination.this.global.copyPropagation.Record)Unit">replaceFieldAccess</a><span class="delimiter">(</span><a href="#252080" title="ClosureElimination.this.global.copyPropagation.Record">r</a><span class="delimiter">)</span>
                    <span class="keyword">case</span> <span title="Unit">_</span> =&gt; 
                  <span class="delimiter">}</span>
                <span class="keyword">case</span> <span title="Unit">Deref</span><span class="delimiter">(</span>Field<span class="delimiter">(</span><a title="ClosureElimination.this.global.copyPropagation.Record" id="252089">r1</a>, <a title="ClosureElimination.this.global.copyPropagation.global.Symbol" id="252090">f1</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
                  <a href="#251921" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#223482" title="(r: ClosureElimination.this.global.copyPropagation.Record, f: ClosureElimination.this.global.copyPropagation.global.Symbol)Option[ClosureElimination.this.global.copyPropagation.Value]">getFieldValue</a><span class="delimiter">(</span><a href="#252089" title="ClosureElimination.this.global.copyPropagation.Record">r1</a>, <a href="#252090" title="ClosureElimination.this.global.copyPropagation.global.Symbol">f1</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
                    <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="ClosureElimination.this.global.copyPropagation.Record" id="252094">r</a> @ Record<span class="delimiter">(</span>_, <a title="scala.collection.mutable.Map[ClosureElimination.this.global.copyPropagation.global.Symbol,ClosureElimination.this.global.copyPropagation.Value]" id="252097">bindings</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#252097" title="scala.collection.mutable.Map[ClosureElimination.this.global.copyPropagation.global.Symbol,ClosureElimination.this.global.copyPropagation.Value]">bindings</a> <span title="(key: ClosureElimination.this.global.copyPropagation.global.Symbol)Boolean">isDefinedAt</span> <a href="#252017" title="ClosureElimination.this.global.icodes.global.Symbol">f</a> =&gt;
                      <a href="#252018" title="(r: ClosureElimination.this.global.copyPropagation.Record)Unit">replaceFieldAccess</a><span class="delimiter">(</span><a href="#252094" title="ClosureElimination.this.global.copyPropagation.Record">r</a><span class="delimiter">)</span>
                    <span class="keyword">case</span> <span title="Unit">_</span> =&gt; 
                  <span class="delimiter">}</span>

                <span class="keyword">case</span> <span title="Unit">_</span> =&gt; 
              <span class="delimiter">}</span>

            <span class="keyword">case</span> <span title="Unit">UNBOX</span><span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;
              <a href="#251921" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#223473" title="=&gt; List[ClosureElimination.this.global.copyPropagation.Value]">stack</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <span title="Unit">Deref</span><span class="delimiter">(</span>LocalVar<span class="delimiter">(</span><a title="ClosureElimination.this.global.copyPropagation.global.icodes.Local" id="252107">loc1</a><span class="delimiter">)</span><span class="delimiter">)</span> :: _ <span class="keyword">if</span> <a href="#251921" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#223471" title="=&gt; ClosureElim.this.cpp.lattice.Bindings">bindings</a> <span title="(key: ClosureElimination.this.global.copyPropagation.Location)Boolean">isDefinedAt</span> <a href="../icode/analysis/CopyPropagation.scala.html#223069" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.LocalVar">LocalVar</a><span class="delimiter">(</span><a href="#252107" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">loc1</a><span class="delimiter">)</span> =&gt;
                  <span class="keyword">val</span> <a title="ClosureElimination.this.global.copyPropagation.Value" id="252113">value</a> = <a href="#251921" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#223480" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.Value">getBinding</a><span class="delimiter">(</span><a href="#252107" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">loc1</a><span class="delimiter">)</span>
                  <a href="#252113" title="ClosureElimination.this.global.copyPropagation.Value">value</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
                    <span class="keyword">case</span> <span title="Unit">Boxed</span><span class="delimiter">(</span>LocalVar<span class="delimiter">(</span><a title="ClosureElimination.this.global.copyPropagation.global.icodes.Local" id="252118">loc2</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
                      <a href="#251920" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a>.<a href="../icode/BasicBlocks.scala.html#197658" title="(oldInstr: ClosureElimination.this.global.icodes.Instruction, is: List[ClosureElimination.this.global.icodes.Instruction])Boolean">replaceInstruction</a><span class="delimiter">(</span><a href="#251967" title="ClosureElimination.this.global.icodes.Instruction">i</a>, <a href="../icode/Opcodes.scala.html#206820" title="(typ: ClosureElimination.this.global.icodes.TypeKind)ClosureElimination.this.global.icodes.opcodes.DROP">DROP</a><span class="delimiter">(</span><a href="../../Global.scala.html#64836" title="object ClosureElimination.this.global.icodes">icodes</a>.<a href="../icode/ICodes.scala.html#96942" title="=&gt; ClosureElimination.this.global.icodes.TypeKind">ObjectReference</a><span class="delimiter">)</span> <a href="#252123" title="(x: ClosureElimination.this.global.icodes.Instruction)List[ClosureElimination.this.global.icodes.Instruction]">::</a> <a href="#251837" title="(v: ClosureElimination.this.global.copyPropagation.Value)ClosureElimination.this.global.icodes.Instruction">valueToInstruction</a><span class="delimiter">(</span><a href="#251921" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#223480" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.Value">getBinding</a><span class="delimiter">(</span><a href="#252118" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">loc2</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#252125" title="(x: ClosureElimination.this.global.icodes.Instruction)List[ClosureElimination.this.global.icodes.Instruction]">::</a> <span title="object Nil">Nil</span><span class="delimiter">)</span>
                      <a href="../../Global.scala.html#64872" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;replaced &quot;)" class="string">&quot;replaced &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#251967" title="ClosureElimination.this.global.icodes.Instruction">i</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; with &quot;)" class="string">&quot; with &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#251921" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#223480" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.Value">getBinding</a><span class="delimiter">(</span><a href="#252118" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">loc2</a><span class="delimiter">)</span><span class="delimiter">)</span>
                    <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
                      <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
                  <span class="delimiter">}</span>
                <span class="keyword">case</span> <span title="Unit">Boxed</span><span class="delimiter">(</span>LocalVar<span class="delimiter">(</span><a title="ClosureElimination.this.global.copyPropagation.global.icodes.Local" id="252146">loc1</a><span class="delimiter">)</span><span class="delimiter">)</span> :: _ =&gt;
                  <span class="keyword">val</span> <a title="ClosureElimination.this.global.copyPropagation.global.icodes.Local" id="252147">loc2</a> = <a href="#251921" title="ClosureElim.this.cpp.lattice.Elem">info</a>.<a href="../icode/analysis/CopyPropagation.scala.html#223479" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.global.icodes.Local">getAlias</a><span class="delimiter">(</span><a href="#252146" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">loc1</a><span class="delimiter">)</span>
                  <a href="#251920" title="ClosureElimination.this.global.icodes.BasicBlock">bb</a>.<a href="../icode/BasicBlocks.scala.html#197658" title="(oldInstr: ClosureElimination.this.global.icodes.Instruction, is: List[ClosureElimination.this.global.icodes.Instruction])Boolean">replaceInstruction</a><span class="delimiter">(</span><a href="#251967" title="ClosureElimination.this.global.icodes.Instruction">i</a>, <a href="../icode/Opcodes.scala.html#206820" title="(typ: ClosureElimination.this.global.icodes.TypeKind)ClosureElimination.this.global.icodes.opcodes.DROP">DROP</a><span class="delimiter">(</span><a href="../../Global.scala.html#64836" title="object ClosureElimination.this.global.icodes">icodes</a>.<a href="../icode/ICodes.scala.html#96942" title="=&gt; ClosureElimination.this.global.icodes.TypeKind">ObjectReference</a><span class="delimiter">)</span> <a href="#252152" title="(x: ClosureElimination.this.global.icodes.Instruction)List[ClosureElimination.this.global.icodes.Instruction]">::</a> <a href="#251837" title="(v: ClosureElimination.this.global.copyPropagation.Value)ClosureElimination.this.global.icodes.Instruction">valueToInstruction</a><span class="delimiter">(</span><a href="../icode/analysis/CopyPropagation.scala.html#223294" title="(l: ClosureElimination.this.global.copyPropagation.Location)ClosureElimination.this.global.copyPropagation.Deref">Deref</a><span class="delimiter">(</span><a href="../icode/analysis/CopyPropagation.scala.html#223069" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.LocalVar">LocalVar</a><span class="delimiter">(</span><a href="#252147" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">loc2</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#252153" title="(x: ClosureElimination.this.global.icodes.Instruction)List[ClosureElimination.this.global.icodes.Instruction]">::</a> <span title="object Nil">Nil</span><span class="delimiter">)</span>
                  <a href="../../Global.scala.html#64872" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;replaced &quot;)" class="string">&quot;replaced &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#251967" title="ClosureElimination.this.global.icodes.Instruction">i</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; with &quot;)" class="string">&quot; with &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="../icode/analysis/CopyPropagation.scala.html#223069" title="(l: ClosureElimination.this.global.copyPropagation.global.icodes.Local)ClosureElimination.this.global.copyPropagation.LocalVar">LocalVar</a><span class="delimiter">(</span><a href="#252147" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">loc2</a><span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
              <span class="delimiter">}</span>

            <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
          <span class="delimiter">}</span>
          <a href="#251921" title="ClosureElim.this.cpp.lattice.Elem">info</a> = <a href="#251833" title="=&gt; ClosureElimination.this.global.copyPropagation.CopyAnalysis">cpp</a>.<a href="../icode/analysis/CopyPropagation.scala.html#223940" title="(in: ClosureElimination.this.global.copyPropagation.copyLattice.Elem, i: ClosureElimination.this.global.copyPropagation.global.icodes.Instruction)ClosureElimination.this.global.copyPropagation.copyLattice.Elem">interpret</a><span class="delimiter">(</span><a href="#251921" title="ClosureElim.this.cpp.lattice.Elem">info</a>, <a href="#251967" title="ClosureElimination.this.global.icodes.Instruction">i</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span><span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Unit" id="252171">e</a>: <a href="../icode/analysis/LubException.scala.html#14651" title="scala.tools.nsc.backend.icode.analysis.LubException">LubException</a> =&gt; 
        <span title="object Console">Console</span>.<span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;In method: &quot;)" class="string">&quot;In method: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#251884" title="ClosureElimination.this.global.icodes.IMethod">m</a><span class="delimiter">)</span>
        <span title="object Console">Console</span>.<span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="#252171" title="scala.tools.nsc.backend.icode.analysis.LubException">e</a><span class="delimiter">)</span>
        <a href="#252171" title="scala.tools.nsc.backend.icode.analysis.LubException">e</a>.<span title="()Unit">printStackTrace</span>
    <span class="delimiter">}</span>

    <span class="comment">/* Partial mapping from values to instructions that load them. */</span>
    <span class="keyword">def</span> <a title="(v: ClosureElimination.this.global.copyPropagation.Value)ClosureElimination.this.global.icodes.Instruction" id="251837">valueToInstruction</a><span class="delimiter">(</span><a title="ClosureElimination.this.global.copyPropagation.Value" id="252006">v</a>: <a href="../icode/analysis/CopyPropagation.scala.html#107157" title="ClosureElimination.this.global.copyPropagation.Value">Value</a><span class="delimiter">)</span>: <a href="../icode/Opcodes.scala.html#96974" title="ClosureElimination.this.global.icodes.Instruction">Instruction</a> = <span class="delimiter">(</span><a href="#252006" title="ClosureElimination.this.global.copyPropagation.Value">v</a>: @<a href="../icode/analysis/CopyPropagation.scala.html#107157" title="ClosureElimination.this.global.copyPropagation.Value @unchecked">unchecked</a><span class="delimiter">)</span> <span title="ClosureElimination.this.global.icodes.Instruction" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="ClosureElimination.this.global.icodes.opcodes.LOAD_LOCAL">Deref</span><span class="delimiter">(</span>LocalVar<span class="delimiter">(</span><a title="ClosureElimination.this.global.copyPropagation.global.icodes.Local" id="252180">v</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; 
        <a href="../icode/Opcodes.scala.html#206409" title="(local: ClosureElimination.this.global.icodes.Local)ClosureElimination.this.global.icodes.opcodes.LOAD_LOCAL">LOAD_LOCAL</a><span class="delimiter">(</span><a href="#252180" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">v</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="ClosureElimination.this.global.icodes.opcodes.CONSTANT">Const</span><span class="delimiter">(</span><a title="ClosureElimination.this.global.copyPropagation.global.Constant" id="252183">k</a><span class="delimiter">)</span> =&gt;
        <a href="../icode/Opcodes.scala.html#206980" title="(constant: ClosureElimination.this.global.icodes.global.Constant)ClosureElimination.this.global.icodes.opcodes.CONSTANT">CONSTANT</a><span class="delimiter">(</span><a href="#252183" title="ClosureElimination.this.global.copyPropagation.global.Constant">k</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="ClosureElimination.this.global.icodes.opcodes.THIS">Deref</span><span class="delimiter">(</span><a href="../icode/analysis/CopyPropagation.scala.html#107155" title="object ClosureElimination.this.global.copyPropagation.This">This</a><span class="delimiter">)</span> =&gt;
        <a href="../icode/Opcodes.scala.html#208416" title="(clasz: ClosureElimination.this.global.icodes.global.Symbol)ClosureElimination.this.global.icodes.opcodes.THIS">THIS</a><span class="delimiter">(</span><a href="../../symtab/Definitions.scala.html#67688" title="object ClosureElimination.this.global.definitions">definitions</a>.<a href="../../symtab/Definitions.scala.html#106079" title="=&gt; ClosureElimination.this.global.Symbol">ObjectClass</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="ClosureElimination.this.global.icodes.opcodes.LOAD_LOCAL">Boxed</span><span class="delimiter">(</span>LocalVar<span class="delimiter">(</span><a title="ClosureElimination.this.global.copyPropagation.global.icodes.Local" id="252192">v</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
        <a href="../icode/Opcodes.scala.html#206409" title="(local: ClosureElimination.this.global.icodes.Local)ClosureElimination.this.global.icodes.opcodes.LOAD_LOCAL">LOAD_LOCAL</a><span class="delimiter">(</span><a href="#252192" title="ClosureElimination.this.global.copyPropagation.global.icodes.Local">v</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="comment">/** is field 'f' accessible from method 'm'? */</span>
    <span class="keyword">def</span> <a title="(f: ClosureElimination.this.global.Symbol, m: ClosureElimination.this.global.Symbol)Boolean" id="251838">accessible</a><span class="delimiter">(</span><a title="ClosureElimination.this.global.Symbol" id="252194">f</a>: <a href="../../symtab/Symbols.scala.html#67320" title="ClosureElimination.this.global.Symbol">Symbol</a>, <a title="ClosureElimination.this.global.Symbol" id="252195">m</a>: <a href="../../symtab/Symbols.scala.html#67320" title="ClosureElimination.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = 
      <a href="#252194" title="ClosureElimination.this.global.Symbol">f</a>.<span title="=&gt; Boolean">isPublic</span> <span title="(x: Boolean)Boolean">||</span> <span class="delimiter">(</span><a href="#252194" title="ClosureElimination.this.global.Symbol">f</a>.<span title="=&gt; Boolean">isProtected</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span class="delimiter">(</span><a href="#252194" title="ClosureElimination.this.global.Symbol">f</a>.<a href="../../symtab/Symbols.scala.html#107473" title="=&gt; ClosureElimination.this.global.Symbol">enclosingPackageClass</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#252195" title="ClosureElimination.this.global.Symbol">m</a>.<a href="../../symtab/Symbols.scala.html#107473" title="=&gt; ClosureElimination.this.global.Symbol">enclosingPackageClass</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span> <span class="comment">/* class ClosureElim */</span>


  <span class="comment">/** Peephole optimization. */</span>
  <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class PeepholeOpt extends java.lang.Object with ScalaObject" id="112127">PeepholeOpt</a> <a href="#112127" title="ScalaObject" class="delimiter">{</a>

    <span class="keyword">private</span> <span class="keyword">var</span> <a title="ClosureElimination.this.global.icodes.IMethod" id="251573">method</a>: <a href="../icode/Members.scala.html#96963" title="ClosureElimination.this.global.icodes.IMethod">IMethod</a> = <span title="Null(null)" class="keyword">null</span>

    <span class="comment">/** Concrete implementations will perform their optimizations here */</span>
    <span class="keyword">def</span> <a title="(bb: ClosureElimination.this.global.icodes.BasicBlock, i1: ClosureElimination.this.global.icodes.Instruction, i2: ClosureElimination.this.global.icodes.Instruction)Option[List[ClosureElimination.this.global.icodes.Instruction]]" id="251575">peep</a><span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.BasicBlock" id="251586">bb</a>: <a href="../icode/BasicBlocks.scala.html#96970" title="ClosureElimination.this.global.icodes.BasicBlock">BasicBlock</a>, <a title="ClosureElimination.this.global.icodes.Instruction" id="251587">i1</a>: <a href="../icode/Opcodes.scala.html#96974" title="ClosureElimination.this.global.icodes.Instruction">Instruction</a>, <a title="ClosureElimination.this.global.icodes.Instruction" id="251588">i2</a>: <a href="../icode/Opcodes.scala.html#96974" title="ClosureElimination.this.global.icodes.Instruction">Instruction</a><span class="delimiter">)</span>: <span title="Option[List[ClosureElimination.this.global.icodes.Instruction]]">Option</span><span class="delimiter">[</span>List<span class="delimiter">[</span>Instruction<span class="delimiter">]</span><span class="delimiter">]</span>

    <span class="keyword">var</span> <a title="ClosureElimination.this.global.icodes.liveness.LivenessAnalysis" id="251577">liveness</a>: global.icodes.liveness.<a href="../icode/analysis/Liveness.scala.html#215431" title="ClosureElimination.this.global.icodes.liveness.LivenessAnalysis">LivenessAnalysis</a> = <span title="Null(null)" class="keyword">null</span>

    <span class="keyword">def</span> <a title="(m: ClosureElimination.this.global.icodes.IMethod)Unit" id="251579">apply</a><span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.IMethod" id="251886">m</a>: <a href="../icode/Members.scala.html#96963" title="ClosureElimination.this.global.icodes.IMethod">IMethod</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#251886" title="ClosureElimination.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197727" title="=&gt; ClosureElimination.this.global.icodes.Code">code</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#251573" title="(x$1: ClosureElimination.this.global.icodes.IMethod)Unit">method</a> = <a href="#251886" title="ClosureElimination.this.global.icodes.IMethod">m</a>
      <a href="#251577" title="(x$1: ClosureElimination.this.global.icodes.liveness.LivenessAnalysis)Unit">liveness</a> = <span title="ClosureElimination.this.global.icodes.liveness.LivenessAnalysis" class="keyword">new</span> <a href="../../SubComponent.scala.html#95918" title="=&gt; scala.tools.nsc.Global">global</a>.<a href="../../Global.scala.html#64836" title="object ClosureElimination.this.global.icodes">icodes</a>.<a href="../icode/ICodes.scala.html#96930" title="object ClosureElimination.this.global.icodes.liveness">liveness</a>.<a href="../icode/analysis/Liveness.scala.html#215431" title="ClosureElimination.this.global.icodes.liveness.LivenessAnalysis">LivenessAnalysis</a>
      <a href="#251577" title="=&gt; ClosureElimination.this.global.icodes.liveness.LivenessAnalysis">liveness</a>.<a href="../icode/analysis/Liveness.scala.html#225874" title="(m: ClosureElimination.this.global.icodes.liveness.global.icodes.IMethod)Unit">init</a><span class="delimiter">(</span><a href="#251886" title="ClosureElimination.this.global.icodes.IMethod">m</a><span class="delimiter">)</span>
      <a href="#251577" title="=&gt; ClosureElimination.this.global.icodes.liveness.LivenessAnalysis">liveness</a>.<a href="../icode/analysis/Liveness.scala.html#225877" title="()Unit">run</a>
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.BasicBlock" id="252246">b</a> &lt;- <a href="#251886" title="ClosureElimination.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#197727" title="=&gt; ClosureElimination.this.global.icodes.Code">code</a>.<a href="../icode/Members.scala.html#197800" title="(f: ClosureElimination.this.global.icodes.BasicBlock =&gt; Unit)Unit">blocks</a><span class="delimiter">)</span> 
        <a href="#251580" title="(b: ClosureElimination.this.global.icodes.BasicBlock)Unit">transformBlock</a><span class="delimiter">(</span><a href="#252246" title="ClosureElimination.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(b: ClosureElimination.this.global.icodes.BasicBlock)Unit" id="251580">transformBlock</a><span class="delimiter">(</span><a title="ClosureElimination.this.global.icodes.BasicBlock" id="252247">b</a>: <a href="../icode/BasicBlocks.scala.html#96970" title="ClosureElimination.this.global.icodes.BasicBlock">BasicBlock</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#252247" title="ClosureElimination.this.global.icodes.BasicBlock">b</a>.<span title="=&gt; Int">size</span> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">var</span> <a title="List[ClosureElimination.this.global.icodes.Instruction]" id="252254">newInstructions</a>: <span title="List[ClosureElimination.this.global.icodes.Instruction]">List</span><span class="delimiter">[</span>Instruction<span class="delimiter">]</span> = <span title="object Nil">Nil</span>

      <a href="#252254" title="List[ClosureElimination.this.global.icodes.Instruction]">newInstructions</a> = <a href="#252247" title="ClosureElimination.this.global.icodes.BasicBlock">b</a>.<a href="../icode/BasicBlocks.scala.html#197646" title="=&gt; List[ClosureElimination.this.global.icodes.Instruction]">toList</a>

      <span class="keyword">var</span> <a title="Boolean" id="252255">redo</a> = <span title="Boolean(false)" class="keyword">false</span>
      <a href="#252256" title="Unit" class="keyword">do</a> <span class="delimiter">{</span>
        <span class="keyword">var</span> <a title="ClosureElimination.this.global.icodes.Instruction" id="252257">h</a> = <a href="#252254" title="List[ClosureElimination.this.global.icodes.Instruction]">newInstructions</a>.<span title="=&gt; ClosureElimination.this.global.icodes.Instruction">head</span>
        <span class="keyword">var</span> <a title="List[ClosureElimination.this.global.icodes.Instruction]" id="252258">t</a> = <a href="#252254" title="List[ClosureElimination.this.global.icodes.Instruction]">newInstructions</a>.<span title="=&gt; List[ClosureElimination.this.global.icodes.Instruction]">tail</span>
        <span class="keyword">var</span> <a title="List[ClosureElimination.this.global.icodes.Instruction]" id="252259">seen</a>: <span title="List[ClosureElimination.this.global.icodes.Instruction]">List</span><span class="delimiter">[</span>Instruction<span class="delimiter">]</span> = <span title="object Nil">Nil</span>
        <a href="#252255" title="Boolean">redo</a> = <span title="Boolean(false)" class="keyword">false</span>

        <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#252258" title="List[ClosureElimination.this.global.icodes.Instruction]">t</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="object Nil">Nil</span><span class="delimiter">)</span> <a href="#252264" title="()Unit" class="delimiter">{</a>
          <a href="#251575" title="(bb: ClosureElimination.this.global.icodes.BasicBlock, i1: ClosureElimination.this.global.icodes.Instruction, i2: ClosureElimination.this.global.icodes.Instruction)Option[List[ClosureElimination.this.global.icodes.Instruction]]">peep</a><span class="delimiter">(</span><a href="#252247" title="ClosureElimination.this.global.icodes.BasicBlock">b</a>, <a href="#252257" title="ClosureElimination.this.global.icodes.Instruction">h</a>, <a href="#252258" title="List[ClosureElimination.this.global.icodes.Instruction]">t</a>.<span title="=&gt; ClosureElimination.this.global.icodes.Instruction">head</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="List[ClosureElimination.this.global.icodes.Instruction]" id="252272">newInstrs</a><span class="delimiter">)</span> =&gt;
              <a href="#252254" title="List[ClosureElimination.this.global.icodes.Instruction]">newInstructions</a> = <a href="#252259" title="List[ClosureElimination.this.global.icodes.Instruction]">seen</a>.<span title="=&gt; List[ClosureElimination.this.global.icodes.Instruction]">reverse</span> <a href="#252273" title="(prefix: List[ClosureElimination.this.global.icodes.Instruction])List[ClosureElimination.this.global.icodes.Instruction]">:::</a> <a href="#252272" title="List[ClosureElimination.this.global.icodes.Instruction]">newInstrs</a> <a href="#252275" title="(prefix: List[ClosureElimination.this.global.icodes.Instruction])List[ClosureElimination.this.global.icodes.Instruction]">:::</a> <a href="#252258" title="List[ClosureElimination.this.global.icodes.Instruction]">t</a>.<span title="=&gt; List[ClosureElimination.this.global.icodes.Instruction]">tail</span>;
              <a href="#252255" title="Boolean">redo</a> = <span title="Boolean(true)" class="keyword">true</span>
            <span class="keyword">case</span> <span title="Unit">None</span> =&gt;
            	<span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <a href="#252259" title="List[ClosureElimination.this.global.icodes.Instruction]">seen</a> = <a href="#252257" title="ClosureElimination.this.global.icodes.Instruction">h</a> <a href="#252289" title="(x: ClosureElimination.this.global.icodes.Instruction)List[ClosureElimination.this.global.icodes.Instruction]">::</a> <a href="#252259" title="List[ClosureElimination.this.global.icodes.Instruction]">seen</a>
          <a href="#252257" title="ClosureElimination.this.global.icodes.Instruction">h</a> = <a href="#252258" title="List[ClosureElimination.this.global.icodes.Instruction]">t</a>.<span title="=&gt; ClosureElimination.this.global.icodes.Instruction">head</span>
          <a href="#252258" title="List[ClosureElimination.this.global.icodes.Instruction]">t</a> = <a href="#252258" title="List[ClosureElimination.this.global.icodes.Instruction]">t</a>.<span title="=&gt; List[ClosureElimination.this.global.icodes.Instruction]">tail</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> <span class="keyword">while</span> <span class="delimiter">(</span><a href="#252255" title="Boolean">redo</a><span class="delimiter">)</span>;
      <a href="#252247" title="ClosureElimination.this.global.icodes.BasicBlock">b</a> <a href="../icode/BasicBlocks.scala.html#197649" title="(is: List[ClosureElimination.this.global.icodes.Instruction])Unit">fromList</a> <a href="#252254" title="List[ClosureElimination.this.global.icodes.Instruction]">newInstructions</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

<span class="delimiter">}</span> <span class="comment">/* class ClosureElimination */</span>

        </pre>
    </body>
</html>
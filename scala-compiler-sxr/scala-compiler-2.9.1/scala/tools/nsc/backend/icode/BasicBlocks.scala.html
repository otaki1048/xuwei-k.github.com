<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/backend/icode/BasicBlocks.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* NSC -- new Scala compiler
 * Copyright 2005-2011 LAMP/EPFL
 * @author  Martin Odersky
 */</span>


<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> backend
<span class="keyword">package</span> icode

<span class="keyword">import</span> scala.collection.<span class="delimiter">{</span> mutable, immutable <span class="delimiter">}</span>
<span class="keyword">import</span> mutable.<span class="delimiter">{</span> ArrayBuffer <span class="delimiter">}</span>
<span class="keyword">import</span> util.<span class="delimiter">{</span> Position, NoPosition <span class="delimiter">}</span>
<span class="keyword">import</span> backend.icode.analysis.ProgramPoint

<span class="keyword">trait</span> <a title="trait BasicBlocks extends java.lang.Object with ScalaObject" id="13473">BasicBlocks</a> <span title="ScalaObject" class="delimiter">{</span>
  self: ICodes =&gt;
  
  <span class="keyword">import</span> <a href="Opcodes.scala.html#96975" title="object BasicBlocks.this.opcodes">opcodes</a>._
  <span class="keyword">import</span> <a href="ICodes.scala.html#96917" title="=&gt; scala.tools.nsc.Global">global</a>.<span class="delimiter">{</span> settings, log, nme <span class="delimiter">}</span>
  <span class="keyword">import</span> <a href="../../symtab/StdNames.scala.html#67713" title="object BasicBlocks.this.global.nme">nme</a>.isExceptionResultName

  <span class="comment">/** This class represents a basic block. Each
   *  basic block contains a list of instructions that are
   *  either executed all, or none. No jumps
   *  to/from the &quot;middle&quot; of the basic block are allowed (modulo exceptions).
   */</span>
  <span class="keyword">class</span> <a title="class BasicBlock extends java.lang.Object with scala.tools.nsc.backend.icode.analysis.ProgramPoint[BasicBlocks.this.BasicBlock] with Seq[BasicBlocks.this.Instruction] with ScalaObject" id="96970">BasicBlock</a><a href="#96970" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="Int" id="197789">label</a>: <span title="Int">Int</span>, <span class="keyword">val</span> <a title="BasicBlocks.this.IMethod" id="197790">method</a>: <a href="Members.scala.html#96963" title="BasicBlocks.this.IMethod">IMethod</a><span class="delimiter">)</span>
        <span class="keyword">extends</span> <span title="java.lang.Object">AnyRef</span>
        <span class="keyword">with</span> <a href="analysis/ProgramPoint.scala.html#14609" title="scala.tools.nsc.backend.icode.analysis.ProgramPoint[BasicBlocks.this.BasicBlock]">ProgramPoint</a><span class="delimiter">[</span>BasicBlock<span class="delimiter">]</span>
        <span class="keyword">with</span> <span title="Seq[BasicBlocks.this.Instruction]">Seq</span><span class="delimiter">[</span>Instruction<span class="delimiter">]</span> <span class="delimiter">{</span>

    <span class="keyword">import</span> <a href="#13939" title="object scala.tools.nsc.backend.icode.BBFlags">BBFlags</a>._
    
    <span class="keyword">def</span> <a title="=&gt; BasicBlocks.this.Code" id="197617">code</a> = <a href="#197790" title="=&gt; BasicBlocks.this.IMethod">method</a>.<a href="Members.scala.html#197727" title="=&gt; BasicBlocks.this.Code">code</a>
    
    <span class="comment">/** Flags of this basic block. */</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="197619">flags</a>: <span title="Int">Int</span> = <span title="Int(0)" class="int">0</span>

    <span class="comment">/** Does this block have the given flag? */</span>
    <span class="keyword">def</span> <a title="(flag: Int)Boolean" id="197621">hasFlag</a><span class="delimiter">(</span><a title="Int" id="197820">flag</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">(</span><a href="#197619" title="=&gt; Int">flags</a> <span title="(x: Int)Int">&amp;</span> <a href="#197820" title="Int">flag</a><span class="delimiter">)</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(0)" class="int">0</span>
    
    <span class="comment">/** Set the given flag. */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(flag: Int)Unit" id="197622">setFlag</a><span class="delimiter">(</span><a title="Int" id="197831">flag</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#197619" title="(x$1: Int)Unit">flags</a> <span title="(x: Int)Int">|=</span> <a href="#197831" title="Int">flag</a>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(flag: Int)Unit" id="197623">resetFlag</a><span class="delimiter">(</span><a title="Int" id="197838">flag</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#197619" title="(x$1: Int)Unit">flags</a> <span title="(x: Int)Int">&amp;=</span> <span title="=&gt; Int">~</span><a href="#197838" title="Int">flag</a>
    <span class="delimiter">}</span>
    
    <span class="comment">/** Is this block closed? */</span>
    <span class="keyword">def</span> <a title="=&gt; Boolean" id="197624">closed</a>: <span title="Boolean">Boolean</span> = <a href="#197621" title="(flag: Int)Boolean">hasFlag</a><span class="delimiter">(</span><span title="Int(8)">CLOSED</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(b: Boolean)Unit" id="197625">closed_=</a><span class="delimiter">(</span><a title="Boolean" id="197852">b</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> = <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#197852" title="Boolean">b</a><span class="delimiter">)</span> <a href="#197622" title="(flag: Int)Unit">setFlag</a><span class="delimiter">(</span><span title="Int(8)">CLOSED</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#197623" title="(flag: Int)Unit">resetFlag</a><span class="delimiter">(</span><span title="Int(8)">CLOSED</span><span class="delimiter">)</span>
    
    <span class="comment">/** When set, the &lt;code&gt;emit&lt;/code&gt; methods will be ignored. */</span>
    <span class="keyword">def</span> <a title="=&gt; Boolean" id="197626">ignore</a>: <span title="Boolean">Boolean</span> = <a href="#197621" title="(flag: Int)Boolean">hasFlag</a><span class="delimiter">(</span><span title="Int(2)">IGNORING</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(b: Boolean)Unit" id="197627">ignore_=</a><span class="delimiter">(</span><a title="Boolean" id="197861">b</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> = <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#197861" title="Boolean">b</a><span class="delimiter">)</span> <a href="#197622" title="(flag: Int)Unit">setFlag</a><span class="delimiter">(</span><span title="Int(2)">IGNORING</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#197623" title="(flag: Int)Unit">resetFlag</a><span class="delimiter">(</span><span title="Int(2)">IGNORING</span><span class="delimiter">)</span>

    <span class="comment">/** Is this block the head of a while? */</span>
    <span class="keyword">def</span> <a title="=&gt; Boolean" id="197628">loopHeader</a> = <a href="#197621" title="(flag: Int)Boolean">hasFlag</a><span class="delimiter">(</span><span title="Int(1)">LOOP_HEADER</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(b: Boolean)Unit" id="197629">loopHeader_=</a><span class="delimiter">(</span><a title="Boolean" id="197871">b</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> = 
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#197871" title="Boolean">b</a><span class="delimiter">)</span> <a href="#197622" title="(flag: Int)Unit">setFlag</a><span class="delimiter">(</span><span title="Int(1)">LOOP_HEADER</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#197623" title="(flag: Int)Unit">resetFlag</a><span class="delimiter">(</span><span title="Int(1)">LOOP_HEADER</span><span class="delimiter">)</span>
    
    <span class="comment">/** Is this block the start block of an exception handler? */</span>
    <span class="keyword">def</span> <a title="=&gt; Boolean" id="197630">exceptionHandlerStart</a> = <a href="#197621" title="(flag: Int)Boolean">hasFlag</a><span class="delimiter">(</span><span title="Int(4)">EX_HEADER</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(b: Boolean)Unit" id="197631">exceptionHandlerStart_=</a><span class="delimiter">(</span><a title="Boolean" id="197881">b</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> = 
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#197881" title="Boolean">b</a><span class="delimiter">)</span> <a href="#197622" title="(flag: Int)Unit">setFlag</a><span class="delimiter">(</span><span title="Int(4)">EX_HEADER</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#197623" title="(flag: Int)Unit">resetFlag</a><span class="delimiter">(</span><span title="Int(4)">EX_HEADER</span><span class="delimiter">)</span>

    <span class="comment">/** Has this basic block been modified since the last call to 'successors'? */</span>
    <span class="keyword">def</span> <a title="=&gt; Boolean" id="197632">touched</a> = <a href="#197621" title="(flag: Int)Boolean">hasFlag</a><span class="delimiter">(</span><span title="Int(16)">DIRTYSUCCS</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(b: Boolean)Unit" id="197633">touched_=</a><span class="delimiter">(</span><a title="Boolean" id="197891">b</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> = <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#197891" title="Boolean">b</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#197622" title="(flag: Int)Unit">setFlag</a><span class="delimiter">(</span>DIRTYSUCCS <span title="Int(48)">|</span> DIRTYPREDS<span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#197623" title="(flag: Int)Unit">resetFlag</a><span class="delimiter">(</span>DIRTYSUCCS <span title="Int(48)">|</span> DIRTYPREDS<span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="comment">// basic blocks start in a dirty state</span>
    <a href="#197622" title="(flag: Int)Unit">setFlag</a><span class="delimiter">(</span>DIRTYSUCCS <span title="Int(48)">|</span> DIRTYPREDS<span class="delimiter">)</span>

    <span class="comment">/** Cached predecessors. */</span>
    <span class="keyword">var</span> <a title="List[BasicBlocks.this.BasicBlock]" id="197635">preds</a>: <span title="List[BasicBlocks.this.BasicBlock]">List</span><span class="delimiter">[</span>BasicBlock<span class="delimiter">]</span> = <span title="Null(null)" class="keyword">null</span>
    
    <span class="comment">/** Local variables that are in scope at entry of this basic block. Used
     *  for debugging information.
     */</span>
    <span class="keyword">var</span> <a title="scala.collection.mutable.Set[BasicBlocks.this.Local]" id="197638">varsInScope</a>: mutable.<span title="scala.collection.mutable.Set[BasicBlocks.this.Local]">Set</span><span class="delimiter">[</span>Local<span class="delimiter">]</span> = <span title="scala.collection.mutable.LinkedHashSet[BasicBlocks.this.Local]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.LinkedHashSet[BasicBlocks.this.Local]">LinkedHashSet</span><span class="delimiter">(</span><span class="delimiter">)</span>
    
    <span class="comment">/** ICode instructions, used as temporary storage while emitting code.
     * Once closed is called, only the `instrs' array should be used.
     */</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <a title="List[BasicBlocks.this.Instruction]" id="197641">instructionList</a>: <span title="List[BasicBlocks.this.Instruction]">List</span><span class="delimiter">[</span>Instruction<span class="delimiter">]</span> = <span title="object Nil">Nil</span>

    <span class="keyword">private</span> <span class="keyword">var</span> <a title="Array[BasicBlocks.this.Instruction]" id="197644">instrs</a>: <span title="Array[BasicBlocks.this.Instruction]">Array</span><span class="delimiter">[</span>Instruction<span class="delimiter">]</span> = _

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; List[BasicBlocks.this.Instruction]" id="197646">toList</a>: <span title="List[BasicBlocks.this.Instruction]">List</span><span class="delimiter">[</span>Instruction<span class="delimiter">]</span> =
      <span title="List[BasicBlocks.this.Instruction]" class="keyword">if</span> <span class="delimiter">(</span><a href="#197624" title="=&gt; Boolean">closed</a><span class="delimiter">)</span> <a href="#197644" title="(xs: Array[BasicBlocks.this.Instruction])scala.collection.mutable.ArrayOps[BasicBlocks.this.Instruction]">instrs</a>.<span title="=&gt; List[BasicBlocks.this.Instruction]">toList</span> <span class="keyword">else</span> <a href="#197641" title="=&gt; List[BasicBlocks.this.Instruction]">instructionList</a>.<span title="=&gt; List[BasicBlocks.this.Instruction]">reverse</span>
    
    <span class="comment">/** Return an iterator over the instructions in this basic block. */</span>
    <span class="keyword">def</span> <a title="=&gt; Iterator[BasicBlocks.this.Instruction]" id="197647">iterator</a>: <span title="Iterator[BasicBlocks.this.Instruction]">Iterator</span><span class="delimiter">[</span>Instruction<span class="delimiter">]</span> =
      <span title="Iterator[BasicBlocks.this.Instruction]" class="keyword">if</span> <span class="delimiter">(</span><a href="#197624" title="=&gt; Boolean">closed</a><span class="delimiter">)</span> <a href="#197644" title="(xs: Array[BasicBlocks.this.Instruction])scala.collection.mutable.ArrayOps[BasicBlocks.this.Instruction]">instrs</a>.<span title="=&gt; Iterator[BasicBlocks.this.Instruction]">iterator</span> <span class="keyword">else</span> <a href="#197641" title="=&gt; List[BasicBlocks.this.Instruction]">instructionList</a>.<span title="=&gt; List[BasicBlocks.this.Instruction]">reverse</span>.<span title="=&gt; Iterator[BasicBlocks.this.Instruction]">iterator</span>
    
    <span class="comment">/** return the underlying array of instructions */</span>
    <span class="keyword">def</span> <a title="=&gt; Array[BasicBlocks.this.Instruction]" id="197648">getArray</a>: <span title="Array[BasicBlocks.this.Instruction]">Array</span><span class="delimiter">[</span>Instruction<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span title="(assertion: Boolean)Unit">assert</span><span class="delimiter">(</span><a href="#197624" title="=&gt; Boolean">closed</a><span class="delimiter">)</span>
      <a href="#197644" title="=&gt; Array[BasicBlocks.this.Instruction]">instrs</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(is: List[BasicBlocks.this.Instruction])Unit" id="197649">fromList</a><span class="delimiter">(</span><a title="List[BasicBlocks.this.Instruction]" id="198141">is</a>: <span title="List[BasicBlocks.this.Instruction]">List</span><span class="delimiter">[</span>Instruction<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#197617" title="=&gt; BasicBlocks.this.Code">code</a>.<a href="Members.scala.html#197815" title="(b: Boolean)Unit">touched</a> = <span title="Boolean(true)" class="keyword">true</span>
      <a href="#197644" title="(x$1: Array[BasicBlocks.this.Instruction])Unit">instrs</a> = <a href="#198141" title="List[BasicBlocks.this.Instruction]">is</a>.<a href="#13473" title="(implicit evidence$1: ClassManifest[BasicBlocks.this.Instruction])Array[BasicBlocks.this.Instruction]">toArray</a>
      <a href="#197625" title="(b: Boolean)Unit">closed</a> = <span title="Boolean(true)" class="keyword">true</span>
    <span class="delimiter">}</span>

    <span class="comment">/** Return the index of inst. Uses reference equality.
     *  Returns -1 if not found.
     */</span>
    <span class="keyword">def</span> <a title="(inst: BasicBlocks.this.Instruction)Int" id="197650">indexOf</a><span class="delimiter">(</span><a title="BasicBlocks.this.Instruction" id="198167">inst</a>: <a href="Opcodes.scala.html#96974" title="BasicBlocks.this.Instruction">Instruction</a><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span title="(assertion: Boolean)Unit">assert</span><span class="delimiter">(</span><a href="#197624" title="=&gt; Boolean">closed</a><span class="delimiter">)</span>
      <a href="#197644" title="(xs: Array[BasicBlocks.this.Instruction])scala.collection.mutable.ArrayOps[BasicBlocks.this.Instruction]">instrs</a> <span title="(p: BasicBlocks.this.Instruction =&gt; Boolean)Int">indexWhere</span> <span class="delimiter">(</span><a href="#198509" title="BasicBlocks.this.Instruction">_</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="#198167" title="BasicBlocks.this.Instruction">inst</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="comment">/** Apply a function to all the instructions of the block. */</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="[U](f: BasicBlocks.this.Instruction =&gt; U)Unit" id="197651">foreach</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="197653">U</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="BasicBlocks.this.Instruction =&gt; U" id="198510">f</a>: Instruction =&gt; U<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#197624" title="=&gt; Boolean">closed</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#197790" title="=&gt; BasicBlocks.this.IMethod">method</a>.<a href="Members.scala.html#197766" title="()Unit">dump</a>
        <a href="ICodes.scala.html#96917" title="=&gt; scala.tools.nsc.Global">global</a>.<a href="../../symtab/SymbolTable.scala.html#64779" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Traversing an open block!: &quot;)" class="string">&quot;Traversing an open block!: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#197789" title="=&gt; Int">label</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; in &quot;)" class="string">&quot; in &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#197790" title="=&gt; BasicBlocks.this.IMethod">method</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#197644" title="(xs: Array[BasicBlocks.this.Instruction])scala.collection.mutable.ArrayOps[BasicBlocks.this.Instruction]">instrs</a> <span title="(f: BasicBlocks.this.Instruction =&gt; U)Unit">foreach</span> <a href="#198510" title="BasicBlocks.this.Instruction =&gt; U">f</a>
    <span class="delimiter">}</span>

    <span class="comment">/** The number of instructions in this basic block so far. */</span>
    <span class="keyword">def</span> <a title="=&gt; Int" id="197654">length</a> = <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#197624" title="=&gt; Boolean">closed</a><span class="delimiter">)</span> <a href="#197644" title="=&gt; Array[BasicBlocks.this.Instruction]">instrs</a>.<span title="=&gt; Int">length</span> <span class="keyword">else</span> <a href="#197641" title="=&gt; List[BasicBlocks.this.Instruction]">instructionList</a>.<span title="=&gt; Int">length</span>

    <span class="comment">/** Return the n-th instruction. */</span>
    <span class="keyword">def</span> <a title="(n: Int)BasicBlocks.this.Instruction" id="197655">apply</a><span class="delimiter">(</span><a title="Int" id="199286">n</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="Opcodes.scala.html#96974" title="BasicBlocks.this.Instruction">Instruction</a> =
      <span title="BasicBlocks.this.Instruction" class="keyword">if</span> <span class="delimiter">(</span><a href="#197624" title="=&gt; Boolean">closed</a><span class="delimiter">)</span> <a href="#197644" title="(i: Int)BasicBlocks.this.Instruction">instrs</a><span class="delimiter">(</span><a href="#199286" title="Int">n</a><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#197641" title="=&gt; List[BasicBlocks.this.Instruction]">instructionList</a>.<span title="(n: Int)BasicBlocks.this.Instruction">reverse</span><span class="delimiter">(</span><a href="#199286" title="Int">n</a><span class="delimiter">)</span>

    <span class="comment">///////////////////// Substitutions ///////////////////////</span>

    <span class="comment">/**
     * Replace the instruction at the given position. Used by labels when
     * they are anchored. It retains the position of the previous instruction.
     */</span>
    <span class="keyword">def</span> <a title="(pos: Int, instr: BasicBlocks.this.Instruction)Boolean" id="197656">replaceInstruction</a><span class="delimiter">(</span><a title="Int" id="199298">pos</a>: <span title="Int">Int</span>, <a title="BasicBlocks.this.Instruction" id="199299">instr</a>: <a href="Opcodes.scala.html#96974" title="BasicBlocks.this.Instruction">Instruction</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
      <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#197624" title="=&gt; Boolean">closed</a>, <span title="java.lang.String(&quot;Instructions can be replaced only after the basic block is closed&quot;)" class="string">&quot;Instructions can be replaced only after the basic block is closed&quot;</span><span class="delimiter">)</span>
      <a href="#199299" title="BasicBlocks.this.Instruction">instr</a>.<a href="Opcodes.scala.html#197950" title="(p: scala.tools.nsc.util.Position)instr.type">setPos</a><span class="delimiter">(</span><a href="#197644" title="(i: Int)BasicBlocks.this.Instruction">instrs</a><span class="delimiter">(</span><a href="#199298" title="Int">pos</a><span class="delimiter">)</span>.<a href="Opcodes.scala.html#197946" title="=&gt; scala.tools.nsc.util.Position">pos</a><span class="delimiter">)</span>
      <a href="#197644" title="(i: Int, x: BasicBlocks.this.Instruction)Unit">instrs</a><span class="delimiter">(</span><a href="#199298" title="Int">pos</a><span class="delimiter">)</span> = <a href="#199299" title="BasicBlocks.this.Instruction">instr</a>
      <a href="#197617" title="=&gt; BasicBlocks.this.Code">code</a>.<a href="Members.scala.html#197815" title="(b: Boolean)Unit">touched</a> = <span title="Boolean(true)" class="keyword">true</span>
      <span title="Boolean(true)" class="keyword">true</span>
    <span class="delimiter">}</span>

    <span class="comment">/**
     * Replace the given instruction with the new one. 
     * Returns `true' if it actually changed something. 
     * It retains the position of the previous instruction.
     */</span>
    <span class="keyword">def</span> <a title="(oldInstr: BasicBlocks.this.Instruction, newInstr: BasicBlocks.this.Instruction)Boolean" id="197657">replaceInstruction</a><span class="delimiter">(</span><a title="BasicBlocks.this.Instruction" id="199309">oldInstr</a>: <a href="Opcodes.scala.html#96974" title="BasicBlocks.this.Instruction">Instruction</a>, <a title="BasicBlocks.this.Instruction" id="199310">newInstr</a>: <a href="Opcodes.scala.html#96974" title="BasicBlocks.this.Instruction">Instruction</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
      <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#197624" title="=&gt; Boolean">closed</a>, <span title="java.lang.String(&quot;Instructions can be replaced only after the basic block is closed&quot;)" class="string">&quot;Instructions can be replaced only after the basic block is closed&quot;</span><span class="delimiter">)</span>
      
      <a href="#197650" title="(inst: BasicBlocks.this.Instruction)Int">indexOf</a><span class="delimiter">(</span><a href="#199309" title="BasicBlocks.this.Instruction">oldInstr</a><span class="delimiter">)</span> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Boolean(false)">-</span><span class="int">1</span>   =&gt; <span title="Boolean(false)" class="keyword">false</span>
        <span class="keyword">case</span> <a title="Boolean" id="199331">idx</a>  =&gt;
          <a href="#199310" title="BasicBlocks.this.Instruction">newInstr</a> <a href="Opcodes.scala.html#197950" title="(p: scala.tools.nsc.util.Position)newInstr.type">setPos</a> <a href="#199309" title="BasicBlocks.this.Instruction">oldInstr</a>.<a href="Opcodes.scala.html#197946" title="=&gt; scala.tools.nsc.util.Position">pos</a>
          <a href="#197644" title="(i: Int, x: BasicBlocks.this.Instruction)Unit">instrs</a><span class="delimiter">(</span><a href="#199331" title="Int">idx</a><span class="delimiter">)</span> = <a href="#199310" title="BasicBlocks.this.Instruction">newInstr</a>
          <a href="#197617" title="=&gt; BasicBlocks.this.Code">code</a>.<a href="Members.scala.html#197815" title="(b: Boolean)Unit">touched</a> = <span title="Boolean(true)" class="keyword">true</span>
          <span title="Boolean(true)" class="keyword">true</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="comment">/** Replaces &lt;code&gt;oldInstr&lt;/code&gt; with &lt;code&gt;is&lt;/code&gt;. It does not update
     *  the position field in the newly inserted instructions, so it behaves
     *  differently than the one-instruction versions of this function.
     *
     *  @param iold ..
     *  @param is   ..
     *  @return     ..
     */</span>
    <span class="keyword">def</span> <a title="(oldInstr: BasicBlocks.this.Instruction, is: List[BasicBlocks.this.Instruction])Boolean" id="197658">replaceInstruction</a><span class="delimiter">(</span><a title="BasicBlocks.this.Instruction" id="199332">oldInstr</a>: <a href="Opcodes.scala.html#96974" title="BasicBlocks.this.Instruction">Instruction</a>, <a title="List[BasicBlocks.this.Instruction]" id="199333">is</a>: <span title="List[BasicBlocks.this.Instruction]">List</span><span class="delimiter">[</span>Instruction<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
      <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#197624" title="=&gt; Boolean">closed</a>, <span title="java.lang.String(&quot;Instructions can be replaced only after the basic block is closed&quot;)" class="string">&quot;Instructions can be replaced only after the basic block is closed&quot;</span><span class="delimiter">)</span>
      
      <a href="#197650" title="(inst: BasicBlocks.this.Instruction)Int">indexOf</a><span class="delimiter">(</span><a href="#199332" title="BasicBlocks.this.Instruction">oldInstr</a><span class="delimiter">)</span> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Boolean(false)">-</span><span class="int">1</span>   =&gt; <span title="Boolean(false)" class="keyword">false</span>
        <span class="keyword">case</span> <a title="Boolean" id="199354">idx</a>  =&gt;
          <a href="#197644" title="(x$1: Array[BasicBlocks.this.Instruction])Unit">instrs</a> = <a href="#197644" title="(xs: Array[BasicBlocks.this.Instruction])scala.collection.mutable.ArrayOps[BasicBlocks.this.Instruction]">instrs</a>.<span title="(from: Int, patch: scala.collection.GenSeq[BasicBlocks.this.Instruction], replaced: Int)(implicit bf: scala.collection.generic.CanBuildFrom[Array[BasicBlocks.this.Instruction],BasicBlocks.this.Instruction,Array[BasicBlocks.this.Instruction]])Array[BasicBlocks.this.Instruction]">patch</span><a href="#13473" title="(implicit m: scala.reflect.ClassManifest[BasicBlocks.this.Instruction])scala.collection.generic.CanBuildFrom[Array[_],BasicBlocks.this.Instruction,Array[BasicBlocks.this.Instruction]]" class="delimiter">(</a><a href="#199354" title="Int">idx</a>, <a href="#199333" title="List[BasicBlocks.this.Instruction]">is</a>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
          <a href="#197617" title="=&gt; BasicBlocks.this.Code">code</a>.<a href="Members.scala.html#197815" title="(b: Boolean)Unit">touched</a> = <span title="Boolean(true)" class="keyword">true</span>
          <span title="Boolean(true)" class="keyword">true</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    
    <span class="comment">/** Insert instructions in 'is' immediately after index 'idx'. */</span>
    <span class="keyword">def</span> <a title="(idx: Int, is: List[BasicBlocks.this.Instruction])Unit" id="197659">insertAfter</a><span class="delimiter">(</span><a title="Int" id="200075">idx</a>: <span title="Int">Int</span>, <a title="List[BasicBlocks.this.Instruction]" id="200076">is</a>: <span title="List[BasicBlocks.this.Instruction]">List</span><span class="delimiter">[</span>Instruction<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#197624" title="=&gt; Boolean">closed</a>, <span title="java.lang.String(&quot;Instructions can be replaced only after the basic block is closed&quot;)" class="string">&quot;Instructions can be replaced only after the basic block is closed&quot;</span><span class="delimiter">)</span>
      
      <a href="#197644" title="(x$1: Array[BasicBlocks.this.Instruction])Unit">instrs</a> = <a href="#197644" title="(xs: Array[BasicBlocks.this.Instruction])scala.collection.mutable.ArrayOps[BasicBlocks.this.Instruction]">instrs</a>.<span title="(from: Int, patch: scala.collection.GenSeq[BasicBlocks.this.Instruction], replaced: Int)(implicit bf: scala.collection.generic.CanBuildFrom[Array[BasicBlocks.this.Instruction],BasicBlocks.this.Instruction,Array[BasicBlocks.this.Instruction]])Array[BasicBlocks.this.Instruction]">patch</span><a href="#13473" title="(implicit m: scala.reflect.ClassManifest[BasicBlocks.this.Instruction])scala.collection.generic.CanBuildFrom[Array[_],BasicBlocks.this.Instruction,Array[BasicBlocks.this.Instruction]]" class="delimiter">(</a><a href="#200075" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>, <a href="#200076" title="List[BasicBlocks.this.Instruction]">is</a>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <a href="#197617" title="=&gt; BasicBlocks.this.Code">code</a>.<a href="Members.scala.html#197815" title="(b: Boolean)Unit">touched</a> = <span title="Boolean(true)" class="keyword">true</span>
    <span class="delimiter">}</span>

    <span class="comment">/** Removes instructions found at the given positions.
     *
     *  @param positions ...
     */</span>
    <span class="keyword">def</span> <a title="(positions: Int*)Unit" id="197660">removeInstructionsAt</a><span class="delimiter">(</span><a title="Int*" id="200791">positions</a>: <span title="Int*">Int</span>*<span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="(assertion: Boolean)Unit">assert</span><span class="delimiter">(</span><a href="#197624" title="=&gt; Boolean">closed</a><span class="delimiter">)</span>
      <a href="#197644" title="(x$1: Array[BasicBlocks.this.Instruction])Unit">instrs</a> = <a href="#197644" title="(xs: Array[BasicBlocks.this.Instruction])scala.collection.mutable.ArrayOps[BasicBlocks.this.Instruction]">instrs</a>.<span title="=&gt; scala.collection.immutable.Range">indices</span>.<span title="implicit scala.Predef.intArrayOps : (xs: Array[Int])scala.collection.mutable.ArrayOps[Int]">toArray</span> <span title="implicit scala.Predef.intArrayOps : (xs: Array[Int])scala.collection.mutable.ArrayOps[Int]">filterNot</span> <a href="#200791" title="Int*">positions</a>.<span title="scala.collection.immutable.Set[Int]">toSet</span> <a href="#13473" title="(f: Int =&gt; BasicBlocks.this.Instruction)(implicit bf: scala.collection.generic.CanBuildFrom[Array[Int],BasicBlocks.this.Instruction,Array[BasicBlocks.this.Instruction]])Array[BasicBlocks.this.Instruction]">map</a> <a href="#197644" title="(xs: Array[BasicBlocks.this.Instruction])scala.collection.mutable.WrappedArray[BasicBlocks.this.Instruction]">instrs</a>
      <a href="#197617" title="=&gt; BasicBlocks.this.Code">code</a>.<a href="Members.scala.html#197815" title="(b: Boolean)Unit">touched</a> = <span title="Boolean(true)" class="keyword">true</span>
    <span class="delimiter">}</span>
    
    <span class="comment">/** Remove the last instruction of this basic block. It is
     *  fast for an open block, but slower when the block is closed.
     */</span>
    <span class="keyword">def</span> <a title="()Unit" id="197661">removeLastInstruction</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#197624" title="=&gt; Boolean">closed</a><span class="delimiter">)</span> 
        <a href="#197660" title="(positions: Int*)Unit">removeInstructionsAt</a><span class="delimiter">(</span><a href="#96970" title="=&gt; Int">size</a><span class="delimiter">)</span>
      <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="#197641" title="(x$1: List[BasicBlocks.this.Instruction])Unit">instructionList</a> = <a href="#197641" title="=&gt; List[BasicBlocks.this.Instruction]">instructionList</a>.<span title="=&gt; List[BasicBlocks.this.Instruction]">tail</span>
        <a href="#197617" title="=&gt; BasicBlocks.this.Code">code</a>.<a href="Members.scala.html#197815" title="(b: Boolean)Unit">touched</a> = <span title="Boolean(true)" class="keyword">true</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="comment">/** Replaces all instructions found in the map.
     *
     *  @param map ...
     */</span>
    <span class="keyword">def</span> <a title="(map: Map[BasicBlocks.this.Instruction,BasicBlocks.this.Instruction])Unit" id="197662">subst</a><span class="delimiter">(</span><a title="Map[BasicBlocks.this.Instruction,BasicBlocks.this.Instruction]" id="201545">map</a>: <span title="Map[BasicBlocks.this.Instruction,BasicBlocks.this.Instruction]">Map</span><span class="delimiter">[</span>Instruction, Instruction<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#197624" title="=&gt; Boolean">closed</a><span class="delimiter">)</span>
        <a href="#197641" title="(x$1: List[BasicBlocks.this.Instruction])Unit">instructionList</a> = <a href="#197641" title="=&gt; List[BasicBlocks.this.Instruction]">instructionList</a> <span title="(f: BasicBlocks.this.Instruction =&gt; BasicBlocks.this.Instruction)(implicit bf: scala.collection.generic.CanBuildFrom[List[BasicBlocks.this.Instruction],BasicBlocks.this.Instruction,List[BasicBlocks.this.Instruction]])List[BasicBlocks.this.Instruction]">map</span> <span class="delimiter">(</span><a title="BasicBlocks.this.Instruction" id="201566">x</a> =&gt; <a href="#201545" title="Map[BasicBlocks.this.Instruction,BasicBlocks.this.Instruction]">map</a>.<span title="(key: BasicBlocks.this.Instruction, default: =&gt; BasicBlocks.this.Instruction)BasicBlocks.this.Instruction">getOrElse</span><span class="delimiter">(</span><a href="#201566" title="BasicBlocks.this.Instruction">x</a>, <a href="#201566" title="BasicBlocks.this.Instruction">x</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">else</span>
        <a href="#197644" title="(xs: Array[BasicBlocks.this.Instruction])scala.collection.mutable.ArrayOps[BasicBlocks.this.Instruction]">instrs</a>.<a href="#13473" title="(xs: Array[(BasicBlocks.this.Instruction, Int)])scala.collection.mutable.ArrayOps[(BasicBlocks.this.Instruction, Int)]">zipWithIndex</a> <span title="(pf: PartialFunction[(BasicBlocks.this.Instruction, Int),Unit])(implicit bf: scala.collection.generic.CanBuildFrom[Array[(BasicBlocks.this.Instruction, Int)],Unit,Any])Any">collect</span> <a href="#202526" title="Unit" class="delimiter">{</a>
          <span class="keyword">case</span> <span title="Unit" class="delimiter">(</span><a title="BasicBlocks.this.Instruction" id="202529">oldInstr</a>, <a title="Int" id="202530">i</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#201545" title="Map[BasicBlocks.this.Instruction,BasicBlocks.this.Instruction]">map</a> <span title="(key: BasicBlocks.this.Instruction)Boolean">contains</span> <a href="#202529" title="BasicBlocks.this.Instruction">oldInstr</a> =&gt;
            <a href="#197617" title="=&gt; BasicBlocks.this.Code">code</a>.<a href="Members.scala.html#197815" title="(b: Boolean)Unit">touched</a> <span title="(x: Boolean)Boolean">|=</span> <a href="#197656" title="(pos: Int, instr: BasicBlocks.this.Instruction)Boolean">replaceInstruction</a><span class="delimiter">(</span><a href="#202530" title="Int">i</a>, <a href="#201545" title="(key: BasicBlocks.this.Instruction)BasicBlocks.this.Instruction">map</a><span class="delimiter">(</span><a href="#202529" title="BasicBlocks.this.Instruction">oldInstr</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

    <span class="comment">////////////////////// Emit //////////////////////</span>


    <span class="comment">/** Add a new instruction at the end of the block,
     *  using the same source position as the last emitted instruction
     */</span>
    <span class="keyword">def</span> <a title="(instr: BasicBlocks.this.Instruction)Unit" id="197663">emit</a><span class="delimiter">(</span><a title="BasicBlocks.this.Instruction" id="202596">instr</a>: <a href="Opcodes.scala.html#96974" title="BasicBlocks.this.Instruction">Instruction</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.tools.nsc.util.Position" id="202598">pos</a> = <span title="scala.tools.nsc.util.Position" class="keyword">if</span> <span class="delimiter">(</span><a href="#197641" title="=&gt; List[BasicBlocks.this.Instruction]">instructionList</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="../../util/Position.scala.html#30447" title="object scala.tools.nsc.util.NoPosition">NoPosition</a> <span class="keyword">else</span> <a href="#197641" title="=&gt; List[BasicBlocks.this.Instruction]">instructionList</a>.<span title="=&gt; BasicBlocks.this.Instruction">head</span>.<a href="Opcodes.scala.html#197946" title="=&gt; scala.tools.nsc.util.Position">pos</a>
      <a href="#197664" title="(instr: BasicBlocks.this.Instruction, pos: scala.tools.nsc.util.Position)Unit">emit</a><span class="delimiter">(</span><a href="#202596" title="BasicBlocks.this.Instruction">instr</a>, <a href="#202598" title="scala.tools.nsc.util.Position">pos</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="comment">/** Emitting does not set touched to true. During code generation this is a hotspot and
     *  setting the flag for each emit is a waste. Caching should happen only after a block
     *  is closed, which sets the DIRTYSUCCS flag.
     */</span>
    <span class="keyword">def</span> <a title="(instr: BasicBlocks.this.Instruction, pos: scala.tools.nsc.util.Position)Unit" id="197664">emit</a><span class="delimiter">(</span><a title="BasicBlocks.this.Instruction" id="202607">instr</a>: <a href="Opcodes.scala.html#96974" title="BasicBlocks.this.Instruction">Instruction</a>, <a title="scala.tools.nsc.util.Position" id="202608">pos</a>: <a href="../../util/Position.scala.html#30599" title="scala.tools.nsc.util.Position">Position</a><span class="delimiter">)</span> <span class="delimiter">{</span>
<span class="comment">/*      if (closed) {
        print()
        Console.println(&quot;trying to emit: &quot; + instr)
      } */</span>
      <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#197624" title="=&gt; Boolean">closed</a> <span title="(x: Boolean)Boolean">||</span> <a href="#197626" title="=&gt; Boolean">ignore</a>, <span title="java.lang.String(&quot;BasicBlock closed&quot;)" class="string">&quot;BasicBlock closed&quot;</span><span class="delimiter">)</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#197626" title="=&gt; Boolean">ignore</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#64818" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#36760" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#42162" title="=&gt; Boolean">value</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="comment">/** Trying to pin down what it's likely to see after a block has been
           *  put into ignore mode so we hear about it if there's a problem.
           */</span>
          <a href="#202607" title="BasicBlocks.this.Instruction">instr</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="Unit">JUMP</span><span class="delimiter">(</span>_<span class="delimiter">)</span> | RETURN<span class="delimiter">(</span>_<span class="delimiter">)</span> | THROW<span class="delimiter">(</span>_<span class="delimiter">)</span> | SCOPE_EXIT<span class="delimiter">(</span>_<span class="delimiter">)</span>               =&gt; <span class="comment">// ok</span>
            <span class="keyword">case</span> <span title="Unit">STORE_LOCAL</span><span class="delimiter">(</span><a title="BasicBlocks.this.Local" id="202775">local</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="../../symtab/NameManglers.scala.html#115603" title="(name: BasicBlocks.this.global.Name)Boolean">isExceptionResultName</a><span class="delimiter">(</span><a href="#202775" title="BasicBlocks.this.Local">local</a>.<a href="Members.scala.html#197915" title="=&gt; BasicBlocks.this.global.Symbol">sym</a>.<a href="../../symtab/Symbols.scala.html#107407" title="=&gt; BasicBlocks.this.global.Name">name</a><span class="delimiter">)</span>  =&gt; <span class="comment">// ok</span>
            <span class="keyword">case</span> <a title="Unit" id="202787">x</a> =&gt; <a href="../../Global.scala.html#64872" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Ignoring instruction, possibly at our peril, at &quot;)" class="string">&quot;Ignoring instruction, possibly at our peril, at &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#202608" title="scala.tools.nsc.util.Position">pos</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#202787" title="BasicBlocks.this.Instruction">x</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="#202607" title="BasicBlocks.this.Instruction">instr</a>.<a href="Opcodes.scala.html#197950" title="(p: scala.tools.nsc.util.Position)instr.type">setPos</a><span class="delimiter">(</span><a href="#202608" title="scala.tools.nsc.util.Position">pos</a><span class="delimiter">)</span>
        <a href="#197641" title="(x$1: List[BasicBlocks.this.Instruction])Unit">instructionList</a> <span title="(x: BasicBlocks.this.Instruction)List[BasicBlocks.this.Instruction]">::=</span> <a href="#202607" title="BasicBlocks.this.Instruction">instr</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="(instrs: Seq[BasicBlocks.this.Instruction])Unit" id="197665">emit</a><span class="delimiter">(</span><a title="Seq[BasicBlocks.this.Instruction]" id="202605">instrs</a>: <span title="Seq[BasicBlocks.this.Instruction]">Seq</span><span class="delimiter">[</span>Instruction<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#202605" title="Seq[BasicBlocks.this.Instruction]">instrs</a> <span title="(f: BasicBlocks.this.Instruction =&gt; Unit)Unit">foreach</span> <span class="delimiter">(</span><a title="BasicBlocks.this.Instruction" id="202813">i</a> =&gt; <a href="#197664" title="(instr: BasicBlocks.this.Instruction, pos: scala.tools.nsc.util.Position)Unit">emit</a><span class="delimiter">(</span><a href="#202813" title="BasicBlocks.this.Instruction">i</a>, <a href="#202813" title="BasicBlocks.this.Instruction">i</a>.<a href="Opcodes.scala.html#197946" title="=&gt; scala.tools.nsc.util.Position">pos</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    
    <span class="comment">/** The semantics of this are a little odd but it's designed to work
     *  seamlessly with the existing code.  It emits each supplied instruction,
     *  then closes the block.  The odd part is that if the instruction has
     *  pos == NoPosition, it calls the 1-arg emit, but otherwise it calls
     *  the 2-arg emit.  This way I could retain existing behavior exactly by
     *  calling setPos on any instruction using the two arg version which
     *  I wanted to include in a call to emitOnly.
     */</span>
    <span class="keyword">def</span> <a title="(instrs: BasicBlocks.this.Instruction*)Unit" id="197666">emitOnly</a><span class="delimiter">(</span><a title="BasicBlocks.this.Instruction*" id="202819">instrs</a>: <span title="BasicBlocks.this.Instruction*">Instruction</span>*<span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#202819" title="BasicBlocks.this.Instruction*">instrs</a> <span title="(f: BasicBlocks.this.Instruction =&gt; Unit)Unit">foreach</span> <span class="delimiter">(</span><a title="BasicBlocks.this.Instruction" id="202837">i</a> =&gt; <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#202837" title="BasicBlocks.this.Instruction">i</a>.<a href="Opcodes.scala.html#197946" title="=&gt; scala.tools.nsc.util.Position">pos</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../util/Position.scala.html#30447" title="object scala.tools.nsc.util.NoPosition">NoPosition</a><span class="delimiter">)</span> <a href="#197663" title="(instr: BasicBlocks.this.Instruction)Unit">emit</a><span class="delimiter">(</span><a href="#202837" title="BasicBlocks.this.Instruction">i</a><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#197664" title="(instr: BasicBlocks.this.Instruction, pos: scala.tools.nsc.util.Position)Unit">emit</a><span class="delimiter">(</span><a href="#202837" title="BasicBlocks.this.Instruction">i</a>, <a href="#202837" title="BasicBlocks.this.Instruction">i</a>.<a href="Opcodes.scala.html#197946" title="=&gt; scala.tools.nsc.util.Position">pos</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#96970" title="BasicBlock.this.type" class="keyword">this</a>.<a href="#197669" title="()Unit">close</a>
    <span class="delimiter">}</span>

    <span class="comment">/** do nothing if block is already closed */</span>
    <span class="keyword">def</span> <a title="(instr: BasicBlocks.this.Instruction)Unit" id="197667">closeWith</a><span class="delimiter">(</span><a title="BasicBlocks.this.Instruction" id="202855">instr</a>: <a href="Opcodes.scala.html#96974" title="BasicBlocks.this.Instruction">Instruction</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#197624" title="=&gt; Boolean">closed</a><span class="delimiter">)</span> <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="#197663" title="(instr: BasicBlocks.this.Instruction)Unit">emit</a><span class="delimiter">(</span><a href="#202855" title="BasicBlocks.this.Instruction">instr</a><span class="delimiter">)</span>
        <a href="#197669" title="()Unit">close</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(instr: BasicBlocks.this.Instruction, pos: scala.tools.nsc.util.Position)Unit" id="197668">closeWith</a><span class="delimiter">(</span><a title="BasicBlocks.this.Instruction" id="202863">instr</a>: <a href="Opcodes.scala.html#96974" title="BasicBlocks.this.Instruction">Instruction</a>, <a title="scala.tools.nsc.util.Position" id="202864">pos</a>: <a href="../../util/Position.scala.html#30599" title="scala.tools.nsc.util.Position">Position</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#197624" title="=&gt; Boolean">closed</a><span class="delimiter">)</span> <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="#197664" title="(instr: BasicBlocks.this.Instruction, pos: scala.tools.nsc.util.Position)Unit">emit</a><span class="delimiter">(</span><a href="#202863" title="BasicBlocks.this.Instruction">instr</a>, <a href="#202864" title="scala.tools.nsc.util.Position">pos</a><span class="delimiter">)</span>
        <a href="#197669" title="()Unit">close</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="comment">/** Close the block */</span>
    <span class="keyword">def</span> <a title="()Unit" id="197669">close</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="(assertion: Boolean)Unit">assert</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#197624" title="=&gt; Boolean">closed</a> <span title="(x: Boolean)Boolean">||</span> <a href="#197626" title="=&gt; Boolean">ignore</a><span class="delimiter">)</span>
      <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#197641" title="=&gt; List[BasicBlocks.this.Instruction]">instructionList</a>.<span title="=&gt; Boolean">nonEmpty</span>, <span title="java.lang.String(&quot;Empty block.&quot;)" class="string">&quot;Empty block.&quot;</span><span class="delimiter">)</span>
      <a href="#197625" title="(b: Boolean)Unit">closed</a> = <span title="Boolean(true)" class="keyword">true</span>
      <a href="#197622" title="(flag: Int)Unit">setFlag</a><span class="delimiter">(</span><span title="Int(16)">DIRTYSUCCS</span><span class="delimiter">)</span>
      <a href="#197641" title="(x$1: List[BasicBlocks.this.Instruction])Unit">instructionList</a> = <a href="#197641" title="=&gt; List[BasicBlocks.this.Instruction]">instructionList</a>.<span title="=&gt; List[BasicBlocks.this.Instruction]">reverse</span>
      <a href="#197644" title="(x$1: Array[BasicBlocks.this.Instruction])Unit">instrs</a> = <a href="#197641" title="=&gt; List[BasicBlocks.this.Instruction]">instructionList</a>.<a href="#13473" title="(implicit evidence$1: ClassManifest[BasicBlocks.this.Instruction])Array[BasicBlocks.this.Instruction]">toArray</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="()Unit" id="197670">open</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="(assertion: Boolean)Unit">assert</span><span class="delimiter">(</span><a href="#197624" title="=&gt; Boolean">closed</a><span class="delimiter">)</span>
      <a href="#197625" title="(b: Boolean)Unit">closed</a> = <span title="Boolean(false)" class="keyword">false</span>
      <a href="#197627" title="(b: Boolean)Unit">ignore</a> = <span title="Boolean(false)" class="keyword">false</span>
      <a href="#197633" title="(b: Boolean)Unit">touched</a> = <span title="Boolean(true)" class="keyword">true</span>
      <a href="#197641" title="(x$1: List[BasicBlocks.this.Instruction])Unit">instructionList</a> = <a href="#197641" title="=&gt; List[BasicBlocks.this.Instruction]">instructionList</a>.<span title="=&gt; List[BasicBlocks.this.Instruction]">reverse</span>  <span class="comment">// prepare for appending to the head</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="()Unit" id="197671">clear</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#197641" title="(x$1: List[BasicBlocks.this.Instruction])Unit">instructionList</a> = <span title="object Nil">Nil</span>
      <a href="#197644" title="(x$1: Array[BasicBlocks.this.Instruction])Unit">instrs</a> = <span title="Null(null)" class="keyword">null</span>
      <a href="#197635" title="(x$1: List[BasicBlocks.this.BasicBlock])Unit">preds</a>  = <span title="Null(null)" class="keyword">null</span>
    <span class="delimiter">}</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Boolean" id="197672">isEmpty</a>: <span title="Boolean">Boolean</span> = <a href="#197641" title="=&gt; List[BasicBlocks.this.Instruction]">instructionList</a>.<span title="=&gt; Boolean">isEmpty</span>

    <span class="comment">/** Enter ignore mode: new 'emit'ted instructions will not be
     *  added to this basic block. It makes the generation of THROW
     *  and RETURNs easier.
     */</span>
    <span class="keyword">def</span> <a title="()Unit" id="197673">enterIgnoreMode</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="#197627" title="(b: Boolean)Unit">ignore</a> = <span title="Boolean(true)" class="keyword">true</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="()Unit" id="197674">exitIgnoreMode</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#197626" title="=&gt; Boolean">ignore</a>, <span title="java.lang.String(&quot;Exit ignore mode when not in ignore mode.&quot;)" class="string">&quot;Exit ignore mode when not in ignore mode.&quot;</span><span class="delimiter">)</span>
      <a href="#197627" title="(b: Boolean)Unit">ignore</a> = <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span>

    <span class="comment">/** Return the last instruction of this basic block. */</span>
    <span class="keyword">def</span> <a title="=&gt; BasicBlocks.this.Instruction" id="197675">lastInstruction</a> =
      <span title="BasicBlocks.this.Instruction" class="keyword">if</span> <span class="delimiter">(</span><a href="#197624" title="=&gt; Boolean">closed</a><span class="delimiter">)</span> <a href="#197644" title="(xs: Array[BasicBlocks.this.Instruction])scala.collection.mutable.ArrayOps[BasicBlocks.this.Instruction]">instrs</a>.<span title="=&gt; BasicBlocks.this.Instruction">last</span>
      <span class="keyword">else</span> <a href="#197641" title="=&gt; List[BasicBlocks.this.Instruction]">instructionList</a>.<span title="=&gt; BasicBlocks.this.Instruction">head</span>

    <span class="keyword">def</span> <a title="=&gt; BasicBlocks.this.Instruction" id="197676">firstInstruction</a> =
      <span title="BasicBlocks.this.Instruction" class="keyword">if</span> <span class="delimiter">(</span><a href="#197624" title="=&gt; Boolean">closed</a><span class="delimiter">)</span> <a href="#197644" title="(i: Int)BasicBlocks.this.Instruction">instrs</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <span class="keyword">else</span> <a href="#197641" title="=&gt; List[BasicBlocks.this.Instruction]">instructionList</a>.<span title="=&gt; BasicBlocks.this.Instruction">last</span>
    
    <span class="keyword">def</span> <a title="(block: BasicBlocks.this.BasicBlock)List[BasicBlocks.this.BasicBlock]" id="197677">exceptionSuccessorsForBlock</a><span class="delimiter">(</span><a title="BasicBlocks.this.BasicBlock" id="203036">block</a>: <a href="#96970" title="BasicBlocks.this.BasicBlock">BasicBlock</a><span class="delimiter">)</span>: <span title="List[BasicBlocks.this.BasicBlock]">List</span><span class="delimiter">[</span>BasicBlock<span class="delimiter">]</span> =
      <a href="#197790" title="=&gt; BasicBlocks.this.IMethod">method</a>.<a href="Members.scala.html#197733" title="=&gt; List[BasicBlocks.this.ExceptionHandler]">exh</a> <span title="(pf: PartialFunction[BasicBlocks.this.ExceptionHandler,BasicBlocks.this.BasicBlock])(implicit bf: scala.collection.generic.CanBuildFrom[List[BasicBlocks.this.ExceptionHandler],BasicBlocks.this.BasicBlock,List[BasicBlocks.this.BasicBlock]])List[BasicBlocks.this.BasicBlock]">collect</span> <a href="#203068" title="BasicBlocks.this.BasicBlock" class="delimiter">{</a> <span class="keyword">case</span> <a title="BasicBlocks.this.BasicBlock" id="203106">x</a> <span class="keyword">if</span> <a href="#203106" title="BasicBlocks.this.ExceptionHandler">x</a> <a href="ExceptionHandlers.scala.html#203098" title="(b: BasicBlocks.this.BasicBlock)Boolean">covers</a> <a href="#203036" title="BasicBlocks.this.BasicBlock">block</a> =&gt; <a href="#203106" title="BasicBlocks.this.ExceptionHandler">x</a>.<a href="ExceptionHandlers.scala.html#203093" title="=&gt; BasicBlocks.this.BasicBlock">startBlock</a> <span class="delimiter">}</span>

    <span class="comment">/** Cached value of successors. Must be recomputed whenever a block in the current method is changed. */</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <a title="List[BasicBlocks.this.BasicBlock]" id="197679">succs</a>: <span title="List[BasicBlocks.this.BasicBlock]">List</span><span class="delimiter">[</span>BasicBlock<span class="delimiter">]</span> = <span title="object Nil">Nil</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="197681">updateSuccs</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#197623" title="(flag: Int)Unit">resetFlag</a><span class="delimiter">(</span><span title="Int(16)">DIRTYSUCCS</span><span class="delimiter">)</span>      
      <a href="#197679" title="(x$1: List[BasicBlocks.this.BasicBlock])Unit">succs</a> =
        <span title="List[BasicBlocks.this.BasicBlock]" class="keyword">if</span> <span class="delimiter">(</span><a href="#197672" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <span title="object Nil">Nil</span>
        <span class="keyword">else</span> <a href="#197684" title="=&gt; List[BasicBlocks.this.BasicBlock]">exceptionSuccessors</a> <span title="(that: scala.collection.GenTraversableOnce[BasicBlocks.this.BasicBlock])(implicit bf: scala.collection.generic.CanBuildFrom[List[BasicBlocks.this.BasicBlock],BasicBlocks.this.BasicBlock,List[BasicBlocks.this.BasicBlock]])List[BasicBlocks.this.BasicBlock]">++</span> <a href="#197683" title="=&gt; List[BasicBlocks.this.BasicBlock]">directSuccessors</a> <span title="(that: scala.collection.GenTraversableOnce[BasicBlocks.this.BasicBlock])(implicit bf: scala.collection.generic.CanBuildFrom[List[BasicBlocks.this.BasicBlock],BasicBlocks.this.BasicBlock,List[BasicBlocks.this.BasicBlock]])List[BasicBlocks.this.BasicBlock]">++</span> <a href="#197685" title="=&gt; List[BasicBlocks.this.BasicBlock]">indirectExceptionSuccessors</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="=&gt; List[BasicBlocks.this.BasicBlock]" id="197682">successors</a> : <span title="List[BasicBlocks.this.BasicBlock]">List</span><span class="delimiter">[</span>BasicBlock<span class="delimiter">]</span> = <span class="delimiter">{</span>    
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#197632" title="=&gt; Boolean">touched</a><span class="delimiter">)</span> <a href="#197681" title="()Unit">updateSuccs</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#197679" title="=&gt; List[BasicBlocks.this.BasicBlock]">succs</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="=&gt; List[BasicBlocks.this.BasicBlock]" id="197683">directSuccessors</a>: <span title="List[BasicBlocks.this.BasicBlock]">List</span><span class="delimiter">[</span>BasicBlock<span class="delimiter">]</span> =
      <span title="List[BasicBlocks.this.BasicBlock]" class="keyword">if</span> <span class="delimiter">(</span><a href="#197672" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <span title="object Nil">Nil</span> <span class="keyword">else</span> <a href="#197675" title="=&gt; BasicBlocks.this.Instruction">lastInstruction</a> <span title="List[BasicBlocks.this.BasicBlock]" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="List[BasicBlocks.this.BasicBlock]">JUMP</span><span class="delimiter">(</span><a title="BasicBlocks.this.BasicBlock" id="203288">whereto</a><span class="delimiter">)</span>              =&gt; <span title="(xs: BasicBlocks.this.BasicBlock*)List[BasicBlocks.this.BasicBlock]">List</span><span class="delimiter">(</span><a href="#203288" title="BasicBlocks.this.BasicBlock">whereto</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="List[BasicBlocks.this.BasicBlock]">CJUMP</span><span class="delimiter">(</span><a title="BasicBlocks.this.BasicBlock" id="203357">succ</a>, <a title="BasicBlocks.this.BasicBlock" id="203358">fail</a>, _, _<span class="delimiter">)</span>    =&gt; <a href="#203358" title="BasicBlocks.this.BasicBlock">fail</a> <a href="#203359" title="(x: BasicBlocks.this.BasicBlock)List[BasicBlocks.this.BasicBlock]">::</a> <a href="#203357" title="BasicBlocks.this.BasicBlock">succ</a> <a href="#203360" title="(x: BasicBlocks.this.BasicBlock)List[BasicBlocks.this.BasicBlock]">::</a> <span title="object Nil">Nil</span>
        <span class="keyword">case</span> <span title="List[BasicBlocks.this.BasicBlock]">CZJUMP</span><span class="delimiter">(</span><a title="BasicBlocks.this.BasicBlock" id="203429">succ</a>, <a title="BasicBlocks.this.BasicBlock" id="203430">fail</a>, _, _<span class="delimiter">)</span>   =&gt; <a href="#203430" title="BasicBlocks.this.BasicBlock">fail</a> <a href="#203431" title="(x: BasicBlocks.this.BasicBlock)List[BasicBlocks.this.BasicBlock]">::</a> <a href="#203429" title="BasicBlocks.this.BasicBlock">succ</a> <a href="#203432" title="(x: BasicBlocks.this.BasicBlock)List[BasicBlocks.this.BasicBlock]">::</a> <span title="object Nil">Nil</span>
        <span class="keyword">case</span> <span title="List[BasicBlocks.this.BasicBlock]">SWITCH</span><span class="delimiter">(</span>_, <a title="List[BasicBlocks.this.BasicBlock]" id="203507">labels</a><span class="delimiter">)</span>          =&gt; <a href="#203507" title="List[BasicBlocks.this.BasicBlock]">labels</a>
        <span class="keyword">case</span> <span title="scala.collection.immutable.Nil.type">RETURN</span><span class="delimiter">(</span>_<span class="delimiter">)</span>                  =&gt; <span title="object Nil">Nil</span>
        <span class="keyword">case</span> <span title="scala.collection.immutable.Nil.type">THROW</span><span class="delimiter">(</span>_<span class="delimiter">)</span>                   =&gt; <span title="object Nil">Nil</span>
        <span class="keyword">case</span> <span title="List[BasicBlocks.this.BasicBlock]">_</span> =&gt;
          <span title="List[BasicBlocks.this.BasicBlock]" class="keyword">if</span> <span class="delimiter">(</span><a href="#197624" title="=&gt; Boolean">closed</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="ICodes.scala.html#96928" title="()Unit">dump</a>
            <a href="ICodes.scala.html#96917" title="=&gt; scala.tools.nsc.Global">global</a>.<a href="../../symtab/SymbolTable.scala.html#64779" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="java.lang.String(&quot;The last instruction is not a control flow instruction: &quot;)" class="string">&quot;The last instruction is not a control flow instruction: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#197675" title="=&gt; BasicBlocks.this.Instruction">lastInstruction</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <span class="keyword">else</span> <span title="object Nil">Nil</span>
      <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="=&gt; List[BasicBlocks.this.BasicBlock]" id="197684">exceptionSuccessors</a>: <span title="List[BasicBlocks.this.BasicBlock]">List</span><span class="delimiter">[</span>BasicBlock<span class="delimiter">]</span> =
      <a href="#197677" title="(block: BasicBlocks.this.BasicBlock)List[BasicBlocks.this.BasicBlock]">exceptionSuccessorsForBlock</a><span class="delimiter">(</span><a href="#96970" title="BasicBlocks.this.BasicBlock" class="keyword">this</a><span class="delimiter">)</span>

    <span class="comment">/** Return a list of successors for 'b' that come from exception handlers
     *  covering b's (non-exceptional) successors. These exception handlers 
     *  might not cover 'b' itself. This situation corresponds to an 
     *  exception being thrown as the first thing of one of b's successors.
     */</span>
    <span class="keyword">def</span> <a title="=&gt; List[BasicBlocks.this.BasicBlock]" id="197685">indirectExceptionSuccessors</a>: <span title="List[BasicBlocks.this.BasicBlock]">List</span><span class="delimiter">[</span>BasicBlock<span class="delimiter">]</span> =
      <a href="#197683" title="=&gt; List[BasicBlocks.this.BasicBlock]">directSuccessors</a> <span title="(f: BasicBlocks.this.BasicBlock =&gt; scala.collection.GenTraversableOnce[BasicBlocks.this.BasicBlock])(implicit bf: scala.collection.generic.CanBuildFrom[List[BasicBlocks.this.BasicBlock],BasicBlocks.this.BasicBlock,List[BasicBlocks.this.BasicBlock]])List[BasicBlocks.this.BasicBlock]">flatMap</span> <a href="#197677" title="(block: BasicBlocks.this.BasicBlock)List[BasicBlocks.this.BasicBlock]">exceptionSuccessorsForBlock</a> <span title="=&gt; List[BasicBlocks.this.BasicBlock]">distinct</span>

    <span class="comment">/** Returns the predecessors of this block.     */</span>
    <span class="keyword">def</span> <a title="=&gt; List[BasicBlocks.this.BasicBlock]" id="197686">predecessors</a>: <span title="List[BasicBlocks.this.BasicBlock]">List</span><span class="delimiter">[</span>BasicBlock<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#197621" title="(flag: Int)Boolean">hasFlag</a><span class="delimiter">(</span><span title="Int(32)">DIRTYPREDS</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#197623" title="(flag: Int)Unit">resetFlag</a><span class="delimiter">(</span><span title="Int(32)">DIRTYPREDS</span><span class="delimiter">)</span>
        <a href="#197635" title="(x$1: List[BasicBlocks.this.BasicBlock])Unit">preds</a> = <a href="#197617" title="=&gt; BasicBlocks.this.Code">code</a>.<a href="Members.scala.html#197800" title="=&gt; scala.collection.mutable.ListBuffer[BasicBlocks.this.BasicBlock]">blocks</a>.<span title="=&gt; Iterator[BasicBlocks.this.BasicBlock]">iterator</span> <span title="(p: BasicBlocks.this.BasicBlock =&gt; Boolean)Iterator[BasicBlocks.this.BasicBlock]">filter</span> <span class="delimiter">(</span><a href="#203576" title="BasicBlocks.this.BasicBlock">_</a>.<a href="#197682" title="=&gt; List[BasicBlocks.this.BasicBlock]">successors</a> <span title="(elem: Any)Boolean">contains</span> <a href="#96970" title="BasicBlocks.this.BasicBlock" class="keyword">this</a><span class="delimiter">)</span> <span title="=&gt; List[BasicBlocks.this.BasicBlock]">toList</span>
      <span class="delimiter">}</span>
      <a href="#197635" title="=&gt; List[BasicBlocks.this.BasicBlock]">preds</a>
    <span class="delimiter">}</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(other: Any)Boolean" id="197687">equals</a><span class="delimiter">(</span><a title="Any" id="203578">other</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <a href="#203578" title="Any">other</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Boolean" id="203580">that</a>: <a href="#96970" title="BasicBlocks.this.BasicBlock">BasicBlock</a> =&gt; <span class="delimiter">(</span><a href="#203580" title="BasicBlocks.this.BasicBlock">that</a>.<a href="#197789" title="=&gt; Int">label</a> <span title="(x: Int)Boolean">==</span> <a href="#197789" title="=&gt; Int">label</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span class="delimiter">(</span><a href="#203580" title="BasicBlocks.this.BasicBlock">that</a>.<a href="#197617" title="=&gt; BasicBlocks.this.Code">code</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#197617" title="=&gt; BasicBlocks.this.Code">code</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Boolean(false)">_</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Int" id="197688">hashCode</a> = <a href="#197789" title="=&gt; Int">label</a> <span title="(x: Int)Int">*</span> <span title="Int(41)" class="int">41</span> <span title="(x: Int)Int">+</span> <a href="#197617" title="=&gt; BasicBlocks.this.Code">code</a>.<span title="()Int">hashCode</span>
    
    <span class="comment">// Instead of it, rather use a printer</span>
    <span class="keyword">def</span> <a title="()Unit" id="197689">print</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#197690" title="(out: java.io.PrintStream)Unit">print</a><span class="delimiter">(</span>java.lang.<span title="object java.lang.System">System</span>.<span title="java.io.PrintStream">out</span><span class="delimiter">)</span> <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(out: java.io.PrintStream)Unit" id="197690">print</a><span class="delimiter">(</span><a title="java.io.PrintStream" id="203607">out</a>: java.io.<span title="java.io.PrintStream">PrintStream</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#203607" title="java.io.PrintStream">out</a>.<span title="(x$1: java.lang.String)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;block #&quot;)" class="string">&quot;block #&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#197789" title="=&gt; Int">label</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; :&quot;)" class="string">&quot; :&quot;</span><span class="delimiter">)</span>
      <a href="#197651" title="(f: BasicBlocks.this.Instruction =&gt; Unit)Unit">foreach</a><span class="delimiter">(</span><a title="BasicBlocks.this.Instruction" id="203631">i</a> =&gt; <a href="#203607" title="java.io.PrintStream">out</a>.<span title="(x$1: java.lang.String)Unit">println</span><span class="delimiter">(</span><span title="java.lang.String(&quot;  &quot;)" class="string">&quot;  &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#203631" title="BasicBlocks.this.Instruction">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#203607" title="java.io.PrintStream">out</a>.<span title="(x$1: java.lang.String)Unit">print</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Successors: &quot;)" class="string">&quot;Successors: &quot;</span><span class="delimiter">)</span>
      <a href="#197682" title="=&gt; List[BasicBlocks.this.BasicBlock]">successors</a>.<span title="(f: BasicBlocks.this.BasicBlock =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><span class="delimiter">(</span>x: <a href="#96970" title="BasicBlocks.this.BasicBlock">BasicBlock</a><span class="delimiter">)</span> =&gt; <a href="#203607" title="java.io.PrintStream">out</a>.<span title="(x$1: java.lang.String)Unit">print</span><span class="delimiter">(</span><span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#203662" title="BasicBlocks.this.BasicBlock">x</a>.<a href="#197789" title="=&gt; Int">label</a>.<span title="()java.lang.String">toString</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#203607" title="java.io.PrintStream">out</a>.<span title="()Unit">println</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; java.lang.String" id="197691">succString</a> = <span title="java.lang.String" class="keyword">if</span> <span class="delimiter">(</span><a href="#197682" title="=&gt; List[BasicBlocks.this.BasicBlock]">successors</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span title="java.lang.String(&quot;[S: N/A]&quot;)" class="string">&quot;[S: N/A]&quot;</span> <span class="keyword">else</span> <a href="#197682" title="=&gt; List[BasicBlocks.this.BasicBlock]">successors</a>.<span title="=&gt; List[BasicBlocks.this.BasicBlock]">distinct</span>.<span title="(start: String, sep: String, end: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;[S: &quot;)" class="string">&quot;[S: &quot;</span>, <span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span>, <span title="java.lang.String(&quot;]&quot;)" class="string">&quot;]&quot;</span><span class="delimiter">)</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; java.lang.String" id="197692">predString</a> = <span title="java.lang.String" class="keyword">if</span> <span class="delimiter">(</span><a href="#197686" title="=&gt; List[BasicBlocks.this.BasicBlock]">predecessors</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span title="java.lang.String(&quot;[P: N/A]&quot;)" class="string">&quot;[P: N/A]&quot;</span> <span class="keyword">else</span> <a href="#197686" title="=&gt; List[BasicBlocks.this.BasicBlock]">predecessors</a>.<span title="=&gt; List[BasicBlocks.this.BasicBlock]">distinct</span>.<span title="(start: String, sep: String, end: String)String">mkString</span><span class="delimiter">(</span><span title="java.lang.String(&quot;[P: &quot;)" class="string">&quot;[P: &quot;</span>, <span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span>, <span title="java.lang.String(&quot;]&quot;)" class="string">&quot;]&quot;</span><span class="delimiter">)</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="197693">toString</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="String">String</span> = <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#197789" title="=&gt; Int">label</a>

    <span class="keyword">def</span> <a title="=&gt; String" id="197694">blockContents</a> = <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(p: scala.tools.nsc.util.Position)java.lang.String" id="203691">posStr</a><span class="delimiter">(</span><a title="scala.tools.nsc.util.Position" id="203693">p</a>: <a href="../../util/Position.scala.html#30599" title="scala.tools.nsc.util.Position">Position</a><span class="delimiter">)</span> = <span title="java.lang.String" class="keyword">if</span> <span class="delimiter">(</span><a href="#203693" title="scala.tools.nsc.util.Position">p</a>.<a href="../../util/Position.scala.html#97188" title="=&gt; Boolean">isDefined</a><span class="delimiter">)</span> <a href="#203693" title="scala.tools.nsc.util.Position">p</a>.<a href="../../util/Position.scala.html#97214" title="=&gt; Int">line</a>.<span title="()java.lang.String">toString</span> <span class="keyword">else</span> <span title="java.lang.String(&quot;&lt;??&gt;&quot;)" class="string">&quot;&lt;??&gt;&quot;</span>
      <span class="keyword">val</span> <a title="List[java.lang.String]" id="203692">xs</a> = <a href="#96970" title="BasicBlock.this.type" class="keyword">this</a>.<a href="#197646" title="=&gt; List[BasicBlocks.this.Instruction]">toList</a> <span title="(f: BasicBlocks.this.Instruction =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[List[BasicBlocks.this.Instruction],java.lang.String,List[java.lang.String]])List[java.lang.String]">map</span> <span class="delimiter">(</span><a title="BasicBlocks.this.Instruction" id="203715">instr</a> =&gt; <a href="#203691" title="(p: scala.tools.nsc.util.Position)java.lang.String">posStr</a><span class="delimiter">(</span><a href="#203715" title="BasicBlocks.this.Instruction">instr</a>.<a href="Opcodes.scala.html#197946" title="=&gt; scala.tools.nsc.util.Position">pos</a><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\011&quot;)" class="string">&quot;\t&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#203715" title="BasicBlocks.this.Instruction">instr</a><span class="delimiter">)</span>
      <a href="#203692" title="List[java.lang.String]">xs</a>.<span title="(start: String, sep: String, end: String)String">mkString</span><span class="delimiter">(</span><a href="#197697" title="=&gt; String">fullString</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; {\012  &quot;)" class="string">&quot; {\n  &quot;</span>, <span title="java.lang.String(&quot;\012  &quot;)" class="string">&quot;\n  &quot;</span>, <span title="java.lang.String(&quot;\012}&quot;)" class="string">&quot;\n}&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="=&gt; String" id="197695">predContents</a> = <a href="#197686" title="=&gt; List[BasicBlocks.this.BasicBlock]">predecessors</a>.<span title="(f: BasicBlocks.this.BasicBlock =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[List[BasicBlocks.this.BasicBlock],String,List[String]])List[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,String,List[String]]" class="delimiter">(</span><a href="#203769" title="BasicBlocks.this.BasicBlock">_</a>.<a href="#197694" title="=&gt; String">blockContents</a><span class="delimiter">)</span>.<span title="(start: String, sep: String, end: String)String">mkString</span><span class="delimiter">(</span><a href="#197686" title="=&gt; List[BasicBlocks.this.BasicBlock]">predecessors</a>.<span title="=&gt; Int">size</span> <span title="(x: String)String">+</span> <span title="java.lang.String(&quot; preds:\012&quot;)" class="string">&quot; preds:\n&quot;</span>, <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span>, <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="=&gt; String" id="197696">succContents</a> = <a href="#197682" title="=&gt; List[BasicBlocks.this.BasicBlock]">successors</a>.<span title="(f: BasicBlocks.this.BasicBlock =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[List[BasicBlocks.this.BasicBlock],String,List[String]])List[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,String,List[String]]" class="delimiter">(</span><a href="#203825" title="BasicBlocks.this.BasicBlock">_</a>.<a href="#197694" title="=&gt; String">blockContents</a><span class="delimiter">)</span>.<span title="(start: String, sep: String, end: String)String">mkString</span><span class="delimiter">(</span><a href="#197682" title="=&gt; List[BasicBlocks.this.BasicBlock]">successors</a>.<span title="=&gt; Int">size</span> <span title="(x: String)String">+</span> <span title="java.lang.String(&quot; succs:\012&quot;)" class="string">&quot; succs:\n&quot;</span>, <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span>, <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="=&gt; String" id="197697">fullString</a>: <span title="String">String</span> = <span title="(xs: Any*)List[Any]">List</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Block&quot;)" class="string">&quot;Block&quot;</span>, <a href="#197789" title="=&gt; Int">label</a>, <a href="#197691" title="=&gt; java.lang.String">succString</a>, <a href="#197692" title="=&gt; java.lang.String">predString</a>, <a href="#197698" title="=&gt; String">flagsString</a><span class="delimiter">)</span> <span title="(sep: String)String">mkString</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span>    
    <span class="keyword">def</span> <a title="=&gt; String" id="197698">flagsString</a>: <span title="String">String</span> = <a href="#13939" title="object scala.tools.nsc.backend.icode.BBFlags">BBFlags</a>.<a href="#197770" title="(flags: Int)String">flagsToString</a><span class="delimiter">(</span><a href="#197619" title="=&gt; Int">flags</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object scala.tools.nsc.backend.icode.BBFlags" id="13939">BBFlags</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">val</span> <a title="scala.collection.immutable.Map[Int,String]" id="197768">flagMap</a> = <span title="[A, B](elems: (A, B)*)scala.collection.immutable.Map[A,B]">Map</span><span title="(elems: (Int, String)*)scala.collection.immutable.Map[Int,String]" class="delimiter">[</span><span title="Int">Int</span>, <span title="String">String</span><span class="delimiter">]</span><span class="delimiter">(</span>
    <span title="(x: Int)ArrowAssoc[Int]">LOOP_HEADER</span> <span title="(y: java.lang.String)(Int, java.lang.String)">-&gt;</span> <span title="java.lang.String(&quot;loopheader&quot;)" class="string">&quot;loopheader&quot;</span>,
    <span title="(x: Int)ArrowAssoc[Int]">IGNORING</span> <span title="(y: java.lang.String)(Int, java.lang.String)">-&gt;</span> <span title="java.lang.String(&quot;ignore&quot;)" class="string">&quot;ignore&quot;</span>,
    <span title="(x: Int)ArrowAssoc[Int]">EX_HEADER</span> <span title="(y: java.lang.String)(Int, java.lang.String)">-&gt;</span> <span title="java.lang.String(&quot;exheader&quot;)" class="string">&quot;exheader&quot;</span>,
    <span title="(x: Int)ArrowAssoc[Int]">CLOSED</span> <span title="(y: java.lang.String)(Int, java.lang.String)">-&gt;</span> <span title="java.lang.String(&quot;closed&quot;)" class="string">&quot;closed&quot;</span>,
    <span title="(x: Int)ArrowAssoc[Int]">DIRTYSUCCS</span> <span title="(y: java.lang.String)(Int, java.lang.String)">-&gt;</span> <span title="java.lang.String(&quot;dirtysuccs&quot;)" class="string">&quot;dirtysuccs&quot;</span>,
    <span title="(x: Int)ArrowAssoc[Int]">DIRTYPREDS</span> <span title="(y: java.lang.String)(Int, java.lang.String)">-&gt;</span> <span title="java.lang.String(&quot;dirtypreds&quot;)" class="string">&quot;dirtypreds&quot;</span>
  <span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(flags: Int)String" id="197770">flagsToString</a><span class="delimiter">(</span><a title="Int" id="203880">flags</a>: <span title="Int">Int</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#197768" title="=&gt; scala.collection.immutable.Map[Int,String]">flagMap</a> <span title="(pf: PartialFunction[(Int, String),java.lang.String])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Map[Int,String],java.lang.String,scala.collection.immutable.Iterable[java.lang.String]])scala.collection.immutable.Iterable[java.lang.String]">collect</span> <a href="#203992" title="java.lang.String" class="delimiter">{</a> <span class="keyword">case</span> <span title="java.lang.String" class="delimiter">(</span><a title="Int" id="203995">bit</a>, <a title="String" id="203996">name</a><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#203995" title="Int">bit</a> <span title="(x: Int)Int">&amp;</span> <a href="#203880" title="Int">flags</a><span class="delimiter">)</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(0)" class="int">0</span> =&gt; <span title="java.lang.String(&quot;&lt;&quot;)" class="string">&quot;&lt;&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#203996" title="String">name</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;&gt;&quot;)" class="string">&quot;&gt;&quot;</span> <span class="delimiter">}</span> <span title="(sep: String)String">mkString</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span>
  <span class="delimiter">}</span>

  <span class="comment">/** This block is a loop header (was translated from a while). */</span>
  <span class="keyword">final</span> <span class="keyword">val</span> <a title="Int(1)" id="197771">LOOP_HEADER</a> = <span class="delimiter">(</span><span class="int">1</span> <span title="Int(1)">&lt;&lt;</span> <span class="int">0</span><span class="delimiter">)</span>
  
  <span class="comment">/** Ignoring mode: emit instructions are dropped. */</span>
  <span class="keyword">final</span> <span class="keyword">val</span> <a title="Int(2)" id="197773">IGNORING</a>    = <span class="delimiter">(</span><span class="int">1</span> <span title="Int(2)">&lt;&lt;</span> <span class="int">1</span><span class="delimiter">)</span>
  
  <span class="comment">/** This block is the header of an exception handler. */</span>
  <span class="keyword">final</span> <span class="keyword">val</span> <a title="Int(4)" id="197775">EX_HEADER</a>   = <span class="delimiter">(</span><span class="int">1</span> <span title="Int(4)">&lt;&lt;</span> <span class="int">2</span><span class="delimiter">)</span>
  
  <span class="comment">/** This block is closed. No new instructions can be added. */</span>
  <span class="keyword">final</span> <span class="keyword">val</span> <a title="Int(8)" id="197777">CLOSED</a>      = <span class="delimiter">(</span><span class="int">1</span> <span title="Int(8)">&lt;&lt;</span> <span class="int">3</span><span class="delimiter">)</span>

  <span class="comment">/** Code has been changed, recompute successors. */</span>
  <span class="keyword">final</span> <span class="keyword">val</span> <a title="Int(16)" id="197779">DIRTYSUCCS</a>  = <span class="delimiter">(</span><span class="int">1</span> <span title="Int(16)">&lt;&lt;</span> <span class="int">4</span><span class="delimiter">)</span>

  <span class="comment">/** Code has been changed, recompute predecessors. */</span>
  <span class="keyword">final</span> <span class="keyword">val</span> <a title="Int(32)" id="197781">DIRTYPREDS</a>  = <span class="delimiter">(</span><span class="int">1</span> <span title="Int(32)">&lt;&lt;</span> <span class="int">5</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
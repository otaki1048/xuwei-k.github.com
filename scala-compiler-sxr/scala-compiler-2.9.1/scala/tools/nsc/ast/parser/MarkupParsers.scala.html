<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/ast/parser/MarkupParsers.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* NSC -- new Scala compiler
 * Copyright 2005-2011 LAMP/EPFL
 * @author Burak Emir
 */</span>

<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> ast.parser

<span class="keyword">import</span> scala.collection.mutable
<span class="keyword">import</span> mutable.<span class="delimiter">{</span> Buffer, ArrayBuffer, ListBuffer, HashMap <span class="delimiter">}</span>
<span class="keyword">import</span> scala.util.control.ControlThrowable
<span class="keyword">import</span> scala.tools.nsc.util.<span class="delimiter">{</span>SourceFile,CharArrayReader<span class="delimiter">}</span>
<span class="keyword">import</span> scala.xml.<span class="delimiter">{</span> Text, TextBuffer <span class="delimiter">}</span>
<span class="keyword">import</span> scala.xml.<span title="object scala.xml.Utility">Utility</span>.<span class="delimiter">{</span> isNameStart, isNameChar, isSpace <span class="delimiter">}</span>
<span class="keyword">import</span> util.<a href="../../util/Chars.scala.html#30375" title="object scala.tools.nsc.util.Chars">Chars</a>.<span class="delimiter">{</span> SU, LF <span class="delimiter">}</span>

<span class="comment">// XXX/Note: many/most of the functions in here are almost direct cut and pastes</span>
<span class="comment">// from another file - scala.xml.parsing.MarkupParser, it looks like.</span>
<span class="comment">// (It was like that when I got here.) They used to be commented &quot;[Duplicate]&quot; but</span>
<span class="comment">// since approximately all of them were, I snipped it as noise.  As far as I can</span>
<span class="comment">// tell this wasn't for any particularly good reason, but slightly different</span>
<span class="comment">// compiler and library parser interfaces meant it would take some setup.</span>
<span class="comment">//</span>
<span class="comment">// I rewrote most of these, but not as yet the library versions: so if you are</span>
<span class="comment">// tempted to touch any of these, please be aware of that situation and try not</span>
<span class="comment">// to let it get any worse.  -- paulp</span>

<span class="comment">/** This trait ...
 *
 *  @author  Burak Emir
 *  @version 1.0
 */</span>
<span class="keyword">trait</span> <a title="trait MarkupParsers extends java.lang.Object with ScalaObject" id="12777">MarkupParsers</a> <span title="ScalaObject" class="delimiter">{</span>
  self: Parsers =&gt;
  
  case <span class="keyword">object</span> <a href="#168698" title="object MarkupParsers.this.MissingEndTagControl" id="168701">MissingEndTagControl</a> <span title="ScalaObject" class="keyword">extends</span> <span title="scala.util.control.ControlThrowable">ControlThrowable</span> <span class="delimiter">{</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()java.lang.String" id="168684">getMessage</a> = <span title="java.lang.String(&quot;start tag was here: &quot;)" class="string">&quot;start tag was here: &quot;</span>
  <span class="delimiter">}</span>

  case <span class="keyword">object</span> <a href="#168716" title="object MarkupParsers.this.ConfusedAboutBracesControl" id="168719">ConfusedAboutBracesControl</a> <span title="ScalaObject" class="keyword">extends</span> <span title="scala.util.control.ControlThrowable">ControlThrowable</span> <span class="delimiter">{</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()java.lang.String" id="168704">getMessage</a> = <span title="java.lang.String(&quot; I encountered a \'}\' where I didn\'t expect one, maybe this tag isn\'t closed &lt;&quot;)" class="string">&quot; I encountered a '}' where I didn't expect one, maybe this tag isn't closed &lt;&quot;</span>
  <span class="delimiter">}</span>

  case <span class="keyword">object</span> <a href="#168734" title="object MarkupParsers.this.TruncatedXMLControl" id="168737">TruncatedXMLControl</a> <span title="ScalaObject" class="keyword">extends</span> <span title="scala.util.control.ControlThrowable">ControlThrowable</span> <span class="delimiter">{</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()java.lang.String" id="168722">getMessage</a> = <span title="java.lang.String(&quot;input ended while parsing XML&quot;)" class="string">&quot;input ended while parsing XML&quot;</span>
  <span class="delimiter">}</span>

  <span class="keyword">import</span> <a href="Parsers.scala.html#95992" title="=&gt; scala.tools.nsc.Global">global</a>._

  <span class="keyword">class</span> <a title="class MarkupParser extends java.lang.Object with scala.xml.parsing.MarkupParserCommon with ScalaObject" id="96019">MarkupParser</a><a href="#96019" title="ScalaObject" class="delimiter">(</a><a title="MarkupParsers.this.SourceFileParser" id="169270">parser</a>: <a href="Parsers.scala.html#95999" title="MarkupParsers.this.SourceFileParser">SourceFileParser</a>, <span class="keyword">final</span> <span class="keyword">val</span> <a title="Boolean" id="169271">preserveWS</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> <span class="keyword">extends</span> scala.xml.parsing.<span title="scala.xml.parsing.MarkupParserCommon">MarkupParserCommon</span> <span class="delimiter">{</span>

    <span class="keyword">import</span> <a href="Tokens.scala.html#12661" title="object scala.tools.nsc.ast.parser.Tokens">Tokens</a>.<span class="delimiter">{</span> EMPTY, LBRACE, RBRACE <span class="delimiter">}</span>
    
    <span class="keyword">type</span> <a title="MarkupParsers.this.global.Position" id="168830">PositionType</a> = <a href="../../util/Position.scala.html#30599" title="MarkupParsers.this.global.Position">Position</a>
    <span class="keyword">type</span> <a title="scala.tools.nsc.util.CharArrayReader" id="168831">InputType</a>    = <a href="../../util/CharArrayReader.scala.html#30713" title="scala.tools.nsc.util.CharArrayReader">CharArrayReader</a>
    <span class="keyword">type</span> <a title="MarkupParsers.this.global.Tree" id="168832">ElementType</a>  = <span title="MarkupParsers.this.global.Tree">Tree</span>
    <span class="keyword">type</span> <a title="scala.collection.mutable.Map[String,MarkupParsers.this.global.Tree]" id="168833">AttributesType</a> = mutable.<span title="scala.collection.mutable.Map[String,MarkupParsers.this.global.Tree]">Map</span><span class="delimiter">[</span>String, Tree<span class="delimiter">]</span>
    <span class="keyword">type</span> <a title="Any" id="168834">NamespaceType</a> = <span title="Any">Any</span>  <span class="comment">// namespaces ignored</span>
    
    <span class="keyword">def</span> <a title="(name: String, other: MarkupParser.this.NamespaceType)MarkupParser.this.AttributesType" id="168835">mkAttributes</a><span class="delimiter">(</span><a title="String" id="169274">name</a>: <span title="String">String</span>, <a title="MarkupParser.this.NamespaceType" id="169275">other</a>: <span title="MarkupParser.this.NamespaceType">NamespaceType</span><span class="delimiter">)</span>: <span title="MarkupParser.this.AttributesType">AttributesType</span> = <a href="#168864" title="=&gt; scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]">xAttributes</a>
    
    <span class="keyword">val</span> <a title="Boolean" id="168836">eof</a> = <span title="Boolean(false)" class="keyword">false</span>
    
    <span class="keyword">def</span> <a title="(msg: String)Nothing" id="168838">truncatedError</a><span class="delimiter">(</span><a title="String" id="169642">msg</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Nothing">Nothing</span> = <span title="Nothing" class="keyword">throw</span> <a href="#168737" title="object MarkupParsers.this.TruncatedXMLControl">TruncatedXMLControl</a>
    <span class="keyword">def</span> <a title="(that: Char, msg: String)Unit" id="168839">xHandleError</a><span class="delimiter">(</span><a title="Char" id="169644">that</a>: <span title="Char">Char</span>, <a title="String" id="169645">msg</a>: <span title="String">String</span><span class="delimiter">)</span> =
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#168849" title="=&gt; Char">ch</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'\032\')">SU</span><span class="delimiter">)</span> <span title="Nothing" class="keyword">throw</span> <a href="#168737" title="object MarkupParsers.this.TruncatedXMLControl">TruncatedXMLControl</a>
      <span class="keyword">else</span> <a href="#168885" title="(str: String)Unit">reportSyntaxError</a><span class="delimiter">(</span><a href="#169645" title="String">msg</a><span class="delimiter">)</span>

    <span class="keyword">var</span> <a title="scala.tools.nsc.util.CharArrayReader" id="168841">input</a> : <a href="../../util/CharArrayReader.scala.html#30713" title="scala.tools.nsc.util.CharArrayReader">CharArrayReader</a> = _
    <span class="keyword">def</span> <a title="()BufferedIterator[Char]" id="168843">lookahead</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="BufferedIterator[Char]">BufferedIterator</span><span class="delimiter">[</span>Char<span class="delimiter">]</span> =
      <span class="delimiter">(</span><a href="#168841" title="=&gt; scala.tools.nsc.util.CharArrayReader">input</a>.<a href="../../util/CharArrayReader.scala.html#96248" title="implicit scala.Predef.charArrayOps : (xs: Array[Char])scala.collection.mutable.ArrayOps[Char]">buf</a> <span title="implicit scala.Predef.charArrayOps : (xs: Array[Char])scala.collection.mutable.ArrayOps[Char]">drop</span> <a href="#168841" title="=&gt; scala.tools.nsc.util.CharArrayReader">input</a>.<a href="../../util/CharArrayReader.scala.html#96254" title="=&gt; Int">charOffset</a><span class="delimiter">)</span>.<span title="=&gt; Iterator[Char]">iterator</span>.<span title="=&gt; java.lang.Object with scala.collection.BufferedIterator[Char]">buffered</span>

    <span class="keyword">import</span> <a href="#169270" title="MarkupParsers.this.SourceFileParser">parser</a>.<span class="delimiter">{</span> symbXMLBuilder =&gt; handle, o2p, r2p <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="=&gt; Int" id="168845">curOffset</a> : <span title="Int">Int</span> = <a href="#168841" title="=&gt; scala.tools.nsc.util.CharArrayReader">input</a>.<a href="../../util/CharArrayReader.scala.html#96254" title="=&gt; Int">charOffset</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span>
    <span class="keyword">var</span> <a title="MarkupParsers.this.global.Position" id="168847">tmppos</a> : <a href="../../util/Position.scala.html#30599" title="MarkupParsers.this.global.Position">Position</a> = <a href="../../symtab/Positions.scala.html#67891" title="=&gt; tools.nsc.util.NoPosition.type">NoPosition</a>
    <span class="keyword">def</span> <a title="=&gt; Char" id="168849">ch</a> = <a href="#168841" title="=&gt; scala.tools.nsc.util.CharArrayReader">input</a>.<a href="../../util/CharArrayReader.scala.html#96251" title="=&gt; Char">ch</a>
    <span class="comment">/** this method assign the next character to ch and advances in input */</span>
    <span class="keyword">def</span> <a title="=&gt; Char" id="168850">nextch</a> = <span class="delimiter">{</span> <span class="keyword">val</span> <a title="Char" id="169306">result</a> = <a href="#168841" title="=&gt; scala.tools.nsc.util.CharArrayReader">input</a>.<a href="../../util/CharArrayReader.scala.html#96251" title="=&gt; Char">ch</a>; <a href="#168841" title="=&gt; scala.tools.nsc.util.CharArrayReader">input</a>.<a href="../../util/CharArrayReader.scala.html#96267" title="()Unit">nextChar</a><span class="delimiter">(</span><span class="delimiter">)</span>; <a href="#169306" title="Char">result</a> <span class="delimiter">}</span> 
    <span class="keyword">def</span> <a title="=&gt; Char" id="168851">ch_returning_nextch</a> = <a href="#168850" title="=&gt; Char">nextch</a>
    
    <span class="keyword">def</span> <a title="(position: MarkupParsers.this.global.Position, name: String, text: String)MarkupParsers.this.global.Tree" id="168852">mkProcInstr</a><span class="delimiter">(</span><a title="MarkupParsers.this.global.Position" id="169873">position</a>: <a href="../../util/Position.scala.html#30599" title="MarkupParsers.this.global.Position">Position</a>, <a title="String" id="169874">name</a>: <span title="String">String</span>, <a title="String" id="169875">text</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="MarkupParsers.this.global.Tree">Tree</span> =
      <a href="#169270" title="MarkupParsers.this.SourceFileParser">parser</a>.<a href="Parsers.scala.html#169266" title="object MarkupParser.this.parser.symbXMLBuilder">symbXMLBuilder</a>.<a href="SymbolicXMLBuilder.scala.html#169368" title="(pos: MarkupParser.this.parser.symbXMLBuilder.global.Position, target: String, txt: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">procInstr</a><span class="delimiter">(</span><a href="#169873" title="MarkupParsers.this.global.Position">position</a>, <a href="#169874" title="String">name</a>, <a href="#169875" title="String">text</a><span class="delimiter">)</span>

    <span class="keyword">var</span> <a title="Boolean" id="168854">xEmbeddedBlock</a> = <span title="Boolean(false)" class="keyword">false</span>

    <span class="keyword">private</span> <span class="keyword">var</span> <a title="scala.collection.mutable.Stack[(Int, String)]" id="168857">debugLastStartElement</a> = <span title="()scala.collection.mutable.Stack[(Int, String)]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.Stack[(Int, String)]">Stack</span><span class="delimiter">[</span><span class="delimiter">(</span>Int, String<span class="delimiter">)</span><span class="delimiter">]</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; Int" id="168859">debugLastPos</a> = <a href="#168857" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="=&gt; (Int, String)">top</span>.<span title="=&gt; Int">_1</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; String" id="168860">debugLastElem</a> = <a href="#168857" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="=&gt; (Int, String)">top</span>.<span title="=&gt; String">_2</span>
    
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Nothing" id="168861">errorBraces</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="#168885" title="(str: String)Unit">reportSyntaxError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;in XML content, please use \'}}\' to express \'}\'&quot;)" class="string">&quot;in XML content, please use '}}' to express '}'&quot;</span><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">throw</span> <a href="#168719" title="object MarkupParsers.this.ConfusedAboutBracesControl">ConfusedAboutBracesControl</a>
    <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="(tag: String)Nothing" id="168862">errorNoEnd</a><span class="delimiter">(</span><a title="String" id="170123">tag</a>: <span title="String">String</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="#168885" title="(str: String)Unit">reportSyntaxError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;expected closing tag of &quot;)" class="string">&quot;expected closing tag of &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#170123" title="String">tag</a><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">throw</span> <a href="#168701" title="object MarkupParsers.this.MissingEndTagControl">MissingEndTagControl</a>
    <span class="delimiter">}</span>

    <span class="comment">/** checks whether next character starts a Scala block, if yes, skip it.
     * @return true if next character starts a scala block 
     */</span>
    <span class="keyword">def</span> <a title="=&gt; Boolean" id="168863">xCheckEmbeddedBlock</a>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
      <span class="comment">// attentions, side-effect, used in xText</span>
      <a href="#168854" title="(x$1: Boolean)Unit">xEmbeddedBlock</a> = <span class="delimiter">(</span><a href="#168849" title="=&gt; Char">ch</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'{\')" class="char">'{'</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span class="delimiter">{</span> <a href="#168850" title="=&gt; Char">nextch</a>; <span class="delimiter">(</span><a href="#168849" title="=&gt; Char">ch</a> <span title="(x: Char)Boolean">!=</span> <span title="Char(\'{\')" class="char">'{'</span><span class="delimiter">)</span> <span class="delimiter">}</span>
      <a href="#168854" title="=&gt; Boolean">xEmbeddedBlock</a>
    <span class="delimiter">}</span>

    <span class="comment">/** parse attribute and add it to listmap
     *  [41] Attributes   ::= { S Name Eq AttValue }
     *       AttValue     ::= `'` { _  } `'`
     *                      | `&quot;` { _ } `&quot;`
     *                      | `{` scalablock `}`
     */</span>
    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]" id="168864">xAttributes</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]" id="169282">aMap</a> = <span title="()scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]">HashMap</span><span class="delimiter">[</span>String, Tree<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
      
      <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#96019" title="(ch: Char)Boolean">isNameStart</a><span class="delimiter">(</span><a href="#168849" title="=&gt; Char">ch</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#169283" title="()Unit" class="delimiter">{</a>
        <span class="keyword">val</span> <a title="Int" id="169288">start</a> = <a href="#168845" title="=&gt; Int">curOffset</a>
        <span class="keyword">val</span> <a title="String" id="169289">key</a> = <a href="#96019" title="=&gt; String">xName</a>
        <a href="#96019" title="()Unit">xEQ</a>
        <span class="keyword">val</span> <a title="Char" id="169290">delim</a> = <a href="#168849" title="=&gt; Char">ch</a>
        <span class="keyword">val</span> <a title="Int" id="169291">mid</a> = <a href="#168845" title="=&gt; Int">curOffset</a>
        <span class="keyword">val</span> <a title="MarkupParsers.this.global.Tree" id="169292">value</a>: <span title="MarkupParsers.this.global.Tree">Tree</span> = <a href="#168849" title="=&gt; Char">ch</a> <span title="MarkupParsers.this.global.Tree" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="MarkupParsers.this.global.Tree" class="char">'&quot;'</span> | <span title="Char(\'\\\'\')" class="char">'\''</span> =&gt;
            <span class="keyword">val</span> <a title="String" id="169295">tmp</a> = <a href="#96019" title="(endCh: Char)String">xAttributeValue</a><span class="delimiter">(</span><a href="#168851" title="=&gt; Char">ch_returning_nextch</a><span class="delimiter">)</span>
            
            <span class="keyword">try</span> <a href="Parsers.scala.html#169266" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#169374" title="(pos: MarkupParser.this.parser.symbXMLBuilder.global.Position, s: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">parseAttribute</a><span class="delimiter">(</span><a href="Parsers.scala.html#169259" title="(start: Int, mid: Int, end: Int)MarkupParsers.this.global.Position">r2p</a><span class="delimiter">(</span><a href="#169288" title="Int">start</a>, <a href="#169291" title="Int">mid</a>, <a href="#168845" title="=&gt; Int">curOffset</a><span class="delimiter">)</span>, <a href="#169295" title="String">tmp</a><span class="delimiter">)</span>
            <span class="keyword">catch</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <a title="MarkupParsers.this.global.Literal" id="169440">e</a>: <span title="RuntimeException">RuntimeException</span> =&gt; 
                <a href="#96019" title="(msg: String, x: MarkupParsers.this.global.Literal)MarkupParsers.this.global.Literal">errorAndResult</a><span class="delimiter">(</span><span title="java.lang.String(&quot;error parsing attribute value&quot;)" class="string">&quot;error parsing attribute value&quot;</span>, <a href="#169270" title="MarkupParsers.this.SourceFileParser">parser</a>.<a href="Parsers.scala.html#169073" title="=&gt; MarkupParsers.this.global.Literal">errorTermTree</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          
          <span class="keyword">case</span> <span title="MarkupParsers.this.global.Tree" class="char">'{'</span>  =&gt;
            <a href="#168850" title="=&gt; Char">nextch</a>
            <a href="#168882" title="=&gt; MarkupParsers.this.global.Tree">xEmbeddedExpr</a>
          <span class="keyword">case</span> <span title="Nothing">SU</span> =&gt;
            <span title="Nothing" class="keyword">throw</span> <a href="#168737" title="object MarkupParsers.this.TruncatedXMLControl">TruncatedXMLControl</a>
          <span class="keyword">case</span> <span title="MarkupParsers.this.global.Literal">_</span> =&gt;
            <a href="#96019" title="(msg: String, x: MarkupParsers.this.global.Literal)MarkupParsers.this.global.Literal">errorAndResult</a><span class="delimiter">(</span><span title="java.lang.String(&quot;\' or \&quot; delimited attribute value or \'{\' scala-expr \'}\' expected&quot;)" class="string">&quot;' or \&quot; delimited attribute value or '{' scala-expr '}' expected&quot;</span>, <a href="Parsers.scala.html#95992" title="(value: MarkupParsers.this.global.Constant)MarkupParsers.this.global.Literal">Literal</a><span class="delimiter">(</span><a href="Parsers.scala.html#95992" title="(value: Any)MarkupParsers.this.global.Constant">Constant</a><span class="delimiter">(</span><span title="java.lang.String(&quot;&lt;syntax-error&gt;&quot;)" class="string">&quot;&lt;syntax-error&gt;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="comment">// well-formedness constraint: unique attribute names</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#169282" title="scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]">aMap</a> <span title="(key: String)Boolean">contains</span> <a href="#169289" title="String">key</a><span class="delimiter">)</span>
          <a href="#168885" title="(str: String)Unit">reportSyntaxError</a><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;attribute %s may only be defined once&quot;</span> <span title="(args: Any*)String">format</span> <a href="#169289" title="String">key</a><span class="delimiter">)</span>

        <a href="#169282" title="(key: String, value: MarkupParsers.this.global.Tree)Unit">aMap</a><span class="delimiter">(</span><a href="#169289" title="String">key</a><span class="delimiter">)</span> = <a href="#169292" title="MarkupParsers.this.global.Tree">value</a>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#168849" title="=&gt; Char">ch</a> <span title="(x: Char)Boolean">!=</span> <span title="Char(\'/\')" class="char">'/'</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#168849" title="=&gt; Char">ch</a> <span title="(x: Char)Boolean">!=</span> <span title="Char(\'&gt;\')" class="char">'&gt;'</span><span class="delimiter">)</span>
          <a href="#96019" title="()Unit">xSpace</a>
      <span class="delimiter">}</span>
      <a href="#169282" title="scala.collection.mutable.HashMap[String,MarkupParsers.this.global.Tree]">aMap</a>
    <span class="delimiter">}</span>

    <span class="comment">/** '&lt;! CharData ::= [CDATA[ ( {char} - {char}&quot;]]&gt;&quot;{char} ) ']]&gt;'
     *
     * see [15]
     */</span>
    <span class="keyword">def</span> <a title="=&gt; MarkupParsers.this.global.Tree" id="168865">xCharData</a>: <span title="MarkupParsers.this.global.Tree">Tree</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Int" id="170144">start</a> = <a href="#168845" title="=&gt; Int">curOffset</a>
      <a href="#96019" title="(that: Seq[Char])Unit">xToken</a><span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString" class="string">&quot;[CDATA[&quot;</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Int" id="170145">mid</a> = <a href="#168845" title="=&gt; Int">curOffset</a>
      <a href="#96019" title="(handler: (MarkupParser.this.PositionType, String) =&gt; MarkupParser.this.parser.symbXMLBuilder.global.Tree, positioner: () =&gt; MarkupParser.this.PositionType, until: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">xTakeUntil</a><span class="delimiter">(</span><a href="Parsers.scala.html#169266" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#169367" title="(pos: MarkupParser.this.parser.symbXMLBuilder.global.Position, txt: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">charData</a>, <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="Parsers.scala.html#169259" title="(start: Int, mid: Int, end: Int)MarkupParsers.this.global.Position">r2p</a><span class="delimiter">(</span><a href="#170144" title="Int">start</a>, <a href="#170145" title="Int">mid</a>, <a href="#168845" title="=&gt; Int">curOffset</a><span class="delimiter">)</span>, <span title="java.lang.String(&quot;]]&gt;&quot;)" class="string">&quot;]]&gt;&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="=&gt; MarkupParsers.this.global.Tree" id="168866">xUnparsed</a>: <span title="MarkupParsers.this.global.Tree">Tree</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Int" id="170194">start</a> = <a href="#168845" title="=&gt; Int">curOffset</a>
      <a href="#96019" title="(handler: (MarkupParser.this.PositionType, String) =&gt; MarkupParser.this.parser.symbXMLBuilder.global.Tree, positioner: () =&gt; MarkupParser.this.PositionType, until: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">xTakeUntil</a><span class="delimiter">(</span><a href="Parsers.scala.html#169266" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#169379" title="(pos: MarkupParser.this.parser.symbXMLBuilder.global.Position, str: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">unparsed</a>, <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="Parsers.scala.html#169259" title="(start: Int, mid: Int, end: Int)MarkupParsers.this.global.Position">r2p</a><span class="delimiter">(</span><a href="#170194" title="Int">start</a>, <a href="#170194" title="Int">start</a>, <a href="#168845" title="=&gt; Int">curOffset</a><span class="delimiter">)</span>, <span title="java.lang.String(&quot;&lt;/xml:unparsed&gt;&quot;)" class="string">&quot;&lt;/xml:unparsed&gt;&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="comment">/** Comment ::= '&lt;!--' ((Char - '-') | ('-' (Char - '-')))* '--&gt;'
     *
     * see [15]
     */</span>
    <span class="keyword">def</span> <a title="=&gt; MarkupParsers.this.global.Tree" id="168867">xComment</a>: <span title="MarkupParsers.this.global.Tree">Tree</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Int" id="170213">start</a> = <a href="#168845" title="=&gt; Int">curOffset</a> <span title="(x: Int)Int">-</span> <span title="Int(2)" class="int">2</span>   <span class="comment">// Rewinding to include &quot;&lt;!&quot;</span>
      <a href="#96019" title="(that: Seq[Char])Unit">xToken</a><span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString" class="string">&quot;--&quot;</span><span class="delimiter">)</span>
      <a href="#96019" title="(handler: (MarkupParser.this.PositionType, String) =&gt; MarkupParser.this.parser.symbXMLBuilder.global.Tree, positioner: () =&gt; MarkupParser.this.PositionType, until: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">xTakeUntil</a><span class="delimiter">(</span><a href="Parsers.scala.html#169266" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#169366" title="(pos: MarkupParser.this.parser.symbXMLBuilder.global.Position, text: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">comment</a>, <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="Parsers.scala.html#169259" title="(start: Int, mid: Int, end: Int)MarkupParsers.this.global.Position">r2p</a><span class="delimiter">(</span><a href="#170213" title="Int">start</a>, <a href="#170213" title="Int">start</a>, <a href="#168845" title="=&gt; Int">curOffset</a><span class="delimiter">)</span>, <span title="java.lang.String(&quot;--&gt;&quot;)" class="string">&quot;--&gt;&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(pos: MarkupParsers.this.global.Position, ts: scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree], txt: String)Unit" id="168868">appendText</a><span class="delimiter">(</span><a title="MarkupParsers.this.global.Position" id="170260">pos</a>: <a href="../../util/Position.scala.html#30599" title="MarkupParsers.this.global.Position">Position</a>, <a title="scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]" id="170261">ts</a>: <span title="scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]">Buffer</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span>, <a title="String" id="170262">txt</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Seq[String]" id="170264">toAppend</a> =
        <span title="Seq[String]" class="keyword">if</span> <span class="delimiter">(</span><a href="#169271" title="=&gt; Boolean">preserveWS</a><span class="delimiter">)</span> <span title="(elems: String*)Seq[String]">Seq</span><span class="delimiter">(</span><a href="#170262" title="String">txt</a><span class="delimiter">)</span>
        <span class="keyword">else</span> <span title="object scala.xml.TextBuffer">TextBuffer</span>.<span title="(str: String)scala.xml.TextBuffer">fromString</span><span class="delimiter">(</span><a href="#170262" title="String">txt</a><span class="delimiter">)</span>.<span title="=&gt; Seq[scala.xml.Text]">toText</span> <span title="(f: scala.xml.Text =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[scala.xml.Text],String,Seq[String]])Seq[String]">map</span> <span class="delimiter">(</span><a href="#170304" title="scala.xml.Text">_</a>.<span title="=&gt; String">text</span><span class="delimiter">)</span>
      
      <a href="#170264" title="Seq[String]">toAppend</a> <span title="(f: String =&gt; Unit)Unit">foreach</span> <span class="delimiter">(</span><a title="String" id="170377">t</a> =&gt; <a href="#170261" title="scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]">ts</a> <span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span> <a href="Parsers.scala.html#169266" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#169363" title="(pos: MarkupParser.this.parser.symbXMLBuilder.global.Position, txt: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">text</a><span class="delimiter">(</span><a href="#170260" title="MarkupParsers.this.global.Position">pos</a>, <a href="#170377" title="String">t</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="comment">/** adds entity/character to ts as side-effect 
     *  @precond ch == '&amp;'
     */</span>
    <span class="keyword">def</span> <a title="(ts: scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree])Unit" id="168869">content_AMP</a><span class="delimiter">(</span><a title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" id="170385">ts</a>: <span title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ArrayBuffer</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#168850" title="=&gt; Char">nextch</a>
      <span class="keyword">val</span> <a title="MarkupParser.this.parser.symbXMLBuilder.global.Tree" id="170387">toAppend</a> = <a href="#168849" title="=&gt; Char">ch</a> <span title="MarkupParser.this.parser.symbXMLBuilder.global.Tree" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="MarkupParser.this.parser.symbXMLBuilder.global.Tree" class="char">'#'</span> =&gt; <span class="comment">// CharacterRef</span>
          <a href="#168850" title="=&gt; Char">nextch</a>
          <span class="keyword">val</span> <a title="MarkupParser.this.parser.symbXMLBuilder.global.Tree" id="170388">theChar</a> = <a href="Parsers.scala.html#169266" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#169363" title="(pos: MarkupParser.this.parser.symbXMLBuilder.global.Position, txt: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">text</a><span class="delimiter">(</span><a href="#168847" title="=&gt; MarkupParsers.this.global.Position">tmppos</a>, <a href="#96019" title="=&gt; String">xCharRef</a><span class="delimiter">)</span>
          <a href="#96019" title="(that: Char)Unit">xToken</a><span class="delimiter">(</span><span title="Char(\';\')" class="char">';'</span><span class="delimiter">)</span>
          <a href="#170388" title="MarkupParser.this.parser.symbXMLBuilder.global.Tree">theChar</a>
        <span class="keyword">case</span> <span title="MarkupParser.this.parser.symbXMLBuilder.global.Tree">_</span> =&gt;   <span class="comment">// EntityRef</span>
          <span class="keyword">val</span> <a title="String" id="170399">n</a> = <a href="#96019" title="=&gt; String">xName</a>
          <a href="#96019" title="(that: Char)Unit">xToken</a><span class="delimiter">(</span><span title="Char(\';\')" class="char">';'</span><span class="delimiter">)</span>
          <a href="Parsers.scala.html#169266" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#169362" title="(pos: MarkupParser.this.parser.symbXMLBuilder.global.Position, n: String)MarkupParser.this.parser.symbXMLBuilder.global.Tree">entityRef</a><span class="delimiter">(</span><a href="#168847" title="=&gt; MarkupParsers.this.global.Position">tmppos</a>, <a href="#170399" title="String">n</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      
      <a href="#170385" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a> <span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span> <a href="#170387" title="MarkupParser.this.parser.symbXMLBuilder.global.Tree">toAppend</a>
    <span class="delimiter">}</span>

    <span class="comment">/**
     *  @precond ch == '{'
     *  @postcond: xEmbeddedBlock == false!
     */</span>
    <span class="keyword">def</span> <a title="(p: MarkupParsers.this.global.Position, ts: scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree])Unit" id="168870">content_BRACE</a><span class="delimiter">(</span><a title="MarkupParsers.this.global.Position" id="170430">p</a>: <a href="../../util/Position.scala.html#30599" title="MarkupParsers.this.global.Position">Position</a>, <a title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" id="170431">ts</a>: <span title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ArrayBuffer</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#168863" title="=&gt; Boolean">xCheckEmbeddedBlock</a><span class="delimiter">)</span> <a href="#170431" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a> <span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span> <a href="#168882" title="=&gt; MarkupParsers.this.global.Tree">xEmbeddedExpr</a>
      <span class="keyword">else</span> <a href="#168868" title="(pos: MarkupParsers.this.global.Position, ts: scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree], txt: String)Unit">appendText</a><span class="delimiter">(</span><a href="#170430" title="MarkupParsers.this.global.Position">p</a>, <a href="#170431" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>, <a href="#168874" title="=&gt; String">xText</a><span class="delimiter">)</span>

    <span class="comment">/** Returns true if it encounters an end tag (without consuming it),
     *  appends trees to ts as side-effect.
     *
     *  @param ts ...
     *  @return   ...
     */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(ts: scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree])Boolean" id="168871">content_LT</a><span class="delimiter">(</span><a title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" id="170436">ts</a>: <span title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ArrayBuffer</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#168849" title="=&gt; Char">ch</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'/\')" class="char">'/'</span><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">return</span> <span title="Boolean(true)" class="keyword">true</span>   <span class="comment">// end tag</span>
      
      <span class="keyword">val</span> <a title="MarkupParsers.this.global.Tree" id="170438">toAppend</a> = <a href="#168849" title="=&gt; Char">ch</a> <span title="MarkupParsers.this.global.Tree" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="MarkupParsers.this.global.Tree" class="char">'!'</span>    =&gt; <a href="#168850" title="=&gt; Char">nextch</a> ; <span title="MarkupParsers.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#168849" title="=&gt; Char">ch</a> <span title="(x: Char)Boolean">==</span><span title="Char(\'[\')" class="char">'['</span><span class="delimiter">)</span> <a href="#168865" title="=&gt; MarkupParsers.this.global.Tree">xCharData</a> <span class="keyword">else</span> <a href="#168867" title="=&gt; MarkupParsers.this.global.Tree">xComment</a> <span class="comment">// CDATA or Comment</span>
        <span class="keyword">case</span> <span title="MarkupParser.this.ElementType" class="char">'?'</span>    =&gt; <a href="#168850" title="=&gt; Char">nextch</a> ; <a href="#96019" title="=&gt; MarkupParser.this.ElementType">xProcInstr</a>                            <span class="comment">// PI</span>
        <span class="keyword">case</span> <span title="MarkupParsers.this.global.Tree">_</span>      =&gt; <a href="#168873" title="=&gt; MarkupParsers.this.global.Tree">element</a>                                        <span class="comment">// child node</span>
      <span class="delimiter">}</span>
      
      <a href="#170436" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a> <span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span> <a href="#170438" title="MarkupParsers.this.global.Tree">toAppend</a>
      <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="=&gt; scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]" id="168872">content</a>: <span title="scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]">Buffer</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" id="170454">ts</a> = <span title="()scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" class="keyword">new</span> <span title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ArrayBuffer</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span>
      <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#170455" title="Unit" class="keyword">if</a> <span class="delimiter">(</span><a href="#168854" title="=&gt; Boolean">xEmbeddedBlock</a><span class="delimiter">)</span>
          <a href="#170454" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a> <span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span> <a href="#168882" title="=&gt; MarkupParsers.this.global.Tree">xEmbeddedExpr</a>
        <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#168847" title="(x$1: MarkupParsers.this.global.Position)Unit">tmppos</a> = <a href="Parsers.scala.html#169258" title="(offset: Int)MarkupParsers.this.global.Position">o2p</a><span class="delimiter">(</span><a href="#168845" title="=&gt; Int">curOffset</a><span class="delimiter">)</span>
          <a href="#168849" title="=&gt; Char">ch</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="comment">// end tag, cdata, comment, pi or child node</span>
            <span class="keyword">case</span> <span title="Unit" class="char">'&lt;'</span>  =&gt; <a href="#168850" title="=&gt; Char">nextch</a> ; <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#168871" title="(ts: scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree])Boolean">content_LT</a><span class="delimiter">(</span><a href="#170454" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="Nothing" class="keyword">return</span> <a href="#170454" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>
            <span class="comment">// either the character '{' or an embedded scala block }</span>
            <span class="keyword">case</span> <span title="Unit" class="char">'{'</span>  =&gt; <a href="#168870" title="(p: MarkupParsers.this.global.Position, ts: scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree])Unit">content_BRACE</a><span class="delimiter">(</span><a href="#168847" title="=&gt; MarkupParsers.this.global.Position">tmppos</a>, <a href="#170454" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a><span class="delimiter">)</span>  <span class="comment">// }</span>
            <span class="comment">// EntityRef or CharRef </span>
            <span class="keyword">case</span> <span title="Unit" class="char">'&amp;'</span>  =&gt; <a href="#168869" title="(ts: scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree])Unit">content_AMP</a><span class="delimiter">(</span><a href="#170454" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a><span class="delimiter">)</span>
            <span class="keyword">case</span> <span title="Nothing">SU</span>   =&gt; <span title="Nothing" class="keyword">return</span> <a href="#170454" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>
            <span class="comment">// text content - here xEmbeddedBlock might be true</span>
            <span class="keyword">case</span> <span title="Unit">_</span>    =&gt; <a href="#168868" title="(pos: MarkupParsers.this.global.Position, ts: scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree], txt: String)Unit">appendText</a><span class="delimiter">(</span><a href="#168847" title="=&gt; MarkupParsers.this.global.Position">tmppos</a>, <a href="#170454" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>, <a href="#168874" title="=&gt; String">xText</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <a href="#96019" title="=&gt; Nothing">unreachable</a>
    <span class="delimiter">}</span>

    <span class="comment">/** '&lt;' element ::= xmlTag1 '&gt;'  { xmlExpr | '{' simpleExpr '}' } ETag
     *                | xmlTag1 '/' '&gt;'
     */</span>
    <span class="keyword">def</span> <a title="=&gt; MarkupParsers.this.global.Tree" id="168873">element</a>: <span title="MarkupParsers.this.global.Tree">Tree</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Int" id="170460">start</a> = <a href="#168845" title="=&gt; Int">curOffset</a>
      <span class="keyword">val</span> <a href="#170462" title="(String, MarkupParser.this.AttributesType)" class="delimiter">(</a><a href="#170461" title="String" id="170462">qname</a>, <a href="#170461" title="MarkupParser.this.AttributesType" id="170463">attrMap</a><span class="delimiter">)</span> = <a href="#96019" title="(pscope: MarkupParser.this.NamespaceType)(String, MarkupParser.this.AttributesType)">xTag</a><span title="(String, MarkupParser.this.AttributesType) @unchecked" class="delimiter">(</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="MarkupParsers.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#168849" title="=&gt; Char">ch</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'/\')" class="char">'/'</span><span class="delimiter">)</span> <span class="delimiter">{</span> <span class="comment">// empty element</span>
        <a href="#96019" title="(that: Seq[Char])Unit">xToken</a><span class="delimiter">(</span><span title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString" class="string">&quot;/&gt;&quot;</span><span class="delimiter">)</span>
        <a href="Parsers.scala.html#169266" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#169380" title="(pos: MarkupParser.this.parser.symbXMLBuilder.global.Position, qname: String, attrMap: scala.collection.mutable.Map[String,MarkupParser.this.parser.symbXMLBuilder.global.Tree], args: Seq[MarkupParser.this.parser.symbXMLBuilder.global.Tree])MarkupParser.this.parser.symbXMLBuilder.global.Tree">element</a><span class="delimiter">(</span><a href="Parsers.scala.html#169259" title="(start: Int, mid: Int, end: Int)MarkupParsers.this.global.Position">r2p</a><span class="delimiter">(</span><a href="#170460" title="Int">start</a>, <a href="#170460" title="Int">start</a>, <a href="#168845" title="=&gt; Int">curOffset</a><span class="delimiter">)</span>, <a href="#170462" title="String">qname</a>, <a href="#170463" title="MarkupParser.this.AttributesType">attrMap</a>, <span title="scala.collection.mutable.ListBuffer[MarkupParsers.this.global.Tree]" class="keyword">new</span> <span title="scala.collection.mutable.ListBuffer[MarkupParsers.this.global.Tree]">ListBuffer</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">else</span> <span class="delimiter">{</span> <span class="comment">// handle content</span>
        <a href="#96019" title="(that: Char)Unit">xToken</a><span class="delimiter">(</span><span title="Char(\'&gt;\')" class="char">'&gt;'</span><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#170462" title="String">qname</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;xml:unparsed&quot;)" class="string">&quot;xml:unparsed&quot;</span><span class="delimiter">)</span>
          <span title="Nothing" class="keyword">return</span> <a href="#168866" title="=&gt; MarkupParsers.this.global.Tree">xUnparsed</a>

        <a href="#168857" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="(elem: (Int, java.lang.String))scala.collection.mutable.Stack[(Int, String)]">push</span><span class="delimiter">(</span><span title="(_1: Int, _2: String)(Int, String)" class="delimiter">(</span><a href="#170460" title="Int">start</a>, <a href="#170462" title="String">qname</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]" id="170504">ts</a> = <a href="#168872" title="=&gt; scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]">content</a>
        <a href="#96019" title="(startName: String)Unit">xEndTag</a><span class="delimiter">(</span><a href="#170462" title="String">qname</a><span class="delimiter">)</span>
        <a href="#168857" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="()(Int, String)">pop</span>
        <span class="keyword">val</span> <a title="MarkupParsers.this.global.Position" id="170505">pos</a> = <a href="Parsers.scala.html#169259" title="(start: Int, mid: Int, end: Int)MarkupParsers.this.global.Position">r2p</a><span class="delimiter">(</span><a href="#170460" title="Int">start</a>, <a href="#170460" title="Int">start</a>, <a href="#168845" title="=&gt; Int">curOffset</a><span class="delimiter">)</span>
        <a href="#170462" title="String">qname</a> <span title="MarkupParsers.this.global.Tree" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="MarkupParser.this.parser.symbXMLBuilder.global.Tree" class="string">&quot;xml:group&quot;</span> =&gt; <a href="Parsers.scala.html#169266" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#169378" title="(pos: MarkupParser.this.parser.symbXMLBuilder.global.Position, args: Seq[MarkupParser.this.parser.symbXMLBuilder.global.Tree])MarkupParser.this.parser.symbXMLBuilder.global.Tree">group</a><span class="delimiter">(</span><a href="#170505" title="MarkupParsers.this.global.Position">pos</a>, <a href="#170504" title="scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]">ts</a><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="MarkupParser.this.parser.symbXMLBuilder.global.Tree">_</span> =&gt; <a href="Parsers.scala.html#169266" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#169380" title="(pos: MarkupParser.this.parser.symbXMLBuilder.global.Position, qname: String, attrMap: scala.collection.mutable.Map[String,MarkupParser.this.parser.symbXMLBuilder.global.Tree], args: Seq[MarkupParser.this.parser.symbXMLBuilder.global.Tree])MarkupParser.this.parser.symbXMLBuilder.global.Tree">element</a><span class="delimiter">(</span><a href="#170505" title="MarkupParsers.this.global.Position">pos</a>, <a href="#170462" title="String">qname</a>, <a href="#170463" title="MarkupParser.this.AttributesType">attrMap</a>, <a href="#170504" title="scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree]">ts</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="comment">/** parse character data.
     *  precondition: xEmbeddedBlock == false (we are not in a scala block)
     */</span>
    <span class="keyword">def</span> <a title="=&gt; String" id="168874">xText</a>: <span title="String">String</span> = <span class="delimiter">{</span>
      <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#168854" title="=&gt; Boolean">xEmbeddedBlock</a>, <span title="java.lang.String(&quot;internal error: encountered embedded block&quot;)" class="string">&quot;internal error: encountered embedded block&quot;</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="StringBuilder" id="170541">buf</a> = <span title="()StringBuilder" class="keyword">new</span> <span title="StringBuilder">StringBuilder</span>
      <span class="keyword">def</span> <a title="=&gt; java.lang.String" id="170542">done</a> = <a href="#170541" title="StringBuilder">buf</a>.<span title="()java.lang.String">toString</span>
      
      <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#168849" title="=&gt; Char">ch</a> <span title="(x: Char)Boolean">!=</span> <span title="Char(\'\032\')">SU</span><span class="delimiter">)</span> <a href="#170543" title="()Unit" class="delimiter">{</a>
        <span title="AnyVal" class="keyword">if</span> <span class="delimiter">(</span><a href="#168849" title="=&gt; Char">ch</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'}\')" class="char">'}'</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="Char" class="keyword">if</span> <span class="delimiter">(</span><a href="#168876" title="(body: =&gt; Unit)Char">charComingAfter</a><span class="delimiter">(</span><a href="#168850" title="=&gt; Char">nextch</a><span class="delimiter">)</span> <span title="(x: Char)Boolean">==</span> <span title="Char(\'}\')" class="char">'}'</span><span class="delimiter">)</span> <a href="#168850" title="=&gt; Char">nextch</a>
          <span class="keyword">else</span> <a href="#168861" title="()Nothing">errorBraces</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        
        <a href="#170541" title="StringBuilder">buf</a> <span title="(x: Char)StringBuilder">append</span> <a href="#168849" title="=&gt; Char">ch</a>
        <a href="#168850" title="=&gt; Char">nextch</a>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#168863" title="=&gt; Boolean">xCheckEmbeddedBlock</a> <span title="(x: Boolean)Boolean">||</span> <a href="#168849" title="=&gt; Char">ch</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'&lt;\')" class="char">'&lt;'</span> <span title="(x: Boolean)Boolean">||</span>  <a href="#168849" title="=&gt; Char">ch</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'&amp;\')" class="char">'&amp;'</span><span class="delimiter">)</span>
          <span title="Nothing" class="keyword">return</span> <a href="#170542" title="=&gt; java.lang.String">done</a>
      <span class="delimiter">}</span>
      <a href="#170542" title="=&gt; java.lang.String">done</a>
    <span class="delimiter">}</span>
    
    <span class="comment">/** Some try/catch/finally logic used by xLiteral and xLiteralPattern.  */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(f: () =&gt; MarkupParsers.this.global.Tree, ifTruncated: String =&gt; Unit)MarkupParsers.this.global.Tree" id="168875">xLiteralCommon</a><span class="delimiter">(</span><a title="() =&gt; MarkupParsers.this.global.Tree" id="170593">f</a>: <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Tree, <a title="String =&gt; Unit" id="170594">ifTruncated</a>: String =&gt; Unit<span class="delimiter">)</span>: <span title="MarkupParsers.this.global.Tree">Tree</span> = <span class="delimiter">{</span>
      <span class="keyword">try</span> <span title="Nothing" class="keyword">return</span> <a href="#170593" title="()MarkupParsers.this.global.Tree">f</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Unit" id="170596">c</a> @ <a href="#168737" title="object MarkupParsers.this.TruncatedXMLControl">TruncatedXMLControl</a>  =&gt;
          <a href="#170594" title="(v1: String)Unit">ifTruncated</a><span class="delimiter">(</span><a href="#170596" title="object MarkupParsers.this.TruncatedXMLControl">c</a>.<a href="#168722" title="()java.lang.String">getMessage</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="Unit" id="170598">c</a> @ <span class="delimiter">(</span><a href="#168701" title="object MarkupParsers.this.MissingEndTagControl">MissingEndTagControl</a> | <a href="#168719" title="object MarkupParsers.this.ConfusedAboutBracesControl">ConfusedAboutBracesControl</a><span class="delimiter">)</span> =&gt;
          <a href="#169270" title="MarkupParsers.this.SourceFileParser">parser</a>.<a href="Parsers.scala.html#169262" title="(offset: Int, msg: String)Unit">syntaxError</a><span class="delimiter">(</span><a href="#168859" title="=&gt; Int">debugLastPos</a>, <a href="#170598" title="java.lang.Throwable">c</a>.<span title="()java.lang.String">getMessage</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#168860" title="=&gt; String">debugLastElem</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;&gt;&quot;)" class="string">&quot;&gt;&quot;</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Unit">_</span>: <span title="ArrayIndexOutOfBoundsException">ArrayIndexOutOfBoundsException</span> =&gt;
          <a href="#169270" title="MarkupParsers.this.SourceFileParser">parser</a>.<a href="Parsers.scala.html#169262" title="(offset: Int, msg: String)Unit">syntaxError</a><span class="delimiter">(</span><a href="#168859" title="=&gt; Int">debugLastPos</a>, <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;missing end tag in XML literal for &lt;%s&gt;&quot;</span> <span title="(args: Any*)String">format</span> <a href="#168860" title="=&gt; String">debugLastElem</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">finally</span> <a href="#169270" title="MarkupParsers.this.SourceFileParser">parser</a>.<a href="Parsers.scala.html#169251" title="=&gt; MarkupParsers.this.SourceFileScanner">in</a> <a href="Scanners.scala.html#96276" title="(lastCode: Int)Unit">resume</a> Tokens.<span title="Int(96)">XMLSTART</span>
      
      <a href="#169270" title="MarkupParsers.this.SourceFileParser">parser</a>.<a href="Parsers.scala.html#169073" title="=&gt; MarkupParsers.this.global.Literal">errorTermTree</a>
    <span class="delimiter">}</span>
      
    <span class="comment">/** Use a lookahead parser to run speculative body, and return the first char afterward. */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(body: =&gt; Unit)Char" id="168876">charComingAfter</a><span class="delimiter">(</span><a title="=&gt; Unit" id="170558">body</a>: =&gt; Unit<span class="delimiter">)</span>: <span title="Char">Char</span> = <span class="delimiter">{</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="#168841" title="(x$1: scala.tools.nsc.util.CharArrayReader)Unit">input</a> = <a href="#168841" title="=&gt; scala.tools.nsc.util.CharArrayReader">input</a>.<a href="../../util/CharArrayReader.scala.html#96272" title="=&gt; scala.tools.nsc.util.CharArrayReader#CharArrayLookaheadReader">lookaheadReader</a>
        <a href="#170558" title="=&gt; Unit">body</a>
        <a href="#168849" title="=&gt; Char">ch</a>
      <span class="delimiter">}</span>
      <span class="keyword">finally</span> <a href="#168841" title="(x$1: scala.tools.nsc.util.CharArrayReader)Unit">input</a> = <a href="#169270" title="MarkupParsers.this.SourceFileParser">parser</a>.<a href="Parsers.scala.html#169251" title="=&gt; MarkupParsers.this.SourceFileScanner">in</a>
    <span class="delimiter">}</span>

    <span class="comment">/** xLiteral = element { element }
     *  @return Scala representation of this xml literal
     */</span>
    <span class="keyword">def</span> <a title="=&gt; MarkupParsers.this.global.Tree" id="168877">xLiteral</a>: <span title="MarkupParsers.this.global.Tree">Tree</span> = <a href="#168875" title="(f: () =&gt; MarkupParsers.this.global.Tree, ifTruncated: String =&gt; Unit)MarkupParsers.this.global.Tree">xLiteralCommon</a><span class="delimiter">(</span>
      <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="#168841" title="(x$1: scala.tools.nsc.util.CharArrayReader)Unit">input</a> = <a href="#169270" title="MarkupParsers.this.SourceFileParser">parser</a>.<a href="Parsers.scala.html#169251" title="=&gt; MarkupParsers.this.SourceFileScanner">in</a>
        <a href="Parsers.scala.html#169266" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#169328" title="(x$1: Boolean)Unit">isPattern</a> = <span title="Boolean(false)" class="keyword">false</span>
      
        <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" id="170652">ts</a> = <span title="()scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" class="keyword">new</span> <span title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ArrayBuffer</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span>
        <span class="keyword">val</span> <a title="Int" id="170653">start</a> = <a href="#168845" title="=&gt; Int">curOffset</a>
        <a href="#168847" title="(x$1: MarkupParsers.this.global.Position)Unit">tmppos</a> = <a href="Parsers.scala.html#169258" title="(offset: Int)MarkupParsers.this.global.Position">o2p</a><span class="delimiter">(</span><a href="#168845" title="=&gt; Int">curOffset</a><span class="delimiter">)</span>    <span class="comment">// Iuli: added this line, as it seems content_LT uses tmppos when creating trees</span>
        <a href="#168871" title="(ts: scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree])Boolean">content_LT</a><span class="delimiter">(</span><a href="#170652" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a><span class="delimiter">)</span>
      
        <span class="comment">// parse more XML ?        </span>
        <span title="MarkupParsers.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#168876" title="(body: =&gt; Unit)Char">charComingAfter</a><span class="delimiter">(</span><a href="#96019" title="()Unit">xSpaceOpt</a><span class="delimiter">)</span> <span title="(x: Char)Boolean">==</span> <span title="Char(\'&lt;\')" class="char">'&lt;'</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#96019" title="()Unit">xSpaceOpt</a>
          <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#168849" title="=&gt; Char">ch</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'&lt;\')" class="char">'&lt;'</span><span class="delimiter">)</span> <a href="#170662" title="()Unit" class="delimiter">{</a>
            <a href="#168850" title="=&gt; Char">nextch</a>
            <a href="#170652" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a> <span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span> <a href="#168873" title="=&gt; MarkupParsers.this.global.Tree">element</a>
            <a href="#96019" title="()Unit">xSpaceOpt</a>
          <span class="delimiter">}</span>
          <a href="Parsers.scala.html#169266" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#169376" title="(pos: MarkupParser.this.parser.symbXMLBuilder.global.Position, args: Seq[MarkupParser.this.parser.symbXMLBuilder.global.Tree])MarkupParser.this.parser.symbXMLBuilder.global.Block">makeXMLseq</a><span class="delimiter">(</span><a href="Parsers.scala.html#169259" title="(start: Int, mid: Int, end: Int)MarkupParsers.this.global.Position">r2p</a><span class="delimiter">(</span><a href="#170653" title="Int">start</a>, <a href="#170653" title="Int">start</a>, <a href="#168845" title="=&gt; Int">curOffset</a><span class="delimiter">)</span>, <a href="#170652" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">else</span> <span class="delimiter">{</span>
          <span title="(assertion: Boolean)Unit">assert</span><span class="delimiter">(</span><a href="#170652" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
          <a href="#170652" title="(idx: Int)MarkupParsers.this.global.Tree">ts</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>,
      <a title="String" id="170943">msg</a> =&gt; <a href="#169270" title="MarkupParsers.this.SourceFileParser">parser</a>.<a href="Parsers.scala.html#169263" title="(msg: String)Unit">incompleteInputError</a><span class="delimiter">(</span><a href="#170943" title="String">msg</a><span class="delimiter">)</span>
    <span class="delimiter">)</span>

    <span class="comment">/** @see xmlPattern. resynchronizes after successful parse 
     *  @return this xml pattern
     */</span>
    <span class="keyword">def</span> <a title="=&gt; MarkupParsers.this.global.Tree" id="168878">xLiteralPattern</a>: <span title="MarkupParsers.this.global.Tree">Tree</span> = <a href="#168875" title="(f: () =&gt; MarkupParsers.this.global.Tree, ifTruncated: String =&gt; Unit)MarkupParsers.this.global.Tree">xLiteralCommon</a><span class="delimiter">(</span>
      <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
        <a href="#168841" title="(x$1: scala.tools.nsc.util.CharArrayReader)Unit">input</a> = <a href="#169270" title="MarkupParsers.this.SourceFileParser">parser</a>.<a href="Parsers.scala.html#169251" title="=&gt; MarkupParsers.this.SourceFileScanner">in</a>
        <a href="#96019" title="[A, B](getter: A, setter: A =&gt; Unit)(body: =&gt; B)B">saving</a><span title="(getter: Boolean, setter: Boolean =&gt; Unit)(body: =&gt; MarkupParsers.this.global.Tree)MarkupParsers.this.global.Tree" class="delimiter">[</span><span title="Boolean">Boolean</span>, <span title="MarkupParsers.this.global.Tree">Tree</span><span class="delimiter">]</span><span class="delimiter">(</span><a href="Parsers.scala.html#169266" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#169327" title="=&gt; Boolean">isPattern</a>, <a href="Parsers.scala.html#169266" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#169328" title="(x$1: Boolean)Unit">isPattern</a> = <a href="#170955" title="Boolean">_</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="Parsers.scala.html#169266" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#169328" title="(x$1: Boolean)Unit">isPattern</a> = <span title="Boolean(true)" class="keyword">true</span>
          <span class="keyword">val</span> <a title="MarkupParsers.this.global.Tree" id="170956">tree</a> = <a href="#168886" title="=&gt; MarkupParsers.this.global.Tree">xPattern</a>
          <a href="#96019" title="()Unit">xSpaceOpt</a>
          <a href="#170956" title="MarkupParsers.this.global.Tree">tree</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>,
      <a title="String" id="170960">msg</a> =&gt; <a href="#169270" title="MarkupParsers.this.SourceFileParser">parser</a>.<a href="Parsers.scala.html#169262" title="(offset: Int, msg: String)Unit">syntaxError</a><span class="delimiter">(</span><a href="#168845" title="=&gt; Int">curOffset</a>, <a href="#170960" title="String">msg</a><span class="delimiter">)</span>
    <span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="[A](op: =&gt; A, kind: String)A" id="168879">escapeToScala</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="168881">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="=&gt; A" id="170965">op</a>: =&gt; A, <a title="String" id="170966">kind</a>: <span title="String">String</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="#168854" title="(x$1: Boolean)Unit">xEmbeddedBlock</a> = <span title="Boolean(false)" class="keyword">false</span>
      <span class="keyword">val</span> <a title="A" id="170969">res</a> = <a href="#96019" title="[A, B](getter: A, setter: A =&gt; Unit)(body: =&gt; B)B">saving</a><span title="(getter: List[Int], setter: List[Int] =&gt; Unit)(body: =&gt; A)A" class="delimiter">[</span><span title="List[Int]">List</span><span class="delimiter">[</span>Int<span class="delimiter">]</span>, <a href="#168881" title="A">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a href="#169270" title="MarkupParsers.this.SourceFileParser">parser</a>.<a href="Parsers.scala.html#169251" title="=&gt; MarkupParsers.this.SourceFileScanner">in</a>.<a href="Scanners.scala.html#96301" title="=&gt; List[Int]">sepRegions</a>, <a href="#169270" title="MarkupParsers.this.SourceFileParser">parser</a>.<a href="Parsers.scala.html#169251" title="=&gt; MarkupParsers.this.SourceFileScanner">in</a>.<a href="Scanners.scala.html#96302" title="(x$1: List[Int])Unit">sepRegions</a> = <a href="#170974" title="List[Int]">_</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#169270" title="MarkupParsers.this.SourceFileParser">parser</a>.<a href="Parsers.scala.html#169251" title="=&gt; MarkupParsers.this.SourceFileScanner">in</a> <a href="Scanners.scala.html#96276" title="(lastCode: Int)Unit">resume</a> <span title="Int(94)">LBRACE</span>
        <a href="#170965" title="=&gt; A">op</a>
      <span class="delimiter">}</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#169270" title="MarkupParsers.this.SourceFileParser">parser</a>.<a href="Parsers.scala.html#169251" title="=&gt; MarkupParsers.this.SourceFileScanner">in</a>.<a href="Scanners.scala.html#96369" title="=&gt; Int">token</a> <span title="(x: Int)Boolean">!=</span> <span title="Int(95)">RBRACE</span><span class="delimiter">)</span>
        <a href="#168885" title="(str: String)Unit">reportSyntaxError</a><span class="delimiter">(</span><span title="java.lang.String(&quot; expected end of Scala &quot;)" class="string">&quot; expected end of Scala &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#170966" title="String">kind</a><span class="delimiter">)</span>
      
      <a href="#170969" title="A">res</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="=&gt; MarkupParsers.this.global.Tree" id="168882">xEmbeddedExpr</a>: <span title="MarkupParsers.this.global.Tree">Tree</span> = <a href="#168879" title="(op: =&gt; MarkupParsers.this.global.Tree, kind: String)MarkupParsers.this.global.Tree">escapeToScala</a><span class="delimiter">(</span><a href="#169270" title="MarkupParsers.this.SourceFileParser">parser</a>.<a href="Parsers.scala.html#169169" title="()MarkupParsers.this.global.Tree">block</a><span class="delimiter">(</span><span class="delimiter">)</span>, <span title="java.lang.String(&quot;block&quot;)" class="string">&quot;block&quot;</span><span class="delimiter">)</span>

    <span class="comment">/** xScalaPatterns  ::= patterns
     */</span>
    <span class="keyword">def</span> <a title="=&gt; List[MarkupParsers.this.global.Tree]" id="168883">xScalaPatterns</a>: <span title="List[MarkupParsers.this.global.Tree]">List</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span> = <a href="#168879" title="(op: =&gt; List[MarkupParsers.this.global.Tree], kind: String)List[MarkupParsers.this.global.Tree]">escapeToScala</a><span class="delimiter">(</span><a href="#169270" title="MarkupParsers.this.SourceFileParser">parser</a>.<a href="Parsers.scala.html#169190" title="()List[MarkupParsers.this.global.Tree]">seqPatterns</a><span class="delimiter">(</span><span class="delimiter">)</span>, <span title="java.lang.String(&quot;pattern&quot;)" class="string">&quot;pattern&quot;</span><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="(pos: Int, str: String)Unit" id="168884">reportSyntaxError</a><span class="delimiter">(</span><a title="Int" id="169576">pos</a>: <span title="Int">Int</span>, <a title="String" id="169577">str</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#169270" title="MarkupParsers.this.SourceFileParser">parser</a>.<a href="Parsers.scala.html#169262" title="(offset: Int, msg: String)Unit">syntaxError</a><span class="delimiter">(</span><a href="#169576" title="Int">pos</a>, <a href="#169577" title="String">str</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(str: String)Unit" id="168885">reportSyntaxError</a><span class="delimiter">(</span><a title="String" id="169607">str</a>: <span title="String">String</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="#168884" title="(pos: Int, str: String)Unit">reportSyntaxError</a><span class="delimiter">(</span><a href="#168845" title="=&gt; Int">curOffset</a>, <span title="java.lang.String(&quot;in XML literal: &quot;)" class="string">&quot;in XML literal: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#169607" title="String">str</a><span class="delimiter">)</span>
      <a href="#168850" title="=&gt; Char">nextch</a>
    <span class="delimiter">}</span>

    <span class="comment">/** '&lt;' xPattern  ::= Name [S] { xmlPattern | '{' pattern3 '}' } ETag
     *                  | Name [S] '/' '&gt;'
     */</span>
    <span class="keyword">def</span> <a title="=&gt; MarkupParsers.this.global.Tree" id="168886">xPattern</a>: <span title="MarkupParsers.this.global.Tree">Tree</span> = <span class="delimiter">{</span>      
      <span class="keyword">var</span> <a title="Int" id="171012">start</a> = <a href="#168845" title="=&gt; Int">curOffset</a>
      <span class="keyword">val</span> <a title="String" id="171013">qname</a> = <a href="#96019" title="=&gt; String">xName</a>
      <a href="#168857" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="(elem: (Int, java.lang.String))scala.collection.mutable.Stack[(Int, String)]">push</span><span class="delimiter">(</span><span title="(_1: Int, _2: String)(Int, String)" class="delimiter">(</span><a href="#171012" title="Int">start</a>, <a href="#171013" title="String">qname</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#96019" title="()Unit">xSpaceOpt</a>

      <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" id="171014">ts</a> = <span title="()scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]" class="keyword">new</span> <span title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ArrayBuffer</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span>
      <span class="keyword">val</span> <a title="Boolean" id="171015">isEmptyTag</a> = <span class="delimiter">(</span><a href="#168849" title="=&gt; Char">ch</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'/\')" class="char">'/'</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span class="delimiter">{</span> <a href="#168850" title="=&gt; Char">nextch</a> ; <span title="Boolean(true)" class="keyword">true</span> <span class="delimiter">}</span>
      <a href="#96019" title="(that: Char)Unit">xToken</a><span class="delimiter">(</span><span title="Char(\'&gt;\')" class="char">'&gt;'</span><span class="delimiter">)</span>

      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#171015" title="Boolean">isEmptyTag</a><span class="delimiter">)</span> <span class="delimiter">{</span>        
        <span class="comment">// recurses until it hits a termination condition, then returns</span>
        <span class="keyword">def</span> <a title="=&gt; Boolean" id="171037">doPattern</a>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Int" id="171039">start1</a> = <a href="#168845" title="=&gt; Int">curOffset</a>
          <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#168854" title="=&gt; Boolean">xEmbeddedBlock</a><span class="delimiter">)</span> <a href="#171014" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a> <span title="(xs: scala.collection.TraversableOnce[MarkupParsers.this.global.Tree])ts.type">++=</span> <a href="#168883" title="=&gt; List[MarkupParsers.this.global.Tree]">xScalaPatterns</a>
          <span class="keyword">else</span> <a href="#168849" title="=&gt; Char">ch</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="Unit" class="char">'&lt;'</span>  =&gt; <span class="comment">// tag</span>
              <a href="#168850" title="=&gt; Char">nextch</a>
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#168849" title="=&gt; Char">ch</a> <span title="(x: Char)Boolean">!=</span> <span title="Char(\'/\')" class="char">'/'</span><span class="delimiter">)</span> <a href="#171014" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a> <span title="(elems: MarkupParsers.this.global.Tree*)Unit">append</span> <a href="#168886" title="=&gt; MarkupParsers.this.global.Tree">xPattern</a>   <span class="comment">// child</span>
              <span class="keyword">else</span> <span title="Nothing" class="keyword">return</span> <span title="Boolean(false)" class="keyword">false</span>                   <span class="comment">// terminate</span>
              
            <span class="keyword">case</span> <span title="Unit" class="char">'{'</span>  =&gt; <span class="comment">// embedded Scala patterns</span>
              <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#168849" title="=&gt; Char">ch</a> <span title="(x: Char)Boolean">==</span> <span title="Char(\'{\')" class="char">'{'</span><span class="delimiter">)</span> <a href="#171053" title="()Unit" class="delimiter">{</a>
                <a href="#168850" title="=&gt; Char">nextch</a>
                <a href="#171014" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a> <span title="(xs: scala.collection.TraversableOnce[MarkupParsers.this.global.Tree])ts.type">++=</span> <a href="#168883" title="=&gt; List[MarkupParsers.this.global.Tree]">xScalaPatterns</a>
              <span class="delimiter">}</span>
              <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#168854" title="=&gt; Boolean">xEmbeddedBlock</a>, <span title="java.lang.String(&quot;problem with embedded block&quot;)" class="string">&quot;problem with embedded block&quot;</span><span class="delimiter">)</span>
              
            <span class="keyword">case</span> <span title="Nothing">SU</span>   =&gt;
              <span title="Nothing" class="keyword">throw</span> <a href="#168737" title="object MarkupParsers.this.TruncatedXMLControl">TruncatedXMLControl</a>
              
            <span class="keyword">case</span> <span title="Unit">_</span>    =&gt; <span class="comment">// text</span>
              <a href="#168868" title="(pos: MarkupParsers.this.global.Position, ts: scala.collection.mutable.Buffer[MarkupParsers.this.global.Tree], txt: String)Unit">appendText</a><span class="delimiter">(</span><a href="Parsers.scala.html#169259" title="(start: Int, mid: Int, end: Int)MarkupParsers.this.global.Position">r2p</a><span class="delimiter">(</span><a href="#171039" title="Int">start1</a>, <a href="#171039" title="Int">start1</a>, <a href="#168845" title="=&gt; Int">curOffset</a><span class="delimiter">)</span>, <a href="#171014" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a>, <a href="#168874" title="=&gt; String">xText</a><span class="delimiter">)</span>
              <span class="comment">// here xEmbeddedBlock might be true:</span>
              <span class="comment">// if (xEmbeddedBlock) throw new ApplicationError(&quot;after:&quot;+text); // assert</span>
          <span class="delimiter">}</span>
          <span title="Boolean(true)" class="keyword">true</span>
        <span class="delimiter">}</span>
        
        <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#171037" title="=&gt; Boolean">doPattern</a><span class="delimiter">)</span> <a href="#171038" title="Unit" class="delimiter">{</a> <span class="delimiter">}</span>  <span class="comment">// call until false</span>
        <a href="#96019" title="(startName: String)Unit">xEndTag</a><span class="delimiter">(</span><a href="#171013" title="String">qname</a><span class="delimiter">)</span>
        <a href="#168857" title="=&gt; scala.collection.mutable.Stack[(Int, String)]">debugLastStartElement</a>.<span title="()(Int, String)">pop</span>
      <span class="delimiter">}</span>
      
      <a href="Parsers.scala.html#169266" title="object MarkupParser.this.parser.symbXMLBuilder">handle</a>.<a href="SymbolicXMLBuilder.scala.html#169371" title="(pos: MarkupParser.this.parser.symbXMLBuilder.global.Position, n: String, args: Seq[MarkupParser.this.parser.symbXMLBuilder.global.Tree])MarkupParser.this.parser.symbXMLBuilder.global.Tree">makeXMLpat</a><span class="delimiter">(</span><a href="Parsers.scala.html#169259" title="(start: Int, mid: Int, end: Int)MarkupParsers.this.global.Position">r2p</a><span class="delimiter">(</span><a href="#171012" title="Int">start</a>, <a href="#171012" title="Int">start</a>, <a href="#168845" title="=&gt; Int">curOffset</a><span class="delimiter">)</span>, <a href="#171013" title="String">qname</a>, <a href="#171014" title="scala.collection.mutable.ArrayBuffer[MarkupParsers.this.global.Tree]">ts</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span> <span class="comment">/* class MarkupParser */</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
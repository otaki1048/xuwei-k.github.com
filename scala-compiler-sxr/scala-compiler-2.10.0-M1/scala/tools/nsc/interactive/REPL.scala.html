<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/interactive/REPL.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
/* NSC -- new Scala compiler
 * Copyright 2009-2011 Scala Solutions and LAMP/EPFL
 * @author Martin Odersky
 */
<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> interactive

<span class="keyword">import</span> scala.concurrent.SyncVar
<span class="keyword">import</span> scala.tools.nsc.util._
<span class="keyword">import</span> scala.tools.nsc.symtab._
<span class="keyword">import</span> scala.tools.nsc.ast._
<span class="keyword">import</span> scala.tools.nsc.reporters._
<span class="keyword">import</span> scala.tools.nsc.io._
<span class="keyword">import</span> scala.tools.nsc.scratchpad.<span class="delimiter">{</span>Executor, SourceInserter<span class="delimiter">}</span>
<span class="keyword">import</span> scala.tools.nsc.interpreter.AbstractFileClassLoader
<span class="keyword">import</span> java.io.<span class="delimiter">{</span>File, FileWriter<span class="delimiter">}</span>

/** Interface of interactive compiler to a client such as an IDE
 */
<span class="keyword">object</span> <a title="object scala.tools.nsc.interactive.REPL" id="20697">REPL</a> <span title="ScalaObject" class="delimiter">{</span>

  <span class="keyword">val</span> <a title="String" id="434997">versionMsg</a> = <span title="String(&quot;Scala compiler &quot;)" class="string">&quot;Scala compiler &quot;</span> <span title="(x$1: Any)String">+</span>
    <a href="../Properties.scala.html#13302" title="object scala.tools.nsc.Properties">Properties</a>.<span title="=&gt; String">versionString</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot; -- &quot;)" class="string">&quot; -- &quot;</span> <span title="(x$1: Any)String">+</span>
    <a href="../Properties.scala.html#13302" title="object scala.tools.nsc.Properties">Properties</a>.<span title="=&gt; String">copyrightString</span>

  <span class="keyword">val</span> <a title="String" id="434999">prompt</a> = <span title="String(&quot;&gt; &quot;)" class="string">&quot;&gt; &quot;</span>

  <span class="keyword">var</span> <a title="scala.tools.nsc.reporters.ConsoleReporter" id="435002">reporter</a>: <a href="../reporters/ConsoleReporter.scala.html#26911" title="scala.tools.nsc.reporters.ConsoleReporter">ConsoleReporter</a> = _

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(msg: String)Unit" id="435004">replError</a><span class="delimiter">(</span><a title="String" id="435020">msg</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#435002" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#182821" title="(pos: scala.tools.nsc.util.Position, msg: String)Unit">error</a><span class="delimiter">(</span>/*new Position */<a href="../util/Position.scala.html#230894" title="(msg: String)scala.tools.nsc.util.FakePos">FakePos</a><span class="delimiter">(</span><span title="String(&quot;scalac&quot;)" class="string">&quot;scalac&quot;</span><span class="delimiter">)</span>,
                   <a href="#435020" title="String">msg</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;\n  scalac -help  gives more information&quot;)" class="string">&quot;\n  scalac -help  gives more information&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(args: Array[String])Unit" id="435005">process</a><span class="delimiter">(</span><a title="Array[String]" id="435024">args</a>: <span title="Array[String]">Array</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.tools.nsc.Settings" id="435026">settings</a> = <span title="scala.tools.nsc.Settings" class="keyword">new</span> <a href="../Settings.scala.html#12926" title="scala.tools.nsc.Settings">Settings</a><span class="delimiter">(</span><a href="#435004" title="(msg: String)Unit">replError</a><span class="delimiter">)</span>
    <a href="#435002" title="(x$1: scala.tools.nsc.reporters.ConsoleReporter)Unit">reporter</a> = <a href="../reporters/ConsoleReporter.scala.html#208888" title="(settings: scala.tools.nsc.Settings)scala.tools.nsc.reporters.ConsoleReporter" class="keyword">new</a> <a href="../reporters/ConsoleReporter.scala.html#26911" title="scala.tools.nsc.reporters.ConsoleReporter">ConsoleReporter</a><span class="delimiter">(</span><a href="#435026" title="scala.tools.nsc.Settings">settings</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.tools.nsc.CompilerCommand" id="435027">command</a> = <span title="scala.tools.nsc.CompilerCommand" class="keyword">new</span> <a href="../CompilerCommand.scala.html#12653" title="scala.tools.nsc.CompilerCommand">CompilerCommand</a><span class="delimiter">(</span><a href="#435024" title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]">args</a>.<span title="=&gt; List[String]">toList</span>, <a href="#435026" title="scala.tools.nsc.Settings">settings</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#435027" title="scala.tools.nsc.CompilerCommand">command</a>.<a href="../CompilerCommand.scala.html#188131" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/StandardScalaSettings.scala.html#183610" title="=&gt; command.settings.BooleanSetting">version</a>.<a href="../settings/MutableSettings.scala.html#183734" title="=&gt; Boolean">value</a><span class="delimiter">)</span>
      <a href="#435002" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#182817" title="(msg: String)Unit">echo</a><span class="delimiter">(</span><a href="#434997" title="=&gt; String">versionMsg</a><span class="delimiter">)</span>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <span class="keyword">object</span> <a title="object compiler" id="435164">compiler</a> <a href="Global.scala.html#250886" title="ScalaObject" class="keyword">extends</a> <a href="Global.scala.html#20168" title="scala.tools.nsc.interactive.Global">Global</a><span class="delimiter">(</span><a href="#435027" title="scala.tools.nsc.CompilerCommand">command</a>.<a href="../CompilerCommand.scala.html#188131" title="=&gt; scala.tools.nsc.Settings">settings</a>, <a href="#435002" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a><span class="delimiter">)</span> <span class="delimiter">{</span>
//          printTypings = true
        <span class="delimiter">}</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#435002" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#182815" title="=&gt; Boolean">hasErrors</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#435002" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/ConsoleReporter.scala.html#208906" title="()Unit">flush</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <span title="Nothing" class="keyword">return</span>
        <span class="delimiter">}</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#435027" title="scala.tools.nsc.CompilerCommand">command</a>.<a href="../CompilerCommand.scala.html#188152" title="=&gt; Boolean">shouldStopWithInfo</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#435002" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#182817" title="(msg: String)Unit">echo</a><span class="delimiter">(</span><a href="#435027" title="scala.tools.nsc.CompilerCommand">command</a>.<a href="../CompilerCommand.scala.html#188153" title="(global: scala.tools.nsc.Global)String">getInfoMessage</a><span class="delimiter">(</span><a href="#435164" title="object compiler">compiler</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#435008" title="(comp: scala.tools.nsc.interactive.Global)Unit">run</a><span class="delimiter">(</span><a href="#435164" title="object compiler">compiler</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Unit" id="435173">ex</a> @ FatalError<span class="delimiter">(</span><a title="String" id="435174">msg</a><span class="delimiter">)</span> =&gt;
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span> <span title="(x: Boolean)Boolean">||</span> <a href="#435027" title="scala.tools.nsc.CompilerCommand">command</a>.<a href="../CompilerCommand.scala.html#188131" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#183452" title="=&gt; command.settings.BooleanSetting">debug</a>.<a href="../settings/MutableSettings.scala.html#183734" title="=&gt; Boolean">value</a><span class="delimiter">)</span> // !!!
            <a href="#435173" title="scala.reflect.internal.FatalError">ex</a>.<span title="()Unit">printStackTrace</span><span class="delimiter">(</span><span class="delimiter">)</span>;
        <a href="#435002" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#182821" title="(pos: scala.tools.nsc.util.Position, msg: String)Unit">error</a><span class="delimiter">(</span><span title="Null(null)" class="keyword">null</span>, <span title="String(&quot;fatal error: &quot;)" class="string">&quot;fatal error: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#435174" title="String">msg</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(args: Array[String])Unit" id="435006">main</a><span class="delimiter">(</span><a title="Array[String]" id="435177">args</a>: <span title="Array[String]">Array</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#435005" title="(args: Array[String])Unit">process</a><span class="delimiter">(</span><a href="#435177" title="Array[String]">args</a><span class="delimiter">)</span>
    /*sys.*/<span title="(status: Int)Nothing">exit</span><span class="delimiter">(</span><span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#435002" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#182815" title="=&gt; Boolean">hasErrors</a><span class="delimiter">)</span> <span title="Int(1)" class="int">1</span> <span class="keyword">else</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>// Don't use sys yet as this has to run on 2.8.2 also.
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(action: String =&gt; Unit)Unit" id="435007">loop</a><span class="delimiter">(</span><a title="String =&gt; Unit" id="435181">action</a>: <span class="delimiter">(</span>String<span class="delimiter">)</span> =&gt; Unit<span class="delimiter">)</span> <span class="delimiter">{</span>
    <span title="object Console">Console</span>.<span title="(obj: Any)Unit">print</span><span class="delimiter">(</span><a href="#434999" title="=&gt; String">prompt</a><span class="delimiter">)</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="String" id="435183">line</a> = <span title="object Console">Console</span>.<span title="()String">readLine</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#435183" title="String">line</a>.<span title="()Int">length</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#435181" title="(v1: String)Unit">action</a><span class="delimiter">(</span><a href="#435183" title="String">line</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#435007" title="(action: String =&gt; Unit)Unit">loop</a><span class="delimiter">(</span><a href="#435181" title="String =&gt; Unit">action</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Unit">_</span>: java.io.<span title="java.io.EOFException">EOFException</span> =&gt; //nop
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** Commands:
   *
   *  reload file1 ... fileN
   *  typeat file off1 off2?
   *  complete file off1 off2?
   */
  <span class="keyword">def</span> <a title="(comp: scala.tools.nsc.interactive.Global)Unit" id="435008">run</a><span class="delimiter">(</span><a title="scala.tools.nsc.interactive.Global" id="435171">comp</a>: <a href="Global.scala.html#20168" title="scala.tools.nsc.interactive.Global">Global</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.tools.nsc.interactive.Response[Unit]" id="435191">reloadResult</a> = <span title="scala.tools.nsc.interactive.Response[Unit]" class="keyword">new</span> <a href="Response.scala.html#20942" title="scala.tools.nsc.interactive.Response[Unit]">Response</a><span class="delimiter">[</span>Unit<span class="delimiter">]</span>
    <span class="keyword">val</span> <a title="scala.tools.nsc.interactive.Response[comp.Tree]" id="435192">typeatResult</a> = <span title="scala.tools.nsc.interactive.Response[comp.Tree]" class="keyword">new</span> <a href="Response.scala.html#20942" title="scala.tools.nsc.interactive.Response[comp.Tree]">Response</a><span class="delimiter">[</span>comp.Tree<span class="delimiter">]</span>
    <span class="keyword">val</span> <a title="scala.tools.nsc.interactive.Response[List[comp.Member]]" id="435193">completeResult</a> = <span title="scala.tools.nsc.interactive.Response[List[comp.Member]]" class="keyword">new</span> <a href="Response.scala.html#20942" title="scala.tools.nsc.interactive.Response[List[comp.Member]]">Response</a><span class="delimiter">[</span>List<span class="delimiter">[</span>comp.Member<span class="delimiter">]</span><span class="delimiter">]</span>
    <span class="keyword">val</span> <a title="scala.tools.nsc.interactive.Response[comp.Tree]" id="435194">typedResult</a> = <span title="scala.tools.nsc.interactive.Response[comp.Tree]" class="keyword">new</span> <a href="Response.scala.html#20942" title="scala.tools.nsc.interactive.Response[comp.Tree]">Response</a><span class="delimiter">[</span>comp.Tree<span class="delimiter">]</span>
    <span class="keyword">val</span> <a title="scala.tools.nsc.interactive.Response[comp.Tree]" id="435195">structureResult</a> = <span title="scala.tools.nsc.interactive.Response[comp.Tree]" class="keyword">new</span> <a href="Response.scala.html#20942" title="scala.tools.nsc.interactive.Response[comp.Tree]">Response</a><span class="delimiter">[</span>comp.Tree<span class="delimiter">]</span>
    <span class="keyword">val</span> <a title="scala.tools.nsc.interactive.Response[(String, Array[Char])]" id="435196">instrumentedResult</a> = <span title="scala.tools.nsc.interactive.Response[(String, Array[Char])]" class="keyword">new</span> <a href="Response.scala.html#20942" title="scala.tools.nsc.interactive.Response[(String, Array[Char])]">Response</a><span class="delimiter">[</span><span class="delimiter">(</span>String, Array<span class="delimiter">[</span>Char<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">]</span>

    <span class="keyword">def</span> <a title="(file: String, off1: String, off2: String)scala.tools.nsc.util.RangePosition" id="435197">makePos</a><span class="delimiter">(</span><a title="String" id="435206">file</a>: <span title="String">String</span>, <a title="String" id="435207">off1</a>: <span title="String">String</span>, <a title="String" id="435208">off2</a>: <span title="String">String</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.tools.nsc.util.BatchSourceFile" id="435209">source</a> = <a href="#435009" title="(name: String)scala.tools.nsc.util.BatchSourceFile">toSourceFile</a><span class="delimiter">(</span><a href="#435206" title="String">file</a><span class="delimiter">)</span>
      <a href="#435171" title="scala.tools.nsc.interactive.Global">comp</a>.<a href="RangePositions.scala.html#250788" title="(source: scala.tools.nsc.util.SourceFile, start: Int, point: Int, end: Int)scala.tools.nsc.util.RangePosition">rangePos</a><span class="delimiter">(</span><a href="#435209" title="scala.tools.nsc.util.BatchSourceFile">source</a>, <a href="#435207" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">off1</a>.<span title="=&gt; Int">toInt</span>, <a href="#435207" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">off1</a>.<span title="=&gt; Int">toInt</span>, <a href="#435208" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">off2</a>.<span title="=&gt; Int">toInt</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(pos: scala.tools.nsc.util.Position)Unit" id="435198">doTypeAt</a><span class="delimiter">(</span><a title="scala.tools.nsc.util.Position" id="435229">pos</a>: <a href="../util/Position.scala.html#34604" title="scala.tools.nsc.util.Position">Position</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#435171" title="scala.tools.nsc.interactive.Global">comp</a>.<a href="CompilerControl.scala.html#250726" title="(pos: comp.Position, response: comp.Response[comp.Tree])Unit">askTypeAt</a><span class="delimiter">(</span><a href="#435229" title="scala.tools.nsc.util.Position">pos</a>, <a href="#435192" title="scala.tools.nsc.interactive.Response[comp.Tree]">typeatResult</a><span class="delimiter">)</span>
      <a href="#435015" title="(svar: scala.tools.nsc.interactive.Response[comp.Tree])Option[Unit]">show</a><span title="Unit" class="delimiter">(</span><a href="#435192" title="scala.tools.nsc.interactive.Response[comp.Tree]">typeatResult</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(pos: scala.tools.nsc.util.Position)Unit" id="435199">doComplete</a><span class="delimiter">(</span><a title="scala.tools.nsc.util.Position" id="435258">pos</a>: <a href="../util/Position.scala.html#34604" title="scala.tools.nsc.util.Position">Position</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#435171" title="scala.tools.nsc.interactive.Global">comp</a>.<a href="CompilerControl.scala.html#250729" title="(pos: comp.Position, response: comp.Response[List[comp.Member]])Unit">askTypeCompletion</a><span class="delimiter">(</span><a href="#435258" title="scala.tools.nsc.util.Position">pos</a>, <a href="#435193" title="scala.tools.nsc.interactive.Response[List[comp.Member]]">completeResult</a><span class="delimiter">)</span>
      <a href="#435015" title="(svar: scala.tools.nsc.interactive.Response[List[comp.Member]])Option[Unit]">show</a><span title="Unit" class="delimiter">(</span><a href="#435193" title="scala.tools.nsc.interactive.Response[List[comp.Member]]">completeResult</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(file: String)Unit" id="435200">doTypedTree</a><span class="delimiter">(</span><a title="String" id="435264">file</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#435171" title="scala.tools.nsc.interactive.Global">comp</a>.<a href="CompilerControl.scala.html#250727" title="(source: scala.tools.nsc.util.SourceFile, forceReload: Boolean, response: comp.Response[comp.Tree])Unit">askType</a><span class="delimiter">(</span><a href="#435009" title="(name: String)scala.tools.nsc.util.BatchSourceFile">toSourceFile</a><span class="delimiter">(</span><a href="#435264" title="String">file</a><span class="delimiter">)</span>, <span title="Boolean(true)" class="keyword">true</span>, <a href="#435194" title="scala.tools.nsc.interactive.Response[comp.Tree]">typedResult</a><span class="delimiter">)</span>
      <a href="#435015" title="(svar: scala.tools.nsc.interactive.Response[comp.Tree])Option[Unit]">show</a><span title="Unit" class="delimiter">(</span><a href="#435194" title="scala.tools.nsc.interactive.Response[comp.Tree]">typedResult</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(file: String)Unit" id="435201">doStructure</a><span class="delimiter">(</span><a title="String" id="435271">file</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#435171" title="scala.tools.nsc.interactive.Global">comp</a>.<a href="CompilerControl.scala.html#250734" title="(source: scala.tools.nsc.util.SourceFile, keepLoaded: Boolean, response: comp.Response[comp.Tree])Unit">askParsedEntered</a><span class="delimiter">(</span><a href="#435009" title="(name: String)scala.tools.nsc.util.BatchSourceFile">toSourceFile</a><span class="delimiter">(</span><a href="#435271" title="String">file</a><span class="delimiter">)</span>, <span title="Boolean(false)" class="keyword">false</span>, <a href="#435195" title="scala.tools.nsc.interactive.Response[comp.Tree]">structureResult</a><span class="delimiter">)</span>
      <a href="#435015" title="(svar: scala.tools.nsc.interactive.Response[comp.Tree])Option[Unit]">show</a><span title="Unit" class="delimiter">(</span><a href="#435195" title="scala.tools.nsc.interactive.Response[comp.Tree]">structureResult</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    /** Write instrumented source file to disk.
     *  @param iFullName  The full name of the first top-level object in source
     *  @param iContents  An Array[Char] containing the instrumented source
     *  @return The name of the instrumented source file
     */
    <span class="keyword">def</span> <a title="(iFullName: String, iContents: Array[Char])String" id="435202">writeInstrumented</a><span class="delimiter">(</span><a title="String" id="435278">iFullName</a>: <span title="String">String</span>, <a title="Array[Char]" id="435279">iContents</a>: <span title="Array[Char]">Array</span><span class="delimiter">[</span>Char<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="String" id="435280">iSimpleName</a> = <a href="#435278" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">iFullName</a> <span title="(n: Int)String">drop</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#435278" title="String">iFullName</a> <span title="(x$1: Int)Int">lastIndexOf</span> <span title="Int(46)" class="char">'.'</span><span class="delimiter">)</span> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="String" id="435281">iSourceName</a> = <a href="#435280" title="String">iSimpleName</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;$instrumented.scala&quot;)" class="string">&quot;$instrumented.scala&quot;</span>
      <span class="keyword">val</span> <a title="java.io.FileWriter" id="435282">ifile</a> = <span title="java.io.FileWriter" class="keyword">new</span> <span title="java.io.FileWriter">FileWriter</span><span class="delimiter">(</span><a href="#435281" title="String">iSourceName</a><span class="delimiter">)</span>
      <a href="#435282" title="java.io.FileWriter">ifile</a>.<span title="(x$1: Array[Char])Unit">write</span><span class="delimiter">(</span><a href="#435279" title="Array[Char]">iContents</a><span class="delimiter">)</span>
      <a href="#435282" title="java.io.FileWriter">ifile</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#435281" title="String">iSourceName</a>
    <span class="delimiter">}</span>

    /** Compile instrumented source file
     *  @param iSourceName The name of the instrumented source file
     *  @param arguments   Further argumenrs to pass to the compiler
     *  @return Optionallu, if no -d option is given, the virtual directory
     *          contained the generated bytecode classes
     */
    <span class="keyword">def</span> <a title="(iSourceName: String, arguments: List[String])Option[scala.tools.nsc.io.AbstractFile]" id="435203">compileInstrumented</a><span class="delimiter">(</span><a title="String" id="435408">iSourceName</a>: <span title="String">String</span>, <a title="List[String]" id="435409">arguments</a>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Option[scala.tools.nsc.io.AbstractFile]">Option</span><span class="delimiter">[</span>AbstractFile<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;compiling &quot;)" class="string">&quot;compiling &quot;</span><span title="(x$1: Any)String">+</span><a href="#435408" title="String">iSourceName</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.tools.nsc.CompilerCommand" id="435410">command</a> = <a href="../CompilerCommand.scala.html#188134" title="(arguments: List[String], error: String =&gt; Unit)scala.tools.nsc.CompilerCommand" class="keyword">new</a> <a href="../CompilerCommand.scala.html#12653" title="scala.tools.nsc.CompilerCommand">CompilerCommand</a><span class="delimiter">(</span><a href="#435408" title="String">iSourceName</a> <a href="#435418" title="(x: String)List[String]">::</a> <a href="#435409" title="List[String]">arguments</a>, <a href="#435002" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#182821" title="(pos: scala.tools.nsc.util.Position, msg: String)Unit">error</a><span class="delimiter">(</span>scala.tools.nsc.util.<a href="../util/Position.scala.html#34428" title="object scala.tools.nsc.util.NoPosition">NoPosition</a>, <a href="#435425" title="String">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Option[scala.tools.nsc.io.VirtualDirectory]" id="435411">virtualDirectoryOpt</a> =
        <span title="Option[scala.tools.nsc.io.VirtualDirectory]" class="keyword">if</span> <span class="delimiter">(</span><a href="#435409" title="List[String]">arguments</a> <span title="(elem: Any)Boolean">contains</span> <span title="String(&quot;-d&quot;)" class="string">&quot;-d&quot;</span><span class="delimiter">)</span>
          <span title="object None">None</span>
        <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="scala.tools.nsc.io.VirtualDirectory" id="435426">vdir</a> = <span title="scala.tools.nsc.io.VirtualDirectory" class="keyword">new</span> <a href="../io/VirtualDirectory.scala.html#25224" title="scala.tools.nsc.io.VirtualDirectory">VirtualDirectory</a><span class="delimiter">(</span><span title="String(&quot;(memory)&quot;)" class="string">&quot;(memory)&quot;</span>, <span title="object None">None</span><span class="delimiter">)</span>
          <a href="#435410" title="scala.tools.nsc.CompilerCommand">command</a>.<a href="../CompilerCommand.scala.html#188131" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/MutableSettings.scala.html#183246" title="=&gt; command.settings.OutputDirs">outputDirs</a> <a href="../settings/MutableSettings.scala.html#188427" title="(dir: scala.tools.nsc.io.AbstractFile)Unit">setSingleOutput</a> <a href="#435426" title="scala.tools.nsc.io.VirtualDirectory">vdir</a>
          <span title="(x: scala.tools.nsc.io.VirtualDirectory)Some[scala.tools.nsc.io.VirtualDirectory]">Some</span><span class="delimiter">(</span><a href="#435426" title="scala.tools.nsc.io.VirtualDirectory">vdir</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="keyword">val</span> <a title="scala.tools.nsc.Global" id="435412">compiler</a> = <span title="scala.tools.nsc.Global" class="keyword">new</span> scala.tools.nsc.<a href="../Global.scala.html#12521" title="scala.tools.nsc.Global">Global</a><span class="delimiter">(</span><a href="#435410" title="scala.tools.nsc.CompilerCommand">command</a>.<a href="../CompilerCommand.scala.html#188131" title="=&gt; scala.tools.nsc.Settings">settings</a>, <a href="#435002" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="compiler.Run" id="435413">run</a> = <span title="compiler.Run" class="keyword">new</span> <a href="#435412" title="scala.tools.nsc.Global">compiler</a>.<a href="../Global.scala.html#183026" title="compiler.Run">Run</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;compiling: &quot;)" class="string">&quot;compiling: &quot;</span><span title="(x$1: Any)String">+</span><a href="#435410" title="scala.tools.nsc.CompilerCommand">command</a>.<a href="../CompilerCommand.scala.html#188142" title="=&gt; List[String]">files</a><span class="delimiter">)</span>
      <a href="#435413" title="compiler.Run">run</a> <a href="../Global.scala.html#185279" title="(filenames: List[String])Unit">compile</a> <a href="#435410" title="scala.tools.nsc.CompilerCommand">command</a>.<a href="../CompilerCommand.scala.html#188142" title="=&gt; List[String]">files</a>
      <a href="#435411" title="Option[scala.tools.nsc.io.VirtualDirectory]">virtualDirectoryOpt</a>
    <span class="delimiter">}</span>

    /** Run instrumented bytecode file
     *  @param vdir       Optionally, the virtual directory containing the generated bytecode classes
     *  @param iFullName  The full name of the generated object
     *  @param stripped   The contents original source file without any right hand column comments.
     *  @return The generated file content containing original source in the left column
     *          and outputs in the right column
     */
    <span class="keyword">def</span> <a title="(vdirOpt: Option[scala.tools.nsc.io.AbstractFile], iFullName: String, stripped: Array[Char])Array[Char]" id="435204">runInstrumented</a><span class="delimiter">(</span><a title="Option[scala.tools.nsc.io.AbstractFile]" id="435449">vdirOpt</a>: <span title="Option[scala.tools.nsc.io.AbstractFile]">Option</span><span class="delimiter">[</span>AbstractFile<span class="delimiter">]</span>, <a title="String" id="435450">iFullName</a>: <span title="String">String</span>, <a title="Array[Char]" id="435451">stripped</a>: <span title="Array[Char]">Array</span><span class="delimiter">[</span>Char<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Array[Char]">Array</span><span class="delimiter">[</span>Char<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="ClassLoader" id="435452">defaultClassLoader</a> = <span title="()Class[_]">getClass</span>.<span title="()ClassLoader">getClassLoader</span>
      <span class="keyword">val</span> <a title="ClassLoader" id="435453">classLoader</a> = <a href="#435449" title="Option[scala.tools.nsc.io.AbstractFile]">vdirOpt</a> <span title="ClassLoader" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="scala.tools.nsc.interpreter.AbstractFileClassLoader">Some</span><span class="delimiter">(</span><a title="scala.tools.nsc.io.AbstractFile" id="435457">vdir</a><span class="delimiter">)</span> =&gt; <span title="scala.tools.nsc.interpreter.AbstractFileClassLoader" class="keyword">new</span> <a href="../interpreter/AbstractFileClassLoader.scala.html#24429" title="scala.tools.nsc.interpreter.AbstractFileClassLoader">AbstractFileClassLoader</a><span class="delimiter">(</span><a href="#435457" title="scala.tools.nsc.io.AbstractFile">vdir</a>, <a href="#435452" title="ClassLoader">defaultClassLoader</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="ClassLoader">None</span> =&gt; <a href="#435452" title="ClassLoader">defaultClassLoader</a>
      <span class="delimiter">}</span>
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;running &quot;)" class="string">&quot;running &quot;</span><span title="(x$1: Any)String">+</span><a href="#435450" title="String">iFullName</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="scala.tools.nsc.scratchpad.SourceInserter" id="435454">si</a> = <a href="../scratchpad/SourceInserter.scala.html#435497" title="scala.tools.nsc.scratchpad.SourceInserter" class="keyword">new</a> <a href="../scratchpad/SourceInserter.scala.html#26956" title="scala.tools.nsc.scratchpad.SourceInserter">SourceInserter</a><span class="delimiter">(</span><a href="#435451" title="Array[Char]">stripped</a><span class="delimiter">)</span>
      <a href="../scratchpad/Executor.scala.html#26969" title="object scala.tools.nsc.scratchpad.Executor">Executor</a>.<a href="../scratchpad/Executor.scala.html#435507" title="(name: String, si: scala.tools.nsc.scratchpad.SourceInserter, classLoader: ClassLoader)Unit">execute</a><span class="delimiter">(</span><a href="#435450" title="String">iFullName</a>, <a href="#435454" title="scala.tools.nsc.scratchpad.SourceInserter">si</a>, <a href="#435453" title="ClassLoader">classLoader</a><span class="delimiter">)</span>
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;done&quot;)" class="string">&quot;done&quot;</span><span class="delimiter">)</span>
      <a href="#435454" title="scala.tools.nsc.scratchpad.SourceInserter">si</a>.<a href="../scratchpad/SourceInserter.scala.html#435488" title="=&gt; Array[Char]">currentContents</a>
    <span class="delimiter">}</span>

    /** The method for implementing worksheet functionality.
     *  @param arguments  a file name, followed by optional command line arguments that are passed
     *                    to the compiler that processes the instrumented source.
     *  @param line       A line number that controls uop to which line results should be produced
     *                    If line = -1, results are produced for all expressions in the worksheet.
     *  @return           The generated file content containing original source in the left column
     *                    and outputs in the right column, or None if the presentation compiler
     *                    does not respond to askInstrumented.
     */
    <span class="keyword">def</span> <a title="(arguments: List[String], line: Int)Option[Array[Char]]" id="435205">instrument</a><span class="delimiter">(</span><a title="List[String]" id="435562">arguments</a>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="Int" id="435563">line</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Option[Array[Char]]">Option</span><span class="delimiter">[</span>Array<span class="delimiter">[</span>Char<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.tools.nsc.util.BatchSourceFile" id="435564">source</a> = <a href="#435009" title="(name: String)scala.tools.nsc.util.BatchSourceFile">toSourceFile</a><span class="delimiter">(</span><a href="#435562" title="List[String]">arguments</a>.<span title="=&gt; String">head</span><span class="delimiter">)</span>
      // strip right hand side comment column and any trailing spaces from all lines
      <span class="keyword">val</span> <a title="scala.tools.nsc.util.BatchSourceFile" id="435565">strippedSource</a> = <span title="scala.tools.nsc.util.BatchSourceFile" class="keyword">new</span> <a href="../util/SourceFile.scala.html#34862" title="scala.tools.nsc.util.BatchSourceFile">BatchSourceFile</a><span class="delimiter">(</span><a href="#435564" title="scala.tools.nsc.util.BatchSourceFile">source</a>.<a href="../util/SourceFile.scala.html#228749" title="=&gt; scala.tools.nsc.io.AbstractFile">file</a>, <a href="../scratchpad/SourceInserter.scala.html#26957" title="object scala.tools.nsc.scratchpad.SourceInserter">SourceInserter</a>.<a href="../scratchpad/SourceInserter.scala.html#435496" title="(cs: Array[Char])Array[Char]">stripRight</a><span class="delimiter">(</span><a href="#435564" title="scala.tools.nsc.util.BatchSourceFile">source</a>.<a href="../util/SourceFile.scala.html#228751" title="=&gt; Array[Char]">content</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#435171" title="scala.tools.nsc.interactive.Global">comp</a>.<a href="CompilerControl.scala.html#250724" title="(sources: List[scala.tools.nsc.util.SourceFile], response: comp.Response[Unit])Unit">askReload</a><span class="delimiter">(</span><span title="(xs: scala.tools.nsc.util.BatchSourceFile*)List[scala.tools.nsc.util.BatchSourceFile]">List</span><span class="delimiter">(</span><a href="#435565" title="scala.tools.nsc.util.BatchSourceFile">strippedSource</a><span class="delimiter">)</span>, <a href="#435191" title="scala.tools.nsc.interactive.Response[Unit]">reloadResult</a><span class="delimiter">)</span>
      <a href="#435171" title="scala.tools.nsc.interactive.Global">comp</a>.<a href="CompilerControl.scala.html#250735" title="(source: scala.tools.nsc.util.SourceFile, line: Int, response: comp.Response[(String, Array[Char])])Unit">askInstrumented</a><span class="delimiter">(</span><a href="#435565" title="scala.tools.nsc.util.BatchSourceFile">strippedSource</a>, <a href="#435563" title="Int">line</a>, <a href="#435196" title="scala.tools.nsc.interactive.Response[(String, Array[Char])]">instrumentedResult</a><span class="delimiter">)</span>
      <a href="#435010" title="(svar: scala.tools.nsc.interactive.Response[(String, Array[Char])])(op: ((String, Array[Char])) =&gt; Array[Char])Option[Array[Char]]">using</a><span class="delimiter">(</span><a href="#435196" title="scala.tools.nsc.interactive.Response[(String, Array[Char])]">instrumentedResult</a><span class="delimiter">)</span> <a href="#435593" title="Array[Char]" class="delimiter">{</a>
        <span class="keyword">case</span> <span title="Array[Char]" class="delimiter">(</span><a title="String" id="435596">iFullName</a>, <a title="Array[Char]" id="435597">iContents</a><span class="delimiter">)</span> =&gt;
          <span class="keyword">val</span> <a title="String" id="435598">iSourceName</a> = <a href="#435202" title="(iFullName: String, iContents: Array[Char])String">writeInstrumented</a><span class="delimiter">(</span><a href="#435596" title="String">iFullName</a>, <a href="#435597" title="Array[Char]">iContents</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Option[scala.tools.nsc.io.AbstractFile]" id="435599">vdirOpt</a> = <a href="#435203" title="(iSourceName: String, arguments: List[String])Option[scala.tools.nsc.io.AbstractFile]">compileInstrumented</a><span class="delimiter">(</span><a href="#435598" title="String">iSourceName</a>, <a href="#435562" title="List[String]">arguments</a>.<span title="=&gt; List[String]">tail</span><span class="delimiter">)</span>
          <a href="#435204" title="(vdirOpt: Option[scala.tools.nsc.io.AbstractFile], iFullName: String, stripped: Array[Char])Array[Char]">runInstrumented</a><span class="delimiter">(</span><a href="#435599" title="Option[scala.tools.nsc.io.AbstractFile]">vdirOpt</a>, <a href="#435596" title="String">iFullName</a>, <a href="#435565" title="scala.tools.nsc.util.BatchSourceFile">strippedSource</a>.<a href="../util/SourceFile.scala.html#228751" title="=&gt; Array[Char]">content</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <a href="#435007" title="(action: String =&gt; Unit)Unit">loop</a> <span class="delimiter">{</span> <a title="String" id="435603">line</a> =&gt;
      <span class="delimiter">(</span><a href="#435603" title="String">line</a> <span title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]">split</span> <span title="String(&quot; &quot;)" class="string">&quot; &quot;</span><span class="delimiter">)</span>.<span title="=&gt; List[String]">toList</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Unit" class="string">&quot;reload&quot;</span> :: <a title="List[String]" id="435713">args</a> =&gt;
          <a href="#435171" title="scala.tools.nsc.interactive.Global">comp</a>.<a href="CompilerControl.scala.html#250724" title="(sources: List[scala.tools.nsc.util.SourceFile], response: comp.Response[Unit])Unit">askReload</a><span class="delimiter">(</span><a href="#435713" title="List[String]">args</a> <span title="(f: String =&gt; scala.tools.nsc.util.BatchSourceFile)(implicit bf: scala.collection.generic.CanBuildFrom[List[String],scala.tools.nsc.util.BatchSourceFile,List[scala.tools.nsc.util.SourceFile]])List[scala.tools.nsc.util.SourceFile]">map</span> <a href="#435009" title="(name: String)scala.tools.nsc.util.BatchSourceFile">toSourceFile</a>, <a href="#435191" title="scala.tools.nsc.interactive.Response[Unit]">reloadResult</a><span class="delimiter">)</span>
          <a href="#435015" title="(svar: scala.tools.nsc.interactive.Response[Unit])Option[Unit]">show</a><span title="Unit" class="delimiter">(</span><a href="#435191" title="scala.tools.nsc.interactive.Response[Unit]">reloadResult</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Unit" class="string">&quot;reloadAndAskType&quot;</span> :: <a title="String" id="435772">file</a> :: <a title="String" id="435777">millis</a> :: <span title="object Nil">Nil</span> =&gt;
          <a href="#435171" title="scala.tools.nsc.interactive.Global">comp</a>.<a href="CompilerControl.scala.html#250724" title="(sources: List[scala.tools.nsc.util.SourceFile], response: comp.Response[Unit])Unit">askReload</a><span class="delimiter">(</span><span title="(xs: scala.tools.nsc.util.BatchSourceFile*)List[scala.tools.nsc.util.BatchSourceFile]">List</span><span class="delimiter">(</span><a href="#435009" title="(name: String)scala.tools.nsc.util.BatchSourceFile">toSourceFile</a><span class="delimiter">(</span><a href="#435772" title="String">file</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#435191" title="scala.tools.nsc.interactive.Response[Unit]">reloadResult</a><span class="delimiter">)</span>
          <span title="object Thread">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><a href="#435777" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">millis</a>.<span title="=&gt; Long">toInt</span><span class="delimiter">)</span>
          <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;ask type now&quot;)" class="string">&quot;ask type now&quot;</span><span class="delimiter">)</span>
          <a href="#435171" title="scala.tools.nsc.interactive.Global">comp</a>.<a href="CompilerControl.scala.html#250727" title="(source: scala.tools.nsc.util.SourceFile, forceReload: Boolean, response: comp.Response[comp.Tree])Unit">askType</a><span class="delimiter">(</span><a href="#435009" title="(name: String)scala.tools.nsc.util.BatchSourceFile">toSourceFile</a><span class="delimiter">(</span><a href="#435772" title="String">file</a><span class="delimiter">)</span>, <span title="Boolean(false)" class="keyword">false</span>, <a href="#435194" title="scala.tools.nsc.interactive.Response[comp.Tree]">typedResult</a><span class="delimiter">)</span>
          <a href="#435194" title="scala.tools.nsc.interactive.Response[comp.Tree]">typedResult</a>.<a href="Response.scala.html#251017" title="=&gt; Either[comp.Tree,Throwable]">get</a>
        <span class="keyword">case</span> <a href="#435795" title="Unit">List</a><span class="delimiter">(</span><span title="String(&quot;typed&quot;)" class="string">&quot;typed&quot;</span>, <a title="String" id="435817">file</a><span class="delimiter">)</span> =&gt;
          <a href="#435200" title="(file: String)Unit">doTypedTree</a><span class="delimiter">(</span><a href="#435817" title="String">file</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="#435819" title="Unit">List</a><span class="delimiter">(</span><span title="String(&quot;typeat&quot;)" class="string">&quot;typeat&quot;</span>, <a title="String" id="435830">file</a>, <a title="String" id="435831">off1</a>, <a title="String" id="435832">off2</a><span class="delimiter">)</span> =&gt;
          <a href="#435198" title="(pos: scala.tools.nsc.util.Position)Unit">doTypeAt</a><span class="delimiter">(</span><a href="#435197" title="(file: String, off1: String, off2: String)scala.tools.nsc.util.RangePosition">makePos</a><span class="delimiter">(</span><a href="#435830" title="String">file</a>, <a href="#435831" title="String">off1</a>, <a href="#435832" title="String">off2</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="#435834" title="Unit">List</a><span class="delimiter">(</span><span title="String(&quot;typeat&quot;)" class="string">&quot;typeat&quot;</span>, <a title="String" id="435845">file</a>, <a title="String" id="435846">off1</a><span class="delimiter">)</span> =&gt;
          <a href="#435198" title="(pos: scala.tools.nsc.util.Position)Unit">doTypeAt</a><span class="delimiter">(</span><a href="#435197" title="(file: String, off1: String, off2: String)scala.tools.nsc.util.RangePosition">makePos</a><span class="delimiter">(</span><a href="#435845" title="String">file</a>, <a href="#435846" title="String">off1</a>, <a href="#435846" title="String">off1</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="#435848" title="Unit">List</a><span class="delimiter">(</span><span title="String(&quot;complete&quot;)" class="string">&quot;complete&quot;</span>, <a title="String" id="435859">file</a>, <a title="String" id="435860">off1</a>, <a title="String" id="435861">off2</a><span class="delimiter">)</span> =&gt;
          <a href="#435199" title="(pos: scala.tools.nsc.util.Position)Unit">doComplete</a><span class="delimiter">(</span><a href="#435197" title="(file: String, off1: String, off2: String)scala.tools.nsc.util.RangePosition">makePos</a><span class="delimiter">(</span><a href="#435859" title="String">file</a>, <a href="#435860" title="String">off1</a>, <a href="#435861" title="String">off2</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="#435863" title="Unit">List</a><span class="delimiter">(</span><span title="String(&quot;complete&quot;)" class="string">&quot;complete&quot;</span>, <a title="String" id="435874">file</a>, <a title="String" id="435875">off1</a><span class="delimiter">)</span> =&gt;
          <a href="#435199" title="(pos: scala.tools.nsc.util.Position)Unit">doComplete</a><span class="delimiter">(</span><a href="#435197" title="(file: String, off1: String, off2: String)scala.tools.nsc.util.RangePosition">makePos</a><span class="delimiter">(</span><a href="#435874" title="String">file</a>, <a href="#435875" title="String">off1</a>, <a href="#435875" title="String">off1</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Unit" class="string">&quot;instrument&quot;</span> :: <a title="List[String]" id="435880">arguments</a> =&gt;
          <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="#435205" title="(arguments: List[String], line: Int)Option[Array[Char]]">instrument</a><span class="delimiter">(</span><a href="#435880" title="List[String]">arguments</a>, -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span>.<span title="(f: Array[Char] =&gt; String)Option[String]">map</span><span class="delimiter">(</span><a href="#435887" title="implicit scala.Predef.charArrayOps : (xs: Array[Char])scala.collection.mutable.ArrayOps[Char]">_</a>.<span title="=&gt; String">mkString</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Unit" class="string">&quot;instrumentTo&quot;</span> :: <a title="String" id="436037">line</a> :: <a title="List[String]" id="436038">arguments</a> =&gt;
          <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><a href="#435205" title="(arguments: List[String], line: Int)Option[Array[Char]]">instrument</a><span class="delimiter">(</span><a href="#436038" title="List[String]">arguments</a>, <a href="#436037" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">line</a>.<span title="=&gt; Int">toInt</span><span class="delimiter">)</span>.<span title="(f: Array[Char] =&gt; String)Option[String]">map</span><span class="delimiter">(</span><a href="#436047" title="implicit scala.Predef.charArrayOps : (xs: Array[Char])scala.collection.mutable.ArrayOps[Char]">_</a>.<span title="=&gt; String">mkString</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="#436190" title="Nothing">List</a><span class="delimiter">(</span><span title="String(&quot;quit&quot;)" class="string">&quot;quit&quot;</span><span class="delimiter">)</span> =&gt;
          <a href="#435171" title="scala.tools.nsc.interactive.Global">comp</a>.<a href="CompilerControl.scala.html#250737" title="()Unit">askShutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <span title="(status: Int)Nothing">exit</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span> // Don't use sys yet as this has to run on 2.8.2 also.
        <span class="keyword">case</span> <a href="#436204" title="Unit">List</a><span class="delimiter">(</span><span title="String(&quot;structure&quot;)" class="string">&quot;structure&quot;</span>, <a title="String" id="436215">file</a><span class="delimiter">)</span> =&gt;
          <a href="#435201" title="(file: String)Unit">doStructure</a><span class="delimiter">(</span><a href="#436215" title="String">file</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
          <span title="(x: Any)Unit">print</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;Available commands:
                  | reload &lt;file_1&gt; ... &lt;file_n&gt;
                  | reloadAndAskType &lt;file&gt; &lt;sleep-ms&gt;
                  | typed &lt;file&gt;
                  | typeat &lt;file&gt; &lt;start-pos&gt; &lt;end-pos&gt;
                  | typeat &lt;file&gt; &lt;pos&gt;
                  | complete &lt;file&gt; &lt;start-pos&gt; &lt;end-pos&gt;
                  | compile &lt;file&gt; &lt;pos&gt;
                  | instrument &lt;file&gt; &lt;arg&gt;*
                  | instrumentTo &lt;line-num&gt; &lt;file&gt; &lt;arg&gt;*
                  | structure &lt;file&gt;
                  | quit
                  |&quot;&quot;&quot;</span>.<span title="=&gt; String">stripMargin</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(name: String)scala.tools.nsc.util.BatchSourceFile" id="435009">toSourceFile</a><span class="delimiter">(</span><a title="String" id="435210">name</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="../util/SourceFile.scala.html#228754" title="(_file: scala.tools.nsc.io.AbstractFile)scala.tools.nsc.util.BatchSourceFile" class="keyword">new</a> <a href="../util/SourceFile.scala.html#34862" title="scala.tools.nsc.util.BatchSourceFile">BatchSourceFile</a><span class="delimiter">(</span><span title="scala.tools.nsc.io.PlainFile" class="keyword">new</span> <a href="../io/PlainFile.scala.html#25518" title="scala.tools.nsc.io.PlainFile">PlainFile</a><span class="delimiter">(</span><a href="../io/Path.scala.html#187344" title="implicit scala.tools.nsc.io.Path.jfile2path : (jfile: scala.tools.nsc.io.JFile)scala.tools.nsc.io.Path" class="keyword">new</a> java.io.<span title="java.io.File">File</span><span class="delimiter">(</span><a href="#435210" title="String">name</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="[T, U](svar: scala.tools.nsc.interactive.Response[T])(op: T =&gt; U)Option[U]" id="435010">using</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="435013">T</a>, <a title="&gt;: Nothing &lt;: Any" id="435014">U</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="scala.tools.nsc.interactive.Response[T]" id="435235">svar</a>: <a href="Response.scala.html#20942" title="scala.tools.nsc.interactive.Response[T]">Response</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="T =&gt; U" id="435236">op</a>: T =&gt; U<span class="delimiter">)</span>: <span title="Option[U]">Option</span><span class="delimiter">[</span>U<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Option[U]" id="436226">res</a> = <a href="#435235" title="scala.tools.nsc.interactive.Response[T]">svar</a>.<a href="Response.scala.html#251017" title="=&gt; Either[T,Throwable]">get</a> <span title="Option[U]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Some[U]">Left</span><span class="delimiter">(</span><a title="T" id="436230">result</a><span class="delimiter">)</span> =&gt; <span title="(x: U)Some[U]">Some</span><span class="delimiter">(</span><a href="#435236" title="(v1: T)U">op</a><span class="delimiter">(</span><a href="#436230" title="T">result</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="None.type">Right</span><span class="delimiter">(</span><a title="Throwable" id="436236">exc</a><span class="delimiter">)</span> =&gt; <a href="#436236" title="Throwable">exc</a>.<span title="()Unit">printStackTrace</span>; <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;ERROR: &quot;)" class="string">&quot;ERROR: &quot;</span><span title="(x$1: Any)String">+</span><a href="#436236" title="Throwable">exc</a><span class="delimiter">)</span>; <span title="object None">None</span>
    <span class="delimiter">}</span>
    <a href="#435235" title="scala.tools.nsc.interactive.Response[T]">svar</a>.<a href="Response.scala.html#251022" title="()Unit">clear</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#436226" title="Option[U]">res</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[T](svar: scala.tools.nsc.interactive.Response[T])Option[Unit]" id="435015">show</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="435017">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="scala.tools.nsc.interactive.Response[T]" id="435232">svar</a>: <a href="Response.scala.html#20942" title="scala.tools.nsc.interactive.Response[T]">Response</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#435010" title="(svar: scala.tools.nsc.interactive.Response[T])(op: T =&gt; Unit)Option[Unit]">using</a><span class="delimiter">(</span><a href="#435232" title="scala.tools.nsc.interactive.Response[T]">svar</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="T" id="435249">res</a> =&gt; <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;==&gt; &quot;)" class="string">&quot;==&gt; &quot;</span><span title="(x$1: Any)String">+</span><a href="#435249" title="T">res</a><span class="delimiter">)</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/interactive/ScratchPadMaker.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> interactive

<span class="keyword">import</span> util.<span class="delimiter">{</span>SourceFile, BatchSourceFile, RangePosition<span class="delimiter">}</span>
<span class="keyword">import</span> collection.mutable.ArrayBuffer
<span class="keyword">import</span> reflect.internal.<a href="../../../reflect/internal/Chars.scala.html#7499" title="object scala.reflect.internal.Chars">Chars</a>.isLineBreakChar

<span class="keyword">trait</span> <a title="trait ScratchPadMaker extends Object with ScalaObject" id="20582">ScratchPadMaker</a> <span title="ScalaObject" class="delimiter">{</span> self: Global =&gt;

  <span class="keyword">import</span> <a href="../../../reflect/internal/Definitions.scala.html#40473" title="object ScratchPadMaker.this.definitions">definitions</a>._

  <span class="keyword">private</span> case <span class="keyword">class</span> <a title="class Patch extends Object with ScalaObject with Product with Serializable" id="444586">Patch</a><a href="#444586" title="ScalaObject" class="delimiter">(</a><a title="Int" id="440990">offset</a>: <span title="Int">Int</span>, <a title="String" id="440991">text</a>: <span title="String">String</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">class</span> <a title="class Patcher extends ScratchPadMaker.this.Traverser with ScalaObject" id="250834">Patcher</a><a href="#250834" title="ScalaObject" class="delimiter">(</a><a title="Array[Char]" id="440947">contents</a>: <span title="Array[Char]">Array</span><span class="delimiter">[</span>Char<span class="delimiter">]</span>, <a title="Int" id="440948">endOffset</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#20582" title="ScratchPadMaker.this.Traverser">Traverser</a> <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="String" id="440909">objectName</a>: <span title="String">String</span> = <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span>

    <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]" id="440911">patches</a> = <span title="()scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]" class="keyword">new</span> <span title="scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]">ArrayBuffer</span><span class="delimiter">[</span>Patch<span class="delimiter">]</span>
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[String]" id="440913">toPrint</a> = <span title="()scala.collection.mutable.ArrayBuffer[String]" class="keyword">new</span> <span title="scala.collection.mutable.ArrayBuffer[String]">ArrayBuffer</span><span class="delimiter">[</span>String<span class="delimiter">]</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="440916">skipped</a> = <span title="Int(0)" class="int">0</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="440919">resNum</a>: <span title="Int">Int</span> = -<span title="Int(-1)" class="int">1</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="()String" id="440921">nextRes</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
      <a href="#440919" title="(x$1: Int)Unit">resNum</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
      <span title="String(&quot;res$&quot;)" class="string">&quot;res$&quot;</span><span title="(x$1: Any)String">+</span><a href="#440919" title="=&gt; Int">resNum</a>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(name: String, tpe: ScratchPadMaker.this.Type)String" id="440922">nameType</a><span class="delimiter">(</span><a title="String" id="440956">name</a>: <span title="String">String</span>, <a title="ScratchPadMaker.this.Type" id="440957">tpe</a>: <a href="../../../reflect/internal/Types.scala.html#40083" title="ScratchPadMaker.this.Type">Type</a><span class="delimiter">)</span>: <span title="String">String</span> = <a href="#440956" title="String">name</a><span title="(x$1: Any)String">+</span><span title="String(&quot;: &quot;)" class="string">&quot;: &quot;</span><span title="(x$1: Any)String">+</span><a href="#440957" title="ScratchPadMaker.this.Type">tpe</a>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: ScratchPadMaker.this.Symbol)String" id="440923">nameType</a><span class="delimiter">(</span><a title="ScratchPadMaker.this.Symbol" id="440959">sym</a>: <a href="../../../reflect/internal/Symbols.scala.html#40001" title="ScratchPadMaker.this.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="String">String</span> = <a href="#440922" title="(name: String, tpe: ScratchPadMaker.this.Type)String">nameType</a><span class="delimiter">(</span><a href="#440959" title="ScratchPadMaker.this.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#47883" title="=&gt; ScratchPadMaker.this.Name">name</a>.<span title="()String">toString</span>, <a href="#440959" title="ScratchPadMaker.this.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; ScratchPadMaker.this.Type">tpe</a><span class="delimiter">)</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(str: String)String" id="440924">literal</a><span class="delimiter">(</span><a title="String" id="440966">str</a>: <span title="String">String</span><span class="delimiter">)</span> = <span title="String(&quot;\&quot;\&quot;\&quot;&quot;)" class="string">&quot;\&quot;\&quot;\&quot;&quot;</span><span title="(x$1: Any)String">+</span><a href="#440966" title="String">str</a><span title="(x$1: Any)String">+</span><span title="String(&quot;\&quot;\&quot;\&quot;&quot;)" class="string">&quot;\&quot;\&quot;\&quot;&quot;</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(offset: Int)Unit" id="440925">applyPendingPatches</a><span class="delimiter">(</span><a title="Int" id="440969">offset</a>: <span title="Int">Int</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#440916" title="=&gt; Int">skipped</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#440911" title="=&gt; scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]">patches</a> <span title="(elem: ScratchPadMaker.this.Patch)Patcher.this.patches.type">+=</span> <a href="#444586" title="(offset: Int, text: String)ScratchPadMaker.this.Patch">Patch</a><span class="delimiter">(</span><a href="#440969" title="Int">offset</a>, <span title="String(&quot;import scala.tools.nsc.scratchpad.Executor._; &quot;)" class="string">&quot;import scala.tools.nsc.scratchpad.Executor._; &quot;</span><span class="delimiter">)</span>
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="String" id="441090">msg</a> &lt;- <a href="#440913" title="(f: String =&gt; scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch])Unit">toPrint</a><span class="delimiter">)</span> <a href="#440911" title="=&gt; scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]">patches</a> <span title="(elem: ScratchPadMaker.this.Patch)Patcher.this.patches.type">+=</span> <a href="#444586" title="(offset: Int, text: String)ScratchPadMaker.this.Patch">Patch</a><span class="delimiter">(</span><a href="#440969" title="Int">offset</a>, <span title="String(&quot;;System.out.println(&quot;)" class="string">&quot;;System.out.println(&quot;</span><span title="(x$1: Any)String">+</span><a href="#441090" title="String">msg</a><span title="(x$1: Any)String">+</span><span title="String(&quot;)&quot;)" class="string">&quot;)&quot;</span><span class="delimiter">)</span>
      <a href="#440913" title="=&gt; scala.collection.mutable.ArrayBuffer[String]">toPrint</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(stat: ScratchPadMaker.this.Tree)Unit" id="440926">addSkip</a><span class="delimiter">(</span><a title="ScratchPadMaker.this.Tree" id="441094">stat</a>: <span title="ScratchPadMaker.this.Tree">Tree</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#441094" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Position">pos</span>.<a href="../util/Position.scala.html#183793" title="=&gt; Int">start</a> <span title="(x: Int)Boolean">&gt;</span> <a href="#440916" title="=&gt; Int">skipped</a><span class="delimiter">)</span> <a href="#440925" title="(offset: Int)Unit">applyPendingPatches</a><span class="delimiter">(</span><a href="#441094" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Position">pos</span>.<a href="../util/Position.scala.html#183793" title="=&gt; Int">start</a><span class="delimiter">)</span>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#441094" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Position">pos</span>.<a href="../util/Position.scala.html#183793" title="=&gt; Int">start</a> <span title="(x: Int)Boolean">&gt;=</span> <a href="#440948" title="Int">endOffset</a><span class="delimiter">)</span>
        <a href="#440911" title="=&gt; scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]">patches</a> <span title="(elem: ScratchPadMaker.this.Patch)Patcher.this.patches.type">+=</span> <a href="#444586" title="(offset: Int, text: String)ScratchPadMaker.this.Patch">Patch</a><span class="delimiter">(</span><a href="#441094" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Position">pos</span>.<a href="../util/Position.scala.html#183793" title="=&gt; Int">start</a>, <span title="String(&quot;;$stop()&quot;)" class="string">&quot;;$stop()&quot;</span><span class="delimiter">)</span>
      <span class="keyword">var</span> <a title="Int" id="441096">end</a> = <a href="#441094" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Position">pos</span>.<a href="../util/Position.scala.html#183797" title="=&gt; Int">end</a>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#441096" title="Int">end</a> <span title="(x: Int)Boolean">&gt;</span> <a href="#440916" title="=&gt; Int">skipped</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#441096" title="Int">end</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#440947" title="Array[Char]">contents</a>.<span title="=&gt; Int">length</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><span class="delimiter">(</span><a href="../../../reflect/internal/Chars.scala.html#68275" title="(c: Char)Boolean">isLineBreakChar</a><span class="delimiter">(</span><a href="#440947" title="(i: Int)Char">contents</a><span class="delimiter">(</span><a href="#441096" title="Int">end</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#441096" title="Int">end</a> <a href="#441117" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
        <a href="#440911" title="=&gt; scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]">patches</a> <span title="(elem: ScratchPadMaker.this.Patch)Patcher.this.patches.type">+=</span> <a href="#444586" title="(offset: Int, text: String)ScratchPadMaker.this.Patch">Patch</a><span class="delimiter">(</span><a href="#441094" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Position">pos</span>.<a href="../util/Position.scala.html#183793" title="=&gt; Int">start</a>, <span title="String(&quot;;$skip(&quot;)" class="string">&quot;;$skip(&quot;</span><span title="(x$1: Any)String">+</span><span class="delimiter">(</span><a href="#441096" title="Int">end</a><span title="(x: Int)Int">-</span><a href="#440916" title="=&gt; Int">skipped</a><span class="delimiter">)</span><span title="(x$1: Any)String">+</span><span title="String(&quot;); &quot;)" class="string">&quot;); &quot;</span><span class="delimiter">)</span>
        <a href="#440916" title="(x$1: Int)Unit">skipped</a> = <a href="#441096" title="Int">end</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(expr: ScratchPadMaker.this.Tree)Unit" id="440927">addSandbox</a><span class="delimiter">(</span><a title="ScratchPadMaker.this.Tree" id="441132">expr</a>: <span title="ScratchPadMaker.this.Tree">Tree</span><span class="delimiter">)</span> = <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>
//      patches += (Patch(expr.pos.start, &quot;sandbox(&quot;), Patch(expr.pos.end, &quot;)&quot;))

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(prefix: String, expr: String)String" id="440928">resultString</a><span class="delimiter">(</span><a title="String" id="441135">prefix</a>: <span title="String">String</span>, <a title="String" id="441136">expr</a>: <span title="String">String</span><span class="delimiter">)</span> =
      <a href="#440924" title="(str: String)String">literal</a><span class="delimiter">(</span><a href="#441135" title="String">prefix</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; = &quot;)" class="string">&quot; = &quot;</span><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot; + $show(&quot;)" class="string">&quot; + $show(&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#441136" title="String">expr</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;)&quot;)" class="string">&quot;)&quot;</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(stat: ScratchPadMaker.this.Tree)Any" id="440929">traverseStat</a><span class="delimiter">(</span><a title="ScratchPadMaker.this.Tree" id="441139">stat</a>: <span title="ScratchPadMaker.this.Tree">Tree</span><span class="delimiter">)</span> =
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#441139" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Position">pos</span>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="../util/Position.scala.html#35279" title="scala.tools.nsc.util.RangePosition">RangePosition</a><span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#441139" title="ScratchPadMaker.this.Tree">stat</a> <span title="Any" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Any">ValDef</span><span class="delimiter">(</span>_, _, _, <a title="ScratchPadMaker.this.Tree" id="441150">rhs</a><span class="delimiter">)</span> =&gt;
            <a href="#440926" title="(stat: ScratchPadMaker.this.Tree)Unit">addSkip</a><span class="delimiter">(</span><a href="#441139" title="ScratchPadMaker.this.Tree">stat</a><span class="delimiter">)</span>
            <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#441139" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Symbol">symbol</span>.<a href="../../../reflect/internal/HasFlags.scala.html#48081" title="=&gt; Boolean">isLazy</a><span class="delimiter">)</span>
              <a href="#440913" title="=&gt; scala.collection.mutable.ArrayBuffer[String]">toPrint</a> <span title="(elem: String)Patcher.this.toPrint.type">+=</span> <a href="#440924" title="(str: String)String">literal</a><span class="delimiter">(</span><a href="#440923" title="(sym: ScratchPadMaker.this.Symbol)String">nameType</a><span class="delimiter">(</span><a href="#441139" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Symbol">symbol</span><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot; = &lt;lazy&gt;&quot;)" class="string">&quot; = &lt;lazy&gt;&quot;</span><span class="delimiter">)</span>
            <span class="keyword">else</span> <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#441139" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Symbol">symbol</span>.<a href="../../../reflect/internal/HasFlags.scala.html#48086" title="=&gt; Boolean">isSynthetic</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#440927" title="(expr: ScratchPadMaker.this.Tree)Unit">addSandbox</a><span class="delimiter">(</span><a href="#441150" title="ScratchPadMaker.this.Tree">rhs</a><span class="delimiter">)</span>
              <a href="#440913" title="=&gt; scala.collection.mutable.ArrayBuffer[String]">toPrint</a> <span title="(elem: String)Patcher.this.toPrint.type">+=</span> <a href="#440928" title="(prefix: String, expr: String)String">resultString</a><span class="delimiter">(</span><a href="#440923" title="(sym: ScratchPadMaker.this.Symbol)String">nameType</a><span class="delimiter">(</span><a href="#441139" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Symbol">symbol</span><span class="delimiter">)</span>, <a href="#441139" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Symbol">symbol</span>.<a href="../../../reflect/internal/Symbols.scala.html#47883" title="=&gt; ScratchPadMaker.this.Name">name</a>.<span title="()String">toString</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="keyword">case</span> <span title="Patcher.this.toPrint.type">DefDef</span><span class="delimiter">(</span>_, _, _, _, _, _<span class="delimiter">)</span> =&gt;
            <a href="#440926" title="(stat: ScratchPadMaker.this.Tree)Unit">addSkip</a><span class="delimiter">(</span><a href="#441139" title="ScratchPadMaker.this.Tree">stat</a><span class="delimiter">)</span>
            <a href="#440913" title="=&gt; scala.collection.mutable.ArrayBuffer[String]">toPrint</a> <span title="(elem: String)Patcher.this.toPrint.type">+=</span> <a href="#440924" title="(str: String)String">literal</a><span class="delimiter">(</span><a href="#440923" title="(sym: ScratchPadMaker.this.Symbol)String">nameType</a><span class="delimiter">(</span><a href="#441139" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Symbol">symbol</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Unit">Annotated</span><span class="delimiter">(</span>_, <a title="ScratchPadMaker.this.Tree" id="441249">arg</a><span class="delimiter">)</span> =&gt;
            <a href="#440930" title="(tree: ScratchPadMaker.this.Tree)Unit">traverse</a><span class="delimiter">(</span><a href="#441249" title="ScratchPadMaker.this.Tree">arg</a><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Unit">DocDef</span><span class="delimiter">(</span>_, <a title="ScratchPadMaker.this.Tree" id="441255">defn</a><span class="delimiter">)</span> =&gt;
            <a href="#440930" title="(tree: ScratchPadMaker.this.Tree)Unit">traverse</a><span class="delimiter">(</span><a href="#441255" title="ScratchPadMaker.this.Tree">defn</a><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Any">_</span> =&gt;
            <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#441139" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; Boolean">isTerm</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#440926" title="(stat: ScratchPadMaker.this.Tree)Unit">addSkip</a><span class="delimiter">(</span><a href="#441139" title="ScratchPadMaker.this.Tree">stat</a><span class="delimiter">)</span>
              <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#441139" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Type">tpe</span>.<a href="../../../reflect/internal/Types.scala.html#42728" title="=&gt; ScratchPadMaker.this.Symbol">typeSymbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#46834" title="=&gt; ScratchPadMaker.this.Symbol">UnitClass</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="#440927" title="(expr: ScratchPadMaker.this.Tree)Unit">addSandbox</a><span class="delimiter">(</span><a href="#441139" title="ScratchPadMaker.this.Tree">stat</a><span class="delimiter">)</span>
              <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
                <span class="keyword">val</span> <a title="String" id="441262">resName</a> = <a href="#440921" title="()String">nextRes</a><span class="delimiter">(</span><span class="delimiter">)</span>
                <span class="keyword">val</span> <a title="String" id="441263">dispResName</a> = <a href="#441262" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">resName</a> <span title="(p: Char =&gt; Boolean)String">filter</span> <span class="delimiter">(</span><span title="Char('$')" class="char">'$'</span> <a href="#441441" title="(x: Char)Boolean">!=</a><span class="delimiter">)</span>
                <a href="#440911" title="=&gt; scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]">patches</a> <span title="(elem: ScratchPadMaker.this.Patch)Patcher.this.patches.type">+=</span> <a href="#444586" title="(offset: Int, text: String)ScratchPadMaker.this.Patch">Patch</a><span class="delimiter">(</span><a href="#441139" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Position">pos</span>.<a href="../util/Position.scala.html#183793" title="=&gt; Int">start</a>, <span title="String(&quot;val &quot;)" class="string">&quot;val &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#441262" title="String">resName</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; = &quot;)" class="string">&quot; = &quot;</span><span class="delimiter">)</span>
                <a href="#440927" title="(expr: ScratchPadMaker.this.Tree)Unit">addSandbox</a><span class="delimiter">(</span><a href="#441139" title="ScratchPadMaker.this.Tree">stat</a><span class="delimiter">)</span>
                <a href="#440913" title="=&gt; scala.collection.mutable.ArrayBuffer[String]">toPrint</a> <span title="(elem: String)Patcher.this.toPrint.type">+=</span> <a href="#440928" title="(prefix: String, expr: String)String">resultString</a><span class="delimiter">(</span><a href="#440922" title="(name: String, tpe: ScratchPadMaker.this.Type)String">nameType</a><span class="delimiter">(</span><a href="#441263" title="String">dispResName</a>, <a href="#441139" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Type">tpe</span><span class="delimiter">)</span>, <a href="#441262" title="String">resName</a><span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: ScratchPadMaker.this.Tree)Unit" id="440930">traverse</a><span class="delimiter">(</span><a title="ScratchPadMaker.this.Tree" id="441250">tree</a>: <span title="ScratchPadMaker.this.Tree">Tree</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#441250" title="ScratchPadMaker.this.Tree">tree</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Unit">PackageDef</span><span class="delimiter">(</span>_, _<span class="delimiter">)</span> =&gt;
        <a href="#250834" title="ScratchPadMaker.this.Patcher" class="keyword">super</a>.<span title="(tree: ScratchPadMaker.this.Tree)Unit">traverse</span><span class="delimiter">(</span><a href="#441250" title="ScratchPadMaker.this.Tree">tree</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">ModuleDef</span><span class="delimiter">(</span>_, <a title="ScratchPadMaker.this.TermName" id="441483">name</a>, Template<span class="delimiter">(</span>_, _, <a title="List[ScratchPadMaker.this.Tree]" id="441495">body</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#440909" title="=&gt; String">objectName</a>.<span title="()Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span> /* objectName.isEmpty does not compile on Java 5 due to ambiguous implicit conversions: augmentString, stringToTermName */<span class="delimiter">)</span>
          <a href="#440909" title="(x$1: String)Unit">objectName</a> = <a href="#441250" title="ScratchPadMaker.this.Tree">tree</a>.<span title="=&gt; ScratchPadMaker.this.Symbol">symbol</span>.<a href="../../../reflect/internal/Symbols.scala.html#47897" title="=&gt; String">fullName</a>
        <a href="#441495" title="List[ScratchPadMaker.this.Tree]">body</a> <span title="(f: ScratchPadMaker.this.Tree =&gt; Any)Unit">foreach</span> <a href="#440929" title="(stat: ScratchPadMaker.this.Tree)Any">traverseStat</a>
        <a href="#440925" title="(offset: Int)Unit">applyPendingPatches</a><span class="delimiter">(</span><a href="#440916" title="=&gt; Int">skipped</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
    <span class="delimiter">}</span>

    /** The patched text.
     *  @require  traverse is run first
     */
    <span class="keyword">def</span> <a title="=&gt; Array[Char]" id="440931">result</a>: <span title="Array[Char]">Array</span><span class="delimiter">[</span>Char<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Int" id="441528">reslen</a> = <a href="#440947" title="Array[Char]">contents</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">+</span> <span class="delimiter">(</span><a href="#440911" title="=&gt; scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]">patches</a> <span title="(f: ScratchPadMaker.this.Patch =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch],Int,scala.collection.mutable.ArrayBuffer[Int]])scala.collection.mutable.ArrayBuffer[Int]">map</span> <span class="delimiter">(</span><a href="#441553" title="ScratchPadMaker.this.Patch">_</a>.<a href="#440991" title="=&gt; String">text</a>.<span title="()Int">length</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(implicit num: Numeric[Int])Int">sum</span>
      <span class="keyword">val</span> <a title="Array[Char]" id="441529">res</a> = <span title="object Array">Array</span>.<span title="[T](n1: Int)(implicit evidence$3: scala.reflect.ClassManifest[T])Array[T]">ofDim</span><span title="(n1: Int)(implicit evidence$3: scala.reflect.ClassManifest[Char])Array[Char]" class="delimiter">[</span><span title="Char">Char</span><span class="delimiter">]</span><span title="=&gt; scala.reflect.AnyValManifest[Char]" class="delimiter">(</span><a href="#441528" title="Int">reslen</a><span class="delimiter">)</span>
      <span class="keyword">var</span> <a title="Int" id="441530">lastOffset</a> = <span title="Int(0)" class="int">0</span>
      <span class="keyword">var</span> <a title="Int" id="441531">from</a> = <span title="Int(0)" class="int">0</span>
      <span class="keyword">var</span> <a title="Int" id="441532">to</a> = <span title="Int(0)" class="int">0</span>
      <span class="keyword">for</span> <span class="delimiter">(</span>Patch<span class="delimiter">(</span><a title="Int" id="441859">offset</a>, <a title="String" id="441860">text</a><span class="delimiter">)</span> &lt;- <a href="#440911" title="(f: ScratchPadMaker.this.Patch =&gt; Unit)Unit">patches</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Int" id="441861">delta</a> = <a href="#441859" title="Int">offset</a> <span title="(x: Int)Int">-</span> <a href="#441530" title="Int">lastOffset</a>
        <span title="(assertion: Boolean)Unit">assert</span><span class="delimiter">(</span><a href="#441861" title="Int">delta</a> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
        <span title="object Array">Array</span>.<span title="(src: AnyRef, srcPos: Int, dest: AnyRef, destPos: Int, length: Int)Unit">copy</span><span class="delimiter">(</span><a href="#440947" title="Array[Char]">contents</a>, <a href="#441531" title="Int">from</a>, <a href="#441529" title="Array[Char]">res</a>, <a href="#441532" title="Int">to</a>, <a href="#441861" title="Int">delta</a><span class="delimiter">)</span>
        <a href="#441531" title="Int">from</a> <span title="(x: Int)Int">+=</span> <a href="#441861" title="Int">delta</a>
        <a href="#441532" title="Int">to</a> <span title="(x: Int)Int">+=</span> <a href="#441861" title="Int">delta</a>
        <a href="#441530" title="Int">lastOffset</a> = <a href="#441859" title="Int">offset</a>
        <a href="#441860" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">text</a>.<span title="(xs: Array[Char], start: Int)Unit">copyToArray</span><span class="delimiter">(</span><a href="#441529" title="Array[Char]">res</a>, <a href="#441532" title="Int">to</a><span class="delimiter">)</span>
        <a href="#441532" title="Int">to</a> <span title="(x: Int)Int">+=</span> <a href="#441860" title="String">text</a>.<span title="()Int">length</span>
      <span class="delimiter">}</span>
      <span title="(assertion: Boolean)Unit">assert</span><span class="delimiter">(</span><a href="#440947" title="Array[Char]">contents</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">-</span> <a href="#441531" title="Int">from</a> <span title="(x: Int)Boolean">==</span> <a href="#441528" title="Int">reslen</a> <span title="(x: Int)Int">-</span> <a href="#441532" title="Int">to</a><span class="delimiter">)</span>
      <span title="object Array">Array</span>.<span title="(src: AnyRef, srcPos: Int, dest: AnyRef, destPos: Int, length: Int)Unit">copy</span><span class="delimiter">(</span><a href="#440947" title="Array[Char]">contents</a>, <a href="#441531" title="Int">from</a>, <a href="#441529" title="Array[Char]">res</a>, <a href="#441532" title="Int">to</a>, <a href="#440947" title="Array[Char]">contents</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">-</span> <a href="#441531" title="Int">from</a><span class="delimiter">)</span>
      <a href="#441529" title="Array[Char]">res</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** Compute an instrumented version of a sourcefile.
   *  @param source  The given sourcefile.
   *  @param line    The line up to which results should be printed, -1 = whole document.
   *  @return        A pair consisting of
   *                  - the fully qualified name of the first top-level object definition in the file.
   *                    or &quot;&quot; if there are no object definitions.
   *                  - the text of the instrumented program which, when run,
   *                    prints its output and all defined values in a comment column.
   */
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(source: scala.tools.nsc.util.SourceFile, line: Int)(String, Array[Char])" id="250835">instrument</a><span class="delimiter">(</span><a title="scala.tools.nsc.util.SourceFile" id="431662">source</a>: <a href="../util/SourceFile.scala.html#34370" title="scala.tools.nsc.util.SourceFile">SourceFile</a>, <a title="Int" id="431663">line</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="(String, Array[Char])" class="delimiter">(</span>String, Array<span class="delimiter">[</span>Char<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="ScratchPadMaker.this.Tree" id="444561">tree</a> = <a href="Global.scala.html#250678" title="(source: scala.tools.nsc.util.SourceFile, forceReload: Boolean)ScratchPadMaker.this.Tree">typedTree</a><span class="delimiter">(</span><a href="#431662" title="scala.tools.nsc.util.SourceFile">source</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="444562">endOffset</a> = <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#431663" title="Int">line</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#431662" title="scala.tools.nsc.util.SourceFile">source</a>.<a href="../util/SourceFile.scala.html#185148" title="=&gt; Int">length</a> <span class="keyword">else</span> <a href="#431662" title="scala.tools.nsc.util.SourceFile">source</a>.<a href="../util/SourceFile.scala.html#185152" title="(index: Int)Int">lineToOffset</a><span class="delimiter">(</span><a href="#431663" title="Int">line</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ScratchPadMaker.this.Patcher" id="444563">patcher</a> = <span title="ScratchPadMaker.this.Patcher" class="keyword">new</span> <a href="#250834" title="ScratchPadMaker.this.Patcher">Patcher</a><span class="delimiter">(</span><a href="#431662" title="scala.tools.nsc.util.SourceFile">source</a>.<a href="../util/SourceFile.scala.html#185144" title="=&gt; Array[Char]">content</a>, <a href="#444562" title="Int">endOffset</a><span class="delimiter">)</span>
    <a href="#444563" title="ScratchPadMaker.this.Patcher">patcher</a>.<a href="#440930" title="(tree: ScratchPadMaker.this.Tree)Unit">traverse</a><span class="delimiter">(</span><a href="#444561" title="ScratchPadMaker.this.Tree">tree</a><span class="delimiter">)</span>
    <span title="(_1: String, _2: Array[Char])(String, Array[Char])" class="delimiter">(</span><a href="#444563" title="ScratchPadMaker.this.Patcher">patcher</a>.<a href="#440909" title="=&gt; String">objectName</a>, <a href="#444563" title="ScratchPadMaker.this.Patcher">patcher</a>.<a href="#440931" title="=&gt; Array[Char]">result</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/interpreter/ExprTyper.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
/* NSC -- new Scala compiler
 * Copyright 2005-2011 LAMP/EPFL
 * @author  Paul Phillips
 */

<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> interpreter

<span class="keyword">import</span> util.BatchSourceFile
<span class="keyword">import</span> scala.tools.nsc.ast.parser.<a href="../ast/parser/Tokens.scala.html#14580" title="object scala.tools.nsc.ast.parser.Tokens">Tokens</a>.EOF

<span class="keyword">trait</span> <a title="trait ExprTyper extends Object with ScalaObject" id="22566">ExprTyper</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">val</span> <a title="=&gt; scala.tools.nsc.interpreter.IMain" id="457296">repl</a>: <a href="IMain.scala.html#23535" title="scala.tools.nsc.interpreter.IMain">IMain</a>

  <span class="keyword">import</span> <a href="#457296" title="=&gt; scala.tools.nsc.interpreter.IMain">repl</a>._
  <span class="keyword">import</span> <a href="IMain.scala.html#249818" title="object ExprTyper.this.repl.replTokens">replTokens</a>.<span class="delimiter">{</span> Tokenizer <span class="delimiter">}</span>
  <span class="keyword">import</span> <a href="IMain.scala.html#249712" title="=&gt; scala.tools.nsc.Global">global</a>.<span class="delimiter">{</span> reporter =&gt; _, Import =&gt; _, _ <span class="delimiter">}</span>
  <span class="keyword">import</span> <a href="../../../reflect/internal/Definitions.scala.html#40473" title="object ExprTyper.this.repl.global.definitions">definitions</a>._
  <span class="keyword">import</span> <a href="../Global.scala.html#182934" title="object ExprTyper.this.repl.global.syntaxAnalyzer">syntaxAnalyzer</a>.<span class="delimiter">{</span> UnitParser, UnitScanner, token2name <span class="delimiter">}</span>
  <span class="keyword">import</span> <a href="IMain.scala.html#249721" title="object ExprTyper.this.repl.naming">naming</a>.freshInternalVarName

  <span class="keyword">object</span> <a title="object ExprTyper.this.codeParser" id="457303">codeParser</a> <span title="ScalaObject" class="keyword">extends</span> <span class="delimiter">{</span> <span class="keyword">val</span> <a title="ExprTyper.this.repl.global.type" id="457504">global</a>: repl.global.<span class="keyword">type</span> = <a href="#457296" title="=&gt; scala.tools.nsc.interpreter.IMain">repl</a>.<a href="IMain.scala.html#249712" title="=&gt; scala.tools.nsc.Global">global</a> <span class="delimiter">}</span> <span class="keyword">with</span> <a href="CodeHandlers.scala.html#22002" title="scala.tools.nsc.interpreter.CodeHandlers[ExprTyper.this.repl.global.Tree]">CodeHandlers</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="[T](code: String, rule: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; T)T" id="457490">applyRule</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="457492">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="String" id="457505">code</a>: <span title="String">String</span>, <a title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; T" id="457506">rule</a>: UnitParser =&gt; T<span class="delimiter">)</span>: <a href="#457492" title="T">T</a> = <span class="delimiter">{</span>
      <a href="IMain.scala.html#249702" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/AbstractReporter.scala.html#188122" title="()Unit">reset</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="ExprTyper.this.repl.global.CompilationUnit" id="457510">unit</a>    = <span title="ExprTyper.this.repl.global.CompilationUnit" class="keyword">new</span> <a href="../CompilationUnits.scala.html#183079" title="ExprTyper.this.repl.global.CompilationUnit">CompilationUnit</a><span class="delimiter">(</span><a href="../util/SourceFile.scala.html#228755" title="(sourceName: String, cs: Seq[Char])scala.tools.nsc.util.BatchSourceFile" class="keyword">new</a> <a href="../util/SourceFile.scala.html#34862" title="scala.tools.nsc.util.BatchSourceFile">BatchSourceFile</a><span class="delimiter">(</span><span title="String(&quot;&lt;console&gt;&quot;)" class="string">&quot;&lt;console&gt;&quot;</span>, <a href="#457505" title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString">code</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser" id="457511">scanner</a> = <a href="../ast/parser/Parsers.scala.html#284551" title="(unit: ExprTyper.this.repl.global.syntaxAnalyzer.global.CompilationUnit)ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser" class="keyword">new</a> <a href="../ast/parser/Parsers.scala.html#228331" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">UnitParser</a><span class="delimiter">(</span><a href="#457510" title="ExprTyper.this.repl.global.CompilationUnit">unit</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="T" id="457512">result</a>  = <a href="#457506" title="(v1: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser)T">rule</a><span class="delimiter">(</span><a href="#457511" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">scanner</a><span class="delimiter">)</span>

      <span title="AnyVal" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="IMain.scala.html#249702" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#182815" title="=&gt; Boolean">hasErrors</a><span class="delimiter">)</span>
        <a href="#457511" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">scanner</a>.<a href="../ast/parser/Parsers.scala.html#282041" title="(token: Int)Int">accept</a><span class="delimiter">(</span><span title="Int(0)">EOF</span><span class="delimiter">)</span>

      <a href="#457512" title="T">result</a>
    <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="(code: String)Iterator[ExprTyper.this.repl.replTokens.ReplToken]" id="457493">tokens</a><span class="delimiter">(</span><a title="String" id="457545">code</a>: <span title="String">String</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="IMain.scala.html#249702" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/AbstractReporter.scala.html#188122" title="()Unit">reset</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="ExprTyper.this.repl.global.CompilationUnit" id="457548">unit</a> = <span title="ExprTyper.this.repl.global.CompilationUnit" class="keyword">new</span> <a href="../CompilationUnits.scala.html#183079" title="ExprTyper.this.repl.global.CompilationUnit">CompilationUnit</a><span class="delimiter">(</span><a href="../util/SourceFile.scala.html#228755" title="(sourceName: String, cs: Seq[Char])scala.tools.nsc.util.BatchSourceFile" class="keyword">new</a> <a href="../util/SourceFile.scala.html#34862" title="scala.tools.nsc.util.BatchSourceFile">BatchSourceFile</a><span class="delimiter">(</span><span title="String(&quot;&lt;tokens&gt;&quot;)" class="string">&quot;&lt;tokens&gt;&quot;</span>, <a href="#457545" title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString">code</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitScanner" id="457549">in</a>   = <a href="../ast/parser/Scanners.scala.html#228692" title="(unit: ExprTyper.this.repl.global.syntaxAnalyzer.global.CompilationUnit)ExprTyper.this.repl.global.syntaxAnalyzer.UnitScanner" class="keyword">new</a> <a href="../ast/parser/Scanners.scala.html#228320" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitScanner">UnitScanner</a><span class="delimiter">(</span><a href="#457548" title="ExprTyper.this.repl.global.CompilationUnit">unit</a><span class="delimiter">)</span>
      <a href="#457549" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitScanner">in</a>.<a href="../ast/parser/Scanners.scala.html#228674" title="()Unit">init</a><span class="delimiter">(</span><span class="delimiter">)</span>

      <span title="ExprTyper.this.repl.replTokens.Tokenizer" class="keyword">new</span> <a href="ReplTokens.scala.html#457476" title="ExprTyper.this.repl.replTokens.Tokenizer">Tokenizer</a><span class="delimiter">(</span><a href="#457549" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitScanner">in</a><span class="delimiter">)</span> <a href="ReplTokens.scala.html#457575" title="=&gt; Iterator[ExprTyper.this.repl.replTokens.ReplToken]">tokenIterator</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(code: String)Nothing" id="457494">decl</a><span class="delimiter">(</span><a title="String" id="457580">code</a>: <span title="String">String</span><span class="delimiter">)</span>  = <a href="CodeHandlers.scala.html#22003" title="object scala.tools.nsc.interpreter.CodeHandlers">CodeHandlers</a>.<a href="CodeHandlers.scala.html#453557" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="String(&quot;todo&quot;)" class="string">&quot;todo&quot;</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)Nothing" id="457495">defn</a><span class="delimiter">(</span><a title="String" id="457583">code</a>: <span title="String">String</span><span class="delimiter">)</span>  = <a href="CodeHandlers.scala.html#22003" title="object scala.tools.nsc.interpreter.CodeHandlers">CodeHandlers</a>.<a href="CodeHandlers.scala.html#453557" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="String(&quot;todo&quot;)" class="string">&quot;todo&quot;</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree" id="457496">expr</a><span class="delimiter">(</span><a title="String" id="457586">code</a>: <span title="String">String</span><span class="delimiter">)</span>  = <a href="#457490" title="(code: String, rule: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree)ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">applyRule</a><span class="delimiter">(</span><a href="#457586" title="String">code</a>, <a href="#457593" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">_</a>.<a href="../ast/parser/Parsers.scala.html#282132" title="()ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">expr</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree" id="457497">impt</a><span class="delimiter">(</span><a title="String" id="457598">code</a>: <span title="String">String</span><span class="delimiter">)</span>  = <a href="#457490" title="(code: String, rule: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree)ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">applyRule</a><span class="delimiter">(</span><a href="#457598" title="String">code</a>, <a href="#457605" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">_</a>.<a href="../ast/parser/Parsers.scala.html#282187" title="()ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">importExpr</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]" id="457498">impts</a><span class="delimiter">(</span><a title="String" id="457608">code</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#457490" title="(code: String, rule: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree])List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">applyRule</a><span class="delimiter">(</span><a href="#457608" title="String">code</a>, <a href="#457615" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">_</a>.<a href="../ast/parser/Parsers.scala.html#282186" title="()List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">importClause</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]" id="457499">stmts</a><span class="delimiter">(</span><a title="String" id="457618">code</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#457490" title="(code: String, rule: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree])List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">applyRule</a><span class="delimiter">(</span><a href="#457618" title="String">code</a>, <a href="#457625" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">_</a>.<a href="../ast/parser/Parsers.scala.html#282216" title="(isPre: Boolean)(ExprTyper.this.repl.global.syntaxAnalyzer.global.ValDef, List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree])">templateStatSeq</a><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>.<span title="=&gt; List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">_2</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)ExprTyper.this.repl.global.Tree" id="457500">stmt</a><span class="delimiter">(</span><a title="String" id="457629">code</a>: <span title="String">String</span><span class="delimiter">)</span>  = <a href="#457499" title="(code: String)List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">stmts</a><span class="delimiter">(</span><a href="#457629" title="String">code</a><span class="delimiter">)</span> <span title="ExprTyper.this.repl.global.Tree" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#457633" title="ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">List</a><span class="delimiter">(</span><a title="ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree" id="457655">t</a><span class="delimiter">)</span>  =&gt; <a href="#457655" title="ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">t</a>
      <span class="keyword">case</span> <a title="Nothing" id="457656">xs</a>       =&gt; <a href="CodeHandlers.scala.html#22003" title="object scala.tools.nsc.interpreter.CodeHandlers">CodeHandlers</a>.<a href="CodeHandlers.scala.html#453557" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="String(&quot;Not a single statement: &quot;)" class="string">&quot;Not a single statement: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#457656" title="List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">xs</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** Parse a line into a sequence of trees. Returns None if the input is incomplete. */
  <span class="keyword">def</span> <a title="(line: String)Option[List[ExprTyper.this.repl.global.Tree]]" id="457305">parse</a><span class="delimiter">(</span><a title="String" id="457659">line</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[List[ExprTyper.this.repl.global.Tree]]">Option</span><span class="delimiter">[</span>List<span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Boolean" id="457661">isIncomplete</a> = <span title="Boolean(false)" class="keyword">false</span>
    <a href="IMain.scala.html#249702" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#182809" title="(handler: (scala.tools.nsc.util.Position, String) =&gt; Unit)(thunk: =&gt; Option[List[ExprTyper.this.repl.global.Tree]])Option[List[ExprTyper.this.repl.global.Tree]]">withIncompleteHandler</a><span class="delimiter">(</span><span class="delimiter">(</span><a title="scala.tools.nsc.util.Position" id="457673">_</a>, <a title="String" id="457674">_</a><span class="delimiter">)</span> =&gt; <a href="#457661" title="Boolean">isIncomplete</a> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]" id="457676">trees</a> = <a href="#457303" title="object ExprTyper.this.codeParser">codeParser</a>.<a href="#457499" title="(code: String)List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">stmts</a><span class="delimiter">(</span><a href="#457659" title="String">line</a><span class="delimiter">)</span>
      <span title="Option[List[ExprTyper.this.repl.global.Tree]]" class="keyword">if</span> <span class="delimiter">(</span><a href="IMain.scala.html#249702" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#182815" title="=&gt; Boolean">hasErrors</a><span class="delimiter">)</span> <span title="(x: scala.collection.immutable.Nil.type)Some[scala.collection.immutable.Nil.type]">Some</span><span class="delimiter">(</span><span title="object Nil">Nil</span><span class="delimiter">)</span>
      <span class="keyword">else</span> <span title="Option[List[ExprTyper.this.repl.global.Tree]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#457661" title="Boolean">isIncomplete</a><span class="delimiter">)</span> <span title="object None">None</span>
      <span class="keyword">else</span> <span title="(x: List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree])Some[List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]]">Some</span><span class="delimiter">(</span><a href="#457676" title="List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">trees</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  <span class="keyword">def</span> <a title="(line: String)Iterator[ExprTyper.this.repl.replTokens.ReplToken]" id="457306">tokens</a><span class="delimiter">(</span><a title="String" id="457685">line</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="IMain.scala.html#249736" title="(operation: =&gt; Iterator[ExprTyper.this.repl.replTokens.ReplToken])Iterator[ExprTyper.this.repl.replTokens.ReplToken]">beSilentDuring</a><span class="delimiter">(</span><a href="#457303" title="object ExprTyper.this.codeParser">codeParser</a>.<a href="#457493" title="(code: String)Iterator[ExprTyper.this.repl.replTokens.ReplToken]">tokens</a><span class="delimiter">(</span><a href="#457685" title="String">line</a><span class="delimiter">)</span><span class="delimiter">)</span>

  // TODO: integrate these into a CodeHandler[Type].

  // XXX literals.
  // 1) Identifiers defined in the repl.
  // 2) A path loadable via getModule.
  // 3) Try interpreting it as an expression.
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="457308">typeOfExpressionDepth</a> = <span title="Int(0)" class="int">0</span>
  <span class="keyword">def</span> <a title="(expr: String, silent: Boolean)ExprTyper.this.repl.global.Type" id="457310">typeOfExpression</a><span class="delimiter">(</span><a title="String" id="457694">expr</a>: <span title="String">String</span>, <a title="Boolean" id="457697">silent</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#40083" title="ExprTyper.this.repl.global.Type">Type</a> = <span class="delimiter">{</span>
    <a href="ReplConfig.scala.html#36130" title="(msg: =&gt; String)Unit">repltrace</a><span class="delimiter">(</span><span title="String(&quot;typeOfExpression(&quot;)" class="string">&quot;typeOfExpression(&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#457694" title="String">expr</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;)&quot;)" class="string">&quot;)&quot;</span><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#457308" title="=&gt; Int">typeOfExpressionDepth</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="ReplConfig.scala.html#36129" title="(msg: =&gt; String)Unit">repldbg</a><span class="delimiter">(</span><span title="String(&quot;Terminating typeOfExpression recursion for expression: &quot;)" class="string">&quot;Terminating typeOfExpression recursion for expression: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#457694" title="String">expr</a><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <a href="../../../reflect/internal/Types.scala.html#40097" title="object ExprTyper.this.repl.global.NoType">NoType</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="=&gt; ExprTyper.this.repl.global.Type" id="457698">asQualifiedImport</a>: <a href="../../../reflect/internal/Types.scala.html#40083" title="ExprTyper.this.repl.global.Type">Type</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="String" id="457724">name</a> = <a href="#457694" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">expr</a>.<span title="(p: Char =&gt; Boolean)String">takeWhile</span><span class="delimiter">(</span><a href="#457979" title="Char">_</a> <span title="(x: Char)Boolean">!=</span> <span title="Char('.')" class="char">'.'</span><span class="delimiter">)</span>
      <a href="#457310" title="(expr: String, silent: Boolean)ExprTyper.this.repl.global.Type">typeOfExpression</a><span class="delimiter">(</span><a href="Imports.scala.html#249641" title="(name: String)ExprTyper.this.repl.global.Symbol">importedTermNamed</a><span class="delimiter">(</span><a href="#457724" title="String">name</a><span class="delimiter">)</span>.<a href="../../../reflect/internal/Symbols.scala.html#47897" title="=&gt; String">fullName</a> <span title="(x$1: Any)String">+</span> <a href="#457694" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">expr</a>.<span title="(n: Int)String">drop</span><span class="delimiter">(</span><a href="#457724" title="String">name</a>.<span title="()Int">length</span><span class="delimiter">)</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="=&gt; ExprTyper.this.repl.global.Type" id="457699">asModule</a>: <a href="../../../reflect/internal/Types.scala.html#40083" title="ExprTyper.this.repl.global.Type">Type</a> = <a href="../../../reflect/internal/Definitions.scala.html#46755" title="(fullname: String)ExprTyper.this.repl.global.Symbol">getModuleIfDefined</a><span class="delimiter">(</span><a href="#457694" title="String">expr</a><span class="delimiter">)</span>.<a href="../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; ExprTyper.this.repl.global.Type">tpe</a>
    <span class="keyword">def</span> <a title="=&gt; ExprTyper.this.repl.global.Type" id="457700">asExpr</a>: <a href="../../../reflect/internal/Types.scala.html#40083" title="ExprTyper.this.repl.global.Type">Type</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="String" id="458116">lhs</a> = <a href="Naming.scala.html#457337" title="()String">freshInternalVarName</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="String" id="458117">line</a> = <span title="String(&quot;lazy val &quot;)" class="string">&quot;lazy val &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#458116" title="String">lhs</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; =\n&quot;)" class="string">&quot; =\n&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#457694" title="String">expr</a>

      <a href="IMain.scala.html#249785" title="(line: String, synthetic: Boolean)scala.tools.nsc.interpreter.IR.Result">interpret</a><span class="delimiter">(</span><a href="#458117" title="String">line</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <span title="ExprTyper.this.repl.global.Type" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="package.scala.html#36156" title="ExprTyper.this.repl.global.Type">IR</a>.<a href="Results.scala.html#458162" title="object scala.tools.nsc.interpreter.IR.Success">Success</a> =&gt; <a href="#457310" title="(expr: String, silent: Boolean)ExprTyper.this.repl.global.Type">typeOfExpression</a><span class="delimiter">(</span><a href="#458116" title="String">lhs</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="ExprTyper.this.repl.global.NoType.type">_</span>          =&gt; <a href="../../../reflect/internal/Types.scala.html#40097" title="object ExprTyper.this.repl.global.NoType">NoType</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="()ExprTyper.this.repl.global.Type" id="457701">evaluate</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#40083" title="ExprTyper.this.repl.global.Type">Type</a> = <span class="delimiter">{</span>
      <a href="#457308" title="(x$1: Int)Unit">typeOfExpressionDepth</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
      <span class="keyword">try</span> <a href="IMain.scala.html#249814" title="(id: String)ExprTyper.this.repl.global.Type">typeOfTerm</a><a href="IMain.scala.html#249719" title="implicit scala.tools.nsc.interpreter.IMain.installReplTypeOps : (tp: ExprTyper.this.repl.global.Type)ExprTyper.this.repl.ReplTypeOps" class="delimiter">(</a><a href="#457694" title="String">expr</a><span class="delimiter">)</span> <a href="IMain.scala.html#249719" title="implicit scala.tools.nsc.interpreter.IMain.installReplTypeOps : (tp: ExprTyper.this.repl.global.Type)ExprTyper.this.repl.ReplTypeOps">orElse</a> <a href="#457699" title="=&gt; ExprTyper.this.repl.global.Type">asModule</a> <a href="IMain.scala.html#249719" title="implicit scala.tools.nsc.interpreter.IMain.installReplTypeOps : (tp: ExprTyper.this.repl.global.Type)ExprTyper.this.repl.ReplTypeOps">orElse</a> <a href="#457700" title="=&gt; ExprTyper.this.repl.global.Type">asExpr</a> <a href="IMain.scala.html#457728" title="(other: =&gt; ExprTyper.this.repl.global.Type)ExprTyper.this.repl.global.Type">orElse</a> <a href="#457698" title="=&gt; ExprTyper.this.repl.global.Type">asQualifiedImport</a>
      <span class="keyword">finally</span> <a href="#457308" title="(x$1: Int)Unit">typeOfExpressionDepth</a> <span title="(x: Int)Int">-=</span> <span title="Int(1)" class="int">1</span>
    <span class="delimiter">}</span>

    // Don't presently have a good way to suppress undesirable success output
    // while letting errors through, so it is first trying it silently: if there
    // is an error, and errors are desired, then it re-evaluates non-silently
    // to induce the error message.
    <a href="IMain.scala.html#249736" title="(operation: =&gt; ExprTyper.this.repl.global.Type)ExprTyper.this.repl.global.Type">beSilentDuring</a><a href="IMain.scala.html#249719" title="implicit scala.tools.nsc.interpreter.IMain.installReplTypeOps : (tp: ExprTyper.this.repl.global.Type)ExprTyper.this.repl.ReplTypeOps" class="delimiter">(</a><a href="#457701" title="()ExprTyper.this.repl.global.Type">evaluate</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="IMain.scala.html#249719" title="implicit scala.tools.nsc.interpreter.IMain.installReplTypeOps : (tp: ExprTyper.this.repl.global.Type)ExprTyper.this.repl.ReplTypeOps">orElse</a> <a href="IMain.scala.html#249736" title="(operation: =&gt; ExprTyper.this.repl.global.Type)ExprTyper.this.repl.global.Type">beSilentDuring</a><span class="delimiter">(</span><a href="#457311" title="(code: String)ExprTyper.this.repl.global.Type">typeOfDeclaration</a><span class="delimiter">(</span><a href="#457694" title="String">expr</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="IMain.scala.html#457728" title="(other: =&gt; ExprTyper.this.repl.global.Type)ExprTyper.this.repl.global.Type">orElse</a> <span class="delimiter">{</span>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#457697" title="Boolean">silent</a><span class="delimiter">)</span>
        <a href="#457701" title="()ExprTyper.this.repl.global.Type">evaluate</a><span class="delimiter">(</span><span class="delimiter">)</span>

      <a href="../../../reflect/internal/Types.scala.html#40097" title="object ExprTyper.this.repl.global.NoType">NoType</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  // Since people will be giving us &quot;:t def foo = 5&quot; even though that is not an
  // expression, we have a means of typing declarations too.
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(code: String)ExprTyper.this.repl.global.Type" id="457311">typeOfDeclaration</a><span class="delimiter">(</span><a title="String" id="458217">code</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#40083" title="ExprTyper.this.repl.global.Type">Type</a> = <span class="delimiter">{</span>
    <a href="ReplConfig.scala.html#36130" title="(msg: =&gt; String)Unit">repltrace</a><span class="delimiter">(</span><span title="String(&quot;typeOfDeclaration(&quot;)" class="string">&quot;typeOfDeclaration(&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#458217" title="String">code</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;)&quot;)" class="string">&quot;)&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="String" id="458232">obname</a> = <a href="Naming.scala.html#457337" title="()String">freshInternalVarName</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <a href="IMain.scala.html#249785" title="(line: String, synthetic: Boolean)scala.tools.nsc.interpreter.IR.Result">interpret</a><span class="delimiter">(</span><span title="String(&quot;object &quot;)" class="string">&quot;object &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#458232" title="String">obname</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; {\n&quot;)" class="string">&quot; {\n&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#458217" title="String">code</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;\n}\n&quot;)" class="string">&quot;\n}\n&quot;</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <span title="ExprTyper.this.repl.global.Type" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="package.scala.html#36156" title="ExprTyper.this.repl.global.Type">IR</a>.<a href="Results.scala.html#458162" title="object scala.tools.nsc.interpreter.IR.Success">Success</a> =&gt;
        <span class="keyword">val</span> <a title="ExprTyper.this.repl.global.Symbol" id="458235">sym</a> = <a href="IMain.scala.html#249815" title="(id: String)ExprTyper.this.repl.global.Symbol">symbolOfTerm</a><span class="delimiter">(</span><a href="#458232" title="String">obname</a><span class="delimiter">)</span>
        <span title="ExprTyper.this.repl.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="#458235" title="ExprTyper.this.repl.global.Symbol">sym</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Symbols.scala.html#40013" title="object ExprTyper.this.repl.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <a href="../../../reflect/internal/Types.scala.html#40097" title="object ExprTyper.this.repl.global.NoType">NoType</a> <span class="keyword">else</span> <span class="delimiter">{</span>
          // TODO: bitmap$n is not marked synthetic.
          <span class="keyword">val</span> <a title="List[ExprTyper.this.repl.global.Symbol]" id="458242">decls</a> = <a href="#458235" title="ExprTyper.this.repl.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; ExprTyper.this.repl.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#42760" title="=&gt; ExprTyper.this.repl.global.Scope">decls</a>.<a href="../../../reflect/internal/Scopes.scala.html#61763" title="=&gt; List[ExprTyper.this.repl.global.Symbol]">toList</a> <span title="(p: ExprTyper.this.repl.global.Symbol =&gt; Boolean)List[ExprTyper.this.repl.global.Symbol]">filterNot</span> <span class="delimiter">(</span><a title="ExprTyper.this.repl.global.Symbol" id="458255">x</a> =&gt; <a href="#458255" title="ExprTyper.this.repl.global.Symbol">x</a>.<a href="../../../reflect/internal/Symbols.scala.html#47804" title="=&gt; Boolean">isConstructor</a> <span title="(x: Boolean)Boolean">||</span> <a href="#458255" title="ExprTyper.this.repl.global.Symbol">x</a>.<a href="../../../reflect/internal/HasFlags.scala.html#48084" title="=&gt; Boolean">isPrivate</a> <span title="(x: Boolean)Boolean">||</span> <span class="delimiter">(</span><a href="#458255" title="ExprTyper.this.repl.global.Symbol">x</a>.<a href="../../../reflect/internal/Symbols.scala.html#47883" title="=&gt; ExprTyper.this.repl.global.Name">name</a>.<span title="()String">toString</span> <span title="(x$1: CharSequence)Boolean">contains</span> <span title="String(&quot;$&quot;)" class="string">&quot;$&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="ReplConfig.scala.html#36130" title="(msg: =&gt; String)Unit">repltrace</a><span class="delimiter">(</span><span title="String(&quot;decls: &quot;)" class="string">&quot;decls: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#458242" title="List[ExprTyper.this.repl.global.Symbol]">decls</a><span class="delimiter">)</span>
          <span title="ExprTyper.this.repl.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="#458242" title="List[ExprTyper.this.repl.global.Symbol]">decls</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="../../../reflect/internal/Types.scala.html#40097" title="object ExprTyper.this.repl.global.NoType">NoType</a>
          <span class="keyword">else</span> <a href="IMain.scala.html#249783" title="(sym: ExprTyper.this.repl.global.Symbol, memberName: ExprTyper.this.repl.global.Name)ExprTyper.this.repl.global.Type">typeCleanser</a><span class="delimiter">(</span><a href="#458235" title="ExprTyper.this.repl.global.Symbol">sym</a>, <a href="#458242" title="List[ExprTyper.this.repl.global.Symbol]">decls</a>.<span title="=&gt; ExprTyper.this.repl.global.Symbol">last</span>.<a href="../../../reflect/internal/Symbols.scala.html#47883" title="=&gt; ExprTyper.this.repl.global.Name">name</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="ExprTyper.this.repl.global.NoType.type">_</span>          =&gt;
        <a href="../../../reflect/internal/Types.scala.html#40097" title="object ExprTyper.this.repl.global.NoType">NoType</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  // def compileAndTypeExpr(expr: String): Option[Typer] = {
  //   class TyperRun extends Run {
  //     override def stopPhase(name: String) = name == &quot;superaccessors&quot;
  //   }
  // }
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/transform/LazyVals.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> transform

<span class="keyword">import</span> scala.collection.<span class="delimiter">{</span> mutable, immutable <span class="delimiter">}</span>

<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class LazyVals extends scala.tools.nsc.SubComponent with scala.tools.nsc.transform.Transform with scala.tools.nsc.transform.TypingTransformers with scala.tools.nsc.ast.TreeDSL with ScalaObject" id="28314">LazyVals</a> <a href="#28314" title="ScalaObject" class="keyword">extends</a> <a href="Transform.scala.html#29967" title="scala.tools.nsc.transform.Transform">Transform</a> <span class="keyword">with</span> <a href="TypingTransformers.scala.html#29733" title="scala.tools.nsc.transform.TypingTransformers">TypingTransformers</a> <span class="keyword">with</span> ast.<a href="../ast/TreeDSL.scala.html#13777" title="scala.tools.nsc.ast.TreeDSL">TreeDSL</a> <span class="delimiter">{</span>
  // inherits abstract value `global` and class `Phase` from Transform

  <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#184069" title="=&gt; scala.tools.nsc.Global">global</a>._                  // the global environment
  <span class="keyword">import</span> <a href="../../../reflect/internal/Definitions.scala.html#40473" title="object LazyVals.this.global.definitions">definitions</a>._             // standard classes and methods
  <span class="keyword">import</span> <a href="../Global.scala.html#182992" title="object LazyVals.this.global.typer">typer</a>.<span class="delimiter">{</span>typed, atOwner<span class="delimiter">}</span>    // methods to type trees
  <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#184073" title="object LazyVals.this.CODE">CODE</a>._

  <span class="keyword">val</span> <a title="String" id="239214">phaseName</a>: <span title="String">String</span> = <span title="String(&quot;lazyvals&quot;)" class="string">&quot;lazyvals&quot;</span>
  <span class="keyword">val</span> <a title="=&gt; Int" id="239216">FLAGS_PER_WORD</a>: <span title="Int">Int</span>

  <span class="keyword">def</span> <a title="(unit: LazyVals.this.global.CompilationUnit)LazyVals.this.global.Transformer" id="239217">newTransformer</a><span class="delimiter">(</span><a title="LazyVals.this.global.CompilationUnit" id="592623">unit</a>: <a href="../CompilationUnits.scala.html#183079" title="LazyVals.this.global.CompilationUnit">CompilationUnit</a><span class="delimiter">)</span>: <a href="../ast/Trees.scala.html#183129" title="LazyVals.this.global.Transformer">Transformer</a> =
    <span title="LazyVals.this.LazyValues" class="keyword">new</span> <a href="#239221" title="LazyVals.this.LazyValues">LazyValues</a><span class="delimiter">(</span><a href="#592623" title="LazyVals.this.global.CompilationUnit">unit</a><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: LazyVals.this.global.Symbol)Boolean" id="239218">lazyUnit</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="592641">sym</a>: <a href="../../../reflect/internal/Symbols.scala.html#40001" title="LazyVals.this.global.Symbol">Symbol</a><span class="delimiter">)</span> = <a href="#592641" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; LazyVals.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#42743" title="=&gt; LazyVals.this.global.Type">resultType</a>.<a href="../../../reflect/internal/Types.scala.html#42728" title="=&gt; LazyVals.this.global.Symbol">typeSymbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#46834" title="=&gt; LazyVals.this.global.Symbol">UnitClass</a>

  <span class="keyword">object</span> <a title="object LazyVals.this.LocalLazyValFinder" id="239219">LocalLazyValFinder</a> <span title="ScalaObject" class="keyword">extends</span> <a href="../ast/TreeDSL.scala.html#184069" title="LazyVals.this.global.Traverser">Traverser</a> <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Boolean" id="592655">result</a>: <span title="Boolean">Boolean</span>  = _

    <span class="keyword">def</span> <a title="(t: LazyVals.this.global.Tree)Boolean" id="592657">find</a><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="592662">t</a>: <span title="LazyVals.this.global.Tree">Tree</span><span class="delimiter">)</span> = <span class="delimiter">{</span><a href="#592655" title="(x$1: Boolean)Unit">result</a> = <span title="Boolean(false)" class="keyword">false</span>; <a href="#592659" title="(t: LazyVals.this.global.Tree)Unit">traverse</a><span class="delimiter">(</span><a href="#592662" title="LazyVals.this.global.Tree">t</a><span class="delimiter">)</span>; <a href="#592655" title="=&gt; Boolean">result</a><span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="(ts: List[LazyVals.this.global.Tree])Boolean" id="592658">find</a><span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="592668">ts</a>: <span title="List[LazyVals.this.global.Tree]">List</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span><a href="#592655" title="(x$1: Boolean)Unit">result</a> = <span title="Boolean(false)" class="keyword">false</span>; <span title="(trees: List[LazyVals.this.global.Tree])Unit">traverseTrees</span><span class="delimiter">(</span><a href="#592668" title="List[LazyVals.this.global.Tree]">ts</a><span class="delimiter">)</span>; <a href="#592655" title="=&gt; Boolean">result</a><span class="delimiter">}</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(t: LazyVals.this.global.Tree)Unit" id="592659">traverse</a><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="592665">t</a>: <span title="LazyVals.this.global.Tree">Tree</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#592655" title="=&gt; Boolean">result</a><span class="delimiter">)</span>
        <a href="#592665" title="LazyVals.this.global.Tree">t</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a title="Unit" id="592672">v</a>@ValDef<span class="delimiter">(</span>_, _, _, _<span class="delimiter">)</span> <span class="keyword">if</span> <a href="#592672" title="LazyVals.this.global.ValDef">v</a>.<span title="=&gt; LazyVals.this.global.Symbol">symbol</span>.<a href="../../../reflect/internal/HasFlags.scala.html#48081" title="=&gt; Boolean">isLazy</a> =&gt;
            <a href="#592655" title="(x$1: Boolean)Unit">result</a> = <span title="Boolean(true)" class="keyword">true</span>

          <span class="keyword">case</span> <a title="Unit" id="592682">d</a>@DefDef<span class="delimiter">(</span>_, _, _, _, _, _<span class="delimiter">)</span> <span class="keyword">if</span> <a href="#592682" title="LazyVals.this.global.DefDef">d</a>.<span title="=&gt; LazyVals.this.global.Symbol">symbol</span>.<a href="../../../reflect/internal/HasFlags.scala.html#48081" title="=&gt; Boolean">isLazy</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#239218" title="(sym: LazyVals.this.global.Symbol)Boolean">lazyUnit</a><span class="delimiter">(</span><a href="#592682" title="LazyVals.this.global.DefDef">d</a>.<span title="=&gt; LazyVals.this.global.Symbol">symbol</span><span class="delimiter">)</span> =&gt;
            <a href="#592682" title="LazyVals.this.global.DefDef">d</a>.<span title="=&gt; LazyVals.this.global.Symbol">symbol</span>.<a href="../../../reflect/internal/Symbols.scala.html#47902" title="(mask: Long)LazyVals.this.global.Symbol">resetFlag</a><span class="delimiter">(</span>symtab.Flags.<span title="Long(2147483648L)">LAZY</span><span class="delimiter">)</span>
            <a href="#592655" title="(x$1: Boolean)Unit">result</a> = <span title="Boolean(true)" class="keyword">true</span>

          <span class="keyword">case</span> <span title="Unit">ClassDef</span><span class="delimiter">(</span>_, _, _, _<span class="delimiter">)</span> | DefDef<span class="delimiter">(</span>_, _, _, _, _, _<span class="delimiter">)</span> | ModuleDef<span class="delimiter">(</span>_, _, _<span class="delimiter">)</span> =&gt;

          <span class="keyword">case</span> <span title="Unit">LabelDef</span><span class="delimiter">(</span><a title="LazyVals.this.global.TermName" id="592744">name</a>, _, _<span class="delimiter">)</span> <span class="keyword">if</span> <a href="../../../reflect/internal/StdNames.scala.html#40560" title="object LazyVals.this.global.nme">nme</a>.<a href="../../../reflect/internal/NameManglers.scala.html#60675" title="(name: LazyVals.this.global.Name)Boolean">isLoopHeaderLabel</a><span class="delimiter">(</span><a href="#592744" title="LazyVals.this.global.TermName">name</a><span class="delimiter">)</span> =&gt;

          <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
            <span class="keyword">super</span>.<span title="(tree: LazyVals.this.global.Tree)Unit">traverse</span><span class="delimiter">(</span><a href="#592665" title="LazyVals.this.global.Tree">t</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /**
   * Transform local lazy accessors to check for the initialized bit.
   */
  <span class="keyword">class</span> <a title="class LazyValues extends LazyVals.this.TypingTransformer with ScalaObject" id="239221">LazyValues</a><a href="#239221" title="ScalaObject" class="delimiter">(</a><a title="LazyVals.this.global.CompilationUnit" id="592640">unit</a>: <a href="../CompilationUnits.scala.html#183079" title="LazyVals.this.global.CompilationUnit">CompilationUnit</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="TypingTransformers.scala.html#238439" title="LazyVals.this.TypingTransformer">TypingTransformer</a><span class="delimiter">(</span><a href="#592640" title="LazyVals.this.global.CompilationUnit">unit</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    /** map from method symbols to the number of lazy values it defines. */
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,Int]" id="592629">lazyVals</a> = <a href="#592750" title="scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,Int]" class="keyword">new</a> <a title="anonymous class $anon extends scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,Int]" id="592750">mutable</a>.<span title="scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,Int]">HashMap</span><span class="delimiter">[</span>Symbol, Int<span class="delimiter">]</span> <span class="delimiter">{</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="(meth: LazyVals.this.global.Symbol)Int" id="592752">default</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="592753">meth</a>: <a href="../../../reflect/internal/Symbols.scala.html#40001" title="LazyVals.this.global.Symbol">Symbol</a><span class="delimiter">)</span> = <span title="Int(0)" class="int">0</span>
    <span class="delimiter">}</span>

    <span class="keyword">import</span> symtab.<a href="../symtab/package.scala.html#36230" title="=&gt; reflect.internal.Flags.type">Flags</a>._
    <span class="keyword">import</span> <a href="#592629" title="=&gt; scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,Int]">lazyVals</a>._

    /** Perform the following transformations:
     *  - for a lazy accessor inside a method, make it check the initialization bitmap
     *  - for all methods, add enough int vars to allow one flag per lazy local value
     *  - blocks in template bodies behave almost like methods. A single bitmaps section is
     *      added in the first block, for all lazy values defined in such blocks.
     *  - remove ACCESSOR flags: accessors in traits are not statically implemented,
     *    but moved to the host class. local lazy values should be statically implemented.
     */
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree" id="592633">transform</a><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="592839">tree</a>: <span title="LazyVals.this.global.Tree">Tree</span><span class="delimiter">)</span>: <span title="LazyVals.this.global.Tree">Tree</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="LazyVals.this.global.Symbol" id="592844">sym</a> = <a href="#592839" title="LazyVals.this.global.Tree">tree</a>.<span title="=&gt; LazyVals.this.global.Symbol">symbol</span>
      <a href="TypingTransformers.scala.html#586827" title="(x$1: LazyVals.this.global.Tree)Unit">curTree</a> = <a href="#592839" title="LazyVals.this.global.Tree">tree</a>

      <a href="#592839" title="LazyVals.this.global.Tree">tree</a> <span title="LazyVals.this.global.Tree" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="LazyVals.this.global.DefDef">DefDef</span><span class="delimiter">(</span><a title="LazyVals.this.global.Modifiers" id="592855">mods</a>, <a title="LazyVals.this.global.Name" id="592856">name</a>, <a title="List[LazyVals.this.global.TypeDef]" id="592857">tparams</a>, <a title="List[List[LazyVals.this.global.ValDef]]" id="592858">vparams</a>, <a title="LazyVals.this.global.Tree" id="592859">tpt</a>, <a title="LazyVals.this.global.Tree" id="592860">rhs</a><span class="delimiter">)</span> =&gt; <a href="TypingTransformers.scala.html#586832" title="(owner: LazyVals.this.global.Symbol)(trans: =&gt; LazyVals.this.global.DefDef)LazyVals.this.global.DefDef">atOwner</a><span class="delimiter">(</span><a href="#592839" title="LazyVals.this.global.Tree">tree</a>.<span title="=&gt; LazyVals.this.global.Symbol">symbol</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="LazyVals.this.global.Tree" id="592880">res</a> = <span title="LazyVals.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#592844" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; LazyVals.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#47757" title="=&gt; Boolean">isClass</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#592844" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/HasFlags.scala.html#48081" title="=&gt; Boolean">isLazy</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="LazyVals.this.global.Symbol" id="592882">enclosingClassOrDummyOrMethod</a> = <span class="delimiter">{</span>
              <span class="keyword">val</span> <a title="LazyVals.this.global.Symbol" id="592885">enclMethod</a> = <a href="#592844" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#47976" title="=&gt; LazyVals.this.global.Symbol">enclMethod</a>

              <span title="LazyVals.this.global.Symbol" class="keyword">if</span> <span class="delimiter">(</span><a href="#592885" title="LazyVals.this.global.Symbol">enclMethod</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../../reflect/internal/Symbols.scala.html#40013" title="object LazyVals.this.global.NoSymbol">NoSymbol</a> <span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">val</span> <a title="LazyVals.this.global.Symbol" id="592890">enclClass</a> = <a href="#592844" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#47975" title="=&gt; LazyVals.this.global.Symbol">enclClass</a>
                <span title="LazyVals.this.global.Symbol" class="keyword">if</span> <span class="delimiter">(</span><a href="#592890" title="LazyVals.this.global.Symbol">enclClass</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../../reflect/internal/Symbols.scala.html#40013" title="object LazyVals.this.global.NoSymbol">NoSymbol</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#592885" title="LazyVals.this.global.Symbol">enclMethod</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#592890" title="LazyVals.this.global.Symbol">enclClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#47976" title="=&gt; LazyVals.this.global.Symbol">enclMethod</a><span class="delimiter">)</span>
                  <a href="#592890" title="LazyVals.this.global.Symbol">enclClass</a>
                <span class="keyword">else</span>
                  <a href="#592885" title="LazyVals.this.global.Symbol">enclMethod</a>
              <span class="delimiter">}</span> <span class="keyword">else</span>
                <a href="#592844" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; LazyVals.this.global.Symbol">owner</a>
            <span class="delimiter">}</span>
            <span class="keyword">val</span> <a title="Int" id="592883">idx</a> = <a href="#592629" title="(key: LazyVals.this.global.Symbol)Int">lazyVals</a><span class="delimiter">(</span><a href="#592882" title="LazyVals.this.global.Symbol">enclosingClassOrDummyOrMethod</a><span class="delimiter">)</span>
            <a href="#592629" title="(key: LazyVals.this.global.Symbol, value: Int)Unit">lazyVals</a><span class="delimiter">(</span><a href="#592882" title="LazyVals.this.global.Symbol">enclosingClassOrDummyOrMethod</a><span class="delimiter">)</span> = <a href="#592883" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>
            <span class="keyword">val</span> <a title="LazyVals.this.global.Tree" id="592884">rhs1</a> = <a href="#592635" title="(methOrClass: LazyVals.this.global.Symbol, tree: LazyVals.this.global.Tree, offset: Int, lazyVal: LazyVals.this.global.Symbol)LazyVals.this.global.Tree">mkLazyDef</a><span class="delimiter">(</span><a href="#592882" title="LazyVals.this.global.Symbol">enclosingClassOrDummyOrMethod</a>, <a href="#239221" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="TypingTransformers.scala.html#586838" title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#592860" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span>, <a href="#592883" title="Int">idx</a>, <a href="#592844" title="LazyVals.this.global.Symbol">sym</a><span class="delimiter">)</span>
            <a href="#592844" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#47902" title="(mask: Long)sym.type">resetFlag</a><span class="delimiter">(</span><span class="delimiter">(</span><span title="Long" class="keyword">if</span> <span class="delimiter">(</span><a href="#239218" title="(sym: LazyVals.this.global.Symbol)Boolean">lazyUnit</a><span class="delimiter">(</span><a href="#592844" title="LazyVals.this.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="Long(0L)" class="int">0</span> <span class="keyword">else</span> <span title="Long(2147483648L)">LAZY</span><span class="delimiter">)</span> <span title="(x: Int)Long">|</span> <span title="Int(134217728)">ACCESSOR</span><span class="delimiter">)</span>
            <a href="#592884" title="LazyVals.this.global.Tree">rhs1</a>
          <span class="delimiter">}</span> <span class="keyword">else</span>
            <a href="#239221" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="TypingTransformers.scala.html#586838" title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#592860" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span>

          <a href="#239221" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<span title="(tree: LazyVals.this.global.Tree, mods: LazyVals.this.global.Modifiers, name: LazyVals.this.global.Name, tparams: List[LazyVals.this.global.TypeDef], vparamss: List[List[LazyVals.this.global.ValDef]], tpt: LazyVals.this.global.Tree, rhs: LazyVals.this.global.Tree)LazyVals.this.global.DefDef">DefDef</span><span class="delimiter">(</span><a href="#592839" title="LazyVals.this.global.Tree">tree</a>, <a href="#592855" title="LazyVals.this.global.Modifiers">mods</a>, <a href="#592856" title="LazyVals.this.global.Name">name</a>, <a href="#592857" title="List[LazyVals.this.global.TypeDef]">tparams</a>, <a href="#592858" title="List[List[LazyVals.this.global.ValDef]]">vparams</a>, <a href="#592859" title="LazyVals.this.global.Tree">tpt</a>,
                  <span title="LazyVals.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#239219" title="object LazyVals.this.LocalLazyValFinder">LocalLazyValFinder</a>.<a href="#592657" title="(t: LazyVals.this.global.Tree)Boolean">find</a><span class="delimiter">(</span><a href="#592880" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../typechecker/Typers.scala.html#184436" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#592634" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#592844" title="LazyVals.this.global.Symbol">sym</a>, <a href="#592880" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#592880" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span class="keyword">case</span> <span title="LazyVals.this.global.Template">Template</span><span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="592993">parents</a>, <a title="LazyVals.this.global.ValDef" id="592994">self</a>, <a title="List[LazyVals.this.global.Tree]" id="592995">body</a><span class="delimiter">)</span> =&gt; <a href="TypingTransformers.scala.html#586832" title="(owner: LazyVals.this.global.Symbol)(trans: =&gt; LazyVals.this.global.Template)LazyVals.this.global.Template">atOwner</a><span class="delimiter">(</span><a href="#239221" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="List[LazyVals.this.global.Tree]" id="593011">body1</a> = <a href="#239221" title="LazyVals.this.LazyValues" class="keyword">super</a>.<span title="(trees: List[LazyVals.this.global.Tree])List[LazyVals.this.global.Tree]">transformTrees</span><span class="delimiter">(</span><a href="#592995" title="List[LazyVals.this.global.Tree]">body</a><span class="delimiter">)</span>
          <span class="keyword">var</span> <a title="Boolean" id="593012">added</a> = <span title="Boolean(false)" class="keyword">false</span>
          <span class="keyword">val</span> <a title="List[LazyVals.this.global.analyzer.global.Tree]" id="593013">stats</a> =
            <span class="keyword">for</span> <span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="593033">stat</a> &lt;- <a href="#593011" title="(f: LazyVals.this.global.Tree =&gt; LazyVals.this.global.analyzer.global.Tree)(implicit bf: scala.collection.generic.CanBuildFrom[List[LazyVals.this.global.Tree],LazyVals.this.global.analyzer.global.Tree,List[LazyVals.this.global.analyzer.global.Tree]])List[LazyVals.this.global.analyzer.global.Tree]">body1</a><span class="delimiter">)</span> <span class="keyword">yield</span> <a href="#593033" title="LazyVals.this.global.Tree">stat</a> <span title="LazyVals.this.global.analyzer.global.Tree" class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <span title="LazyVals.this.global.analyzer.global.Tree">Block</span><span class="delimiter">(</span>_, _<span class="delimiter">)</span> | Apply<span class="delimiter">(</span>_, _<span class="delimiter">)</span> | If<span class="delimiter">(</span>_, _, _<span class="delimiter">)</span> <span class="keyword">if</span> <span title="=&gt; Boolean">!</span><a href="#593012" title="Boolean">added</a> =&gt;
                // Avoid adding bitmaps when they are fully overshadowed by those
                // that are added inside loops
                <span title="LazyVals.this.global.analyzer.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#239219" title="object LazyVals.this.LocalLazyValFinder">LocalLazyValFinder</a>.<a href="#592657" title="(t: LazyVals.this.global.Tree)Boolean">find</a><span class="delimiter">(</span><a href="#593033" title="LazyVals.this.global.Tree">stat</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                  <a href="#593012" title="Boolean">added</a> = <span title="Boolean(true)" class="keyword">true</span>
                  <a href="../typechecker/Typers.scala.html#184436" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#592634" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#592844" title="LazyVals.this.global.Symbol">sym</a>, <a href="#593033" title="LazyVals.this.global.Tree">stat</a><span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#593033" title="LazyVals.this.global.Tree">stat</a>
              <span class="keyword">case</span> <span title="LazyVals.this.global.analyzer.global.Tree">ValDef</span><span class="delimiter">(</span><a title="LazyVals.this.global.Modifiers" id="593060">mods</a>, <a title="LazyVals.this.global.TermName" id="593061">name</a>, <a title="LazyVals.this.global.Tree" id="593062">tpt</a>, <a title="LazyVals.this.global.Tree" id="593063">rhs</a><span class="delimiter">)</span> =&gt;
                <a href="../typechecker/Typers.scala.html#184436" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#239221" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<span title="(tree: LazyVals.this.global.Tree, mods: LazyVals.this.global.Modifiers, name: LazyVals.this.global.Name, tpt: LazyVals.this.global.Tree, rhs: LazyVals.this.global.Tree)LazyVals.this.global.ValDef">ValDef</span><span class="delimiter">(</span><a href="#593033" title="LazyVals.this.global.Tree">stat</a>, <a href="#593060" title="LazyVals.this.global.Modifiers">mods</a>, <a href="#593061" title="LazyVals.this.global.TermName">name</a>, <a href="#593062" title="LazyVals.this.global.Tree">tpt</a>, <a href="#592634" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#593033" title="LazyVals.this.global.Tree">stat</a>.<span title="=&gt; LazyVals.this.global.Symbol">symbol</span>, <a href="#593063" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="LazyVals.this.global.Tree">_</span> =&gt;
                <a href="#593033" title="LazyVals.this.global.Tree">stat</a>
            <span class="delimiter">}</span>
          <span class="keyword">val</span> <a title="List[LazyVals.this.global.analyzer.global.Tree]" id="593014">innerClassBitmaps</a> = <span title="List[LazyVals.this.global.analyzer.global.Tree]" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#593012" title="Boolean">added</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#239221" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a>.<a href="../../../reflect/internal/Symbols.scala.html#47757" title="=&gt; Boolean">isClass</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#592637" title="=&gt; scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]{def default(meth: LazyVals.this.global.Symbol): scala.collection.immutable.Nil.type}">bitmaps</a>.<span title="(key: LazyVals.this.global.Symbol)Boolean">contains</span><span class="delimiter">(</span><a href="#239221" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              // add bitmap to inner class if necessary
                <span class="keyword">val</span> <a title="List[LazyVals.this.global.analyzer.global.Tree]" id="593102">toAdd0</a> = <a href="#592637" title="(key: LazyVals.this.global.Symbol)List[LazyVals.this.global.Symbol]">bitmaps</a><span class="delimiter">(</span><a href="#239221" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a><span class="delimiter">)</span>.<span title="(f: LazyVals.this.global.Symbol =&gt; LazyVals.this.global.analyzer.global.Tree)(implicit bf: scala.collection.generic.CanBuildFrom[List[LazyVals.this.global.Symbol],LazyVals.this.global.analyzer.global.Tree,List[LazyVals.this.global.analyzer.global.Tree]])List[LazyVals.this.global.analyzer.global.Tree]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,LazyVals.this.global.analyzer.global.Tree,List[LazyVals.this.global.analyzer.global.Tree]]" class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="593134">s</a> =&gt; <a href="../typechecker/Typers.scala.html#184436" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#40610" title="(sym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.ValDef">ValDef</a><span class="delimiter">(</span><a href="#593134" title="LazyVals.this.global.Symbol">s</a>, <a href="../ast/TreeDSL.scala.html#241196" title="=&gt; LazyVals.this.global.Literal">ZERO</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                <a href="#593102" title="List[LazyVals.this.global.analyzer.global.Tree]">toAdd0</a>.<span title="(f: LazyVals.this.global.analyzer.global.Tree =&gt; Any)Unit">foreach</span><span class="delimiter">(</span><a title="LazyVals.this.global.analyzer.global.Tree" id="593197">t</a> =&gt; <span class="delimiter">{</span>
                    <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#239221" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a>.<a href="../../../reflect/internal/Symbols.scala.html#47920" title="=&gt; LazyVals.this.global.Type">info</a>.<a href="../../../reflect/internal/Types.scala.html#42761" title="(name: LazyVals.this.global.Name)LazyVals.this.global.Symbol">decl</a><span class="delimiter">(</span><a href="#593197" title="LazyVals.this.global.analyzer.global.Tree">t</a>.<span title="=&gt; LazyVals.this.global.analyzer.global.Symbol">symbol</span>.<a href="../../../reflect/internal/Symbols.scala.html#47883" title="=&gt; LazyVals.this.global.analyzer.global.Name">name</a><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Symbols.scala.html#40013" title="object LazyVals.this.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                      <a href="#593197" title="LazyVals.this.global.analyzer.global.Tree">t</a>.<span title="=&gt; LazyVals.this.global.analyzer.global.Symbol">symbol</span>.<a href="../../../reflect/internal/Symbols.scala.html#47901" title="(mask: Long)LazyVals.this.global.analyzer.global.Symbol">setFlag</a><span class="delimiter">(</span><span title="Long(1L)">PROTECTED</span><span class="delimiter">)</span>
                      <a href="#239221" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a>.<a href="../../../reflect/internal/Symbols.scala.html#47920" title="=&gt; LazyVals.this.global.Type">info</a>.<a href="../../../reflect/internal/Types.scala.html#42760" title="=&gt; LazyVals.this.global.Scope">decls</a>.<a href="../../../reflect/internal/Scopes.scala.html#61752" title="(sym: LazyVals.this.global.Symbol)LazyVals.this.global.Symbol">enter</a><span class="delimiter">(</span><a href="#593197" title="LazyVals.this.global.analyzer.global.Tree">t</a>.<span title="=&gt; LazyVals.this.global.analyzer.global.Symbol">symbol</span><span class="delimiter">)</span>
                    <span class="delimiter">}</span>
                <span class="delimiter">}</span><span class="delimiter">)</span>
                <a href="#593102" title="List[LazyVals.this.global.analyzer.global.Tree]">toAdd0</a>
            <span class="delimiter">}</span> <span class="keyword">else</span> List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#239221" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<span title="(tree: LazyVals.this.global.Tree, parents: List[LazyVals.this.global.Tree], self: LazyVals.this.global.ValDef, body: List[LazyVals.this.global.Tree])LazyVals.this.global.Template">Template</span><span class="delimiter">(</span><a href="#592839" title="LazyVals.this.global.Tree">tree</a>, <a href="#592993" title="List[LazyVals.this.global.Tree]">parents</a>, <a href="#592994" title="LazyVals.this.global.ValDef">self</a>, <a href="#593014" title="List[LazyVals.this.global.analyzer.global.Tree]">innerClassBitmaps</a> <span title="(that: scala.collection.GenTraversableOnce[LazyVals.this.global.analyzer.global.Tree])(implicit bf: scala.collection.generic.CanBuildFrom[List[LazyVals.this.global.analyzer.global.Tree],LazyVals.this.global.analyzer.global.Tree,List[LazyVals.this.global.Tree]])List[LazyVals.this.global.Tree]">++</span> <a href="#593013" title="List[LazyVals.this.global.analyzer.global.Tree]">stats</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span class="keyword">case</span> <span title="LazyVals.this.global.ValDef">ValDef</span><span class="delimiter">(</span><a title="LazyVals.this.global.Modifiers" id="593303">mods</a>, <a title="LazyVals.this.global.TermName" id="593304">name</a>, <a title="LazyVals.this.global.Tree" id="593305">tpt</a>, <a title="LazyVals.this.global.Tree" id="593306">rhs0</a><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#592844" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; LazyVals.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#47774" title="=&gt; Boolean">isModule</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#592844" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; LazyVals.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#47757" title="=&gt; Boolean">isClass</a><span class="delimiter">)</span> =&gt;
          <span class="keyword">val</span> <a title="LazyVals.this.global.Tree" id="593308">rhs</a> = <a href="#239221" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="TypingTransformers.scala.html#586838" title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#593306" title="LazyVals.this.global.Tree">rhs0</a><span class="delimiter">)</span>
          <a href="#239221" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<span title="(tree: LazyVals.this.global.Tree, mods: LazyVals.this.global.Modifiers, name: LazyVals.this.global.Name, tpt: LazyVals.this.global.Tree, rhs: LazyVals.this.global.Tree)LazyVals.this.global.ValDef">ValDef</span><span class="delimiter">(</span><a href="#592839" title="LazyVals.this.global.Tree">tree</a>, <a href="#593303" title="LazyVals.this.global.Modifiers">mods</a>, <a href="#593304" title="LazyVals.this.global.TermName">name</a>, <a href="#593305" title="LazyVals.this.global.Tree">tpt</a>,
                  <span title="LazyVals.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#239219" title="object LazyVals.this.LocalLazyValFinder">LocalLazyValFinder</a>.<a href="#592657" title="(t: LazyVals.this.global.Tree)Boolean">find</a><span class="delimiter">(</span><a href="#593308" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../typechecker/Typers.scala.html#184436" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#592634" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#592844" title="LazyVals.this.global.Symbol">sym</a>, <a href="#593308" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#593308" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span>

        <span class="keyword">case</span> <a title="LazyVals.this.global.Tree" id="593318">l</a>@LabelDef<span class="delimiter">(</span><a title="LazyVals.this.global.TermName" id="593324">name0</a>, <a title="List[LazyVals.this.global.Ident]" id="593325">params0</a>, <a title="LazyVals.this.global.If" id="593326">ifp0</a>@If<span class="delimiter">(</span>_, _, _<span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#593324" title="LazyVals.this.global.TermName">name0</a>.<a href="../../../reflect/internal/Names.scala.html#53443" title="(name: String)Boolean">startsWith</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#40560" title="object LazyVals.this.global.nme">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#60439" title="=&gt; String">WHILE_PREFIX</a><span class="delimiter">)</span> =&gt;
          <span class="keyword">val</span> <a title="LazyVals.this.global.Tree" id="593337">ifp1</a> = <a href="#239221" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="TypingTransformers.scala.html#586838" title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#593326" title="LazyVals.this.global.If">ifp0</a><span class="delimiter">)</span>
          <span class="keyword">val</span> If<a href="#593339" title="(LazyVals.this.global.Tree, LazyVals.this.global.Tree, LazyVals.this.global.Tree)" class="delimiter">(</a><a href="#593338" title="LazyVals.this.global.Tree" id="593339">cond0</a>, <a href="#593338" title="LazyVals.this.global.Tree" id="593340">thenp0</a>, <a href="#593338" title="LazyVals.this.global.Tree" id="593341">elsep0</a><span class="delimiter">)</span> = <a href="#593337" title="LazyVals.this.global.Tree">ifp1</a>
          <span title="LazyVals.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#239219" title="object LazyVals.this.LocalLazyValFinder">LocalLazyValFinder</a>.<a href="#592657" title="(t: LazyVals.this.global.Tree)Boolean">find</a><span class="delimiter">(</span><a href="#593340" title="LazyVals.this.global.Tree">thenp0</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#239221" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<span title="(tree: LazyVals.this.global.Tree, name: LazyVals.this.global.Name, params: List[LazyVals.this.global.Ident], rhs: LazyVals.this.global.Tree)LazyVals.this.global.LabelDef">LabelDef</span><span class="delimiter">(</span><a href="#593318" title="LazyVals.this.global.LabelDef">l</a>, <a href="#593324" title="LazyVals.this.global.TermName">name0</a>, <a href="#593325" title="List[LazyVals.this.global.Ident]">params0</a>,
                    <a href="#239221" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<span title="(tree: LazyVals.this.global.Tree, cond: LazyVals.this.global.Tree, thenp: LazyVals.this.global.Tree, elsep: LazyVals.this.global.Tree)LazyVals.this.global.If">If</span><span class="delimiter">(</span><a href="#593337" title="LazyVals.this.global.Tree">ifp1</a>, <a href="#593339" title="LazyVals.this.global.Tree">cond0</a>, <a href="../typechecker/Typers.scala.html#184436" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#592634" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#592844" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; LazyVals.this.global.Symbol">owner</a>, <a href="#593340" title="LazyVals.this.global.Tree">thenp0</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#593341" title="LazyVals.this.global.Tree">elsep0</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">else</span>
            <a href="#593318" title="LazyVals.this.global.LabelDef">l</a>

        <span class="keyword">case</span> <a title="LazyVals.this.global.Tree" id="593374">l</a>@LabelDef<span class="delimiter">(</span><a title="LazyVals.this.global.TermName" id="593380">name0</a>, <a title="List[LazyVals.this.global.Ident]" id="593381">params0</a>, <a title="LazyVals.this.global.Block" id="593382">block</a>@Block<span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="593387">stats0</a>, _<span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">if</span> <a href="#593380" title="LazyVals.this.global.TermName">name0</a>.<a href="../../../reflect/internal/Names.scala.html#53443" title="(name: String)Boolean">startsWith</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#40560" title="object LazyVals.this.global.nme">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#60439" title="=&gt; String">WHILE_PREFIX</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <a href="#593380" title="LazyVals.this.global.TermName">name0</a>.<a href="../../../reflect/internal/Names.scala.html#53443" title="(name: String)Boolean">startsWith</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#40560" title="object LazyVals.this.global.nme">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#60423" title="=&gt; String">DO_WHILE_PREFIX</a><span class="delimiter">)</span> =&gt;
          <span class="keyword">val</span> <a title="List[LazyVals.this.global.Tree]" id="593399">stats1</a> = <a href="#239221" title="LazyVals.this.LazyValues" class="keyword">super</a>.<span title="(trees: List[LazyVals.this.global.Tree])List[LazyVals.this.global.Tree]">transformTrees</span><span class="delimiter">(</span><a href="#593387" title="List[LazyVals.this.global.Tree]">stats0</a><span class="delimiter">)</span>
          <span title="LazyVals.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#239219" title="object LazyVals.this.LocalLazyValFinder">LocalLazyValFinder</a>.<a href="#592658" title="(ts: List[LazyVals.this.global.Tree])Boolean">find</a><span class="delimiter">(</span><a href="#593399" title="List[LazyVals.this.global.Tree]">stats1</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#239221" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<span title="(tree: LazyVals.this.global.Tree, name: LazyVals.this.global.Name, params: List[LazyVals.this.global.Ident], rhs: LazyVals.this.global.Tree)LazyVals.this.global.LabelDef">LabelDef</span><span class="delimiter">(</span><a href="#593374" title="LazyVals.this.global.LabelDef">l</a>, <a href="#593380" title="LazyVals.this.global.TermName">name0</a>, <a href="#593381" title="List[LazyVals.this.global.Ident]">params0</a>,
                    <a href="#239221" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<span title="(tree: LazyVals.this.global.Tree, stats: List[LazyVals.this.global.Tree], expr: LazyVals.this.global.Tree)LazyVals.this.global.Block">Block</span><span class="delimiter">(</span><a href="#593382" title="LazyVals.this.global.Block">block</a>, <a href="../typechecker/Typers.scala.html#184436" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#592634" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#592844" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; LazyVals.this.global.Symbol">owner</a>, <a href="#593399" title="List[LazyVals.this.global.Tree]">stats1</a>.<span title="=&gt; LazyVals.this.global.Tree">head</span><span class="delimiter">)</span><span class="delimiter">)</span><a href="#593409" title="(x: LazyVals.this.global.Tree)List[LazyVals.this.global.Tree]">::</a><a href="#593399" title="List[LazyVals.this.global.Tree]">stats1</a>.<span title="=&gt; List[LazyVals.this.global.Tree]">tail</span>, <a href="#593382" title="LazyVals.this.global.Block">block</a>.<span title="=&gt; LazyVals.this.global.Tree">expr</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">else</span>
            <a href="#593374" title="LazyVals.this.global.LabelDef">l</a>

        <span class="keyword">case</span> <span title="LazyVals.this.global.Tree">_</span> =&gt; <a href="#239221" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="TypingTransformers.scala.html#586838" title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#592839" title="LazyVals.this.global.Tree">tree</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    /** Add the bitmap definitions to the rhs of a method definition.
     *  If the rhs has been tail-call transformed, insert the bitmap
     *  definitions inside the top-level label definition, so that each
     *  iteration has the lazy values un-initialized. Otherwise add them
     *  at the very beginning of the method.
     */
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree" id="592634">addBitmapDefs</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="592976">methSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#40001" title="LazyVals.this.global.Symbol">Symbol</a>, <a title="LazyVals.this.global.Tree" id="592977">rhs</a>: <span title="LazyVals.this.global.Tree">Tree</span><span class="delimiter">)</span>: <span title="LazyVals.this.global.Tree">Tree</span> = <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(stats: List[LazyVals.this.global.Tree], tree: LazyVals.this.global.Tree)LazyVals.this.global.Block" id="593420">prependStats</a><span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="593423">stats</a>: <span title="List[LazyVals.this.global.Tree]">List</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span>, <a title="LazyVals.this.global.Tree" id="593424">tree</a>: <span title="LazyVals.this.global.Tree">Tree</span><span class="delimiter">)</span>: <span title="LazyVals.this.global.Block">Block</span> = <a href="#593424" title="LazyVals.this.global.Tree">tree</a> <span title="LazyVals.this.global.Block" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="LazyVals.this.global.Block">Block</span><span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="593429">stats1</a>, <a title="LazyVals.this.global.Tree" id="593430">res</a><span class="delimiter">)</span> =&gt; <a href="../ast/TreeDSL.scala.html#184069" title="(stats: List[LazyVals.this.global.Tree], expr: LazyVals.this.global.Tree)LazyVals.this.global.Block">Block</a><span class="delimiter">(</span><a href="#593423" title="List[LazyVals.this.global.Tree]">stats</a> <a href="#593443" title="(prefix: List[LazyVals.this.global.Tree])List[LazyVals.this.global.Tree]">:::</a> <a href="#593429" title="List[LazyVals.this.global.Tree]">stats1</a>, <a href="#593430" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="LazyVals.this.global.Block">_</span> =&gt; <a href="../ast/TreeDSL.scala.html#184069" title="(stats: List[LazyVals.this.global.Tree], expr: LazyVals.this.global.Tree)LazyVals.this.global.Block">Block</a><span class="delimiter">(</span><a href="#593423" title="List[LazyVals.this.global.Tree]">stats</a>, <a href="#593424" title="LazyVals.this.global.Tree">tree</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="List[LazyVals.this.global.ValDef]" id="593421">bmps</a> = <a href="#592637" title="(key: LazyVals.this.global.Symbol)List[LazyVals.this.global.Symbol]">bitmaps</a><span class="delimiter">(</span><a href="#592976" title="LazyVals.this.global.Symbol">methSym</a><span class="delimiter">)</span> <span title="(f: LazyVals.this.global.Symbol =&gt; LazyVals.this.global.ValDef)(implicit bf: scala.collection.generic.CanBuildFrom[List[LazyVals.this.global.Symbol],LazyVals.this.global.ValDef,List[LazyVals.this.global.ValDef]])List[LazyVals.this.global.ValDef]">map</span> <span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#40610" title="(sym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.ValDef">ValDef</a><span class="delimiter">(</span><a href="#593502" title="LazyVals.this.global.Symbol">_</a>, <a href="../ast/TreeDSL.scala.html#241196" title="=&gt; LazyVals.this.global.Literal">ZERO</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">def</span> <a title="(params: List[LazyVals.this.global.Ident])Boolean" id="593422">isMatch</a><span class="delimiter">(</span><a title="List[LazyVals.this.global.Ident]" id="593540">params</a>: <span title="List[LazyVals.this.global.Ident]">List</span><span class="delimiter">[</span>Ident<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="#593540" title="List[LazyVals.this.global.Ident]">params</a>.<span title="=&gt; List[LazyVals.this.global.Ident]">tail</span> <span title="(that: scala.collection.GenSeq[LazyVals.this.global.Symbol])(p: (LazyVals.this.global.Ident, LazyVals.this.global.Symbol) =&gt; Boolean)Boolean">corresponds</span> <a href="#592976" title="LazyVals.this.global.Symbol">methSym</a>.<a href="../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; LazyVals.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#42750" title="=&gt; List[LazyVals.this.global.Symbol]">params</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#593580" title="LazyVals.this.global.Ident">_</a>.<span title="=&gt; LazyVals.this.global.Type">tpe</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#593581" title="LazyVals.this.global.Symbol">_</a>.<a href="../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; LazyVals.this.global.Type">tpe</a><span class="delimiter">)</span>

      <span title="LazyVals.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#593421" title="List[LazyVals.this.global.ValDef]">bmps</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#592977" title="LazyVals.this.global.Tree">rhs</a> <span class="keyword">else</span> <a href="#592977" title="LazyVals.this.global.Tree">rhs</a> <span title="LazyVals.this.global.Tree" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="LazyVals.this.global.Block">Block</span><span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="593591">assign</a>, <a title="LazyVals.this.global.LabelDef" id="593592">l</a> @ LabelDef<span class="delimiter">(</span><a title="LazyVals.this.global.TermName" id="593598">name</a>, <a title="List[LazyVals.this.global.Ident]" id="593599">params</a>, <a title="LazyVals.this.global.Tree" id="593600">rhs1</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">if</span> <a href="#593598" title="LazyVals.this.global.TermName">name</a>.<span title="()String">toString</span> <span title="(x$1: AnyRef)Boolean">==</span> <span class="delimiter">(</span><span title="String(&quot;_&quot;)" class="string">&quot;_&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#592976" title="LazyVals.this.global.Symbol">methSym</a>.<a href="../../../reflect/internal/Symbols.scala.html#47883" title="=&gt; LazyVals.this.global.Name">name</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#593422" title="(params: List[LazyVals.this.global.Ident])Boolean">isMatch</a><span class="delimiter">(</span><a href="#593599" title="List[LazyVals.this.global.Ident]">params</a><span class="delimiter">)</span> =&gt;
            <a href="../ast/TreeDSL.scala.html#184069" title="(stats: List[LazyVals.this.global.Tree], expr: LazyVals.this.global.Tree)LazyVals.this.global.Block">Block</a><span class="delimiter">(</span><a href="#593591" title="List[LazyVals.this.global.Tree]">assign</a>, <a href="#239221" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<span title="(tree: LazyVals.this.global.Tree, name: LazyVals.this.global.Name, params: List[LazyVals.this.global.Ident], rhs: LazyVals.this.global.Tree)LazyVals.this.global.LabelDef">LabelDef</span><span class="delimiter">(</span><a href="#593592" title="LazyVals.this.global.LabelDef">l</a>, <a href="#593598" title="LazyVals.this.global.TermName">name</a>, <a href="#593599" title="List[LazyVals.this.global.Ident]">params</a>, <a href="../typechecker/Typers.scala.html#184436" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#593420" title="(stats: List[LazyVals.this.global.Tree], tree: LazyVals.this.global.Tree)LazyVals.this.global.Block">prependStats</a><span class="delimiter">(</span><a href="#593421" title="List[LazyVals.this.global.ValDef]">bmps</a>, <a href="#593600" title="LazyVals.this.global.Tree">rhs1</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

        <span class="keyword">case</span> <span title="LazyVals.this.global.Block">_</span> =&gt; <a href="#593420" title="(stats: List[LazyVals.this.global.Tree], tree: LazyVals.this.global.Tree)LazyVals.this.global.Block">prependStats</a><span class="delimiter">(</span><a href="#593421" title="List[LazyVals.this.global.ValDef]">bmps</a>, <a href="#592977" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    /** return a 'lazified' version of rhs. Rhs should conform to the
     *  following schema:
     *  {
     *    l$ = &lt;rhs&gt;
     *    l$
     *  } or
     *  &lt;rhs&gt; when the lazy value has type Unit (for which there is no field
     *  to cache it's value.
     *
     *  The result will be a tree of the form
     *  {
     *    if ((bitmap$n &amp; MASK) == 0) {
     *       l$ = &lt;rhs&gt;
     *       bitmap$n = bimap$n | MASK
     *    }
     *    l$
     *  }
     *  where bitmap$n is an int value acting as a bitmap of initialized values. It is
     *  the 'n' is (offset / 32), the MASK is (1 &lt;&lt; (offset % 32)). If the value has type
     *  unit, no field is used to cache the value, so the resulting code is:
     *  {
     *    if ((bitmap$n &amp; MASK) == 0) {
     *       &lt;rhs&gt;;
     *       bitmap$n = bimap$n | MASK
     *    }
     *    ()
     *  }
     */
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(methOrClass: LazyVals.this.global.Symbol, tree: LazyVals.this.global.Tree, offset: Int, lazyVal: LazyVals.this.global.Symbol)LazyVals.this.global.Tree" id="592635">mkLazyDef</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="592939">methOrClass</a>: <a href="../../../reflect/internal/Symbols.scala.html#40001" title="LazyVals.this.global.Symbol">Symbol</a>, <a title="LazyVals.this.global.Tree" id="592940">tree</a>: <span title="LazyVals.this.global.Tree">Tree</span>, <a title="Int" id="592941">offset</a>: <span title="Int">Int</span>, <a title="LazyVals.this.global.Symbol" id="592942">lazyVal</a>: <a href="../../../reflect/internal/Symbols.scala.html#40001" title="LazyVals.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="LazyVals.this.global.Tree">Tree</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="LazyVals.this.global.Symbol" id="593624">bitmapSym</a>           = <a href="#592639" title="(meth: LazyVals.this.global.Symbol, offset: Int)LazyVals.this.global.Symbol">getBitmapFor</a><span class="delimiter">(</span><a href="#592939" title="LazyVals.this.global.Symbol">methOrClass</a>, <a href="#592941" title="Int">offset</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="LazyVals.this.global.Literal" id="593625">mask</a>                = <a href="../ast/TreeDSL.scala.html#274578" title="(x: Any)LazyVals.this.global.Literal">LIT</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span> <span title="(x: Int)Int">&lt;&lt;</span> <span class="delimiter">(</span><a href="#592941" title="Int">offset</a> <span title="(x: Int)Int">%</span> <a href="#239216" title="=&gt; Int">FLAGS_PER_WORD</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="LazyVals extends LazyVals.this.global.RefTree with Serializable" id="593626">bitmapRef</a> = <span title="LazyVals extends LazyVals.this.global.RefTree with Serializable" class="keyword">if</span> <span class="delimiter">(</span><a href="#592939" title="LazyVals.this.global.Symbol">methOrClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#47757" title="=&gt; Boolean">isClass</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#184069" title="(qualifier: LazyVals.this.global.Tree, sym: LazyVals.this.global.Symbol)LazyVals.this.global.Select">Select</a><span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#40628" title="(sym: LazyVals.this.global.Symbol)LazyVals.this.global.Tree">This</a><span class="delimiter">(</span><a href="#592939" title="LazyVals.this.global.Symbol">methOrClass</a><span class="delimiter">)</span>, <a href="#593624" title="LazyVals.this.global.Symbol">bitmapSym</a><span class="delimiter">)</span> <span class="keyword">else</span> <a href="../ast/TreeDSL.scala.html#184069" title="(sym: LazyVals.this.global.Symbol)LazyVals.this.global.Ident">Ident</a><span class="delimiter">(</span><a href="#593624" title="LazyVals.this.global.Symbol">bitmapSym</a><span class="delimiter">)</span>

      <span class="keyword">def</span> <a title="(stmt: LazyVals.this.global.Tree)LazyVals.this.global.Block" id="593627">mkBlock</a><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="593706">stmt</a>: <span title="LazyVals.this.global.Tree">Tree</span><span class="delimiter">)</span> = <a href="../ast/TreeDSL.scala.html#241244" title="(xs: LazyVals.this.global.Tree*)LazyVals.this.global.Block">BLOCK</a><span class="delimiter">(</span><a href="#593706" title="LazyVals.this.global.Tree">stmt</a>, <a href="#592636" title="(bmp: LazyVals.this.global.Symbol, mask: LazyVals.this.global.Tree, bmpRef: LazyVals.this.global.Tree)LazyVals.this.global.Tree">mkSetFlag</a><span class="delimiter">(</span><a href="#593624" title="LazyVals.this.global.Symbol">bitmapSym</a>, <a href="#593625" title="LazyVals.this.global.Literal">mask</a>, <a href="#593626" title="LazyVals extends LazyVals.this.global.RefTree with Serializable">bitmapRef</a><span class="delimiter">)</span>, <a href="../ast/TreeDSL.scala.html#241199" title="=&gt; LazyVals.this.global.Literal">UNIT</a><span class="delimiter">)</span>


      <span class="keyword">val</span> <a href="#593629" title="(LazyVals.this.global.Block, LazyVals.this.global.Tree)" class="delimiter">(</a><a href="#593628" title="LazyVals.this.global.Block" id="593629">block</a>, <a href="#593628" title="LazyVals.this.global.Tree" id="593630">res</a><span class="delimiter">)</span> = <a href="#592940" title="LazyVals.this.global.Tree">tree</a> <span title="(LazyVals.this.global.Block, LazyVals.this.global.Tree)" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="(LazyVals.this.global.Block, LazyVals.this.global.Tree)">Block</span><span class="delimiter">(</span><a href="#593717" title="(x: List[LazyVals.this.global.Tree])Some[List[LazyVals.this.global.Tree]]">List</a><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="593728">assignment</a><span class="delimiter">)</span>, <a title="LazyVals.this.global.Tree" id="593729">res</a><span class="delimiter">)</span> <span class="keyword">if</span> <span title="=&gt; Boolean">!</span><a href="#239218" title="(sym: LazyVals.this.global.Symbol)Boolean">lazyUnit</a><span class="delimiter">(</span><a href="#592942" title="LazyVals.this.global.Symbol">lazyVal</a><span class="delimiter">)</span> =&gt;
          <span title="(_1: LazyVals.this.global.Block, _2: LazyVals.this.global.Tree)(LazyVals.this.global.Block, LazyVals.this.global.Tree)" class="delimiter">(</span><a href="#593627" title="(stmt: LazyVals.this.global.Tree)LazyVals.this.global.Block">mkBlock</a><span class="delimiter">(</span><a href="#593728" title="LazyVals.this.global.Tree">assignment</a><span class="delimiter">)</span>,  <a href="#593729" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="(LazyVals.this.global.Block, LazyVals.this.global.Literal)" id="593736">rhs</a>                          =&gt;
          <span title="(_1: LazyVals.this.global.Block, _2: LazyVals.this.global.Literal)(LazyVals.this.global.Block, LazyVals.this.global.Literal)" class="delimiter">(</span><a href="#593627" title="(stmt: LazyVals.this.global.Tree)LazyVals.this.global.Block">mkBlock</a><span class="delimiter">(</span><a href="#593736" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span>,         <a href="../ast/TreeDSL.scala.html#241199" title="=&gt; LazyVals.this.global.Literal">UNIT</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="LazyVals.this.global.Apply" id="593631">cond</a> = <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#241253" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: LazyVals.this.global.Tree)LazyVals.this.CODE.TreeMethods">bitmapRef</a> <a href="../ast/TreeDSL.scala.html#241253" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: LazyVals.this.global.Tree)LazyVals.this.CODE.TreeMethods">INT_&amp;</a> <a href="#593625" title="LazyVals.this.global.Literal">mask</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#274642" title="(other: LazyVals.this.global.Tree)LazyVals.this.global.Apply">INT_==</a> <a href="../ast/TreeDSL.scala.html#241196" title="=&gt; LazyVals.this.global.Literal">ZERO</a>

      <a href="../../../reflect/internal/Trees.scala.html#40635" title="(pos: LazyVals.this.global.Position)(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">atPos</a><span class="delimiter">(</span><a href="#592940" title="LazyVals.this.global.Tree">tree</a>.<span title="=&gt; LazyVals.this.global.Position">pos</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="TypingTransformers.scala.html#586823" title="=&gt; LazyVals.this.global.analyzer.Typer">localTyper</a>.<a href="../typechecker/Typers.scala.html#184436" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a> <span class="delimiter">{</span>
        <span class="keyword">def</span> <a title="=&gt; LazyVals.this.global.gen.global.Tree" id="593780">body</a> = <a href="../Global.scala.html#182860" title="object LazyVals.this.global.gen">gen</a>.<a href="../ast/TreeGen.scala.html#235496" title="(clazz: LazyVals.this.global.gen.global.Symbol, cond: LazyVals.this.global.gen.global.Tree, syncBody: List[LazyVals.this.global.gen.global.Tree], stats: List[LazyVals.this.global.gen.global.Tree])LazyVals.this.global.gen.global.Tree">mkDoubleCheckedLocking</a><span class="delimiter">(</span><a href="#592939" title="LazyVals.this.global.Symbol">methOrClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#47975" title="=&gt; LazyVals.this.global.Symbol">enclClass</a>, <a href="#593631" title="LazyVals.this.global.Apply">cond</a>, <span title="(xs: LazyVals.this.global.Block*)List[LazyVals.this.global.Block]">List</span><span class="delimiter">(</span><a href="#593629" title="LazyVals.this.global.Block">block</a><span class="delimiter">)</span>, <span title="object Nil">Nil</span><span class="delimiter">)</span>
        <a href="../ast/TreeDSL.scala.html#241244" title="(xs: LazyVals.this.global.Tree*)LazyVals.this.global.Block">BLOCK</a><span class="delimiter">(</span><a href="#593780" title="=&gt; LazyVals.this.global.gen.global.Tree">body</a>, <a href="#593630" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(bmp: LazyVals.this.global.Symbol, mask: LazyVals.this.global.Tree, bmpRef: LazyVals.this.global.Tree)LazyVals.this.global.Tree" id="592636">mkSetFlag</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="593708">bmp</a>: <a href="../../../reflect/internal/Symbols.scala.html#40001" title="LazyVals.this.global.Symbol">Symbol</a>, <a title="LazyVals.this.global.Tree" id="593709">mask</a>: <span title="LazyVals.this.global.Tree">Tree</span>, <a title="LazyVals.this.global.Tree" id="593710">bmpRef</a>: <span title="LazyVals.this.global.Tree">Tree</span><span class="delimiter">)</span>: <span title="LazyVals.this.global.Tree">Tree</span> =
      <a href="../ast/TreeDSL.scala.html#241253" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: LazyVals.this.global.Tree)LazyVals.this.CODE.TreeMethods">bmpRef</a> <a href="../ast/TreeDSL.scala.html#274651" title="(rhs: LazyVals.this.global.Tree)LazyVals.this.global.Assign">===</a> <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#241253" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: LazyVals.this.global.Tree)LazyVals.this.CODE.TreeMethods">bmpRef</a> <a href="../ast/TreeDSL.scala.html#274639" title="(other: LazyVals.this.global.Tree)LazyVals.this.global.Apply">INT_|</a> <a href="#593709" title="LazyVals.this.global.Tree">mask</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="bitmaps extends scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]" id="592637">bitmaps</a> = <a href="#592790" title="scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]" class="keyword">new</a> <a title="anonymous class $anon extends scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]" id="592790">mutable</a>.<span title="scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]">HashMap</span><span class="delimiter">[</span>Symbol, List<span class="delimiter">[</span>Symbol<span class="delimiter">]</span><span class="delimiter">]</span> <span class="delimiter">{</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="(meth: LazyVals.this.global.Symbol)scala.collection.immutable.Nil.type" id="592792">default</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="592793">meth</a>: <a href="../../../reflect/internal/Symbols.scala.html#40001" title="LazyVals.this.global.Symbol">Symbol</a><span class="delimiter">)</span> = <span title="object Nil">Nil</span>
    <span class="delimiter">}</span>

    /** Return the symbol corresponding of the right bitmap int inside meth,
     *  given offset.
     */
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(meth: LazyVals.this.global.Symbol, offset: Int)LazyVals.this.global.Symbol" id="592639">getBitmapFor</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="593632">meth</a>: <a href="../../../reflect/internal/Symbols.scala.html#40001" title="LazyVals.this.global.Symbol">Symbol</a>, <a title="Int" id="593633">offset</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="../../../reflect/internal/Symbols.scala.html#40001" title="LazyVals.this.global.Symbol">Symbol</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Int" id="593817">n</a> = <a href="#593633" title="Int">offset</a> <span title="(x: Int)Int">/</span> <a href="#239216" title="=&gt; Int">FLAGS_PER_WORD</a>
      <span class="keyword">val</span> <a title="List[LazyVals.this.global.Symbol]" id="593818">bmps</a> = <a href="#592637" title="(key: LazyVals.this.global.Symbol)List[LazyVals.this.global.Symbol]">bitmaps</a><span class="delimiter">(</span><a href="#593632" title="LazyVals.this.global.Symbol">meth</a><span class="delimiter">)</span>
      <span title="LazyVals.this.global.Symbol" class="keyword">if</span> <span class="delimiter">(</span><a href="#593818" title="List[LazyVals.this.global.Symbol]">bmps</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">&gt;</span> <a href="#593817" title="Int">n</a><span class="delimiter">)</span>
        <a href="#593818" title="(n: Int)LazyVals.this.global.Symbol">bmps</a><span class="delimiter">(</span><a href="#593817" title="Int">n</a><span class="delimiter">)</span>
      <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="LazyVals.this.global.TermSymbol" id="593842">sym</a> = <a href="#593632" title="LazyVals.this.global.Symbol">meth</a>.<a href="../../../reflect/internal/Symbols.scala.html#47699" title="(name: LazyVals.this.global.TermName, pos: LazyVals.this.global.Position, newFlags: Long)LazyVals.this.global.TermSymbol">newVariable</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#40560" title="object LazyVals.this.global.nme">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#60402" title="(bitmapPrefix: LazyVals.this.global.Name, n: Int)bitmapPrefix.ThisNameType">newBitmapName</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#40560" title="object LazyVals.this.global.nme">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#60405" title="=&gt; LazyVals.this.global.nme.NameType">BITMAP_NORMAL</a>, <a href="#593817" title="Int">n</a><span class="delimiter">)</span>, <a href="#593632" title="LazyVals.this.global.Symbol">meth</a>.<a href="../../../reflect/internal/Symbols.scala.html#47694" title="=&gt; LazyVals.this.global.Position">pos</a><span class="delimiter">)</span>.<a href="../../../reflect/internal/Symbols.scala.html#47922" title="(info: LazyVals.this.global.Type)LazyVals.this.global.TermSymbol">setInfo</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#46842" title="=&gt; LazyVals.this.global.Symbol">IntClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; LazyVals.this.global.Type">tpe</a><span class="delimiter">)</span>
        <a href="../../../reflect/internal/SymbolTable.scala.html#36972" title="(ph: scala.reflect.internal.Phase)(op: =&gt; LazyVals.this.global.TermSymbol)LazyVals.this.global.TermSymbol">atPhase</a><span class="delimiter">(</span><a href="../Global.scala.html#183023" title="=&gt; LazyVals.this.global.Run">currentRun</a>.<a href="../Global.scala.html#185227" title="=&gt; scala.tools.nsc.Phase">typerPhase</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#593842" title="LazyVals.this.global.TermSymbol">sym</a> <a href="../../../reflect/internal/Symbols.scala.html#47960" title="(sym: LazyVals.this.global.Symbol, args: LazyVals.this.global.Tree*)sym.type">addAnnotation</a> <a href="../../../reflect/internal/Definitions.scala.html#46727" title="=&gt; LazyVals.this.global.Symbol">VolatileAttr</a>
        <span class="delimiter">}</span>

        <a href="#592637" title="(key: LazyVals.this.global.Symbol, value: List[LazyVals.this.global.Symbol])Unit">bitmaps</a><span class="delimiter">(</span><a href="#593632" title="LazyVals.this.global.Symbol">meth</a><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="#593842" title="LazyVals.this.global.TermSymbol">sym</a> <a href="#593868" title="(x: LazyVals.this.global.Symbol)List[LazyVals.this.global.Symbol]">::</a> <a href="#593818" title="List[LazyVals.this.global.Symbol]">bmps</a><span class="delimiter">)</span>.<span title="=&gt; List[LazyVals.this.global.Symbol]">reverse</span>
        <a href="#593842" title="LazyVals.this.global.TermSymbol">sym</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/typechecker/Macros.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> typechecker

<span class="keyword">import</span> symtab.<a href="../symtab/package.scala.html#36230" title="=&gt; reflect.internal.Flags.type">Flags</a>._

<span class="keyword">trait</span> <a title="trait Macros extends Object with ScalaObject" id="33859">Macros</a> <span title="ScalaObject" class="delimiter">{</span> self: Analyzer =&gt;
  <span class="keyword">import</span> <a href="Analyzer.scala.html#183929" title="=&gt; scala.tools.nsc.Global">global</a>._
  <span class="keyword">import</span> <a href="../../../reflect/internal/Definitions.scala.html#40473" title="object Macros.this.global.definitions">definitions</a>._

  <span class="keyword">def</span> <a title="(mac: Macros.this.global.Symbol)Macros.this.global.Symbol" id="184209">macroMeth</a><span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="634663">mac</a>: <a href="../../../reflect/internal/Symbols.scala.html#40001" title="Macros.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Symbols.scala.html#40001" title="Macros.this.global.Symbol">Symbol</a> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Macros.this.global.Symbol" id="634665">owner</a> = <a href="#634663" title="Macros.this.global.Symbol">mac</a>.<a href="../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; Macros.this.global.Symbol">owner</a>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#634665" title="Macros.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#47775" title="=&gt; Boolean">isModuleClass</a><span class="delimiter">)</span> <a href="#634665" title="Macros.this.global.Symbol">owner</a> = <a href="#634665" title="Macros.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#48005" title="=&gt; Macros.this.global.Symbol">companionModule</a>.<a href="../../../reflect/internal/Symbols.scala.html#48010" title="=&gt; Macros.this.global.Symbol">moduleClass</a>
    <a href="#634665" title="Macros.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#47920" title="=&gt; Macros.this.global.Type">info</a>.<a href="../../../reflect/internal/Types.scala.html#42761" title="(name: Macros.this.global.Name)Macros.this.global.Symbol">decl</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#40560" title="object Macros.this.global.nme">nme</a>.<a href="../../../reflect/internal/NameManglers.scala.html#60686" title="(name: Macros.this.global.Name)Macros.this.global.TermName">macroMethodName</a><span class="delimiter">(</span><a href="#634663" title="Macros.this.global.Symbol">mac</a>.<a href="../../../reflect/internal/Symbols.scala.html#47883" title="=&gt; Macros.this.global.Name">name</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  /**
   * The definition of the method implementing a macro. Example:
   *  Say we have in a class C
   *
   *    def macro foo[T](xs: List[T]): T = expr
   *
   *  Then the following macro method is generated for `foo`:
   *
   *    def defmacro$foo(glob: scala.reflect.api.Universe)
   *           (_this: glob.Tree)
   *           (T: glob.Type)
   *           (xs: glob.Tree): glob.Tree = {
   *      implicit val $glob = glob
   *      expr
   *    }
   *
   *    If `foo` is declared in an object, the second parameter list is () instead of (_this: glob.Tree).
   */
  <span class="keyword">def</span> <a title="(mdef: Macros.this.global.DefDef)Macros.this.global.Tree" id="184210">macroMethDef</a><span class="delimiter">(</span><a title="Macros.this.global.DefDef" id="634671">mdef</a>: <span title="Macros.this.global.DefDef">DefDef</span><span class="delimiter">)</span>: <span title="Macros.this.global.Tree">Tree</span> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(name: Macros.this.global.Name, tpt: Macros.this.global.Tree)Macros.this.global.ValDef" id="634673">paramDef</a><span class="delimiter">(</span><a title="Macros.this.global.Name" id="634683">name</a>: <a href="../../../reflect/internal/Names.scala.html#39679" title="Macros.this.global.Name">Name</a>, <a title="Macros.this.global.Tree" id="634684">tpt</a>: <span title="Macros.this.global.Tree">Tree</span><span class="delimiter">)</span> = <a href="Analyzer.scala.html#183929" title="(mods: Macros.this.global.Modifiers, name: Macros.this.global.TermName, tpt: Macros.this.global.Tree, rhs: Macros.this.global.Tree)Macros.this.global.ValDef">ValDef</a><span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#40602" title="(flags: Long)Macros.this.global.Modifiers">Modifiers</a><span class="delimiter">(</span><span title="Long(8192L)">PARAM</span><span class="delimiter">)</span>, <a href="../../../reflect/internal/Names.scala.html#39643" title="implicit scala.reflect.internal.Names.promoteTermNamesAsNecessary : (name: Macros.this.global.Name)Macros.this.global.TermName">name</a>, <a href="#634684" title="Macros.this.global.Tree">tpt</a>, <a href="Analyzer.scala.html#183929" title="object Macros.this.global.EmptyTree">EmptyTree</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Macros.this.global.TypeTree" id="634674">universeType</a> = <a href="Analyzer.scala.html#183929" title="(tp: Macros.this.global.Type)Macros.this.global.TypeTree">TypeTree</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#46465" title="=&gt; Macros.this.global.Symbol">ReflectApiUniverse</a>.<a href="../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; Macros.this.global.Type">tpe</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="List[Macros.this.global.ValDef]" id="634675">globParamSec</a> = <span title="(xs: Macros.this.global.ValDef*)List[Macros.this.global.ValDef]">List</span><span class="delimiter">(</span><a href="#634673" title="(name: Macros.this.global.Name, tpt: Macros.this.global.Tree)Macros.this.global.ValDef">paramDef</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#40560" title="object Macros.this.global.nme">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#60248" title="=&gt; Macros.this.global.nme.NameType">glob</a>, <a href="#634674" title="Macros.this.global.TypeTree">universeType</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(name: Macros.this.global.Name)Macros.this.global.Select" id="634676">globSelect</a><span class="delimiter">(</span><a title="Macros.this.global.Name" id="634742">name</a>: <a href="../../../reflect/internal/Names.scala.html#39679" title="Macros.this.global.Name">Name</a><span class="delimiter">)</span> = <a href="Analyzer.scala.html#183929" title="(qualifier: Macros.this.global.Tree, name: Macros.this.global.Name)Macros.this.global.Select">Select</a><span class="delimiter">(</span><a href="Analyzer.scala.html#183929" title="(name: Macros.this.global.Name)Macros.this.global.Ident">Ident</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#40560" title="object Macros.this.global.nme">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#60248" title="=&gt; Macros.this.global.nme.NameType">glob</a><span class="delimiter">)</span>, <a href="#634742" title="Macros.this.global.Name">name</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="=&gt; Macros.this.global.Select" id="634677">globTree</a> = <a href="#634676" title="(name: Macros.this.global.Name)Macros.this.global.Select">globSelect</a><span class="delimiter">(</span><a href="../../../reflect/internal/Names.scala.html#39671" title="(s: String)Macros.this.global.TypeName">newTypeName</a><span class="delimiter">(</span><span title="String(&quot;Tree&quot;)" class="string">&quot;Tree&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="=&gt; Macros.this.global.Select" id="634678">globType</a> = <a href="#634676" title="(name: Macros.this.global.Name)Macros.this.global.Select">globSelect</a><span class="delimiter">(</span><a href="../../../reflect/internal/Names.scala.html#39671" title="(s: String)Macros.this.global.TypeName">newTypeName</a><span class="delimiter">(</span><span title="String(&quot;Type&quot;)" class="string">&quot;Type&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="List[Macros.this.global.ValDef]" id="634679">thisParamSec</a> = <span title="List[Macros.this.global.ValDef]" class="keyword">if</span> <span class="delimiter">(</span><a href="#634671" title="Macros.this.global.DefDef">mdef</a>.<span title="=&gt; Macros.this.global.Symbol">symbol</span>.<a href="../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; Macros.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#47775" title="=&gt; Boolean">isModuleClass</a><span class="delimiter">)</span> List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span> <span class="keyword">else</span> <span title="(xs: Macros.this.global.ValDef*)List[Macros.this.global.ValDef]">List</span><span class="delimiter">(</span><a href="#634673" title="(name: Macros.this.global.Name, tpt: Macros.this.global.Tree)Macros.this.global.ValDef">paramDef</a><span class="delimiter">(</span><a href="../../../reflect/internal/Names.scala.html#39670" title="(s: String)Macros.this.global.TermName">newTermName</a><span class="delimiter">(</span><span title="String(&quot;_this&quot;)" class="string">&quot;_this&quot;</span><span class="delimiter">)</span>, <a href="#634677" title="=&gt; Macros.this.global.Select">globTree</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(tdef: Macros.this.global.TypeDef)Macros.this.global.ValDef" id="634680">tparamInMacro</a><span class="delimiter">(</span><a title="Macros.this.global.TypeDef" id="634809">tdef</a>: <span title="Macros.this.global.TypeDef">TypeDef</span><span class="delimiter">)</span> = <a href="#634673" title="(name: Macros.this.global.Name, tpt: Macros.this.global.Tree)Macros.this.global.ValDef">paramDef</a><span class="delimiter">(</span><a href="#634809" title="Macros.this.global.TypeDef">tdef</a>.<span title="=&gt; Macros.this.global.TypeName">name</span>.<a href="../../../reflect/internal/Names.scala.html#67995" title="=&gt; Macros.this.global.TermName">toTermName</a>, <a href="#634678" title="=&gt; Macros.this.global.Select">globType</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(vdef: Macros.this.global.ValDef)Macros.this.global.ValDef" id="634681">vparamInMacro</a><span class="delimiter">(</span><a title="Macros.this.global.ValDef" id="634810">vdef</a>: <span title="Macros.this.global.ValDef">ValDef</span><span class="delimiter">)</span>: <span title="Macros.this.global.ValDef">ValDef</span> = <a href="#634673" title="(name: Macros.this.global.Name, tpt: Macros.this.global.Tree)Macros.this.global.ValDef">paramDef</a><span class="delimiter">(</span><a href="#634810" title="Macros.this.global.ValDef">vdef</a>.<span title="=&gt; Macros.this.global.TermName">name</span>, <a href="#634677" title="=&gt; Macros.this.global.Select">globTree</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(tree: Macros.this.global.Tree)Macros.this.global.Block" id="634682">wrapImplicit</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="634811">tree</a>: <span title="Macros.this.global.Tree">Tree</span><span class="delimiter">)</span> = <a href="../../../reflect/internal/Trees.scala.html#40635" title="(pos: Macros.this.global.Position)(tree: Macros.this.global.Block)Macros.this.global.Block">atPos</a><span class="delimiter">(</span><a href="#634811" title="Macros.this.global.Tree">tree</a>.<span title="=&gt; Macros.this.global.Position">pos</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="Analyzer.scala.html#183929" title="(stats: List[Macros.this.global.Tree], expr: Macros.this.global.Tree)Macros.this.global.Block">Block</a><span class="delimiter">(</span><span title="(xs: Macros.this.global.ValDef*)List[Macros.this.global.ValDef]">List</span><span class="delimiter">(</span><a href="Analyzer.scala.html#183929" title="(mods: Macros.this.global.Modifiers, name: Macros.this.global.TermName, tpt: Macros.this.global.Tree, rhs: Macros.this.global.Tree)Macros.this.global.ValDef">ValDef</a><span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#40602" title="(flags: Long)Macros.this.global.Modifiers">Modifiers</a><span class="delimiter">(</span><span title="Long(512L)">IMPLICIT</span><span class="delimiter">)</span>, <a href="../../../reflect/internal/Names.scala.html#39670" title="(s: String)Macros.this.global.TermName">newTermName</a><span class="delimiter">(</span><span title="String(&quot;$&quot;)" class="string">&quot;$&quot;</span> <span title="(x$1: Any)String">+</span> <a href="../../../reflect/internal/StdNames.scala.html#40560" title="object Macros.this.global.nme">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#60248" title="=&gt; Macros.this.global.nme.NameType">glob</a><span class="delimiter">)</span>, <a href="#634674" title="Macros.this.global.TypeTree">universeType</a>, <a href="Analyzer.scala.html#183929" title="(name: Macros.this.global.Name)Macros.this.global.Ident">Ident</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#40560" title="object Macros.this.global.nme">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#60248" title="=&gt; Macros.this.global.nme.NameType">glob</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#634811" title="Macros.this.global.Tree">tree</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <a href="../../../reflect/internal/Trees.scala.html#40635" title="(pos: Macros.this.global.Position)(tree: Macros.this.global.DefDef)Macros.this.global.DefDef">atPos</a><span class="delimiter">(</span><a href="#634671" title="Macros.this.global.DefDef">mdef</a>.<span title="=&gt; Macros.this.global.Position">pos</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Macros.this.global.DefDef" class="keyword">new</span> <a href="Analyzer.scala.html#183929" title="Macros.this.global.DefDef">DefDef</a><span class="delimiter">(</span> // can't call DefDef here; need to find out why
        mods = <a href="#634671" title="Macros.this.global.DefDef">mdef</a>.<span title="=&gt; Macros.this.global.Modifiers">mods</span> <a href="../../../reflect/internal/Trees.scala.html#85421" title="(flag: Long)Macros.this.global.Modifiers">&amp;~</a> <span title="Long(32768L)">MACRO</span>,
        name = <a href="../../../reflect/internal/StdNames.scala.html#40560" title="object Macros.this.global.nme">nme</a>.<a href="../../../reflect/internal/NameManglers.scala.html#60686" title="(name: Macros.this.global.Name)Macros.this.global.TermName">macroMethodName</a><span class="delimiter">(</span><a href="#634671" title="Macros.this.global.DefDef">mdef</a>.<span title="=&gt; Macros.this.global.Name">name</span><span class="delimiter">)</span>,
        tparams = List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>,
        vparamss = <a href="#634675" title="List[Macros.this.global.ValDef]">globParamSec</a> <a href="#634900" title="(x: List[Macros.this.global.ValDef])List[List[Macros.this.global.ValDef]]">::</a> <a href="#634679" title="List[Macros.this.global.ValDef]">thisParamSec</a> <a href="#634901" title="(x: List[Macros.this.global.ValDef])List[List[Macros.this.global.ValDef]]">::</a> <span class="delimiter">(</span><a href="#634671" title="Macros.this.global.DefDef">mdef</a>.<span title="=&gt; List[Macros.this.global.TypeDef]">tparams</span> <span title="(f: Macros.this.global.TypeDef =&gt; Macros.this.global.ValDef)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.TypeDef],Macros.this.global.ValDef,List[Macros.this.global.ValDef]])List[Macros.this.global.ValDef]">map</span> <a href="#634680" title="(tdef: Macros.this.global.TypeDef)Macros.this.global.ValDef">tparamInMacro</a><span class="delimiter">)</span> <a href="#634902" title="(x: List[Macros.this.global.ValDef])List[List[Macros.this.global.ValDef]]">::</a>
          <span class="delimiter">(</span><a href="#634671" title="Macros.this.global.DefDef">mdef</a>.<span title="=&gt; List[List[Macros.this.global.ValDef]]">vparamss</span> <span title="(f: List[Macros.this.global.ValDef] =&gt; List[Macros.this.global.ValDef])(implicit bf: scala.collection.generic.CanBuildFrom[List[List[Macros.this.global.ValDef]],List[Macros.this.global.ValDef],List[List[Macros.this.global.ValDef]]])List[List[Macros.this.global.ValDef]]">map</span> <span class="delimiter">(</span><a href="#634963" title="List[Macros.this.global.ValDef]">_</a> <span title="(f: Macros.this.global.ValDef =&gt; Macros.this.global.ValDef)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.ValDef],Macros.this.global.ValDef,List[Macros.this.global.ValDef]])List[Macros.this.global.ValDef]">map</span> <a href="#634681" title="(vdef: Macros.this.global.ValDef)Macros.this.global.ValDef">vparamInMacro</a><span class="delimiter">)</span><span class="delimiter">)</span>,
        tpt = <a href="#634677" title="=&gt; Macros.this.global.Select">globTree</a>,
        <a href="#634682" title="(tree: Macros.this.global.Tree)Macros.this.global.Block">wrapImplicit</a><span class="delimiter">(</span><a href="#634671" title="Macros.this.global.DefDef">mdef</a>.<span title="=&gt; Macros.this.global.Tree">rhs</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(templ: Macros.this.global.Template, namer: Macros.this.Namer)Unit" id="184211">addMacroMethods</a><span class="delimiter">(</span><a title="Macros.this.global.Template" id="635048">templ</a>: <span title="Macros.this.global.Template">Template</span>, <a title="Macros.this.Namer" id="635049">namer</a>: <a href="Namers.scala.html#183984" title="Macros.this.Namer">Namer</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">for</span> <span class="delimiter">(</span><a title="Macros.this.global.DefDef" id="635104">ddef</a> @ DefDef<span class="delimiter">(</span><a title="Macros.this.global.Modifiers" id="635113">mods</a>, _, _, _, _, _<span class="delimiter">)</span> &lt;- <a href="#635048" title="Macros.this.global.Template">templ</a>.<a href="#635054" title="(f: Macros.this.global.Tree =&gt; Unit)Unit">body</a> <span class="keyword">if</span> <a href="#635113" title="Macros.this.global.Modifiers">mods</a> <a href="../../../reflect/internal/Trees.scala.html#85417" title="(flag: Long)Boolean">hasFlag</a> <span title="Long(32768L)">MACRO</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="635114">sym</a> = <a href="#635049" title="Macros.this.Namer">namer</a>.<a href="Namers.scala.html#619551" title="(tree: Macros.this.global.Tree)Macros.this.global.Symbol">enterSyntheticSym</a><span class="delimiter">(</span>util.<a href="../util/SimpleTracer.scala.html#183220" title="(msg: String)(value: Macros.this.global.Tree)Macros.this.global.Tree">trace</a><span class="delimiter">(</span><span title="String(&quot;macro def: &quot;)" class="string">&quot;macro def: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#184210" title="(mdef: Macros.this.global.DefDef)Macros.this.global.Tree">macroMethDef</a><span class="delimiter">(</span><a href="#635104" title="Macros.this.global.DefDef">ddef</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;added to &quot;)" class="string">&quot;added to &quot;</span><span title="(x$1: Any)String">+</span><a href="#635049" title="Macros.this.Namer">namer</a>.<a href="Namers.scala.html#619487" title="=&gt; Macros.this.Context">context</a>.<a href="Contexts.scala.html#184558" title="=&gt; Macros.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#47975" title="=&gt; Macros.this.global.Symbol">enclClass</a><span title="(x$1: Any)String">+</span><span title="String(&quot;: &quot;)" class="string">&quot;: &quot;</span><span title="(x$1: Any)String">+</span><a href="#635114" title="Macros.this.global.Symbol">sym</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(tree: Macros.this.global.Tree)Macros.this.global.Tree" id="184212">macroExpand</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="635128">tree</a>: <span title="Macros.this.global.Tree">Tree</span><span class="delimiter">)</span>: <span title="Macros.this.global.Tree">Tree</span> = <span title="=&gt; Nothing">???</span>

<span class="delimiter">}</span>
        </pre>
    </body>
</html>
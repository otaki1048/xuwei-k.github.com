<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/backend/msil/GenMSIL.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
/* NSC -- new scala compiler
 * Copyright 2005-2011 LAMP/EPFL
 * @author Nikolay Mihaylov
 */


<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> backend.msil

<span class="keyword">import</span> java.io.<span class="delimiter">{</span>File, IOException<span class="delimiter">}</span>
<span class="keyword">import</span> java.nio.<span class="delimiter">{</span>ByteBuffer, ByteOrder<span class="delimiter">}</span>
<span class="keyword">import</span> scala.collection.<span class="delimiter">{</span> mutable, immutable <span class="delimiter">}</span>
<span class="keyword">import</span> scala.tools.nsc.symtab._

<span class="keyword">import</span> ch.epfl.lamp.compiler.msil.<span class="delimiter">{</span>Type =&gt; MsilType, _<span class="delimiter">}</span>
<span class="keyword">import</span> ch.epfl.lamp.compiler.msil.emit._
<span class="keyword">import</span> ch.epfl.lamp.compiler.msil.util.PECustomMod

<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class GenMSIL extends scala.tools.nsc.SubComponent with ScalaObject" id="18068">GenMSIL</a> <a href="#18068" title="ScalaObject" class="keyword">extends</a> <a href="../../SubComponent.scala.html#12956" title="scala.tools.nsc.SubComponent">SubComponent</a> <span class="delimiter">{</span>
  <span class="keyword">import</span> <a href="../../SubComponent.scala.html#228250" title="=&gt; scala.tools.nsc.Global">global</a>._
  <span class="keyword">import</span> <a href="../../Global.scala.html#182918" title="=&gt; scala.tools.nsc.symtab.SymbolLoaders{val global: GenMSIL.this.global.type}">loaders</a>.clrTypes
  <span class="keyword">import</span> <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<span class="delimiter">{</span>types, constructors, methods, fields<span class="delimiter">}</span>
  <span class="keyword">import</span> <a href="../../Global.scala.html#182864" title="object GenMSIL.this.global.icodes">icodes</a>._
  <span class="keyword">import</span> <a href="../../Global.scala.html#182864" title="object GenMSIL.this.global.icodes">icodes</a>.<a href="../icode/Opcodes.scala.html#228942" title="object GenMSIL.this.global.icodes.opcodes">opcodes</a>._

  <span class="keyword">val</span> <a title="loaders extends scala.tools.nsc.symtab.SymbolLoaders" id="310238">x</a> = <a href="../../Global.scala.html#182918" title="=&gt; scala.tools.nsc.symtab.SymbolLoaders{val global: GenMSIL.this.global.type}">loaders</a>

  /** Create a new phase */
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(p: scala.tools.nsc.Phase)GenMSIL.this.MsilPhase" id="310240">newPhase</a><span class="delimiter">(</span><a title="scala.tools.nsc.Phase" id="356888">p</a>: <a href="../../../../reflect/internal/Phase.scala.html#7654" title="scala.tools.nsc.Phase">Phase</a><span class="delimiter">)</span> = <span title="GenMSIL.this.MsilPhase" class="keyword">new</span> <a href="#310243" title="GenMSIL.this.MsilPhase">MsilPhase</a><span class="delimiter">(</span><a href="#356888" title="scala.tools.nsc.Phase">p</a><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="String" id="310241">phaseName</a> = <span title="String(&quot;msil&quot;)" class="string">&quot;msil&quot;</span>
  /** MSIL code generation phase
   */
  <span class="keyword">class</span> <a title="class MsilPhase extends GenMSIL.this.global.GlobalPhase with ScalaObject" id="310243">MsilPhase</a><a href="#310243" title="ScalaObject" class="delimiter">(</a><a title="scala.tools.nsc.Phase" id="356899">prev</a>: <a href="../../../../reflect/internal/Phase.scala.html#7654" title="scala.tools.nsc.Phase">Phase</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../Global.scala.html#182927" title="GenMSIL.this.global.GlobalPhase">GlobalPhase</a><span class="delimiter">(</span><a href="#356899" title="scala.tools.nsc.Phase">prev</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="=&gt; String" id="356894">name</a> = <a href="#310241" title="=&gt; String">phaseName</a>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Long" id="356895">newFlags</a> = <a href="../../SubComponent.scala.html#228259" title="=&gt; Long">phaseNewFlags</a>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Boolean" id="356896">erasedTypes</a> = <span title="Boolean(true)" class="keyword">true</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="356897">run</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#182849" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#183452" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#183734" title="=&gt; Boolean">value</a><span class="delimiter">)</span> <a href="../../Global.scala.html#182890" title="(msg: String)Unit">inform</a><span class="delimiter">(</span><span title="String(&quot;[running phase &quot;)" class="string">&quot;[running phase &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#356894" title="=&gt; String">name</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; on icode]&quot;)" class="string">&quot; on icode]&quot;</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="GenMSIL.this.BytecodeGenerator" id="356912">codeGenerator</a> = <span title="GenMSIL.this.BytecodeGenerator" class="keyword">new</span> <a href="#310244" title="GenMSIL.this.BytecodeGenerator">BytecodeGenerator</a>

      //classes is ICodes.classes, a HashMap[Symbol, IClass]
      <a href="../icode/ICodes.scala.html#228877" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.global.Symbol,GenMSIL.this.global.icodes.IClass]">classes</a>.<span title="=&gt; Iterable[GenMSIL.this.global.icodes.IClass]">values</span> <span title="(f: GenMSIL.this.global.icodes.IClass =&gt; Unit)Unit">foreach</span> <a href="#356912" title="GenMSIL.this.BytecodeGenerator">codeGenerator</a>.<a href="#357080" title="(cls: GenMSIL.this.global.icodes.IClass)Unit">findEntryPoint</a>
      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span> <a href="../../Global.scala.html#182909" title="object GenMSIL.this.global.opt">opt</a>.<a href="../../Global.scala.html#229311" title="=&gt; Option[GenMSIL.this.global.Name]">showClass</a>.<span title="=&gt; Boolean">isDefined</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span class="delimiter">(</span><a href="#356912" title="GenMSIL.this.BytecodeGenerator">codeGenerator</a>.<a href="#357074" title="=&gt; GenMSIL.this.global.Symbol">entryPoint</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">)</span> <span class="delimiter">{</span> // TODO introduce dedicated setting instead
        <span class="keyword">val</span> <a title="String" id="357161">entryclass</a> = <a href="../../Global.scala.html#182909" title="object GenMSIL.this.global.opt">opt</a>.<a href="../../Global.scala.html#229311" title="=&gt; Option[GenMSIL.this.global.Name]">showClass</a>.<span title="=&gt; GenMSIL.this.global.Name">get</span>.<span title="()String">toString</span>
        <a href="../../Global.scala.html#182891" title="(msg: String)Unit">warning</a><span class="delimiter">(</span><span title="String(&quot;Couldn\'t find entry class &quot;)" class="string">&quot;Couldn't find entry class &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#357161" title="String">entryclass</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="#356912" title="GenMSIL.this.BytecodeGenerator">codeGenerator</a>.<a href="#357016" title="()Unit">initAssembly</a>

      <span class="keyword">val</span> <a title="List[GenMSIL.this.global.icodes.IClass]" id="356913">classesSorted</a> = <a href="../icode/ICodes.scala.html#228877" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.global.Symbol,GenMSIL.this.global.icodes.IClass]">classes</a>.<span title="=&gt; Iterable[GenMSIL.this.global.icodes.IClass]">values</span>.<span title="=&gt; List[GenMSIL.this.global.icodes.IClass]">toList</span>.<span title="(f: GenMSIL.this.global.icodes.IClass =&gt; Int)(implicit ord: scala.math.Ordering[Int])List[GenMSIL.this.global.icodes.IClass]">sortBy</span><span title="object scala.math.Ordering.Int" class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IClass" id="357171">c</a> =&gt; <a href="#357171" title="GenMSIL.this.global.icodes.IClass">c</a>.<a href="../icode/Members.scala.html#229219" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47689" title="=&gt; Int">id</a><span class="delimiter">)</span> // simplifies comparing cross-compiler vs. .exe output
      <a href="#356913" title="List[GenMSIL.this.global.icodes.IClass]">classesSorted</a> <span title="(f: GenMSIL.this.global.icodes.IClass =&gt; Unit)Unit">foreach</span> <a href="#356912" title="GenMSIL.this.BytecodeGenerator">codeGenerator</a>.<a href="#357087" title="(iclass: GenMSIL.this.global.icodes.IClass)Unit">createTypeBuilder</a>
      <a href="#356913" title="List[GenMSIL.this.global.icodes.IClass]">classesSorted</a> <span title="(f: GenMSIL.this.global.icodes.IClass =&gt; Unit)Unit">foreach</span> <a href="#356912" title="GenMSIL.this.BytecodeGenerator">codeGenerator</a>.<a href="#357088" title="(iclass: GenMSIL.this.global.icodes.IClass)Unit">createClassMembers</a>

      <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="#356913" title="List[GenMSIL.this.global.icodes.IClass]">classesSorted</a> <span title="(f: GenMSIL.this.global.icodes.IClass =&gt; Unit)Unit">foreach</span> <a href="#356912" title="GenMSIL.this.BytecodeGenerator">codeGenerator</a>.<a href="#357023" title="(iclass: GenMSIL.this.global.icodes.IClass)Unit">genClass</a>
      <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
        <a href="#356912" title="GenMSIL.this.BytecodeGenerator">codeGenerator</a>.<a href="#357020" title="()Unit">writeAssembly</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(unit: GenMSIL.this.global.CompilationUnit)Unit" id="356898">apply</a><span class="delimiter">(</span><a title="GenMSIL.this.global.CompilationUnit" id="357286">unit</a>: <a href="../../CompilationUnits.scala.html#183079" title="GenMSIL.this.global.CompilationUnit">CompilationUnit</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../Global.scala.html#182892" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="String(&quot;MSIL works on icode classes, not on compilation units!&quot;)" class="string">&quot;MSIL works on icode classes, not on compilation units!&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /**
   * MSIL bytecode generator.
   *
   */
  <span class="keyword">class</span> <a title="class BytecodeGenerator extends Object with ScalaObject" id="310244">BytecodeGenerator</a> <a href="#310244" title="ScalaObject" class="delimiter">{</a>

    <span class="keyword">val</span> <a title="String" id="356924">MODULE_INSTANCE_NAME</a> = <span title="String(&quot;MODULE$&quot;)" class="string">&quot;MODULE$&quot;</span>

    <span class="keyword">import</span> <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<span class="delimiter">{</span>VOID =&gt; MVOID, BOOLEAN =&gt; MBOOL, BYTE =&gt; MBYTE, SHORT =&gt; MSHORT,
                   CHAR =&gt; MCHAR, INT =&gt; MINT, LONG =&gt; MLONG, FLOAT =&gt; MFLOAT,
                   DOUBLE =&gt; MDOUBLE, OBJECT =&gt; MOBJECT, STRING =&gt; MSTRING,
                   STRING_ARRAY =&gt; MSTRING_ARRAY,
                   SYMTAB_CONSTR =&gt; SYMTAB_ATTRIBUTE_CONSTRUCTOR,
                   SYMTAB_DEFAULT_CONSTR =&gt; SYMTAB_ATTRIBUTE_EMPTY_CONSTRUCTOR<span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="356927">EXCEPTION</a> = <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310664" title="(name: String)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><span title="String(&quot;System.Exception&quot;)" class="string">&quot;System.Exception&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="356929">MBYTE_ARRAY</a> = <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310666" title="(elemType: ch.epfl.lamp.compiler.msil.Type)ch.epfl.lamp.compiler.msil.Type">mkArrayType</a><span class="delimiter">(</span><a href="../../symtab/clr/CLRTypes.scala.html#310574" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MBYTE</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="356931">ICLONEABLE</a> = <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310664" title="(name: String)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><span title="String(&quot;System.ICloneable&quot;)" class="string">&quot;System.ICloneable&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="356933">MEMBERWISE_CLONE</a> = <a href="../../symtab/clr/CLRTypes.scala.html#310619" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MOBJECT</a>.<span title="(x$1: String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="String(&quot;MemberwiseClone&quot;)" class="string">&quot;MemberwiseClone&quot;</span>, <span title="object ch.epfl.lamp.compiler.msil.Type">MsilType</span>.<span title="Array[ch.epfl.lamp.compiler.msil.Type]">EmptyTypes</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="356935">MMONITOR</a>       = <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310664" title="(name: String)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><span title="String(&quot;System.Threading.Monitor&quot;)" class="string">&quot;System.Threading.Monitor&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="356937">MMONITOR_ENTER</a> = <a href="#356935" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MMONITOR</a>.<span title="(x$1: String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="String(&quot;Enter&quot;)" class="string">&quot;Enter&quot;</span>, <span title="(xs: ch.epfl.lamp.compiler.msil.Type*)(implicit evidence$2: scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type])Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span title="(clazz: Class[_])scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type]" class="delimiter">(</span><a href="../../symtab/clr/CLRTypes.scala.html#310619" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MOBJECT</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="356939">MMONITOR_EXIT</a>  = <a href="#356935" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MMONITOR</a>.<span title="(x$1: String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="String(&quot;Exit&quot;)" class="string">&quot;Exit&quot;</span>, <span title="(xs: ch.epfl.lamp.compiler.msil.Type*)(implicit evidence$2: scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type])Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span title="(clazz: Class[_])scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type]" class="delimiter">(</span><a href="../../symtab/clr/CLRTypes.scala.html#310619" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MOBJECT</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="356941">MSTRING_BUILDER</a> = <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310664" title="(name: String)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><span title="String(&quot;System.Text.StringBuilder&quot;)" class="string">&quot;System.Text.StringBuilder&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.ConstructorInfo" id="356943">MSTRING_BUILDER_CONSTR</a> = <a href="#356941" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MSTRING_BUILDER</a>.<span title="(x$1: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.ConstructorInfo">GetConstructor</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.Type">MsilType</span>.<span title="Array[ch.epfl.lamp.compiler.msil.Type]">EmptyTypes</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="356945">MSTRING_BUILDER_TOSTRING</a> = <a href="#356941" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MSTRING_BUILDER</a>.<span title="(x$1: String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="String(&quot;ToString&quot;)" class="string">&quot;ToString&quot;</span>,
                                                             <span title="object ch.epfl.lamp.compiler.msil.Type">MsilType</span>.<span title="Array[ch.epfl.lamp.compiler.msil.Type]">EmptyTypes</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="356947">TYPE_FROM_HANDLE</a> =
      <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310664" title="(name: String)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><span title="String(&quot;System.Type&quot;)" class="string">&quot;System.Type&quot;</span><span class="delimiter">)</span>.<span title="(x$1: String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="String(&quot;GetTypeFromHandle&quot;)" class="string">&quot;GetTypeFromHandle&quot;</span>, <span title="(xs: ch.epfl.lamp.compiler.msil.Type*)(implicit evidence$2: scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type])Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span title="(clazz: Class[_])scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type]" class="delimiter">(</span><a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310664" title="(name: String)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><span title="String(&quot;System.RuntimeTypeHandle&quot;)" class="string">&quot;System.RuntimeTypeHandle&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="356949">INT_PTR</a> = <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310664" title="(name: String)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><span title="String(&quot;System.IntPtr&quot;)" class="string">&quot;System.IntPtr&quot;</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="GenMSIL.this.global.Symbol" id="356951">JOBJECT</a> = <a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46278" title="=&gt; GenMSIL.this.global.Symbol">ObjectClass</a>
    <span class="keyword">val</span> <a title="GenMSIL.this.global.Symbol" id="356953">JSTRING</a> = <a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46317" title="=&gt; GenMSIL.this.global.Symbol">StringClass</a>

    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="356955">SystemConvert</a> = <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310664" title="(name: String)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><span title="String(&quot;System.Convert&quot;)" class="string">&quot;System.Convert&quot;</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Array[ch.epfl.lamp.compiler.msil.Type]" id="356957">objParam</a> = <span title="(xs: ch.epfl.lamp.compiler.msil.Type*)(implicit evidence$2: scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type])Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span title="(clazz: Class[_])scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type]" class="delimiter">(</span><a href="../../symtab/clr/CLRTypes.scala.html#310619" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MOBJECT</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="356959">toBool</a>:   <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span> = <a href="#356955" title="=&gt; ch.epfl.lamp.compiler.msil.Type">SystemConvert</a>.<span title="(x$1: String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="String(&quot;ToBoolean&quot;)" class="string">&quot;ToBoolean&quot;</span>, <a href="#356957" title="=&gt; Array[ch.epfl.lamp.compiler.msil.Type]">objParam</a><span class="delimiter">)</span> // see comment in emitUnbox
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="356961">toSByte</a>:  <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span> = <a href="#356955" title="=&gt; ch.epfl.lamp.compiler.msil.Type">SystemConvert</a>.<span title="(x$1: String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="String(&quot;ToSByte&quot;)" class="string">&quot;ToSByte&quot;</span>,   <a href="#356957" title="=&gt; Array[ch.epfl.lamp.compiler.msil.Type]">objParam</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="356963">toShort</a>:  <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span> = <a href="#356955" title="=&gt; ch.epfl.lamp.compiler.msil.Type">SystemConvert</a>.<span title="(x$1: String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="String(&quot;ToInt16&quot;)" class="string">&quot;ToInt16&quot;</span>,   <a href="#356957" title="=&gt; Array[ch.epfl.lamp.compiler.msil.Type]">objParam</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="356965">toChar</a>:   <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span> = <a href="#356955" title="=&gt; ch.epfl.lamp.compiler.msil.Type">SystemConvert</a>.<span title="(x$1: String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="String(&quot;ToChar&quot;)" class="string">&quot;ToChar&quot;</span>,    <a href="#356957" title="=&gt; Array[ch.epfl.lamp.compiler.msil.Type]">objParam</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="356967">toInt</a>:    <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span> = <a href="#356955" title="=&gt; ch.epfl.lamp.compiler.msil.Type">SystemConvert</a>.<span title="(x$1: String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="String(&quot;ToInt32&quot;)" class="string">&quot;ToInt32&quot;</span>,   <a href="#356957" title="=&gt; Array[ch.epfl.lamp.compiler.msil.Type]">objParam</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="356969">toLong</a>:   <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span> = <a href="#356955" title="=&gt; ch.epfl.lamp.compiler.msil.Type">SystemConvert</a>.<span title="(x$1: String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="String(&quot;ToInt64&quot;)" class="string">&quot;ToInt64&quot;</span>,   <a href="#356957" title="=&gt; Array[ch.epfl.lamp.compiler.msil.Type]">objParam</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="356971">toFloat</a>:  <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span> = <a href="#356955" title="=&gt; ch.epfl.lamp.compiler.msil.Type">SystemConvert</a>.<span title="(x$1: String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="String(&quot;ToSingle&quot;)" class="string">&quot;ToSingle&quot;</span>,  <a href="#356957" title="=&gt; Array[ch.epfl.lamp.compiler.msil.Type]">objParam</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="356973">toDouble</a>: <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span> = <a href="#356955" title="=&gt; ch.epfl.lamp.compiler.msil.Type">SystemConvert</a>.<span title="(x$1: String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="String(&quot;ToDouble&quot;)" class="string">&quot;ToDouble&quot;</span>,  <a href="#356957" title="=&gt; Array[ch.epfl.lamp.compiler.msil.Type]">objParam</a><span class="delimiter">)</span>

    //val boxedUnit: FieldInfo = msilType(definitions.BoxedUnitModule.info).GetField(&quot;UNIT&quot;)
    <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.FieldInfo" id="356975">boxedUnit</a>: <span title="ch.epfl.lamp.compiler.msil.FieldInfo">FieldInfo</span> = <a href="../../symtab/clr/CLRTypes.scala.html#310652" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)ch.epfl.lamp.compiler.msil.FieldInfo">fields</a><span class="delimiter">(</span><a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46669" title="=&gt; GenMSIL.this.global.Symbol">BoxedUnit_UNIT</a><span class="delimiter">)</span>

    // Scala attributes
    // symtab.Definitions -&gt; object (singleton..)
    <span class="keyword">val</span> <a title="GenMSIL.this.global.Type" id="356977">SerializableAttr</a> = <a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46687" title="=&gt; GenMSIL.this.global.Symbol">SerializableAttr</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.Type">tpe</a>
    <span class="keyword">val</span> <a title="GenMSIL.this.global.Type" id="356979">CloneableAttr</a>    = <a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46703" title="=&gt; GenMSIL.this.global.Symbol">CloneableAttr</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.Type">tpe</a>
    <span class="keyword">val</span> <a title="GenMSIL.this.global.Type" id="356981">TransientAtt</a>     = <a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46723" title="=&gt; GenMSIL.this.global.Symbol">TransientAttr</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.Type">tpe</a>
    // remoting: the architectures are too different, no mapping (no portable code
    // possible)

    // java instance methods that are mapped to static methods in .net
    // these will need to be called with OpCodes.Call (not Callvirt)
    <span class="keyword">val</span> <a title="scala.collection.mutable.HashSet[GenMSIL.this.global.Symbol]" id="356983">dynToStatMapped</a> = mutable.<span title="[A](elems: A*)scala.collection.mutable.HashSet[A]">HashSet</span><span title="(elems: GenMSIL.this.global.Symbol*)scala.collection.mutable.HashSet[GenMSIL.this.global.Symbol]" class="delimiter">[</span><a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <a href="#356985" title="()Unit">initMappings</a><span class="delimiter">(</span><span class="delimiter">)</span>

    /** Create the mappings between java and .net classes and methods */
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="356985">initMappings</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#357086" title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit">mapType</a><span class="delimiter">(</span><a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46274" title="=&gt; GenMSIL.this.global.Symbol">AnyClass</a>, <a href="../../symtab/clr/CLRTypes.scala.html#310619" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MOBJECT</a><span class="delimiter">)</span>
      <a href="#357086" title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit">mapType</a><span class="delimiter">(</span><a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46276" title="=&gt; GenMSIL.this.global.Symbol">AnyRefClass</a>, <a href="../../symtab/clr/CLRTypes.scala.html#310619" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MOBJECT</a><span class="delimiter">)</span>
      //mapType(definitions.NullClass, clrTypes.getType(&quot;scala.AllRef$&quot;))
      //mapType(definitions.NothingClass, clrTypes.getType(&quot;scala.All$&quot;))
      // FIXME: for some reason the upper two lines map to null
      <a href="#357086" title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit">mapType</a><span class="delimiter">(</span><a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46291" title="object GenMSIL.this.global.definitions.NullClass">NullClass</a>, <a href="#356927" title="=&gt; ch.epfl.lamp.compiler.msil.Type">EXCEPTION</a><span class="delimiter">)</span>
      <a href="#357086" title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit">mapType</a><span class="delimiter">(</span><a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46289" title="object GenMSIL.this.global.definitions.NothingClass">NothingClass</a>, <a href="#356927" title="=&gt; ch.epfl.lamp.compiler.msil.Type">EXCEPTION</a><span class="delimiter">)</span>

      <a href="#357086" title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit">mapType</a><span class="delimiter">(</span><a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46850" title="=&gt; GenMSIL.this.global.Symbol">BooleanClass</a>, <a href="../../symtab/clr/CLRTypes.scala.html#310607" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MBOOL</a><span class="delimiter">)</span>
      <a href="#357086" title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit">mapType</a><span class="delimiter">(</span><a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46836" title="=&gt; GenMSIL.this.global.Symbol">ByteClass</a>, <a href="../../symtab/clr/CLRTypes.scala.html#310574" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MBYTE</a><span class="delimiter">)</span>
      <a href="#357086" title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit">mapType</a><span class="delimiter">(</span><a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46838" title="=&gt; GenMSIL.this.global.Symbol">ShortClass</a>, <a href="../../symtab/clr/CLRTypes.scala.html#310580" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MSHORT</a><span class="delimiter">)</span>
      <a href="#357086" title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit">mapType</a><span class="delimiter">(</span><a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46840" title="=&gt; GenMSIL.this.global.Symbol">CharClass</a>, <a href="../../symtab/clr/CLRTypes.scala.html#310586" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MCHAR</a><span class="delimiter">)</span>
      <a href="#357086" title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit">mapType</a><span class="delimiter">(</span><a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46842" title="=&gt; GenMSIL.this.global.Symbol">IntClass</a>, <a href="../../symtab/clr/CLRTypes.scala.html#310589" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MINT</a><span class="delimiter">)</span>
      <a href="#357086" title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit">mapType</a><span class="delimiter">(</span><a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46844" title="=&gt; GenMSIL.this.global.Symbol">LongClass</a>, <a href="../../symtab/clr/CLRTypes.scala.html#310595" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MLONG</a><span class="delimiter">)</span>
      <a href="#357086" title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit">mapType</a><span class="delimiter">(</span><a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46846" title="=&gt; GenMSIL.this.global.Symbol">FloatClass</a>, <a href="../../symtab/clr/CLRTypes.scala.html#310601" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MFLOAT</a><span class="delimiter">)</span>
      <a href="#357086" title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit">mapType</a><span class="delimiter">(</span><a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46848" title="=&gt; GenMSIL.this.global.Symbol">DoubleClass</a>, <a href="../../symtab/clr/CLRTypes.scala.html#310604" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MDOUBLE</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">var</span> <a title="GenMSIL.this.global.icodes.IClass" id="356987">clasz</a>: <a href="../icode/Members.scala.html#228924" title="GenMSIL.this.global.icodes.IClass">IClass</a> = _
    <span class="keyword">var</span> <a title="GenMSIL.this.global.icodes.IMethod" id="356990">method</a>: <a href="../icode/Members.scala.html#228928" title="GenMSIL.this.global.icodes.IMethod">IMethod</a> = _

    <span class="keyword">var</span> <a title="ch.epfl.lamp.compiler.msil.emit.AssemblyBuilder" id="356993">massembly</a>: <span title="ch.epfl.lamp.compiler.msil.emit.AssemblyBuilder">AssemblyBuilder</span> = _
    <span class="keyword">var</span> <a title="ch.epfl.lamp.compiler.msil.emit.ModuleBuilder" id="356996">mmodule</a>: <span title="ch.epfl.lamp.compiler.msil.emit.ModuleBuilder">ModuleBuilder</span> = _
    <span class="keyword">var</span> <a title="ch.epfl.lamp.compiler.msil.emit.ILGenerator" id="356999">mcode</a>: <span title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">ILGenerator</span> = _

    <span class="keyword">var</span> <a title="String" id="357002">assemName</a>: <span title="String">String</span> = _
    <span class="keyword">var</span> <a title="String" id="357005">firstSourceName</a> = <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span>
    <span class="keyword">var</span> <a title="java.io.File" id="357008">outDir</a>: <span title="java.io.File">File</span> = _
    <span class="keyword">var</span> <a title="java.io.File" id="357011">srcPath</a>: <span title="java.io.File">File</span> = _
    <span class="keyword">var</span> <a title="String" id="357014">moduleName</a>: <span title="String">String</span> = _

    <span class="keyword">def</span> <a title="()Unit" id="357016">initAssembly</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>

      <a href="#357002" title="(x$1: String)Unit">assemName</a> = <a href="../../Global.scala.html#182849" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#183356" title="=&gt; scala.tools.nsc.Settings#StringSetting">assemname</a>.<a href="../../../../reflect/internal/settings/MutableSettings.scala.html#75565" title="=&gt; String">value</a>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#357002" title="=&gt; String">assemName</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#357074" title="=&gt; GenMSIL.this.global.Symbol">entryPoint</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#357002" title="(x$1: String)Unit">assemName</a> = <a href="#357069" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#357074" title="=&gt; GenMSIL.this.global.Symbol">entryPoint</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47975" title="=&gt; GenMSIL.this.global.Symbol">enclClass</a><span class="delimiter">)</span>
          // remove the $ at the end (from module-name)
          <a href="#357002" title="(x$1: String)Unit">assemName</a> = <a href="#357002" title="=&gt; String">assemName</a>.<span title="(x$1: Int, x$2: Int)String">substring</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#357002" title="=&gt; String">assemName</a>.<span title="()Int">length</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          // assuming filename of first source file
          <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#357005" title="=&gt; String">firstSourceName</a>.<span title="(x$1: String)Boolean">endsWith</span><span class="delimiter">(</span><span title="String(&quot;.scala&quot;)" class="string">&quot;.scala&quot;</span><span class="delimiter">)</span>, <a href="#357005" title="=&gt; String">firstSourceName</a><span class="delimiter">)</span>
          <a href="#357002" title="(x$1: String)Unit">assemName</a> = <a href="#357005" title="=&gt; String">firstSourceName</a>.<span title="(x$1: Int, x$2: Int)String">substring</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#357005" title="=&gt; String">firstSourceName</a>.<span title="()Int">length</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Int">-</span> <span title="Int(6)" class="int">6</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#357002" title="=&gt; String">assemName</a>.<span title="(x$1: String)Boolean">endsWith</span><span class="delimiter">(</span><span title="String(&quot;.msil&quot;)" class="string">&quot;.msil&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#357002" title="(x$1: String)Unit">assemName</a> = <a href="#357002" title="=&gt; String">assemName</a>.<span title="(x$1: Int, x$2: Int)String">substring</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#357002" title="=&gt; String">assemName</a>.<span title="()Int">length</span><span class="delimiter">(</span><span class="delimiter">)</span><span title="(x: Int)Int">-</span><span title="Int(5)" class="int">5</span><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#357002" title="=&gt; String">assemName</a>.<span title="(x$1: String)Boolean">endsWith</span><span class="delimiter">(</span><span title="String(&quot;.il&quot;)" class="string">&quot;.il&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#357002" title="(x$1: String)Unit">assemName</a> = <a href="#357002" title="=&gt; String">assemName</a>.<span title="(x$1: Int, x$2: Int)String">substring</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#357002" title="=&gt; String">assemName</a>.<span title="()Int">length</span><span class="delimiter">(</span><span class="delimiter">)</span><span title="(x: Int)Int">-</span><span title="Int(3)" class="int">3</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="java.io.File" id="357983">f</a>: <span title="java.io.File">File</span> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#357002" title="=&gt; String">assemName</a><span class="delimiter">)</span>
        <a href="#357002" title="(x$1: String)Unit">assemName</a> = <a href="#357983" title="java.io.File">f</a>.<span title="()String">getName</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="#357008" title="(x$1: java.io.File)Unit">outDir</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="../../Global.scala.html#182849" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#183432" title="=&gt; scala.tools.nsc.Settings#OutputSetting">outdir</a>.<a href="../../../../reflect/internal/settings/MutableSettings.scala.html#75565" title="=&gt; String">value</a><span class="delimiter">)</span>

      <a href="#357011" title="(x$1: java.io.File)Unit">srcPath</a> = <span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="../../Global.scala.html#182849" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#183362" title="=&gt; scala.tools.nsc.Settings#StringSetting">sourcedir</a>.<a href="../../../../reflect/internal/settings/MutableSettings.scala.html#75565" title="=&gt; String">value</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.AssemblyName" id="357948">assemblyName</a> = <span title="ch.epfl.lamp.compiler.msil.AssemblyName" class="keyword">new</span> <span title="ch.epfl.lamp.compiler.msil.AssemblyName">AssemblyName</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#357948" title="ch.epfl.lamp.compiler.msil.AssemblyName">assemblyName</a>.<span title="String">Name</span> = <a href="#357002" title="=&gt; String">assemName</a>
      <a href="#356993" title="(x$1: ch.epfl.lamp.compiler.msil.emit.AssemblyBuilder)Unit">massembly</a> = <span title="object ch.epfl.lamp.compiler.msil.emit.AssemblyBuilderFactory">AssemblyBuilderFactory</span>.<span title="(name: ch.epfl.lamp.compiler.msil.AssemblyName)ch.epfl.lamp.compiler.msil.emit.AssemblyBuilder">DefineDynamicAssembly</span><span class="delimiter">(</span><a href="#357948" title="ch.epfl.lamp.compiler.msil.AssemblyName">assemblyName</a><span class="delimiter">)</span>

      <a href="#357014" title="(x$1: String)Unit">moduleName</a> = <a href="#357002" title="=&gt; String">assemName</a> // + (if (entryPoint == null) &quot;.dll&quot; else &quot;.exe&quot;)
      // filename here: .dll or .exe (in both parameters), second: give absolute-path
      <a href="#356996" title="(x$1: ch.epfl.lamp.compiler.msil.emit.ModuleBuilder)Unit">mmodule</a> = <a href="#356993" title="=&gt; ch.epfl.lamp.compiler.msil.emit.AssemblyBuilder">massembly</a>.<span title="(name: String, fileName: String)ch.epfl.lamp.compiler.msil.emit.ModuleBuilder">DefineDynamicModule</span><span class="delimiter">(</span><a href="#357014" title="=&gt; String">moduleName</a>,
                                              <span title="(x$1: java.io.File, x$2: String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#357008" title="=&gt; java.io.File">outDir</a>, <a href="#357014" title="=&gt; String">moduleName</a><span class="delimiter">)</span>.<span title="()String">getAbsolutePath</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="(assertion: Boolean)Unit">assert</span> <span class="delimiter">(</span><a href="#356996" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ModuleBuilder">mmodule</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>


    /**
     * Form of the custom Attribute parameter (Ecma-335.pdf)
     *      - p. 163 for CustomAttrib Form,
     *      - p. 164 for FixedArg Form (Array and Element) (if array or not is known!)
     *  !! least significant byte first if values longer than one byte !!
     *
     * 1: Prolog (unsigned int16, value 0x0001) -&gt; symtab[0] = 0x01, symtab[1] = 0x00
     * 2: FixedArgs (directly the data, get number and types from related constructor)
     *  2.1: length of the array (unsigned int32, 4 bytes, least significant first)
     *  2.2: the byte array data
     * 3: NumNamed (unsigned int16, number of named fields and properties, 0x0000)
     */
    <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol, tBuilder: ch.epfl.lamp.compiler.msil.emit.TypeBuilder)Unit" id="357017">addSymtabAttribute</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="358137">sym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a>, <a title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" id="358138">tBuilder</a>: <span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="()Unit" id="358140">addMarker</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Array[Byte]" id="358141">markerSymtab</a> = <span title="Array[Byte]" class="keyword">new</span> <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">(</span><span title="Int(4)" class="int">4</span><span class="delimiter">)</span>
        <a href="#358141" title="(i: Int, x: Byte)Unit">markerSymtab</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> = <span title="Int(1)" class="int">1</span>.<span title="=&gt; Byte">toByte</span>
        <a href="#358138" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a>.<span title="(constr: ch.epfl.lamp.compiler.msil.ConstructorInfo, value: Array[Byte])Unit">SetCustomAttribute</span><span class="delimiter">(</span><a href="../../symtab/clr/CLRTypes.scala.html#310637" title="=&gt; ch.epfl.lamp.compiler.msil.ConstructorInfo">SYMTAB_ATTRIBUTE_EMPTY_CONSTRUCTOR</a>, <a href="#358141" title="Array[Byte]">markerSymtab</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      // both conditions are needed (why exactly..?)
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#358138" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a>.<span title="String">Name</span>.<span title="(x$1: String)Boolean">endsWith</span><span class="delimiter">(</span><span title="String(&quot;$&quot;)" class="string">&quot;$&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <a href="#358137" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47775" title="=&gt; Boolean">isModuleClass</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#358140" title="()Unit">addMarker</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="../../Global.scala.html#183023" title="=&gt; GenMSIL.this.global.Run">currentRun</a>.<a href="../../Global.scala.html#185264" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.Symbol,scala.reflect.internal.pickling.PickleBuffer]">symData</a>.<span title="(key: GenMSIL.this.global.Symbol)Option[scala.reflect.internal.pickling.PickleBuffer]">get</span><span class="delimiter">(</span><a href="#358137" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="scala.reflect.internal.pickling.PickleBuffer" id="358162">pickle</a><span class="delimiter">)</span> =&gt;
            <span class="keyword">var</span> <a title="Int" id="358163">size</a> = <a href="#358162" title="scala.reflect.internal.pickling.PickleBuffer">pickle</a>.<a href="../../../../reflect/internal/pickling/PickleBuffer.scala.html#147934" title="=&gt; Int">writeIndex</a>
            <span class="keyword">val</span> <a title="Array[Byte]" id="358164">symtab</a> = <span title="Array[Byte]" class="keyword">new</span> <span title="Array[Byte]">Array</span><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">(</span><a href="#358163" title="Int">size</a> <span title="(x: Int)Int">+</span> <span title="Int(8)" class="int">8</span><span class="delimiter">)</span>
            <a href="#358164" title="(i: Int, x: Byte)Unit">symtab</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> = <span title="Int(1)" class="int">1</span>.<span title="=&gt; Byte">toByte</span>
            <span class="keyword">for</span> <span class="delimiter">(</span><a title="Int" id="358303">i</a> &lt;- <span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">2</span> <span title="(f: Int =&gt; Unit)Unit">until</span> <span title="Int(6)" class="int">6</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#358164" title="(i: Int, x: Byte)Unit">symtab</a><span class="delimiter">(</span><a href="#358303" title="Int">i</a><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="#358163" title="Int">size</a> <span title="(x: Int)Int">&amp;</span> <span title="Int(255)" class="int">0xff</span><span class="delimiter">)</span>.<span title="=&gt; Byte">toByte</span>
              <a href="#358163" title="Int">size</a> = <a href="#358163" title="Int">size</a> <span title="(x: Int)Int">&gt;&gt;</span> <span title="Int(8)" class="int">8</span>
            <span class="delimiter">}</span>
            java.lang.<span title="object System">System</span>.<span title="(x$1: Any, x$2: Int, x$3: Any, x$4: Int, x$5: Int)Unit">arraycopy</span><span class="delimiter">(</span><a href="#358162" title="scala.reflect.internal.pickling.PickleBuffer">pickle</a>.<a href="../../../../reflect/internal/pickling/PickleBuffer.scala.html#147928" title="=&gt; Array[Byte]">bytes</a>, <span title="Int(0)" class="int">0</span>, <a href="#358164" title="Array[Byte]">symtab</a>, <span title="Int(6)" class="int">6</span>, <a href="#358162" title="scala.reflect.internal.pickling.PickleBuffer">pickle</a>.<a href="../../../../reflect/internal/pickling/PickleBuffer.scala.html#147934" title="=&gt; Int">writeIndex</a><span class="delimiter">)</span>

            <a href="#358138" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a>.<span title="(constr: ch.epfl.lamp.compiler.msil.ConstructorInfo, value: Array[Byte])Unit">SetCustomAttribute</span><span class="delimiter">(</span><a href="../../symtab/clr/CLRTypes.scala.html#310634" title="=&gt; ch.epfl.lamp.compiler.msil.ConstructorInfo">SYMTAB_ATTRIBUTE_CONSTRUCTOR</a>, <a href="#358164" title="Array[Byte]">symtab</a><span class="delimiter">)</span>

            <a href="../../Global.scala.html#183023" title="=&gt; GenMSIL.this.global.Run">currentRun</a>.<a href="../../Global.scala.html#185264" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.Symbol,scala.reflect.internal.pickling.PickleBuffer]">symData</a> <span title="(key: GenMSIL.this.global.Symbol)scala.collection.mutable.HashMap[GenMSIL.this.global.Symbol,scala.reflect.internal.pickling.PickleBuffer]">-=</span> <a href="#358137" title="GenMSIL.this.global.Symbol">sym</a>
            <a href="../../Global.scala.html#183023" title="=&gt; GenMSIL.this.global.Run">currentRun</a>.<a href="../../Global.scala.html#185264" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.Symbol,scala.reflect.internal.pickling.PickleBuffer]">symData</a> <span title="(key: GenMSIL.this.global.Symbol)scala.collection.mutable.HashMap[GenMSIL.this.global.Symbol,scala.reflect.internal.pickling.PickleBuffer]">-=</span> <a href="#358137" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#48006" title="=&gt; GenMSIL.this.global.Symbol">companionSymbol</a>

          <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
            <a href="#358140" title="()Unit">addMarker</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    /**
     * Mutates `member` adding CLR attributes (if any) based on sym.annotations.
     * Please notice that CLR custom modifiers are a different beast (see customModifiers below)
     * and thus shouldn't be added by this method.
     */
    <span class="keyword">def</span> <a title="(member: ch.epfl.lamp.compiler.msil.emit.ICustomAttributeSetter, annotations: List[GenMSIL.this.global.AnnotationInfo])Unit" id="357018">addAttributes</a><span class="delimiter">(</span><a title="ch.epfl.lamp.compiler.msil.emit.ICustomAttributeSetter" id="358347">member</a>: <span title="ch.epfl.lamp.compiler.msil.emit.ICustomAttributeSetter">ICustomAttributeSetter</span>, <a title="List[GenMSIL.this.global.AnnotationInfo]" id="358348">annotations</a>: <span title="List[GenMSIL.this.global.AnnotationInfo]">List</span><span class="delimiter">[</span>AnnotationInfo<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="List[Null]" id="358350">attributes</a> = <a href="#358348" title="List[GenMSIL.this.global.AnnotationInfo]">annotations</a>.<span title="(f: GenMSIL.this.global.AnnotationInfo =&gt; GenMSIL.this.global.Symbol)(implicit bf: scala.collection.generic.CanBuildFrom[List[GenMSIL.this.global.AnnotationInfo],GenMSIL.this.global.Symbol,List[GenMSIL.this.global.Symbol]])List[GenMSIL.this.global.Symbol]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,GenMSIL.this.global.Symbol,List[GenMSIL.this.global.Symbol]]" class="delimiter">(</span><a href="#358367" title="GenMSIL.this.global.AnnotationInfo">_</a>.<a href="../../../../reflect/internal/AnnotationInfos.scala.html#47239" title="=&gt; GenMSIL.this.global.Type">atp</a>.<a href="../../../../reflect/internal/Types.scala.html#42728" title="=&gt; GenMSIL.this.global.Symbol">typeSymbol</a><span class="delimiter">)</span>.<span title="(pf: PartialFunction[GenMSIL.this.global.Symbol,Null])(implicit bf: scala.collection.generic.CanBuildFrom[List[GenMSIL.this.global.Symbol],Null,List[Null]])List[Null]">collect</span> <a href="#358415" title="Null" class="delimiter">{</a>
        <span class="keyword">case</span> <a href="../../../../reflect/internal/Definitions.scala.html#40473" title="Null(null)">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46723" title="=&gt; GenMSIL.this.global.Symbol">TransientAttr</a> =&gt; <span title="Null(null)" class="keyword">null</span> // TODO this is just an example
      <span class="delimiter">}</span>
      <span title="Nothing" class="keyword">return</span> // TODO: implement at some point
    <span class="delimiter">}</span>

    /**
     * What's a CLR custom modifier? Intro available as source comments in compiler.msil.CustomModifier.
     * It's basically a marker associated with a location (think of FieldInfo, ParameterInfo, and PropertyInfo)
     * and thus that marker (be it optional or required) becomes part of the signature of that location.
     * Some annotations will become CLR attributes (see addAttributes above), others custom modifiers (this method).
     */
    <span class="keyword">def</span> <a title="(annotations: List[GenMSIL.this.global.AnnotationInfo])Array[ch.epfl.lamp.compiler.msil.CustomModifier]" id="357019">customModifiers</a><span class="delimiter">(</span><a title="List[GenMSIL.this.global.AnnotationInfo]" id="358443">annotations</a>: <span title="List[GenMSIL.this.global.AnnotationInfo]">List</span><span class="delimiter">[</span>AnnotationInfo<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Array[ch.epfl.lamp.compiler.msil.CustomModifier]">Array</span><span class="delimiter">[</span>CustomModifier<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <a href="#358443" title="List[GenMSIL.this.global.AnnotationInfo]">annotations</a>.<span title="(f: GenMSIL.this.global.AnnotationInfo =&gt; GenMSIL.this.global.Symbol)(implicit bf: scala.collection.generic.CanBuildFrom[List[GenMSIL.this.global.AnnotationInfo],GenMSIL.this.global.Symbol,List[GenMSIL.this.global.Symbol]])List[GenMSIL.this.global.Symbol]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,GenMSIL.this.global.Symbol,List[GenMSIL.this.global.Symbol]]" class="delimiter">(</span><a href="#358471" title="GenMSIL.this.global.AnnotationInfo">_</a>.<a href="../../../../reflect/internal/AnnotationInfos.scala.html#47239" title="=&gt; GenMSIL.this.global.Type">atp</a>.<a href="../../../../reflect/internal/Types.scala.html#42728" title="=&gt; GenMSIL.this.global.Symbol">typeSymbol</a><span class="delimiter">)</span>.<span title="(pf: PartialFunction[GenMSIL.this.global.Symbol,ch.epfl.lamp.compiler.msil.CustomModifier])(implicit bf: scala.collection.generic.CanBuildFrom[List[GenMSIL.this.global.Symbol],ch.epfl.lamp.compiler.msil.CustomModifier,List[ch.epfl.lamp.compiler.msil.CustomModifier]])List[ch.epfl.lamp.compiler.msil.CustomModifier]">collect</span> <a href="#358515" title="ch.epfl.lamp.compiler.msil.CustomModifier" class="delimiter">{</a>
        <span class="keyword">case</span> <a href="../../../../reflect/internal/Definitions.scala.html#40473" title="ch.epfl.lamp.compiler.msil.CustomModifier">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46727" title="=&gt; GenMSIL.this.global.Symbol">VolatileAttr</a>  =&gt; <span title="ch.epfl.lamp.compiler.msil.CustomModifier" class="keyword">new</span> <span title="ch.epfl.lamp.compiler.msil.CustomModifier">CustomModifier</span><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span>, <span title="object ch.epfl.lamp.compiler.msil.CustomModifier">CustomModifier</span>.<span title="()ch.epfl.lamp.compiler.msil.Type">VolatileMarker</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span title="(implicit evidence$1: ClassManifest[ch.epfl.lamp.compiler.msil.CustomModifier])Array[ch.epfl.lamp.compiler.msil.CustomModifier]">toArray</span>
    <span class="delimiter">}</span>



    /*
      debuglog(&quot;creating annotations: &quot; + annotations + &quot; for member : &quot; + member)
      for (annot@ AnnotationInfo(typ, annArgs, nvPairs) &lt;- annotations ;
           if annot.isConstant)
           //!typ.typeSymbol.isJavaDefined
      {
//        assert(consts.length &lt;= 1,
//               &quot;too many constant arguments for annotations; &quot;+consts.toString())

        // Problem / TODO having the symbol of the annotations type would be nicer
        // (i hope that type.typeSymbol is the same as the one in types2create)
        // AND: this will crash if the annotations Type is already compiled (-&gt; not a typeBuilder)
        // when this is solved, types2create will be the same as icodes.classes, thus superfluous
        val annType: TypeBuilder = getType(typ.typeSymbol).asInstanceOf[TypeBuilder]
//        val annType: MsilType = getType(typ.typeSymbol)

        // Problem / TODO: i have no idea which constructor is used. This
        // information should be available in AnnotationInfo.
        annType.CreateType() // else, GetConstructors can't be used
        val constr: ConstructorInfo = annType.GetConstructors()(0)
        // prevent a second call of CreateType, only needed because there's no
        // other way than GetConstructors()(0) to get the constructor, if there's
        // no constructor symbol available.

        val args: Array[Byte] =
          getAttributeArgs(
            annArgs map (_.constant.get),
            (for((n,v) &lt;- nvPairs) yield (n, v.constant.get)))
        member.SetCustomAttribute(constr, args)
      }
    } */

/*    def getAttributeArgs(consts: List[Constant], nvPairs: List[(Name, Constant)]): Array[Byte] = {
      val buf = ByteBuffer.allocate(2048) // FIXME: this may be not enough!
      buf.order(ByteOrder.LITTLE_ENDIAN)
      buf.putShort(1.toShort) // signature

      def emitSerString(str: String) = {
          // this is wrong, it has to be the length of the UTF-8 byte array, which
          // may be longer (see clr-book on page 302)
//          val length: Int = str.length
            val strBytes: Array[Byte] = try {
              str.getBytes(&quot;UTF-8&quot;)
            } catch {
              case _: Error =&gt; abort(&quot;could not get byte-array for string: &quot; + str)
            }
            val length: Int = strBytes.length //this length is stored big-endian
            if (length &lt; 128)
              buf.put(length.toByte)
            else if (length &lt; (1&lt;&lt;14)) {
              buf.put(((length &gt;&gt; 8) | 0x80).toByte) // the bits 14 and 15 of length are '0'
              buf.put((length | 0xff).toByte)
            } else if (length &lt; (1 &lt;&lt; 29)) {
              buf.put(((length &gt;&gt; 24) | 0xc0).toByte)
              buf.put(((length &gt;&gt; 16) &amp; 0xff).toByte)
              buf.put(((length &gt;&gt;  8) &amp; 0xff).toByte)
              buf.put(((length      ) &amp; 0xff).toByte)
            } else
              abort(&quot;string too long for attribute parameter: &quot; + length)
            buf.put(strBytes)
      }

      def emitConst(const: Constant): Unit = const.tag match {
        case BooleanTag =&gt; buf.put((if (const.booleanValue) 1 else 0).toByte)
        case ByteTag =&gt; buf.put(const.byteValue)
        case ShortTag =&gt; buf.putShort(const.shortValue)
        case CharTag =&gt; buf.putChar(const.charValue)
        case IntTag =&gt; buf.putInt(const.intValue)
        case LongTag =&gt; buf.putLong(const.longValue)
        case FloatTag =&gt; buf.putFloat(const.floatValue)
        case DoubleTag =&gt; buf.putDouble(const.doubleValue)
        case StringTag =&gt;
          val str: String = const.stringValue
          if (str == null) {
            buf.put(0xff.toByte)
          } else {
            emitSerString(str)
          }
        case ArrayTag =&gt;
          val arr: Array[Constant] = const.arrayValue
          if (arr == null) {
            buf.putInt(0xffffffff)
          } else {
            buf.putInt(arr.length)
            arr.foreach(emitConst)
          }

        // TODO: other Tags: NoTag, UnitTag, ClassTag, EnumTag, ArrayTag ???

        case _ =&gt; abort(&quot;could not handle attribute argument: &quot; + const)
      }

      consts foreach emitConst
      buf.putShort(nvPairs.length.toShort)
      def emitNamedArg(nvPair: (Name, Constant)) {
        // the named argument is a property of the attribute (it can't be a field, since
        //  all fields in scala are private)
        buf.put(0x54.toByte)

        def emitType(c: Constant) = c.tag match { // type of the constant, Ecma-335.pdf, page 151
          case BooleanTag =&gt; buf.put(0x02.toByte)
          case ByteTag =&gt;    buf.put(0x05.toByte)
          case ShortTag =&gt;   buf.put(0x06.toByte)
          case CharTag =&gt;    buf.put(0x07.toByte)
          case IntTag =&gt;     buf.put(0x08.toByte)
          case LongTag =&gt;    buf.put(0x0a.toByte)
          case FloatTag =&gt;   buf.put(0x0c.toByte)
          case DoubleTag =&gt;  buf.put(0x0d.toByte)
          case StringTag =&gt;  buf.put(0x0e.toByte)

          // TODO: other Tags: NoTag, UnitTag, ClassTag, EnumTag ???

          // ArrayTag falls in here
          case _ =&gt; abort(&quot;could not handle attribute argument: &quot; + c)
        }

        val cnst: Constant = nvPair._2
        if (cnst.tag == ArrayTag) {
          buf.put(0x1d.toByte)
          emitType(cnst.arrayValue(0)) // FIXME: will crash if array length = 0
        } else if (cnst.tag == EnumTag) {
          buf.put(0x55.toByte)
          // TODO: put a SerString (don't know what exactly, names of the enums somehow..)
              } else {
          buf.put(0x51.toByte)
          emitType(cnst)
        }

        emitSerString(nvPair._1.toString)
        emitConst(nvPair._2)
      }

      val length = buf.position()
      buf.array().slice(0, length)
    } */

    <span class="keyword">def</span> <a title="()Unit" id="357020">writeAssembly</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#357074" title="=&gt; GenMSIL.this.global.Symbol">entryPoint</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#357074" title="=&gt; GenMSIL.this.global.Symbol">entryPoint</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47975" title="=&gt; GenMSIL.this.global.Symbol">enclClass</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47775" title="=&gt; Boolean">isModuleClass</a>, <a href="#357074" title="=&gt; GenMSIL.this.global.Symbol">entryPoint</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47975" title="=&gt; GenMSIL.this.global.Symbol">enclClass</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="358571">mainMethod</a> = <a href="../../symtab/clr/CLRTypes.scala.html#310650" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)ch.epfl.lamp.compiler.msil.MethodInfo">methods</a><span class="delimiter">(</span><a href="#357074" title="=&gt; GenMSIL.this.global.Symbol">entryPoint</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Array[ch.epfl.lamp.compiler.msil.Type]" id="358572">stringArrayTypes</a>: <span title="Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span class="delimiter">[</span>MsilType<span class="delimiter">]</span> = <span title="(xs: ch.epfl.lamp.compiler.msil.Type*)(implicit evidence$2: scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type])Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span title="(clazz: Class[_])scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type]" class="delimiter">(</span><a href="../../symtab/clr/CLRTypes.scala.html#310625" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MSTRING_ARRAY</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder" id="358573">globalMain</a> = <a href="#356996" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ModuleBuilder">mmodule</a>.<span title="(name: String, attributes: Int, returnType: ch.epfl.lamp.compiler.msil.Type, paramTypes: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.emit.MethodBuilder">DefineGlobalMethod</span><span class="delimiter">(</span>
          <span title="String(&quot;Main&quot;)" class="string">&quot;Main&quot;</span>, MethodAttributes.Public <span title="Int(22)">|</span> MethodAttributes.Static,
          <a href="../../symtab/clr/CLRTypes.scala.html#310610" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MVOID</a>, <a href="#358572" title="Array[ch.epfl.lamp.compiler.msil.Type]">stringArrayTypes</a><span class="delimiter">)</span>
        <a href="#358573" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">globalMain</a>.<span title="(pos: Int, attr: Int, name: String)ch.epfl.lamp.compiler.msil.emit.ParameterBuilder">DefineParameter</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, ParameterAttributes.<span title="Int(0)">None</span>, <span title="String(&quot;args&quot;)" class="string">&quot;args&quot;</span><span class="delimiter">)</span>
        <a href="#356993" title="=&gt; ch.epfl.lamp.compiler.msil.emit.AssemblyBuilder">massembly</a>.<span title="(entryMethod: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">SetEntryPoint</span><span class="delimiter">(</span><a href="#358573" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">globalMain</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.ILGenerator" id="358574">code</a> = <a href="#358573" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">globalMain</a>.<span title="()ch.epfl.lamp.compiler.msil.emit.ILGenerator">GetILGenerator</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.FieldInfo" id="358575">moduleField</a> = <a href="#357094" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.FieldInfo">getModuleInstanceField</a><span class="delimiter">(</span><a href="#357074" title="=&gt; GenMSIL.this.global.Symbol">entryPoint</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47975" title="=&gt; GenMSIL.this.global.Symbol">enclClass</a><span class="delimiter">)</span>
        <a href="#358574" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldsfld</span>, <a href="#358575" title="ch.epfl.lamp.compiler.msil.FieldInfo">moduleField</a><span class="delimiter">)</span>
        <a href="#358574" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldarg_0</span><span class="delimiter">)</span>
        <a href="#358574" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Callvirt</span>, <a href="#358571" title="ch.epfl.lamp.compiler.msil.MethodInfo">mainMethod</a><span class="delimiter">)</span>
        <a href="#358574" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ret</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#357021" title="()Unit">createTypes</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">var</span> <a title="String" id="358565">outDirName</a>: <span title="String">String</span> = <span title="Null(null)" class="keyword">null</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#182849" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#183490" title="=&gt; scala.tools.nsc.Settings#StringSetting">Ygenjavap</a>.<a href="../../../../reflect/internal/settings/MutableSettings.scala.html#75563" title="=&gt; Boolean">isDefault</a><span class="delimiter">)</span> <span class="delimiter">{</span> // we reuse the JVM-sounding setting because it's conceptually similar
          <a href="#358565" title="String">outDirName</a> = <a href="#357008" title="=&gt; java.io.File">outDir</a>.<span title="()String">getPath</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#356993" title="=&gt; ch.epfl.lamp.compiler.msil.emit.AssemblyBuilder">massembly</a>.<span title="(fileName: String)Unit">Save</span><span class="delimiter">(</span><a href="#358565" title="String">outDirName</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;\\&quot;)" class="string">&quot;\\&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#357002" title="=&gt; String">assemName</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;.msil&quot;)" class="string">&quot;.msil&quot;</span><span class="delimiter">)</span> /* use SingleFileILPrinterVisitor */
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#358565" title="String">outDirName</a> = <a href="#357011" title="=&gt; java.io.File">srcPath</a>.<span title="()String">getPath</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#356993" title="=&gt; ch.epfl.lamp.compiler.msil.emit.AssemblyBuilder">massembly</a>.<span title="(destPath: String, sourceFilesPath: String)Unit">Save</span><span class="delimiter">(</span><a href="../../Global.scala.html#182849" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#183490" title="=&gt; scala.tools.nsc.Settings#StringSetting">Ygenjavap</a>.<a href="../../../../reflect/internal/settings/MutableSettings.scala.html#75565" title="=&gt; String">value</a>, <a href="#358565" title="String">outDirName</a><span class="delimiter">)</span>  /* use MultipleFilesILPrinterVisitor */
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Nothing" id="360392">e</a>:<span title="java.io.IOException">IOException</span> =&gt; <a href="../../Global.scala.html#182892" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="String(&quot;Could not write to &quot;)" class="string">&quot;Could not write to &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#358565" title="String">outDirName</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#360392" title="java.io.IOException">e</a>.<span title="()String">getMessage</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="357021">createTypes</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="360429">sym</a> &lt;- <a href="../icode/ICodes.scala.html#228877" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.global.Symbol,GenMSIL.this.global.icodes.IClass]">classes</a>.<span title="(f: GenMSIL.this.global.icodes.global.Symbol =&gt; Unit)Unit">keys</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.IClass" id="360430">iclass</a>   = <a href="../icode/ICodes.scala.html#228877" title="(key: GenMSIL.this.global.icodes.global.Symbol)GenMSIL.this.global.icodes.IClass">classes</a><span class="delimiter">(</span><a href="#360429" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" id="360431">tBuilder</a> = <a href="../../symtab/clr/CLRTypes.scala.html#310646" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)ch.epfl.lamp.compiler.msil.Type">types</a><span class="delimiter">(</span><a href="#360429" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" class="delimiter">[</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span><span class="delimiter">]</span>

        <a href="../../Global.scala.html#182894" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;Calling CreatType for &quot;)" class="string">&quot;Calling CreatType for &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#360429" title="GenMSIL.this.global.icodes.global.Symbol">sym</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;, &quot;)" class="string">&quot;, &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#360431" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a>.<span title="()String">toString</span><span class="delimiter">)</span>

        <a href="#360431" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a>.<span title="()ch.epfl.lamp.compiler.msil.Type">CreateType</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#360431" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a>.<span title="(sourceFilepath: String)Unit">setSourceFilepath</span><span class="delimiter">(</span><a href="#360430" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#229228" title="=&gt; GenMSIL.this.global.icodes.global.CompilationUnit">cunit</a>.<a href="../../CompilationUnits.scala.html#185106" title="=&gt; scala.tools.nsc.util.SourceFile">source</a>.<a href="../../util/SourceFile.scala.html#185145" title="=&gt; scala.tools.nsc.io.AbstractFile">file</a>.<a href="../../io/AbstractFile.scala.html#187400" title="=&gt; String">path</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span><span class="delimiter">[</span>GenMSIL<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(iclass: GenMSIL.this.global.icodes.IClass)String" id="357022">ilasmFileName</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IClass" id="360487">iclass</a>: <a href="../icode/Members.scala.html#228924" title="GenMSIL.this.global.icodes.IClass">IClass</a><span class="delimiter">)</span> : <span title="String">String</span> = <span class="delimiter">{</span>
      // method.sourceFile contains just the filename
      <a href="#360487" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#229228" title="=&gt; GenMSIL.this.global.icodes.global.CompilationUnit">cunit</a>.<a href="../../CompilationUnits.scala.html#185106" title="=&gt; scala.tools.nsc.util.SourceFile">source</a>.<a href="../../util/SourceFile.scala.html#185145" title="=&gt; scala.tools.nsc.io.AbstractFile">file</a>.<a href="../../io/AbstractFile.scala.html#187433" title="()String">toString</a>.<span title="(x$1: CharSequence, x$2: CharSequence)String">replace</span><span class="delimiter">(</span><span title="String(&quot;\\&quot;)" class="string">&quot;\\&quot;</span>, <span title="String(&quot;\\\\&quot;)" class="string">&quot;\\\\&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span><span class="delimiter">[</span>GenMSIL<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(iclass: GenMSIL.this.global.icodes.IClass)Unit" id="357023">genClass</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IClass" id="357280">iclass</a>: <a href="../icode/Members.scala.html#228924" title="GenMSIL.this.global.icodes.IClass">IClass</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.global.Symbol" id="360496">sym</a> = <a href="#357280" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#229219" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>
      <a href="../../Global.scala.html#182894" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;Generating class &quot;)" class="string">&quot;Generating class &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#360496" title="GenMSIL.this.global.icodes.global.Symbol">sym</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; flags: &quot;)" class="string">&quot; flags: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="../../symtab/package.scala.html#36230" title="=&gt; reflect.internal.Flags.type">Flags</a>.<a href="../../../../reflect/internal/Flags.scala.html#39895" title="(flags: Long)String">flagsToString</a><span class="delimiter">(</span><a href="#360496" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47898" title="=&gt; Long">flags</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#356987" title="(x$1: GenMSIL.this.global.icodes.IClass)Unit">clasz</a> = <a href="#357280" title="GenMSIL.this.global.icodes.IClass">iclass</a>

      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" id="360497">tBuilder</a> = <a href="#357084" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#360496" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" class="delimiter">[</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span><span class="delimiter">]</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#357092" title="(sym: GenMSIL.this.global.Symbol)Boolean">isCloneable</a><span class="delimiter">(</span><a href="#360496" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        // FIXME: why there's no nme.clone_ ?
        // &quot;Clone&quot;: if the code is non-portable, &quot;Clone&quot; is defined, not &quot;clone&quot;
        // TODO: improve condition (should override AnyRef.clone)
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#357280" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#229225" title="=&gt; List[GenMSIL.this.global.icodes.IMethod]">methods</a>.<span title="(p: GenMSIL.this.global.icodes.IMethod =&gt; Boolean)Boolean">forall</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IMethod" id="360529">m</a> =&gt; <span class="delimiter">{</span>
          <span title="=&gt; Boolean">!</span><span class="delimiter">(</span><span class="delimiter">(</span><a href="#360529" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312600" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47883" title="=&gt; GenMSIL.this.global.icodes.global.Name">name</a>.<span title="()String">toString</span> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="String(&quot;clone&quot;)" class="string">&quot;clone&quot;</span> <span title="(x: Boolean)Boolean">||</span> <a href="#360529" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312600" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47883" title="=&gt; GenMSIL.this.global.icodes.global.Name">name</a>.<span title="()String">toString</span> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="String(&quot;Clone&quot;)" class="string">&quot;Clone&quot;</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
            <a href="#360529" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312600" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.icodes.global.Type">tpe</a>.<a href="../../../../reflect/internal/Types.scala.html#42751" title="=&gt; List[GenMSIL.this.global.icodes.global.Type]">paramTypes</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">!=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
        <span class="delimiter">}</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../../Global.scala.html#182894" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;auto-generating cloneable method for &quot;)" class="string">&quot;auto-generating cloneable method for &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#360496" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Short" id="360548">attrs</a>: <span title="Short">Short</span> = <span class="delimiter">(</span>MethodAttributes.Public | MethodAttributes.Virtual <span title="Int(198)">|</span>
                              MethodAttributes.HideBySig<span class="delimiter">)</span>.<span title="=&gt; Short">toShort</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder" id="360549">cloneMethod</a> = <a href="#360497" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a>.<span title="(name: String, attrs: Short, returnType: ch.epfl.lamp.compiler.msil.Type, paramTypes: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.emit.MethodBuilder">DefineMethod</span><span class="delimiter">(</span><span title="String(&quot;Clone&quot;)" class="string">&quot;Clone&quot;</span>, <a href="#360548" title="Short">attrs</a>, <a href="../../symtab/clr/CLRTypes.scala.html#310619" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MOBJECT</a>,
                                                  <span title="object ch.epfl.lamp.compiler.msil.Type">MsilType</span>.<span title="Array[ch.epfl.lamp.compiler.msil.Type]">EmptyTypes</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.ILGenerator" id="360550">clCode</a> = <a href="#360549" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">cloneMethod</a>.<span title="()ch.epfl.lamp.compiler.msil.emit.ILGenerator">GetILGenerator</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#360550" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">clCode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldarg_0</span><span class="delimiter">)</span>
          <a href="#360550" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">clCode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#356933" title="=&gt; ch.epfl.lamp.compiler.msil.MethodInfo">MEMBERWISE_CLONE</a><span class="delimiter">)</span>
          <a href="#360550" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">clCode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ret</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="Int" id="360498">line</a> = <a href="#360496" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47694" title="=&gt; GenMSIL.this.global.icodes.global.Position">pos</a>.<a href="../../util/Position.scala.html#183814" title="=&gt; Int">line</a>
      <a href="#360497" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a>.<span title="(sourceLine: Int, sourceFilename: String)Unit">setPosition</span><span class="delimiter">(</span><a href="#360498" title="Int">line</a>, <a href="#357022" title="(iclass: GenMSIL.this.global.icodes.IClass)String">ilasmFileName</a><span class="delimiter">(</span><a href="#357280" title="GenMSIL.this.global.icodes.IClass">iclass</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#357090" title="(sym: GenMSIL.this.global.Symbol)Boolean">isTopLevelModule</a><span class="delimiter">(</span><a href="#360496" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#360496" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#48003" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">companionClass</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../../reflect/internal/Symbols.scala.html#40013" title="object GenMSIL.this.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span>
          <a href="#357097" title="(sym: GenMSIL.this.global.Symbol)Unit">generateMirrorClass</a><span class="delimiter">(</span><a href="#360496" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>
        <span class="keyword">else</span>
          <a href="../../Global.scala.html#182904" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="String(&quot;No mirror class for module with linked class: &quot;)" class="string">&quot;No mirror class for module with linked class: &quot;</span> <span title="(x$1: Any)String">+</span>
              <a href="#360496" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47897" title="=&gt; String">fullName</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="#357017" title="(sym: GenMSIL.this.global.Symbol, tBuilder: ch.epfl.lamp.compiler.msil.emit.TypeBuilder)Unit">addSymtabAttribute</a><span class="delimiter">(</span><a href="#360496" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>, <a href="#360497" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a><span class="delimiter">)</span>
      <a href="#357018" title="(member: ch.epfl.lamp.compiler.msil.emit.ICustomAttributeSetter, annotations: List[GenMSIL.this.global.AnnotationInfo])Unit">addAttributes</a><span class="delimiter">(</span><a href="#360497" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a>, <a href="#360496" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47954" title="=&gt; List[GenMSIL.this.global.icodes.global.AnnotationInfo]">annotations</a><span class="delimiter">)</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#357280" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#229219" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46442" title="=&gt; GenMSIL.this.global.Symbol">ArrayClass</a><span class="delimiter">)</span>
        <a href="#357280" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#229225" title="=&gt; List[GenMSIL.this.global.icodes.IMethod]">methods</a> <span title="(f: GenMSIL.this.global.icodes.IMethod =&gt; Unit)Unit">foreach</span> <a href="#357024" title="(m: GenMSIL.this.global.icodes.IMethod)Unit">genMethod</a>

    <span class="delimiter">}</span> //genClass


    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(m: GenMSIL.this.global.icodes.IMethod)Unit" id="357024">genMethod</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IMethod" id="360602">m</a>: <a href="../icode/Members.scala.html#228928" title="GenMSIL.this.global.icodes.IMethod">IMethod</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../Global.scala.html#182894" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;Generating method &quot;)" class="string">&quot;Generating method &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#360602" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312600" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; flags: &quot;)" class="string">&quot; flags: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="../../symtab/package.scala.html#36230" title="=&gt; reflect.internal.Flags.type">Flags</a>.<a href="../../../../reflect/internal/Flags.scala.html#39895" title="(flags: Long)String">flagsToString</a><span class="delimiter">(</span><a href="#360602" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312600" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47898" title="=&gt; Long">flags</a><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span>
            <span title="String(&quot; owner: &quot;)" class="string">&quot; owner: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#360602" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312600" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">owner</a><span class="delimiter">)</span>
      <a href="#356990" title="(x$1: GenMSIL.this.global.icodes.IMethod)Unit">method</a> = <a href="#360602" title="GenMSIL.this.global.icodes.IMethod">m</a>
      <a href="#357078" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.Local,ch.epfl.lamp.compiler.msil.emit.LocalBuilder]">localBuilders</a>.<span title="()Unit">clear</span>
      <a href="#357068" title="(m: GenMSIL.this.global.icodes.IMethod)Unit">computeLocalVarsIndex</a><span class="delimiter">(</span><a href="#360602" title="GenMSIL.this.global.icodes.IMethod">m</a><span class="delimiter">)</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#360602" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312600" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47802" title="=&gt; Boolean">isClassConstructor</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#356999" title="(x$1: ch.epfl.lamp.compiler.msil.emit.ILGenerator)Unit">mcode</a> = <a href="../../symtab/clr/CLRTypes.scala.html#310648" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)ch.epfl.lamp.compiler.msil.ConstructorInfo">constructors</a><span class="delimiter">(</span><a href="#360602" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312600" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="ch.epfl.lamp.compiler.msil.emit.ConstructorBuilder" class="delimiter">[</span><span title="ch.epfl.lamp.compiler.msil.emit.ConstructorBuilder">ConstructorBuilder</span><span class="delimiter">]</span>.<span title="()ch.epfl.lamp.compiler.msil.emit.ILGenerator">GetILGenerator</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder" id="360655">mBuilder</a> = <a href="../../symtab/clr/CLRTypes.scala.html#310650" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)ch.epfl.lamp.compiler.msil.MethodInfo">methods</a><span class="delimiter">(</span><a href="#360602" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312600" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder" class="delimiter">[</span><span title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">MethodBuilder</span><span class="delimiter">]</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#360655" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">mBuilder</a>.<span title="()Boolean">IsAbstract</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">try</span> <span class="delimiter">{</span>
            <a href="#356999" title="(x$1: ch.epfl.lamp.compiler.msil.emit.ILGenerator)Unit">mcode</a> = <a href="#360655" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">mBuilder</a>.<span title="()ch.epfl.lamp.compiler.msil.emit.ILGenerator">GetILGenerator</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a title="Nothing" id="360671">e</a>: <span title="Exception">Exception</span> =&gt;
              java.lang.<span title="object System">System</span>.<span title="java.io.PrintStream">out</span>.<span title="(x$1: String)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;m.symbol       = &quot;)" class="string">&quot;m.symbol       = &quot;</span> <span title="(x$1: Any)String">+</span> <a href="../../symtab/package.scala.html#36230" title="=&gt; reflect.internal.Flags.type">Flags</a>.<a href="../../../../reflect/internal/Flags.scala.html#39895" title="(flags: Long)String">flagsToString</a><span class="delimiter">(</span><a href="#360602" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312600" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47898" title="=&gt; Long">flags</a><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#360602" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312600" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a><span class="delimiter">)</span>
              java.lang.<span title="object System">System</span>.<span title="java.io.PrintStream">out</span>.<span title="(x$1: String)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;m.symbol.owner = &quot;)" class="string">&quot;m.symbol.owner = &quot;</span> <span title="(x$1: Any)String">+</span> <a href="../../symtab/package.scala.html#36230" title="=&gt; reflect.internal.Flags.type">Flags</a>.<a href="../../../../reflect/internal/Flags.scala.html#39895" title="(flags: Long)String">flagsToString</a><span class="delimiter">(</span><a href="#360602" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312600" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">owner</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47898" title="=&gt; Long">flags</a><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#360602" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312600" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">owner</a><span class="delimiter">)</span>
              java.lang.<span title="object System">System</span>.<span title="java.io.PrintStream">out</span>.<span title="(x$1: String)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;mBuilder       = &quot;)" class="string">&quot;mBuilder       = &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#360655" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">mBuilder</a><span class="delimiter">)</span>
              java.lang.<span title="object System">System</span>.<span title="java.io.PrintStream">out</span>.<span title="(x$1: String)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;mBuilder.DeclaringType = &quot;)" class="string">&quot;mBuilder.DeclaringType = &quot;</span> <span title="(x$1: Any)String">+</span>
                                 <span title="object ch.epfl.lamp.compiler.msil.TypeAttributes">TypeAttributes</span>.<span title="(x$1: Int)String">toString</span><span class="delimiter">(</span><a href="#360655" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">mBuilder</a>.<span title="ch.epfl.lamp.compiler.msil.Type">DeclaringType</span>.<span title="Int">Attributes</span><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span>
                                 <span title="String(&quot;::&quot;)" class="string">&quot;::&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#360655" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">mBuilder</a>.<span title="ch.epfl.lamp.compiler.msil.Type">DeclaringType</span><span class="delimiter">)</span>
              <span title="Nothing" class="keyword">throw</span> <a href="#360671" title="Exception">e</a>
          <span class="delimiter">}</span>
          <span class="keyword">else</span>
            <a href="#356999" title="(x$1: ch.epfl.lamp.compiler.msil.emit.ILGenerator)Unit">mcode</a> = <span title="Null(null)" class="keyword">null</span>
      <span class="delimiter">}</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.Local" id="360746">local</a> &lt;- <a href="#360602" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312632" title="(f: GenMSIL.this.global.icodes.Local =&gt; Unit)Unit">locals</a> ; <span class="keyword">if</span> <span title="=&gt; Boolean">!</span><span class="delimiter">(</span><a href="#360602" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312635" title="=&gt; List[GenMSIL.this.global.icodes.Local]">params</a> <span title="(elem: Any)Boolean">contains</span> <a href="#360746" title="GenMSIL.this.global.icodes.Local">local</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../../Global.scala.html#182894" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;add local var: &quot;)" class="string">&quot;add local var: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#360746" title="GenMSIL.this.global.icodes.Local">local</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;, of kind &quot;)" class="string">&quot;, of kind &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#360746" title="GenMSIL.this.global.icodes.Local">local</a>.<a href="../icode/Members.scala.html#313049" title="=&gt; GenMSIL.this.global.icodes.TypeKind">kind</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="360747">t</a>: <span title="ch.epfl.lamp.compiler.msil.Type">MsilType</span> = <a href="#357081" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#360746" title="GenMSIL.this.global.icodes.Local">local</a>.<a href="../icode/Members.scala.html#313049" title="=&gt; GenMSIL.this.global.icodes.TypeKind">kind</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.LocalBuilder" id="360748">localBuilder</a> = <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(localType: ch.epfl.lamp.compiler.msil.Type)ch.epfl.lamp.compiler.msil.emit.LocalBuilder">DeclareLocal</span><span class="delimiter">(</span><a href="#360747" title="ch.epfl.lamp.compiler.msil.Type">t</a><span class="delimiter">)</span>
          <a href="#360748" title="ch.epfl.lamp.compiler.msil.emit.LocalBuilder">localBuilder</a>.<span title="(name: String)Unit">SetLocalSymInfo</span><span class="delimiter">(</span><a href="#357069" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#360746" title="GenMSIL.this.global.icodes.Local">local</a>.<a href="../icode/Members.scala.html#313047" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#357078" title="(key: GenMSIL.this.global.icodes.Local, value: ch.epfl.lamp.compiler.msil.emit.LocalBuilder)Unit">localBuilders</a><span class="delimiter">(</span><a href="#360746" title="GenMSIL.this.global.icodes.Local">local</a><span class="delimiter">)</span> = <a href="#360748" title="ch.epfl.lamp.compiler.msil.emit.LocalBuilder">localBuilder</a>
        <span class="delimiter">}</span>
        <a href="#357032" title="(m: GenMSIL.this.global.icodes.IMethod)Unit">genCode</a><span class="delimiter">(</span><a href="#360602" title="GenMSIL.this.global.icodes.IMethod">m</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span class="delimiter">}</span>

    /** Special linearizer for methods with at least one exception handler. This
     *  linearizer brings all basic blocks in the right order so that nested
     *  try-catch and try-finally blocks can be emitted.
     */
    <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.MSILLinearizer" id="357025">msilLinearizer</a> = <span title="GenMSIL.this.global.icodes.MSILLinearizer" class="keyword">new</span> <a href="../icode/Linearizers.scala.html#229100" title="GenMSIL.this.global.icodes.MSILLinearizer">MSILLinearizer</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,ch.epfl.lamp.compiler.msil.emit.Label]" id="357027">labels</a> = mutable.<span title="[A, B](elems: (A, B)*)scala.collection.mutable.HashMap[A,B]">HashMap</span><span title="(elems: (GenMSIL.this.global.icodes.BasicBlock, ch.epfl.lamp.compiler.msil.emit.Label)*)scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,ch.epfl.lamp.compiler.msil.emit.Label]" class="delimiter">[</span><a href="../icode/BasicBlocks.scala.html#228937" title="GenMSIL.this.global.icodes.BasicBlock">BasicBlock</a>, <span title="ch.epfl.lamp.compiler.msil.emit.Label">Label</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

    /* when emitting .line, it's enough to include the full filename just once per method, thus reducing filesize.
     * this scheme relies on the fact that the entry block is emitted first. */
    <span class="keyword">var</span> <a title="Boolean" id="357030">dbFilenameSeen</a> = <span title="Boolean(false)" class="keyword">false</span>

    <span class="keyword">def</span> <a title="(m: GenMSIL.this.global.icodes.IMethod)Unit" id="357032">genCode</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IMethod" id="360764">m</a>: <a href="../icode/Members.scala.html#228928" title="GenMSIL.this.global.icodes.IMethod">IMethod</a><span class="delimiter">)</span> <span class="delimiter">{</span>

      <span class="keyword">def</span> <a title="(blocks: List[GenMSIL.this.global.icodes.BasicBlock])Unit" id="360766">makeLabels</a><span class="delimiter">(</span><a title="List[GenMSIL.this.global.icodes.BasicBlock]" id="360768">blocks</a>: <span title="List[GenMSIL.this.global.icodes.BasicBlock]">List</span><span class="delimiter">[</span>BasicBlock<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
        <a href="../../Global.scala.html#182894" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;Making labels for: &quot;)" class="string">&quot;Making labels for: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#356990" title="=&gt; GenMSIL.this.global.icodes.IMethod">method</a><span class="delimiter">)</span>
        <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.BasicBlock" id="360788">bb</a> &lt;- <a href="#360768" title="(f: GenMSIL.this.global.icodes.BasicBlock =&gt; Unit)Unit">blocks</a><span class="delimiter">)</span> <a href="#357027" title="(key: GenMSIL.this.global.icodes.BasicBlock, value: ch.epfl.lamp.compiler.msil.emit.Label)Unit">labels</a><span class="delimiter">(</span><a href="#360788" title="GenMSIL.this.global.icodes.BasicBlock">bb</a><span class="delimiter">)</span> = <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="()ch.epfl.lamp.compiler.msil.emit.Label">DefineLabel</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="#357027" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,ch.epfl.lamp.compiler.msil.emit.Label]">labels</a>.<span title="()Unit">clear</span>

      <span class="keyword">var</span> <a title="List[GenMSIL.this.global.icodes.BasicBlock]" id="360767">linearization</a> = <span title="List[GenMSIL.this.global.icodes.BasicBlock]" class="keyword">if</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#360764" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312620" title="=&gt; List[GenMSIL.this.global.icodes.ExceptionHandler]">exh</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#357025" title="=&gt; GenMSIL.this.global.icodes.MSILLinearizer">msilLinearizer</a>.<a href="../icode/Linearizers.scala.html#330437" title="(m: GenMSIL.this.global.icodes.IMethod)List[GenMSIL.this.global.icodes.BasicBlock]">linearize</a><span class="delimiter">(</span><a href="#360764" title="GenMSIL.this.global.icodes.IMethod">m</a><span class="delimiter">)</span>
                          <span class="keyword">else</span> <a href="../icode/ICodes.scala.html#228881" title="=&gt; GenMSIL.this.global.icodes.Linearizer">linearizer</a>.<a href="../icode/Linearizers.scala.html#329675" title="(c: GenMSIL.this.global.icodes.IMethod)List[GenMSIL.this.global.icodes.BasicBlock]">linearize</a><span class="delimiter">(</span><a href="#360764" title="GenMSIL.this.global.icodes.IMethod">m</a><span class="delimiter">)</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#360764" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312620" title="=&gt; List[GenMSIL.this.global.icodes.ExceptionHandler]">exh</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span>
        <a href="#360767" title="List[GenMSIL.this.global.icodes.BasicBlock]">linearization</a> = <a href="#357058" title="(blocks: List[GenMSIL.this.global.icodes.BasicBlock], m: GenMSIL.this.global.icodes.IMethod)List[GenMSIL.this.global.icodes.BasicBlock]">computeExceptionMaps</a><span class="delimiter">(</span><a href="#360767" title="List[GenMSIL.this.global.icodes.BasicBlock]">linearization</a>, <a href="#360764" title="GenMSIL.this.global.icodes.IMethod">m</a><span class="delimiter">)</span>

      <a href="#360766" title="(blocks: List[GenMSIL.this.global.icodes.BasicBlock])Unit">makeLabels</a><span class="delimiter">(</span><a href="#360767" title="List[GenMSIL.this.global.icodes.BasicBlock]">linearization</a><span class="delimiter">)</span>

      // debug val blocksInM = m.code.blocks.toList.sortBy(bb =&gt; bb.label)
      // debug val blocksInL = linearization.sortBy(bb =&gt; bb.label)
      // debug val MButNotL  = (blocksInM.toSet) diff (blocksInL.toSet) // if non-empty, a jump to B fails to find a label for B (case CJUMP, case CZJUMP)
      // debug if(!MButNotL.isEmpty) { }

      <a href="#357030" title="(x$1: Boolean)Unit">dbFilenameSeen</a> = <span title="Boolean(false)" class="keyword">false</span>
      <a href="#357033" title="(blocks: List[GenMSIL.this.global.icodes.BasicBlock], previous: GenMSIL.this.global.icodes.BasicBlock)Unit">genBlocks</a><span class="delimiter">(</span><a href="#360767" title="List[GenMSIL.this.global.icodes.BasicBlock]">linearization</a><span class="delimiter">)</span>

      // RETURN inside exception blocks are replaced by Leave. The target of the
      // leave is a `Ret` outside any exception block (generated here).
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#357044" title="=&gt; GenMSIL.this.global.icodes.IMethod">handlerReturnMethod</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#360764" title="GenMSIL.this.global.icodes.IMethod">m</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">MarkLabel</span><span class="delimiter">(</span><a href="#357050" title="=&gt; ch.epfl.lamp.compiler.msil.emit.Label">handlerReturnLabel</a><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#357053" title="=&gt; GenMSIL.this.global.icodes.TypeKind">handlerReturnKind</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../icode/TypeKinds.scala.html#228965" title="object GenMSIL.this.global.icodes.UNIT">UNIT</a><span class="delimiter">)</span>
          <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.emit.LocalBuilder)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldloc</span>, <a href="#357047" title="=&gt; ch.epfl.lamp.compiler.msil.emit.LocalBuilder">handlerReturnLocal</a><span class="delimiter">)</span>
        <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ret</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="#357034" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,List[GenMSIL.this.global.icodes.ExceptionHandler]]">beginExBlock</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#357036" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,GenMSIL.this.global.icodes.ExceptionHandler]">beginCatchBlock</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#357038" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,List[GenMSIL.this.global.icodes.ExceptionHandler]]">endExBlock</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#357056" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.ExceptionHandler,ch.epfl.lamp.compiler.msil.emit.Label]">endFinallyLabels</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(blocks: List[GenMSIL.this.global.icodes.BasicBlock], previous: GenMSIL.this.global.icodes.BasicBlock)Unit" id="357033">genBlocks</a><span class="delimiter">(</span><a title="List[GenMSIL.this.global.icodes.BasicBlock]" id="360813">blocks</a>: <span title="List[GenMSIL.this.global.icodes.BasicBlock]">List</span><span class="delimiter">[</span>BasicBlock<span class="delimiter">]</span>, <a title="GenMSIL.this.global.icodes.BasicBlock" id="360816">previous</a>: <a href="../icode/BasicBlocks.scala.html#228937" title="GenMSIL.this.global.icodes.BasicBlock">BasicBlock</a> = <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#360813" title="List[GenMSIL.this.global.icodes.BasicBlock]">blocks</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Unit">Nil</span> =&gt; <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="Unit" id="360841">x</a> :: <span title="object Nil">Nil</span> =&gt; <a href="#357059" title="(block: GenMSIL.this.global.icodes.BasicBlock, prev: GenMSIL.this.global.icodes.BasicBlock, next: GenMSIL.this.global.icodes.BasicBlock)Unit">genBlock</a><span class="delimiter">(</span><a href="#360841" title="GenMSIL.this.global.icodes.BasicBlock">x</a>, prev = <a href="#360816" title="GenMSIL.this.global.icodes.BasicBlock">previous</a>, next = <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="Unit" id="360850">x</a> :: <a title="GenMSIL.this.global.icodes.BasicBlock" id="360858">y</a> :: <a title="List[GenMSIL.this.global.icodes.BasicBlock]" id="360859">ys</a> =&gt; <a href="#357059" title="(block: GenMSIL.this.global.icodes.BasicBlock, prev: GenMSIL.this.global.icodes.BasicBlock, next: GenMSIL.this.global.icodes.BasicBlock)Unit">genBlock</a><span class="delimiter">(</span><a href="#360850" title="GenMSIL.this.global.icodes.BasicBlock">x</a>, prev = <a href="#360816" title="GenMSIL.this.global.icodes.BasicBlock">previous</a>, next = <a href="#360858" title="GenMSIL.this.global.icodes.BasicBlock">y</a><span class="delimiter">)</span>; <a href="#357033" title="(blocks: List[GenMSIL.this.global.icodes.BasicBlock], previous: GenMSIL.this.global.icodes.BasicBlock)Unit">genBlocks</a><span class="delimiter">(</span><a href="#360858" title="GenMSIL.this.global.icodes.BasicBlock">y</a> <a href="#360860" title="(x: GenMSIL.this.global.icodes.BasicBlock)List[GenMSIL.this.global.icodes.BasicBlock]">::</a> <a href="#360859" title="List[GenMSIL.this.global.icodes.BasicBlock]">ys</a>, previous = <a href="#360850" title="GenMSIL.this.global.icodes.BasicBlock">x</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    // the try blocks starting at a certain BasicBlock
    <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,List[GenMSIL.this.global.icodes.ExceptionHandler]]" id="357034">beginExBlock</a> = mutable.<span title="[A, B](elems: (A, B)*)scala.collection.mutable.HashMap[A,B]">HashMap</span><span title="(elems: (GenMSIL.this.global.icodes.BasicBlock, List[GenMSIL.this.global.icodes.ExceptionHandler])*)scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,List[GenMSIL.this.global.icodes.ExceptionHandler]]" class="delimiter">[</span><a href="../icode/BasicBlocks.scala.html#228937" title="GenMSIL.this.global.icodes.BasicBlock">BasicBlock</a>, <span title="List[GenMSIL.this.global.icodes.ExceptionHandler]">List</span><span class="delimiter">[</span>ExceptionHandler<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

    // the catch blocks starting / endling at a certain BasicBlock
    <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,GenMSIL.this.global.icodes.ExceptionHandler]" id="357036">beginCatchBlock</a> = mutable.<span title="[A, B](elems: (A, B)*)scala.collection.mutable.HashMap[A,B]">HashMap</span><span title="(elems: (GenMSIL.this.global.icodes.BasicBlock, GenMSIL.this.global.icodes.ExceptionHandler)*)scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,GenMSIL.this.global.icodes.ExceptionHandler]" class="delimiter">[</span><a href="../icode/BasicBlocks.scala.html#228937" title="GenMSIL.this.global.icodes.BasicBlock">BasicBlock</a>, <a href="../icode/ExceptionHandlers.scala.html#229005" title="GenMSIL.this.global.icodes.ExceptionHandler">ExceptionHandler</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,List[GenMSIL.this.global.icodes.ExceptionHandler]]" id="357038">endExBlock</a> = mutable.<span title="[A, B](elems: (A, B)*)scala.collection.mutable.HashMap[A,B]">HashMap</span><span title="(elems: (GenMSIL.this.global.icodes.BasicBlock, List[GenMSIL.this.global.icodes.ExceptionHandler])*)scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,List[GenMSIL.this.global.icodes.ExceptionHandler]]" class="delimiter">[</span><a href="../icode/BasicBlocks.scala.html#228937" title="GenMSIL.this.global.icodes.BasicBlock">BasicBlock</a>, <span title="List[GenMSIL.this.global.icodes.ExceptionHandler]">List</span><span class="delimiter">[</span>ExceptionHandler<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

    /** When emitting the code (genBlock), the number of currently active try / catch
     *  blocks. When seeing a `RETURN` inside a try / catch, we need to
     *   - store the result in a local (if it's not UNIT)
     *   - emit `Leave handlerReturnLabel` instead of the Return
     *   - emit code at the end: load the local and return its value
     */
    <span class="keyword">var</span> <a title="scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]" id="357041">currentHandlers</a> = <span title="()scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">Stack</span><span class="delimiter">[</span>ExceptionHandler<span class="delimiter">]</span>
    // The IMethod the Local/Label/Kind below belong to
    <span class="keyword">var</span> <a title="GenMSIL.this.global.icodes.IMethod" id="357044">handlerReturnMethod</a>: <a href="../icode/Members.scala.html#228928" title="GenMSIL.this.global.icodes.IMethod">IMethod</a> = _
    // Stores the result when returning inside an exception block
    <span class="keyword">var</span> <a title="ch.epfl.lamp.compiler.msil.emit.LocalBuilder" id="357047">handlerReturnLocal</a>: <span title="ch.epfl.lamp.compiler.msil.emit.LocalBuilder">LocalBuilder</span> = _
    // Label for a return instruction outside any exception block
    <span class="keyword">var</span> <a title="ch.epfl.lamp.compiler.msil.emit.Label" id="357050">handlerReturnLabel</a>: <span title="ch.epfl.lamp.compiler.msil.emit.Label">Label</span> = _
    // The result kind.
    <span class="keyword">var</span> <a title="GenMSIL.this.global.icodes.TypeKind" id="357053">handlerReturnKind</a>: <a href="../icode/TypeKinds.scala.html#228959" title="GenMSIL.this.global.icodes.TypeKind">TypeKind</a> = _
    <span class="keyword">def</span> <a title="(kind: GenMSIL.this.global.icodes.TypeKind)(ch.epfl.lamp.compiler.msil.emit.LocalBuilder, ch.epfl.lamp.compiler.msil.emit.Label)" id="357055">returnFromHandler</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="360866">kind</a>: <a href="../icode/TypeKinds.scala.html#228959" title="GenMSIL.this.global.icodes.TypeKind">TypeKind</a><span class="delimiter">)</span>: <span title="(ch.epfl.lamp.compiler.msil.emit.LocalBuilder, ch.epfl.lamp.compiler.msil.emit.Label)" class="delimiter">(</span>LocalBuilder, Label<span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#357044" title="=&gt; GenMSIL.this.global.icodes.IMethod">handlerReturnMethod</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#356990" title="=&gt; GenMSIL.this.global.icodes.IMethod">method</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#357044" title="(x$1: GenMSIL.this.global.icodes.IMethod)Unit">handlerReturnMethod</a> = <a href="#356990" title="=&gt; GenMSIL.this.global.icodes.IMethod">method</a>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#360866" title="GenMSIL.this.global.icodes.TypeKind">kind</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../icode/TypeKinds.scala.html#228965" title="object GenMSIL.this.global.icodes.UNIT">UNIT</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#357047" title="(x$1: ch.epfl.lamp.compiler.msil.emit.LocalBuilder)Unit">handlerReturnLocal</a> = <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(localType: ch.epfl.lamp.compiler.msil.Type)ch.epfl.lamp.compiler.msil.emit.LocalBuilder">DeclareLocal</span><span class="delimiter">(</span><a href="#357081" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#360866" title="GenMSIL.this.global.icodes.TypeKind">kind</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#357047" title="=&gt; ch.epfl.lamp.compiler.msil.emit.LocalBuilder">handlerReturnLocal</a>.<span title="(name: String)Unit">SetLocalSymInfo</span><span class="delimiter">(</span><span title="String(&quot;$handlerReturn&quot;)" class="string">&quot;$handlerReturn&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#357050" title="(x$1: ch.epfl.lamp.compiler.msil.emit.Label)Unit">handlerReturnLabel</a> = <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="()ch.epfl.lamp.compiler.msil.emit.Label">DefineLabel</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#357053" title="(x$1: GenMSIL.this.global.icodes.TypeKind)Unit">handlerReturnKind</a> = <a href="#360866" title="GenMSIL.this.global.icodes.TypeKind">kind</a>
      <span class="delimiter">}</span>
      <span title="(_1: ch.epfl.lamp.compiler.msil.emit.LocalBuilder, _2: ch.epfl.lamp.compiler.msil.emit.Label)(ch.epfl.lamp.compiler.msil.emit.LocalBuilder, ch.epfl.lamp.compiler.msil.emit.Label)" class="delimiter">(</span><a href="#357047" title="=&gt; ch.epfl.lamp.compiler.msil.emit.LocalBuilder">handlerReturnLocal</a>, <a href="#357050" title="=&gt; ch.epfl.lamp.compiler.msil.emit.Label">handlerReturnLabel</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    /** For try/catch nested inside a finally, we can't use `Leave OutsideFinally`, the
     *  Leave target has to be inside the finally (and it has to be the `endfinally` instruction).
     *  So for every finalizer, we have a label which marks the place of the `endfinally`,
     *  nested try/catch blocks will leave there.
     */
    <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.ExceptionHandler,ch.epfl.lamp.compiler.msil.emit.Label]" id="357056">endFinallyLabels</a> = mutable.<span title="[A, B](elems: (A, B)*)scala.collection.mutable.HashMap[A,B]">HashMap</span><span title="(elems: (GenMSIL.this.global.icodes.ExceptionHandler, ch.epfl.lamp.compiler.msil.emit.Label)*)scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.ExceptionHandler,ch.epfl.lamp.compiler.msil.emit.Label]" class="delimiter">[</span><a href="../icode/ExceptionHandlers.scala.html#229005" title="GenMSIL.this.global.icodes.ExceptionHandler">ExceptionHandler</a>, <span title="ch.epfl.lamp.compiler.msil.emit.Label">Label</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

    /** Computes which blocks are the beginning / end of a try or catch block */
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(blocks: List[GenMSIL.this.global.icodes.BasicBlock], m: GenMSIL.this.global.icodes.IMethod)List[GenMSIL.this.global.icodes.BasicBlock]" id="357058">computeExceptionMaps</a><span class="delimiter">(</span><a title="List[GenMSIL.this.global.icodes.BasicBlock]" id="360810">blocks</a>: <span title="List[GenMSIL.this.global.icodes.BasicBlock]">List</span><span class="delimiter">[</span>BasicBlock<span class="delimiter">]</span>, <a title="GenMSIL.this.global.icodes.IMethod" id="360811">m</a>: <a href="../icode/Members.scala.html#228928" title="GenMSIL.this.global.icodes.IMethod">IMethod</a><span class="delimiter">)</span>: <span title="List[GenMSIL.this.global.icodes.BasicBlock]">List</span><span class="delimiter">[</span>BasicBlock<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.collection.mutable.HashSet[GenMSIL.this.global.icodes.BasicBlock]" id="360889">visitedBlocks</a> = <span title="()scala.collection.mutable.HashSet[GenMSIL.this.global.icodes.BasicBlock]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.HashSet[GenMSIL.this.global.icodes.BasicBlock]">HashSet</span><span class="delimiter">[</span>BasicBlock<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

      // handlers which have not been introduced so far
      <span class="keyword">var</span> <a title="List[GenMSIL.this.global.icodes.ExceptionHandler]" id="360890">openHandlers</a> = <a href="#360811" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312620" title="=&gt; List[GenMSIL.this.global.icodes.ExceptionHandler]">exh</a>


      /** Example
       *   try {
       *     try {
       *         // *1*
       *     } catch {
       *       case h1 =&gt;
       *     }
       *   } catch {
       *     case h2 =&gt;
       *     case h3 =&gt;
       *       try {
       *
       *       } catch {
       *         case h4 =&gt;  // *2*
       *         case h5 =&gt;
       *       }
       *   }
       */

      // Stack of nested try blocks. Each bloc has a List of ExceptionHandler (multiple
      // catch statements). Example *1*: Stack(List(h2, h3), List(h1))
      <span class="keyword">val</span> <a title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]" id="360891">currentTryHandlers</a> = <span title="()scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]">Stack</span><span class="delimiter">[</span>List<span class="delimiter">[</span>ExceptionHandler<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

      // Stack of nested catch blocks. The head of the list is the current catch block. The
      // tail is all following catch blocks. Example *2*: Stack(List(h3), List(h4, h5))
      <span class="keyword">val</span> <a title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]" id="360892">currentCatchHandlers</a> = <span title="()scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]">Stack</span><span class="delimiter">[</span>List<span class="delimiter">[</span>ExceptionHandler<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

      <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.BasicBlock" id="360917">b</a> &lt;- <a href="#360810" title="(f: GenMSIL.this.global.icodes.BasicBlock =&gt; scala.collection.mutable.HashSet[GenMSIL.this.global.icodes.BasicBlock])Unit">blocks</a><span class="delimiter">)</span> <span class="delimiter">{</span>

        // are we past the current catch blocks?
        <span class="keyword">def</span> <a title="()List[GenMSIL.this.global.icodes.ExceptionHandler]" id="360918">endHandlers</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="List[GenMSIL.this.global.icodes.ExceptionHandler]">List</span><span class="delimiter">[</span>ExceptionHandler<span class="delimiter">]</span> = <span class="delimiter">{</span>
          <span class="keyword">var</span> <a title="List[GenMSIL.this.global.icodes.ExceptionHandler]" id="360926">res</a>: <span title="List[GenMSIL.this.global.icodes.ExceptionHandler]">List</span><span class="delimiter">[</span>ExceptionHandler<span class="delimiter">]</span> = <span title="object Nil">Nil</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#360892" title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]">currentCatchHandlers</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.ExceptionHandler" id="360927">handler</a> = <a href="#360892" title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]">currentCatchHandlers</a>.<span title="=&gt; List[GenMSIL.this.global.icodes.ExceptionHandler]">top</span>.<span title="=&gt; GenMSIL.this.global.icodes.ExceptionHandler">head</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#360927" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a>.<a href="../icode/ExceptionHandlers.scala.html#312857" title="=&gt; List[GenMSIL.this.global.icodes.BasicBlock]">blocks</a>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#360917" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              // all blocks of the handler are either visited, or not part of the linearization (i.e. dead)
              <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#360927" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a>.<a href="../icode/ExceptionHandlers.scala.html#312857" title="=&gt; List[GenMSIL.this.global.icodes.BasicBlock]">blocks</a>.<span title="(p: GenMSIL.this.global.icodes.BasicBlock =&gt; Boolean)Boolean">forall</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.BasicBlock" id="360946">b</a> =&gt; <a href="#360889" title="scala.collection.mutable.HashSet[GenMSIL.this.global.icodes.BasicBlock]">visitedBlocks</a>.<span title="(elem: GenMSIL.this.global.icodes.BasicBlock)Boolean">contains</span><span class="delimiter">(</span><a href="#360946" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <span title="=&gt; Boolean">!</span><a href="#360810" title="List[GenMSIL.this.global.icodes.BasicBlock]">blocks</a>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#360946" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span><span class="delimiter">)</span>,
                     <span title="String(&quot;Bad linearization of basic blocks inside catch. Found block not part of the handler\n&quot;)" class="string">&quot;Bad linearization of basic blocks inside catch. Found block not part of the handler\n&quot;</span><span title="(x$1: Any)String">+</span>
                     <a href="#360917" title="GenMSIL.this.global.icodes.BasicBlock">b</a>.<a href="../icode/BasicBlocks.scala.html#312593" title="=&gt; String">fullString</a> <span title="(x$1: Any)String">+</span><span title="String(&quot;\nwhile in catch-part of\n&quot;)" class="string">&quot;\nwhile in catch-part of\n&quot;</span><span title="(x$1: Any)String">+</span> <a href="#360927" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a><span class="delimiter">)</span>

              <span class="keyword">val</span> <a title="List[GenMSIL.this.global.icodes.ExceptionHandler]" id="360933">rest</a> = <a href="#360892" title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]">currentCatchHandlers</a>.<span title="()List[GenMSIL.this.global.icodes.ExceptionHandler]">pop</span>.<span title="=&gt; List[GenMSIL.this.global.icodes.ExceptionHandler]">tail</span>
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#360933" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">rest</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                // all catch blocks of that exception handler are covered
                <a href="#360926" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">res</a> = <a href="#360927" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a> <a href="#360951" title="(x: GenMSIL.this.global.icodes.ExceptionHandler)List[GenMSIL.this.global.icodes.ExceptionHandler]">::</a> <a href="#360918" title="()List[GenMSIL.this.global.icodes.ExceptionHandler]">endHandlers</a><span class="delimiter">(</span><span class="delimiter">)</span>
              <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
                // there are more catch blocks for that try (handlers covering the same)
                <a href="#360892" title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]">currentCatchHandlers</a>.<span title="(elem: List[GenMSIL.this.global.icodes.ExceptionHandler])currentCatchHandlers.type">push</span><span class="delimiter">(</span><a href="#360933" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">rest</a><span class="delimiter">)</span>
                <a href="#357036" title="(key: GenMSIL.this.global.icodes.BasicBlock, value: GenMSIL.this.global.icodes.ExceptionHandler)Unit">beginCatchBlock</a><span class="delimiter">(</span><a href="#360917" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span> = <a href="#360933" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">rest</a>.<span title="=&gt; GenMSIL.this.global.icodes.ExceptionHandler">head</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
          <a href="#360926" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">res</a>
        <span class="delimiter">}</span>
        <span class="keyword">val</span> <a title="List[GenMSIL.this.global.icodes.ExceptionHandler]" id="360919">end</a> = <a href="#360918" title="()List[GenMSIL.this.global.icodes.ExceptionHandler]">endHandlers</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#360919" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">end</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#357038" title="(key: GenMSIL.this.global.icodes.BasicBlock, value: List[GenMSIL.this.global.icodes.ExceptionHandler])Unit">endExBlock</a><span class="delimiter">(</span><a href="#360917" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span> = <a href="#360919" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">end</a>

        // are we past the current try block?
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#360891" title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]">currentTryHandlers</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.ExceptionHandler" id="360971">handler</a> = <a href="#360891" title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]">currentTryHandlers</a>.<span title="=&gt; List[GenMSIL.this.global.icodes.ExceptionHandler]">top</span>.<span title="=&gt; GenMSIL.this.global.icodes.ExceptionHandler">head</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#360971" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a>.<a href="../icode/ExceptionHandlers.scala.html#312856" title="(b: GenMSIL.this.global.icodes.BasicBlock)Boolean">covers</a><span class="delimiter">(</span><a href="#360917" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            // all of the covered blocks are visited, or not part of the linearization
            <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#360971" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a>.<a href="../icode/ExceptionHandlers.scala.html#312852" title="=&gt; scala.collection.immutable.Set[GenMSIL.this.global.icodes.BasicBlock]">covered</a>.<span title="(p: GenMSIL.this.global.icodes.BasicBlock =&gt; Boolean)Boolean">forall</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.BasicBlock" id="360992">b</a> =&gt; <a href="#360889" title="scala.collection.mutable.HashSet[GenMSIL.this.global.icodes.BasicBlock]">visitedBlocks</a>.<span title="(elem: GenMSIL.this.global.icodes.BasicBlock)Boolean">contains</span><span class="delimiter">(</span><a href="#360992" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <span title="=&gt; Boolean">!</span><a href="#360810" title="List[GenMSIL.this.global.icodes.BasicBlock]">blocks</a>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#360992" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span><span class="delimiter">)</span>,
                   <span title="String(&quot;Bad linearization of basic blocks inside try. Found non-covered block\n&quot;)" class="string">&quot;Bad linearization of basic blocks inside try. Found non-covered block\n&quot;</span><span title="(x$1: Any)String">+</span>
                   <a href="#360917" title="GenMSIL.this.global.icodes.BasicBlock">b</a>.<a href="../icode/BasicBlocks.scala.html#312593" title="=&gt; String">fullString</a> <span title="(x$1: Any)String">+</span><span title="String(&quot;\nwhile in try-part of\n&quot;)" class="string">&quot;\nwhile in try-part of\n&quot;</span><span title="(x$1: Any)String">+</span> <a href="#360971" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a><span class="delimiter">)</span>

            <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#360971" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a>.<a href="../icode/ExceptionHandlers.scala.html#312851" title="=&gt; GenMSIL.this.global.icodes.BasicBlock">startBlock</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#360917" title="GenMSIL.this.global.icodes.BasicBlock">b</a>,
                   <span title="String(&quot;Bad linearization of basic blocks. The entry block of a catch does not directly follow the try\n&quot;)" class="string">&quot;Bad linearization of basic blocks. The entry block of a catch does not directly follow the try\n&quot;</span><span title="(x$1: Any)String">+</span>
                   <a href="#360917" title="GenMSIL.this.global.icodes.BasicBlock">b</a>.<a href="../icode/BasicBlocks.scala.html#312593" title="=&gt; String">fullString</a> <span title="(x$1: Any)String">+</span><span title="String(&quot;\n&quot;)" class="string">&quot;\n&quot;</span><span title="(x$1: Any)String">+</span> <a href="#360971" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a><span class="delimiter">)</span>

            <span class="keyword">val</span> <a title="List[GenMSIL.this.global.icodes.ExceptionHandler]" id="360974">handlers</a> = <a href="#360891" title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]">currentTryHandlers</a>.<span title="()List[GenMSIL.this.global.icodes.ExceptionHandler]">pop</span>
            <a href="#360892" title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]">currentCatchHandlers</a>.<span title="(elem: List[GenMSIL.this.global.icodes.ExceptionHandler])currentCatchHandlers.type">push</span><span class="delimiter">(</span><a href="#360974" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">handlers</a><span class="delimiter">)</span>
            <a href="#357036" title="(key: GenMSIL.this.global.icodes.BasicBlock, value: GenMSIL.this.global.icodes.ExceptionHandler)Unit">beginCatchBlock</a><span class="delimiter">(</span><a href="#360917" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span> = <a href="#360971" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>

        // are there try blocks starting at b?
        <span class="keyword">val</span> <a href="#360921" title="(List[GenMSIL.this.global.icodes.ExceptionHandler], List[GenMSIL.this.global.icodes.ExceptionHandler])" class="delimiter">(</a><a href="#360920" title="List[GenMSIL.this.global.icodes.ExceptionHandler]" id="360921">newHandlers</a>, <a href="#360920" title="List[GenMSIL.this.global.icodes.ExceptionHandler]" id="360922">stillOpen</a><span class="delimiter">)</span> = <a href="#360890" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">openHandlers</a>.<span title="(p: GenMSIL.this.global.icodes.ExceptionHandler =&gt; Boolean)(List[GenMSIL.this.global.icodes.ExceptionHandler], List[GenMSIL.this.global.icodes.ExceptionHandler])">partition</span><span title="(List[GenMSIL.this.global.icodes.ExceptionHandler], List[GenMSIL.this.global.icodes.ExceptionHandler]) @unchecked" class="delimiter">(</span><a href="#361011" title="GenMSIL.this.global.icodes.ExceptionHandler">_</a>.<a href="../icode/ExceptionHandlers.scala.html#312856" title="(b: GenMSIL.this.global.icodes.BasicBlock)Boolean">covers</a><span class="delimiter">(</span><a href="#360917" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#360890" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">openHandlers</a> = <a href="#360922" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">stillOpen</a>

        <span class="keyword">val</span> <a title="scala.collection.immutable.Map[Int,List[GenMSIL.this.global.icodes.ExceptionHandler]]" id="360923">newHandlersBySize</a> = <a href="#360921" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">newHandlers</a>.<span title="(f: GenMSIL.this.global.icodes.ExceptionHandler =&gt; Int)scala.collection.immutable.Map[Int,List[GenMSIL.this.global.icodes.ExceptionHandler]]">groupBy</span><span class="delimiter">(</span><a href="#361029" title="GenMSIL.this.global.icodes.ExceptionHandler">_</a>.<a href="../icode/ExceptionHandlers.scala.html#312852" title="=&gt; scala.collection.immutable.Set[GenMSIL.this.global.icodes.BasicBlock]">covered</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span>
        // big handlers first, smaller ones are nested inside the try of the big one
        // (checked by the assertions below)
        <span class="keyword">val</span> <a title="List[Int]" id="360924">sizes</a> = <a href="#360923" title="scala.collection.immutable.Map[Int,List[GenMSIL.this.global.icodes.ExceptionHandler]]">newHandlersBySize</a>.<span title="=&gt; Iterable[Int]">keys</span>.<span title="=&gt; List[Int]">toList</span>.<span title="(lt: (Int, Int) =&gt; Boolean)List[Int]">sortWith</span><span class="delimiter">(</span><a href="#361035" title="Int">_</a> <span title="(x: Int)Boolean">&gt;</span> <a href="#361036" title="Int">_</a><span class="delimiter">)</span>

        <span class="keyword">val</span> <a title="scala.collection.mutable.ListBuffer[GenMSIL.this.global.icodes.ExceptionHandler]" id="360925">beginHandlers</a> = <span title="scala.collection.mutable.ListBuffer[GenMSIL.this.global.icodes.ExceptionHandler]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.ListBuffer[GenMSIL.this.global.icodes.ExceptionHandler]">ListBuffer</span><span class="delimiter">[</span>ExceptionHandler<span class="delimiter">]</span>
        <span class="keyword">for</span> <span class="delimiter">(</span><a title="Int" id="361060">s</a> &lt;- <a href="#360924" title="(f: Int =&gt; scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]])Unit">sizes</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="List[GenMSIL.this.global.icodes.ExceptionHandler]" id="361061">sHandlers</a> = <a href="#360923" title="(key: Int)List[GenMSIL.this.global.icodes.ExceptionHandler]">newHandlersBySize</a><span class="delimiter">(</span><a href="#361060" title="Int">s</a><span class="delimiter">)</span>
          <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.ExceptionHandler" id="361106">h</a> &lt;- <a href="#361061" title="(f: GenMSIL.this.global.icodes.ExceptionHandler =&gt; Unit)Unit">sHandlers</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#361106" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a>.<a href="../icode/ExceptionHandlers.scala.html#312852" title="=&gt; scala.collection.immutable.Set[GenMSIL.this.global.icodes.BasicBlock]">covered</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#361061" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">sHandlers</a>.<span title="=&gt; GenMSIL.this.global.icodes.ExceptionHandler">head</span>.<a href="../icode/ExceptionHandlers.scala.html#312852" title="=&gt; scala.collection.immutable.Set[GenMSIL.this.global.icodes.BasicBlock]">covered</a>,
                   <span title="String(&quot;bad nesting of exception handlers. same size, but not covering same blocks\n&quot;)" class="string">&quot;bad nesting of exception handlers. same size, but not covering same blocks\n&quot;</span><span title="(x$1: Any)String">+</span>
                   <a href="#361106" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a> <span title="(x$1: Any)String">+</span><span title="String(&quot;\n&quot;)" class="string">&quot;\n&quot;</span><span title="(x$1: Any)String">+</span> <a href="#361061" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">sHandlers</a>.<span title="=&gt; GenMSIL.this.global.icodes.ExceptionHandler">head</span><span class="delimiter">)</span>
            <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#361106" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a>.<a href="../icode/ExceptionHandlers.scala.html#312847" title="=&gt; GenMSIL.this.global.icodes.TypeKind">resultKind</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#361061" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">sHandlers</a>.<span title="=&gt; GenMSIL.this.global.icodes.ExceptionHandler">head</span>.<a href="../icode/ExceptionHandlers.scala.html#312847" title="=&gt; GenMSIL.this.global.icodes.TypeKind">resultKind</a>,
                   <span title="String(&quot;bad nesting of exception handlers. same size, but the same resultKind\n&quot;)" class="string">&quot;bad nesting of exception handlers. same size, but the same resultKind\n&quot;</span><span title="(x$1: Any)String">+</span>
                   <a href="#361106" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a> <span title="(x$1: Any)String">+</span><span title="String(&quot;\n&quot;)" class="string">&quot;\n&quot;</span><span title="(x$1: Any)String">+</span> <a href="#361061" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">sHandlers</a>.<span title="=&gt; GenMSIL.this.global.icodes.ExceptionHandler">head</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.ExceptionHandler" id="361141">bigger</a> &lt;- <a href="#360925" title="(f: GenMSIL.this.global.icodes.ExceptionHandler =&gt; Unit)Unit">beginHandlers</a>; <a title="GenMSIL.this.global.icodes.ExceptionHandler" id="361160">h</a> &lt;- <a href="#361061" title="(f: GenMSIL.this.global.icodes.ExceptionHandler =&gt; Unit)Unit">sHandlers</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#361160" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a>.<a href="../icode/ExceptionHandlers.scala.html#312852" title="=&gt; scala.collection.immutable.Set[GenMSIL.this.global.icodes.BasicBlock]">covered</a>.<span title="(that: scala.collection.GenSet[GenMSIL.this.global.icodes.BasicBlock])Boolean">subsetOf</span><span class="delimiter">(</span><a href="#361141" title="GenMSIL.this.global.icodes.ExceptionHandler">bigger</a>.<a href="../icode/ExceptionHandlers.scala.html#312852" title="=&gt; scala.collection.immutable.Set[GenMSIL.this.global.icodes.BasicBlock]">covered</a><span class="delimiter">)</span>,
                   <span title="String(&quot;bad nesting of exception handlers. try blocks of smaller handler are not nested in bigger one.\n&quot;)" class="string">&quot;bad nesting of exception handlers. try blocks of smaller handler are not nested in bigger one.\n&quot;</span><span title="(x$1: Any)String">+</span>
                   <a href="#361160" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a> <span title="(x$1: Any)String">+</span><span title="String(&quot;\n&quot;)" class="string">&quot;\n&quot;</span><span title="(x$1: Any)String">+</span> <a href="#361141" title="GenMSIL.this.global.icodes.ExceptionHandler">bigger</a><span class="delimiter">)</span>
            <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#361160" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a>.<a href="../icode/ExceptionHandlers.scala.html#312857" title="=&gt; List[GenMSIL.this.global.icodes.BasicBlock]">blocks</a>.<span title="scala.collection.immutable.Set[GenMSIL.this.global.icodes.BasicBlock]">toSet</span>.<span title="(that: scala.collection.GenSet[GenMSIL.this.global.icodes.BasicBlock])Boolean">subsetOf</span><span class="delimiter">(</span><a href="#361141" title="GenMSIL.this.global.icodes.ExceptionHandler">bigger</a>.<a href="../icode/ExceptionHandlers.scala.html#312852" title="=&gt; scala.collection.immutable.Set[GenMSIL.this.global.icodes.BasicBlock]">covered</a><span class="delimiter">)</span>,
                   <span title="String(&quot;bad nesting of exception handlers. catch blocks of smaller handler are not nested in bigger one.\n&quot;)" class="string">&quot;bad nesting of exception handlers. catch blocks of smaller handler are not nested in bigger one.\n&quot;</span><span title="(x$1: Any)String">+</span>
                   <a href="#361160" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a> <span title="(x$1: Any)String">+</span><span title="String(&quot;\n&quot;)" class="string">&quot;\n&quot;</span><span title="(x$1: Any)String">+</span> <a href="#361141" title="GenMSIL.this.global.icodes.ExceptionHandler">bigger</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <a href="#360925" title="scala.collection.mutable.ListBuffer[GenMSIL.this.global.icodes.ExceptionHandler]">beginHandlers</a> <span title="(x: GenMSIL.this.global.icodes.ExceptionHandler)beginHandlers.type">+=</span> <a href="#361061" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">sHandlers</a>.<span title="=&gt; GenMSIL.this.global.icodes.ExceptionHandler">head</span>
          <a href="#360891" title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]">currentTryHandlers</a>.<span title="(elem: List[GenMSIL.this.global.icodes.ExceptionHandler])currentTryHandlers.type">push</span><span class="delimiter">(</span><a href="#361061" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">sHandlers</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#357034" title="(key: GenMSIL.this.global.icodes.BasicBlock, value: List[GenMSIL.this.global.icodes.ExceptionHandler])Unit">beginExBlock</a><span class="delimiter">(</span><a href="#360917" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span> = <a href="#360925" title="scala.collection.mutable.ListBuffer[GenMSIL.this.global.icodes.ExceptionHandler]">beginHandlers</a>.<span title="=&gt; List[GenMSIL.this.global.icodes.ExceptionHandler]">toList</span>
        <a href="#360889" title="scala.collection.mutable.HashSet[GenMSIL.this.global.icodes.BasicBlock]">visitedBlocks</a> <span title="(elem: GenMSIL.this.global.icodes.BasicBlock)visitedBlocks.type">+=</span> <a href="#360917" title="GenMSIL.this.global.icodes.BasicBlock">b</a>
      <span class="delimiter">}</span>

      // if there handlers left (i.e. handlers covering nothing, or a
      // non-existent (dead) block), remove their catch-blocks.
      <span class="keyword">val</span> <a title="List[GenMSIL.this.global.icodes.BasicBlock]" id="360893">liveBlocks</a> = <span title="List[GenMSIL.this.global.icodes.BasicBlock]" class="keyword">if</span> <span class="delimiter">(</span><a href="#360890" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">openHandlers</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#360810" title="List[GenMSIL.this.global.icodes.BasicBlock]">blocks</a> <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="#360810" title="List[GenMSIL.this.global.icodes.BasicBlock]">blocks</a>.<span title="(p: GenMSIL.this.global.icodes.BasicBlock =&gt; Boolean)List[GenMSIL.this.global.icodes.BasicBlock]">filter</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.BasicBlock" id="361214">b</a> =&gt; <a href="#360890" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">openHandlers</a>.<span title="(p: GenMSIL.this.global.icodes.ExceptionHandler =&gt; Boolean)Boolean">forall</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.ExceptionHandler" id="361223">h</a> =&gt; <span title="=&gt; Boolean">!</span><a href="#361223" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a>.<a href="../icode/ExceptionHandlers.scala.html#312857" title="=&gt; List[GenMSIL.this.global.icodes.BasicBlock]">blocks</a>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#361214" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      /** There might be open handlers, but no more blocks. happens when try/catch end
       *  with `throw` or `return`
       *     def foo() { try { .. throw } catch { _ =&gt; .. throw } }
       *
       *  In this case we need some code after the catch block for the auto-generated
       *  `leave` instruction. So we're adding a (dead) `throw new Exception`.
       */
      <span class="keyword">val</span> <a title="List[GenMSIL.this.global.icodes.ExceptionHandler]" id="360894">rest</a> = <a href="#360892" title="scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]]">currentCatchHandlers</a>.<span title="(f: List[GenMSIL.this.global.icodes.ExceptionHandler] =&gt; GenMSIL.this.global.icodes.ExceptionHandler)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Stack[List[GenMSIL.this.global.icodes.ExceptionHandler]],GenMSIL.this.global.icodes.ExceptionHandler,scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]])scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.mutable.Stack.Coll,GenMSIL.this.global.icodes.ExceptionHandler,scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]]" class="delimiter">(</span><a title="List[GenMSIL.this.global.icodes.ExceptionHandler]" id="361240">handlers</a> =&gt; <span class="delimiter">{</span>
        <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#361240" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">handlers</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span>, <a href="#361240" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">handlers</a><span class="delimiter">)</span>
        <a href="#361240" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">handlers</a>.<span title="=&gt; GenMSIL.this.global.icodes.ExceptionHandler">head</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>.<span title="=&gt; List[GenMSIL.this.global.icodes.ExceptionHandler]">toList</span>

      <span title="List[GenMSIL.this.global.icodes.BasicBlock]" class="keyword">if</span> <span class="delimiter">(</span><a href="#360894" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">rest</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#360893" title="List[GenMSIL.this.global.icodes.BasicBlock]">liveBlocks</a>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.BasicBlock" id="361373">b</a> = <a href="#360811" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312603" title="=&gt; GenMSIL.this.global.icodes.Code">code</a>.<a href="../icode/Members.scala.html#312713" title="()GenMSIL.this.global.icodes.BasicBlock">newBlock</a>
        <a href="#361373" title="GenMSIL.this.global.icodes.BasicBlock">b</a>.<a href="../icode/BasicBlocks.scala.html#312563" title="(is: Seq[GenMSIL.this.global.icodes.Instruction])Unit">emit</a><span class="delimiter">(</span><span title="(elems: Product with GenMSIL.this.global.icodes.Instruction with Serializable*)Seq[Product with GenMSIL.this.global.icodes.Instruction with Serializable]">Seq</span><span class="delimiter">(</span>
          <a href="../icode/Opcodes.scala.html#322895" title="(kind: GenMSIL.this.global.icodes.REFERENCE)GenMSIL.this.global.icodes.opcodes.NEW">NEW</a><span class="delimiter">(</span><a href="../icode/TypeKinds.scala.html#311260" title="(cls: GenMSIL.this.global.icodes.global.Symbol)GenMSIL.this.global.icodes.REFERENCE">REFERENCE</a><span class="delimiter">(</span><a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46305" title="=&gt; GenMSIL.this.global.Symbol">ThrowableClass</a><span class="delimiter">)</span><span class="delimiter">)</span>,
          <a href="../icode/Opcodes.scala.html#320934" title="(typ: GenMSIL.this.global.icodes.TypeKind)GenMSIL.this.global.icodes.opcodes.DUP">DUP</a><span class="delimiter">(</span><a href="../icode/TypeKinds.scala.html#311260" title="(cls: GenMSIL.this.global.icodes.global.Symbol)GenMSIL.this.global.icodes.REFERENCE">REFERENCE</a><span class="delimiter">(</span><a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46278" title="=&gt; GenMSIL.this.global.Symbol">ObjectClass</a><span class="delimiter">)</span><span class="delimiter">)</span>,
          <a href="../icode/Opcodes.scala.html#323126" title="(method: GenMSIL.this.global.icodes.global.Symbol, style: GenMSIL.this.global.icodes.opcodes.InvokeStyle)GenMSIL.this.global.icodes.opcodes.CALL_METHOD">CALL_METHOD</a><span class="delimiter">(</span><a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46305" title="=&gt; GenMSIL.this.global.Symbol">ThrowableClass</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47977" title="=&gt; GenMSIL.this.global.Symbol">primaryConstructor</a>, <a href="../icode/Opcodes.scala.html#323436" title="(onInstance: Boolean)GenMSIL.this.global.icodes.opcodes.Static">Static</a><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span><span class="delimiter">)</span>,
          <a href="../icode/Opcodes.scala.html#318042" title="(clasz: GenMSIL.this.global.icodes.global.Symbol)GenMSIL.this.global.icodes.opcodes.THROW">THROW</a><span class="delimiter">(</span><a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46305" title="=&gt; GenMSIL.this.global.Symbol">ThrowableClass</a><span class="delimiter">)</span>
        <span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#361373" title="GenMSIL.this.global.icodes.BasicBlock">b</a>.<a href="../icode/BasicBlocks.scala.html#312567" title="()Unit">close</a>
        <a href="#357038" title="(key: GenMSIL.this.global.icodes.BasicBlock, value: List[GenMSIL.this.global.icodes.ExceptionHandler])Unit">endExBlock</a><span class="delimiter">(</span><a href="#361373" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span> = <a href="#360894" title="List[GenMSIL.this.global.icodes.ExceptionHandler]">rest</a>
        <a href="#360893" title="List[GenMSIL.this.global.icodes.BasicBlock]">liveBlocks</a> <a href="#361417" title="(prefix: List[GenMSIL.this.global.icodes.BasicBlock])List[GenMSIL.this.global.icodes.BasicBlock]">:::</a> <span title="(xs: GenMSIL.this.global.icodes.BasicBlock*)List[GenMSIL.this.global.icodes.BasicBlock]">List</span><span class="delimiter">(</span><a href="#361373" title="GenMSIL.this.global.icodes.BasicBlock">b</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    /**
     *  @param block the BasicBlock to emit code for
     *  @param next  the following BasicBlock, `null` if `block` is the last one
     */
    <span class="keyword">def</span> <a title="(block: GenMSIL.this.global.icodes.BasicBlock, prev: GenMSIL.this.global.icodes.BasicBlock, next: GenMSIL.this.global.icodes.BasicBlock)Unit" id="357059">genBlock</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.BasicBlock" id="360842">block</a>: <a href="../icode/BasicBlocks.scala.html#228937" title="GenMSIL.this.global.icodes.BasicBlock">BasicBlock</a>, <a title="GenMSIL.this.global.icodes.BasicBlock" id="360843">prev</a>: <a href="../icode/BasicBlocks.scala.html#228937" title="GenMSIL.this.global.icodes.BasicBlock">BasicBlock</a>, <a title="GenMSIL.this.global.icodes.BasicBlock" id="360844">next</a>: <a href="../icode/BasicBlocks.scala.html#228937" title="GenMSIL.this.global.icodes.BasicBlock">BasicBlock</a><span class="delimiter">)</span> <span class="delimiter">{</span>

      <span class="keyword">def</span> <a title="(local: GenMSIL.this.global.icodes.Local, msg: String, loadAddr: Boolean)Unit" id="361432">loadLocalOrAddress</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.Local" id="361437">local</a>: <a href="../icode/Members.scala.html#228929" title="GenMSIL.this.global.icodes.Local">Local</a>, <a title="String" id="361438">msg</a> : <span title="String">String</span> , <a title="Boolean" id="361439">loadAddr</a> : <span title="Boolean">Boolean</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="../../Global.scala.html#182894" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><a href="#361438" title="String">msg</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; for &quot;)" class="string">&quot; for &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#361437" title="GenMSIL.this.global.icodes.Local">local</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Boolean" id="361440">isArg</a> = <a href="#361437" title="GenMSIL.this.global.icodes.Local">local</a>.<a href="../icode/Members.scala.html#313051" title="=&gt; Boolean">arg</a>
        <span class="keyword">val</span> <a title="Int" id="361441">i</a> = <a href="#361437" title="GenMSIL.this.global.icodes.Local">local</a>.<a href="../icode/Members.scala.html#313054" title="=&gt; Int">index</a>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#361440" title="Boolean">isArg</a><span class="delimiter">)</span>
          <a href="#357062" title="(code: ch.epfl.lamp.compiler.msil.emit.ILGenerator, loadAddr: Boolean)(i: Int)Unit">loadArg</a><span class="delimiter">(</span><a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>, <a href="#361439" title="Boolean">loadAddr</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#361441" title="Int">i</a><span class="delimiter">)</span>
        <span class="keyword">else</span>
          <a href="#357063" title="(i: Int, local: GenMSIL.this.global.icodes.Local, code: ch.epfl.lamp.compiler.msil.emit.ILGenerator, loadAddr: Boolean)Unit">loadLocal</a><span class="delimiter">(</span><a href="#361441" title="Int">i</a>, <a href="#361437" title="GenMSIL.this.global.icodes.Local">local</a>, <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>, <a href="#361439" title="Boolean">loadAddr</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">def</span> <a title="(field: GenMSIL.this.global.Symbol, isStatic: Boolean, msg: String, loadAddr: Boolean)Unit" id="361433">loadFieldOrAddress</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="361621">field</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a>, <a title="Boolean" id="361622">isStatic</a>: <span title="Boolean">Boolean</span>, <a title="String" id="361623">msg</a>: <span title="String">String</span>, <a title="Boolean" id="361624">loadAddr</a> : <span title="Boolean">Boolean</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="../../Global.scala.html#182894" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><a href="#361623" title="String">msg</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; with owner: &quot;)" class="string">&quot; with owner: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#361621" title="GenMSIL.this.global.Symbol">field</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.Symbol">owner</a> <span title="(x$1: Any)String">+</span>
              <span title="String(&quot; flags: &quot;)" class="string">&quot; flags: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="../../symtab/package.scala.html#36230" title="=&gt; reflect.internal.Flags.type">Flags</a>.<a href="../../../../reflect/internal/Flags.scala.html#39895" title="(flags: Long)String">flagsToString</a><span class="delimiter">(</span><a href="#361621" title="GenMSIL.this.global.Symbol">field</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.Symbol">owner</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47898" title="=&gt; Long">flags</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">var</span> <a title="ch.epfl.lamp.compiler.msil.FieldInfo" id="361625">fieldInfo</a> = <a href="../../symtab/clr/CLRTypes.scala.html#310652" title="=&gt; scala.collection.mutable.Map[GenMSIL.this.global.loaders.clrTypes.global.Symbol,ch.epfl.lamp.compiler.msil.FieldInfo]">fields</a>.<span title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)Option[ch.epfl.lamp.compiler.msil.FieldInfo]">get</span><span class="delimiter">(</span><a href="#361621" title="GenMSIL.this.global.Symbol">field</a><span class="delimiter">)</span> <span title="ch.epfl.lamp.compiler.msil.FieldInfo" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.FieldInfo">Some</span><span class="delimiter">(</span><a title="ch.epfl.lamp.compiler.msil.FieldInfo" id="361632">fInfo</a><span class="delimiter">)</span> =&gt; <a href="#361632" title="ch.epfl.lamp.compiler.msil.FieldInfo">fInfo</a>
          <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.FieldInfo">None</span> =&gt;
            <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.FieldInfo" id="361633">fInfo</a> = <a href="#357084" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#361621" title="GenMSIL.this.global.Symbol">field</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.Symbol">owner</a><span class="delimiter">)</span>.<span title="(x$1: String)ch.epfl.lamp.compiler.msil.FieldInfo">GetField</span><span class="delimiter">(</span><a href="#357069" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#361621" title="GenMSIL.this.global.Symbol">field</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="../../symtab/clr/CLRTypes.scala.html#310652" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol, value: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">fields</a><span class="delimiter">(</span><a href="#361621" title="GenMSIL.this.global.Symbol">field</a><span class="delimiter">)</span> = <a href="#361633" title="ch.epfl.lamp.compiler.msil.FieldInfo">fInfo</a>
            <a href="#361633" title="ch.epfl.lamp.compiler.msil.FieldInfo">fInfo</a>
        <span class="delimiter">}</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#361625" title="ch.epfl.lamp.compiler.msil.FieldInfo">fieldInfo</a>.<span title="()Boolean">IsVolatile</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Volatile</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#361625" title="ch.epfl.lamp.compiler.msil.FieldInfo">fieldInfo</a>.<span title="()Boolean">IsLiteral</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#361624" title="Boolean">loadAddr</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">Emit</span><span class="delimiter">(</span><span title="ch.epfl.lamp.compiler.msil.emit.OpCode" class="keyword">if</span> <span class="delimiter">(</span><a href="#361622" title="Boolean">isStatic</a><span class="delimiter">)</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldsflda</span> <span class="keyword">else</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldflda</span>, <a href="#361625" title="ch.epfl.lamp.compiler.msil.FieldInfo">fieldInfo</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
            <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">Emit</span><span class="delimiter">(</span><span title="ch.epfl.lamp.compiler.msil.emit.OpCode" class="keyword">if</span> <span class="delimiter">(</span><a href="#361622" title="Boolean">isStatic</a><span class="delimiter">)</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldsfld</span> <span class="keyword">else</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldfld</span>, <a href="#361625" title="ch.epfl.lamp.compiler.msil.FieldInfo">fieldInfo</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#361624" title="Boolean">loadAddr</a>, <span title="String(&quot;can\'t take AddressOf a literal field (not even with readonly. prefix) because no memory was allocated to such field ...&quot;)" class="string">&quot;can't take AddressOf a literal field (not even with readonly. prefix) because no memory was allocated to such field ...&quot;</span><span class="delimiter">)</span>
          // TODO the above can be overcome by loading the value, boxing, and finally unboxing. An address to a copy of the raw value will be on the stack.
         /*  We perform `field inlining' as required by CLR.
          *  Emit as for a CONSTANT ICode stmt, with the twist that the constant value is available
          *  as a java.lang.Object and its .NET type allows constant initialization in CLR, i.e. that type
          *  is one of I1, I2, I4, I8, R4, R8, CHAR, BOOLEAN, STRING, or CLASS (in this last case,
          *  only accepting nullref as value). See Table 9-1 in Lidin's book on ILAsm. */
          <span class="keyword">val</span> <a title="Object" id="361648">value</a> = <a href="#361625" title="ch.epfl.lamp.compiler.msil.FieldInfo">fieldInfo</a>.<span title="()Object">getValue</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#361648" title="Object">value</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldnull</span><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="361657">typ</a> = <span title="ch.epfl.lamp.compiler.msil.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="#361625" title="ch.epfl.lamp.compiler.msil.FieldInfo">fieldInfo</a>.<span title="ch.epfl.lamp.compiler.msil.Type">FieldType</span>.<span title="()Boolean">IsEnum</span><span class="delimiter">)</span> <a href="#361625" title="ch.epfl.lamp.compiler.msil.FieldInfo">fieldInfo</a>.<span title="ch.epfl.lamp.compiler.msil.Type">FieldType</span>.<span title="()ch.epfl.lamp.compiler.msil.Type">getUnderlyingType</span>
                      <span class="keyword">else</span> <a href="#361625" title="ch.epfl.lamp.compiler.msil.FieldInfo">fieldInfo</a>.<span title="ch.epfl.lamp.compiler.msil.Type">FieldType</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#361657" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310622" title="=&gt; ch.epfl.lamp.compiler.msil.Type">STRING</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: String)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldstr</span>, <a href="#361648" title="Object">value</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="String" class="delimiter">[</span><span title="String">String</span><span class="delimiter">]</span><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#361657" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310607" title="=&gt; ch.epfl.lamp.compiler.msil.Type">BOOLEAN</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="ch.epfl.lamp.compiler.msil.emit.OpCode" class="keyword">if</span> <span class="delimiter">(</span><a href="#361648" title="Object">value</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Boolean" class="delimiter">[</span><span title="Boolean">Boolean</span><span class="delimiter">]</span><span class="delimiter">)</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_1</span>
                           <span class="keyword">else</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_0</span><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#361657" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310574" title="=&gt; ch.epfl.lamp.compiler.msil.Type">BYTE</a> <span title="(x: Boolean)Boolean">||</span> <a href="#361657" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310577" title="=&gt; ch.epfl.lamp.compiler.msil.Type">UBYTE</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#357061" title="(value: Int, code: ch.epfl.lamp.compiler.msil.emit.ILGenerator)Unit">loadI4</a><span class="delimiter">(</span><a href="#361648" title="Object">value</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="=&gt; Int" class="delimiter">[</span><span title="Byte">Byte</span><span class="delimiter">]</span>, <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#361657" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310580" title="=&gt; ch.epfl.lamp.compiler.msil.Type">SHORT</a> <span title="(x: Boolean)Boolean">||</span> <a href="#361657" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310583" title="=&gt; ch.epfl.lamp.compiler.msil.Type">USHORT</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#357061" title="(value: Int, code: ch.epfl.lamp.compiler.msil.emit.ILGenerator)Unit">loadI4</a><span class="delimiter">(</span><a href="#361648" title="Object">value</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Int" class="delimiter">[</span><span title="Int">Int</span><span class="delimiter">]</span>, <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#361657" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310586" title="=&gt; ch.epfl.lamp.compiler.msil.Type">CHAR</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#357061" title="(value: Int, code: ch.epfl.lamp.compiler.msil.emit.ILGenerator)Unit">loadI4</a><span class="delimiter">(</span><a href="#361648" title="Object">value</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="=&gt; Int" class="delimiter">[</span><span title="Char">Char</span><span class="delimiter">]</span>, <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#361657" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310589" title="=&gt; ch.epfl.lamp.compiler.msil.Type">INT</a> <span title="(x: Boolean)Boolean">||</span> <a href="#361657" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310592" title="=&gt; ch.epfl.lamp.compiler.msil.Type">UINT</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#357061" title="(value: Int, code: ch.epfl.lamp.compiler.msil.emit.ILGenerator)Unit">loadI4</a><span class="delimiter">(</span><a href="#361648" title="Object">value</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Int" class="delimiter">[</span><span title="Int">Int</span><span class="delimiter">]</span>, <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#361657" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310595" title="=&gt; ch.epfl.lamp.compiler.msil.Type">LONG</a> <span title="(x: Boolean)Boolean">||</span> <a href="#361657" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310598" title="=&gt; ch.epfl.lamp.compiler.msil.Type">ULONG</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Long)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I8</span>, <a href="#361648" title="Object">value</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Long" class="delimiter">[</span><span title="Long">Long</span><span class="delimiter">]</span><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#361657" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310601" title="=&gt; ch.epfl.lamp.compiler.msil.Type">FLOAT</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Float)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_R4</span>, <a href="#361648" title="Object">value</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Float" class="delimiter">[</span><span title="Float">Float</span><span class="delimiter">]</span><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#361657" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310604" title="=&gt; ch.epfl.lamp.compiler.msil.Type">DOUBLE</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Double)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_R8</span>, <a href="#361648" title="Object">value</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Double" class="delimiter">[</span><span title="Double">Double</span><span class="delimiter">]</span><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
              /* TODO one more case is described in Partition II, 16.2: bytearray(...) */
              <a href="../../Global.scala.html#182892" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="String(&quot;Unknown type for static literal field: &quot;)" class="string">&quot;Unknown type for static literal field: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#361625" title="ch.epfl.lamp.compiler.msil.FieldInfo">fieldInfo</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      /** Creating objects works differently on .NET. On the JVM
       *  - NEW(type) =&gt; reference on Stack
       *  - DUP, load arguments, CALL_METHOD(constructor)
       *
       * On .NET, the NEW and DUP are ignored, but we emit a special method call
       *  - load arguments
       *  - NewObj(constructor) =&gt; reference on stack
       *
       * This variable tells whether the previous instruction was a NEW,
       * we expect a DUP which is not emitted. */
      <span class="keyword">var</span> <a title="Boolean" id="361434">previousWasNEW</a> = <span title="Boolean(false)" class="keyword">false</span>

      <span class="keyword">var</span> <a title="Int" id="361435">lastLineNr</a>: <span title="Int">Int</span> = <span title="Int(0)" class="int">0</span>
      <span class="keyword">var</span> <a title="GenMSIL.this.global.Position" id="361436">lastPos</a>: <a href="../../util/Position.scala.html#34604" title="GenMSIL.this.global.Position">Position</a> = <a href="../../symtab/Positions.scala.html#183210" title="=&gt; tools.nsc.util.NoPosition.type">NoPosition</a>


      // EndExceptionBlock must happen before MarkLabel because it adds the
      // Leave instruction. Otherwise, labels(block) points to the Leave
      // (inside the catch) instead of the instruction afterwards.
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="List[GenMSIL.this.global.icodes.ExceptionHandler]" id="361740">handlers</a> &lt;- <a href="#357038" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,List[GenMSIL.this.global.icodes.ExceptionHandler]]">endExBlock</a>.<span title="(key: GenMSIL.this.global.icodes.BasicBlock)Option[List[GenMSIL.this.global.icodes.ExceptionHandler]]">get</span><span title="(f: List[GenMSIL.this.global.icodes.ExceptionHandler] =&gt; Unit)Unit" class="delimiter">(</span><a href="#360842" title="GenMSIL.this.global.icodes.BasicBlock">block</a><span class="delimiter">)</span>; <a title="GenMSIL.this.global.icodes.ExceptionHandler" id="361760">exh</a> &lt;- <a href="#361740" title="(f: GenMSIL.this.global.icodes.ExceptionHandler =&gt; Unit)Unit">handlers</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#357041" title="=&gt; scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">currentHandlers</a>.<span title="()GenMSIL.this.global.icodes.ExceptionHandler">pop</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="keyword">for</span> <span class="delimiter">(</span><a title="ch.epfl.lamp.compiler.msil.emit.Label" id="361768">l</a> &lt;- <a href="#357056" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.ExceptionHandler,ch.epfl.lamp.compiler.msil.emit.Label]">endFinallyLabels</a>.<span title="(key: GenMSIL.this.global.icodes.ExceptionHandler)Option[ch.epfl.lamp.compiler.msil.emit.Label]">get</span><span title="(f: ch.epfl.lamp.compiler.msil.emit.Label =&gt; Unit)Unit" class="delimiter">(</span><a href="#361760" title="GenMSIL.this.global.icodes.ExceptionHandler">exh</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">MarkLabel</span><span class="delimiter">(</span><a href="#361768" title="ch.epfl.lamp.compiler.msil.emit.Label">l</a><span class="delimiter">)</span>
        <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="()Unit">EndExceptionBlock</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">MarkLabel</span><span class="delimiter">(</span><a href="#357027" title="(key: GenMSIL.this.global.icodes.BasicBlock)ch.epfl.lamp.compiler.msil.emit.Label">labels</a><span class="delimiter">(</span><a href="#360842" title="GenMSIL.this.global.icodes.BasicBlock">block</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="../../Global.scala.html#182894" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;Generating code for block: &quot;)" class="string">&quot;Generating code for block: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#360842" title="GenMSIL.this.global.icodes.BasicBlock">block</a><span class="delimiter">)</span>

      <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.ExceptionHandler" id="361810">handler</a> &lt;- <a href="#357036" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,GenMSIL.this.global.icodes.ExceptionHandler]">beginCatchBlock</a>.<span title="(key: GenMSIL.this.global.icodes.BasicBlock)Option[GenMSIL.this.global.icodes.ExceptionHandler]">get</span><span title="(f: GenMSIL.this.global.icodes.ExceptionHandler =&gt; Unit)Unit" class="delimiter">(</span><a href="#360842" title="GenMSIL.this.global.icodes.BasicBlock">block</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#357041" title="=&gt; scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">currentHandlers</a>.<span title="=&gt; Boolean">isEmpty</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#357041" title="=&gt; scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">currentHandlers</a>.<span title="=&gt; GenMSIL.this.global.icodes.ExceptionHandler">top</span>.<a href="../icode/ExceptionHandlers.scala.html#312852" title="=&gt; scala.collection.immutable.Set[GenMSIL.this.global.icodes.BasicBlock]">covered</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#361810" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a>.<a href="../icode/ExceptionHandlers.scala.html#312852" title="=&gt; scala.collection.immutable.Set[GenMSIL.this.global.icodes.BasicBlock]">covered</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#357041" title="=&gt; scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">currentHandlers</a>.<span title="()GenMSIL.this.global.icodes.ExceptionHandler">pop</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#357041" title="=&gt; scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">currentHandlers</a>.<span title="(elem: GenMSIL.this.global.icodes.ExceptionHandler)scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">push</span><span class="delimiter">(</span><a href="#361810" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#361810" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a>.<a href="../icode/ExceptionHandlers.scala.html#312835" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">cls</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../../reflect/internal/Symbols.scala.html#40013" title="object GenMSIL.this.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          // `finally` blocks are represented the same as `catch`, but with no catch-type
          <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="()Unit">BeginFinallyBlock</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="361883">t</a> = <a href="#357084" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#361810" title="GenMSIL.this.global.icodes.ExceptionHandler">handler</a>.<a href="../icode/ExceptionHandlers.scala.html#312835" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">cls</a><span class="delimiter">)</span>
          <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(exceptionType: ch.epfl.lamp.compiler.msil.Type)Unit">BeginCatchBlock</span><span class="delimiter">(</span><a href="#361883" title="ch.epfl.lamp.compiler.msil.Type">t</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="List[GenMSIL.this.global.icodes.ExceptionHandler]" id="361892">handlers</a> &lt;- <a href="#357034" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.BasicBlock,List[GenMSIL.this.global.icodes.ExceptionHandler]]">beginExBlock</a>.<span title="(key: GenMSIL.this.global.icodes.BasicBlock)Option[List[GenMSIL.this.global.icodes.ExceptionHandler]]">get</span><span title="(f: List[GenMSIL.this.global.icodes.ExceptionHandler] =&gt; Unit)Unit" class="delimiter">(</span><a href="#360842" title="GenMSIL.this.global.icodes.BasicBlock">block</a><span class="delimiter">)</span>; <a title="GenMSIL.this.global.icodes.ExceptionHandler" id="361912">exh</a> &lt;- <a href="#361892" title="(f: GenMSIL.this.global.icodes.ExceptionHandler =&gt; Unit)Unit">handlers</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#357041" title="=&gt; scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">currentHandlers</a>.<span title="(elem: GenMSIL.this.global.icodes.ExceptionHandler)scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">push</span><span class="delimiter">(</span><a href="#361912" title="GenMSIL.this.global.icodes.ExceptionHandler">exh</a><span class="delimiter">)</span>
        <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="()Unit">BeginExceptionBlock</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.Instruction" id="361921">instr</a> &lt;- <a href="../icode/BasicBlocks.scala.html#312548" title="(f: GenMSIL.this.global.icodes.Instruction =&gt; Unit)Unit">block</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">try</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="Int" id="361922">currentLineNr</a> = <a href="#361921" title="GenMSIL.this.global.icodes.Instruction">instr</a>.<a href="../icode/Opcodes.scala.html#313078" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../../util/Position.scala.html#183814" title="=&gt; Int">line</a>
          <span class="keyword">val</span> <a title="Boolean" id="361923">skip</a> = <span title="Boolean" class="keyword">if</span><span class="delimiter">(</span><a href="#361921" title="GenMSIL.this.global.icodes.Instruction">instr</a>.<a href="../icode/Opcodes.scala.html#313078" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../../util/Position.scala.html#183790" title="=&gt; Boolean">isRange</a><span class="delimiter">)</span> <a href="#361921" title="GenMSIL.this.global.icodes.Instruction">instr</a>.<a href="../icode/Opcodes.scala.html#313078" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../../util/Position.scala.html#183813" title="(pos: scala.tools.nsc.util.Position)Boolean">sameRange</a><span class="delimiter">(</span><a href="#361436" title="GenMSIL.this.global.Position">lastPos</a><span class="delimiter">)</span> <span class="keyword">else</span> <span class="delimiter">(</span><a href="#361922" title="Int">currentLineNr</a> <span title="(x: Int)Boolean">==</span> <a href="#361435" title="Int">lastLineNr</a><span class="delimiter">)</span>;
          <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#361923" title="Boolean">skip</a> <span title="(x: Boolean)Boolean">||</span> <span title="=&gt; Boolean">!</span><a href="#357030" title="=&gt; Boolean">dbFilenameSeen</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="String" id="361941">fileName</a> = <span title="String" class="keyword">if</span><span class="delimiter">(</span><a href="#357030" title="=&gt; Boolean">dbFilenameSeen</a><span class="delimiter">)</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span> <span class="keyword">else</span> <span class="delimiter">{</span><a href="#357030" title="(x$1: Boolean)Unit">dbFilenameSeen</a> = <span title="Boolean(true)" class="keyword">true</span>; <a href="#357022" title="(iclass: GenMSIL.this.global.icodes.IClass)String">ilasmFileName</a><span class="delimiter">(</span><a href="#356987" title="=&gt; GenMSIL.this.global.icodes.IClass">clasz</a><span class="delimiter">)</span><span class="delimiter">}</span>;
            <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#361921" title="GenMSIL.this.global.icodes.Instruction">instr</a>.<a href="../icode/Opcodes.scala.html#313078" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../../util/Position.scala.html#183790" title="=&gt; Boolean">isRange</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="keyword">val</span> <a title="Int" id="361942">startLine</a> = <a href="#361921" title="GenMSIL.this.global.icodes.Instruction">instr</a>.<a href="../icode/Opcodes.scala.html#313078" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../../util/Position.scala.html#183805" title="=&gt; scala.tools.nsc.util.Position">focusStart</a>.<a href="../../util/Position.scala.html#183814" title="=&gt; Int">line</a>
              <span class="keyword">val</span> <a title="Int" id="361943">endLine</a>   = <a href="#361921" title="GenMSIL.this.global.icodes.Instruction">instr</a>.<a href="../icode/Opcodes.scala.html#313078" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../../util/Position.scala.html#183807" title="=&gt; scala.tools.nsc.util.Position">focusEnd</a>.<a href="../../util/Position.scala.html#183814" title="=&gt; Int">line</a>
              <span class="keyword">val</span> <a title="Int" id="361944">startCol</a>  = <a href="#361921" title="GenMSIL.this.global.icodes.Instruction">instr</a>.<a href="../icode/Opcodes.scala.html#313078" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../../util/Position.scala.html#183805" title="=&gt; scala.tools.nsc.util.Position">focusStart</a>.<a href="../../util/Position.scala.html#183815" title="=&gt; Int">column</a>
              <span class="keyword">val</span> <a title="Int" id="361945">endCol</a>    = <a href="#361921" title="GenMSIL.this.global.icodes.Instruction">instr</a>.<a href="../icode/Opcodes.scala.html#313078" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../../util/Position.scala.html#183807" title="=&gt; scala.tools.nsc.util.Position">focusEnd</a>.<a href="../../util/Position.scala.html#183815" title="=&gt; Int">column</a>
              <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(startLine: Int, endLine: Int, startCol: Int, endCol: Int, filename: String)Unit">setPosition</span><span class="delimiter">(</span><a href="#361942" title="Int">startLine</a>, <a href="#361943" title="Int">endLine</a>, <a href="#361944" title="Int">startCol</a>, <a href="#361945" title="Int">endCol</a>, <a href="#361941" title="String">fileName</a><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
              <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(line: Int, filename: String)Unit">setPosition</span><span class="delimiter">(</span><a href="#361921" title="GenMSIL.this.global.icodes.Instruction">instr</a>.<a href="../icode/Opcodes.scala.html#313078" title="=&gt; scala.tools.nsc.util.Position">pos</a>.<a href="../../util/Position.scala.html#183814" title="=&gt; Int">line</a>, <a href="#361941" title="String">fileName</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            <a href="#361435" title="Int">lastLineNr</a> = <a href="#361922" title="Int">currentLineNr</a>
            <a href="#361436" title="GenMSIL.this.global.Position">lastPos</a> = <a href="#361921" title="GenMSIL.this.global.icodes.Instruction">instr</a>.<a href="../icode/Opcodes.scala.html#313078" title="=&gt; scala.tools.nsc.util.Position">pos</a>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span> <span class="keyword">case</span> <span title="Unit">_</span>: <span title="UnsupportedOperationException">UnsupportedOperationException</span> =&gt; <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">}</span>

        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#361434" title="Boolean">previousWasNEW</a><span class="delimiter">)</span>
          <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#361921" title="GenMSIL.this.global.icodes.Instruction">instr</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="../icode/Opcodes.scala.html#240983" title="GenMSIL.this.global.icodes.opcodes.DUP">DUP</a><span class="delimiter">]</span>, <a href="#360842" title="GenMSIL.this.global.icodes.BasicBlock">block</a><span class="delimiter">)</span>

        <a href="#361921" title="GenMSIL.this.global.icodes.Instruction">instr</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Unit">THIS</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="361961">clasz</a><span class="delimiter">)</span> =&gt;
            <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldarg_0</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">CONSTANT</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Constant" id="361965">const</a><span class="delimiter">)</span> =&gt;
            <a href="#361965" title="GenMSIL.this.global.icodes.global.Constant">const</a>.<a href="../../../../reflect/internal/Constants.scala.html#47580" title="=&gt; Int">tag</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <span title="Unit">UnitTag</span>    =&gt; <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">BooleanTag</span> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="ch.epfl.lamp.compiler.msil.emit.OpCode" class="keyword">if</span> <span class="delimiter">(</span><a href="#361965" title="GenMSIL.this.global.icodes.global.Constant">const</a>.<a href="../../../../reflect/internal/Constants.scala.html#47594" title="=&gt; Boolean">booleanValue</a><span class="delimiter">)</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_1</span>
                                            <span class="keyword">else</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_0</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">ByteTag</span>    =&gt; <a href="#357061" title="(value: Int, code: ch.epfl.lamp.compiler.msil.emit.ILGenerator)Unit">loadI4</a><span class="delimiter">(</span><a href="#361965" title="GenMSIL.this.global.icodes.global.Constant">const</a>.<a href="../../../../reflect/internal/Constants.scala.html#47595" title="=&gt; Int">byteValue</a>, <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">ShortTag</span>   =&gt; <a href="#357061" title="(value: Int, code: ch.epfl.lamp.compiler.msil.emit.ILGenerator)Unit">loadI4</a><span class="delimiter">(</span><a href="#361965" title="GenMSIL.this.global.icodes.global.Constant">const</a>.<a href="../../../../reflect/internal/Constants.scala.html#47596" title="=&gt; Int">shortValue</a>, <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">CharTag</span>    =&gt; <a href="#357061" title="(value: Int, code: ch.epfl.lamp.compiler.msil.emit.ILGenerator)Unit">loadI4</a><span class="delimiter">(</span><a href="#361965" title="GenMSIL.this.global.icodes.global.Constant">const</a>.<a href="../../../../reflect/internal/Constants.scala.html#47597" title="=&gt; Int">charValue</a>, <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">IntTag</span>     =&gt; <a href="#357061" title="(value: Int, code: ch.epfl.lamp.compiler.msil.emit.ILGenerator)Unit">loadI4</a><span class="delimiter">(</span><a href="#361965" title="GenMSIL.this.global.icodes.global.Constant">const</a>.<a href="../../../../reflect/internal/Constants.scala.html#47598" title="=&gt; Int">intValue</a>, <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">LongTag</span>    =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Long)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I8</span>, <a href="#361965" title="GenMSIL.this.global.icodes.global.Constant">const</a>.<a href="../../../../reflect/internal/Constants.scala.html#47599" title="=&gt; Long">longValue</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">FloatTag</span>   =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Float)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_R4</span>, <a href="#361965" title="GenMSIL.this.global.icodes.global.Constant">const</a>.<a href="../../../../reflect/internal/Constants.scala.html#47600" title="=&gt; Float">floatValue</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">DoubleTag</span>  =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Double)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_R8</span>, <a href="#361965" title="GenMSIL.this.global.icodes.global.Constant">const</a>.<a href="../../../../reflect/internal/Constants.scala.html#47601" title="=&gt; Double">doubleValue</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">StringTag</span>  =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: String)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldstr</span>, <a href="#361965" title="GenMSIL.this.global.icodes.global.Constant">const</a>.<a href="../../../../reflect/internal/Constants.scala.html#47603" title="=&gt; String">stringValue</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">NullTag</span>    =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldnull</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">ClassTag</span>   =&gt;
                <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.Type)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldtoken</span>, <a href="#357082" title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#361965" title="GenMSIL.this.global.icodes.global.Constant">const</a>.<a href="../../../../reflect/internal/Constants.scala.html#47606" title="=&gt; GenMSIL.this.global.icodes.global.Type">typeValue</a><span class="delimiter">)</span><span class="delimiter">)</span>
                <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#356947" title="=&gt; ch.epfl.lamp.compiler.msil.MethodInfo">TYPE_FROM_HANDLE</a><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Nothing">_</span>          =&gt; <a href="../../Global.scala.html#182892" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="String(&quot;Unknown constant value: &quot;)" class="string">&quot;Unknown constant value: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#361965" title="GenMSIL.this.global.icodes.global.Constant">const</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>

          <span class="keyword">case</span> <span title="Unit">LOAD_ARRAY_ITEM</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="362003">kind</a><span class="delimiter">)</span> =&gt;
            <span class="delimiter">(</span><a href="#362003" title="GenMSIL.this.global.icodes.TypeKind">kind</a>: @<a href="../icode/TypeKinds.scala.html#228959" title="GenMSIL.this.global.icodes.TypeKind @unchecked">unchecked</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228967" title="Unit">BOOL</a>           =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldelem_I1</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228969" title="Unit">BYTE</a>           =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldelem_I1</span><span class="delimiter">)</span> // I1 for System.SByte, i.e. a scala.Byte
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228971" title="Unit">SHORT</a>          =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldelem_I2</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228973" title="Unit">CHAR</a>           =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldelem_U2</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228975" title="Unit">INT</a>            =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldelem_I4</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228977" title="Unit">LONG</a>           =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldelem_I8</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228979" title="Unit">FLOAT</a>          =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldelem_R4</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228981" title="Unit">DOUBLE</a>         =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldelem_R8</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">REFERENCE</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="362021">cls</a><span class="delimiter">)</span> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldelem_Ref</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">ARRAY</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="362025">elem</a><span class="delimiter">)</span>    =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldelem_Ref</span><span class="delimiter">)</span>

              // case UNIT is not possible: an Array[Unit] will be an
              //  Array[scala.runtime.BoxedUnit] (-&gt; case REFERENCE)
            <span class="delimiter">}</span>

          <span class="keyword">case</span> <span title="Unit">LOAD_LOCAL</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.Local" id="362029">local</a><span class="delimiter">)</span> =&gt; <a href="#361432" title="(local: GenMSIL.this.global.icodes.Local, msg: String, loadAddr: Boolean)Unit">loadLocalOrAddress</a><span class="delimiter">(</span><a href="#362029" title="GenMSIL.this.global.icodes.Local">local</a>, <span title="String(&quot;load_local&quot;)" class="string">&quot;load_local&quot;</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">CIL_LOAD_LOCAL_ADDRESS</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.Local" id="362031">local</a><span class="delimiter">)</span> =&gt; <a href="#361432" title="(local: GenMSIL.this.global.icodes.Local, msg: String, loadAddr: Boolean)Unit">loadLocalOrAddress</a><span class="delimiter">(</span><a href="#362031" title="GenMSIL.this.global.icodes.Local">local</a>, <span title="String(&quot;cil_load_local_address&quot;)" class="string">&quot;cil_load_local_address&quot;</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">LOAD_FIELD</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="362034">field</a>, <a title="Boolean" id="362035">isStatic</a><span class="delimiter">)</span> =&gt; <a href="#361433" title="(field: GenMSIL.this.global.Symbol, isStatic: Boolean, msg: String, loadAddr: Boolean)Unit">loadFieldOrAddress</a><span class="delimiter">(</span><a href="#362034" title="GenMSIL.this.global.icodes.global.Symbol">field</a>, <a href="#362035" title="Boolean">isStatic</a>, <span title="String(&quot;load_field&quot;)" class="string">&quot;load_field&quot;</span>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">CIL_LOAD_FIELD_ADDRESS</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="362038">field</a>, <a title="Boolean" id="362039">isStatic</a><span class="delimiter">)</span> =&gt; <a href="#361433" title="(field: GenMSIL.this.global.Symbol, isStatic: Boolean, msg: String, loadAddr: Boolean)Unit">loadFieldOrAddress</a><span class="delimiter">(</span><a href="#362038" title="GenMSIL.this.global.icodes.global.Symbol">field</a>, <a href="#362039" title="Boolean">isStatic</a>, <span title="String(&quot;cil_load_field_address&quot;)" class="string">&quot;cil_load_field_address&quot;</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">CIL_LOAD_ARRAY_ITEM_ADDRESS</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="362041">kind</a><span class="delimiter">)</span> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.Type)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldelema</span>, <a href="#357081" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#362041" title="GenMSIL.this.global.icodes.TypeKind">kind</a><span class="delimiter">)</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">CIL_NEWOBJ</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="362053">msym</a><span class="delimiter">)</span> =&gt;
            <span title="(assertion: Boolean)Unit">assert</span><span class="delimiter">(</span><a href="#362053" title="GenMSIL.this.global.icodes.global.Symbol">msym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47802" title="=&gt; Boolean">isClassConstructor</a><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.ConstructorInfo" id="362054">constructorInfo</a>: <span title="ch.epfl.lamp.compiler.msil.ConstructorInfo">ConstructorInfo</span> = <a href="#357108" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.ConstructorInfo">getConstructor</a><span class="delimiter">(</span><a href="#362053" title="GenMSIL.this.global.icodes.global.Symbol">msym</a><span class="delimiter">)</span>
            <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.ConstructorInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Newobj</span>, <a href="#362054" title="ch.epfl.lamp.compiler.msil.ConstructorInfo">constructorInfo</a><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">LOAD_MODULE</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="362064">module</a><span class="delimiter">)</span> =&gt;
            <a href="../../Global.scala.html#182894" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;Generating LOAD_MODULE for: &quot;)" class="string">&quot;Generating LOAD_MODULE for: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#357117" title="(sym: GenMSIL.this.global.Symbol)String">showsym</a><span class="delimiter">(</span><a href="#362064" title="GenMSIL.this.global.icodes.global.Symbol">module</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldsfld</span>, <a href="#357094" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.FieldInfo">getModuleInstanceField</a><span class="delimiter">(</span><a href="#362064" title="GenMSIL.this.global.icodes.global.Symbol">module</a><span class="delimiter">)</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">STORE_ARRAY_ITEM</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="362070">kind</a><span class="delimiter">)</span> =&gt;
            <span class="delimiter">(</span><a href="#362070" title="GenMSIL.this.global.icodes.TypeKind">kind</a>: @<a href="../icode/TypeKinds.scala.html#228959" title="GenMSIL.this.global.icodes.TypeKind @unchecked">unchecked</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228967" title="Unit">BOOL</a>           =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stelem_I1</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228969" title="Unit">BYTE</a>           =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stelem_I1</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228971" title="Unit">SHORT</a>          =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stelem_I2</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228973" title="Unit">CHAR</a>           =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stelem_I2</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228975" title="Unit">INT</a>            =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stelem_I4</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228977" title="Unit">LONG</a>           =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stelem_I8</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228979" title="Unit">FLOAT</a>          =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stelem_R4</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228981" title="Unit">DOUBLE</a>         =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stelem_R8</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">REFERENCE</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="362088">cls</a><span class="delimiter">)</span> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stelem_Ref</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="Unit">ARRAY</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="362092">elem</a><span class="delimiter">)</span>    =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stelem_Ref</span><span class="delimiter">)</span> // @TODO: test this! (occurs when calling a Array[Object]* vararg param method)

              // case UNIT not possible (see comment at LOAD_ARRAY_ITEM)
            <span class="delimiter">}</span>

          <span class="keyword">case</span> <span title="Unit">STORE_LOCAL</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.Local" id="362096">local</a><span class="delimiter">)</span> =&gt;
            <span class="keyword">val</span> <a title="Boolean" id="362097">isArg</a> = <a href="#362096" title="GenMSIL.this.global.icodes.Local">local</a>.<a href="../icode/Members.scala.html#313051" title="=&gt; Boolean">arg</a>
            <span class="keyword">val</span> <a title="Int" id="362098">i</a> = <a href="#362096" title="GenMSIL.this.global.icodes.Local">local</a>.<a href="../icode/Members.scala.html#313054" title="=&gt; Int">index</a>
            <a href="../../Global.scala.html#182894" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;store_local for &quot;)" class="string">&quot;store_local for &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#362096" title="GenMSIL.this.global.icodes.Local">local</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;, index &quot;)" class="string">&quot;, index &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#362098" title="Int">i</a><span class="delimiter">)</span>

            // there are some locals defined by the compiler that
            // are isArg and are need to be stored.
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#362097" title="Boolean">isArg</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#362098" title="Int">i</a> <span title="(x: Int)Boolean">&gt;=</span> -<span title="Int(-128)" class="int">128</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#362098" title="Int">i</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(127)" class="int">127</span><span class="delimiter">)</span>
                <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Int)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Starg_S</span>, <a href="#362098" title="Int">i</a><span class="delimiter">)</span>
              <span class="keyword">else</span>
                <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Int)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Starg</span>, <a href="#362098" title="Int">i</a><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
              <a href="#362098" title="Int">i</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <span title="Unit" class="int">0</span> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stloc_0</span><span class="delimiter">)</span>
                <span class="keyword">case</span> <span title="Unit" class="int">1</span> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stloc_1</span><span class="delimiter">)</span>
                <span class="keyword">case</span> <span title="Unit" class="int">2</span> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stloc_2</span><span class="delimiter">)</span>
                <span class="keyword">case</span> <span title="Unit" class="int">3</span> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stloc_3</span><span class="delimiter">)</span>
                <span class="keyword">case</span> <span title="Unit">_</span>      =&gt;
                  <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#362098" title="Int">i</a> <span title="(x: Int)Boolean">&gt;=</span> -<span title="Int(-128)" class="int">128</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#362098" title="Int">i</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(127)" class="int">127</span><span class="delimiter">)</span>
                    <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.emit.LocalBuilder)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stloc_S</span>, <a href="#357078" title="(key: GenMSIL.this.global.icodes.Local)ch.epfl.lamp.compiler.msil.emit.LocalBuilder">localBuilders</a><span class="delimiter">(</span><a href="#362096" title="GenMSIL.this.global.icodes.Local">local</a><span class="delimiter">)</span><span class="delimiter">)</span>
                  <span class="keyword">else</span>
                    <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.emit.LocalBuilder)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stloc</span>, <a href="#357078" title="(key: GenMSIL.this.global.icodes.Local)ch.epfl.lamp.compiler.msil.emit.LocalBuilder">localBuilders</a><span class="delimiter">(</span><a href="#362096" title="GenMSIL.this.global.icodes.Local">local</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>

          <span class="keyword">case</span> <span title="Unit">STORE_THIS</span><span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;
            // this only works for impl classes because the self parameter comes first
            // in the method signature. If that changes, this code has to be revisited.
            <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Int)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Starg_S</span>, <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">STORE_FIELD</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="362184">field</a>, <a title="Boolean" id="362185">isStatic</a><span class="delimiter">)</span> =&gt;
            <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.FieldInfo" id="362186">fieldInfo</a> = <a href="../../symtab/clr/CLRTypes.scala.html#310652" title="=&gt; scala.collection.mutable.Map[GenMSIL.this.global.loaders.clrTypes.global.Symbol,ch.epfl.lamp.compiler.msil.FieldInfo]">fields</a>.<span title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)Option[ch.epfl.lamp.compiler.msil.FieldInfo]">get</span><span class="delimiter">(</span><a href="#362184" title="GenMSIL.this.global.icodes.global.Symbol">field</a><span class="delimiter">)</span> <span title="ch.epfl.lamp.compiler.msil.FieldInfo" class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.FieldInfo">Some</span><span class="delimiter">(</span><a title="ch.epfl.lamp.compiler.msil.FieldInfo" id="362190">fInfo</a><span class="delimiter">)</span> =&gt; <a href="#362190" title="ch.epfl.lamp.compiler.msil.FieldInfo">fInfo</a>
              <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.FieldInfo">None</span> =&gt;
                <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.FieldInfo" id="362191">fInfo</a> = <a href="#357084" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#362184" title="GenMSIL.this.global.icodes.global.Symbol">field</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">owner</a><span class="delimiter">)</span>.<span title="(x$1: String)ch.epfl.lamp.compiler.msil.FieldInfo">GetField</span><span class="delimiter">(</span><a href="#357069" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#362184" title="GenMSIL.this.global.icodes.global.Symbol">field</a><span class="delimiter">)</span><span class="delimiter">)</span>
                <a href="../../symtab/clr/CLRTypes.scala.html#310652" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol, value: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">fields</a><span class="delimiter">(</span><a href="#362184" title="GenMSIL.this.global.icodes.global.Symbol">field</a><span class="delimiter">)</span> = <a href="#362191" title="ch.epfl.lamp.compiler.msil.FieldInfo">fInfo</a>
                <a href="#362191" title="ch.epfl.lamp.compiler.msil.FieldInfo">fInfo</a>
            <span class="delimiter">}</span>
            <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">Emit</span><span class="delimiter">(</span><span title="ch.epfl.lamp.compiler.msil.emit.OpCode" class="keyword">if</span> <span class="delimiter">(</span><a href="#362185" title="Boolean">isStatic</a><span class="delimiter">)</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stsfld</span> <span class="keyword">else</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stfld</span>, <a href="#362186" title="ch.epfl.lamp.compiler.msil.FieldInfo">fieldInfo</a><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">CALL_PRIMITIVE</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.Primitive" id="362199">primitive</a><span class="delimiter">)</span> =&gt;
            <a href="#357060" title="(primitive: GenMSIL.this.global.icodes.Primitive, pos: GenMSIL.this.global.Position)Unit">genPrimitive</a><span class="delimiter">(</span><a href="#362199" title="GenMSIL.this.global.icodes.Primitive">primitive</a>, <a href="#361921" title="GenMSIL.this.global.icodes.Instruction">instr</a>.<a href="../icode/Opcodes.scala.html#313078" title="=&gt; scala.tools.nsc.util.Position">pos</a><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">CALL_METHOD</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="362205">msym</a>, <a title="GenMSIL.this.global.icodes.opcodes.InvokeStyle" id="362206">style</a><span class="delimiter">)</span> =&gt;
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#362205" title="GenMSIL.this.global.icodes.global.Symbol">msym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47802" title="=&gt; Boolean">isClassConstructor</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.ConstructorInfo" id="362207">constructorInfo</a>: <span title="ch.epfl.lamp.compiler.msil.ConstructorInfo">ConstructorInfo</span> = <a href="#357108" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.ConstructorInfo">getConstructor</a><span class="delimiter">(</span><a href="#362205" title="GenMSIL.this.global.icodes.global.Symbol">msym</a><span class="delimiter">)</span>
              <span class="delimiter">(</span><a href="#362206" title="GenMSIL.this.global.icodes.opcodes.InvokeStyle">style</a>: @<a href="../icode/Opcodes.scala.html#241001" title="GenMSIL.this.global.icodes.opcodes.InvokeStyle @unchecked">unchecked</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
                // normal constructor calls are Static..
                <span class="keyword">case</span> <span title="Unit">Static</span><span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;
                  <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#356990" title="=&gt; GenMSIL.this.global.icodes.IMethod">method</a>.<a href="../icode/Members.scala.html#312600" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47802" title="=&gt; Boolean">isClassConstructor</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#356990" title="=&gt; GenMSIL.this.global.icodes.IMethod">method</a>.<a href="../icode/Members.scala.html#312600" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">owner</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#362205" title="GenMSIL.this.global.icodes.global.Symbol">msym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">owner</a><span class="delimiter">)</span>
                    // we're generating a constructor (method: IMethod is a constructor), and we're
                    // calling another constructor of the same class.

                    // @LUC TODO: this can probably break, namely when having: class A { def this() { new A() } }
                    // instead, we should instruct the CALL_METHOD with additional information, know whether it's
                    // an instance creation constructor call or not.
                    <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.ConstructorInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#362207" title="ch.epfl.lamp.compiler.msil.ConstructorInfo">constructorInfo</a><span class="delimiter">)</span>
                  <span class="keyword">else</span>
                    <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.ConstructorInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Newobj</span>, <a href="#362207" title="ch.epfl.lamp.compiler.msil.ConstructorInfo">constructorInfo</a><span class="delimiter">)</span>
                <span class="keyword">case</span> <span title="Unit">SuperCall</span><span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;
                  <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.ConstructorInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#362207" title="ch.epfl.lamp.compiler.msil.ConstructorInfo">constructorInfo</a><span class="delimiter">)</span>
                  <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#357091" title="(sym: GenMSIL.this.global.Symbol)Boolean">isStaticModule</a><span class="delimiter">(</span><a href="#356987" title="=&gt; GenMSIL.this.global.icodes.IClass">clasz</a>.<a href="../icode/Members.scala.html#229219" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
                      <a href="#357076" title="=&gt; scala.collection.mutable.HashSet[GenMSIL.this.global.Symbol]">notInitializedModules</a>.<span title="(elem: GenMSIL.this.global.Symbol)Boolean">contains</span><span class="delimiter">(</span><a href="#356987" title="=&gt; GenMSIL.this.global.icodes.IClass">clasz</a>.<a href="../icode/Members.scala.html#229219" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
                      <a href="#356990" title="=&gt; GenMSIL.this.global.icodes.IMethod">method</a>.<a href="../icode/Members.scala.html#312600" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47802" title="=&gt; Boolean">isClassConstructor</a><span class="delimiter">)</span>
                    <span class="delimiter">{</span>
                      <a href="#357076" title="=&gt; scala.collection.mutable.HashSet[GenMSIL.this.global.Symbol]">notInitializedModules</a> <span title="(elem: GenMSIL.this.global.Symbol)BytecodeGenerator.this.notInitializedModules.type">-=</span> <a href="#356987" title="=&gt; GenMSIL.this.global.icodes.IClass">clasz</a>.<a href="../icode/Members.scala.html#229219" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>
                      <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldarg_0</span><span class="delimiter">)</span>
                      <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stsfld</span>, <a href="#357094" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.FieldInfo">getModuleInstanceField</a><span class="delimiter">(</span><a href="#356987" title="=&gt; GenMSIL.this.global.icodes.IClass">clasz</a>.<a href="../icode/Members.scala.html#229219" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a><span class="delimiter">)</span><span class="delimiter">)</span>
                    <span class="delimiter">}</span>
              <span class="delimiter">}</span>

            <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>

              <span class="keyword">var</span> <a title="Boolean" id="362253">doEmit</a> = <span title="Boolean(true)" class="keyword">true</span>
              <a href="#357085" title="(sym: GenMSIL.this.global.Symbol)Option[ch.epfl.lamp.compiler.msil.Type]">getTypeOpt</a><span class="delimiter">(</span><a href="#362205" title="GenMSIL.this.global.icodes.global.Symbol">msym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">owner</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="ch.epfl.lamp.compiler.msil.Type" id="362259">typ</a><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#362259" title="ch.epfl.lamp.compiler.msil.Type">typ</a>.<span title="()Boolean">IsEnum</span><span class="delimiter">)</span> =&gt; <span class="delimiter">{</span>
                  <span class="keyword">def</span> <a title="()Unit" id="362260">negBool</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
                    <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_0</span><span class="delimiter">)</span>
                    <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ceq</span><span class="delimiter">)</span>
                  <span class="delimiter">}</span>
                  <a href="#362253" title="Boolean">doEmit</a> = <span title="Boolean(false)" class="keyword">false</span>
                  <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.global.Name" id="362261">name</a> = <a href="#362205" title="GenMSIL.this.global.icodes.global.Symbol">msym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47883" title="=&gt; GenMSIL.this.global.icodes.global.Name">name</a>
                  <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#362261" title="GenMSIL.this.global.icodes.global.Name">name</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../../../reflect/internal/StdNames.scala.html#40560" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../../../reflect/internal/StdNames.scala.html#60455" title="=&gt; GenMSIL.this.global.TermName">EQ</a><span class="delimiter">)</span>       <span class="delimiter">{</span> <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ceq</span><span class="delimiter">)</span> <span class="delimiter">}</span>
                  <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#362261" title="GenMSIL.this.global.icodes.global.Name">name</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../../../reflect/internal/StdNames.scala.html#40560" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../../../reflect/internal/StdNames.scala.html#60479" title="=&gt; GenMSIL.this.global.TermName">NE</a><span class="delimiter">)</span>  <span class="delimiter">{</span> <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ceq</span><span class="delimiter">)</span>; <a href="#362260" title="()Unit">negBool</a> <span class="delimiter">}</span>
                  <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#362261" title="GenMSIL.this.global.icodes.global.Name">name</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../../../reflect/internal/StdNames.scala.html#40560" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../../../reflect/internal/StdNames.scala.html#60471" title="=&gt; GenMSIL.this.global.TermName">LT</a><span class="delimiter">)</span>  <span class="delimiter">{</span> <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Clt</span><span class="delimiter">)</span> <span class="delimiter">}</span>
                  <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#362261" title="GenMSIL.this.global.icodes.global.Name">name</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../../../reflect/internal/StdNames.scala.html#40560" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../../../reflect/internal/StdNames.scala.html#60465" title="=&gt; GenMSIL.this.global.TermName">LE</a><span class="delimiter">)</span>  <span class="delimiter">{</span> <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Cgt</span><span class="delimiter">)</span>; <a href="#362260" title="()Unit">negBool</a> <span class="delimiter">}</span>
                  <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#362261" title="GenMSIL.this.global.icodes.global.Name">name</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../../../reflect/internal/StdNames.scala.html#40560" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../../../reflect/internal/StdNames.scala.html#60461" title="=&gt; GenMSIL.this.global.TermName">GT</a><span class="delimiter">)</span>  <span class="delimiter">{</span> <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Cgt</span><span class="delimiter">)</span> <span class="delimiter">}</span>
                  <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#362261" title="GenMSIL.this.global.icodes.global.Name">name</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../../../reflect/internal/StdNames.scala.html#40560" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../../../reflect/internal/StdNames.scala.html#60459" title="=&gt; GenMSIL.this.global.TermName">GE</a><span class="delimiter">)</span>  <span class="delimiter">{</span> <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Clt</span><span class="delimiter">)</span>; <a href="#362260" title="()Unit">negBool</a> <span class="delimiter">}</span>
                  <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#362261" title="GenMSIL.this.global.icodes.global.Name">name</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../../../reflect/internal/StdNames.scala.html#40560" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../../../reflect/internal/StdNames.scala.html#60481" title="=&gt; GenMSIL.this.global.TermName">OR</a><span class="delimiter">)</span>  <span class="delimiter">{</span> <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Or</span><span class="delimiter">)</span> <span class="delimiter">}</span>
                  <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#362261" title="GenMSIL.this.global.icodes.global.Name">name</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../../../reflect/internal/StdNames.scala.html#40560" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../../../reflect/internal/StdNames.scala.html#60449" title="=&gt; GenMSIL.this.global.TermName">AND</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">And</span><span class="delimiter">)</span> <span class="delimiter">}</span>
                  <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#362261" title="GenMSIL.this.global.icodes.global.Name">name</a> <span title="(x$1: AnyRef)Boolean">eq</span> <a href="../../../../reflect/internal/StdNames.scala.html#40560" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../../../reflect/internal/StdNames.scala.html#60487" title="=&gt; GenMSIL.this.global.TermName">XOR</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Xor</span><span class="delimiter">)</span> <span class="delimiter">}</span>
                  <span class="keyword">else</span>
                    <a href="#362253" title="Boolean">doEmit</a> = <span title="Boolean(true)" class="keyword">true</span>
                <span class="delimiter">}</span>
                <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>

              // method: implicit view(FunctionX[PType0, PType1, ...,PTypeN, ResType]):DelegateType
              <span class="keyword">val</span> <a href="#362255" title="(Boolean, GenMSIL.this.global.Type, GenMSIL.this.global.Type)" class="delimiter">(</a><a href="#362254" title="Boolean" id="362255">isDelegateView</a>, <a href="#362254" title="GenMSIL.this.global.Type" id="362256">paramType</a>, <a href="#362254" title="GenMSIL.this.global.Type" id="362257">resType</a><span class="delimiter">)</span> = <a href="../../../../reflect/internal/SymbolTable.scala.html#36972" title="(ph: scala.reflect.internal.Phase)(op: =&gt; (Boolean, GenMSIL.this.global.Type, GenMSIL.this.global.Type))(Boolean, GenMSIL.this.global.Type, GenMSIL.this.global.Type)">atPhase</a><span class="delimiter">(</span><a href="../../Global.scala.html#183023" title="=&gt; GenMSIL.this.global.Run">currentRun</a>.<a href="../../Global.scala.html#185227" title="=&gt; scala.tools.nsc.Phase">typerPhase</a><span class="delimiter">)</span> <span title="(Boolean, GenMSIL.this.global.Type, GenMSIL.this.global.Type) @unchecked" class="delimiter">{</span>
                <a href="#362205" title="GenMSIL.this.global.icodes.global.Symbol">msym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.icodes.global.Type">tpe</a> <span title="(Boolean, GenMSIL.this.global.Type, GenMSIL.this.global.Type)" class="keyword">match</span> <span class="delimiter">{</span>
                  <span class="keyword">case</span> <span title="(Boolean, GenMSIL.this.global.Type, GenMSIL.this.global.Type)">MethodType</span><span class="delimiter">(</span><a title="List[GenMSIL.this.global.Symbol]" id="362290">params</a>, <a title="GenMSIL.this.global.Type" id="362291">resultType</a><span class="delimiter">)</span>
                  <span class="keyword">if</span> <span class="delimiter">(</span><a href="#362290" title="List[GenMSIL.this.global.Symbol]">params</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#362205" title="GenMSIL.this.global.icodes.global.Symbol">msym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47883" title="=&gt; GenMSIL.this.global.icodes.global.Name">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../../reflect/internal/StdNames.scala.html#40560" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../../../reflect/internal/StdNames.scala.html#60370" title="=&gt; GenMSIL.this.global.nme.NameType">view_</a><span class="delimiter">)</span> =&gt;
                    <span class="keyword">val</span> <a title="GenMSIL.this.global.Type" id="362302">paramType</a> = <a href="#362290" title="(n: Int)GenMSIL.this.global.Symbol">params</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.Type">tpe</a>
                    <span class="keyword">val</span> <a title="Boolean" id="362303">isDel</a> = <a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46580" title="(delegateType: GenMSIL.this.global.Type, functionType: GenMSIL.this.global.Type)Boolean">isCorrespondingDelegate</a><span class="delimiter">(</span><a href="#362291" title="GenMSIL.this.global.Type">resultType</a>, <a href="#362302" title="GenMSIL.this.global.Type">paramType</a><span class="delimiter">)</span>
                    <span title="(_1: Boolean, _2: GenMSIL.this.global.Type, _3: GenMSIL.this.global.Type)(Boolean, GenMSIL.this.global.Type, GenMSIL.this.global.Type)" class="delimiter">(</span><a href="#362303" title="Boolean">isDel</a>, <a href="#362302" title="GenMSIL.this.global.Type">paramType</a>, <a href="#362291" title="GenMSIL.this.global.Type">resultType</a><span class="delimiter">)</span>
                  <span class="keyword">case</span> <span title="(Boolean, Null, Null)">_</span> =&gt; <span title="(_1: Boolean, _2: Null, _3: Null)(Boolean, Null, Null)" class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span>, <span title="Null(null)" class="keyword">null</span>, <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
                <span class="delimiter">}</span>
              <span class="delimiter">}</span>
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#362253" title="Boolean">doEmit</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#362255" title="Boolean">isDelegateView</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="#362253" title="Boolean">doEmit</a> = <span title="Boolean(false)" class="keyword">false</span>
                <a href="#357105" title="(functionType: GenMSIL.this.global.Type, delegateType: GenMSIL.this.global.Type)Unit">createDelegateCaller</a><span class="delimiter">(</span><a href="#362256" title="GenMSIL.this.global.Type">paramType</a>, <a href="#362257" title="GenMSIL.this.global.Type">resType</a><span class="delimiter">)</span>
              <span class="delimiter">}</span>

              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#362253" title="Boolean">doEmit</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
                  <span class="delimiter">(</span><a href="#362205" title="GenMSIL.this.global.icodes.global.Symbol">msym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47883" title="=&gt; GenMSIL.this.global.icodes.global.Name">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../../reflect/internal/StdNames.scala.html#40560" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../../../reflect/internal/StdNames.scala.html#60483" title="=&gt; GenMSIL.this.global.TermName">PLUS</a> <span title="(x: Boolean)Boolean">||</span> <a href="#362205" title="GenMSIL.this.global.icodes.global.Symbol">msym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47883" title="=&gt; GenMSIL.this.global.icodes.global.Name">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../../reflect/internal/StdNames.scala.html#40560" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../../../reflect/internal/StdNames.scala.html#60473" title="=&gt; GenMSIL.this.global.TermName">MINUS</a><span class="delimiter">)</span>
                  <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310667" title="(t: ch.epfl.lamp.compiler.msil.Type)Boolean">isDelegateType</a><span class="delimiter">(</span><a href="#357082" title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#362205" title="GenMSIL.this.global.icodes.global.Symbol">msym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">owner</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.icodes.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="delimiter">{</span>
                <a href="#362253" title="Boolean">doEmit</a> = <span title="Boolean(false)" class="keyword">false</span>
                <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="363052">methodInfo</a>: <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span> = <a href="#357110" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.MethodInfo">getMethod</a><span class="delimiter">(</span><a href="#362205" title="GenMSIL.this.global.icodes.global.Symbol">msym</a><span class="delimiter">)</span>
                // call it as a static method, even if the compiler (symbol) thinks it's virtual
                <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#363052" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a><span class="delimiter">)</span>
                <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.Type)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Castclass</span>, <a href="#357082" title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#362205" title="GenMSIL.this.global.icodes.global.Symbol">msym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">owner</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.icodes.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>

              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#362253" title="Boolean">doEmit</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46575" title="=&gt; List[GenMSIL.this.global.Symbol]">Delegate_scalaCallers</a>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#362205" title="GenMSIL.this.global.icodes.global.Symbol">msym</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="#362253" title="Boolean">doEmit</a> = <span title="Boolean(false)" class="keyword">false</span>
                <span class="keyword">val</span> <a title="GenMSIL.this.global.Symbol" id="363068">methodSym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a> = <a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46578" title="(key: GenMSIL.this.global.Symbol)GenMSIL.this.global.Symbol">Delegate_scalaCallerTargets</a><span class="delimiter">(</span><a href="#362205" title="GenMSIL.this.global.icodes.global.Symbol">msym</a><span class="delimiter">)</span>
                <span class="keyword">val</span> <a title="GenMSIL.this.global.Type" id="363069">delegateType</a>: <a href="../../../../reflect/internal/Types.scala.html#40083" title="GenMSIL.this.global.Type">Type</a> = <a href="#362205" title="GenMSIL.this.global.icodes.global.Symbol">msym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.icodes.global.Type">tpe</a> <span title="GenMSIL.this.global.Type" class="keyword">match</span> <span class="delimiter">{</span>
                  <span class="keyword">case</span> <span title="GenMSIL.this.global.Type">MethodType</span><span class="delimiter">(</span>_, <a title="GenMSIL.this.global.Type" id="363105">retType</a><span class="delimiter">)</span> =&gt; <a href="#363105" title="GenMSIL.this.global.Type">retType</a>
                  <span class="keyword">case</span> <span title="Nothing">_</span> =&gt; <a href="../../Global.scala.html#182892" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="String(&quot;not a method type: &quot;)" class="string">&quot;not a method type: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#362205" title="GenMSIL.this.global.icodes.global.Symbol">msym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.icodes.global.Type">tpe</a><span class="delimiter">)</span>
                <span class="delimiter">}</span>
                <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="363070">methodInfo</a>: <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span> = <a href="#357110" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.MethodInfo">getMethod</a><span class="delimiter">(</span><a href="#363068" title="GenMSIL.this.global.Symbol">methodSym</a><span class="delimiter">)</span>
                <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.ConstructorInfo" id="363071">delegCtor</a> = <a href="#357082" title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#363069" title="GenMSIL.this.global.Type">delegateType</a><span class="delimiter">)</span>.<span title="(x$1: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.ConstructorInfo">GetConstructor</span><span class="delimiter">(</span><span title="(xs: ch.epfl.lamp.compiler.msil.Type*)(implicit evidence$2: scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type])Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span title="(clazz: Class[_])scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type]" class="delimiter">(</span><a href="../../symtab/clr/CLRTypes.scala.html#310619" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MOBJECT</a>, <a href="#356949" title="=&gt; ch.epfl.lamp.compiler.msil.Type">INT_PTR</a><span class="delimiter">)</span><span class="delimiter">)</span>
                <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#363068" title="GenMSIL.this.global.Symbol">methodSym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47857" title="=&gt; Boolean">isStatic</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                  <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldftn</span>, <a href="#363070" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a><span class="delimiter">)</span>
                <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
                  <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Dup</span><span class="delimiter">)</span>
                  <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldvirtftn</span>, <a href="#363070" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a><span class="delimiter">)</span>
                <span class="delimiter">}</span>
                <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.ConstructorInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Newobj</span>, <a href="#363071" title="ch.epfl.lamp.compiler.msil.ConstructorInfo">delegCtor</a><span class="delimiter">)</span>
              <span class="delimiter">}</span>

              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#362253" title="Boolean">doEmit</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="363152">methodInfo</a>: <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span> = <a href="#357110" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.MethodInfo">getMethod</a><span class="delimiter">(</span><a href="#362205" title="GenMSIL.this.global.icodes.global.Symbol">msym</a><span class="delimiter">)</span>
                <span class="delimiter">(</span><a href="#362206" title="GenMSIL.this.global.icodes.opcodes.InvokeStyle">style</a>: @<a href="../icode/Opcodes.scala.html#241001" title="GenMSIL.this.global.icodes.opcodes.InvokeStyle @unchecked">unchecked</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
                  <span class="keyword">case</span> <span title="Unit">SuperCall</span><span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;
                    <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#363152" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a><span class="delimiter">)</span>
                  <span class="keyword">case</span> <a href="../icode/Opcodes.scala.html#241002" title="Unit">Dynamic</a> =&gt;
                    // methodInfo.DeclaringType is null for global methods
                    <span class="keyword">val</span> <a title="Boolean" id="363158">isValuetypeMethod</a> = <span class="delimiter">(</span><a href="#363152" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a>.<span title="ch.epfl.lamp.compiler.msil.Type">DeclaringType</span> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span class="delimiter">(</span><a href="#363152" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a>.<span title="ch.epfl.lamp.compiler.msil.Type">DeclaringType</span>.<span title="()Boolean">IsValueType</span><span class="delimiter">)</span>
                    <span class="keyword">val</span> <a title="Boolean" id="363159">isValuetypeVirtualMethod</a> = <a href="#363158" title="Boolean">isValuetypeMethod</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span class="delimiter">(</span><a href="#363152" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a>.<span title="()Boolean">IsVirtual</span><span class="delimiter">)</span>
                    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#356983" title="(elem: GenMSIL.this.global.Symbol)Boolean">dynToStatMapped</a><span class="delimiter">(</span><a href="#362205" title="GenMSIL.this.global.icodes.global.Symbol">msym</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                      <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#363152" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a><span class="delimiter">)</span>
                    <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#363159" title="Boolean">isValuetypeVirtualMethod</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                      <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.Type)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Constrained</span>, <a href="#363152" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a>.<span title="ch.epfl.lamp.compiler.msil.Type">DeclaringType</span><span class="delimiter">)</span>
                      <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Callvirt</span>, <a href="#363152" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a><span class="delimiter">)</span>
                    <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#363158" title="Boolean">isValuetypeMethod</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                      // otherwise error &quot;Callvirt on a value type method&quot; ensues
                      <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#363152" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a><span class="delimiter">)</span>
                    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
                      <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Callvirt</span>, <a href="#363152" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a><span class="delimiter">)</span>
                    <span class="delimiter">}</span>
                  <span class="keyword">case</span> <span title="Unit">Static</span><span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;
                    <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#363152" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a>.<span title="()Boolean">IsVirtual</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="()Boolean">Ldarg0WasJustEmitted</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                      <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Callvirt</span>, <a href="#363152" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a><span class="delimiter">)</span>
                    <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#363152" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a><span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>
            <span class="delimiter">}</span>

          <span class="keyword">case</span> <span title="Unit">BOX</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="363208">boxType</a><span class="delimiter">)</span> =&gt;
            <a href="#357106" title="(code: ch.epfl.lamp.compiler.msil.emit.ILGenerator, boxType: GenMSIL.this.global.icodes.TypeKind)Unit">emitBox</a><span class="delimiter">(</span><a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>, <a href="#363208" title="GenMSIL.this.global.icodes.TypeKind">boxType</a><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">UNBOX</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="363210">boxType</a><span class="delimiter">)</span> =&gt;
            <a href="#357107" title="(code: ch.epfl.lamp.compiler.msil.emit.ILGenerator, boxType: GenMSIL.this.global.icodes.TypeKind)Unit">emitUnbox</a><span class="delimiter">(</span><a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>, <a href="#363210" title="GenMSIL.this.global.icodes.TypeKind">boxType</a><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">CIL_UNBOX</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="363212">boxType</a><span class="delimiter">)</span> =&gt;
            <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.Type)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Unbox</span>, <a href="#357081" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#363212" title="GenMSIL.this.global.icodes.TypeKind">boxType</a><span class="delimiter">)</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">CIL_INITOBJ</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="363224">valueType</a><span class="delimiter">)</span> =&gt;
            <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.Type)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Initobj</span>, <a href="#357081" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#363224" title="GenMSIL.this.global.icodes.TypeKind">valueType</a><span class="delimiter">)</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">NEW</span><span class="delimiter">(</span>REFERENCE<span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="363237">cls</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
            // the next instruction must be a DUP, see comment on `var previousWasNEW`
            <a href="#361434" title="Boolean">previousWasNEW</a> = <span title="Boolean(true)" class="keyword">true</span>

          // works also for arrays and reference-types
          <span class="keyword">case</span> <span title="Unit">CREATE_ARRAY</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="363240">elem</a>, <a title="Int" id="363241">dims</a><span class="delimiter">)</span> =&gt;
            // TODO: handle multi dimensional arrays
            <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#363241" title="Int">dims</a> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span>, <span title="String(&quot;Can\'t handle multi dimensional arrays&quot;)" class="string">&quot;Can't handle multi dimensional arrays&quot;</span><span class="delimiter">)</span>
            <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.Type)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Newarr</span>, <a href="#357081" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#363240" title="GenMSIL.this.global.icodes.TypeKind">elem</a><span class="delimiter">)</span><span class="delimiter">)</span>

          // works for arrays and reference-types
          <span class="keyword">case</span> <span title="Unit">IS_INSTANCE</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="363259">tpe</a><span class="delimiter">)</span> =&gt;
            <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.Type)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Isinst</span>, <a href="#357081" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#363259" title="GenMSIL.this.global.icodes.TypeKind">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldnull</span><span class="delimiter">)</span>
            <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ceq</span><span class="delimiter">)</span>
            <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_0</span><span class="delimiter">)</span>
            <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ceq</span><span class="delimiter">)</span>

          // works for arrays and reference-types
          // part from the scala reference: &quot;S &lt;: T does not imply
          //  Array[S] &lt;: Array[T] in Scala. However, it is possible
          //  to cast an array of S to an array of T if such a cast
          //  is permitted in the host environment.&quot;
          <span class="keyword">case</span> <span title="Unit">CHECK_CAST</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="363279">tpknd</a><span class="delimiter">)</span> =&gt;
            <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="363280">tMSIL</a> = <a href="#357081" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#363279" title="GenMSIL.this.global.icodes.TypeKind">tpknd</a><span class="delimiter">)</span>
              <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.Type)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Castclass</span>, <a href="#363280" title="ch.epfl.lamp.compiler.msil.Type">tMSIL</a><span class="delimiter">)</span>

          // no SWITCH is generated when there's
          //  - a default case (&quot;case _ =&gt; ...&quot;) in the matching expr
          //  - OR is used (&quot;case 1 | 2 =&gt; ...&quot;)
          <span class="keyword">case</span> <span title="Unit">SWITCH</span><span class="delimiter">(</span><a title="List[List[Int]]" id="363293">tags</a>, <a title="List[GenMSIL.this.global.icodes.BasicBlock]" id="363294">branches</a><span class="delimiter">)</span> =&gt;
            // tags is List[List[Int]]; a list of integers for every label.
            //    if the int on stack is 4, and 4 is in the second list =&gt; jump
            //    to second label
            // branches is List[BasicBlock]
            //    the labels to jump to (the last one is the default one)

            <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.LocalBuilder" id="363295">switchLocal</a> = <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(localType: ch.epfl.lamp.compiler.msil.Type)ch.epfl.lamp.compiler.msil.emit.LocalBuilder">DeclareLocal</span><span class="delimiter">(</span><a href="../../symtab/clr/CLRTypes.scala.html#310589" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MINT</a><span class="delimiter">)</span>
            // several switch variables will appear with the same name in the
            //  assembly code, but this makes no truble
            <a href="#363295" title="ch.epfl.lamp.compiler.msil.emit.LocalBuilder">switchLocal</a>.<span title="(name: String)Unit">SetLocalSymInfo</span><span class="delimiter">(</span><span title="String(&quot;$switch_var&quot;)" class="string">&quot;$switch_var&quot;</span><span class="delimiter">)</span>

            <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.emit.LocalBuilder)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stloc</span>, <a href="#363295" title="ch.epfl.lamp.compiler.msil.emit.LocalBuilder">switchLocal</a><span class="delimiter">)</span>
            <span class="keyword">var</span> <a title="Int" id="363296">i</a> = <span title="Int(0)" class="int">0</span>
            <span class="keyword">for</span> <span class="delimiter">(</span><a title="List[Int]" id="363321">l</a> &lt;- <a href="#363293" title="(f: List[Int] =&gt; Unit)Unit">tags</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="keyword">var</span> <a title="ch.epfl.lamp.compiler.msil.emit.Label" id="363322">targetLabel</a> = <a href="#357027" title="(key: GenMSIL.this.global.icodes.BasicBlock)ch.epfl.lamp.compiler.msil.emit.Label">labels</a><span class="delimiter">(</span><a href="#363294" title="(n: Int)GenMSIL.this.global.icodes.BasicBlock">branches</a><span class="delimiter">(</span><a href="#363296" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="keyword">for</span> <span class="delimiter">(</span><a title="Int" id="363368">i</a> &lt;- <a href="#363321" title="(f: Int =&gt; Unit)Unit">l</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.emit.LocalBuilder)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldloc</span>, <a href="#363295" title="ch.epfl.lamp.compiler.msil.emit.LocalBuilder">switchLocal</a><span class="delimiter">)</span>
                <a href="#357061" title="(value: Int, code: ch.epfl.lamp.compiler.msil.emit.ILGenerator)Unit">loadI4</a><span class="delimiter">(</span><a href="#363368" title="Int">i</a>, <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a><span class="delimiter">)</span>
                <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Beq</span>, <a href="#363322" title="ch.epfl.lamp.compiler.msil.emit.Label">targetLabel</a><span class="delimiter">)</span>
              <span class="delimiter">}</span>
              <a href="#363296" title="Int">i</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
            <span class="delimiter">}</span>
            <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.Label" id="363297">defaultTarget</a> = <a href="#357027" title="(key: GenMSIL.this.global.icodes.BasicBlock)ch.epfl.lamp.compiler.msil.emit.Label">labels</a><span class="delimiter">(</span><a href="#363294" title="(n: Int)GenMSIL.this.global.icodes.BasicBlock">branches</a><span class="delimiter">(</span><a href="#363296" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#360844" title="GenMSIL.this.global.icodes.BasicBlock">next</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#363294" title="(n: Int)GenMSIL.this.global.icodes.BasicBlock">branches</a><span class="delimiter">(</span><a href="#363296" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Br</span>, <a href="#363297" title="ch.epfl.lamp.compiler.msil.emit.Label">defaultTarget</a><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">JUMP</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.BasicBlock" id="363425">whereto</a><span class="delimiter">)</span> =&gt;
            <span class="keyword">val</span> <a href="#363427" title="(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label])" class="delimiter">(</a><a href="#363426" title="Boolean" id="363427">leaveHandler</a>, <a href="#363426" title="Boolean" id="363428">leaveFinally</a>, <a href="#363426" title="Option[ch.epfl.lamp.compiler.msil.emit.Label]" id="363429">lfTarget</a><span class="delimiter">)</span> = <a href="#357064" title="(from: GenMSIL.this.global.icodes.BasicBlock, to: GenMSIL.this.global.icodes.BasicBlock)(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label])">leavesHandler</a><span title="(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label]) @unchecked" class="delimiter">(</span><a href="#360842" title="GenMSIL.this.global.icodes.BasicBlock">block</a>, <a href="#363425" title="GenMSIL.this.global.icodes.BasicBlock">whereto</a><span class="delimiter">)</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#363427" title="Boolean">leaveHandler</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#363428" title="Boolean">leaveFinally</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#363429" title="Option[ch.epfl.lamp.compiler.msil.emit.Label]">lfTarget</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Leave</span>, <a href="#363429" title="Option[ch.epfl.lamp.compiler.msil.emit.Label]">lfTarget</a>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.Label">get</span><span class="delimiter">)</span>
                <span class="keyword">else</span> <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Endfinally</span><span class="delimiter">)</span>
              <span class="delimiter">}</span> <span class="keyword">else</span>
                <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Leave</span>, <a href="#357027" title="(key: GenMSIL.this.global.icodes.BasicBlock)ch.epfl.lamp.compiler.msil.emit.Label">labels</a><span class="delimiter">(</span><a href="#363425" title="GenMSIL.this.global.icodes.BasicBlock">whereto</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#360844" title="GenMSIL.this.global.icodes.BasicBlock">next</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#363425" title="GenMSIL.this.global.icodes.BasicBlock">whereto</a><span class="delimiter">)</span>
              <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Br</span>, <a href="#357027" title="(key: GenMSIL.this.global.icodes.BasicBlock)ch.epfl.lamp.compiler.msil.emit.Label">labels</a><span class="delimiter">(</span><a href="#363425" title="GenMSIL.this.global.icodes.BasicBlock">whereto</a><span class="delimiter">)</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">CJUMP</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.BasicBlock" id="363508">success</a>, <a title="GenMSIL.this.global.icodes.BasicBlock" id="363509">failure</a>, <a title="GenMSIL.this.global.icodes.TestOp" id="363510">cond</a>, <a title="GenMSIL.this.global.icodes.TypeKind" id="363511">kind</a><span class="delimiter">)</span> =&gt;
            // cond is TestOp (see Primitives.scala), and can take
            // values EQ, NE, LT, GE LE, GT
            // kind is TypeKind
            <span class="keyword">val</span> <a title="Boolean" id="363512">isFloat</a> = <a href="#363511" title="GenMSIL.this.global.icodes.TypeKind">kind</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../icode/TypeKinds.scala.html#228979" title="object GenMSIL.this.global.icodes.FLOAT">FLOAT</a> <span title="(x: Boolean)Boolean">||</span> <a href="#363511" title="GenMSIL.this.global.icodes.TypeKind">kind</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../icode/TypeKinds.scala.html#228981" title="object GenMSIL.this.global.icodes.DOUBLE">DOUBLE</a>
            <span class="keyword">val</span> <a title="(GenMSIL.this.global.icodes.TestOp, ch.epfl.lamp.compiler.msil.emit.Label) =&gt; Unit" id="363513">emit</a> = <span class="delimiter">(</span>c: <a href="../icode/Primitives.scala.html#229051" title="GenMSIL.this.global.icodes.TestOp">TestOp</a>, l: <span title="ch.epfl.lamp.compiler.msil.emit.Label">Label</span><span class="delimiter">)</span> =&gt; <a href="#357066" title="(condition: GenMSIL.this.global.icodes.TestOp, dest: ch.epfl.lamp.compiler.msil.emit.Label, isFloat: Boolean)Unit">emitBr</a><span class="delimiter">(</span><a href="#363523" title="GenMSIL.this.global.icodes.TestOp">c</a>, <a href="#363524" title="ch.epfl.lamp.compiler.msil.emit.Label">l</a>, <a href="#363512" title="Boolean">isFloat</a><span class="delimiter">)</span>
            <a href="#357065" title="(block: GenMSIL.this.global.icodes.BasicBlock, cond: GenMSIL.this.global.icodes.TestOp, success: GenMSIL.this.global.icodes.BasicBlock, failure: GenMSIL.this.global.icodes.BasicBlock, next: GenMSIL.this.global.icodes.BasicBlock, emitBrFun: (GenMSIL.this.global.icodes.TestOp, ch.epfl.lamp.compiler.msil.emit.Label) =&gt; Unit)Unit">emitCondBr</a><span class="delimiter">(</span><a href="#360842" title="GenMSIL.this.global.icodes.BasicBlock">block</a>, <a href="#363510" title="GenMSIL.this.global.icodes.TestOp">cond</a>, <a href="#363508" title="GenMSIL.this.global.icodes.BasicBlock">success</a>, <a href="#363509" title="GenMSIL.this.global.icodes.BasicBlock">failure</a>, <a href="#360844" title="GenMSIL.this.global.icodes.BasicBlock">next</a>, <a href="#363513" title="(GenMSIL.this.global.icodes.TestOp, ch.epfl.lamp.compiler.msil.emit.Label) =&gt; Unit">emit</a><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">CZJUMP</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.BasicBlock" id="363540">success</a>, <a title="GenMSIL.this.global.icodes.BasicBlock" id="363541">failure</a>, <a title="GenMSIL.this.global.icodes.TestOp" id="363542">cond</a>, <a title="GenMSIL.this.global.icodes.TypeKind" id="363543">kind</a><span class="delimiter">)</span> =&gt;
            <a href="#357065" title="(block: GenMSIL.this.global.icodes.BasicBlock, cond: GenMSIL.this.global.icodes.TestOp, success: GenMSIL.this.global.icodes.BasicBlock, failure: GenMSIL.this.global.icodes.BasicBlock, next: GenMSIL.this.global.icodes.BasicBlock, emitBrFun: (GenMSIL.this.global.icodes.TestOp, ch.epfl.lamp.compiler.msil.emit.Label) =&gt; Unit)Unit">emitCondBr</a><span class="delimiter">(</span><a href="#360842" title="GenMSIL.this.global.icodes.BasicBlock">block</a>, <a href="#363542" title="GenMSIL.this.global.icodes.TestOp">cond</a>, <a href="#363540" title="GenMSIL.this.global.icodes.BasicBlock">success</a>, <a href="#363541" title="GenMSIL.this.global.icodes.BasicBlock">failure</a>, <a href="#360844" title="GenMSIL.this.global.icodes.BasicBlock">next</a>, <a href="#357067" title="(cond: GenMSIL.this.global.icodes.TestOp, dest: ch.epfl.lamp.compiler.msil.emit.Label)Unit">emitBrBool</a><span class="delimiter">(</span><a href="#363545" title="GenMSIL.this.global.icodes.TestOp">_</a>, <a href="#363546" title="ch.epfl.lamp.compiler.msil.emit.Label">_</a><span class="delimiter">)</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">RETURN</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="363551">kind</a><span class="delimiter">)</span> =&gt;
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#357041" title="=&gt; scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">currentHandlers</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span>
              <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ret</span><span class="delimiter">)</span>
            <span class="keyword">else</span> <span class="delimiter">{</span>
              <span class="keyword">val</span> <a href="#363556" title="(ch.epfl.lamp.compiler.msil.emit.LocalBuilder, ch.epfl.lamp.compiler.msil.emit.Label)" class="delimiter">(</a><a href="#363555" title="ch.epfl.lamp.compiler.msil.emit.LocalBuilder" id="363556">local</a>, <a href="#363555" title="ch.epfl.lamp.compiler.msil.emit.Label" id="363557">label</a><span class="delimiter">)</span> = <a href="#357055" title="(kind: GenMSIL.this.global.icodes.TypeKind)(ch.epfl.lamp.compiler.msil.emit.LocalBuilder, ch.epfl.lamp.compiler.msil.emit.Label)">returnFromHandler</a><span title="(ch.epfl.lamp.compiler.msil.emit.LocalBuilder, ch.epfl.lamp.compiler.msil.emit.Label) @unchecked" class="delimiter">(</span><a href="#363551" title="GenMSIL.this.global.icodes.TypeKind">kind</a><span class="delimiter">)</span>
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#363551" title="GenMSIL.this.global.icodes.TypeKind">kind</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../icode/TypeKinds.scala.html#228965" title="object GenMSIL.this.global.icodes.UNIT">UNIT</a><span class="delimiter">)</span>
                <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.emit.LocalBuilder)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stloc</span>, <a href="#363556" title="ch.epfl.lamp.compiler.msil.emit.LocalBuilder">local</a><span class="delimiter">)</span>
              <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Leave</span>, <a href="#363557" title="ch.epfl.lamp.compiler.msil.emit.Label">label</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>

          <span class="keyword">case</span> <span title="Unit">THROW</span><span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;
            <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Throw</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">DROP</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="363584">kind</a><span class="delimiter">)</span> =&gt;
            <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Pop</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">DUP</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="363588">kind</a><span class="delimiter">)</span> =&gt;
            // see comment on `var previousWasNEW`
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#361434" title="Boolean">previousWasNEW</a><span class="delimiter">)</span>
              <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Dup</span><span class="delimiter">)</span>
            <span class="keyword">else</span>
              <a href="#361434" title="Boolean">previousWasNEW</a> = <span title="Boolean(false)" class="keyword">false</span>

          <span class="keyword">case</span> <span title="Unit">MONITOR_ENTER</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt;
            <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#356937" title="=&gt; ch.epfl.lamp.compiler.msil.MethodInfo">MMONITOR_ENTER</a><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">MONITOR_EXIT</span><span class="delimiter">(</span><span class="delimiter">)</span> =&gt;
            <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#356939" title="=&gt; ch.epfl.lamp.compiler.msil.MethodInfo">MMONITOR_EXIT</a><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Unit">SCOPE_ENTER</span><span class="delimiter">(</span>_<span class="delimiter">)</span> | SCOPE_EXIT<span class="delimiter">(</span>_<span class="delimiter">)</span> | LOAD_EXCEPTION<span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;
            <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

      <span class="delimiter">}</span> // end for (instr &lt;- b) { .. }
    <span class="delimiter">}</span> // end genBlock

    <span class="keyword">def</span> <a title="(primitive: GenMSIL.this.global.icodes.Primitive, pos: GenMSIL.this.global.Position)Unit" id="357060">genPrimitive</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.Primitive" id="362200">primitive</a>: <a href="../icode/Primitives.scala.html#229011" title="GenMSIL.this.global.icodes.Primitive">Primitive</a>, <a title="GenMSIL.this.global.Position" id="362201">pos</a>: <a href="../../util/Position.scala.html#34604" title="GenMSIL.this.global.Position">Position</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#362200" title="GenMSIL.this.global.icodes.Primitive">primitive</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Unit">Negation</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="363604">kind</a><span class="delimiter">)</span> =&gt;
          <a href="#363604" title="GenMSIL.this.global.icodes.TypeKind">kind</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
            // CHECK: is ist possible to get this for BOOL? in this case, verify.
            <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228967" title="Unit">BOOL</a> | <a href="../icode/TypeKinds.scala.html#228969" title="object GenMSIL.this.global.icodes.BYTE">BYTE</a> | <a href="../icode/TypeKinds.scala.html#228973" title="object GenMSIL.this.global.icodes.CHAR">CHAR</a> | <a href="../icode/TypeKinds.scala.html#228971" title="object GenMSIL.this.global.icodes.SHORT">SHORT</a> | <a href="../icode/TypeKinds.scala.html#228975" title="object GenMSIL.this.global.icodes.INT">INT</a> | <a href="../icode/TypeKinds.scala.html#228977" title="object GenMSIL.this.global.icodes.LONG">LONG</a> | <a href="../icode/TypeKinds.scala.html#228979" title="object GenMSIL.this.global.icodes.FLOAT">FLOAT</a> | <a href="../icode/TypeKinds.scala.html#228981" title="object GenMSIL.this.global.icodes.DOUBLE">DOUBLE</a> =&gt;
              <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Neg</span><span class="delimiter">)</span>

            <span class="keyword">case</span> <span title="Nothing">_</span> =&gt; <a href="../../Global.scala.html#182892" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="String(&quot;Impossible to negate a &quot;)" class="string">&quot;Impossible to negate a &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#363604" title="GenMSIL.this.global.icodes.TypeKind">kind</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

        <span class="keyword">case</span> <span title="Unit">Arithmetic</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.ArithmeticOp" id="363611">op</a>, <a title="GenMSIL.this.global.icodes.TypeKind" id="363612">kind</a><span class="delimiter">)</span> =&gt;
          <a href="#363611" title="GenMSIL.this.global.icodes.ArithmeticOp">op</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#229065" title="Unit">ADD</a> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Add</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#229067" title="Unit">SUB</a> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Sub</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#229069" title="Unit">MUL</a> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Mul</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#229071" title="Unit">DIV</a> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Div</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#229073" title="Unit">REM</a> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Rem</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#229075" title="Unit">NOT</a> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Not</span><span class="delimiter">)</span> //bitwise complement (one's complement)
            <span class="keyword">case</span> <span title="Nothing">_</span> =&gt; <a href="../../Global.scala.html#182892" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="String(&quot;Unknown arithmetic primitive &quot;)" class="string">&quot;Unknown arithmetic primitive &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#362200" title="GenMSIL.this.global.icodes.Primitive">primitive</a> <span class="delimiter">)</span>
          <span class="delimiter">}</span>

        <span class="keyword">case</span> <span title="Unit">Logical</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.LogicalOp" id="363629">op</a>, <a title="GenMSIL.this.global.icodes.TypeKind" id="363630">kind</a><span class="delimiter">)</span> =&gt; <a href="#363629" title="GenMSIL.this.global.icodes.LogicalOp">op</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#229085" title="Unit">AND</a> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">And</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#229087" title="Unit">OR</a> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Or</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#229089" title="Unit">XOR</a> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Xor</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span class="keyword">case</span> <span title="Unit">Shift</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.ShiftOp" id="363639">op</a>, <a title="GenMSIL.this.global.icodes.TypeKind" id="363640">kind</a><span class="delimiter">)</span> =&gt; <a href="#363639" title="GenMSIL.this.global.icodes.ShiftOp">op</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#229078" title="Unit">LSL</a> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Shl</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#229080" title="Unit">ASR</a> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Shr</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#229082" title="Unit">LSR</a> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Shr_Un</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span class="keyword">case</span> <span title="Unit">Conversion</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="363649">src</a>, <a title="GenMSIL.this.global.icodes.TypeKind" id="363650">dst</a><span class="delimiter">)</span> =&gt;
          <a href="../../Global.scala.html#182894" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;Converting from: &quot;)" class="string">&quot;Converting from: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#363649" title="GenMSIL.this.global.icodes.TypeKind">src</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; to: &quot;)" class="string">&quot; to: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#363650" title="GenMSIL.this.global.icodes.TypeKind">dst</a><span class="delimiter">)</span>

          <a href="#363650" title="GenMSIL.this.global.icodes.TypeKind">dst</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228969" title="Unit">BYTE</a> =&gt;   <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Conv_I1</span><span class="delimiter">)</span> // I1 for System.SByte, i.e. a scala.Byte
            <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228971" title="Unit">SHORT</a> =&gt;  <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Conv_I2</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228973" title="Unit">CHAR</a> =&gt;   <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Conv_U2</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228975" title="Unit">INT</a> =&gt;    <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Conv_I4</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228977" title="Unit">LONG</a> =&gt;   <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Conv_I8</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228979" title="Unit">FLOAT</a> =&gt;  <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Conv_R4</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228981" title="Unit">DOUBLE</a> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Conv_R8</span><span class="delimiter">)</span>
            <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
              <span title="object Console">Console</span>.<span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;Illegal conversion at: &quot;)" class="string">&quot;Illegal conversion at: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#356987" title="=&gt; GenMSIL.this.global.icodes.IClass">clasz</a> <span title="(x$1: Any)String">+</span>
                              <span title="String(&quot; at: &quot;)" class="string">&quot; at: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#362201" title="GenMSIL.this.global.Position">pos</a>.<a href="../../util/Position.scala.html#183787" title="=&gt; scala.tools.nsc.util.SourceFile">source</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;:&quot;)" class="string">&quot;:&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#362201" title="GenMSIL.this.global.Position">pos</a>.<a href="../../util/Position.scala.html#183814" title="=&gt; Int">line</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

        <span class="keyword">case</span> <span title="Unit">ArrayLength</span><span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;
          <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldlen</span><span class="delimiter">)</span>

        <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#229039" title="Unit">StartConcat</a> =&gt;
          <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.ConstructorInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Newobj</span>, <a href="#356943" title="=&gt; ch.epfl.lamp.compiler.msil.ConstructorInfo">MSTRING_BUILDER_CONSTR</a><span class="delimiter">)</span>


        <span class="keyword">case</span> <span title="Unit">StringConcat</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="363675">el</a><span class="delimiter">)</span> =&gt;
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="363676">elemType</a> : <span title="ch.epfl.lamp.compiler.msil.Type">MsilType</span> = <a href="#363675" title="GenMSIL.this.global.icodes.TypeKind">el</a> <span title="ch.epfl.lamp.compiler.msil.Type" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.Type">REFERENCE</span><span class="delimiter">(</span>_<span class="delimiter">)</span> | ARRAY<span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt; <a href="../../symtab/clr/CLRTypes.scala.html#310619" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MOBJECT</a>
            <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.Type">_</span> =&gt; <a href="#357081" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#363675" title="GenMSIL.this.global.icodes.TypeKind">el</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

          <span class="keyword">val</span> <a title="Array[ch.epfl.lamp.compiler.msil.Type]" id="363677">argTypes</a>:<span title="Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span class="delimiter">[</span>MsilType<span class="delimiter">]</span> = <span title="(xs: ch.epfl.lamp.compiler.msil.Type*)(implicit evidence$2: scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type])Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span title="(clazz: Class[_])scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type]" class="delimiter">(</span><a href="#363676" title="ch.epfl.lamp.compiler.msil.Type">elemType</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="363678">stringBuilderAppend</a> = <a href="#356941" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MSTRING_BUILDER</a>.<span title="(x$1: String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><span title="String(&quot;Append&quot;)" class="string">&quot;Append&quot;</span>, <a href="#363677" title="Array[ch.epfl.lamp.compiler.msil.Type]">argTypes</a> <span class="delimiter">)</span>
          <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Callvirt</span>,  <a href="#363678" title="ch.epfl.lamp.compiler.msil.MethodInfo">stringBuilderAppend</a><span class="delimiter">)</span>

        <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#229041" title="Unit">EndConcat</a> =&gt;
          <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Callvirt</span>, <a href="#356945" title="=&gt; ch.epfl.lamp.compiler.msil.MethodInfo">MSTRING_BUILDER_TOSTRING</a><span class="delimiter">)</span>

        <span class="keyword">case</span> <span title="Nothing">_</span> =&gt;
          <a href="../../Global.scala.html#182892" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="String(&quot;Unimplemented primitive &quot;)" class="string">&quot;Unimplemented primitive &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#362200" title="GenMSIL.this.global.icodes.Primitive">primitive</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> // end genPrimitive


    ////////////////////// loading ///////////////////////

    <span class="keyword">def</span> <a title="(value: Int, code: ch.epfl.lamp.compiler.msil.emit.ILGenerator)Unit" id="357061">loadI4</a><span class="delimiter">(</span><a title="Int" id="361680">value</a>: <span title="Int">Int</span>, <a title="ch.epfl.lamp.compiler.msil.emit.ILGenerator" id="361681">code</a>: <span title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">ILGenerator</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#361680" title="Int">value</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Unit">-</span><span class="int">1</span> =&gt; <a href="#361681" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_M1</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit" class="int">0</span>  =&gt; <a href="#361681" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_0</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit" class="int">1</span>  =&gt; <a href="#361681" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_1</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit" class="int">2</span>  =&gt; <a href="#361681" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_2</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit" class="int">3</span>  =&gt; <a href="#361681" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_3</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit" class="int">4</span>  =&gt; <a href="#361681" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_4</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit" class="int">5</span>  =&gt; <a href="#361681" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_5</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit" class="int">6</span>  =&gt; <a href="#361681" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_6</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit" class="int">7</span>  =&gt; <a href="#361681" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_7</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit" class="int">8</span>  =&gt; <a href="#361681" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_8</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">_</span>  =&gt;
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#361680" title="Int">value</a> <span title="(x: Int)Boolean">&gt;=</span> -<span title="Int(-128)" class="int">128</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#361680" title="Int">value</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(127)" class="int">127</span><span class="delimiter">)</span>
          <a href="#361681" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Int)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4_S</span>, <a href="#361680" title="Int">value</a><span class="delimiter">)</span>
        <span class="keyword">else</span>
          <a href="#361681" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Int)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldc_I4</span>, <a href="#361680" title="Int">value</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(code: ch.epfl.lamp.compiler.msil.emit.ILGenerator, loadAddr: Boolean)(i: Int)Unit" id="357062">loadArg</a><span class="delimiter">(</span><a title="ch.epfl.lamp.compiler.msil.emit.ILGenerator" id="361442">code</a>: <span title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">ILGenerator</span>, <a title="Boolean" id="361443">loadAddr</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="Int" id="361444">i</a>: <span title="Int">Int</span><span class="delimiter">)</span> =
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#361443" title="Boolean">loadAddr</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#361444" title="Int">i</a> <span title="(x: Int)Boolean">&gt;=</span> -<span title="Int(-128)" class="int">128</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#361444" title="Int">i</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(127)" class="int">127</span><span class="delimiter">)</span>
          <a href="#361442" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Int)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldarga_S</span>, <a href="#361444" title="Int">i</a><span class="delimiter">)</span>
        <span class="keyword">else</span>
          <a href="#361442" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Int)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldarga</span>, <a href="#361444" title="Int">i</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="#361444" title="Int">i</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Unit" class="int">0</span> =&gt; <a href="#361442" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldarg_0</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Unit" class="int">1</span> =&gt; <a href="#361442" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldarg_1</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Unit" class="int">2</span> =&gt; <a href="#361442" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldarg_2</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Unit" class="int">3</span> =&gt; <a href="#361442" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldarg_3</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Unit">_</span>      =&gt;
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#361444" title="Int">i</a> <span title="(x: Int)Boolean">&gt;=</span> -<span title="Int(-128)" class="int">128</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#361444" title="Int">i</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(127)" class="int">127</span><span class="delimiter">)</span>
              <a href="#361442" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Int)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldarg_S</span>, <a href="#361444" title="Int">i</a><span class="delimiter">)</span>
            <span class="keyword">else</span>
              <a href="#361442" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: Int)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldarg</span>, <a href="#361444" title="Int">i</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(i: Int, local: GenMSIL.this.global.icodes.Local, code: ch.epfl.lamp.compiler.msil.emit.ILGenerator, loadAddr: Boolean)Unit" id="357063">loadLocal</a><span class="delimiter">(</span><a title="Int" id="361487">i</a>: <span title="Int">Int</span>, <a title="GenMSIL.this.global.icodes.Local" id="361488">local</a>: <a href="../icode/Members.scala.html#228929" title="GenMSIL.this.global.icodes.Local">Local</a>, <a title="ch.epfl.lamp.compiler.msil.emit.ILGenerator" id="361489">code</a>: <span title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">ILGenerator</span>, <a title="Boolean" id="361490">loadAddr</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> =
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#361490" title="Boolean">loadAddr</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#361487" title="Int">i</a> <span title="(x: Int)Boolean">&gt;=</span> -<span title="Int(-128)" class="int">128</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#361487" title="Int">i</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(127)" class="int">127</span><span class="delimiter">)</span>
          <a href="#361489" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.emit.LocalBuilder)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldloca_S</span>, <a href="#357078" title="(key: GenMSIL.this.global.icodes.Local)ch.epfl.lamp.compiler.msil.emit.LocalBuilder">localBuilders</a><span class="delimiter">(</span><a href="#361488" title="GenMSIL.this.global.icodes.Local">local</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">else</span>
          <a href="#361489" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.emit.LocalBuilder)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldloca</span>, <a href="#357078" title="(key: GenMSIL.this.global.icodes.Local)ch.epfl.lamp.compiler.msil.emit.LocalBuilder">localBuilders</a><span class="delimiter">(</span><a href="#361488" title="GenMSIL.this.global.icodes.Local">local</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="#361487" title="Int">i</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Unit" class="int">0</span> =&gt; <a href="#361489" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldloc_0</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Unit" class="int">1</span> =&gt; <a href="#361489" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldloc_1</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Unit" class="int">2</span> =&gt; <a href="#361489" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldloc_2</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Unit" class="int">3</span> =&gt; <a href="#361489" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldloc_3</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Unit">_</span>      =&gt;
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#361487" title="Int">i</a> <span title="(x: Int)Boolean">&gt;=</span> -<span title="Int(-128)" class="int">128</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#361487" title="Int">i</a> <span title="(x: Int)Boolean">&lt;=</span> <span title="Int(127)" class="int">127</span><span class="delimiter">)</span>
              <a href="#361489" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.emit.LocalBuilder)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldloc_S</span>, <a href="#357078" title="(key: GenMSIL.this.global.icodes.Local)ch.epfl.lamp.compiler.msil.emit.LocalBuilder">localBuilders</a><span class="delimiter">(</span><a href="#361488" title="GenMSIL.this.global.icodes.Local">local</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="keyword">else</span>
              <a href="#361489" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.emit.LocalBuilder)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldloc</span>, <a href="#357078" title="(key: GenMSIL.this.global.icodes.Local)ch.epfl.lamp.compiler.msil.emit.LocalBuilder">localBuilders</a><span class="delimiter">(</span><a href="#361488" title="GenMSIL.this.global.icodes.Local">local</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    ////////////////////// branches ///////////////////////

    /** Returns a Triple (Boolean, Boolean, Option[Label])
     *   - whether the jump leaves some exception block (try / catch / finally)
     *   - whether it leaves a finally handler (finally block, but not it's try / catch)
     *   - a label where to jump for leaving the finally handler
     *     . None to leave directly using `endfinally`
     *     . Some(label) to emit `leave label` (for try / catch inside a finally handler)
     */
    <span class="keyword">def</span> <a title="(from: GenMSIL.this.global.icodes.BasicBlock, to: GenMSIL.this.global.icodes.BasicBlock)(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label])" id="357064">leavesHandler</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.BasicBlock" id="363430">from</a>: <a href="../icode/BasicBlocks.scala.html#228937" title="GenMSIL.this.global.icodes.BasicBlock">BasicBlock</a>, <a title="GenMSIL.this.global.icodes.BasicBlock" id="363431">to</a>: <a href="../icode/BasicBlocks.scala.html#228937" title="GenMSIL.this.global.icodes.BasicBlock">BasicBlock</a><span class="delimiter">)</span>: <span title="(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label])" class="delimiter">(</span>Boolean, Boolean, Option<span class="delimiter">[</span>Label<span class="delimiter">]</span><span class="delimiter">)</span> =
      <span title="(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label])" class="keyword">if</span> <span class="delimiter">(</span><a href="#357041" title="=&gt; scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">currentHandlers</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span title="(_1: Boolean, _2: Boolean, _3: None.type)(Boolean, Boolean, None.type)" class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span>, <span title="Boolean(false)" class="keyword">false</span>, <span title="object None">None</span><span class="delimiter">)</span>
      <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.ExceptionHandler" id="363769">h</a> = <a href="#357041" title="=&gt; scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">currentHandlers</a>.<span title="=&gt; GenMSIL.this.global.icodes.ExceptionHandler">head</span>
        <span class="keyword">val</span> <a title="Boolean" id="363770">leaveHead</a> = <span class="delimiter">{</span> <a href="#363769" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a>.<a href="../icode/ExceptionHandlers.scala.html#312856" title="(b: GenMSIL.this.global.icodes.BasicBlock)Boolean">covers</a><span class="delimiter">(</span><a href="#363430" title="GenMSIL.this.global.icodes.BasicBlock">from</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">!=</span> <a href="#363769" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a>.<a href="../icode/ExceptionHandlers.scala.html#312856" title="(b: GenMSIL.this.global.icodes.BasicBlock)Boolean">covers</a><span class="delimiter">(</span><a href="#363431" title="GenMSIL.this.global.icodes.BasicBlock">to</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span>
                          <a href="#363769" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a>.<a href="../icode/ExceptionHandlers.scala.html#312857" title="=&gt; List[GenMSIL.this.global.icodes.BasicBlock]">blocks</a>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#363430" title="GenMSIL.this.global.icodes.BasicBlock">from</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">!=</span> <a href="#363769" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a>.<a href="../icode/ExceptionHandlers.scala.html#312857" title="=&gt; List[GenMSIL.this.global.icodes.BasicBlock]">blocks</a>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#363431" title="GenMSIL.this.global.icodes.BasicBlock">to</a><span class="delimiter">)</span> <span class="delimiter">}</span>
        <span title="(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label])" class="keyword">if</span> <span class="delimiter">(</span><a href="#363770" title="Boolean">leaveHead</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          // we leave the innermost exception block.
          // find out if we also leave som e `finally` handler
          <a href="#357041" title="=&gt; scala.collection.mutable.Stack[GenMSIL.this.global.icodes.ExceptionHandler]">currentHandlers</a>.<span title="(p: GenMSIL.this.global.icodes.ExceptionHandler =&gt; Boolean)Option[GenMSIL.this.global.icodes.ExceptionHandler]">find</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.ExceptionHandler" id="363804">e</a> =&gt; <span class="delimiter">{</span>
            <a href="#363804" title="GenMSIL.this.global.icodes.ExceptionHandler">e</a>.<a href="../icode/ExceptionHandlers.scala.html#312835" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">cls</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../../reflect/internal/Symbols.scala.html#40013" title="object GenMSIL.this.global.NoSymbol">NoSymbol</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#363804" title="GenMSIL.this.global.icodes.ExceptionHandler">e</a>.<a href="../icode/ExceptionHandlers.scala.html#312857" title="=&gt; List[GenMSIL.this.global.icodes.BasicBlock]">blocks</a>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#363430" title="GenMSIL.this.global.icodes.BasicBlock">from</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">!=</span> <a href="#363804" title="GenMSIL.this.global.icodes.ExceptionHandler">e</a>.<a href="../icode/ExceptionHandlers.scala.html#312857" title="=&gt; List[GenMSIL.this.global.icodes.BasicBlock]">blocks</a>.<span title="(elem: Any)Boolean">contains</span><span class="delimiter">(</span><a href="#363431" title="GenMSIL.this.global.icodes.BasicBlock">to</a><span class="delimiter">)</span>
          <span class="delimiter">}</span><span class="delimiter">)</span> <span title="(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label])" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label])">Some</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.ExceptionHandler" id="363815">finallyHandler</a><span class="delimiter">)</span> =&gt;
              <span title="(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label])" class="keyword">if</span> <span class="delimiter">(</span><a href="#363769" title="GenMSIL.this.global.icodes.ExceptionHandler">h</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#363815" title="GenMSIL.this.global.icodes.ExceptionHandler">finallyHandler</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                // the finally handler is the innermost, so we can emit `endfinally` directly
                <span title="(_1: Boolean, _2: Boolean, _3: None.type)(Boolean, Boolean, None.type)" class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span>, <span title="Boolean(true)" class="keyword">true</span>, <span title="object None">None</span><span class="delimiter">)</span>
              <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
                // we need to `Leave` to the `endfinally` of the next outer finally handler
                <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.Label" id="363829">l</a> = <a href="#357056" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.ExceptionHandler,ch.epfl.lamp.compiler.msil.emit.Label]">endFinallyLabels</a>.<span title="(key: GenMSIL.this.global.icodes.ExceptionHandler, op: =&gt; ch.epfl.lamp.compiler.msil.emit.Label)ch.epfl.lamp.compiler.msil.emit.Label">getOrElseUpdate</span><span class="delimiter">(</span><a href="#363815" title="GenMSIL.this.global.icodes.ExceptionHandler">finallyHandler</a>, <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="()ch.epfl.lamp.compiler.msil.emit.Label">DefineLabel</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
                <span title="(_1: Boolean, _2: Boolean, _3: Some[ch.epfl.lamp.compiler.msil.emit.Label])(Boolean, Boolean, Some[ch.epfl.lamp.compiler.msil.emit.Label])" class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span>, <span title="Boolean(true)" class="keyword">true</span>, <span title="(x: ch.epfl.lamp.compiler.msil.emit.Label)Some[ch.epfl.lamp.compiler.msil.emit.Label]">Some</span><span class="delimiter">(</span><a href="#363829" title="ch.epfl.lamp.compiler.msil.emit.Label">l</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="keyword">case</span> <span title="(Boolean, Boolean, None.type)">None</span> =&gt;
              <span title="(_1: Boolean, _2: Boolean, _3: None.type)(Boolean, Boolean, None.type)" class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span>, <span title="Boolean(false)" class="keyword">false</span>, <span title="object None">None</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span title="(_1: Boolean, _2: Boolean, _3: None.type)(Boolean, Boolean, None.type)" class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span>, <span title="Boolean(false)" class="keyword">false</span>, <span title="object None">None</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(block: GenMSIL.this.global.icodes.BasicBlock, cond: GenMSIL.this.global.icodes.TestOp, success: GenMSIL.this.global.icodes.BasicBlock, failure: GenMSIL.this.global.icodes.BasicBlock, next: GenMSIL.this.global.icodes.BasicBlock, emitBrFun: (GenMSIL.this.global.icodes.TestOp, ch.epfl.lamp.compiler.msil.emit.Label) =&gt; Unit)Unit" id="357065">emitCondBr</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.BasicBlock" id="363529">block</a>: <a href="../icode/BasicBlocks.scala.html#228937" title="GenMSIL.this.global.icodes.BasicBlock">BasicBlock</a>, <a title="GenMSIL.this.global.icodes.TestOp" id="363530">cond</a>: <a href="../icode/Primitives.scala.html#229051" title="GenMSIL.this.global.icodes.TestOp">TestOp</a>, <a title="GenMSIL.this.global.icodes.BasicBlock" id="363531">success</a>: <a href="../icode/BasicBlocks.scala.html#228937" title="GenMSIL.this.global.icodes.BasicBlock">BasicBlock</a>, <a title="GenMSIL.this.global.icodes.BasicBlock" id="363532">failure</a>: <a href="../icode/BasicBlocks.scala.html#228937" title="GenMSIL.this.global.icodes.BasicBlock">BasicBlock</a>,
                   <a title="GenMSIL.this.global.icodes.BasicBlock" id="363533">next</a>: <a href="../icode/BasicBlocks.scala.html#228937" title="GenMSIL.this.global.icodes.BasicBlock">BasicBlock</a>, <a title="(GenMSIL.this.global.icodes.TestOp, ch.epfl.lamp.compiler.msil.emit.Label) =&gt; Unit" id="363534">emitBrFun</a>: <span class="delimiter">(</span>TestOp, Label<span class="delimiter">)</span> =&gt; Unit<span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a href="#363863" title="(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label])" class="delimiter">(</a><a href="#363862" title="Boolean" id="363863">sLeaveHandler</a>, <a href="#363862" title="Boolean" id="363864">sLeaveFinally</a>, <a href="#363862" title="Option[ch.epfl.lamp.compiler.msil.emit.Label]" id="363865">slfTarget</a><span class="delimiter">)</span> = <a href="#357064" title="(from: GenMSIL.this.global.icodes.BasicBlock, to: GenMSIL.this.global.icodes.BasicBlock)(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label])">leavesHandler</a><span title="(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label]) @unchecked" class="delimiter">(</span><a href="#363529" title="GenMSIL.this.global.icodes.BasicBlock">block</a>, <a href="#363531" title="GenMSIL.this.global.icodes.BasicBlock">success</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a href="#363867" title="(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label])" class="delimiter">(</a><a href="#363866" title="Boolean" id="363867">fLeaveHandler</a>, <a href="#363866" title="Boolean" id="363868">fLeaveFinally</a>, <a href="#363866" title="Option[ch.epfl.lamp.compiler.msil.emit.Label]" id="363869">flfTarget</a><span class="delimiter">)</span> = <a href="#357064" title="(from: GenMSIL.this.global.icodes.BasicBlock, to: GenMSIL.this.global.icodes.BasicBlock)(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label])">leavesHandler</a><span title="(Boolean, Boolean, Option[ch.epfl.lamp.compiler.msil.emit.Label]) @unchecked" class="delimiter">(</span><a href="#363529" title="GenMSIL.this.global.icodes.BasicBlock">block</a>, <a href="#363532" title="GenMSIL.this.global.icodes.BasicBlock">failure</a><span class="delimiter">)</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#363863" title="Boolean">sLeaveHandler</a> <span title="(x: Boolean)Boolean">||</span> <a href="#363867" title="Boolean">fLeaveHandler</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Option[ch.epfl.lamp.compiler.msil.emit.Label]" id="363900">sLabelOpt</a> = <span title="Option[ch.epfl.lamp.compiler.msil.emit.Label]" class="keyword">if</span> <span class="delimiter">(</span><a href="#363863" title="Boolean">sLeaveHandler</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.Label" id="363901">leaveSLabel</a> = <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="()ch.epfl.lamp.compiler.msil.emit.Label">DefineLabel</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#363534" title="(v1: GenMSIL.this.global.icodes.TestOp, v2: ch.epfl.lamp.compiler.msil.emit.Label)Unit">emitBrFun</a><span class="delimiter">(</span><a href="#363530" title="GenMSIL.this.global.icodes.TestOp">cond</a>, <a href="#363901" title="ch.epfl.lamp.compiler.msil.emit.Label">leaveSLabel</a><span class="delimiter">)</span>
          <span title="(x: ch.epfl.lamp.compiler.msil.emit.Label)Some[ch.epfl.lamp.compiler.msil.emit.Label]">Some</span><span class="delimiter">(</span><a href="#363901" title="ch.epfl.lamp.compiler.msil.emit.Label">leaveSLabel</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#363534" title="(v1: GenMSIL.this.global.icodes.TestOp, v2: ch.epfl.lamp.compiler.msil.emit.Label)Unit">emitBrFun</a><span class="delimiter">(</span><a href="#363530" title="GenMSIL.this.global.icodes.TestOp">cond</a>, <a href="#357027" title="(key: GenMSIL.this.global.icodes.BasicBlock)ch.epfl.lamp.compiler.msil.emit.Label">labels</a><span class="delimiter">(</span><a href="#363531" title="GenMSIL.this.global.icodes.BasicBlock">success</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span title="object None">None</span>
        <span class="delimiter">}</span>

        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#363867" title="Boolean">fLeaveHandler</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#363868" title="Boolean">fLeaveFinally</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#363869" title="Option[ch.epfl.lamp.compiler.msil.emit.Label]">flfTarget</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Leave</span>, <a href="#363869" title="Option[ch.epfl.lamp.compiler.msil.emit.Label]">flfTarget</a>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.Label">get</span><span class="delimiter">)</span>
            <span class="keyword">else</span> <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Endfinally</span><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span>
            <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Leave</span>, <a href="#357027" title="(key: GenMSIL.this.global.icodes.BasicBlock)ch.epfl.lamp.compiler.msil.emit.Label">labels</a><span class="delimiter">(</span><a href="#363532" title="GenMSIL.this.global.icodes.BasicBlock">failure</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span>
          <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Br</span>, <a href="#357027" title="(key: GenMSIL.this.global.icodes.BasicBlock)ch.epfl.lamp.compiler.msil.emit.Label">labels</a><span class="delimiter">(</span><a href="#363532" title="GenMSIL.this.global.icodes.BasicBlock">failure</a><span class="delimiter">)</span><span class="delimiter">)</span>

        <a href="#363900" title="Option[ch.epfl.lamp.compiler.msil.emit.Label]">sLabelOpt</a>.<span title="(f: ch.epfl.lamp.compiler.msil.emit.Label =&gt; Unit)Option[Unit]">map</span><span title="Unit" class="delimiter">(</span><a title="ch.epfl.lamp.compiler.msil.emit.Label" id="363993">l</a> =&gt; <span class="delimiter">{</span>
          <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">MarkLabel</span><span class="delimiter">(</span><a href="#363993" title="ch.epfl.lamp.compiler.msil.emit.Label">l</a><span class="delimiter">)</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#363864" title="Boolean">sLeaveFinally</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#363865" title="Option[ch.epfl.lamp.compiler.msil.emit.Label]">slfTarget</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Leave</span>, <a href="#363865" title="Option[ch.epfl.lamp.compiler.msil.emit.Label]">slfTarget</a>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.Label">get</span><span class="delimiter">)</span>
            <span class="keyword">else</span> <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Endfinally</span><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span>
            <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Leave</span>, <a href="#357027" title="(key: GenMSIL.this.global.icodes.BasicBlock)ch.epfl.lamp.compiler.msil.emit.Label">labels</a><span class="delimiter">(</span><a href="#363531" title="GenMSIL.this.global.icodes.BasicBlock">success</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#363533" title="GenMSIL.this.global.icodes.BasicBlock">next</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#363531" title="GenMSIL.this.global.icodes.BasicBlock">success</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#363534" title="(v1: GenMSIL.this.global.icodes.TestOp, v2: ch.epfl.lamp.compiler.msil.emit.Label)Unit">emitBrFun</a><span class="delimiter">(</span><a href="#363530" title="GenMSIL.this.global.icodes.TestOp">cond</a>.<a href="../icode/Primitives.scala.html#318374" title="()GenMSIL.this.global.icodes.TestOp">negate</a>, <a href="#357027" title="(key: GenMSIL.this.global.icodes.BasicBlock)ch.epfl.lamp.compiler.msil.emit.Label">labels</a><span class="delimiter">(</span><a href="#363532" title="GenMSIL.this.global.icodes.BasicBlock">failure</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#363534" title="(v1: GenMSIL.this.global.icodes.TestOp, v2: ch.epfl.lamp.compiler.msil.emit.Label)Unit">emitBrFun</a><span class="delimiter">(</span><a href="#363530" title="GenMSIL.this.global.icodes.TestOp">cond</a>, <a href="#357027" title="(key: GenMSIL.this.global.icodes.BasicBlock)ch.epfl.lamp.compiler.msil.emit.Label">labels</a><span class="delimiter">(</span><a href="#363531" title="GenMSIL.this.global.icodes.BasicBlock">success</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#363533" title="GenMSIL.this.global.icodes.BasicBlock">next</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#363532" title="GenMSIL.this.global.icodes.BasicBlock">failure</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Br</span>, <a href="#357027" title="(key: GenMSIL.this.global.icodes.BasicBlock)ch.epfl.lamp.compiler.msil.emit.Label">labels</a><span class="delimiter">(</span><a href="#363532" title="GenMSIL.this.global.icodes.BasicBlock">failure</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(condition: GenMSIL.this.global.icodes.TestOp, dest: ch.epfl.lamp.compiler.msil.emit.Label, isFloat: Boolean)Unit" id="357066">emitBr</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TestOp" id="363525">condition</a>: <a href="../icode/Primitives.scala.html#229051" title="GenMSIL.this.global.icodes.TestOp">TestOp</a>, <a title="ch.epfl.lamp.compiler.msil.emit.Label" id="363526">dest</a>: <span title="ch.epfl.lamp.compiler.msil.emit.Label">Label</span>, <a title="Boolean" id="363527">isFloat</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#363525" title="GenMSIL.this.global.icodes.TestOp">condition</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#229052" title="Unit">EQ</a> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Beq</span>, <a href="#363526" title="ch.epfl.lamp.compiler.msil.emit.Label">dest</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#229054" title="Unit">NE</a> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Bne_Un</span>, <a href="#363526" title="ch.epfl.lamp.compiler.msil.emit.Label">dest</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#229056" title="Unit">LT</a> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="ch.epfl.lamp.compiler.msil.emit.OpCode" class="keyword">if</span> <span class="delimiter">(</span><a href="#363527" title="Boolean">isFloat</a><span class="delimiter">)</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Blt_Un</span> <span class="keyword">else</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Blt</span>, <a href="#363526" title="ch.epfl.lamp.compiler.msil.emit.Label">dest</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#229058" title="Unit">GE</a> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="ch.epfl.lamp.compiler.msil.emit.OpCode" class="keyword">if</span> <span class="delimiter">(</span><a href="#363527" title="Boolean">isFloat</a><span class="delimiter">)</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Bge_Un</span> <span class="keyword">else</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Bge</span>, <a href="#363526" title="ch.epfl.lamp.compiler.msil.emit.Label">dest</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#229060" title="Unit">LE</a> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="ch.epfl.lamp.compiler.msil.emit.OpCode" class="keyword">if</span> <span class="delimiter">(</span><a href="#363527" title="Boolean">isFloat</a><span class="delimiter">)</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ble_Un</span> <span class="keyword">else</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ble</span>, <a href="#363526" title="ch.epfl.lamp.compiler.msil.emit.Label">dest</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#229062" title="Unit">GT</a> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="ch.epfl.lamp.compiler.msil.emit.OpCode" class="keyword">if</span> <span class="delimiter">(</span><a href="#363527" title="Boolean">isFloat</a><span class="delimiter">)</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Bgt_Un</span> <span class="keyword">else</span> <span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Bgt</span>, <a href="#363526" title="ch.epfl.lamp.compiler.msil.emit.Label">dest</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(cond: GenMSIL.this.global.icodes.TestOp, dest: ch.epfl.lamp.compiler.msil.emit.Label)Unit" id="357067">emitBrBool</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TestOp" id="363547">cond</a>: <a href="../icode/Primitives.scala.html#229051" title="GenMSIL.this.global.icodes.TestOp">TestOp</a>, <a title="ch.epfl.lamp.compiler.msil.emit.Label" id="363548">dest</a>: <span title="ch.epfl.lamp.compiler.msil.emit.Label">Label</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#363547" title="GenMSIL.this.global.icodes.TestOp">cond</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        // EQ -&gt; Brfalse, NE -&gt; Brtrue; this is because we come from
        // a CZJUMP. If the value on the stack is 0 (e.g. a boolean
        // method returned false), and we are in the case EQ, then
        // we need to emit Brfalse (EQ Zero means false). vice versa
        <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#229052" title="Unit">EQ</a> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Brfalse</span>, <a href="#363548" title="ch.epfl.lamp.compiler.msil.emit.Label">dest</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a href="../icode/Primitives.scala.html#229054" title="Unit">NE</a> =&gt; <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, label: ch.epfl.lamp.compiler.msil.emit.Label)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Brtrue</span>, <a href="#363548" title="ch.epfl.lamp.compiler.msil.emit.Label">dest</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    ////////////////////// local vars ///////////////////////

    /**
     * Compute the indexes of each local variable of the given
     * method.
     */
    <span class="keyword">def</span> <a title="(m: GenMSIL.this.global.icodes.IMethod)Unit" id="357068">computeLocalVarsIndex</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IMethod" id="360609">m</a>: <a href="../icode/Members.scala.html#228928" title="GenMSIL.this.global.icodes.IMethod">IMethod</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">var</span> <a title="Int" id="364125">idx</a> = <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#360609" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312600" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47859" title="=&gt; Boolean">isStaticMember</a><span class="delimiter">)</span> <span title="Int(0)" class="int">0</span> <span class="keyword">else</span> <span title="Int(1)" class="int">1</span>

      <span class="keyword">val</span> <a title="List[GenMSIL.this.global.icodes.Local]" id="364126">params</a> = <a href="#360609" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312635" title="=&gt; List[GenMSIL.this.global.icodes.Local]">params</a>
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.Local" id="364147">l</a> &lt;- <a href="#364126" title="(f: GenMSIL.this.global.icodes.Local =&gt; Unit)Unit">params</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="../../Global.scala.html#182894" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;Index value for parameter &quot;)" class="string">&quot;Index value for parameter &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#364147" title="GenMSIL.this.global.icodes.Local">l</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#364125" title="Int">idx</a><span class="delimiter">)</span>
        <a href="#364147" title="GenMSIL.this.global.icodes.Local">l</a>.<a href="../icode/Members.scala.html#313055" title="(x$1: Int)Unit">index</a> = <a href="#364125" title="Int">idx</a>
        <a href="#364125" title="Int">idx</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span> // sizeOf(l.kind)
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="List[GenMSIL.this.global.icodes.Local]" id="364127">locvars</a> = <a href="#360609" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312632" title="=&gt; List[GenMSIL.this.global.icodes.Local]">locals</a> <span title="(p: GenMSIL.this.global.icodes.Local =&gt; Boolean)List[GenMSIL.this.global.icodes.Local]">filterNot</span> <span class="delimiter">(</span><a href="#364126" title="List[GenMSIL.this.global.icodes.Local]">params</a> <a href="#364158" title="(elem: Any)Boolean">contains</a><span class="delimiter">)</span>
      <a href="#364125" title="Int">idx</a> = <span title="Int(0)" class="int">0</span>

      <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.Local" id="364178">l</a> &lt;- <a href="#364127" title="(f: GenMSIL.this.global.icodes.Local =&gt; Unit)Unit">locvars</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="../../Global.scala.html#182894" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;Index value for local variable &quot;)" class="string">&quot;Index value for local variable &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#364178" title="GenMSIL.this.global.icodes.Local">l</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#364125" title="Int">idx</a><span class="delimiter">)</span>
        <a href="#364178" title="GenMSIL.this.global.icodes.Local">l</a>.<a href="../icode/Members.scala.html#313055" title="(x$1: Int)Unit">index</a> = <a href="#364125" title="Int">idx</a>
        <a href="#364125" title="Int">idx</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span> // sizeOf(l.kind)
      <span class="delimiter">}</span>

    <span class="delimiter">}</span>

    ////////////////////// Utilities ////////////////////////

    /** Return the a name of this symbol that can be used on the .NET
     * platform. It removes spaces from names.
     *
     * Special handling: scala.All and scala.AllRef are 'erased' to
     * scala.All$ and scala.AllRef$. This is needed because they are
     * not real classes, and they mean 'abrupt termination upon evaluation
     * of that expression' or 'null' respectively. This handling is
     * done already in GenICode, but here we need to remove references
     * from method signatures to these types, because such classes can
     * not exist in the classpath: the type checker will be very confused.
     */
    <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)String" id="357069">msilName</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="357964">sym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="String" id="364184">suffix</a> = <a href="#357964" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47889" title="=&gt; String">moduleSuffix</a>
      // Flags.JAVA: &quot;symbol was not defined by a scala-class&quot; (java, or .net-class)

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#357964" title="GenMSIL.this.global.Symbol">sym</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46289" title="object GenMSIL.this.global.definitions.NothingClass">NothingClass</a><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">return</span> <span title="String(&quot;scala.runtime.Nothing$&quot;)" class="string">&quot;scala.runtime.Nothing$&quot;</span>
      <span class="keyword">else</span> <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#357964" title="GenMSIL.this.global.Symbol">sym</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46291" title="object GenMSIL.this.global.definitions.NullClass">NullClass</a><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">return</span> <span title="String(&quot;scala.runtime.Null$&quot;)" class="string">&quot;scala.runtime.Null$&quot;</span>

      <span class="delimiter">(</span><span title="implicit scala.Predef.any2stringadd : (x: Any)scala.runtime.StringAdd" class="keyword">if</span> <span class="delimiter">(</span><a href="#357964" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47757" title="=&gt; Boolean">isClass</a> <span title="(x: Boolean)Boolean">||</span> <span class="delimiter">(</span><a href="#357964" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47774" title="=&gt; Boolean">isModule</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#357964" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47773" title="=&gt; Boolean">isMethod</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Object" class="keyword">if</span> <span class="delimiter">(</span><a href="#357964" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47864" title="=&gt; Boolean">isNestedClass</a><span class="delimiter">)</span> <a href="#357964" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#48037" title="=&gt; GenMSIL.this.global.Name">simpleName</a>
        <span class="keyword">else</span> <a href="#357964" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47897" title="=&gt; String">fullName</a>
       <span class="delimiter">}</span> <span class="keyword">else</span>
         <a href="#357964" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#48037" title="=&gt; GenMSIL.this.global.Name">simpleName</a>.<span title="()String">toString</span>.<span title="()String">trim</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(other: String)String">+</span> <a href="#364184" title="String">suffix</a>
    <span class="delimiter">}</span>


    ////////////////////// flags ///////////////////////

    <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)Int" id="357070">msilTypeFlags</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="364210">sym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
      <span class="keyword">var</span> <a title="Int" id="364212">mf</a>: <span title="Int">Int</span> = TypeAttributes.AutoLayout <span title="Int(0)">|</span> TypeAttributes.AnsiClass

      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#364210" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47864" title="=&gt; Boolean">isNestedClass</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#364212" title="Int">mf</a> = <a href="#364212" title="Int">mf</a> <span title="(x: Int)Int">|</span> <span class="delimiter">(</span><span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#364210" title="GenMSIL.this.global.Symbol">sym</a> <a href="../../../../reflect/internal/Symbols.scala.html#47905" title="(mask: Long)Boolean">hasFlag</a> Flags.<span title="Long(4L)">PRIVATE</span><span class="delimiter">)</span> TypeAttributes.<span title="Int(3)">NestedPrivate</span> <span class="keyword">else</span> TypeAttributes.<span title="Int(2)">NestedPublic</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="#364212" title="Int">mf</a> = <a href="#364212" title="Int">mf</a> <span title="(x: Int)Int">|</span> <span class="delimiter">(</span><span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#364210" title="GenMSIL.this.global.Symbol">sym</a> <a href="../../../../reflect/internal/Symbols.scala.html#47905" title="(mask: Long)Boolean">hasFlag</a> Flags.<span title="Long(4L)">PRIVATE</span><span class="delimiter">)</span> TypeAttributes.<span title="Int(0)">NotPublic</span> <span class="keyword">else</span> TypeAttributes.<span title="Int(1)">Public</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#364212" title="Int">mf</a> = <a href="#364212" title="Int">mf</a> <span title="(x: Int)Int">|</span> <span class="delimiter">(</span><span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#364210" title="GenMSIL.this.global.Symbol">sym</a> <a href="../../../../reflect/internal/Symbols.scala.html#47905" title="(mask: Long)Boolean">hasFlag</a> Flags.<span title="Long(8L)">ABSTRACT</span><span class="delimiter">)</span> TypeAttributes.<span title="Int(128)">Abstract</span> <span class="keyword">else</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <a href="#364212" title="Int">mf</a> = <a href="#364212" title="Int">mf</a> <span title="(x: Int)Int">|</span> <span class="delimiter">(</span><span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#364210" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47763" title="=&gt; Boolean">isTrait</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#364210" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47771" title="=&gt; Boolean">isImplClass</a><span class="delimiter">)</span> TypeAttributes.<span title="Int(32)">Interface</span> <span class="keyword">else</span> TypeAttributes.<span title="Int(0)">Class</span><span class="delimiter">)</span>
      <a href="#364212" title="Int">mf</a> = <a href="#364212" title="Int">mf</a> <span title="(x: Int)Int">|</span> <span class="delimiter">(</span><span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#364210" title="GenMSIL.this.global.Symbol">sym</a> <a href="../../../../reflect/internal/HasFlags.scala.html#48079" title="=&gt; Boolean">isFinal</a><span class="delimiter">)</span> TypeAttributes.<span title="Int(256)">Sealed</span> <span class="keyword">else</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>

      <a href="#364210" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47954" title="=&gt; List[GenMSIL.this.global.AnnotationInfo]">annotations</a> <span title="(f: GenMSIL.this.global.AnnotationInfo =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="GenMSIL.this.global.AnnotationInfo" id="364262">a</a> =&gt; <a href="#364262" title="GenMSIL.this.global.AnnotationInfo">a</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="../../../../reflect/internal/AnnotationInfos.scala.html#47274" title="Unit">AnnotationInfo</a><span class="delimiter">(</span><a href="#356977" title="=&gt; GenMSIL.this.global.Type">SerializableAttr</a>, _, _<span class="delimiter">)</span> =&gt;
          // TODO: add the Serializable TypeAttribute also if the annotation
          // System.SerializableAttribute is present (.net annotation, not scala)
          //  Best way to do it: compare with
          //  definitions.getClass(&quot;System.SerializableAttribute&quot;).tpe
          //  when frontend available
          <a href="#364212" title="Int">mf</a> = <a href="#364212" title="Int">mf</a> <span title="(x: Int)Int">|</span> TypeAttributes.<span title="Int(8192)">Serializable</span>
        <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">}</span>

      <a href="#364212" title="Int">mf</a>
      // static: not possible (or?)
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)Short" id="357071">msilMethodFlags</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="364274">sym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="Short">Short</span> = <span class="delimiter">{</span>
      <span class="keyword">var</span> <a title="Int" id="364276">mf</a>: <span title="Int">Int</span> = MethodAttributes.<span title="Short(128)">HideBySig</span> <span title="(x: Short)Int">|</span>
        <span class="delimiter">(</span><span title="Short" class="keyword">if</span> <span class="delimiter">(</span><a href="#364274" title="GenMSIL.this.global.Symbol">sym</a> <a href="../../../../reflect/internal/Symbols.scala.html#47905" title="(mask: Long)Boolean">hasFlag</a> Flags.<span title="Long(4L)">PRIVATE</span><span class="delimiter">)</span> MethodAttributes.<span title="Short(1)">Private</span>
         <span class="keyword">else</span> MethodAttributes.<span title="Short(6)">Public</span><span class="delimiter">)</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#364274" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47802" title="=&gt; Boolean">isClassConstructor</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#364274" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47859" title="=&gt; Boolean">isStaticMember</a><span class="delimiter">)</span>
          <a href="#364276" title="Int">mf</a> = <a href="#364276" title="Int">mf</a> <span title="(x: Short)Int">|</span> FieldAttributes.<span title="Short(16)">Static</span> // coincidentally, same value as for MethodAttributes.Static ...
        <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#364276" title="Int">mf</a> = <a href="#364276" title="Int">mf</a> <span title="(x: Short)Int">|</span> MethodAttributes.<span title="Short(64)">Virtual</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#364274" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/HasFlags.scala.html#48079" title="=&gt; Boolean">isFinal</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#357084" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#364274" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.Symbol">owner</a><span class="delimiter">)</span>.<span title="()Boolean">IsInterface</span><span class="delimiter">)</span>
            <a href="#364276" title="Int">mf</a> = <a href="#364276" title="Int">mf</a> <span title="(x: Short)Int">|</span> MethodAttributes.<span title="Short(32)">Final</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#364274" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/HasFlags.scala.html#48097" title="=&gt; Boolean">isDeferred</a> <span title="(x: Boolean)Boolean">||</span> <a href="#357084" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#364274" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.Symbol">owner</a><span class="delimiter">)</span>.<span title="()Boolean">IsInterface</span><span class="delimiter">)</span>
            <a href="#364276" title="Int">mf</a> = <a href="#364276" title="Int">mf</a> <span title="(x: Short)Int">|</span> MethodAttributes.<span title="Short(1024)">Abstract</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#364274" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47859" title="=&gt; Boolean">isStaticMember</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#364276" title="Int">mf</a> = <a href="#364276" title="Int">mf</a> <span title="(x: Short)Int">|</span> MethodAttributes.<span title="Short(16)">Static</span>
      <span class="delimiter">}</span>

      // constructors of module classes should be private
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#364274" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47851" title="=&gt; Boolean">isPrimaryConstructor</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#357090" title="(sym: GenMSIL.this.global.Symbol)Boolean">isTopLevelModule</a><span class="delimiter">(</span><a href="#364274" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.Symbol">owner</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#364276" title="Int">mf</a> <span title="(x: Short)Int">|=</span> MethodAttributes.<span title="Short(1)">Private</span>
        <a href="#364276" title="Int">mf</a> <span title="(x: Int)Int">&amp;=</span> <span title="=&gt; Int">~</span><span class="delimiter">(</span>MethodAttributes.<span title="Short(6)">Public</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="#364276" title="Int">mf</a>.<span title="=&gt; Short">toShort</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)Short" id="357072">msilFieldFlags</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="364309">sym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="Short">Short</span> = <span class="delimiter">{</span>
      <span class="keyword">var</span> <a title="Int" id="364311">mf</a>: <span title="Int">Int</span> =
        <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#364309" title="GenMSIL.this.global.Symbol">sym</a> <a href="../../../../reflect/internal/Symbols.scala.html#47905" title="(mask: Long)Boolean">hasFlag</a> Flags.<span title="Long(4L)">PRIVATE</span><span class="delimiter">)</span> FieldAttributes.<span title="Int(1)">Private</span>
        <span class="keyword">else</span> <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#364309" title="GenMSIL.this.global.Symbol">sym</a> <a href="../../../../reflect/internal/Symbols.scala.html#47905" title="(mask: Long)Boolean">hasFlag</a> Flags.<span title="Long(1L)">PROTECTED</span><span class="delimiter">)</span> FieldAttributes.<span title="Int(5)">FamORAssem</span>
        <span class="keyword">else</span> FieldAttributes.<span title="Int(6)">Public</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#364309" title="GenMSIL.this.global.Symbol">sym</a> <a href="../../../../reflect/internal/Symbols.scala.html#47905" title="(mask: Long)Boolean">hasFlag</a> Flags.<span title="Long(32L)">FINAL</span><span class="delimiter">)</span>
        <a href="#364311" title="Int">mf</a> = <a href="#364311" title="Int">mf</a> <span title="(x: Short)Int">|</span> FieldAttributes.<span title="Short(32)">InitOnly</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#364309" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47859" title="=&gt; Boolean">isStaticMember</a><span class="delimiter">)</span>
        <a href="#364311" title="Int">mf</a> = <a href="#364311" title="Int">mf</a> <span title="(x: Short)Int">|</span> FieldAttributes.<span title="Short(16)">Static</span>

      // TRANSIENT: &quot;not serialized&quot;, VOLATILE: doesn't exist on .net
      // TODO: add this annotation also if the class has the custom attribute
      // System.NotSerializedAttribute
      <a href="#364309" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47954" title="=&gt; List[GenMSIL.this.global.AnnotationInfo]">annotations</a>.<span title="(f: GenMSIL.this.global.AnnotationInfo =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span> <a title="GenMSIL.this.global.AnnotationInfo" id="364341">a</a> =&gt; <a href="#364341" title="GenMSIL.this.global.AnnotationInfo">a</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="../../../../reflect/internal/AnnotationInfos.scala.html#47274" title="Unit">AnnotationInfo</a><span class="delimiter">(</span><a href="#356981" title="=&gt; GenMSIL.this.global.Type">TransientAtt</a>, _, _<span class="delimiter">)</span> =&gt;
          <a href="#364311" title="Int">mf</a> = <a href="#364311" title="Int">mf</a> <span title="(x: Short)Int">|</span> FieldAttributes.<span title="Short(128)">NotSerialized</span>
        <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>

      <a href="#364311" title="Int">mf</a>.<span title="=&gt; Short">toShort</span>
    <span class="delimiter">}</span>

    ////////////////////// builders, types ///////////////////////

    <span class="keyword">var</span> <a title="GenMSIL.this.global.Symbol" id="357074">entryPoint</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a> = _

    <span class="keyword">val</span> <a title="scala.collection.mutable.HashSet[GenMSIL.this.global.Symbol]" id="357076">notInitializedModules</a> = mutable.<span title="[A](elems: A*)scala.collection.mutable.HashSet[A]">HashSet</span><span title="(elems: GenMSIL.this.global.Symbol*)scala.collection.mutable.HashSet[GenMSIL.this.global.Symbol]" class="delimiter">[</span><a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

    // TODO: create fields also in def createType, and not in genClass,
    // add a getField method (it only works as it is because fields never
    // accessed from outside a class)

    <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.Local,ch.epfl.lamp.compiler.msil.emit.LocalBuilder]" id="357078">localBuilders</a> = mutable.<span title="[A, B](elems: (A, B)*)scala.collection.mutable.HashMap[A,B]">HashMap</span><span title="(elems: (GenMSIL.this.global.icodes.Local, ch.epfl.lamp.compiler.msil.emit.LocalBuilder)*)scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.Local,ch.epfl.lamp.compiler.msil.emit.LocalBuilder]" class="delimiter">[</span><a href="../icode/Members.scala.html#228929" title="GenMSIL.this.global.icodes.Local">Local</a>, <span title="ch.epfl.lamp.compiler.msil.emit.LocalBuilder">LocalBuilder</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">private</span><span class="delimiter">[</span>GenMSIL<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(cls: GenMSIL.this.global.icodes.IClass)Unit" id="357080">findEntryPoint</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IClass" id="357151">cls</a>: <a href="../icode/Members.scala.html#228924" title="GenMSIL.this.global.icodes.IClass">IClass</a><span class="delimiter">)</span> <span class="delimiter">{</span>

      <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)Boolean" id="364353">isEntryPoint</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="364354">sym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>:<span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#357091" title="(sym: GenMSIL.this.global.Symbol)Boolean">isStaticModule</a><span class="delimiter">(</span><a href="#364354" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.Symbol">owner</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#357069" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#364354" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="String(&quot;main&quot;)" class="string">&quot;main&quot;</span><span class="delimiter">)</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#364354" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.Type">tpe</a>.<a href="../../../../reflect/internal/Types.scala.html#42751" title="=&gt; List[GenMSIL.this.global.Type]">paramTypes</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="../icode/TypeKinds.scala.html#228995" title="(t: GenMSIL.this.global.icodes.global.Type)GenMSIL.this.global.icodes.TypeKind">toTypeKind</a><span class="delimiter">(</span><a href="#364354" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.Type">tpe</a>.<a href="../../../../reflect/internal/Types.scala.html#42751" title="(n: Int)GenMSIL.this.global.Type">paramTypes</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <span title="Unit">ARRAY</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="364375">elem</a><span class="delimiter">)</span> =&gt;
                <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#364375" title="GenMSIL.this.global.icodes.TypeKind">elem</a>.<a href="../icode/TypeKinds.scala.html#310923" title="=&gt; GenMSIL.this.global.icodes.global.Type">toType</a>.<a href="../../../../reflect/internal/Types.scala.html#42728" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">typeSymbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46317" title="=&gt; GenMSIL.this.global.Symbol">StringClass</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                  <span title="Nothing" class="keyword">return</span> <span title="Boolean(true)" class="keyword">true</span>
                <span class="delimiter">}</span>
              <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span title="Boolean(false)" class="keyword">false</span>
      <span class="delimiter">}</span>

      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><span class="delimiter">(</span><a href="#357074" title="=&gt; GenMSIL.this.global.Symbol">entryPoint</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="../../Global.scala.html#182909" title="object GenMSIL.this.global.opt">opt</a>.<a href="../../Global.scala.html#229311" title="=&gt; Option[GenMSIL.this.global.Name]">showClass</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <span class="delimiter">{</span>  // TODO introduce dedicated setting instead
        <span class="keyword">val</span> <a title="String" id="364387">entryclass</a> = <a href="../../Global.scala.html#182909" title="object GenMSIL.this.global.opt">opt</a>.<a href="../../Global.scala.html#229311" title="=&gt; Option[GenMSIL.this.global.Name]">showClass</a>.<span title="=&gt; GenMSIL.this.global.Name">get</span>.<span title="()String">toString</span>
        <span class="keyword">val</span> <a title="String" id="364388">cfn</a> = <a href="#357151" title="GenMSIL.this.global.icodes.IClass">cls</a>.<a href="../icode/Members.scala.html#229219" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47897" title="=&gt; String">fullName</a>
        <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#364388" title="String">cfn</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#364387" title="String">entryclass</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IMethod" id="364406">m</a> &lt;- <a href="#357151" title="GenMSIL.this.global.icodes.IClass">cls</a>.<a href="../icode/Members.scala.html#229225" title="(f: GenMSIL.this.global.icodes.IMethod =&gt; Unit)Unit">methods</a>; <span class="keyword">if</span> <a href="#364353" title="(sym: GenMSIL.this.global.Symbol)Boolean">isEntryPoint</a><span class="delimiter">(</span><a href="#364406" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312600" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#357074" title="(x$1: GenMSIL.this.global.Symbol)Unit">entryPoint</a> = <a href="#364406" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312600" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a> <span class="delimiter">}</span>
          <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#357074" title="=&gt; GenMSIL.this.global.Symbol">entryPoint</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="../../Global.scala.html#182891" title="(msg: String)Unit">warning</a><span class="delimiter">(</span><span title="String(&quot;Couldn\'t find main method in class &quot;)" class="string">&quot;Couldn't find main method in class &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#364388" title="String">cfn</a><span class="delimiter">)</span> <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#357005" title="=&gt; String">firstSourceName</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#357151" title="GenMSIL.this.global.icodes.IClass">cls</a>.<a href="../icode/Members.scala.html#229219" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../../../reflect/internal/Symbols.scala.html#48029" title="=&gt; GenMSIL.this.global.icodes.global.AbstractFileType">sourceFile</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> // is null for nested classes
          <a href="#357005" title="(x$1: String)Unit">firstSourceName</a> = <a href="#357151" title="GenMSIL.this.global.icodes.IClass">cls</a>.<a href="../icode/Members.scala.html#229219" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../../../reflect/internal/Symbols.scala.html#48029" title="=&gt; GenMSIL.this.global.icodes.global.AbstractFileType">sourceFile</a>.<a href="../../io/AbstractFile.scala.html#187399" title="=&gt; String">name</a>
    <span class="delimiter">}</span>

    // #####################################################################
    // get and create types

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type" id="357081">msilType</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="360755">t</a>: <a href="../icode/TypeKinds.scala.html#228959" title="GenMSIL.this.global.icodes.TypeKind">TypeKind</a><span class="delimiter">)</span>: <span title="ch.epfl.lamp.compiler.msil.Type">MsilType</span> = <span class="delimiter">(</span><a href="#360755" title="GenMSIL.this.global.icodes.TypeKind">t</a>: @<a href="../icode/TypeKinds.scala.html#228959" title="GenMSIL.this.global.icodes.TypeKind @unchecked">unchecked</a><span class="delimiter">)</span> <span title="ch.epfl.lamp.compiler.msil.Type" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228965" title="ch.epfl.lamp.compiler.msil.Type">UNIT</a>           =&gt; <a href="../../symtab/clr/CLRTypes.scala.html#310610" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MVOID</a>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228967" title="ch.epfl.lamp.compiler.msil.Type">BOOL</a>           =&gt; <a href="../../symtab/clr/CLRTypes.scala.html#310607" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MBOOL</a>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228969" title="ch.epfl.lamp.compiler.msil.Type">BYTE</a>           =&gt; <a href="../../symtab/clr/CLRTypes.scala.html#310574" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MBYTE</a>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228971" title="ch.epfl.lamp.compiler.msil.Type">SHORT</a>          =&gt; <a href="../../symtab/clr/CLRTypes.scala.html#310580" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MSHORT</a>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228973" title="ch.epfl.lamp.compiler.msil.Type">CHAR</a>           =&gt; <a href="../../symtab/clr/CLRTypes.scala.html#310586" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MCHAR</a>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228975" title="ch.epfl.lamp.compiler.msil.Type">INT</a>            =&gt; <a href="../../symtab/clr/CLRTypes.scala.html#310589" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MINT</a>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228977" title="ch.epfl.lamp.compiler.msil.Type">LONG</a>           =&gt; <a href="../../symtab/clr/CLRTypes.scala.html#310595" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MLONG</a>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228979" title="ch.epfl.lamp.compiler.msil.Type">FLOAT</a>          =&gt; <a href="../../symtab/clr/CLRTypes.scala.html#310601" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MFLOAT</a>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228981" title="ch.epfl.lamp.compiler.msil.Type">DOUBLE</a>         =&gt; <a href="../../symtab/clr/CLRTypes.scala.html#310604" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MDOUBLE</a>
      <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.Type">REFERENCE</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="364424">cls</a><span class="delimiter">)</span> =&gt; <a href="#357084" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#364424" title="GenMSIL.this.global.icodes.global.Symbol">cls</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.Type">ARRAY</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.TypeKind" id="364426">elem</a><span class="delimiter">)</span>    =&gt;
        <a href="#357081" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#364426" title="GenMSIL.this.global.icodes.TypeKind">elem</a><span class="delimiter">)</span> <span title="ch.epfl.lamp.compiler.msil.Type" class="keyword">match</span> <span class="delimiter">{</span>
          // For type builders, cannot call &quot;clrTypes.mkArrayType&quot; because this looks up
          // the type &quot;tp&quot; in the assembly (not in the HashMap &quot;types&quot; of the backend).
          // This can fail for nested types because the builders are not complete yet.
          <span class="keyword">case</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="364433">tb</a>: <span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span> =&gt; <a href="#364433" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tb</a>.<span title="()ch.epfl.lamp.compiler.msil.Type">MakeArrayType</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="364434">tp</a>: <span title="ch.epfl.lamp.compiler.msil.Type">MsilType</span> =&gt; <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310666" title="(elemType: ch.epfl.lamp.compiler.msil.Type)ch.epfl.lamp.compiler.msil.Type">mkArrayType</a><span class="delimiter">(</span><a href="#364434" title="ch.epfl.lamp.compiler.msil.Type">tp</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type" id="357082">msilType</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Type" id="360753">tpe</a>: <a href="../../../../reflect/internal/Types.scala.html#40083" title="GenMSIL.this.global.Type">Type</a><span class="delimiter">)</span>: <span title="ch.epfl.lamp.compiler.msil.Type">MsilType</span> = <a href="#357081" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="../icode/TypeKinds.scala.html#228995" title="(t: GenMSIL.this.global.icodes.global.Type)GenMSIL.this.global.icodes.TypeKind">toTypeKind</a><span class="delimiter">(</span><a href="#360753" title="GenMSIL.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)Array[ch.epfl.lamp.compiler.msil.Type]" id="357083">msilParamTypes</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="364441">sym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span class="delimiter">[</span>MsilType<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <a href="#364441" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.Type">tpe</a>.<a href="../../../../reflect/internal/Types.scala.html#42751" title="=&gt; List[GenMSIL.this.global.Type]">paramTypes</a>.<span title="(f: GenMSIL.this.global.Type =&gt; ch.epfl.lamp.compiler.msil.Type)(implicit bf: scala.collection.generic.CanBuildFrom[List[GenMSIL.this.global.Type],ch.epfl.lamp.compiler.msil.Type,List[ch.epfl.lamp.compiler.msil.Type]])List[ch.epfl.lamp.compiler.msil.Type]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,ch.epfl.lamp.compiler.msil.Type,List[ch.epfl.lamp.compiler.msil.Type]]" class="delimiter">(</span><a href="#357082" title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">)</span>.<span title="(implicit evidence$1: ClassManifest[ch.epfl.lamp.compiler.msil.Type])Array[ch.epfl.lamp.compiler.msil.Type]">toArray</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type" id="357084">getType</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="360501">sym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span> = <a href="#357085" title="(sym: GenMSIL.this.global.Symbol)Option[ch.epfl.lamp.compiler.msil.Type]">getTypeOpt</a><span class="delimiter">(</span><a href="#360501" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>.<span title="(default: =&gt; ch.epfl.lamp.compiler.msil.Type)ch.epfl.lamp.compiler.msil.Type">getOrElse</span><span class="delimiter">(</span><a href="../../Global.scala.html#182892" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><a href="#357117" title="(sym: GenMSIL.this.global.Symbol)String">showsym</a><span class="delimiter">(</span><a href="#360501" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

    /**
     * Get an MSIL type from a symbol. First look in the clrTypes.types map, then
     * lookup the name using clrTypes.getType
     */
    <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)Option[ch.epfl.lamp.compiler.msil.Type]" id="357085">getTypeOpt</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="360504">sym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="Option[ch.epfl.lamp.compiler.msil.Type]">Option</span><span class="delimiter">[</span>MsilType<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Option[ch.epfl.lamp.compiler.msil.Type]" id="364516">tmp</a> = <a href="../../symtab/clr/CLRTypes.scala.html#310646" title="=&gt; scala.collection.mutable.Map[GenMSIL.this.global.loaders.clrTypes.global.Symbol,ch.epfl.lamp.compiler.msil.Type]">types</a>.<span title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)Option[ch.epfl.lamp.compiler.msil.Type]">get</span><span class="delimiter">(</span><a href="#360504" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>
      <a href="#364516" title="Option[ch.epfl.lamp.compiler.msil.Type]">tmp</a> <span title="Option[ch.epfl.lamp.compiler.msil.Type]" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Some[ch.epfl.lamp.compiler.msil.Type]" id="364519">typ</a> @ Some<span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt; <a href="#364519" title="Some[ch.epfl.lamp.compiler.msil.Type]">typ</a>
        <span class="keyword">case</span> <span title="Option[ch.epfl.lamp.compiler.msil.Type]">None</span> =&gt;
          <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)String" id="364521">typeString</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="364524">sym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="String" id="364525">s</a> = <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#364524" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47864" title="=&gt; Boolean">isNestedClass</a><span class="delimiter">)</span> <a href="#364521" title="(sym: GenMSIL.this.global.Symbol)String">typeString</a><span class="delimiter">(</span><a href="#364524" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.Symbol">owner</a><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span><span title="String(&quot;+&quot;)" class="string">&quot;+&quot;</span><span title="(x$1: Any)String">+</span> <a href="#364524" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#48037" title="=&gt; GenMSIL.this.global.Name">simpleName</a>
                    <span class="keyword">else</span> <a href="#364524" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47897" title="=&gt; String">fullName</a>
            <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#364524" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47775" title="=&gt; Boolean">isModuleClass</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#364524" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47763" title="=&gt; Boolean">isTrait</a><span class="delimiter">)</span> <a href="#364525" title="String">s</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;$&quot;)" class="string">&quot;$&quot;</span> <span class="keyword">else</span> <a href="#364525" title="String">s</a>
          <span class="delimiter">}</span>
          <span class="keyword">val</span> <a title="String" id="364522">name</a> = <a href="#364521" title="(sym: GenMSIL.this.global.Symbol)String">typeString</a><span class="delimiter">(</span><a href="#360504" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="364523">typ</a> = <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310664" title="(name: String)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#364522" title="String">name</a><span class="delimiter">)</span>
          <span title="Option[ch.epfl.lamp.compiler.msil.Type]" class="keyword">if</span> <span class="delimiter">(</span><a href="#364523" title="ch.epfl.lamp.compiler.msil.Type">typ</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
            <span title="object None">None</span>
          <span class="keyword">else</span> <span class="delimiter">{</span>
            <a href="../../symtab/clr/CLRTypes.scala.html#310646" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol, value: ch.epfl.lamp.compiler.msil.Type)Unit">types</a><span class="delimiter">(</span><a href="#360504" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span> = <a href="#364523" title="ch.epfl.lamp.compiler.msil.Type">typ</a>
            <span title="(x: ch.epfl.lamp.compiler.msil.Type)Some[ch.epfl.lamp.compiler.msil.Type]">Some</span><span class="delimiter">(</span><a href="#364523" title="ch.epfl.lamp.compiler.msil.Type">typ</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit" id="357086">mapType</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="357945">sym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a>, <a title="ch.epfl.lamp.compiler.msil.Type" id="357946">mType</a>: <span title="ch.epfl.lamp.compiler.msil.Type">MsilType</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#357946" title="ch.epfl.lamp.compiler.msil.Type">mType</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span>, <a href="#357117" title="(sym: GenMSIL.this.global.Symbol)String">showsym</a><span class="delimiter">(</span><a href="#357945" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="../../symtab/clr/CLRTypes.scala.html#310646" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol, value: ch.epfl.lamp.compiler.msil.Type)Unit">types</a><span class="delimiter">(</span><a href="#357945" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span> = <a href="#357946" title="ch.epfl.lamp.compiler.msil.Type">mType</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(iclass: GenMSIL.this.global.icodes.IClass)Unit" id="357087">createTypeBuilder</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IClass" id="357250">iclass</a>: <a href="../icode/Members.scala.html#228924" title="GenMSIL.this.global.icodes.IClass">IClass</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      /**
       * First look in the clrTypes.types map, if that fails check if it's a class being compiled, otherwise
       * lookup by name (clrTypes.getType calls the static method msil.Type.GetType(fullname)).
       */
      <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type" id="364543">msilTypeFromSym</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="364551">sym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="ch.epfl.lamp.compiler.msil.Type">MsilType</span> = <span class="delimiter">{</span>
        <a href="../../symtab/clr/CLRTypes.scala.html#310646" title="=&gt; scala.collection.mutable.Map[GenMSIL.this.global.loaders.clrTypes.global.Symbol,ch.epfl.lamp.compiler.msil.Type]">types</a>.<span title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)Option[ch.epfl.lamp.compiler.msil.Type]">get</span><span class="delimiter">(</span><a href="#364551" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>.<span title="(default: =&gt; ch.epfl.lamp.compiler.msil.Type)ch.epfl.lamp.compiler.msil.Type">getOrElse</span> <span class="delimiter">{</span>
          <a href="../icode/ICodes.scala.html#228877" title="=&gt; scala.collection.mutable.HashMap[GenMSIL.this.global.icodes.global.Symbol,GenMSIL.this.global.icodes.IClass]">classes</a>.<span title="(key: GenMSIL.this.global.icodes.global.Symbol)Option[GenMSIL.this.global.icodes.IClass]">get</span><span class="delimiter">(</span><a href="#364551" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span> <span title="ch.epfl.lamp.compiler.msil.Type" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">Some</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IClass" id="364558">iclass</a><span class="delimiter">)</span> =&gt;
	              <a href="#364544" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.emit.TypeBuilder">msilTypeBuilderFromSym</a><span class="delimiter">(</span><a href="#364551" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>
            <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.Type">None</span> =&gt;
              <a href="#357084" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#364551" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.emit.TypeBuilder" id="364544">msilTypeBuilderFromSym</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="364559">sym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span> = <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><span class="delimiter">(</span><a href="../../symtab/clr/CLRTypes.scala.html#310646" title="=&gt; scala.collection.mutable.Map[GenMSIL.this.global.loaders.clrTypes.global.Symbol,ch.epfl.lamp.compiler.msil.Type]">types</a>.<span title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)Boolean">contains</span><span class="delimiter">(</span><a href="#364559" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="../../symtab/clr/CLRTypes.scala.html#310646" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)ch.epfl.lamp.compiler.msil.Type">types</a><span class="delimiter">(</span><a href="#364559" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.IClass" id="364578">iclass</a> = <a href="../icode/ICodes.scala.html#228877" title="(key: GenMSIL.this.global.icodes.global.Symbol)GenMSIL.this.global.icodes.IClass">classes</a><span class="delimiter">(</span><a href="#364559" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>
          <span title="(assertion: Boolean)Unit">assert</span><span class="delimiter">(</span><a href="#364578" title="GenMSIL.this.global.icodes.IClass">iclass</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
          <a href="#357087" title="(iclass: GenMSIL.this.global.icodes.IClass)Unit">createTypeBuilder</a><span class="delimiter">(</span><a href="#364578" title="GenMSIL.this.global.icodes.IClass">iclass</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="../../symtab/clr/CLRTypes.scala.html#310646" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)ch.epfl.lamp.compiler.msil.Type">types</a><span class="delimiter">(</span><a href="#364559" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" class="delimiter">[</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span><span class="delimiter">]</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.global.Symbol" id="364545">sym</a> = <a href="#357250" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#229219" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../symtab/clr/CLRTypes.scala.html#310646" title="=&gt; scala.collection.mutable.Map[GenMSIL.this.global.loaders.clrTypes.global.Symbol,ch.epfl.lamp.compiler.msil.Type]">types</a>.<span title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)Boolean">contains</span><span class="delimiter">(</span><a href="#364545" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="../../symtab/clr/CLRTypes.scala.html#310646" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)ch.epfl.lamp.compiler.msil.Type">types</a><span class="delimiter">(</span><a href="#364545" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span><span class="delimiter">]</span><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">return</span>

      <span class="keyword">def</span> <a title="(s: GenMSIL.this.global.Symbol)Boolean" id="364546">isInterface</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="364634">s</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span> = <a href="#364634" title="GenMSIL.this.global.Symbol">s</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47763" title="=&gt; Boolean">isTrait</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#364634" title="GenMSIL.this.global.Symbol">s</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47771" title="=&gt; Boolean">isImplClass</a>
      <span class="keyword">val</span> <a title="List[GenMSIL.this.global.Type]" id="364547">parents</a>: <span title="List[GenMSIL.this.global.Type]">List</span><span class="delimiter">[</span>Type<span class="delimiter">]</span> =
        <span title="List[GenMSIL.this.global.Type]" class="keyword">if</span> <span class="delimiter">(</span><a href="#364545" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47920" title="=&gt; GenMSIL.this.global.icodes.global.Type">info</a>.<a href="../../../../reflect/internal/Types.scala.html#42737" title="=&gt; List[GenMSIL.this.global.icodes.global.Type]">parents</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span title="(xs: GenMSIL.this.global.Type*)List[GenMSIL.this.global.Type]">List</span><span class="delimiter">(</span><a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46278" title="=&gt; GenMSIL.this.global.Symbol">ObjectClass</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.Type">tpe</a><span class="delimiter">)</span>
        <span class="keyword">else</span> <a href="#364545" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47920" title="=&gt; GenMSIL.this.global.icodes.global.Type">info</a>.<a href="../../../../reflect/internal/Types.scala.html#42737" title="=&gt; List[GenMSIL.this.global.icodes.global.Type]">parents</a>.<span title="=&gt; List[GenMSIL.this.global.icodes.global.Type]">distinct</span>

      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="364548">superType</a> : <span title="ch.epfl.lamp.compiler.msil.Type">MsilType</span> = <span title="ch.epfl.lamp.compiler.msil.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="#364546" title="(s: GenMSIL.this.global.Symbol)Boolean">isInterface</a><span class="delimiter">(</span><a href="#364545" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="Null(null)" class="keyword">null</span> <span class="keyword">else</span> <a href="#364543" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">msilTypeFromSym</a><span class="delimiter">(</span><a href="#364547" title="List[GenMSIL.this.global.Type]">parents</a>.<span title="=&gt; GenMSIL.this.global.Type">head</span>.<a href="../../../../reflect/internal/Types.scala.html#42728" title="=&gt; GenMSIL.this.global.Symbol">typeSymbol</a><span class="delimiter">)</span>
      <a href="../../Global.scala.html#182894" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;super type: &quot;)" class="string">&quot;super type: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#364547" title="(n: Int)GenMSIL.this.global.Type">parents</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<a href="../../../../reflect/internal/Types.scala.html#42728" title="=&gt; GenMSIL.this.global.Symbol">typeSymbol</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;, msil type: &quot;)" class="string">&quot;, msil type: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#364548" title="ch.epfl.lamp.compiler.msil.Type">superType</a><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="Array[ch.epfl.lamp.compiler.msil.Type]" id="364549">interfaces</a>: <span title="Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span class="delimiter">[</span>MsilType<span class="delimiter">]</span> =
	<a href="#364547" title="List[GenMSIL.this.global.Type]">parents</a>.<span title="=&gt; List[GenMSIL.this.global.Type]">tail</span>.<span title="(f: GenMSIL.this.global.Type =&gt; ch.epfl.lamp.compiler.msil.Type)(implicit bf: scala.collection.generic.CanBuildFrom[List[GenMSIL.this.global.Type],ch.epfl.lamp.compiler.msil.Type,List[ch.epfl.lamp.compiler.msil.Type]])List[ch.epfl.lamp.compiler.msil.Type]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,ch.epfl.lamp.compiler.msil.Type,List[ch.epfl.lamp.compiler.msil.Type]]" class="delimiter">(</span><a title="GenMSIL.this.global.Type" id="364676">p</a> =&gt; <a href="#364543" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">msilTypeFromSym</a><span class="delimiter">(</span><a href="#364676" title="GenMSIL.this.global.Type">p</a>.<a href="../../../../reflect/internal/Types.scala.html#42728" title="=&gt; GenMSIL.this.global.Symbol">typeSymbol</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(implicit evidence$1: ClassManifest[ch.epfl.lamp.compiler.msil.Type])Array[ch.epfl.lamp.compiler.msil.Type]">toArray</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#364547" title="List[GenMSIL.this.global.Type]">parents</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Global.scala.html#182849" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../../settings/ScalaSettings.scala.html#183452" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">debug</a>.<a href="../../settings/MutableSettings.scala.html#183734" title="=&gt; Boolean">value</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="../../Global.scala.html#182904" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="String(&quot;interfaces:&quot;)" class="string">&quot;interfaces:&quot;</span><span class="delimiter">)</span>
          <span class="keyword">for</span> <span class="delimiter">(</span><a title="Int" id="364829">i</a> &lt;- <span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span>.<span title="(end: Int)scala.collection.immutable.Range">until</span><span title="(f: Int =&gt; Unit)Unit" class="delimiter">(</span><a href="#364549" title="Array[ch.epfl.lamp.compiler.msil.Type]">interfaces</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="../../Global.scala.html#182904" title="(msg: =&gt; AnyRef)Unit">log</a><span class="delimiter">(</span><span title="String(&quot;  type: &quot;)" class="string">&quot;  type: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#364547" title="(n: Int)GenMSIL.this.global.Type">parents</a><span class="delimiter">(</span><a href="#364829" title="Int">i</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>.<a href="../../../../reflect/internal/Types.scala.html#42728" title="=&gt; GenMSIL.this.global.Symbol">typeSymbol</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;, msil type: &quot;)" class="string">&quot;, msil type: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#364549" title="(i: Int)ch.epfl.lamp.compiler.msil.Type">interfaces</a><span class="delimiter">(</span><a href="#364829" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" id="364550">tBuilder</a> = <span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" class="keyword">if</span> <span class="delimiter">(</span><a href="#364545" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47864" title="=&gt; Boolean">isNestedClass</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" id="364843">ownerT</a> = <a href="#364544" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.emit.TypeBuilder">msilTypeBuilderFromSym</a><span class="delimiter">(</span><a href="#364545" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">owner</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" class="delimiter">[</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span><span class="delimiter">]</span>
        <a href="#364843" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">ownerT</a>.<span title="(name: String, attributes: Int, baseType: ch.epfl.lamp.compiler.msil.Type, interfaces: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.emit.TypeBuilder">DefineNestedType</span><span class="delimiter">(</span><a href="#357069" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#364545" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>, <a href="#357070" title="(sym: GenMSIL.this.global.Symbol)Int">msilTypeFlags</a><span class="delimiter">(</span><a href="#364545" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>, <a href="#364548" title="ch.epfl.lamp.compiler.msil.Type">superType</a>, <a href="#364549" title="Array[ch.epfl.lamp.compiler.msil.Type]">interfaces</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="#356996" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ModuleBuilder">mmodule</a>.<span title="(typeName: String, attributes: Int, baseType: ch.epfl.lamp.compiler.msil.Type, interfaces: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.emit.TypeBuilder">DefineType</span><span class="delimiter">(</span><a href="#357069" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#364545" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>, <a href="#357070" title="(sym: GenMSIL.this.global.Symbol)Int">msilTypeFlags</a><span class="delimiter">(</span><a href="#364545" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>, <a href="#364548" title="ch.epfl.lamp.compiler.msil.Type">superType</a>, <a href="#364549" title="Array[ch.epfl.lamp.compiler.msil.Type]">interfaces</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#357086" title="(sym: GenMSIL.this.global.Symbol, mType: ch.epfl.lamp.compiler.msil.Type)Unit">mapType</a><span class="delimiter">(</span><a href="#364545" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>, <a href="#364550" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> // createTypeBuilder

    <span class="keyword">def</span> <a title="(iclass: GenMSIL.this.global.icodes.IClass)Unit" id="357088">createClassMembers</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IClass" id="357265">iclass</a>: <a href="../icode/Members.scala.html#228924" title="GenMSIL.this.global.icodes.IClass">IClass</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">try</span> <span class="delimiter">{</span>
        <a href="#357089" title="(iclass: GenMSIL.this.global.icodes.IClass)Unit">createClassMembers0</a><span class="delimiter">(</span><a href="#357265" title="GenMSIL.this.global.icodes.IClass">iclass</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">catch</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Nothing" id="364848">e</a>: <span title="Throwable">Throwable</span> =&gt;
          java.lang.<span title="object System">System</span>.<span title="java.io.PrintStream">err</span>.<span title="(x$1: String)Unit">println</span><span class="delimiter">(</span><a href="#357117" title="(sym: GenMSIL.this.global.Symbol)String">showsym</a><span class="delimiter">(</span><a href="#357265" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#229219" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a><span class="delimiter">)</span><span class="delimiter">)</span>
          java.lang.<span title="object System">System</span>.<span title="java.io.PrintStream">err</span>.<span title="(x$1: String)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;with methods = &quot;)" class="string">&quot;with methods = &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#357265" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#229225" title="=&gt; List[GenMSIL.this.global.icodes.IMethod]">methods</a><span class="delimiter">)</span>
          <span title="Nothing" class="keyword">throw</span> <a href="#364848" title="Throwable">e</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(iclass: GenMSIL.this.global.icodes.IClass)Unit" id="357089">createClassMembers0</a><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IClass" id="364846">iclass</a>: <a href="../icode/Members.scala.html#228924" title="GenMSIL.this.global.icodes.IClass">IClass</a><span class="delimiter">)</span> <span class="delimiter">{</span>

      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" id="364857">mtype</a> = <a href="#357084" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#364846" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#229219" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" class="delimiter">[</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span><span class="delimiter">]</span>

      <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IField" id="364883">ifield</a> &lt;- <a href="#364846" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#229222" title="(f: GenMSIL.this.global.icodes.IField =&gt; Unit)Unit">fields</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.global.Symbol" id="364884">sym</a> = <a href="#364883" title="GenMSIL.this.global.icodes.IField">ifield</a>.<a href="../icode/Members.scala.html#325111" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>
        <a href="../../Global.scala.html#182894" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;Adding field: &quot;)" class="string">&quot;Adding field: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#364884" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47897" title="=&gt; String">fullName</a><span class="delimiter">)</span>

        <span class="keyword">var</span> <a title="Short" id="364885">attributes</a> = <a href="#357072" title="(sym: GenMSIL.this.global.Symbol)Short">msilFieldFlags</a><span class="delimiter">(</span><a href="#364884" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.util.PECustomMod" id="364886">fieldTypeWithCustomMods</a> =
          <span title="ch.epfl.lamp.compiler.msil.util.PECustomMod" class="keyword">new</span> <span title="ch.epfl.lamp.compiler.msil.util.PECustomMod">PECustomMod</span><span class="delimiter">(</span><a href="#357082" title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#364884" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.icodes.global.Type">tpe</a><span class="delimiter">)</span>,
                          <a href="#357019" title="(annotations: List[GenMSIL.this.global.AnnotationInfo])Array[ch.epfl.lamp.compiler.msil.CustomModifier]">customModifiers</a><span class="delimiter">(</span><a href="#364884" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47954" title="=&gt; List[GenMSIL.this.global.icodes.global.AnnotationInfo]">annotations</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.FieldBuilder" id="364887">fBuilder</a> = <a href="#364857" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">mtype</a>.<span title="(name: String, fieldTypeWithMods: ch.epfl.lamp.compiler.msil.util.PECustomMod, attrs: Short)ch.epfl.lamp.compiler.msil.emit.FieldBuilder">DefineField</span><span class="delimiter">(</span><a href="#357069" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#364884" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>,
                                         <a href="#364886" title="ch.epfl.lamp.compiler.msil.util.PECustomMod">fieldTypeWithCustomMods</a>,
                                         <a href="#364885" title="Short">attributes</a><span class="delimiter">)</span>
        <a href="../../symtab/clr/CLRTypes.scala.html#310652" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol, value: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">fields</a><span class="delimiter">(</span><a href="#364884" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span> = <a href="#364887" title="ch.epfl.lamp.compiler.msil.emit.FieldBuilder">fBuilder</a>
        <a href="#357018" title="(member: ch.epfl.lamp.compiler.msil.emit.ICustomAttributeSetter, annotations: List[GenMSIL.this.global.AnnotationInfo])Unit">addAttributes</a><span class="delimiter">(</span><a href="#364887" title="ch.epfl.lamp.compiler.msil.emit.FieldBuilder">fBuilder</a>, <a href="#364884" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47954" title="=&gt; List[GenMSIL.this.global.icodes.global.AnnotationInfo]">annotations</a><span class="delimiter">)</span>
      <span class="delimiter">}</span> // all iclass.fields iterated over

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#357091" title="(sym: GenMSIL.this.global.Symbol)Boolean">isStaticModule</a><span class="delimiter">(</span><a href="#364846" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#229219" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Option[GenMSIL.this.global.icodes.IMethod]" id="364903">sc</a> = <a href="#364846" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#229238" title="=&gt; Option[GenMSIL.this.global.icodes.IMethod]">lookupStaticCtor</a>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#364903" title="Option[GenMSIL.this.global.icodes.IMethod]">sc</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.IMethod" id="364904">m</a> = <a href="#364903" title="Option[GenMSIL.this.global.icodes.IMethod]">sc</a>.<span title="=&gt; GenMSIL.this.global.icodes.IMethod">get</span>
          <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.BasicBlock" id="364905">oldLastBlock</a> = <a href="#364904" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312608" title="=&gt; GenMSIL.this.global.icodes.BasicBlock">lastBlock</a>
          <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.BasicBlock" id="364906">lastBlock</a> = <a href="#364904" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312606" title="()GenMSIL.this.global.icodes.BasicBlock">newBlock</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#364905" title="GenMSIL.this.global.icodes.BasicBlock">oldLastBlock</a>.<a href="../icode/BasicBlocks.scala.html#312554" title="(pos: Int, instr: GenMSIL.this.global.icodes.Instruction)Boolean">replaceInstruction</a><span class="delimiter">(</span><a href="#364905" title="GenMSIL.this.global.icodes.BasicBlock">oldLastBlock</a>.<a href="../icode/BasicBlocks.scala.html#312551" title="=&gt; Int">length</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span>, <a href="../icode/Opcodes.scala.html#317981" title="(whereto: GenMSIL.this.global.icodes.BasicBlock)GenMSIL.this.global.icodes.opcodes.JUMP">JUMP</a><span class="delimiter">(</span><a href="#364906" title="GenMSIL.this.global.icodes.BasicBlock">lastBlock</a><span class="delimiter">)</span><span class="delimiter">)</span>
          // call object's private ctor from static ctor
          <a href="#364906" title="GenMSIL.this.global.icodes.BasicBlock">lastBlock</a>.<a href="../icode/BasicBlocks.scala.html#312561" title="(instr: GenMSIL.this.global.icodes.Instruction)Unit">emit</a><span class="delimiter">(</span><a href="../icode/Opcodes.scala.html#323401" title="(method: GenMSIL.this.global.icodes.global.Symbol)GenMSIL.this.global.icodes.opcodes.CIL_NEWOBJ">CIL_NEWOBJ</a><span class="delimiter">(</span><a href="#364846" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#229219" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47977" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">primaryConstructor</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#364906" title="GenMSIL.this.global.icodes.BasicBlock">lastBlock</a>.<a href="../icode/BasicBlocks.scala.html#312561" title="(instr: GenMSIL.this.global.icodes.Instruction)Unit">emit</a><span class="delimiter">(</span><a href="../icode/Opcodes.scala.html#321656" title="(typ: GenMSIL.this.global.icodes.TypeKind)GenMSIL.this.global.icodes.opcodes.DROP">DROP</a><span class="delimiter">(</span><a href="../icode/TypeKinds.scala.html#228995" title="(t: GenMSIL.this.global.icodes.global.Type)GenMSIL.this.global.icodes.TypeKind">toTypeKind</a><span class="delimiter">(</span><a href="#364846" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#229219" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.icodes.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#364906" title="GenMSIL.this.global.icodes.BasicBlock">lastBlock</a> <a href="../icode/BasicBlocks.scala.html#312561" title="(instr: GenMSIL.this.global.icodes.Instruction)Unit">emit</a> <a href="../icode/Opcodes.scala.html#318012" title="(kind: GenMSIL.this.global.icodes.TypeKind)GenMSIL.this.global.icodes.opcodes.RETURN">RETURN</a><span class="delimiter">(</span><a href="../icode/TypeKinds.scala.html#228965" title="object GenMSIL.this.global.icodes.UNIT">UNIT</a><span class="delimiter">)</span>
          <a href="#364906" title="GenMSIL.this.global.icodes.BasicBlock">lastBlock</a>.<a href="../icode/BasicBlocks.scala.html#312567" title="()Unit">close</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#364846" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#229219" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46442" title="=&gt; GenMSIL.this.global.Symbol">ArrayClass</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.IMethod" id="364970">m</a>: <a href="../icode/Members.scala.html#228928" title="GenMSIL.this.global.icodes.IMethod">IMethod</a> &lt;- <a href="#364846" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#229225" title="(f: GenMSIL.this.global.icodes.IMethod =&gt; Unit)Unit">methods</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.global.Symbol" id="364971">sym</a> = <a href="#364970" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312600" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>
        <a href="../../Global.scala.html#182894" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;Creating MethodBuilder for &quot;)" class="string">&quot;Creating MethodBuilder for &quot;</span> <span title="(x$1: Any)String">+</span> <a href="../../symtab/package.scala.html#36230" title="=&gt; reflect.internal.Flags.type">Flags</a>.<a href="../../../../reflect/internal/Flags.scala.html#39895" title="(flags: Long)String">flagsToString</a><span class="delimiter">(</span><a href="#364971" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47898" title="=&gt; Long">flags</a><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)String">+</span>
              <a href="#364971" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">owner</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47897" title="=&gt; String">fullName</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;::&quot;)" class="string">&quot;::&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#364971" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47883" title="=&gt; GenMSIL.this.global.icodes.global.Name">name</a><span class="delimiter">)</span>

        <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" id="364972">ownerType</a> = <a href="#357084" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#364971" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47975" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">enclClass</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" class="delimiter">[</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span><span class="delimiter">]</span>
        <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#364857" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">mtype</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#364972" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">ownerType</a>, <span title="String(&quot;mtype = &quot;)" class="string">&quot;mtype = &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#364857" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">mtype</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;; ownerType = &quot;)" class="string">&quot;; ownerType = &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#364972" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">ownerType</a><span class="delimiter">)</span>
        <span class="keyword">var</span> <a title="Array[ch.epfl.lamp.compiler.msil.Type]" id="364973">paramTypes</a> = <a href="#357083" title="(sym: GenMSIL.this.global.Symbol)Array[ch.epfl.lamp.compiler.msil.Type]">msilParamTypes</a><span class="delimiter">(</span><a href="#364971" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Short" id="364974">attr</a> = <a href="#357071" title="(sym: GenMSIL.this.global.Symbol)Short">msilMethodFlags</a><span class="delimiter">(</span><a href="#364971" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>

        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#364970" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312600" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47802" title="=&gt; Boolean">isClassConstructor</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.ConstructorBuilder" id="364986">constr</a> =
            <a href="#364972" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">ownerType</a>.<span title="(attrs: Short, callingConvention: Short, paramTypes: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.emit.ConstructorBuilder">DefineConstructor</span><span class="delimiter">(</span><a href="#364974" title="Short">attr</a>, CallingConventions.<span title="Short(1)">Standard</span>, <a href="#364973" title="Array[ch.epfl.lamp.compiler.msil.Type]">paramTypes</a><span class="delimiter">)</span>
          <span class="keyword">for</span> <span class="delimiter">(</span><a title="Int" id="365093">i</a> &lt;- <span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span>.<span title="(end: Int)scala.collection.immutable.Range">until</span><span title="(f: Int =&gt; ch.epfl.lamp.compiler.msil.emit.ParameterBuilder)Unit" class="delimiter">(</span><a href="#364973" title="Array[ch.epfl.lamp.compiler.msil.Type]">paramTypes</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#364986" title="ch.epfl.lamp.compiler.msil.emit.ConstructorBuilder">constr</a>.<span title="(pos: Int, attr: Int, name: String)ch.epfl.lamp.compiler.msil.emit.ParameterBuilder">DefineParameter</span><span class="delimiter">(</span><a href="#365093" title="Int">i</a>, ParameterAttributes.<span title="Int(0)">None</span>, <a href="#357069" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#364970" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312635" title="(n: Int)GenMSIL.this.global.icodes.Local">params</a><span class="delimiter">(</span><a href="#365093" title="Int">i</a><span class="delimiter">)</span>.<a href="../icode/Members.scala.html#313047" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <a href="#357109" title="(sym: GenMSIL.this.global.Symbol, cInfo: ch.epfl.lamp.compiler.msil.ConstructorInfo)Unit">mapConstructor</a><span class="delimiter">(</span><a href="#364971" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>, <a href="#364986" title="ch.epfl.lamp.compiler.msil.emit.ConstructorBuilder">constr</a><span class="delimiter">)</span>
          <a href="#357018" title="(member: ch.epfl.lamp.compiler.msil.emit.ICustomAttributeSetter, annotations: List[GenMSIL.this.global.AnnotationInfo])Unit">addAttributes</a><span class="delimiter">(</span><a href="#364986" title="ch.epfl.lamp.compiler.msil.emit.ConstructorBuilder">constr</a>, <a href="#364971" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47954" title="=&gt; List[GenMSIL.this.global.icodes.global.AnnotationInfo]">annotations</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">var</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="365109">resType</a> = <a href="#357081" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#364970" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312626" title="=&gt; GenMSIL.this.global.icodes.TypeKind">returnType</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder" id="365110">method</a> =
            <a href="#364972" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">ownerType</a>.<span title="(name: String, attrs: Short, returnType: ch.epfl.lamp.compiler.msil.Type, paramTypes: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.emit.MethodBuilder">DefineMethod</span><span class="delimiter">(</span><a href="#357069" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#364971" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span>, <a href="#364974" title="Short">attr</a>, <a href="#365109" title="ch.epfl.lamp.compiler.msil.Type">resType</a>, <a href="#364973" title="Array[ch.epfl.lamp.compiler.msil.Type]">paramTypes</a><span class="delimiter">)</span>
          <span class="keyword">for</span> <span class="delimiter">(</span><a title="Int" id="365216">i</a> &lt;- <span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span>.<span title="(end: Int)scala.collection.immutable.Range">until</span><span title="(f: Int =&gt; ch.epfl.lamp.compiler.msil.emit.ParameterBuilder)Unit" class="delimiter">(</span><a href="#364973" title="Array[ch.epfl.lamp.compiler.msil.Type]">paramTypes</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#365110" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">method</a>.<span title="(pos: Int, attr: Int, name: String)ch.epfl.lamp.compiler.msil.emit.ParameterBuilder">DefineParameter</span><span class="delimiter">(</span><a href="#365216" title="Int">i</a>, ParameterAttributes.<span title="Int(0)">None</span>, <a href="#357069" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#364970" title="GenMSIL.this.global.icodes.IMethod">m</a>.<a href="../icode/Members.scala.html#312635" title="(n: Int)GenMSIL.this.global.icodes.Local">params</a><span class="delimiter">(</span><a href="#365216" title="Int">i</a><span class="delimiter">)</span>.<a href="../icode/Members.scala.html#313047" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="../../symtab/clr/CLRTypes.scala.html#310650" title="=&gt; scala.collection.mutable.Map[GenMSIL.this.global.loaders.clrTypes.global.Symbol,ch.epfl.lamp.compiler.msil.MethodInfo]">methods</a>.<span title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)Boolean">contains</span><span class="delimiter">(</span><a href="#364971" title="GenMSIL.this.global.icodes.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#357111" title="(sym: GenMSIL.this.global.Symbol, mInfo: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">mapMethod</a><span class="delimiter">(</span><a href="#364971" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>, <a href="#365110" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">method</a><span class="delimiter">)</span>
          <a href="#357018" title="(member: ch.epfl.lamp.compiler.msil.emit.ICustomAttributeSetter, annotations: List[GenMSIL.this.global.AnnotationInfo])Unit">addAttributes</a><span class="delimiter">(</span><a href="#365110" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">method</a>, <a href="#364971" title="GenMSIL.this.global.icodes.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47954" title="=&gt; List[GenMSIL.this.global.icodes.global.AnnotationInfo]">annotations</a><span class="delimiter">)</span>
          <a href="../../Global.scala.html#182894" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;\t created MethodBuilder &quot;)" class="string">&quot;\t created MethodBuilder &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#365110" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">method</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
      <span class="delimiter">}</span> // method builders created for non-array iclass

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#357091" title="(sym: GenMSIL.this.global.Symbol)Boolean">isStaticModule</a><span class="delimiter">(</span><a href="#364846" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#229219" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#357093" title="(sym: GenMSIL.this.global.Symbol)Unit">addModuleInstanceField</a><span class="delimiter">(</span><a href="#364846" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#229219" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a><span class="delimiter">)</span>
        <a href="#357076" title="=&gt; scala.collection.mutable.HashSet[GenMSIL.this.global.Symbol]">notInitializedModules</a> <span title="(elem: GenMSIL.this.global.Symbol)BytecodeGenerator.this.notInitializedModules.type">+=</span> <a href="#364846" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#229219" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#364846" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#229238" title="=&gt; Option[GenMSIL.this.global.icodes.IMethod]">lookupStaticCtor</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#357096" title="(sym: GenMSIL.this.global.Symbol)Unit">addStaticInit</a><span class="delimiter">(</span><a href="#364846" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#229219" title="=&gt; GenMSIL.this.global.icodes.global.Symbol">symbol</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    <span class="delimiter">}</span> // createClassMembers0

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)Boolean" id="357090">isTopLevelModule</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="360567">sym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> =
      <a href="../../../../reflect/internal/SymbolTable.scala.html#36972" title="(ph: scala.reflect.internal.Phase)(op: =&gt; Boolean)Boolean">atPhase</a> <span class="delimiter">(</span><a href="../../Global.scala.html#183023" title="=&gt; GenMSIL.this.global.Run">currentRun</a>.<a href="../../Global.scala.html#185231" title="=&gt; scala.tools.nsc.Phase">refchecksPhase</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#360567" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47775" title="=&gt; Boolean">isModuleClass</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#360567" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47771" title="=&gt; Boolean">isImplClass</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#360567" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47864" title="=&gt; Boolean">isNestedClass</a>
      <span class="delimiter">}</span>

    // if the module is lifted it does not need to be initialized in
    // its static constructor, and the MODULE$ field is not required.
    // the outer class will care about it.
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)Boolean" id="357091">isStaticModule</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="362229">sym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
      // .net inner classes: removed '!sym.hasFlag(Flags.LIFTED)', added
      // 'sym.isStatic'. -&gt; no longer compatible without skipping flatten!
      <a href="#362229" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47775" title="=&gt; Boolean">isModuleClass</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#362229" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47857" title="=&gt; Boolean">isStatic</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#362229" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47771" title="=&gt; Boolean">isImplClass</a>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)Boolean" id="357092">isCloneable</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="360515">sym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> = <span class="delimiter">{</span>
      <span title="=&gt; Boolean">!</span><a href="#360515" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47954" title="=&gt; List[GenMSIL.this.global.AnnotationInfo]">annotations</a>.<span title="(p: GenMSIL.this.global.AnnotationInfo =&gt; Boolean)Boolean">forall</span><span class="delimiter">(</span> <a title="GenMSIL.this.global.AnnotationInfo" id="365286">a</a> =&gt; <a href="#365286" title="GenMSIL.this.global.AnnotationInfo">a</a> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="../../../../reflect/internal/AnnotationInfos.scala.html#47274" title="Boolean(false)">AnnotationInfo</a><span class="delimiter">(</span><a href="#356979" title="=&gt; GenMSIL.this.global.Type">CloneableAttr</a>, _, _<span class="delimiter">)</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
        <span class="keyword">case</span> <span title="Boolean(true)">_</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)Unit" id="357093">addModuleInstanceField</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="365259">sym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="../../Global.scala.html#182894" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;Adding Module-Instance Field for &quot;)" class="string">&quot;Adding Module-Instance Field for &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#357117" title="(sym: GenMSIL.this.global.Symbol)String">showsym</a><span class="delimiter">(</span><a href="#365259" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" id="365293">tBuilder</a> = <a href="#357084" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#365259" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" class="delimiter">[</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span><span class="delimiter">]</span>
      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.FieldBuilder" id="365294">fb</a> = <a href="#365293" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a>.<span title="(name: String, fieldType: ch.epfl.lamp.compiler.msil.Type, attrs: Short)ch.epfl.lamp.compiler.msil.emit.FieldBuilder">DefineField</span><span class="delimiter">(</span><a href="#356924" title="=&gt; String">MODULE_INSTANCE_NAME</a>,
                           <a href="#365293" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a>,
                           <span class="delimiter">(</span>FieldAttributes.Public <span title="Int(22)">|</span>
                            //FieldAttributes.InitOnly |
                            FieldAttributes.Static<span class="delimiter">)</span>.<span title="=&gt; Short">toShort</span><span class="delimiter">)</span>
      <a href="../../symtab/clr/CLRTypes.scala.html#310652" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol, value: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">fields</a><span class="delimiter">(</span><a href="#365259" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span> = <a href="#365294" title="ch.epfl.lamp.compiler.msil.emit.FieldBuilder">fb</a>
    <span class="delimiter">}</span>


    // the symbol may be a object-symbol (module-symbol), or a module-class-symbol
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.FieldInfo" id="357094">getModuleInstanceField</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="358709">sym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="ch.epfl.lamp.compiler.msil.FieldInfo">FieldInfo</span> = <span class="delimiter">{</span>
      <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#358709" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47774" title="=&gt; Boolean">isModule</a> <span title="(x: Boolean)Boolean">||</span> <a href="#358709" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47775" title="=&gt; Boolean">isModuleClass</a>, <span title="String(&quot;Expected module: &quot;)" class="string">&quot;Expected module: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#357117" title="(sym: GenMSIL.this.global.Symbol)String">showsym</a><span class="delimiter">(</span><a href="#358709" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span>

      // when called by LOAD_MODULE, the corresponding type maybe doesn't
      // exist yet -&gt; make a getType
      <span class="keyword">val</span> <a title="GenMSIL.this.global.Symbol" id="365305">moduleClassSym</a> = <span title="GenMSIL.this.global.Symbol" class="keyword">if</span> <span class="delimiter">(</span><a href="#358709" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47774" title="=&gt; Boolean">isModule</a><span class="delimiter">)</span> <a href="#358709" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#48010" title="=&gt; GenMSIL.this.global.Symbol">moduleClass</a> <span class="keyword">else</span> <a href="#358709" title="GenMSIL.this.global.Symbol">sym</a>

      // TODO: get module field for modules not defined in the
      // source currently compiling (e.g. Console)

      <a href="../../symtab/clr/CLRTypes.scala.html#310652" title="=&gt; scala.collection.mutable.Map[GenMSIL.this.global.loaders.clrTypes.global.Symbol,ch.epfl.lamp.compiler.msil.FieldInfo]">fields</a> <span title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)Option[ch.epfl.lamp.compiler.msil.FieldInfo]">get</span> <a href="#365305" title="GenMSIL.this.global.Symbol">moduleClassSym</a> <span title="ch.epfl.lamp.compiler.msil.FieldInfo" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.FieldInfo">Some</span><span class="delimiter">(</span><a title="ch.epfl.lamp.compiler.msil.FieldInfo" id="365311">sym</a><span class="delimiter">)</span> =&gt; <a href="#365311" title="ch.epfl.lamp.compiler.msil.FieldInfo">sym</a>
        <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.FieldInfo">None</span> =&gt;
          //val mclass = types(moduleClassSym)
          <span class="keyword">val</span> <a title="String" id="365312">nameInMetadata</a> = <a href="#357095" title="(csym: GenMSIL.this.global.Symbol)String">nestingAwareFullClassname</a><span class="delimiter">(</span><a href="#365305" title="GenMSIL.this.global.Symbol">moduleClassSym</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="365313">mClass</a> = <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310664" title="(name: String)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#365312" title="String">nameInMetadata</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.FieldInfo" id="365314">mfield</a> = <a href="#365313" title="ch.epfl.lamp.compiler.msil.Type">mClass</a>.<span title="(x$1: String)ch.epfl.lamp.compiler.msil.FieldInfo">GetField</span><span class="delimiter">(</span><span title="String(&quot;MODULE$&quot;)" class="string">&quot;MODULE$&quot;</span><span class="delimiter">)</span>
          <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#365314" title="ch.epfl.lamp.compiler.msil.FieldInfo">mfield</a> <span title="(x$1: AnyRef)Boolean">ne</span> <span title="Null(null)" class="keyword">null</span>, <span title="String(&quot;module not found &quot;)" class="string">&quot;module not found &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#357117" title="(sym: GenMSIL.this.global.Symbol)String">showsym</a><span class="delimiter">(</span><a href="#365305" title="GenMSIL.this.global.Symbol">moduleClassSym</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="../../symtab/clr/CLRTypes.scala.html#310652" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol, value: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">fields</a><span class="delimiter">(</span><a href="#365305" title="GenMSIL.this.global.Symbol">moduleClassSym</a><span class="delimiter">)</span> = <a href="#365314" title="ch.epfl.lamp.compiler.msil.FieldInfo">mfield</a>
          <a href="#365314" title="ch.epfl.lamp.compiler.msil.FieldInfo">mfield</a>
      <span class="delimiter">}</span>

      //fields(moduleClassSym)
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(csym: GenMSIL.this.global.Symbol)String" id="357095">nestingAwareFullClassname</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="365315">csym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span> : <span title="String">String</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="String" id="365321">suffix</a> = <a href="#365315" title="GenMSIL.this.global.Symbol">csym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47889" title="=&gt; String">moduleSuffix</a>
      <span class="keyword">val</span> <a title="String" id="365322">res</a> = <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#365315" title="GenMSIL.this.global.Symbol">csym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47864" title="=&gt; Boolean">isNestedClass</a><span class="delimiter">)</span>
        <a href="#357095" title="(csym: GenMSIL.this.global.Symbol)String">nestingAwareFullClassname</a><span class="delimiter">(</span><a href="#365315" title="GenMSIL.this.global.Symbol">csym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.Symbol">owner</a><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot;+&quot;)" class="string">&quot;+&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#365315" title="GenMSIL.this.global.Symbol">csym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47886" title="=&gt; String">encodedName</a>
      <span class="keyword">else</span>
        <a href="#365315" title="GenMSIL.this.global.Symbol">csym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47897" title="=&gt; String">fullName</a>
      <a href="#365322" title="String">res</a> <span title="(x$1: Any)String">+</span> <a href="#365321" title="String">suffix</a>
    <span class="delimiter">}</span>

    /** Adds a static initializer which creates an instance of the module
     *  class (calls the primary constructor). A special primary constructor
     *  will be generated (notInitializedModules) which stores the new instance
     *  in the MODULE$ field right after the super call.
     */
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)Unit" id="357096">addStaticInit</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="365270">sym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" id="365325">tBuilder</a> = <a href="#357084" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#365270" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" class="delimiter">[</span><span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span><span class="delimiter">]</span>

      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.ConstructorBuilder" id="365326">staticInit</a> = <a href="#365325" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">tBuilder</a>.<span title="(attrs: Short, callingConvention: Short, paramTypes: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.emit.ConstructorBuilder">DefineConstructor</span><span class="delimiter">(</span>
        <span class="delimiter">(</span>MethodAttributes.Static <span title="Int(22)">|</span> MethodAttributes.Public<span class="delimiter">)</span>.<span title="=&gt; Short">toShort</span>,
        CallingConventions.<span title="Short(1)">Standard</span>,
        <span title="object ch.epfl.lamp.compiler.msil.Type">MsilType</span>.<span title="Array[ch.epfl.lamp.compiler.msil.Type]">EmptyTypes</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.ILGenerator" id="365327">sicode</a> = <a href="#365326" title="ch.epfl.lamp.compiler.msil.emit.ConstructorBuilder">staticInit</a>.<span title="()ch.epfl.lamp.compiler.msil.emit.ILGenerator">GetILGenerator</span><span class="delimiter">(</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.ConstructorInfo" id="365328">instanceConstructor</a> = <a href="../../symtab/clr/CLRTypes.scala.html#310648" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)ch.epfl.lamp.compiler.msil.ConstructorInfo">constructors</a><span class="delimiter">(</span><a href="#365270" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47977" title="=&gt; GenMSIL.this.global.Symbol">primaryConstructor</a><span class="delimiter">)</span>

      // there are no constructor parameters. assuming the constructor takes no parameter
      // is fine: we call (in the static constructor) the constructor of the module class,
      // which takes no arguments - an object definition cannot take constructor arguments.
      <a href="#365327" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">sicode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.ConstructorInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Newobj</span>, <a href="#365328" title="ch.epfl.lamp.compiler.msil.ConstructorInfo">instanceConstructor</a><span class="delimiter">)</span>
      // the stsfld is done in the instance constructor, just after the super call.
      <a href="#365327" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">sicode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Pop</span><span class="delimiter">)</span>

      <a href="#365327" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">sicode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ret</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)Unit" id="357097">generateMirrorClass</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="360574">sym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="365356">tBuilder</a> = <a href="#357084" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#360574" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>
      <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#360574" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47775" title="=&gt; Boolean">isModuleClass</a>, <span title="String(&quot;Can\'t generate Mirror-Class for the Non-Module class &quot;)" class="string">&quot;Can't generate Mirror-Class for the Non-Module class &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#360574" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>
      <a href="../../Global.scala.html#182894" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;Dumping mirror class for object: &quot;)" class="string">&quot;Dumping mirror class for object: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#360574" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="String" id="365357">moduleName</a> = <a href="#357069" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#360574" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="String" id="365358">mirrorName</a> = <a href="#365357" title="String">moduleName</a>.<span title="(x$1: Int, x$2: Int)String">substring</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span>, <a href="#365357" title="String">moduleName</a>.<span title="()Int">length</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" id="365359">mirrorTypeBuilder</a> = <a href="#356996" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ModuleBuilder">mmodule</a>.<span title="(typeName: String, attributes: Int, baseType: ch.epfl.lamp.compiler.msil.Type, interfaces: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.emit.TypeBuilder">DefineType</span><span class="delimiter">(</span><a href="#365358" title="String">mirrorName</a>,
                                                 TypeAttributes.Class |
                                                 TypeAttributes.Public <span title="Int(257)">|</span>
                                                 TypeAttributes.Sealed,
                                                 <a href="../../symtab/clr/CLRTypes.scala.html#310619" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MOBJECT</a>,
                                                 <span title="object ch.epfl.lamp.compiler.msil.Type">MsilType</span>.<span title="Array[ch.epfl.lamp.compiler.msil.Type]">EmptyTypes</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="GenMSIL.this.global.icodes.IClass" id="365360">iclass</a> = <a href="../icode/ICodes.scala.html#228877" title="(key: GenMSIL.this.global.icodes.global.Symbol)GenMSIL.this.global.icodes.IClass">classes</a><span class="delimiter">(</span><a href="#360574" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>

      <span class="keyword">for</span> <span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="365414">m</a> &lt;- <a href="#360574" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.Type">tpe</a>.<a href="../../../../reflect/internal/Types.scala.html#42765" title="(f: GenMSIL.this.global.Symbol =&gt; Unit)Unit">nonPrivateMembers</a>
           <span class="keyword">if</span> <a href="#365414" title="GenMSIL.this.global.Symbol">m</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.Symbol">owner</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../../../reflect/internal/Definitions.scala.html#40473" title="object GenMSIL.this.global.definitions">definitions</a>.<a href="../../../../reflect/internal/Definitions.scala.html#46278" title="=&gt; GenMSIL.this.global.Symbol">ObjectClass</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#365414" title="GenMSIL.this.global.Symbol">m</a>.<a href="../../../../reflect/internal/HasFlags.scala.html#48085" title="=&gt; Boolean">isProtected</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
           <a href="#365414" title="GenMSIL.this.global.Symbol">m</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47773" title="=&gt; Boolean">isMethod</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#365414" title="GenMSIL.this.global.Symbol">m</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47802" title="=&gt; Boolean">isClassConstructor</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#365414" title="GenMSIL.this.global.Symbol">m</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47859" title="=&gt; Boolean">isStaticMember</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#365414" title="GenMSIL.this.global.Symbol">m</a>.<a href="../../../../reflect/internal/HasFlags.scala.html#48078" title="=&gt; Boolean">isCase</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span>
           <span title="=&gt; Boolean">!</span><a href="#365414" title="GenMSIL.this.global.Symbol">m</a>.<a href="../../../../reflect/internal/HasFlags.scala.html#48097" title="=&gt; Boolean">isDeferred</a><span class="delimiter">)</span>
        <span class="delimiter">{</span>
          <a href="../../Global.scala.html#182894" title="(msg: =&gt; String)Unit">debuglog</a><span class="delimiter">(</span><span title="String(&quot;   Mirroring method: &quot;)" class="string">&quot;   Mirroring method: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#365414" title="GenMSIL.this.global.Symbol">m</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Array[ch.epfl.lamp.compiler.msil.Type]" id="365415">paramTypes</a> = <a href="#357083" title="(sym: GenMSIL.this.global.Symbol)Array[ch.epfl.lamp.compiler.msil.Type]">msilParamTypes</a><span class="delimiter">(</span><a href="#365414" title="GenMSIL.this.global.Symbol">m</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Array[String]" id="365416">paramNames</a>: <span title="Array[String]">Array</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span title="Array[String]" class="keyword">new</span> <span title="Array[String]">Array</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">(</span><a href="#365415" title="Array[ch.epfl.lamp.compiler.msil.Type]">paramTypes</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
          <span class="keyword">for</span> <span class="delimiter">(</span><a title="Int" id="365521">i</a> &lt;- <span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(f: Int =&gt; Unit)Unit">until</span> <a href="#365415" title="Array[ch.epfl.lamp.compiler.msil.Type]">paramTypes</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
            <a href="#365416" title="(i: Int, x: String)Unit">paramNames</a><span class="delimiter">(</span><a href="#365521" title="Int">i</a><span class="delimiter">)</span> = <span title="String(&quot;x_&quot;)" class="string">&quot;x_&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#365521" title="Int">i</a>

          // CHECK: verify if getMethodName is better than msilName
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder" id="365417">mirrorMethod</a> = <a href="#365359" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">mirrorTypeBuilder</a>.<span title="(name: String, attrs: Short, returnType: ch.epfl.lamp.compiler.msil.Type, paramTypes: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.emit.MethodBuilder">DefineMethod</span><span class="delimiter">(</span><a href="#357069" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#365414" title="GenMSIL.this.global.Symbol">m</a><span class="delimiter">)</span>,
                                                            <span class="delimiter">(</span>MethodAttributes.Public <span title="Int(22)">|</span>
                                                            MethodAttributes.Static<span class="delimiter">)</span>.<span title="=&gt; Short">toShort</span>,
                                                            <a href="#357082" title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#365414" title="GenMSIL.this.global.Symbol">m</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.Type">tpe</a>.<a href="../../../../reflect/internal/Types.scala.html#42743" title="=&gt; GenMSIL.this.global.Type">resultType</a><span class="delimiter">)</span>,
                                                            <a href="#365415" title="Array[ch.epfl.lamp.compiler.msil.Type]">paramTypes</a><span class="delimiter">)</span>

          <span class="keyword">var</span> <a title="Int" id="365418">i</a> = <span title="Int(0)" class="int">0</span>
          <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#365418" title="Int">i</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#365415" title="Array[ch.epfl.lamp.compiler.msil.Type]">paramTypes</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span> <a href="#365421" title="()Unit" class="delimiter">{</a>
            <a href="#365417" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">mirrorMethod</a>.<span title="(pos: Int, attr: Int, name: String)ch.epfl.lamp.compiler.msil.emit.ParameterBuilder">DefineParameter</span><span class="delimiter">(</span><a href="#365418" title="Int">i</a>, ParameterAttributes.<span title="Int(0)">None</span>, <a href="#365416" title="(i: Int)String">paramNames</a><span class="delimiter">(</span><a href="#365418" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#365418" title="Int">i</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
          <span class="delimiter">}</span>

          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.ILGenerator" id="365419">mirrorCode</a> = <a href="#365417" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">mirrorMethod</a>.<span title="()ch.epfl.lamp.compiler.msil.emit.ILGenerator">GetILGenerator</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#365419" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">mirrorCode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldsfld</span>, <a href="#357094" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.FieldInfo">getModuleInstanceField</a><span class="delimiter">(</span><a href="#360574" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="365420">mInfo</a> = <a href="#357110" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.MethodInfo">getMethod</a><span class="delimiter">(</span><a href="#365414" title="GenMSIL.this.global.Symbol">m</a><span class="delimiter">)</span>
          <span class="keyword">for</span> <span class="delimiter">(</span><a title="Int" id="365649">paramidx</a> &lt;- <span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span>.<span title="(end: Int)scala.collection.immutable.Range">until</span><span title="(f: Int =&gt; Unit)Unit" class="delimiter">(</span><a href="#365415" title="Array[ch.epfl.lamp.compiler.msil.Type]">paramTypes</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="Array[ch.epfl.lamp.compiler.msil.ParameterInfo]" id="365650">mInfoParams</a> = <a href="#365420" title="ch.epfl.lamp.compiler.msil.MethodInfo">mInfo</a>.<span title="()Array[ch.epfl.lamp.compiler.msil.ParameterInfo]">GetParameters</span>
            <span class="keyword">val</span> <a title="Boolean" id="365651">loadAddr</a> = <a href="#365650" title="(i: Int)ch.epfl.lamp.compiler.msil.ParameterInfo">mInfoParams</a><span class="delimiter">(</span><a href="#365649" title="Int">paramidx</a><span class="delimiter">)</span>.<span title="ch.epfl.lamp.compiler.msil.Type">ParameterType</span>.<span title="()Boolean">IsByRef</span>
            <a href="#357062" title="(code: ch.epfl.lamp.compiler.msil.emit.ILGenerator, loadAddr: Boolean)(i: Int)Unit">loadArg</a><span class="delimiter">(</span><a href="#365419" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">mirrorCode</a>, <a href="#365651" title="Boolean">loadAddr</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#365649" title="Int">paramidx</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

          <a href="#365419" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">mirrorCode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Callvirt</span>, <a href="#357110" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.MethodInfo">getMethod</a><span class="delimiter">(</span><a href="#365414" title="GenMSIL.this.global.Symbol">m</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#365419" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">mirrorCode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ret</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

      <a href="#357017" title="(sym: GenMSIL.this.global.Symbol, tBuilder: ch.epfl.lamp.compiler.msil.emit.TypeBuilder)Unit">addSymtabAttribute</a><span class="delimiter">(</span><a href="#360574" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47985" title="=&gt; GenMSIL.this.global.Symbol">sourceModule</a>, <a href="#365359" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">mirrorTypeBuilder</a><span class="delimiter">)</span>

      <a href="#365359" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">mirrorTypeBuilder</a>.<span title="()ch.epfl.lamp.compiler.msil.Type">CreateType</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#365359" title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">mirrorTypeBuilder</a>.<span title="(sourceFilepath: String)Unit">setSourceFilepath</span><span class="delimiter">(</span><a href="#365360" title="GenMSIL.this.global.icodes.IClass">iclass</a>.<a href="../icode/Members.scala.html#229228" title="=&gt; GenMSIL.this.global.icodes.global.CompilationUnit">cunit</a>.<a href="../../CompilationUnits.scala.html#185106" title="=&gt; scala.tools.nsc.util.SourceFile">source</a>.<a href="../../util/SourceFile.scala.html#185145" title="=&gt; scala.tools.nsc.io.AbstractFile">file</a>.<a href="../../io/AbstractFile.scala.html#187400" title="=&gt; String">path</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>


    // #####################################################################
    // delegate callers

    <span class="keyword">var</span> <a title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder" id="357099">delegateCallers</a>: <span title="ch.epfl.lamp.compiler.msil.emit.TypeBuilder">TypeBuilder</span> = _
    <span class="keyword">var</span> <a title="Int" id="357102">nbDelegateCallers</a>: <span title="Int">Int</span> = <span title="Int(0)" class="int">0</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="357104">initDelegateCallers</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="#357099" title="(x$1: ch.epfl.lamp.compiler.msil.emit.TypeBuilder)Unit">delegateCallers</a> = <a href="#356996" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ModuleBuilder">mmodule</a>.<span title="(typeName: String, attributes: Int)ch.epfl.lamp.compiler.msil.emit.TypeBuilder">DefineType</span><span class="delimiter">(</span><span title="String(&quot;$DelegateCallers&quot;)" class="string">&quot;$DelegateCallers&quot;</span>, TypeAttributes.Public <span title="Int(257)">|</span>
                                          TypeAttributes.Sealed<span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(functionType: GenMSIL.this.global.Type, delegateType: GenMSIL.this.global.Type)Unit" id="357105">createDelegateCaller</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Type" id="362349">functionType</a>: <a href="../../../../reflect/internal/Types.scala.html#40083" title="GenMSIL.this.global.Type">Type</a>, <a title="GenMSIL.this.global.Type" id="362350">delegateType</a>: <a href="../../../../reflect/internal/Types.scala.html#40083" title="GenMSIL.this.global.Type">Type</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#357099" title="=&gt; ch.epfl.lamp.compiler.msil.emit.TypeBuilder">delegateCallers</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
        <a href="#357104" title="()Unit">initDelegateCallers</a><span class="delimiter">(</span><span class="delimiter">)</span>
      // create a field an store the function-object
      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="362353">mFunctionType</a>: <span title="ch.epfl.lamp.compiler.msil.Type">MsilType</span> = <a href="#357082" title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#362349" title="GenMSIL.this.global.Type">functionType</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.FieldBuilder" id="362354">anonfunField</a>: <span title="ch.epfl.lamp.compiler.msil.emit.FieldBuilder">FieldBuilder</span> = <a href="#357099" title="=&gt; ch.epfl.lamp.compiler.msil.emit.TypeBuilder">delegateCallers</a>.<span title="(name: String, fieldType: ch.epfl.lamp.compiler.msil.Type, attrs: Short)ch.epfl.lamp.compiler.msil.emit.FieldBuilder">DefineField</span><span class="delimiter">(</span>
        <span title="String(&quot;$anonfunField$$&quot;)" class="string">&quot;$anonfunField$$&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#357102" title="=&gt; Int">nbDelegateCallers</a>, <a href="#362353" title="ch.epfl.lamp.compiler.msil.Type">mFunctionType</a>,
        <span class="delimiter">(</span>FieldAttributes.InitOnly | FieldAttributes.Public <span title="Int(54)">|</span> FieldAttributes.Static<span class="delimiter">)</span>.<span title="=&gt; Short">toShort</span><span class="delimiter">)</span>
      <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Stsfld</span>, <a href="#362354" title="ch.epfl.lamp.compiler.msil.emit.FieldBuilder">anonfunField</a><span class="delimiter">)</span>


      // create the static caller method and the delegate object
      <span class="keyword">val</span> <a href="#362356" title="(List[GenMSIL.this.global.Symbol], GenMSIL.this.global.Type)" class="delimiter">(</a><a href="#362355" title="List[GenMSIL.this.global.Symbol]" id="362356">params</a>, <a href="#362355" title="GenMSIL.this.global.Type" id="362357">returnType</a><span class="delimiter">)</span> = <a href="#362350" title="GenMSIL.this.global.Type">delegateType</a>.<a href="../../../../reflect/internal/Types.scala.html#42769" title="(name: GenMSIL.this.global.Name)GenMSIL.this.global.Symbol">member</a><span class="delimiter">(</span><a href="../../../../reflect/internal/StdNames.scala.html#40560" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../../../reflect/internal/StdNames.scala.html#60160" title="=&gt; GenMSIL.this.global.nme.NameType">apply</a><span class="delimiter">)</span>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.Type">tpe</a> <span title="(List[GenMSIL.this.global.Symbol], GenMSIL.this.global.Type)" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="(List[GenMSIL.this.global.Symbol], GenMSIL.this.global.Type)">MethodType</span><span class="delimiter">(</span><a title="List[GenMSIL.this.global.Symbol]" id="362449">delParams</a>, <a title="GenMSIL.this.global.Type" id="362450">delReturn</a><span class="delimiter">)</span> =&gt; <span title="(_1: List[GenMSIL.this.global.Symbol], _2: GenMSIL.this.global.Type)(List[GenMSIL.this.global.Symbol], GenMSIL.this.global.Type)" class="delimiter">(</span><a href="#362449" title="List[GenMSIL.this.global.Symbol]">delParams</a>, <a href="#362450" title="GenMSIL.this.global.Type">delReturn</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="Nothing">_</span> =&gt; <a href="../../Global.scala.html#182892" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="String(&quot;not a delegate type: &quot;)" class="string">&quot;not a delegate type: &quot;</span>  <span title="(x$1: Any)String">+</span> <a href="#362350" title="GenMSIL.this.global.Type">delegateType</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder" id="362358">caller</a>: <span title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">MethodBuilder</span> = <a href="#357099" title="=&gt; ch.epfl.lamp.compiler.msil.emit.TypeBuilder">delegateCallers</a>.<span title="(name: String, attrs: Short, returnType: ch.epfl.lamp.compiler.msil.Type, paramTypes: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.emit.MethodBuilder">DefineMethod</span><span class="delimiter">(</span>
        <span title="String(&quot;$delegateCaller$$&quot;)" class="string">&quot;$delegateCaller$$&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#357102" title="=&gt; Int">nbDelegateCallers</a>,
        <span class="delimiter">(</span>MethodAttributes.Final | MethodAttributes.Public <span title="Int(54)">|</span> MethodAttributes.Static<span class="delimiter">)</span>.<span title="=&gt; Short">toShort</span>,
        <a href="#357082" title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#362357" title="GenMSIL.this.global.Type">returnType</a><span class="delimiter">)</span>, <span class="delimiter">(</span><a href="#362356" title="List[GenMSIL.this.global.Symbol]">params</a> <span title="(f: GenMSIL.this.global.Symbol =&gt; GenMSIL.this.global.Type)(implicit bf: scala.collection.generic.CanBuildFrom[List[GenMSIL.this.global.Symbol],GenMSIL.this.global.Type,List[GenMSIL.this.global.Type]])List[GenMSIL.this.global.Type]">map</span> <span class="delimiter">(</span><a href="#362510" title="GenMSIL.this.global.Symbol">_</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: GenMSIL.this.global.Type =&gt; ch.epfl.lamp.compiler.msil.Type)(implicit bf: scala.collection.generic.CanBuildFrom[List[GenMSIL.this.global.Type],ch.epfl.lamp.compiler.msil.Type,List[ch.epfl.lamp.compiler.msil.Type]])List[ch.epfl.lamp.compiler.msil.Type]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,ch.epfl.lamp.compiler.msil.Type,List[ch.epfl.lamp.compiler.msil.Type]]" class="delimiter">(</span><a href="#357082" title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">)</span>.<span title="(implicit evidence$1: ClassManifest[ch.epfl.lamp.compiler.msil.Type])Array[ch.epfl.lamp.compiler.msil.Type]">toArray</span><span class="delimiter">)</span>
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="Int" id="362751">i</a> &lt;- <span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(f: Int =&gt; ch.epfl.lamp.compiler.msil.emit.ParameterBuilder)Unit">until</span> <a href="#362356" title="List[GenMSIL.this.global.Symbol]">params</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span>
        <a href="#362358" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">caller</a>.<span title="(pos: Int, attr: Int, name: String)ch.epfl.lamp.compiler.msil.emit.ParameterBuilder">DefineParameter</span><span class="delimiter">(</span><a href="#362751" title="Int">i</a>, ParameterAttributes.<span title="Int(0)">None</span>, <span title="String(&quot;arg&quot;)" class="string">&quot;arg&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#362751" title="Int">i</a><span class="delimiter">)</span> // FIXME: use name of parameter symbol
      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.ConstructorInfo" id="362359">delegCtor</a> = <a href="#357082" title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#362350" title="GenMSIL.this.global.Type">delegateType</a><span class="delimiter">)</span>.<span title="(x$1: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.ConstructorInfo">GetConstructor</span><span class="delimiter">(</span><span title="(xs: ch.epfl.lamp.compiler.msil.Type*)(implicit evidence$2: scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type])Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span title="(clazz: Class[_])scala.reflect.ClassManifest[ch.epfl.lamp.compiler.msil.Type]" class="delimiter">(</span><a href="../../symtab/clr/CLRTypes.scala.html#310619" title="=&gt; ch.epfl.lamp.compiler.msil.Type">MOBJECT</a>, <a href="#356949" title="=&gt; ch.epfl.lamp.compiler.msil.Type">INT_PTR</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldnull</span><span class="delimiter">)</span>
      <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldftn</span>, <a href="#362358" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">caller</a><span class="delimiter">)</span>
      <a href="#356999" title="=&gt; ch.epfl.lamp.compiler.msil.emit.ILGenerator">mcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.ConstructorInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Newobj</span>, <a href="#362359" title="ch.epfl.lamp.compiler.msil.ConstructorInfo">delegCtor</a><span class="delimiter">)</span>


      // create the static caller method body
      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="362360">functionApply</a>: <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span> = <a href="#357110" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.MethodInfo">getMethod</a><span class="delimiter">(</span><a href="#362349" title="GenMSIL.this.global.Type">functionType</a>.<a href="../../../../reflect/internal/Types.scala.html#42769" title="(name: GenMSIL.this.global.Name)GenMSIL.this.global.Symbol">member</a><span class="delimiter">(</span><a href="../../../../reflect/internal/StdNames.scala.html#40560" title="object GenMSIL.this.global.nme">nme</a>.<a href="../../../../reflect/internal/StdNames.scala.html#60160" title="=&gt; GenMSIL.this.global.nme.NameType">apply</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.emit.ILGenerator" id="362361">dcode</a>: <span title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">ILGenerator</span> = <a href="#362358" title="ch.epfl.lamp.compiler.msil.emit.MethodBuilder">caller</a>.<span title="()ch.epfl.lamp.compiler.msil.emit.ILGenerator">GetILGenerator</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#362361" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">dcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldsfld</span>, <a href="#362354" title="ch.epfl.lamp.compiler.msil.emit.FieldBuilder">anonfunField</a><span class="delimiter">)</span>
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="Int" id="362915">i</a> &lt;- <span title="implicit scala.LowPriorityImplicits.intWrapper : (x: Int)scala.runtime.RichInt" class="int">0</span> <span title="(f: Int =&gt; Unit)Unit">until</span> <a href="#362356" title="List[GenMSIL.this.global.Symbol]">params</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#357062" title="(code: ch.epfl.lamp.compiler.msil.emit.ILGenerator, loadAddr: Boolean)(i: Int)Unit">loadArg</a><span class="delimiter">(</span><a href="#362361" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">dcode</a>, <span title="Boolean(false)" class="keyword">false</span> /* TODO confirm whether passing actual as-is to formal is correct wrt the ByRef attribute of the param */<span class="delimiter">)</span><span class="delimiter">(</span><a href="#362915" title="Int">i</a><span class="delimiter">)</span>
        <a href="#357106" title="(code: ch.epfl.lamp.compiler.msil.emit.ILGenerator, boxType: GenMSIL.this.global.icodes.TypeKind)Unit">emitBox</a><span class="delimiter">(</span><a href="#362361" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">dcode</a>, <a href="../icode/TypeKinds.scala.html#228995" title="(t: GenMSIL.this.global.icodes.global.Type)GenMSIL.this.global.icodes.TypeKind">toTypeKind</a><span class="delimiter">(</span><a href="#362356" title="(n: Int)GenMSIL.this.global.Symbol">params</a><span class="delimiter">(</span><a href="#362915" title="Int">i</a><span class="delimiter">)</span>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.Type">tpe</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#362361" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">dcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Callvirt</span>, <a href="#362360" title="ch.epfl.lamp.compiler.msil.MethodInfo">functionApply</a><span class="delimiter">)</span>
      <a href="#357107" title="(code: ch.epfl.lamp.compiler.msil.emit.ILGenerator, boxType: GenMSIL.this.global.icodes.TypeKind)Unit">emitUnbox</a><span class="delimiter">(</span><a href="#362361" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">dcode</a>, <a href="../icode/TypeKinds.scala.html#228995" title="(t: GenMSIL.this.global.icodes.global.Type)GenMSIL.this.global.icodes.TypeKind">toTypeKind</a><span class="delimiter">(</span><a href="#362357" title="GenMSIL.this.global.Type">returnType</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#362361" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">dcode</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ret</span><span class="delimiter">)</span>

      <a href="#357102" title="(x$1: Int)Unit">nbDelegateCallers</a> = <a href="#357102" title="=&gt; Int">nbDelegateCallers</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>

    <span class="delimiter">}</span> //def createDelegateCaller

    <span class="keyword">def</span> <a title="(code: ch.epfl.lamp.compiler.msil.emit.ILGenerator, boxType: GenMSIL.this.global.icodes.TypeKind)Unit" id="357106">emitBox</a><span class="delimiter">(</span><a title="ch.epfl.lamp.compiler.msil.emit.ILGenerator" id="362916">code</a>: <span title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">ILGenerator</span>, <a title="GenMSIL.this.global.icodes.TypeKind" id="362917">boxType</a>: <a href="../icode/TypeKinds.scala.html#228959" title="GenMSIL.this.global.icodes.TypeKind">TypeKind</a><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="#362917" title="GenMSIL.this.global.icodes.TypeKind">boxType</a>: @<a href="../icode/TypeKinds.scala.html#228959" title="GenMSIL.this.global.icodes.TypeKind @unchecked">unchecked</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      // doesn't make sense, unit as parameter..
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228965" title="Unit">UNIT</a>   =&gt; <a href="#362916" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.FieldInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldsfld</span>, <a href="#356975" title="=&gt; ch.epfl.lamp.compiler.msil.FieldInfo">boxedUnit</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228967" title="Unit">BOOL</a> | <a href="../icode/TypeKinds.scala.html#228969" title="object GenMSIL.this.global.icodes.BYTE">BYTE</a> | <a href="../icode/TypeKinds.scala.html#228971" title="object GenMSIL.this.global.icodes.SHORT">SHORT</a> | <a href="../icode/TypeKinds.scala.html#228973" title="object GenMSIL.this.global.icodes.CHAR">CHAR</a> | <a href="../icode/TypeKinds.scala.html#228975" title="object GenMSIL.this.global.icodes.INT">INT</a> | <a href="../icode/TypeKinds.scala.html#228977" title="object GenMSIL.this.global.icodes.LONG">LONG</a> | <a href="../icode/TypeKinds.scala.html#228979" title="object GenMSIL.this.global.icodes.FLOAT">FLOAT</a> | <a href="../icode/TypeKinds.scala.html#228981" title="object GenMSIL.this.global.icodes.DOUBLE">DOUBLE</a> =&gt;
        <a href="#362916" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.Type)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Box</span>, <a href="#357081" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#362917" title="GenMSIL.this.global.icodes.TypeKind">boxType</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">REFERENCE</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="362935">cls</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310662" title="(cls: GenMSIL.this.global.loaders.clrTypes.global.Symbol)Boolean">isValueType</a><span class="delimiter">(</span><a href="#362935" title="GenMSIL.this.global.icodes.global.Symbol">cls</a><span class="delimiter">)</span> =&gt;
        <a href="#362916" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.Type)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Box</span>, <span class="delimiter">(</span><a href="#357081" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#362917" title="GenMSIL.this.global.icodes.TypeKind">boxType</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">REFERENCE</span><span class="delimiter">(</span>_<span class="delimiter">)</span> | ARRAY<span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;
        <a href="../../Global.scala.html#182891" title="(msg: String)Unit">warning</a><span class="delimiter">(</span><span title="String(&quot;Tried to BOX a non-valuetype.&quot;)" class="string">&quot;Tried to BOX a non-valuetype.&quot;</span><span class="delimiter">)</span>
        <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(code: ch.epfl.lamp.compiler.msil.emit.ILGenerator, boxType: GenMSIL.this.global.icodes.TypeKind)Unit" id="357107">emitUnbox</a><span class="delimiter">(</span><a title="ch.epfl.lamp.compiler.msil.emit.ILGenerator" id="362965">code</a>: <span title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">ILGenerator</span>, <a title="GenMSIL.this.global.icodes.TypeKind" id="362966">boxType</a>: <a href="../icode/TypeKinds.scala.html#228959" title="GenMSIL.this.global.icodes.TypeKind">TypeKind</a><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="#362966" title="GenMSIL.this.global.icodes.TypeKind">boxType</a>: @<a href="../icode/TypeKinds.scala.html#228959" title="GenMSIL.this.global.icodes.TypeKind @unchecked">unchecked</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228965" title="Unit">UNIT</a>   =&gt; <a href="#362965" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Pop</span><span class="delimiter">)</span>
      /* (1) it's essential to keep the code emitted here (as of now plain calls to System.Convert.ToBlaBla methods)
             behaviorally.equiv.wrt. BoxesRunTime.unboxToBlaBla methods
             (case null: that's easy, case boxed: track changes to unboxBlaBla)
         (2) See also: asInstanceOf to cast from Any to number,
             tracked in http://lampsvn.epfl.ch/trac/scala/ticket/4437  */
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228967" title="Unit">BOOL</a>   =&gt; <a href="#362965" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#356959" title="=&gt; ch.epfl.lamp.compiler.msil.MethodInfo">toBool</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228969" title="Unit">BYTE</a>   =&gt; <a href="#362965" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#356961" title="=&gt; ch.epfl.lamp.compiler.msil.MethodInfo">toSByte</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228971" title="Unit">SHORT</a>  =&gt; <a href="#362965" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#356963" title="=&gt; ch.epfl.lamp.compiler.msil.MethodInfo">toShort</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228973" title="Unit">CHAR</a>   =&gt; <a href="#362965" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#356965" title="=&gt; ch.epfl.lamp.compiler.msil.MethodInfo">toChar</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228975" title="Unit">INT</a>    =&gt; <a href="#362965" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#356967" title="=&gt; ch.epfl.lamp.compiler.msil.MethodInfo">toInt</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228977" title="Unit">LONG</a>   =&gt; <a href="#362965" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#356969" title="=&gt; ch.epfl.lamp.compiler.msil.MethodInfo">toLong</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228979" title="Unit">FLOAT</a>  =&gt; <a href="#362965" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#356971" title="=&gt; ch.epfl.lamp.compiler.msil.MethodInfo">toFloat</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a href="../icode/TypeKinds.scala.html#228981" title="Unit">DOUBLE</a> =&gt; <a href="#362965" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Call</span>, <a href="#356973" title="=&gt; ch.epfl.lamp.compiler.msil.MethodInfo">toDouble</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">REFERENCE</span><span class="delimiter">(</span><a title="GenMSIL.this.global.icodes.global.Symbol" id="363004">cls</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="../../symtab/SymbolLoaders.scala.html#238157" title="object GenMSIL.this.global.loaders.clrTypes">clrTypes</a>.<a href="../../symtab/clr/CLRTypes.scala.html#310662" title="(cls: GenMSIL.this.global.loaders.clrTypes.global.Symbol)Boolean">isValueType</a><span class="delimiter">(</span><a href="#363004" title="GenMSIL.this.global.icodes.global.Symbol">cls</a><span class="delimiter">)</span> =&gt;
        <a href="#362965" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.Type)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Unbox</span>, <a href="#357081" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#362966" title="GenMSIL.this.global.icodes.TypeKind">boxType</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#362965" title="ch.epfl.lamp.compiler.msil.emit.ILGenerator">code</a>.<span title="(opcode: ch.epfl.lamp.compiler.msil.emit.OpCode, arg: ch.epfl.lamp.compiler.msil.Type)Unit">Emit</span><span class="delimiter">(</span><span title="object ch.epfl.lamp.compiler.msil.emit.OpCodes">OpCodes</span>.<span title="=&gt; ch.epfl.lamp.compiler.msil.emit.OpCode">Ldobj</span>, <a href="#357081" title="(t: GenMSIL.this.global.icodes.TypeKind)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#362966" title="GenMSIL.this.global.icodes.TypeKind">boxType</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">REFERENCE</span><span class="delimiter">(</span>_<span class="delimiter">)</span> | ARRAY<span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt;
        <a href="../../Global.scala.html#182891" title="(msg: String)Unit">warning</a><span class="delimiter">(</span><span title="String(&quot;Tried to UNBOX a non-valuetype.&quot;)" class="string">&quot;Tried to UNBOX a non-valuetype.&quot;</span><span class="delimiter">)</span>
        <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    // #####################################################################
    // get and create methods / constructors

    <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.ConstructorInfo" id="357108">getConstructor</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="362057">sym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="ch.epfl.lamp.compiler.msil.ConstructorInfo">ConstructorInfo</span> = <a href="../../symtab/clr/CLRTypes.scala.html#310648" title="=&gt; scala.collection.mutable.Map[GenMSIL.this.global.loaders.clrTypes.global.Symbol,ch.epfl.lamp.compiler.msil.ConstructorInfo]">constructors</a>.<span title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)Option[ch.epfl.lamp.compiler.msil.ConstructorInfo]">get</span><span class="delimiter">(</span><a href="#362057" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span> <span title="ch.epfl.lamp.compiler.msil.ConstructorInfo" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.ConstructorInfo">Some</span><span class="delimiter">(</span><a title="ch.epfl.lamp.compiler.msil.ConstructorInfo" id="365663">constr</a><span class="delimiter">)</span> =&gt; <a href="#365663" title="ch.epfl.lamp.compiler.msil.ConstructorInfo">constr</a>
      <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.ConstructorInfo">None</span> =&gt;
        <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="365664">mClass</a> = <a href="#357084" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#362057" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.Symbol">owner</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.ConstructorInfo" id="365665">constr</a> = <a href="#365664" title="ch.epfl.lamp.compiler.msil.Type">mClass</a>.<span title="(x$1: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.ConstructorInfo">GetConstructor</span><span class="delimiter">(</span><a href="#357083" title="(sym: GenMSIL.this.global.Symbol)Array[ch.epfl.lamp.compiler.msil.Type]">msilParamTypes</a><span class="delimiter">(</span><a href="#362057" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span title="ch.epfl.lamp.compiler.msil.ConstructorInfo" class="keyword">if</span> <span class="delimiter">(</span><a href="#365665" title="ch.epfl.lamp.compiler.msil.ConstructorInfo">constr</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          java.lang.<span title="object System">System</span>.<span title="java.io.PrintStream">out</span>.<span title="(x$1: String)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;Cannot find constructor &quot;)" class="string">&quot;Cannot find constructor &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#362057" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.Symbol">owner</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;::&quot;)" class="string">&quot;::&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#362057" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47883" title="=&gt; GenMSIL.this.global.Name">name</a><span class="delimiter">)</span>
          java.lang.<span title="object System">System</span>.<span title="java.io.PrintStream">out</span>.<span title="(x$1: String)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;scope = &quot;)" class="string">&quot;scope = &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#362057" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.Symbol">owner</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.Type">tpe</a>.<a href="../../../../reflect/internal/Types.scala.html#42760" title="=&gt; GenMSIL.this.global.Scope">decls</a><span class="delimiter">)</span>
          <a href="../../Global.scala.html#182892" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><a href="#362057" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47897" title="=&gt; String">fullName</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#357109" title="(sym: GenMSIL.this.global.Symbol, cInfo: ch.epfl.lamp.compiler.msil.ConstructorInfo)Unit">mapConstructor</a><span class="delimiter">(</span><a href="#362057" title="GenMSIL.this.global.Symbol">sym</a>, <a href="#365665" title="ch.epfl.lamp.compiler.msil.ConstructorInfo">constr</a><span class="delimiter">)</span>
          <a href="#365665" title="ch.epfl.lamp.compiler.msil.ConstructorInfo">constr</a>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol, cInfo: ch.epfl.lamp.compiler.msil.ConstructorInfo)Unit" id="357109">mapConstructor</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="365103">sym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a>, <a title="ch.epfl.lamp.compiler.msil.ConstructorInfo" id="365104">cInfo</a>: <span title="ch.epfl.lamp.compiler.msil.ConstructorInfo">ConstructorInfo</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="../../symtab/clr/CLRTypes.scala.html#310648" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol, value: ch.epfl.lamp.compiler.msil.ConstructorInfo)Unit">constructors</a><span class="delimiter">(</span><a href="#365103" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span> = <a href="#365104" title="ch.epfl.lamp.compiler.msil.ConstructorInfo">cInfo</a>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.MethodInfo" id="357110">getMethod</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="362808">sym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span> = <span class="delimiter">{</span>

        <a href="../../symtab/clr/CLRTypes.scala.html#310650" title="=&gt; scala.collection.mutable.Map[GenMSIL.this.global.loaders.clrTypes.global.Symbol,ch.epfl.lamp.compiler.msil.MethodInfo]">methods</a>.<span title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol)Option[ch.epfl.lamp.compiler.msil.MethodInfo]">get</span><span class="delimiter">(</span><a href="#362808" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span> <span title="ch.epfl.lamp.compiler.msil.MethodInfo" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.MethodInfo">Some</span><span class="delimiter">(</span><a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="365682">method</a><span class="delimiter">)</span> =&gt; <a href="#365682" title="ch.epfl.lamp.compiler.msil.MethodInfo">method</a>
        <span class="keyword">case</span> <span title="ch.epfl.lamp.compiler.msil.MethodInfo">None</span> =&gt;
          <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.Type" id="365683">mClass</a> = <a href="#357084" title="(sym: GenMSIL.this.global.Symbol)ch.epfl.lamp.compiler.msil.Type">getType</a><span class="delimiter">(</span><a href="#362808" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.Symbol">owner</a><span class="delimiter">)</span>
          <span class="keyword">try</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="365684">method</a> = <a href="#365683" title="ch.epfl.lamp.compiler.msil.Type">mClass</a>.<span title="(x$1: String, x$2: Array[ch.epfl.lamp.compiler.msil.Type], x$3: ch.epfl.lamp.compiler.msil.Type)ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><a href="#357069" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#362808" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>, <a href="#357083" title="(sym: GenMSIL.this.global.Symbol)Array[ch.epfl.lamp.compiler.msil.Type]">msilParamTypes</a><span class="delimiter">(</span><a href="#362808" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span>,
                                          <a href="#357082" title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">(</span><a href="#362808" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.Type">tpe</a>.<a href="../../../../reflect/internal/Types.scala.html#42743" title="=&gt; GenMSIL.this.global.Type">resultType</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span title="ch.epfl.lamp.compiler.msil.MethodInfo" class="keyword">if</span> <span class="delimiter">(</span><a href="#365684" title="ch.epfl.lamp.compiler.msil.MethodInfo">method</a> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              java.lang.<span title="object System">System</span>.<span title="java.io.PrintStream">out</span>.<span title="(x$1: String)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;Cannot find method &quot;)" class="string">&quot;Cannot find method &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#362808" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.Symbol">owner</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;::&quot;)" class="string">&quot;::&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#357069" title="(sym: GenMSIL.this.global.Symbol)String">msilName</a><span class="delimiter">(</span><a href="#362808" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span>
              java.lang.<span title="object System">System</span>.<span title="java.io.PrintStream">out</span>.<span title="(x$1: String)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;scope = &quot;)" class="string">&quot;scope = &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#362808" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.Symbol">owner</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.Type">tpe</a>.<a href="../../../../reflect/internal/Types.scala.html#42760" title="=&gt; GenMSIL.this.global.Scope">decls</a><span class="delimiter">)</span>
              <a href="../../Global.scala.html#182892" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><a href="#362808" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47897" title="=&gt; String">fullName</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
            <span class="keyword">else</span> <span class="delimiter">{</span>
              <a href="#357111" title="(sym: GenMSIL.this.global.Symbol, mInfo: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">mapMethod</a><span class="delimiter">(</span><a href="#362808" title="GenMSIL.this.global.Symbol">sym</a>, <a href="#365684" title="ch.epfl.lamp.compiler.msil.MethodInfo">method</a><span class="delimiter">)</span>
              <a href="#365684" title="ch.epfl.lamp.compiler.msil.MethodInfo">method</a>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>
          <span class="keyword">catch</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a title="Nothing" id="365714">e</a>: <span title="Exception">Exception</span> =&gt;
              <span title="object Console">Console</span>.<span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;While looking up &quot;)" class="string">&quot;While looking up &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#365683" title="ch.epfl.lamp.compiler.msil.Type">mClass</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;::&quot;)" class="string">&quot;::&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#362808" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#48044" title="=&gt; String">nameString</a><span class="delimiter">)</span>
            <span title="object Console">Console</span>.<span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;\t&quot;)" class="string">&quot;\t&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#357117" title="(sym: GenMSIL.this.global.Symbol)String">showsym</a><span class="delimiter">(</span><a href="#362808" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <span title="Nothing" class="keyword">throw</span> <a href="#365714" title="Exception">e</a>
          <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    /*
     * add a mapping between sym and mInfo
     */
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol, mInfo: ch.epfl.lamp.compiler.msil.MethodInfo)Unit" id="357111">mapMethod</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="365255">sym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a>, <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="365256">mInfo</a>: <span title="ch.epfl.lamp.compiler.msil.MethodInfo">MethodInfo</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span> <span class="delimiter">(</span><a href="#365256" title="ch.epfl.lamp.compiler.msil.MethodInfo">mInfo</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span>, <a href="#365256" title="ch.epfl.lamp.compiler.msil.MethodInfo">mInfo</a><span class="delimiter">)</span>
      <a href="../../symtab/clr/CLRTypes.scala.html#310650" title="(key: GenMSIL.this.global.loaders.clrTypes.global.Symbol, value: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">methods</a><span class="delimiter">(</span><a href="#365255" title="GenMSIL.this.global.Symbol">sym</a><span class="delimiter">)</span> = <a href="#365256" title="ch.epfl.lamp.compiler.msil.MethodInfo">mInfo</a>
    <span class="delimiter">}</span>

    /*
     * add mapping between sym and method with newName, paramTypes of newClass
     */
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol, newClass: ch.epfl.lamp.compiler.msil.Type, newName: String, paramTypes: Array[ch.epfl.lamp.compiler.msil.Type])Unit" id="357112">mapMethod</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="365250">sym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a>, <a title="ch.epfl.lamp.compiler.msil.Type" id="365251">newClass</a>: <span title="ch.epfl.lamp.compiler.msil.Type">MsilType</span>, <a title="String" id="365252">newName</a>: <span title="String">String</span>, <a title="Array[ch.epfl.lamp.compiler.msil.Type]" id="365253">paramTypes</a>: <span title="Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span class="delimiter">[</span>MsilType<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="ch.epfl.lamp.compiler.msil.MethodInfo" id="365727">methodInfo</a> = <a href="#365251" title="ch.epfl.lamp.compiler.msil.Type">newClass</a>.<span title="(x$1: String, x$2: Array[ch.epfl.lamp.compiler.msil.Type])ch.epfl.lamp.compiler.msil.MethodInfo">GetMethod</span><span class="delimiter">(</span><a href="#365252" title="String">newName</a>, <a href="#365253" title="Array[ch.epfl.lamp.compiler.msil.Type]">paramTypes</a><span class="delimiter">)</span>
      <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#365727" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span>, <span title="String(&quot;Can\'t find mapping for &quot;)" class="string">&quot;Can't find mapping for &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#365250" title="GenMSIL.this.global.Symbol">sym</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; -&gt; &quot;)" class="string">&quot; -&gt; &quot;</span> <span title="(x$1: Any)String">+</span>
             <a href="#365252" title="String">newName</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;(&quot;)" class="string">&quot;(&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#365253" title="Array[ch.epfl.lamp.compiler.msil.Type]">paramTypes</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;)&quot;)" class="string">&quot;)&quot;</span><span class="delimiter">)</span>
      <a href="#357111" title="(sym: GenMSIL.this.global.Symbol, mInfo: ch.epfl.lamp.compiler.msil.MethodInfo)Unit">mapMethod</a><span class="delimiter">(</span><a href="#365250" title="GenMSIL.this.global.Symbol">sym</a>, <a href="#365727" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#365727" title="ch.epfl.lamp.compiler.msil.MethodInfo">methodInfo</a>.<span title="()Boolean">IsStatic</span><span class="delimiter">)</span>
        <a href="#356983" title="=&gt; scala.collection.mutable.HashSet[GenMSIL.this.global.Symbol]">dynToStatMapped</a> <span title="(elem: GenMSIL.this.global.Symbol)BytecodeGenerator.this.dynToStatMapped.type">+=</span> <a href="#365250" title="GenMSIL.this.global.Symbol">sym</a>
    <span class="delimiter">}</span>

    /*
     * add mapping between method with name and paramTypes of clazz to
     * method with newName and newParamTypes of newClass (used for instance
     * for &quot;wait&quot;)
     */
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(clazz: GenMSIL.this.global.Symbol, name: GenMSIL.this.global.Name, paramTypes: Array[GenMSIL.this.global.Type], newClass: ch.epfl.lamp.compiler.msil.Type, newName: String, newParamTypes: Array[ch.epfl.lamp.compiler.msil.Type])Unit" id="357113">mapMethod</a><span class="delimiter">(</span>
      <a title="GenMSIL.this.global.Symbol" id="365243">clazz</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a>, <a title="GenMSIL.this.global.Name" id="365244">name</a>: <a href="../../../../reflect/internal/Names.scala.html#39679" title="GenMSIL.this.global.Name">Name</a>, <a title="Array[GenMSIL.this.global.Type]" id="365245">paramTypes</a>: <span title="Array[GenMSIL.this.global.Type]">Array</span><span class="delimiter">[</span>Type<span class="delimiter">]</span>,
      <a title="ch.epfl.lamp.compiler.msil.Type" id="365246">newClass</a>: <span title="ch.epfl.lamp.compiler.msil.Type">MsilType</span>, <a title="String" id="365247">newName</a>: <span title="String">String</span>, <a title="Array[ch.epfl.lamp.compiler.msil.Type]" id="365248">newParamTypes</a>: <span title="Array[ch.epfl.lamp.compiler.msil.Type]">Array</span><span class="delimiter">[</span>MsilType<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="GenMSIL.this.global.Symbol" id="365750">methodSym</a> = <a href="#357116" title="(clazz: GenMSIL.this.global.Symbol, name: GenMSIL.this.global.Name, paramTypes: Array[GenMSIL.this.global.Type])GenMSIL.this.global.Symbol">lookupMethod</a><span class="delimiter">(</span><a href="#365243" title="GenMSIL.this.global.Symbol">clazz</a>, <a href="#365244" title="GenMSIL.this.global.Name">name</a>, <a href="#365245" title="Array[GenMSIL.this.global.Type]">paramTypes</a><span class="delimiter">)</span>
        <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#365750" title="GenMSIL.this.global.Symbol">methodSym</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span>, <span title="String(&quot;cannot find method &quot;)" class="string">&quot;cannot find method &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#365244" title="GenMSIL.this.global.Name">name</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;(&quot;)" class="string">&quot;(&quot;</span> <span title="(x$1: Any)String">+</span>
               <a href="#365245" title="Array[GenMSIL.this.global.Type]">paramTypes</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;)&quot;)" class="string">&quot;)&quot;</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot; in class &quot;)" class="string">&quot; in class &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#365243" title="GenMSIL.this.global.Symbol">clazz</a><span class="delimiter">)</span>
        <a href="#357112" title="(sym: GenMSIL.this.global.Symbol, newClass: ch.epfl.lamp.compiler.msil.Type, newName: String, paramTypes: Array[ch.epfl.lamp.compiler.msil.Type])Unit">mapMethod</a><span class="delimiter">(</span><a href="#365750" title="GenMSIL.this.global.Symbol">methodSym</a>, <a href="#365246" title="ch.epfl.lamp.compiler.msil.Type">newClass</a>, <a href="#365247" title="String">newName</a>, <a href="#365248" title="Array[ch.epfl.lamp.compiler.msil.Type]">newParamTypes</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    /*
     * add mapping for member with name and paramTypes to member
     * newName of newClass (same parameters)
     */
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(clazz: GenMSIL.this.global.Symbol, name: GenMSIL.this.global.Name, paramTypes: Array[GenMSIL.this.global.Type], newClass: ch.epfl.lamp.compiler.msil.Type, newName: String)Unit" id="357114">mapMethod</a><span class="delimiter">(</span>
      <a title="GenMSIL.this.global.Symbol" id="365237">clazz</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a>, <a title="GenMSIL.this.global.Name" id="365238">name</a>: <a href="../../../../reflect/internal/Names.scala.html#39679" title="GenMSIL.this.global.Name">Name</a>, <a title="Array[GenMSIL.this.global.Type]" id="365239">paramTypes</a>: <span title="Array[GenMSIL.this.global.Type]">Array</span><span class="delimiter">[</span>Type<span class="delimiter">]</span>,
      <a title="ch.epfl.lamp.compiler.msil.Type" id="365240">newClass</a>: <span title="ch.epfl.lamp.compiler.msil.Type">MsilType</span>, <a title="String" id="365241">newName</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#357113" title="(clazz: GenMSIL.this.global.Symbol, name: GenMSIL.this.global.Name, paramTypes: Array[GenMSIL.this.global.Type], newClass: ch.epfl.lamp.compiler.msil.Type, newName: String, newParamTypes: Array[ch.epfl.lamp.compiler.msil.Type])Unit">mapMethod</a><span class="delimiter">(</span><a href="#365237" title="GenMSIL.this.global.Symbol">clazz</a>, <a href="#365238" title="GenMSIL.this.global.Name">name</a>, <a href="#365239" title="Array[GenMSIL.this.global.Type]">paramTypes</a>, <a href="#365240" title="ch.epfl.lamp.compiler.msil.Type">newClass</a>, <a href="#365241" title="String">newName</a>, <a href="#365239" title="(xs: Array[GenMSIL.this.global.Type])scala.collection.mutable.ArrayOps[GenMSIL.this.global.Type]">paramTypes</a> <span title="(f: GenMSIL.this.global.Type =&gt; ch.epfl.lamp.compiler.msil.Type)(implicit bf: scala.collection.generic.CanBuildFrom[Array[GenMSIL.this.global.Type],ch.epfl.lamp.compiler.msil.Type,Array[ch.epfl.lamp.compiler.msil.Type]])Array[ch.epfl.lamp.compiler.msil.Type]">map</span> <a href="#357082" title="(tpe: GenMSIL.this.global.Type)ch.epfl.lamp.compiler.msil.Type">msilType</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

    /*
     * add mapping for all methods with name of clazz to the corresponding
     * method (same parameters) with newName of newClass
     */
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(clazz: GenMSIL.this.global.Symbol, name: GenMSIL.this.global.Name, newClass: ch.epfl.lamp.compiler.msil.Type, newName: String)Unit" id="357115">mapMethod</a><span class="delimiter">(</span>
      <a title="GenMSIL.this.global.Symbol" id="365232">clazz</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a>, <a title="GenMSIL.this.global.Name" id="365233">name</a>: <a href="../../../../reflect/internal/Names.scala.html#39679" title="GenMSIL.this.global.Name">Name</a>,
      <a title="ch.epfl.lamp.compiler.msil.Type" id="365234">newClass</a>: <span title="ch.epfl.lamp.compiler.msil.Type">MsilType</span>, <a title="String" id="365235">newName</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="GenMSIL.this.global.Symbol" id="366272">memberSym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a> = <a href="#365232" title="GenMSIL.this.global.Symbol">clazz</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.Type">tpe</a>.<a href="../../../../reflect/internal/Types.scala.html#42769" title="(name: GenMSIL.this.global.Name)GenMSIL.this.global.Symbol">member</a><span class="delimiter">(</span><a href="#365233" title="GenMSIL.this.global.Name">name</a><span class="delimiter">)</span>
        <a href="#366272" title="GenMSIL.this.global.Symbol">memberSym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.Type">tpe</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          // alternatives: List[Symbol]
          <span class="keyword">case</span> <span title="Unit">OverloadedType</span><span class="delimiter">(</span>_, <a title="List[GenMSIL.this.global.Symbol]" id="366279">alternatives</a><span class="delimiter">)</span> =&gt;
            <a href="#366279" title="List[GenMSIL.this.global.Symbol]">alternatives</a>.<span title="(f: GenMSIL.this.global.Symbol =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="366299">s</a> =&gt; <a href="#357112" title="(sym: GenMSIL.this.global.Symbol, newClass: ch.epfl.lamp.compiler.msil.Type, newName: String, paramTypes: Array[ch.epfl.lamp.compiler.msil.Type])Unit">mapMethod</a><span class="delimiter">(</span><a href="#366299" title="GenMSIL.this.global.Symbol">s</a>, <a href="#365234" title="ch.epfl.lamp.compiler.msil.Type">newClass</a>, <a href="#365235" title="String">newName</a>, <a href="#357083" title="(sym: GenMSIL.this.global.Symbol)Array[ch.epfl.lamp.compiler.msil.Type]">msilParamTypes</a><span class="delimiter">(</span><a href="#366299" title="GenMSIL.this.global.Symbol">s</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

          // paramTypes: List[Type], resType: Type
          <span class="keyword">case</span> <span title="Unit">MethodType</span><span class="delimiter">(</span><a title="List[GenMSIL.this.global.Symbol]" id="366309">params</a>, <a title="GenMSIL.this.global.Type" id="366310">resType</a><span class="delimiter">)</span> =&gt;
            <a href="#357112" title="(sym: GenMSIL.this.global.Symbol, newClass: ch.epfl.lamp.compiler.msil.Type, newName: String, paramTypes: Array[ch.epfl.lamp.compiler.msil.Type])Unit">mapMethod</a><span class="delimiter">(</span><a href="#366272" title="GenMSIL.this.global.Symbol">memberSym</a>, <a href="#365234" title="ch.epfl.lamp.compiler.msil.Type">newClass</a>, <a href="#365235" title="String">newName</a>, <a href="#357083" title="(sym: GenMSIL.this.global.Symbol)Array[ch.epfl.lamp.compiler.msil.Type]">msilParamTypes</a><span class="delimiter">(</span><a href="#366272" title="GenMSIL.this.global.Symbol">memberSym</a><span class="delimiter">)</span><span class="delimiter">)</span>

          <span class="keyword">case</span> <span title="Nothing">_</span> =&gt;
            <a href="../../Global.scala.html#182892" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="String(&quot;member not found: &quot;)" class="string">&quot;member not found: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#365232" title="GenMSIL.this.global.Symbol">clazz</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;, &quot;)" class="string">&quot;, &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#365233" title="GenMSIL.this.global.Name">name</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>


    /*
     * find the method in clazz with name and paramTypes
     */
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(clazz: GenMSIL.this.global.Symbol, name: GenMSIL.this.global.Name, paramTypes: Array[GenMSIL.this.global.Type])GenMSIL.this.global.Symbol" id="357116">lookupMethod</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="365751">clazz</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a>, <a title="GenMSIL.this.global.Name" id="365752">name</a>: <a href="../../../../reflect/internal/Names.scala.html#39679" title="GenMSIL.this.global.Name">Name</a>, <a title="Array[GenMSIL.this.global.Type]" id="365753">paramTypes</a>: <span title="Array[GenMSIL.this.global.Type]">Array</span><span class="delimiter">[</span>Type<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="GenMSIL.this.global.Symbol" id="366319">memberSym</a> = <a href="#365751" title="GenMSIL.this.global.Symbol">clazz</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.Type">tpe</a>.<a href="../../../../reflect/internal/Types.scala.html#42769" title="(name: GenMSIL.this.global.Name)GenMSIL.this.global.Symbol">member</a><span class="delimiter">(</span><a href="#365752" title="GenMSIL.this.global.Name">name</a><span class="delimiter">)</span>
      <a href="#366319" title="GenMSIL.this.global.Symbol">memberSym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.Type">tpe</a> <span title="GenMSIL.this.global.Symbol" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="GenMSIL.this.global.Symbol">OverloadedType</span><span class="delimiter">(</span>_, <a title="List[GenMSIL.this.global.Symbol]" id="366326">alternatives</a><span class="delimiter">)</span> =&gt;
          <a href="#366326" title="List[GenMSIL.this.global.Symbol]">alternatives</a>.<span title="(p: GenMSIL.this.global.Symbol =&gt; Boolean)Option[GenMSIL.this.global.Symbol]">find</span><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="366333">s</a> =&gt; <span class="delimiter">{</span>
            <span class="keyword">var</span> <a title="Int" id="366334">i</a>: <span title="Int">Int</span> = <span title="Int(0)" class="int">0</span>
            <span class="keyword">var</span> <a title="Boolean" id="366335">typesOK</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#365753" title="Array[GenMSIL.this.global.Type]">paramTypes</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <a href="#366333" title="GenMSIL.this.global.Symbol">s</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.Type">tpe</a>.<a href="../../../../reflect/internal/Types.scala.html#42751" title="=&gt; List[GenMSIL.this.global.Type]">paramTypes</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span title="Unit" class="keyword">while</span><span class="delimiter">(</span><a href="#366334" title="Int">i</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#365753" title="Array[GenMSIL.this.global.Type]">paramTypes</a>.<span title="=&gt; Int">length</span><span class="delimiter">)</span> <a href="#366342" title="()Unit" class="delimiter">{</a>
                <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#365753" title="(i: Int)GenMSIL.this.global.Type">paramTypes</a><span class="delimiter">(</span><a href="#366334" title="Int">i</a><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="#366333" title="GenMSIL.this.global.Symbol">s</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47918" title="=&gt; GenMSIL.this.global.Type">tpe</a>.<a href="../../../../reflect/internal/Types.scala.html#42751" title="(n: Int)GenMSIL.this.global.Type">paramTypes</a><span class="delimiter">(</span><a href="#366334" title="Int">i</a><span class="delimiter">)</span><span class="delimiter">)</span>
                  <a href="#366335" title="Boolean">typesOK</a> = <span title="Boolean(false)" class="keyword">false</span>
                <a href="#366334" title="Int">i</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
              <a href="#366335" title="Boolean">typesOK</a> = <span title="Boolean(false)" class="keyword">false</span>
            <span class="delimiter">}</span>
            <a href="#366335" title="Boolean">typesOK</a>
          <span class="delimiter">}</span><span class="delimiter">)</span> <span title="GenMSIL.this.global.Symbol" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="GenMSIL.this.global.Symbol">Some</span><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="366365">sym</a><span class="delimiter">)</span> =&gt; <a href="#366365" title="GenMSIL.this.global.Symbol">sym</a>
            <span class="keyword">case</span> <span title="Nothing">None</span> =&gt; <a href="../../Global.scala.html#182892" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="String(&quot;member of &quot;)" class="string">&quot;member of &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#365751" title="GenMSIL.this.global.Symbol">clazz</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;, &quot;)" class="string">&quot;, &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#365752" title="GenMSIL.this.global.Name">name</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;(&quot;)" class="string">&quot;(&quot;</span> <span title="(x$1: Any)String">+</span>
                               <a href="#365753" title="Array[GenMSIL.this.global.Type]">paramTypes</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;) not found&quot;)" class="string">&quot;) not found&quot;</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>

        <span class="keyword">case</span> <span title="GenMSIL.this.global.Symbol">MethodType</span><span class="delimiter">(</span>_, _<span class="delimiter">)</span> =&gt; <a href="#366319" title="GenMSIL.this.global.Symbol">memberSym</a>

        <span class="keyword">case</span> <span title="Nothing">_</span> =&gt; <a href="../../Global.scala.html#182892" title="(msg: String)Nothing">abort</a><span class="delimiter">(</span><span title="String(&quot;member not found: &quot;)" class="string">&quot;member not found: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#365752" title="GenMSIL.this.global.Name">name</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; of &quot;)" class="string">&quot; of &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#365751" title="GenMSIL.this.global.Symbol">clazz</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: GenMSIL.this.global.Symbol)String" id="357117">showsym</a><span class="delimiter">(</span><a title="GenMSIL.this.global.Symbol" id="360512">sym</a>: <a href="../../../../reflect/internal/Symbols.scala.html#40001" title="GenMSIL.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">(</span><a href="#360512" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#48046" title="()String">toString</a> <span title="(x$1: Any)String">+</span>
      <span title="String(&quot;\n  symbol = &quot;)" class="string">&quot;\n  symbol = &quot;</span> <span title="(x$1: Any)String">+</span> <a href="../../symtab/package.scala.html#36230" title="=&gt; reflect.internal.Flags.type">Flags</a>.<a href="../../../../reflect/internal/Flags.scala.html#39895" title="(flags: Long)String">flagsToString</a><span class="delimiter">(</span><a href="#360512" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47898" title="=&gt; Long">flags</a><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#360512" title="GenMSIL.this.global.Symbol">sym</a> <span title="(x$1: Any)String">+</span>
      <span title="String(&quot;\n  owner  = &quot;)" class="string">&quot;\n  owner  = &quot;</span> <span title="(x$1: Any)String">+</span> <a href="../../symtab/package.scala.html#36230" title="=&gt; reflect.internal.Flags.type">Flags</a>.<a href="../../../../reflect/internal/Flags.scala.html#39895" title="(flags: Long)String">flagsToString</a><span class="delimiter">(</span><a href="#360512" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.Symbol">owner</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47898" title="=&gt; Long">flags</a><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#360512" title="GenMSIL.this.global.Symbol">sym</a>.<a href="../../../../reflect/internal/Symbols.scala.html#47876" title="=&gt; GenMSIL.this.global.Symbol">owner</a>
    <span class="delimiter">)</span>

  <span class="delimiter">}</span> // class BytecodeGenerator

<span class="delimiter">}</span> // class GenMSIL

        </pre>
    </body>
</html>
<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/transform/LazyVals.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> transform

<span class="keyword">import</span> scala.collection.<span class="delimiter">{</span> mutable, immutable <span class="delimiter">}</span>

<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class LazyVals extends scala.tools.nsc.SubComponent with scala.tools.nsc.transform.Transform with scala.tools.nsc.transform.TypingTransformers with scala.tools.nsc.ast.TreeDSL with ScalaObject" id="28530">LazyVals</a> <a href="#28530" title="ScalaObject" class="keyword">extends</a> <a href="Transform.scala.html#28200" title="scala.tools.nsc.transform.Transform">Transform</a> <span class="keyword">with</span> <a href="TypingTransformers.scala.html#28392" title="scala.tools.nsc.transform.TypingTransformers">TypingTransformers</a> <span class="keyword">with</span> ast.<a href="../ast/TreeDSL.scala.html#14381" title="scala.tools.nsc.ast.TreeDSL">TreeDSL</a> <span class="delimiter">{</span>
  // inherits abstract value `global` and class `Phase` from Transform

  <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#187429" title="=&gt; scala.tools.nsc.Global">global</a>._                  // the global environment
  <span class="keyword">import</span> <a href="../../../reflect/internal/Definitions.scala.html#39224" title="object LazyVals.this.global.definitions">definitions</a>._             // standard classes and methods
  <span class="keyword">import</span> <a href="../Global.scala.html#186285" title="object LazyVals.this.global.typer">typer</a>.<span class="delimiter">{</span>typed, atOwner<span class="delimiter">}</span>    // methods to type trees
  <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#187433" title="object LazyVals.this.CODE">CODE</a>._

  <span class="keyword">val</span> <a title="String" id="242812">phaseName</a>: <span title="String">String</span> = <span title="String(&quot;lazyvals&quot;)" class="string">&quot;lazyvals&quot;</span>
  <span class="keyword">val</span> <a title="=&gt; Int" id="242814">FLAGS_PER_WORD</a>: <span title="Int">Int</span>

  <span class="keyword">def</span> <a title="(unit: LazyVals.this.global.CompilationUnit)LazyVals.this.global.Transformer" id="242815">newTransformer</a><span class="delimiter">(</span><a title="LazyVals.this.global.CompilationUnit" id="603727">unit</a>: <a href="../CompilationUnits.scala.html#186387" title="LazyVals.this.global.CompilationUnit">CompilationUnit</a><span class="delimiter">)</span>: <a href="../ast/Trees.scala.html#186434" title="LazyVals.this.global.Transformer">Transformer</a> =
    <span title="LazyVals.this.LazyValues" class="keyword">new</span> <a href="#242819" title="LazyVals.this.LazyValues">LazyValues</a><span class="delimiter">(</span><a href="#603727" title="LazyVals.this.global.CompilationUnit">unit</a><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: LazyVals.this.global.Symbol)Boolean" id="242816">lazyUnit</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="603745">sym</a>: <a href="../../../reflect/internal/Symbols.scala.html#38726" title="LazyVals.this.global.Symbol">Symbol</a><span class="delimiter">)</span> = <a href="#603745" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#46606" title="=&gt; LazyVals.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#41519" title="=&gt; LazyVals.this.global.Type">resultType</a>.<a href="../../../reflect/internal/Types.scala.html#41504" title="=&gt; LazyVals.this.global.Symbol">typeSymbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#45531" title="=&gt; LazyVals.this.global.Symbol">UnitClass</a>

  <span class="keyword">object</span> <a title="object LazyVals.this.LocalLazyValFinder" id="242817">LocalLazyValFinder</a> <span title="ScalaObject" class="keyword">extends</span> <a href="../ast/TreeDSL.scala.html#187429" title="LazyVals.this.global.Traverser">Traverser</a> <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Boolean" id="603759">result</a>: <span title="Boolean">Boolean</span>  = _

    <span class="keyword">def</span> <a title="(t: LazyVals.this.global.Tree)Boolean" id="603761">find</a><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="603766">t</a>: <span title="LazyVals.this.global.Tree">Tree</span><span class="delimiter">)</span> = <span class="delimiter">{</span><a href="#603759" title="(x$1: Boolean)Unit">result</a> = <span title="Boolean(false)" class="keyword">false</span>; <a href="#603763" title="(t: LazyVals.this.global.Tree)Unit">traverse</a><span class="delimiter">(</span><a href="#603766" title="LazyVals.this.global.Tree">t</a><span class="delimiter">)</span>; <a href="#603759" title="=&gt; Boolean">result</a><span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="(ts: List[LazyVals.this.global.Tree])Boolean" id="603762">find</a><span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="603772">ts</a>: <span title="List[LazyVals.this.global.Tree]">List</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span><a href="#603759" title="(x$1: Boolean)Unit">result</a> = <span title="Boolean(false)" class="keyword">false</span>; <span title="(trees: List[LazyVals.this.global.Tree])Unit">traverseTrees</span><span class="delimiter">(</span><a href="#603772" title="List[LazyVals.this.global.Tree]">ts</a><span class="delimiter">)</span>; <a href="#603759" title="=&gt; Boolean">result</a><span class="delimiter">}</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(t: LazyVals.this.global.Tree)Unit" id="603763">traverse</a><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="603769">t</a>: <span title="LazyVals.this.global.Tree">Tree</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#603759" title="=&gt; Boolean">result</a><span class="delimiter">)</span>
        <a href="#603769" title="LazyVals.this.global.Tree">t</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a title="Unit" id="603776">v</a>@ValDef<span class="delimiter">(</span>_, _, _, _<span class="delimiter">)</span> <span class="keyword">if</span> <a href="#603776" title="LazyVals.this.global.ValDef">v</a>.<span title="=&gt; LazyVals.this.global.Symbol">symbol</span>.<a href="../../../reflect/internal/HasFlags.scala.html#46779" title="=&gt; Boolean">isLazy</a> =&gt;
            <a href="#603759" title="(x$1: Boolean)Unit">result</a> = <span title="Boolean(true)" class="keyword">true</span>

          <span class="keyword">case</span> <a title="Unit" id="603786">d</a>@DefDef<span class="delimiter">(</span>_, _, _, _, _, _<span class="delimiter">)</span> <span class="keyword">if</span> <a href="#603786" title="LazyVals.this.global.DefDef">d</a>.<span title="=&gt; LazyVals.this.global.Symbol">symbol</span>.<a href="../../../reflect/internal/HasFlags.scala.html#46779" title="=&gt; Boolean">isLazy</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#242816" title="(sym: LazyVals.this.global.Symbol)Boolean">lazyUnit</a><span class="delimiter">(</span><a href="#603786" title="LazyVals.this.global.DefDef">d</a>.<span title="=&gt; LazyVals.this.global.Symbol">symbol</span><span class="delimiter">)</span> =&gt;
            <a href="#603786" title="LazyVals.this.global.DefDef">d</a>.<span title="=&gt; LazyVals.this.global.Symbol">symbol</span>.<a href="../../../reflect/internal/Symbols.scala.html#46590" title="(mask: Long)LazyVals.this.global.Symbol">resetFlag</a><span class="delimiter">(</span>symtab.Flags.<span title="Long(2147483648L)">LAZY</span><span class="delimiter">)</span>
            <a href="#603759" title="(x$1: Boolean)Unit">result</a> = <span title="Boolean(true)" class="keyword">true</span>

          <span class="keyword">case</span> <span title="Unit">ClassDef</span><span class="delimiter">(</span>_, _, _, _<span class="delimiter">)</span> | DefDef<span class="delimiter">(</span>_, _, _, _, _, _<span class="delimiter">)</span> | ModuleDef<span class="delimiter">(</span>_, _, _<span class="delimiter">)</span> =&gt;

          <span class="keyword">case</span> <span title="Unit">LabelDef</span><span class="delimiter">(</span><a title="LazyVals.this.global.TermName" id="603848">name</a>, _, _<span class="delimiter">)</span> <span class="keyword">if</span> <a href="../../../reflect/internal/StdNames.scala.html#39313" title="object LazyVals.this.global.nme">nme</a>.<a href="../../../reflect/internal/NameManglers.scala.html#59419" title="(name: LazyVals.this.global.Name)Boolean">isLoopHeaderLabel</a><span class="delimiter">(</span><a href="#603848" title="LazyVals.this.global.TermName">name</a><span class="delimiter">)</span> =&gt;

          <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
            <span class="keyword">super</span>.<span title="(tree: LazyVals.this.global.Tree)Unit">traverse</span><span class="delimiter">(</span><a href="#603769" title="LazyVals.this.global.Tree">t</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /**
   * Transform local lazy accessors to check for the initialized bit.
   */
  <span class="keyword">class</span> <a title="class LazyValues extends LazyVals.this.TypingTransformer with ScalaObject" id="242819">LazyValues</a><a href="#242819" title="ScalaObject" class="delimiter">(</a><a title="LazyVals.this.global.CompilationUnit" id="603744">unit</a>: <a href="../CompilationUnits.scala.html#186387" title="LazyVals.this.global.CompilationUnit">CompilationUnit</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="TypingTransformers.scala.html#242088" title="LazyVals.this.TypingTransformer">TypingTransformer</a><span class="delimiter">(</span><a href="#603744" title="LazyVals.this.global.CompilationUnit">unit</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    /** map from method symbols to the number of lazy values it defines. */
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,Int]" id="603733">lazyVals</a> = <a href="#603854" title="scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,Int]" class="keyword">new</a> <a title="anonymous class $anon extends scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,Int]" id="603854">mutable</a>.<span title="scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,Int]">HashMap</span><span class="delimiter">[</span>Symbol, Int<span class="delimiter">]</span> <span class="delimiter">{</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="(meth: LazyVals.this.global.Symbol)Int" id="603856">default</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="603857">meth</a>: <a href="../../../reflect/internal/Symbols.scala.html#38726" title="LazyVals.this.global.Symbol">Symbol</a><span class="delimiter">)</span> = <span title="Int(0)" class="int">0</span>
    <span class="delimiter">}</span>

    <span class="keyword">import</span> symtab.<a href="../symtab/package.scala.html#34879" title="=&gt; reflect.internal.Flags.type">Flags</a>._
    <span class="keyword">import</span> <a href="#603733" title="=&gt; scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,Int]">lazyVals</a>._

    /** Perform the following transformations:
     *  - for a lazy accessor inside a method, make it check the initialization bitmap
     *  - for all methods, add enough int vars to allow one flag per lazy local value
     *  - blocks in template bodies behave almost like methods. A single bitmaps section is
     *      added in the first block, for all lazy values defined in such blocks.
     *  - remove ACCESSOR flags: accessors in traits are not statically implemented,
     *    but moved to the host class. local lazy values should be statically implemented.
     */
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree" id="603737">transform</a><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="603955">tree</a>: <span title="LazyVals.this.global.Tree">Tree</span><span class="delimiter">)</span>: <span title="LazyVals.this.global.Tree">Tree</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="LazyVals.this.global.Symbol" id="603960">sym</a> = <a href="#603955" title="LazyVals.this.global.Tree">tree</a>.<span title="=&gt; LazyVals.this.global.Symbol">symbol</span>
      <a href="TypingTransformers.scala.html#597942" title="(x$1: LazyVals.this.global.Tree)Unit">curTree</a> = <a href="#603955" title="LazyVals.this.global.Tree">tree</a>

      <a href="#603955" title="LazyVals.this.global.Tree">tree</a> <span title="LazyVals.this.global.Tree" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="LazyVals.this.global.DefDef">DefDef</span><span class="delimiter">(</span><a title="LazyVals.this.global.Modifiers" id="603971">mods</a>, <a title="LazyVals.this.global.Name" id="603972">name</a>, <a title="List[LazyVals.this.global.TypeDef]" id="603973">tparams</a>, <a title="List[List[LazyVals.this.global.ValDef]]" id="603974">vparams</a>, <a title="LazyVals.this.global.Tree" id="603975">tpt</a>, <a title="LazyVals.this.global.Tree" id="603976">rhs</a><span class="delimiter">)</span> =&gt; <a href="TypingTransformers.scala.html#597947" title="(owner: LazyVals.this.global.Symbol)(trans: =&gt; LazyVals.this.global.DefDef)LazyVals.this.global.DefDef">atOwner</a><span class="delimiter">(</span><a href="#603955" title="LazyVals.this.global.Tree">tree</a>.<span title="=&gt; LazyVals.this.global.Symbol">symbol</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="LazyVals.this.global.Tree" id="603996">res</a> = <span title="LazyVals.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#603960" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#46564" title="=&gt; LazyVals.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#46445" title="=&gt; Boolean">isClass</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#603960" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/HasFlags.scala.html#46779" title="=&gt; Boolean">isLazy</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="LazyVals.this.global.Symbol" id="603998">enclosingClassOrDummyOrMethod</a> = <span class="delimiter">{</span>
              <span class="keyword">val</span> <a title="LazyVals.this.global.Symbol" id="604001">enclMethod</a> = <a href="#603960" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#46663" title="=&gt; LazyVals.this.global.Symbol">enclMethod</a>

              <span title="LazyVals.this.global.Symbol" class="keyword">if</span> <span class="delimiter">(</span><a href="#604001" title="LazyVals.this.global.Symbol">enclMethod</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../../reflect/internal/Symbols.scala.html#38740" title="=&gt; LazyVals.this.global.NoSymbol">NoSymbol</a> <span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">val</span> <a title="LazyVals.this.global.Symbol" id="604006">enclClass</a> = <a href="#603960" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#46662" title="=&gt; LazyVals.this.global.Symbol">enclClass</a>
                <span title="LazyVals.this.global.Symbol" class="keyword">if</span> <span class="delimiter">(</span><a href="#604006" title="LazyVals.this.global.Symbol">enclClass</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../../reflect/internal/Symbols.scala.html#38740" title="=&gt; LazyVals.this.global.NoSymbol">NoSymbol</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#604001" title="LazyVals.this.global.Symbol">enclMethod</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#604006" title="LazyVals.this.global.Symbol">enclClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#46663" title="=&gt; LazyVals.this.global.Symbol">enclMethod</a><span class="delimiter">)</span>
                  <a href="#604006" title="LazyVals.this.global.Symbol">enclClass</a>
                <span class="keyword">else</span>
                  <a href="#604001" title="LazyVals.this.global.Symbol">enclMethod</a>
              <span class="delimiter">}</span> <span class="keyword">else</span>
                <a href="#603960" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#46564" title="=&gt; LazyVals.this.global.Symbol">owner</a>
            <span class="delimiter">}</span>
            <span class="keyword">val</span> <a title="Int" id="603999">idx</a> = <a href="#603733" title="(key: LazyVals.this.global.Symbol)Int">lazyVals</a><span class="delimiter">(</span><a href="#603998" title="LazyVals.this.global.Symbol">enclosingClassOrDummyOrMethod</a><span class="delimiter">)</span>
            <a href="#603733" title="(key: LazyVals.this.global.Symbol, value: Int)Unit">lazyVals</a><span class="delimiter">(</span><a href="#603998" title="LazyVals.this.global.Symbol">enclosingClassOrDummyOrMethod</a><span class="delimiter">)</span> = <a href="#603999" title="Int">idx</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>
            <span class="keyword">val</span> <a title="LazyVals.this.global.Tree" id="604000">rhs1</a> = <a href="#603739" title="(methOrClass: LazyVals.this.global.Symbol, tree: LazyVals.this.global.Tree, offset: Int, lazyVal: LazyVals.this.global.Symbol)LazyVals.this.global.Tree">mkLazyDef</a><span class="delimiter">(</span><a href="#603998" title="LazyVals.this.global.Symbol">enclosingClassOrDummyOrMethod</a>, <a href="#242819" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="TypingTransformers.scala.html#597953" title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#603976" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span>, <a href="#603999" title="Int">idx</a>, <a href="#603960" title="LazyVals.this.global.Symbol">sym</a><span class="delimiter">)</span>
            <a href="#603960" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#46590" title="(mask: Long)sym.type">resetFlag</a><span class="delimiter">(</span><span class="delimiter">(</span><span title="Long" class="keyword">if</span> <span class="delimiter">(</span><a href="#242816" title="(sym: LazyVals.this.global.Symbol)Boolean">lazyUnit</a><span class="delimiter">(</span><a href="#603960" title="LazyVals.this.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="Long(0L)" class="int">0</span> <span class="keyword">else</span> <span title="Long(2147483648L)">LAZY</span><span class="delimiter">)</span> <span title="(x: Int)Long">|</span> <span title="Int(134217728)">ACCESSOR</span><span class="delimiter">)</span>
            <a href="#604000" title="LazyVals.this.global.Tree">rhs1</a>
          <span class="delimiter">}</span> <span class="keyword">else</span>
            <a href="#242819" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="TypingTransformers.scala.html#597953" title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#603976" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span>

          <a href="#242819" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<span title="(tree: LazyVals.this.global.Tree, mods: LazyVals.this.global.Modifiers, name: LazyVals.this.global.Name, tparams: List[LazyVals.this.global.TypeDef], vparamss: List[List[LazyVals.this.global.ValDef]], tpt: LazyVals.this.global.Tree, rhs: LazyVals.this.global.Tree)LazyVals.this.global.DefDef">DefDef</span><span class="delimiter">(</span><a href="#603955" title="LazyVals.this.global.Tree">tree</a>, <a href="#603971" title="LazyVals.this.global.Modifiers">mods</a>, <a href="#603972" title="LazyVals.this.global.Name">name</a>, <a href="#603973" title="List[LazyVals.this.global.TypeDef]">tparams</a>, <a href="#603974" title="List[List[LazyVals.this.global.ValDef]]">vparams</a>, <a href="#603975" title="LazyVals.this.global.Tree">tpt</a>,
                  <span title="LazyVals.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#242817" title="object LazyVals.this.LocalLazyValFinder">LocalLazyValFinder</a>.<a href="#603761" title="(t: LazyVals.this.global.Tree)Boolean">find</a><span class="delimiter">(</span><a href="#603996" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../typechecker/Typers.scala.html#187859" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#603738" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#603960" title="LazyVals.this.global.Symbol">sym</a>, <a href="#603996" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#603996" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span class="keyword">case</span> <span title="LazyVals.this.global.Template">Template</span><span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="604109">parents</a>, <a title="LazyVals.this.global.ValDef" id="604110">self</a>, <a title="List[LazyVals.this.global.Tree]" id="604111">body</a><span class="delimiter">)</span> =&gt; <a href="TypingTransformers.scala.html#597947" title="(owner: LazyVals.this.global.Symbol)(trans: =&gt; LazyVals.this.global.Template)LazyVals.this.global.Template">atOwner</a><span class="delimiter">(</span><a href="#242819" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="List[LazyVals.this.global.Tree]" id="604127">body1</a> = <a href="#242819" title="LazyVals.this.LazyValues" class="keyword">super</a>.<span title="(trees: List[LazyVals.this.global.Tree])List[LazyVals.this.global.Tree]">transformTrees</span><span class="delimiter">(</span><a href="#604111" title="List[LazyVals.this.global.Tree]">body</a><span class="delimiter">)</span>
          <span class="keyword">var</span> <a title="Boolean" id="604128">added</a> = <span title="Boolean(false)" class="keyword">false</span>
          <span class="keyword">val</span> <a title="List[LazyVals.this.global.analyzer.global.Tree]" id="604129">stats</a> =
            <span class="keyword">for</span> <span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="604149">stat</a> &lt;- <a href="#604127" title="(f: LazyVals.this.global.Tree =&gt; LazyVals.this.global.analyzer.global.Tree)(implicit bf: scala.collection.generic.CanBuildFrom[List[LazyVals.this.global.Tree],LazyVals.this.global.analyzer.global.Tree,List[LazyVals.this.global.analyzer.global.Tree]])List[LazyVals.this.global.analyzer.global.Tree]">body1</a><span class="delimiter">)</span> <span class="keyword">yield</span> <a href="#604149" title="LazyVals.this.global.Tree">stat</a> <span title="LazyVals.this.global.analyzer.global.Tree" class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <span title="LazyVals.this.global.analyzer.global.Tree">Block</span><span class="delimiter">(</span>_, _<span class="delimiter">)</span> | Apply<span class="delimiter">(</span>_, _<span class="delimiter">)</span> | If<span class="delimiter">(</span>_, _, _<span class="delimiter">)</span> <span class="keyword">if</span> <span title="=&gt; Boolean">!</span><a href="#604128" title="Boolean">added</a> =&gt;
                // Avoid adding bitmaps when they are fully overshadowed by those
                // that are added inside loops
                <span title="LazyVals.this.global.analyzer.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#242817" title="object LazyVals.this.LocalLazyValFinder">LocalLazyValFinder</a>.<a href="#603761" title="(t: LazyVals.this.global.Tree)Boolean">find</a><span class="delimiter">(</span><a href="#604149" title="LazyVals.this.global.Tree">stat</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                  <a href="#604128" title="Boolean">added</a> = <span title="Boolean(true)" class="keyword">true</span>
                  <a href="../typechecker/Typers.scala.html#187859" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#603738" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#603960" title="LazyVals.this.global.Symbol">sym</a>, <a href="#604149" title="LazyVals.this.global.Tree">stat</a><span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#604149" title="LazyVals.this.global.Tree">stat</a>
              <span class="keyword">case</span> <span title="LazyVals.this.global.analyzer.global.Tree">ValDef</span><span class="delimiter">(</span><a title="LazyVals.this.global.Modifiers" id="604176">mods</a>, <a title="LazyVals.this.global.TermName" id="604177">name</a>, <a title="LazyVals.this.global.Tree" id="604178">tpt</a>, <a title="LazyVals.this.global.Tree" id="604179">rhs</a><span class="delimiter">)</span> =&gt;
                <a href="../typechecker/Typers.scala.html#187859" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#242819" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<span title="(tree: LazyVals.this.global.Tree, mods: LazyVals.this.global.Modifiers, name: LazyVals.this.global.Name, tpt: LazyVals.this.global.Tree, rhs: LazyVals.this.global.Tree)LazyVals.this.global.ValDef">ValDef</span><span class="delimiter">(</span><a href="#604149" title="LazyVals.this.global.Tree">stat</a>, <a href="#604176" title="LazyVals.this.global.Modifiers">mods</a>, <a href="#604177" title="LazyVals.this.global.TermName">name</a>, <a href="#604178" title="LazyVals.this.global.Tree">tpt</a>, <a href="#603738" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#604149" title="LazyVals.this.global.Tree">stat</a>.<span title="=&gt; LazyVals.this.global.Symbol">symbol</span>, <a href="#604179" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="LazyVals.this.global.Tree">_</span> =&gt;
                <a href="#604149" title="LazyVals.this.global.Tree">stat</a>
            <span class="delimiter">}</span>
          <span class="keyword">val</span> <a title="List[LazyVals.this.global.analyzer.global.Tree]" id="604130">innerClassBitmaps</a> = <span title="List[LazyVals.this.global.analyzer.global.Tree]" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#604128" title="Boolean">added</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#242819" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a>.<a href="../../../reflect/internal/Symbols.scala.html#46445" title="=&gt; Boolean">isClass</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#603741" title="=&gt; scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]{def default(meth: LazyVals.this.global.Symbol): scala.collection.immutable.Nil.type}">bitmaps</a>.<span title="(key: LazyVals.this.global.Symbol)Boolean">contains</span><span class="delimiter">(</span><a href="#242819" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              // add bitmap to inner class if necessary
                <span class="keyword">val</span> <a title="List[LazyVals.this.global.analyzer.global.Tree]" id="604218">toAdd0</a> = <a href="#603741" title="(key: LazyVals.this.global.Symbol)List[LazyVals.this.global.Symbol]">bitmaps</a><span class="delimiter">(</span><a href="#242819" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a><span class="delimiter">)</span>.<span title="(f: LazyVals.this.global.Symbol =&gt; LazyVals.this.global.analyzer.global.Tree)(implicit bf: scala.collection.generic.CanBuildFrom[List[LazyVals.this.global.Symbol],LazyVals.this.global.analyzer.global.Tree,List[LazyVals.this.global.analyzer.global.Tree]])List[LazyVals.this.global.analyzer.global.Tree]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,LazyVals.this.global.analyzer.global.Tree,List[LazyVals.this.global.analyzer.global.Tree]]" class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="604250">s</a> =&gt; <a href="../typechecker/Typers.scala.html#187859" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#39363" title="(sym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.ValDef">ValDef</a><span class="delimiter">(</span><a href="#604250" title="LazyVals.this.global.Symbol">s</a>, <a href="../ast/TreeDSL.scala.html#244788" title="=&gt; LazyVals.this.global.Literal">ZERO</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                <a href="#604218" title="List[LazyVals.this.global.analyzer.global.Tree]">toAdd0</a>.<span title="(f: LazyVals.this.global.analyzer.global.Tree =&gt; Any)Unit">foreach</span><span class="delimiter">(</span><a title="LazyVals.this.global.analyzer.global.Tree" id="604313">t</a> =&gt; <span class="delimiter">{</span>
                    <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#242819" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a>.<a href="../../../reflect/internal/Symbols.scala.html#46608" title="=&gt; LazyVals.this.global.Type">info</a>.<a href="../../../reflect/internal/Types.scala.html#41537" title="(name: LazyVals.this.global.Name)LazyVals.this.global.Symbol">decl</a><span class="delimiter">(</span><a href="#604313" title="LazyVals.this.global.analyzer.global.Tree">t</a>.<span title="=&gt; LazyVals.this.global.analyzer.global.Symbol">symbol</span>.<a href="../../../reflect/internal/Symbols.scala.html#46571" title="=&gt; LazyVals.this.global.analyzer.global.Name">name</a><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Symbols.scala.html#38740" title="=&gt; LazyVals.this.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                      <a href="#604313" title="LazyVals.this.global.analyzer.global.Tree">t</a>.<span title="=&gt; LazyVals.this.global.analyzer.global.Symbol">symbol</span>.<a href="../../../reflect/internal/Symbols.scala.html#46589" title="(mask: Long)LazyVals.this.global.analyzer.global.Symbol">setFlag</a><span class="delimiter">(</span><span title="Long(1L)">PROTECTED</span><span class="delimiter">)</span>
                      <a href="#242819" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a>.<a href="../../../reflect/internal/Symbols.scala.html#46608" title="=&gt; LazyVals.this.global.Type">info</a>.<a href="../../../reflect/internal/Types.scala.html#41536" title="=&gt; LazyVals.this.global.Scope">decls</a>.<a href="../../../reflect/internal/Scopes.scala.html#60499" title="(sym: LazyVals.this.global.Symbol)LazyVals.this.global.Symbol">enter</a><span class="delimiter">(</span><a href="#604313" title="LazyVals.this.global.analyzer.global.Tree">t</a>.<span title="=&gt; LazyVals.this.global.analyzer.global.Symbol">symbol</span><span class="delimiter">)</span>
                    <span class="delimiter">}</span>
                <span class="delimiter">}</span><span class="delimiter">)</span>
                <a href="#604218" title="List[LazyVals.this.global.analyzer.global.Tree]">toAdd0</a>
            <span class="delimiter">}</span> <span class="keyword">else</span> List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#242819" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<span title="(tree: LazyVals.this.global.Tree, parents: List[LazyVals.this.global.Tree], self: LazyVals.this.global.ValDef, body: List[LazyVals.this.global.Tree])LazyVals.this.global.Template">Template</span><span class="delimiter">(</span><a href="#603955" title="LazyVals.this.global.Tree">tree</a>, <a href="#604109" title="List[LazyVals.this.global.Tree]">parents</a>, <a href="#604110" title="LazyVals.this.global.ValDef">self</a>, <a href="#604130" title="List[LazyVals.this.global.analyzer.global.Tree]">innerClassBitmaps</a> <span title="(that: scala.collection.GenTraversableOnce[LazyVals.this.global.analyzer.global.Tree])(implicit bf: scala.collection.generic.CanBuildFrom[List[LazyVals.this.global.analyzer.global.Tree],LazyVals.this.global.analyzer.global.Tree,List[LazyVals.this.global.Tree]])List[LazyVals.this.global.Tree]">++</span> <a href="#604129" title="List[LazyVals.this.global.analyzer.global.Tree]">stats</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span class="keyword">case</span> <span title="LazyVals.this.global.ValDef">ValDef</span><span class="delimiter">(</span><a title="LazyVals.this.global.Modifiers" id="604417">mods</a>, <a title="LazyVals.this.global.TermName" id="604418">name</a>, <a title="LazyVals.this.global.Tree" id="604419">tpt</a>, <a title="LazyVals.this.global.Tree" id="604420">rhs0</a><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#603960" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#46564" title="=&gt; LazyVals.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#46462" title="=&gt; Boolean">isModule</a> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#603960" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#46564" title="=&gt; LazyVals.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#46445" title="=&gt; Boolean">isClass</a><span class="delimiter">)</span> =&gt;
          <span class="keyword">val</span> <a title="LazyVals.this.global.Tree" id="604422">rhs</a> = <a href="#242819" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="TypingTransformers.scala.html#597953" title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#604420" title="LazyVals.this.global.Tree">rhs0</a><span class="delimiter">)</span>
          <a href="#242819" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<span title="(tree: LazyVals.this.global.Tree, mods: LazyVals.this.global.Modifiers, name: LazyVals.this.global.Name, tpt: LazyVals.this.global.Tree, rhs: LazyVals.this.global.Tree)LazyVals.this.global.ValDef">ValDef</span><span class="delimiter">(</span><a href="#603955" title="LazyVals.this.global.Tree">tree</a>, <a href="#604417" title="LazyVals.this.global.Modifiers">mods</a>, <a href="#604418" title="LazyVals.this.global.TermName">name</a>, <a href="#604419" title="LazyVals.this.global.Tree">tpt</a>,
                  <span title="LazyVals.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#242817" title="object LazyVals.this.LocalLazyValFinder">LocalLazyValFinder</a>.<a href="#603761" title="(t: LazyVals.this.global.Tree)Boolean">find</a><span class="delimiter">(</span><a href="#604422" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../typechecker/Typers.scala.html#187859" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#603738" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#603960" title="LazyVals.this.global.Symbol">sym</a>, <a href="#604422" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#604422" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span>

        <span class="keyword">case</span> <a title="LazyVals.this.global.Tree" id="604432">l</a>@LabelDef<span class="delimiter">(</span><a title="LazyVals.this.global.TermName" id="604438">name0</a>, <a title="List[LazyVals.this.global.Ident]" id="604439">params0</a>, <a title="LazyVals.this.global.If" id="604440">ifp0</a>@If<span class="delimiter">(</span>_, _, _<span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#604438" title="LazyVals.this.global.TermName">name0</a>.<a href="../../../reflect/internal/Names.scala.html#52157" title="(name: String)Boolean">startsWith</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#39313" title="object LazyVals.this.global.nme">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#58664" title="=&gt; String">WHILE_PREFIX</a><span class="delimiter">)</span> =&gt;
          <span class="keyword">val</span> <a title="LazyVals.this.global.Tree" id="604451">ifp1</a> = <a href="#242819" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="TypingTransformers.scala.html#597953" title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#604440" title="LazyVals.this.global.If">ifp0</a><span class="delimiter">)</span>
          <span class="keyword">val</span> If<a href="#604453" title="(LazyVals.this.global.Tree, LazyVals.this.global.Tree, LazyVals.this.global.Tree)" class="delimiter">(</a><a href="#604452" title="LazyVals.this.global.Tree" id="604453">cond0</a>, <a href="#604452" title="LazyVals.this.global.Tree" id="604454">thenp0</a>, <a href="#604452" title="LazyVals.this.global.Tree" id="604455">elsep0</a><span class="delimiter">)</span> = <a href="#604451" title="LazyVals.this.global.Tree">ifp1</a>
          <span title="LazyVals.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#242817" title="object LazyVals.this.LocalLazyValFinder">LocalLazyValFinder</a>.<a href="#603761" title="(t: LazyVals.this.global.Tree)Boolean">find</a><span class="delimiter">(</span><a href="#604454" title="LazyVals.this.global.Tree">thenp0</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#242819" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<span title="(tree: LazyVals.this.global.Tree, name: LazyVals.this.global.Name, params: List[LazyVals.this.global.Ident], rhs: LazyVals.this.global.Tree)LazyVals.this.global.LabelDef">LabelDef</span><span class="delimiter">(</span><a href="#604432" title="LazyVals.this.global.LabelDef">l</a>, <a href="#604438" title="LazyVals.this.global.TermName">name0</a>, <a href="#604439" title="List[LazyVals.this.global.Ident]">params0</a>,
                    <a href="#242819" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<span title="(tree: LazyVals.this.global.Tree, cond: LazyVals.this.global.Tree, thenp: LazyVals.this.global.Tree, elsep: LazyVals.this.global.Tree)LazyVals.this.global.If">If</span><span class="delimiter">(</span><a href="#604451" title="LazyVals.this.global.Tree">ifp1</a>, <a href="#604453" title="LazyVals.this.global.Tree">cond0</a>, <a href="../typechecker/Typers.scala.html#187859" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#603738" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#603960" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#46564" title="=&gt; LazyVals.this.global.Symbol">owner</a>, <a href="#604454" title="LazyVals.this.global.Tree">thenp0</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#604455" title="LazyVals.this.global.Tree">elsep0</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">else</span>
            <a href="#604432" title="LazyVals.this.global.LabelDef">l</a>

        <span class="keyword">case</span> <a title="LazyVals.this.global.Tree" id="604488">l</a>@LabelDef<span class="delimiter">(</span><a title="LazyVals.this.global.TermName" id="604494">name0</a>, <a title="List[LazyVals.this.global.Ident]" id="604495">params0</a>, <a title="LazyVals.this.global.Block" id="604496">block</a>@Block<span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="604501">stats0</a>, _<span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">if</span> <a href="#604494" title="LazyVals.this.global.TermName">name0</a>.<a href="../../../reflect/internal/Names.scala.html#52157" title="(name: String)Boolean">startsWith</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#39313" title="object LazyVals.this.global.nme">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#58664" title="=&gt; String">WHILE_PREFIX</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">||</span> <a href="#604494" title="LazyVals.this.global.TermName">name0</a>.<a href="../../../reflect/internal/Names.scala.html#52157" title="(name: String)Boolean">startsWith</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#39313" title="object LazyVals.this.global.nme">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#58648" title="=&gt; String">DO_WHILE_PREFIX</a><span class="delimiter">)</span> =&gt;
          <span class="keyword">val</span> <a title="List[LazyVals.this.global.Tree]" id="604513">stats1</a> = <a href="#242819" title="LazyVals.this.LazyValues" class="keyword">super</a>.<span title="(trees: List[LazyVals.this.global.Tree])List[LazyVals.this.global.Tree]">transformTrees</span><span class="delimiter">(</span><a href="#604501" title="List[LazyVals.this.global.Tree]">stats0</a><span class="delimiter">)</span>
          <span title="LazyVals.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#242817" title="object LazyVals.this.LocalLazyValFinder">LocalLazyValFinder</a>.<a href="#603762" title="(ts: List[LazyVals.this.global.Tree])Boolean">find</a><span class="delimiter">(</span><a href="#604513" title="List[LazyVals.this.global.Tree]">stats1</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="#242819" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<span title="(tree: LazyVals.this.global.Tree, name: LazyVals.this.global.Name, params: List[LazyVals.this.global.Ident], rhs: LazyVals.this.global.Tree)LazyVals.this.global.LabelDef">LabelDef</span><span class="delimiter">(</span><a href="#604488" title="LazyVals.this.global.LabelDef">l</a>, <a href="#604494" title="LazyVals.this.global.TermName">name0</a>, <a href="#604495" title="List[LazyVals.this.global.Ident]">params0</a>,
                    <a href="#242819" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<span title="(tree: LazyVals.this.global.Tree, stats: List[LazyVals.this.global.Tree], expr: LazyVals.this.global.Tree)LazyVals.this.global.Block">Block</span><span class="delimiter">(</span><a href="#604496" title="LazyVals.this.global.Block">block</a>, <a href="../typechecker/Typers.scala.html#187859" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#603738" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#603960" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#46564" title="=&gt; LazyVals.this.global.Symbol">owner</a>, <a href="#604513" title="List[LazyVals.this.global.Tree]">stats1</a>.<span title="=&gt; LazyVals.this.global.Tree">head</span><span class="delimiter">)</span><span class="delimiter">)</span><a href="#604523" title="(x: LazyVals.this.global.Tree)List[LazyVals.this.global.Tree]">::</a><a href="#604513" title="List[LazyVals.this.global.Tree]">stats1</a>.<span title="=&gt; List[LazyVals.this.global.Tree]">tail</span>, <a href="#604496" title="LazyVals.this.global.Block">block</a>.<span title="=&gt; LazyVals.this.global.Tree">expr</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">else</span>
            <a href="#604488" title="LazyVals.this.global.LabelDef">l</a>

        <span class="keyword">case</span> <span title="LazyVals.this.global.Tree">_</span> =&gt; <a href="#242819" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="TypingTransformers.scala.html#597953" title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#603955" title="LazyVals.this.global.Tree">tree</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    /** Add the bitmap definitions to the rhs of a method definition.
     *  If the rhs has been tail-call transformed, insert the bitmap
     *  definitions inside the top-level label definition, so that each
     *  iteration has the lazy values un-initialized. Otherwise add them
     *  at the very beginning of the method.
     */
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree" id="603738">addBitmapDefs</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="604092">methSym</a>: <a href="../../../reflect/internal/Symbols.scala.html#38726" title="LazyVals.this.global.Symbol">Symbol</a>, <a title="LazyVals.this.global.Tree" id="604093">rhs</a>: <span title="LazyVals.this.global.Tree">Tree</span><span class="delimiter">)</span>: <span title="LazyVals.this.global.Tree">Tree</span> = <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(stats: List[LazyVals.this.global.Tree], tree: LazyVals.this.global.Tree)LazyVals.this.global.Block" id="604534">prependStats</a><span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="604537">stats</a>: <span title="List[LazyVals.this.global.Tree]">List</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span>, <a title="LazyVals.this.global.Tree" id="604538">tree</a>: <span title="LazyVals.this.global.Tree">Tree</span><span class="delimiter">)</span>: <span title="LazyVals.this.global.Block">Block</span> = <a href="#604538" title="LazyVals.this.global.Tree">tree</a> <span title="LazyVals.this.global.Block" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="LazyVals.this.global.Block">Block</span><span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="604543">stats1</a>, <a title="LazyVals.this.global.Tree" id="604544">res</a><span class="delimiter">)</span> =&gt; <a href="../ast/TreeDSL.scala.html#187429" title="(stats: List[LazyVals.this.global.Tree], expr: LazyVals.this.global.Tree)LazyVals.this.global.Block">Block</a><span class="delimiter">(</span><a href="#604537" title="List[LazyVals.this.global.Tree]">stats</a> <a href="#604557" title="(prefix: List[LazyVals.this.global.Tree])List[LazyVals.this.global.Tree]">:::</a> <a href="#604543" title="List[LazyVals.this.global.Tree]">stats1</a>, <a href="#604544" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="LazyVals.this.global.Block">_</span> =&gt; <a href="../ast/TreeDSL.scala.html#187429" title="(stats: List[LazyVals.this.global.Tree], expr: LazyVals.this.global.Tree)LazyVals.this.global.Block">Block</a><span class="delimiter">(</span><a href="#604537" title="List[LazyVals.this.global.Tree]">stats</a>, <a href="#604538" title="LazyVals.this.global.Tree">tree</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="List[LazyVals.this.global.ValDef]" id="604535">bmps</a> = <a href="#603741" title="(key: LazyVals.this.global.Symbol)List[LazyVals.this.global.Symbol]">bitmaps</a><span class="delimiter">(</span><a href="#604092" title="LazyVals.this.global.Symbol">methSym</a><span class="delimiter">)</span> <span title="(f: LazyVals.this.global.Symbol =&gt; LazyVals.this.global.ValDef)(implicit bf: scala.collection.generic.CanBuildFrom[List[LazyVals.this.global.Symbol],LazyVals.this.global.ValDef,List[LazyVals.this.global.ValDef]])List[LazyVals.this.global.ValDef]">map</span> <span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#39363" title="(sym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.ValDef">ValDef</a><span class="delimiter">(</span><a href="#604616" title="LazyVals.this.global.Symbol">_</a>, <a href="../ast/TreeDSL.scala.html#244788" title="=&gt; LazyVals.this.global.Literal">ZERO</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">def</span> <a title="(params: List[LazyVals.this.global.Ident])Boolean" id="604536">isMatch</a><span class="delimiter">(</span><a title="List[LazyVals.this.global.Ident]" id="604654">params</a>: <span title="List[LazyVals.this.global.Ident]">List</span><span class="delimiter">[</span>Ident<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="#604654" title="List[LazyVals.this.global.Ident]">params</a>.<span title="=&gt; List[LazyVals.this.global.Ident]">tail</span> <span title="(that: scala.collection.GenSeq[LazyVals.this.global.Symbol])(p: (LazyVals.this.global.Ident, LazyVals.this.global.Symbol) =&gt; Boolean)Boolean">corresponds</span> <a href="#604092" title="LazyVals.this.global.Symbol">methSym</a>.<a href="../../../reflect/internal/Symbols.scala.html#46606" title="=&gt; LazyVals.this.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#41526" title="=&gt; List[LazyVals.this.global.Symbol]">params</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#604694" title="LazyVals.this.global.Ident">_</a>.<span title="=&gt; LazyVals.this.global.Type">tpe</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#604695" title="LazyVals.this.global.Symbol">_</a>.<a href="../../../reflect/internal/Symbols.scala.html#46606" title="=&gt; LazyVals.this.global.Type">tpe</a><span class="delimiter">)</span>

      <span title="LazyVals.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#604535" title="List[LazyVals.this.global.ValDef]">bmps</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#604093" title="LazyVals.this.global.Tree">rhs</a> <span class="keyword">else</span> <a href="#604093" title="LazyVals.this.global.Tree">rhs</a> <span title="LazyVals.this.global.Tree" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="LazyVals.this.global.Block">Block</span><span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="604705">assign</a>, <a title="LazyVals.this.global.LabelDef" id="604706">l</a> @ LabelDef<span class="delimiter">(</span><a title="LazyVals.this.global.TermName" id="604712">name</a>, <a title="List[LazyVals.this.global.Ident]" id="604713">params</a>, <a title="LazyVals.this.global.Tree" id="604714">rhs1</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">if</span> <a href="#604712" title="LazyVals.this.global.TermName">name</a>.<span title="()String">toString</span> <span title="(x$1: AnyRef)Boolean">==</span> <span class="delimiter">(</span><span title="String(&quot;_&quot;)" class="string">&quot;_&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#604092" title="LazyVals.this.global.Symbol">methSym</a>.<a href="../../../reflect/internal/Symbols.scala.html#46571" title="=&gt; LazyVals.this.global.Name">name</a><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#604536" title="(params: List[LazyVals.this.global.Ident])Boolean">isMatch</a><span class="delimiter">(</span><a href="#604713" title="List[LazyVals.this.global.Ident]">params</a><span class="delimiter">)</span> =&gt;
            <a href="../ast/TreeDSL.scala.html#187429" title="(stats: List[LazyVals.this.global.Tree], expr: LazyVals.this.global.Tree)LazyVals.this.global.Block">Block</a><span class="delimiter">(</span><a href="#604705" title="List[LazyVals.this.global.Tree]">assign</a>, <a href="#242819" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<span title="(tree: LazyVals.this.global.Tree, name: LazyVals.this.global.Name, params: List[LazyVals.this.global.Ident], rhs: LazyVals.this.global.Tree)LazyVals.this.global.LabelDef">LabelDef</span><span class="delimiter">(</span><a href="#604706" title="LazyVals.this.global.LabelDef">l</a>, <a href="#604712" title="LazyVals.this.global.TermName">name</a>, <a href="#604713" title="List[LazyVals.this.global.Ident]">params</a>, <a href="../typechecker/Typers.scala.html#187859" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#604534" title="(stats: List[LazyVals.this.global.Tree], tree: LazyVals.this.global.Tree)LazyVals.this.global.Block">prependStats</a><span class="delimiter">(</span><a href="#604535" title="List[LazyVals.this.global.ValDef]">bmps</a>, <a href="#604714" title="LazyVals.this.global.Tree">rhs1</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

        <span class="keyword">case</span> <span title="LazyVals.this.global.Block">_</span> =&gt; <a href="#604534" title="(stats: List[LazyVals.this.global.Tree], tree: LazyVals.this.global.Tree)LazyVals.this.global.Block">prependStats</a><span class="delimiter">(</span><a href="#604535" title="List[LazyVals.this.global.ValDef]">bmps</a>, <a href="#604093" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    /** return a 'lazified' version of rhs. Rhs should conform to the
     *  following schema:
     *  {
     *    l$ = &lt;rhs&gt;
     *    l$
     *  } or
     *  &lt;rhs&gt; when the lazy value has type Unit (for which there is no field
     *  to cache it's value.
     *
     *  The result will be a tree of the form
     *  {
     *    if ((bitmap$n &amp; MASK) == 0) {
     *       l$ = &lt;rhs&gt;
     *       bitmap$n = bimap$n | MASK
     *    }
     *    l$
     *  }
     *  where bitmap$n is an int value acting as a bitmap of initialized values. It is
     *  the 'n' is (offset / 32), the MASK is (1 &lt;&lt; (offset % 32)). If the value has type
     *  unit, no field is used to cache the value, so the resulting code is:
     *  {
     *    if ((bitmap$n &amp; MASK) == 0) {
     *       &lt;rhs&gt;;
     *       bitmap$n = bimap$n | MASK
     *    }
     *    ()
     *  }
     */
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(methOrClass: LazyVals.this.global.Symbol, tree: LazyVals.this.global.Tree, offset: Int, lazyVal: LazyVals.this.global.Symbol)LazyVals.this.global.Tree" id="603739">mkLazyDef</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="604055">methOrClass</a>: <a href="../../../reflect/internal/Symbols.scala.html#38726" title="LazyVals.this.global.Symbol">Symbol</a>, <a title="LazyVals.this.global.Tree" id="604056">tree</a>: <span title="LazyVals.this.global.Tree">Tree</span>, <a title="Int" id="604057">offset</a>: <span title="Int">Int</span>, <a title="LazyVals.this.global.Symbol" id="604058">lazyVal</a>: <a href="../../../reflect/internal/Symbols.scala.html#38726" title="LazyVals.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="LazyVals.this.global.Tree">Tree</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="LazyVals.this.global.Symbol" id="604738">bitmapSym</a>           = <a href="#603743" title="(meth: LazyVals.this.global.Symbol, offset: Int)LazyVals.this.global.Symbol">getBitmapFor</a><span class="delimiter">(</span><a href="#604055" title="LazyVals.this.global.Symbol">methOrClass</a>, <a href="#604057" title="Int">offset</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="LazyVals.this.global.Literal" id="604739">mask</a>                = <a href="../ast/TreeDSL.scala.html#284810" title="(x: Any)LazyVals.this.global.Literal">LIT</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span> <span title="(x: Int)Int">&lt;&lt;</span> <span class="delimiter">(</span><a href="#604057" title="Int">offset</a> <span title="(x: Int)Int">%</span> <a href="#242814" title="=&gt; Int">FLAGS_PER_WORD</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="LazyVals extends LazyVals.this.global.RefTree with Serializable" id="604740">bitmapRef</a> = <span title="LazyVals extends LazyVals.this.global.RefTree with Serializable" class="keyword">if</span> <span class="delimiter">(</span><a href="#604055" title="LazyVals.this.global.Symbol">methOrClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#46445" title="=&gt; Boolean">isClass</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#187429" title="(qualifier: LazyVals.this.global.Tree, sym: LazyVals.this.global.Symbol)LazyVals.this.global.Select">Select</a><span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#187429" title="(sym: LazyVals.this.global.Symbol)LazyVals.this.global.Tree">This</a><span class="delimiter">(</span><a href="#604055" title="LazyVals.this.global.Symbol">methOrClass</a><span class="delimiter">)</span>, <a href="#604738" title="LazyVals.this.global.Symbol">bitmapSym</a><span class="delimiter">)</span> <span class="keyword">else</span> <a href="../ast/TreeDSL.scala.html#187429" title="(sym: LazyVals.this.global.Symbol)LazyVals.this.global.Ident">Ident</a><span class="delimiter">(</span><a href="#604738" title="LazyVals.this.global.Symbol">bitmapSym</a><span class="delimiter">)</span>

      <span class="keyword">def</span> <a title="(stmt: LazyVals.this.global.Tree)LazyVals.this.global.Block" id="604741">mkBlock</a><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="604820">stmt</a>: <span title="LazyVals.this.global.Tree">Tree</span><span class="delimiter">)</span> = <a href="../ast/TreeDSL.scala.html#244836" title="(xs: LazyVals.this.global.Tree*)LazyVals.this.global.Block">BLOCK</a><span class="delimiter">(</span><a href="#604820" title="LazyVals.this.global.Tree">stmt</a>, <a href="#603740" title="(bmp: LazyVals.this.global.Symbol, mask: LazyVals.this.global.Tree, bmpRef: LazyVals.this.global.Tree)LazyVals.this.global.Tree">mkSetFlag</a><span class="delimiter">(</span><a href="#604738" title="LazyVals.this.global.Symbol">bitmapSym</a>, <a href="#604739" title="LazyVals.this.global.Literal">mask</a>, <a href="#604740" title="LazyVals extends LazyVals.this.global.RefTree with Serializable">bitmapRef</a><span class="delimiter">)</span>, <a href="../ast/TreeDSL.scala.html#244791" title="=&gt; LazyVals.this.global.Literal">UNIT</a><span class="delimiter">)</span>


      <span class="keyword">val</span> <a href="#604743" title="(LazyVals.this.global.Block, LazyVals.this.global.Tree)" class="delimiter">(</a><a href="#604742" title="LazyVals.this.global.Block" id="604743">block</a>, <a href="#604742" title="LazyVals.this.global.Tree" id="604744">res</a><span class="delimiter">)</span> = <a href="#604056" title="LazyVals.this.global.Tree">tree</a> <span title="(LazyVals.this.global.Block, LazyVals.this.global.Tree)" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="(LazyVals.this.global.Block, LazyVals.this.global.Tree)">Block</span><span class="delimiter">(</span><a href="#604831" title="(x: List[LazyVals.this.global.Tree])Some[List[LazyVals.this.global.Tree]]">List</a><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="604842">assignment</a><span class="delimiter">)</span>, <a title="LazyVals.this.global.Tree" id="604843">res</a><span class="delimiter">)</span> <span class="keyword">if</span> <span title="=&gt; Boolean">!</span><a href="#242816" title="(sym: LazyVals.this.global.Symbol)Boolean">lazyUnit</a><span class="delimiter">(</span><a href="#604058" title="LazyVals.this.global.Symbol">lazyVal</a><span class="delimiter">)</span> =&gt;
          <span title="(_1: LazyVals.this.global.Block, _2: LazyVals.this.global.Tree)(LazyVals.this.global.Block, LazyVals.this.global.Tree)" class="delimiter">(</span><a href="#604741" title="(stmt: LazyVals.this.global.Tree)LazyVals.this.global.Block">mkBlock</a><span class="delimiter">(</span><a href="#604842" title="LazyVals.this.global.Tree">assignment</a><span class="delimiter">)</span>,  <a href="#604843" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="(LazyVals.this.global.Block, LazyVals.this.global.Literal)" id="604850">rhs</a>                          =&gt;
          <span title="(_1: LazyVals.this.global.Block, _2: LazyVals.this.global.Literal)(LazyVals.this.global.Block, LazyVals.this.global.Literal)" class="delimiter">(</span><a href="#604741" title="(stmt: LazyVals.this.global.Tree)LazyVals.this.global.Block">mkBlock</a><span class="delimiter">(</span><a href="#604850" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span>,         <a href="../ast/TreeDSL.scala.html#244791" title="=&gt; LazyVals.this.global.Literal">UNIT</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="LazyVals.this.global.Apply" id="604745">cond</a> = <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#244845" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: LazyVals.this.global.Tree)LazyVals.this.CODE.TreeMethods">bitmapRef</a> <a href="../ast/TreeDSL.scala.html#244845" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: LazyVals.this.global.Tree)LazyVals.this.CODE.TreeMethods">INT_&amp;</a> <a href="#604739" title="LazyVals.this.global.Literal">mask</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#284874" title="(other: LazyVals.this.global.Tree)LazyVals.this.global.Apply">INT_==</a> <a href="../ast/TreeDSL.scala.html#244788" title="=&gt; LazyVals.this.global.Literal">ZERO</a>

      <a href="../../../reflect/internal/Trees.scala.html#39387" title="(pos: LazyVals.this.global.Position)(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">atPos</a><span class="delimiter">(</span><a href="#604056" title="LazyVals.this.global.Tree">tree</a>.<span title="=&gt; LazyVals.this.global.Position">pos</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="TypingTransformers.scala.html#597938" title="=&gt; LazyVals.this.global.analyzer.Typer">localTyper</a>.<a href="../typechecker/Typers.scala.html#187859" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a> <span class="delimiter">{</span>
        <span class="keyword">def</span> <a title="=&gt; LazyVals.this.global.gen.global.Tree" id="604894">body</a> = <a href="../Global.scala.html#186149" title="object LazyVals.this.global.gen">gen</a>.<a href="../ast/TreeGen.scala.html#239110" title="(clazz: LazyVals.this.global.gen.global.Symbol, cond: LazyVals.this.global.gen.global.Tree, syncBody: List[LazyVals.this.global.gen.global.Tree], stats: List[LazyVals.this.global.gen.global.Tree])LazyVals.this.global.gen.global.Tree">mkDoubleCheckedLocking</a><span class="delimiter">(</span><a href="#604055" title="LazyVals.this.global.Symbol">methOrClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#46662" title="=&gt; LazyVals.this.global.Symbol">enclClass</a>, <a href="#604745" title="LazyVals.this.global.Apply">cond</a>, <span title="(xs: LazyVals.this.global.Block*)List[LazyVals.this.global.Block]">List</span><span class="delimiter">(</span><a href="#604743" title="LazyVals.this.global.Block">block</a><span class="delimiter">)</span>, <span title="object Nil">Nil</span><span class="delimiter">)</span>
        <a href="../ast/TreeDSL.scala.html#244836" title="(xs: LazyVals.this.global.Tree*)LazyVals.this.global.Block">BLOCK</a><span class="delimiter">(</span><a href="#604894" title="=&gt; LazyVals.this.global.gen.global.Tree">body</a>, <a href="#604744" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(bmp: LazyVals.this.global.Symbol, mask: LazyVals.this.global.Tree, bmpRef: LazyVals.this.global.Tree)LazyVals.this.global.Tree" id="603740">mkSetFlag</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="604822">bmp</a>: <a href="../../../reflect/internal/Symbols.scala.html#38726" title="LazyVals.this.global.Symbol">Symbol</a>, <a title="LazyVals.this.global.Tree" id="604823">mask</a>: <span title="LazyVals.this.global.Tree">Tree</span>, <a title="LazyVals.this.global.Tree" id="604824">bmpRef</a>: <span title="LazyVals.this.global.Tree">Tree</span><span class="delimiter">)</span>: <span title="LazyVals.this.global.Tree">Tree</span> =
      <a href="../ast/TreeDSL.scala.html#244845" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: LazyVals.this.global.Tree)LazyVals.this.CODE.TreeMethods">bmpRef</a> <a href="../ast/TreeDSL.scala.html#284883" title="(rhs: LazyVals.this.global.Tree)LazyVals.this.global.Assign">===</a> <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#244845" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: LazyVals.this.global.Tree)LazyVals.this.CODE.TreeMethods">bmpRef</a> <a href="../ast/TreeDSL.scala.html#284871" title="(other: LazyVals.this.global.Tree)LazyVals.this.global.Apply">INT_|</a> <a href="#604823" title="LazyVals.this.global.Tree">mask</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="bitmaps extends scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]" id="603741">bitmaps</a> = <a href="#603900" title="scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]" class="keyword">new</a> <a title="anonymous class $anon extends scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]" id="603900">mutable</a>.<span title="scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]">HashMap</span><span class="delimiter">[</span>Symbol, List<span class="delimiter">[</span>Symbol<span class="delimiter">]</span><span class="delimiter">]</span> <span class="delimiter">{</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="(meth: LazyVals.this.global.Symbol)scala.collection.immutable.Nil.type" id="603902">default</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="603903">meth</a>: <a href="../../../reflect/internal/Symbols.scala.html#38726" title="LazyVals.this.global.Symbol">Symbol</a><span class="delimiter">)</span> = <span title="object Nil">Nil</span>
    <span class="delimiter">}</span>

    /** Return the symbol corresponding of the right bitmap int inside meth,
     *  given offset.
     */
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(meth: LazyVals.this.global.Symbol, offset: Int)LazyVals.this.global.Symbol" id="603743">getBitmapFor</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="604746">meth</a>: <a href="../../../reflect/internal/Symbols.scala.html#38726" title="LazyVals.this.global.Symbol">Symbol</a>, <a title="Int" id="604747">offset</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="../../../reflect/internal/Symbols.scala.html#38726" title="LazyVals.this.global.Symbol">Symbol</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Int" id="604931">n</a> = <a href="#604747" title="Int">offset</a> <span title="(x: Int)Int">/</span> <a href="#242814" title="=&gt; Int">FLAGS_PER_WORD</a>
      <span class="keyword">val</span> <a title="List[LazyVals.this.global.Symbol]" id="604932">bmps</a> = <a href="#603741" title="(key: LazyVals.this.global.Symbol)List[LazyVals.this.global.Symbol]">bitmaps</a><span class="delimiter">(</span><a href="#604746" title="LazyVals.this.global.Symbol">meth</a><span class="delimiter">)</span>
      <span title="LazyVals.this.global.Symbol" class="keyword">if</span> <span class="delimiter">(</span><a href="#604932" title="List[LazyVals.this.global.Symbol]">bmps</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">&gt;</span> <a href="#604931" title="Int">n</a><span class="delimiter">)</span>
        <a href="#604932" title="(n: Int)LazyVals.this.global.Symbol">bmps</a><span class="delimiter">(</span><a href="#604931" title="Int">n</a><span class="delimiter">)</span>
      <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="LazyVals.this.global.TermSymbol" id="604956">sym</a> = <a href="#604746" title="LazyVals.this.global.Symbol">meth</a>.<a href="../../../reflect/internal/Symbols.scala.html#46384" title="(name: LazyVals.this.global.TermName, pos: LazyVals.this.global.Position, newFlags: Long)LazyVals.this.global.TermSymbol">newVariable</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#39313" title="object LazyVals.this.global.nme">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#58627" title="(bitmapPrefix: LazyVals.this.global.Name, n: Int)bitmapPrefix.ThisNameType">newBitmapName</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#39313" title="object LazyVals.this.global.nme">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#58630" title="=&gt; LazyVals.this.global.nme.NameType">BITMAP_NORMAL</a>, <a href="#604931" title="Int">n</a><span class="delimiter">)</span>, <a href="#604746" title="LazyVals.this.global.Symbol">meth</a>.<a href="../../../reflect/internal/Symbols.scala.html#46379" title="=&gt; LazyVals.this.global.Position">pos</a><span class="delimiter">)</span>.<a href="../../../reflect/internal/Symbols.scala.html#46610" title="(info: LazyVals.this.global.Type)LazyVals.this.global.TermSymbol">setInfo</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#45539" title="=&gt; LazyVals.this.global.Symbol">IntClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#46606" title="=&gt; LazyVals.this.global.Type">tpe</a><span class="delimiter">)</span>
        <a href="../../../reflect/internal/SymbolTable.scala.html#35637" title="(ph: scala.reflect.internal.Phase)(op: =&gt; LazyVals.this.global.TermSymbol)LazyVals.this.global.TermSymbol">atPhase</a><span class="delimiter">(</span><a href="../Global.scala.html#186319" title="=&gt; LazyVals.this.global.Run">currentRun</a>.<a href="../Global.scala.html#188838" title="=&gt; scala.tools.nsc.Phase">typerPhase</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#604956" title="LazyVals.this.global.TermSymbol">sym</a> <a href="../../../reflect/internal/Symbols.scala.html#46646" title="(sym: LazyVals.this.global.Symbol, args: LazyVals.this.global.Tree*)sym.type">addAnnotation</a> <a href="../../../reflect/internal/Definitions.scala.html#45423" title="=&gt; LazyVals.this.global.Symbol">VolatileAttr</a>
        <span class="delimiter">}</span>

        <a href="#603741" title="(key: LazyVals.this.global.Symbol, value: List[LazyVals.this.global.Symbol])Unit">bitmaps</a><span class="delimiter">(</span><a href="#604746" title="LazyVals.this.global.Symbol">meth</a><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="#604956" title="LazyVals.this.global.TermSymbol">sym</a> <a href="#604982" title="(x: LazyVals.this.global.Symbol)List[LazyVals.this.global.Symbol]">::</a> <a href="#604932" title="List[LazyVals.this.global.Symbol]">bmps</a><span class="delimiter">)</span>.<span title="=&gt; List[LazyVals.this.global.Symbol]">reverse</span>
        <a href="#604956" title="LazyVals.this.global.TermSymbol">sym</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
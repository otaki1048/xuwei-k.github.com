<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/typechecker/Macros.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> typechecker

<span class="keyword">import</span> symtab.<a href="../symtab/package.scala.html#34879" title="=&gt; reflect.internal.Flags.type">Flags</a>._
<span class="keyword">import</span> scala.tools.nsc.util._
<span class="keyword">import</span> scala.reflect.ReflectionUtils

<span class="keyword">trait</span> <a title="trait Macros extends Object with ScalaObject" id="31571">Macros</a> <span title="ScalaObject" class="delimiter">{</span> self: Analyzer =&gt;
  <span class="keyword">import</span> <a href="Analyzer.scala.html#187273" title="=&gt; scala.tools.nsc.Global">global</a>._
  <span class="keyword">import</span> <a href="../../../reflect/internal/Definitions.scala.html#39224" title="object Macros.this.global.definitions">definitions</a>._

  <span class="keyword">def</span> <a title="(mac: Macros.this.global.Symbol)Macros.this.global.Symbol" id="187582">macroMeth</a><span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="643071">mac</a>: <a href="../../../reflect/internal/Symbols.scala.html#38726" title="Macros.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <a href="../../../reflect/internal/Symbols.scala.html#38726" title="Macros.this.global.Symbol">Symbol</a> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Macros.this.global.Symbol" id="643073">owner</a> = <a href="#643071" title="Macros.this.global.Symbol">mac</a>.<a href="../../../reflect/internal/Symbols.scala.html#46564" title="=&gt; Macros.this.global.Symbol">owner</a>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#643073" title="Macros.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#46463" title="=&gt; Boolean">isModuleClass</a><span class="delimiter">)</span> <a href="#643073" title="Macros.this.global.Symbol">owner</a> = <a href="#643073" title="Macros.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#46693" title="=&gt; Macros.this.global.Symbol">companionModule</a>.<a href="../../../reflect/internal/Symbols.scala.html#46698" title="=&gt; Macros.this.global.Symbol">moduleClass</a>
    <a href="#643073" title="Macros.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#46608" title="=&gt; Macros.this.global.Type">info</a>.<a href="../../../reflect/internal/Types.scala.html#41537" title="(name: Macros.this.global.Name)Macros.this.global.Symbol">decl</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#39313" title="object Macros.this.global.nme">nme</a>.<a href="../../../reflect/internal/NameManglers.scala.html#59430" title="(name: Macros.this.global.Name)Macros.this.global.TermName">macroMethodName</a><span class="delimiter">(</span><a href="#643071" title="Macros.this.global.Symbol">mac</a>.<a href="../../../reflect/internal/Symbols.scala.html#46571" title="=&gt; Macros.this.global.Name">name</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(tree: Macros.this.global.Tree)List[List[Macros.this.global.Tree]]" id="187583">macroArgs</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="643077">tree</a>: <span title="Macros.this.global.Tree">Tree</span><span class="delimiter">)</span>: <span class="delimiter">(</span><span title="List[List[Macros.this.global.Tree]]">List</span><span class="delimiter">[</span>List<span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#643077" title="Macros.this.global.Tree">tree</a> <span title="List[List[Macros.this.global.Tree]]" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span title="List[List[Macros.this.global.Tree]]">Apply</span><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="643085">fn</a>, <a title="List[Macros.this.global.Tree]" id="643086">args</a><span class="delimiter">)</span> =&gt;
      <a href="#187583" title="(tree: Macros.this.global.Tree)List[List[Macros.this.global.Tree]]">macroArgs</a><span class="delimiter">(</span><a href="#643085" title="Macros.this.global.Tree">fn</a><span class="delimiter">)</span> <span title="(elem: List[Macros.this.global.Tree])(implicit bf: scala.collection.generic.CanBuildFrom[List[List[Macros.this.global.Tree]],List[Macros.this.global.Tree],List[List[Macros.this.global.Tree]]])List[List[Macros.this.global.Tree]]">:+</span> <a href="#643086" title="List[Macros.this.global.Tree]">args</a>
    <span class="keyword">case</span> <span title="List[List[Macros.this.global.Tree]]">TypeApply</span><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="643170">fn</a>, <a title="List[Macros.this.global.Tree]" id="643171">args</a><span class="delimiter">)</span> =&gt;
      <a href="#187583" title="(tree: Macros.this.global.Tree)List[List[Macros.this.global.Tree]]">macroArgs</a><span class="delimiter">(</span><a href="#643170" title="Macros.this.global.Tree">fn</a><span class="delimiter">)</span> <span title="(elem: List[Macros.this.global.Tree])(implicit bf: scala.collection.generic.CanBuildFrom[List[List[Macros.this.global.Tree]],List[Macros.this.global.Tree],List[List[Macros.this.global.Tree]]])List[List[Macros.this.global.Tree]]">:+</span> <a href="#643171" title="List[Macros.this.global.Tree]">args</a>
    <span class="keyword">case</span> <span title="List[List[Macros.this.global.Tree]]">Select</span><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="643226">qual</a>, <a title="Macros.this.global.Name" id="643227">name</a><span class="delimiter">)</span> =&gt;
      <span title="(xs: List[Macros.this.global.Tree]*)List[List[Macros.this.global.Tree]]">List</span><span class="delimiter">(</span><span title="(xs: Macros.this.global.Tree*)List[Macros.this.global.Tree]">List</span><span class="delimiter">(</span><a href="#643226" title="Macros.this.global.Tree">qual</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <span title="List[List[Nothing]]">_</span> =&gt;
      <span title="(xs: List[Nothing]*)List[List[Nothing]]">List</span><span class="delimiter">(</span>List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  /**
   *  The definition of the method implementing a macro. Example:
   *  Say we have in a class C
   *
   *    def macro foo[T](xs: List[T]): T = expr
   *
   *  Then the following macro method is generated for `foo`:
   *
   *    def defmacro$foo
   *           (_context: scala.reflect.macro.Context)
   *           (_this: _context.Tree)
   *           (T: _context.TypeTree)
   *           (xs: _context.Tree): _context.Tree = {
   *      import _context._  // this means that all methods of Context can be used unqualified in macro's body
   *      expr
   *    }
   *
   *  If macro has no type arguments, the third parameter list is omitted (it's not empty, but omitted altogether).
   *
   *  To find out the desugared representation of your particular macro, compile it with -Ymacro-debug.
   */
  <span class="keyword">def</span> <a title="(mdef: Macros.this.global.DefDef)Macros.this.global.Tree" id="187584">macroMethDef</a><span class="delimiter">(</span><a title="Macros.this.global.DefDef" id="643258">mdef</a>: <span title="Macros.this.global.DefDef">DefDef</span><span class="delimiter">)</span>: <span title="Macros.this.global.Tree">Tree</span> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(name: Macros.this.global.Name, tpt: Macros.this.global.Tree)Macros.this.global.ValDef" id="643260">paramDef</a><span class="delimiter">(</span><a title="Macros.this.global.Name" id="643271">name</a>: <a href="../../../reflect/internal/Names.scala.html#38403" title="Macros.this.global.Name">Name</a>, <a title="Macros.this.global.Tree" id="643272">tpt</a>: <span title="Macros.this.global.Tree">Tree</span><span class="delimiter">)</span> = <a href="Analyzer.scala.html#187273" title="(mods: Macros.this.global.Modifiers, name: Macros.this.global.TermName, tpt: Macros.this.global.Tree, rhs: Macros.this.global.Tree)Macros.this.global.ValDef">ValDef</a><span class="delimiter">(</span><a href="../../../reflect/internal/Trees.scala.html#39355" title="(flags: Long)Macros.this.global.Modifiers">Modifiers</a><span class="delimiter">(</span><span title="Long(8192L)">PARAM</span><span class="delimiter">)</span>, <a href="../../../reflect/internal/Names.scala.html#38367" title="implicit scala.reflect.internal.Names.promoteTermNamesAsNecessary : (name: Macros.this.global.Name)Macros.this.global.TermName">name</a>, <a href="#643272" title="Macros.this.global.Tree">tpt</a>, <a href="Analyzer.scala.html#187273" title="object Macros.this.global.EmptyTree">EmptyTree</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Macros.this.global.TypeTree" id="643261">contextType</a> = <a href="Analyzer.scala.html#187273" title="(tp: Macros.this.global.Type)Macros.this.global.TypeTree">TypeTree</a><span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#45177" title="=&gt; Macros.this.global.Symbol">ReflectMacroContext</a>.<a href="../../../reflect/internal/Symbols.scala.html#46606" title="=&gt; Macros.this.global.Type">tpe</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="List[Macros.this.global.ValDef]" id="643262">globParamSec</a> = <span title="(xs: Macros.this.global.ValDef*)List[Macros.this.global.ValDef]">List</span><span class="delimiter">(</span><a href="#643260" title="(name: Macros.this.global.Name, tpt: Macros.this.global.Tree)Macros.this.global.ValDef">paramDef</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#39313" title="object Macros.this.global.nme">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#59198" title="=&gt; Macros.this.global.nme.NameType">macroContext</a>, <a href="#643261" title="Macros.this.global.TypeTree">contextType</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(name: Macros.this.global.Name)Macros.this.global.Select" id="643263">globSelect</a><span class="delimiter">(</span><a title="Macros.this.global.Name" id="643325">name</a>: <a href="../../../reflect/internal/Names.scala.html#38403" title="Macros.this.global.Name">Name</a><span class="delimiter">)</span> = <a href="Analyzer.scala.html#187273" title="(qualifier: Macros.this.global.Tree, name: Macros.this.global.Name)Macros.this.global.Select">Select</a><span class="delimiter">(</span><a href="Analyzer.scala.html#187273" title="(name: Macros.this.global.Name)Macros.this.global.Ident">Ident</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#39313" title="object Macros.this.global.nme">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#59198" title="=&gt; Macros.this.global.nme.NameType">macroContext</a><span class="delimiter">)</span>, <a href="#643325" title="Macros.this.global.Name">name</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="=&gt; Macros.this.global.Select" id="643264">globTree</a> = <a href="#643263" title="(name: Macros.this.global.Name)Macros.this.global.Select">globSelect</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#39303" title="object Macros.this.global.tpnme">tpnme</a>.<a href="../../../reflect/internal/StdNames.scala.html#63667" title="=&gt; Macros.this.global.tpnme.NameType">Tree</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="=&gt; Macros.this.global.Select" id="643265">globTypeTree</a> = <a href="#643263" title="(name: Macros.this.global.Name)Macros.this.global.Select">globSelect</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#39303" title="object Macros.this.global.tpnme">tpnme</a>.<a href="../../../reflect/internal/StdNames.scala.html#63669" title="=&gt; Macros.this.global.tpnme.NameType">TypeTree</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="List[Macros.this.global.ValDef]" id="643266">thisParamSec</a> = <span title="(xs: Macros.this.global.ValDef*)List[Macros.this.global.ValDef]">List</span><span class="delimiter">(</span><a href="#643260" title="(name: Macros.this.global.Name, tpt: Macros.this.global.Tree)Macros.this.global.ValDef">paramDef</a><span class="delimiter">(</span><a href="../../../reflect/internal/Names.scala.html#38394" title="(s: String)Macros.this.global.TermName">newTermName</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#39313" title="object Macros.this.global.nme">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#39298" title="implicit scala.reflect.internal.StdNames.lowerTermNames : (n: Macros.this.global.TermName)String">macroThis</a><span class="delimiter">)</span>, <a href="#643264" title="=&gt; Macros.this.global.Select">globTree</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(tdef: Macros.this.global.TypeDef)Macros.this.global.ValDef" id="643267">tparamInMacro</a><span class="delimiter">(</span><a title="Macros.this.global.TypeDef" id="643374">tdef</a>: <span title="Macros.this.global.TypeDef">TypeDef</span><span class="delimiter">)</span> = <a href="#643260" title="(name: Macros.this.global.Name, tpt: Macros.this.global.Tree)Macros.this.global.ValDef">paramDef</a><span class="delimiter">(</span><a href="#643374" title="Macros.this.global.TypeDef">tdef</a>.<span title="=&gt; Macros.this.global.TypeName">name</span>.<a href="../../../reflect/internal/Names.scala.html#63728" title="=&gt; Macros.this.global.TermName">toTermName</a>, <a href="#643265" title="=&gt; Macros.this.global.Select">globTypeTree</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(vdef: Macros.this.global.ValDef)Macros.this.global.ValDef" id="643268">vparamInMacro</a><span class="delimiter">(</span><a title="Macros.this.global.ValDef" id="643375">vdef</a>: <span title="Macros.this.global.ValDef">ValDef</span><span class="delimiter">)</span>: <span title="Macros.this.global.ValDef">ValDef</span> = <a href="#643260" title="(name: Macros.this.global.Name, tpt: Macros.this.global.Tree)Macros.this.global.ValDef">paramDef</a><span class="delimiter">(</span><a href="#643375" title="Macros.this.global.ValDef">vdef</a>.<span title="=&gt; Macros.this.global.TermName">name</span>, <a href="#643375" title="Macros.this.global.ValDef">vdef</a>.<span title="=&gt; Macros.this.global.Tree">tpt</span> <span title="Macros.this.global.Tree" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Macros.this.global.AppliedTypeTree" id="643376">tpt</a> @ AppliedTypeTree<span class="delimiter">(</span><a title="Macros.this.global.Tree" id="643379">hk</a>, _<span class="delimiter">)</span> <span class="keyword">if</span> <a href="../ast/Trees.scala.html#186424" title="object Macros.this.global.treeInfo">treeInfo</a>.<a href="../../../reflect/internal/TreeInfo.scala.html#120084" title="(tpt: Macros.this.global.treeInfo.global.Tree)Boolean">isRepeatedParamType</a><span class="delimiter">(</span><a href="#643376" title="Macros.this.global.AppliedTypeTree">tpt</a><span class="delimiter">)</span> =&gt; <a href="Analyzer.scala.html#187273" title="(tpt: Macros.this.global.Tree, args: List[Macros.this.global.Tree])Macros.this.global.AppliedTypeTree">AppliedTypeTree</a><span class="delimiter">(</span><a href="#643379" title="Macros.this.global.Tree">hk</a>, <span title="(xs: Macros.this.global.Select*)List[Macros.this.global.Select]">List</span><span class="delimiter">(</span><a href="#643264" title="=&gt; Macros.this.global.Select">globTree</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Macros.this.global.Select">_</span> =&gt; <a href="#643264" title="=&gt; Macros.this.global.Select">globTree</a>
    <span class="delimiter">}</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(tree: Macros.this.global.Tree)Macros.this.global.Block" id="643269">wrapImplicit</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="643392">tree</a>: <span title="Macros.this.global.Tree">Tree</span><span class="delimiter">)</span> = <a href="../../../reflect/internal/Trees.scala.html#39387" title="(pos: Macros.this.global.Position)(tree: Macros.this.global.Block)Macros.this.global.Block">atPos</a><span class="delimiter">(</span><a href="#643392" title="Macros.this.global.Tree">tree</a>.<span title="=&gt; Macros.this.global.Position">pos</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      // implicit hasn't proven useful so far, so I'm disabling it
      //val implicitDecl = ValDef(Modifiers(IMPLICIT), nme.macroContextImplicit, SingletonTypeTree(Ident(nme.macroContext)), Ident(nme.macroContext))
      <span class="keyword">val</span> <a title="Macros.this.global.Import" id="643400">importGlob</a> = <a href="Analyzer.scala.html#187273" title="(expr: Macros.this.global.Tree, selectors: List[Macros.this.global.ImportSelector])Macros.this.global.Import">Import</a><span class="delimiter">(</span><a href="Analyzer.scala.html#187273" title="(name: Macros.this.global.Name)Macros.this.global.Ident">Ident</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#39313" title="object Macros.this.global.nme">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#59198" title="=&gt; Macros.this.global.nme.NameType">macroContext</a><span class="delimiter">)</span>, <span title="(xs: Macros.this.global.ImportSelector*)List[Macros.this.global.ImportSelector]">List</span><span class="delimiter">(</span><a href="Analyzer.scala.html#187273" title="(name: Macros.this.global.Name, namePos: Int, rename: Macros.this.global.Name, renamePos: Int)Macros.this.global.ImportSelector">ImportSelector</a><span class="delimiter">(</span><a href="../../../reflect/internal/StdNames.scala.html#39313" title="object Macros.this.global.nme">nme</a>.<a href="../../../reflect/internal/StdNames.scala.html#59373" title="=&gt; Macros.this.global.nme.NameType">WILDCARD</a>, -<span title="Int(-1)" class="int">1</span>, <span title="Null(null)" class="keyword">null</span>, -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="Analyzer.scala.html#187273" title="(stats: List[Macros.this.global.Tree], expr: Macros.this.global.Tree)Macros.this.global.Block">Block</a><span class="delimiter">(</span><span title="(xs: Macros.this.global.Import*)List[Macros.this.global.Import]">List</span><span class="delimiter">(</span><a href="#643400" title="Macros.this.global.Import">importGlob</a><span class="delimiter">)</span>, <a href="#643392" title="Macros.this.global.Tree">tree</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">var</span> <a title="List[List[Macros.this.global.ValDef]]" id="643270">formals</a> = <span class="delimiter">(</span><a href="#643258" title="Macros.this.global.DefDef">mdef</a>.<span title="=&gt; List[List[Macros.this.global.ValDef]]">vparamss</span> <span title="(f: List[Macros.this.global.ValDef] =&gt; List[Macros.this.global.ValDef])(implicit bf: scala.collection.generic.CanBuildFrom[List[List[Macros.this.global.ValDef]],List[Macros.this.global.ValDef],List[List[Macros.this.global.ValDef]]])List[List[Macros.this.global.ValDef]]">map</span> <span class="delimiter">(</span><a href="#643476" title="List[Macros.this.global.ValDef]">_</a> <span title="(f: Macros.this.global.ValDef =&gt; Macros.this.global.ValDef)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.ValDef],Macros.this.global.ValDef,List[Macros.this.global.ValDef]])List[Macros.this.global.ValDef]">map</span> <a href="#643268" title="(vdef: Macros.this.global.ValDef)Macros.this.global.ValDef">vparamInMacro</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#643258" title="Macros.this.global.DefDef">mdef</a>.<span title="=&gt; List[Macros.this.global.TypeDef]">tparams</span>.<span title="=&gt; Boolean">nonEmpty</span><span class="delimiter">)</span> <a href="#643270" title="List[List[Macros.this.global.ValDef]]">formals</a> = <span class="delimiter">(</span><a href="#643258" title="Macros.this.global.DefDef">mdef</a>.<span title="=&gt; List[Macros.this.global.TypeDef]">tparams</span> <span title="(f: Macros.this.global.TypeDef =&gt; Macros.this.global.ValDef)(implicit bf: scala.collection.generic.CanBuildFrom[List[Macros.this.global.TypeDef],Macros.this.global.ValDef,List[Macros.this.global.ValDef]])List[Macros.this.global.ValDef]">map</span> <a href="#643267" title="(tdef: Macros.this.global.TypeDef)Macros.this.global.ValDef">tparamInMacro</a><span class="delimiter">)</span> <a href="#643548" title="(x: List[Macros.this.global.ValDef])List[List[Macros.this.global.ValDef]]">::</a> <a href="#643270" title="List[List[Macros.this.global.ValDef]]">formals</a>

    <a href="../../../reflect/internal/Trees.scala.html#39387" title="(pos: Macros.this.global.Position)(tree: Macros.this.global.DefDef)Macros.this.global.DefDef">atPos</a><span class="delimiter">(</span><a href="#643258" title="Macros.this.global.DefDef">mdef</a>.<span title="=&gt; Macros.this.global.Position">pos</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Macros.this.global.DefDef" class="keyword">new</span> <a href="Analyzer.scala.html#187273" title="Macros.this.global.DefDef">DefDef</a><span class="delimiter">(</span> // can't call DefDef here; need to find out why
        mods = <a href="#643258" title="Macros.this.global.DefDef">mdef</a>.<span title="=&gt; Macros.this.global.Modifiers">mods</span> <a href="../../../reflect/internal/Trees.scala.html#85209" title="(flag: Long)Macros.this.global.Modifiers">&amp;~</a> <span title="Long(32768L)">MACRO</span> <a href="../../../reflect/internal/Trees.scala.html#85209" title="(flag: Long)Macros.this.global.Modifiers">&amp;~</a> <span title="Long(2L)">OVERRIDE</span>,
        name = <a href="../../../reflect/internal/StdNames.scala.html#39313" title="object Macros.this.global.nme">nme</a>.<a href="../../../reflect/internal/NameManglers.scala.html#59430" title="(name: Macros.this.global.Name)Macros.this.global.TermName">macroMethodName</a><span class="delimiter">(</span><a href="#643258" title="Macros.this.global.DefDef">mdef</a>.<span title="=&gt; Macros.this.global.Name">name</span><span class="delimiter">)</span>,
        tparams = List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span>,
        vparamss = <a href="#643262" title="List[Macros.this.global.ValDef]">globParamSec</a> <a href="#643617" title="(x: List[Macros.this.global.ValDef])List[List[Macros.this.global.ValDef]]">::</a> <a href="#643266" title="List[Macros.this.global.ValDef]">thisParamSec</a> <a href="#643618" title="(x: List[Macros.this.global.ValDef])List[List[Macros.this.global.ValDef]]">::</a> <a href="#643270" title="List[List[Macros.this.global.ValDef]]">formals</a>,
        tpt = <a href="#643264" title="=&gt; Macros.this.global.Select">globTree</a>,
        <a href="#643269" title="(tree: Macros.this.global.Tree)Macros.this.global.Block">wrapImplicit</a><span class="delimiter">(</span><a href="#643258" title="Macros.this.global.DefDef">mdef</a>.<span title="=&gt; Macros.this.global.Tree">rhs</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(templ: Macros.this.global.Template, namer: Macros.this.Namer)Unit" id="187585">addMacroMethods</a><span class="delimiter">(</span><a title="Macros.this.global.Template" id="643627">templ</a>: <span title="Macros.this.global.Template">Template</span>, <a title="Macros.this.Namer" id="643628">namer</a>: <a href="Namers.scala.html#187335" title="Macros.this.Namer">Namer</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">for</span> <span class="delimiter">(</span><a title="Macros.this.global.DefDef" id="643681">ddef</a> @ DefDef<span class="delimiter">(</span><a title="Macros.this.global.Modifiers" id="643690">mods</a>, _, _, _, _, _<span class="delimiter">)</span> &lt;- <a href="#643627" title="Macros.this.global.Template">templ</a>.<a href="#643633" title="(f: Macros.this.global.Tree =&gt; Macros.this.global.Symbol)Unit">body</a> <span class="keyword">if</span> <a href="#643690" title="Macros.this.global.Modifiers">mods</a> <a href="../../../reflect/internal/Trees.scala.html#85205" title="(flag: Long)Boolean">hasFlag</a> <span title="Long(32768L)">MACRO</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="scala.tools.nsc.util.SimpleTracer" id="643691">trace</a> = scala.tools.nsc.util.<a href="../util/package.scala.html#34914" title="=&gt; scala.tools.nsc.util.SimpleTracer">trace</a> <a href="../util/SimpleTracer.scala.html#186538" title="(enabled: Boolean)scala.tools.nsc.util.SimpleTracer">when</a> <a href="../Global.scala.html#186138" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#186844" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">Ymacrodebug</a>.<a href="../settings/MutableSettings.scala.html#187054" title="=&gt; Boolean">value</a>
      <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="643692">sym</a> = <a href="#643628" title="Macros.this.Namer">namer</a>.<a href="Namers.scala.html#625646" title="(tree: Macros.this.global.Tree)Macros.this.global.Symbol">enterSyntheticSym</a><span class="delimiter">(</span><a href="../util/SimpleTracer.scala.html#186534" title="(msg: String)(value: Macros.this.global.Tree)Macros.this.global.Tree">trace</a><span class="delimiter">(</span><span title="String(&quot;macro def: &quot;)" class="string">&quot;macro def: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#187584" title="(mdef: Macros.this.global.DefDef)Macros.this.global.Tree">macroMethDef</a><span class="delimiter">(</span><a href="#643681" title="Macros.this.global.DefDef">ddef</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="../util/SimpleTracer.scala.html#186534" title="(msg: String)(value: Macros.this.global.Symbol)Macros.this.global.Symbol">trace</a><span class="delimiter">(</span><span title="String(&quot;added to &quot;)" class="string">&quot;added to &quot;</span><span title="(x$1: Any)String">+</span><a href="#643628" title="Macros.this.Namer">namer</a>.<a href="Namers.scala.html#625582" title="=&gt; Macros.this.Context">context</a>.<a href="Contexts.scala.html#188108" title="=&gt; Macros.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#46662" title="=&gt; Macros.this.global.Symbol">enclClass</a><span title="(x$1: Any)String">+</span><span title="String(&quot;: &quot;)" class="string">&quot;: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#643692" title="Macros.this.global.Symbol">sym</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="mirror extends scala.reflect.runtime.Mirror" id="187587">mirror</a> = <a href="#643712" title="scala.reflect.runtime.Mirror{lazy val libraryClassLoader: ClassLoader}" class="keyword">new</a> <a title="anonymous class $anon extends scala.reflect.runtime.Mirror" id="643712">scala</a>.reflect.runtime.<a href="../../../reflect/runtime/Mirror.scala.html#10954" title="scala.reflect.runtime.Mirror">Mirror</a> <span class="delimiter">{</span>
    <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="ClassLoader" id="643715">libraryClassLoader</a> = <span class="delimiter">{</span>
      // todo. this is more or less okay, but not completely correct
      // see https://issues.scala-lang.org/browse/SI-5433 for more info
      <span class="keyword">val</span> <a title="List[java.net.URL]" id="643717">classpath</a> = <a href="Analyzer.scala.html#187273" title="=&gt; scala.tools.nsc.Global">global</a>.<a href="../Global.scala.html#186147" title="=&gt; scala.tools.nsc.util.ClassPath[Macros.this.global.platform.BinaryRepr]">classPath</a>.<a href="../util/ClassPath.scala.html#238162" title="=&gt; List[java.net.URL]">asURLs</a>
      <span class="keyword">var</span> <a title="ClassLoader" id="643718">loader</a>: <span title="ClassLoader">ClassLoader</span> = <a href="../util/ScalaClassLoader.scala.html#33743" title="object scala.tools.nsc.util.ScalaClassLoader">ScalaClassLoader</a>.<a href="../util/ScalaClassLoader.scala.html#167625" title="(urls: Seq[java.net.URL], parent: ClassLoader)scala.tools.nsc.util.ScalaClassLoader.URLClassLoader">fromURLs</a><span class="delimiter">(</span><a href="#643717" title="List[java.net.URL]">classpath</a>, <a href="#31571" title="Macros.this.type">self</a>.<span title="()Class[_]">getClass</span>.<span title="()ClassLoader">getClassLoader</span><span class="delimiter">)</span>

      // an heuristic to detect REPL
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="Analyzer.scala.html#187273" title="=&gt; scala.tools.nsc.Global">global</a>.<a href="../Global.scala.html#186138" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#186868" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">exposeEmptyPackage</a>.<a href="../settings/MutableSettings.scala.html#187054" title="=&gt; Boolean">value</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">import</span> scala.tools.nsc.interpreter._
        <span class="keyword">val</span> <a title="scala.tools.nsc.io.AbstractFile" id="643728">virtualDirectory</a> = <a href="Analyzer.scala.html#187273" title="=&gt; scala.tools.nsc.Global">global</a>.<a href="../Global.scala.html#186138" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/MutableSettings.scala.html#186560" title="=&gt; scala.tools.nsc.Settings#OutputDirs">outputDirs</a>.<a href="../settings/MutableSettings.scala.html#192140" title="=&gt; Option[scala.tools.nsc.io.AbstractFile]">getSingleOutput</a>.<span title="=&gt; scala.tools.nsc.io.AbstractFile">get</span>
        <a href="#643718" title="ClassLoader">loader</a> = <a href="#643729" title="scala.tools.nsc.interpreter.AbstractFileClassLoader" class="keyword">new</a> <a href="../interpreter/AbstractFileClassLoader.scala.html#22406" title="anonymous class $anon extends scala.tools.nsc.interpreter.AbstractFileClassLoader" id="643729">AbstractFileClassLoader</a><span class="delimiter">(</span><a href="#643728" title="scala.tools.nsc.io.AbstractFile">virtualDirectory</a>, <a href="#643718" title="ClassLoader">loader</a><span class="delimiter">)</span> <span class="delimiter">{</span><span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <a href="#643718" title="ClassLoader">loader</a>
    <span class="delimiter">}</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()ClassLoader" id="643716">defaultReflectiveClassLoader</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="#643714" title="=&gt; ClassLoader">libraryClassLoader</a>
  <span class="delimiter">}</span>

  /** Return optionally address of companion object and implementation method symbol
   *  of given macro; or None if implementation classfile cannot be loaded or does
   *  not contain the macro implementation.
   */
  <span class="keyword">def</span> <a title="(mac: Macros.this.global.Symbol)Option[(AnyRef, Macros.this.mirror.Symbol)]" id="187588">macroImpl</a><span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="643747">mac</a>: <a href="../../../reflect/internal/Symbols.scala.html#38726" title="Macros.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="Option[(AnyRef, Macros.this.mirror.Symbol)]">Option</span><span class="delimiter">[</span><span class="delimiter">(</span>AnyRef, mirror.Symbol<span class="delimiter">)</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Boolean" id="643749">debug</a> = <a href="../Global.scala.html#186138" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#186844" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">Ymacrodebug</a>.<a href="../settings/MutableSettings.scala.html#187054" title="=&gt; Boolean">value</a>
    <span class="keyword">val</span> <a title="scala.tools.nsc.util.SimpleTracer" id="643750">trace</a> = scala.tools.nsc.util.<a href="../util/package.scala.html#34914" title="=&gt; scala.tools.nsc.util.SimpleTracer">trace</a> <a href="../util/SimpleTracer.scala.html#186538" title="(enabled: Boolean)scala.tools.nsc.util.SimpleTracer">when</a> <a href="#643749" title="Boolean">debug</a>
    <a href="../util/SimpleTracer.scala.html#186534" title="(msg: String)(value: String)String">trace</a><span class="delimiter">(</span><span title="String(&quot;looking for macro implementation: &quot;)" class="string">&quot;looking for macro implementation: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#643747" title="Macros.this.global.Symbol">mac</a>.<a href="../../../reflect/internal/Symbols.scala.html#46740" title="=&gt; String">fullNameString</a><span class="delimiter">)</span>

    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="643758">mmeth</a> = <a href="#187582" title="(mac: Macros.this.global.Symbol)Macros.this.global.Symbol">macroMeth</a><span class="delimiter">(</span><a href="#643747" title="Macros.this.global.Symbol">mac</a><span class="delimiter">)</span>
      <a href="../util/SimpleTracer.scala.html#186534" title="(msg: String)(value: String)String">trace</a><span class="delimiter">(</span><span title="String(&quot;found implementation at: &quot;)" class="string">&quot;found implementation at: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#643758" title="Macros.this.global.Symbol">mmeth</a>.<a href="../../../reflect/internal/Symbols.scala.html#46740" title="=&gt; String">fullNameString</a><span class="delimiter">)</span>

      <span title="Option[(AnyRef, Macros.this.mirror.Symbol)]" class="keyword">if</span> <span class="delimiter">(</span><a href="#643758" title="Macros.this.global.Symbol">mmeth</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Symbols.scala.html#38740" title="=&gt; Macros.this.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <span title="object None">None</span>
      <span class="keyword">else</span> <span class="delimiter">{</span>
        <a href="../util/SimpleTracer.scala.html#186534" title="(msg: String)(value: String)String">trace</a><span class="delimiter">(</span><span title="String(&quot;loading implementation class: &quot;)" class="string">&quot;loading implementation class: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#643758" title="Macros.this.global.Symbol">mmeth</a>.<a href="../../../reflect/internal/Symbols.scala.html#46564" title="=&gt; Macros.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#46585" title="=&gt; String">fullName</a><span class="delimiter">)</span>
        <a href="../util/SimpleTracer.scala.html#186534" title="(msg: String)(value: String)String">trace</a><span class="delimiter">(</span><span title="String(&quot;classloader is: &quot;)" class="string">&quot;classloader is: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;%s of type %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#187586" title="=&gt; scala.reflect.runtime.Mirror{lazy val libraryClassLoader: ClassLoader}">mirror</a>.<a href="#643746" title="=&gt; ClassLoader">libraryClassLoader</a>, <a href="#187586" title="=&gt; scala.reflect.runtime.Mirror{lazy val libraryClassLoader: ClassLoader}">mirror</a>.<a href="#643746" title="=&gt; ClassLoader">libraryClassLoader</a>.<span title="()Class[_]">getClass</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">def</span> <a title="(cl: ClassLoader)String" id="643769">inferClasspath</a><span class="delimiter">(</span><a title="ClassLoader" id="643794">cl</a>: <span title="ClassLoader">ClassLoader</span><span class="delimiter">)</span> = <a href="#643794" title="ClassLoader">cl</a> <span title="String" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a title="String" id="643795">cl</a>: java.net.<span title="java.net.URLClassLoader">URLClassLoader</span> =&gt; <span title="String(&quot;[&quot;)" class="string">&quot;[&quot;</span> <span title="(x$1: Any)String">+</span> <span class="delimiter">(</span><a href="#643795" title="java.net.URLClassLoader">cl</a>.<span title="(xs: Array[java.net.URL])scala.collection.mutable.ArrayOps[java.net.URL]">getURLs</span> <span title="(sep: String)String">mkString</span> <span title="String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot;]&quot;)" class="string">&quot;]&quot;</span>
          <span class="keyword">case</span> <span title="String(&quot;&lt;unknown&gt;&quot;)">_</span> =&gt; <span title="String(&quot;&lt;unknown&gt;&quot;)" class="string">&quot;&lt;unknown&gt;&quot;</span>
        <span class="delimiter">}</span>
        <a href="../util/SimpleTracer.scala.html#186534" title="(msg: String)(value: String)String">trace</a><span class="delimiter">(</span><span title="String(&quot;classpath is: &quot;)" class="string">&quot;classpath is: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#643769" title="(cl: ClassLoader)String">inferClasspath</a><span class="delimiter">(</span><a href="#187586" title="=&gt; scala.reflect.runtime.Mirror{lazy val libraryClassLoader: ClassLoader}">mirror</a>.<a href="#643746" title="=&gt; ClassLoader">libraryClassLoader</a><span class="delimiter">)</span><span class="delimiter">)</span>

        // @xeno.by: relies on the fact that macros can only be defined in static classes
        <span class="keyword">def</span> <a title="(sym: Macros.this.global.Symbol)String" id="643770">classfile</a><span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="643922">sym</a>: <a href="../../../reflect/internal/Symbols.scala.html#38726" title="Macros.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
          <span class="keyword">def</span> <a title="(sym: Macros.this.global.Symbol)String" id="643923">recur</a><span class="delimiter">(</span><a title="Macros.this.global.Symbol" id="643924">sym</a>: <a href="../../../reflect/internal/Symbols.scala.html#38726" title="Macros.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="String">String</span> = <a href="#643924" title="Macros.this.global.Symbol">sym</a> <span title="String" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a title="String" id="643925">sym</a> <span class="keyword">if</span> <a href="#643925" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#46564" title="=&gt; Macros.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#46475" title="=&gt; Boolean">isPackageClass</a> =&gt;
              <span class="keyword">val</span> <a title="String" id="643926">suffix</a> = <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#643925" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#46463" title="=&gt; Boolean">isModuleClass</a><span class="delimiter">)</span> <span title="String(&quot;$&quot;)" class="string">&quot;$&quot;</span> <span class="keyword">else</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span>
              <a href="#643925" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#46585" title="=&gt; String">fullName</a> <span title="(x$1: Any)String">+</span> <a href="#643926" title="String">suffix</a>
            <span class="keyword">case</span> <a title="String" id="643929">sym</a> =&gt;
              <span class="keyword">val</span> <a title="String" id="643930">separator</a> = <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#643929" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#46564" title="=&gt; Macros.this.global.Symbol">owner</a>.<a href="../../../reflect/internal/Symbols.scala.html#46463" title="=&gt; Boolean">isModuleClass</a><span class="delimiter">)</span> <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span> <span class="keyword">else</span> <span title="String(&quot;$&quot;)" class="string">&quot;$&quot;</span>
              <a href="#643923" title="(sym: Macros.this.global.Symbol)String">recur</a><span class="delimiter">(</span><a href="#643929" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#46564" title="=&gt; Macros.this.global.Symbol">owner</a><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <a href="#643930" title="String">separator</a> <span title="(x$1: Any)String">+</span> <a href="#643929" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#46579" title="=&gt; String">javaSimpleName</a>
          <span class="delimiter">}</span>

          <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#643922" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#46445" title="=&gt; Boolean">isClass</a> <span title="(x: Boolean)Boolean">||</span> <a href="#643922" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#46462" title="=&gt; Boolean">isModule</a><span class="delimiter">)</span> <a href="#643923" title="(sym: Macros.this.global.Symbol)String">recur</a><span class="delimiter">(</span><a href="#643922" title="Macros.this.global.Symbol">sym</a><span class="delimiter">)</span>
          <span class="keyword">else</span> <a href="#643923" title="(sym: Macros.this.global.Symbol)String">recur</a><span class="delimiter">(</span><a href="#643922" title="Macros.this.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#46662" title="=&gt; Macros.this.global.Symbol">enclClass</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        // @xeno.by: this doesn't work for inner classes
        // neither does mmeth.owner.javaClassName, so I had to roll my own implementation
        //val receiverName = mmeth.owner.fullName
        <span class="keyword">val</span> <a title="String" id="643771">receiverName</a> = <a href="#643770" title="(sym: Macros.this.global.Symbol)String">classfile</a><span class="delimiter">(</span><a href="#643758" title="Macros.this.global.Symbol">mmeth</a>.<a href="../../../reflect/internal/Symbols.scala.html#46564" title="=&gt; Macros.this.global.Symbol">owner</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Macros.this.mirror.Symbol" id="643772">receiverClass</a>: mirror.<a href="../../../reflect/internal/Symbols.scala.html#38726" title="Macros.this.mirror.Symbol">Symbol</a> = <a href="#187586" title="=&gt; scala.reflect.runtime.Mirror{lazy val libraryClassLoader: ClassLoader}">mirror</a>.<a href="../../../reflect/runtime/Mirror.scala.html#182857" title="(name: String)Macros.this.mirror.Symbol">symbolForName</a><span class="delimiter">(</span><a href="#643771" title="String">receiverName</a><span class="delimiter">)</span>

        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#643749" title="Boolean">debug</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;receiverClass is: &quot;)" class="string">&quot;receiverClass is: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#643772" title="Macros.this.mirror.Symbol">receiverClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#46740" title="=&gt; String">fullNameString</a><span class="delimiter">)</span>

          <span class="keyword">val</span> <a title="Class[_]" id="643931">jreceiverClass</a> = <a href="#187586" title="=&gt; scala.reflect.runtime.Mirror{lazy val libraryClassLoader: ClassLoader}">mirror</a>.<a href="../../../reflect/runtime/ScalaToJava.scala.html#166310" title="(clazz: Macros.this.mirror.Symbol)Class[_]">classToJava</a><span class="delimiter">(</span><a href="#643772" title="Macros.this.mirror.Symbol">receiverClass</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="java.security.CodeSource" id="643932">jreceiverSource</a> = <a href="#643931" title="Class[_]">jreceiverClass</a>.<span title="()java.security.ProtectionDomain">getProtectionDomain</span>.<span title="()java.security.CodeSource">getCodeSource</span>
          <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;jreceiverClass is %s from %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#643931" title="Class[_]">jreceiverClass</a>, <a href="#643932" title="java.security.CodeSource">jreceiverSource</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;jreceiverClassLoader is %s with classpath %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#643931" title="Class[_]">jreceiverClass</a>.<span title="()ClassLoader">getClassLoader</span>, <a href="#643769" title="(cl: ClassLoader)String">inferClasspath</a><span class="delimiter">(</span><a href="#643931" title="Class[_]">jreceiverClass</a>.<span title="()ClassLoader">getClassLoader</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span class="keyword">val</span> <a title="Macros.this.mirror.Symbol" id="643773">receiverObj</a> = <a href="#643772" title="Macros.this.mirror.Symbol">receiverClass</a>.<a href="../../../reflect/internal/Symbols.scala.html#46693" title="=&gt; Macros.this.mirror.Symbol">companionModule</a>
        <a href="../util/SimpleTracer.scala.html#186534" title="(msg: String)(value: String)String">trace</a><span class="delimiter">(</span><span title="String(&quot;receiverObj is: &quot;)" class="string">&quot;receiverObj is: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#643773" title="Macros.this.mirror.Symbol">receiverObj</a>.<a href="../../../reflect/internal/Symbols.scala.html#46740" title="=&gt; String">fullNameString</a><span class="delimiter">)</span>

        <span title="Option[(AnyRef, Macros.this.mirror.Symbol)]" class="keyword">if</span> <span class="delimiter">(</span><a href="#643773" title="Macros.this.mirror.Symbol">receiverObj</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#187586" title="=&gt; scala.reflect.runtime.Mirror{lazy val libraryClassLoader: ClassLoader}">mirror</a>.<a href="../../../reflect/internal/Symbols.scala.html#38740" title="=&gt; Macros.this.mirror.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <span title="object None">None</span>
        <span class="keyword">else</span> <span class="delimiter">{</span>
          // @xeno.by: yet another reflection method that doesn't work for inner classes
          //val receiver = mirror.companionInstance(receiverClass)
          <span class="keyword">val</span> <a title="Class[_]" id="643959">clazz</a> = java.lang.<span title="object Class">Class</span>.<span title="(x$1: String, x$2: Boolean, x$3: ClassLoader)Class[_]">forName</span><span class="delimiter">(</span><a href="#643771" title="String">receiverName</a>, <span title="Boolean(true)" class="keyword">true</span>, <a href="#187586" title="=&gt; scala.reflect.runtime.Mirror{lazy val libraryClassLoader: ClassLoader}">mirror</a>.<a href="#643746" title="=&gt; ClassLoader">libraryClassLoader</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Object" id="643960">receiver</a> = <a href="#643959" title="Class[_]">clazz</a> <span title="(x$1: String)java.lang.reflect.Field">getField</span> <span title="String(&quot;MODULE$&quot;)" class="string">&quot;MODULE$&quot;</span> <span title="(x$1: Any)Object">get</span> <span title="Null(null)" class="keyword">null</span>

          <span class="keyword">val</span> <a title="Macros.this.mirror.Symbol" id="643961">rmeth</a> = <a href="#643773" title="Macros.this.mirror.Symbol">receiverObj</a>.<a href="../../../reflect/internal/Symbols.scala.html#46608" title="=&gt; Macros.this.mirror.Type">info</a>.<a href="../../../reflect/internal/Types.scala.html#41545" title="(name: Macros.this.mirror.Name)Macros.this.mirror.Symbol">member</a><span class="delimiter">(</span><a href="#187586" title="=&gt; scala.reflect.runtime.Mirror{lazy val libraryClassLoader: ClassLoader}">mirror</a>.<a href="../../../reflect/runtime/SynchronizedOps.scala.html#166334" title="(s: String)Macros.this.mirror.TermName">newTermName</a><span class="delimiter">(</span><a href="#643758" title="Macros.this.global.Symbol">mmeth</a>.<a href="../../../reflect/internal/Symbols.scala.html#46571" title="=&gt; Macros.this.global.Name">name</a>.<span title="()String">toString</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#643749" title="Boolean">debug</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;rmeth is: &quot;)" class="string">&quot;rmeth is: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#643961" title="Macros.this.mirror.Symbol">rmeth</a>.<a href="../../../reflect/internal/Symbols.scala.html#46740" title="=&gt; String">fullNameString</a><span class="delimiter">)</span>
            <span title="(x: Any)Unit">println</span><span class="delimiter">(</span><span title="String(&quot;jrmeth is: &quot;)" class="string">&quot;jrmeth is: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#187586" title="=&gt; scala.reflect.runtime.Mirror{lazy val libraryClassLoader: ClassLoader}">mirror</a>.<a href="../../../reflect/runtime/ScalaToJava.scala.html#166313" title="(meth: Macros.this.mirror.Symbol)java.lang.reflect.Method">methodToJava</a><span class="delimiter">(</span><a href="#643961" title="Macros.this.mirror.Symbol">rmeth</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>

          <span title="Option[(AnyRef, Macros.this.mirror.Symbol)]" class="keyword">if</span> <span class="delimiter">(</span><a href="#643961" title="Macros.this.mirror.Symbol">rmeth</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#187586" title="=&gt; scala.reflect.runtime.Mirror{lazy val libraryClassLoader: ClassLoader}">mirror</a>.<a href="../../../reflect/internal/Symbols.scala.html#38740" title="=&gt; Macros.this.mirror.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <span title="object None">None</span>
          <span class="keyword">else</span> <span class="delimiter">{</span>
            <span title="(x: (Object, Macros.this.mirror.Symbol))Some[(Object, Macros.this.mirror.Symbol)]">Some</span><span class="delimiter">(</span><span title="(_1: Object, _2: Macros.this.mirror.Symbol)(Object, Macros.this.mirror.Symbol)" class="delimiter">(</span><a href="#643960" title="Object">receiver</a>, <a href="#643961" title="Macros.this.mirror.Symbol">rmeth</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="None.type" id="643993">ex</a>: <span title="ClassNotFoundException">ClassNotFoundException</span> =&gt;
        <a href="../util/SimpleTracer.scala.html#186534" title="(msg: String)(value: String)String">trace</a><span class="delimiter">(</span><span title="String(&quot;implementation class failed to load: &quot;)" class="string">&quot;implementation class failed to load: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#643993" title="ClassNotFoundException">ex</a>.<span title="()String">toString</span><span class="delimiter">)</span>
        <span title="object None">None</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** Return result of macro expansion.
   *  Or, if that fails, and the macro overrides a method return
   *  tree that calls this method instead of the macro.
   */
  <span class="keyword">def</span> <a title="(tree: Macros.this.global.Tree, typer: Macros.this.Typer)Option[Any]" id="187589">macroExpand</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="644000">tree</a>: <span title="Macros.this.global.Tree">Tree</span>, <a title="Macros.this.Typer" id="644001">typer</a>: <a href="Typers.scala.html#187422" title="Macros.this.Typer">Typer</a><span class="delimiter">)</span>: <span title="Option[Any]">Option</span><span class="delimiter">[</span>Any<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="scala.tools.nsc.util.SimpleTracer" id="644003">trace</a> = scala.tools.nsc.util.<a href="../util/package.scala.html#34914" title="=&gt; scala.tools.nsc.util.SimpleTracer">trace</a> <a href="../util/SimpleTracer.scala.html#186538" title="(enabled: Boolean)scala.tools.nsc.util.SimpleTracer">when</a> <a href="../Global.scala.html#186138" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#186844" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">Ymacrodebug</a>.<a href="../settings/MutableSettings.scala.html#187054" title="=&gt; Boolean">value</a>
    <a href="../util/SimpleTracer.scala.html#186534" title="(msg: String)(value: Macros.this.global.Tree)Macros.this.global.Tree">trace</a><span class="delimiter">(</span><span title="String(&quot;macroExpand: &quot;)" class="string">&quot;macroExpand: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#644000" title="Macros.this.global.Tree">tree</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="Macros.this.global.Symbol" id="644004">macroDef</a> = <a href="#644000" title="Macros.this.global.Tree">tree</a>.<span title="=&gt; Macros.this.global.Symbol">symbol</span>
    <a href="#187588" title="(mac: Macros.this.global.Symbol)Option[(AnyRef, Macros.this.mirror.Symbol)]">macroImpl</a><span class="delimiter">(</span><a href="#644004" title="Macros.this.global.Symbol">macroDef</a><span class="delimiter">)</span> <span title="Option[Any]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Option[Any]">Some</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="AnyRef" id="644015">receiver</a>, <a title="Macros.this.mirror.Symbol" id="644016">rmeth</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
        <span class="keyword">val</span> <a title="List[List[ScalaObject]]" id="644017">argss</a> = <span title="(xs: scala.tools.nsc.Global*)List[scala.tools.nsc.Global]">List</span><span class="delimiter">(</span><a href="Analyzer.scala.html#187273" title="=&gt; scala.tools.nsc.Global">global</a><span class="delimiter">)</span> <a href="#644022" title="(x: List[ScalaObject])List[List[ScalaObject]]">::</a> <a href="#187583" title="(tree: Macros.this.global.Tree)List[List[Macros.this.global.Tree]]">macroArgs</a><span class="delimiter">(</span><a href="#644000" title="Macros.this.global.Tree">tree</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="List[List[Macros.this.global.Symbol]]" id="644018">paramss</a> = <a href="#187582" title="(mac: Macros.this.global.Symbol)Macros.this.global.Symbol">macroMeth</a><span class="delimiter">(</span><a href="#644004" title="Macros.this.global.Symbol">macroDef</a><span class="delimiter">)</span>.<a href="../../../reflect/internal/Symbols.scala.html#46629" title="=&gt; List[List[Macros.this.global.Symbol]]">paramss</a>
        <a href="../util/SimpleTracer.scala.html#186534" title="(msg: String)(value: List[List[Macros.this.global.Symbol]])List[List[Macros.this.global.Symbol]]">trace</a><span class="delimiter">(</span><span title="String(&quot;paramss: &quot;)" class="string">&quot;paramss: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#644018" title="List[List[Macros.this.global.Symbol]]">paramss</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="List[List[ScalaObject]]" id="644019">rawArgss</a> = <span class="keyword">for</span> <span class="delimiter">(</span><span class="delimiter">(</span><a title="List[ScalaObject]" id="647984">as</a>, <a title="List[Macros.this.global.Symbol]" id="647985">ps</a><span class="delimiter">)</span> &lt;- <a href="#644017" title="List[List[ScalaObject]]">argss</a> <a href="#647957" title="(f: ((List[ScalaObject], List[Macros.this.global.Symbol])) =&gt; List[ScalaObject])(implicit bf: scala.collection.generic.CanBuildFrom[List[(List[ScalaObject], List[Macros.this.global.Symbol])],List[ScalaObject],List[List[ScalaObject]]])List[List[ScalaObject]]">zip</a> <a href="#644018" title="List[List[Macros.this.global.Symbol]]">paramss</a><span class="delimiter">)</span> <span class="keyword">yield</span> <span class="delimiter">{</span>
          <span title="List[ScalaObject]" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../reflect/internal/Definitions.scala.html#45115" title="(params: List[Macros.this.global.Symbol])Boolean">isVarArgsList</a><span class="delimiter">(</span><a href="#647985" title="List[Macros.this.global.Symbol]">ps</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#647984" title="List[ScalaObject]">as</a>.<span title="(n: Int)List[ScalaObject]">take</span><span class="delimiter">(</span><a href="#647985" title="List[Macros.this.global.Symbol]">ps</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span title="(elem: ScalaObject)(implicit bf: scala.collection.generic.CanBuildFrom[List[ScalaObject],ScalaObject,List[ScalaObject]])List[ScalaObject]">:+</span> <a href="#647984" title="List[ScalaObject]">as</a>.<span title="(n: Int)List[ScalaObject]">drop</span><span class="delimiter">(</span><a href="#647985" title="List[Macros.this.global.Symbol]">ps</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
          <span class="keyword">else</span> <a href="#647984" title="List[ScalaObject]">as</a>
        <span class="delimiter">}</span>
        <span class="keyword">val</span> <a title="Seq[Any]" id="644020">rawArgs</a>: <span title="Seq[Any]">Seq</span><span class="delimiter">[</span>Any<span class="delimiter">]</span> = <a href="#644019" title="List[List[ScalaObject]]">rawArgss</a>.<span title="(implicit asTraversable: List[ScalaObject] =&gt; scala.collection.GenTraversableOnce[Any])List[Any]">flatten</span>
        <a href="../util/SimpleTracer.scala.html#186534" title="(msg: String)(value: Seq[Any])Seq[Any]">trace</a><span class="delimiter">(</span><span title="String(&quot;rawArgs: &quot;)" class="string">&quot;rawArgs: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#644020" title="Seq[Any]">rawArgs</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Macros.this.global.nodePrinters.InfoLevel.Value" id="644021">savedInfolevel</a> = <a href="../Global.scala.html#186165" title="object Macros.this.global.nodePrinters">nodePrinters</a>.<a href="../ast/NodePrinters.scala.html#238871" title="=&gt; Macros.this.global.nodePrinters.InfoLevel.Value">infolevel</a>
        <span class="keyword">try</span> <span class="delimiter">{</span>
          // @xeno.by: InfoLevel.Verbose examines and prints out infos of symbols
          // by the means of this'es these symbols can climb up the lexical scope
          // when these symbols will be examined by a node printer
          // they will enumerate and analyze their children (ask for infos and tpes)
          // if one of those children involves macro expansion, things might get nasty
          // that's why I'm temporarily turning this behavior off
          <a href="../Global.scala.html#186165" title="object Macros.this.global.nodePrinters">nodePrinters</a>.<a href="../ast/NodePrinters.scala.html#238872" title="(x$1: Macros.this.global.nodePrinters.InfoLevel.Value)Unit">infolevel</a> = <a href="../Global.scala.html#186165" title="object Macros.this.global.nodePrinters">nodePrinters</a>.<a href="../ast/NodePrinters.scala.html#238869" title="object Macros.this.global.nodePrinters.InfoLevel">InfoLevel</a>.<a href="../ast/NodePrinters.scala.html#239676" title="=&gt; Macros.this.global.nodePrinters.InfoLevel.Value">Quiet</a>
          <span class="keyword">val</span> <a title="Any" id="648110">expanded</a> = <a href="#187586" title="=&gt; scala.reflect.runtime.Mirror{lazy val libraryClassLoader: ClassLoader}">mirror</a>.<a href="../../../reflect/runtime/Mirror.scala.html#182863" title="(receiver: AnyRef, meth: Macros.this.mirror.Symbol)(args: Any*)Any">invoke</a><span class="delimiter">(</span><a href="#644015" title="AnyRef">receiver</a>, <a href="#644016" title="Macros.this.mirror.Symbol">rmeth</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#644020" title="Seq[Any]">rawArgs</a>: _*<span class="delimiter">)</span>
          <a href="#648110" title="Any">expanded</a> <span title="Option[Any]" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a title="Some[Macros.this.global.Tree]" id="648116">expanded</a>: <span title="Macros.this.global.Tree">Tree</span> =&gt;
              <span class="keyword">val</span> <a title="Macros.this.global.Type" id="648117">expectedTpe</a> = <a href="#644000" title="Macros.this.global.Tree">tree</a>.<span title="=&gt; Macros.this.global.Type">tpe</span>
              <span class="keyword">val</span> <a title="Macros.this.global.Tree" id="648118">typed</a> = <a href="#644001" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#187856" title="(tree: Macros.this.global.Tree, mode: Int, pt: Macros.this.global.Type)Macros.this.global.Tree">typed</a><span class="delimiter">(</span><a href="#648116" title="Macros.this.global.Tree">expanded</a>, <span title="Int(1)">EXPRmode</span>, <a href="#648117" title="Macros.this.global.Type">expectedTpe</a><span class="delimiter">)</span>
              <span title="(x: Macros.this.global.Tree)Some[Macros.this.global.Tree]">Some</span><span class="delimiter">(</span><a href="#648118" title="Macros.this.global.Tree">typed</a><span class="delimiter">)</span>
            <span class="keyword">case</span> <a title="None.type" id="648130">expanded</a> <span class="keyword">if</span> <a href="#648130" title="Any">expanded</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><span title="Macros.this.global.Tree">Tree</span><span class="delimiter">]</span> =&gt;
              <a href="#644001" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#187741" title="=&gt; Macros.this.Context">context</a>.<a href="Contexts.scala.html#188102" title="=&gt; Macros.this.global.CompilationUnit">unit</a>.<a href="../CompilationUnits.scala.html#188714" title="(pos: Macros.this.global.Position, msg: String)Unit">error</a><span class="delimiter">(</span><a href="#644000" title="Macros.this.global.Tree">tree</a>.<span title="=&gt; Macros.this.global.Position">pos</span>, <span title="String(&quot;macro must return a compiler-specific tree; returned value is Tree, but it doesn\'t belong to this compiler\'s universe&quot;)" class="string">&quot;macro must return a compiler-specific tree; returned value is Tree, but it doesn't belong to this compiler's universe&quot;</span><span class="delimiter">)</span>
              <span title="object None">None</span>
            <span class="keyword">case</span> <a title="None.type" id="648133">expanded</a> =&gt;
              <a href="#644001" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#187741" title="=&gt; Macros.this.Context">context</a>.<a href="Contexts.scala.html#188102" title="=&gt; Macros.this.global.CompilationUnit">unit</a>.<a href="../CompilationUnits.scala.html#188714" title="(pos: Macros.this.global.Position, msg: String)Unit">error</a><span class="delimiter">(</span><a href="#644000" title="Macros.this.global.Tree">tree</a>.<span title="=&gt; Macros.this.global.Position">pos</span>, <span title="String(&quot;macro must return a compiler-specific tree; returned value is of class: &quot;)" class="string">&quot;macro must return a compiler-specific tree; returned value is of class: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#648133" title="Any">expanded</a>.<span title="()Class[_]">getClass</span><span class="delimiter">)</span>
              <span title="object None">None</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a title="None.type" id="648136">ex</a> =&gt;
            <span class="keyword">val</span> <a title="Throwable" id="648137">realex</a> = <span title="object scala.reflect.ReflectionUtils">ReflectionUtils</span>.<span title="(x: Throwable)Throwable">unwrapThrowable</span><span class="delimiter">(</span><a href="#648136" title="Throwable">ex</a><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="String" id="648138">msg</a> = <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="../Global.scala.html#186138" title="=&gt; scala.tools.nsc.Settings">settings</a>.<a href="../settings/ScalaSettings.scala.html#186844" title="=&gt; scala.tools.nsc.Settings#BooleanSetting">Ymacrodebug</a>.<a href="../settings/MutableSettings.scala.html#187054" title="=&gt; Boolean">value</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="keyword">val</span> <a title="java.io.StringWriter" id="648140">stacktrace</a> = <span title="java.io.StringWriter" class="keyword">new</span> java.io.<span title="java.io.StringWriter">StringWriter</span><span class="delimiter">(</span><span class="delimiter">)</span>
              <a href="#648137" title="Throwable">realex</a>.<span title="(x$1: java.io.PrintWriter)Unit">printStackTrace</span><span class="delimiter">(</span><span title="java.io.PrintWriter" class="keyword">new</span> java.io.<span title="java.io.PrintWriter">PrintWriter</span><span class="delimiter">(</span><a href="#648140" title="java.io.StringWriter">stacktrace</a><span class="delimiter">)</span><span class="delimiter">)</span>
              <span title="object System">System</span>.<span title="(x$1: String)String">getProperty</span><span class="delimiter">(</span><span title="String(&quot;line.separator&quot;)" class="string">&quot;line.separator&quot;</span><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <a href="#648140" title="java.io.StringWriter">stacktrace</a>
            <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
              <a href="#648137" title="Throwable">realex</a>.<span title="()String">getMessage</span>
            <span class="delimiter">}</span>
            <a href="#644001" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#187741" title="=&gt; Macros.this.Context">context</a>.<a href="Contexts.scala.html#188102" title="=&gt; Macros.this.global.CompilationUnit">unit</a>.<a href="../CompilationUnits.scala.html#188714" title="(pos: Macros.this.global.Position, msg: String)Unit">error</a><span class="delimiter">(</span><a href="#644000" title="Macros.this.global.Tree">tree</a>.<span title="=&gt; Macros.this.global.Position">pos</span>, <span title="String(&quot;exception during macro expansion: &quot;)" class="string">&quot;exception during macro expansion: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#648138" title="String">msg</a><span class="delimiter">)</span>
            <span title="object None">None</span>
        <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
          <a href="../Global.scala.html#186165" title="object Macros.this.global.nodePrinters">nodePrinters</a>.<a href="../ast/NodePrinters.scala.html#238872" title="(x$1: Macros.this.global.nodePrinters.InfoLevel.Value)Unit">infolevel</a> = <a href="#644021" title="Macros.this.global.nodePrinters.InfoLevel.Value">savedInfolevel</a>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="Option[Any]">None</span> =&gt;
        <span class="keyword">def</span> <a title="()None.type" id="648153">notFound</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
          <a href="#644001" title="Macros.this.Typer">typer</a>.<a href="Typers.scala.html#187741" title="=&gt; Macros.this.Context">context</a>.<a href="Contexts.scala.html#188102" title="=&gt; Macros.this.global.CompilationUnit">unit</a>.<a href="../CompilationUnits.scala.html#188714" title="(pos: Macros.this.global.Position, msg: String)Unit">error</a><span class="delimiter">(</span><a href="#644000" title="Macros.this.global.Tree">tree</a>.<span title="=&gt; Macros.this.global.Position">pos</span>, <span title="String(&quot;macro implementation not found: &quot;)" class="string">&quot;macro implementation not found: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#644004" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#46571" title="=&gt; Macros.this.global.Name">name</a><span class="delimiter">)</span>
          <span title="object None">None</span>
        <span class="delimiter">}</span>
        <span class="keyword">def</span> <a title="(tree: Macros.this.global.Tree)Option[Macros.this.global.Tree]" id="648154">fallBackToOverridden</a><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="648155">tree</a>: <span title="Macros.this.global.Tree">Tree</span><span class="delimiter">)</span>: <span title="Option[Macros.this.global.Tree]">Option</span><span class="delimiter">[</span>Tree<span class="delimiter">]</span> = <span class="delimiter">{</span>
          <a href="#648155" title="Macros.this.global.Tree">tree</a> <span title="Option[Macros.this.global.Tree]" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <span title="Option[Macros.this.global.Tree]">Select</span><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="648160">qual</a>, <a title="Macros.this.global.Name" id="648161">name</a><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="#644004" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#46538" title="=&gt; Boolean">isMacro</a><span class="delimiter">)</span> =&gt;
              <a href="#644004" title="Macros.this.global.Symbol">macroDef</a>.<a href="../../../reflect/internal/Symbols.scala.html#46703" title="=&gt; List[Macros.this.global.Symbol]">allOverriddenSymbols</a> <span title="Option[Macros.this.global.Tree]" class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <a title="Some[Macros.this.global.Select]" id="648168">first</a> :: _ =&gt;
                  <span title="(x: Macros.this.global.Select)Some[Macros.this.global.Select]">Some</span><span class="delimiter">(</span><a href="Analyzer.scala.html#187273" title="(qualifier: Macros.this.global.Tree, name: Macros.this.global.Name)Macros.this.global.Select">Select</a><span class="delimiter">(</span><a href="#648160" title="Macros.this.global.Tree">qual</a>, <a href="#648161" title="Macros.this.global.Name">name</a><span class="delimiter">)</span> <span title="(pos: scala.tools.nsc.util.Position)Macros.this.global.Select">setPos</span> <a href="#648155" title="Macros.this.global.Tree">tree</a>.<span title="=&gt; Macros.this.global.Position">pos</span> <span title="(sym: Macros.this.global.Symbol)Macros.this.global.Select">setSymbol</span> <a href="#648168" title="Macros.this.global.Symbol">first</a><span class="delimiter">)</span>
                <span class="keyword">case</span> <span title="None.type">_</span> =&gt;
                  <a href="../util/SimpleTracer.scala.html#186534" title="(msg: String)(value: Macros.this.global.Tree)Macros.this.global.Tree">trace</a><span class="delimiter">(</span><span title="String(&quot;macro is not overridden: &quot;)" class="string">&quot;macro is not overridden: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#648155" title="Macros.this.global.Tree">tree</a><span class="delimiter">)</span>
                  <a href="#648153" title="()None.type">notFound</a><span class="delimiter">(</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="keyword">case</span> <span title="Option[Macros.this.global.Tree]">Apply</span><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="648207">fn</a>, <a title="List[Macros.this.global.Tree]" id="648208">args</a><span class="delimiter">)</span> =&gt;
              <a href="#648154" title="(tree: Macros.this.global.Tree)Option[Macros.this.global.Tree]">fallBackToOverridden</a><span class="delimiter">(</span><a href="#648207" title="Macros.this.global.Tree">fn</a><span class="delimiter">)</span> <span title="Option[Macros.this.global.Tree]" class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <span title="Some[Macros.this.global.Apply]">Some</span><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="648210">fn1</a><span class="delimiter">)</span> =&gt; <span title="(x: Macros.this.global.Apply)Some[Macros.this.global.Apply]">Some</span><span class="delimiter">(</span><a href="Analyzer.scala.html#187273" title="(fun: Macros.this.global.Tree, args: List[Macros.this.global.Tree])Macros.this.global.Apply">Apply</a><span class="delimiter">(</span><a href="#648210" title="Macros.this.global.Tree">fn1</a>, <a href="#648208" title="List[Macros.this.global.Tree]">args</a><span class="delimiter">)</span> <span title="(pos: scala.tools.nsc.util.Position)Macros.this.global.Apply">setPos</span> <a href="#648155" title="Macros.this.global.Tree">tree</a>.<span title="=&gt; Macros.this.global.Position">pos</span><span class="delimiter">)</span>
                <span class="keyword">case</span> <span title="None.type">_</span>         =&gt; <span title="object None">None</span>
              <span class="delimiter">}</span>
            <span class="keyword">case</span> <span title="Option[Macros.this.global.Tree]">TypeApply</span><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="648240">fn</a>, <a title="List[Macros.this.global.Tree]" id="648241">args</a><span class="delimiter">)</span> =&gt;
              <a href="#648154" title="(tree: Macros.this.global.Tree)Option[Macros.this.global.Tree]">fallBackToOverridden</a><span class="delimiter">(</span><a href="#648240" title="Macros.this.global.Tree">fn</a><span class="delimiter">)</span> <span title="Option[Macros.this.global.Tree]" class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <span title="Some[Macros.this.global.TypeApply]">Some</span><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="648243">fn1</a><span class="delimiter">)</span> =&gt; <span title="(x: Macros.this.global.TypeApply)Some[Macros.this.global.TypeApply]">Some</span><span class="delimiter">(</span><a href="Analyzer.scala.html#187273" title="(fun: Macros.this.global.Tree, args: List[Macros.this.global.Tree])Macros.this.global.TypeApply">TypeApply</a><span class="delimiter">(</span><a href="#648243" title="Macros.this.global.Tree">fn1</a>, <a href="#648241" title="List[Macros.this.global.Tree]">args</a><span class="delimiter">)</span> <span title="(pos: scala.tools.nsc.util.Position)Macros.this.global.TypeApply">setPos</span> <a href="#648155" title="Macros.this.global.Tree">tree</a>.<span title="=&gt; Macros.this.global.Position">pos</span><span class="delimiter">)</span>
                <span class="keyword">case</span> <span title="None.type">_</span>         =&gt; <span title="object None">None</span>
              <span class="delimiter">}</span>
            <span class="keyword">case</span> <span title="None.type">_</span> =&gt;
              <a href="../util/SimpleTracer.scala.html#186534" title="(msg: String)(value: Macros.this.global.Tree)Macros.this.global.Tree">trace</a><span class="delimiter">(</span><span title="String(&quot;unexpected tree in fallback: &quot;)" class="string">&quot;unexpected tree in fallback: &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#648155" title="Macros.this.global.Tree">tree</a><span class="delimiter">)</span>
              <a href="#648153" title="()None.type">notFound</a><span class="delimiter">(</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        <a href="#648154" title="(tree: Macros.this.global.Tree)Option[Macros.this.global.Tree]">fallBackToOverridden</a><span class="delimiter">(</span><a href="#644000" title="Macros.this.global.Tree">tree</a><span class="delimiter">)</span> <span title="Option[Any]" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Some[Macros.this.global.Tree]">Some</span><span class="delimiter">(</span><a title="Macros.this.global.Tree" id="648262">tree1</a><span class="delimiter">)</span> =&gt;
            <a href="../util/SimpleTracer.scala.html#186534" title="(msg: String)(value: Macros.this.global.Tree)Macros.this.global.Tree">trace</a><span class="delimiter">(</span><span title="String(&quot;falling back to &quot;)" class="string">&quot;falling back to &quot;</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#648262" title="Macros.this.global.Tree">tree1</a><span class="delimiter">)</span>
            <a href="../Global.scala.html#186319" title="=&gt; Macros.this.global.Run">currentRun</a>.<a href="../Global.scala.html#188794" title="(x$1: Boolean)Unit">macroExpansionFailed</a> = <span title="Boolean(true)" class="keyword">true</span>
            <span title="(x: Macros.this.global.Tree)Some[Macros.this.global.Tree]">Some</span><span class="delimiter">(</span><a href="#648262" title="Macros.this.global.Tree">tree1</a><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="None.type">None</span> =&gt;
            <span title="object None">None</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/interactive/ScratchPadMaker.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> interactive

<span class="keyword">import</span> util.<span class="delimiter">{</span>SourceFile, BatchSourceFile, RangePosition<span class="delimiter">}</span>
<span class="keyword">import</span> collection.mutable.ArrayBuffer
<span class="keyword">import</span> reflect.internal.<a href="../../../reflect/internal/Chars.scala.html#7661" title="object scala.reflect.internal.Chars">Chars</a>.isLineBreakChar

<span class="keyword">trait</span> <a title="trait ScratchPadMaker extends Object with ScalaObject" id="20563">ScratchPadMaker</a> <span title="ScalaObject" class="delimiter">{</span> self: Global =&gt;

  <span class="keyword">import</span> <a href="../../../reflect/internal/Definitions.scala.html#39224" title="object ScratchPadMaker.this.definitions">definitions</a>._

  <span class="keyword">private</span> case <span class="keyword">class</span> <a title="class Patch extends Object with ScalaObject with Product with Serializable" id="454187">Patch</a><a href="#454187" title="ScalaObject" class="delimiter">(</a><a title="Int" id="450579">offset</a>: <span title="Int">Int</span>, <a title="String" id="450580">text</a>: <span title="String">String</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">class</span> <a title="class Patcher extends ScratchPadMaker.this.Traverser with ScalaObject" id="254596">Patcher</a><a href="#254596" title="ScalaObject" class="delimiter">(</a><a title="Array[Char]" id="450534">contents</a>: <span title="Array[Char]">Array</span><span class="delimiter">[</span>Char<span class="delimiter">]</span>, <a title="Int" id="450535">endOffset</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#20563" title="ScratchPadMaker.this.Traverser">Traverser</a> <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="String" id="450496">objectName</a>: <span title="String">String</span> = <span title="String(&quot;&quot;)" class="string">&quot;&quot;</span>

    <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]" id="450498">patches</a> = <span title="()scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]" class="keyword">new</span> <span title="scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]">ArrayBuffer</span><span class="delimiter">[</span>Patch<span class="delimiter">]</span>
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[String]" id="450500">toPrint</a> = <span title="()scala.collection.mutable.ArrayBuffer[String]" class="keyword">new</span> <span title="scala.collection.mutable.ArrayBuffer[String]">ArrayBuffer</span><span class="delimiter">[</span>String<span class="delimiter">]</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="450503">skipped</a> = <span title="Int(0)" class="int">0</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="450506">resNum</a>: <span title="Int">Int</span> = -<span title="Int(-1)" class="int">1</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="()String" id="450508">nextRes</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
      <a href="#450506" title="(x$1: Int)Unit">resNum</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
      <span title="String(&quot;res$&quot;)" class="string">&quot;res$&quot;</span><span title="(x$1: Any)String">+</span><a href="#450506" title="=&gt; Int">resNum</a>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(name: String, tpe: ScratchPadMaker.this.Type)String" id="450509">nameType</a><span class="delimiter">(</span><a title="String" id="450545">name</a>: <span title="String">String</span>, <a title="ScratchPadMaker.this.Type" id="450546">tpe</a>: <a href="../../../reflect/internal/Types.scala.html#38813" title="ScratchPadMaker.this.Type">Type</a><span class="delimiter">)</span>: <span title="String">String</span> = <a href="#450545" title="String">name</a><span title="(x$1: Any)String">+</span><span title="String(&quot;: &quot;)" class="string">&quot;: &quot;</span><span title="(x$1: Any)String">+</span><a href="#450546" title="ScratchPadMaker.this.Type">tpe</a>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: ScratchPadMaker.this.Symbol)String" id="450510">nameType</a><span class="delimiter">(</span><a title="ScratchPadMaker.this.Symbol" id="450548">sym</a>: <a href="../../../reflect/internal/Symbols.scala.html#38726" title="ScratchPadMaker.this.Symbol">Symbol</a><span class="delimiter">)</span>: <span title="String">String</span> = <a href="#450509" title="(name: String, tpe: ScratchPadMaker.this.Type)String">nameType</a><span class="delimiter">(</span><a href="#450548" title="ScratchPadMaker.this.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#46571" title="=&gt; ScratchPadMaker.this.Name">name</a>.<span title="()String">toString</span>, <a href="#450548" title="ScratchPadMaker.this.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#46606" title="=&gt; ScratchPadMaker.this.Type">tpe</a><span class="delimiter">)</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(str: String)String" id="450511">literal</a><span class="delimiter">(</span><a title="String" id="450555">str</a>: <span title="String">String</span><span class="delimiter">)</span> = <span title="String(&quot;\&quot;\&quot;\&quot;&quot;)" class="string">&quot;\&quot;\&quot;\&quot;&quot;</span><span title="(x$1: Any)String">+</span><a href="#450555" title="String">str</a><span title="(x$1: Any)String">+</span><span title="String(&quot;\&quot;\&quot;\&quot;&quot;)" class="string">&quot;\&quot;\&quot;\&quot;&quot;</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(offset: Int)Unit" id="450512">applyPendingPatches</a><span class="delimiter">(</span><a title="Int" id="450558">offset</a>: <span title="Int">Int</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#450503" title="=&gt; Int">skipped</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#450498" title="=&gt; scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]">patches</a> <span title="(elem: ScratchPadMaker.this.Patch)Patcher.this.patches.type">+=</span> <a href="#454187" title="(offset: Int, text: String)ScratchPadMaker.this.Patch">Patch</a><span class="delimiter">(</span><a href="#450558" title="Int">offset</a>, <span title="String(&quot;import scala.tools.nsc.scratchpad.Executor._; &quot;)" class="string">&quot;import scala.tools.nsc.scratchpad.Executor._; &quot;</span><span class="delimiter">)</span>
      <span class="keyword">for</span> <span class="delimiter">(</span><a title="String" id="450679">msg</a> &lt;- <a href="#450500" title="(f: String =&gt; scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch])Unit">toPrint</a><span class="delimiter">)</span> <a href="#450498" title="=&gt; scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]">patches</a> <span title="(elem: ScratchPadMaker.this.Patch)Patcher.this.patches.type">+=</span> <a href="#454187" title="(offset: Int, text: String)ScratchPadMaker.this.Patch">Patch</a><span class="delimiter">(</span><a href="#450558" title="Int">offset</a>, <span title="String(&quot;;System.out.println(&quot;)" class="string">&quot;;System.out.println(&quot;</span><span title="(x$1: Any)String">+</span><a href="#450679" title="String">msg</a><span title="(x$1: Any)String">+</span><span title="String(&quot;)&quot;)" class="string">&quot;)&quot;</span><span class="delimiter">)</span>
      <a href="#450500" title="=&gt; scala.collection.mutable.ArrayBuffer[String]">toPrint</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(stat: ScratchPadMaker.this.Tree)Unit" id="450513">addSkip</a><span class="delimiter">(</span><a title="ScratchPadMaker.this.Tree" id="450683">stat</a>: <span title="ScratchPadMaker.this.Tree">Tree</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#450683" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Position">pos</span>.<a href="../util/Position.scala.html#187134" title="=&gt; Int">start</a> <span title="(x: Int)Boolean">&gt;</span> <a href="#450503" title="=&gt; Int">skipped</a><span class="delimiter">)</span> <a href="#450512" title="(offset: Int)Unit">applyPendingPatches</a><span class="delimiter">(</span><a href="#450683" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Position">pos</span>.<a href="../util/Position.scala.html#187134" title="=&gt; Int">start</a><span class="delimiter">)</span>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#450683" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Position">pos</span>.<a href="../util/Position.scala.html#187134" title="=&gt; Int">start</a> <span title="(x: Int)Boolean">&gt;=</span> <a href="#450535" title="Int">endOffset</a><span class="delimiter">)</span>
        <a href="#450498" title="=&gt; scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]">patches</a> <span title="(elem: ScratchPadMaker.this.Patch)Patcher.this.patches.type">+=</span> <a href="#454187" title="(offset: Int, text: String)ScratchPadMaker.this.Patch">Patch</a><span class="delimiter">(</span><a href="#450683" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Position">pos</span>.<a href="../util/Position.scala.html#187134" title="=&gt; Int">start</a>, <span title="String(&quot;;$stop()&quot;)" class="string">&quot;;$stop()&quot;</span><span class="delimiter">)</span>
      <span class="keyword">var</span> <a title="Int" id="450685">end</a> = <a href="#450683" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Position">pos</span>.<a href="../util/Position.scala.html#187138" title="=&gt; Int">end</a>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#450685" title="Int">end</a> <span title="(x: Int)Boolean">&gt;</span> <a href="#450503" title="=&gt; Int">skipped</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#450685" title="Int">end</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#450534" title="Array[Char]">contents</a>.<span title="=&gt; Int">length</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><span class="delimiter">(</span><a href="../../../reflect/internal/Chars.scala.html#67108" title="(c: Char)Boolean">isLineBreakChar</a><span class="delimiter">(</span><a href="#450534" title="(i: Int)Char">contents</a><span class="delimiter">(</span><a href="#450685" title="Int">end</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#450685" title="Int">end</a> <a href="#450706" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
        <a href="#450498" title="=&gt; scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]">patches</a> <span title="(elem: ScratchPadMaker.this.Patch)Patcher.this.patches.type">+=</span> <a href="#454187" title="(offset: Int, text: String)ScratchPadMaker.this.Patch">Patch</a><span class="delimiter">(</span><a href="#450683" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Position">pos</span>.<a href="../util/Position.scala.html#187134" title="=&gt; Int">start</a>, <span title="String(&quot;;$skip(&quot;)" class="string">&quot;;$skip(&quot;</span><span title="(x$1: Any)String">+</span><span class="delimiter">(</span><a href="#450685" title="Int">end</a><span title="(x: Int)Int">-</span><a href="#450503" title="=&gt; Int">skipped</a><span class="delimiter">)</span><span title="(x$1: Any)String">+</span><span title="String(&quot;); &quot;)" class="string">&quot;); &quot;</span><span class="delimiter">)</span>
        <a href="#450503" title="(x$1: Int)Unit">skipped</a> = <a href="#450685" title="Int">end</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(expr: ScratchPadMaker.this.Tree)Unit" id="450514">addSandbox</a><span class="delimiter">(</span><a title="ScratchPadMaker.this.Tree" id="450723">expr</a>: <span title="ScratchPadMaker.this.Tree">Tree</span><span class="delimiter">)</span> = <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>
//      patches += (Patch(expr.pos.start, &quot;sandbox(&quot;), Patch(expr.pos.end, &quot;)&quot;))

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(prefix: String, expr: String)String" id="450515">resultString</a><span class="delimiter">(</span><a title="String" id="450726">prefix</a>: <span title="String">String</span>, <a title="String" id="450727">expr</a>: <span title="String">String</span><span class="delimiter">)</span> =
      <a href="#450511" title="(str: String)String">literal</a><span class="delimiter">(</span><a href="#450726" title="String">prefix</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; = &quot;)" class="string">&quot; = &quot;</span><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot; + $show(&quot;)" class="string">&quot; + $show(&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#450727" title="String">expr</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;)&quot;)" class="string">&quot;)&quot;</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(stat: ScratchPadMaker.this.Tree)Any" id="450516">traverseStat</a><span class="delimiter">(</span><a title="ScratchPadMaker.this.Tree" id="450730">stat</a>: <span title="ScratchPadMaker.this.Tree">Tree</span><span class="delimiter">)</span> =
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#450730" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Position">pos</span>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><a href="../util/Position.scala.html#33526" title="scala.tools.nsc.util.RangePosition">RangePosition</a><span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#450730" title="ScratchPadMaker.this.Tree">stat</a> <span title="Any" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Any">ValDef</span><span class="delimiter">(</span>_, _, _, <a title="ScratchPadMaker.this.Tree" id="450741">rhs</a><span class="delimiter">)</span> =&gt;
            <a href="#450513" title="(stat: ScratchPadMaker.this.Tree)Unit">addSkip</a><span class="delimiter">(</span><a href="#450730" title="ScratchPadMaker.this.Tree">stat</a><span class="delimiter">)</span>
            <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#450730" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Symbol">symbol</span>.<a href="../../../reflect/internal/HasFlags.scala.html#46779" title="=&gt; Boolean">isLazy</a><span class="delimiter">)</span>
              <a href="#450500" title="=&gt; scala.collection.mutable.ArrayBuffer[String]">toPrint</a> <span title="(elem: String)Patcher.this.toPrint.type">+=</span> <a href="#450511" title="(str: String)String">literal</a><span class="delimiter">(</span><a href="#450510" title="(sym: ScratchPadMaker.this.Symbol)String">nameType</a><span class="delimiter">(</span><a href="#450730" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Symbol">symbol</span><span class="delimiter">)</span> <span title="(x$1: Any)String">+</span> <span title="String(&quot; = &lt;lazy&gt;&quot;)" class="string">&quot; = &lt;lazy&gt;&quot;</span><span class="delimiter">)</span>
            <span class="keyword">else</span> <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#450730" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Symbol">symbol</span>.<a href="../../../reflect/internal/HasFlags.scala.html#46784" title="=&gt; Boolean">isSynthetic</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#450514" title="(expr: ScratchPadMaker.this.Tree)Unit">addSandbox</a><span class="delimiter">(</span><a href="#450741" title="ScratchPadMaker.this.Tree">rhs</a><span class="delimiter">)</span>
              <a href="#450500" title="=&gt; scala.collection.mutable.ArrayBuffer[String]">toPrint</a> <span title="(elem: String)Patcher.this.toPrint.type">+=</span> <a href="#450515" title="(prefix: String, expr: String)String">resultString</a><span class="delimiter">(</span><a href="#450510" title="(sym: ScratchPadMaker.this.Symbol)String">nameType</a><span class="delimiter">(</span><a href="#450730" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Symbol">symbol</span><span class="delimiter">)</span>, <a href="#450730" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Symbol">symbol</span>.<a href="../../../reflect/internal/Symbols.scala.html#46571" title="=&gt; ScratchPadMaker.this.Name">name</a>.<span title="()String">toString</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="keyword">case</span> <span title="Patcher.this.toPrint.type">DefDef</span><span class="delimiter">(</span>_, _, _, _, _, _<span class="delimiter">)</span> =&gt;
            <a href="#450513" title="(stat: ScratchPadMaker.this.Tree)Unit">addSkip</a><span class="delimiter">(</span><a href="#450730" title="ScratchPadMaker.this.Tree">stat</a><span class="delimiter">)</span>
            <a href="#450500" title="=&gt; scala.collection.mutable.ArrayBuffer[String]">toPrint</a> <span title="(elem: String)Patcher.this.toPrint.type">+=</span> <a href="#450511" title="(str: String)String">literal</a><span class="delimiter">(</span><a href="#450510" title="(sym: ScratchPadMaker.this.Symbol)String">nameType</a><span class="delimiter">(</span><a href="#450730" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Symbol">symbol</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Unit">Annotated</span><span class="delimiter">(</span>_, <a title="ScratchPadMaker.this.Tree" id="450840">arg</a><span class="delimiter">)</span> =&gt;
            <a href="#450517" title="(tree: ScratchPadMaker.this.Tree)Unit">traverse</a><span class="delimiter">(</span><a href="#450840" title="ScratchPadMaker.this.Tree">arg</a><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Unit">DocDef</span><span class="delimiter">(</span>_, <a title="ScratchPadMaker.this.Tree" id="450846">defn</a><span class="delimiter">)</span> =&gt;
            <a href="#450517" title="(tree: ScratchPadMaker.this.Tree)Unit">traverse</a><span class="delimiter">(</span><a href="#450846" title="ScratchPadMaker.this.Tree">defn</a><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="Any">_</span> =&gt;
            <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#450730" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; Boolean">isTerm</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#450513" title="(stat: ScratchPadMaker.this.Tree)Unit">addSkip</a><span class="delimiter">(</span><a href="#450730" title="ScratchPadMaker.this.Tree">stat</a><span class="delimiter">)</span>
              <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#450730" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Type">tpe</span>.<a href="../../../reflect/internal/Types.scala.html#41504" title="=&gt; ScratchPadMaker.this.Symbol">typeSymbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Definitions.scala.html#45531" title="=&gt; ScratchPadMaker.this.Symbol">UnitClass</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                <a href="#450514" title="(expr: ScratchPadMaker.this.Tree)Unit">addSandbox</a><span class="delimiter">(</span><a href="#450730" title="ScratchPadMaker.this.Tree">stat</a><span class="delimiter">)</span>
              <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
                <span class="keyword">val</span> <a title="String" id="450853">resName</a> = <a href="#450508" title="()String">nextRes</a><span class="delimiter">(</span><span class="delimiter">)</span>
                <span class="keyword">val</span> <a title="String" id="450854">dispResName</a> = <a href="#450853" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">resName</a> <span title="(p: Char =&gt; Boolean)String">filter</span> <span class="delimiter">(</span><span title="Char('$')" class="char">'$'</span> <a href="#451032" title="(x: Char)Boolean">!=</a><span class="delimiter">)</span>
                <a href="#450498" title="=&gt; scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]">patches</a> <span title="(elem: ScratchPadMaker.this.Patch)Patcher.this.patches.type">+=</span> <a href="#454187" title="(offset: Int, text: String)ScratchPadMaker.this.Patch">Patch</a><span class="delimiter">(</span><a href="#450730" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Position">pos</span>.<a href="../util/Position.scala.html#187134" title="=&gt; Int">start</a>, <span title="String(&quot;val &quot;)" class="string">&quot;val &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#450853" title="String">resName</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; = &quot;)" class="string">&quot; = &quot;</span><span class="delimiter">)</span>
                <a href="#450514" title="(expr: ScratchPadMaker.this.Tree)Unit">addSandbox</a><span class="delimiter">(</span><a href="#450730" title="ScratchPadMaker.this.Tree">stat</a><span class="delimiter">)</span>
                <a href="#450500" title="=&gt; scala.collection.mutable.ArrayBuffer[String]">toPrint</a> <span title="(elem: String)Patcher.this.toPrint.type">+=</span> <a href="#450515" title="(prefix: String, expr: String)String">resultString</a><span class="delimiter">(</span><a href="#450509" title="(name: String, tpe: ScratchPadMaker.this.Type)String">nameType</a><span class="delimiter">(</span><a href="#450854" title="String">dispResName</a>, <a href="#450730" title="ScratchPadMaker.this.Tree">stat</a>.<span title="=&gt; ScratchPadMaker.this.Type">tpe</span><span class="delimiter">)</span>, <a href="#450853" title="String">resName</a><span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: ScratchPadMaker.this.Tree)Unit" id="450517">traverse</a><span class="delimiter">(</span><a title="ScratchPadMaker.this.Tree" id="450841">tree</a>: <span title="ScratchPadMaker.this.Tree">Tree</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#450841" title="ScratchPadMaker.this.Tree">tree</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Unit">PackageDef</span><span class="delimiter">(</span>_, _<span class="delimiter">)</span> =&gt;
        <a href="#254596" title="ScratchPadMaker.this.Patcher" class="keyword">super</a>.<span title="(tree: ScratchPadMaker.this.Tree)Unit">traverse</span><span class="delimiter">(</span><a href="#450841" title="ScratchPadMaker.this.Tree">tree</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">ModuleDef</span><span class="delimiter">(</span>_, <a title="ScratchPadMaker.this.TermName" id="451074">name</a>, Template<span class="delimiter">(</span>_, _, <a title="List[ScratchPadMaker.this.Tree]" id="451086">body</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#450496" title="=&gt; String">objectName</a>.<span title="()Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span> /* objectName.isEmpty does not compile on Java 5 due to ambiguous implicit conversions: augmentString, stringToTermName */<span class="delimiter">)</span>
          <a href="#450496" title="(x$1: String)Unit">objectName</a> = <a href="#450841" title="ScratchPadMaker.this.Tree">tree</a>.<span title="=&gt; ScratchPadMaker.this.Symbol">symbol</span>.<a href="../../../reflect/internal/Symbols.scala.html#46585" title="=&gt; String">fullName</a>
        <a href="#451086" title="List[ScratchPadMaker.this.Tree]">body</a> <span title="(f: ScratchPadMaker.this.Tree =&gt; Any)Unit">foreach</span> <a href="#450516" title="(stat: ScratchPadMaker.this.Tree)Any">traverseStat</a>
        <a href="#450512" title="(offset: Int)Unit">applyPendingPatches</a><span class="delimiter">(</span><a href="#450503" title="=&gt; Int">skipped</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
    <span class="delimiter">}</span>

    /** The patched text.
     *  @require  traverse is run first
     */
    <span class="keyword">def</span> <a title="=&gt; Array[Char]" id="450518">result</a>: <span title="Array[Char]">Array</span><span class="delimiter">[</span>Char<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Int" id="451119">reslen</a> = <a href="#450534" title="Array[Char]">contents</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">+</span> <span class="delimiter">(</span><a href="#450498" title="=&gt; scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch]">patches</a> <span title="(f: ScratchPadMaker.this.Patch =&gt; Int)(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ArrayBuffer[ScratchPadMaker.this.Patch],Int,scala.collection.mutable.ArrayBuffer[Int]])scala.collection.mutable.ArrayBuffer[Int]">map</span> <span class="delimiter">(</span><a href="#451144" title="ScratchPadMaker.this.Patch">_</a>.<a href="#450580" title="=&gt; String">text</a>.<span title="()Int">length</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(implicit num: Numeric[Int])Int">sum</span>
      <span class="keyword">val</span> <a title="Array[Char]" id="451120">res</a> = <span title="object Array">Array</span>.<span title="[T](n1: Int)(implicit evidence$3: scala.reflect.ClassManifest[T])Array[T]">ofDim</span><span title="(n1: Int)(implicit evidence$3: scala.reflect.ClassManifest[Char])Array[Char]" class="delimiter">[</span><span title="Char">Char</span><span class="delimiter">]</span><span title="=&gt; scala.reflect.AnyValManifest[Char]" class="delimiter">(</span><a href="#451119" title="Int">reslen</a><span class="delimiter">)</span>
      <span class="keyword">var</span> <a title="Int" id="451121">lastOffset</a> = <span title="Int(0)" class="int">0</span>
      <span class="keyword">var</span> <a title="Int" id="451122">from</a> = <span title="Int(0)" class="int">0</span>
      <span class="keyword">var</span> <a title="Int" id="451123">to</a> = <span title="Int(0)" class="int">0</span>
      <span class="keyword">for</span> <span class="delimiter">(</span>Patch<span class="delimiter">(</span><a title="Int" id="451450">offset</a>, <a title="String" id="451451">text</a><span class="delimiter">)</span> &lt;- <a href="#450498" title="(f: ScratchPadMaker.this.Patch =&gt; Unit)Unit">patches</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Int" id="451452">delta</a> = <a href="#451450" title="Int">offset</a> <span title="(x: Int)Int">-</span> <a href="#451121" title="Int">lastOffset</a>
        <a href="../Global.scala.html#186184" title="(assertion: Boolean)Unit">assert</a><span class="delimiter">(</span><a href="#451452" title="Int">delta</a> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
        <span title="object Array">Array</span>.<span title="(src: AnyRef, srcPos: Int, dest: AnyRef, destPos: Int, length: Int)Unit">copy</span><span class="delimiter">(</span><a href="#450534" title="Array[Char]">contents</a>, <a href="#451122" title="Int">from</a>, <a href="#451120" title="Array[Char]">res</a>, <a href="#451123" title="Int">to</a>, <a href="#451452" title="Int">delta</a><span class="delimiter">)</span>
        <a href="#451122" title="Int">from</a> <span title="(x: Int)Int">+=</span> <a href="#451452" title="Int">delta</a>
        <a href="#451123" title="Int">to</a> <span title="(x: Int)Int">+=</span> <a href="#451452" title="Int">delta</a>
        <a href="#451121" title="Int">lastOffset</a> = <a href="#451450" title="Int">offset</a>
        <a href="#451451" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">text</a>.<span title="(xs: Array[Char], start: Int)Unit">copyToArray</span><span class="delimiter">(</span><a href="#451120" title="Array[Char]">res</a>, <a href="#451123" title="Int">to</a><span class="delimiter">)</span>
        <a href="#451123" title="Int">to</a> <span title="(x: Int)Int">+=</span> <a href="#451451" title="String">text</a>.<span title="()Int">length</span>
      <span class="delimiter">}</span>
      <a href="../Global.scala.html#186184" title="(assertion: Boolean)Unit">assert</a><span class="delimiter">(</span><a href="#450534" title="Array[Char]">contents</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">-</span> <a href="#451122" title="Int">from</a> <span title="(x: Int)Boolean">==</span> <a href="#451119" title="Int">reslen</a> <span title="(x: Int)Int">-</span> <a href="#451123" title="Int">to</a><span class="delimiter">)</span>
      <span title="object Array">Array</span>.<span title="(src: AnyRef, srcPos: Int, dest: AnyRef, destPos: Int, length: Int)Unit">copy</span><span class="delimiter">(</span><a href="#450534" title="Array[Char]">contents</a>, <a href="#451122" title="Int">from</a>, <a href="#451120" title="Array[Char]">res</a>, <a href="#451123" title="Int">to</a>, <a href="#450534" title="Array[Char]">contents</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Int">-</span> <a href="#451122" title="Int">from</a><span class="delimiter">)</span>
      <a href="#451120" title="Array[Char]">res</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** Compute an instrumented version of a sourcefile.
   *  @param source  The given sourcefile.
   *  @param line    The line up to which results should be printed, -1 = whole document.
   *  @return        A pair consisting of
   *                  - the fully qualified name of the first top-level object definition in the file.
   *                    or &quot;&quot; if there are no object definitions.
   *                  - the text of the instrumented program which, when run,
   *                    prints its output and all defined values in a comment column.
   */
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(source: scala.tools.nsc.util.SourceFile, line: Int)(String, Array[Char])" id="254597">instrument</a><span class="delimiter">(</span><a title="scala.tools.nsc.util.SourceFile" id="441233">source</a>: <a href="../util/SourceFile.scala.html#33202" title="scala.tools.nsc.util.SourceFile">SourceFile</a>, <a title="Int" id="441234">line</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="(String, Array[Char])" class="delimiter">(</span>String, Array<span class="delimiter">[</span>Char<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="ScratchPadMaker.this.Tree" id="454162">tree</a> = <a href="Global.scala.html#254440" title="(source: scala.tools.nsc.util.SourceFile, forceReload: Boolean)ScratchPadMaker.this.Tree">typedTree</a><span class="delimiter">(</span><a href="#441233" title="scala.tools.nsc.util.SourceFile">source</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Int" id="454163">endOffset</a> = <span title="Int" class="keyword">if</span> <span class="delimiter">(</span><a href="#441234" title="Int">line</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#441233" title="scala.tools.nsc.util.SourceFile">source</a>.<a href="../util/SourceFile.scala.html#188731" title="=&gt; Int">length</a> <span class="keyword">else</span> <a href="#441233" title="scala.tools.nsc.util.SourceFile">source</a>.<a href="../util/SourceFile.scala.html#188735" title="(index: Int)Int">lineToOffset</a><span class="delimiter">(</span><a href="#441234" title="Int">line</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="ScratchPadMaker.this.Patcher" id="454164">patcher</a> = <span title="ScratchPadMaker.this.Patcher" class="keyword">new</span> <a href="#254596" title="ScratchPadMaker.this.Patcher">Patcher</a><span class="delimiter">(</span><a href="#441233" title="scala.tools.nsc.util.SourceFile">source</a>.<a href="../util/SourceFile.scala.html#188727" title="=&gt; Array[Char]">content</a>, <a href="#454163" title="Int">endOffset</a><span class="delimiter">)</span>
    <a href="#454164" title="ScratchPadMaker.this.Patcher">patcher</a>.<a href="#450517" title="(tree: ScratchPadMaker.this.Tree)Unit">traverse</a><span class="delimiter">(</span><a href="#454162" title="ScratchPadMaker.this.Tree">tree</a><span class="delimiter">)</span>
    <span title="(_1: String, _2: Array[Char])(String, Array[Char])" class="delimiter">(</span><a href="#454164" title="ScratchPadMaker.this.Patcher">patcher</a>.<a href="#450496" title="=&gt; String">objectName</a>, <a href="#454164" title="ScratchPadMaker.this.Patcher">patcher</a>.<a href="#450518" title="=&gt; Array[Char]">result</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
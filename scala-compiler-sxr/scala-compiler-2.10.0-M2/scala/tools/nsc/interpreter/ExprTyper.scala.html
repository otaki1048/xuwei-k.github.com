<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/interpreter/ExprTyper.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
/* NSC -- new Scala compiler
 * Copyright 2005-2011 LAMP/EPFL
 * @author  Paul Phillips
 */

<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> interpreter

<span class="keyword">import</span> util.BatchSourceFile
<span class="keyword">import</span> scala.tools.nsc.ast.parser.<a href="../ast/parser/Tokens.scala.html#14555" title="object scala.tools.nsc.ast.parser.Tokens">Tokens</a>.EOF

<span class="keyword">trait</span> <a title="trait ExprTyper extends Object with ScalaObject" id="21557">ExprTyper</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">val</span> <a title="=&gt; scala.tools.nsc.interpreter.IMain" id="467843">repl</a>: <a href="IMain.scala.html#23492" title="scala.tools.nsc.interpreter.IMain">IMain</a>

  <span class="keyword">import</span> <a href="#467843" title="=&gt; scala.tools.nsc.interpreter.IMain">repl</a>._
  <span class="keyword">import</span> <a href="IMain.scala.html#253571" title="object ExprTyper.this.repl.replTokens">replTokens</a>.<span class="delimiter">{</span> Tokenizer <span class="delimiter">}</span>
  <span class="keyword">import</span> <a href="IMain.scala.html#253465" title="=&gt; scala.tools.nsc.Global">global</a>.<span class="delimiter">{</span> reporter =&gt; _, Import =&gt; _, _ <span class="delimiter">}</span>
  <span class="keyword">import</span> <a href="../../../reflect/internal/Definitions.scala.html#39224" title="object ExprTyper.this.repl.global.definitions">definitions</a>._
  <span class="keyword">import</span> <a href="../Global.scala.html#186229" title="object ExprTyper.this.repl.global.syntaxAnalyzer">syntaxAnalyzer</a>.<span class="delimiter">{</span> UnitParser, UnitScanner, token2name <span class="delimiter">}</span>
  <span class="keyword">import</span> <a href="IMain.scala.html#253474" title="object ExprTyper.this.repl.naming">naming</a>.freshInternalVarName

  <span class="keyword">object</span> <a title="object ExprTyper.this.codeParser" id="467850">codeParser</a> <span title="ScalaObject" class="keyword">extends</span> <span class="delimiter">{</span> <span class="keyword">val</span> <a title="ExprTyper.this.repl.global.type" id="468053">global</a>: repl.global.<span class="keyword">type</span> = <a href="#467843" title="=&gt; scala.tools.nsc.interpreter.IMain">repl</a>.<a href="IMain.scala.html#253465" title="=&gt; scala.tools.nsc.Global">global</a> <span class="delimiter">}</span> <span class="keyword">with</span> <a href="CodeHandlers.scala.html#23390" title="scala.tools.nsc.interpreter.CodeHandlers[ExprTyper.this.repl.global.Tree]">CodeHandlers</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="[T](code: String, rule: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; T)T" id="468039">applyRule</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="468041">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="String" id="468054">code</a>: <span title="String">String</span>, <a title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; T" id="468055">rule</a>: UnitParser =&gt; T<span class="delimiter">)</span>: <a href="#468041" title="T">T</a> = <span class="delimiter">{</span>
      <a href="IMain.scala.html#253455" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/AbstractReporter.scala.html#191836" title="()Unit">reset</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="ExprTyper.this.repl.global.CompilationUnit" id="468059">unit</a>    = <span title="ExprTyper.this.repl.global.CompilationUnit" class="keyword">new</span> <a href="../CompilationUnits.scala.html#186387" title="ExprTyper.this.repl.global.CompilationUnit">CompilationUnit</a><span class="delimiter">(</span><a href="../util/SourceFile.scala.html#232462" title="(sourceName: String, cs: Seq[Char])scala.tools.nsc.util.BatchSourceFile" class="keyword">new</a> <a href="../util/SourceFile.scala.html#33118" title="scala.tools.nsc.util.BatchSourceFile">BatchSourceFile</a><span class="delimiter">(</span><span title="String(&quot;&lt;console&gt;&quot;)" class="string">&quot;&lt;console&gt;&quot;</span>, <a href="#468054" title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString">code</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser" id="468060">scanner</a> = <a href="../ast/parser/Parsers.scala.html#295156" title="(unit: ExprTyper.this.repl.global.syntaxAnalyzer.global.CompilationUnit)ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser" class="keyword">new</a> <a href="../ast/parser/Parsers.scala.html#232037" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">UnitParser</a><span class="delimiter">(</span><a href="#468059" title="ExprTyper.this.repl.global.CompilationUnit">unit</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="T" id="468061">result</a>  = <a href="#468055" title="(v1: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser)T">rule</a><span class="delimiter">(</span><a href="#468060" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">scanner</a><span class="delimiter">)</span>

      <span title="AnyVal" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="IMain.scala.html#253455" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#186104" title="=&gt; Boolean">hasErrors</a><span class="delimiter">)</span>
        <a href="#468060" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">scanner</a>.<a href="../ast/parser/Parsers.scala.html#292638" title="(token: Int)Int">accept</a><span class="delimiter">(</span><span title="Int(0)">EOF</span><span class="delimiter">)</span>

      <a href="#468061" title="T">result</a>
    <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="(code: String)Iterator[ExprTyper.this.repl.replTokens.ReplToken]" id="468042">tokens</a><span class="delimiter">(</span><a title="String" id="468094">code</a>: <span title="String">String</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="IMain.scala.html#253455" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/AbstractReporter.scala.html#191836" title="()Unit">reset</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="ExprTyper.this.repl.global.CompilationUnit" id="468097">unit</a> = <span title="ExprTyper.this.repl.global.CompilationUnit" class="keyword">new</span> <a href="../CompilationUnits.scala.html#186387" title="ExprTyper.this.repl.global.CompilationUnit">CompilationUnit</a><span class="delimiter">(</span><a href="../util/SourceFile.scala.html#232462" title="(sourceName: String, cs: Seq[Char])scala.tools.nsc.util.BatchSourceFile" class="keyword">new</a> <a href="../util/SourceFile.scala.html#33118" title="scala.tools.nsc.util.BatchSourceFile">BatchSourceFile</a><span class="delimiter">(</span><span title="String(&quot;&lt;tokens&gt;&quot;)" class="string">&quot;&lt;tokens&gt;&quot;</span>, <a href="#468094" title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString">code</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitScanner" id="468098">in</a>   = <a href="../ast/parser/Scanners.scala.html#232399" title="(unit: ExprTyper.this.repl.global.syntaxAnalyzer.global.CompilationUnit)ExprTyper.this.repl.global.syntaxAnalyzer.UnitScanner" class="keyword">new</a> <a href="../ast/parser/Scanners.scala.html#232026" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitScanner">UnitScanner</a><span class="delimiter">(</span><a href="#468097" title="ExprTyper.this.repl.global.CompilationUnit">unit</a><span class="delimiter">)</span>
      <a href="#468098" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitScanner">in</a>.<a href="../ast/parser/Scanners.scala.html#232381" title="()Unit">init</a><span class="delimiter">(</span><span class="delimiter">)</span>

      <span title="ExprTyper.this.repl.replTokens.Tokenizer" class="keyword">new</span> <a href="ReplTokens.scala.html#468025" title="ExprTyper.this.repl.replTokens.Tokenizer">Tokenizer</a><span class="delimiter">(</span><a href="#468098" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitScanner">in</a><span class="delimiter">)</span> <a href="ReplTokens.scala.html#468124" title="=&gt; Iterator[ExprTyper.this.repl.replTokens.ReplToken]">tokenIterator</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(code: String)Nothing" id="468043">decl</a><span class="delimiter">(</span><a title="String" id="468129">code</a>: <span title="String">String</span><span class="delimiter">)</span>  = <a href="CodeHandlers.scala.html#23391" title="object scala.tools.nsc.interpreter.CodeHandlers">CodeHandlers</a>.<a href="CodeHandlers.scala.html#464106" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="String(&quot;todo&quot;)" class="string">&quot;todo&quot;</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)Nothing" id="468044">defn</a><span class="delimiter">(</span><a title="String" id="468132">code</a>: <span title="String">String</span><span class="delimiter">)</span>  = <a href="CodeHandlers.scala.html#23391" title="object scala.tools.nsc.interpreter.CodeHandlers">CodeHandlers</a>.<a href="CodeHandlers.scala.html#464106" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="String(&quot;todo&quot;)" class="string">&quot;todo&quot;</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree" id="468045">expr</a><span class="delimiter">(</span><a title="String" id="468135">code</a>: <span title="String">String</span><span class="delimiter">)</span>  = <a href="#468039" title="(code: String, rule: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree)ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">applyRule</a><span class="delimiter">(</span><a href="#468135" title="String">code</a>, <a href="#468142" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">_</a>.<a href="../ast/parser/Parsers.scala.html#292729" title="()ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">expr</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree" id="468046">impt</a><span class="delimiter">(</span><a title="String" id="468147">code</a>: <span title="String">String</span><span class="delimiter">)</span>  = <a href="#468039" title="(code: String, rule: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree)ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">applyRule</a><span class="delimiter">(</span><a href="#468147" title="String">code</a>, <a href="#468154" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">_</a>.<a href="../ast/parser/Parsers.scala.html#292784" title="()ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">importExpr</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]" id="468047">impts</a><span class="delimiter">(</span><a title="String" id="468157">code</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#468039" title="(code: String, rule: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree])List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">applyRule</a><span class="delimiter">(</span><a href="#468157" title="String">code</a>, <a href="#468164" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">_</a>.<a href="../ast/parser/Parsers.scala.html#292783" title="()List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">importClause</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]" id="468048">stmts</a><span class="delimiter">(</span><a title="String" id="468167">code</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#468039" title="(code: String, rule: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree])List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">applyRule</a><span class="delimiter">(</span><a href="#468167" title="String">code</a>, <a href="#468174" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">_</a>.<a href="../ast/parser/Parsers.scala.html#292813" title="(isPre: Boolean)(ExprTyper.this.repl.global.syntaxAnalyzer.global.ValDef, List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree])">templateStatSeq</a><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>.<span title="=&gt; List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">_2</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)ExprTyper.this.repl.global.Tree" id="468049">stmt</a><span class="delimiter">(</span><a title="String" id="468178">code</a>: <span title="String">String</span><span class="delimiter">)</span>  = <a href="#468048" title="(code: String)List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">stmts</a><span class="delimiter">(</span><a href="#468178" title="String">code</a><span class="delimiter">)</span> <span title="ExprTyper.this.repl.global.Tree" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#468182" title="ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">List</a><span class="delimiter">(</span><a title="ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree" id="468204">t</a><span class="delimiter">)</span>  =&gt; <a href="#468204" title="ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">t</a>
      <span class="keyword">case</span> <a title="Nothing" id="468205">xs</a>       =&gt; <a href="CodeHandlers.scala.html#23391" title="object scala.tools.nsc.interpreter.CodeHandlers">CodeHandlers</a>.<a href="CodeHandlers.scala.html#464106" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="String(&quot;Not a single statement: &quot;)" class="string">&quot;Not a single statement: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#468205" title="List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">xs</a>.<span title="(sep: String)String">mkString</span><span class="delimiter">(</span><span title="String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  /** Parse a line into a sequence of trees. Returns None if the input is incomplete. */
  <span class="keyword">def</span> <a title="(line: String)Option[List[ExprTyper.this.repl.global.Tree]]" id="467852">parse</a><span class="delimiter">(</span><a title="String" id="468208">line</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[List[ExprTyper.this.repl.global.Tree]]">Option</span><span class="delimiter">[</span>List<span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Boolean" id="468210">isIncomplete</a> = <span title="Boolean(false)" class="keyword">false</span>
    <a href="IMain.scala.html#253455" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#186098" title="(handler: (scala.tools.nsc.util.Position, String) =&gt; Unit)(thunk: =&gt; Option[List[ExprTyper.this.repl.global.Tree]])Option[List[ExprTyper.this.repl.global.Tree]]">withIncompleteHandler</a><span class="delimiter">(</span><span class="delimiter">(</span><a title="scala.tools.nsc.util.Position" id="468222">_</a>, <a title="String" id="468223">_</a><span class="delimiter">)</span> =&gt; <a href="#468210" title="Boolean">isIncomplete</a> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]" id="468225">trees</a> = <a href="#467850" title="object ExprTyper.this.codeParser">codeParser</a>.<a href="#468048" title="(code: String)List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">stmts</a><span class="delimiter">(</span><a href="#468208" title="String">line</a><span class="delimiter">)</span>
      <span title="Option[List[ExprTyper.this.repl.global.Tree]]" class="keyword">if</span> <span class="delimiter">(</span><a href="IMain.scala.html#253455" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#186104" title="=&gt; Boolean">hasErrors</a><span class="delimiter">)</span> <span title="(x: scala.collection.immutable.Nil.type)Some[scala.collection.immutable.Nil.type]">Some</span><span class="delimiter">(</span><span title="object Nil">Nil</span><span class="delimiter">)</span>
      <span class="keyword">else</span> <span title="Option[List[ExprTyper.this.repl.global.Tree]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#468210" title="Boolean">isIncomplete</a><span class="delimiter">)</span> <span title="object None">None</span>
      <span class="keyword">else</span> <span title="(x: List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree])Some[List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]]">Some</span><span class="delimiter">(</span><a href="#468225" title="List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">trees</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  <span class="keyword">def</span> <a title="(line: String)Iterator[ExprTyper.this.repl.replTokens.ReplToken]" id="467853">tokens</a><span class="delimiter">(</span><a title="String" id="468234">line</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="IMain.scala.html#253486" title="(body: =&gt; Iterator[ExprTyper.this.repl.replTokens.ReplToken])Iterator[ExprTyper.this.repl.replTokens.ReplToken]">beQuietDuring</a><span class="delimiter">(</span><a href="#467850" title="object ExprTyper.this.codeParser">codeParser</a>.<a href="#468042" title="(code: String)Iterator[ExprTyper.this.repl.replTokens.ReplToken]">tokens</a><span class="delimiter">(</span><a href="#468234" title="String">line</a><span class="delimiter">)</span><span class="delimiter">)</span>

  // TODO: integrate these into a CodeHandler[Type].

  // XXX literals.
  // 1) Identifiers defined in the repl.
  // 2) A path loadable via getModule.
  // 3) Try interpreting it as an expression.
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="467855">typeOfExpressionDepth</a> = <span title="Int(0)" class="int">0</span>
  <span class="keyword">def</span> <a title="(expr: String, silent: Boolean)ExprTyper.this.repl.global.Type" id="467857">typeOfExpression</a><span class="delimiter">(</span><a title="String" id="468243">expr</a>: <span title="String">String</span>, <a title="Boolean" id="468246">silent</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#38813" title="ExprTyper.this.repl.global.Type">Type</a> = <span class="delimiter">{</span>
    <a href="ReplConfig.scala.html#34779" title="(msg: =&gt; String)Unit">repltrace</a><span class="delimiter">(</span><span title="String(&quot;typeOfExpression(&quot;)" class="string">&quot;typeOfExpression(&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#468243" title="String">expr</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;)&quot;)" class="string">&quot;)&quot;</span><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#467855" title="=&gt; Int">typeOfExpressionDepth</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="ReplConfig.scala.html#34778" title="(msg: =&gt; String)Unit">repldbg</a><span class="delimiter">(</span><span title="String(&quot;Terminating typeOfExpression recursion for expression: &quot;)" class="string">&quot;Terminating typeOfExpression recursion for expression: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#468243" title="String">expr</a><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <a href="../../../reflect/internal/Types.scala.html#38827" title="object ExprTyper.this.repl.global.NoType">NoType</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="=&gt; ExprTyper.this.repl.global.Type" id="468247">asQualifiedImport</a>: <a href="../../../reflect/internal/Types.scala.html#38813" title="ExprTyper.this.repl.global.Type">Type</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="String" id="468273">name</a> = <a href="#468243" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">expr</a>.<span title="(p: Char =&gt; Boolean)String">takeWhile</span><span class="delimiter">(</span><a href="#468528" title="Char">_</a> <span title="(x: Char)Boolean">!=</span> <span title="Char('.')" class="char">'.'</span><span class="delimiter">)</span>
      <a href="#467857" title="(expr: String, silent: Boolean)ExprTyper.this.repl.global.Type">typeOfExpression</a><span class="delimiter">(</span><a href="Imports.scala.html#253394" title="(name: String)ExprTyper.this.repl.global.Symbol">importedTermNamed</a><span class="delimiter">(</span><a href="#468273" title="String">name</a><span class="delimiter">)</span>.<a href="../../../reflect/internal/Symbols.scala.html#46585" title="=&gt; String">fullName</a> <span title="(x$1: Any)String">+</span> <a href="#468243" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">expr</a>.<span title="(n: Int)String">drop</span><span class="delimiter">(</span><a href="#468273" title="String">name</a>.<span title="()Int">length</span><span class="delimiter">)</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="=&gt; ExprTyper.this.repl.global.Type" id="468248">asModule</a>: <a href="../../../reflect/internal/Types.scala.html#38813" title="ExprTyper.this.repl.global.Type">Type</a> = <a href="../../../reflect/internal/Definitions.scala.html#45451" title="(fullname: String)ExprTyper.this.repl.global.Symbol">getModuleIfDefined</a><span class="delimiter">(</span><a href="#468243" title="String">expr</a><span class="delimiter">)</span>.<a href="../../../reflect/internal/Symbols.scala.html#46606" title="=&gt; ExprTyper.this.repl.global.Type">tpe</a>
    <span class="keyword">def</span> <a title="=&gt; ExprTyper.this.repl.global.Type" id="468249">asExpr</a>: <a href="../../../reflect/internal/Types.scala.html#38813" title="ExprTyper.this.repl.global.Type">Type</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="String" id="468664">lhs</a> = <a href="Naming.scala.html#467884" title="()String">freshInternalVarName</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="String" id="468665">line</a> = <span title="String(&quot;lazy val &quot;)" class="string">&quot;lazy val &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#468664" title="String">lhs</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; =\n&quot;)" class="string">&quot; =\n&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#468243" title="String">expr</a>

      <a href="IMain.scala.html#253538" title="(line: String, synthetic: Boolean)scala.tools.nsc.interpreter.IR.Result">interpret</a><span class="delimiter">(</span><a href="#468665" title="String">line</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <span title="ExprTyper.this.repl.global.Type" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="package.scala.html#34805" title="ExprTyper.this.repl.global.Type">IR</a>.<a href="Results.scala.html#468710" title="object scala.tools.nsc.interpreter.IR.Success">Success</a> =&gt; <a href="#467857" title="(expr: String, silent: Boolean)ExprTyper.this.repl.global.Type">typeOfExpression</a><span class="delimiter">(</span><a href="#468664" title="String">lhs</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="ExprTyper.this.repl.global.NoType.type">_</span>          =&gt; <a href="../../../reflect/internal/Types.scala.html#38827" title="object ExprTyper.this.repl.global.NoType">NoType</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    
    <span class="keyword">def</span> <a title="()ExprTyper.this.repl.global.Type" id="468250">evaluate</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#38813" title="ExprTyper.this.repl.global.Type">Type</a> = <span class="delimiter">{</span>
      <a href="#467855" title="(x$1: Int)Unit">typeOfExpressionDepth</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
      <span class="keyword">try</span> <a href="IMain.scala.html#253567" title="(id: String)ExprTyper.this.repl.global.Type">typeOfTerm</a><a href="IMain.scala.html#253472" title="implicit scala.tools.nsc.interpreter.IMain.installReplTypeOps : (tp: ExprTyper.this.repl.global.Type)ExprTyper.this.repl.ReplTypeOps" class="delimiter">(</a><a href="#468243" title="String">expr</a><span class="delimiter">)</span> <a href="IMain.scala.html#253472" title="implicit scala.tools.nsc.interpreter.IMain.installReplTypeOps : (tp: ExprTyper.this.repl.global.Type)ExprTyper.this.repl.ReplTypeOps">orElse</a> <a href="#468248" title="=&gt; ExprTyper.this.repl.global.Type">asModule</a> <a href="IMain.scala.html#253472" title="implicit scala.tools.nsc.interpreter.IMain.installReplTypeOps : (tp: ExprTyper.this.repl.global.Type)ExprTyper.this.repl.ReplTypeOps">orElse</a> <a href="#468249" title="=&gt; ExprTyper.this.repl.global.Type">asExpr</a> <a href="IMain.scala.html#468277" title="(other: =&gt; ExprTyper.this.repl.global.Type)ExprTyper.this.repl.global.Type">orElse</a> <a href="#468247" title="=&gt; ExprTyper.this.repl.global.Type">asQualifiedImport</a>
      <span class="keyword">finally</span> <a href="#467855" title="(x$1: Int)Unit">typeOfExpressionDepth</a> <span title="(x: Int)Int">-=</span> <span title="Int(1)" class="int">1</span>
    <span class="delimiter">}</span>

    // Don't presently have a good way to suppress undesirable success output
    // while letting errors through, so it is first trying it silently: if there
    // is an error, and errors are desired, then it re-evaluates non-silently
    // to induce the error message.
    <a href="IMain.scala.html#253489" title="(operation: =&gt; ExprTyper.this.repl.global.Type)ExprTyper.this.repl.global.Type">beSilentDuring</a><a href="IMain.scala.html#253472" title="implicit scala.tools.nsc.interpreter.IMain.installReplTypeOps : (tp: ExprTyper.this.repl.global.Type)ExprTyper.this.repl.ReplTypeOps" class="delimiter">(</a><a href="#468250" title="()ExprTyper.this.repl.global.Type">evaluate</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="IMain.scala.html#253472" title="implicit scala.tools.nsc.interpreter.IMain.installReplTypeOps : (tp: ExprTyper.this.repl.global.Type)ExprTyper.this.repl.ReplTypeOps">orElse</a> <a href="IMain.scala.html#253489" title="(operation: =&gt; ExprTyper.this.repl.global.Type)ExprTyper.this.repl.global.Type">beSilentDuring</a><span class="delimiter">(</span><a href="#467858" title="(code: String)ExprTyper.this.repl.global.Type">typeOfDeclaration</a><span class="delimiter">(</span><a href="#468243" title="String">expr</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="IMain.scala.html#468277" title="(other: =&gt; ExprTyper.this.repl.global.Type)ExprTyper.this.repl.global.Type">orElse</a> <span class="delimiter">{</span>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#468246" title="Boolean">silent</a><span class="delimiter">)</span>
        <a href="#468250" title="()ExprTyper.this.repl.global.Type">evaluate</a><span class="delimiter">(</span><span class="delimiter">)</span>

      <a href="../../../reflect/internal/Types.scala.html#38827" title="object ExprTyper.this.repl.global.NoType">NoType</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  // Since people will be giving us &quot;:t def foo = 5&quot; even though that is not an
  // expression, we have a means of typing declarations too.
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(code: String)ExprTyper.this.repl.global.Type" id="467858">typeOfDeclaration</a><span class="delimiter">(</span><a title="String" id="468772">code</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../../../reflect/internal/Types.scala.html#38813" title="ExprTyper.this.repl.global.Type">Type</a> = <span class="delimiter">{</span>
    <a href="ReplConfig.scala.html#34779" title="(msg: =&gt; String)Unit">repltrace</a><span class="delimiter">(</span><span title="String(&quot;typeOfDeclaration(&quot;)" class="string">&quot;typeOfDeclaration(&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#468772" title="String">code</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;)&quot;)" class="string">&quot;)&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="String" id="468787">obname</a> = <a href="Naming.scala.html#467884" title="()String">freshInternalVarName</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <a href="IMain.scala.html#253538" title="(line: String, synthetic: Boolean)scala.tools.nsc.interpreter.IR.Result">interpret</a><span class="delimiter">(</span><span title="String(&quot;object &quot;)" class="string">&quot;object &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#468787" title="String">obname</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot; {\n&quot;)" class="string">&quot; {\n&quot;</span> <span title="(x$1: Any)String">+</span> <a href="#468772" title="String">code</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;\n}\n&quot;)" class="string">&quot;\n}\n&quot;</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <span title="ExprTyper.this.repl.global.Type" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="package.scala.html#34805" title="ExprTyper.this.repl.global.Type">IR</a>.<a href="Results.scala.html#468710" title="object scala.tools.nsc.interpreter.IR.Success">Success</a> =&gt;
        <span class="keyword">val</span> <a title="ExprTyper.this.repl.global.Symbol" id="468790">sym</a> = <a href="IMain.scala.html#253568" title="(id: String)ExprTyper.this.repl.global.Symbol">symbolOfTerm</a><span class="delimiter">(</span><a href="#468787" title="String">obname</a><span class="delimiter">)</span>
        <span title="ExprTyper.this.repl.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="#468790" title="ExprTyper.this.repl.global.Symbol">sym</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../../../reflect/internal/Symbols.scala.html#38740" title="=&gt; ExprTyper.this.repl.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <a href="../../../reflect/internal/Types.scala.html#38827" title="object ExprTyper.this.repl.global.NoType">NoType</a> <span class="keyword">else</span> <span class="delimiter">{</span>
          // TODO: bitmap$n is not marked synthetic.
          <span class="keyword">val</span> <a title="List[ExprTyper.this.repl.global.Symbol]" id="468797">decls</a> = <a href="#468790" title="ExprTyper.this.repl.global.Symbol">sym</a>.<a href="../../../reflect/internal/Symbols.scala.html#46606" title="=&gt; ExprTyper.this.repl.global.Type">tpe</a>.<a href="../../../reflect/internal/Types.scala.html#41536" title="=&gt; ExprTyper.this.repl.global.Scope">decls</a>.<a href="../../../reflect/internal/Scopes.scala.html#60510" title="=&gt; List[ExprTyper.this.repl.global.Symbol]">toList</a> <span title="(p: ExprTyper.this.repl.global.Symbol =&gt; Boolean)List[ExprTyper.this.repl.global.Symbol]">filterNot</span> <span class="delimiter">(</span><a title="ExprTyper.this.repl.global.Symbol" id="468810">x</a> =&gt; <a href="#468810" title="ExprTyper.this.repl.global.Symbol">x</a>.<a href="../../../reflect/internal/Symbols.scala.html#46492" title="=&gt; Boolean">isConstructor</a> <span title="(x: Boolean)Boolean">||</span> <a href="#468810" title="ExprTyper.this.repl.global.Symbol">x</a>.<a href="../../../reflect/internal/HasFlags.scala.html#46782" title="=&gt; Boolean">isPrivate</a> <span title="(x: Boolean)Boolean">||</span> <span class="delimiter">(</span><a href="#468810" title="ExprTyper.this.repl.global.Symbol">x</a>.<a href="../../../reflect/internal/Symbols.scala.html#46571" title="=&gt; ExprTyper.this.repl.global.Name">name</a>.<span title="()String">toString</span> <span title="(x$1: CharSequence)Boolean">contains</span> <span title="String(&quot;$&quot;)" class="string">&quot;$&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="ReplConfig.scala.html#34779" title="(msg: =&gt; String)Unit">repltrace</a><span class="delimiter">(</span><span title="String(&quot;decls: &quot;)" class="string">&quot;decls: &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#468797" title="List[ExprTyper.this.repl.global.Symbol]">decls</a><span class="delimiter">)</span>
          <span title="ExprTyper.this.repl.global.Type" class="keyword">if</span> <span class="delimiter">(</span><a href="#468797" title="List[ExprTyper.this.repl.global.Symbol]">decls</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="../../../reflect/internal/Types.scala.html#38827" title="object ExprTyper.this.repl.global.NoType">NoType</a>
          <span class="keyword">else</span> <a href="IMain.scala.html#253536" title="(sym: ExprTyper.this.repl.global.Symbol, memberName: ExprTyper.this.repl.global.Name)ExprTyper.this.repl.global.Type">typeCleanser</a><span class="delimiter">(</span><a href="#468790" title="ExprTyper.this.repl.global.Symbol">sym</a>, <a href="#468797" title="List[ExprTyper.this.repl.global.Symbol]">decls</a>.<span title="=&gt; ExprTyper.this.repl.global.Symbol">last</span>.<a href="../../../reflect/internal/Symbols.scala.html#46571" title="=&gt; ExprTyper.this.repl.global.Name">name</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="ExprTyper.this.repl.global.NoType.type">_</span>          =&gt;
        <a href="../../../reflect/internal/Types.scala.html#38827" title="object ExprTyper.this.repl.global.NoType">NoType</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  // def compileAndTypeExpr(expr: String): Option[Typer] = {
  //   class TyperRun extends Run {
  //     override def stopPhase(name: String) = name == &quot;superaccessors&quot;
  //   }
  // }
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/transform/LazyVals.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> transform

<span class="keyword">import</span> scala.collection.<span class="delimiter">{</span> mutable, immutable <span class="delimiter">}</span>

<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class LazyVals extends scala.tools.nsc.SubComponent with scala.tools.nsc.transform.Transform with scala.tools.nsc.transform.TypingTransformers with scala.tools.nsc.ast.TreeDSL with ScalaObject" id="37837">LazyVals</a> <a href="../../../ScalaObject.scala.html#464" title="ScalaObject" class="keyword">extends</a> <a href="Transform.scala.html#39274" title="scala.tools.nsc.transform.Transform">Transform</a> <span class="keyword">with</span> <a href="TypingTransformers.scala.html#39067" title="scala.tools.nsc.transform.TypingTransformers">TypingTransformers</a> <span class="keyword">with</span> ast.<a href="../ast/TreeDSL.scala.html#23679" title="scala.tools.nsc.ast.TreeDSL">TreeDSL</a> <span class="delimiter">{</span>
  <span class="comment">// inherits abstract value `global' and class `Phase' from Transform</span>

  <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#507538" title="=&gt; scala.tools.nsc.Global">global</a>._                  <span class="comment">// the global environment</span>
  <span class="keyword">import</span> <a href="../symtab/Definitions.scala.html#479030" title="object LazyVals.this.global.definitions">definitions</a>._             <span class="comment">// standard classes and methods</span>
  <span class="keyword">import</span> <a href="../Global.scala.html#478336" title="object LazyVals.this.global.typer">typer</a>.<span class="delimiter">{</span>typed, atOwner<span class="delimiter">}</span>    <span class="comment">// methods to type trees</span>
  <span class="keyword">import</span> <a href="../ast/TreeDSL.scala.html#507542" title="object LazyVals.this.CODE">CODE</a>._

  <span class="keyword">val</span> <a title="String" id="513162">phaseName</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;lazyvals&quot;)" class="string">&quot;lazyvals&quot;</span>
  <span class="keyword">val</span> <a title="=&gt; Int" id="513164">FLAGS_PER_WORD</a>: <a href="../../../Int.scala.html#386" title="Int">Int</a>

  <span class="keyword">def</span> <a title="(unit: LazyVals.this.global.CompilationUnit)LazyVals.this.global.Transformer" id="513165">newTransformer</a><span class="delimiter">(</span><a title="LazyVals.this.global.CompilationUnit" id="899047">unit</a>: <a href="../CompilationUnits.scala.html#479284" title="LazyVals.this.global.CompilationUnit">CompilationUnit</a><span class="delimiter">)</span>: <a href="../ast/Trees.scala.html#479167" title="LazyVals.this.global.Transformer">Transformer</a> =
    <span title="LazyVals.this.LazyValues" class="keyword">new</span> <a href="#513169" title="LazyVals.this.LazyValues">LazyValues</a><span class="delimiter">(</span><a href="#899047" title="LazyVals.this.global.CompilationUnit">unit</a><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(sym: LazyVals.this.global.Symbol)Boolean" id="513166">lazyUnit</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="899065">sym</a>: <a href="../symtab/Symbols.scala.html#478659" title="LazyVals.this.global.Symbol">Symbol</a><span class="delimiter">)</span> = <a href="#899065" title="LazyVals.this.global.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#509270" title="=&gt; LazyVals.this.global.Type">tpe</a>.<a href="../symtab/Types.scala.html#507173" title="=&gt; LazyVals.this.global.Type">resultType</a>.<a href="../symtab/Types.scala.html#507159" title="=&gt; LazyVals.this.global.Symbol">typeSymbol</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../symtab/Definitions.scala.html#508423" title="=&gt; LazyVals.this.global.Symbol">UnitClass</a>

  <span class="keyword">object</span> <a title="object LazyVals.this.LocalLazyValFinder" id="513167">LocalLazyValFinder</a> <a href="../../../ScalaObject.scala.html#464" title="ScalaObject" class="keyword">extends</a> <a href="../ast/Trees.scala.html#479168" title="LazyVals.this.global.Traverser">Traverser</a> <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Boolean" id="899079">result</a>: <a href="../../../Boolean.scala.html#65" title="Boolean">Boolean</a>  = _

    <span class="keyword">def</span> <a title="(t: LazyVals.this.global.Tree)Boolean" id="899081">find</a><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="899086">t</a>: <a href="../../../reflect/generic/Trees.scala.html#434028" title="LazyVals.this.global.Tree">Tree</a><span class="delimiter">)</span> = <span class="delimiter">{</span><a href="#899079" title="(x$1: Boolean)Unit">result</a> = <span title="Boolean(false)" class="keyword">false</span>; <a href="#899083" title="(t: LazyVals.this.global.Tree)Unit">traverse</a><span class="delimiter">(</span><a href="#899086" title="LazyVals.this.global.Tree">t</a><span class="delimiter">)</span>; <a href="#899079" title="=&gt; Boolean">result</a><span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="(ts: List[LazyVals.this.global.Tree])Boolean" id="899082">find</a><span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="899095">ts</a>: <a href="../../../collection/immutable/List.scala.html#14047" title="List[LazyVals.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span><a href="#899079" title="(x$1: Boolean)Unit">result</a> = <span title="Boolean(false)" class="keyword">false</span>; <a href="../../../reflect/generic/Trees.scala.html#443197" title="(trees: List[LazyVals.this.global.Tree])Unit">traverseTrees</a><span class="delimiter">(</span><a href="#899095" title="List[LazyVals.this.global.Tree]">ts</a><span class="delimiter">)</span>; <a href="#899079" title="=&gt; Boolean">result</a><span class="delimiter">}</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(t: LazyVals.this.global.Tree)Unit" id="899083">traverse</a><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="899089">t</a>: <a href="../../../reflect/generic/Trees.scala.html#434028" title="LazyVals.this.global.Tree">Tree</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#55576" title="=&gt; Boolean">!</a><a href="#899079" title="=&gt; Boolean">result</a><span class="delimiter">)</span>
        <a href="#899089" title="LazyVals.this.global.Tree">t</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <a title="Unit" id="899099">v</a>@ValDef<span class="delimiter">(</span>_, _, _, _<span class="delimiter">)</span> <span class="keyword">if</span> <a href="#899099" title="LazyVals.this.global.ValDef">v</a>.<a href="../../../reflect/generic/Trees.scala.html#441600" title="=&gt; LazyVals.this.global.Symbol">symbol</a>.<a href="../../../reflect/generic/HasFlags.scala.html#435299" title="=&gt; Boolean">isLazy</a> =&gt;
            <a href="#899079" title="(x$1: Boolean)Unit">result</a> = <span title="Boolean(true)" class="keyword">true</span>

          <span class="keyword">case</span> <a title="Unit" id="899109">d</a>@DefDef<span class="delimiter">(</span>_, _, _, _, _, _<span class="delimiter">)</span> <span class="keyword">if</span> <a href="#899109" title="LazyVals.this.global.DefDef">d</a>.<a href="../../../reflect/generic/Trees.scala.html#441600" title="=&gt; LazyVals.this.global.Symbol">symbol</a>.<a href="../../../reflect/generic/HasFlags.scala.html#435299" title="=&gt; Boolean">isLazy</a> <a href="../../../Boolean.scala.html#55580" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#513166" title="(sym: LazyVals.this.global.Symbol)Boolean">lazyUnit</a><span class="delimiter">(</span><a href="#899109" title="LazyVals.this.global.DefDef">d</a>.<a href="../../../reflect/generic/Trees.scala.html#441600" title="=&gt; LazyVals.this.global.Symbol">symbol</a><span class="delimiter">)</span> =&gt;
            <a href="#899109" title="LazyVals.this.global.DefDef">d</a>.<a href="../../../reflect/generic/Trees.scala.html#441600" title="=&gt; LazyVals.this.global.Symbol">symbol</a>.<a href="../symtab/Symbols.scala.html#509262" title="(mask: Long)LazyVals.this.global.Symbol">resetFlag</a><span class="delimiter">(</span>symtab.Flags.<span title="Long(2147483648L)">LAZY</span><span class="delimiter">)</span>
            <a href="#899079" title="(x$1: Boolean)Unit">result</a> = <span title="Boolean(true)" class="keyword">true</span>

          <span class="keyword">case</span> <span title="Unit">ClassDef</span><span class="delimiter">(</span>_, _, _, _<span class="delimiter">)</span> | DefDef<span class="delimiter">(</span>_, _, _, _, _, _<span class="delimiter">)</span> | ModuleDef<span class="delimiter">(</span>_, _, _<span class="delimiter">)</span> =&gt;

          <span class="keyword">case</span> <span title="Unit">LabelDef</span><span class="delimiter">(</span><a title="LazyVals.this.global.TermName" id="899171">name</a>, _, _<span class="delimiter">)</span> <span class="keyword">if</span> <a href="../symtab/StdNames.scala.html#479055" title="object LazyVals.this.global.nme">nme</a>.<a href="../symtab/NameManglers.scala.html#516877" title="(name: LazyVals.this.global.Name)Boolean">isLoopHeaderLabel</a><span class="delimiter">(</span><a href="#899171" title="LazyVals.this.global.TermName">name</a><span class="delimiter">)</span> =&gt;

          <span class="keyword">case</span> <span title="Unit">_</span> =&gt;
            <span class="keyword">super</span>.<a href="../ast/Trees.scala.html#560433" title="(tree: LazyVals.this.global.Tree)Unit">traverse</a><span class="delimiter">(</span><a href="#899089" title="LazyVals.this.global.Tree">t</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Transform local lazy accessors to check for the initialized bit.
   */</span>
  <span class="keyword">class</span> <a title="class LazyValues extends LazyVals.this.TypingTransformer with ScalaObject" id="513169">LazyValues</a><a href="../../../ScalaObject.scala.html#464" title="ScalaObject" class="delimiter">(</a><a title="LazyVals.this.global.CompilationUnit" id="899064">unit</a>: <a href="../CompilationUnits.scala.html#479284" title="LazyVals.this.global.CompilationUnit">CompilationUnit</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="TypingTransformers.scala.html#511840" title="LazyVals.this.TypingTransformer">TypingTransformer</a><span class="delimiter">(</span><a href="#899064" title="LazyVals.this.global.CompilationUnit">unit</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="comment">/** map from method symbols to the number of lazy values it defines. */</span>
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.Map[LazyVals.this.global.Symbol,Int]" id="899053">lazyVals</a> = <a href="../symtab/SymbolTable.scala.html#478192" title="object LazyVals.this.global.perRunCaches">perRunCaches</a>.<a href="../symtab/SymbolTable.scala.html#521645" title="[K, V]()scala.collection.mutable.HashMap[K,V]">newMap</a><span title="()scala.collection.mutable.HashMap[LazyVals.this.global.Symbol,Int]" class="delimiter">[</span><a href="../symtab/Symbols.scala.html#478659" title="LazyVals.this.global.Symbol">Symbol</a>, <a href="../../../Int.scala.html#386" title="Int">Int</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span> <a href="../../../collection/mutable/Map.scala.html#72699" title="(d: Int)scala.collection.mutable.Map[LazyVals.this.global.Symbol,Int]">withDefaultValue</a> <span title="Int(0)" class="int">0</span>

    <span class="keyword">import</span> symtab.<a href="../symtab/Flags.scala.html#36139" title="object scala.tools.nsc.symtab.Flags">Flags</a>._
    <span class="keyword">import</span> <a href="#899053" title="=&gt; scala.collection.mutable.Map[LazyVals.this.global.Symbol,Int]">lazyVals</a>._

    <span class="comment">/** Perform the following transformations:
     *  - for a lazy accessor inside a method, make it check the initialization bitmap
     *  - for all methods, add enough int vars to allow one flag per lazy local value
     *  - blocks in template bodies behave almost like methods. A single bitmaps section is
     *      added in the first block, for all lazy values defined in such blocks.
     *  - remove ACCESSOR flags: accessors in traits are not statically implemented,
     *    but moved to the host class. local lazy values should be statically implemented.
     */</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree" id="899057">transform</a><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="899181">tree</a>: <a href="../../../reflect/generic/Trees.scala.html#434028" title="LazyVals.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/generic/Trees.scala.html#434028" title="LazyVals.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="LazyVals.this.global.Symbol" id="899186">sym</a> = <a href="#899181" title="LazyVals.this.global.Tree">tree</a>.<a href="../../../reflect/generic/Trees.scala.html#441032" title="=&gt; LazyVals.this.global.Symbol">symbol</a>
      <a href="TypingTransformers.scala.html#893500" title="(x$1: LazyVals.this.global.Tree)Unit">curTree</a> = <a href="#899181" title="LazyVals.this.global.Tree">tree</a>

      <a href="#899181" title="LazyVals.this.global.Tree">tree</a> <span title="LazyVals.this.global.Tree" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="LazyVals.this.global.DefDef">DefDef</span><span class="delimiter">(</span><a title="LazyVals.this.global.Modifiers" id="899197">mods</a>, <a title="LazyVals.this.global.TermName" id="899198">name</a>, <a title="List[LazyVals.this.global.TypeDef]" id="899199">tparams</a>, <a title="List[List[LazyVals.this.global.ValDef]]" id="899200">vparams</a>, <a title="LazyVals.this.global.Tree" id="899201">tpt</a>, <a title="LazyVals.this.global.Tree" id="899202">rhs</a><span class="delimiter">)</span> =&gt; <a href="TypingTransformers.scala.html#893505" title="(owner: LazyVals.this.global.Symbol)(trans: =&gt; LazyVals.this.global.DefDef)LazyVals.this.global.DefDef">atOwner</a><span class="delimiter">(</span><a href="#899181" title="LazyVals.this.global.Tree">tree</a>.<a href="../../../reflect/generic/Trees.scala.html#441032" title="=&gt; LazyVals.this.global.Symbol">symbol</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="LazyVals.this.global.Tree" id="899222">res</a> = <span title="LazyVals.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#55576" title="=&gt; Boolean">!</a><a href="#899186" title="LazyVals.this.global.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#509249" title="=&gt; LazyVals.this.global.Symbol">owner</a>.<a href="../../../reflect/generic/Symbols.scala.html#435371" title="=&gt; Boolean">isClass</a> <a href="../../../Boolean.scala.html#55580" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#899186" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/generic/HasFlags.scala.html#435299" title="=&gt; Boolean">isLazy</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="LazyVals.this.global.Symbol" id="899223">enclosingClassOrDummyOrMethod</a> = <span class="delimiter">{</span>
              <span class="keyword">val</span> <a title="LazyVals.this.global.Symbol" id="899226">enclMethod</a> = <a href="#899186" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/generic/Symbols.scala.html#435410" title="=&gt; LazyVals.this.global.Symbol">enclMethod</a>

              <span title="LazyVals.this.global.Symbol" class="keyword">if</span> <span class="delimiter">(</span><a href="#899226" title="LazyVals.this.global.Symbol">enclMethod</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../symtab/Symbols.scala.html#478667" title="object LazyVals.this.global.NoSymbol">NoSymbol</a> <span class="delimiter">)</span> <span class="delimiter">{</span>
                <span class="keyword">val</span> <a title="LazyVals.this.global.Symbol" id="899231">enclClass</a> = <a href="#899186" title="LazyVals.this.global.Symbol">sym</a>.<a href="../../../reflect/generic/Symbols.scala.html#435409" title="=&gt; LazyVals.this.global.Symbol">enclClass</a>
                <span title="LazyVals.this.global.Symbol" class="keyword">if</span> <span class="delimiter">(</span><a href="#899231" title="LazyVals.this.global.Symbol">enclClass</a> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../symtab/Symbols.scala.html#478667" title="object LazyVals.this.global.NoSymbol">NoSymbol</a> <a href="../../../Boolean.scala.html#55580" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#899226" title="LazyVals.this.global.Symbol">enclMethod</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#899231" title="LazyVals.this.global.Symbol">enclClass</a>.<a href="../../../reflect/generic/Symbols.scala.html#435410" title="=&gt; LazyVals.this.global.Symbol">enclMethod</a><span class="delimiter">)</span>
                  <a href="#899231" title="LazyVals.this.global.Symbol">enclClass</a>
                <span class="keyword">else</span>
                  <a href="#899226" title="LazyVals.this.global.Symbol">enclMethod</a>
              <span class="delimiter">}</span> <span class="keyword">else</span>
                <a href="#899186" title="LazyVals.this.global.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#509249" title="=&gt; LazyVals.this.global.Symbol">owner</a>
            <span class="delimiter">}</span>
            <span class="keyword">val</span> <a title="Int" id="899224">idx</a> = <a href="../../../collection/MapLike.scala.html#73204" title="(key: LazyVals.this.global.Symbol)Int">lazyVals</a><span class="delimiter">(</span><a href="#899223" title="LazyVals.this.global.Symbol">enclosingClassOrDummyOrMethod</a><span class="delimiter">)</span>
            <a href="../../../collection/mutable/MapLike.scala.html#73272" title="(key: LazyVals.this.global.Symbol, value: Int)Unit">lazyVals</a><span class="delimiter">(</span><a href="#899223" title="LazyVals.this.global.Symbol">enclosingClassOrDummyOrMethod</a><span class="delimiter">)</span> = <a href="#899224" title="Int">idx</a> <a href="../../../Int.scala.html#54804" title="(x: Int)Int">+</a> <span title="Int(1)" class="int">1</span>
            <span class="keyword">val</span> <a title="LazyVals.this.global.Tree" id="899225">rhs1</a> = <a href="#899059" title="(methOrClass: LazyVals.this.global.Symbol, tree: LazyVals.this.global.Tree, offset: Int, lazyVal: LazyVals.this.global.Symbol)LazyVals.this.global.Tree">mkLazyDef</a><span class="delimiter">(</span><a href="#899223" title="LazyVals.this.global.Symbol">enclosingClassOrDummyOrMethod</a>, <a href="#513169" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="TypingTransformers.scala.html#893511" title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#899202" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span>, <a href="#899224" title="Int">idx</a>, <a href="#899186" title="LazyVals.this.global.Symbol">sym</a><span class="delimiter">)</span>
            <a href="#899186" title="LazyVals.this.global.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#509262" title="(mask: Long)sym.type">resetFlag</a><span class="delimiter">(</span><span class="delimiter">(</span><span title="Long" class="keyword">if</span> <span class="delimiter">(</span><a href="#513166" title="(sym: LazyVals.this.global.Symbol)Boolean">lazyUnit</a><span class="delimiter">(</span><a href="#899186" title="LazyVals.this.global.Symbol">sym</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="Long(0L)" class="int">0</span> <span class="keyword">else</span> <span title="Long(2147483648L)">LAZY</span><span class="delimiter">)</span> <a href="../../../Long.scala.html#55154" title="(x: Int)Long">|</a> <span title="Int(134217728)">ACCESSOR</span><span class="delimiter">)</span>
            <a href="#899225" title="LazyVals.this.global.Tree">rhs1</a>
          <span class="delimiter">}</span> <span class="keyword">else</span>
            <a href="#513169" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="TypingTransformers.scala.html#893511" title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#899202" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span>

          <a href="../ast/Trees.scala.html#560331" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<a href="../ast/Trees.scala.html#560236" title="(tree: LazyVals.this.global.Tree, mods: LazyVals.this.global.Modifiers, name: LazyVals.this.global.Name, tparams: List[LazyVals.this.global.TypeDef], vparamss: List[List[LazyVals.this.global.ValDef]], tpt: LazyVals.this.global.Tree, rhs: LazyVals.this.global.Tree)LazyVals.this.global.DefDef">DefDef</a><span class="delimiter">(</span><a href="#899181" title="LazyVals.this.global.Tree">tree</a>, <a href="#899197" title="LazyVals.this.global.Modifiers">mods</a>, <a href="#899198" title="LazyVals.this.global.TermName">name</a>, <a href="#899199" title="List[LazyVals.this.global.TypeDef]">tparams</a>, <a href="#899200" title="List[List[LazyVals.this.global.ValDef]]">vparams</a>, <a href="#899201" title="LazyVals.this.global.Tree">tpt</a>,
                  <span title="LazyVals.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#513167" title="object LazyVals.this.LocalLazyValFinder">LocalLazyValFinder</a>.<a href="#899081" title="(t: LazyVals.this.global.Tree)Boolean">find</a><span class="delimiter">(</span><a href="#899222" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../typechecker/Typers.scala.html#507768" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#899058" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#899186" title="LazyVals.this.global.Symbol">sym</a>, <a href="#899222" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#899222" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span class="keyword">case</span> <span title="LazyVals.this.global.Template">Template</span><span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="899330">parents</a>, <a title="LazyVals.this.global.ValDef" id="899331">self</a>, <a title="List[LazyVals.this.global.Tree]" id="899332">body</a><span class="delimiter">)</span> =&gt; <a href="TypingTransformers.scala.html#893505" title="(owner: LazyVals.this.global.Symbol)(trans: =&gt; LazyVals.this.global.Template)LazyVals.this.global.Template">atOwner</a><span class="delimiter">(</span><a href="../ast/Trees.scala.html#560333" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="List[LazyVals.this.global.Tree]" id="899348">body1</a> = <a href="#513169" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="../ast/Trees.scala.html#560340" title="(trees: List[LazyVals.this.global.Tree])List[LazyVals.this.global.Tree]">transformTrees</a><span class="delimiter">(</span><a href="#899332" title="List[LazyVals.this.global.Tree]">body</a><span class="delimiter">)</span>
          <span class="keyword">var</span> <a title="Boolean" id="899349">added</a> = <span title="Boolean(false)" class="keyword">false</span>
          <span class="keyword">val</span> <a title="List[LazyVals.this.global.analyzer.global.Tree]" id="899350">stats</a> =
            <span class="keyword">for</span> <span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="899370">stat</a> &lt;- <a href="../../../collection/TraversableLike.scala.html#49041" title="(f: LazyVals.this.global.Tree =&gt; LazyVals.this.global.analyzer.global.Tree)(implicit bf: scala.collection.generic.CanBuildFrom[List[LazyVals.this.global.Tree],LazyVals.this.global.analyzer.global.Tree,List[LazyVals.this.global.analyzer.global.Tree]])List[LazyVals.this.global.analyzer.global.Tree]">body1</a><span class="delimiter">)</span> <span class="keyword">yield</span> <a href="#899370" title="LazyVals.this.global.Tree">stat</a> <span title="LazyVals.this.global.analyzer.global.Tree" class="keyword">match</span> <span class="delimiter">{</span>
              <span class="keyword">case</span> <span title="LazyVals.this.global.analyzer.global.Tree">Block</span><span class="delimiter">(</span>_, _<span class="delimiter">)</span> | Apply<span class="delimiter">(</span>_, _<span class="delimiter">)</span> | If<span class="delimiter">(</span>_, _, _<span class="delimiter">)</span> <span class="keyword">if</span> <a href="../../../Boolean.scala.html#55576" title="=&gt; Boolean">!</a><a href="#899349" title="Boolean">added</a> =&gt;
                <span class="comment">// Avoid adding bitmaps when they are fully overshadowed by those</span>
                <span class="comment">// that are added inside loops</span>
                <span title="LazyVals.this.global.analyzer.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#513167" title="object LazyVals.this.LocalLazyValFinder">LocalLazyValFinder</a>.<a href="#899081" title="(t: LazyVals.this.global.Tree)Boolean">find</a><span class="delimiter">(</span><a href="#899370" title="LazyVals.this.global.Tree">stat</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
                  <a href="#899349" title="Boolean">added</a> = <span title="Boolean(true)" class="keyword">true</span>
                  <a href="../typechecker/Typers.scala.html#507768" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#899058" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#899186" title="LazyVals.this.global.Symbol">sym</a>, <a href="#899370" title="LazyVals.this.global.Tree">stat</a><span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#899370" title="LazyVals.this.global.Tree">stat</a>
              <span class="keyword">case</span> <span title="LazyVals.this.global.analyzer.global.Tree">ValDef</span><span class="delimiter">(</span><a title="LazyVals.this.global.Modifiers" id="899393">mods</a>, <a title="LazyVals.this.global.TermName" id="899394">name</a>, <a title="LazyVals.this.global.Tree" id="899395">tpt</a>, <a title="LazyVals.this.global.Tree" id="899396">rhs</a><span class="delimiter">)</span> =&gt;
                <a href="../typechecker/Typers.scala.html#507768" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="../ast/Trees.scala.html#560331" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<a href="../ast/Trees.scala.html#560235" title="(tree: LazyVals.this.global.Tree, mods: LazyVals.this.global.Modifiers, name: LazyVals.this.global.Name, tpt: LazyVals.this.global.Tree, rhs: LazyVals.this.global.Tree)LazyVals.this.global.ValDef">ValDef</a><span class="delimiter">(</span><a href="#899370" title="LazyVals.this.global.Tree">stat</a>, <a href="#899393" title="LazyVals.this.global.Modifiers">mods</a>, <a href="#899394" title="LazyVals.this.global.TermName">name</a>, <a href="#899395" title="LazyVals.this.global.Tree">tpt</a>, <a href="#899058" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#899370" title="LazyVals.this.global.Tree">stat</a>.<a href="../../../reflect/generic/Trees.scala.html#441032" title="=&gt; LazyVals.this.global.Symbol">symbol</a>, <a href="#899396" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
              <span class="keyword">case</span> <span title="LazyVals.this.global.Tree">_</span> =&gt;
                <a href="#899370" title="LazyVals.this.global.Tree">stat</a>
            <span class="delimiter">}</span>
          <span class="keyword">val</span> <a title="List[LazyVals.this.global.analyzer.global.Tree]" id="899351">innerClassBitmaps</a> = <span title="List[LazyVals.this.global.analyzer.global.Tree]" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#55576" title="=&gt; Boolean">!</a><a href="#899349" title="Boolean">added</a> <a href="../../../Boolean.scala.html#55580" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../ast/Trees.scala.html#560333" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a>.<a href="../../../reflect/generic/Symbols.scala.html#435371" title="=&gt; Boolean">isClass</a> <a href="../../../Boolean.scala.html#55580" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#899061" title="=&gt; scala.collection.mutable.Map[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]">bitmaps</a>.<a href="../../../collection/MapLike.scala.html#73205" title="(key: LazyVals.this.global.Symbol)Boolean">contains</a><span class="delimiter">(</span><a href="../ast/Trees.scala.html#560333" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="comment">// add bitmap to inner class if necessary</span>
                <span class="keyword">val</span> <a title="List[LazyVals.this.global.analyzer.global.Tree]" id="899432">toAdd0</a> = <a href="../../../collection/MapLike.scala.html#73204" title="(key: LazyVals.this.global.Symbol)List[LazyVals.this.global.Symbol]">bitmaps</a><span class="delimiter">(</span><a href="../ast/Trees.scala.html#560333" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a><span class="delimiter">)</span>.<a href="../../../collection/TraversableLike.scala.html#49041" title="(f: LazyVals.this.global.Symbol =&gt; LazyVals.this.global.analyzer.global.Tree)(implicit bf: scala.collection.generic.CanBuildFrom[List[LazyVals.this.global.Symbol],LazyVals.this.global.analyzer.global.Tree,List[LazyVals.this.global.analyzer.global.Tree]])List[LazyVals.this.global.analyzer.global.Tree]">map</a><a href="../../../collection/immutable/List.scala.html#48868" title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,LazyVals.this.global.analyzer.global.Tree,List[LazyVals.this.global.analyzer.global.Tree]]" class="delimiter">(</a><a title="LazyVals.this.global.Symbol" id="899477">s</a> =&gt; <a href="../typechecker/Typers.scala.html#507768" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="../ast/Trees.scala.html#479125" title="(sym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.ValDef">ValDef</a><span class="delimiter">(</span><a href="#899477" title="LazyVals.this.global.Symbol">s</a>, <a href="../ast/TreeDSL.scala.html#515190" title="=&gt; LazyVals.this.global.Literal">ZERO</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                <a href="#899432" title="List[LazyVals.this.global.analyzer.global.Tree]">toAdd0</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#71032" title="(f: LazyVals.this.global.analyzer.global.Tree =&gt; Any)Unit">foreach</a><span class="delimiter">(</span><a title="LazyVals.this.global.analyzer.global.Tree" id="899540">t</a> =&gt; <span class="delimiter">{</span>
                    <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="../ast/Trees.scala.html#560333" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a>.<a href="../symtab/Symbols.scala.html#509272" title="=&gt; LazyVals.this.global.Type">info</a>.<a href="../symtab/Types.scala.html#507193" title="(name: LazyVals.this.global.Name)LazyVals.this.global.Symbol">decl</a><span class="delimiter">(</span><a href="#899540" title="LazyVals.this.global.analyzer.global.Tree">t</a>.<a href="../../../reflect/generic/Trees.scala.html#441032" title="=&gt; LazyVals.this.global.analyzer.global.Symbol">symbol</a>.<a href="../symtab/Symbols.scala.html#509256" title="=&gt; LazyVals.this.global.analyzer.global.Name">name</a><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../symtab/Symbols.scala.html#478667" title="object LazyVals.this.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <span class="delimiter">{</span>
                      <a href="#899540" title="LazyVals.this.global.analyzer.global.Tree">t</a>.<a href="../../../reflect/generic/Trees.scala.html#441032" title="=&gt; LazyVals.this.global.analyzer.global.Symbol">symbol</a>.<a href="../symtab/Symbols.scala.html#509261" title="(mask: Long)LazyVals.this.global.analyzer.global.Symbol">setFlag</a><span class="delimiter">(</span><span title="Long(1L)">PROTECTED</span><span class="delimiter">)</span>
                      <a href="../ast/Trees.scala.html#560333" title="=&gt; LazyVals.this.global.Symbol">currentOwner</a>.<a href="../symtab/Symbols.scala.html#509272" title="=&gt; LazyVals.this.global.Type">info</a>.<a href="../symtab/Types.scala.html#507192" title="=&gt; LazyVals.this.global.Scope">decls</a>.<a href="../symtab/Scopes.scala.html#514360" title="(sym: LazyVals.this.global.Symbol)LazyVals.this.global.Symbol">enter</a><span class="delimiter">(</span><a href="#899540" title="LazyVals.this.global.analyzer.global.Tree">t</a>.<a href="../../../reflect/generic/Trees.scala.html#441032" title="=&gt; LazyVals.this.global.analyzer.global.Symbol">symbol</a><span class="delimiter">)</span>
                    <span class="delimiter">}</span>
                <span class="delimiter">}</span><span class="delimiter">)</span>
                <a href="#899432" title="List[LazyVals.this.global.analyzer.global.Tree]">toAdd0</a>
            <span class="delimiter">}</span> <span class="keyword">else</span> List<a href="../../../collection/immutable/List.scala.html#13700" title="object Nil" class="delimiter">(</a><span class="delimiter">)</span>
          <a href="../ast/Trees.scala.html#560331" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<a href="../ast/Trees.scala.html#560241" title="(tree: LazyVals.this.global.Tree, parents: List[LazyVals.this.global.Tree], self: LazyVals.this.global.ValDef, body: List[LazyVals.this.global.Tree])LazyVals.this.global.Template">Template</a><span class="delimiter">(</span><a href="#899181" title="LazyVals.this.global.Tree">tree</a>, <a href="#899330" title="List[LazyVals.this.global.Tree]">parents</a>, <a href="#899331" title="LazyVals.this.global.ValDef">self</a>, <a href="#899351" title="List[LazyVals.this.global.analyzer.global.Tree]">innerClassBitmaps</a> <a href="../../../collection/immutable/List.scala.html#49152" title="(that: scala.collection.GenTraversableOnce[LazyVals.this.global.analyzer.global.Tree])(implicit bf: scala.collection.generic.CanBuildFrom[List[LazyVals.this.global.analyzer.global.Tree],LazyVals.this.global.analyzer.global.Tree,List[LazyVals.this.global.Tree]])List[LazyVals.this.global.Tree]">++</a> <a href="#899350" title="List[LazyVals.this.global.analyzer.global.Tree]">stats</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <span class="keyword">case</span> <span title="LazyVals.this.global.ValDef">ValDef</span><span class="delimiter">(</span><a title="LazyVals.this.global.Modifiers" id="899654">mods</a>, <a title="LazyVals.this.global.TermName" id="899655">name</a>, <a title="LazyVals.this.global.Tree" id="899656">tpt</a>, <a title="LazyVals.this.global.Tree" id="899657">rhs0</a><span class="delimiter">)</span> <span class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#55576" title="=&gt; Boolean">!</a><a href="#899186" title="LazyVals.this.global.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#509249" title="=&gt; LazyVals.this.global.Symbol">owner</a>.<a href="../../../reflect/generic/Symbols.scala.html#435386" title="=&gt; Boolean">isModule</a> <a href="../../../Boolean.scala.html#55580" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../../Boolean.scala.html#55576" title="=&gt; Boolean">!</a><a href="#899186" title="LazyVals.this.global.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#509249" title="=&gt; LazyVals.this.global.Symbol">owner</a>.<a href="../../../reflect/generic/Symbols.scala.html#435371" title="=&gt; Boolean">isClass</a><span class="delimiter">)</span> =&gt;
          <span class="keyword">val</span> <a title="LazyVals.this.global.Tree" id="899658">rhs</a> = <a href="#513169" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="TypingTransformers.scala.html#893511" title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#899657" title="LazyVals.this.global.Tree">rhs0</a><span class="delimiter">)</span>
          <a href="../ast/Trees.scala.html#560331" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<a href="../ast/Trees.scala.html#560235" title="(tree: LazyVals.this.global.Tree, mods: LazyVals.this.global.Modifiers, name: LazyVals.this.global.Name, tpt: LazyVals.this.global.Tree, rhs: LazyVals.this.global.Tree)LazyVals.this.global.ValDef">ValDef</a><span class="delimiter">(</span><a href="#899181" title="LazyVals.this.global.Tree">tree</a>, <a href="#899654" title="LazyVals.this.global.Modifiers">mods</a>, <a href="#899655" title="LazyVals.this.global.TermName">name</a>, <a href="#899656" title="LazyVals.this.global.Tree">tpt</a>,
                  <span title="LazyVals.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#513167" title="object LazyVals.this.LocalLazyValFinder">LocalLazyValFinder</a>.<a href="#899081" title="(t: LazyVals.this.global.Tree)Boolean">find</a><span class="delimiter">(</span><a href="#899658" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../typechecker/Typers.scala.html#507768" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#899058" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#899186" title="LazyVals.this.global.Symbol">sym</a>, <a href="#899658" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#899658" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span>

        <span class="keyword">case</span> <a title="LazyVals.this.global.Tree" id="899668">l</a>@LabelDef<span class="delimiter">(</span><a title="LazyVals.this.global.TermName" id="899674">name0</a>, <a title="List[LazyVals.this.global.Ident]" id="899675">params0</a>, <a title="LazyVals.this.global.If" id="899676">ifp0</a>@If<span class="delimiter">(</span>_, _, _<span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#899674" title="LazyVals.this.global.TermName">name0</a>.<a href="../symtab/Names.scala.html#501146" title="(name: String)Boolean">startsWith</a><span class="delimiter">(</span><a href="../symtab/StdNames.scala.html#479055" title="object LazyVals.this.global.nme">nme</a>.<a href="../symtab/StdNames.scala.html#516792" title="=&gt; java.lang.String">WHILE_PREFIX</a><span class="delimiter">)</span> =&gt;
          <span class="keyword">val</span> <a title="LazyVals.this.global.Tree" id="899687">ifp1</a> = <a href="#513169" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="TypingTransformers.scala.html#893511" title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#899676" title="LazyVals.this.global.If">ifp0</a><span class="delimiter">)</span>
          <span class="keyword">val</span> If<a href="../../../Tuple3.scala.html#53296" title="(LazyVals.this.global.Tree, LazyVals.this.global.Tree, LazyVals.this.global.Tree)" class="delimiter">(</a><a href="../../../Tuple3.scala.html#53312" title="LazyVals.this.global.Tree" id="899689">cond0</a>, <a href="../../../Tuple3.scala.html#53314" title="LazyVals.this.global.Tree" id="899690">thenp0</a>, <a href="../../../Tuple3.scala.html#53316" title="LazyVals.this.global.Tree" id="899691">elsep0</a><span class="delimiter">)</span> = <a href="#899687" title="LazyVals.this.global.Tree">ifp1</a>
          <span title="LazyVals.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#513167" title="object LazyVals.this.LocalLazyValFinder">LocalLazyValFinder</a>.<a href="#899081" title="(t: LazyVals.this.global.Tree)Boolean">find</a><span class="delimiter">(</span><a href="#899690" title="LazyVals.this.global.Tree">thenp0</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="../ast/Trees.scala.html#560331" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<a href="../ast/Trees.scala.html#560238" title="(tree: LazyVals.this.global.Tree, name: LazyVals.this.global.Name, params: List[LazyVals.this.global.Ident], rhs: LazyVals.this.global.Tree)LazyVals.this.global.LabelDef">LabelDef</a><span class="delimiter">(</span><a href="#899668" title="LazyVals.this.global.LabelDef">l</a>, <a href="#899674" title="LazyVals.this.global.TermName">name0</a>, <a href="#899675" title="List[LazyVals.this.global.Ident]">params0</a>,
                    <a href="../ast/Trees.scala.html#560331" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<a href="../ast/Trees.scala.html#560252" title="(tree: LazyVals.this.global.Tree, cond: LazyVals.this.global.Tree, thenp: LazyVals.this.global.Tree, elsep: LazyVals.this.global.Tree)LazyVals.this.global.If">If</a><span class="delimiter">(</span><a href="#899687" title="LazyVals.this.global.Tree">ifp1</a>, <a href="#899689" title="LazyVals.this.global.Tree">cond0</a>, <a href="../typechecker/Typers.scala.html#507768" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#899058" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#899186" title="LazyVals.this.global.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#509249" title="=&gt; LazyVals.this.global.Symbol">owner</a>, <a href="#899690" title="LazyVals.this.global.Tree">thenp0</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#899691" title="LazyVals.this.global.Tree">elsep0</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">else</span>
            <a href="#899668" title="LazyVals.this.global.LabelDef">l</a>

        <span class="keyword">case</span> <a title="LazyVals.this.global.Tree" id="899724">l</a>@LabelDef<span class="delimiter">(</span><a title="LazyVals.this.global.TermName" id="899730">name0</a>, <a title="List[LazyVals.this.global.Ident]" id="899731">params0</a>, <a title="LazyVals.this.global.Block" id="899732">block</a>@Block<span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="899737">stats0</a>, _<span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">if</span> <a href="#899730" title="LazyVals.this.global.TermName">name0</a>.<a href="../symtab/Names.scala.html#501146" title="(name: String)Boolean">startsWith</a><span class="delimiter">(</span><a href="../symtab/StdNames.scala.html#479055" title="object LazyVals.this.global.nme">nme</a>.<a href="../symtab/StdNames.scala.html#516792" title="=&gt; java.lang.String">WHILE_PREFIX</a><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#55579" title="(x: Boolean)Boolean">||</a> <a href="#899730" title="LazyVals.this.global.TermName">name0</a>.<a href="../symtab/Names.scala.html#501146" title="(name: String)Boolean">startsWith</a><span class="delimiter">(</span><a href="../symtab/StdNames.scala.html#479055" title="object LazyVals.this.global.nme">nme</a>.<a href="../symtab/StdNames.scala.html#516776" title="=&gt; java.lang.String">DO_WHILE_PREFIX</a><span class="delimiter">)</span> =&gt;
          <span class="keyword">val</span> <a title="List[LazyVals.this.global.Tree]" id="899749">stats1</a> = <a href="#513169" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="../ast/Trees.scala.html#560340" title="(trees: List[LazyVals.this.global.Tree])List[LazyVals.this.global.Tree]">transformTrees</a><span class="delimiter">(</span><a href="#899737" title="List[LazyVals.this.global.Tree]">stats0</a><span class="delimiter">)</span>
          <span title="LazyVals.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#513167" title="object LazyVals.this.LocalLazyValFinder">LocalLazyValFinder</a>.<a href="#899082" title="(ts: List[LazyVals.this.global.Tree])Boolean">find</a><span class="delimiter">(</span><a href="#899749" title="List[LazyVals.this.global.Tree]">stats1</a><span class="delimiter">)</span><span class="delimiter">)</span>
            <a href="../ast/Trees.scala.html#560331" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<a href="../ast/Trees.scala.html#560238" title="(tree: LazyVals.this.global.Tree, name: LazyVals.this.global.Name, params: List[LazyVals.this.global.Ident], rhs: LazyVals.this.global.Tree)LazyVals.this.global.LabelDef">LabelDef</a><span class="delimiter">(</span><a href="#899724" title="LazyVals.this.global.LabelDef">l</a>, <a href="#899730" title="LazyVals.this.global.TermName">name0</a>, <a href="#899731" title="List[LazyVals.this.global.Ident]">params0</a>,
                    <a href="../ast/Trees.scala.html#560331" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<a href="../ast/Trees.scala.html#560242" title="(tree: LazyVals.this.global.Tree, stats: List[LazyVals.this.global.Tree], expr: LazyVals.this.global.Tree)LazyVals.this.global.Block">Block</a><span class="delimiter">(</span><a href="#899732" title="LazyVals.this.global.Block">block</a>, <a href="../typechecker/Typers.scala.html#507768" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#899058" title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree">addBitmapDefs</a><span class="delimiter">(</span><a href="#899186" title="LazyVals.this.global.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#509249" title="=&gt; LazyVals.this.global.Symbol">owner</a>, <a href="#899749" title="List[LazyVals.this.global.Tree]">stats1</a>.<a href="../../../collection/IterableLike.scala.html#53870" title="=&gt; LazyVals.this.global.Tree">head</a><span class="delimiter">)</span><span class="delimiter">)</span><a href="../../../collection/immutable/List.scala.html#49140" title="(x: LazyVals.this.global.Tree)List[LazyVals.this.global.Tree]">::</a><a href="#899749" title="List[LazyVals.this.global.Tree]">stats1</a>.<a href="../../../collection/TraversableLike.scala.html#49082" title="=&gt; List[LazyVals.this.global.Tree]">tail</a>, <a href="#899732" title="LazyVals.this.global.Block">block</a>.<a href="../../../reflect/generic/Trees.scala.html#442419" title="=&gt; LazyVals.this.global.Tree">expr</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">else</span>
            <a href="#899724" title="LazyVals.this.global.LabelDef">l</a>

        <span class="keyword">case</span> <span title="LazyVals.this.global.Tree">_</span> =&gt; <a href="#513169" title="LazyVals.this.LazyValues" class="keyword">super</a>.<a href="TypingTransformers.scala.html#893511" title="(tree: LazyVals.this.global.Tree)LazyVals.this.global.Tree">transform</a><span class="delimiter">(</span><a href="#899181" title="LazyVals.this.global.Tree">tree</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="comment">/** Add the bitmap definitions to the rhs of a method definition.
     *  If the rhs has been tail-call transformed, insert the bitmap
     *  definitions inside the top-level label definition, so that each
     *  iteration has the lazy values un-initialized. Otherwise add them
     *  at the very beginning of the method.
     */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(methSym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.Tree" id="899058">addBitmapDefs</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="899313">methSym</a>: <a href="../symtab/Symbols.scala.html#478659" title="LazyVals.this.global.Symbol">Symbol</a>, <a title="LazyVals.this.global.Tree" id="899314">rhs</a>: <a href="../../../reflect/generic/Trees.scala.html#434028" title="LazyVals.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/generic/Trees.scala.html#434028" title="LazyVals.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(stats: List[LazyVals.this.global.Tree], tree: LazyVals.this.global.Tree)LazyVals.this.global.Block" id="899770">prependStats</a><span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="899773">stats</a>: <a href="../../../collection/immutable/List.scala.html#14047" title="List[LazyVals.this.global.Tree]">List</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span>, <a title="LazyVals.this.global.Tree" id="899774">tree</a>: <a href="../../../reflect/generic/Trees.scala.html#434028" title="LazyVals.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/generic/Trees.scala.html#434070" title="LazyVals.this.global.Block">Block</a> = <a href="#899774" title="LazyVals.this.global.Tree">tree</a> <span title="LazyVals.this.global.Block" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="LazyVals.this.global.Block">Block</span><span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="899779">stats1</a>, <a title="LazyVals.this.global.Tree" id="899780">res</a><span class="delimiter">)</span> =&gt; <a href="../../../reflect/generic/Trees.scala.html#443384" title="(stats: List[LazyVals.this.global.Tree], expr: LazyVals.this.global.Tree)LazyVals.this.global.Block">Block</a><span class="delimiter">(</span><a href="#899773" title="List[LazyVals.this.global.Tree]">stats</a> <a href="../../../collection/immutable/List.scala.html#49143" title="(prefix: List[LazyVals.this.global.Tree])List[LazyVals.this.global.Tree]">:::</a> <a href="#899779" title="List[LazyVals.this.global.Tree]">stats1</a>, <a href="#899780" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="LazyVals.this.global.Block">_</span> =&gt; <a href="../../../reflect/generic/Trees.scala.html#443384" title="(stats: List[LazyVals.this.global.Tree], expr: LazyVals.this.global.Tree)LazyVals.this.global.Block">Block</a><span class="delimiter">(</span><a href="#899773" title="List[LazyVals.this.global.Tree]">stats</a>, <a href="#899774" title="LazyVals.this.global.Tree">tree</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="List[LazyVals.this.global.ValDef]" id="899771">bmps</a> = <a href="../../../collection/MapLike.scala.html#73204" title="(key: LazyVals.this.global.Symbol)List[LazyVals.this.global.Symbol]">bitmaps</a><span class="delimiter">(</span><a href="#899313" title="LazyVals.this.global.Symbol">methSym</a><span class="delimiter">)</span> <a href="../../../collection/TraversableLike.scala.html#49041" title="(f: LazyVals.this.global.Symbol =&gt; LazyVals.this.global.ValDef)(implicit bf: scala.collection.generic.CanBuildFrom[List[LazyVals.this.global.Symbol],LazyVals.this.global.ValDef,List[LazyVals.this.global.ValDef]])List[LazyVals.this.global.ValDef]">map</a> <span class="delimiter">(</span><a href="../ast/Trees.scala.html#479125" title="(sym: LazyVals.this.global.Symbol, rhs: LazyVals.this.global.Tree)LazyVals.this.global.ValDef">ValDef</a><span class="delimiter">(</span><a href="#899859" title="LazyVals.this.global.Symbol">_</a>, <a href="../ast/TreeDSL.scala.html#515190" title="=&gt; LazyVals.this.global.Literal">ZERO</a><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="keyword">def</span> <a title="(params: List[LazyVals.this.global.Ident])Boolean" id="899772">isMatch</a><span class="delimiter">(</span><a title="List[LazyVals.this.global.Ident]" id="899897">params</a>: <a href="../../../collection/immutable/List.scala.html#14047" title="List[LazyVals.this.global.Ident]">List</a><span class="delimiter">[</span>Ident<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="#899897" title="List[LazyVals.this.global.Ident]">params</a>.<a href="../../../collection/TraversableLike.scala.html#49082" title="=&gt; List[LazyVals.this.global.Ident]">tail</a> <a href="../../../collection/SeqLike.scala.html#54171" title="(that: scala.collection.GenSeq[LazyVals.this.global.Symbol])(p: (LazyVals.this.global.Ident, LazyVals.this.global.Symbol) =&gt; Boolean)Boolean">corresponds</a> <a href="#899313" title="LazyVals.this.global.Symbol">methSym</a>.<a href="../symtab/Symbols.scala.html#509270" title="=&gt; LazyVals.this.global.Type">tpe</a>.<a href="../symtab/Types.scala.html#507180" title="=&gt; List[LazyVals.this.global.Symbol]">params</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#899922" title="LazyVals.this.global.Ident">_</a>.<a href="../../../reflect/generic/Trees.scala.html#441028" title="=&gt; LazyVals.this.global.Type">tpe</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#899923" title="LazyVals.this.global.Symbol">_</a>.<a href="../symtab/Symbols.scala.html#509270" title="=&gt; LazyVals.this.global.Type">tpe</a><span class="delimiter">)</span>

      <span title="LazyVals.this.global.Tree" class="keyword">if</span> <span class="delimiter">(</span><a href="#899771" title="List[LazyVals.this.global.ValDef]">bmps</a>.<a href="../../../collection/IterableLike.scala.html#53862" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <a href="#899314" title="LazyVals.this.global.Tree">rhs</a> <span class="keyword">else</span> <a href="#899314" title="LazyVals.this.global.Tree">rhs</a> <span title="LazyVals.this.global.Tree" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="LazyVals.this.global.Block">Block</span><span class="delimiter">(</span><a title="List[LazyVals.this.global.Tree]" id="899933">assign</a>, <a title="LazyVals.this.global.LabelDef" id="899934">l</a> @ LabelDef<span class="delimiter">(</span><a title="LazyVals.this.global.TermName" id="899940">name</a>, <a title="List[LazyVals.this.global.Ident]" id="899941">params</a>, <a title="LazyVals.this.global.Tree" id="899942">rhs1</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">if</span> <a href="#899940" title="LazyVals.this.global.TermName">name</a>.<a href="../symtab/Names.scala.html#501123" title="()String">toString</a> <span title="(x$1: AnyRef)Boolean">==</span> <span class="delimiter">(</span><span title="java.lang.String(&quot;_&quot;)" class="string">&quot;_&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#899313" title="LazyVals.this.global.Symbol">methSym</a>.<a href="../symtab/Symbols.scala.html#509256" title="=&gt; LazyVals.this.global.Name">name</a><span class="delimiter">)</span> <a href="../../../Boolean.scala.html#55580" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="#899772" title="(params: List[LazyVals.this.global.Ident])Boolean">isMatch</a><span class="delimiter">(</span><a href="#899941" title="List[LazyVals.this.global.Ident]">params</a><span class="delimiter">)</span> =&gt;
            <a href="../../../reflect/generic/Trees.scala.html#443384" title="(stats: List[LazyVals.this.global.Tree], expr: LazyVals.this.global.Tree)LazyVals.this.global.Block">Block</a><span class="delimiter">(</span><a href="#899933" title="List[LazyVals.this.global.Tree]">assign</a>, <a href="../ast/Trees.scala.html#560331" title="=&gt; LazyVals.this.global.TreeCopier">treeCopy</a>.<a href="../ast/Trees.scala.html#560238" title="(tree: LazyVals.this.global.Tree, name: LazyVals.this.global.Name, params: List[LazyVals.this.global.Ident], rhs: LazyVals.this.global.Tree)LazyVals.this.global.LabelDef">LabelDef</a><span class="delimiter">(</span><a href="#899934" title="LazyVals.this.global.LabelDef">l</a>, <a href="#899940" title="LazyVals.this.global.TermName">name</a>, <a href="#899941" title="List[LazyVals.this.global.Ident]">params</a>, <a href="../typechecker/Typers.scala.html#507768" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a><span class="delimiter">(</span><a href="#899770" title="(stats: List[LazyVals.this.global.Tree], tree: LazyVals.this.global.Tree)LazyVals.this.global.Block">prependStats</a><span class="delimiter">(</span><a href="#899771" title="List[LazyVals.this.global.ValDef]">bmps</a>, <a href="#899942" title="LazyVals.this.global.Tree">rhs1</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>

        <span class="keyword">case</span> <span title="LazyVals.this.global.Block">_</span> =&gt; <a href="#899770" title="(stats: List[LazyVals.this.global.Tree], tree: LazyVals.this.global.Tree)LazyVals.this.global.Block">prependStats</a><span class="delimiter">(</span><a href="#899771" title="List[LazyVals.this.global.ValDef]">bmps</a>, <a href="#899314" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="comment">/** return a 'lazified' version of rhs. Rhs should conform to the
     *  following schema:
     *  {
     *    l$ = &lt;rhs&gt;
     *    l$
     *  } or
     *  &lt;rhs&gt; when the lazy value has type Unit (for which there is no field
     *  to cache it's value.
     *
     *  The result will be a tree of the form
     *  {
     *    if ((bitmap$n &amp; MASK) == 0) {
     *       l$ = &lt;rhs&gt;
     *       bitmap$n = bimap$n | MASK
     *    }
     *    l$
     *  }
     *  where bitmap$n is an int value acting as a bitmap of initialized values. It is
     *  the 'n' is (offset / 32), the MASK is (1 &lt;&lt; (offset % 32)). If the value has type
     *  unit, no field is used to cache the value, so the resulting code is:
     *  {
     *    if ((bitmap$n &amp; MASK) == 0) {
     *       &lt;rhs&gt;;
     *       bitmap$n = bimap$n | MASK
     *    }
     *    ()
     *  }
     */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(methOrClass: LazyVals.this.global.Symbol, tree: LazyVals.this.global.Tree, offset: Int, lazyVal: LazyVals.this.global.Symbol)LazyVals.this.global.Tree" id="899059">mkLazyDef</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="899279">methOrClass</a>: <a href="../symtab/Symbols.scala.html#478659" title="LazyVals.this.global.Symbol">Symbol</a>, <a title="LazyVals.this.global.Tree" id="899280">tree</a>: <a href="../../../reflect/generic/Trees.scala.html#434028" title="LazyVals.this.global.Tree">Tree</a>, <a title="Int" id="899281">offset</a>: <a href="../../../Int.scala.html#386" title="Int">Int</a>, <a title="LazyVals.this.global.Symbol" id="899282">lazyVal</a>: <a href="../symtab/Symbols.scala.html#478659" title="LazyVals.this.global.Symbol">Symbol</a><span class="delimiter">)</span>: <a href="../../../reflect/generic/Trees.scala.html#434028" title="LazyVals.this.global.Tree">Tree</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="LazyVals.this.global.Symbol" id="899966">bitmapSym</a>           = <a href="#899063" title="(meth: LazyVals.this.global.Symbol, offset: Int)LazyVals.this.global.Symbol">getBitmapFor</a><span class="delimiter">(</span><a href="#899279" title="LazyVals.this.global.Symbol">methOrClass</a>, <a href="#899281" title="Int">offset</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="LazyVals.this.global.Literal" id="899967">mask</a>                = <a href="../ast/TreeDSL.scala.html#547417" title="(x: Any)LazyVals.this.global.Literal">LIT</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span> <a href="../../../Int.scala.html#54738" title="(x: Int)Int">&lt;&lt;</a> <span class="delimiter">(</span><a href="#899281" title="Int">offset</a> <a href="../../../Int.scala.html#54832" title="(x: Int)Int">%</a> <a href="#513164" title="=&gt; Int">FLAGS_PER_WORD</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="&lt;none&gt; extends LazyVals.this.global.RefTree with Serializable" id="899968">bitmapRef</a> = <span title="&lt;none&gt; extends LazyVals.this.global.RefTree with Serializable" class="keyword">if</span> <span class="delimiter">(</span><a href="#899279" title="LazyVals.this.global.Symbol">methOrClass</a>.<a href="../../../reflect/generic/Symbols.scala.html#435371" title="=&gt; Boolean">isClass</a><span class="delimiter">)</span> <a href="../ast/Trees.scala.html#479143" title="(qualifier: LazyVals.this.global.Tree, sym: LazyVals.this.global.Symbol)LazyVals.this.global.Select">Select</a><span class="delimiter">(</span><a href="../ast/Trees.scala.html#479142" title="(sym: LazyVals.this.global.Symbol)LazyVals.this.global.Tree">This</a><span class="delimiter">(</span><a href="#899279" title="LazyVals.this.global.Symbol">methOrClass</a><span class="delimiter">)</span>, <a href="#899966" title="LazyVals.this.global.Symbol">bitmapSym</a><span class="delimiter">)</span> <span class="keyword">else</span> <a href="../ast/Trees.scala.html#479144" title="(sym: LazyVals.this.global.Symbol)LazyVals.this.global.Ident">Ident</a><span class="delimiter">(</span><a href="#899966" title="LazyVals.this.global.Symbol">bitmapSym</a><span class="delimiter">)</span>

      <span class="keyword">def</span> <a title="(stmt: LazyVals.this.global.Tree)LazyVals.this.global.Block" id="899969">mkBlock</a><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="900046">stmt</a>: <a href="../../../reflect/generic/Trees.scala.html#434028" title="LazyVals.this.global.Tree">Tree</a><span class="delimiter">)</span> = <a href="../ast/TreeDSL.scala.html#515238" title="(xs: LazyVals.this.global.Tree*)LazyVals.this.global.Block">BLOCK</a><span class="delimiter">(</span><a href="#900046" title="LazyVals.this.global.Tree">stmt</a>, <a href="#899060" title="(bmp: LazyVals.this.global.Symbol, mask: LazyVals.this.global.Tree, bmpRef: LazyVals.this.global.Tree)LazyVals.this.global.Tree">mkSetFlag</a><span class="delimiter">(</span><a href="#899966" title="LazyVals.this.global.Symbol">bitmapSym</a>, <a href="#899967" title="LazyVals.this.global.Literal">mask</a>, <a href="#899968" title="&lt;none&gt; extends LazyVals.this.global.RefTree with Serializable">bitmapRef</a><span class="delimiter">)</span>, <a href="../ast/TreeDSL.scala.html#515193" title="=&gt; LazyVals.this.global.Literal">UNIT</a><span class="delimiter">)</span>


      <span class="keyword">val</span> <a href="../../../Tuple2.scala.html#53390" title="(LazyVals.this.global.Block, LazyVals.this.global.Tree)" class="delimiter">(</a><a href="../../../Tuple2.scala.html#53402" title="LazyVals.this.global.Block" id="899971">block</a>, <a href="../../../Tuple2.scala.html#53404" title="LazyVals.this.global.Tree" id="899972">res</a><span class="delimiter">)</span> = <a href="#899280" title="LazyVals.this.global.Tree">tree</a> <span title="(LazyVals.this.global.Block, LazyVals.this.global.Tree)" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="(LazyVals.this.global.Block, LazyVals.this.global.Tree)">Block</span><span class="delimiter">(</span><a href="../../../collection/generic/GenSeqFactory.scala.html#48862" title="(x: List[LazyVals.this.global.Tree])Some[List[LazyVals.this.global.Tree]]">List</a><span class="delimiter">(</span><a title="LazyVals.this.global.Tree" id="900068">assignment</a><span class="delimiter">)</span>, <a title="LazyVals.this.global.Tree" id="900069">res</a><span class="delimiter">)</span> <span class="keyword">if</span> <a href="../../../Boolean.scala.html#55576" title="=&gt; Boolean">!</a><a href="#513166" title="(sym: LazyVals.this.global.Symbol)Boolean">lazyUnit</a><span class="delimiter">(</span><a href="#899282" title="LazyVals.this.global.Symbol">lazyVal</a><span class="delimiter">)</span> =&gt;
          <a href="../../../Tuple2.scala.html#53390" title="(_1: LazyVals.this.global.Block, _2: LazyVals.this.global.Tree)(LazyVals.this.global.Block, LazyVals.this.global.Tree)" class="delimiter">(</a><a href="#899969" title="(stmt: LazyVals.this.global.Tree)LazyVals.this.global.Block">mkBlock</a><span class="delimiter">(</span><a href="#900068" title="LazyVals.this.global.Tree">assignment</a><span class="delimiter">)</span>,  <a href="#900069" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="(LazyVals.this.global.Block, LazyVals.this.global.Literal)" id="900076">rhs</a>                          =&gt;
          <a href="../../../Tuple2.scala.html#53390" title="(_1: LazyVals.this.global.Block, _2: LazyVals.this.global.Literal)(LazyVals.this.global.Block, LazyVals.this.global.Literal)" class="delimiter">(</a><a href="#899969" title="(stmt: LazyVals.this.global.Tree)LazyVals.this.global.Block">mkBlock</a><span class="delimiter">(</span><a href="#900076" title="LazyVals.this.global.Tree">rhs</a><span class="delimiter">)</span>,         <a href="../ast/TreeDSL.scala.html#515193" title="=&gt; LazyVals.this.global.Literal">UNIT</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="LazyVals.this.global.Apply" id="899973">cond</a> = <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#515248" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: LazyVals.this.global.Tree)LazyVals.this.CODE.TreeMethods">bitmapRef</a> <a href="../ast/TreeDSL.scala.html#515248" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: LazyVals.this.global.Tree)LazyVals.this.CODE.TreeMethods">INT_&amp;</a> <a href="#899967" title="LazyVals.this.global.Literal">mask</a><span class="delimiter">)</span> <a href="../ast/TreeDSL.scala.html#547498" title="(other: LazyVals.this.global.Tree)LazyVals.this.global.Apply">INT_==</a> <a href="../ast/TreeDSL.scala.html#515190" title="=&gt; LazyVals.this.global.Literal">ZERO</a>

      <a href="../ast/Trees.scala.html#479182" title="(pos: LazyVals.this.global.Position)(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">atPos</a><span class="delimiter">(</span><a href="#899280" title="LazyVals.this.global.Tree">tree</a>.<a href="../../../reflect/generic/Trees.scala.html#441024" title="=&gt; LazyVals.this.global.Position">pos</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="TypingTransformers.scala.html#893496" title="=&gt; LazyVals.this.global.analyzer.Typer">localTyper</a>.<a href="../typechecker/Typers.scala.html#507768" title="(tree: LazyVals.this.global.analyzer.global.Tree)LazyVals.this.global.analyzer.global.Tree">typed</a> <span class="delimiter">{</span>
        <span class="keyword">def</span> <a title="=&gt; LazyVals.this.global.gen.global.Tree" id="900120">body</a> = <a href="../Global.scala.html#478214" title="object LazyVals.this.global.gen">gen</a>.<a href="../ast/TreeGen.scala.html#507316" title="(clazz: LazyVals.this.global.gen.global.Symbol, cond: LazyVals.this.global.gen.global.Tree, syncBody: List[LazyVals.this.global.gen.global.Tree], stats: List[LazyVals.this.global.gen.global.Tree])LazyVals.this.global.gen.global.Tree">mkDoubleCheckedLocking</a><span class="delimiter">(</span><a href="#899279" title="LazyVals.this.global.Symbol">methOrClass</a>.<a href="../../../reflect/generic/Symbols.scala.html#435409" title="=&gt; LazyVals.this.global.Symbol">enclClass</a>, <a href="#899973" title="LazyVals.this.global.Apply">cond</a>, <a href="../../../collection/immutable/List.scala.html#48877" title="(xs: LazyVals.this.global.Block*)List[LazyVals.this.global.Block]">List</a><span class="delimiter">(</span><a href="#899971" title="LazyVals.this.global.Block">block</a><span class="delimiter">)</span>, <a href="../../../collection/immutable/List.scala.html#13700" title="object Nil">Nil</a><span class="delimiter">)</span>
        <a href="../ast/TreeDSL.scala.html#515238" title="(xs: LazyVals.this.global.Tree*)LazyVals.this.global.Block">BLOCK</a><span class="delimiter">(</span><a href="#900120" title="=&gt; LazyVals.this.global.gen.global.Tree">body</a>, <a href="#899972" title="LazyVals.this.global.Tree">res</a><span class="delimiter">)</span>
      <span class="delimiter">}</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(bmp: LazyVals.this.global.Symbol, mask: LazyVals.this.global.Tree, bmpRef: LazyVals.this.global.Tree)LazyVals.this.global.Tree" id="899060">mkSetFlag</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="900048">bmp</a>: <a href="../symtab/Symbols.scala.html#478659" title="LazyVals.this.global.Symbol">Symbol</a>, <a title="LazyVals.this.global.Tree" id="900049">mask</a>: <a href="../../../reflect/generic/Trees.scala.html#434028" title="LazyVals.this.global.Tree">Tree</a>, <a title="LazyVals.this.global.Tree" id="900050">bmpRef</a>: <a href="../../../reflect/generic/Trees.scala.html#434028" title="LazyVals.this.global.Tree">Tree</a><span class="delimiter">)</span>: <a href="../../../reflect/generic/Trees.scala.html#434028" title="LazyVals.this.global.Tree">Tree</a> =
      <a href="../ast/TreeDSL.scala.html#515248" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: LazyVals.this.global.Tree)LazyVals.this.CODE.TreeMethods">bmpRef</a> <a href="../ast/TreeDSL.scala.html#547507" title="(rhs: LazyVals.this.global.Tree)LazyVals.this.global.Assign">===</a> <span class="delimiter">(</span><a href="../ast/TreeDSL.scala.html#515248" title="implicit scala.tools.nsc.ast.TreeDSL.CODE.mkTreeMethods : (target: LazyVals.this.global.Tree)LazyVals.this.CODE.TreeMethods">bmpRef</a> <a href="../ast/TreeDSL.scala.html#547495" title="(other: LazyVals.this.global.Tree)LazyVals.this.global.Apply">INT_|</a> <a href="#900049" title="LazyVals.this.global.Tree">mask</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="scala.collection.mutable.Map[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]" id="899061">bitmaps</a> = mutable.<a href="../../../collection/generic/GenMapFactory.scala.html#56702" title="[A, B](elems: (A, B)*)scala.collection.mutable.Map[A,B]">Map</a><span title="(elems: (LazyVals.this.global.Symbol, List[LazyVals.this.global.Symbol])*)scala.collection.mutable.Map[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]" class="delimiter">[</span><a href="../symtab/Symbols.scala.html#478659" title="LazyVals.this.global.Symbol">Symbol</a>, <a href="../../../collection/immutable/List.scala.html#14047" title="List[LazyVals.this.global.Symbol]">List</a><span class="delimiter">[</span>Symbol<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span> <a href="../../../collection/mutable/Map.scala.html#72699" title="(d: List[LazyVals.this.global.Symbol])scala.collection.mutable.Map[LazyVals.this.global.Symbol,List[LazyVals.this.global.Symbol]]">withDefaultValue</a> <a href="../../../collection/immutable/List.scala.html#13700" title="object Nil">Nil</a>

    <span class="comment">/** Return the symbol corresponding of the right bitmap int inside meth,
     *  given offset.
     */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(meth: LazyVals.this.global.Symbol, offset: Int)LazyVals.this.global.Symbol" id="899063">getBitmapFor</a><span class="delimiter">(</span><a title="LazyVals.this.global.Symbol" id="899974">meth</a>: <a href="../symtab/Symbols.scala.html#478659" title="LazyVals.this.global.Symbol">Symbol</a>, <a title="Int" id="899975">offset</a>: <a href="../../../Int.scala.html#386" title="Int">Int</a><span class="delimiter">)</span>: <a href="../symtab/Symbols.scala.html#478659" title="LazyVals.this.global.Symbol">Symbol</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Int" id="900155">n</a> = <a href="#899975" title="Int">offset</a> <a href="../../../Int.scala.html#54825" title="(x: Int)Int">/</a> <a href="#513164" title="=&gt; Int">FLAGS_PER_WORD</a>
      <span class="keyword">val</span> <a title="List[LazyVals.this.global.Symbol]" id="900156">bmps</a> = <a href="../../../collection/MapLike.scala.html#73204" title="(key: LazyVals.this.global.Symbol)List[LazyVals.this.global.Symbol]">bitmaps</a><span class="delimiter">(</span><a href="#899974" title="LazyVals.this.global.Symbol">meth</a><span class="delimiter">)</span>
      <span title="LazyVals.this.global.Symbol" class="keyword">if</span> <span class="delimiter">(</span><a href="#900156" title="List[LazyVals.this.global.Symbol]">bmps</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#71030" title="=&gt; Int">length</a> <a href="../../../Int.scala.html#54775" title="(x: Int)Boolean">&gt;</a> <a href="#900155" title="Int">n</a><span class="delimiter">)</span>
        <a href="../../../collection/LinearSeqOptimized.scala.html#71031" title="(n: Int)LazyVals.this.global.Symbol">bmps</a><span class="delimiter">(</span><a href="#900155" title="Int">n</a><span class="delimiter">)</span>
      <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="LazyVals.this.global.TermSymbol" id="900187">sym</a> = <a href="#899974" title="LazyVals.this.global.Symbol">meth</a>.<a href="../symtab/Symbols.scala.html#509127" title="(pos: LazyVals.this.global.Position, name: LazyVals.this.global.TermName)LazyVals.this.global.TermSymbol">newVariable</a><span class="delimiter">(</span><a href="#899974" title="LazyVals.this.global.Symbol">meth</a>.<a href="../symtab/Symbols.scala.html#509109" title="=&gt; LazyVals.this.global.Position">pos</a>, <a href="../symtab/StdNames.scala.html#479055" title="object LazyVals.this.global.nme">nme</a>.<a href="../symtab/StdNames.scala.html#516765" title="(n: Int)LazyVals.this.global.TermName">bitmapName</a><span class="delimiter">(</span><a href="#900155" title="Int">n</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../symtab/Symbols.scala.html#509274" title="(info: LazyVals.this.global.Type)LazyVals.this.global.TermSymbol">setInfo</a><span class="delimiter">(</span><a href="../symtab/Definitions.scala.html#508431" title="=&gt; LazyVals.this.global.Symbol">IntClass</a>.<a href="../symtab/Symbols.scala.html#509270" title="=&gt; LazyVals.this.global.Type">tpe</a><span class="delimiter">)</span>
        <a href="../symtab/SymbolTable.scala.html#478184" title="(ph: scala.tools.nsc.Phase)(op: =&gt; Unit)Unit">atPhase</a><span class="delimiter">(</span><a href="../Global.scala.html#478362" title="=&gt; LazyVals.this.global.Run">currentRun</a>.<a href="../Global.scala.html#482526" title="=&gt; scala.tools.nsc.Phase">typerPhase</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#900187" title="LazyVals.this.global.TermSymbol">sym</a> <a href="../symtab/Symbols.scala.html#509118" title="(annot: LazyVals.this.global.AnnotationInfo)Unit">addAnnotation</a> <a href="../symtab/AnnotationInfos.scala.html#533292" title="(atp: LazyVals.this.global.Type, args: List[LazyVals.this.global.Tree], assocs: List[(LazyVals.this.global.Name, LazyVals.this.global.ClassfileAnnotArg)])LazyVals.this.global.AnnotationInfo">AnnotationInfo</a><span class="delimiter">(</span><a href="../symtab/Definitions.scala.html#508335" title="=&gt; LazyVals.this.global.Symbol">VolatileAttr</a>.<a href="../symtab/Symbols.scala.html#509270" title="=&gt; LazyVals.this.global.Type">tpe</a>, <a href="../../../collection/immutable/List.scala.html#13700" title="object Nil">Nil</a>, <a href="../../../collection/immutable/List.scala.html#13700" title="object Nil">Nil</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

        <a href="../../../collection/mutable/MapLike.scala.html#73272" title="(key: LazyVals.this.global.Symbol, value: List[LazyVals.this.global.Symbol])Unit">bitmaps</a><span class="delimiter">(</span><a href="#899974" title="LazyVals.this.global.Symbol">meth</a><span class="delimiter">)</span> = <span class="delimiter">(</span><a href="#900187" title="LazyVals.this.global.TermSymbol">sym</a> <a href="../../../collection/immutable/List.scala.html#49140" title="(x: LazyVals.this.global.Symbol)List[LazyVals.this.global.Symbol]">::</a> <a href="#900156" title="List[LazyVals.this.global.Symbol]">bmps</a><span class="delimiter">)</span>.<a href="../../../collection/immutable/List.scala.html#49171" title="=&gt; List[LazyVals.this.global.Symbol]">reverse</a>
        <a href="#900187" title="LazyVals.this.global.TermSymbol">sym</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
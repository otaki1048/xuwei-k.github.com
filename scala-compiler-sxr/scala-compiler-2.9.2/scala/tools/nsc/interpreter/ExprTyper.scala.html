<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/nsc/interpreter/ExprTyper.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* NSC -- new Scala compiler
 * Copyright 2005-2011 LAMP/EPFL
 * @author  Paul Phillips
 */</span>

<span class="keyword">package</span> scala.tools.nsc
<span class="keyword">package</span> interpreter

<span class="keyword">import</span> util.BatchSourceFile
<span class="keyword">import</span> ast.parser.<a href="../ast/parser/Tokens.scala.html#24609" title="object scala.tools.nsc.ast.parser.Tokens">Tokens</a>.EOF

<span class="keyword">trait</span> <a title="trait ExprTyper extends java.lang.Object with ScalaObject" id="31062">ExprTyper</a> <a href="../../../ScalaObject.scala.html#464" title="ScalaObject" class="delimiter">{</a>
  <span class="keyword">val</span> <a title="=&gt; scala.tools.nsc.interpreter.IMain" id="733343">repl</a>: <a href="IMain.scala.html#31896" title="scala.tools.nsc.interpreter.IMain">IMain</a>
  <span class="keyword">import</span> <a href="#733343" title="=&gt; scala.tools.nsc.interpreter.IMain">repl</a>._
  <span class="keyword">import</span> <a href="IMain.scala.html#523020" title="=&gt; scala.tools.nsc.Global">global</a>.<span class="delimiter">{</span> reporter =&gt; _, _ <span class="delimiter">}</span>
  <span class="keyword">import</span> <a href="../Global.scala.html#478280" title="object ExprTyper.this.repl.global.syntaxAnalyzer">syntaxAnalyzer</a>.UnitParser
  <span class="keyword">import</span> <a href="IMain.scala.html#523026" title="object ExprTyper.this.repl.naming">naming</a>.freshInternalVarName

  <span class="keyword">object</span> <a title="object ExprTyper.this.codeParser" id="733348">codeParser</a> <a href="../../../ScalaObject.scala.html#464" title="ScalaObject" class="keyword">extends</a> <span class="delimiter">{</span> <span class="keyword">val</span> <a title="ExprTyper.this.repl.global.type" id="733377">global</a>: repl.global.<span class="keyword">type</span> = <a href="#733343" title="=&gt; scala.tools.nsc.interpreter.IMain">repl</a>.<a href="IMain.scala.html#523020" title="=&gt; scala.tools.nsc.Global">global</a> <span class="delimiter">}</span> <span class="keyword">with</span> <a href="CodeHandlers.scala.html#30624" title="scala.tools.nsc.interpreter.CodeHandlers[ExprTyper.this.repl.global.Tree]">CodeHandlers</a><span class="delimiter">[</span>Tree<span class="delimiter">]</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="[T](code: String, rule: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; T)T" id="733364">applyRule</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="733366">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="String" id="733378">code</a>: <span title="String">String</span>, <a title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; T" id="733379">rule</a>: UnitParser =&gt; T<span class="delimiter">)</span>: <a href="#733366" title="T">T</a> = <span class="delimiter">{</span>
      <a href="IMain.scala.html#522994" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/AbstractReporter.scala.html#482446" title="()Unit">reset</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="ExprTyper.this.repl.global.CompilationUnit" id="733383">unit</a>    = <span title="ExprTyper.this.repl.global.CompilationUnit" class="keyword">new</span> <a href="../CompilationUnits.scala.html#479284" title="ExprTyper.this.repl.global.CompilationUnit">CompilationUnit</a><span class="delimiter">(</span><a href="../util/SourceFile.scala.html#501064" title="(sourceName: String, cs: Seq[Char])scala.tools.nsc.util.BatchSourceFile" class="keyword">new</a> <a href="../util/SourceFile.scala.html#42877" title="scala.tools.nsc.util.BatchSourceFile">BatchSourceFile</a><span class="delimiter">(</span><span title="java.lang.String(&quot;&lt;console&gt;&quot;)" class="string">&quot;&lt;console&gt;&quot;</span>, <a href="../../../LowPriorityImplicits.scala.html#9503" title="implicit scala.LowPriorityImplicits.wrapString : (s: String)scala.collection.immutable.WrappedString">code</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser" id="733384">scanner</a> = <a href="../ast/parser/Parsers.scala.html#568812" title="(unit: ExprTyper.this.repl.global.syntaxAnalyzer.global.CompilationUnit)ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser" class="keyword">new</a> <a href="../ast/parser/Parsers.scala.html#500549" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">UnitParser</a><span class="delimiter">(</span><a href="#733383" title="ExprTyper.this.repl.global.CompilationUnit">unit</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="T" id="733385">result</a>  = <a href="../../../Function1.scala.html#53453" title="(v1: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser)T">rule</a><span class="delimiter">(</span><a href="#733384" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">scanner</a><span class="delimiter">)</span>
      <span title="AnyVal" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#55576" title="=&gt; Boolean">!</a><a href="IMain.scala.html#522994" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#479335" title="=&gt; Boolean">hasErrors</a><span class="delimiter">)</span>
        <a href="#733384" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">scanner</a>.<a href="../ast/parser/Parsers.scala.html#566390" title="(token: Int)Int">accept</a><span class="delimiter">(</span><span title="Int(0)">EOF</span><span class="delimiter">)</span>

      <a href="#733385" title="T">result</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="(code: String)Nothing" id="733367">decl</a><span class="delimiter">(</span><a title="String" id="733423">code</a>: <span title="String">String</span><span class="delimiter">)</span>  = <a href="CodeHandlers.scala.html#30625" title="object scala.tools.nsc.interpreter.CodeHandlers">CodeHandlers</a>.<a href="CodeHandlers.scala.html#729583" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="java.lang.String(&quot;todo&quot;)" class="string">&quot;todo&quot;</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)Nothing" id="733368">defn</a><span class="delimiter">(</span><a title="String" id="733426">code</a>: <span title="String">String</span><span class="delimiter">)</span>  = <a href="CodeHandlers.scala.html#30625" title="object scala.tools.nsc.interpreter.CodeHandlers">CodeHandlers</a>.<a href="CodeHandlers.scala.html#729583" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="java.lang.String(&quot;todo&quot;)" class="string">&quot;todo&quot;</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree" id="733369">expr</a><span class="delimiter">(</span><a title="String" id="733429">code</a>: <span title="String">String</span><span class="delimiter">)</span>  = <a href="#733364" title="(code: String, rule: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree)ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">applyRule</a><span class="delimiter">(</span><a href="#733429" title="String">code</a>, <a href="#733436" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">_</a>.<a href="../ast/parser/Parsers.scala.html#566478" title="()ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">expr</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree" id="733370">impt</a><span class="delimiter">(</span><a title="String" id="733444">code</a>: <span title="String">String</span><span class="delimiter">)</span>  = <a href="#733364" title="(code: String, rule: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree)ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">applyRule</a><span class="delimiter">(</span><a href="#733444" title="String">code</a>, <a href="#733451" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">_</a>.<a href="../ast/parser/Parsers.scala.html#566533" title="()ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">importExpr</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]" id="733371">impts</a><span class="delimiter">(</span><a title="String" id="733454">code</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#733364" title="(code: String, rule: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree])List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">applyRule</a><span class="delimiter">(</span><a href="#733454" title="String">code</a>, <a href="#733461" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">_</a>.<a href="../ast/parser/Parsers.scala.html#566532" title="()List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">importClause</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]" id="733372">stmts</a><span class="delimiter">(</span><a title="String" id="733464">code</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#733364" title="(code: String, rule: ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser =&gt; List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree])List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">applyRule</a><span class="delimiter">(</span><a href="#733464" title="String">code</a>, <a href="#733472" title="ExprTyper.this.repl.global.syntaxAnalyzer.UnitParser">_</a>.<a href="../ast/parser/Parsers.scala.html#566561" title="(isPre: Boolean)(ExprTyper.this.repl.global.syntaxAnalyzer.global.ValDef, List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree])">templateStatSeq</a><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>.<a href="../../../Tuple2.scala.html#53404" title="=&gt; List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">_2</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="(code: String)ExprTyper.this.repl.global.Tree" id="733373">stmt</a><span class="delimiter">(</span><a title="String" id="733476">code</a>: <span title="String">String</span><span class="delimiter">)</span>  = <a href="#733372" title="(code: String)List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">stmts</a><span class="delimiter">(</span><a href="#733476" title="String">code</a><span class="delimiter">)</span> <span title="ExprTyper.this.repl.global.Tree" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="../../../collection/generic/GenSeqFactory.scala.html#48862" title="ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">List</a><span class="delimiter">(</span><a title="ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree" id="733496">t</a><span class="delimiter">)</span>  =&gt; <a href="#733496" title="ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree">t</a>
      <span class="keyword">case</span> <a title="Nothing" id="733497">xs</a>       =&gt; <a href="CodeHandlers.scala.html#30625" title="object scala.tools.nsc.interpreter.CodeHandlers">CodeHandlers</a>.<a href="CodeHandlers.scala.html#729583" title="(msg: String)Nothing">fail</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Not a single statement: &quot;)" class="string">&quot;Not a single statement: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#733497" title="List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">xs</a>.<a href="../../../collection/TraversableOnce.scala.html#53709" title="(sep: String)String">mkString</a><span class="delimiter">(</span><span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Parse a line into a sequence of trees. Returns None if the input is incomplete. */</span>
  <span class="keyword">def</span> <a title="(line: String)Option[List[ExprTyper.this.repl.global.Tree]]" id="733350">parse</a><span class="delimiter">(</span><a title="String" id="733500">line</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../../../Option.scala.html#560" title="Option[List[ExprTyper.this.repl.global.Tree]]">Option</a><span class="delimiter">[</span>List<span class="delimiter">[</span>Tree<span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Boolean" id="733502">isIncomplete</a> = <span title="Boolean(false)" class="keyword">false</span>
    <a href="IMain.scala.html#522994" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#479329" title="(handler: (scala.tools.nsc.util.Position, String) =&gt; Unit)(thunk: =&gt; Option[List[ExprTyper.this.repl.global.Tree]])Option[List[ExprTyper.this.repl.global.Tree]]">withIncompleteHandler</a><span class="delimiter">(</span><span class="delimiter">(</span><a title="scala.tools.nsc.util.Position" id="733514">_</a>, <a title="String" id="733515">_</a><span class="delimiter">)</span> =&gt; <a href="#733502" title="Boolean">isIncomplete</a> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]" id="733517">trees</a> = <a href="#733348" title="object ExprTyper.this.codeParser">codeParser</a>.<a href="#733372" title="(code: String)List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">stmts</a><span class="delimiter">(</span><a href="#733500" title="String">line</a><span class="delimiter">)</span>
      <span title="Option[List[ExprTyper.this.repl.global.Tree]]" class="keyword">if</span> <span class="delimiter">(</span><a href="IMain.scala.html#522994" title="=&gt; scala.tools.nsc.reporters.ConsoleReporter">reporter</a>.<a href="../reporters/Reporter.scala.html#479335" title="=&gt; Boolean">hasErrors</a><span class="delimiter">)</span> <a href="../../../Option.scala.html#57885" title="(x: scala.collection.immutable.Nil.type)Some[scala.collection.immutable.Nil.type]">Some</a><span class="delimiter">(</span><a href="../../../collection/immutable/List.scala.html#13700" title="object Nil">Nil</a><span class="delimiter">)</span>
      <span class="keyword">else</span> <span title="Option[List[ExprTyper.this.repl.global.Tree]]" class="keyword">if</span> <span class="delimiter">(</span><a href="#733502" title="Boolean">isIncomplete</a><span class="delimiter">)</span> <a href="../../../Option.scala.html#1737" title="object None">None</a>
      <span class="keyword">else</span> <a href="../../../Option.scala.html#57885" title="(x: List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree])Some[List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]]">Some</a><span class="delimiter">(</span><a href="#733517" title="List[ExprTyper.this.repl.global.syntaxAnalyzer.global.Tree]">trees</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">// TODO: integrate these into a CodeHandler[Type].</span>

  <span class="comment">// XXX literals.</span>
  <span class="comment">// 1) Identifiers defined in the repl.</span>
  <span class="comment">// 2) A path loadable via getModule.</span>
  <span class="comment">// 3) Try interpreting it as an expression.</span>
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="733352">typeOfExpressionDepth</a> = <span title="Int(0)" class="int">0</span>
  <span class="keyword">def</span> <a title="(expr: String, silent: Boolean)Option[ExprTyper.this.repl.global.Type]" id="733354">typeOfExpression</a><span class="delimiter">(</span><a title="String" id="733531">expr</a>: <span title="String">String</span>, <a title="Boolean" id="733534">silent</a>: <a href="../../../Boolean.scala.html#65" title="Boolean">Boolean</a> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>: <a href="../../../Option.scala.html#560" title="Option[ExprTyper.this.repl.global.Type]">Option</a><span class="delimiter">[</span>Type<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="ReplConfig.scala.html#48207" title="(msg: =&gt; String)Unit">repltrace</a><span class="delimiter">(</span><span title="java.lang.String(&quot;typeOfExpression(&quot;)" class="string">&quot;typeOfExpression(&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#733531" title="String">expr</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;)&quot;)" class="string">&quot;)&quot;</span><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#733352" title="=&gt; Int">typeOfExpressionDepth</a> <a href="../../../Int.scala.html#54775" title="(x: Int)Boolean">&gt;</a> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="ReplConfig.scala.html#48206" title="(msg: =&gt; String)Unit">repldbg</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Terminating typeOfExpression recursion for expression: &quot;)" class="string">&quot;Terminating typeOfExpression recursion for expression: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#733531" title="String">expr</a><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span> <a href="../../../Option.scala.html#1737" title="object None">None</a>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="=&gt; Option[ExprTyper.this.repl.global.Type]" id="733535">asQualifiedImport</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="String" id="733561">name</a> = <a href="../../../Predef.scala.html#9682" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">expr</a>.<a href="../../../collection/IndexedSeqOptimized.scala.html#55972" title="(p: Char =&gt; Boolean)String">takeWhile</a><span class="delimiter">(</span><a href="#733811" title="Char">_</a> <a href="../../../Char.scala.html#54909" title="(x: Char)Boolean">!=</a> <span title="Char(\'.\')" class="char">'.'</span><span class="delimiter">)</span>
      <a href="Imports.scala.html#522971" title="(name: String)Option[ExprTyper.this.repl.global.TermSymbol]">importedTermNamed</a><span class="delimiter">(</span><a href="#733561" title="String">name</a><span class="delimiter">)</span> <a href="../../../Option.scala.html#48483" title="(f: ExprTyper.this.repl.global.TermSymbol =&gt; Option[ExprTyper.this.repl.global.Type])Option[ExprTyper.this.repl.global.Type]">flatMap</a> <span class="delimiter">{</span> <a title="ExprTyper.this.repl.global.TermSymbol" id="734378">sym</a> =&gt;
        <a href="#733354" title="(expr: String, silent: Boolean)Option[ExprTyper.this.repl.global.Type]">typeOfExpression</a><span class="delimiter">(</span><a href="#734378" title="ExprTyper.this.repl.global.TermSymbol">sym</a>.<a href="../../../reflect/generic/Symbols.scala.html#435348" title="=&gt; String">fullName</a> <span title="(x$1: Any)java.lang.String">+</span> <a href="../../../Predef.scala.html#9682" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">expr</a>.<a href="../../../collection/IndexedSeqOptimized.scala.html#55968" title="(n: Int)String">drop</a><span class="delimiter">(</span><a href="#733561" title="String">name</a>.<span title="()Int">length</span><span class="delimiter">)</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="=&gt; Option[ExprTyper.this.repl.global.Type]" id="733536">asModule</a> = <a href="IMain.scala.html#523122" title="(name: String)Option[ExprTyper.this.repl.global.Symbol]">safeModule</a><span class="delimiter">(</span><a href="#733531" title="String">expr</a><span class="delimiter">)</span> <a href="../../../Option.scala.html#48480" title="(f: ExprTyper.this.repl.global.Symbol =&gt; ExprTyper.this.repl.global.Type)Option[ExprTyper.this.repl.global.Type]">map</a> <span class="delimiter">(</span><a href="#734506" title="ExprTyper.this.repl.global.Symbol">_</a>.<a href="../symtab/Symbols.scala.html#509270" title="=&gt; ExprTyper.this.repl.global.Type">tpe</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="=&gt; Option[ExprTyper.this.repl.global.Type]" id="733537">asExpr</a> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="String" id="734508">lhs</a> = <a href="Naming.scala.html#733169" title="()String">freshInternalVarName</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.lang.String" id="734509">line</a> = <span title="java.lang.String(&quot;lazy val &quot;)" class="string">&quot;lazy val &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#734508" title="String">lhs</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; =\012&quot;)" class="string">&quot; =\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#733531" title="String">expr</a>

      <a href="IMain.scala.html#523101" title="(line: String, synthetic: Boolean)scala.tools.nsc.interpreter.package.IR.Result">interpret</a><span class="delimiter">(</span><a href="#734509" title="java.lang.String">line</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <span title="Option[ExprTyper.this.repl.global.Type]" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="package.scala.html#48223" title="Option[ExprTyper.this.repl.global.Type]">IR</a>.<a href="Results.scala.html#734553" title="object scala.tools.nsc.interpreter.package.IR.Success">Success</a> =&gt; <a href="#733354" title="(expr: String, silent: Boolean)Option[ExprTyper.this.repl.global.Type]">typeOfExpression</a><span class="delimiter">(</span><a href="#734508" title="String">lhs</a>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="None.type">_</span>          =&gt; <a href="../../../Option.scala.html#1737" title="object None">None</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="()Option[ExprTyper.this.repl.global.Type]" id="733538">evaluate</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="#733352" title="(x$1: Int)Unit">typeOfExpressionDepth</a> <a href="../../../Int.scala.html#54804" title="(x: Int)Int">+=</a> <span title="Int(1)" class="int">1</span>
      <span class="keyword">try</span> <a href="IMain.scala.html#523126" title="(id: String)Option[ExprTyper.this.repl.global.Type]">typeOfTerm</a><span class="delimiter">(</span><a href="#733531" title="String">expr</a><span class="delimiter">)</span> <a href="../../../Option.scala.html#48497" title="(alternative: =&gt; Option[ExprTyper.this.repl.global.Type])Option[ExprTyper.this.repl.global.Type]">orElse</a> <a href="#733536" title="=&gt; Option[ExprTyper.this.repl.global.Type]">asModule</a> <a href="../../../Option.scala.html#48497" title="(alternative: =&gt; Option[ExprTyper.this.repl.global.Type])Option[ExprTyper.this.repl.global.Type]">orElse</a> <a href="#733537" title="=&gt; Option[ExprTyper.this.repl.global.Type]">asExpr</a> <a href="../../../Option.scala.html#48497" title="(alternative: =&gt; Option[ExprTyper.this.repl.global.Type])Option[ExprTyper.this.repl.global.Type]">orElse</a> <a href="#733535" title="=&gt; Option[ExprTyper.this.repl.global.Type]">asQualifiedImport</a>
      <span class="keyword">finally</span> <a href="#733352" title="(x$1: Int)Unit">typeOfExpressionDepth</a> <a href="../../../Int.scala.html#54811" title="(x: Int)Int">-=</a> <span title="Int(1)" class="int">1</span>
    <span class="delimiter">}</span>

    <span class="comment">// Don't presently have a good way to suppress undesirable success output</span>
    <span class="comment">// while letting errors through, so it is first trying it silently: if there</span>
    <span class="comment">// is an error, and errors are desired, then it re-evaluates non-silently</span>
    <span class="comment">// to induce the error message.</span>
    <a href="IMain.scala.html#523041" title="(operation: =&gt; Option[ExprTyper.this.repl.global.Type])Option[ExprTyper.this.repl.global.Type]">beSilentDuring</a><span class="delimiter">(</span><a href="#733538" title="()Option[ExprTyper.this.repl.global.Type]">evaluate</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../Option.scala.html#48497" title="(alternative: =&gt; Option[ExprTyper.this.repl.global.Type])Option[ExprTyper.this.repl.global.Type]">orElse</a> <a href="IMain.scala.html#523041" title="(operation: =&gt; Option[ExprTyper.this.repl.global.Type])Option[ExprTyper.this.repl.global.Type]">beSilentDuring</a><span class="delimiter">(</span><a href="#733355" title="(code: String)Option[ExprTyper.this.repl.global.Type]">typeOfDeclaration</a><span class="delimiter">(</span><a href="#733531" title="String">expr</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../../../Option.scala.html#48497" title="(alternative: =&gt; Option[ExprTyper.this.repl.global.Type])Option[ExprTyper.this.repl.global.Type]">orElse</a> <span class="delimiter">{</span>
      <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="../../../Boolean.scala.html#55576" title="=&gt; Boolean">!</a><a href="#733534" title="Boolean">silent</a><span class="delimiter">)</span>
        <a href="#733538" title="()Option[ExprTyper.this.repl.global.Type]">evaluate</a><span class="delimiter">(</span><span class="delimiter">)</span>

      <a href="../../../Option.scala.html#1737" title="object None">None</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  <span class="comment">// Since people will be giving us &quot;:t def foo = 5&quot; even though that is not an</span>
  <span class="comment">// expression, we have a means of typing declarations too.</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(code: String)Option[ExprTyper.this.repl.global.Type]" id="733355">typeOfDeclaration</a><span class="delimiter">(</span><a title="String" id="734595">code</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../../../Option.scala.html#560" title="Option[ExprTyper.this.repl.global.Type]">Option</a><span class="delimiter">[</span>Type<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="ReplConfig.scala.html#48207" title="(msg: =&gt; String)Unit">repltrace</a><span class="delimiter">(</span><span title="java.lang.String(&quot;typeOfDeclaration(&quot;)" class="string">&quot;typeOfDeclaration(&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#734595" title="String">code</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;)&quot;)" class="string">&quot;)&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="String" id="734610">obname</a> = <a href="Naming.scala.html#733169" title="()String">freshInternalVarName</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <a href="IMain.scala.html#523101" title="(line: String, synthetic: Boolean)scala.tools.nsc.interpreter.package.IR.Result">interpret</a><span class="delimiter">(</span><span title="java.lang.String(&quot;object &quot;)" class="string">&quot;object &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#734610" title="String">obname</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; {\012&quot;)" class="string">&quot; {\n&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#734595" title="String">code</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\012}\012&quot;)" class="string">&quot;\n}\n&quot;</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <span title="Option[ExprTyper.this.repl.global.Type]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="package.scala.html#48223" title="Option[ExprTyper.this.repl.global.Type]">IR</a>.<a href="Results.scala.html#734553" title="object scala.tools.nsc.interpreter.package.IR.Success">Success</a> =&gt;
        <span class="keyword">val</span> <a title="ExprTyper.this.repl.global.Symbol" id="734613">sym</a> = <a href="IMain.scala.html#523127" title="(id: String)ExprTyper.this.repl.global.Symbol">symbolOfTerm</a><span class="delimiter">(</span><a href="#734610" title="String">obname</a><span class="delimiter">)</span>
        <span title="Option[ExprTyper.this.repl.global.Type]" class="keyword">if</span> <span class="delimiter">(</span><a href="#734613" title="ExprTyper.this.repl.global.Symbol">sym</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="../symtab/Symbols.scala.html#478667" title="object ExprTyper.this.repl.global.NoSymbol">NoSymbol</a><span class="delimiter">)</span> <a href="../../../Option.scala.html#1737" title="object None">None</a> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="comment">// TODO: bitmap$n is not marked synthetic.</span>
          <span class="keyword">val</span> <a title="List[ExprTyper.this.repl.global.Symbol]" id="734620">decls</a> = <a href="#734613" title="ExprTyper.this.repl.global.Symbol">sym</a>.<a href="../symtab/Symbols.scala.html#509270" title="=&gt; ExprTyper.this.repl.global.Type">tpe</a>.<a href="../symtab/Types.scala.html#507192" title="=&gt; ExprTyper.this.repl.global.Scope">decls</a>.<a href="../symtab/Scopes.scala.html#514371" title="=&gt; List[ExprTyper.this.repl.global.Symbol]">toList</a> <a href="../../../collection/TraversableLike.scala.html#49052" title="(p: ExprTyper.this.repl.global.Symbol =&gt; Boolean)List[ExprTyper.this.repl.global.Symbol]">filterNot</a> <span class="delimiter">(</span><a title="ExprTyper.this.repl.global.Symbol" id="734635">x</a> =&gt; <a href="#734635" title="ExprTyper.this.repl.global.Symbol">x</a>.<a href="../symtab/Symbols.scala.html#509180" title="=&gt; Boolean">isConstructor</a> <a href="../../../Boolean.scala.html#55579" title="(x: Boolean)Boolean">||</a> <a href="#734635" title="ExprTyper.this.repl.global.Symbol">x</a>.<a href="../../../reflect/generic/HasFlags.scala.html#435302" title="=&gt; Boolean">isPrivate</a> <a href="../../../Boolean.scala.html#55579" title="(x: Boolean)Boolean">||</a> <span class="delimiter">(</span><a href="#734635" title="ExprTyper.this.repl.global.Symbol">x</a>.<a href="../symtab/Symbols.scala.html#509256" title="=&gt; ExprTyper.this.repl.global.Name">name</a>.<a href="../symtab/Names.scala.html#501123" title="()String">toString</a> <span title="(x$1: java.lang.CharSequence)Boolean">contains</span> <span title="java.lang.String(&quot;$&quot;)" class="string">&quot;$&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="ReplConfig.scala.html#48207" title="(msg: =&gt; String)Unit">repltrace</a><span class="delimiter">(</span><span title="java.lang.String(&quot;decls: &quot;)" class="string">&quot;decls: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#734620" title="List[ExprTyper.this.repl.global.Symbol]">decls</a><span class="delimiter">)</span>
          <a href="#734620" title="List[ExprTyper.this.repl.global.Symbol]">decls</a>.<a href="../../../collection/TraversableLike.scala.html#49084" title="=&gt; Option[ExprTyper.this.repl.global.Symbol]">lastOption</a> <a href="../../../Option.scala.html#48480" title="(f: ExprTyper.this.repl.global.Symbol =&gt; ExprTyper.this.repl.global.Type)Option[ExprTyper.this.repl.global.Type]">map</a> <span class="delimiter">(</span><a title="ExprTyper.this.repl.global.Symbol" id="734640">decl</a> =&gt; <a href="IMain.scala.html#523099" title="(sym: ExprTyper.this.repl.global.Symbol, memberName: ExprTyper.this.repl.global.Name)ExprTyper.this.repl.global.Type">typeCleanser</a><span class="delimiter">(</span><a href="#734613" title="ExprTyper.this.repl.global.Symbol">sym</a>, <a href="#734640" title="ExprTyper.this.repl.global.Symbol">decl</a>.<a href="../symtab/Symbols.scala.html#509256" title="=&gt; ExprTyper.this.repl.global.Name">name</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="None.type">_</span>          =&gt;
        <a href="../../../Option.scala.html#1737" title="object None">None</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  <span class="comment">// def compileAndTypeExpr(expr: String): Option[Typer] = {</span>
  <span class="comment">//   class TyperRun extends Run {</span>
  <span class="comment">//     override def stopPhase(name: String) = name == &quot;superaccessors&quot;</span>
  <span class="comment">//   }</span>
  <span class="comment">// }</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/tools/ant/ScalaBazaar.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*                     __                                               *\
**     ________ ___   / /  ___     Scala Ant Tasks                      **
**    / __/ __// _ | / /  / _ |    (c) 2005-2011, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */</span>



<span class="keyword">package</span> scala.tools.ant <span class="delimiter">{</span>

  <span class="keyword">import</span> scala.collection.DefaultMap
  <span class="keyword">import</span> scala.collection.mutable.HashMap
  <span class="keyword">import</span> java.io.<span class="delimiter">{</span>File, FileInputStream, FileOutputStream,
                  FileWriter, StringReader<span class="delimiter">}</span>
  <span class="keyword">import</span> java.net.URL
  <span class="keyword">import</span> java.util.ArrayList
  <span class="keyword">import</span> java.util.zip.<span class="delimiter">{</span>ZipOutputStream, ZipEntry<span class="delimiter">}</span>

  <span class="keyword">import</span> org.apache.tools.ant.<span class="delimiter">{</span>AntClassLoader, BuildException,
                               DirectoryScanner, Project<span class="delimiter">}</span>
  <span class="keyword">import</span> org.apache.tools.ant.Task
  <span class="keyword">import</span> org.apache.tools.ant.types.Path
  <span class="keyword">import</span> org.apache.tools.ant.util.<span class="delimiter">{</span>FileUtils, MergingMapper,
                                    SourceFileScanner<span class="delimiter">}</span>
  <span class="keyword">import</span> org.apache.tools.ant.types.<span class="delimiter">{</span>EnumeratedAttribute, Reference, FileSet<span class="delimiter">}</span>

  <span class="comment">/** A set of files that can be installed at any relative location */</span>
    <span class="keyword">class</span> <a title="class LooseFileSet extends java.lang.Object with ScalaObject" id="21585">LooseFileSet</a> <a href="../../ScalaObject.scala.html#464" title="ScalaObject" class="delimiter">{</a>
      <span class="keyword">var</span> <a title="Option[String]" id="474725">destination</a>: <a href="../../Option.scala.html#560" title="Option[String]">Option</a><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="../../Option.scala.html#1737" title="object None">None</a>
      <span class="keyword">def</span> <a title="(dest: String)Unit" id="474727">setDestination</a><span class="delimiter">(</span><a title="String" id="474735">dest</a>: <span title="String">String</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
        <a href="#474725" title="(x$1: Option[String])Unit">destination</a> = <a href="../../Option.scala.html#57885" title="(x: String)Some[String]">Some</a><span class="delimiter">(</span><a href="#474735" title="String">dest</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <span class="keyword">var</span> <a title="Option[org.apache.tools.ant.types.FileSet]" id="474729">fileset</a>: <a href="../../Option.scala.html#560" title="Option[org.apache.tools.ant.types.FileSet]">Option</a><span class="delimiter">[</span>FileSet<span class="delimiter">]</span> = <a href="../../Option.scala.html#1737" title="object None">None</a>
      <span class="keyword">def</span> <a title="(fs: org.apache.tools.ant.types.FileSet)Unit" id="474731">addConfiguredFileSet</a><span class="delimiter">(</span><a title="org.apache.tools.ant.types.FileSet" id="474741">fs</a>: <span title="org.apache.tools.ant.types.FileSet">FileSet</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
        <a href="#474729" title="(x$1: Option[org.apache.tools.ant.types.FileSet])Unit">fileset</a> = <a href="../../Option.scala.html#57885" title="(x: org.apache.tools.ant.types.FileSet)Some[org.apache.tools.ant.types.FileSet]">Some</a><span class="delimiter">(</span><a href="#474741" title="org.apache.tools.ant.types.FileSet">fs</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="comment">/** An Ant task that generates a Scala Bazaars package (sbp file) along
    * with an advertisement of that package.
    *
    * This task can take the following parameters as attributes:&lt;ul&gt;
    *  &lt;li&gt;file (mandatory),&lt;/li&gt;
    *  &lt;li&gt;adfile,&lt;/li&gt;
    *  &lt;li&gt;name (mandatory),&lt;/li&gt;
    *  &lt;li&gt;version (mandatory),&lt;/li&gt;
    *  &lt;li&gt;depends,&lt;/li&gt;
    *  &lt;li&gt;description,&lt;/li&gt;
    *  &lt;li&gt;link.&lt;/li&gt;
    *  &lt;/ul&gt;
    *
    * @author Gilles Dubochet */</span>
  <span class="keyword">class</span> <a title="class ScalaBazaar extends org.apache.tools.ant.Task with scala.tools.ant.ScalaTask with ScalaObject" id="21537">ScalaBazaar</a> <a href="../../ScalaObject.scala.html#464" title="ScalaObject" class="keyword">extends</a> <span title="org.apache.tools.ant.Task">Task</span> <span class="keyword">with</span> <a href="ScalaMatchingTask.scala.html#21669" title="scala.tools.ant.ScalaTask">ScalaTask</a> <span class="delimiter">{</span>

    <span class="comment">/** The unique Ant file utilities instance to use in this task. */</span>
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="org.apache.tools.ant.util.FileUtils" id="474748">fileUtils</a> = <span title="object org.apache.tools.ant.util.FileUtils">FileUtils</span>.<span title="()org.apache.tools.ant.util.FileUtils">getFileUtils</span><span class="delimiter">(</span><span class="delimiter">)</span>

<span class="comment">/******************************************************************************\
**                             Ant user-properties                            **
\******************************************************************************/</span>

    <span class="comment">/** The path to the archive file. */</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <a title="Option[java.io.File]" id="474751">file</a>: <a href="../../Option.scala.html#560" title="Option[java.io.File]">Option</a><span class="delimiter">[</span>File<span class="delimiter">]</span> = <a href="../../Option.scala.html#1737" title="object None">None</a>
    <span class="comment">/** The optional path to the advertisement file. */</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <a title="Option[java.io.File]" id="474754">adfile</a>: <a href="../../Option.scala.html#560" title="Option[java.io.File]">Option</a><span class="delimiter">[</span>File<span class="delimiter">]</span> = <a href="../../Option.scala.html#1737" title="object None">None</a>
    <span class="comment">/** The name of the package. */</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <a title="Option[String]" id="474757">name</a>: <a href="../../Option.scala.html#560" title="Option[String]">Option</a><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="../../Option.scala.html#1737" title="object None">None</a>
    <span class="comment">/** The version number of the package. */</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <a title="Option[String]" id="474760">version</a>: <a href="../../Option.scala.html#560" title="Option[String]">Option</a><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="../../Option.scala.html#1737" title="object None">None</a>
    <span class="comment">/** An (optional) list of names of the packages it depends of. */</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <a title="List[String]" id="474763">depends</a>: <a href="../../collection/immutable/List.scala.html#14047" title="List[String]">List</a><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="../../collection/immutable/List.scala.html#13700" title="object Nil">Nil</a>
    <span class="comment">/** An (optional) description of this package. */</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <a title="Option[String]" id="474766">desc</a>: <a href="../../Option.scala.html#560" title="Option[String]">Option</a><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="../../Option.scala.html#1737" title="object None">None</a>
    <span class="comment">/** An (optional) URL link pointing to the location of the package */</span>
    <span class="keyword">private</span> <span class="keyword">var</span> <a title="Option[String]" id="474769">link</a>: <a href="../../Option.scala.html#560" title="Option[String]">Option</a><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="../../Option.scala.html#1737" title="object None">None</a>

    <span class="comment">/** The sets of files to include in the package */</span>
    <span class="keyword">private</span> <span class="keyword">object</span> <a title="object ScalaBazaar.this.fileSetsMap" id="474771">fileSetsMap</a> <a href="../../ScalaObject.scala.html#464" title="ScalaObject" class="keyword">extends</a> <a href="../../collection/DefaultMap.scala.html#8636" title="scala.collection.DefaultMap[String,List[org.apache.tools.ant.types.FileSet]]">DefaultMap</a><span class="delimiter">[</span>String, List<span class="delimiter">[</span>FileSet<span class="delimiter">]</span><span class="delimiter">]</span> <span class="delimiter">{</span>
      <span class="keyword">private</span> <span class="keyword">var</span> <a title="scala.collection.mutable.HashMap[String,List[org.apache.tools.ant.types.FileSet]]" id="475048">content</a> = <a href="../../collection/mutable/HashMap.scala.html#73156" title="()scala.collection.mutable.HashMap[String,List[org.apache.tools.ant.types.FileSet]]" class="keyword">new</a> <a href="../../collection/mutable/HashMap.scala.html#14905" title="scala.collection.mutable.HashMap[String,List[org.apache.tools.ant.types.FileSet]]">HashMap</a><span class="delimiter">[</span>String, List<span class="delimiter">[</span>FileSet<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="(key: String)Option[List[org.apache.tools.ant.types.FileSet]]" id="475050">get</a><span class="delimiter">(</span><a title="String" id="475070">key</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="../../Option.scala.html#560" title="Option[List[org.apache.tools.ant.types.FileSet]]">Option</a><span class="delimiter">[</span>List<span class="delimiter">[</span>FileSet<span class="delimiter">]</span><span class="delimiter">]</span> = <a href="#475048" title="=&gt; scala.collection.mutable.HashMap[String,List[org.apache.tools.ant.types.FileSet]]">content</a>.<a href="../../collection/mutable/HashMap.scala.html#73158" title="(key: String)Option[List[org.apache.tools.ant.types.FileSet]]">get</a><span class="delimiter">(</span><a href="#475070" title="String">key</a><span class="delimiter">)</span>
      <span class="keyword">override</span> <span class="keyword">def</span> <a title="=&gt; Int" id="475051">size</a>: <a href="../../Int.scala.html#386" title="Int">Int</a> = <a href="#475048" title="=&gt; scala.collection.mutable.HashMap[String,List[org.apache.tools.ant.types.FileSet]]">content</a>.<a href="../../collection/mutable/HashMap.scala.html#73155" title="=&gt; Int">size</a>
      <span class="keyword">def</span> <a title="(key: String, value: org.apache.tools.ant.types.FileSet)Unit" id="475052">update</a><span class="delimiter">(</span><a title="String" id="475080">key</a>: <span title="String">String</span>, <a title="org.apache.tools.ant.types.FileSet" id="475081">value</a>: <span title="org.apache.tools.ant.types.FileSet">FileSet</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#475048" title="=&gt; scala.collection.mutable.HashMap[String,List[org.apache.tools.ant.types.FileSet]]">content</a>.<a href="../../collection/MapLike.scala.html#73205" title="(key: String)Boolean">contains</a><span class="delimiter">(</span><a href="#475080" title="String">key</a><span class="delimiter">)</span> <a href="../../Boolean.scala.html#55580" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../collection/MapLike.scala.html#73204" title="(key: String)List[org.apache.tools.ant.types.FileSet]">content</a><span class="delimiter">(</span><a href="#475080" title="String">key</a><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">!=</span> <a href="../../collection/immutable/List.scala.html#13700" title="object Nil">Nil</a><span class="delimiter">)</span>
          <a href="#475048" title="=&gt; scala.collection.mutable.HashMap[String,List[org.apache.tools.ant.types.FileSet]]">content</a>.<a href="../../collection/mutable/HashMap.scala.html#73160" title="(key: String, value: List[org.apache.tools.ant.types.FileSet])Unit">update</a><span class="delimiter">(</span><a href="#475080" title="String">key</a>, <a href="#475081" title="org.apache.tools.ant.types.FileSet">value</a> <a href="../../collection/immutable/List.scala.html#49140" title="(x: org.apache.tools.ant.types.FileSet)List[org.apache.tools.ant.types.FileSet]">::</a> <a href="../../collection/MapLike.scala.html#73204" title="(key: String)List[org.apache.tools.ant.types.FileSet]">content</a><span class="delimiter">(</span><a href="#475080" title="String">key</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">else</span> <a href="#475048" title="=&gt; scala.collection.mutable.HashMap[String,List[org.apache.tools.ant.types.FileSet]]">content</a>.<a href="../../collection/mutable/HashMap.scala.html#73160" title="(key: String, value: List[org.apache.tools.ant.types.FileSet])Unit">update</a><span class="delimiter">(</span><a href="#475080" title="String">key</a>, <a href="../../collection/immutable/List.scala.html#48877" title="(xs: org.apache.tools.ant.types.FileSet*)List[org.apache.tools.ant.types.FileSet]">List</a><span class="delimiter">(</span><a href="#475081" title="org.apache.tools.ant.types.FileSet">value</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">def</span> <a title="=&gt; List[(String, List[org.apache.tools.ant.types.FileSet])]" id="475053">fileSets</a> = <a href="#475048" title="=&gt; scala.collection.mutable.HashMap[String,List[org.apache.tools.ant.types.FileSet]]">content</a>.<a href="../../collection/TraversableOnce.scala.html#53691" title="=&gt; List[(String, List[org.apache.tools.ant.types.FileSet])]">toList</a>
      <span class="keyword">def</span> <a title="=&gt; Iterator[(String, List[org.apache.tools.ant.types.FileSet])]" id="475054">iterator</a> = <a href="#475048" title="=&gt; scala.collection.mutable.HashMap[String,List[org.apache.tools.ant.types.FileSet]]">content</a>.<a href="../../collection/mutable/HashMap.scala.html#73164" title="=&gt; Iterator[(String, List[org.apache.tools.ant.types.FileSet])]">iterator</a>
    <span class="delimiter">}</span>



<span class="comment">/******************************************************************************\
**                             Internal properties                            **
\******************************************************************************/</span>


<span class="comment">/******************************************************************************\
**                             Properties setters                             **
\******************************************************************************/</span>

    <span class="comment">/** Sets the file attribute. Used by Ant.
      * @param input The value of &lt;code&gt;file&lt;/code&gt;. */</span>
    <span class="keyword">def</span> <a title="(input: java.io.File)Unit" id="474773">setFile</a><span class="delimiter">(</span><a title="java.io.File" id="475180">input</a>: <span title="java.io.File">File</span><span class="delimiter">)</span> =
      <a href="#474751" title="(x$1: Option[java.io.File])Unit">file</a> = <a href="../../Option.scala.html#57885" title="(x: java.io.File)Some[java.io.File]">Some</a><span class="delimiter">(</span><a href="#475180" title="java.io.File">input</a><span class="delimiter">)</span>

    <span class="comment">/** Sets the advertisement file attribute. Used by Ant.
      * @param input The value of &lt;code&gt;adfile&lt;/code&gt;. */</span>
    <span class="keyword">def</span> <a title="(input: java.io.File)Unit" id="474774">setAdfile</a><span class="delimiter">(</span><a title="java.io.File" id="475186">input</a>: <span title="java.io.File">File</span><span class="delimiter">)</span> =
      <a href="#474754" title="(x$1: Option[java.io.File])Unit">adfile</a> = <a href="../../Option.scala.html#57885" title="(x: java.io.File)Some[java.io.File]">Some</a><span class="delimiter">(</span><a href="#475186" title="java.io.File">input</a><span class="delimiter">)</span>

    <span class="comment">/** Sets the name attribute of this package. Used by Ant.
      * @param input The value of &lt;code&gt;name&lt;/code&gt;. */</span>
    <span class="keyword">def</span> <a title="(input: String)Unit" id="474775">setName</a><span class="delimiter">(</span><a title="String" id="475192">input</a>: <span title="String">String</span><span class="delimiter">)</span> =
      <a href="#474757" title="(x$1: Option[String])Unit">name</a> = <a href="../../Option.scala.html#57885" title="(x: String)Some[String]">Some</a><span class="delimiter">(</span><a href="#475192" title="String">input</a><span class="delimiter">)</span>

    <span class="comment">/** Sets the version attribute of this package. Used by Ant.
      * @param input The value of &lt;code&gt;version&lt;/code&gt;. */</span>
    <span class="keyword">def</span> <a title="(input: String)Unit" id="474776">setVersion</a><span class="delimiter">(</span><a title="String" id="475198">input</a>: <span title="String">String</span><span class="delimiter">)</span> =
      <a href="#474760" title="(x$1: Option[String])Unit">version</a> = <a href="../../Option.scala.html#57885" title="(x: String)Some[String]">Some</a><span class="delimiter">(</span><a href="#475198" title="String">input</a><span class="delimiter">)</span>

    <span class="comment">/** Sets the depends attribute. Used by Ant.
      * @param input The value for &lt;code&gt;depends&lt;/code&gt;. */</span>
    <span class="keyword">def</span> <a title="(input: String)Unit" id="474777">setDepends</a><span class="delimiter">(</span><a title="String" id="475204">input</a>: <span title="String">String</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="#474763" title="(x$1: List[String])Unit">depends</a> = <a href="#475204" title="String">input</a>.<span title="(x$1: java.lang.String)Array[java.lang.String]">split</span><a href="../../Predef.scala.html#9626" title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">(</a><span title="java.lang.String(&quot;,&quot;)" class="string">&quot;,&quot;</span><span class="delimiter">)</span>.<a href="../../collection/TraversableOnce.scala.html#53691" title="=&gt; List[java.lang.String]">toList</a>.<a href="../../collection/TraversableLike.scala.html#49046" title="(f: java.lang.String =&gt; scala.collection.GenTraversableOnce[java.lang.String])(implicit bf: scala.collection.generic.CanBuildFrom[List[java.lang.String],java.lang.String,List[String]])List[String]">flatMap</a> <a href="../../collection/immutable/List.scala.html#48868" title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,java.lang.String,List[java.lang.String]]" class="delimiter">{</a> s: <span title="String">String</span> =&gt;
        <span class="keyword">val</span> <a title="java.lang.String" id="475325">st</a> = <a href="#475324" title="String">s</a>.<span title="()java.lang.String">trim</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">(</span><span title="List[java.lang.String]" class="keyword">if</span> <span class="delimiter">(</span><a href="#475325" title="java.lang.String">st</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> <a href="../../collection/immutable/List.scala.html#48877" title="(xs: java.lang.String*)List[java.lang.String]">List</a><span class="delimiter">(</span><a href="#475325" title="java.lang.String">st</a><span class="delimiter">)</span> <span class="keyword">else</span> <a href="../../collection/immutable/List.scala.html#13700" title="object Nil">Nil</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="comment">/** Sets the description attribute of this package. Used by Ant.
      * @param input The value of &lt;code&gt;description&lt;/code&gt;. */</span>
    <span class="keyword">def</span> <a title="(input: String)Unit" id="474778">setDesc</a><span class="delimiter">(</span><a title="String" id="475364">input</a>: <span title="String">String</span><span class="delimiter">)</span> =
      <a href="#474766" title="(x$1: Option[String])Unit">desc</a> = <a href="../../Option.scala.html#57885" title="(x: String)Some[String]">Some</a><span class="delimiter">(</span><a href="#475364" title="String">input</a><span class="delimiter">)</span>

    <span class="comment">/** Sets the link attribute of this package. Used by Ant.
      * @param input The value of &lt;code&gt;link&lt;/code&gt;. */</span>
    <span class="keyword">def</span> <a title="(input: String)Unit" id="474779">setLink</a><span class="delimiter">(</span><a title="String" id="475370">input</a>: <span title="String">String</span><span class="delimiter">)</span> =
      <a href="#474769" title="(x$1: Option[String])Unit">link</a> = <a href="../../Option.scala.html#57885" title="(x: String)Some[String]">Some</a><span class="delimiter">(</span><a href="#475370" title="String">input</a><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="(input: org.apache.tools.ant.types.FileSet)Unit" id="474780">addConfiguredLibset</a><span class="delimiter">(</span><a title="org.apache.tools.ant.types.FileSet" id="475376">input</a>: <span title="org.apache.tools.ant.types.FileSet">FileSet</span><span class="delimiter">)</span> =
      <a href="#474771" title="object ScalaBazaar.this.fileSetsMap">fileSetsMap</a>.<a href="#475052" title="(key: String, value: org.apache.tools.ant.types.FileSet)Unit">update</a><span class="delimiter">(</span><span title="java.lang.String(&quot;lib&quot;)" class="string">&quot;lib&quot;</span>, <a href="#475376" title="org.apache.tools.ant.types.FileSet">input</a><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="(input: org.apache.tools.ant.types.FileSet)Unit" id="474781">addConfiguredBinset</a><span class="delimiter">(</span><a title="org.apache.tools.ant.types.FileSet" id="475379">input</a>: <span title="org.apache.tools.ant.types.FileSet">FileSet</span><span class="delimiter">)</span> =
      <a href="#474771" title="object ScalaBazaar.this.fileSetsMap">fileSetsMap</a>.<a href="#475052" title="(key: String, value: org.apache.tools.ant.types.FileSet)Unit">update</a><span class="delimiter">(</span><span title="java.lang.String(&quot;bin&quot;)" class="string">&quot;bin&quot;</span>, <a href="#475379" title="org.apache.tools.ant.types.FileSet">input</a><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="(input: org.apache.tools.ant.types.FileSet)Unit" id="474782">addConfiguredSrcset</a><span class="delimiter">(</span><a title="org.apache.tools.ant.types.FileSet" id="475382">input</a>: <span title="org.apache.tools.ant.types.FileSet">FileSet</span><span class="delimiter">)</span> =
      <a href="#474771" title="object ScalaBazaar.this.fileSetsMap">fileSetsMap</a>.<a href="#475052" title="(key: String, value: org.apache.tools.ant.types.FileSet)Unit">update</a><span class="delimiter">(</span><span title="java.lang.String(&quot;src&quot;)" class="string">&quot;src&quot;</span>, <a href="#475382" title="org.apache.tools.ant.types.FileSet">input</a><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="(input: org.apache.tools.ant.types.FileSet)Unit" id="474783">addConfiguredManset</a><span class="delimiter">(</span><a title="org.apache.tools.ant.types.FileSet" id="475385">input</a>: <span title="org.apache.tools.ant.types.FileSet">FileSet</span><span class="delimiter">)</span> =
      <a href="#474771" title="object ScalaBazaar.this.fileSetsMap">fileSetsMap</a>.<a href="#475052" title="(key: String, value: org.apache.tools.ant.types.FileSet)Unit">update</a><span class="delimiter">(</span><span title="java.lang.String(&quot;man&quot;)" class="string">&quot;man&quot;</span>, <a href="#475385" title="org.apache.tools.ant.types.FileSet">input</a><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="(input: org.apache.tools.ant.types.FileSet)Unit" id="474784">addConfiguredDocset</a><span class="delimiter">(</span><a title="org.apache.tools.ant.types.FileSet" id="475388">input</a>: <span title="org.apache.tools.ant.types.FileSet">FileSet</span><span class="delimiter">)</span> =
      <a href="#474771" title="object ScalaBazaar.this.fileSetsMap">fileSetsMap</a>.<a href="#475052" title="(key: String, value: org.apache.tools.ant.types.FileSet)Unit">update</a><span class="delimiter">(</span><span title="java.lang.String(&quot;doc/&quot;)" class="string">&quot;doc/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#474787" title="=&gt; String">getName</a>, <a href="#475388" title="org.apache.tools.ant.types.FileSet">input</a><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="(input: org.apache.tools.ant.types.FileSet)Unit" id="474785">addConfiguredMiscset</a><span class="delimiter">(</span><a title="org.apache.tools.ant.types.FileSet" id="475393">input</a>: <span title="org.apache.tools.ant.types.FileSet">FileSet</span><span class="delimiter">)</span> =
      <a href="#474771" title="object ScalaBazaar.this.fileSetsMap">fileSetsMap</a>.<a href="#475052" title="(key: String, value: org.apache.tools.ant.types.FileSet)Unit">update</a><span class="delimiter">(</span><span title="java.lang.String(&quot;misc/&quot;)" class="string">&quot;misc/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#474787" title="=&gt; String">getName</a>, <a href="#475393" title="org.apache.tools.ant.types.FileSet">input</a><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="(set: scala.tools.ant.LooseFileSet)Unit" id="474786">addConfiguredLooseset</a><span class="delimiter">(</span><a title="scala.tools.ant.LooseFileSet" id="475396">set</a>: <a href="#21585" title="scala.tools.ant.LooseFileSet">LooseFileSet</a><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <a href="../../Predef.scala.html#57855" title="(x: Option[String], y: Option[org.apache.tools.ant.types.FileSet])(Option[String], Option[org.apache.tools.ant.types.FileSet])">Pair</a><span class="delimiter">(</span><a href="#475396" title="scala.tools.ant.LooseFileSet">set</a>.<a href="#474725" title="=&gt; Option[String]">destination</a>, <a href="#475396" title="scala.tools.ant.LooseFileSet">set</a>.<a href="#474729" title="=&gt; Option[org.apache.tools.ant.types.FileSet]">fileset</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a href="../../Predef.scala.html#57860" title="Nothing">Pair</a><span class="delimiter">(</span><a href="../../Option.scala.html#1737" title="object None">None</a>, _<span class="delimiter">)</span> =&gt;
          <a href="ScalaMatchingTask.scala.html#469482" title="(message: String)Nothing">buildError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;destination not specified for a loose file set&quot;)" class="string">&quot;destination not specified for a loose file set&quot;</span><span class="delimiter">)</span>

        <span class="keyword">case</span> <a href="../../Predef.scala.html#57860" title="Nothing">Pair</a><span class="delimiter">(</span>_, <a href="../../Option.scala.html#1737" title="object None">None</a><span class="delimiter">)</span> =&gt;
          <a href="ScalaMatchingTask.scala.html#469482" title="(message: String)Nothing">buildError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;no files specified for a loose file set&quot;)" class="string">&quot;no files specified for a loose file set&quot;</span><span class="delimiter">)</span>

        <span class="keyword">case</span> <a href="../../Predef.scala.html#57860" title="Unit">Pair</a><span class="delimiter">(</span>Some<span class="delimiter">(</span><a title="String" id="475430">dest</a><span class="delimiter">)</span>, Some<span class="delimiter">(</span><a title="org.apache.tools.ant.types.FileSet" id="475432">fileset</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
          <a href="#474771" title="object ScalaBazaar.this.fileSetsMap">fileSetsMap</a>.<a href="#475052" title="(key: String, value: org.apache.tools.ant.types.FileSet)Unit">update</a><span class="delimiter">(</span><a href="#475430" title="String">dest</a>, <a href="#475432" title="org.apache.tools.ant.types.FileSet">fileset</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

<span class="comment">/******************************************************************************\
**                             Properties getters                             **
\******************************************************************************/</span>

    <span class="comment">/** Gets the value of the file attribute in a Scala-friendly form.
      * @return The file as a file. */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; String" id="474787">getName</a>: <span title="String">String</span> =
      <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#474757" title="=&gt; Option[String]">name</a>.<a href="../../Option.scala.html#48471" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <a href="ScalaMatchingTask.scala.html#469482" title="(message: String)Nothing">buildError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Name attribute must be defined first.&quot;)" class="string">&quot;Name attribute must be defined first.&quot;</span><span class="delimiter">)</span>
      <span class="keyword">else</span> <a href="#474757" title="=&gt; Option[String]">name</a>.<a href="../../Option.scala.html#48473" title="=&gt; String">get</a>

    <span class="comment">/** Gets the value of the file attribute in a Scala-friendly form.
      * @return The file as a file. */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; java.io.File" id="474788">getFile</a>: <span title="java.io.File">File</span> =
      <span title="java.io.File" class="keyword">if</span> <span class="delimiter">(</span><a href="#474751" title="=&gt; Option[java.io.File]">file</a>.<a href="../../Option.scala.html#48471" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <a href="ScalaMatchingTask.scala.html#469482" title="(message: String)Nothing">buildError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Member \'file\' is empty.&quot;)" class="string">&quot;Member 'file' is empty.&quot;</span><span class="delimiter">)</span>
      <span class="keyword">else</span> <a href="#21537" title="()org.apache.tools.ant.Project">getProject</a><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: java.lang.String)java.io.File">resolveFile</span><span class="delimiter">(</span><a href="#474751" title="=&gt; Option[java.io.File]">file</a>.<a href="../../Option.scala.html#48473" title="=&gt; java.io.File">get</a>.<span title="()java.lang.String">toString</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="comment">/** Gets the value of the adfile attribute in a Scala-friendly form.
      * @return The adfile as a file. */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; java.io.File" id="474789">getAdfile</a>: <span title="java.io.File">File</span> =
      <span title="java.io.File" class="keyword">if</span> <span class="delimiter">(</span><a href="#474754" title="=&gt; Option[java.io.File]">adfile</a>.<a href="../../Option.scala.html#48471" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <a href="ScalaMatchingTask.scala.html#469482" title="(message: String)Nothing">buildError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Member \'adfile\' is empty.&quot;)" class="string">&quot;Member 'adfile' is empty.&quot;</span><span class="delimiter">)</span>
      <span class="keyword">else</span> <a href="#21537" title="()org.apache.tools.ant.Project">getProject</a><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: java.lang.String)java.io.File">resolveFile</span><span class="delimiter">(</span><a href="#474754" title="=&gt; Option[java.io.File]">adfile</a>.<a href="../../Option.scala.html#48473" title="=&gt; java.io.File">get</a>.<span title="()java.lang.String">toString</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

<span class="comment">/******************************************************************************\
**                       Compilation and support methods                      **
\******************************************************************************/</span>
    <span class="comment">/** Transforms a string name into a file relative to the provided base
      * directory.
      * @param base A file pointing to the location relative to which the name
      *   will be resolved.
      * @param name A relative or absolute path to the file as a string.
      * @return A file created from the name and the base file. */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(base: java.io.File)(name: String)java.io.File" id="474790">nameToFile</a><span class="delimiter">(</span><a title="java.io.File" id="475443">base</a>: <span title="java.io.File">File</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="String" id="475444">name</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="java.io.File">File</span> =
      <a href="#474792" title="(file: java.io.File)java.io.File">existing</a><span class="delimiter">(</span><a href="#474748" title="=&gt; org.apache.tools.ant.util.FileUtils">fileUtils</a>.<span title="(x$1: java.io.File, x$2: java.lang.String)java.io.File">resolveFile</span><span class="delimiter">(</span><a href="#475443" title="java.io.File">base</a>, <a href="#475444" title="String">name</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="comment">/** Transforms a string name into a file relative to the build root
      * directory.
      * @param name A relative or absolute path to the file as a string.
      * @return A file created from the name. */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(name: String)java.io.File" id="474791">nameToFile</a><span class="delimiter">(</span><a title="String" id="475448">name</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="java.io.File">File</span> =
      <a href="#474792" title="(file: java.io.File)java.io.File">existing</a><span class="delimiter">(</span><a href="#21537" title="()org.apache.tools.ant.Project">getProject</a><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="(x$1: java.lang.String)java.io.File">resolveFile</span><span class="delimiter">(</span><a href="#475448" title="String">name</a><span class="delimiter">)</span><span class="delimiter">)</span>

    <span class="comment">/** Tests if a file exists and prints a warning in case it doesn't. Always
      * returns the file, even if it doesn't exist.
      * @param file A file to test for existance.
      * @return The same file. */</span>
    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(file: java.io.File)java.io.File" id="474792">existing</a><span class="delimiter">(</span><a title="java.io.File" id="475446">file</a>: <span title="java.io.File">File</span><span class="delimiter">)</span>: <span title="java.io.File">File</span> = <span class="delimiter">{</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#55576" title="=&gt; Boolean">!</a><a href="#475446" title="java.io.File">file</a>.<span title="()Boolean">exists</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#21537" title="(x$1: java.lang.String, x$2: Int)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Element \'&quot;)" class="string">&quot;Element '&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#475446" title="java.io.File">file</a>.<span title="()java.lang.String">toString</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\' does not exist.&quot;)" class="string">&quot;' does not exist.&quot;</span>,
            Project.<span title="Int(1)">MSG_WARN</span><span class="delimiter">)</span>
      <a href="#475446" title="java.io.File">file</a>
    <span class="delimiter">}</span>

    <span class="keyword">private</span> <span class="keyword">def</span> <a title="(file: java.io.File, content: String)Unit" id="474793">writeFile</a><span class="delimiter">(</span><a title="java.io.File" id="475459">file</a>: <span title="java.io.File">File</span>, <a title="String" id="475460">content</a>: <span title="String">String</span><span class="delimiter">)</span> =
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#475459" title="java.io.File">file</a>.<span title="()Boolean">exists</span><span class="delimiter">(</span><span class="delimiter">)</span> <a href="../../Boolean.scala.html#55580" title="(x: Boolean)Boolean">&amp;&amp;</a> <a href="../../Boolean.scala.html#55576" title="=&gt; Boolean">!</a><a href="#475459" title="java.io.File">file</a>.<span title="()Boolean">canWrite</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="ScalaMatchingTask.scala.html#469482" title="(message: String)Nothing">buildError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;File &quot;)" class="string">&quot;File &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#475459" title="java.io.File">file</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot; is not writable&quot;)" class="string">&quot; is not writable&quot;</span><span class="delimiter">)</span>
      <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="java.io.FileWriter" id="475463">writer</a> = <span title="(x$1: java.io.File, x$2: Boolean)java.io.FileWriter" class="keyword">new</span> <span title="java.io.FileWriter">FileWriter</span><span class="delimiter">(</span><a href="#475459" title="java.io.File">file</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
        <a href="#475463" title="java.io.FileWriter">writer</a>.<span title="(x$1: java.lang.String)Unit">write</span><span class="delimiter">(</span><a href="#475460" title="String">content</a><span class="delimiter">)</span>
        <a href="#475463" title="java.io.FileWriter">writer</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>

<span class="comment">/******************************************************************************\
**                           The big execute method                           **
\******************************************************************************/</span>

    <span class="comment">/** Performs the compilation. */</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="474794">execute</a><span class="delimiter">(</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
      <span class="comment">// Tests if all mandatory attributes are set and valid.</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#474751" title="=&gt; Option[java.io.File]">file</a>.<a href="../../Option.scala.html#48471" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <a href="ScalaMatchingTask.scala.html#469482" title="(message: String)Nothing">buildError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Attribute \'file\' is not set.&quot;)" class="string">&quot;Attribute 'file' is not set.&quot;</span><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#474757" title="=&gt; Option[String]">name</a>.<a href="../../Option.scala.html#48471" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <a href="ScalaMatchingTask.scala.html#469482" title="(message: String)Nothing">buildError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Attribute \'name\' is not set.&quot;)" class="string">&quot;Attribute 'name' is not set.&quot;</span><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#474760" title="=&gt; Option[String]">version</a>.<a href="../../Option.scala.html#48471" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <a href="ScalaMatchingTask.scala.html#469482" title="(message: String)Nothing">buildError</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Attribute \'version\' is not set.&quot;)" class="string">&quot;Attribute 'version' is not set.&quot;</span><span class="delimiter">)</span>

      <span class="keyword">val</span> <a title="scala.xml.Elem" id="475486">pack</a> = <span class="delimiter">{</span>
        &lt;<a href="../../xml/Elem.scala.html#46428" title="scala.xml.Elem" id="475525" class="keyword">package</a>&gt;
          &lt;<a href="../../xml/Elem.scala.html#46428" title="scala.xml.Elem" id="475558">name</a>&gt;<span class="delimiter">{</span><a href="#474757" title="=&gt; Option[String]">name</a>.<a href="../../Option.scala.html#48473" title="=&gt; String">get</a><span class="delimiter">}</span>&lt;/name&gt;
          &lt;<a href="../../xml/Elem.scala.html#46428" title="scala.xml.Elem" id="475563">version</a>&gt;<span class="delimiter">{</span><a href="#474760" title="=&gt; Option[String]">version</a>.<a href="../../Option.scala.html#48473" title="=&gt; String">get</a><span class="delimiter">}</span>&lt;/version&gt;<span class="delimiter">{</span>
            <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#55576" title="=&gt; Boolean">!</a><a href="#474763" title="=&gt; List[String]">depends</a>.<a href="../../collection/IterableLike.scala.html#53862" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span>
              &lt;<a href="../../xml/Elem.scala.html#46428" title="scala.xml.Elem" id="475565">depends</a>&gt;<span class="delimiter">{</span>
                <span class="keyword">for</span> <span class="delimiter">(</span><a title="String" id="475585">depend</a> &lt;- <a href="../../collection/TraversableLike.scala.html#49041" title="(f: String =&gt; scala.xml.Elem)(implicit bf: scala.collection.generic.CanBuildFrom[List[String],scala.xml.Elem,Any])Any">depends</a><span class="delimiter">)</span> <span class="keyword">yield</span>
                  &lt;<a href="../../xml/Elem.scala.html#46428" title="scala.xml.Elem" id="475586">name</a>&gt;<span class="delimiter">{</span><a href="#475585" title="String">depend</a><span class="delimiter">}</span>&lt;/name&gt;
              <span class="delimiter">}</span>&lt;/depends&gt;
            <span class="keyword">else</span> <a href="../../collection/immutable/List.scala.html#13700" title="object Nil">Nil</a>
          <span class="delimiter">}</span><span class="delimiter">{</span>
            <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#55576" title="=&gt; Boolean">!</a><a href="#474766" title="=&gt; Option[String]">desc</a>.<a href="../../Option.scala.html#48471" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span>
              &lt;<a href="../../xml/Elem.scala.html#46428" title="scala.xml.Elem" id="475618">description</a>&gt;<span class="delimiter">{</span><a href="#474766" title="=&gt; Option[String]">desc</a>.<a href="../../Option.scala.html#48473" title="=&gt; String">get</a><span class="delimiter">}</span>&lt;/description&gt;
            <span class="keyword">else</span> <a href="../../collection/immutable/List.scala.html#13700" title="object Nil">Nil</a>
          <span class="delimiter">}</span>
        &lt;/<span class="keyword">package</span>&gt;
      <span class="delimiter">}</span>

      <a href="#21537" title="(x$1: java.lang.String)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Creating package \'&quot;)" class="string">&quot;Creating package '&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#474757" title="=&gt; Option[String]">name</a>.<a href="../../Option.scala.html#48473" title="=&gt; String">get</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;\'&quot;)" class="string">&quot;'&quot;</span><span class="delimiter">)</span>

      <span class="comment">// Creates the advert file</span>
      <span class="keyword">val</span> <a title="scala.xml.Elem" id="475487">advert</a> = <span class="delimiter">{</span>
        &lt;<a href="../../xml/Elem.scala.html#46428" title="scala.xml.Elem" id="475623">availablePackage</a>&gt;
          <span class="delimiter">{</span><a href="#475486" title="scala.xml.Elem">pack</a><span class="delimiter">}</span>
          <span class="delimiter">{</span><a href="#474769" title="=&gt; Option[String]">link</a> <span title="Any" class="keyword">match</span> <span class="delimiter">{</span>
            <span class="keyword">case</span> <a href="../../Option.scala.html#1737" title="scala.xml.Elem">None</a> =&gt; &lt;<a href="../../xml/Elem.scala.html#46428" title="scala.xml.Elem" id="475624">link</a>&gt;<a href="../../xml/Text.scala.html#46365" title="scala.xml.Text">INSERT</a> LINK HERE&lt;/link&gt;
            <span class="keyword">case</span> <span title="scala.xml.Elem">Some</span><span class="delimiter">(</span><a title="String" id="475626">str</a><span class="delimiter">)</span> =&gt; &lt;<a href="../../xml/Elem.scala.html#46428" title="scala.xml.Elem" id="475627">link</a>&gt;<span class="delimiter">{</span><a href="#475626" title="String">str</a><span class="delimiter">}</span>&lt;/link&gt;
          <span class="delimiter">}</span><span class="delimiter">}</span>
        &lt;/availablePackage&gt;
      <span class="delimiter">}</span>;

      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#55576" title="=&gt; Boolean">!</a><a href="#474754" title="=&gt; Option[java.io.File]">adfile</a>.<a href="../../Option.scala.html#48471" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span>
        <a href="#474793" title="(file: java.io.File, content: String)Unit">writeFile</a><span class="delimiter">(</span><a href="#474789" title="=&gt; java.io.File">getAdfile</a>, <a href="#475487" title="scala.xml.Elem">advert</a>.<a href="../../xml/Node.scala.html#460179" title="()String">toString</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>

      <span class="comment">// Checks for new files and creates the ZIP</span>

      <span class="keyword">val</span> <a title="List[(String, java.io.File, java.lang.String)]" id="475488">zipContent</a> =
        <span class="keyword">for</span> <span class="delimiter">{</span>
          <a href="../../Predef.scala.html#57860" title="(x: (String, List[org.apache.tools.ant.types.FileSet]))Option[(String, List[org.apache.tools.ant.types.FileSet])]">Pair</a><span class="delimiter">(</span><a title="String" id="475678">folder</a>, <a title="List[org.apache.tools.ant.types.FileSet]" id="475679">fileSets</a><span class="delimiter">)</span> &lt;- <a href="#474771" title="object ScalaBazaar.this.fileSetsMap">fileSetsMap</a>.<a href="../../collection/TraversableLike.scala.html#49046" title="(f: ((String, List[org.apache.tools.ant.types.FileSet])) =&gt; scala.collection.GenTraversableOnce[(String, java.io.File, java.lang.String)])(implicit bf: scala.collection.generic.CanBuildFrom[List[(String, List[org.apache.tools.ant.types.FileSet])],(String, java.io.File, java.lang.String),List[(String, java.io.File, java.lang.String)]])List[(String, java.io.File, java.lang.String)]">fileSets</a>
          <a title="org.apache.tools.ant.types.FileSet" id="475696">fileSet</a> &lt;- <a href="../../collection/TraversableLike.scala.html#49046" title="(f: org.apache.tools.ant.types.FileSet =&gt; scala.collection.GenTraversableOnce[(String, java.io.File, java.lang.String)])(implicit bf: scala.collection.generic.CanBuildFrom[List[org.apache.tools.ant.types.FileSet],(String, java.io.File, java.lang.String),List[(String, java.io.File, java.lang.String)]])List[(String, java.io.File, java.lang.String)]">fileSets</a>
          <a title="java.lang.String" id="475814">file</a> &lt;- <a href="#475696" title="org.apache.tools.ant.types.FileSet">fileSet</a>.<span title="(x$1: org.apache.tools.ant.Project)org.apache.tools.ant.DirectoryScanner">getDirectoryScanner</span><span class="delimiter">(</span><a href="#21537" title="()org.apache.tools.ant.Project">getProject</a><span class="delimiter">)</span>.<a href="../../Predef.scala.html#9626" title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]">getIncludedFiles</a>.<a href="../../collection/TraversableLike.scala.html#49041" title="(f: java.lang.String =&gt; (String, java.io.File, java.lang.String))(implicit bf: scala.collection.generic.CanBuildFrom[List[java.lang.String],(String, java.io.File, java.lang.String),List[(String, java.io.File, java.lang.String)]])List[(String, java.io.File, java.lang.String)]">toList</a>
        <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="../../Predef.scala.html#57908" title="(x: String, y: java.io.File, z: java.lang.String)(String, java.io.File, java.lang.String)">Triple</a><span class="delimiter">(</span><a href="#475678" title="String">folder</a>, <a href="#475696" title="org.apache.tools.ant.types.FileSet">fileSet</a>.<span title="(x$1: org.apache.tools.ant.Project)java.io.File">getDir</span><span class="delimiter">(</span><a href="#21537" title="()org.apache.tools.ant.Project">getProject</a><span class="delimiter">)</span>, <a href="#475814" title="java.lang.String">file</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.util.zip.ZipOutputStream" id="475489">zip</a> = <span title="java.util.zip.ZipOutputStream" class="keyword">new</span> <span title="java.util.zip.ZipOutputStream">ZipOutputStream</span><span class="delimiter">(</span><span title="(x$1: java.io.File, x$2: Boolean)java.io.FileOutputStream" class="keyword">new</span> <span title="java.io.FileOutputStream">FileOutputStream</span><span class="delimiter">(</span><a href="#474751" title="=&gt; Option[java.io.File]">file</a>.<a href="../../Option.scala.html#48473" title="=&gt; java.io.File">get</a>, <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="../../Boolean.scala.html#55576" title="=&gt; Boolean">!</a><a href="#475488" title="List[(String, java.io.File, java.lang.String)]">zipContent</a>.<a href="../../collection/IterableLike.scala.html#53862" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">for</span> <span class="delimiter">(</span><a href="../../Predef.scala.html#57915" title="(x: (String, java.io.File, java.lang.String))Option[(String, java.io.File, java.lang.String)]">Triple</a><span class="delimiter">(</span><a title="String" id="475976">destFolder</a>, <a title="java.io.File" id="475977">srcFolder</a>, <a title="java.lang.String" id="475978">file</a><span class="delimiter">)</span> &lt;- <a href="../../collection/LinearSeqOptimized.scala.html#71032" title="(f: ((String, java.io.File, java.lang.String)) =&gt; Unit)Unit">zipContent</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#21537" title="(x$1: java.lang.String, x$2: Int)Unit">log</a><span class="delimiter">(</span><a href="#475978" title="java.lang.String">file</a>, Project.<span title="Int(4)">MSG_DEBUG</span><span class="delimiter">)</span>
          <a href="#475489" title="java.util.zip.ZipOutputStream">zip</a>.<span title="(x$1: java.util.zip.ZipEntry)Unit">putNextEntry</span><span class="delimiter">(</span><span title="java.util.zip.ZipEntry" class="keyword">new</span> <span title="java.util.zip.ZipEntry">ZipEntry</span><span class="delimiter">(</span><a href="#475976" title="String">destFolder</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#475978" title="java.lang.String">file</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="java.io.FileInputStream" id="475979">input</a> = <span title="(x$1: java.io.File)java.io.FileInputStream" class="keyword">new</span> <span title="java.io.FileInputStream">FileInputStream</span><span class="delimiter">(</span><a href="#474790" title="(base: java.io.File)(name: String)java.io.File">nameToFile</a><span class="delimiter">(</span><a href="#475977" title="java.io.File">srcFolder</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#475978" title="java.lang.String">file</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="Array[Byte]" id="475980">buf</a> = <span title="Array[Byte]" class="keyword">new</span> <a href="../../Array.scala.html#1430" title="Array[Byte]">Array</a><span class="delimiter">[</span>Byte<span class="delimiter">]</span><span class="delimiter">(</span><span title="Int(10240)" class="int">10240</span><span class="delimiter">)</span>
          <span class="keyword">var</span> <a title="Int" id="475981">n</a> = <a href="#475979" title="java.io.FileInputStream">input</a>.<span title="(x$1: Array[Byte], x$2: Int, x$3: Int)Int">read</span><span class="delimiter">(</span><a href="#475980" title="Array[Byte]">buf</a>, <span title="Int(0)" class="int">0</span>, <a href="#475980" title="Array[Byte]">buf</a>.<a href="../../Array.scala.html#49204" title="=&gt; Int">length</a><span class="delimiter">)</span>
          <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#475981" title="Int">n</a> <a href="../../Int.scala.html#54782" title="(x: Int)Boolean">&gt;=</a> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#475982" title="()Unit" class="delimiter">{</a>
            <a href="#475489" title="java.util.zip.ZipOutputStream">zip</a>.<span title="(x$1: Array[Byte], x$2: Int, x$3: Int)Unit">write</span> <span class="delimiter">(</span><a href="#475980" title="Array[Byte]">buf</a>, <span title="Int(0)" class="int">0</span>, <a href="#475981" title="Int">n</a><span class="delimiter">)</span>
            <a href="#475981" title="Int">n</a> = <a href="#475979" title="java.io.FileInputStream">input</a>.<span title="(x$1: Array[Byte], x$2: Int, x$3: Int)Int">read</span><span class="delimiter">(</span><a href="#475980" title="Array[Byte]">buf</a>, <span title="Int(0)" class="int">0</span>, <a href="#475980" title="Array[Byte]">buf</a>.<a href="../../Array.scala.html#49204" title="=&gt; Int">length</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <a href="#475489" title="java.util.zip.ZipOutputStream">zip</a>.<span title="()Unit">closeEntry</span><span class="delimiter">(</span><span class="delimiter">)</span>
          <a href="#475979" title="java.io.FileInputStream">input</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#21537" title="(x$1: java.lang.String, x$2: Int)Unit">log</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Archive contains no files.&quot;)" class="string">&quot;Archive contains no files.&quot;</span>, Project.<span title="Int(3)">MSG_VERBOSE</span><span class="delimiter">)</span>
      <a href="#475489" title="java.util.zip.ZipOutputStream">zip</a>.<span title="(x$1: java.util.zip.ZipEntry)Unit">putNextEntry</span><span class="delimiter">(</span><span title="java.util.zip.ZipEntry" class="keyword">new</span> <span title="java.util.zip.ZipEntry">ZipEntry</span><span class="delimiter">(</span><span title="java.lang.String(&quot;meta/description&quot;)" class="string">&quot;meta/description&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.io.StringReader" id="475490">packInput</a> = <span title="java.io.StringReader" class="keyword">new</span> <span title="java.io.StringReader">StringReader</span><span class="delimiter">(</span><a href="#475486" title="scala.xml.Elem">pack</a>.<a href="../../xml/Node.scala.html#460179" title="()String">toString</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">var</span> <a title="Int" id="475491">byte</a> = <a href="#475490" title="java.io.StringReader">packInput</a>.<span title="()Int">read</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#475491" title="Int">byte</a> <a href="../../Int.scala.html#54754" title="(x: Int)Boolean">!=</a> -<span title="Int(-1)" class="int">1</span><span class="delimiter">)</span> <a href="#475492" title="()Unit" class="delimiter">{</a>
        <a href="#475489" title="java.util.zip.ZipOutputStream">zip</a>.<span title="(x$1: Int)Unit">write</span> <span class="delimiter">(</span><a href="#475491" title="Int">byte</a><span class="delimiter">)</span>
        <a href="#475491" title="Int">byte</a> = <a href="#475490" title="java.io.StringReader">packInput</a>.<span title="()Int">read</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <a href="#475489" title="java.util.zip.ZipOutputStream">zip</a>.<span title="()Unit">closeEntry</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#475490" title="java.io.StringReader">packInput</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#475489" title="java.util.zip.ZipOutputStream">zip</a>.<span title="()Unit">close</span>
    <span class="delimiter">}</span>

  <span class="delimiter">}</span>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>
<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scala/util/parsing/ast/Binders.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*                     __                                               *\
**     ________ ___   / /  ___     Scala API                            **
**    / __/ __// _ | / /  / _ |    (c) 2006-2011, LAMP/EPFL             **
**  __\ \/ /__/ __ |/ /__/ __ |    http://scala-lang.org/               **
** /____/\___/_/ |_/____/_/ | |                                         **
**                          |/                                          **
\*                                                                      */</span>

<span class="keyword">package</span> scala.util.parsing.ast

<span class="keyword">import</span> scala.collection.mutable.Map

<span class="comment">//DISCLAIMER: this code is highly experimental!</span>

  <span class="comment">// TODO: avoid clashes when substituting</span>
  <span class="comment">// TODO: check binders in the same scope are distinct</span>

<span class="comment">/** This trait provides the core ''Scrap-Your-Boilerplate'' abstractions as
 *  well as implementations for common datatypes.
 *
 *  (Based on Ralf LÃ¤mmel's [[http://homepages.cwi.nl/~ralf/syb3/ SYB papers]].)
 *
 *  @author Adriaan Moors
 */</span>
<span class="keyword">trait</span> <a title="trait Mappable extends java.lang.Object with ScalaObject" id="44715">Mappable</a> <a href="../../../ScalaObject.scala.html#464" title="ScalaObject" class="delimiter">{</a>
  <span class="keyword">trait</span> <a title="trait Mapper extends java.lang.Object" id="1021203">Mapper</a> <span title="java.lang.Object" class="delimiter">{</span> <span class="keyword">def</span> <a title="[T](x: T)(implicit evidence$1: T =&gt; Mappable.this.Mappable[T])T" id="1021220">apply</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="1021217">T</a> &lt;% Mappable<span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><a title="T" id="1021219">x</a>: <a href="#1021217" title="T">T</a><span class="delimiter">)</span>: <a href="#1021217" title="T">T</a> <span class="delimiter">}</span> <span class="comment">/* TODO: having type `Forall T. T =&gt; T` is too strict:
  sometimes we want to allow `Forall T &gt;: precision. T =&gt; T` for some type `precision`, so that,
  beneath a certain threshold, we have some leeway.
  concretely: to use gmap for substitution, we simply require that ast nodes are mapped to ast nodes,
  we can't require that the type is preserved precisely: a Name may map to e.g., a MethodCall
  */</span>

  <span class="keyword">trait</span> <a title="trait Mappable[T] extends java.lang.Object with ScalaObject" id="1021204">Mappable</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="1021205">T</a><span class="delimiter">]</span> <a href="../../../ScalaObject.scala.html#464" title="ScalaObject" class="delimiter">{</a>
    <span class="comment">// one-layer traversal</span>
    <span class="keyword">def</span> <a title="(f: Mappable.this.Mapper)T" id="1021224">gmap</a><span class="delimiter">(</span><a title="Mappable.this.Mapper" id="1021228">f</a>: <a href="#1021203" title="Mappable.this.Mapper">Mapper</a><span class="delimiter">)</span>: <a href="#1021205" title="T">T</a>
    <span class="comment">//  everywhere f x = f (gmapT (everywhere f) x)</span>
    <span class="keyword">def</span> <a title="(f: Mappable.this.Mapper)(implicit c: T =&gt; Mappable.this.Mappable[T])T" id="1021225">everywhere</a><span class="delimiter">(</span><a title="Mappable.this.Mapper" id="1021230">f</a>: <a href="#1021203" title="Mappable.this.Mapper">Mapper</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="T =&gt; Mappable.this.Mappable[T]" id="1021231">c</a>: T =&gt; Mappable<span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#1021205" title="T">T</a> =
      <a href="#1021220" title="(x: T)(implicit evidence$1: T =&gt; Mappable.this.Mappable[T])T">f</a><a href="#1021231" title="T =&gt; Mappable.this.Mappable[T]" class="delimiter">(</a><a href="#1021224" title="(f: Mappable.this.Mapper)T">gmap</a><span class="delimiter">(</span><a href="#1021237" title="java.lang.Object with Mappable.this.Mapper" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with Mappable.this.Mapper" id="1021237">Mapper</a> <span class="delimiter">{</span> <span class="keyword">def</span> <a title="[T](x: T)(implicit evidence$2: T =&gt; Mappable.this.Mappable[T])T" id="1021245">apply</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="1021243">T</a> &lt;% Mappable<span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><a title="T" id="1021244">x</a>: <a href="#1021243" title="T">T</a><span class="delimiter">)</span>: <a href="#1021243" title="T">T</a> = <a href="../../../Function1.scala.html#53453" title="(v1: T)Mappable.this.Mappable[T]">x</a>.<a href="#1021225" title="(f: Mappable.this.Mapper)(implicit c: T =&gt; Mappable.this.Mappable[T])T">everywhere</a><a href="#1021245" title="T =&gt; Mappable.this.Mappable[T]" class="delimiter">(</a><a href="#1021230" title="Mappable.this.Mapper">f</a><span class="delimiter">)</span><span class="delimiter">}</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit scala.util.parsing.ast.Mappable.StringIsMappable : (s: String)Mappable.this.Mappable[String]" id="1021206">StringIsMappable</a><span class="delimiter">(</span><a title="String" id="1021279">s</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="#1021204" title="Mappable.this.Mappable[String]">Mappable</a><span class="delimiter">[</span>String<span class="delimiter">]</span> =
    <a href="#1021302" title="java.lang.Object with Mappable.this.Mappable[String]" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with Mappable.this.Mappable[String]" id="1021302">Mappable</a><span class="delimiter">[</span>String<span class="delimiter">]</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(f: Mappable.this.Mapper)String" id="1021306">gmap</a><span class="delimiter">(</span><a title="Mappable.this.Mapper" id="1021307">f</a>: <a href="#1021203" title="Mappable.this.Mapper">Mapper</a><span class="delimiter">)</span>: <span title="String">String</span> = <a href="#1021220" title="(x: String)(implicit evidence$1: String =&gt; Mappable.this.Mappable[String])String">f</a><a href="#1021206" title="implicit scala.util.parsing.ast.Mappable.StringIsMappable : (s: String)Mappable.this.Mappable[String]" class="delimiter">(</a><a href="#1021279" title="String">s</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="[t](xs: List[t])(implicit evidence$3: t =&gt; Mappable.this.Mappable[t])Mappable.this.Mappable[List[t]]" id="1021273">ListIsMappable</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="1021209">t</a> &lt;% Mappable<span class="delimiter">[</span>t<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><a title="List[t]" id="1021272">xs</a>: <a href="../../../collection/immutable/List.scala.html#14047" title="List[t]">List</a><span class="delimiter">[</span>t<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#1021204" title="Mappable.this.Mappable[List[t]]">Mappable</a><span class="delimiter">[</span>List<span class="delimiter">[</span>t<span class="delimiter">]</span><span class="delimiter">]</span> =
    <a href="#1021322" title="java.lang.Object with Mappable.this.Mappable[List[t]]" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with Mappable.this.Mappable[List[t]]" id="1021322">Mappable</a><span class="delimiter">[</span>List<span class="delimiter">[</span>t<span class="delimiter">]</span><span class="delimiter">]</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(f: Mappable.this.Mapper)List[t]" id="1021326">gmap</a><span class="delimiter">(</span><a title="Mappable.this.Mapper" id="1021327">f</a>: <a href="#1021203" title="Mappable.this.Mapper">Mapper</a><span class="delimiter">)</span>: <a href="../../../collection/immutable/List.scala.html#14047" title="List[t]">List</a><span class="delimiter">[</span>t<span class="delimiter">]</span> = <span class="delimiter">(</span><span class="keyword">for</span> <span class="delimiter">(</span><a title="t" id="1021347">x</a> &lt;- <a href="../../../collection/TraversableLike.scala.html#49041" title="(f: t =&gt; t)(implicit bf: scala.collection.generic.CanBuildFrom[List[t],t,List[t]])List[t]">xs</a><span class="delimiter">)</span> <span class="keyword">yield</span> <a href="#1021220" title="(x: t)(implicit evidence$1: t =&gt; Mappable.this.Mappable[t])t">f</a><a href="#1021273" title="t =&gt; Mappable.this.Mappable[t]" class="delimiter">(</a><a href="#1021347" title="t">x</a><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="../../../collection/immutable/List.scala.html#49162" title="=&gt; List[t]">toList</a>
    <span class="delimiter">}</span>

  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="[t](xs: Option[t])(implicit evidence$4: t =&gt; Mappable.this.Mappable[t])Mappable.this.Mappable[Option[t]]" id="1021266">OptionIsMappable</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="1021212">t</a> &lt;% Mappable<span class="delimiter">[</span>t<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><a title="Option[t]" id="1021265">xs</a>: <a href="../../../Option.scala.html#560" title="Option[t]">Option</a><span class="delimiter">[</span>t<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#1021204" title="Mappable.this.Mappable[Option[t]]">Mappable</a><span class="delimiter">[</span>Option<span class="delimiter">[</span>t<span class="delimiter">]</span><span class="delimiter">]</span> =
    <a href="#1021393" title="java.lang.Object with Mappable.this.Mappable[Option[t]]" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with Mappable.this.Mappable[Option[t]]" id="1021393">Mappable</a><span class="delimiter">[</span>Option<span class="delimiter">[</span>t<span class="delimiter">]</span><span class="delimiter">]</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(f: Mappable.this.Mapper)Option[t]" id="1021397">gmap</a><span class="delimiter">(</span><a title="Mappable.this.Mapper" id="1021398">f</a>: <a href="#1021203" title="Mappable.this.Mapper">Mapper</a><span class="delimiter">)</span>: <a href="../../../Option.scala.html#560" title="Option[t]">Option</a><span class="delimiter">[</span>t<span class="delimiter">]</span> = <span class="delimiter">(</span><span class="keyword">for</span> <span class="delimiter">(</span><a title="t" id="1021406">x</a> &lt;- <a href="../../../Option.scala.html#48480" title="(f: t =&gt; t)Option[t]">xs</a><span class="delimiter">)</span> <span class="keyword">yield</span> <a href="#1021220" title="(x: t)(implicit evidence$1: t =&gt; Mappable.this.Mappable[t])t">f</a><a href="#1021266" title="t =&gt; Mappable.this.Mappable[t]" class="delimiter">(</a><a href="#1021406" title="t">x</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/** This component provides functionality for enforcing variable binding
 *  during parse-time.
 *
 *  When parsing simple languages, like Featherweight Scala, these parser
 *  combinators will fully enforce the binding discipline. When names are
 *  allowed to be left unqualified, these mechanisms would have to be
 *  complemented by an extra phase that resolves names that couldn't be
 *  resolved using the naive binding rules. (Maybe some machinery to
 *  model `implicit` binders (e.g., `this` and imported qualifiers)
 *  and selection on a binder will suffice?)
 *
 * @author Adriaan Moors
 */</span>
<span class="keyword">trait</span> <a title="trait Binders extends java.lang.Object with scala.util.parsing.ast.AbstractSyntax with scala.util.parsing.ast.Mappable with ScalaObject" id="44700">Binders</a> <a href="../../../ScalaObject.scala.html#464" title="ScalaObject" class="keyword">extends</a> <a href="AbstractSyntax.scala.html#44775" title="scala.util.parsing.ast.AbstractSyntax">AbstractSyntax</a> <span class="keyword">with</span> <a href="#44715" title="scala.util.parsing.ast.Mappable">Mappable</a> <span class="delimiter">{</span>
  <span class="comment">/** A `Scope` keeps track of one or more syntactic elements that represent bound names.
   *  The elements it contains share the same scope and must all be distinct, as determined by `==`.
   *
   *  A `NameElement` `n` in the AST that is conceptually bound by a `Scope` `s`, is replaced by a
   *  `BoundElement(n, s)`. (For example, in `val x:Int=x+1`, the first `x` is modelled by a
   *  Scope `s` that contains `x` and the second `x` is represented by a `BoundElement(x, s)`)
   *  The term (`x+1`) in scope of the Scope becomes an `UnderBinder(s, x+1)`.
   *
   *  A `NameElement` `n` is bound by a `Scope` `s` if it is wrapped as a `BoundElement(n, s)`, and
   *  `s` has a binder element that is semantically equal (`equals` or `==`) to `n`.
   *
   *  A `Scope` is represented textually by its list of binder elements, followed by the scope's `id`.
   *  For example: `[x, y]!1` represents the scope with `id` `1` and binder elements `x` and `y`.
   *  (`id` is solely used for this textual representation.)
   */</span>
  <span class="keyword">class</span> <a title="class Scope[binderType &lt;: Binders.this.NameElement] extends java.lang.Object with Iterable[binderType] with ScalaObject" id="1021422">Scope</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Binders.this.NameElement" id="1021423">binderType</a> &lt;: NameElement<span class="delimiter">]</span> <a href="../../../ScalaObject.scala.html#464" title="ScalaObject" class="keyword">extends</a> <a href="../../../collection/Iterable.scala.html#8279" title="Iterable[binderType]">Iterable</a><span class="delimiter">[</span>binderType<span class="delimiter">]</span><span class="delimiter">{</span>
    <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.Map[binderType,Binders.this.Element]" id="1021471">substitution</a>: <a href="../../../collection/mutable/Map.scala.html#14767" title="scala.collection.mutable.Map[binderType,Binders.this.Element]">Map</a><span class="delimiter">[</span>binderType, Element<span class="delimiter">]</span> =
      <span title="scala.collection.mutable.LinkedHashMap[binderType,Binders.this.Element]" class="keyword">new</span> scala.collection.mutable.<a href="../../../collection/mutable/LinkedHashMap.scala.html#15073" title="scala.collection.mutable.LinkedHashMap[binderType,Binders.this.Element]">LinkedHashMap</a><span class="delimiter">[</span>binderType, Element<span class="delimiter">]</span> <span class="comment">// a LinkedHashMap is ordered by insertion order -- important!</span>

    <span class="comment">/** Returns a unique number identifying this Scope (only used for representation purposes). */</span>
    <span class="keyword">val</span> <a title="Int" id="1021473">id</a>: <a href="../../../Int.scala.html#386" title="Int">Int</a> = <a href="#1021466" title="object Binders.this._Binder">_Binder</a>.<a href="#1021498" title="=&gt; Int">genId</a>

    <span class="comment">/** Returns the binders in this scope.
     *  For a typical let-binding, this is just the variable name. For an argument list to a method body,
     *  there is one binder per formal argument.
     */</span>
    <span class="keyword">def</span> <a title="=&gt; Iterator[binderType]" id="1021475">iterator</a> = <a href="#1021471" title="=&gt; scala.collection.mutable.Map[binderType,Binders.this.Element]">substitution</a>.<a href="../../../collection/MapLike.scala.html#73209" title="=&gt; Iterator[binderType]">keysIterator</a>

    <span class="comment">/** Return the `i`th binder in this scope. */</span>
    <span class="keyword">def</span> <a title="(i: Int)binderType" id="1021476">apply</a><span class="delimiter">(</span><a title="Int" id="1021551">i</a>: <a href="../../../Int.scala.html#386" title="Int">Int</a><span class="delimiter">)</span>: <a href="#1021423" title="binderType">binderType</a> = <a href="#1021422" title="Scope.this.type" class="keyword">this</a>.<a href="#1021475" title="=&gt; Iterator[binderType]">iterator</a>.<a href="../../../collection/LinearSeqOptimized.scala.html#71031" title="(n: Int)binderType">toList</a><span class="delimiter">(</span><a href="#1021551" title="Int">i</a><span class="delimiter">)</span>

    <span class="comment">/** Returns true if this container has a binder equal (as determined by `==`) to `b`. */</span>
    <span class="keyword">def</span> <a title="(b: binderType)Boolean" id="1021477">binds</a><span class="delimiter">(</span><a title="binderType" id="1021566">b</a>: <a href="#1021423" title="binderType">binderType</a><span class="delimiter">)</span>: <a href="../../../Boolean.scala.html#65" title="Boolean">Boolean</a> = <a href="#1021471" title="=&gt; scala.collection.mutable.Map[binderType,Binders.this.Element]">substitution</a>.<a href="../../../collection/MapLike.scala.html#73205" title="(key: binderType)Boolean">contains</a><span class="delimiter">(</span><a href="#1021566" title="binderType">b</a><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="(b: binderType)Option[Int]" id="1021478">indexFor</a><span class="delimiter">(</span><a title="binderType" id="1021569">b</a>: <a href="#1021423" title="binderType">binderType</a><span class="delimiter">)</span>: <a href="../../../Option.scala.html#560" title="Option[Int]">Option</a><span class="delimiter">[</span>Int<span class="delimiter">]</span> = <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="zipWithIndex extends java.lang.Object with Iterator[(binderType, Int)]" id="1021571">iter</a> = <a href="#1021422" title="Scope.this.type" class="keyword">this</a>.<a href="#1021475" title="=&gt; Iterator[binderType]">iterator</a>.<a href="../../../collection/Iterator.scala.html#59146" title="=&gt; java.lang.Object with Iterator[(binderType, Int)]{def idx: Int; def idx_=(x$1: Int): Unit}">zipWithIndex</a>
      <span class="keyword">for</span> <span class="delimiter">(</span><span class="delimiter">(</span><a title="binderType" id="1021596">that</a>, <a title="Int" id="1021597">count</a><span class="delimiter">)</span> &lt;- <a href="../../../collection/Iterator.scala.html#59154" title="(f: ((binderType, Int)) =&gt; Unit)Unit">iter</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#1021596" title="binderType">that</a>.<a href="AbstractSyntax.scala.html#1021184" title="=&gt; String">name</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#1021569" title="binderType">b</a>.<a href="AbstractSyntax.scala.html#1021184" title="=&gt; String">name</a><span class="delimiter">)</span> <span class="comment">// TODO: why do name equals and structural equals differ?</span>
          <span title="Nothing" class="keyword">return</span> <a href="../../../Option.scala.html#57885" title="(x: Int)Some[Int]">Some</a><span class="delimiter">(</span><a href="#1021597" title="Int">count</a> <a href="../../../Int.scala.html#54804" title="(x: Int)Int">+</a> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
        <span class="keyword">else</span>
          <a href="../../../Console.scala.html#507" title="object Console">Console</a>.<a href="../../../Console.scala.html#58055" title="(x: Any)Unit">println</a><span class="delimiter">(</span><a href="../../../Predef.scala.html#9681" title="implicit scala.Predef.any2stringadd : (x: Any)scala.runtime.StringAdd">that</a><a href="../../../runtime/StringAdd.scala.html#58450" title="(other: String)java.lang.String">+</a><span title="java.lang.String(&quot;!=&quot;)" class="string">&quot;!=&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#1021569" title="binderType">b</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>

      <a href="../../../Option.scala.html#1737" title="object None">None</a>
    <span class="delimiter">}</span>

    <span class="comment">/** Adds a new binder, for example the variable name in a local variable declaration.
     *
     * @param b a new binder that is distinct from the existing binders in this scope,
     *           and shares their conceptual scope. `canAddBinder(b)` must hold.
     * @return `binds(b)` and `getElementFor(b) eq b` will hold.
     */</span>
    <span class="keyword">def</span> <a title="(b: binderType)Unit" id="1021479">addBinder</a><span class="delimiter">(</span><a title="binderType" id="1021649">b</a>: <a href="#1021423" title="binderType">binderType</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#1021471" title="=&gt; scala.collection.mutable.Map[binderType,Binders.this.Element]">substitution</a> <a href="../../../collection/mutable/MapLike.scala.html#73273" title="(kv: (binderType, Binders.this.Element))Scope.this.substitution.type">+=</a> <a href="../../../Predef.scala.html#57855" title="(x: binderType, y: binderType)(binderType, binderType)">Pair</a><span class="delimiter">(</span><a href="#1021649" title="binderType">b</a>, <a href="#1021649" title="binderType">b</a><span class="delimiter">)</span> <span class="delimiter">}</span>

    <span class="comment">// TODO: strengthen this condition so that no binders may be added after this scope has been</span>
    <span class="comment">//       linked to its `UnderBinder` (i.e., while parsing, BoundElements may be added to the Scope</span>
    <span class="comment">//       associated to the UnderBinder, but after that, no changes are allowed, except for substitution)?</span>
    <span class="comment">/** `canAddElement` indicates whether `b` may be added to this scope.
     *
     * TODO: strengthen this condition so that no binders may be added after this scope has been
     *       linked to its `UnderBinder' (i.e., while parsing, BoundElements may be added to the Scope
     *       associated to the UnderBinder, but after that, no changes are allowed, except for substitution)?
     *
     * @return true if `b` had not been added yet
     */</span>
    <span class="keyword">def</span> <a title="(b: binderType)Boolean" id="1021480">canAddBinder</a><span class="delimiter">(</span><a title="binderType" id="1021665">b</a>: <a href="#1021423" title="binderType">binderType</a><span class="delimiter">)</span>: <a href="../../../Boolean.scala.html#65" title="Boolean">Boolean</a> = <a href="../../../Boolean.scala.html#55576" title="=&gt; Boolean">!</a><a href="#1021477" title="(b: binderType)Boolean">binds</a><span class="delimiter">(</span><a href="#1021665" title="binderType">b</a><span class="delimiter">)</span>

    <span class="comment">/** ''Replaces'' the bound occurrences of a contained binder by their new value.
     *  The bound occurrences of `b` are not actually replaced; the scope keeps track
     *  of a substitution that maps every binder to its current value. Since a `BoundElement` is
     *  a proxy for the element it is bound to by its binder, `substitute` may thus be thought of
     *  as replacing all the bound occurrences of the given binder `b` by their new value `value`.
     *
     *  @param b    the binder whose bound occurrences should be given a new value. `binds(b)` must hold.
     *  @param value the new value for the bound occurrences of `b`
     *  @return `getElementFor(b) eq value` will hold.
     */</span>
    <span class="keyword">def</span> <a title="(b: binderType, value: Binders.this.Element)Unit" id="1021481">substitute</a><span class="delimiter">(</span><a title="binderType" id="1021667">b</a>: <a href="#1021423" title="binderType">binderType</a>, <a title="Binders.this.Element" id="1021668">value</a>: <a href="AbstractSyntax.scala.html#1021173" title="Binders.this.Element">Element</a><span class="delimiter">)</span>: <a href="../../../Unit.scala.html#461" title="Unit">Unit</a> = <a href="../../../collection/mutable/MapLike.scala.html#73272" title="(key: binderType, value: Binders.this.Element)Unit">substitution</a><span class="delimiter">(</span><a href="#1021667" title="binderType">b</a><span class="delimiter">)</span> = <a href="#1021668" title="Binders.this.Element">value</a>

    <span class="comment">/** Returns the current value for the bound occurrences of `b`.
     *
     *  @param b the contained binder whose current value should be returned `binds(b)` must hold.
     */</span>
    <span class="keyword">def</span> <a title="(b: binderType)Binders.this.Element" id="1021482">getElementFor</a><span class="delimiter">(</span><a title="binderType" id="1021672">b</a>: <a href="#1021423" title="binderType">binderType</a><span class="delimiter">)</span>: <a href="AbstractSyntax.scala.html#1021173" title="Binders.this.Element">Element</a> = <a href="../../../collection/MapLike.scala.html#73204" title="(key: binderType)Binders.this.Element">substitution</a><span class="delimiter">(</span><a href="#1021672" title="binderType">b</a><span class="delimiter">)</span>

    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="1021483">toString</a>: <span title="String">String</span> =  <a href="#1021422" title="Scope.this.type" class="keyword">this</a>.<a href="#1021475" title="=&gt; Iterator[binderType]">iterator</a>.<a href="../../../collection/TraversableOnce.scala.html#53691" title="=&gt; List[binderType]">toList</a>.<a href="../../../collection/TraversableOnce.scala.html#53708" title="(start: String, sep: String, end: String)String">mkString</a><span class="delimiter">(</span><span title="java.lang.String(&quot;[&quot;)" class="string">&quot;[&quot;</span>,<span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span>,<span title="java.lang.String(&quot;]&quot;)" class="string">&quot;]&quot;</span><span class="delimiter">)</span><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;!&quot;)" class="string">&quot;!&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#1021473" title="=&gt; Int">id</a> <span class="comment">// TODO show substitution?</span>

    <span class="comment">/** Returns a list of strings that represent the binder elements, each tagged with this scope's id. */</span>
    <span class="keyword">def</span> <a title="=&gt; List[String]" id="1021484">bindersToString</a>: <a href="../../../collection/immutable/List.scala.html#14047" title="List[String]">List</a><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span class="delimiter">(</span><span class="keyword">for</span><span class="delimiter">(</span><a title="binderType" id="1021707">b</a> &lt;- <a href="#1021422" title="Scope.this.type" class="keyword">this</a>.<a href="../../../collection/Iterator.scala.html#59115" title="(f: binderType =&gt; java.lang.String)Iterator[java.lang.String]">iterator</a><span class="delimiter">)</span> <span class="keyword">yield</span> <a href="../../../Predef.scala.html#9681" title="implicit scala.Predef.any2stringadd : (x: Any)scala.runtime.StringAdd">b</a><a href="../../../runtime/StringAdd.scala.html#58450" title="(other: String)java.lang.String">+</a><span title="java.lang.String(&quot;!&quot;)" class="string">&quot;!&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#1021473" title="=&gt; Int">id</a><span class="delimiter">)</span>.<a href="../../../collection/TraversableOnce.scala.html#53691" title="=&gt; List[java.lang.String]">toList</a>

    <span class="comment">/** Return a new inheriting scope that won't check whether binding is respected until the scope is left (so as to support forward references). */</span>
    <span class="keyword">def</span> <a title="=&gt; Binders.this.Scope[binderType]" id="1021485">allowForwardRef</a>: <a href="#1021422" title="Binders.this.Scope[binderType]">Scope</a><span class="delimiter">[</span>binderType<span class="delimiter">]</span> = <a href="#1021422" title="Binders.this.Scope[binderType]" class="keyword">this</a> <span class="comment">// TODO</span>

    <span class="comment">/** Return a nested scope -- binders entered into it won't be visible in this scope, but if this scope allows forward references,
     *  the binding in the returned scope also does, and thus the check that all variables are bound is deferred until this scope is left.
     */</span>
    <span class="keyword">def</span> <a title="=&gt; Binders.this.Scope[binderType]" id="1021486">nested</a>: <a href="#1021422" title="Binders.this.Scope[binderType]">Scope</a><span class="delimiter">[</span>binderType<span class="delimiter">]</span> = <a href="#1021422" title="Binders.this.Scope[binderType]" class="keyword">this</a> <span class="comment">// TODO</span>

    <span class="keyword">def</span> <a title="()Unit" id="1021487">onEnter</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="()Unit" id="1021488">onLeft</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="Unit" class="delimiter">{</span><span class="delimiter">}</span>
  <span class="delimiter">}</span>


  <span class="keyword">trait</span> <a title="trait BindingSensitive extends java.lang.Object" id="1021424">BindingSensitive</a> <span title="java.lang.Object" class="delimiter">{</span>
    <span class="comment">// would like to specify this as one method:</span>
    <span class="comment">// def alpha_==[t &lt;: NameElement](other: BoundElement[t]): Boolean</span>
    <span class="comment">// def alpha_==[bt &lt;: binderType, st &lt;: elementT](other: UnderBinder[bt, st]): Boolean</span>
  <span class="delimiter">}</span>

  <span class="comment">/** A `BoundElement` is bound in a certain scope `scope`, which keeps track of the actual element that
   *  `el` stands for.
   *
   *  A `BoundElement` is represented textually by its bound element, followed by its scope's `id`.
   *  For example: `x@1` represents the variable `x` that is bound in the scope with `id` `1`.
   *
   *  @note `scope.binds(el)` holds before and after.
   */</span>
  case <span class="keyword">class</span> <a title="class BoundElement[boundElement &lt;: Binders.this.NameElement] extends java.lang.Object with Binders.this.NameElement with Proxy with Binders.this.BindingSensitive with ScalaObject with Product with Serializable" id="1021944">BoundElement</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Binders.this.NameElement" id="1021946">boundElement</a> &lt;: NameElement<span class="delimiter">]</span><a href="../../../ScalaObject.scala.html#464" title="ScalaObject" class="delimiter">(</a><a title="boundElement" id="1022190">el</a>: <a href="#1021946" title="boundElement">boundElement</a>, <a title="Binders.this.Scope[boundElement]" id="1022191">scope</a>: <a href="#1021422" title="Binders.this.Scope[boundElement]">Scope</a><span class="delimiter">[</span>boundElement<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="AbstractSyntax.scala.html#1021174" title="Binders.this.NameElement">NameElement</a> <span class="keyword">with</span> <a href="../../../Proxy.scala.html#539" title="Proxy">Proxy</a> <span class="keyword">with</span> <a href="#1021424" title="Binders.this.BindingSensitive">BindingSensitive</a> <span class="delimiter">{</span>
    <span class="comment">/** Returns the element this `BoundElement` stands for.
     *  The `Proxy` trait ensures `equals`, `hashCode` and `toString` are forwarded to
     *  the result of this method.
     */</span>
    <span class="keyword">def</span> <a title="=&gt; Binders.this.Element" id="1021759">self</a>: <a href="AbstractSyntax.scala.html#1021173" title="Binders.this.Element">Element</a> = <a href="#1022191" title="=&gt; Binders.this.Scope[boundElement]">scope</a>.<a href="#1021482" title="(b: boundElement)Binders.this.Element">getElementFor</a><span class="delimiter">(</span><a href="#1022190" title="=&gt; boundElement">el</a><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="=&gt; String" id="1021760">name</a> = <a href="#1021759" title="=&gt; Binders.this.Element">self</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Binders.this.NameElement" class="delimiter">[</span><a href="AbstractSyntax.scala.html#1021174" title="Binders.this.NameElement">NameElement</a><span class="delimiter">]</span>.<a href="AbstractSyntax.scala.html#1021184" title="=&gt; String">name</a> <span class="comment">// TODO: this is only safe when substituted to a NameElement, which certainly isn't required -- I want dynamic inheritance! :)</span>

    <span class="comment">// decorate element's representation with the id of the scope it's bound in</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="1021761">toString</a>: <span title="String">String</span> =  <a href="#1021944" title="Binders.this.BoundElement[boundElement]" class="keyword">super</a>.<a href="../../../Proxy.scala.html#54412" title="()String">toString</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;@&quot;)" class="string">&quot;@&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#1022191" title="=&gt; Binders.this.Scope[boundElement]">scope</a>.<a href="#1021473" title="=&gt; Int">id</a>

    <span class="keyword">def</span> <a title="[t &lt;: Binders.this.NameElement](other: Binders.this.BoundElement[t])Boolean" id="1021762">alpha_==</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Binders.this.NameElement" id="1021764">t</a> &lt;: NameElement<span class="delimiter">]</span><span class="delimiter">(</span><a title="Binders.this.BoundElement[t]" id="1021782">other</a>: <a href="#1021944" title="Binders.this.BoundElement[t]">BoundElement</a><span class="delimiter">[</span>t<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../Boolean.scala.html#65" title="Boolean">Boolean</a> = <a href="#1022191" title="=&gt; Binders.this.Scope[boundElement]">scope</a>.<a href="#1021478" title="(b: boundElement)Option[Int]">indexFor</a><span class="delimiter">(</span><a href="#1022190" title="=&gt; boundElement">el</a><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#1021782" title="Binders.this.BoundElement[t]">other</a>.<a href="#1022191" title="=&gt; Binders.this.Scope[t]">scope</a>.<a href="#1021478" title="(b: t)Option[Int]">indexFor</a><span class="delimiter">(</span><a href="#1021782" title="Binders.this.BoundElement[t]">other</a>.<a href="#1022190" title="=&gt; t">el</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** A variable that escaped its scope (i.e., a free variable) -- we don't deal very well with these yet
   */</span>
  <span class="keyword">class</span> <a title="class UnboundElement[N &lt;: Binders.this.NameElement] extends java.lang.Object with Binders.this.NameElement with ScalaObject" id="1021429">UnboundElement</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Binders.this.NameElement" id="1021430">N</a> &lt;: NameElement<span class="delimiter">]</span><a href="../../../ScalaObject.scala.html#464" title="ScalaObject" class="delimiter">(</a><span class="keyword">private</span> <span class="keyword">val</span> <a title="N" id="1021826">el</a>: <a href="#1021430" title="N">N</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="AbstractSyntax.scala.html#1021174" title="Binders.this.NameElement">NameElement</a> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="=&gt; java.lang.String" id="1021823">name</a> = <a href="#1021826" title="=&gt; N">el</a>.<a href="AbstractSyntax.scala.html#1021184" title="=&gt; String">name</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;@??&quot;)" class="string">&quot;@??&quot;</span>
  <span class="delimiter">}</span>

  <span class="comment">// this is useless, as Element is a supertype of BoundElement --&gt; the coercion will never be inferred</span>
  <span class="comment">// if we knew a more specific type for the element that the bound element represents, this could make sense</span>
  <span class="comment">// implicit def BoundElementProxy[t &lt;: NameElement](e: BoundElement[t]): Element = e.self</span>

  <span class="comment">/** Represents an element with variables that are bound in a certain scope. */</span>
  <span class="keyword">class</span> <a title="class UnderBinder[binderType &lt;: Binders.this.NameElement, elementT] extends java.lang.Object with Binders.this.Element with Binders.this.BindingSensitive with ScalaObject" id="1021431">UnderBinder</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Binders.this.NameElement" id="1021432">binderType</a>  &lt;: NameElement, <a title="&gt;: Nothing &lt;: Any" id="1021433">elementT</a> &lt;% Mappable<span class="delimiter">[</span>elementT<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><span class="keyword">val</span> <a title="Binders.this.Scope[binderType]" id="1021834">scope</a>: <a href="#1021422" title="Binders.this.Scope[binderType]">Scope</a><span class="delimiter">[</span>binderType<span class="delimiter">]</span>, <span class="keyword">private</span><span class="delimiter">[</span>Binders<span class="delimiter">]</span> <span class="keyword">val</span> <a title="elementT" id="1021835">element</a>: <a href="#1021433" title="elementT">elementT</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="AbstractSyntax.scala.html#1021173" title="Binders.this.Element">Element</a> <span class="keyword">with</span> <a href="#1021424" title="Binders.this.BindingSensitive">BindingSensitive</a> <span class="delimiter">{</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="()String" id="1021531">toString</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;(&quot;)" class="string">&quot;(&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#1021834" title="=&gt; Binders.this.Scope[binderType]">scope</a>.<a href="#1021483" title="()String">toString</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;) in { &quot;)" class="string">&quot;) in { &quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#1021835" title="=&gt; elementT">element</a>.<span title="()java.lang.String">toString</span><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot; }&quot;)" class="string">&quot; }&quot;</span>

    <span class="comment">/** Alpha-equivalence -- TODO
     *  Returns true if the `element` of the `other` `UnderBinder` is equal to this `element` up to alpha-conversion.
     *
     *  That is, regular equality is used for all elements but `BoundElement`s: such an element is
     *  equal to a `BoundElement` in `other` if their binders are equal. Binders are equal if they
     *  are at the same index in their respective scope.
     *
     *  Example:
     *  {{{
     *    UnderBinder([x, y]!1, x@1) alpha_== UnderBinder([a, b]!2, a@2)
     *    ! (UnderBinder([x, y]!1, y@1) alpha_== UnderBinder([a, b]!2, a@2))
     *  }}}
     */</span>
    <span class="comment">/*def alpha_==[bt &lt;: binderType, st &lt;: elementT](other: UnderBinder[bt, st]): Boolean = {
       var result = true

       // TODO: generic zip or gmap2
       element.gmap2(other.element, new Mapper2 {
         def apply[s  &lt;% Mappable[s], t  &lt;% Mappable[t]](x :{s, t}): {s, t} = x match {
           case {be1: BoundElement[_], be2: BoundElement[_]} =&gt; result == result &amp;&amp; be1.alpha_==(be2) // monadic gmap (cheating using state directly)
           case {ub1: UnderBinder[_, _], ub2: UnderBinder[_, _]} =&gt; result == result &amp;&amp; be1.alpha_==(be2)
           case {a, b} =&gt; result == result &amp;&amp; a.equals(b)
         }; x
       })
    }*/</span>

    <span class="keyword">def</span> <a title="(subst: scala.collection.immutable.Map[Binders.this.NameElement,Binders.this.NameElement])elementT" id="1021532">cloneElementWithSubst</a><span class="delimiter">(</span><a title="scala.collection.immutable.Map[Binders.this.NameElement,Binders.this.NameElement]" id="1021839">subst</a>: scala.collection.immutable.<a href="../../../collection/immutable/Map.scala.html#13468" title="scala.collection.immutable.Map[Binders.this.NameElement,Binders.this.NameElement]">Map</a><span class="delimiter">[</span>NameElement, NameElement<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="../../../Function1.scala.html#53453" title="(v1: elementT)Binders.this.Mappable[elementT]">element</a>.<a href="#1021224" title="(f: Binders.this.Mapper)elementT">gmap</a><span class="delimiter">(</span><a href="#1021866" title="java.lang.Object with Binders.this.Mapper" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with Binders.this.Mapper" id="1021866">Mapper</a> <span class="delimiter">{</span> <span class="keyword">def</span> <a title="[t](x: t)(implicit evidence$6: t =&gt; Binders.this.Mappable[t])t" id="1021874">apply</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="1021872">t</a> &lt;% Mappable<span class="delimiter">[</span>t<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><a title="t" id="1021873">x</a> :<a href="#1021872" title="t">t</a><span class="delimiter">)</span>: <a href="#1021872" title="t">t</a> = <a href="#1021873" title="t">x</a> <span title="t" class="keyword">match</span><span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="t" id="1021889">substable</a>: <a href="AbstractSyntax.scala.html#1021174" title="Binders.this.NameElement">NameElement</a> <span class="keyword">if</span> <a href="#1021839" title="scala.collection.immutable.Map[Binders.this.NameElement,Binders.this.NameElement]">subst</a>.<a href="../../../collection/MapLike.scala.html#73205" title="(key: Binders.this.NameElement)Boolean">contains</a><span class="delimiter">(</span><a href="#1021889" title="Binders.this.NameElement">substable</a><span class="delimiter">)</span> =&gt; <a href="#1021839" title="scala.collection.immutable.Map[Binders.this.NameElement,Binders.this.NameElement]">subst</a>.<a href="../../../collection/MapLike.scala.html#73194" title="(key: Binders.this.NameElement)Option[Binders.this.NameElement]">get</a><span class="delimiter">(</span><a href="#1021889" title="Binders.this.NameElement">substable</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="t" class="delimiter">[</span><a href="#1021872" title="t">t</a><span class="delimiter">]</span> <span class="comment">// TODO: wrong... substitution is not (necessarily) the identity function</span>
         <span class="comment">//Console.println(&quot;substed: &quot;+substable+&quot;-&gt; &quot;+subst.get(substable)+&quot;)&quot;);</span>
      <span class="keyword">case</span> <a title="t" id="1021893">x</a> =&gt; <a href="#1021893" title="t">x</a> <span class="comment">// Console.println(&quot;subst: &quot;+x+&quot;(keys: &quot;+subst.keys+&quot;)&quot;);x</span>
    <span class="delimiter">}</span><span class="delimiter">}</span><span class="delimiter">)</span>

    <span class="comment">// TODO</span>
    <span class="keyword">def</span> <a title="=&gt; elementT" id="1021533">cloneElementNoBoundElements</a> = <a href="../../../Function1.scala.html#53453" title="(v1: elementT)Binders.this.Mappable[elementT]">element</a>.<a href="#1021224" title="(f: Binders.this.Mapper)elementT">gmap</a><span class="delimiter">(</span><a href="#1021919" title="java.lang.Object with Binders.this.Mapper" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with Binders.this.Mapper" id="1021919">Mapper</a> <span class="delimiter">{</span> <span class="keyword">def</span> <a title="[t](x: t)(implicit evidence$7: t =&gt; Binders.this.Mappable[t])t" id="1021927">apply</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="1021925">t</a> &lt;% Mappable<span class="delimiter">[</span>t<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><a title="t" id="1021926">x</a> :<a href="#1021925" title="t">t</a><span class="delimiter">)</span>: <a href="#1021925" title="t">t</a> = <a href="#1021926" title="t">x</a> <span title="t" class="keyword">match</span><span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="t">BoundElement</span><span class="delimiter">(</span><a title="Binders.this.NameElement" id="1021978">el</a>, _<span class="delimiter">)</span> =&gt; <span title="Binders.this.UnboundElement[Binders.this.NameElement]" class="keyword">new</span> <a href="#1021429" title="Binders.this.UnboundElement[Binders.this.NameElement]">UnboundElement</a><span class="delimiter">(</span><a href="#1021978" title="Binders.this.NameElement">el</a><span class="delimiter">)</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="t" class="delimiter">[</span><a href="#1021925" title="t">t</a><span class="delimiter">]</span> <span class="comment">// TODO: precision stuff</span>
      <span class="keyword">case</span> <a title="t" id="1021982">x</a> =&gt; <a href="#1021982" title="t">x</a>
    <span class="delimiter">}</span><span class="delimiter">}</span><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="=&gt; elementT" id="1021534">extract</a>: <a href="#1021433" title="elementT">elementT</a> = <a href="#1021533" title="=&gt; elementT">cloneElementNoBoundElements</a>
    <span class="keyword">def</span> <a title="(subst: scala.collection.immutable.Map[Binders.this.NameElement,Binders.this.NameElement])elementT" id="1021535">extract</a><span class="delimiter">(</span><a title="scala.collection.immutable.Map[Binders.this.NameElement,Binders.this.NameElement]" id="1021987">subst</a>: scala.collection.immutable.<a href="../../../collection/immutable/Map.scala.html#13468" title="scala.collection.immutable.Map[Binders.this.NameElement,Binders.this.NameElement]">Map</a><span class="delimiter">[</span>NameElement, NameElement<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#1021433" title="elementT">elementT</a> = <a href="#1021532" title="(subst: scala.collection.immutable.Map[Binders.this.NameElement,Binders.this.NameElement])elementT">cloneElementWithSubst</a><span class="delimiter">(</span><a href="#1021987" title="scala.collection.immutable.Map[Binders.this.NameElement,Binders.this.NameElement]">subst</a><span class="delimiter">)</span>

    <span class="comment">/** Get a string representation of element, normally we don't allow direct access to element, but just getting a string representation is ok*/</span>
    <span class="keyword">def</span> <a title="=&gt; String" id="1021536">elementToString</a>: <span title="String">String</span> = <a href="#1021835" title="=&gt; elementT">element</a>.<span title="()java.lang.String">toString</span>
  <span class="delimiter">}</span>

  <span class="comment">//SYB type class instances</span>
  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="[bt &lt;: Binders.this.NameElement, st](ub: Binders.this.UnderBinder[bt,st])(implicit evidence$8: bt =&gt; Binders.this.Mappable[bt], implicit evidence$9: st =&gt; Binders.this.Mappable[st])Binders.this.Mappable[Binders.this.UnderBinder[bt,st]]" id="1021517">UnderBinderIsMappable</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Binders.this.NameElement" id="1021437">bt</a> &lt;: NameElement &lt;% Mappable<span class="delimiter">[</span>bt<span class="delimiter">]</span>, <a title="&gt;: Nothing &lt;: Any" id="1021438">st</a> &lt;% Mappable<span class="delimiter">[</span>st<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><a title="Binders.this.UnderBinder[bt,st]" id="1021515">ub</a>: <a href="#1021431" title="Binders.this.UnderBinder[bt,st]">UnderBinder</a><span class="delimiter">[</span>bt, st<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#1021204" title="Binders.this.Mappable[Binders.this.UnderBinder[bt,st]]">Mappable</a><span class="delimiter">[</span>UnderBinder<span class="delimiter">[</span>bt, st<span class="delimiter">]</span><span class="delimiter">]</span> =
    <a href="#1021991" title="java.lang.Object with Binders.this.Mappable[Binders.this.UnderBinder[bt,st]]" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with Binders.this.Mappable[Binders.this.UnderBinder[bt,st]]" id="1021991">Mappable</a><span class="delimiter">[</span>UnderBinder<span class="delimiter">[</span>bt, st<span class="delimiter">]</span><span class="delimiter">]</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(f: Binders.this.Mapper)Binders.this.UnderBinder[bt,st]" id="1021995">gmap</a><span class="delimiter">(</span><a title="Binders.this.Mapper" id="1021996">f</a>: <a href="#1021203" title="Binders.this.Mapper">Mapper</a><span class="delimiter">)</span>: <a href="#1021431" title="Binders.this.UnderBinder[bt,st]">UnderBinder</a><span class="delimiter">[</span>bt, st<span class="delimiter">]</span> = <a href="#1022014" title="(scope: Binders.this.Scope[bt], element: st)(implicit evidence$11: st =&gt; Binders.this.Mappable[st])Binders.this.UnderBinder[bt,st]">UnderBinder</a><a href="#1021517" title="st =&gt; Binders.this.Mappable[st]" class="delimiter">(</a><a href="#1021220" title="(x: Binders.this.Scope[bt])(implicit evidence$1: Binders.this.Scope[bt] =&gt; Binders.this.Mappable[Binders.this.Scope[bt]])Binders.this.Scope[bt]">f</a><a href="#1021538" title="(scope: Binders.this.Scope[bt])(implicit evidence$10: bt =&gt; Binders.this.Mappable[bt])Binders.this.Mappable[Binders.this.Scope[bt]]" class="delimiter">(</a><a href="#1021515" title="Binders.this.UnderBinder[bt,st]">ub</a>.<a href="#1021834" title="=&gt; Binders.this.Scope[bt]">scope</a><span class="delimiter">)</span>, <a href="#1021220" title="(x: st)(implicit evidence$1: st =&gt; Binders.this.Mappable[st])st">f</a><a href="#1021517" title="st =&gt; Binders.this.Mappable[st]" class="delimiter">(</a><a href="#1021515" title="Binders.this.UnderBinder[bt,st]">ub</a>.<a href="#1021835" title="=&gt; st">element</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="[bt &lt;: Binders.this.NameElement](scope: Binders.this.Scope[bt])(implicit evidence$10: bt =&gt; Binders.this.Mappable[bt])Binders.this.Mappable[Binders.this.Scope[bt]]" id="1021538">ScopeIsMappable</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Binders.this.NameElement" id="1021441">bt</a> &lt;: NameElement &lt;% Mappable<span class="delimiter">[</span>bt<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><a title="Binders.this.Scope[bt]" id="1021537">scope</a>: <a href="#1021422" title="Binders.this.Scope[bt]">Scope</a><span class="delimiter">[</span>bt<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#1021204" title="Binders.this.Mappable[Binders.this.Scope[bt]]">Mappable</a><span class="delimiter">[</span>Scope<span class="delimiter">[</span>bt<span class="delimiter">]</span><span class="delimiter">]</span> =
    <a href="#1022127" title="java.lang.Object with Binders.this.Mappable[Binders.this.Scope[bt]]" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with Binders.this.Mappable[Binders.this.Scope[bt]]" id="1022127">Mappable</a><span class="delimiter">[</span>Scope<span class="delimiter">[</span>bt<span class="delimiter">]</span><span class="delimiter">]</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(f: Binders.this.Mapper)Binders.this.Scope[bt]" id="1022131">gmap</a><span class="delimiter">(</span><a title="Binders.this.Mapper" id="1022132">f</a>: <a href="#1021203" title="Binders.this.Mapper">Mapper</a><span class="delimiter">)</span>: <a href="#1021422" title="Binders.this.Scope[bt]">Scope</a><span class="delimiter">[</span>bt<span class="delimiter">]</span> = <span class="delimiter">{</span> <span class="keyword">val</span> <a title="Binders.this.Scope[bt]" id="1022137">newScope</a> = <span title="Binders.this.Scope[bt]" class="keyword">new</span> <a href="#1021422" title="Binders.this.Scope[bt]">Scope</a><span class="delimiter">[</span>bt<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="keyword">for</span><span class="delimiter">(</span><a title="bt" id="1022154">b</a> &lt;- <a href="../../../collection/IterableLike.scala.html#53856" title="(f: bt =&gt; Unit)Unit">scope</a><span class="delimiter">)</span> <a href="#1022137" title="Binders.this.Scope[bt]">newScope</a>.<a href="#1021479" title="(b: bt)Unit">addBinder</a><span class="delimiter">(</span><a href="#1021220" title="(x: bt)(implicit evidence$1: bt =&gt; Binders.this.Mappable[bt])bt">f</a><a href="#1021538" title="bt =&gt; Binders.this.Mappable[bt]" class="delimiter">(</a><a href="#1022154" title="bt">b</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#1022137" title="Binders.this.Scope[bt]">newScope</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit scala.util.parsing.ast.Binders.NameElementIsMappable : (self: Binders.this.NameElement)Binders.this.Mappable[Binders.this.NameElement]" id="1021442">NameElementIsMappable</a><span class="delimiter">(</span><a title="Binders.this.NameElement" id="1021542">self</a>: <a href="AbstractSyntax.scala.html#1021174" title="Binders.this.NameElement">NameElement</a><span class="delimiter">)</span>: <a href="#1021204" title="Binders.this.Mappable[Binders.this.NameElement]">Mappable</a><span class="delimiter">[</span>NameElement<span class="delimiter">]</span> = <a href="#1022176" title="java.lang.Object with Binders.this.Mappable[Binders.this.NameElement]" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with Binders.this.Mappable[Binders.this.NameElement]" id="1022176">Mappable</a><span class="delimiter">[</span>NameElement<span class="delimiter">]</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(f: Binders.this.Mapper)Binders.this.NameElement" id="1022180">gmap</a><span class="delimiter">(</span><a title="Binders.this.Mapper" id="1022181">f</a>: <a href="#1021203" title="Binders.this.Mapper">Mapper</a><span class="delimiter">)</span>: <a href="AbstractSyntax.scala.html#1021174" title="Binders.this.NameElement">NameElement</a> = <a href="#1021542" title="Binders.this.NameElement">self</a> <span title="Binders.this.NameElement" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Binders.this.BoundElement[Binders.this.NameElement]">BoundElement</span><span class="delimiter">(</span><a title="Binders.this.NameElement" id="1022188">el</a>, <a title="Binders.this.Scope[Binders.this.NameElement]" id="1022189">scope</a><span class="delimiter">)</span> =&gt; <a href="#1021944" title="(el: Binders.this.NameElement, scope: Binders.this.Scope[Binders.this.NameElement])Binders.this.BoundElement[Binders.this.NameElement]">BoundElement</a><span class="delimiter">(</span><a href="#1021220" title="(x: Binders.this.NameElement)(implicit evidence$1: Binders.this.NameElement =&gt; Binders.this.Mappable[Binders.this.NameElement])Binders.this.NameElement">f</a><a href="#1021442" title="implicit scala.util.parsing.ast.Binders.NameElementIsMappable : (self: Binders.this.NameElement)Binders.this.Mappable[Binders.this.NameElement]" class="delimiter">(</a><a href="#1022188" title="Binders.this.NameElement">el</a><span class="delimiter">)</span>, <a href="#1021220" title="(x: Binders.this.Scope[Binders.this.NameElement])(implicit evidence$1: Binders.this.Scope[Binders.this.NameElement] =&gt; Binders.this.Mappable[Binders.this.Scope[Binders.this.NameElement]])Binders.this.Scope[Binders.this.NameElement]">f</a><a href="#1021538" title="(scope: Binders.this.Scope[Binders.this.NameElement])(implicit evidence$10: Binders.this.NameElement =&gt; Binders.this.Mappable[Binders.this.NameElement])Binders.this.Mappable[Binders.this.Scope[Binders.this.NameElement]]" class="delimiter">(</a><a href="#1022189" title="Binders.this.Scope[Binders.this.NameElement]">scope</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Binders.this.NameElement">_</span> =&gt; <a href="#1021443" title="(self: Binders.this.NameElement)Binders.this.Mappable[Binders.this.NameElement]">UserNameElementIsMappable</a><span class="delimiter">(</span><a href="#1021542" title="Binders.this.NameElement">self</a><span class="delimiter">)</span>.<a href="#1021224" title="(f: Binders.this.Mapper)Binders.this.NameElement">gmap</a><span class="delimiter">(</span><a href="#1022181" title="Binders.this.Mapper">f</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[t &lt;: Binders.this.NameElement](self: t)Binders.this.Mappable[t]" id="1021443">UserNameElementIsMappable</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Binders.this.NameElement" id="1021445">t</a> &lt;: NameElement<span class="delimiter">]</span><span class="delimiter">(</span><a title="t" id="1022241">self</a>: <a href="#1021445" title="t">t</a><span class="delimiter">)</span>: <a href="#1021204" title="Binders.this.Mappable[t]">Mappable</a><span class="delimiter">[</span>t<span class="delimiter">]</span>

  <span class="keyword">object</span> <a title="object Binders.this.UnderBinder" id="1021446">UnderBinder</a> <a href="../../../ScalaObject.scala.html#464" title="ScalaObject" class="delimiter">{</a>
    <span class="keyword">def</span> <a title="[binderType &lt;: Binders.this.NameElement, elementT](scope: Binders.this.Scope[binderType], element: elementT)(implicit evidence$11: elementT =&gt; Binders.this.Mappable[elementT])Binders.this.UnderBinder[binderType,elementT]" id="1022014">apply</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Binders.this.NameElement" id="1022005">binderType</a> &lt;: NameElement, <a title="&gt;: Nothing &lt;: Any" id="1022006">elementT</a> &lt;% Mappable<span class="delimiter">[</span>elementT<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><a title="Binders.this.Scope[binderType]" id="1022012">scope</a>: <a href="#1021422" title="Binders.this.Scope[binderType]">Scope</a><span class="delimiter">[</span>binderType<span class="delimiter">]</span>, <a title="elementT" id="1022013">element</a>: <a href="#1022006" title="elementT">elementT</a><span class="delimiter">)</span> = <a href="#1022014" title="Binders.this.UnderBinder[binderType,elementT]" class="keyword">new</a> <a href="#1021431" title="Binders.this.UnderBinder[binderType,elementT]">UnderBinder</a><span class="delimiter">(</span><a href="#1022012" title="Binders.this.Scope[binderType]">scope</a>, <a href="#1022013" title="elementT">element</a><span class="delimiter">)</span>
    <span class="keyword">def</span> <a title="[bt &lt;: Binders.this.NameElement, elementT](x: elementT)(implicit evidence$12: elementT =&gt; Binders.this.Mappable[elementT])Binders.this.UnderBinder[bt,elementT]" id="1022251">unit</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Binders.this.NameElement" id="1022010">bt</a> &lt;: NameElement, <a title="&gt;: Nothing &lt;: Any" id="1022011">elementT</a> &lt;% Mappable<span class="delimiter">[</span>elementT<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><a title="elementT" id="1022250">x</a>: <a href="#1022011" title="elementT">elementT</a><span class="delimiter">)</span> = <a href="#1022014" title="(scope: Binders.this.Scope[bt], element: elementT)(implicit evidence$11: elementT =&gt; Binders.this.Mappable[elementT])Binders.this.UnderBinder[bt,elementT]">UnderBinder</a><a href="#1022251" title="elementT =&gt; Binders.this.Mappable[elementT]" class="delimiter">(</a><span title="Binders.this.Scope[bt]" class="keyword">new</span> <a href="#1021422" title="Binders.this.Scope[bt]">Scope</a><span class="delimiter">[</span>bt<span class="delimiter">]</span><span class="delimiter">(</span><span class="delimiter">)</span>, <a href="#1022250" title="elementT">x</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** If a list of `UnderBinder`s all have the same scope, they can be turned in to an `UnderBinder`
   *  containing a list of the elements in the original `UnderBinder`.
   *
   *  The name `sequence` comes from the fact that this method's type is equal to the type of monadic sequence.
   *
   *  @note `!orig.isEmpty` implies `orig.forall(ub =&gt; ub.scope eq orig(0).scope)`
   *
   */</span>
  <span class="keyword">def</span> <a title="[bt &lt;: Binders.this.NameElement, st](orig: List[Binders.this.UnderBinder[bt,st]])(implicit evidence$13: st =&gt; Binders.this.Mappable[st])Binders.this.UnderBinder[bt,List[st]]" id="1022285">sequence</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Binders.this.NameElement" id="1021451">bt</a> &lt;: NameElement, <a title="&gt;: Nothing &lt;: Any" id="1021452">st</a> &lt;% Mappable<span class="delimiter">[</span>st<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><a title="List[Binders.this.UnderBinder[bt,st]]" id="1022284">orig</a>: <a href="../../../collection/immutable/List.scala.html#14047" title="List[Binders.this.UnderBinder[bt,st]]">List</a><span class="delimiter">[</span>UnderBinder<span class="delimiter">[</span>bt, st<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#1021431" title="Binders.this.UnderBinder[bt,List[st]]">UnderBinder</a><span class="delimiter">[</span>bt, List<span class="delimiter">[</span>st<span class="delimiter">]</span><span class="delimiter">]</span> =
    <span title="Binders.this.UnderBinder[bt,List[st]]" class="keyword">if</span><span class="delimiter">(</span><a href="#1022284" title="List[Binders.this.UnderBinder[bt,st]]">orig</a>.<a href="../../../collection/IterableLike.scala.html#53862" title="=&gt; Boolean">isEmpty</a><span class="delimiter">)</span> <a href="#1021446" title="object Binders.this.UnderBinder">UnderBinder</a>.<a href="#1022251" title="(x: List[st])(implicit evidence$12: List[st] =&gt; Binders.this.Mappable[List[st]])Binders.this.UnderBinder[bt,List[st]]">unit</a><a href="#1021273" title="(xs: List[st])(implicit evidence$3: st =&gt; Binders.this.Mappable[st])Binders.this.Mappable[List[st]]" class="delimiter">(</a><a href="../../../collection/immutable/List.scala.html#13700" title="object Nil">Nil</a><span class="delimiter">)</span>
    <span class="keyword">else</span> <a href="#1022014" title="(scope: Binders.this.Scope[bt], element: List[st])(implicit evidence$11: List[st] =&gt; Binders.this.Mappable[List[st]])Binders.this.UnderBinder[bt,List[st]]">UnderBinder</a><a href="#1021273" title="(xs: List[st])(implicit evidence$3: st =&gt; Binders.this.Mappable[st])Binders.this.Mappable[List[st]]" class="delimiter">(</a><a href="../../../collection/LinearSeqOptimized.scala.html#71031" title="(n: Int)Binders.this.UnderBinder[bt,st]">orig</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>.<a href="#1021834" title="=&gt; Binders.this.Scope[bt]">scope</a>, <a href="#1022284" title="List[Binders.this.UnderBinder[bt,st]]">orig</a>.<a href="../../../collection/TraversableLike.scala.html#49041" title="(f: Binders.this.UnderBinder[bt,st] =&gt; st)(implicit bf: scala.collection.generic.CanBuildFrom[List[Binders.this.UnderBinder[bt,st]],st,List[st]])List[st]">map</a><a href="../../../collection/immutable/List.scala.html#48868" title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,st,List[st]]" class="delimiter">(</a><a href="#1022361" title="Binders.this.UnderBinder[bt,st]">_</a>.<a href="#1021835" title="=&gt; st">element</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">// couldn't come up with a better name...</span>
  <span class="keyword">def</span> <a title="[bt &lt;: Binders.this.NameElement, st](orig: Binders.this.UnderBinder[bt,List[st]])(implicit evidence$14: st =&gt; Binders.this.Mappable[st])List[Binders.this.UnderBinder[bt,st]]" id="1022422">unsequence</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Binders.this.NameElement" id="1021456">bt</a> &lt;: NameElement, <a title="&gt;: Nothing &lt;: Any" id="1021457">st</a> &lt;% Mappable<span class="delimiter">[</span>st<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><a title="Binders.this.UnderBinder[bt,List[st]]" id="1022421">orig</a>: <a href="#1021431" title="Binders.this.UnderBinder[bt,List[st]]">UnderBinder</a><span class="delimiter">[</span>bt, List<span class="delimiter">[</span>st<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>: <a href="../../../collection/immutable/List.scala.html#14047" title="List[Binders.this.UnderBinder[bt,st]]">List</a><span class="delimiter">[</span>UnderBinder<span class="delimiter">[</span>bt, st<span class="delimiter">]</span><span class="delimiter">]</span> =
    <a href="#1022421" title="Binders.this.UnderBinder[bt,List[st]]">orig</a>.<a href="#1021835" title="=&gt; List[st]">element</a>.<a href="../../../collection/TraversableLike.scala.html#49041" title="(f: st =&gt; Binders.this.UnderBinder[bt,st])(implicit bf: scala.collection.generic.CanBuildFrom[List[st],Binders.this.UnderBinder[bt,st],List[Binders.this.UnderBinder[bt,st]]])List[Binders.this.UnderBinder[bt,st]]">map</a><a href="../../../collection/immutable/List.scala.html#48868" title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,Binders.this.UnderBinder[bt,st],List[Binders.this.UnderBinder[bt,st]]]" class="delimiter">(</a><a title="st" id="1022447">sc</a> =&gt; <a href="#1022014" title="(scope: Binders.this.Scope[bt], element: st)(implicit evidence$11: st =&gt; Binders.this.Mappable[st])Binders.this.UnderBinder[bt,st]">UnderBinder</a><a href="#1022422" title="st =&gt; Binders.this.Mappable[st]" class="delimiter">(</a><a href="#1022421" title="Binders.this.UnderBinder[bt,List[st]]">orig</a>.<a href="#1021834" title="=&gt; Binders.this.Scope[bt]">scope</a>, <a href="#1022447" title="st">sc</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">//TODO: more documentation</span>
  <span class="comment">/** An environment that maps a `NameElement` to the scope in which it is bound.
   *  This can be used to model scoping during parsing.
   *
   *  @note This class uses similar techniques as described by ''Burak Emir'' in
   *        [[http://library.epfl.ch/theses/?nr=3899 Object-oriented pattern matching]],
   *        but uses `==` instead of `eq`, thus types can't be unified in general.
   */</span>
  <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class BinderEnv extends java.lang.Object with ScalaObject" id="1021458">BinderEnv</a> <a href="../../../ScalaObject.scala.html#464" title="ScalaObject" class="delimiter">{</a>
    <span class="keyword">def</span> <a title="[A &lt;: Binders.this.NameElement](v: A)Option[Binders.this.Scope[A]]" id="1022499">apply</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Binders.this.NameElement" id="1022501">A</a> &lt;: NameElement<span class="delimiter">]</span><span class="delimiter">(</span><a title="A" id="1022506">v</a>: <a href="#1022501" title="A">A</a><span class="delimiter">)</span>: <a href="../../../Option.scala.html#560" title="Option[Binders.this.Scope[A]]">Option</a><span class="delimiter">[</span>Scope<span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">]</span>
    <span class="keyword">def</span> <a title="[a &lt;: Binders.this.NameElement](v: a, x: Binders.this.Scope[a])Binders.this.BinderEnv" id="1022502">extend</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Binders.this.NameElement" id="1022504">a</a> &lt;: NameElement<span class="delimiter">]</span><span class="delimiter">(</span><a title="a" id="1022509">v</a> : <a href="#1022504" title="a">a</a>, <a title="Binders.this.Scope[a]" id="1022510">x</a> : <a href="#1021422" title="Binders.this.Scope[a]">Scope</a><span class="delimiter">[</span>a<span class="delimiter">]</span><span class="delimiter">)</span> = <a href="#1022513" title="Binders.this.BinderEnv" class="keyword">new</a> <a href="#1021458" title="anonymous class $anon extends Binders.this.BinderEnv" id="1022513">BinderEnv</a> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="[b &lt;: Binders.this.NameElement](w: b)Option[Binders.this.Scope[b]]" id="1022515">apply</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Binders.this.NameElement" id="1022517">b</a> &lt;: NameElement<span class="delimiter">]</span><span class="delimiter">(</span><a title="b" id="1022518">w</a> : <a href="#1022517" title="b">b</a><span class="delimiter">)</span>: <a href="../../../Option.scala.html#560" title="Option[Binders.this.Scope[b]]">Option</a><span class="delimiter">[</span>Scope<span class="delimiter">[</span>b<span class="delimiter">]</span><span class="delimiter">]</span> =
        <span title="Option[Binders.this.Scope[b]]" class="keyword">if</span><span class="delimiter">(</span><a href="#1022518" title="b">w</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#1022509" title="a">v</a><span class="delimiter">)</span> <a href="../../../Option.scala.html#57885" title="(x: Binders.this.Scope[b])Some[Binders.this.Scope[b]]">Some</a><span class="delimiter">(</span><a href="#1022510" title="Binders.this.Scope[a]">x</a>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="Binders.this.Scope[b]" class="delimiter">[</span><a href="#1021422" title="Binders.this.Scope[b]">Scope</a><span class="delimiter">[</span>b<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>
        <span class="keyword">else</span> <a href="#1021458" title="BinderEnv.this.type">BinderEnv</a>.<span class="keyword">this</span>.<a href="#1022499" title="(v: b)Option[Binders.this.Scope[b]]">apply</a><span class="delimiter">(</span><a href="#1022518" title="b">w</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">object</span> <a title="object Binders.this.EmptyBinderEnv" id="1021459">EmptyBinderEnv</a> <a href="../../../ScalaObject.scala.html#464" title="ScalaObject" class="keyword">extends</a> <a href="#1021458" title="Binders.this.BinderEnv">BinderEnv</a> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="[A &lt;: Binders.this.NameElement](v: A)Option[Binders.this.Scope[A]]" id="1022553">apply</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Binders.this.NameElement" id="1022555">A</a> &lt;: NameElement<span class="delimiter">]</span><span class="delimiter">(</span><a title="A" id="1022557">v</a>: <a href="#1022555" title="A">A</a><span class="delimiter">)</span>: <a href="../../../Option.scala.html#560" title="Option[Binders.this.Scope[A]]">Option</a><span class="delimiter">[</span>Scope<span class="delimiter">[</span>A<span class="delimiter">]</span><span class="delimiter">]</span> = <a href="../../../Option.scala.html#1737" title="object None">None</a>
  <span class="delimiter">}</span>

  <span class="comment">// TODO: move this to some utility object higher in the scala hierarchy?</span>
  <span class="comment">/** Returns a given result, but executes the supplied closure before returning.
   *  (The effect of this closure does not influence the returned value.)
   *
   *  @param result the result to be returned
   *  @param block  code to be executed, purely for its side-effects
   */</span>
  <span class="keyword">trait</span> <a title="trait ReturnAndDo[T] extends java.lang.Object" id="1021461">ReturnAndDo</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="1021462">T</a><span class="delimiter">]</span><span title="java.lang.Object" class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(block: =&gt; Unit)T" id="1021508">andDo</a><span class="delimiter">(</span><a title="=&gt; Unit" id="1021509">block</a>: =&gt; Unit<span class="delimiter">)</span>: <a href="#1021462" title="T">T</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[T](result: T)Binders.this.ReturnAndDo[T]" id="1021463">return_</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="1021465">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="T" id="1021502">result</a>: <a href="#1021465" title="T">T</a><span class="delimiter">)</span>: <a href="#1021461" title="Binders.this.ReturnAndDo[T]">ReturnAndDo</a><span class="delimiter">[</span>T<span class="delimiter">]</span> =
    <a href="#1022563" title="java.lang.Object with Binders.this.ReturnAndDo[T]{}" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with Binders.this.ReturnAndDo[T]" id="1022563">ReturnAndDo</a><span class="delimiter">[</span>T<span class="delimiter">]</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="T" id="1022567">r</a> = <a href="#1021502" title="T">result</a>
      <span class="keyword">def</span> <a title="(block: =&gt; Unit)T" id="1022569">andDo</a><span class="delimiter">(</span><a title="=&gt; Unit" id="1022570">block</a>: =&gt; Unit<span class="delimiter">)</span>: <a href="#1021465" title="T">T</a> = <span class="delimiter">{</span><a href="#1022570" title="=&gt; Unit">block</a>; <a href="#1022567" title="=&gt; T">r</a><span class="delimiter">}</span>
    <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">object</span> <a title="object Binders.this._Binder" id="1021466">_Binder</a> <a href="../../../ScalaObject.scala.html#464" title="ScalaObject" class="delimiter">{</a>
    <span class="keyword">private</span> <span class="keyword">var</span> <a title="Int" id="1021496">currentId</a> = <span title="Int(0)" class="int">0</span>
    <span class="keyword">private</span><span class="delimiter">[</span>Binders<span class="delimiter">]</span> <span class="keyword">def</span> <a title="=&gt; Int" id="1021498">genId</a> = <a href="#1021463" title="(result: Int)Binders.this.ReturnAndDo[Int]">return_</a><span class="delimiter">(</span><a href="#1021496" title="=&gt; Int">currentId</a><span class="delimiter">)</span> <a href="#1021508" title="(block: =&gt; Unit)Int">andDo</a> <span class="delimiter">{</span><a href="#1021496" title="(x$1: Int)Unit">currentId</a>=<a href="#1021496" title="=&gt; Int">currentId</a><a href="../../../Int.scala.html#54804" title="(x: Int)Int">+</a><span title="Int(1)" class="int">1</span><span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
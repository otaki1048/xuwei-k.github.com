<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>org/scalaquery/ql/basic/BasicInsertInvoker.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> org.scalaquery.ql.basic

<span class="keyword">import</span> java.sql.Statement
<span class="keyword">import</span> org.scalaquery.SQueryException
<span class="keyword">import</span> org.scalaquery.ql.<span class="delimiter">{</span>ColumnBase, Query<span class="delimiter">}</span>
<span class="keyword">import</span> org.scalaquery.session.<span class="delimiter">{</span>Session, PositionedParameters<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class BasicInsertInvoker[T] extends java.lang.Object with ScalaObject" id="10359">BasicInsertInvoker</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="10360">T</a><span class="delimiter">]</span> <a href="#10359" title="ScalaObject" class="delimiter">(</a><a title="org.scalaquery.ql.ColumnBase[T]" id="109701">column</a>: <a href="../ColumnBase.scala.html#9799" title="org.scalaquery.ql.ColumnBase[T]">ColumnBase</a><span class="delimiter">[</span>T<span class="delimiter">]</span>, <a title="org.scalaquery.ql.basic.BasicProfile" id="109702">profile</a>: <a href="BasicProfile.scala.html#10366" title="org.scalaquery.ql.basic.BasicProfile">BasicProfile</a><span class="delimiter">)</span> <span class="delimiter">{</span>

  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="String" id="109691">insertStatement</a> = <a href="#109702" title="org.scalaquery.ql.basic.BasicProfile">profile</a>.<a href="BasicProfile.scala.html#79196" title="(cb: org.scalaquery.ql.ColumnBase[_])String">buildInsertStatement</a><span class="delimiter">(</span><a href="#109701" title="org.scalaquery.ql.ColumnBase[T]">column</a><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(query: org.scalaquery.ql.Query[org.scalaquery.ql.ColumnBase[T]])String" id="109692">insertStatementFor</a><span class="delimiter">(</span><a title="org.scalaquery.ql.Query[org.scalaquery.ql.ColumnBase[T]]" id="110585">query</a>: <a href="../Query.scala.html#10200" title="org.scalaquery.ql.Query[org.scalaquery.ql.ColumnBase[T]]">Query</a><span class="delimiter">[</span>ColumnBase<span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span>: <span title="String">String</span> = <a href="#109702" title="org.scalaquery.ql.basic.BasicProfile">profile</a>.<a href="BasicProfile.scala.html#79197" title="(cb: org.scalaquery.ql.ColumnBase[T], q: org.scalaquery.ql.Query[org.scalaquery.ql.ColumnBase[T]])org.scalaquery.util.SQLBuilder.Result">buildInsertStatement</a><span class="delimiter">(</span><a href="#109701" title="org.scalaquery.ql.ColumnBase[T]">column</a>, <a href="#110585" title="org.scalaquery.ql.Query[org.scalaquery.ql.ColumnBase[T]]">query</a><span class="delimiter">)</span>.<a href="../../util/SQLBuilder.scala.html#109445" title="=&gt; String">sql</a>
  <span class="keyword">def</span> <a title="(c: org.scalaquery.ql.ColumnBase[T])String" id="109693">insertStatementFor</a><span class="delimiter">(</span><a title="org.scalaquery.ql.ColumnBase[T]" id="110679">c</a>: <a href="../ColumnBase.scala.html#9799" title="org.scalaquery.ql.ColumnBase[T]">ColumnBase</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="String">String</span> = <a href="#109692" title="(query: org.scalaquery.ql.Query[org.scalaquery.ql.ColumnBase[T]])String">insertStatementFor</a><span class="delimiter">(</span><a href="../Query.scala.html#86282" title="(value: org.scalaquery.ql.ColumnBase[T])org.scalaquery.ql.Query[org.scalaquery.ql.ColumnBase[T]]">Query</a><span class="delimiter">(</span><a href="#110679" title="org.scalaquery.ql.ColumnBase[T]">c</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(implicit session: org.scalaquery.session.Session)Boolean" id="109694">useBatchUpdates</a><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="org.scalaquery.session.Session" id="110690">session</a>: <a href="../../session/Session.scala.html#10660" title="org.scalaquery.session.Session">Session</a><span class="delimiter">)</span> = <a href="#110690" title="org.scalaquery.session.Session">session</a>.<a href="../../session/Session.scala.html#13177" title="=&gt; org.scalaquery.session.DatabaseCapabilities">capabilities</a>.<a href="../../session/DatabaseCapabilities.scala.html#110698" title="=&gt; Boolean">supportsBatchUpdates</a>

  <span class="comment">/**
   * Insert a single row.
   */</span>
  <span class="keyword">def</span> <a title="(value: T)(implicit session: org.scalaquery.session.Session)Int" id="109695">insert</a><span class="delimiter">(</span><a title="T" id="110700">value</a>: <a href="#10360" title="T">T</a><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="org.scalaquery.session.Session" id="110701">session</a>: <a href="../../session/Session.scala.html#10660" title="org.scalaquery.session.Session">Session</a><span class="delimiter">)</span>: <span title="Int">Int</span> = <a href="#110701" title="org.scalaquery.session.Session">session</a>.<a href="../../session/Session.scala.html#13183" title="(sql: String, defaultType: org.scalaquery.session.ResultSetType, defaultConcurrency: org.scalaquery.session.ResultSetConcurrency, defaultHoldability: org.scalaquery.session.ResultSetHoldability)(f: java.sql.PreparedStatement =&gt; Int)Int">withPreparedStatement</a><span class="delimiter">(</span><a href="#109690" title="=&gt; String">insertStatement</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a title="java.sql.PreparedStatement" id="110711">st</a> =&gt;
    <a href="#110711" title="java.sql.PreparedStatement">st</a>.<span title="()Unit">clearParameters</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#109701" title="org.scalaquery.ql.ColumnBase[T]">column</a>.<a href="../ColumnBase.scala.html#78932" title="(profile: org.scalaquery.ql.basic.BasicProfile, ps: org.scalaquery.session.PositionedParameters, value: Option[T])Unit">setParameter</a><span class="delimiter">(</span><a href="#109702" title="org.scalaquery.ql.basic.BasicProfile">profile</a>, <span title="org.scalaquery.session.PositionedParameters" class="keyword">new</span> <a href="../../session/PositionedParameters.scala.html#10623" title="org.scalaquery.session.PositionedParameters">PositionedParameters</a><span class="delimiter">(</span><a href="#110711" title="java.sql.PreparedStatement">st</a><span class="delimiter">)</span>, <span title="(x: T)Some[T]">Some</span><span class="delimiter">(</span><a href="#110700" title="T">value</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#110711" title="java.sql.PreparedStatement">st</a>.<span title="()Int">executeUpdate</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Insert multiple rows. Uses JDBC's batch update feature if supported by
   * the JDBC driver. Returns Some(rowsAffected), or None if the database
   * returned no row count for some part of the batch. If any part of the
   * batch fails, an exception thrown.
   */</span>
  <span class="keyword">def</span> <a title="(values: T*)(implicit session: org.scalaquery.session.Session)Option[Int]" id="109696">insertAll</a><span class="delimiter">(</span><a title="T*" id="110722">values</a>: <span title="T*">T</span>*<span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="org.scalaquery.session.Session" id="110723">session</a>: <a href="../../session/Session.scala.html#10660" title="org.scalaquery.session.Session">Session</a><span class="delimiter">)</span>: <span title="Option[Int]">Option</span><span class="delimiter">[</span>Int<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span title="Option[Int]" class="keyword">if</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#109694" title="(implicit session: org.scalaquery.session.Session)Boolean">useBatchUpdates</a> <span title="(x: Boolean)Boolean">||</span> <span class="delimiter">(</span><a href="#110722" title="T*">values</a>.<span title="[T0]=&gt; Boolean">isInstanceOf</span><span title="Boolean" class="delimiter">[</span><span title="IndexedSeq[_]">IndexedSeq</span><span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">]</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <a href="#110722" title="T*">values</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(2)" class="int">2</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="(x: Int)Some[Int]">Some</span><span class="delimiter">(</span> <span class="delimiter">(</span><span title="Int(0)" class="int">0</span> <a href="#110737" title="(z: Int)(op: (Int, T) =&gt; Int)Int">/:</a> <a href="#110722" title="T*">values</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a href="#110750" title="Int">_</a> <span title="(x: Int)Int">+</span> <a href="#109695" title="(value: T)(implicit session: org.scalaquery.session.Session)Int">insert</a><a href="#110723" title="org.scalaquery.session.Session" class="delimiter">(</a><a href="#110751" title="T">_</a><span class="delimiter">)</span> <span class="delimiter">}</span> <span class="delimiter">)</span>
    <span class="keyword">else</span> <a href="#110723" title="org.scalaquery.session.Session">session</a>.<a href="../../session/Session.scala.html#13191" title="(f: =&gt; Option[Int])Option[Int]">withTransaction</a> <span class="delimiter">{</span>
      <a href="#110723" title="org.scalaquery.session.Session">session</a>.<a href="../../session/Session.scala.html#13183" title="(sql: String, defaultType: org.scalaquery.session.ResultSetType, defaultConcurrency: org.scalaquery.session.ResultSetConcurrency, defaultHoldability: org.scalaquery.session.ResultSetHoldability)(f: java.sql.PreparedStatement =&gt; Option[Int])Option[Int]">withPreparedStatement</a><span class="delimiter">(</span><a href="#109690" title="=&gt; String">insertStatement</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a title="java.sql.PreparedStatement" id="110779">st</a> =&gt;
        <a href="#110779" title="java.sql.PreparedStatement">st</a>.<span title="()Unit">clearParameters</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="keyword">for</span><span class="delimiter">(</span><a title="T" id="110798">value</a> &lt;- <a href="#110722" title="(f: T =&gt; Unit)Unit">values</a><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="#109701" title="org.scalaquery.ql.ColumnBase[T]">column</a>.<a href="../ColumnBase.scala.html#78932" title="(profile: org.scalaquery.ql.basic.BasicProfile, ps: org.scalaquery.session.PositionedParameters, value: Option[T])Unit">setParameter</a><span class="delimiter">(</span><a href="#109702" title="org.scalaquery.ql.basic.BasicProfile">profile</a>, <span title="org.scalaquery.session.PositionedParameters" class="keyword">new</span> <a href="../../session/PositionedParameters.scala.html#10623" title="org.scalaquery.session.PositionedParameters">PositionedParameters</a><span class="delimiter">(</span><a href="#110779" title="java.sql.PreparedStatement">st</a><span class="delimiter">)</span>, <span title="(x: T)Some[T]">Some</span><span class="delimiter">(</span><a href="#110798" title="T">value</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#110779" title="java.sql.PreparedStatement">st</a>.<span title="()Unit">addBatch</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">var</span> <a title="Boolean" id="110780">unknown</a> = <span title="Boolean(false)" class="keyword">false</span>
        <span class="keyword">var</span> <a title="Int" id="110781">count</a> = <span title="Int(0)" class="int">0</span>
        <span class="keyword">for</span><span class="delimiter">(</span><span class="delimiter">(</span><a title="Int" id="112226">res</a>, <a title="Int" id="112227">idx</a><span class="delimiter">)</span> &lt;- <a href="#110779" title="java.sql.PreparedStatement">st</a>.<span title="()Array[Int]">executeBatch</span><span title="implicit scala.Predef.intArrayOps : (xs: Array[Int])scala.collection.mutable.ArrayOps[Int]" class="delimiter">(</span><span class="delimiter">)</span>.<a href="#111616" title="(f: (Int, Int) =&gt; Unit)Unit">zipWithIndex</a><span class="delimiter">)</span> <a href="#112226" title="Int">res</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Unit">Statement</span>.<span title="Int(-2)">SUCCESS_NO_INFO</span> =&gt; <a href="#110780" title="Boolean">unknown</a> = <span title="Boolean(true)" class="keyword">true</span>
          <span class="keyword">case</span> <span title="Nothing">Statement</span>.<span title="Int(-3)">EXECUTE_FAILED</span> =&gt;
            <span title="Nothing" class="keyword">throw</span> <a href="../../SQueryException.scala.html#25911" title="org.scalaquery.SQueryException" class="keyword">new</a> <a href="../../SQueryException.scala.html#9548" title="org.scalaquery.SQueryException">SQueryException</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Failed to insert row #&quot;)" class="string">&quot;Failed to insert row #&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <span class="delimiter">(</span><a href="#112227" title="Int">idx</a><span title="(x: Int)Int">+</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="keyword">case</span> <a title="Unit" id="112232">i</a> =&gt; <a href="#110781" title="Int">count</a> <span title="(x: Int)Int">+=</span> <a href="#112232" title="Int">i</a>
        <span class="delimiter">}</span>
        <span title="Option[Int]" class="keyword">if</span><span class="delimiter">(</span><a href="#110780" title="Boolean">unknown</a><span class="delimiter">)</span> <span title="object None">None</span> <span class="keyword">else</span> <span title="(x: Int)Some[Int]">Some</span><span class="delimiter">(</span><a href="#110781" title="Int">count</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(query: org.scalaquery.ql.Query[org.scalaquery.ql.ColumnBase[T]])(implicit session: org.scalaquery.session.Session)Int" id="109697">insert</a><span class="delimiter">(</span><a title="org.scalaquery.ql.Query[org.scalaquery.ql.ColumnBase[T]]" id="110763">query</a>: <a href="../Query.scala.html#10200" title="org.scalaquery.ql.Query[org.scalaquery.ql.ColumnBase[T]]">Query</a><span class="delimiter">[</span>ColumnBase<span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="org.scalaquery.session.Session" id="110764">session</a>: <a href="../../session/Session.scala.html#10660" title="org.scalaquery.session.Session">Session</a><span class="delimiter">)</span>: <span title="Int">Int</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="org.scalaquery.util.SQLBuilder.Result" id="112244">sbr</a> = <a href="#109702" title="org.scalaquery.ql.basic.BasicProfile">profile</a>.<a href="BasicProfile.scala.html#79197" title="(cb: org.scalaquery.ql.ColumnBase[T], q: org.scalaquery.ql.Query[org.scalaquery.ql.ColumnBase[T]])org.scalaquery.util.SQLBuilder.Result">buildInsertStatement</a><span class="delimiter">(</span><a href="#109701" title="org.scalaquery.ql.ColumnBase[T]">column</a>, <a href="#110763" title="org.scalaquery.ql.Query[org.scalaquery.ql.ColumnBase[T]]">query</a><span class="delimiter">)</span>
    <a href="#110764" title="org.scalaquery.session.Session">session</a>.<a href="../../session/Session.scala.html#13183" title="(sql: String, defaultType: org.scalaquery.session.ResultSetType, defaultConcurrency: org.scalaquery.session.ResultSetConcurrency, defaultHoldability: org.scalaquery.session.ResultSetHoldability)(f: java.sql.PreparedStatement =&gt; Int)Int">withPreparedStatement</a><span class="delimiter">(</span><a href="#109692" title="(query: org.scalaquery.ql.Query[org.scalaquery.ql.ColumnBase[T]])String">insertStatementFor</a><span class="delimiter">(</span><a href="#110763" title="org.scalaquery.ql.Query[org.scalaquery.ql.ColumnBase[T]]">query</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span> <a title="java.sql.PreparedStatement" id="112350">st</a> =&gt;
      <a href="#112350" title="java.sql.PreparedStatement">st</a>.<span title="()Unit">clearParameters</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#112244" title="org.scalaquery.util.SQLBuilder.Result">sbr</a>.<a href="../../util/SQLBuilder.scala.html#109447" title="(v1: org.scalaquery.session.PositionedParameters, v2: Any)Unit">setter</a><span class="delimiter">(</span><span title="org.scalaquery.session.PositionedParameters" class="keyword">new</span> <a href="../../session/PositionedParameters.scala.html#10623" title="org.scalaquery.session.PositionedParameters">PositionedParameters</a><span class="delimiter">(</span><a href="#112350" title="java.sql.PreparedStatement">st</a><span class="delimiter">)</span>, <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
      <a href="#112350" title="java.sql.PreparedStatement">st</a>.<span title="()Int">executeUpdate</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(c: org.scalaquery.ql.ColumnBase[T])(implicit session: org.scalaquery.session.Session)Int" id="109698">insert</a><span class="delimiter">(</span><a title="org.scalaquery.ql.ColumnBase[T]" id="110760">c</a>: <a href="../ColumnBase.scala.html#9799" title="org.scalaquery.ql.ColumnBase[T]">ColumnBase</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="org.scalaquery.session.Session" id="110761">session</a>: <a href="../../session/Session.scala.html#10660" title="org.scalaquery.session.Session">Session</a><span class="delimiter">)</span>: <span title="Int">Int</span> = <a href="#109697" title="(query: org.scalaquery.ql.Query[org.scalaquery.ql.ColumnBase[T]])(implicit session: org.scalaquery.session.Session)Int">insert</a><span class="delimiter">(</span><a href="../Query.scala.html#86282" title="(value: org.scalaquery.ql.ColumnBase[T])org.scalaquery.ql.Query[org.scalaquery.ql.ColumnBase[T]]">Query</a><span class="delimiter">(</span><a href="#110760" title="org.scalaquery.ql.ColumnBase[T]">c</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#110761" title="org.scalaquery.session.Session">session</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="=&gt; BasicInsertInvoker.this.type" id="109699">insertInvoker</a>: <span class="keyword">this</span>.<span class="keyword">type</span> = <a href="#10359" title="BasicInsertInvoker.this.type" class="keyword">this</a>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
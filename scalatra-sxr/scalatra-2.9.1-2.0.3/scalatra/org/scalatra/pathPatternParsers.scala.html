<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>scalatra/org/scalatra/pathPatternParsers.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> org.scalatra

<span class="keyword">import</span> scala.collection.mutable.<span class="delimiter">{</span>HashMap, ListBuffer<span class="delimiter">}</span>
<span class="keyword">import</span> scala.util.matching.Regex
<span class="keyword">import</span> scala.util.parsing.combinator.RegexParsers
<span class="keyword">import</span> java.util.regex.<span title="object java.util.regex.Pattern">Pattern</span>.<span class="delimiter">{</span>quote =&gt; escape<span class="delimiter">}</span>
<span class="keyword">import</span> <a href="ScalatraKernel.scala.html#10017" title="object org.scalatra.ScalatraKernel">ScalatraKernel</a>.MultiParams
<span class="keyword">import</span> util.MultiMap

<span class="comment">/**
 * A path pattern optionally matches a request path and extracts path
 * parameters.
 */</span>
case <span class="keyword">class</span> <a title="class PathPattern extends java.lang.Object with ScalaObject with Product with Serializable" id="69318">PathPattern</a><a href="#69318" title="ScalaObject" class="delimiter">(</a><a title="scala.util.matching.Regex" id="68160">regex</a>: <span title="scala.util.matching.Regex">Regex</span>, <a title="List[String]" id="68161">captureGroupNames</a>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span title="object Nil">Nil</span><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(path: String)Option[org.scalatra.ScalatraKernel.MultiParams]" id="29035">apply</a><span class="delimiter">(</span><a title="String" id="67523">path</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[org.scalatra.ScalatraKernel.MultiParams]">Option</span><span class="delimiter">[</span>MultiParams<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#68160" title="=&gt; scala.util.matching.Regex">regex</a>.<span title="(source: java.lang.CharSequence)Option[scala.util.matching.Regex.Match]">findFirstMatchIn</span><span class="delimiter">(</span><a href="#67523" title="String">path</a><span class="delimiter">)</span>
      .<span title="(f: scala.util.matching.Regex.Match =&gt; List[(String, String)])Option[List[(String, String)]]">map</span> <span class="delimiter">{</span> <a href="#68161" title="=&gt; List[String]">captureGroupNames</a> <span title="(that: scala.collection.GenIterable[String])(implicit bf: scala.collection.generic.CanBuildFrom[List[String],(String, String),List[(String, String)]])List[(String, String)]">zip</span> <a href="#67529" title="scala.util.matching.Regex.Match">_</a>.<span title="=&gt; List[String]">subgroups</span> <span class="delimiter">}</span>
      .<span title="(f: List[(String, String)] =&gt; org.scalatra.util.MultiMap)Option[org.scalatra.util.MultiMap]">map</span> <span class="delimiter">{</span> <a title="List[(String, String)]" id="67598">pairs</a> =&gt;
      <span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[String,scala.collection.mutable.ListBuffer[String]]" id="67599">multiParams</a> = <span title="()scala.collection.mutable.HashMap[String,scala.collection.mutable.ListBuffer[String]]" class="keyword">new</span> <span title="scala.collection.mutable.HashMap[String,scala.collection.mutable.ListBuffer[String]]">HashMap</span><span class="delimiter">[</span>String, ListBuffer<span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">]</span>
      <a href="#67598" title="List[(String, String)]">pairs</a> <span title="(f: (String, String) =&gt; Any)Unit">foreach</span> <a href="#67682" title="Any" class="delimiter">{</a> <span class="keyword">case</span> <span title="Any" class="delimiter">(</span><a title="String" id="67685">k</a>, <a title="String" id="67686">v</a><span class="delimiter">)</span> =&gt;
        <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#67686" title="String">v</a> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <a href="#67599" title="scala.collection.mutable.HashMap[String,scala.collection.mutable.ListBuffer[String]]">multiParams</a>.<span title="(key: String, op: =&gt; scala.collection.mutable.ListBuffer[String])scala.collection.mutable.ListBuffer[String]">getOrElseUpdate</span><span class="delimiter">(</span><a href="#67685" title="String">k</a>, <span title="scala.collection.mutable.ListBuffer[String]" class="keyword">new</span> <span title="scala.collection.mutable.ListBuffer[String]">ListBuffer</span><span class="delimiter">)</span> <span title="(x: java.lang.String)scala.collection.mutable.ListBuffer[String]">+=</span> <a href="#67686" title="String">v</a>
      <span class="delimiter">}</span>
      <a href="util/MultiMap.scala.html#56867" title="(wrapped: scala.collection.immutable.Map[String,scala.collection.mutable.ListBuffer[String]])org.scalatra.util.MultiMap">MultiMap</a><span class="delimiter">(</span><span title="(elems: (String, Nothing)*)scala.collection.immutable.Map[String,Nothing]">Map</span><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(xs: scala.collection.GenTraversableOnce[(String, scala.collection.mutable.ListBuffer[String])])scala.collection.immutable.Map[String,scala.collection.mutable.ListBuffer[String]]">++</span> <a href="#67599" title="scala.collection.mutable.HashMap[String,scala.collection.mutable.ListBuffer[String]]">multiParams</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(pathPattern: org.scalatra.PathPattern)org.scalatra.PathPattern" id="29036">+</a><span class="delimiter">(</span><a title="org.scalatra.PathPattern" id="68158">pathPattern</a>: <a href="#69318" title="org.scalatra.PathPattern">PathPattern</a><span class="delimiter">)</span>: <a href="#69318" title="org.scalatra.PathPattern">PathPattern</a> = <a href="#69318" title="(regex: scala.util.matching.Regex, captureGroupNames: List[String])org.scalatra.PathPattern">PathPattern</a><span class="delimiter">(</span>
    <span title="scala.util.matching.Regex" class="keyword">new</span> <span title="scala.util.matching.Regex">Regex</span><span class="delimiter">(</span><a href="#69318" title="PathPattern.this.type" class="keyword">this</a>.<a href="#68160" title="=&gt; scala.util.matching.Regex">regex</a>.<span title="()String">toString</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#68158" title="org.scalatra.PathPattern">pathPattern</a>.<a href="#68160" title="=&gt; scala.util.matching.Regex">regex</a>.<span title="()String">toString</span><span class="delimiter">)</span>,
    <a href="#69318" title="PathPattern.this.type" class="keyword">this</a>.<a href="#68161" title="=&gt; List[String]">captureGroupNames</a> <a href="#68168" title="(prefix: List[String])List[String]">:::</a> <a href="#68158" title="org.scalatra.PathPattern">pathPattern</a>.<a href="#68161" title="=&gt; List[String]">captureGroupNames</a>
  <span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Parses a string into a path pattern for routing.
 */</span>
<span class="keyword">trait</span> <a title="trait PathPatternParser extends java.lang.Object" id="9632">PathPatternParser</a> <span title="java.lang.Object" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(pattern: String)org.scalatra.PathPattern" id="68233">apply</a><span class="delimiter">(</span><a title="String" id="68235">pattern</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="#69318" title="org.scalatra.PathPattern">PathPattern</a>
<span class="delimiter">}</span>

<span class="keyword">trait</span> <a title="trait RegexPathPatternParser extends java.lang.Object with org.scalatra.PathPatternParser with scala.util.parsing.combinator.RegexParsers with ScalaObject" id="10127">RegexPathPatternParser</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#9632" title="org.scalatra.PathPatternParser">PathPatternParser</a> <span class="keyword">with</span> <span title="scala.util.parsing.combinator.RegexParsers">RegexParsers</span> <span class="delimiter">{</span>
  <span class="comment">/**
   * This parser gradually builds a regular expression.  Some intermediate
   * strings are not valid regexes, so we wait to compile until the end.
   */</span>
  <span class="keyword">protected</span> case <span class="keyword">class</span> <a title="class PartialPathPattern extends java.lang.Object with ScalaObject with Product with Serializable" id="68704">PartialPathPattern</a><a href="#68704" title="ScalaObject" class="delimiter">(</a><a title="String" id="68718">regex</a>: <span title="String">String</span>, <a title="List[String]" id="68719">captureGroupNames</a>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span title="object Nil">Nil</span><span class="delimiter">)</span>
  <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="=&gt; org.scalatra.PathPattern" id="68694">toPathPattern</a>: <a href="#69318" title="org.scalatra.PathPattern">PathPattern</a> = <a href="#69318" title="(regex: scala.util.matching.Regex, captureGroupNames: List[String])org.scalatra.PathPattern">PathPattern</a><span class="delimiter">(</span><a href="#68718" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">regex</a>.<span title="=&gt; scala.util.matching.Regex">r</span>, <a href="#68719" title="=&gt; List[String]">captureGroupNames</a><span class="delimiter">)</span>

    <span class="keyword">def</span> <a title="(other: RegexPathPatternParser.this.PartialPathPattern)RegexPathPatternParser.this.PartialPathPattern" id="68695">+</a><span class="delimiter">(</span><a title="RegexPathPatternParser.this.PartialPathPattern" id="68716">other</a>: <a href="#68704" title="RegexPathPatternParser.this.PartialPathPattern">PartialPathPattern</a><span class="delimiter">)</span>: <a href="#68704" title="RegexPathPatternParser.this.PartialPathPattern">PartialPathPattern</a> = <a href="#68704" title="(regex: String, captureGroupNames: List[String])RegexPathPatternParser.this.PartialPathPattern">PartialPathPattern</a><span class="delimiter">(</span>
      <a href="#68704" title="PartialPathPattern.this.type" class="keyword">this</a>.<a href="#68718" title="=&gt; String">regex</a> <span title="(x$1: Any)java.lang.String">+</span> <a href="#68716" title="RegexPathPatternParser.this.PartialPathPattern">other</a>.<a href="#68718" title="=&gt; String">regex</a>,
      <a href="#68704" title="PartialPathPattern.this.type" class="keyword">this</a>.<a href="#68719" title="=&gt; List[String]">captureGroupNames</a> <a href="#68726" title="(prefix: List[String])List[String]">:::</a> <a href="#68716" title="RegexPathPatternParser.this.PartialPathPattern">other</a>.<a href="#68719" title="=&gt; List[String]">captureGroupNames</a>
    <span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * A Sinatra-compatible route path pattern parser.
 */</span>
<span class="keyword">class</span> <a title="class SinatraPathPatternParser extends java.lang.Object with org.scalatra.RegexPathPatternParser with ScalaObject" id="9800">SinatraPathPatternParser</a> <a href="#9800" title="ScalaObject" class="keyword">extends</a> <a href="#10127" title="org.scalatra.RegexPathPatternParser">RegexPathPatternParser</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(pattern: String)org.scalatra.PathPattern" id="68799">apply</a><span class="delimiter">(</span><a title="String" id="68808">pattern</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="#69318" title="org.scalatra.PathPattern">PathPattern</a> =
    <a href="#9800" title="(p: SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern], in: java.lang.CharSequence)SinatraPathPatternParser.this.ParseResult[SinatraPathPatternParser.this.PartialPathPattern]">parseAll</a><span class="delimiter">(</span><a href="#68800" title="=&gt; SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern]">pathPattern</a>, <a href="#68808" title="String">pattern</a><span class="delimiter">)</span> <span title="org.scalatra.PathPattern" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="org.scalatra.PathPattern">Success</span><span class="delimiter">(</span><a title="SinatraPathPatternParser.this.PartialPathPattern" id="69007">pathPattern</a>, _<span class="delimiter">)</span> =&gt;
        <span class="delimiter">(</span><a href="#68704" title="(regex: String, captureGroupNames: List[String])SinatraPathPatternParser.this.PartialPathPattern">PartialPathPattern</a><span class="delimiter">(</span><span title="java.lang.String(&quot;^&quot;)" class="string">&quot;^&quot;</span><span class="delimiter">)</span> <a href="#68695" title="(other: SinatraPathPatternParser.this.PartialPathPattern)SinatraPathPatternParser.this.PartialPathPattern">+</a> <a href="#69007" title="SinatraPathPatternParser.this.PartialPathPattern">pathPattern</a> <a href="#68695" title="(other: SinatraPathPatternParser.this.PartialPathPattern)SinatraPathPatternParser.this.PartialPathPattern">+</a> <a href="#68704" title="(regex: String, captureGroupNames: List[String])SinatraPathPatternParser.this.PartialPathPattern">PartialPathPattern</a><span class="delimiter">(</span><span title="java.lang.String(&quot;$&quot;)" class="string">&quot;$&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<a href="#68694" title="=&gt; org.scalatra.PathPattern">toPathPattern</a>
      <span class="keyword">case</span> <span title="Nothing">_</span> =&gt;
        <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.IllegalArgumentException" class="keyword">new</span> <span title="java.lang.IllegalArgumentException">IllegalArgumentException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Invalid path pattern: &quot;)" class="string">&quot;Invalid path pattern: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#68808" title="String">pattern</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern]" id="68800">pathPattern</a> = <a href="#9800" title="(p: =&gt; SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern])SinatraPathPatternParser.this.Parser[List[SinatraPathPatternParser.this.PartialPathPattern]]">rep</a><span class="delimiter">(</span><a href="#68801" title="=&gt; SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern]">token</a><span class="delimiter">)</span> <span title="(f: List[SinatraPathPatternParser.this.PartialPathPattern] =&gt; SinatraPathPatternParser.this.PartialPathPattern)SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern]">^^</span> <span class="delimiter">{</span> <a href="#68972" title="List[SinatraPathPatternParser.this.PartialPathPattern]">_</a>.<span title="(f: (SinatraPathPatternParser.this.PartialPathPattern, SinatraPathPatternParser.this.PartialPathPattern) =&gt; SinatraPathPatternParser.this.PartialPathPattern)SinatraPathPatternParser.this.PartialPathPattern">reduceLeft</span> <span class="delimiter">{</span> <a href="#68985" title="SinatraPathPatternParser.this.PartialPathPattern">_</a><a href="#68695" title="(other: SinatraPathPatternParser.this.PartialPathPattern)SinatraPathPatternParser.this.PartialPathPattern">+</a><a href="#68986" title="SinatraPathPatternParser.this.PartialPathPattern">_</a> <span class="delimiter">}</span> <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern]" id="68801">token</a> = <a href="#68802" title="=&gt; SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern]">splat</a> <span title="(q: =&gt; SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern])SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern]">|</span> <a href="#68803" title="=&gt; SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern]">namedGroup</a> <span title="(q: =&gt; SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern])SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern]">|</span> <a href="#68804" title="=&gt; SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern]">literal</a>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern]" id="68802">splat</a> = <a href="#9800" title="implicit scala.util.parsing.combinator.RegexParsers.literal : (s: String)SinatraPathPatternParser.this.Parser[String]" class="string">&quot;*&quot;</a> <span title="(v: =&gt; SinatraPathPatternParser.this.PartialPathPattern)SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern]">^^^</span> <a href="#68704" title="(regex: String, captureGroupNames: List[String])SinatraPathPatternParser.this.PartialPathPattern">PartialPathPattern</a><span class="delimiter">(</span><span title="java.lang.String(&quot;(.*?)&quot;)" class="string">&quot;(.*?)&quot;</span>, <span title="(xs: java.lang.String*)List[java.lang.String]">List</span><span class="delimiter">(</span><span title="java.lang.String(&quot;splat&quot;)" class="string">&quot;splat&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern]" id="68803">namedGroup</a> = <a href="#9800" title="implicit scala.util.parsing.combinator.RegexParsers.literal : (s: String)SinatraPathPatternParser.this.Parser[String]" class="string">&quot;:&quot;</a> <span title="(q: =&gt; SinatraPathPatternParser.this.Parser[String])SinatraPathPatternParser.this.Parser[String]">~&gt;</span> <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;\w+&quot;&quot;&quot;</span>.<a href="#9800" title="implicit scala.util.parsing.combinator.RegexParsers.regex : (r: scala.util.matching.Regex)SinatraPathPatternParser.this.Parser[String]">r</a> <span title="(f: String =&gt; SinatraPathPatternParser.this.PartialPathPattern)SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern]">^^</span>
    <span class="delimiter">{</span> <a title="String" id="68950">groupName</a> =&gt; <a href="#68704" title="(regex: String, captureGroupNames: List[String])SinatraPathPatternParser.this.PartialPathPattern">PartialPathPattern</a><span class="delimiter">(</span><span title="java.lang.String(&quot;([^/?#]+)&quot;)" class="string">&quot;([^/?#]+)&quot;</span>, <span title="(xs: String*)List[String]">List</span><span class="delimiter">(</span><a href="#68950" title="String">groupName</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern]" id="68804">literal</a> = <a href="#68805" title="=&gt; SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern]">metaChar</a> <span title="(q: =&gt; SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern])SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern]">|</span> <a href="#68806" title="=&gt; SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern]">normalChar</a>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern]" id="68805">metaChar</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;[\.\+\(\)\$]&quot;&quot;&quot;</span>.<a href="#9800" title="implicit scala.util.parsing.combinator.RegexParsers.regex : (r: scala.util.matching.Regex)SinatraPathPatternParser.this.Parser[String]">r</a> <span title="(f: String =&gt; SinatraPathPatternParser.this.PartialPathPattern)SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern]">^^</span>
    <span class="delimiter">{</span> <a title="String" id="68878">c</a> =&gt; <a href="#68704" title="(regex: String, captureGroupNames: List[String])SinatraPathPatternParser.this.PartialPathPattern">PartialPathPattern</a><span class="delimiter">(</span><span title="java.lang.String(&quot;\\&quot;)" class="string">&quot;\\&quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#68878" title="String">c</a><span class="delimiter">)</span> <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern]" id="68806">normalChar</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;.&quot;</span>.<a href="#9800" title="implicit scala.util.parsing.combinator.RegexParsers.regex : (r: scala.util.matching.Regex)SinatraPathPatternParser.this.Parser[String]">r</a> <span title="(f: String =&gt; SinatraPathPatternParser.this.PartialPathPattern)SinatraPathPatternParser.this.Parser[SinatraPathPatternParser.this.PartialPathPattern]">^^</span> <span class="delimiter">{</span> <a title="String" id="68900">c</a> =&gt; <a href="#68704" title="(regex: String, captureGroupNames: List[String])SinatraPathPatternParser.this.PartialPathPattern">PartialPathPattern</a><span class="delimiter">(</span><a href="#68900" title="String">c</a><span class="delimiter">)</span> <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object org.scalatra.SinatraPathPatternParser" id="9801">SinatraPathPatternParser</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(pattern: String)org.scalatra.PathPattern" id="69022">apply</a><span class="delimiter">(</span><a title="String" id="69024">pattern</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="#69318" title="org.scalatra.PathPattern">PathPattern</a> = <span title="org.scalatra.SinatraPathPatternParser" class="keyword">new</span> <a href="#9800" title="org.scalatra.SinatraPathPatternParser">SinatraPathPatternParser</a><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="#68799" title="(pattern: String)org.scalatra.PathPattern">apply</a><span class="delimiter">(</span><a href="#69024" title="String">pattern</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Path pattern parser based on Rack::Mount::Strexp, which is used by Rails.
 */</span>
<span class="keyword">class</span> <a title="class RailsPathPatternParser extends java.lang.Object with org.scalatra.RegexPathPatternParser with ScalaObject" id="9941">RailsPathPatternParser</a> <a href="#9941" title="ScalaObject" class="keyword">extends</a> <a href="#10127" title="org.scalatra.RegexPathPatternParser">RegexPathPatternParser</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(pattern: String)org.scalatra.PathPattern" id="69028">apply</a><span class="delimiter">(</span><a title="String" id="69043">pattern</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="#69318" title="org.scalatra.PathPattern">PathPattern</a> =
    <a href="#9941" title="(p: RailsPathPatternParser.this.Parser[org.scalatra.PathPattern], in: java.lang.CharSequence)RailsPathPatternParser.this.ParseResult[org.scalatra.PathPattern]">parseAll</a><span class="delimiter">(</span><a href="#69029" title="=&gt; RailsPathPatternParser.this.Parser[org.scalatra.PathPattern]">target</a>, <a href="#69043" title="String">pattern</a><span class="delimiter">)</span> <span title="org.scalatra.PathPattern" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="org.scalatra.PathPattern">Success</span><span class="delimiter">(</span><a title="org.scalatra.PathPattern" id="69283">target</a>, _<span class="delimiter">)</span> =&gt; <a href="#69283" title="org.scalatra.PathPattern">target</a>
      <span class="keyword">case</span> <span title="Nothing">_</span> =&gt;
        <span title="Nothing" class="keyword">throw</span> <span title="(x$1: java.lang.String)java.lang.IllegalArgumentException" class="keyword">new</span> <span title="java.lang.IllegalArgumentException">IllegalArgumentException</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Invalid path pattern: &quot;)" class="string">&quot;Invalid path pattern: &quot;</span> <span title="(x$1: Any)java.lang.String">+</span> <a href="#69043" title="String">pattern</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; RailsPathPatternParser.this.Parser[org.scalatra.PathPattern]" id="69029">target</a> = <a href="#69030" title="=&gt; RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern]">expr</a> <span title="(f: RailsPathPatternParser.this.PartialPathPattern =&gt; org.scalatra.PathPattern)RailsPathPatternParser.this.Parser[org.scalatra.PathPattern]">^^</span>
    <span class="delimiter">{</span> <a title="RailsPathPatternParser.this.PartialPathPattern" id="69263">e</a> =&gt; <a href="#68704" title="(regex: String, captureGroupNames: List[String])RailsPathPatternParser.this.PartialPathPattern">PartialPathPattern</a><span class="delimiter">(</span><span title="java.lang.String(&quot;\\A&quot;)" class="string">&quot;\\A&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#69263" title="RailsPathPatternParser.this.PartialPathPattern">e</a>.<a href="#68718" title="=&gt; String">regex</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;\\Z&quot;)" class="string">&quot;\\Z&quot;</span>, <a href="#69263" title="RailsPathPatternParser.this.PartialPathPattern">e</a>.<a href="#68719" title="=&gt; List[String]">captureGroupNames</a><span class="delimiter">)</span>.<a href="#68694" title="=&gt; org.scalatra.PathPattern">toPathPattern</a> <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern]" id="69030">expr</a> = <a href="#9941" title="(p: =&gt; RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern])RailsPathPatternParser.this.Parser[List[RailsPathPatternParser.this.PartialPathPattern]]">rep1</a><span class="delimiter">(</span><a href="#69031" title="=&gt; RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern]">token</a><span class="delimiter">)</span> <span title="(f: List[RailsPathPatternParser.this.PartialPathPattern] =&gt; RailsPathPatternParser.this.PartialPathPattern)RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern]">^^</span>
    <span class="delimiter">{</span> <a href="#69242" title="List[RailsPathPatternParser.this.PartialPathPattern]">_</a>.<span title="(f: (RailsPathPatternParser.this.PartialPathPattern, RailsPathPatternParser.this.PartialPathPattern) =&gt; RailsPathPatternParser.this.PartialPathPattern)RailsPathPatternParser.this.PartialPathPattern">reduceLeft</span> <span class="delimiter">{</span> <a href="#69255" title="RailsPathPatternParser.this.PartialPathPattern">_</a><a href="#68695" title="(other: RailsPathPatternParser.this.PartialPathPattern)RailsPathPatternParser.this.PartialPathPattern">+</a><a href="#69256" title="RailsPathPatternParser.this.PartialPathPattern">_</a> <span class="delimiter">}</span> <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern]" id="69031">token</a> = <a href="#69032" title="=&gt; RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern]">param</a> <span title="(q: =&gt; RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern])RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern]">|</span> <a href="#69034" title="=&gt; RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern]">glob</a> <span title="(q: =&gt; RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern])RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern]">|</span> <a href="#69035" title="=&gt; RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern]">optional</a> <span title="(q: =&gt; RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern])RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern]">|</span> <a href="#69036" title="=&gt; RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern]">static</a>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern]" id="69032">param</a> = <a href="#9941" title="implicit scala.util.parsing.combinator.RegexParsers.literal : (s: String)RailsPathPatternParser.this.Parser[String]" class="string">&quot;:&quot;</a> <span title="(q: =&gt; RailsPathPatternParser.this.Parser[String])RailsPathPatternParser.this.Parser[String]">~&gt;</span> <a href="#9941" title="implicit scala.util.parsing.combinator.RegexParsers.regex : (r: scala.util.matching.Regex)RailsPathPatternParser.this.Parser[String]">identifier</a> <span title="(f: String =&gt; RailsPathPatternParser.this.PartialPathPattern)RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern]">^^</span>
    <span class="delimiter">{</span> <a title="String" id="69112">name</a> =&gt; <a href="#68704" title="(regex: String, captureGroupNames: List[String])RailsPathPatternParser.this.PartialPathPattern">PartialPathPattern</a><span class="delimiter">(</span><span title="java.lang.String(&quot;([^#/.?]+)&quot;)" class="string">&quot;([^#/.?]+)&quot;</span>, <span title="(xs: String*)List[String]">List</span><span class="delimiter">(</span><a href="#69112" title="String">name</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; scala.util.matching.Regex" id="69033">identifier</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;[a-zA-Z_]\w*&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern]" id="69034">glob</a> = <a href="#9941" title="implicit scala.util.parsing.combinator.RegexParsers.literal : (s: String)RailsPathPatternParser.this.Parser[String]" class="string">&quot;*&quot;</a> <span title="(q: =&gt; RailsPathPatternParser.this.Parser[String])RailsPathPatternParser.this.Parser[String]">~&gt;</span> <a href="#9941" title="implicit scala.util.parsing.combinator.RegexParsers.regex : (r: scala.util.matching.Regex)RailsPathPatternParser.this.Parser[String]">identifier</a> <span title="(f: String =&gt; RailsPathPatternParser.this.PartialPathPattern)RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern]">^^</span>
    <span class="delimiter">{</span> <a title="String" id="69141">name</a> =&gt; <a href="#68704" title="(regex: String, captureGroupNames: List[String])RailsPathPatternParser.this.PartialPathPattern">PartialPathPattern</a><span class="delimiter">(</span><span title="java.lang.String(&quot;(.+)&quot;)" class="string">&quot;(.+)&quot;</span>, <span title="(xs: String*)List[String]">List</span><span class="delimiter">(</span><a href="#69141" title="String">name</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern]" id="69035">optional</a>: <span title="RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern]">Parser</span><span class="delimiter">[</span>PartialPathPattern<span class="delimiter">]</span> = <a href="#9941" title="implicit scala.util.parsing.combinator.RegexParsers.literal : (s: String)RailsPathPatternParser.this.Parser[String]" class="string">&quot;(&quot;</a> <span title="(q: =&gt; RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern])RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern]">~&gt;</span> <a href="#69030" title="=&gt; RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern]">expr</a> <span title="(q: =&gt; RailsPathPatternParser.this.Parser[String])RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern]">&lt;~</span> <a href="#9941" title="implicit scala.util.parsing.combinator.RegexParsers.literal : (s: String)RailsPathPatternParser.this.Parser[String]" class="string">&quot;)&quot;</a> <span title="(f: RailsPathPatternParser.this.PartialPathPattern =&gt; RailsPathPatternParser.this.PartialPathPattern)RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern]">^^</span>
    <span class="delimiter">{</span> <a title="RailsPathPatternParser.this.PartialPathPattern" id="69303">e</a> =&gt; <a href="#68704" title="(regex: String, captureGroupNames: List[String])RailsPathPatternParser.this.PartialPathPattern">PartialPathPattern</a><span class="delimiter">(</span><span title="java.lang.String(&quot;(?:&quot;)" class="string">&quot;(?:&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#69303" title="RailsPathPatternParser.this.PartialPathPattern">e</a>.<a href="#68718" title="=&gt; String">regex</a><span title="(x$1: Any)java.lang.String">+</span><span title="java.lang.String(&quot;)?&quot;)" class="string">&quot;)?&quot;</span>, <a href="#69303" title="RailsPathPatternParser.this.PartialPathPattern">e</a>.<a href="#68719" title="=&gt; List[String]">captureGroupNames</a><span class="delimiter">)</span> <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern]" id="69036">static</a> = <span class="delimiter">(</span><a href="#69037" title="=&gt; RailsPathPatternParser.this.Parser[java.lang.String]">escaped</a> <span title="(q: =&gt; RailsPathPatternParser.this.Parser[java.lang.String])RailsPathPatternParser.this.Parser[java.lang.String]">|</span> <a href="#69038" title="=&gt; RailsPathPatternParser.this.Parser[java.lang.String]">char</a><span class="delimiter">)</span> <span title="(f: java.lang.String =&gt; RailsPathPatternParser.this.PartialPathPattern)RailsPathPatternParser.this.Parser[RailsPathPatternParser.this.PartialPathPattern]">^^</span>
    <span class="delimiter">{</span> <a title="java.lang.String" id="69234">str</a> =&gt; <a href="#68704" title="(regex: String, captureGroupNames: List[String])RailsPathPatternParser.this.PartialPathPattern">PartialPathPattern</a><span class="delimiter">(</span><a href="#69234" title="java.lang.String">str</a><span class="delimiter">)</span> <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; RailsPathPatternParser.this.Parser[java.lang.String]" id="69037">escaped</a> = <a href="#9941" title="implicit scala.util.parsing.combinator.RegexParsers.literal : (s: String)RailsPathPatternParser.this.Parser[String]">literal</a><span class="delimiter">(</span><span title="java.lang.String(&quot;\\&quot;)" class="string">&quot;\\&quot;</span><span class="delimiter">)</span> <span title="(q: =&gt; RailsPathPatternParser.this.Parser[java.lang.String])RailsPathPatternParser.this.Parser[java.lang.String]">~&gt;</span> <span class="delimiter">(</span><a href="#69038" title="=&gt; RailsPathPatternParser.this.Parser[java.lang.String]">char</a> <span title="(q: =&gt; RailsPathPatternParser.this.Parser[java.lang.String])RailsPathPatternParser.this.Parser[java.lang.String]">|</span> <a href="#69041" title="=&gt; RailsPathPatternParser.this.Parser[java.lang.String]">paren</a><span class="delimiter">)</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; RailsPathPatternParser.this.Parser[java.lang.String]" id="69038">char</a> = <a href="#69039" title="=&gt; RailsPathPatternParser.this.Parser[java.lang.String]">metachar</a> <span title="(q: =&gt; RailsPathPatternParser.this.Parser[java.lang.String])RailsPathPatternParser.this.Parser[java.lang.String]">|</span> <a href="#9941" title="implicit scala.util.parsing.combinator.RegexParsers.regex : (r: scala.util.matching.Regex)RailsPathPatternParser.this.Parser[String]">stdchar</a>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; RailsPathPatternParser.this.Parser[java.lang.String]" id="69039">metachar</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;[.^$|?+*{}\\\[\]-]&quot;&quot;&quot;</span>.<a href="#9941" title="implicit scala.util.parsing.combinator.RegexParsers.regex : (r: scala.util.matching.Regex)RailsPathPatternParser.this.Parser[String]">r</a> <span title="(f: String =&gt; java.lang.String)RailsPathPatternParser.this.Parser[java.lang.String]">^^</span> <span class="delimiter">{</span> <span title="java.lang.String(&quot;\\&quot;)" class="string">&quot;\\&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#69182" title="String">_</a> <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; scala.util.matching.Regex" id="69040">stdchar</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;&quot;&quot;[^()]&quot;&quot;&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="=&gt; RailsPathPatternParser.this.Parser[java.lang.String]" id="69041">paren</a> = <span class="delimiter">(</span><a href="#9941" title="implicit scala.util.parsing.combinator.RegexParsers.literal : (s: String)RailsPathPatternParser.this.Parser[String]" class="string">&quot;(&quot;</a> <span title="(q: =&gt; RailsPathPatternParser.this.Parser[String])RailsPathPatternParser.this.Parser[String]">|</span> <a href="#9941" title="implicit scala.util.parsing.combinator.RegexParsers.literal : (s: String)RailsPathPatternParser.this.Parser[String]" class="string">&quot;)&quot;</a><span class="delimiter">)</span> <span title="(f: String =&gt; java.lang.String)RailsPathPatternParser.this.Parser[java.lang.String]">^^</span> <span class="delimiter">{</span> <span title="java.lang.String(&quot;\\&quot;)" class="string">&quot;\\&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#69220" title="String">_</a> <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object org.scalatra.RailsPathPatternParser" id="9942">RailsPathPatternParser</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(pattern: String)org.scalatra.PathPattern" id="69306">apply</a><span class="delimiter">(</span><a title="String" id="69308">pattern</a>: <span title="String">String</span><span class="delimiter">)</span>: <a href="#69318" title="org.scalatra.PathPattern">PathPattern</a> = <span title="org.scalatra.RailsPathPatternParser" class="keyword">new</span> <a href="#9941" title="org.scalatra.RailsPathPatternParser">RailsPathPatternParser</a><span class="delimiter">(</span><span class="delimiter">)</span>.<a href="#69028" title="(pattern: String)org.scalatra.PathPattern">apply</a><span class="delimiter">(</span><a href="#69308" title="String">pattern</a><span class="delimiter">)</span>
<span class="delimiter">}</span>


        </pre>
    </body>
</html>
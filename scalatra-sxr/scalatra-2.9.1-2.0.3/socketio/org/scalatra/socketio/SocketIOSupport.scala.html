<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>socketio/org/scalatra/socketio/SocketIOSupport.scala</title>
        <script type="text/javascript" src="../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> org.scalatra
<span class="keyword">package</span> socketio

<span class="keyword">import</span> com.glines.socketio.server.transport._
<span class="keyword">import</span> collection.<span title="object scala.collection.JavaConversions">JavaConversions</span>._
<span class="keyword">import</span> scala.io.Source
<span class="keyword">import</span> java.lang.String
<span class="keyword">import</span> com.glines.socketio.common.DisconnectReason
<span class="keyword">import</span> com.glines.socketio.server.<span class="delimiter">{</span>SocketIOInbound, SocketIOOutbound, Transport, SocketIOSessionManager<span class="delimiter">}</span>
<span class="keyword">import</span> com.glines.socketio.server.<span title="object com.glines.socketio.server.SocketIOFrame">SocketIOFrame</span>.FrameType
<span class="keyword">import</span> javax.servlet.http.<span class="delimiter">{</span>HttpServletResponse, HttpServletRequest<span class="delimiter">}</span>
<span class="keyword">import</span> util.<a href="../../../../scalatra/org/scalatra/util/RicherString.scala.html#11062" title="object org.scalatra.util.RicherString">RicherString</a>._
<span class="keyword">import</span> java.util.concurrent.<span class="delimiter">{</span>ConcurrentSkipListSet, CopyOnWriteArrayList, ConcurrentHashMap<span class="delimiter">}</span>

<span class="keyword">trait</span> <a title="trait SocketIOClient extends java.lang.Object with org.scalatra.socketio.SocketIOSupport.ScalatraSocketIOClient" id="11220">SocketIOClient</a> <span class="keyword">extends</span> SocketIOSupport.<a href="#72110" title="org.scalatra.socketio.SocketIOSupport.ScalatraSocketIOClient">ScalatraSocketIOClient</a>
<span class="keyword">sealed</span> <span class="keyword">trait</span> <a title="trait SocketIOMessage extends java.lang.Object" id="11238">SocketIOMessage</a>
case <span class="keyword">object</span> <a href="#72145" title="object org.scalatra.socketio.Connected" id="72150">Connected</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#11238" title="org.scalatra.socketio.SocketIOMessage">SocketIOMessage</a>
case <span class="keyword">class</span> <a title="class Message extends java.lang.Object with org.scalatra.socketio.SocketIOMessage with ScalaObject with Product with Serializable" id="74113">Message</a><a href="#74113" title="ScalaObject" class="delimiter">(</a><a title="Int" id="72406">messageType</a>: <span title="Int">Int</span>, <a title="java.lang.String" id="72407">message</a>: <span title="java.lang.String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#11238" title="org.scalatra.socketio.SocketIOMessage">SocketIOMessage</a>
case <span class="keyword">class</span> <a title="class Disconnected extends java.lang.Object with org.scalatra.socketio.SocketIOMessage with ScalaObject with Product with Serializable" id="74117">Disconnected</a><a href="#74117" title="ScalaObject" class="delimiter">(</a><a title="com.glines.socketio.common.DisconnectReason" id="72389">reason</a>: <span title="com.glines.socketio.common.DisconnectReason">DisconnectReason</span>, <a title="java.lang.String" id="72390">message</a>: <span title="java.lang.String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#11238" title="org.scalatra.socketio.SocketIOMessage">SocketIOMessage</a>

@deprecated<span class="delimiter">(</span><span class="string">&quot;Upstream socketio-java is unsupported. We will provide an Atmosphere solution.&quot;</span><span class="delimiter">)</span>
<span class="keyword">object</span> <a title="object org.scalatra.socketio.SocketIOSupport" id="11248">SocketIOSupport</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">val</span> <a title="java.lang.String" id="72101">BUFFER_SIZE_INIT_PARAM</a> = <span title="java.lang.String(&quot;bufferSize&quot;)" class="string">&quot;bufferSize&quot;</span>
  <span class="keyword">val</span> <a title="java.lang.String" id="72103">MAX_IDLE_TIME_INIT_PARAM</a>: <span title="java.lang.String">String</span> = <span title="java.lang.String(&quot;maxIdleTime&quot;)" class="string">&quot;maxIdleTime&quot;</span>
  <span class="keyword">val</span> <a title="Int" id="72105">BUFFER_SIZE_DEFAULT</a>: <span title="Int">Int</span> = <span title="Int(8192)" class="int">8192</span>
  <span class="keyword">val</span> <a title="Int" id="72107">MAX_IDLE_TIME_DEFAULT</a>: <span title="Int">Int</span> = <span class="int">300</span> <span title="Int(300000)">*</span> <span class="int">1000</span>


  <span class="keyword">type</span> <a title="PartialFunction[org.scalatra.socketio.SocketIOMessage,Unit]" id="72109">SocketIOReceive</a> = <span title="PartialFunction[org.scalatra.socketio.SocketIOMessage,Unit]">PartialFunction</span><span class="delimiter">[</span>SocketIOMessage, Unit<span class="delimiter">]</span>

  <span class="keyword">trait</span> <a title="trait ScalatraSocketIOClient extends java.lang.Object with com.glines.socketio.server.SocketIOInbound with ScalaObject" id="72110">ScalatraSocketIOClient</a> <span title="ScalaObject" class="keyword">extends</span> <span title="com.glines.socketio.server.SocketIOInbound">SocketIOInbound</span> <span class="delimiter">{</span>

    <span class="keyword">val</span> <a title="String" id="72122">clientId</a> = <a href="../../../../scalatra/org/scalatra/CsrfTokenSupport.scala.html#54367" title="()String">GenerateId</a><span class="delimiter">(</span><span class="delimiter">)</span>

    <span class="keyword">final</span> <span class="keyword">def</span> <a title="(outbound: com.glines.socketio.server.SocketIOOutbound)Unit" id="72124">onConnect</a><span class="delimiter">(</span><a title="com.glines.socketio.server.SocketIOOutbound" id="72370">outbound</a>: <span title="com.glines.socketio.server.SocketIOOutbound">SocketIOOutbound</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#72129" title="(x$1: Option[com.glines.socketio.server.SocketIOOutbound])Unit">_out</a> = <span title="(x: com.glines.socketio.server.SocketIOOutbound)Some[com.glines.socketio.server.SocketIOOutbound]">Some</span><span class="delimiter">(</span><a href="#72370" title="com.glines.socketio.server.SocketIOOutbound">outbound</a><span class="delimiter">)</span>
      <a href="#72111" title="=&gt; scala.collection.mutable.Set[org.scalatra.socketio.SocketIOSupport.ScalatraSocketIOClient]">clients</a> <span title="(elem: org.scalatra.socketio.SocketIOSupport.ScalatraSocketIOClient)org.scalatra.socketio.SocketIOSupport.clients.type">+=</span> <a href="#72110" title="org.scalatra.socketio.SocketIOSupport.ScalatraSocketIOClient" class="keyword">this</a>
      <a href="#72127" title="(v1: org.scalatra.socketio.SocketIOMessage)Unit">receive</a><span class="delimiter">(</span><a href="#72150" title="object org.scalatra.socketio.Connected">Connected</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">final</span> <span class="keyword">def</span> <a title="(reason: com.glines.socketio.common.DisconnectReason, errorMessage: java.lang.String)Unit" id="72125">onDisconnect</a><span class="delimiter">(</span><a title="com.glines.socketio.common.DisconnectReason" id="72386">reason</a>: <span title="com.glines.socketio.common.DisconnectReason">DisconnectReason</span>, <a title="java.lang.String" id="72387">errorMessage</a>: <span title="java.lang.String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#72127" title="(v1: org.scalatra.socketio.SocketIOMessage)Unit">receive</a><span class="delimiter">(</span><a href="#74117" title="(reason: com.glines.socketio.common.DisconnectReason, message: java.lang.String)org.scalatra.socketio.Disconnected">Disconnected</a><span class="delimiter">(</span><a href="#72386" title="com.glines.socketio.common.DisconnectReason">reason</a>, <a href="#72387" title="java.lang.String">errorMessage</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#72111" title="=&gt; scala.collection.mutable.Set[org.scalatra.socketio.SocketIOSupport.ScalatraSocketIOClient]">clients</a> <span title="(elem: org.scalatra.socketio.SocketIOSupport.ScalatraSocketIOClient)org.scalatra.socketio.SocketIOSupport.clients.type">-=</span> <a href="#72110" title="org.scalatra.socketio.SocketIOSupport.ScalatraSocketIOClient" class="keyword">this</a>
    <span class="delimiter">}</span>

    <span class="keyword">final</span> <span class="keyword">def</span> <a title="(messageType: Int, message: java.lang.String)Unit" id="72126">onMessage</a><span class="delimiter">(</span><a title="Int" id="72403">messageType</a>: <span title="Int">Int</span>, <a title="java.lang.String" id="72404">message</a>: <span title="java.lang.String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#72127" title="(v1: org.scalatra.socketio.SocketIOMessage)Unit">receive</a><span class="delimiter">(</span><a href="#74113" title="(messageType: Int, message: java.lang.String)org.scalatra.socketio.Message">Message</a><span class="delimiter">(</span><a href="#72403" title="Int">messageType</a>, <a href="#72404" title="java.lang.String">message</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

    <span class="keyword">def</span> <a title="=&gt; org.scalatra.socketio.SocketIOSupport.SocketIOReceive" id="72127">receive</a>: <span title="org.scalatra.socketio.SocketIOSupport.SocketIOReceive">SocketIOReceive</span>

    <span class="keyword">private</span> <span class="keyword">var</span> <a title="Option[com.glines.socketio.server.SocketIOOutbound]" id="72129">_out</a>: <span title="Option[com.glines.socketio.server.SocketIOOutbound]">Option</span><span class="delimiter">[</span>SocketIOOutbound<span class="delimiter">]</span> = <span title="object None">None</span>

    <span class="keyword">final</span> <span class="keyword">def</span> <a title="(messageType: Int, message: java.lang.String)Unit" id="72131">send</a><span class="delimiter">(</span><a title="Int" id="72413">messageType</a>: <span title="Int">Int</span>, <a title="java.lang.String" id="72414">message</a>: <span title="java.lang.String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#72129" title="=&gt; Option[com.glines.socketio.server.SocketIOOutbound]">_out</a> <span title="(f: com.glines.socketio.server.SocketIOOutbound =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a href="#72420" title="com.glines.socketio.server.SocketIOOutbound">_</a>.<span title="(x$1: Int, x$2: java.lang.String)Unit">sendMessage</span><span class="delimiter">(</span><a href="#72413" title="Int">messageType</a>, <a href="#72414" title="java.lang.String">message</a><span class="delimiter">)</span> <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">final</span> <span class="keyword">def</span> <a title="(message: java.lang.String)Unit" id="72132">send</a><span class="delimiter">(</span><a title="java.lang.String" id="72424">message</a>: <span title="java.lang.String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#72129" title="=&gt; Option[com.glines.socketio.server.SocketIOOutbound]">_out</a> <span title="(f: com.glines.socketio.server.SocketIOOutbound =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a href="#72429" title="com.glines.socketio.server.SocketIOOutbound">_</a>.<span title="(x$1: java.lang.String)Unit">sendMessage</span><span class="delimiter">(</span><a href="#72424" title="java.lang.String">message</a><span class="delimiter">)</span> <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">final</span> <span class="keyword">def</span> <a title="(messageType: Int, message: java.lang.String)Unit" id="72133">broadcast</a><span class="delimiter">(</span><a title="Int" id="72433">messageType</a>: <span title="Int">Int</span>, <a title="java.lang.String" id="72434">message</a>: <span title="java.lang.String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#72111" title="=&gt; scala.collection.mutable.Set[org.scalatra.socketio.SocketIOSupport.ScalatraSocketIOClient]">clients</a>.<span title="(p: org.scalatra.socketio.SocketIOSupport.ScalatraSocketIOClient =&gt; Boolean)scala.collection.mutable.Set[org.scalatra.socketio.SocketIOSupport.ScalatraSocketIOClient]">filterNot</span><span class="delimiter">(</span><a href="#72439" title="org.scalatra.socketio.SocketIOSupport.ScalatraSocketIOClient">_</a>.<a href="#72122" title="=&gt; String">clientId</a> <span title="(x$1: AnyRef)Boolean">==</span> <a href="#72122" title="=&gt; String">clientId</a><span class="delimiter">)</span>.<span title="(f: org.scalatra.socketio.SocketIOSupport.ScalatraSocketIOClient =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a href="#72476" title="org.scalatra.socketio.SocketIOSupport.ScalatraSocketIOClient">_</a>.<a href="#72131" title="(messageType: Int, message: java.lang.String)Unit">send</a><span class="delimiter">(</span><a href="#72433" title="Int">messageType</a>, <a href="#72434" title="java.lang.String">message</a><span class="delimiter">)</span> <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">final</span> <span class="keyword">def</span> <a title="()Unit" id="72134">close</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#72129" title="=&gt; Option[com.glines.socketio.server.SocketIOOutbound]">_out</a> <span title="(f: com.glines.socketio.server.SocketIOOutbound =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a href="#72484" title="com.glines.socketio.server.SocketIOOutbound">_</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">}</span>
    <span class="delimiter">}</span>

    <span class="keyword">final</span> <span class="keyword">def</span> <a title="()Unit" id="72135">disconnect</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#72129" title="=&gt; Option[com.glines.socketio.server.SocketIOOutbound]">_out</a> <span title="(f: com.glines.socketio.server.SocketIOOutbound =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a href="#72490" title="com.glines.socketio.server.SocketIOOutbound">_</a>.<span title="()Unit">disconnect</span><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">}</span>
    <span class="delimiter">}</span>

  <span class="delimiter">}</span>

  <span class="keyword">val</span> <a title="scala.collection.mutable.Set[org.scalatra.socketio.SocketIOSupport.ScalatraSocketIOClient]" id="72111">clients</a>: collection.mutable.<span title="scala.collection.mutable.Set[org.scalatra.socketio.SocketIOSupport.ScalatraSocketIOClient]">Set</span><span class="delimiter">[</span>ScalatraSocketIOClient<span class="delimiter">]</span> = <span title="(s: java.util.Set[org.scalatra.socketio.SocketIOSupport.ScalatraSocketIOClient])scala.collection.mutable.Set[org.scalatra.socketio.SocketIOSupport.ScalatraSocketIOClient]" class="keyword">new</span> <span title="java.util.concurrent.ConcurrentSkipListSet[org.scalatra.socketio.SocketIOSupport.ScalatraSocketIOClient]">ConcurrentSkipListSet</span><span class="delimiter">[</span>ScalatraSocketIOClient<span class="delimiter">]</span>

<span class="delimiter">}</span>

@deprecated<span class="delimiter">(</span><span class="string">&quot;Upstream socketio-java is unsupported. We will provide an Atmosphere solution.&quot;</span><span class="delimiter">)</span>
<span class="keyword">trait</span> <a title="trait SocketIOSupport extends java.lang.Object with org.scalatra.Handler with org.scalatra.Initializable with ScalaObject" id="11247">SocketIOSupport</a> <span title="ScalaObject" class="keyword">extends</span> <a href="../../../../scalatra/org/scalatra/Handler.scala.html#10055" title="org.scalatra.Handler">Handler</a> <span class="keyword">with</span> <a href="../../../../scalatra/org/scalatra/Initializable.scala.html#10103" title="org.scalatra.Initializable">Initializable</a> <span class="delimiter">{</span>
  self: ScalatraServlet =&gt;

  <span class="keyword">import</span> <a href="#11248" title="object org.scalatra.socketio.SocketIOSupport">SocketIOSupport</a>._

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="com.glines.socketio.server.SocketIOSessionManager" id="72343">sessionManager</a>: <span title="com.glines.socketio.server.SocketIOSessionManager">SocketIOSessionManager</span> = <span title="com.glines.socketio.server.SocketIOSessionManager" class="keyword">new</span> <span title="com.glines.socketio.server.SocketIOSessionManager">SocketIOSessionManager</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.ConcurrentMap[java.lang.String,com.glines.socketio.server.Transport]" id="72345">transports</a>: collection.mutable.<span title="scala.collection.mutable.ConcurrentMap[java.lang.String,com.glines.socketio.server.Transport]">ConcurrentMap</span><span class="delimiter">[</span>String, Transport<span class="delimiter">]</span> = <span title="(m: java.util.concurrent.ConcurrentMap[java.lang.String,com.glines.socketio.server.Transport])scala.collection.mutable.ConcurrentMap[java.lang.String,com.glines.socketio.server.Transport]" class="keyword">new</span> <span title="java.util.concurrent.ConcurrentHashMap[java.lang.String,com.glines.socketio.server.Transport]">ConcurrentHashMap</span><span class="delimiter">[</span>String, Transport<span class="delimiter">]</span>
<span class="comment">//  private var _builder: SocketIOClientBuilder = null</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.util.concurrent.CopyOnWriteArrayList[org.scalatra.socketio.SocketIOClient]" id="72347">_connections</a> = <span title="java.util.concurrent.CopyOnWriteArrayList[org.scalatra.socketio.SocketIOClient]" class="keyword">new</span> <span title="java.util.concurrent.CopyOnWriteArrayList[org.scalatra.socketio.SocketIOClient]">CopyOnWriteArrayList</span><span class="delimiter">[</span>SocketIOClient<span class="delimiter">]</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(config: SocketIOSupport.this.Config)Unit" id="72349">initialize</a><span class="delimiter">(</span><a title="SocketIOSupport.this.Config" id="73393">config</a>: <span title="SocketIOSupport.this.Config">Config</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Int" id="73396">bufferSize</a> = <span class="delimiter">(</span><span title="(x: java.lang.String)Option[java.lang.String]">Option</span><span class="delimiter">(</span><a href="#11247" title="()javax.servlet.ServletConfig">getServletConfig</a>.<span title="(x$1: java.lang.String)java.lang.String">getInitParameter</span><span class="delimiter">(</span><a href="#72101" title="=&gt; java.lang.String">BUFFER_SIZE_INIT_PARAM</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">getOrElse</span> <a href="#72105" title="=&gt; Int">BUFFER_SIZE_DEFAULT</a>.<span title="()java.lang.String">toString</span><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span>
    <span class="keyword">val</span> <a title="Int" id="73397">maxIdleTime</a> = <span class="delimiter">(</span><span title="(x: java.lang.String)Option[java.lang.String]">Option</span><span class="delimiter">(</span><a href="#11247" title="()javax.servlet.ServletConfig">getServletConfig</a>.<span title="(x$1: java.lang.String)java.lang.String">getInitParameter</span><span class="delimiter">(</span><a href="#72103" title="=&gt; java.lang.String">MAX_IDLE_TIME_INIT_PARAM</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">getOrElse</span> <a href="#72107" title="=&gt; Int">MAX_IDLE_TIME_DEFAULT</a>.<span title="()java.lang.String">toString</span><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span>

    <span class="keyword">val</span> <a title="com.glines.socketio.server.transport.WebSocketTransport" id="73398">websocketTransport</a> = <span title="com.glines.socketio.server.transport.WebSocketTransport" class="keyword">new</span> <span title="com.glines.socketio.server.transport.WebSocketTransport">WebSocketTransport</span><span class="delimiter">(</span><a href="#73396" title="Int">bufferSize</a>, <a href="#73397" title="Int">maxIdleTime</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="com.glines.socketio.server.transport.FlashSocketTransport" id="73399">flashsocketTransport</a> = <span title="com.glines.socketio.server.transport.FlashSocketTransport" class="keyword">new</span> <span title="com.glines.socketio.server.transport.FlashSocketTransport">FlashSocketTransport</span><span class="delimiter">(</span><a href="#73396" title="Int">bufferSize</a>, <a href="#73397" title="Int">maxIdleTime</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="com.glines.socketio.server.transport.HTMLFileTransport" id="73400">htmlFileTransport</a> = <span title="com.glines.socketio.server.transport.HTMLFileTransport" class="keyword">new</span> <span title="com.glines.socketio.server.transport.HTMLFileTransport">HTMLFileTransport</span><span class="delimiter">(</span><a href="#73396" title="Int">bufferSize</a>, <a href="#73397" title="Int">maxIdleTime</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="com.glines.socketio.server.transport.XHRMultipartTransport" id="73401">xhrMultipartTransport</a> = <span title="com.glines.socketio.server.transport.XHRMultipartTransport" class="keyword">new</span> <span title="com.glines.socketio.server.transport.XHRMultipartTransport">XHRMultipartTransport</span><span class="delimiter">(</span><a href="#73396" title="Int">bufferSize</a>, <a href="#73397" title="Int">maxIdleTime</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="com.glines.socketio.server.transport.XHRPollingTransport" id="73402">xhrPollingTransport</a> = <span title="com.glines.socketio.server.transport.XHRPollingTransport" class="keyword">new</span> <span title="com.glines.socketio.server.transport.XHRPollingTransport">XHRPollingTransport</span><span class="delimiter">(</span><a href="#73396" title="Int">bufferSize</a>, <a href="#73397" title="Int">maxIdleTime</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="com.glines.socketio.server.transport.JSONPPollingTransport" id="73403">jsonpPollingTransport</a> = <span title="com.glines.socketio.server.transport.JSONPPollingTransport" class="keyword">new</span> <span title="com.glines.socketio.server.transport.JSONPPollingTransport">JSONPPollingTransport</span><span class="delimiter">(</span><a href="#73396" title="Int">bufferSize</a>, <a href="#73397" title="Int">maxIdleTime</a><span class="delimiter">)</span>
    <a href="#72345" title="=&gt; scala.collection.mutable.ConcurrentMap[java.lang.String,com.glines.socketio.server.Transport]">transports</a> <span title="(xs: scala.collection.TraversableOnce[(java.lang.String, com.glines.socketio.server.Transport)])SocketIOSupport.this.transports.type">++=</span> <span title="(elems: (java.lang.String, com.glines.socketio.server.transport.AbstractTransport)*)Seq[(java.lang.String, com.glines.socketio.server.transport.AbstractTransport)]">Seq</span><span class="delimiter">(</span><a href="#73398" title="com.glines.socketio.server.transport.WebSocketTransport">websocketTransport</a>.<span title="(x: java.lang.String)ArrowAssoc[java.lang.String]">getName</span> <span title="(y: com.glines.socketio.server.transport.WebSocketTransport)(java.lang.String, com.glines.socketio.server.transport.WebSocketTransport)">-&gt;</span> <a href="#73398" title="com.glines.socketio.server.transport.WebSocketTransport">websocketTransport</a>,
      <a href="#73399" title="com.glines.socketio.server.transport.FlashSocketTransport">flashsocketTransport</a>.<span title="(x: java.lang.String)ArrowAssoc[java.lang.String]">getName</span> <span title="(y: com.glines.socketio.server.transport.FlashSocketTransport)(java.lang.String, com.glines.socketio.server.transport.FlashSocketTransport)">-&gt;</span> <a href="#73399" title="com.glines.socketio.server.transport.FlashSocketTransport">flashsocketTransport</a>,
      <a href="#73400" title="com.glines.socketio.server.transport.HTMLFileTransport">htmlFileTransport</a>.<span title="(x: java.lang.String)ArrowAssoc[java.lang.String]">getName</span> <span title="(y: com.glines.socketio.server.transport.HTMLFileTransport)(java.lang.String, com.glines.socketio.server.transport.HTMLFileTransport)">-&gt;</span> <a href="#73400" title="com.glines.socketio.server.transport.HTMLFileTransport">htmlFileTransport</a>,
      <a href="#73401" title="com.glines.socketio.server.transport.XHRMultipartTransport">xhrMultipartTransport</a>.<span title="(x: java.lang.String)ArrowAssoc[java.lang.String]">getName</span> <span title="(y: com.glines.socketio.server.transport.XHRMultipartTransport)(java.lang.String, com.glines.socketio.server.transport.XHRMultipartTransport)">-&gt;</span> <a href="#73401" title="com.glines.socketio.server.transport.XHRMultipartTransport">xhrMultipartTransport</a>,
      <a href="#73402" title="com.glines.socketio.server.transport.XHRPollingTransport">xhrPollingTransport</a>.<span title="(x: java.lang.String)ArrowAssoc[java.lang.String]">getName</span> <span title="(y: com.glines.socketio.server.transport.XHRPollingTransport)(java.lang.String, com.glines.socketio.server.transport.XHRPollingTransport)">-&gt;</span> <a href="#73402" title="com.glines.socketio.server.transport.XHRPollingTransport">xhrPollingTransport</a>,
      <a href="#73403" title="com.glines.socketio.server.transport.JSONPPollingTransport">jsonpPollingTransport</a>.<span title="(x: java.lang.String)ArrowAssoc[java.lang.String]">getName</span> <span title="(y: com.glines.socketio.server.transport.JSONPPollingTransport)(java.lang.String, com.glines.socketio.server.transport.JSONPPollingTransport)">-&gt;</span> <a href="#73403" title="com.glines.socketio.server.transport.JSONPPollingTransport">jsonpPollingTransport</a><span class="delimiter">)</span>

    <a href="#72345" title="=&gt; scala.collection.mutable.ConcurrentMap[java.lang.String,com.glines.socketio.server.Transport]">transports</a>.<span title="=&gt; Iterable[com.glines.socketio.server.Transport]">values</span> <span title="(f: com.glines.socketio.server.Transport =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a href="#73975" title="com.glines.socketio.server.Transport">_</a>.<span title="(x$1: javax.servlet.ServletConfig)Unit">init</span><span class="delimiter">(</span><a href="#11247" title="()javax.servlet.ServletConfig">getServletConfig</a><span class="delimiter">)</span> <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">abstract</span> <span class="keyword">override</span> <span class="keyword">def</span> <a title="(req: javax.servlet.http.HttpServletRequest, res: javax.servlet.http.HttpServletResponse)Unit" id="72350">handle</a><span class="delimiter">(</span><a title="javax.servlet.http.HttpServletRequest" id="73977">req</a>: <span title="javax.servlet.http.HttpServletRequest">HttpServletRequest</span>, <a title="javax.servlet.http.HttpServletResponse" id="73978">res</a>: <span title="javax.servlet.http.HttpServletResponse">HttpServletResponse</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.lang.String" id="73980">path</a> = <a href="#73977" title="javax.servlet.http.HttpServletRequest">req</a>.<span title="()java.lang.String">getPathInfo</span>
    <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="../../../../scalatra/org/scalatra/util/RicherString.scala.html#24699" title="implicit org.scalatra.util.RicherString.stringToRicherString : (s: String)org.scalatra.util.RicherString">path</a>.<a href="../../../../scalatra/org/scalatra/util/RicherString.scala.html#25294" title="=&gt; Boolean">isBlank</a> <span title="(x: Boolean)Boolean">||</span> <a href="#73980" title="java.lang.String">path</a> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span class="delimiter">)</span> <a href="#11247" title="&lt;none&gt; extends org.scalatra.socketio.SocketIOSupport with org.scalatra.ScalatraServlet" class="keyword">super</a>.<a href="../../../../scalatra/org/scalatra/Handler.scala.html#11846" title="(req: javax.servlet.http.HttpServletRequest, res: javax.servlet.http.HttpServletResponse)Unit">handle</a><span class="delimiter">(</span><a href="#73977" title="javax.servlet.http.HttpServletRequest">req</a>, <a href="#73978" title="javax.servlet.http.HttpServletResponse">res</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Array[java.lang.String]" id="73981">parts</a> = <span class="delimiter">(</span><span title="java.lang.String" class="keyword">if</span> <span class="delimiter">(</span><a href="#73980" title="java.lang.String">path</a>.<span title="(x$1: java.lang.String)Boolean">startsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#73980" title="java.lang.String">path</a>.<span title="(x$1: Int)java.lang.String">substring</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#73980" title="java.lang.String">path</a><span class="delimiter">)</span>.<span title="(x$1: java.lang.String)Array[java.lang.String]">split</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Option[com.glines.socketio.server.Transport]" id="73982">transport</a> = <a href="#72345" title="=&gt; scala.collection.mutable.ConcurrentMap[java.lang.String,com.glines.socketio.server.Transport]">transports</a>.<span title="(key: java.lang.String)Option[com.glines.socketio.server.Transport]">get</span><span class="delimiter">(</span><a href="#73981" title="(i: Int)java.lang.String">parts</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#73982" title="Option[com.glines.socketio.server.Transport]">transport</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#11247" title="&lt;none&gt; extends org.scalatra.socketio.SocketIOSupport with org.scalatra.ScalatraServlet" class="keyword">super</a>.<a href="../../../../scalatra/org/scalatra/Handler.scala.html#11846" title="(req: javax.servlet.http.HttpServletRequest, res: javax.servlet.http.HttpServletResponse)Unit">handle</a><span class="delimiter">(</span><a href="#73977" title="javax.servlet.http.HttpServletRequest">req</a>, <a href="#73978" title="javax.servlet.http.HttpServletResponse">res</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#73982" title="Option[com.glines.socketio.server.Transport]">transport</a>.<span title="=&gt; com.glines.socketio.server.Transport">get</span>.<span title="(x$1: javax.servlet.http.HttpServletRequest, x$2: javax.servlet.http.HttpServletResponse, x$3: com.glines.socketio.server.Transport.InboundFactory, x$4: com.glines.socketio.server.SocketIOSession.Factory)Unit">handle</span><span class="delimiter">(</span><a href="#73977" title="javax.servlet.http.HttpServletRequest">req</a>, <a href="#73978" title="javax.servlet.http.HttpServletResponse">res</a>, <a href="#74001" title="java.lang.Object with com.glines.socketio.server.Transport.InboundFactory" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with com.glines.socketio.server.Transport.InboundFactory" id="74001">Transport</a>.<span title="com.glines.socketio.server.Transport.InboundFactory">InboundFactory</span> <span class="delimiter">{</span>
        <span class="keyword">def</span> <a title="(p1: javax.servlet.http.HttpServletRequest)org.scalatra.socketio.SocketIOClient" id="74005">getInbound</a><span class="delimiter">(</span><a title="javax.servlet.http.HttpServletRequest" id="74006">p1</a>: <span title="javax.servlet.http.HttpServletRequest">HttpServletRequest</span><span class="delimiter">)</span> = <a href="#72351" title="(req: javax.servlet.http.HttpServletRequest)org.scalatra.socketio.SocketIOClient">socketio</a><span class="delimiter">(</span><a href="#74006" title="javax.servlet.http.HttpServletRequest">p1</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>, <a href="#72343" title="=&gt; com.glines.socketio.server.SocketIOSessionManager">sessionManager</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <a href="../../../../scalatra/org/scalatra/ScalatraKernel.scala.html#11904" title="(routeMatchers: org.scalatra.RouteMatcher*)(action: =&gt; Any)org.scalatra.Route">get</a><span class="delimiter">(</span><a href="../../../../scalatra/org/scalatra/ScalatraKernel.scala.html#11856" title="implicit org.scalatra.ScalatraKernel.string2RouteMatcher : (path: String)org.scalatra.RouteMatcher" class="string">&quot;/socket.io.js&quot;</a><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="../../../../scalatra/org/scalatra/CoreDsl.scala.html#11934" title="(contentType: String)Unit">contentType</a> = <span title="java.lang.String(&quot;text/javascript&quot;)" class="string">&quot;text/javascript&quot;</span>
    <span class="keyword">val</span> <a title="java.io.InputStream" id="74013">is</a> = <a href="#11247" title="()java.lang.Class[_]">getClass</a>.<span title="()java.lang.ClassLoader">getClassLoader</span>.<span title="(x$1: java.lang.String)java.io.InputStream">getResourceAsStream</span><span class="delimiter">(</span><span title="java.lang.String(&quot;com/glines/socketio/socket.io.js&quot;)" class="string">&quot;com/glines/socketio/socket.io.js&quot;</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="java.lang.String" id="74014">p</a> = <a href="../../../../scalatra/org/scalatra/ScalatraKernel.scala.html#11893" title="=&gt; javax.servlet.http.HttpServletRequest">request</a>.<span title="()java.lang.String">getServletPath</span>.<span title="(x$1: Int)java.lang.String">substring</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span title="object scala.io.Source">Source</span>.<span title="(is: java.io.InputStream)(implicit codec: scala.io.Codec)scala.io.BufferedSource">fromInputStream</span><span title="=&gt; scala.io.Codec" class="delimiter">(</span><a href="#74013" title="java.io.InputStream">is</a><span class="delimiter">)</span>.<span title="()Iterator[String]">getLines</span> <span title="(f: String =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span>
      <a title="String" id="74090">line</a> =&gt;
        <a href="../../../../scalatra/org/scalatra/ScalatraKernel.scala.html#11894" title="=&gt; javax.servlet.http.HttpServletResponse">response</a>.<span title="()java.io.PrintWriter">getWriter</span>.<span title="(x$1: java.lang.String)Unit">println</span><span class="delimiter">(</span>
          <a href="#74090" title="String">line</a>.<span title="(x$1: java.lang.CharSequence, x$2: java.lang.CharSequence)java.lang.String">replace</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\'socket.io\'&quot;)" class="string">&quot;'socket.io'&quot;</span>, <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;'%s'&quot;</span> <span title="(args: Any*)String">format</span> <a href="#74014" title="java.lang.String">p</a><span class="delimiter">)</span>.<span title="(x$1: java.lang.CharSequence, x$2: java.lang.CharSequence)java.lang.String">replace</span><span class="delimiter">(</span><span title="java.lang.String(&quot;socket.io/WebSocketMain&quot;)" class="string">&quot;socket.io/WebSocketMain&quot;</span>, <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;%s/WebSocketMain&quot;</span> <span title="(args: Any*)String">format</span> <a href="#74014" title="java.lang.String">p</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>


  <span class="keyword">def</span> <a title="(req: javax.servlet.http.HttpServletRequest)org.scalatra.socketio.SocketIOClient" id="72351">socketio</a><span class="delimiter">(</span><a title="javax.servlet.http.HttpServletRequest" id="74009">req</a>: <span title="javax.servlet.http.HttpServletRequest">HttpServletRequest</span><span class="delimiter">)</span>: <a href="#11220" title="org.scalatra.socketio.SocketIOClient">SocketIOClient</a>

<span class="delimiter">}</span>

        </pre>
    </body>
</html>
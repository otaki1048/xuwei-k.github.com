<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>websockets/plans.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> unfiltered.netty.websockets

<span class="keyword">import</span> unfiltered.request._
<span class="keyword">import</span> unfiltered.response._
<span class="keyword">import</span> unfiltered.netty._

<span class="keyword">import</span> org.jboss.<span class="delimiter">{</span>netty =&gt; jnetty<span class="delimiter">}</span>
<span class="keyword">import</span> jnetty.handler.codec.http.HttpHeaders
<span class="keyword">import</span> jnetty.channel.<span class="delimiter">{</span>Channel, ChannelHandlerContext, MessageEvent, SimpleChannelUpstreamHandler<span class="delimiter">}</span>
<span class="keyword">import</span> jnetty.buffer.ChannelBuffer

<span class="keyword">object</span> <a title="object unfiltered.netty.websockets.Plan" id="10463">Plan</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">type</span> <a title="PartialFunction[unfiltered.netty.websockets.SocketCallback,Unit]" id="81253">SocketIntent</a> = <span title="PartialFunction[unfiltered.netty.websockets.SocketCallback,Unit]">PartialFunction</span><span class="delimiter">[</span>SocketCallback, Unit<span class="delimiter">]</span>
  <span class="keyword">type</span> <a title="PartialFunction[unfiltered.netty.RequestBinding,unfiltered.netty.websockets.Plan.SocketIntent]" id="81254">Intent</a> = <span title="PartialFunction[unfiltered.netty.RequestBinding,unfiltered.netty.websockets.Plan.SocketIntent]">PartialFunction</span><span class="delimiter">[</span>RequestBinding, SocketIntent<span class="delimiter">]</span>
  <span class="keyword">type</span> <a title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.MessageEvent) =&gt; Unit" id="81255">Pass</a> = <span class="delimiter">(</span>ChannelHandlerContext, MessageEvent<span class="delimiter">)</span> =&gt; Unit
<span class="delimiter">}</span>

<span class="keyword">private</span> <span class="delimiter">[</span>websockets<span class="delimiter">]</span> <span class="keyword">object</span> <a title="object unfiltered.netty.websockets.ProtocolRequestHeader" id="10465">ProtocolRequestHeader</a> <span title="ScalaObject" class="keyword">extends</span> <a href="../unfiltered/request/headers.scala.html#9999" title="unfiltered.request.StringHeader">StringHeader</a><span class="delimiter">(</span>HttpHeaders.Names.<span title="java.lang.String(&quot;Sec-WebSocket-Protocol&quot;)">SEC_WEBSOCKET_PROTOCOL</span><span class="delimiter">)</span>
<span class="keyword">private</span> <span class="delimiter">[</span>websockets<span class="delimiter">]</span> <span class="keyword">object</span> <a title="object unfiltered.netty.websockets.SecKeyOne" id="10467">SecKeyOne</a> <span title="ScalaObject" class="keyword">extends</span> <a href="../unfiltered/request/headers.scala.html#9999" title="unfiltered.request.StringHeader">StringHeader</a><span class="delimiter">(</span>HttpHeaders.Names.<span title="java.lang.String(&quot;Sec-WebSocket-Key1&quot;)">SEC_WEBSOCKET_KEY1</span><span class="delimiter">)</span>
<span class="keyword">private</span> <span class="delimiter">[</span>websockets<span class="delimiter">]</span> <span class="keyword">object</span> <a title="object unfiltered.netty.websockets.SecKeyTwo" id="10469">SecKeyTwo</a> <span title="ScalaObject" class="keyword">extends</span> <a href="../unfiltered/request/headers.scala.html#9999" title="unfiltered.request.StringHeader">StringHeader</a><span class="delimiter">(</span>HttpHeaders.Names.<span title="java.lang.String(&quot;Sec-WebSocket-Key2&quot;)">SEC_WEBSOCKET_KEY2</span><span class="delimiter">)</span>
<span class="keyword">private</span> <span class="delimiter">[</span>websockets<span class="delimiter">]</span> <span class="keyword">object</span> <a title="object unfiltered.netty.websockets.OriginRequestHeader" id="10471">OriginRequestHeader</a> <span title="ScalaObject" class="keyword">extends</span> <a href="../unfiltered/request/headers.scala.html#9999" title="unfiltered.request.StringHeader">StringHeader</a><span class="delimiter">(</span>HttpHeaders.Names.<span title="java.lang.String(&quot;Origin&quot;)">ORIGIN</span><span class="delimiter">)</span>
<span class="keyword">private</span> <span class="delimiter">[</span>websockets<span class="delimiter">]</span> <span class="keyword">object</span> <a title="object unfiltered.netty.websockets.ConnectionUpgrade" id="10473">ConnectionUpgrade</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="[T](req: unfiltered.request.HttpRequest[T])Option[String]" id="81282">unapply</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="81284">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="unfiltered.request.HttpRequest[T]" id="81286">req</a>: <a href="../unfiltered/request/HttpRequest.scala.html#9948" title="unfiltered.request.HttpRequest[T]">HttpRequest</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span> =
    unfiltered.request.<a href="../unfiltered/request/headers.scala.html#12805" title="(req: unfiltered.request.HttpRequest[T])Option[String]">Connection</a><span class="delimiter">(</span><a href="#81286" title="unfiltered.request.HttpRequest[T]">req</a><span class="delimiter">)</span>.<span title="(p: String =&gt; Boolean)Option[String]">filter</span> <span class="delimiter">{</span>
      <a href="#81294" title="String">_</a>.<span title="(x$1: java.lang.String)Boolean">equalsIgnoreCase</span><span class="delimiter">(</span>HttpHeaders.Values.<span title="java.lang.String(&quot;Upgrade&quot;)">UPGRADE</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">private</span> <span class="delimiter">[</span>websockets<span class="delimiter">]</span> <span class="keyword">object</span> <a title="object unfiltered.netty.websockets.UpgradeWebsockets" id="10475">UpgradeWebsockets</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="[T](req: unfiltered.request.HttpRequest[T])Option[unfiltered.request.HttpRequest[T]]" id="81326">unapply</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="81328">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="unfiltered.request.HttpRequest[T]" id="81330">req</a>: <a href="../unfiltered/request/HttpRequest.scala.html#9948" title="unfiltered.request.HttpRequest[T]">HttpRequest</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span> =
    <a href="../unfiltered/request/headers.scala.html#35506" title="(req: unfiltered.request.HttpRequest[T])List[String]">Upgrade</a><span class="delimiter">(</span><a href="#81330" title="unfiltered.request.HttpRequest[T]">req</a><span class="delimiter">)</span>.<span title="(p: String =&gt; Boolean)List[String]">filter</span> <span class="delimiter">{</span>
      <a href="#81341" title="String">_</a>.<span title="(x$1: java.lang.String)Boolean">equalsIgnoreCase</span><span class="delimiter">(</span>HttpHeaders.Values.<span title="java.lang.String(&quot;WebSocket&quot;)">WEBSOCKET</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>.<span title="=&gt; Option[String]">headOption</span>.<span title="(f: String =&gt; unfiltered.request.HttpRequest[T])Option[unfiltered.request.HttpRequest[T]]">map</span> <span class="delimiter">{</span> <a title="String" id="81346">_</a> =&gt; <a href="#81330" title="unfiltered.request.HttpRequest[T]">req</a> <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">private</span> <span class="delimiter">[</span>websockets<span class="delimiter">]</span> <span class="keyword">object</span> <a title="object unfiltered.netty.websockets.WSLocation" id="10477">WSLocation</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="[T](r: unfiltered.request.HttpRequest[T])String" id="81350">apply</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="81352">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="unfiltered.request.HttpRequest[T]" id="81354">r</a>: <a href="../unfiltered/request/HttpRequest.scala.html#9948" title="unfiltered.request.HttpRequest[T]">HttpRequest</a><span class="delimiter">[</span>T<span class="delimiter">]</span><span class="delimiter">)</span> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;ws://%s%s&quot;</span> <span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="../unfiltered/request/headers.scala.html#12805" title="(req: unfiltered.request.HttpRequest[T])Option[String]">Host</a><span class="delimiter">(</span><a href="#81354" title="unfiltered.request.HttpRequest[T]">r</a><span class="delimiter">)</span>.<span title="=&gt; String">get</span>, <a href="#81354" title="unfiltered.request.HttpRequest[T]">r</a>.<a href="../unfiltered/request/HttpRequest.scala.html#10673" title="=&gt; String">uri</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="keyword">trait</span> <a title="trait Plan extends org.jboss.netty.channel.SimpleChannelUpstreamHandler with ScalaObject" id="10479">Plan</a> <span title="ScalaObject" class="keyword">extends</span> <span title="org.jboss.netty.channel.SimpleChannelUpstreamHandler">SimpleChannelUpstreamHandler</span> <span class="delimiter">{</span>

  <span class="keyword">import</span> java.security.MessageDigest
  <span class="keyword">import</span> jnetty.channel.<span class="delimiter">{</span>ChannelFuture, ChannelFutureListener,
                         ChannelStateEvent, ExceptionEvent<span class="delimiter">}</span>
  <span class="keyword">import</span> jnetty.buffer.ChannelBuffers
  <span class="keyword">import</span> jnetty.handler.codec.http.websocket.<span class="delimiter">{</span>DefaultWebSocketFrame, WebSocketFrame,
                                             WebSocketFrameDecoder, WebSocketFrameEncoder<span class="delimiter">}</span>
  <span class="keyword">import</span> jnetty.handler.codec.http.<span class="delimiter">{</span>HttpHeaders, HttpMethod, HttpRequest =&gt; NHttpRequest,
                                   HttpResponseStatus, HttpVersion,  DefaultHttpResponse,
                                   HttpResponse =&gt; NHttpResponse<span class="delimiter">}</span>

  <span class="keyword">import</span> <span title="object org.jboss.netty.handler.codec.http.HttpHeaders">HttpHeaders</span>._
  <span class="keyword">import</span> <span title="object org.jboss.netty.handler.codec.http.HttpHeaders">HttpHeaders</span>.<span title="object org.jboss.netty.handler.codec.http.HttpHeaders.Names">Names</span>.<span class="delimiter">{</span>CONNECTION, ORIGIN, HOST, UPGRADE, SEC_WEBSOCKET_LOCATION,
                            SEC_WEBSOCKET_ORIGIN, SEC_WEBSOCKET_PROTOCOL<span class="delimiter">}</span>
  <span class="keyword">import</span> <span title="object org.jboss.netty.handler.codec.http.HttpHeaders">HttpHeaders</span>.<span title="object org.jboss.netty.handler.codec.http.HttpHeaders.Values">Values</span>._

  <span class="keyword">import</span> jnetty.util.CharsetUtil

  <span class="keyword">def</span> <a title="=&gt; unfiltered.netty.websockets.Plan.Intent" id="81266">intent</a>: Plan.<span title="unfiltered.netty.websockets.Plan.Intent">Intent</span>

  <span class="keyword">def</span> <a title="=&gt; (org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.MessageEvent) =&gt; Unit" id="81267">pass</a>: Plan.<span title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.MessageEvent) =&gt; Unit">Pass</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, event: org.jboss.netty.channel.MessageEvent)Unit" id="81268">messageReceived</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="81383">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="org.jboss.netty.channel.MessageEvent" id="81384">event</a>: <span title="org.jboss.netty.channel.MessageEvent">MessageEvent</span><span class="delimiter">)</span> =
    <a href="#81384" title="org.jboss.netty.channel.MessageEvent">event</a>.<span title="()java.lang.Object">getMessage</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Unit" id="81387">http</a>: <span title="org.jboss.netty.handler.codec.http.HttpRequest">NHttpRequest</span> =&gt; <a href="#81270" title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, request: org.jboss.netty.handler.codec.http.HttpRequest, event: org.jboss.netty.channel.MessageEvent)Unit">upgrade</a><span class="delimiter">(</span><a href="#81383" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#81387" title="org.jboss.netty.handler.codec.http.HttpRequest">http</a>, <a href="#81384" title="org.jboss.netty.channel.MessageEvent">event</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <a href="#81267" title="(v1: org.jboss.netty.channel.ChannelHandlerContext, v2: org.jboss.netty.channel.MessageEvent)Unit">pass</a><span class="delimiter">(</span><a href="#81383" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#81384" title="org.jboss.netty.channel.MessageEvent">event</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, event: org.jboss.netty.channel.ExceptionEvent)Unit" id="81269">exceptionCaught</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="81875">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="org.jboss.netty.channel.ExceptionEvent" id="81876">event</a>: <span title="org.jboss.netty.channel.ExceptionEvent">ExceptionEvent</span><span class="delimiter">)</span> =
    <a href="#81876" title="org.jboss.netty.channel.ExceptionEvent">event</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span>.<span title="()org.jboss.netty.channel.ChannelFuture">close</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, request: org.jboss.netty.handler.codec.http.HttpRequest, event: org.jboss.netty.channel.MessageEvent)Unit" id="81270">upgrade</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="81388">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="org.jboss.netty.handler.codec.http.HttpRequest" id="81389">request</a>: <span title="org.jboss.netty.handler.codec.http.HttpRequest">NHttpRequest</span>, <a title="org.jboss.netty.channel.MessageEvent" id="81390">event</a>: <span title="org.jboss.netty.channel.MessageEvent">MessageEvent</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="unfiltered.netty.ReceivedMessage" id="81393">msg</a> = <a href="../netty/bindings.scala.html#42892" title="(request: org.jboss.netty.handler.codec.http.HttpRequest, context: org.jboss.netty.channel.ChannelHandlerContext, event: org.jboss.netty.channel.MessageEvent)unfiltered.netty.ReceivedMessage">ReceivedMessage</a><span class="delimiter">(</span><a href="#81389" title="org.jboss.netty.handler.codec.http.HttpRequest">request</a>, <a href="#81388" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#81390" title="org.jboss.netty.channel.MessageEvent">event</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="unfiltered.netty.RequestBinding" id="81394">binding</a> = <span title="unfiltered.netty.RequestBinding" class="keyword">new</span> <a href="../netty/bindings.scala.html#9662" title="unfiltered.netty.RequestBinding">RequestBinding</a><span class="delimiter">(</span><a href="#81393" title="unfiltered.netty.ReceivedMessage">msg</a><span class="delimiter">)</span>
    <a href="#81394" title="unfiltered.netty.RequestBinding">binding</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="../unfiltered/request/methods.scala.html#37655" title="Unit">GET</a><span class="delimiter">(</span><a href="#81282" title="(req: unfiltered.request.HttpRequest[unfiltered.netty.ReceivedMessage])Option[String]">ConnectionUpgrade</a><span class="delimiter">(</span>_<span class="delimiter">)</span> <a href="../unfiltered/request/utils.scala.html#39131" title="(a: unfiltered.request.HttpRequest[unfiltered.netty.ReceivedMessage])Some[(unfiltered.request.HttpRequest[unfiltered.netty.ReceivedMessage], unfiltered.request.HttpRequest[unfiltered.netty.ReceivedMessage])]">&amp;</a> <a href="#81326" title="(req: unfiltered.request.HttpRequest[unfiltered.netty.ReceivedMessage])Option[unfiltered.request.HttpRequest[unfiltered.netty.ReceivedMessage]]">UpgradeWebsockets</a><span class="delimiter">(</span>_<span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
        <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#81266" title="=&gt; unfiltered.netty.websockets.Plan.Intent">intent</a>.<span title="(x: unfiltered.netty.RequestBinding)Boolean">isDefinedAt</span><span class="delimiter">(</span><a href="#81394" title="unfiltered.netty.RequestBinding">binding</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="unfiltered.netty.websockets.Plan.SocketIntent" id="81426">socketIntent</a> = <a href="#81266" title="(v1: unfiltered.netty.RequestBinding)unfiltered.netty.websockets.Plan.SocketIntent">intent</a><span class="delimiter">(</span><a href="#81394" title="unfiltered.netty.RequestBinding">binding</a><span class="delimiter">)</span>
          <span class="keyword">val</span> <a title="unfiltered.response.ResponseFunction[org.jboss.netty.handler.codec.http.DefaultHttpResponse] =&gt; org.jboss.netty.handler.codec.http.DefaultHttpResponse" id="81427">response</a> = <a href="#81393" title="unfiltered.netty.ReceivedMessage">msg</a>.<a href="../netty/bindings.scala.html#38198" title="(res: org.jboss.netty.handler.codec.http.DefaultHttpResponse)(rf: unfiltered.response.ResponseFunction[org.jboss.netty.handler.codec.http.DefaultHttpResponse])org.jboss.netty.handler.codec.http.DefaultHttpResponse">response</a><a href="#81442" title="unfiltered.response.ResponseFunction[org.jboss.netty.handler.codec.http.DefaultHttpResponse]" class="delimiter">(</a><a href="#81440" title="org.jboss.netty.handler.codec.http.DefaultHttpResponse" class="keyword">new</a> <span title="org.jboss.netty.handler.codec.http.DefaultHttpResponse">DefaultHttpResponse</span><span class="delimiter">(</span><span title="object org.jboss.netty.handler.codec.http.HttpVersion">HttpVersion</span>.<span title="org.jboss.netty.handler.codec.http.HttpVersion">HTTP_1_1</span>,
                                                              <span title="org.jboss.netty.handler.codec.http.HttpResponseStatus" class="keyword">new</span> <span title="org.jboss.netty.handler.codec.http.HttpResponseStatus">HttpResponseStatus</span><span class="delimiter">(</span><span title="Int(101)" class="int">101</span>, <span title="java.lang.String(&quot;Web Socket Protocol Handshake&quot;)" class="string">&quot;Web Socket Protocol Handshake&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>_
          <span class="keyword">def</span> <a title="=&gt; PartialFunction[unfiltered.netty.websockets.SocketCallback,Unit]" id="81428">attempt</a> = <a href="#81426" title="unfiltered.netty.websockets.Plan.SocketIntent">socketIntent</a>.<span title="(that: PartialFunction[unfiltered.netty.websockets.SocketCallback,Unit])PartialFunction[unfiltered.netty.websockets.SocketCallback,Unit]">orElse</span><span class="delimiter">(</span><a href="#81452" title="Unit" class="delimiter">{</a> <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">}</span>: Plan.<span title="unfiltered.netty.websockets.Plan.SocketIntent">SocketIntent</span><span class="delimiter">)</span>

          <span class="keyword">val</span> <a title="Protocol extends java.lang.Object with unfiltered.response.Responder[org.jboss.netty.handler.codec.http.HttpResponse]" id="81429">Protocol</a> = <a href="#81454" title="java.lang.Object with unfiltered.response.Responder[org.jboss.netty.handler.codec.http.HttpResponse]" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with unfiltered.response.Responder[org.jboss.netty.handler.codec.http.HttpResponse]" id="81454">Responder</a><span class="delimiter">[</span>NHttpResponse<span class="delimiter">]</span> <span class="delimiter">{</span>
            <span class="keyword">def</span> <a title="(res: unfiltered.response.HttpResponse[org.jboss.netty.handler.codec.http.HttpResponse])Unit" id="81456">respond</a><span class="delimiter">(</span><a title="unfiltered.response.HttpResponse[org.jboss.netty.handler.codec.http.HttpResponse]" id="81457">res</a>: <a href="../unfiltered/response/HttpResponse.scala.html#10131" title="unfiltered.response.HttpResponse[org.jboss.netty.handler.codec.http.HttpResponse]">HttpResponse</a><span class="delimiter">[</span>NHttpResponse<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="../unfiltered/request/headers.scala.html#12805" title="(req: unfiltered.request.HttpRequest[unfiltered.netty.ReceivedMessage])Option[String]">ProtocolRequestHeader</a><span class="delimiter">(</span><a href="#81394" title="unfiltered.netty.RequestBinding">binding</a><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="String" id="81466">protocol</a><span class="delimiter">)</span> =&gt;
                  <a href="#81457" title="unfiltered.response.HttpResponse[org.jboss.netty.handler.codec.http.HttpResponse]">res</a>.<a href="../unfiltered/response/HttpResponse.scala.html#25712" title="(name: String, value: String)Unit">header</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Sec-WebSocket-Protocol&quot;)">SEC_WEBSOCKET_PROTOCOL</span>, <a href="#81466" title="String">protocol</a><span class="delimiter">)</span>
                <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>

          <span class="keyword">val</span> <a title="HandShake extends java.lang.Object with unfiltered.response.Responder[org.jboss.netty.handler.codec.http.HttpResponse]" id="81430">HandShake</a> = <a href="#81477" title="java.lang.Object with unfiltered.response.Responder[org.jboss.netty.handler.codec.http.HttpResponse]" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with unfiltered.response.Responder[org.jboss.netty.handler.codec.http.HttpResponse]" id="81477">Responder</a><span class="delimiter">[</span>NHttpResponse<span class="delimiter">]</span> <span class="delimiter">{</span>
            <span class="keyword">def</span> <a title="(res: unfiltered.response.HttpResponse[org.jboss.netty.handler.codec.http.HttpResponse])Unit" id="81479">respond</a><span class="delimiter">(</span><a title="unfiltered.response.HttpResponse[org.jboss.netty.handler.codec.http.HttpResponse]" id="81480">res</a>: <a href="../unfiltered/response/HttpResponse.scala.html#10131" title="unfiltered.response.HttpResponse[org.jboss.netty.handler.codec.http.HttpResponse]">HttpResponse</a><span class="delimiter">[</span>NHttpResponse<span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span title="(_1: Option[String], _2: Option[String])(Option[String], Option[String])" class="delimiter">(</span><a href="../unfiltered/request/headers.scala.html#12805" title="(req: unfiltered.request.HttpRequest[unfiltered.netty.ReceivedMessage])Option[String]">SecKeyOne</a><span class="delimiter">(</span><a href="#81394" title="unfiltered.netty.RequestBinding">binding</a><span class="delimiter">)</span>, <a href="../unfiltered/request/headers.scala.html#12805" title="(req: unfiltered.request.HttpRequest[unfiltered.netty.ReceivedMessage])Option[String]">SecKeyTwo</a><span class="delimiter">(</span><a href="#81394" title="unfiltered.netty.RequestBinding">binding</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
                <span class="keyword">case</span> <span title="Unit" class="delimiter">(</span>Some<span class="delimiter">(</span><a title="String" id="81500">k1</a><span class="delimiter">)</span>, Some<span class="delimiter">(</span><a title="String" id="81502">k2</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
                  <span class="keyword">val</span> <a title="org.jboss.netty.buffer.ChannelBuffer" id="81503">buff</a> = <span title="object org.jboss.netty.buffer.ChannelBuffers">ChannelBuffers</span>.<span title="(x$1: Int)org.jboss.netty.buffer.ChannelBuffer">buffer</span><span class="delimiter">(</span><span title="Int(16)" class="int">16</span><span class="delimiter">)</span>
                  <span class="delimiter">(</span><a href="#81500" title="String">k1</a> <a href="#81506" title="(x: String)List[String]">::</a> <a href="#81502" title="String">k2</a> <a href="#81507" title="(x: String)List[String]">::</a> <span title="object Nil">Nil</span><span class="delimiter">)</span>.<span title="(f: String =&gt; Unit)Unit">foreach</span><span class="delimiter">(</span> <a title="String" id="81551">k</a> =&gt;
                    <a href="#81503" title="org.jboss.netty.buffer.ChannelBuffer">buff</a>.<span title="(x$1: Int)Unit">writeInt</span><span class="delimiter">(</span><span class="delimiter">(</span><a href="#81551" title="String">k</a>.<span title="(x$1: java.lang.String, x$2: java.lang.String)java.lang.String">replaceAll</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="delimiter">(</span><span title="java.lang.String(&quot;[^0-9]&quot;)" class="string">&quot;[^0-9]&quot;</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>.<span title="=&gt; Long">toLong</span> <span title="(x: Int)Long">/</span> <a href="#81551" title="String">k</a>.<span title="(x$1: java.lang.String, x$2: java.lang.String)java.lang.String">replaceAll</span><span class="delimiter">(</span><span title="java.lang.String(&quot;[^ ]&quot;)" class="string">&quot;[^ ]&quot;</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>.<span title="()Int">length</span><span class="delimiter">)</span>.<span title="=&gt; Int">toInt</span><span class="delimiter">)</span>
                  <span class="delimiter">)</span>
                  <a href="#81503" title="org.jboss.netty.buffer.ChannelBuffer">buff</a>.<span title="(x$1: Long)Unit">writeLong</span><span class="delimiter">(</span><a href="#81389" title="org.jboss.netty.handler.codec.http.HttpRequest">request</a>.<span title="()org.jboss.netty.buffer.ChannelBuffer">getContent</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()Long">readLong</span><span class="delimiter">)</span>
                  <a href="#81480" title="unfiltered.response.HttpResponse[org.jboss.netty.handler.codec.http.HttpResponse]">res</a>.<a href="../unfiltered/response/HttpResponse.scala.html#25701" title="=&gt; org.jboss.netty.handler.codec.http.HttpResponse">underlying</a>.<span title="(x$1: org.jboss.netty.buffer.ChannelBuffer)Unit">setContent</span><span class="delimiter">(</span><span title="object org.jboss.netty.buffer.ChannelBuffers">ChannelBuffers</span>.<span title="(x$1: Array[Byte])org.jboss.netty.buffer.ChannelBuffer">wrappedBuffer</span><span class="delimiter">(</span>
                    <span title="object java.security.MessageDigest">MessageDigest</span>.<span title="(x$1: java.lang.String)java.security.MessageDigest">getInstance</span><span class="delimiter">(</span><span title="java.lang.String(&quot;MD5&quot;)" class="string">&quot;MD5&quot;</span><span class="delimiter">)</span>.<span title="(x$1: Array[Byte])Array[Byte]">digest</span><span class="delimiter">(</span><a href="#81503" title="org.jboss.netty.buffer.ChannelBuffer">buff</a>.<span title="()Array[Byte]">array</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
                <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
              <span class="delimiter">}</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span>

          <span class="keyword">val</span> <a title="org.jboss.netty.channel.ChannelPipeline" id="81431">pipe</a> = <a href="#81388" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span>.<span title="()org.jboss.netty.channel.ChannelPipeline">getPipeline</span>
          <span title="Any" class="keyword">if</span><span class="delimiter">(</span><a href="#81431" title="org.jboss.netty.channel.ChannelPipeline">pipe</a>.<span title="(x$1: java.lang.String)org.jboss.netty.channel.ChannelHandler">get</span><span class="delimiter">(</span><span title="java.lang.String(&quot;aggregator&quot;)" class="string">&quot;aggregator&quot;</span><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">!=</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#81431" title="org.jboss.netty.channel.ChannelPipeline">pipe</a>.<span title="(x$1: java.lang.String)org.jboss.netty.channel.ChannelHandler">remove</span><span class="delimiter">(</span><span title="java.lang.String(&quot;aggregator&quot;)" class="string">&quot;aggregator&quot;</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
          <a href="#81431" title="org.jboss.netty.channel.ChannelPipeline">pipe</a>.<span title="(x$1: java.lang.String, x$2: java.lang.String, x$3: org.jboss.netty.channel.ChannelHandler)org.jboss.netty.channel.ChannelHandler">replace</span><span class="delimiter">(</span><span title="java.lang.String(&quot;decoder&quot;)" class="string">&quot;decoder&quot;</span>, <span title="java.lang.String(&quot;wsdecoder&quot;)" class="string">&quot;wsdecoder&quot;</span>, <span title="org.jboss.netty.handler.codec.http.websocket.WebSocketFrameDecoder" class="keyword">new</span> <span title="org.jboss.netty.handler.codec.http.websocket.WebSocketFrameDecoder">WebSocketFrameDecoder</span><span class="delimiter">)</span>

          <a href="#81388" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span>.<span title="(x$1: Any)org.jboss.netty.channel.ChannelFuture">write</span><span class="delimiter">(</span>
            <a href="#81427" title="(v1: unfiltered.response.ResponseFunction[org.jboss.netty.handler.codec.http.DefaultHttpResponse])org.jboss.netty.handler.codec.http.DefaultHttpResponse">response</a><span class="delimiter">(</span>
              <a href="../unfiltered/response/headers.scala.html#38523" title="(value: String*)unfiltered.response.ResponseHeader" class="keyword">new</a> <a href="../unfiltered/response/headers.scala.html#10174" title="unfiltered.response.HeaderName">HeaderName</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Upgrade&quot;)">UPGRADE</span><span class="delimiter">)</span><span class="delimiter">(</span>Values.<span title="java.lang.String(&quot;WebSocket&quot;)">WEBSOCKET</span><span class="delimiter">)</span> <a href="../unfiltered/response/functions.scala.html#26072" title="(that: unfiltered.response.ResponseFunction[Any])java.lang.Object with unfiltered.response.ResponseFunction[Any]">~&gt;</a>
              <a href="../unfiltered/response/headers.scala.html#38523" title="(value: String*)unfiltered.response.ResponseHeader" class="keyword">new</a> <a href="../unfiltered/response/headers.scala.html#10174" title="unfiltered.response.HeaderName">HeaderName</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Connection&quot;)">CONNECTION</span><span class="delimiter">)</span><span class="delimiter">(</span>Values.<span title="java.lang.String(&quot;Upgrade&quot;)">UPGRADE</span><span class="delimiter">)</span> <a href="../unfiltered/response/functions.scala.html#26072" title="(that: unfiltered.response.ResponseFunction[Any])java.lang.Object with unfiltered.response.ResponseFunction[Any]">~&gt;</a>
              <a href="../unfiltered/response/headers.scala.html#38523" title="(value: String*)unfiltered.response.ResponseHeader" class="keyword">new</a> <a href="../unfiltered/response/headers.scala.html#10174" title="unfiltered.response.HeaderName">HeaderName</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Sec-WebSocket-Origin&quot;)">SEC_WEBSOCKET_ORIGIN</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="../unfiltered/request/headers.scala.html#12805" title="(req: unfiltered.request.HttpRequest[unfiltered.netty.ReceivedMessage])Option[String]">OriginRequestHeader</a><span class="delimiter">(</span><a href="#81394" title="unfiltered.netty.RequestBinding">binding</a><span class="delimiter">)</span>.<span title="=&gt; String">get</span><span class="delimiter">)</span> <a href="../unfiltered/response/functions.scala.html#26072" title="(that: unfiltered.response.ResponseFunction[Any])java.lang.Object with unfiltered.response.ResponseFunction[Any]">~&gt;</a>
              <a href="../unfiltered/response/headers.scala.html#38523" title="(value: String*)unfiltered.response.ResponseHeader" class="keyword">new</a> <a href="../unfiltered/response/headers.scala.html#10174" title="unfiltered.response.HeaderName">HeaderName</a><span class="delimiter">(</span><span title="java.lang.String(&quot;Sec-WebSocket-Location&quot;)">SEC_WEBSOCKET_LOCATION</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#81350" title="(r: unfiltered.request.HttpRequest[unfiltered.netty.ReceivedMessage])String">WSLocation</a><span class="delimiter">(</span><a href="#81394" title="unfiltered.netty.RequestBinding">binding</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="../unfiltered/response/functions.scala.html#26072" title="(that: unfiltered.response.ResponseFunction[org.jboss.netty.handler.codec.http.HttpResponse])java.lang.Object with unfiltered.response.ResponseFunction[org.jboss.netty.handler.codec.http.HttpResponse]">~&gt;</a>
              <a href="#81429" title="Protocol extends java.lang.Object with unfiltered.response.Responder[org.jboss.netty.handler.codec.http.HttpResponse]">Protocol</a> <a href="../unfiltered/response/functions.scala.html#26072" title="(that: unfiltered.response.ResponseFunction[org.jboss.netty.handler.codec.http.HttpResponse])java.lang.Object with unfiltered.response.ResponseFunction[org.jboss.netty.handler.codec.http.HttpResponse]">~&gt;</a> <a href="#81430" title="HandShake extends java.lang.Object with unfiltered.response.Responder[org.jboss.netty.handler.codec.http.HttpResponse]">HandShake</a><span class="delimiter">)</span>
          <span class="delimiter">)</span>
          <a href="#81388" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span>.<span title="()org.jboss.netty.channel.ChannelFuture">getCloseFuture</span>.<span title="(x$1: org.jboss.netty.channel.ChannelFutureListener)Unit">addListener</span><span class="delimiter">(</span><a href="#81764" title="java.lang.Object with org.jboss.netty.channel.ChannelFutureListener" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with org.jboss.netty.channel.ChannelFutureListener" id="81764">ChannelFutureListener</a> <span class="delimiter">{</span>
            <span class="keyword">def</span> <a title="(future: org.jboss.netty.channel.ChannelFuture)Unit" id="81768">operationComplete</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelFuture" id="81769">future</a>: <span title="org.jboss.netty.channel.ChannelFuture">ChannelFuture</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
              <a href="#81428" title="(v1: unfiltered.netty.websockets.SocketCallback)Unit">attempt</a><span class="delimiter">(</span><a href="websockets.scala.html#81775" title="(socket: unfiltered.netty.websockets.WebSocket)unfiltered.netty.websockets.Close">Close</a><span class="delimiter">(</span><a href="websockets.scala.html#81788" title="(channel: org.jboss.netty.channel.Channel)unfiltered.netty.websockets.WebSocket">WebSocket</a><span class="delimiter">(</span><a href="#81388" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span><span class="delimiter">)</span>
          <a href="#81431" title="org.jboss.netty.channel.ChannelPipeline">pipe</a>.<span title="(x$1: java.lang.String, x$2: java.lang.String, x$3: org.jboss.netty.channel.ChannelHandler)org.jboss.netty.channel.ChannelHandler">replace</span><span class="delimiter">(</span><span title="java.lang.String(&quot;encoder&quot;)" class="string">&quot;encoder&quot;</span>, <span title="java.lang.String(&quot;wsencoder&quot;)" class="string">&quot;wsencoder&quot;</span>, <span title="org.jboss.netty.handler.codec.http.websocket.WebSocketFrameEncoder" class="keyword">new</span> <span title="org.jboss.netty.handler.codec.http.websocket.WebSocketFrameEncoder">WebSocketFrameEncoder</span><span class="delimiter">)</span>
          <a href="#81428" title="(v1: unfiltered.netty.websockets.SocketCallback)Unit">attempt</a><span class="delimiter">(</span><a href="websockets.scala.html#81824" title="(socket: unfiltered.netty.websockets.WebSocket)unfiltered.netty.websockets.Open">Open</a><span class="delimiter">(</span><a href="websockets.scala.html#81788" title="(channel: org.jboss.netty.channel.Channel)unfiltered.netty.websockets.WebSocket">WebSocket</a><span class="delimiter">(</span><a href="#81388" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <a href="#81431" title="org.jboss.netty.channel.ChannelPipeline">pipe</a>.<span title="(x$1: org.jboss.netty.channel.ChannelHandler, x$2: java.lang.String, x$3: org.jboss.netty.channel.ChannelHandler)Unit">replace</span><span class="delimiter">(</span><a href="#10479" title="unfiltered.netty.websockets.Plan" class="keyword">this</a>, <a href="#81388" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()java.lang.String">getName</span>, <a href="#82121" title="(intent: unfiltered.netty.websockets.Plan.SocketIntent, pass: (org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.MessageEvent) =&gt; Unit)unfiltered.netty.websockets.SocketPlan">SocketPlan</a><span class="delimiter">(</span><a href="#81426" title="unfiltered.netty.websockets.Plan.SocketIntent">socketIntent</a>, <a href="#81267" title="=&gt; (org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.MessageEvent) =&gt; Unit">pass</a><span class="delimiter">)</span><span class="delimiter">)</span>

        <span class="delimiter">}</span> <span class="keyword">else</span> <a href="#81267" title="(v1: org.jboss.netty.channel.ChannelHandlerContext, v2: org.jboss.netty.channel.MessageEvent)Unit">pass</a><span class="delimiter">(</span><a href="#81388" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#81390" title="org.jboss.netty.channel.MessageEvent">event</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">_</span> =&gt;  <a href="#81267" title="(v1: org.jboss.netty.channel.ChannelHandlerContext, v2: org.jboss.netty.channel.MessageEvent)Unit">pass</a><span class="delimiter">(</span><a href="#81388" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#81390" title="org.jboss.netty.channel.MessageEvent">event</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/** By default, when a websocket handler `passes` it writes an Http Forbidden response
   *  to the channel. To override that behavior, call this method with a function to handle
   *  the MessageEvent with custom behavior */</span>
  <span class="keyword">def</span> <a title="(handler: (org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.MessageEvent) =&gt; Unit)unfiltered.netty.websockets.Planify" id="81271">onPass</a><span class="delimiter">(</span><a title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.MessageEvent) =&gt; Unit" id="81879">handler</a>: Plan.<span title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.MessageEvent) =&gt; Unit">Pass</span><span class="delimiter">)</span> = <a href="#81890" title="(intent: unfiltered.netty.websockets.Plan.Intent, pass: (org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.MessageEvent) =&gt; Unit)unfiltered.netty.websockets.Planify">Planify</a><span class="delimiter">(</span><a href="#81266" title="=&gt; unfiltered.netty.websockets.Plan.Intent">intent</a>, <a href="#81879" title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.MessageEvent) =&gt; Unit">handler</a><span class="delimiter">)</span>

<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class Planify extends org.jboss.netty.channel.SimpleChannelUpstreamHandler with unfiltered.netty.websockets.Plan with ScalaObject" id="10480">Planify</a><a href="#10480" title="ScalaObject" class="delimiter">(</a><span class="keyword">val</span> <a title="unfiltered.netty.websockets.Plan.Intent" id="81907">intent</a>: Plan.<span title="unfiltered.netty.websockets.Plan.Intent">Intent</span>, <span class="keyword">val</span> <a title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.MessageEvent) =&gt; Unit" id="81908">pass</a>: Plan.<span title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.MessageEvent) =&gt; Unit">Pass</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#10479" title="unfiltered.netty.websockets.Plan">Plan</a>

<span class="keyword">object</span> <a title="object unfiltered.netty.websockets.Planify" id="10481">Planify</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">import</span> jnetty.channel.ChannelFutureListener
  <span class="keyword">import</span> jnetty.buffer.ChannelBuffers
  <span class="keyword">import</span> jnetty.handler.codec.http.<span class="delimiter">{</span>HttpRequest =&gt; NHttpRequest, DefaultHttpResponse<span class="delimiter">}</span>
  <span class="keyword">import</span> jnetty.handler.codec.http.<span title="object org.jboss.netty.handler.codec.http.HttpVersion">HttpVersion</span>.HTTP_1_1
  <span class="keyword">import</span> jnetty.handler.codec.http.<span title="object org.jboss.netty.handler.codec.http.HttpResponseStatus">HttpResponseStatus</span>.FORBIDDEN
  <span class="keyword">import</span> jnetty.handler.codec.http.<span title="object org.jboss.netty.handler.codec.http.HttpHeaders">HttpHeaders</span>._
  <span class="keyword">import</span> jnetty.util.CharsetUtil

  <span class="keyword">def</span> <a title="(intent: unfiltered.netty.websockets.Plan.Intent, pass: (org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.MessageEvent) =&gt; Unit)unfiltered.netty.websockets.Planify" id="81890">apply</a><span class="delimiter">(</span><a title="unfiltered.netty.websockets.Plan.Intent" id="81896">intent</a>: Plan.<span title="unfiltered.netty.websockets.Plan.Intent">Intent</span>, <a title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.MessageEvent) =&gt; Unit" id="81897">pass</a>: Plan.<span title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.MessageEvent) =&gt; Unit">Pass</span><span class="delimiter">)</span> = <span title="unfiltered.netty.websockets.Planify" class="keyword">new</span> <a href="#10480" title="unfiltered.netty.websockets.Planify">Planify</a><span class="delimiter">(</span><a href="#81896" title="unfiltered.netty.websockets.Plan.Intent">intent</a>, <a href="#81897" title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.MessageEvent) =&gt; Unit">pass</a><span class="delimiter">)</span>

  <span class="comment">/** Creates a WebSocketHandler that, when passes, will return a forbidden
   *  response to the client */</span>
  <span class="keyword">def</span> <a title="(intent: unfiltered.netty.websockets.Plan.Intent)unfiltered.netty.websockets.Plan" id="81891">apply</a><span class="delimiter">(</span><a title="unfiltered.netty.websockets.Plan.Intent" id="81894">intent</a>: Plan.<span title="unfiltered.netty.websockets.Plan.Intent">Intent</span><span class="delimiter">)</span>: <a href="#10479" title="unfiltered.netty.websockets.Plan">Plan</a> =
    <a href="#81890" title="(intent: unfiltered.netty.websockets.Plan.Intent, pass: (org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.MessageEvent) =&gt; Unit)unfiltered.netty.websockets.Planify">Planify</a><span class="delimiter">(</span><a href="#81894" title="unfiltered.netty.websockets.Plan.Intent">intent</a>, <span class="delimiter">{</span> <span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="81925">ctx</a>, <a title="org.jboss.netty.channel.MessageEvent" id="81926">event</a><span class="delimiter">)</span> =&gt;
      <a href="#81926" title="org.jboss.netty.channel.MessageEvent">event</a>.<span title="()java.lang.Object">getMessage</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <a title="Unit" id="81927">request</a>: <span title="org.jboss.netty.handler.codec.http.HttpRequest">NHttpRequest</span> =&gt;
          <span class="keyword">val</span> <a title="org.jboss.netty.handler.codec.http.DefaultHttpResponse" id="81928">res</a> = <span title="org.jboss.netty.handler.codec.http.DefaultHttpResponse" class="keyword">new</span> <span title="org.jboss.netty.handler.codec.http.DefaultHttpResponse">DefaultHttpResponse</span><span class="delimiter">(</span><span title="org.jboss.netty.handler.codec.http.HttpVersion">HTTP_1_1</span>, <span title="org.jboss.netty.handler.codec.http.HttpResponseStatus">FORBIDDEN</span><span class="delimiter">)</span>
          <a href="#81928" title="org.jboss.netty.handler.codec.http.DefaultHttpResponse">res</a>.<span title="(x$1: org.jboss.netty.buffer.ChannelBuffer)Unit">setContent</span><span class="delimiter">(</span><span title="object org.jboss.netty.buffer.ChannelBuffers">ChannelBuffers</span>.<span title="(x$1: java.lang.CharSequence, x$2: java.nio.charset.Charset)org.jboss.netty.buffer.ChannelBuffer">copiedBuffer</span><span class="delimiter">(</span><a href="#81928" title="org.jboss.netty.handler.codec.http.DefaultHttpResponse">res</a>.<span title="()org.jboss.netty.handler.codec.http.HttpResponseStatus">getStatus</span>.<span title="()java.lang.String">toString</span>, <span title="object org.jboss.netty.util.CharsetUtil">CharsetUtil</span>.<span title="java.nio.charset.Charset">UTF_8</span><span class="delimiter">)</span><span class="delimiter">)</span>
          <span title="(x$1: org.jboss.netty.handler.codec.http.HttpMessage, x$2: Long)Unit">setContentLength</span><span class="delimiter">(</span><a href="#81928" title="org.jboss.netty.handler.codec.http.DefaultHttpResponse">res</a>, <a href="#81928" title="org.jboss.netty.handler.codec.http.DefaultHttpResponse">res</a>.<span title="()org.jboss.netty.buffer.ChannelBuffer">getContent</span>.<span title="=&gt; Long">readableBytes</span><span class="delimiter">)</span>
          <a href="#81925" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span>.<span title="(x$1: Any)org.jboss.netty.channel.ChannelFuture">write</span><span class="delimiter">(</span><a href="#81928" title="org.jboss.netty.handler.codec.http.DefaultHttpResponse">res</a><span class="delimiter">)</span>.<span title="(x$1: org.jboss.netty.channel.ChannelFutureListener)Unit">addListener</span><span class="delimiter">(</span><span title="object org.jboss.netty.channel.ChannelFutureListener">ChannelFutureListener</span>.<span title="org.jboss.netty.channel.ChannelFutureListener">CLOSE</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <a title="Nothing" id="81947">msg</a> =&gt;
          <span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;Invalid type of event message (%s) for Plan pass handling&quot;</span> <span title="(args: Any*)String">format</span> <a href="#81947" title="java.lang.Object">msg</a>.<span title="()java.lang.Class[_]">getClass</span>.<span title="()java.lang.String">getName</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
   <span class="delimiter">}</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

case <span class="keyword">class</span> <a title="class SocketPlan extends org.jboss.netty.channel.SimpleChannelUpstreamHandler with ScalaObject with Product with Serializable" id="82121">SocketPlan</a><a href="#82121" title="ScalaObject" class="delimiter">(</a><a title="unfiltered.netty.websockets.Plan.SocketIntent" id="81862">intent</a>: Plan.<span title="unfiltered.netty.websockets.Plan.SocketIntent">SocketIntent</span>,
                      <a title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.MessageEvent) =&gt; Unit" id="81863">pass</a>: Plan.<span title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.MessageEvent) =&gt; Unit">Pass</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="org.jboss.netty.channel.SimpleChannelUpstreamHandler">SimpleChannelUpstreamHandler</span> <span class="delimiter">{</span>
  <span class="keyword">import</span> jnetty.channel.ExceptionEvent
  <span class="keyword">import</span> jnetty.handler.codec.http.websocket.<span class="delimiter">{</span>WebSocketFrame<span class="delimiter">}</span>

  <span class="comment">/** 0x00-0x7F typed frame becomes (UTF-8) Text
   0x80-0xFF typed frame becomes Binary */</span>
  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit unfiltered.netty.websockets.SocketPlan.wsf2msg : (wsf: org.jboss.netty.handler.codec.http.websocket.WebSocketFrame)unfiltered.netty.websockets.Msg" id="81856">wsf2msg</a><span class="delimiter">(</span><a title="org.jboss.netty.handler.codec.http.websocket.WebSocketFrame" id="81958">wsf</a>: <span title="org.jboss.netty.handler.codec.http.websocket.WebSocketFrame">WebSocketFrame</span><span class="delimiter">)</span>: <a href="websockets.scala.html#10512" title="unfiltered.netty.websockets.Msg">Msg</a> =
    <span title="unfiltered.netty.websockets.Msg" class="keyword">if</span><span class="delimiter">(</span><a href="#81958" title="org.jboss.netty.handler.codec.http.websocket.WebSocketFrame">wsf</a>.<span title="()Boolean">isText</span><span class="delimiter">)</span> <a href="websockets.scala.html#81973" title="(txt: String)unfiltered.netty.websockets.Text">Text</a><span class="delimiter">(</span><a href="#81958" title="org.jboss.netty.handler.codec.http.websocket.WebSocketFrame">wsf</a>.<span title="()java.lang.String">getTextData</span><span class="delimiter">)</span> <span class="keyword">else</span> <a href="websockets.scala.html#81986" title="(buf: org.jboss.netty.buffer.ChannelBuffer)unfiltered.netty.websockets.Binary">Binary</a><span class="delimiter">(</span><a href="#81958" title="org.jboss.netty.handler.codec.http.websocket.WebSocketFrame">wsf</a>.<span title="()org.jboss.netty.buffer.ChannelBuffer">getBinaryData</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="=&gt; PartialFunction[unfiltered.netty.websockets.SocketCallback,Unit]" id="81857">attempt</a> = <a href="#81862" title="=&gt; unfiltered.netty.websockets.Plan.SocketIntent">intent</a>.<span title="(that: PartialFunction[unfiltered.netty.websockets.SocketCallback,Unit])PartialFunction[unfiltered.netty.websockets.SocketCallback,Unit]">orElse</span><span class="delimiter">(</span><a href="#82007" title="Unit" class="delimiter">{</a> <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">}</span>: Plan.<span title="unfiltered.netty.websockets.Plan.SocketIntent">SocketIntent</span><span class="delimiter">)</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, event: org.jboss.netty.channel.MessageEvent)Unit" id="81858">messageReceived</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="82009">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="org.jboss.netty.channel.MessageEvent" id="82010">event</a>: <span title="org.jboss.netty.channel.MessageEvent">MessageEvent</span><span class="delimiter">)</span> =
    <a href="#82010" title="org.jboss.netty.channel.MessageEvent">event</a>.<span title="()java.lang.Object">getMessage</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Unit" id="82013">f</a>: <span title="org.jboss.netty.handler.codec.http.websocket.WebSocketFrame">WebSocketFrame</span> =&gt; <a href="#82013" title="org.jboss.netty.handler.codec.http.websocket.WebSocketFrame">f</a>.<span title="()Int">getType</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Unit" class="int">0xFF</span> =&gt; <a href="#82009" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span>.<span title="()org.jboss.netty.channel.ChannelFuture">close</span>
        <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <a href="#81857" title="(v1: unfiltered.netty.websockets.SocketCallback)Unit">attempt</a><span class="delimiter">(</span><a href="websockets.scala.html#82017" title="(socket: unfiltered.netty.websockets.WebSocket, msg: unfiltered.netty.websockets.Msg)unfiltered.netty.websockets.Message">Message</a><span class="delimiter">(</span><a href="websockets.scala.html#81788" title="(channel: org.jboss.netty.channel.Channel)unfiltered.netty.websockets.WebSocket">WebSocket</a><span class="delimiter">(</span><a href="#82009" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span><span class="delimiter">)</span>, <a href="#81856" title="implicit unfiltered.netty.websockets.SocketPlan.wsf2msg : (wsf: org.jboss.netty.handler.codec.http.websocket.WebSocketFrame)unfiltered.netty.websockets.Msg">f</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <a href="#81863" title="(v1: org.jboss.netty.channel.ChannelHandlerContext, v2: org.jboss.netty.channel.MessageEvent)Unit">pass</a><span class="delimiter">(</span><a href="#82009" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#82010" title="org.jboss.netty.channel.MessageEvent">event</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, event: org.jboss.netty.channel.ExceptionEvent)Unit" id="81859">exceptionCaught</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="82037">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="org.jboss.netty.channel.ExceptionEvent" id="82038">event</a>: <span title="org.jboss.netty.channel.ExceptionEvent">ExceptionEvent</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#81857" title="(v1: unfiltered.netty.websockets.SocketCallback)Unit">attempt</a><span class="delimiter">(</span><a href="websockets.scala.html#82044" title="(socket: unfiltered.netty.websockets.WebSocket, err: Throwable)unfiltered.netty.websockets.Error">Error</a><span class="delimiter">(</span><a href="websockets.scala.html#81788" title="(channel: org.jboss.netty.channel.Channel)unfiltered.netty.websockets.WebSocket">WebSocket</a><span class="delimiter">(</span><a href="#82037" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span><span class="delimiter">)</span>, <a href="#82038" title="org.jboss.netty.channel.ExceptionEvent">event</a>.<span title="()java.lang.Throwable">getCause</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="#82038" title="org.jboss.netty.channel.ExceptionEvent">event</a>.<span title="()org.jboss.netty.channel.Channel">getChannel</span>.<span title="()org.jboss.netty.channel.ChannelFuture">close</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
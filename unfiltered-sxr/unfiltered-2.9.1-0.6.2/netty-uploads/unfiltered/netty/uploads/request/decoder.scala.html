<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>netty-uploads/unfiltered/netty/uploads/request/decoder.scala</title>
        <script type="text/javascript" src="../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> unfiltered.netty.request

<span class="keyword">import</span> unfiltered.netty.ReceivedMessage
<span class="keyword">import</span> unfiltered.netty.RequestBinding
<span class="keyword">import</span> unfiltered.netty.ExceptionHandler
<span class="keyword">import</span> unfiltered.request.<span class="delimiter">{</span>POST, HttpRequest<span class="delimiter">}</span>
<span class="keyword">import</span> unfiltered.response.<span class="delimiter">{</span>ResponseFunction, Pass =&gt; UPass<span class="delimiter">}</span>

<span class="keyword">import</span> org.jboss.<span class="delimiter">{</span>netty =&gt; jnetty<span class="delimiter">}</span>
<span class="keyword">import</span> jnetty.handler.codec.http.<span class="delimiter">{</span>HttpRequest =&gt; NHttpRequest,
                                  HttpChunk =&gt; NHttpChunk,
                                  HttpResponse=&gt;NHttpResponse,
                                  HttpMessage =&gt; NHttpMessage<span class="delimiter">}</span>

<span class="keyword">import</span> jnetty.handler.codec.http.<span class="delimiter">{</span>HttpPostRequestDecoder =&gt; IOHttpPostRequestDecoder<span class="delimiter">}</span>
<span class="keyword">import</span> jnetty.handler.codec.http.<span class="delimiter">{</span>DefaultHttpDataFactory =&gt; IODefaultHttpDataFactory<span class="delimiter">}</span>
<span class="keyword">import</span> jnetty.handler.codec.http.<span class="delimiter">{</span>InterfaceHttpData =&gt; IOInterfaceHttpData<span class="delimiter">}</span>
<span class="keyword">import</span> jnetty.handler.codec.http.<span class="delimiter">{</span>Attribute =&gt; IOAttribute<span class="delimiter">}</span>
<span class="keyword">import</span> jnetty.handler.codec.http.<span class="delimiter">{</span>FileUpload =&gt; IOFileUpload<span class="delimiter">}</span>
<span class="keyword">import</span> jnetty.handler.codec.http.<a href="../org/jboss/netty/handler/codec/http/HttpPostRequestDecoder.java.html#11846" title="object org.jboss.netty.handler.codec.http.HttpPostRequestDecoder">HttpPostRequestDecoder</a>.<span class="delimiter">{</span>NotEnoughDataDecoderException =&gt; IONotEnoughDataDecoderException<span class="delimiter">}</span>

<span class="keyword">import</span> jnetty.channel._

<span class="comment">/** A PostDecoder wraps a HttpPostRequestDecoder. */</span>
<span class="keyword">class</span> <a title="class PostDecoder extends java.lang.Object with ScalaObject" id="12303">PostDecoder</a><a href="#12303" title="ScalaObject" class="delimiter">(</a><a title="org.jboss.netty.handler.codec.http.HttpRequest" id="49573">req</a>: <span title="org.jboss.netty.handler.codec.http.HttpRequest">NHttpRequest</span>, <a title="Boolean" id="49575">useDisk</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span> <span class="delimiter">{</span>

  <span class="keyword">import</span> scala.collection.<span title="object scala.collection.JavaConversions">JavaConversions</span>._

  <span class="comment">/** Build a post decoder and parse the request. This only works with POST requests. */</span>
  <span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="Option[org.jboss.netty.handler.codec.http.HttpPostRequestDecoder]" id="47295">decoder</a> = <span class="keyword">try</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="org.jboss.netty.handler.codec.http.DefaultHttpDataFactory" id="47305">factory</a> = <a href="../org/jboss/netty/handler/codec/http/DefaultHttpDataFactory.java.html#48251" title="(useDisk: Boolean)org.jboss.netty.handler.codec.http.DefaultHttpDataFactory" class="keyword">new</a> <a href="../org/jboss/netty/handler/codec/http/DefaultHttpDataFactory.java.html#11896" title="org.jboss.netty.handler.codec.http.DefaultHttpDataFactory">IODefaultHttpDataFactory</a><span class="delimiter">(</span><a href="#49575" title="Boolean">useDisk</a><span class="delimiter">)</span>
    <span title="(x: org.jboss.netty.handler.codec.http.HttpPostRequestDecoder)Some[org.jboss.netty.handler.codec.http.HttpPostRequestDecoder]">Some</span><span class="delimiter">(</span><a href="../org/jboss/netty/handler/codec/http/HttpPostRequestDecoder.java.html#48293" title="(factory: org.jboss.netty.handler.codec.http.HttpDataFactory, request: org.jboss.netty.handler.codec.http.HttpRequest)org.jboss.netty.handler.codec.http.HttpPostRequestDecoder" class="keyword">new</a> <a href="../org/jboss/netty/handler/codec/http/HttpPostRequestDecoder.java.html#11845" title="org.jboss.netty.handler.codec.http.HttpPostRequestDecoder">IOHttpPostRequestDecoder</a><span class="delimiter">(</span><a href="#47305" title="org.jboss.netty.handler.codec.http.DefaultHttpDataFactory">factory</a>, <a href="#49573" title="org.jboss.netty.handler.codec.http.HttpRequest">req</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
    <span class="comment">/** Would it be more useful to throw errors here? */</span>
    <span class="keyword">case</span> <a title="None.type" id="49275">e</a>: IOHttpPostRequestDecoder.<a href="../org/jboss/netty/handler/codec/http/HttpPostRequestDecoder.java.html#47252" title="org.jboss.netty.handler.codec.http.HttpPostRequestDecoder.ErrorDataDecoderException">ErrorDataDecoderException</a> =&gt; <span title="object None">None</span>
    <span class="comment">/** GET method. Can't create a decoder. */</span>
    <span class="keyword">case</span> <a title="None.type" id="49281">e</a>: IOHttpPostRequestDecoder.<a href="../org/jboss/netty/handler/codec/http/HttpPostRequestDecoder.java.html#47255" title="org.jboss.netty.handler.codec.http.HttpPostRequestDecoder.IncompatibleDataDecoderException">IncompatibleDataDecoderException</a> =&gt; <span title="object None">None</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Whether the request is multi-part */</span>
  <span class="keyword">def</span> <a title="=&gt; Boolean" id="47296">isMultipart</a>: <span title="Boolean">Boolean</span> = <a href="#47294" title="=&gt; Option[org.jboss.netty.handler.codec.http.HttpPostRequestDecoder]">decoder</a>.<span title="(f: org.jboss.netty.handler.codec.http.HttpPostRequestDecoder =&gt; Boolean)Option[Boolean]">map</span><span class="delimiter">(</span><a href="#49581" title="org.jboss.netty.handler.codec.http.HttpPostRequestDecoder">_</a>.<a href="../org/jboss/netty/handler/codec/http/HttpPostRequestDecoder.java.html#48296" title="()Boolean">isMultipart</a><span class="delimiter">)</span>.<span title="(default: =&gt; Boolean)Boolean">getOrElse</span><span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>

  <span class="comment">/** Returns a collection containing all the parts of the parsed request */</span>
  <span class="keyword">def</span> <a title="=&gt; List[org.jboss.netty.handler.codec.http.InterfaceHttpData]" id="47297">items</a>: <span title="List[org.jboss.netty.handler.codec.http.InterfaceHttpData]">List</span><span class="delimiter">[</span>IOInterfaceHttpData<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">try</span>
      <a href="#47294" title="=&gt; Option[org.jboss.netty.handler.codec.http.HttpPostRequestDecoder]">decoder</a>.<span title="(f: org.jboss.netty.handler.codec.http.HttpPostRequestDecoder =&gt; List[org.jboss.netty.handler.codec.http.InterfaceHttpData])Option[List[org.jboss.netty.handler.codec.http.InterfaceHttpData]]">map</span><span class="delimiter">(</span><a href="#49594" title="org.jboss.netty.handler.codec.http.HttpPostRequestDecoder">_</a>.<a href="../org/jboss/netty/handler/codec/http/HttpPostRequestDecoder.java.html#48297" title="(l: java.util.List[org.jboss.netty.handler.codec.http.InterfaceHttpData])scala.collection.mutable.Buffer[org.jboss.netty.handler.codec.http.InterfaceHttpData]">getBodyHttpDatas</a>.<span title="=&gt; List[org.jboss.netty.handler.codec.http.InterfaceHttpData]">toList</span><span class="delimiter">)</span>.<span title="(default: =&gt; List[org.jboss.netty.handler.codec.http.InterfaceHttpData])List[org.jboss.netty.handler.codec.http.InterfaceHttpData]">getOrElse</span><span class="delimiter">(</span>List<span title="object Nil" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Nothing" id="49912">e</a>: <a href="../org/jboss/netty/handler/codec/http/HttpPostRequestDecoder.java.html#47246" title="org.jboss.netty.handler.codec.http.HttpPostRequestDecoder.NotEnoughDataDecoderException">IONotEnoughDataDecoderException</a> =&gt; 
        <span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Tried to decode a multipart request before it was fully received. Make sure there is either a HttpChunkAggregator in the handler pipeline e.g. _.chunked() or use a MultiPartDecoder plan.&quot;)" class="string">&quot;Tried to decode a multipart request before it was fully received. Make sure there is either a HttpChunkAggregator in the handler pipeline e.g. _.chunked() or use a MultiPartDecoder plan.&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Returns a collection of uploaded files found in the parsed request */</span>
  <span class="keyword">def</span> <a title="=&gt; List[org.jboss.netty.handler.codec.http.FileUpload]" id="47298">fileUploads</a> = <a href="#47297" title="=&gt; List[org.jboss.netty.handler.codec.http.InterfaceHttpData]">items</a> <span title="(pf: PartialFunction[org.jboss.netty.handler.codec.http.InterfaceHttpData,org.jboss.netty.handler.codec.http.FileUpload])(implicit bf: scala.collection.generic.CanBuildFrom[List[org.jboss.netty.handler.codec.http.InterfaceHttpData],org.jboss.netty.handler.codec.http.FileUpload,List[org.jboss.netty.handler.codec.http.FileUpload]])List[org.jboss.netty.handler.codec.http.FileUpload]">collect</span> <a href="#49950" title="org.jboss.netty.handler.codec.http.FileUpload" class="delimiter">{</a> <span class="keyword">case</span> <a title="org.jboss.netty.handler.codec.http.FileUpload" id="49951">file</a>: <a href="../org/jboss/netty/handler/codec/http/FileUpload.java.html#11881" title="org.jboss.netty.handler.codec.http.FileUpload">IOFileUpload</a> =&gt; <a href="#49951" title="org.jboss.netty.handler.codec.http.FileUpload">file</a> <span class="delimiter">}</span>

  <span class="comment">/** Returns a collection of all the parts excluding file uploads from the parsed request */</span>
  <span class="keyword">def</span> <a title="=&gt; List[org.jboss.netty.handler.codec.http.Attribute]" id="47299">parameters</a> = <a href="#47297" title="=&gt; List[org.jboss.netty.handler.codec.http.InterfaceHttpData]">items</a> <span title="(pf: PartialFunction[org.jboss.netty.handler.codec.http.InterfaceHttpData,org.jboss.netty.handler.codec.http.Attribute])(implicit bf: scala.collection.generic.CanBuildFrom[List[org.jboss.netty.handler.codec.http.InterfaceHttpData],org.jboss.netty.handler.codec.http.Attribute,List[org.jboss.netty.handler.codec.http.Attribute]])List[org.jboss.netty.handler.codec.http.Attribute]">collect</span> <a href="#50028" title="org.jboss.netty.handler.codec.http.Attribute" class="delimiter">{</a> <span class="keyword">case</span> <a title="org.jboss.netty.handler.codec.http.Attribute" id="50029">param</a>: <a href="../org/jboss/netty/handler/codec/http/Attribute.java.html#11884" title="org.jboss.netty.handler.codec.http.Attribute">IOAttribute</a> =&gt; <a href="#50029" title="org.jboss.netty.handler.codec.http.Attribute">param</a> <span class="delimiter">}</span>

  <span class="comment">/** Add a received HttpChunk to the decoder */</span>
  <span class="keyword">def</span> <a title="(chunk: org.jboss.netty.handler.codec.http.HttpChunk)Option[Unit]" id="47300">offer</a><span class="delimiter">(</span><a title="org.jboss.netty.handler.codec.http.HttpChunk" id="47302">chunk</a>: <span title="org.jboss.netty.handler.codec.http.HttpChunk">NHttpChunk</span><span class="delimiter">)</span> = <a href="#47294" title="=&gt; Option[org.jboss.netty.handler.codec.http.HttpPostRequestDecoder]">decoder</a>.<span title="(f: org.jboss.netty.handler.codec.http.HttpPostRequestDecoder =&gt; Unit)Option[Unit]">map</span><span class="delimiter">(</span><a href="#49302" title="org.jboss.netty.handler.codec.http.HttpPostRequestDecoder">_</a>.<a href="../org/jboss/netty/handler/codec/http/HttpPostRequestDecoder.java.html#48300" title="(chunk: org.jboss.netty.handler.codec.http.HttpChunk)Unit">offer</a><span class="delimiter">(</span><a href="#47302" title="org.jboss.netty.handler.codec.http.HttpChunk">chunk</a><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="comment">/** Clean all HttpDatas (on Disk) for the current request */</span>
  <span class="keyword">def</span> <a title="=&gt; Option[Unit]" id="47301">cleanFiles</a> = <a href="#47294" title="=&gt; Option[org.jboss.netty.handler.codec.http.HttpPostRequestDecoder]">decoder</a>.<span title="(f: org.jboss.netty.handler.codec.http.HttpPostRequestDecoder =&gt; Unit)Option[Unit]">map</span><span class="delimiter">(</span><a href="#49344" title="org.jboss.netty.handler.codec.http.HttpPostRequestDecoder">_</a>.<a href="../org/jboss/netty/handler/codec/http/HttpPostRequestDecoder.java.html#48312" title="()Unit">cleanFiles</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object unfiltered.netty.request.PostDecoder" id="12304">PostDecoder</a><span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(req: org.jboss.netty.handler.codec.http.HttpRequest, useDisk: Boolean)Option[unfiltered.netty.request.PostDecoder]" id="47222">apply</a><span class="delimiter">(</span><a title="org.jboss.netty.handler.codec.http.HttpRequest" id="47223">req</a>: <span title="org.jboss.netty.handler.codec.http.HttpRequest">NHttpRequest</span>, <a title="Boolean" id="47226">useDisk</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>: <span title="Option[unfiltered.netty.request.PostDecoder]">Option</span><span class="delimiter">[</span>PostDecoder<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="unfiltered.netty.request.PostDecoder" id="50062">postDecoder</a> = <span title="unfiltered.netty.request.PostDecoder" class="keyword">new</span> <a href="#12303" title="unfiltered.netty.request.PostDecoder">PostDecoder</a><span class="delimiter">(</span><a href="#47223" title="org.jboss.netty.handler.codec.http.HttpRequest">req</a>, <a href="#47226" title="Boolean">useDisk</a><span class="delimiter">)</span>
    <a href="#50062" title="unfiltered.netty.request.PostDecoder">postDecoder</a>.<a href="#47294" title="=&gt; Option[org.jboss.netty.handler.codec.http.HttpPostRequestDecoder]">decoder</a> <span title="Option[unfiltered.netty.request.PostDecoder]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Some[unfiltered.netty.request.PostDecoder]">Some</span><span class="delimiter">(</span><a title="org.jboss.netty.handler.codec.http.HttpPostRequestDecoder" id="50064">dec</a><span class="delimiter">)</span> =&gt; <span title="(x: unfiltered.netty.request.PostDecoder)Some[unfiltered.netty.request.PostDecoder]">Some</span><span class="delimiter">(</span><a href="#50062" title="unfiltered.netty.request.PostDecoder">postDecoder</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="None.type">_</span> =&gt; <span title="object None">None</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/** Provides storage for state when attached to a ChannelHandlerContext */</span>
<span class="keyword">private</span> <span class="delimiter">[</span>netty<span class="delimiter">]</span> case <span class="keyword">class</span> <a title="class MultiPartChannelState extends java.lang.Object with ScalaObject with Product with Serializable" id="50155">MultiPartChannelState</a><a href="#50155" title="ScalaObject" class="delimiter">(</a>
  <a title="Boolean" id="47058">readingChunks</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(false)" class="keyword">false</span>,
  <a title="Option[org.jboss.netty.handler.codec.http.HttpRequest]" id="47059">originalReq</a>: <span title="Option[org.jboss.netty.handler.codec.http.HttpRequest]">Option</span><span class="delimiter">[</span>NHttpRequest<span class="delimiter">]</span> = <span title="object None">None</span>,
  <a title="Option[unfiltered.netty.request.PostDecoder]" id="47060">decoder</a>: <span title="Option[unfiltered.netty.request.PostDecoder]">Option</span><span class="delimiter">[</span>PostDecoder<span class="delimiter">]</span> = <span title="object None">None</span>
<span class="delimiter">)</span>

<span class="keyword">object</span> <a title="object unfiltered.netty.request.MultiPartPass" id="12361">MultiPartPass</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="comment">/** A pass handler serves as a means to forward a request upstream for
   *  unhandled patterns and protocol messages */</span>
  <span class="keyword">type</span> <a title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.ChannelEvent) =&gt; Unit" id="47004">PassHandler</a> = <span class="delimiter">(</span>ChannelHandlerContext, ChannelEvent<span class="delimiter">)</span> =&gt; Unit

  <span class="comment">/** A default implementation of a PassHandler which sends the message upstream */</span>
  <span class="keyword">val</span> <a title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.ChannelEvent) =&gt; Unit" id="47005">DefaultPassHandler</a> = <span class="delimiter">(</span><span class="delimiter">{</span> <span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="49377">ctx</a>, <a title="org.jboss.netty.channel.ChannelEvent" id="49378">event</a><span class="delimiter">)</span> =&gt;
    <a href="#49378" title="org.jboss.netty.channel.ChannelEvent">event</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Unit" id="49379">me</a>: <span title="org.jboss.netty.channel.MessageEvent">MessageEvent</span> =&gt; <a href="#49377" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="(x$1: org.jboss.netty.channel.ChannelEvent)Unit">sendUpstream</span><span class="delimiter">(</span><a href="#49378" title="org.jboss.netty.channel.ChannelEvent">event</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span> <span class="comment">// we really only care about MessageEvents but need to support the more generic ChannelEvent</span>
    <span class="delimiter">}</span>
   <span class="delimiter">}</span>: <span title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.ChannelEvent) =&gt; Unit">PassHandler</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/** Enriches a netty plan with multipart decoding capabilities. */</span>
<span class="keyword">trait</span> <a title="trait AbstractMultiPartDecoder extends java.lang.Object with unfiltered.netty.request.CleanUp with ScalaObject" id="12252">AbstractMultiPartDecoder</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#12369" title="unfiltered.netty.request.CleanUp">CleanUp</a> <span class="delimiter">{</span>

  <span class="comment">/** Whether the ChannelBuffer used in decoding is allowed to write to disk */</span>
  <span class="keyword">protected</span> <span class="keyword">val</span> <a title="Boolean" id="46934">useDisk</a>: <span title="Boolean">Boolean</span> = <span title="Boolean(true)" class="keyword">true</span>
  <span class="comment">/** Called when there are no more chunks to process. Implementation differs between cycle and async plans */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, e: org.jboss.netty.channel.MessageEvent)Unit" id="46936">complete</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="47014">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="org.jboss.netty.channel.MessageEvent" id="47015">e</a>: <span title="org.jboss.netty.channel.MessageEvent">MessageEvent</span><span class="delimiter">)</span>

  <span class="comment">/** A pass handler that should be supplied when the plan is created. Default is to send upstream */</span>
  <span class="keyword">def</span> <a title="=&gt; (org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.ChannelEvent) =&gt; Unit" id="46937">pass</a>: MultiPartPass.<span title="(org.jboss.netty.channel.ChannelHandlerContext, org.jboss.netty.channel.ChannelEvent) =&gt; Unit">PassHandler</span>

  <span class="comment">/** Determine whether the intent could handle the request (without executing it). If so execute @param body, otherwise pass */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, e: org.jboss.netty.channel.MessageEvent, binding: unfiltered.netty.RequestBinding)(body: =&gt; Unit)Unit" id="46938">handleOrPass</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="46959">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="org.jboss.netty.channel.MessageEvent" id="46960">e</a>: <span title="org.jboss.netty.channel.MessageEvent">MessageEvent</span>, <a title="unfiltered.netty.RequestBinding" id="46961">binding</a>: <a href="../../../../../netty/unfiltered/netty/bindings.scala.html#11465" title="unfiltered.netty.RequestBinding">RequestBinding</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="=&gt; Unit" id="46962">body</a>: =&gt; Unit<span class="delimiter">)</span>

  <span class="comment">/** Provides multipart request handling common to both cycle and async plans. 
      Should be called by onMessageReceived. */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, e: org.jboss.netty.channel.MessageEvent)Unit" id="46939">upgrade</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="47141">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="org.jboss.netty.channel.MessageEvent" id="47142">e</a>: <span title="org.jboss.netty.channel.MessageEvent">MessageEvent</span><span class="delimiter">)</span> = <span class="delimiter">{</span>

    <span class="comment">/** Maintain state as exlained here:
    http://docs.jboss.org/netty/3.2/api/org/jboss/netty/channel/ChannelHandlerContext.html */</span>
    <span class="keyword">val</span> <a title="unfiltered.netty.request.MultiPartChannelState" id="47145">channelState</a> = <a href="#12358" title="object unfiltered.netty.request.Helpers">Helpers</a>.<a href="#47020" title="(ctx: org.jboss.netty.channel.ChannelHandlerContext)unfiltered.netty.request.MultiPartChannelState">channelState</a><span class="delimiter">(</span><a href="#47141" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a><span class="delimiter">)</span>

    <a href="#47142" title="org.jboss.netty.channel.MessageEvent">e</a> <span title="()java.lang.Object">getMessage</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Unit" id="47146">request</a>: <span title="org.jboss.netty.handler.codec.http.HttpRequest">NHttpRequest</span> =&gt;
        <span class="keyword">val</span> <a title="unfiltered.netty.ReceivedMessage" id="47147">msg</a> = <a href="../../../../../netty/unfiltered/netty/bindings.scala.html#47084" title="(request: org.jboss.netty.handler.codec.http.HttpRequest, context: org.jboss.netty.channel.ChannelHandlerContext, event: org.jboss.netty.channel.MessageEvent)unfiltered.netty.ReceivedMessage">ReceivedMessage</a><span class="delimiter">(</span><a href="#47146" title="org.jboss.netty.handler.codec.http.HttpRequest">request</a>, <a href="#47141" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#47142" title="org.jboss.netty.channel.MessageEvent">e</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="unfiltered.netty.RequestBinding" id="47148">binding</a> = <span title="unfiltered.netty.RequestBinding" class="keyword">new</span> <a href="../../../../../netty/unfiltered/netty/bindings.scala.html#11465" title="unfiltered.netty.RequestBinding">RequestBinding</a><span class="delimiter">(</span><a href="#47147" title="unfiltered.netty.ReceivedMessage">msg</a><span class="delimiter">)</span>
        <a href="#47148" title="unfiltered.netty.RequestBinding">binding</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="comment">// Should match the initial multipart request</span>
          <span class="keyword">case</span> <a href="../../../../../unfiltered/unfiltered/unfiltered/request/methods.scala.html#42286" title="Unit">POST</a><span class="delimiter">(</span><a href="uploads.scala.html#47164" title="(req: unfiltered.netty.RequestBinding)Option[unfiltered.netty.RequestBinding]">MultiPart</a><span class="delimiter">(</span>_<span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
            <span class="comment">// Determine whether the request is destined for this plan's intent and if not, pass</span>
            <a href="#46938" title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, e: org.jboss.netty.channel.MessageEvent, binding: unfiltered.netty.RequestBinding)(body: =&gt; Unit)Unit">handleOrPass</a><span class="delimiter">(</span><a href="#47141" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#47142" title="org.jboss.netty.channel.MessageEvent">e</a>, <a href="#47148" title="unfiltered.netty.RequestBinding">binding</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="comment">// The request is destined for this intent, so start to handle it</span>
              <a href="#46940" title="(request: org.jboss.netty.handler.codec.http.HttpRequest, channelState: unfiltered.netty.request.MultiPartChannelState, ctx: org.jboss.netty.channel.ChannelHandlerContext, e: org.jboss.netty.channel.MessageEvent)Unit">start</a><span class="delimiter">(</span><a href="#47146" title="org.jboss.netty.handler.codec.http.HttpRequest">request</a>, <a href="#47145" title="unfiltered.netty.request.MultiPartChannelState">channelState</a>, <a href="#47141" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#47142" title="org.jboss.netty.channel.MessageEvent">e</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="comment">// The request is not valid for this plan so send sendUpstream</span>
          <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <a href="#46937" title="(v1: org.jboss.netty.channel.ChannelHandlerContext, v2: org.jboss.netty.channel.ChannelEvent)Unit">pass</a><span class="delimiter">(</span><a href="#47141" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#47142" title="org.jboss.netty.channel.MessageEvent">e</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>

      <span class="comment">// Should match subsequent chunks of the same request</span>
      <span class="keyword">case</span> <a title="Unit" id="47260">chunk</a>: <span title="org.jboss.netty.handler.codec.http.HttpChunk">NHttpChunk</span> =&gt;
        <a href="#47145" title="unfiltered.netty.request.MultiPartChannelState">channelState</a>.<a href="#47059" title="=&gt; Option[org.jboss.netty.handler.codec.http.HttpRequest]">originalReq</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="comment">// Ensure that multipart handling was started for the request</span>
          <span class="keyword">case</span> <span title="Unit">Some</span><span class="delimiter">(</span><a title="org.jboss.netty.handler.codec.http.HttpRequest" id="47268">request</a><span class="delimiter">)</span> =&gt; 
            <span class="keyword">val</span> <a title="unfiltered.netty.ReceivedMessage" id="47269">msg</a> = <a href="../../../../../netty/unfiltered/netty/bindings.scala.html#47084" title="(request: org.jboss.netty.handler.codec.http.HttpRequest, context: org.jboss.netty.channel.ChannelHandlerContext, event: org.jboss.netty.channel.MessageEvent)unfiltered.netty.ReceivedMessage">ReceivedMessage</a><span class="delimiter">(</span><a href="#47268" title="org.jboss.netty.handler.codec.http.HttpRequest">request</a>, <a href="#47141" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#47142" title="org.jboss.netty.channel.MessageEvent">e</a><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="unfiltered.netty.RequestBinding" id="47270">binding</a> = <span title="unfiltered.netty.RequestBinding" class="keyword">new</span> <a href="../../../../../netty/unfiltered/netty/bindings.scala.html#11465" title="unfiltered.netty.RequestBinding">RequestBinding</a><span class="delimiter">(</span><a href="#47269" title="unfiltered.netty.ReceivedMessage">msg</a><span class="delimiter">)</span>
            <span class="comment">// Determine whether the chunk is destined for this plan's intent and if not, pass</span>
            <a href="#46938" title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, e: org.jboss.netty.channel.MessageEvent, binding: unfiltered.netty.RequestBinding)(body: =&gt; Unit)Unit">handleOrPass</a><span class="delimiter">(</span><a href="#47141" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#47142" title="org.jboss.netty.channel.MessageEvent">e</a>, <a href="#47270" title="unfiltered.netty.RequestBinding">binding</a><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span class="comment">// The chunk is destined for this intent, so handle it</span>
              <a href="#46941" title="(chunk: org.jboss.netty.handler.codec.http.HttpChunk, channelState: unfiltered.netty.request.MultiPartChannelState, ctx: org.jboss.netty.channel.ChannelHandlerContext, e: org.jboss.netty.channel.MessageEvent)Unit">continue</a><span class="delimiter">(</span><a href="#47260" title="org.jboss.netty.handler.codec.http.HttpChunk">chunk</a>, <a href="#47145" title="unfiltered.netty.request.MultiPartChannelState">channelState</a>, <a href="#47141" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#47142" title="org.jboss.netty.channel.MessageEvent">e</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="keyword">case</span> <span title="Unit">_</span> =&gt; <a href="#46937" title="(v1: org.jboss.netty.channel.ChannelHandlerContext, v2: org.jboss.netty.channel.ChannelEvent)Unit">pass</a><span class="delimiter">(</span><a href="#47141" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#47142" title="org.jboss.netty.channel.MessageEvent">e</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Sets up for handling a multipart request */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(request: org.jboss.netty.handler.codec.http.HttpRequest, channelState: unfiltered.netty.request.MultiPartChannelState, ctx: org.jboss.netty.channel.ChannelHandlerContext, e: org.jboss.netty.channel.MessageEvent)Unit" id="46940">start</a><span class="delimiter">(</span><a title="org.jboss.netty.handler.codec.http.HttpRequest" id="47214">request</a>: <span title="org.jboss.netty.handler.codec.http.HttpRequest">NHttpRequest</span>, 
                    <a title="unfiltered.netty.request.MultiPartChannelState" id="47215">channelState</a>: <a href="#50155" title="unfiltered.netty.request.MultiPartChannelState">MultiPartChannelState</a>,
                    <a title="org.jboss.netty.channel.ChannelHandlerContext" id="47216">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, 
                    <a title="org.jboss.netty.channel.MessageEvent" id="47217">e</a>: <span title="org.jboss.netty.channel.MessageEvent">MessageEvent</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#47215" title="unfiltered.netty.request.MultiPartChannelState">channelState</a>.<a href="#47058" title="=&gt; Boolean">readingChunks</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="comment">// Initialise the decoder</span>
      <span class="keyword">val</span> <a title="Option[unfiltered.netty.request.PostDecoder]" id="47220">decoder</a> = <a href="#47222" title="(req: org.jboss.netty.handler.codec.http.HttpRequest, useDisk: Boolean)Option[unfiltered.netty.request.PostDecoder]">PostDecoder</a><span class="delimiter">(</span><a href="#47214" title="org.jboss.netty.handler.codec.http.HttpRequest">request</a>, <a href="#46934" title="=&gt; Boolean">useDisk</a><span class="delimiter">)</span>
      <span class="comment">// Store the initial state</span>
      <a href="#47216" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="(x$1: Any)Unit">setAttachment</span><span class="delimiter">(</span><a href="#50155" title="(readingChunks: Boolean, originalReq: Option[org.jboss.netty.handler.codec.http.HttpRequest], decoder: Option[unfiltered.netty.request.PostDecoder])unfiltered.netty.request.MultiPartChannelState">MultiPartChannelState</a><span class="delimiter">(</span><a href="#47215" title="unfiltered.netty.request.MultiPartChannelState">channelState</a>.<a href="#47058" title="=&gt; Boolean">readingChunks</a>, <span title="(x: org.jboss.netty.handler.codec.http.HttpRequest)Some[org.jboss.netty.handler.codec.http.HttpRequest]">Some</span><span class="delimiter">(</span><a href="#47214" title="org.jboss.netty.handler.codec.http.HttpRequest">request</a><span class="delimiter">)</span>, <a href="#47220" title="Option[unfiltered.netty.request.PostDecoder]">decoder</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#47214" title="org.jboss.netty.handler.codec.http.HttpRequest">request</a>.<span title="()Boolean">isChunked</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="comment">// Update the state to readingChunks = true</span>
        <a href="#47216" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="(x$1: Any)Unit">setAttachment</span><span class="delimiter">(</span><a href="#50155" title="(readingChunks: Boolean, originalReq: Option[org.jboss.netty.handler.codec.http.HttpRequest], decoder: Option[unfiltered.netty.request.PostDecoder])unfiltered.netty.request.MultiPartChannelState">MultiPartChannelState</a><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span>, <span title="(x: org.jboss.netty.handler.codec.http.HttpRequest)Some[org.jboss.netty.handler.codec.http.HttpRequest]">Some</span><span class="delimiter">(</span><a href="#47214" title="org.jboss.netty.handler.codec.http.HttpRequest">request</a><span class="delimiter">)</span>, <a href="#47220" title="Option[unfiltered.netty.request.PostDecoder]">decoder</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
        <span class="comment">// This is not a chunked request (could be an aggregated multipart request), </span>
        <span class="comment">// so we should have received it all. Behave like a regular netty plan.</span>
        <a href="#46936" title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, e: org.jboss.netty.channel.MessageEvent)Unit">complete</a><span class="delimiter">(</span><a href="#47216" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#47217" title="org.jboss.netty.channel.MessageEvent">e</a><span class="delimiter">)</span>
        <a href="#46931" title="(ctx: org.jboss.netty.channel.ChannelHandlerContext)Unit">cleanUp</a><span class="delimiter">(</span><a href="#47216" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="comment">// Shouldn't get here</span>
      <span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;HttpRequest received while reading chunks: %s&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#47214" title="org.jboss.netty.handler.codec.http.HttpRequest">request</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/** Handles incoming chunks belonging to the original request */</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(chunk: org.jboss.netty.handler.codec.http.HttpChunk, channelState: unfiltered.netty.request.MultiPartChannelState, ctx: org.jboss.netty.channel.ChannelHandlerContext, e: org.jboss.netty.channel.MessageEvent)Unit" id="46941">continue</a><span class="delimiter">(</span><a title="org.jboss.netty.handler.codec.http.HttpChunk" id="47277">chunk</a>: <span title="org.jboss.netty.handler.codec.http.HttpChunk">NHttpChunk</span>,
                       <a title="unfiltered.netty.request.MultiPartChannelState" id="47278">channelState</a>: <a href="#50155" title="unfiltered.netty.request.MultiPartChannelState">MultiPartChannelState</a>,
                       <a title="org.jboss.netty.channel.ChannelHandlerContext" id="47279">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, 
                       <a title="org.jboss.netty.channel.MessageEvent" id="47280">e</a>: <span title="org.jboss.netty.channel.MessageEvent">MessageEvent</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="comment">// Should be reading chunks here</span>
    <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#47278" title="unfiltered.netty.request.MultiPartChannelState">channelState</a>.<a href="#47058" title="=&gt; Boolean">readingChunks</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="comment">// Give the chunk to the decoder</span>
      <a href="#47278" title="unfiltered.netty.request.MultiPartChannelState">channelState</a>.<a href="#47060" title="=&gt; Option[unfiltered.netty.request.PostDecoder]">decoder</a>.<span title="(f: unfiltered.netty.request.PostDecoder =&gt; Option[Unit])Option[Option[Unit]]">map</span><span class="delimiter">(</span><a href="#47287" title="unfiltered.netty.request.PostDecoder">_</a>.<a href="#47300" title="(chunk: org.jboss.netty.handler.codec.http.HttpChunk)Option[Unit]">offer</a><span class="delimiter">(</span><a href="#47277" title="org.jboss.netty.handler.codec.http.HttpChunk">chunk</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#47277" title="org.jboss.netty.handler.codec.http.HttpChunk">chunk</a>.<span title="()Boolean">isLast</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="comment">// This was the last chunk so we can complete</span>
        <a href="#47279" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="(x$1: Any)Unit">setAttachment</span><span class="delimiter">(</span><a href="#47278" title="unfiltered.netty.request.MultiPartChannelState">channelState</a>.<a href="#50155" title="(readingChunks: Boolean, originalReq: Option[org.jboss.netty.handler.codec.http.HttpRequest], decoder: Option[unfiltered.netty.request.PostDecoder])unfiltered.netty.request.MultiPartChannelState">copy</a><span class="delimiter">(</span>readingChunks=<span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <a href="#46936" title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, e: org.jboss.netty.channel.MessageEvent)Unit">complete</a><span class="delimiter">(</span><a href="#47279" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#47280" title="org.jboss.netty.channel.MessageEvent">e</a><span class="delimiter">)</span>
        <a href="#46931" title="(ctx: org.jboss.netty.channel.ChannelHandlerContext)Unit">cleanUp</a><span class="delimiter">(</span><a href="#47279" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="comment">// It shouldn't be possible to get here</span>
      <span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="java.lang.String(&quot;HttpChunk received when not expected.&quot;)" class="string">&quot;HttpChunk received when not expected.&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object unfiltered.netty.request.Helpers" id="12358">Helpers</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="comment">/** Retrieve the channel state */</span>
  <span class="keyword">def</span> <a title="(ctx: org.jboss.netty.channel.ChannelHandlerContext)unfiltered.netty.request.MultiPartChannelState" id="47020">channelState</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="47021">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span><span class="delimiter">)</span> = <a href="#47021" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a> <span title="()java.lang.Object">getAttachment</span> <span title="unfiltered.netty.request.MultiPartChannelState" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a title="unfiltered.netty.request.MultiPartChannelState" id="47024">s</a>: <a href="#50155" title="unfiltered.netty.request.MultiPartChannelState">MultiPartChannelState</a> =&gt; <a href="#47024" title="unfiltered.netty.request.MultiPartChannelState">s</a>
    <span class="keyword">case</span> <span title="unfiltered.netty.request.MultiPartChannelState">_</span> =&gt; <a href="#50155" title="(readingChunks: Boolean, originalReq: Option[org.jboss.netty.handler.codec.http.HttpRequest], decoder: Option[unfiltered.netty.request.PostDecoder])unfiltered.netty.request.MultiPartChannelState">MultiPartChannelState</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">trait</span> <a title="trait CleanUp extends java.lang.Object with ScalaObject" id="12369">CleanUp</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">import</span> <a href="#12358" title="object unfiltered.netty.request.Helpers">Helpers</a>._

  <span class="comment">/** Erase the channel state in case the context gets recycled */</span>
  <span class="keyword">def</span> <a title="(ctx: org.jboss.netty.channel.ChannelHandlerContext)Unit" id="46931">cleanUp</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="47236">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span><span class="delimiter">)</span> = <a href="#47236" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>.<span title="(x$1: Any)Unit">setAttachment</span><span class="delimiter">(</span><span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>

  <span class="comment">/** Erase any temporary data that may be on disk */</span>
  <span class="keyword">def</span> <a title="(ctx: org.jboss.netty.channel.ChannelHandlerContext)Option[Option[Unit]]" id="46932">cleanFiles</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="49329">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span><span class="delimiter">)</span> = <a href="#47020" title="(ctx: org.jboss.netty.channel.ChannelHandlerContext)unfiltered.netty.request.MultiPartChannelState">channelState</a><span class="delimiter">(</span><a href="#49329" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a><span class="delimiter">)</span>.<a href="#47060" title="=&gt; Option[unfiltered.netty.request.PostDecoder]">decoder</a>.<span title="(f: unfiltered.netty.request.PostDecoder =&gt; Option[Unit])Option[Option[Unit]]">map</span><span class="delimiter">(</span><a href="#49336" title="unfiltered.netty.request.PostDecoder">_</a>.<a href="#47301" title="=&gt; Option[Unit]">cleanFiles</a><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="comment">/** Ensure any state cleanup is done when an exception is caught */</span>
<span class="keyword">trait</span> <a title="trait TidyExceptionHandler extends java.lang.Object with unfiltered.netty.ExceptionHandler with unfiltered.netty.request.CleanUp with ScalaObject" id="12423">TidyExceptionHandler</a> <span title="ScalaObject" class="keyword">extends</span> <a href="../../../../../netty/unfiltered/netty/exceptions.scala.html#11378" title="unfiltered.netty.ExceptionHandler">ExceptionHandler</a> <span class="keyword">with</span> <a href="#12369" title="unfiltered.netty.request.CleanUp">CleanUp</a> <span class="delimiter">{</span> self: SimpleChannelUpstreamHandler =&gt;
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, e: org.jboss.netty.channel.ExceptionEvent)Unit" id="46944">exceptionCaught</a><span class="delimiter">(</span><a title="org.jboss.netty.channel.ChannelHandlerContext" id="50137">ctx</a>: <span title="org.jboss.netty.channel.ChannelHandlerContext">ChannelHandlerContext</span>, <a title="org.jboss.netty.channel.ExceptionEvent" id="50138">e</a>: <span title="org.jboss.netty.channel.ExceptionEvent">ExceptionEvent</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#46932" title="(ctx: org.jboss.netty.channel.ChannelHandlerContext)Option[Option[Unit]]">cleanFiles</a><span class="delimiter">(</span><a href="#50137" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a><span class="delimiter">)</span>
    <a href="#46931" title="(ctx: org.jboss.netty.channel.ChannelHandlerContext)Unit">cleanUp</a><span class="delimiter">(</span><a href="#50137" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a><span class="delimiter">)</span>
    <a href="#12423" title="&lt;none&gt; extends unfiltered.netty.request.TidyExceptionHandler with org.jboss.netty.channel.SimpleChannelUpstreamHandler" class="keyword">super</a>.<a href="../../../../../netty/unfiltered/netty/exceptions.scala.html#42415" title="(ctx: org.jboss.netty.channel.ChannelHandlerContext, e: org.jboss.netty.channel.ExceptionEvent)Unit">exceptionCaught</a><span class="delimiter">(</span><a href="#50137" title="org.jboss.netty.channel.ChannelHandlerContext">ctx</a>, <a href="#50138" title="org.jboss.netty.channel.ExceptionEvent">e</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>scalala/library/Numerics.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 Copyright 2009 David Hall, Daniel Ramage

 Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/</span>

<span class="keyword">package</span> scalala.library

<span class="keyword">import</span> math._
<span class="keyword">import</span> scalala.tensor.Tensor1

<span class="comment">/**
 * Provides some functions left out of java.lang.math.
 *
 * Borrowed from scalanlp.
 *
 * @author dlwh, afwlehmann
 */</span>
<span class="keyword">trait</span> <a title="trait Numerics extends java.lang.Object with ScalaObject" id="12742">Numerics</a> <span title="ScalaObject" class="delimiter">{</span>

  <span class="comment">/**
   * The standard digamma function. Cribbed from Radford Neal
   *
   * http://google.com/codesearch/p?hl=en#EbB356_xxkI/fbm.2003-06-29/util/digamma.c
   */</span>
  <span class="keyword">def</span> <a title="(xx: Double)Double" id="366391">digamma</a><span class="delimiter">(</span><a title="Double" id="366476">xx</a>: <span title="Double">Double</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Double" id="366479">x</a> = <a href="#366476" title="Double">xx</a>;
    <span class="keyword">var</span> <a title="Double" id="366480">r</a> = <span title="Double(0.0)" class="double">0.0</span>;

    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#366479" title="Double">x</a><span title="(x: Int)Boolean">&lt;=</span><span title="Int(5)" class="int">5</span><span class="delimiter">)</span> <a href="#366483" title="()Unit" class="delimiter">{</a>
      <a href="#366480" title="Double">r</a> <span title="(x: Double)Double">-=</span> <span title="Int(1)" class="int">1</span><span title="(x: Double)Double">/</span><a href="#366479" title="Double">x</a>;
      <a href="#366479" title="Double">x</a> <span title="(x: Int)Double">+=</span> <span title="Int(1)" class="int">1</span>;
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="Double" id="366481">f</a> = <span title="Double(1.0)" class="double">1.</span><span title="(x: Double)Double">/</span><span class="delimiter">(</span><a href="#366479" title="Double">x</a> <span title="(x: Double)Double">*</span> <a href="#366479" title="Double">x</a><span class="delimiter">)</span>;
    <span class="keyword">val</span> <a title="Double" id="366482">t</a> = <a href="#366481" title="Double">f</a><span title="(x: Double)Double">*</span><span class="delimiter">(</span>-<span class="int">1</span><span title="Double(-0.08333333333333333)">/</span><span class="double">12.0</span> <span title="(x: Double)Double">+</span>
            <a href="#366481" title="Double">f</a><span title="(x: Double)Double">*</span><span class="delimiter">(</span><span class="int">1</span><span title="Double(0.008333333333333333)">/</span><span class="double">120.0</span> <span title="(x: Double)Double">+</span>
            <a href="#366481" title="Double">f</a><span title="(x: Double)Double">*</span><span class="delimiter">(</span>-<span class="int">1</span><span title="Double(-0.003968253968253968)">/</span><span class="double">252.0</span> <span title="(x: Double)Double">+</span>
            <a href="#366481" title="Double">f</a><span title="(x: Double)Double">*</span><span class="delimiter">(</span><span class="int">1</span><span title="Double(0.004166666666666667)">/</span><span class="double">240.0</span> <span title="(x: Double)Double">+</span>
            <a href="#366481" title="Double">f</a><span title="(x: Double)Double">*</span><span class="delimiter">(</span>-<span class="int">1</span><span title="Double(-0.007575757575757576)">/</span><span class="double">132.0</span> <span title="(x: Double)Double">+</span>
            <a href="#366481" title="Double">f</a><span title="(x: Double)Double">*</span><span class="delimiter">(</span><span class="int">691</span><span title="Double(0.021092796092796094)">/</span><span class="double">32760.0</span> <span title="(x: Double)Double">+</span>
            <a href="#366481" title="Double">f</a><span title="(x: Double)Double">*</span><span class="delimiter">(</span>-<span class="int">1</span><span title="Double(-0.08333333333333333)">/</span><span class="double">12.0</span> <span title="(x: Double)Double">+</span>
            <a href="#366481" title="Double">f</a><span title="(x: Double)Double">*</span><span title="Double(3617.0)" class="double">3617.0</span><span title="(x: Double)Double">/</span><span title="Double(8160.0)" class="double">8160.0</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>;
    <a href="#366480" title="Double">r</a> <span title="(x: Double)Double">+</span> <span title="(x: Double)Double">log</span><span class="delimiter">(</span><a href="#366479" title="Double">x</a><span class="delimiter">)</span> <span title="(x: Double)Double">-</span> <span title="Double(0.5)" class="double">0.5</span><span title="(x: Double)Double">/</span><a href="#366479" title="Double">x</a> <span title="(x: Double)Double">+</span> <a href="#366482" title="Double">t</a>;
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Array[Double]" id="366392">cof</a> =  <span title="(x: Double, xs: Double*)Array[Double]">Array</span><span class="delimiter">(</span><span title="Double(76.18009172947146)" class="double">76.18009172947146</span>, -<span title="Double(-86.50532032941678)" class="double">86.50532032941677</span>,
    <span title="Double(24.01409824083091)" class="double">24.01409824083091</span>,-<span title="Double(-1.231739572450155)" class="double">1.231739572450155</span>,
    <span title="Double(0.001208650973866179)" class="double">0.1208650973866179e-2</span>,-<span title="Double(-5.395239384953E-6)" class="double">0.5395239384953e-5</span>
  <span class="delimiter">)</span>;

  <span class="comment">/**
   * Evaluates the log of the generalized beta function.
   *  = \sum_a lgamma(c(a))- lgamma(c.sum)
   */</span>
  <span class="keyword">def</span> <a title="[T](c: scalala.tensor.Tensor1[T,Double])Double" id="366394">lbeta</a><span class="delimiter">[</span><a title="&gt;: Nothing &lt;: Any" id="366396">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="scalala.tensor.Tensor1[T,Double]" id="366617">c</a>: <a href="../tensor/Tensor1.scala.html#17729" title="scalala.tensor.Tensor1[T,Double]">Tensor1</a><span class="delimiter">[</span>T,Double<span class="delimiter">]</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#366617" title="scalala.tensor.Tensor1[T,Double]">c</a>.<a href="../tensor/Tensor.scala.html#42306" title="=&gt; Iterator[Double]">valuesIterator</a>.<span title="(z: Double)(op: (Double, Double) =&gt; Double)Double">foldLeft</span><span class="delimiter">(</span><span title="=&gt; Double">-</span><a href="#366397" title="(x: Double)Double">lgamma</a><span class="delimiter">(</span><a href="#366617" title="scalala.tensor.Tensor1[T,Double]">c</a>.<a href="../tensor/Tensor.scala.html#42375" title="=&gt; Double">sum</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span> <span class="delimiter">(</span><a title="Double" id="366775">acc</a>,<a title="Double" id="366776">x</a><span class="delimiter">)</span>=&gt; <a href="#366775" title="Double">acc</a> <span title="(x: Double)Double">+</span><a href="#366397" title="(x: Double)Double">lgamma</a><span class="delimiter">(</span><a href="#366776" title="Double">x</a><span class="delimiter">)</span><span class="delimiter">)</span>;
  <span class="delimiter">}</span>

  <span class="comment">/**
  * Computes the log of the gamma function.
  *
  * Reference: Numerical Recipes in C
  * http://www.library.cornell.edu/nr/cbookcpdf.html
  * www.cs.berkeley.edu/~milch/blog/versions/blog-0.1.3/blog/distrib
  * @return an approximation of the log of the Gamma function * of x.  Laczos Approximation
  */</span>
  <span class="keyword">def</span> <a title="(x: Double)Double" id="366397">lgamma</a><span class="delimiter">(</span><a title="Double" id="366713">x</a> : <span title="Double">Double</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Double" id="366716">y</a> = <a href="#366713" title="Double">x</a>;
    <span class="keyword">var</span> <a title="Double" id="366717">tmp</a> = <a href="#366713" title="Double">x</a> <span title="(x: Double)Double">+</span> <span title="Double(5.5)" class="double">5.5</span>;
    <a href="#366717" title="Double">tmp</a> <span title="(x: Double)Double">-=</span> <span class="delimiter">(</span><span class="delimiter">(</span><a href="#366713" title="Double">x</a> <span title="(x: Double)Double">+</span> <span title="Double(0.5)" class="double">0.5</span><span class="delimiter">)</span> <span title="(x: Double)Double">*</span> <span title="(x: Double)Double">log</span><span class="delimiter">(</span><a href="#366717" title="Double">tmp</a><span class="delimiter">)</span><span class="delimiter">)</span>;
    <span class="keyword">var</span> <a title="Double" id="366718">ser</a> = <span title="Double(1.000000000190015)" class="double">1.000000000190015</span>;
    <span class="keyword">var</span> <a title="Int" id="366719">j</a> = <span title="Int(0)" class="int">0</span>;
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#366719" title="Int">j</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(6)" class="int">6</span><span class="delimiter">)</span> <a href="#366720" title="()Unit" class="delimiter">{</a>
      <a href="#366716" title="Double">y</a> <span title="(x: Int)Double">+=</span> <span title="Int(1)" class="int">1</span>;
      <a href="#366718" title="Double">ser</a> <span title="(x: Double)Double">+=</span> <span class="delimiter">(</span><a href="#366392" title="(i: Int)Double">cof</a><span class="delimiter">(</span><a href="#366719" title="Int">j</a><span class="delimiter">)</span><span title="(x: Double)Double">/</span><a href="#366716" title="Double">y</a><span class="delimiter">)</span>;
      <a href="#366719" title="Int">j</a> <span title="(x: Int)Int">+=</span><span title="Int(1)" class="int">1</span>;
    <span class="delimiter">}</span>
    <span class="delimiter">(</span><span title="=&gt; Double">-</span><a href="#366717" title="Double">tmp</a> <span title="(x: Double)Double">+</span> <span title="(x: Double)Double">log</span><span class="delimiter">(</span><span title="Double(2.5066282746310007)" class="double">2.5066282746310005</span><span title="(x: Double)Double">*</span><a href="#366718" title="Double">ser</a> <span title="(x: Double)Double">/</span> <a href="#366713" title="Double">x</a><span class="delimiter">)</span><span class="delimiter">)</span>;
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Double" id="366398">SQRT_PI</a> = <span title="(x: Double)Double">sqrt</span><span class="delimiter">(</span><span title="=&gt; Double">Pi</span><span class="delimiter">)</span>;

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Double" id="366400">ERF_A</a> = <span title="Double(8.0)" class="double">8.</span> <span title="(x: Double)Double">/</span> <span class="delimiter">(</span><span title="Double(3.0)" class="double">3.</span> <span title="(x: Double)Double">*</span> <span title="=&gt; Double">Pi</span><span class="delimiter">)</span> <span title="(x: Double)Double">*</span> <span class="delimiter">(</span><span title="=&gt; Double">Pi</span> <span title="(x: Int)Double">-</span> <span title="Int(3)" class="int">3</span><span class="delimiter">)</span> <span title="(x: Double)Double">/</span> <span class="delimiter">(</span><span title="Int(4)" class="int">4</span> <span title="(x: Double)Double">-</span> <span title="=&gt; Double">Pi</span><span class="delimiter">)</span>;
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Double" id="366402">ERF_B</a> = <span title="Double(4.0)" class="double">4.</span> <span title="(x: Double)Double">/</span> <span title="=&gt; Double">Pi</span>;

  <span class="comment">/**
  * Approximation to the inverse ERF. Based on
  * homepages.physik.uni-muenchen.de/~Winitzki/erf-approx.pdf
  */</span>
  <span class="keyword">def</span> <a title="(x: Double)Double" id="366404">erfi</a><span class="delimiter">(</span><a title="Double" id="366786">x</a>:<span title="Double">Double</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Double" id="366789">x2</a> = <a href="#366786" title="Double">x</a><span title="(x: Double)Double">*</span><a href="#366786" title="Double">x</a>;
    <span class="keyword">val</span> <a title="Double" id="366790">lg1mx2</a> = <span title="(x: Double)Double">log</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span title="(x: Double)Double">-</span> <a href="#366789" title="Double">x2</a><span class="delimiter">)</span>;
    <span class="keyword">val</span> <a title="Double" id="366791">c</a> = <span title="Int(2)" class="int">2</span> <span title="(x: Double)Double">/</span> <span title="=&gt; Double">Pi</span> <span title="(x: Double)Double">/</span> <a href="#366400" title="=&gt; Double">ERF_A</a> <span title="(x: Double)Double">+</span> <a href="#366790" title="Double">lg1mx2</a><span title="(x: Int)Double">/</span><span title="Int(2)" class="int">2</span>;
    <span class="keyword">val</span> <a title="Double" id="366792">result</a> =  <span title="(x: Double)Double">sqrt</span><span class="delimiter">(</span><span title="=&gt; Double">-</span><a href="#366791" title="Double">c</a> <span title="(x: Double)Double">+</span> <span title="(x: Double)Double">sqrt</span><span class="delimiter">(</span> <a href="#366791" title="Double">c</a><span title="(x: Double)Double">*</span><a href="#366791" title="Double">c</a> <span title="(x: Double)Double">-</span> <span title="Int(1)" class="int">1</span><span title="(x: Double)Double">/</span> <a href="#366400" title="=&gt; Double">ERF_A</a> <span title="(x: Double)Double">*</span> <a href="#366790" title="Double">lg1mx2</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span title="Double" class="keyword">if</span> <span class="delimiter">(</span><a href="#366786" title="Double">x</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> -<span title="Int(-1)" class="int">1</span> <span title="(x: Double)Double">*</span> <a href="#366792" title="Double">result</a>
    <span class="keyword">else</span> <a href="#366792" title="Double">result</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
  * 1- erf(x)
  */</span>
  <span class="keyword">def</span> <a title="(x: Double)Double" id="366405">erfc</a><span class="delimiter">(</span><a title="Double" id="366845">x</a>: <span title="Double">Double</span><span class="delimiter">)</span> =  <span title="Int(1)" class="int">1</span> <span title="(x: Double)Double">-</span> <a href="#366406" title="(x: Double)Double">erf</a><span class="delimiter">(</span><a href="#366845" title="Double">x</a><span class="delimiter">)</span>;

  <span class="comment">/**
  * approximation to the erf function, for gaussian integrals.
  */</span>
  <span class="keyword">def</span> <a title="(x: Double)Double" id="366406">erf</a><span class="delimiter">(</span><a title="Double" id="366852">x</a>: <span title="Double">Double</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Double" id="366855">mag</a> = <span title="Int(1)" class="int">1</span> <span title="(x: Double)Double">-</span> <a href="#366408" title="(a: Double, z: Double)Double">gamma</a><span class="delimiter">(</span><span title="Double(0.5)" class="double">.5</span>,<a href="#366852" title="Double">x</a><span title="(x: Double)Double">*</span><a href="#366852" title="Double">x</a><span class="delimiter">)</span><span title="(x: Double)Double">/</span><span title="(x: Double)Double">sqrt</span><span class="delimiter">(</span><span title="=&gt; Double">Pi</span><span class="delimiter">)</span>;
    <span title="Double" class="keyword">if</span> <span class="delimiter">(</span><a href="#366852" title="Double">x</a> <span title="(x: Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> -<span title="Double(-1.0)" class="double">1.0</span> <span title="(x: Double)Double">*</span> <a href="#366855" title="Double">mag</a> <span class="comment">// ERF is odd.</span>
    <span class="keyword">else</span> <a href="#366855" title="Double">mag</a>
  <span class="delimiter">}</span>

  <span class="comment">/**
  * Incomplete lgamma function.
  */</span>
  <span class="keyword">def</span> <a title="(a: Double, z: Double)Double" id="366407">lgamma</a><span class="delimiter">(</span><a title="Double" id="366634">a</a>: <span title="Double">Double</span>, <a title="Double" id="366635">z</a>:<span title="Double">Double</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Double" id="366638">res</a> = <span title="Double(0.0)" class="double">0.</span>;
    <span class="keyword">var</span> <a title="Int" id="366639">m</a> = <span title="Int(21)" class="int">21</span>
    <span title="Unit" class="keyword">while</span><span class="delimiter">(</span> <a href="#366639" title="Int">m</a> <span title="(x: Int)Boolean">&gt;</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <a href="#366640" title="()Unit" class="delimiter">{</a>
      <a href="#366638" title="Double">res</a> = <span class="delimiter">(</span><span class="delimiter">(</span><span title="Double(1.0)" class="double">1.0</span><span title="(x: Int)Double">-</span><a href="#366639" title="Int">m</a><span class="delimiter">)</span><span title="(x: Double)Double">*</span><span class="delimiter">(</span><a href="#366639" title="Int">m</a><span title="(x: Double)Double">-</span><span title="Double(1.0)" class="double">1.0</span><span title="(x: Double)Double">-</span><a href="#366634" title="Double">a</a><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(x: Double)Double">/</span> <span class="delimiter">(</span><span title="Int(2)" class="int">2</span><span title="(x: Int)Int">*</span><a href="#366639" title="Int">m</a> <span title="(x: Int)Int">-</span><span title="Int(1)" class="int">1</span><span title="(x: Double)Double">+</span><a href="#366635" title="Double">z</a> <span title="(x: Double)Double">-</span><a href="#366634" title="Double">a</a> <span title="(x: Double)Double">+</span> <a href="#366638" title="Double">res</a><span class="delimiter">)</span>;
      <a href="#366639" title="Int">m</a> <span title="(x: Int)Int">-=</span> <span title="Int(1)" class="int">1</span>
    <span class="delimiter">}</span>

    <a href="#366634" title="Double">a</a> <span title="(x: Double)Double">*</span> <span title="(x: Double)Double">log</span><span class="delimiter">(</span><a href="#366635" title="Double">z</a><span class="delimiter">)</span> <span title="(x: Double)Double">-</span> <a href="#366635" title="Double">z</a> <span title="(x: Double)Double">-</span> <span title="(x: Double)Double">log</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span title="(x: Double)Double">+</span><a href="#366635" title="Double">z</a><span title="(x: Double)Double">-</span><a href="#366634" title="Double">a</a><span title="(x: Double)Double">+</span><a href="#366638" title="Double">res</a><span class="delimiter">)</span>;
  <span class="delimiter">}</span>

  <span class="comment">/**
  * Incomplete gamma function, the exp of lgamma(a,z)
  */</span>
  <span class="keyword">def</span> <a title="(a: Double, z: Double)Double" id="366408">gamma</a><span class="delimiter">(</span><a title="Double" id="366860">a</a>: <span title="Double">Double</span>, <a title="Double" id="366861">z</a>:<span title="Double">Double</span><span class="delimiter">)</span> = <span title="(x: Double)Double">exp</span><span class="delimiter">(</span><a href="#366407" title="(a: Double, z: Double)Double">lgamma</a><span class="delimiter">(</span><a href="#366860" title="Double">a</a>,<a href="#366861" title="Double">z</a><span class="delimiter">)</span><span class="delimiter">)</span>;

  <span class="comment">/**
  * Sums together things in log space.
  * @return log(exp(a) + exp(b))
  */</span>
  <span class="keyword">def</span> <a title="(a: Double, b: Double)Double" id="366409">logSum</a><span class="delimiter">(</span><a title="Double" id="366884">a</a>: <span title="Double">Double</span>, <a title="Double" id="366885">b</a>: <span title="Double">Double</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span title="Double" class="keyword">if</span> <span class="delimiter">(</span><a href="#366884" title="implicit scala.LowPriorityImplicits.doubleWrapper : (x: Double)scala.runtime.RichDouble">a</a>.<span title="=&gt; Boolean">isNegInfinity</span><span class="delimiter">)</span> <a href="#366885" title="Double">b</a>
    <span class="keyword">else</span> <span title="Double" class="keyword">if</span> <span class="delimiter">(</span><a href="#366885" title="implicit scala.LowPriorityImplicits.doubleWrapper : (x: Double)scala.runtime.RichDouble">b</a>.<span title="=&gt; Boolean">isNegInfinity</span><span class="delimiter">)</span> <a href="#366884" title="Double">a</a>
    <span class="keyword">else</span> <span title="Double" class="keyword">if</span> <span class="delimiter">(</span><a href="#366884" title="Double">a</a> <span title="(x: Double)Boolean">&lt;</span> <a href="#366885" title="Double">b</a><span class="delimiter">)</span> <a href="#366885" title="Double">b</a> <span title="(x: Double)Double">+</span> <span title="(x: Double)Double">log1p</span><span class="delimiter">(</span><span title="(x: Double)Double">exp</span><span class="delimiter">(</span><a href="#366884" title="Double">a</a> <span title="(x: Double)Double">-</span> <a href="#366885" title="Double">b</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">else</span> <a href="#366884" title="Double">a</a> <span title="(x: Double)Double">+</span> <span title="(x: Double)Double">log1p</span><span class="delimiter">(</span><span title="(x: Double)Double">exp</span><span class="delimiter">(</span><a href="#366885" title="Double">b</a> <span title="(x: Double)Double">-</span> <a href="#366884" title="Double">a</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
  * Sums together things in log space.
  * @return log(\sum exp(a_i))
  */</span>
  <span class="keyword">def</span> <a title="(a: Double, b: Double, c: Double*)Double" id="366410">logSum</a><span class="delimiter">(</span><a title="Double" id="366914">a</a>: <span title="Double">Double</span>, <a title="Double" id="366915">b</a>: <span title="Double">Double</span>, <a title="Double*" id="366916">c</a>: <span title="Double*">Double</span>*<span class="delimiter">)</span>: <span title="Double">Double</span> = <span class="delimiter">{</span>
    <span title="Double" class="keyword">if</span> <span class="delimiter">(</span><a href="#366916" title="Double*">c</a>.<span title="=&gt; Int">length</span> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <a href="#366409" title="(a: Double, b: Double)Double">logSum</a><span class="delimiter">(</span><a href="#366914" title="Double">a</a>, <a href="#366915" title="Double">b</a><span class="delimiter">)</span>
    <span class="keyword">else</span>
      <a href="#366412" title="(a: Seq[Double])Double">logSum</a><span class="delimiter">(</span><a href="#366409" title="(a: Double, b: Double)Double">logSum</a><span class="delimiter">(</span><a href="#366914" title="Double">a</a>, <a href="#366915" title="Double">b</a><span class="delimiter">)</span> <a href="#366942" title="(elem: Double)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[Double],Double,Seq[Double]])Seq[Double]">+:</a> <a href="#366916" title="Double*">c</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
  * Sums together things in log space.
  * @return log(\sum exp(a_i))
  */</span>
  <span class="keyword">def</span> <a title="(iter: Iterator[Double], max: Double)Double" id="366411">logSum</a><span class="delimiter">(</span><a title="Iterator[Double]" id="366933">iter</a>: <span title="Iterator[Double]">Iterator</span><span class="delimiter">[</span>Double<span class="delimiter">]</span>, <a title="Double" id="366934">max</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Double">Double</span> = <span class="delimiter">{</span>
    <span title="(requirement: Boolean)Unit">require</span><span class="delimiter">(</span><a href="#366933" title="Iterator[Double]">iter</a>.<span title="=&gt; Boolean">hasNext</span><span class="delimiter">)</span>
    <span title="Double" class="keyword">if</span> <span class="delimiter">(</span><a href="#366934" title="implicit scala.Predef.double2Double : (x: Double)java.lang.Double">max</a>.<span title="()Boolean">isInfinite</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#366934" title="Double">max</a>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Double" id="366997">aux</a> = <span class="delimiter">(</span><span title="Double(0.0)" class="double">0.0</span> <a href="#366998" title="(z: Double)(op: (Double, Double) =&gt; Double)Double">/:</a> <a href="#366933" title="Iterator[Double]">iter</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="delimiter">(</span><a title="Double" id="367011">acc</a>, <a title="Double" id="367012">x</a><span class="delimiter">)</span> =&gt; <span title="Double" class="keyword">if</span> <span class="delimiter">(</span><a href="#367012" title="implicit scala.LowPriorityImplicits.doubleWrapper : (x: Double)scala.runtime.RichDouble">x</a>.<span title="=&gt; Boolean">isNegInfinity</span><span class="delimiter">)</span> <a href="#367011" title="Double">acc</a> <span class="keyword">else</span> <a href="#367011" title="Double">acc</a> <span title="(x: Double)Double">+</span> math.<span title="(x: Double)Double">exp</span><span class="delimiter">(</span><a href="#367012" title="Double">x</a><span title="(x: Double)Double">-</span><a href="#366934" title="Double">max</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span title="Double" class="keyword">if</span> <span class="delimiter">(</span><a href="#366997" title="Double">aux</a> <span title="(x: Int)Boolean">!=</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
        <a href="#366934" title="Double">max</a> <span title="(x: Double)Double">+</span> <span title="(x: Double)Double">log</span><span class="delimiter">(</span><a href="#366997" title="Double">aux</a><span class="delimiter">)</span>
      <span class="keyword">else</span>
        <a href="#366934" title="Double">max</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
  * Sums together things in log space.
  * @return log(\sum exp(a_i))
  */</span>
  <span class="keyword">def</span> <a title="(a: Seq[Double])Double" id="366412">logSum</a><span class="delimiter">(</span><a title="Seq[Double]" id="366930">a</a>: <span title="Seq[Double]">Seq</span><span class="delimiter">[</span>Double<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Double">Double</span> = <span class="delimiter">{</span>
    <a href="#366930" title="Seq[Double]">a</a>.<span title="=&gt; Int">length</span> <span title="Double" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Double(-Infinity)" class="int">0</span> =&gt; Double.<span title="Double(-Infinity)">NegativeInfinity</span>
      <span class="keyword">case</span> <span title="Double" class="int">1</span> =&gt; <a href="#366930" title="(idx: Int)Double">a</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Double" class="int">2</span> =&gt; <a href="#366409" title="(a: Double, b: Double)Double">logSum</a><span class="delimiter">(</span><a href="#366930" title="(idx: Int)Double">a</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>, <a href="#366930" title="(idx: Int)Double">a</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Double">_</span> =&gt; <a href="#366411" title="(iter: Iterator[Double], max: Double)Double">logSum</a><span class="delimiter">(</span><a href="#366930" title="Seq[Double]">a</a>.<span title="=&gt; Iterator[Double]">iterator</span>, <a href="#366930" title="Seq[Double]">a</a> <span title="(op: (Double, Double) =&gt; Double)Double">reduceLeft</span> <span class="delimiter">(</span><a href="#367086" title="implicit scala.LowPriorityImplicits.doubleWrapper : (x: Double)scala.runtime.RichDouble">_</a> <span title="(that: Double)Double">max</span> <a href="#367087" title="Double">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Sums together the first length elements in log space.
   * The length parameter is used to make things faster.
   *
   * This method needs to be fast. Don't scala-ify it.
   * @return log(\sum^length exp(a_i))
   */</span>
  <span class="keyword">def</span> <a title="(a: Array[Double], length: Int)Double" id="366413">logSum</a><span class="delimiter">(</span><a title="Array[Double]" id="366927">a</a>: <span title="Array[Double]">Array</span><span class="delimiter">[</span>Double<span class="delimiter">]</span>, <a title="Int" id="366928">length</a>: <span title="Int">Int</span><span class="delimiter">)</span>:<span title="Double">Double</span> = <span class="delimiter">{</span>
    <a href="#366928" title="Int">length</a> <span title="Double" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Double(-Infinity)" class="int">0</span> =&gt; Double.<span title="Double(-Infinity)">NegativeInfinity</span>;
      <span class="keyword">case</span> <span title="Double" class="int">1</span> =&gt; <a href="#366927" title="(i: Int)Double">a</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="Double" class="int">2</span> =&gt; <a href="#366409" title="(a: Double, b: Double)Double">logSum</a><span class="delimiter">(</span><a href="#366927" title="(i: Int)Double">a</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>,<a href="#366927" title="(i: Int)Double">a</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>;
      <span class="keyword">case</span> <span title="Double">_</span> =&gt;
        <span class="keyword">val</span> <a title="Double" id="367165">m</a> = <a href="#366414" title="(a: Array[Double], length: Int)Double">max</a><span class="delimiter">(</span><a href="#366927" title="Array[Double]">a</a>, <a href="#366928" title="Int">length</a><span class="delimiter">)</span>;
        <span title="Double" class="keyword">if</span><span class="delimiter">(</span><a href="#367165" title="implicit scala.Predef.double2Double : (x: Double)java.lang.Double">m</a>.<span title="()Boolean">isInfinite</span><span class="delimiter">)</span> <a href="#367165" title="Double">m</a>
        <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">var</span> <a title="Int" id="367187">i</a> = <span title="Int(0)" class="int">0</span>;
          <span class="keyword">var</span> <a title="Double" id="367188">accum</a> = <span title="Double(0.0)" class="double">0.0</span>;
          <span title="Unit" class="keyword">while</span><span class="delimiter">(</span><a href="#367187" title="Int">i</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#366928" title="Int">length</a><span class="delimiter">)</span> <a href="#367189" title="()Unit" class="delimiter">{</a>
            <a href="#367188" title="Double">accum</a> <span title="(x: Double)Double">+=</span> <span title="(x: Double)Double">exp</span><span class="delimiter">(</span><a href="#366927" title="(i: Int)Double">a</a><span class="delimiter">(</span><a href="#367187" title="Int">i</a><span class="delimiter">)</span> <span title="(x: Double)Double">-</span> <a href="#367165" title="Double">m</a><span class="delimiter">)</span>;
            <a href="#367187" title="Int">i</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>;
          <span class="delimiter">}</span>
          <a href="#367165" title="Double">m</a> <span title="(x: Double)Double">+</span> <span title="(x: Double)Double">log</span><span class="delimiter">(</span><a href="#367188" title="Double">accum</a><span class="delimiter">)</span>;
        <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">// fast versions of max. Useful for the fast logsum.</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(a: Array[Double], length: Int)Double" id="366414">max</a><span class="delimiter">(</span><a title="Array[Double]" id="367166">a</a>: <span title="Array[Double]">Array</span><span class="delimiter">[</span>Double<span class="delimiter">]</span>, <a title="Int" id="367167">length</a>: <span title="Int">Int</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Int" id="367170">i</a> = <span title="Int(1)" class="int">1</span>;
    <span class="keyword">var</span> <a title="Double" id="367171">max</a> =  <a href="#367166" title="(i: Int)Double">a</a><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span>;
    <span title="Unit" class="keyword">while</span><span class="delimiter">(</span><a href="#367170" title="Int">i</a> <span title="(x: Int)Boolean">&lt;</span> <a href="#367167" title="Int">length</a><span class="delimiter">)</span> <a href="#367172" title="()Unit" class="delimiter">{</a>
      <span title="Unit" class="keyword">if</span><span class="delimiter">(</span><a href="#367166" title="(i: Int)Double">a</a><span class="delimiter">(</span><a href="#367170" title="Int">i</a><span class="delimiter">)</span> <span title="(x: Double)Boolean">&gt;</span> <a href="#367171" title="Double">max</a><span class="delimiter">)</span> <a href="#367171" title="Double">max</a> = <a href="#367166" title="(i: Int)Double">a</a><span class="delimiter">(</span><a href="#367170" title="Int">i</a><span class="delimiter">)</span>;
      <a href="#367170" title="Int">i</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>;
    <span class="delimiter">}</span>
    <a href="#367171" title="Double">max</a>;

  <span class="delimiter">}</span>

  <span class="comment">/**
   * The sigmoid function: 1/(1 + exp(-x));
   */</span>
  <span class="keyword">def</span> <a title="(x: Double)Double" id="366415">sigmoid</a><span class="delimiter">(</span><a title="Double" id="367210">x</a>: <span title="Double">Double</span><span class="delimiter">)</span> = <span title="Int(1)" class="int">1</span><span title="(x: Double)Double">/</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span title="(x: Double)Double">+</span><span title="(x: Double)Double">exp</span><span class="delimiter">(</span><span title="=&gt; Double">-</span><a href="#367210" title="Double">x</a><span class="delimiter">)</span><span class="delimiter">)</span>;


  <span class="comment">/**
   * Takes the difference of two doubles in log space. Requires a &amp;gt b.
   * Note that this only works if a and b are close in value. For a &amp;gt;&amp;gt; b,
   * this will almost certainly do nothing. (exp(30) - exp(1) \approx exp(30))
   *
   * @return log(exp(a) - exp(b))
   */</span>
  <span class="keyword">def</span> <a title="(a: Double, b: Double)Double" id="366416">logDiff</a><span class="delimiter">(</span><a title="Double" id="367221">a</a>: <span title="Double">Double</span>, <a title="Double" id="367222">b</a>: <span title="Double">Double</span><span class="delimiter">)</span>: <span title="Double">Double</span> = <span class="delimiter">{</span>
    <span title="(requirement: Boolean)Unit">require</span><span class="delimiter">(</span><a href="#367221" title="Double">a</a> <span title="(x: Double)Boolean">&gt;=</span> <a href="#367222" title="Double">b</a><span class="delimiter">)</span>
    <span title="Double" class="keyword">if</span> <span class="delimiter">(</span><a href="#367221" title="Double">a</a> <span title="(x: Double)Boolean">&gt;</span> <a href="#367222" title="Double">b</a><span class="delimiter">)</span> <a href="#367221" title="Double">a</a> <span title="(x: Double)Double">+</span> math.<span title="(x: Double)Double">log</span><span class="delimiter">(</span><span title="Double(1.0)" class="double">1.0</span> <span title="(x: Double)Double">-</span> math.<span title="(x: Double)Double">exp</span><span class="delimiter">(</span><a href="#367222" title="Double">b</a><span title="(x: Double)Double">-</span><a href="#367221" title="Double">a</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">else</span> Double.<span title="Double(-Infinity)">NegativeInfinity</span>
  <span class="delimiter">}</span>

  <span class="comment">/**
   * Computes the polynomial P(x) with coefficients given in the passed in array.
   * coefs(i) is the coef for the x^i term.
   */</span>
  <span class="keyword">def</span> <a title="(coefs: Array[Double], x: Double)Double" id="366417">poly</a><span class="delimiter">(</span><a title="Array[Double]" id="367246">coefs</a>: <span title="Array[Double]">Array</span><span class="delimiter">[</span>Double<span class="delimiter">]</span>, <a title="Double" id="367247">x</a>: <span title="Double">Double</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">var</span> <a title="Int" id="367250">i</a> = <a href="#367246" title="Array[Double]">coefs</a>.<span title="=&gt; Int">length</span><span title="(x: Int)Int">-</span><span title="Int(1)" class="int">1</span>;
    <span class="keyword">var</span> <a title="Double" id="367251">p</a> = <a href="#367246" title="(i: Int)Double">coefs</a><span class="delimiter">(</span><a href="#367250" title="Int">i</a><span class="delimiter">)</span>;
    <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#367250" title="Int">i</a><span title="(x: Int)Boolean">&gt;</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#367252" title="()Unit" class="delimiter">{</a>
      <a href="#367250" title="Int">i</a> <span title="(x: Int)Int">-=</span> <span title="Int(1)" class="int">1</span>;
      <a href="#367251" title="Double">p</a> = <a href="#367251" title="Double">p</a><span title="(x: Double)Double">*</span><a href="#367247" title="Double">x</a> <span title="(x: Double)Double">+</span> <a href="#367246" title="(i: Int)Double">coefs</a><span class="delimiter">(</span><a href="#367250" title="Int">i</a><span class="delimiter">)</span>;
    <span class="delimiter">}</span>
    <a href="#367251" title="Double">p</a>
  <span class="delimiter">}</span>

<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object scalala.library.Numerics" id="12743">Numerics</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#12742" title="scalala.library.Numerics">Numerics</a>

        </pre>
    </body>
</html>
<?xml version="1.0" encoding="utf-8"?>
      <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <meta http-equiv="Expires" content="0" />
        <title>org/specs2/html/TableOfContents.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> org.specs2
<span class="keyword">package</span> html

<span class="keyword">import</span> scala.xml._
<span class="keyword">import</span> transform.<span class="delimiter">{</span>RewriteRule, RuleTransformer<span class="delimiter">}</span>
<span class="keyword">import</span> org.specs2.internal.scalaz.<span class="delimiter">{</span> TreeLoc, Scalaz, Show <span class="delimiter">}</span>
<span class="keyword">import</span> <span title="object org.specs2.internal.scalaz.Scalaz">Scalaz</span>._
<span class="keyword">import</span> data.<a href="../data/Trees.scala.html#9635" title="object org.specs2.data.Trees">Trees</a>._
<span class="keyword">import</span> xml.<a href="../xml/Nodex.scala.html#11821" title="object org.specs2.xml.Nodex">Nodex</a>._
<span class="comment">/**
 * This trait checks for the presence of a &lt;toc/&gt; tag at the beginning of a xml document and replaces it
 * by a list of links to the headers of the document
 */</span>
<span class="keyword">private</span><span class="delimiter">[</span>specs2<span class="delimiter">]</span>
<span class="keyword">trait</span> <a title="trait TableOfContents extends java.lang.Object with ScalaObject" id="9923">TableOfContents</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="comment">/**
   * create anchors for each header element and add a table of content to the node if the &lt;toc/&gt; tag is present
   */</span>
  <span class="keyword">def</span> <a title="(body: scala.xml.Node)scala.xml.NodeSeq" id="93924">addToc</a><span class="delimiter">(</span><a title="scala.xml.Node" id="94581">body</a>: <span title="scala.xml.Node">Node</span><span class="delimiter">)</span>: <span title="scala.xml.NodeSeq">NodeSeq</span> = <a href="#93943" title="object TableOfContents.this.anchor">anchor</a>.<a href="#94585" title="(n: scala.xml.Node)scala.xml.Node">addTo</a><span title="(x: =&gt; scala.xml.Node)org.specs2.internal.scalaz.Identity[scala.xml.Node]" class="delimiter">(</span><a href="#94581" title="scala.xml.Node">body</a><span class="delimiter">)</span> <span title="(f: scala.xml.Node =&gt; scala.xml.Node)scala.xml.Node">|&gt;</span> <a href="#93946" title="=&gt; scala.xml.Node =&gt; scala.xml.Node">insertToc</a>

  <span class="comment">/** sanitize a string so that it can be used as a href */</span>
  <span class="keyword">def</span> <a title="(s: String)java.lang.String" id="93925">sanitize</a><span class="delimiter">(</span><a title="String" id="94284">s</a>: <span title="String">String</span><span class="delimiter">)</span> = java.net.<span title="object java.net.URLEncoder">URLEncoder</span>.<span title="(x$1: java.lang.String, x$2: java.lang.String)java.lang.String">encode</span><span class="delimiter">(</span><a href="#94284" title="String">s</a>, <span title="java.lang.String(&quot;UTF-8&quot;)" class="string">&quot;UTF-8&quot;</span><span class="delimiter">)</span>
  <span class="comment">/** create a sanitized anchor name */</span>
  <span class="keyword">def</span> <a title="(name: String)java.lang.String" id="93926">anchorName</a><span class="delimiter">(</span><a title="String" id="94281">name</a>: <span title="String">String</span><span class="delimiter">)</span> = <span title="java.lang.String(&quot;#&quot;)" class="string">&quot;#&quot;</span><span title="(x$1: Any)java.lang.String">+</span><a href="#93925" title="(s: String)java.lang.String">sanitize</a><span class="delimiter">(</span><a href="#94281" title="String">name</a><span class="delimiter">)</span>

  <span class="comment">/** @return all the headers of a document */</span>
  <span class="keyword">def</span> <a title="(body: scala.xml.NodeSeq)scala.xml.NodeSeq" id="93927">headers</a><span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="94557">body</a>: <span title="scala.xml.NodeSeq">NodeSeq</span><span class="delimiter">)</span>: <span title="scala.xml.NodeSeq">NodeSeq</span> = <span class="delimiter">{</span>
    <a href="#94557" title="scala.xml.NodeSeq">body</a>.<span title="=&gt; List[scala.xml.Node]">toList</span> <span title="scala.xml.NodeSeq" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="scala.xml.NodeSeq" id="94670">e</a> :: <a title="List[scala.xml.Node]" id="94671">rest</a> <span class="keyword">if</span> <a href="#93941" title="(e: scala.xml.Node)Boolean">isHeader</a><span class="delimiter">(</span><a href="#94670" title="scala.xml.Node">e</a><span class="delimiter">)</span> =&gt; <a href="#94670" title="scala.xml.Node">e</a> <span title="(that: scala.collection.GenTraversableOnce[scala.xml.Node])(implicit bf: scala.collection.generic.CanBuildFrom[scala.xml.NodeSeq,scala.xml.Node,scala.xml.NodeSeq])scala.xml.NodeSeq">++</span> <a href="#93927" title="(body: scala.xml.NodeSeq)scala.xml.NodeSeq">headers</a><span class="delimiter">(</span><a href="#94671" title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">rest</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="scala.xml.NodeSeq" class="delimiter">(</span><a title="scala.xml.Elem" id="94742">e</a>:<span title="scala.xml.Elem">Elem</span><span class="delimiter">)</span> :: <a title="List[scala.xml.Node]" id="94743">rest</a>         =&gt; <a href="#93927" title="(body: scala.xml.NodeSeq)scala.xml.NodeSeq">headers</a><span class="delimiter">(</span><a href="#94742" title="scala.xml.Elem">e</a>.<span title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">child</span><span class="delimiter">)</span> <span title="(that: scala.collection.GenTraversableOnce[scala.xml.Node])(implicit bf: scala.collection.generic.CanBuildFrom[scala.xml.NodeSeq,scala.xml.Node,scala.xml.NodeSeq])scala.xml.NodeSeq">++</span> <a href="#93927" title="(body: scala.xml.NodeSeq)scala.xml.NodeSeq">headers</a><span class="delimiter">(</span><a href="#94743" title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">rest</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="scala.xml.NodeSeq" id="94842">e</a> :: <a title="List[scala.xml.Node]" id="94843">rest</a>                =&gt; <a href="#93927" title="(body: scala.xml.NodeSeq)scala.xml.NodeSeq">headers</a><span class="delimiter">(</span><a href="#94843" title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">rest</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <span title="scala.xml.NodeSeq">Nil</span>                      =&gt; <span title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">Nil</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  <span class="comment">/** collect all the headers as a Tree */</span>
  <span class="keyword">def</span> <a title="(body: scala.xml.NodeSeq, headers: org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header])org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]" id="93928">headersToTree</a><span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="94208">body</a>: <span title="scala.xml.NodeSeq">NodeSeq</span>, <a title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]" id="94211">headers</a>: <span title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">TreeLoc</span><span class="delimiter">[</span>Header<span class="delimiter">]</span> = <span title="(root: =&gt; TableOfContents.this.Header)org.specs2.internal.scalaz.Tree[TableOfContents.this.Header]">leaf</span><span class="delimiter">(</span><a href="#94924" title="(level: Int, name: String)TableOfContents.this.Header">Header</a><span class="delimiter">(</span><span title="Int(1)" class="int">1</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="=&gt; org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">loc</span><span class="delimiter">)</span>: <span title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">TreeLoc</span><span class="delimiter">[</span>Header<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(headers: org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header], level: Int)org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]" id="94934">goUpUntil</a><span class="delimiter">(</span><a title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]" id="94935">headers</a>: <span title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">TreeLoc</span><span class="delimiter">[</span>Header<span class="delimiter">]</span>, <a title="Int" id="94936">level</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">TreeLoc</span><span class="delimiter">[</span>Header<span class="delimiter">]</span> =
      <span title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]" class="keyword">if</span> <span class="delimiter">(</span><a href="#94935" title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">headers</a>.<span title="=&gt; org.specs2.internal.scalaz.Tree[TableOfContents.this.Header]">tree</span>.<span title="=&gt; TableOfContents.this.Header">rootLabel</span>.<a href="#94926" title="=&gt; Int">level</a> <span title="(x: Int)Boolean">&gt;</span> <a href="#94936" title="Int">level</a><span class="delimiter">)</span> <a href="#94935" title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">headers</a>.<span title="=&gt; Option[org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]]">parent</span>.<span title="(f: org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header] =&gt; org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header])Option[org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]]">map</span><span class="delimiter">(</span><a href="#94934" title="(headers: org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header], level: Int)org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">goUpUntil</a><span class="delimiter">(</span><a href="#94945" title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">_</a>, <a href="#94936" title="Int">level</a><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(default: =&gt; org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header])org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">getOrElse</span><span class="delimiter">(</span><a href="#94935" title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">headers</a><span class="delimiter">)</span>
      <span class="keyword">else</span> <a href="#94935" title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">headers</a>

    <a href="#94208" title="scala.xml.NodeSeq">body</a>.<span title="=&gt; List[scala.xml.Node]">toList</span> <span title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]" id="94956">e</a> :: <a title="List[scala.xml.Node]" id="94957">rest</a> =&gt; <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="Int" id="94958">eLevel</a> = <a href="#93942" title="(e: scala.xml.Node)Int">headerNumber</a><span class="delimiter">(</span><a href="#94956" title="scala.xml.Node">e</a><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="Int" id="94959">currentLevel</a> = <a href="#94211" title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">headers</a>.<span title="=&gt; org.specs2.internal.scalaz.Tree[TableOfContents.this.Header]">tree</span>.<span title="=&gt; TableOfContents.this.Header">rootLabel</span>.<a href="#94926" title="=&gt; Int">level</a>
        <span class="keyword">val</span> <a title="org.specs2.internal.scalaz.Tree[TableOfContents.this.Header]" id="94960">header</a> = <span title="(root: =&gt; TableOfContents.this.Header)org.specs2.internal.scalaz.Tree[TableOfContents.this.Header]">leaf</span><span class="delimiter">(</span><a href="#94924" title="(level: Int, name: String)TableOfContents.this.Header">Header</a><span class="delimiter">(</span><a href="#94958" title="Int">eLevel</a>, <a href="#93938" title="(n: scala.xml.Node)String">nodeText</a><span class="delimiter">(</span><a href="#94956" title="scala.xml.Node">e</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">val</span> <a title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]" id="94961">newHeaders</a> = <span title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]" class="keyword">if</span> <span class="delimiter">(</span><a href="#94958" title="Int">eLevel</a> <span title="(x: Int)Boolean">==</span> <a href="#94959" title="Int">currentLevel</a><span class="delimiter">)</span>
          <a href="#94211" title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">headers</a>.<span title="(t: org.specs2.internal.scalaz.Tree[TableOfContents.this.Header])org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">insertRight</span><span class="delimiter">(</span><a href="#94960" title="org.specs2.internal.scalaz.Tree[TableOfContents.this.Header]">header</a><span class="delimiter">)</span>
        <span class="keyword">else</span> <span title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]" class="keyword">if</span> <span class="delimiter">(</span><a href="#94958" title="Int">eLevel</a> <span title="(x: Int)Boolean">&gt;</span> <a href="#94959" title="Int">currentLevel</a><span class="delimiter">)</span>
          <a href="#94211" title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">headers</a>.<span title="(t: org.specs2.internal.scalaz.Tree[TableOfContents.this.Header])org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">insertDownLast</span><span class="delimiter">(</span><a href="#94960" title="org.specs2.internal.scalaz.Tree[TableOfContents.this.Header]">header</a><span class="delimiter">)</span>
        <span class="keyword">else</span> <span class="delimiter">{</span>
          <span class="keyword">val</span> <a title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]" id="95013">parent</a> = <a href="#94934" title="(headers: org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header], level: Int)org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">goUpUntil</a><span class="delimiter">(</span><a href="#94211" title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">headers</a>, <a href="#94958" title="Int">eLevel</a><span class="delimiter">)</span>
          <span title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]" class="keyword">if</span> <span class="delimiter">(</span><a href="#95013" title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">parent</a>.<span title="=&gt; org.specs2.internal.scalaz.Tree[TableOfContents.this.Header]">tree</span>.<span title="=&gt; TableOfContents.this.Header">rootLabel</span>.<a href="#94926" title="=&gt; Int">level</a> <span title="(x: Int)Boolean">==</span> <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
            <a href="#95013" title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">parent</a>.<span title="(t: org.specs2.internal.scalaz.Tree[TableOfContents.this.Header])org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">insertDownLast</span><span class="delimiter">(</span><a href="#94960" title="org.specs2.internal.scalaz.Tree[TableOfContents.this.Header]">header</a><span class="delimiter">)</span>
          <span class="keyword">else</span>
            <a href="#95013" title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">parent</a>.<span title="(t: org.specs2.internal.scalaz.Tree[TableOfContents.this.Header])org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">insertRight</span><span class="delimiter">(</span><a href="#94960" title="org.specs2.internal.scalaz.Tree[TableOfContents.this.Header]">header</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <a href="#93928" title="(body: scala.xml.NodeSeq, headers: org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header])org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">headersToTree</a><span class="delimiter">(</span><a href="#94957" title="implicit scala.xml.NodeSeq.seqToNodeSeq : (s: Seq[scala.xml.Node])scala.xml.NodeSeq">rest</a>, <a href="#94961" title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">newHeaders</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
      <span class="keyword">case</span> <span title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">Nil</span>       =&gt; <a href="#94211" title="org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">headers</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  case <span class="keyword">class</span> <a title="class Header extends java.lang.Object with ScalaObject with Product with Serializable" id="94924">Header</a><a href="#94924" title="ScalaObject" class="delimiter">(</a><a title="Int" id="94926">level</a>: <span title="Int">Int</span>, <a title="String" id="94927">name</a>: <span title="String">String</span><span class="delimiter">)</span>
  <span class="keyword">implicit</span> <span class="keyword">object</span> <a title="object TableOfContents.this.HeaderShow" id="93932">HeaderShow</a> <span title="ScalaObject" class="keyword">extends</span> <span title="org.specs2.internal.scalaz.Show[TableOfContents.this.Header]">Show</span><span class="delimiter">[</span>Header<span class="delimiter">]</span> <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="(h: TableOfContents.this.Header)List[Char]" id="94131">show</a><span class="delimiter">(</span><a title="TableOfContents.this.Header" id="95116">h</a> : <a href="#94924" title="TableOfContents.this.Header">Header</a><span class="delimiter">)</span> = <a href="#95116" title="TableOfContents.this.Header">h</a>.<a href="#94927" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">name</a>.<span title="=&gt; List[Char]">toList</span>
  <span class="delimiter">}</span>

  <span class="comment">/** @return the toc of a document by building a Tree of all the headers and mapping it to an &lt;ul/&gt; list */</span>
  <span class="keyword">def</span> <a title="(body: scala.xml.NodeSeq, url: String, id: Int, subToc: scala.xml.NodeSeq)scala.xml.NodeSeq" id="93934">tocElements</a><span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="95303">body</a>: <span title="scala.xml.NodeSeq">NodeSeq</span>, <a title="String" id="95309">url</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <a title="Int" id="95310">id</a>: <span title="Int">Int</span> = <span title="Int(0)" class="int">0</span>, <a title="scala.xml.NodeSeq" id="95311">subToc</a>: <span title="scala.xml.NodeSeq">NodeSeq</span> = <span title="object scala.xml.NodeSeq">NodeSeq</span>.<span title="=&gt; scala.xml.NodeSeq">Empty</span><span class="delimiter">)</span> = <a href="#93935" title="(body: scala.xml.NodeSeq, url: String, id: Int, subToc: scala.xml.NodeSeq)scala.xml.NodeSeq">headersTocElements</a><span class="delimiter">(</span><a href="#93927" title="(body: scala.xml.NodeSeq)scala.xml.NodeSeq">headers</a><span class="delimiter">(</span><a href="#95303" title="scala.xml.NodeSeq">body</a><span class="delimiter">)</span>, <a href="#95309" title="String">url</a>, <a href="#95310" title="Int">id</a>, <a href="#95311" title="scala.xml.NodeSeq">subToc</a><span class="delimiter">)</span>

  <span class="comment">/** @return the toc of a document by building a Tree of all the headers and mapping it to a list of &lt;li/&gt; */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(body: scala.xml.NodeSeq, url: String, id: Int, subToc: scala.xml.NodeSeq)scala.xml.NodeSeq" id="93935">headersTocElements</a><span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="95312">body</a>: <span title="scala.xml.NodeSeq">NodeSeq</span>, <a title="String" id="95318">url</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <a title="Int" id="95319">id</a>: <span title="Int">Int</span> = <span title="Int(0)" class="int">0</span>, <a title="scala.xml.NodeSeq" id="95320">subToc</a>: <span title="scala.xml.NodeSeq">NodeSeq</span> = <span title="object scala.xml.NodeSeq">NodeSeq</span>.<span title="=&gt; scala.xml.NodeSeq">Empty</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#93928" title="(body: scala.xml.NodeSeq, headers: org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header])org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">headersToTree</a><span class="delimiter">(</span><a href="#95312" title="scala.xml.NodeSeq">body</a><span class="delimiter">)</span>.<a href="../data/Trees.scala.html#69028" title="(t: org.specs2.internal.scalaz.Tree[TableOfContents.this.Header])org.specs2.data.Trees.Treex[TableOfContents.this.Header]">toTree</a>.
    <a href="../data/Trees.scala.html#69088" title="(f: (TableOfContents.this.Header, Stream[scala.xml.NodeSeq]) =&gt; scala.xml.NodeSeq)org.specs2.internal.scalaz.Tree[scala.xml.NodeSeq]">bottomUp</a> <span class="delimiter">{</span> <span class="delimiter">(</span>h: <a href="#94924" title="TableOfContents.this.Header">Header</a>, s: <span title="Stream[scala.xml.NodeSeq]">Stream</span><span class="delimiter">[</span>NodeSeq<span class="delimiter">]</span><span class="delimiter">)</span> =&gt;
      <span title="scala.xml.NodeSeq" class="keyword">if</span> <span class="delimiter">(</span><a href="#95364" title="TableOfContents.this.Header">h</a>.<a href="#94927" title="=&gt; String">name</a>.<span title="()Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="List[scala.xml.Node]" id="95366">headers</a> = <a href="#95365" title="Stream[scala.xml.NodeSeq]">s</a>.<span title="(f: scala.xml.NodeSeq =&gt; scala.collection.GenTraversableOnce[scala.xml.Node])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Stream[scala.xml.NodeSeq],scala.xml.Node,scala.collection.immutable.Stream[scala.xml.Node]])scala.collection.immutable.Stream[scala.xml.Node]">flatMap</span><a href="../xml/Nodex.scala.html#57828" title="implicit org.specs2.xml.Nodex.reducable : (ns: Seq[scala.xml.NodeSeq])org.specs2.xml.Nodex.Reducable" class="delimiter">(</a><a href="#95390" title="scala.xml.NodeSeq">_</a>.<span title="=&gt; scala.collection.immutable.Seq[scala.xml.Node]">toSeq</span><span class="delimiter">)</span>.<a href="../xml/Nodex.scala.html#73961" title="=&gt; scala.xml.NodeSeq">reduceNodes</a>.<span title="=&gt; List[scala.xml.Node]">toList</span>
        <span class="keyword">val</span> <a title="List[scala.xml.Node]" id="95367">headersWithId</a> = <a href="#95366" title="List[scala.xml.Node]">headers</a> <span title="List[scala.xml.Node]" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="List[scala.xml.Node]" class="delimiter">(</span><a title="scala.xml.Elem" id="95503">e</a>:<span title="scala.xml.Elem">Elem</span><span class="delimiter">)</span> :: <a title="List[scala.xml.Node]" id="95504">rest</a> =&gt; <span class="delimiter">(</span><a href="#95503" title="scala.xml.Elem">e</a> <span title="(updates: scala.xml.MetaData)scala.xml.Elem">%</span> <span class="delimiter">(</span><span title="(x: java.lang.String)ArrowAssoc[java.lang.String]" class="string">&quot;id&quot;</span> <a href="../xml/Nodex.scala.html#57837" title="implicit org.specs2.xml.Nodex.pairToUnprefixedAttribute : (pair: (Any, Any))scala.xml.UnprefixedAttribute">-&gt;</a> <a href="#95319" title="Int">id</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#95505" title="(x: scala.xml.Node)List[scala.xml.Node]">::</a> <a href="#95504" title="List[scala.xml.Node]">rest</a>
          <span class="keyword">case</span> <a title="List[scala.xml.Node]" id="95573">other</a>            =&gt; <a href="#95573" title="List[scala.xml.Node]">other</a>
        <span class="delimiter">}</span>
        <a href="../xml/Nodex.scala.html#57828" title="implicit org.specs2.xml.Nodex.reducable : (ns: Seq[scala.xml.NodeSeq])org.specs2.xml.Nodex.Reducable">headersWithId</a>.<a href="../xml/Nodex.scala.html#73961" title="=&gt; scala.xml.NodeSeq">reduceNodes</a>
      <span class="delimiter">}</span>
      <span class="keyword">else</span>
        &lt;<a title="scala.xml.Elem" id="95615">li</a>&gt;&lt;<a title="scala.xml.MetaData" id="95621">a</a> href=<span class="delimiter">{</span><a href="#95318" title="String">url</a><span title="(x$1: Any)java.lang.String">+</span><a href="#93926" title="(name: String)java.lang.String">anchorName</a><span class="delimiter">(</span><a href="#95364" title="TableOfContents.this.Header">h</a>.<a href="#94927" title="=&gt; String">name</a><span class="delimiter">)</span><span class="delimiter">}</span>&gt;<span class="delimiter">{</span><a href="#95364" title="TableOfContents.this.Header">h</a>.<a href="#94927" title="=&gt; String">name</a><span class="delimiter">}</span>&lt;/a&gt;
          <span class="delimiter">{</span> &lt;<a title="scala.xml.Elem" id="95622">ul</a>&gt;<span class="delimiter">{</span><a href="#95365" title="Stream[scala.xml.NodeSeq]">s</a>.<span title="=&gt; scala.collection.immutable.Seq[scala.xml.NodeSeq]">toSeq</span> <span title="(that: scala.collection.GenTraversableOnce[scala.xml.NodeSeq])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.immutable.Seq[scala.xml.NodeSeq],scala.xml.NodeSeq,Any])Any">++</span> <a href="#95320" title="scala.xml.NodeSeq">subToc</a><span class="delimiter">}</span>&lt;/ul&gt; <span class="delimiter">}</span>
        &lt;/li&gt;
    <span class="delimiter">}</span>.<span title="=&gt; scala.xml.NodeSeq">rootLabel</span>
  <span class="delimiter">}</span>

  <span class="comment">/** @return the toc of a document by building a Tree of all the headers and mapping it to an &lt;ul/&gt; list */</span>
  <span class="keyword">def</span> <a title="(body: scala.xml.NodeSeq, url: String)scala.xml.NodeSeq" id="93936">toc</a><span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="95719">body</a>: <span title="scala.xml.NodeSeq">NodeSeq</span>, <a title="String" id="95723">url</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> = <a href="#93937" title="(body: scala.xml.NodeSeq, url: String)scala.xml.NodeSeq">headersToc</a><span class="delimiter">(</span><a href="#93927" title="(body: scala.xml.NodeSeq)scala.xml.NodeSeq">headers</a><span class="delimiter">(</span><a href="#95719" title="scala.xml.NodeSeq">body</a><span class="delimiter">)</span>, <a href="#95723" title="String">url</a><span class="delimiter">)</span>

  <span class="comment">/** @return the toc of a document by building a Tree of all the headers and mapping it to an &lt;ul/&gt; list */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(body: scala.xml.NodeSeq, url: String)scala.xml.NodeSeq" id="93937">headersToc</a><span class="delimiter">(</span><a title="scala.xml.NodeSeq" id="94203">body</a>: <span title="scala.xml.NodeSeq">NodeSeq</span>, <a title="String" id="94207">url</a>: <span title="String">String</span> = <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#93928" title="(body: scala.xml.NodeSeq, headers: org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header])org.specs2.internal.scalaz.TreeLoc[TableOfContents.this.Header]">headersToTree</a><span class="delimiter">(</span><a href="#94203" title="scala.xml.NodeSeq">body</a><span class="delimiter">)</span>.<a href="../data/Trees.scala.html#69028" title="(t: org.specs2.internal.scalaz.Tree[TableOfContents.this.Header])org.specs2.data.Trees.Treex[TableOfContents.this.Header]">toTree</a>.
    <a href="../data/Trees.scala.html#69088" title="(f: (TableOfContents.this.Header, Stream[scala.xml.NodeSeq]) =&gt; scala.xml.NodeSeq)org.specs2.internal.scalaz.Tree[scala.xml.NodeSeq]">bottomUp</a> <span class="delimiter">{</span> <span class="delimiter">(</span>h: <a href="#94924" title="TableOfContents.this.Header">Header</a>, s: <span title="Stream[scala.xml.NodeSeq]">Stream</span><span class="delimiter">[</span>NodeSeq<span class="delimiter">]</span><span class="delimiter">)</span> =&gt;
      <span class="delimiter">{</span> &lt;<a href="../xml/Nodex.scala.html#57835" title="implicit org.specs2.xml.Nodex.unless : (ns: =&gt; scala.xml.NodeSeq)org.specs2.xml.Nodex.UnlessEmpty" id="94275">li</a> id=<span class="delimiter">{</span><a href="#94268" title="TableOfContents.this.Header">h</a>.<a href="#94927" title="=&gt; String">name</a><span class="delimiter">}</span>&gt;&lt;<a title="scala.xml.MetaData" id="94344">a</a> href=<span class="delimiter">{</span><a href="#94207" title="String">url</a><span title="(x$1: Any)java.lang.String">+</span><a href="#93926" title="(name: String)java.lang.String">anchorName</a><span class="delimiter">(</span><a href="#94268" title="TableOfContents.this.Header">h</a>.<a href="#94927" title="=&gt; String">name</a><span class="delimiter">)</span><span class="delimiter">}</span>&gt;<span class="delimiter">{</span><a href="#94268" title="TableOfContents.this.Header">h</a>.<a href="#94927" title="=&gt; String">name</a><span class="delimiter">}</span>&lt;/a&gt;<span class="delimiter">{</span> &lt;<a href="../xml/Nodex.scala.html#57835" title="implicit org.specs2.xml.Nodex.unless : (ns: =&gt; scala.xml.NodeSeq)org.specs2.xml.Nodex.UnlessEmpty" id="94345">ul</a>&gt;<span class="delimiter">{</span><a href="#94269" title="Stream[scala.xml.NodeSeq]">s</a>.<span title="=&gt; scala.collection.immutable.Seq[scala.xml.NodeSeq]">toSeq</span><span class="delimiter">}</span>&lt;/ul&gt; <a href="../xml/Nodex.scala.html#75521" title="(b: Boolean)scala.xml.NodeSeq">unless</a> <a href="#94269" title="Stream[scala.xml.NodeSeq]">s</a>.<span title="=&gt; Boolean">isEmpty</span> <span class="delimiter">}</span>&lt;/li&gt; <a href="../xml/Nodex.scala.html#75521" title="(b: Boolean)scala.xml.NodeSeq">unless</a> <a href="#94268" title="TableOfContents.this.Header">h</a>.<a href="#94927" title="=&gt; String">name</a>.<span title="()Boolean">isEmpty</span> <span class="delimiter">}</span> <span title="(that: scala.collection.GenTraversableOnce[scala.xml.Node])(implicit bf: scala.collection.generic.CanBuildFrom[scala.xml.NodeSeq,scala.xml.Node,scala.xml.NodeSeq])scala.xml.NodeSeq">++</span>
      <span class="delimiter">{</span> &lt;<a href="../xml/Nodex.scala.html#57835" title="implicit org.specs2.xml.Nodex.unless : (ns: =&gt; scala.xml.NodeSeq)org.specs2.xml.Nodex.UnlessEmpty" id="94480">ul</a>&gt;<span class="delimiter">{</span><a href="#94269" title="Stream[scala.xml.NodeSeq]">s</a>.<span title="=&gt; scala.collection.immutable.Seq[scala.xml.NodeSeq]">toSeq</span><span class="delimiter">}</span>&lt;/ul&gt; <a href="../xml/Nodex.scala.html#75521" title="(b: Boolean)scala.xml.NodeSeq">unless</a> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#94268" title="TableOfContents.this.Header">h</a>.<a href="#94927" title="=&gt; String">name</a>.<span title="()Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">}</span>
    <span class="delimiter">}</span>.<span title="=&gt; scala.xml.NodeSeq">rootLabel</span>
  <span class="delimiter">}</span>

  <span class="comment">/** @return the text of the first child of a Node, removing notoc elements */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>specs2<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(n: scala.xml.Node)String" id="93938">nodeText</a><span class="delimiter">(</span><a title="scala.xml.Node" id="94974">n</a>: <span title="scala.xml.Node">Node</span><span class="delimiter">)</span> = &lt;<a title="scala.xml.Elem" id="94977">a</a>&gt;<span class="delimiter">{</span><a href="#94974" title="scala.xml.Node">n</a>.<span title="=&gt; Seq[scala.xml.Node]">child</span>.<span title="(p: scala.xml.Node =&gt; Boolean)Seq[scala.xml.Node]">filterNot</span><span class="delimiter">(</span><a href="#94987" title="scala.xml.Node">_</a>.<span title="=&gt; String">label</span> <span title="(x$1: AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;notoc&quot;)" class="string">&quot;notoc&quot;</span><span class="delimiter">)</span><span class="delimiter">}</span>&lt;/a&gt;.<span title="=&gt; String">text</span>
  <span class="comment">/** regular expression for a Header Tag */</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.util.matching.Regex" id="93939">HeaderTag</a> = <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;h(\\d)&quot;</span>.<span title="=&gt; scala.util.matching.Regex">r</span>
  <span class="comment">/** @return true if the element is a header and its number satisfies a function */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>specs2<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(e: scala.xml.Node)Boolean" id="93941">isHeader</a><span class="delimiter">(</span><a title="scala.xml.Node" id="94672">e</a>: <span title="scala.xml.Node">Node</span><span class="delimiter">)</span> = <a href="#94672" title="scala.xml.Node">e</a>.<span title="=&gt; String">label</span> <span title="Boolean" class="keyword">match</span> <span class="delimiter">{</span> <span class="keyword">case</span> <a href="#93939" title="Boolean(true)">HeaderTag</a><span class="delimiter">(</span><a title="String" id="94676">i</a><span class="delimiter">)</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>; <span class="keyword">case</span> <span title="Boolean(false)">_</span> =&gt; <span title="Boolean(false)" class="keyword">false</span> <span class="delimiter">}</span>
  <span class="comment">/** @return the header number if any. By convention -1 means &quot;no header&quot; */</span>
  <span class="keyword">private</span><span class="delimiter">[</span>specs2<span class="delimiter">]</span> <span class="keyword">def</span> <a title="(e: scala.xml.Node)Int" id="93942">headerNumber</a><span class="delimiter">(</span><a title="scala.xml.Node" id="94962">e</a>: <span title="scala.xml.Node">Node</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#94962" title="scala.xml.Node">e</a>.<span title="=&gt; String">label</span> <span title="Int" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a href="#93939" title="Int">HeaderTag</a><span class="delimiter">(</span><a title="String" id="94966">i</a><span class="delimiter">)</span> =&gt; <span title="object java.lang.Integer">Integer</span>.<span title="(x$1: java.lang.String)java.lang.Integer">valueOf</span><span class="delimiter">(</span><a href="#94966" title="String">i</a><span class="delimiter">)</span>.<span title="()Int">intValue</span>
      <span class="keyword">case</span> <span title="Int(-1)">_</span>            =&gt; -<span title="Int(-1)" class="int">1</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="comment">/** This rule can be used to add anchors to header elements */</span>
  <span class="keyword">private</span> <span class="keyword">object</span> <a title="object TableOfContents.this.anchor" id="93943">anchor</a> <span title="ScalaObject" class="keyword">extends</span> <span title="scala.xml.transform.RewriteRule">RewriteRule</span> <span class="delimiter">{</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(n: scala.xml.Node)Seq[scala.xml.Node]" id="94584">transform</a><span class="delimiter">(</span><a title="scala.xml.Node" id="95725">n</a>: <span title="scala.xml.Node">Node</span><span class="delimiter">)</span>: <span title="Seq[scala.xml.Node]">Seq</span><span class="delimiter">[</span>Node<span class="delimiter">]</span> = <a href="#95725" title="scala.xml.Node">n</a> <span title="Seq[scala.xml.Node]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Seq[scala.xml.Node]" id="95728">e</a>: <span title="scala.xml.Elem">Elem</span> <span class="keyword">if</span> <a href="#93941" title="(e: scala.xml.Node)Boolean">isHeader</a><span class="delimiter">(</span><a href="#95728" title="scala.xml.Elem">e</a><span class="delimiter">)</span> =&gt; &lt;<a title="scala.xml.MetaData" id="95729">a</a> name=<span class="delimiter">{</span><a href="#93925" title="(s: String)java.lang.String">sanitize</a><span class="delimiter">(</span><a href="#93938" title="(n: scala.xml.Node)String">nodeText</a><span class="delimiter">(</span><a href="#95728" title="scala.xml.Elem">e</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">}</span>/&gt; <span title="(that: scala.collection.GenTraversableOnce[scala.xml.Node])(implicit bf: scala.collection.generic.CanBuildFrom[scala.xml.NodeSeq,scala.xml.Node,Seq[scala.xml.Node]])Seq[scala.xml.Node]">++</span> <a href="#95728" title="scala.xml.Elem">e</a>
      <span class="keyword">case</span> <a title="scala.xml.Node" id="95789">other</a> =&gt; <a href="#95789" title="scala.xml.Node">other</a>
    <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="(n: scala.xml.Node)scala.xml.Node" id="94585">addTo</a><span class="delimiter">(</span><a title="scala.xml.Node" id="94586">n</a>: <span title="scala.xml.Node">Node</span><span class="delimiter">)</span> = <span title="scala.xml.transform.RuleTransformer" class="keyword">new</span> <span title="scala.xml.transform.RuleTransformer">RuleTransformer</span><span class="delimiter">(</span><span class="keyword">this</span><span class="delimiter">)</span>.<span title="(n: scala.xml.Node)scala.xml.Node">apply</span><span class="delimiter">(</span><a href="#94586" title="scala.xml.Node">n</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">/** This rule can replace the toc element with a table of contents derived from the body */</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(body: scala.xml.Node)scala.xml.transform.RewriteRule{def add: scala.xml.Node}" id="93945">tableOfContents</a><span class="delimiter">(</span><a title="scala.xml.Node" id="94160">body</a>: <span title="scala.xml.Node">Node</span><span class="delimiter">)</span> = <a href="#94163" title="scala.xml.transform.RewriteRule{def add: scala.xml.Node}" class="keyword">new</a> <a title="anonymous class $anon extends scala.xml.transform.RewriteRule" id="94163">RewriteRule</a> <span class="delimiter">{</span>
    <span class="keyword">override</span> <span class="keyword">def</span> <a title="(n: scala.xml.Node)Seq[scala.xml.Node]" id="94172">transform</a><span class="delimiter">(</span><a title="scala.xml.Node" id="94188">n</a>: <span title="scala.xml.Node">Node</span><span class="delimiter">)</span>: <span title="Seq[scala.xml.Node]">Seq</span><span class="delimiter">[</span>Node<span class="delimiter">]</span> = <a href="#94188" title="scala.xml.Node">n</a> <span title="Seq[scala.xml.Node]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> &lt;<a href="#94202" title="(n: scala.xml.Node)Option[(String, String, scala.xml.MetaData, scala.xml.NamespaceBinding, Seq[scala.xml.Node])]">toc</a>/&gt; =&gt; <a href="#93937" title="(body: scala.xml.NodeSeq, url: String)scala.xml.NodeSeq">headersToc</a><span class="delimiter">(</span><a href="#93927" title="(body: scala.xml.NodeSeq)scala.xml.NodeSeq">headers</a><span class="delimiter">(</span><a href="#94160" title="scala.xml.Node">body</a><span class="delimiter">)</span>.<span title="(n: Int)scala.xml.NodeSeq">drop</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="scala.xml.Node" id="94560">other</a> =&gt; <a href="#94560" title="scala.xml.Node">other</a>
    <span class="delimiter">}</span>
    <span class="keyword">def</span> <a title="=&gt; scala.xml.Node" id="94173">add</a> = <span title="scala.xml.transform.RuleTransformer" class="keyword">new</span> <span title="scala.xml.transform.RuleTransformer">RuleTransformer</span><span class="delimiter">(</span><a href="#94163" title="scala.xml.transform.RewriteRule{def add: scala.xml.Node}" class="keyword">this</a><span class="delimiter">)</span>.<span title="(n: scala.xml.Node)scala.xml.Node">apply</span><span class="delimiter">(</span><a href="#94160" title="scala.xml.Node">body</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.xml.Node =&gt; scala.xml.Node" id="93946">insertToc</a> = <span class="delimiter">(</span>n: <span title="scala.xml.Node">Node</span><span class="delimiter">)</span> =&gt; <a href="#93945" title="(body: scala.xml.Node)scala.xml.transform.RewriteRule{def add: scala.xml.Node}">tableOfContents</a><span class="delimiter">(</span><a href="#94159" title="scala.xml.Node">n</a><span class="delimiter">)</span>.<a href="#94579" title="=&gt; scala.xml.Node">add</a>
<span class="delimiter">}</span>
<span class="keyword">private</span><span class="delimiter">[</span>specs2<span class="delimiter">]</span>
<span class="keyword">object</span> <a title="object org.specs2.html.TableOfContents" id="9924">TableOfContents</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#9923" title="org.specs2.html.TableOfContents">TableOfContents</a>

        </pre>
    </body>
</html>